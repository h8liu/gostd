<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5789208">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5789263">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5789317">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5789368">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspPackage&nbsp;rpc&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;exported&nbsp;methods&nbsp;of&nbsp;an&nbsp;object&nbsp;across&nbsp;a<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspnetwork&nbsp;or&nbsp;other&nbsp;I/O&nbsp;connection.&nbsp;&nbsp;A&nbsp;server&nbsp;registers&nbsp;an&nbsp;object,&nbsp;making&nbsp;it&nbsp;visible<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspas&nbsp;a&nbsp;service&nbsp;with&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;object.&nbsp;&nbsp;After&nbsp;registration,&nbsp;exported<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspmethods&nbsp;of&nbsp;the&nbsp;object&nbsp;will&nbsp;be&nbsp;accessible&nbsp;remotely.&nbsp;&nbsp;A&nbsp;server&nbsp;may&nbsp;register&nbsp;multiple<br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbspobjects&nbsp;(services)&nbsp;of&nbsp;different&nbsp;types&nbsp;but&nbsp;it&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;register&nbsp;multiple<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspobjects&nbsp;of&nbsp;the&nbsp;same&nbsp;type.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspOnly&nbsp;methods&nbsp;that&nbsp;satisfy&nbsp;these&nbsp;criteria&nbsp;will&nbsp;be&nbsp;made&nbsp;available&nbsp;for&nbsp;remote&nbsp;access;<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspother&nbsp;methods&nbsp;will&nbsp;be&nbsp;ignored:<br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;method&nbsp;is&nbsp;exported.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;method&nbsp;has&nbsp;two&nbsp;arguments,&nbsp;both&nbsp;exported&nbsp;(or&nbsp;builtin)&nbsp;types.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;method&#39;s&nbsp;second&nbsp;argument&nbsp;is&nbsp;a&nbsp;pointer.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;method&nbsp;has&nbsp;return&nbsp;type&nbsp;error.<br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspIn&nbsp;effect,&nbsp;the&nbsp;method&nbsp;must&nbsp;look&nbsp;schematically&nbsp;like<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(t&nbsp;*T)&nbsp;MethodName(argType&nbsp;T1,&nbsp;replyType&nbsp;*T2)&nbsp;error<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbspwhere&nbsp;T,&nbsp;T1&nbsp;and&nbsp;T2&nbsp;can&nbsp;be&nbsp;marshaled&nbsp;by&nbsp;encoding/gob.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThese&nbsp;requirements&nbsp;apply&nbsp;even&nbsp;if&nbsp;a&nbsp;different&nbsp;codec&nbsp;is&nbsp;used.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp(In&nbsp;the&nbsp;future,&nbsp;these&nbsp;requirements&nbsp;may&nbsp;soften&nbsp;for&nbsp;custom&nbsp;codecs.)<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;method&#39;s&nbsp;first&nbsp;argument&nbsp;represents&nbsp;the&nbsp;arguments&nbsp;provided&nbsp;by&nbsp;the&nbsp;caller;&nbsp;the<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbspsecond&nbsp;argument&nbsp;represents&nbsp;the&nbsp;result&nbsp;parameters&nbsp;to&nbsp;be&nbsp;returned&nbsp;to&nbsp;the&nbsp;caller.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;method&#39;s&nbsp;return&nbsp;value,&nbsp;if&nbsp;non-nil,&nbsp;is&nbsp;passed&nbsp;back&nbsp;as&nbsp;a&nbsp;string&nbsp;that&nbsp;the&nbsp;client<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspsees&nbsp;as&nbsp;if&nbsp;created&nbsp;by&nbsp;errors.New.&nbsp;&nbsp;If&nbsp;an&nbsp;error&nbsp;is&nbsp;returned,&nbsp;the&nbsp;reply&nbsp;parameter<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspwill&nbsp;not&nbsp;be&nbsp;sent&nbsp;back&nbsp;to&nbsp;the&nbsp;client.<br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;server&nbsp;may&nbsp;handle&nbsp;requests&nbsp;on&nbsp;a&nbsp;single&nbsp;connection&nbsp;by&nbsp;calling&nbsp;ServeConn.&nbsp;&nbsp;More<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsptypically&nbsp;it&nbsp;will&nbsp;create&nbsp;a&nbsp;network&nbsp;listener&nbsp;and&nbsp;call&nbsp;Accept&nbsp;or,&nbsp;for&nbsp;an&nbsp;HTTP<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsplistener,&nbsp;HandleHTTP&nbsp;and&nbsp;http.Serve.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspA&nbsp;client&nbsp;wishing&nbsp;to&nbsp;use&nbsp;the&nbsp;service&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;and&nbsp;then&nbsp;invokes<br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbspNewClient&nbsp;on&nbsp;the&nbsp;connection.&nbsp;&nbsp;The&nbsp;convenience&nbsp;function&nbsp;Dial&nbsp;(DialHTTP)&nbsp;performs<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspboth&nbsp;steps&nbsp;for&nbsp;a&nbsp;raw&nbsp;network&nbsp;connection&nbsp;(an&nbsp;HTTP&nbsp;connection).&nbsp;&nbsp;The&nbsp;resulting<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspClient&nbsp;object&nbsp;has&nbsp;two&nbsp;methods,&nbsp;Call&nbsp;and&nbsp;Go,&nbsp;that&nbsp;specify&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspcall,&nbsp;a&nbsp;pointer&nbsp;containing&nbsp;the&nbsp;arguments,&nbsp;and&nbsp;a&nbsp;pointer&nbsp;to&nbsp;receive&nbsp;the&nbsp;result<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspparameters.<br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;Call&nbsp;method&nbsp;waits&nbsp;for&nbsp;the&nbsp;remote&nbsp;call&nbsp;to&nbsp;complete&nbsp;while&nbsp;the&nbsp;Go&nbsp;method<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsplaunches&nbsp;the&nbsp;call&nbsp;asynchronously&nbsp;and&nbsp;signals&nbsp;completion&nbsp;using&nbsp;the&nbsp;Call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspstructure&#39;s&nbsp;Done&nbsp;channel.<br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbspUnless&nbsp;an&nbsp;explicit&nbsp;codec&nbsp;is&nbsp;set&nbsp;up,&nbsp;package&nbsp;encoding/gob&nbsp;is&nbsp;used&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsptransport&nbsp;the&nbsp;data.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspHere&nbsp;is&nbsp;a&nbsp;simple&nbsp;example.&nbsp;&nbsp;A&nbsp;server&nbsp;wishes&nbsp;to&nbsp;export&nbsp;an&nbsp;object&nbsp;of&nbsp;type&nbsp;Arith:<br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;server<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptype&nbsp;Args&nbsp;struct&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspA,&nbsp;B&nbsp;int<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptype&nbsp;Quotient&nbsp;struct&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspQuo,&nbsp;Rem&nbsp;int<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptype&nbsp;Arith&nbsp;int<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(t&nbsp;*Arith)&nbsp;Multiply(args&nbsp;*Args,&nbsp;reply&nbsp;*int)&nbsp;error&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp*reply&nbsp;=&nbsp;args.A&nbsp;*&nbsp;args.B<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;nil<br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(t&nbsp;*Arith)&nbsp;Divide(args&nbsp;*Args,&nbsp;quo&nbsp;*Quotient)&nbsp;error&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;args.B&nbsp;==&nbsp;0&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;errors.New(&#34;divide&nbsp;by&nbsp;zero&#34;)<br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspquo.Quo&nbsp;=&nbsp;args.A&nbsp;/&nbsp;args.B<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspquo.Rem&nbsp;=&nbsp;args.A&nbsp;%&nbsp;args.B<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;nil<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;server&nbsp;calls&nbsp;(for&nbsp;HTTP&nbsp;service):<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsparith&nbsp;:=&nbsp;new(Arith)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsprpc.Register(arith)<br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsprpc.HandleHTTP()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspl,&nbsp;e&nbsp;:=&nbsp;net.Listen(&#34;tcp&#34;,&nbsp;&#34;:1234&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;e&nbsp;!=&nbsp;nil&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Fatal(&#34;listen&nbsp;error:&#34;,&nbsp;e)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;http.Serve(l,&nbsp;nil)<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspAt&nbsp;this&nbsp;point,&nbsp;clients&nbsp;can&nbsp;see&nbsp;a&nbsp;service&nbsp;&#34;Arith&#34;&nbsp;with&nbsp;methods&nbsp;&#34;Arith.Multiply&#34;&nbsp;and<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&#34;Arith.Divide&#34;.&nbsp;&nbsp;To&nbsp;invoke&nbsp;one,&nbsp;a&nbsp;client&nbsp;first&nbsp;dials&nbsp;the&nbsp;server:<br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspclient,&nbsp;err&nbsp;:=&nbsp;rpc.DialHTTP(&#34;tcp&#34;,&nbsp;serverAddress&nbsp;+&nbsp;&#34;:1234&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Fatal(&#34;dialing:&#34;,&nbsp;err)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbspThen&nbsp;it&nbsp;can&nbsp;make&nbsp;a&nbsp;remote&nbsp;call:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;Synchronous&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspargs&nbsp;:=&nbsp;&amp;server.Args{7,8}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspvar&nbsp;reply&nbsp;int<br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;client.Call(&#34;Arith.Multiply&#34;,&nbsp;args,&nbsp;&amp;reply)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspif&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Fatal(&#34;arith&nbsp;error:&#34;,&nbsp;err)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfmt.Printf(&#34;Arith:&nbsp;%d*%d=%d&#34;,&nbsp;args.A,&nbsp;args.B,&nbsp;reply)<br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspor<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;Asynchronous&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspquotient&nbsp;:=&nbsp;new(Quotient)<br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspdivCall&nbsp;:=&nbsp;client.Go(&#34;Arith.Divide&#34;,&nbsp;args,&nbsp;quotient,&nbsp;nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreplyCall&nbsp;:=&nbsp;&lt;-divCall.Done&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;will&nbsp;be&nbsp;equal&nbsp;to&nbsp;divCall<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;check&nbsp;errors,&nbsp;print,&nbsp;etc.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspA&nbsp;server&nbsp;implementation&nbsp;will&nbsp;often&nbsp;provide&nbsp;a&nbsp;simple,&nbsp;type-safe&nbsp;wrapper&nbsp;for&nbsp;the<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbspclient.<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="5793197">package</span>&nbsp;<span class="ident" id="5793205">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5793210">import</span>&nbsp;<span class="op" id="5793217">(</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5793220">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5793229">&#34;encoding/gob&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5793245">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5793255">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5793261">&#34;log&#34;</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5793268">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5793275">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5793287">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5793298">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5793309">&#34;sync&#34;</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5793317">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5793328">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5793343">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5793346">const</span>&nbsp;<span class="op" id="5793352">(</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5793355">//&nbsp;Defaults&nbsp;used&nbsp;by&nbsp;HandleHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793387">DefaultRPCPath</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5793404">=</span>&nbsp;<span class="string" id="5793406">&#34;/_goRPC_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793418">DefaultDebugPath</span>&nbsp;<span class="op" id="5793435">=</span>&nbsp;<span class="string" id="5793437">&#34;/debug/rpc&#34;</span><br>
<span class="lineno"></span><span class="op" id="5793450">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="5793453">//&nbsp;Precompute&nbsp;the&nbsp;reflect&nbsp;type&nbsp;for&nbsp;error.&nbsp;&nbsp;Can&#39;t&nbsp;use&nbsp;error&nbsp;directly</span><br>
<span class="lineno"></span><span class="comment" id="5793521">//&nbsp;because&nbsp;Typeof&nbsp;takes&nbsp;an&nbsp;empty&nbsp;interface&nbsp;value.&nbsp;&nbsp;This&nbsp;is&nbsp;annoying.</span><br>
<span class="lineno"></span><span class="keyword" id="5793590">var</span>&nbsp;<span class="ident" id="5793594">typeOfError</span>&nbsp;<span class="op" id="5793606">=</span>&nbsp;<span class="ident" id="5793608"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5793615">.</span><span class="ident" id="5793616">TypeOf</span><span class="op" id="5793622">(</span><span class="op" id="5793623">(</span><span class="op" id="5793624">*</span><span class="builtintype" id="5793625">error</span><span class="op" id="5793630">)</span><span class="op" id="5793631">(</span><span class="ident" id="5793632">nil</span><span class="op" id="5793635">)</span><span class="op" id="5793636">)</span><span class="op" id="5793637">.</span><span class="ident" id="5793638">Elem</span><span class="op" id="5793642">(</span><span class="op" id="5793643">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5793646">type</span>&nbsp;<span class="ident" id="5793651">methodType</span>&nbsp;<span class="keyword" id="5793662">struct</span>&nbsp;<span class="op" id="5793669">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793672"><a href="/net/rpc/server.go.html#5793309">sync</a></span><span class="op" id="5793676">.</span><span class="ident" id="5793677">Mutex</span>&nbsp;<span class="comment" id="5793683">//&nbsp;protects&nbsp;counters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793705">method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5793716"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5793723">.</span><span class="ident" id="5793724">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793732">ArgType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5793743"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5793750">.</span><span class="ident" id="5793751">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793757">ReplyType</span>&nbsp;&nbsp;<span class="ident" id="5793768"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5793775">.</span><span class="ident" id="5793776">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793782">numCalls</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5793793">uint</span><br>
<span class="lineno">155</span><span class="op" id="5793798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5793801">type</span>&nbsp;<span class="ident" id="5793806">service</span>&nbsp;<span class="keyword" id="5793814">struct</span>&nbsp;<span class="op" id="5793821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793824">name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5793831">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5793854">//&nbsp;name&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793874">rcvr</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5793881"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5793888">.</span><span class="ident" id="5793889">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5793904">//&nbsp;receiver&nbsp;of&nbsp;methods&nbsp;for&nbsp;the&nbsp;service</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793944">typ</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5793951"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5793958">.</span><span class="ident" id="5793959">Type</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5793974">//&nbsp;type&nbsp;of&nbsp;the&nbsp;receiver</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5793999">method</span>&nbsp;<span class="keyword" id="5794006">map</span><span class="op" id="5794009">[</span><span class="builtintype" id="5794010">string</span><span class="op" id="5794016">]</span><span class="op" id="5794017">*</span><span class="ident" id="5794018"><a href="/net/rpc/server.go.html#5793651">methodType</a></span>&nbsp;<span class="comment" id="5794029">//&nbsp;registered&nbsp;methods</span><br>
<span class="lineno"></span><span class="op" id="5794051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5794054">//&nbsp;Request&nbsp;is&nbsp;a&nbsp;header&nbsp;written&nbsp;before&nbsp;every&nbsp;RPC&nbsp;call.&nbsp;&nbsp;It&nbsp;is&nbsp;used&nbsp;internally</span><br>
<span class="lineno">165</span><span class="comment" id="5794131">//&nbsp;but&nbsp;documented&nbsp;here&nbsp;as&nbsp;an&nbsp;aid&nbsp;to&nbsp;debugging,&nbsp;such&nbsp;as&nbsp;when&nbsp;analyzing</span><br>
<span class="lineno"></span><span class="comment" id="5794201">//&nbsp;network&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="5794221">type</span>&nbsp;<span class="ident" id="5794226">Request</span>&nbsp;<span class="keyword" id="5794234">struct</span>&nbsp;<span class="op" id="5794241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5794244">ServiceMethod</span>&nbsp;<span class="builtintype" id="5794258">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5794267">//&nbsp;format:&nbsp;&#34;Service.Method&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5794296">Seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5794310">uint64</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5794319">//&nbsp;sequence&nbsp;number&nbsp;chosen&nbsp;by&nbsp;client</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5794356">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5794370">*</span><span class="ident" id="5794371"><a href="/net/rpc/server.go.html#5794226">Request</a></span>&nbsp;<span class="comment" id="5794379">//&nbsp;for&nbsp;free&nbsp;list&nbsp;in&nbsp;Server</span><br>
<span class="lineno"></span><span class="op" id="5794406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5794409">//&nbsp;Response&nbsp;is&nbsp;a&nbsp;header&nbsp;written&nbsp;before&nbsp;every&nbsp;RPC&nbsp;return.&nbsp;&nbsp;It&nbsp;is&nbsp;used&nbsp;internally</span><br>
<span class="lineno"></span><span class="comment" id="5794489">//&nbsp;but&nbsp;documented&nbsp;here&nbsp;as&nbsp;an&nbsp;aid&nbsp;to&nbsp;debugging,&nbsp;such&nbsp;as&nbsp;when&nbsp;analyzing</span><br>
<span class="lineno">175</span><span class="comment" id="5794559">//&nbsp;network&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="5794579">type</span>&nbsp;<span class="ident" id="5794584">Response</span>&nbsp;<span class="keyword" id="5794593">struct</span>&nbsp;<span class="op" id="5794600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5794603">ServiceMethod</span>&nbsp;<span class="builtintype" id="5794617">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5794627">//&nbsp;echoes&nbsp;that&nbsp;of&nbsp;the&nbsp;Request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5794658">Seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5794672">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5794682">//&nbsp;echoes&nbsp;that&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5794713">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5794727">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5794737">//&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5794756">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5794770">*</span><span class="ident" id="5794771"><a href="/net/rpc/server.go.html#5794584">Response</a></span>&nbsp;<span class="comment" id="5794780">//&nbsp;for&nbsp;free&nbsp;list&nbsp;in&nbsp;Server</span><br>
<span class="lineno"></span><span class="op" id="5794807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5794810">//&nbsp;Server&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Server.</span><br>
<span class="lineno"></span><span class="keyword" id="5794846">type</span>&nbsp;<span class="ident" id="5794851">Server</span>&nbsp;<span class="keyword" id="5794858">struct</span>&nbsp;<span class="op" id="5794865">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5794868">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5794879"><a href="/net/rpc/server.go.html#5793309">sync</a></span><span class="op" id="5794883">.</span><span class="ident" id="5794884">RWMutex</span>&nbsp;<span class="comment" id="5794892">//&nbsp;protects&nbsp;the&nbsp;serviceMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5794920">serviceMap</span>&nbsp;<span class="keyword" id="5794931">map</span><span class="op" id="5794934">[</span><span class="builtintype" id="5794935">string</span><span class="op" id="5794941">]</span><span class="op" id="5794942">*</span><span class="ident" id="5794943"><a href="/net/rpc/server.go.html#5793806">service</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5794952">reqLock</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5794963"><a href="/net/rpc/server.go.html#5793309">sync</a></span><span class="op" id="5794967">.</span><span class="ident" id="5794968">Mutex</span>&nbsp;<span class="comment" id="5794974">//&nbsp;protects&nbsp;freeReq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5794995">freeReq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5795006">*</span><span class="ident" id="5795007"><a href="/net/rpc/server.go.html#5794226">Request</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5795016">respLock</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5795027"><a href="/net/rpc/server.go.html#5793309">sync</a></span><span class="op" id="5795031">.</span><span class="ident" id="5795032">Mutex</span>&nbsp;<span class="comment" id="5795038">//&nbsp;protects&nbsp;freeResp</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5795060">freeResp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5795071">*</span><span class="ident" id="5795072"><a href="/net/rpc/server.go.html#5794584">Response</a></span><br>
<span class="lineno"></span><span class="op" id="5795081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5795084">//&nbsp;NewServer&nbsp;returns&nbsp;a&nbsp;new&nbsp;Server.</span><br>
<span class="lineno"></span><span class="keyword" id="5795119">func</span>&nbsp;<span class="ident" id="5795124">NewServer</span><span class="op" id="5795133">(</span><span class="op" id="5795134">)</span>&nbsp;<span class="op" id="5795136">*</span><span class="ident" id="5795137"><a href="/net/rpc/server.go.html#5794851">Server</a></span>&nbsp;<span class="op" id="5795144">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5795147">return</span>&nbsp;<span class="op" id="5795154">&amp;</span><span class="ident" id="5795155"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5795161">{</span><span class="ident" id="5795162">serviceMap</span><span class="op" id="5795172">:</span>&nbsp;<span class="builtinfunc" id="5795174">make</span><span class="op" id="5795178">(</span><span class="keyword" id="5795179">map</span><span class="op" id="5795182">[</span><span class="builtintype" id="5795183">string</span><span class="op" id="5795189">]</span><span class="op" id="5795190">*</span><span class="ident" id="5795191"><a href="/net/rpc/server.go.html#5793806">service</a></span><span class="op" id="5795198">)</span><span class="op" id="5795199">}</span><br>
<span class="lineno"></span><span class="op" id="5795201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5795204">//&nbsp;DefaultServer&nbsp;is&nbsp;the&nbsp;default&nbsp;instance&nbsp;of&nbsp;*Server.</span><br>
<span class="lineno"></span><span class="keyword" id="5795257">var</span>&nbsp;<span class="ident" id="5795261">DefaultServer</span>&nbsp;<span class="op" id="5795275">=</span>&nbsp;<span class="ident" id="5795277"><a href="/net/rpc/server.go.html#5795124">NewServer</a></span><span class="op" id="5795286">(</span><span class="op" id="5795287">)</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5795290">//&nbsp;Is&nbsp;this&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name?</span><br>
<span class="lineno"></span><span class="keyword" id="5795334">func</span>&nbsp;<span class="ident" id="5795339">isExported</span><span class="op" id="5795349">(</span><span class="ident" id="5795350">name</span>&nbsp;<span class="builtintype" id="5795355">string</span><span class="op" id="5795361">)</span>&nbsp;<span class="builtintype" id="5795363">bool</span>&nbsp;<span class="op" id="5795368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5795371">rune</span><span class="op" id="5795375">,</span>&nbsp;<span class="ident" id="5795377">_</span>&nbsp;<span class="op" id="5795379">:=</span>&nbsp;<span class="ident" id="5795382"><a href="/net/rpc/server.go.html#5793328">utf8</a></span><span class="op" id="5795386">.</span><span class="ident" id="5795387">DecodeRuneInString</span><span class="op" id="5795405">(</span><span class="ident" id="5795406"><a href="/net/rpc/server.go.html#5795350">name</a></span><span class="op" id="5795410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5795413">return</span>&nbsp;<span class="ident" id="5795420"><a href="/net/rpc/server.go.html#5793317">unicode</a></span><span class="op" id="5795427">.</span><span class="ident" id="5795428">IsUpper</span><span class="op" id="5795435">(</span><span class="builtintype" id="5795436"><a href="/net/rpc/server.go.html#5795371">rune</a></span><span class="op" id="5795440">)</span><br>
<span class="lineno">205</span><span class="op" id="5795442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5795445">//&nbsp;Is&nbsp;this&nbsp;type&nbsp;exported&nbsp;or&nbsp;a&nbsp;builtin?</span><br>
<span class="lineno"></span><span class="keyword" id="5795484">func</span>&nbsp;<span class="ident" id="5795489">isExportedOrBuiltinType</span><span class="op" id="5795512">(</span><span class="ident" id="5795513">t</span>&nbsp;<span class="ident" id="5795515"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5795522">.</span><span class="ident" id="5795523">Type</span><span class="op" id="5795527">)</span>&nbsp;<span class="builtintype" id="5795529">bool</span>&nbsp;<span class="op" id="5795534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5795537">for</span>&nbsp;<span class="ident" id="5795541"><a href="/net/rpc/server.go.html#5795513">t</a></span><span class="op" id="5795542">.</span><span class="ident" id="5795543">Kind</span><span class="op" id="5795547">(</span><span class="op" id="5795548">)</span>&nbsp;<span class="op" id="5795550">==</span>&nbsp;<span class="ident" id="5795553"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5795560">.</span><span class="ident" id="5795561">Ptr</span>&nbsp;<span class="op" id="5795565">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5795569"><a href="/net/rpc/server.go.html#5795513">t</a></span>&nbsp;<span class="op" id="5795571">=</span>&nbsp;<span class="ident" id="5795573"><a href="/net/rpc/server.go.html#5795513">t</a></span><span class="op" id="5795574">.</span><span class="ident" id="5795575">Elem</span><span class="op" id="5795579">(</span><span class="op" id="5795580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5795583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5795586">//&nbsp;PkgPath&nbsp;will&nbsp;be&nbsp;non-empty&nbsp;even&nbsp;for&nbsp;an&nbsp;exported&nbsp;type,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5795643">//&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;check&nbsp;the&nbsp;type&nbsp;name&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5795690">return</span>&nbsp;<span class="ident" id="5795697"><a href="/net/rpc/server.go.html#5795339">isExported</a></span><span class="op" id="5795707">(</span><span class="ident" id="5795708"><a href="/net/rpc/server.go.html#5795513">t</a></span><span class="op" id="5795709">.</span><span class="ident" id="5795710">Name</span><span class="op" id="5795714">(</span><span class="op" id="5795715">)</span><span class="op" id="5795716">)</span>&nbsp;<span class="op" id="5795718">||</span>&nbsp;<span class="ident" id="5795721"><a href="/net/rpc/server.go.html#5795513">t</a></span><span class="op" id="5795722">.</span><span class="ident" id="5795723">PkgPath</span><span class="op" id="5795730">(</span><span class="op" id="5795731">)</span>&nbsp;<span class="op" id="5795733">==</span>&nbsp;<span class="string" id="5795736">&#34;&#34;</span><br>
<span class="lineno">215</span><span class="op" id="5795739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5795742">//&nbsp;Register&nbsp;publishes&nbsp;in&nbsp;the&nbsp;server&nbsp;the&nbsp;set&nbsp;of&nbsp;methods&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5795804">//&nbsp;receiver&nbsp;value&nbsp;that&nbsp;satisfy&nbsp;the&nbsp;following&nbsp;conditions:</span><br>
<span class="lineno"></span><span class="comment" id="5795861">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;exported&nbsp;method</span><br>
<span class="lineno">220</span><span class="comment" id="5795882">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;two&nbsp;arguments,&nbsp;both&nbsp;of&nbsp;exported&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5795924">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;second&nbsp;argument&nbsp;is&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span><span class="comment" id="5795962">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;one&nbsp;return&nbsp;value,&nbsp;of&nbsp;type&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5795999">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;not&nbsp;an&nbsp;exported&nbsp;type&nbsp;or&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="5796069">//&nbsp;no&nbsp;suitable&nbsp;methods.&nbsp;It&nbsp;also&nbsp;logs&nbsp;the&nbsp;error&nbsp;using&nbsp;package&nbsp;log.</span><br>
<span class="lineno">225</span><span class="comment" id="5796135">//&nbsp;The&nbsp;client&nbsp;accesses&nbsp;each&nbsp;method&nbsp;using&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;Type.Method&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5796212">//&nbsp;where&nbsp;Type&nbsp;is&nbsp;the&nbsp;receiver&#39;s&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5796259">func</span>&nbsp;<span class="op" id="5796264">(</span><span class="ident" id="5796265">server</span>&nbsp;<span class="op" id="5796272">*</span><span class="ident" id="5796273"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5796279">)</span>&nbsp;<span class="ident" id="5796281">Register</span><span class="op" id="5796289">(</span><span class="ident" id="5796290">rcvr</span>&nbsp;<span class="keyword" id="5796295">interface</span><span class="op" id="5796304">{</span><span class="op" id="5796305">}</span><span class="op" id="5796306">)</span>&nbsp;<span class="builtintype" id="5796308">error</span>&nbsp;<span class="op" id="5796314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5796317">return</span>&nbsp;<span class="ident" id="5796324"><a href="/net/rpc/server.go.html#5796265">server</a></span><span class="op" id="5796330">.</span><span class="ident" id="5796331">register</span><span class="op" id="5796339">(</span><span class="ident" id="5796340"><a href="/net/rpc/server.go.html#5796290">rcvr</a></span><span class="op" id="5796344">,</span>&nbsp;<span class="string" id="5796346">&#34;&#34;</span><span class="op" id="5796348">,</span>&nbsp;<span class="builtintype" id="5796350">false</span><span class="op" id="5796355">)</span><br>
<span class="lineno"></span><span class="op" id="5796357">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5796360">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5796433">//&nbsp;instead&nbsp;of&nbsp;the&nbsp;receiver&#39;s&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5796477">func</span>&nbsp;<span class="op" id="5796482">(</span><span class="ident" id="5796483">server</span>&nbsp;<span class="op" id="5796490">*</span><span class="ident" id="5796491"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5796497">)</span>&nbsp;<span class="ident" id="5796499">RegisterName</span><span class="op" id="5796511">(</span><span class="ident" id="5796512">name</span>&nbsp;<span class="builtintype" id="5796517">string</span><span class="op" id="5796523">,</span>&nbsp;<span class="ident" id="5796525">rcvr</span>&nbsp;<span class="keyword" id="5796530">interface</span><span class="op" id="5796539">{</span><span class="op" id="5796540">}</span><span class="op" id="5796541">)</span>&nbsp;<span class="builtintype" id="5796543">error</span>&nbsp;<span class="op" id="5796549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5796552">return</span>&nbsp;<span class="ident" id="5796559"><a href="/net/rpc/server.go.html#5796483">server</a></span><span class="op" id="5796565">.</span><span class="ident" id="5796566">register</span><span class="op" id="5796574">(</span><span class="ident" id="5796575"><a href="/net/rpc/server.go.html#5796525">rcvr</a></span><span class="op" id="5796579">,</span>&nbsp;<span class="ident" id="5796581"><a href="/net/rpc/server.go.html#5796512">name</a></span><span class="op" id="5796585">,</span>&nbsp;<span class="builtintype" id="5796587">true</span><span class="op" id="5796591">)</span><br>
<span class="lineno">235</span><span class="op" id="5796593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5796596">func</span>&nbsp;<span class="op" id="5796601">(</span><span class="ident" id="5796602">server</span>&nbsp;<span class="op" id="5796609">*</span><span class="ident" id="5796610"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5796616">)</span>&nbsp;<span class="ident" id="5796618">register</span><span class="op" id="5796626">(</span><span class="ident" id="5796627">rcvr</span>&nbsp;<span class="keyword" id="5796632">interface</span><span class="op" id="5796641">{</span><span class="op" id="5796642">}</span><span class="op" id="5796643">,</span>&nbsp;<span class="ident" id="5796645">name</span>&nbsp;<span class="builtintype" id="5796650">string</span><span class="op" id="5796656">,</span>&nbsp;<span class="ident" id="5796658">useName</span>&nbsp;<span class="builtintype" id="5796666">bool</span><span class="op" id="5796670">)</span>&nbsp;<span class="builtintype" id="5796672">error</span>&nbsp;<span class="op" id="5796678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796681"><a href="/net/rpc/server.go.html#5796602">server</a></span><span class="op" id="5796687">.</span><span class="ident" id="5796688">mu</span><span class="op" id="5796690">.</span><span class="ident" id="5796691">Lock</span><span class="op" id="5796695">(</span><span class="op" id="5796696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5796699">defer</span>&nbsp;<span class="ident" id="5796705"><a href="/net/rpc/server.go.html#5796602">server</a></span><span class="op" id="5796711">.</span><span class="ident" id="5796712">mu</span><span class="op" id="5796714">.</span><span class="ident" id="5796715">Unlock</span><span class="op" id="5796721">(</span><span class="op" id="5796722">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5796725">if</span>&nbsp;<span class="ident" id="5796728"><a href="/net/rpc/server.go.html#5796602">server</a></span><span class="op" id="5796734">.</span><span class="ident" id="5796735">serviceMap</span>&nbsp;<span class="op" id="5796746">==</span>&nbsp;<span class="ident" id="5796749">nil</span>&nbsp;<span class="op" id="5796753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796757"><a href="/net/rpc/server.go.html#5796602">server</a></span><span class="op" id="5796763">.</span><span class="ident" id="5796764">serviceMap</span>&nbsp;<span class="op" id="5796775">=</span>&nbsp;<span class="builtinfunc" id="5796777">make</span><span class="op" id="5796781">(</span><span class="keyword" id="5796782">map</span><span class="op" id="5796785">[</span><span class="builtintype" id="5796786">string</span><span class="op" id="5796792">]</span><span class="op" id="5796793">*</span><span class="ident" id="5796794"><a href="/net/rpc/server.go.html#5793806">service</a></span><span class="op" id="5796801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5796804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796807">s</span>&nbsp;<span class="op" id="5796809">:=</span>&nbsp;<span class="builtinfunc" id="5796812">new</span><span class="op" id="5796815">(</span><span class="ident" id="5796816"><a href="/net/rpc/server.go.html#5793806">service</a></span><span class="op" id="5796823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796826"><a href="/net/rpc/server.go.html#5796807">s</a></span><span class="op" id="5796827">.</span><span class="ident" id="5796828">typ</span>&nbsp;<span class="op" id="5796832">=</span>&nbsp;<span class="ident" id="5796834"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5796841">.</span><span class="ident" id="5796842">TypeOf</span><span class="op" id="5796848">(</span><span class="ident" id="5796849"><a href="/net/rpc/server.go.html#5796627">rcvr</a></span><span class="op" id="5796853">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796856"><a href="/net/rpc/server.go.html#5796807">s</a></span><span class="op" id="5796857">.</span><span class="ident" id="5796858">rcvr</span>&nbsp;<span class="op" id="5796863">=</span>&nbsp;<span class="ident" id="5796865"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5796872">.</span><span class="ident" id="5796873">ValueOf</span><span class="op" id="5796880">(</span><span class="ident" id="5796881"><a href="/net/rpc/server.go.html#5796627">rcvr</a></span><span class="op" id="5796885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796888">sname</span>&nbsp;<span class="op" id="5796894">:=</span>&nbsp;<span class="ident" id="5796897"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5796904">.</span><span class="ident" id="5796905">Indirect</span><span class="op" id="5796913">(</span><span class="ident" id="5796914"><a href="/net/rpc/server.go.html#5796807">s</a></span><span class="op" id="5796915">.</span><span class="ident" id="5796916">rcvr</span><span class="op" id="5796920">)</span><span class="op" id="5796921">.</span><span class="ident" id="5796922">Type</span><span class="op" id="5796926">(</span><span class="op" id="5796927">)</span><span class="op" id="5796928">.</span><span class="ident" id="5796929">Name</span><span class="op" id="5796933">(</span><span class="op" id="5796934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5796937">if</span>&nbsp;<span class="ident" id="5796940"><a href="/net/rpc/server.go.html#5796658">useName</a></span>&nbsp;<span class="op" id="5796948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796952"><a href="/net/rpc/server.go.html#5796888">sname</a></span>&nbsp;<span class="op" id="5796958">=</span>&nbsp;<span class="ident" id="5796960"><a href="/net/rpc/server.go.html#5796645">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5796966">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5796969">if</span>&nbsp;<span class="ident" id="5796972"><a href="/net/rpc/server.go.html#5796888">sname</a></span>&nbsp;<span class="op" id="5796978">==</span>&nbsp;<span class="string" id="5796981">&#34;&#34;</span>&nbsp;<span class="op" id="5796984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796988">s</span>&nbsp;<span class="op" id="5796990">:=</span>&nbsp;<span class="string" id="5796993">&#34;rpc.Register:&nbsp;no&nbsp;service&nbsp;name&nbsp;for&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5797035">+</span>&nbsp;<span class="ident" id="5797037"><a href="/net/rpc/server.go.html#5796807">s</a></span><span class="op" id="5797038">.</span><span class="ident" id="5797039">typ</span><span class="op" id="5797042">.</span><span class="ident" id="5797043">String</span><span class="op" id="5797049">(</span><span class="op" id="5797050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797054"><a href="/net/rpc/server.go.html#5793261">log</a></span><span class="op" id="5797057">.</span><span class="ident" id="5797058">Print</span><span class="op" id="5797063">(</span><span class="ident" id="5797064"><a href="/net/rpc/server.go.html#5796988">s</a></span><span class="op" id="5797065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5797069">return</span>&nbsp;<span class="ident" id="5797076"><a href="/net/rpc/server.go.html#5793245">errors</a></span><span class="op" id="5797082">.</span><span class="ident" id="5797083">New</span><span class="op" id="5797086">(</span><span class="ident" id="5797087"><a href="/net/rpc/server.go.html#5796988">s</a></span><span class="op" id="5797088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5797091">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5797094">if</span>&nbsp;<span class="op" id="5797097">!</span><span class="ident" id="5797098"><a href="/net/rpc/server.go.html#5795339">isExported</a></span><span class="op" id="5797108">(</span><span class="ident" id="5797109"><a href="/net/rpc/server.go.html#5796888">sname</a></span><span class="op" id="5797114">)</span>&nbsp;<span class="op" id="5797116">&amp;&amp;</span>&nbsp;<span class="op" id="5797119">!</span><span class="ident" id="5797120"><a href="/net/rpc/server.go.html#5796658">useName</a></span>&nbsp;<span class="op" id="5797128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797132">s</span>&nbsp;<span class="op" id="5797134">:=</span>&nbsp;<span class="string" id="5797137">&#34;rpc.Register:&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5797159">+</span>&nbsp;<span class="ident" id="5797161"><a href="/net/rpc/server.go.html#5796888">sname</a></span>&nbsp;<span class="op" id="5797167">+</span>&nbsp;<span class="string" id="5797169">&#34;&nbsp;is&nbsp;not&nbsp;exported&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797190"><a href="/net/rpc/server.go.html#5793261">log</a></span><span class="op" id="5797193">.</span><span class="ident" id="5797194">Print</span><span class="op" id="5797199">(</span><span class="ident" id="5797200"><a href="/net/rpc/server.go.html#5797132">s</a></span><span class="op" id="5797201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5797205">return</span>&nbsp;<span class="ident" id="5797212"><a href="/net/rpc/server.go.html#5793245">errors</a></span><span class="op" id="5797218">.</span><span class="ident" id="5797219">New</span><span class="op" id="5797222">(</span><span class="ident" id="5797223"><a href="/net/rpc/server.go.html#5797132">s</a></span><span class="op" id="5797224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5797227">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5797230">if</span>&nbsp;<span class="ident" id="5797233">_</span><span class="op" id="5797234">,</span>&nbsp;<span class="ident" id="5797236">present</span>&nbsp;<span class="op" id="5797244">:=</span>&nbsp;<span class="ident" id="5797247"><a href="/net/rpc/server.go.html#5796602">server</a></span><span class="op" id="5797253">.</span><span class="ident" id="5797254">serviceMap</span><span class="op" id="5797264">[</span><span class="ident" id="5797265"><a href="/net/rpc/server.go.html#5796888">sname</a></span><span class="op" id="5797270">]</span><span class="op" id="5797271">;</span>&nbsp;<span class="ident" id="5797273"><a href="/net/rpc/server.go.html#5797236">present</a></span>&nbsp;<span class="op" id="5797281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5797285">return</span>&nbsp;<span class="ident" id="5797292"><a href="/net/rpc/server.go.html#5793245">errors</a></span><span class="op" id="5797298">.</span><span class="ident" id="5797299">New</span><span class="op" id="5797302">(</span><span class="string" id="5797303">&#34;rpc:&nbsp;service&nbsp;already&nbsp;defined:&nbsp;&#34;</span>&nbsp;<span class="op" id="5797336">+</span>&nbsp;<span class="ident" id="5797338"><a href="/net/rpc/server.go.html#5796888">sname</a></span><span class="op" id="5797343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5797346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797349"><a href="/net/rpc/server.go.html#5796807">s</a></span><span class="op" id="5797350">.</span><span class="ident" id="5797351">name</span>&nbsp;<span class="op" id="5797356">=</span>&nbsp;<span class="ident" id="5797358"><a href="/net/rpc/server.go.html#5796888">sname</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5797366">//&nbsp;Install&nbsp;the&nbsp;methods</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797390"><a href="/net/rpc/server.go.html#5796807">s</a></span><span class="op" id="5797391">.</span><span class="ident" id="5797392">method</span>&nbsp;<span class="op" id="5797399">=</span>&nbsp;<span class="ident" id="5797401"><a href="/net/rpc/server.go.html#5798049">suitableMethods</a></span><span class="op" id="5797416">(</span><span class="ident" id="5797417"><a href="/net/rpc/server.go.html#5796807">s</a></span><span class="op" id="5797418">.</span><span class="ident" id="5797419">typ</span><span class="op" id="5797422">,</span>&nbsp;<span class="builtintype" id="5797424">true</span><span class="op" id="5797428">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5797432">if</span>&nbsp;<span class="builtinfunc" id="5797435">len</span><span class="op" id="5797438">(</span><span class="ident" id="5797439"><a href="/net/rpc/server.go.html#5796807">s</a></span><span class="op" id="5797440">.</span><span class="ident" id="5797441">method</span><span class="op" id="5797447">)</span>&nbsp;<span class="op" id="5797449">==</span>&nbsp;<span class="num" id="5797452">0</span>&nbsp;<span class="op" id="5797454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797458">str</span>&nbsp;<span class="op" id="5797462">:=</span>&nbsp;<span class="string" id="5797465">&#34;&#34;</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5797471">//&nbsp;To&nbsp;help&nbsp;the&nbsp;user,&nbsp;see&nbsp;if&nbsp;a&nbsp;pointer&nbsp;receiver&nbsp;would&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797532">method</span>&nbsp;<span class="op" id="5797539">:=</span>&nbsp;<span class="ident" id="5797542"><a href="/net/rpc/server.go.html#5798049">suitableMethods</a></span><span class="op" id="5797557">(</span><span class="ident" id="5797558"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5797565">.</span><span class="ident" id="5797566">PtrTo</span><span class="op" id="5797571">(</span><span class="ident" id="5797572"><a href="/net/rpc/server.go.html#5796807">s</a></span><span class="op" id="5797573">.</span><span class="ident" id="5797574">typ</span><span class="op" id="5797577">)</span><span class="op" id="5797578">,</span>&nbsp;<span class="builtintype" id="5797580">false</span><span class="op" id="5797585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5797589">if</span>&nbsp;<span class="builtinfunc" id="5797592">len</span><span class="op" id="5797595">(</span><span class="ident" id="5797596"><a href="/net/rpc/server.go.html#5797532">method</a></span><span class="op" id="5797602">)</span>&nbsp;<span class="op" id="5797604">!=</span>&nbsp;<span class="num" id="5797607">0</span>&nbsp;<span class="op" id="5797609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797614"><a href="/net/rpc/server.go.html#5797458">str</a></span>&nbsp;<span class="op" id="5797618">=</span>&nbsp;<span class="string" id="5797620">&#34;rpc.Register:&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5797642">+</span>&nbsp;<span class="ident" id="5797644"><a href="/net/rpc/server.go.html#5796888">sname</a></span>&nbsp;<span class="op" id="5797650">+</span>&nbsp;<span class="string" id="5797652">&#34;&nbsp;has&nbsp;no&nbsp;exported&nbsp;methods&nbsp;of&nbsp;suitable&nbsp;type&nbsp;(hint:&nbsp;pass&nbsp;a&nbsp;pointer&nbsp;to&nbsp;value&nbsp;of&nbsp;that&nbsp;type)&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5797743">}</span>&nbsp;<span class="keyword" id="5797745">else</span>&nbsp;<span class="op" id="5797750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797755"><a href="/net/rpc/server.go.html#5797458">str</a></span>&nbsp;<span class="op" id="5797759">=</span>&nbsp;<span class="string" id="5797761">&#34;rpc.Register:&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5797783">+</span>&nbsp;<span class="ident" id="5797785"><a href="/net/rpc/server.go.html#5796888">sname</a></span>&nbsp;<span class="op" id="5797791">+</span>&nbsp;<span class="string" id="5797793">&#34;&nbsp;has&nbsp;no&nbsp;exported&nbsp;methods&nbsp;of&nbsp;suitable&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5797839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797843"><a href="/net/rpc/server.go.html#5793261">log</a></span><span class="op" id="5797846">.</span><span class="ident" id="5797847">Print</span><span class="op" id="5797852">(</span><span class="ident" id="5797853"><a href="/net/rpc/server.go.html#5797458">str</a></span><span class="op" id="5797856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5797860">return</span>&nbsp;<span class="ident" id="5797867"><a href="/net/rpc/server.go.html#5793245">errors</a></span><span class="op" id="5797873">.</span><span class="ident" id="5797874">New</span><span class="op" id="5797877">(</span><span class="ident" id="5797878"><a href="/net/rpc/server.go.html#5797458">str</a></span><span class="op" id="5797881">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5797884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5797887"><a href="/net/rpc/server.go.html#5796602">server</a></span><span class="op" id="5797893">.</span><span class="ident" id="5797894">serviceMap</span><span class="op" id="5797904">[</span><span class="ident" id="5797905"><a href="/net/rpc/server.go.html#5796807">s</a></span><span class="op" id="5797906">.</span><span class="ident" id="5797907">name</span><span class="op" id="5797911">]</span>&nbsp;<span class="op" id="5797913">=</span>&nbsp;<span class="ident" id="5797915"><a href="/net/rpc/server.go.html#5796807">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5797918">return</span>&nbsp;<span class="ident" id="5797925">nil</span><br>
<span class="lineno"></span><span class="op" id="5797929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="5797932">//&nbsp;suitableMethods&nbsp;returns&nbsp;suitable&nbsp;Rpc&nbsp;methods&nbsp;of&nbsp;typ,&nbsp;it&nbsp;will&nbsp;report</span><br>
<span class="lineno"></span><span class="comment" id="5798003">//&nbsp;error&nbsp;using&nbsp;log&nbsp;if&nbsp;reportErr&nbsp;is&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5798044">func</span>&nbsp;<span class="ident" id="5798049">suitableMethods</span><span class="op" id="5798064">(</span><span class="ident" id="5798065">typ</span>&nbsp;<span class="ident" id="5798069"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5798076">.</span><span class="ident" id="5798077">Type</span><span class="op" id="5798081">,</span>&nbsp;<span class="ident" id="5798083">reportErr</span>&nbsp;<span class="builtintype" id="5798093">bool</span><span class="op" id="5798097">)</span>&nbsp;<span class="keyword" id="5798099">map</span><span class="op" id="5798102">[</span><span class="builtintype" id="5798103">string</span><span class="op" id="5798109">]</span><span class="op" id="5798110">*</span><span class="ident" id="5798111"><a href="/net/rpc/server.go.html#5793651">methodType</a></span>&nbsp;<span class="op" id="5798122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798125">methods</span>&nbsp;<span class="op" id="5798133">:=</span>&nbsp;<span class="builtinfunc" id="5798136">make</span><span class="op" id="5798140">(</span><span class="keyword" id="5798141">map</span><span class="op" id="5798144">[</span><span class="builtintype" id="5798145">string</span><span class="op" id="5798151">]</span><span class="op" id="5798152">*</span><span class="ident" id="5798153"><a href="/net/rpc/server.go.html#5793651">methodType</a></span><span class="op" id="5798163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5798166">for</span>&nbsp;<span class="ident" id="5798170">m</span>&nbsp;<span class="op" id="5798172">:=</span>&nbsp;<span class="num" id="5798175">0</span><span class="op" id="5798176">;</span>&nbsp;<span class="ident" id="5798178"><a href="/net/rpc/server.go.html#5798170">m</a></span>&nbsp;<span class="op" id="5798180">&lt;</span>&nbsp;<span class="ident" id="5798182"><a href="/net/rpc/server.go.html#5798065">typ</a></span><span class="op" id="5798185">.</span><span class="ident" id="5798186">NumMethod</span><span class="op" id="5798195">(</span><span class="op" id="5798196">)</span><span class="op" id="5798197">;</span>&nbsp;<span class="ident" id="5798199"><a href="/net/rpc/server.go.html#5798170">m</a></span><span class="op" id="5798200">++</span>&nbsp;<span class="op" id="5798203">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798207">method</span>&nbsp;<span class="op" id="5798214">:=</span>&nbsp;<span class="ident" id="5798217"><a href="/net/rpc/server.go.html#5798065">typ</a></span><span class="op" id="5798220">.</span><span class="ident" id="5798221">Method</span><span class="op" id="5798227">(</span><span class="ident" id="5798228"><a href="/net/rpc/server.go.html#5798170">m</a></span><span class="op" id="5798229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798233">mtype</span>&nbsp;<span class="op" id="5798239">:=</span>&nbsp;<span class="ident" id="5798242"><a href="/net/rpc/server.go.html#5798207">method</a></span><span class="op" id="5798248">.</span><span class="ident" id="5798249">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798256">mname</span>&nbsp;<span class="op" id="5798262">:=</span>&nbsp;<span class="ident" id="5798265"><a href="/net/rpc/server.go.html#5798207">method</a></span><span class="op" id="5798271">.</span><span class="ident" id="5798272">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5798279">//&nbsp;Method&nbsp;must&nbsp;be&nbsp;exported.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5798309">if</span>&nbsp;<span class="ident" id="5798312"><a href="/net/rpc/server.go.html#5798207">method</a></span><span class="op" id="5798318">.</span><span class="ident" id="5798319">PkgPath</span>&nbsp;<span class="op" id="5798327">!=</span>&nbsp;<span class="string" id="5798330">&#34;&#34;</span>&nbsp;<span class="op" id="5798333">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5798338">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5798349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5798353">//&nbsp;Method&nbsp;needs&nbsp;three&nbsp;ins:&nbsp;receiver,&nbsp;*args,&nbsp;*reply.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5798407">if</span>&nbsp;<span class="ident" id="5798410"><a href="/net/rpc/server.go.html#5798233">mtype</a></span><span class="op" id="5798415">.</span><span class="ident" id="5798416">NumIn</span><span class="op" id="5798421">(</span><span class="op" id="5798422">)</span>&nbsp;<span class="op" id="5798424">!=</span>&nbsp;<span class="num" id="5798427">3</span>&nbsp;<span class="op" id="5798429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5798434">if</span>&nbsp;<span class="ident" id="5798437"><a href="/net/rpc/server.go.html#5798083">reportErr</a></span>&nbsp;<span class="op" id="5798447">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798453"><a href="/net/rpc/server.go.html#5793261">log</a></span><span class="op" id="5798456">.</span><span class="ident" id="5798457">Println</span><span class="op" id="5798464">(</span><span class="string" id="5798465">&#34;method&#34;</span><span class="op" id="5798473">,</span>&nbsp;<span class="ident" id="5798475"><a href="/net/rpc/server.go.html#5798256">mname</a></span><span class="op" id="5798480">,</span>&nbsp;<span class="string" id="5798482">&#34;has&nbsp;wrong&nbsp;number&nbsp;of&nbsp;ins:&#34;</span><span class="op" id="5798508">,</span>&nbsp;<span class="ident" id="5798510"><a href="/net/rpc/server.go.html#5798233">mtype</a></span><span class="op" id="5798515">.</span><span class="ident" id="5798516">NumIn</span><span class="op" id="5798521">(</span><span class="op" id="5798522">)</span><span class="op" id="5798523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5798528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5798533">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5798544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5798548">//&nbsp;First&nbsp;arg&nbsp;need&nbsp;not&nbsp;be&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798586">argType</span>&nbsp;<span class="op" id="5798594">:=</span>&nbsp;<span class="ident" id="5798597"><a href="/net/rpc/server.go.html#5798233">mtype</a></span><span class="op" id="5798602">.</span><span class="ident" id="5798603">In</span><span class="op" id="5798605">(</span><span class="num" id="5798606">1</span><span class="op" id="5798607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5798611">if</span>&nbsp;<span class="op" id="5798614">!</span><span class="ident" id="5798615"><a href="/net/rpc/server.go.html#5795489">isExportedOrBuiltinType</a></span><span class="op" id="5798638">(</span><span class="ident" id="5798639"><a href="/net/rpc/server.go.html#5798586">argType</a></span><span class="op" id="5798646">)</span>&nbsp;<span class="op" id="5798648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5798653">if</span>&nbsp;<span class="ident" id="5798656"><a href="/net/rpc/server.go.html#5798083">reportErr</a></span>&nbsp;<span class="op" id="5798666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798672"><a href="/net/rpc/server.go.html#5793261">log</a></span><span class="op" id="5798675">.</span><span class="ident" id="5798676">Println</span><span class="op" id="5798683">(</span><span class="ident" id="5798684"><a href="/net/rpc/server.go.html#5798256">mname</a></span><span class="op" id="5798689">,</span>&nbsp;<span class="string" id="5798691">&#34;argument&nbsp;type&nbsp;not&nbsp;exported:&#34;</span><span class="op" id="5798720">,</span>&nbsp;<span class="ident" id="5798722"><a href="/net/rpc/server.go.html#5798586">argType</a></span><span class="op" id="5798729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5798734">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5798739">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5798750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5798754">//&nbsp;Second&nbsp;arg&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798789">replyType</span>&nbsp;<span class="op" id="5798799">:=</span>&nbsp;<span class="ident" id="5798802"><a href="/net/rpc/server.go.html#5798233">mtype</a></span><span class="op" id="5798807">.</span><span class="ident" id="5798808">In</span><span class="op" id="5798810">(</span><span class="num" id="5798811">2</span><span class="op" id="5798812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5798816">if</span>&nbsp;<span class="ident" id="5798819"><a href="/net/rpc/server.go.html#5798789">replyType</a></span><span class="op" id="5798828">.</span><span class="ident" id="5798829">Kind</span><span class="op" id="5798833">(</span><span class="op" id="5798834">)</span>&nbsp;<span class="op" id="5798836">!=</span>&nbsp;<span class="ident" id="5798839"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5798846">.</span><span class="ident" id="5798847">Ptr</span>&nbsp;<span class="op" id="5798851">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5798856">if</span>&nbsp;<span class="ident" id="5798859"><a href="/net/rpc/server.go.html#5798083">reportErr</a></span>&nbsp;<span class="op" id="5798869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5798875"><a href="/net/rpc/server.go.html#5793261">log</a></span><span class="op" id="5798878">.</span><span class="ident" id="5798879">Println</span><span class="op" id="5798886">(</span><span class="string" id="5798887">&#34;method&#34;</span><span class="op" id="5798895">,</span>&nbsp;<span class="ident" id="5798897"><a href="/net/rpc/server.go.html#5798256">mname</a></span><span class="op" id="5798902">,</span>&nbsp;<span class="string" id="5798904">&#34;reply&nbsp;type&nbsp;not&nbsp;a&nbsp;pointer:&#34;</span><span class="op" id="5798931">,</span>&nbsp;<span class="ident" id="5798933"><a href="/net/rpc/server.go.html#5798789">replyType</a></span><span class="op" id="5798942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5798947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5798952">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5798963">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5798967">//&nbsp;Reply&nbsp;type&nbsp;must&nbsp;be&nbsp;exported.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5799001">if</span>&nbsp;<span class="op" id="5799004">!</span><span class="ident" id="5799005"><a href="/net/rpc/server.go.html#5795489">isExportedOrBuiltinType</a></span><span class="op" id="5799028">(</span><span class="ident" id="5799029"><a href="/net/rpc/server.go.html#5798789">replyType</a></span><span class="op" id="5799038">)</span>&nbsp;<span class="op" id="5799040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5799045">if</span>&nbsp;<span class="ident" id="5799048"><a href="/net/rpc/server.go.html#5798083">reportErr</a></span>&nbsp;<span class="op" id="5799058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5799064"><a href="/net/rpc/server.go.html#5793261">log</a></span><span class="op" id="5799067">.</span><span class="ident" id="5799068">Println</span><span class="op" id="5799075">(</span><span class="string" id="5799076">&#34;method&#34;</span><span class="op" id="5799084">,</span>&nbsp;<span class="ident" id="5799086"><a href="/net/rpc/server.go.html#5798256">mname</a></span><span class="op" id="5799091">,</span>&nbsp;<span class="string" id="5799093">&#34;reply&nbsp;type&nbsp;not&nbsp;exported:&#34;</span><span class="op" id="5799119">,</span>&nbsp;<span class="ident" id="5799121"><a href="/net/rpc/server.go.html#5798789">replyType</a></span><span class="op" id="5799130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5799135">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5799140">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5799151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5799155">//&nbsp;Method&nbsp;needs&nbsp;one&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5799182">if</span>&nbsp;<span class="ident" id="5799185"><a href="/net/rpc/server.go.html#5798233">mtype</a></span><span class="op" id="5799190">.</span><span class="ident" id="5799191">NumOut</span><span class="op" id="5799197">(</span><span class="op" id="5799198">)</span>&nbsp;<span class="op" id="5799200">!=</span>&nbsp;<span class="num" id="5799203">1</span>&nbsp;<span class="op" id="5799205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5799210">if</span>&nbsp;<span class="ident" id="5799213"><a href="/net/rpc/server.go.html#5798083">reportErr</a></span>&nbsp;<span class="op" id="5799223">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5799229"><a href="/net/rpc/server.go.html#5793261">log</a></span><span class="op" id="5799232">.</span><span class="ident" id="5799233">Println</span><span class="op" id="5799240">(</span><span class="string" id="5799241">&#34;method&#34;</span><span class="op" id="5799249">,</span>&nbsp;<span class="ident" id="5799251"><a href="/net/rpc/server.go.html#5798256">mname</a></span><span class="op" id="5799256">,</span>&nbsp;<span class="string" id="5799258">&#34;has&nbsp;wrong&nbsp;number&nbsp;of&nbsp;outs:&#34;</span><span class="op" id="5799285">,</span>&nbsp;<span class="ident" id="5799287"><a href="/net/rpc/server.go.html#5798233">mtype</a></span><span class="op" id="5799292">.</span><span class="ident" id="5799293">NumOut</span><span class="op" id="5799299">(</span><span class="op" id="5799300">)</span><span class="op" id="5799301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5799306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5799311">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5799322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5799326">//&nbsp;The&nbsp;return&nbsp;type&nbsp;of&nbsp;the&nbsp;method&nbsp;must&nbsp;be&nbsp;error.</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5799376">if</span>&nbsp;<span class="ident" id="5799379">returnType</span>&nbsp;<span class="op" id="5799390">:=</span>&nbsp;<span class="ident" id="5799393"><a href="/net/rpc/server.go.html#5798233">mtype</a></span><span class="op" id="5799398">.</span><span class="ident" id="5799399">Out</span><span class="op" id="5799402">(</span><span class="num" id="5799403">0</span><span class="op" id="5799404">)</span><span class="op" id="5799405">;</span>&nbsp;<span class="ident" id="5799407"><a href="/net/rpc/server.go.html#5799379">returnType</a></span>&nbsp;<span class="op" id="5799418">!=</span>&nbsp;<span class="ident" id="5799421"><a href="/net/rpc/server.go.html#5793594">typeOfError</a></span>&nbsp;<span class="op" id="5799433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5799438">if</span>&nbsp;<span class="ident" id="5799441"><a href="/net/rpc/server.go.html#5798083">reportErr</a></span>&nbsp;<span class="op" id="5799451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5799457"><a href="/net/rpc/server.go.html#5793261">log</a></span><span class="op" id="5799460">.</span><span class="ident" id="5799461">Println</span><span class="op" id="5799468">(</span><span class="string" id="5799469">&#34;method&#34;</span><span class="op" id="5799477">,</span>&nbsp;<span class="ident" id="5799479"><a href="/net/rpc/server.go.html#5798256">mname</a></span><span class="op" id="5799484">,</span>&nbsp;<span class="string" id="5799486">&#34;returns&#34;</span><span class="op" id="5799495">,</span>&nbsp;<span class="ident" id="5799497"><a href="/net/rpc/server.go.html#5799379">returnType</a></span><span class="op" id="5799507">.</span><span class="ident" id="5799508">String</span><span class="op" id="5799514">(</span><span class="op" id="5799515">)</span><span class="op" id="5799516">,</span>&nbsp;<span class="string" id="5799518">&#34;not&nbsp;error&#34;</span><span class="op" id="5799529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5799534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5799539">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5799550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5799554"><a href="/net/rpc/server.go.html#5798125">methods</a></span><span class="op" id="5799561">[</span><span class="ident" id="5799562"><a href="/net/rpc/server.go.html#5798256">mname</a></span><span class="op" id="5799567">]</span>&nbsp;<span class="op" id="5799569">=</span>&nbsp;<span class="op" id="5799571">&amp;</span><span class="ident" id="5799572"><a href="/net/rpc/server.go.html#5793651">methodType</a></span><span class="op" id="5799582">{</span><span class="ident" id="5799583">method</span><span class="op" id="5799589">:</span>&nbsp;<span class="ident" id="5799591"><a href="/net/rpc/server.go.html#5798207">method</a></span><span class="op" id="5799597">,</span>&nbsp;<span class="ident" id="5799599">ArgType</span><span class="op" id="5799606">:</span>&nbsp;<span class="ident" id="5799608"><a href="/net/rpc/server.go.html#5798586">argType</a></span><span class="op" id="5799615">,</span>&nbsp;<span class="ident" id="5799617">ReplyType</span><span class="op" id="5799626">:</span>&nbsp;<span class="ident" id="5799628"><a href="/net/rpc/server.go.html#5798789">replyType</a></span><span class="op" id="5799637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5799640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5799643">return</span>&nbsp;<span class="ident" id="5799650"><a href="/net/rpc/server.go.html#5798125">methods</a></span><br>
<span class="lineno"></span><span class="op" id="5799658">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="5799661">//&nbsp;A&nbsp;value&nbsp;sent&nbsp;as&nbsp;a&nbsp;placeholder&nbsp;for&nbsp;the&nbsp;server&#39;s&nbsp;response&nbsp;value&nbsp;when&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="5799742">//&nbsp;receives&nbsp;an&nbsp;invalid&nbsp;request.&nbsp;It&nbsp;is&nbsp;never&nbsp;decoded&nbsp;by&nbsp;the&nbsp;client&nbsp;since&nbsp;the&nbsp;Response</span><br>
<span class="lineno"></span><span class="comment" id="5799827">//&nbsp;contains&nbsp;an&nbsp;error&nbsp;when&nbsp;it&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="5799865">var</span>&nbsp;<span class="ident" id="5799869">invalidRequest</span>&nbsp;<span class="op" id="5799884">=</span>&nbsp;<span class="keyword" id="5799886">struct</span><span class="op" id="5799892">{</span><span class="op" id="5799893">}</span><span class="op" id="5799894">{</span><span class="op" id="5799895">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span><span class="keyword" id="5799898">func</span>&nbsp;<span class="op" id="5799903">(</span><span class="ident" id="5799904">server</span>&nbsp;<span class="op" id="5799911">*</span><span class="ident" id="5799912"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5799918">)</span>&nbsp;<span class="ident" id="5799920">sendResponse</span><span class="op" id="5799932">(</span><span class="ident" id="5799933">sending</span>&nbsp;<span class="op" id="5799941">*</span><span class="ident" id="5799942"><a href="/net/rpc/server.go.html#5793309">sync</a></span><span class="op" id="5799946">.</span><span class="ident" id="5799947">Mutex</span><span class="op" id="5799952">,</span>&nbsp;<span class="ident" id="5799954">req</span>&nbsp;<span class="op" id="5799958">*</span><span class="ident" id="5799959"><a href="/net/rpc/server.go.html#5794226">Request</a></span><span class="op" id="5799966">,</span>&nbsp;<span class="ident" id="5799968">reply</span>&nbsp;<span class="keyword" id="5799974">interface</span><span class="op" id="5799983">{</span><span class="op" id="5799984">}</span><span class="op" id="5799985">,</span>&nbsp;<span class="ident" id="5799987">codec</span>&nbsp;<span class="ident" id="5799993"><a href="/net/rpc/server.go.html#5808144">ServerCodec</a></span><span class="op" id="5800004">,</span>&nbsp;<span class="ident" id="5800006">errmsg</span>&nbsp;<span class="builtintype" id="5800013">string</span><span class="op" id="5800019">)</span>&nbsp;<span class="op" id="5800021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800024">resp</span>&nbsp;<span class="op" id="5800029">:=</span>&nbsp;<span class="ident" id="5800032"><a href="/net/rpc/server.go.html#5799904">server</a></span><span class="op" id="5800038">.</span><span class="ident" id="5800039">getResponse</span><span class="op" id="5800050">(</span><span class="op" id="5800051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5800054">//&nbsp;Encode&nbsp;the&nbsp;response&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800085"><a href="/net/rpc/server.go.html#5800024">resp</a></span><span class="op" id="5800089">.</span><span class="ident" id="5800090">ServiceMethod</span>&nbsp;<span class="op" id="5800104">=</span>&nbsp;<span class="ident" id="5800106"><a href="/net/rpc/server.go.html#5799954">req</a></span><span class="op" id="5800109">.</span><span class="ident" id="5800110">ServiceMethod</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5800125">if</span>&nbsp;<span class="ident" id="5800128"><a href="/net/rpc/server.go.html#5800006">errmsg</a></span>&nbsp;<span class="op" id="5800135">!=</span>&nbsp;<span class="string" id="5800138">&#34;&#34;</span>&nbsp;<span class="op" id="5800141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800145"><a href="/net/rpc/server.go.html#5800024">resp</a></span><span class="op" id="5800149">.</span><span class="ident" id="5800150">Error</span>&nbsp;<span class="op" id="5800156">=</span>&nbsp;<span class="ident" id="5800158"><a href="/net/rpc/server.go.html#5800006">errmsg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800167"><a href="/net/rpc/server.go.html#5799968">reply</a></span>&nbsp;<span class="op" id="5800173">=</span>&nbsp;<span class="ident" id="5800175"><a href="/net/rpc/server.go.html#5799869">invalidRequest</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5800191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800194"><a href="/net/rpc/server.go.html#5800024">resp</a></span><span class="op" id="5800198">.</span><span class="ident" id="5800199">Seq</span>&nbsp;<span class="op" id="5800203">=</span>&nbsp;<span class="ident" id="5800205"><a href="/net/rpc/server.go.html#5799954">req</a></span><span class="op" id="5800208">.</span><span class="ident" id="5800209">Seq</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800214"><a href="/net/rpc/server.go.html#5799933">sending</a></span><span class="op" id="5800221">.</span><span class="ident" id="5800222">Lock</span><span class="op" id="5800226">(</span><span class="op" id="5800227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800230">err</span>&nbsp;<span class="op" id="5800234">:=</span>&nbsp;<span class="ident" id="5800237"><a href="/net/rpc/server.go.html#5799987">codec</a></span><span class="op" id="5800242">.</span><span class="ident" id="5800243">WriteResponse</span><span class="op" id="5800256">(</span><span class="ident" id="5800257"><a href="/net/rpc/server.go.html#5800024">resp</a></span><span class="op" id="5800261">,</span>&nbsp;<span class="ident" id="5800263"><a href="/net/rpc/server.go.html#5799968">reply</a></span><span class="op" id="5800268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5800271">if</span>&nbsp;<span class="ident" id="5800274"><a href="/net/rpc/debug.go.html#5787850">debugLog</a></span>&nbsp;<span class="op" id="5800283">&amp;&amp;</span>&nbsp;<span class="ident" id="5800286"><a href="/net/rpc/server.go.html#5800230">err</a></span>&nbsp;<span class="op" id="5800290">!=</span>&nbsp;<span class="ident" id="5800293">nil</span>&nbsp;<span class="op" id="5800297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800301"><a href="/net/rpc/server.go.html#5793261">log</a></span><span class="op" id="5800304">.</span><span class="ident" id="5800305">Println</span><span class="op" id="5800312">(</span><span class="string" id="5800313">&#34;rpc:&nbsp;writing&nbsp;response:&#34;</span><span class="op" id="5800337">,</span>&nbsp;<span class="ident" id="5800339"><a href="/net/rpc/server.go.html#5800230">err</a></span><span class="op" id="5800342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5800345">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800348"><a href="/net/rpc/server.go.html#5799933">sending</a></span><span class="op" id="5800355">.</span><span class="ident" id="5800356">Unlock</span><span class="op" id="5800362">(</span><span class="op" id="5800363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800366"><a href="/net/rpc/server.go.html#5799904">server</a></span><span class="op" id="5800372">.</span><span class="ident" id="5800373">freeResponse</span><span class="op" id="5800385">(</span><span class="ident" id="5800386"><a href="/net/rpc/server.go.html#5800024">resp</a></span><span class="op" id="5800390">)</span><br>
<span class="lineno"></span><span class="op" id="5800392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5800395">func</span>&nbsp;<span class="op" id="5800400">(</span><span class="ident" id="5800401">m</span>&nbsp;<span class="op" id="5800403">*</span><span class="ident" id="5800404"><a href="/net/rpc/server.go.html#5793651">methodType</a></span><span class="op" id="5800414">)</span>&nbsp;<span class="ident" id="5800416">NumCalls</span><span class="op" id="5800424">(</span><span class="op" id="5800425">)</span>&nbsp;<span class="op" id="5800427">(</span><span class="ident" id="5800428">n</span>&nbsp;<span class="builtintype" id="5800430">uint</span><span class="op" id="5800434">)</span>&nbsp;<span class="op" id="5800436">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800439"><a href="/net/rpc/server.go.html#5800401">m</a></span><span class="op" id="5800440">.</span><span class="ident" id="5800441">Lock</span><span class="op" id="5800445">(</span><span class="op" id="5800446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800449"><a href="/net/rpc/server.go.html#5800428">n</a></span>&nbsp;<span class="op" id="5800451">=</span>&nbsp;<span class="ident" id="5800453"><a href="/net/rpc/server.go.html#5800401">m</a></span><span class="op" id="5800454">.</span><span class="ident" id="5800455">numCalls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800465"><a href="/net/rpc/server.go.html#5800401">m</a></span><span class="op" id="5800466">.</span><span class="ident" id="5800467">Unlock</span><span class="op" id="5800473">(</span><span class="op" id="5800474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5800477">return</span>&nbsp;<span class="ident" id="5800484"><a href="/net/rpc/server.go.html#5800428">n</a></span><br>
<span class="lineno"></span><span class="op" id="5800486">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="5800489">func</span>&nbsp;<span class="op" id="5800494">(</span><span class="ident" id="5800495">s</span>&nbsp;<span class="op" id="5800497">*</span><span class="ident" id="5800498"><a href="/net/rpc/server.go.html#5793806">service</a></span><span class="op" id="5800505">)</span>&nbsp;<span class="ident" id="5800507">call</span><span class="op" id="5800511">(</span><span class="ident" id="5800512">server</span>&nbsp;<span class="op" id="5800519">*</span><span class="ident" id="5800520"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5800526">,</span>&nbsp;<span class="ident" id="5800528">sending</span>&nbsp;<span class="op" id="5800536">*</span><span class="ident" id="5800537"><a href="/net/rpc/server.go.html#5793309">sync</a></span><span class="op" id="5800541">.</span><span class="ident" id="5800542">Mutex</span><span class="op" id="5800547">,</span>&nbsp;<span class="ident" id="5800549">mtype</span>&nbsp;<span class="op" id="5800555">*</span><span class="ident" id="5800556"><a href="/net/rpc/server.go.html#5793651">methodType</a></span><span class="op" id="5800566">,</span>&nbsp;<span class="ident" id="5800568">req</span>&nbsp;<span class="op" id="5800572">*</span><span class="ident" id="5800573"><a href="/net/rpc/server.go.html#5794226">Request</a></span><span class="op" id="5800580">,</span>&nbsp;<span class="ident" id="5800582">argv</span><span class="op" id="5800586">,</span>&nbsp;<span class="ident" id="5800588">replyv</span>&nbsp;<span class="ident" id="5800595"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5800602">.</span><span class="ident" id="5800603">Value</span><span class="op" id="5800608">,</span>&nbsp;<span class="ident" id="5800610">codec</span>&nbsp;<span class="ident" id="5800616"><a href="/net/rpc/server.go.html#5808144">ServerCodec</a></span><span class="op" id="5800627">)</span>&nbsp;<span class="op" id="5800629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800632"><a href="/net/rpc/server.go.html#5800549">mtype</a></span><span class="op" id="5800637">.</span><span class="ident" id="5800638">Lock</span><span class="op" id="5800642">(</span><span class="op" id="5800643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800646"><a href="/net/rpc/server.go.html#5800549">mtype</a></span><span class="op" id="5800651">.</span><span class="ident" id="5800652">numCalls</span><span class="op" id="5800660">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800664"><a href="/net/rpc/server.go.html#5800549">mtype</a></span><span class="op" id="5800669">.</span><span class="ident" id="5800670">Unlock</span><span class="op" id="5800676">(</span><span class="op" id="5800677">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800680">function</span>&nbsp;<span class="op" id="5800689">:=</span>&nbsp;<span class="ident" id="5800692"><a href="/net/rpc/server.go.html#5800549">mtype</a></span><span class="op" id="5800697">.</span><span class="ident" id="5800698">method</span><span class="op" id="5800704">.</span><span class="ident" id="5800705">Func</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5800711">//&nbsp;Invoke&nbsp;the&nbsp;method,&nbsp;providing&nbsp;a&nbsp;new&nbsp;value&nbsp;for&nbsp;the&nbsp;reply.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800771">returnValues</span>&nbsp;<span class="op" id="5800784">:=</span>&nbsp;<span class="ident" id="5800787"><a href="/net/rpc/server.go.html#5800680">function</a></span><span class="op" id="5800795">.</span><span class="ident" id="5800796">Call</span><span class="op" id="5800800">(</span><span class="op" id="5800801">[</span><span class="op" id="5800802">]</span><span class="ident" id="5800803"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5800810">.</span><span class="ident" id="5800811">Value</span><span class="op" id="5800816">{</span><span class="ident" id="5800817"><a href="/net/rpc/server.go.html#5800495">s</a></span><span class="op" id="5800818">.</span><span class="ident" id="5800819">rcvr</span><span class="op" id="5800823">,</span>&nbsp;<span class="ident" id="5800825"><a href="/net/rpc/server.go.html#5800582">argv</a></span><span class="op" id="5800829">,</span>&nbsp;<span class="ident" id="5800831"><a href="/net/rpc/server.go.html#5800588">replyv</a></span><span class="op" id="5800837">}</span><span class="op" id="5800838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5800841">//&nbsp;The&nbsp;return&nbsp;value&nbsp;for&nbsp;the&nbsp;method&nbsp;is&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800890">errInter</span>&nbsp;<span class="op" id="5800899">:=</span>&nbsp;<span class="ident" id="5800902"><a href="/net/rpc/server.go.html#5800771">returnValues</a></span><span class="op" id="5800914">[</span><span class="num" id="5800915">0</span><span class="op" id="5800916">]</span><span class="op" id="5800917">.</span><span class="ident" id="5800918">Interface</span><span class="op" id="5800927">(</span><span class="op" id="5800928">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800931">errmsg</span>&nbsp;<span class="op" id="5800938">:=</span>&nbsp;<span class="string" id="5800941">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5800945">if</span>&nbsp;<span class="ident" id="5800948"><a href="/net/rpc/server.go.html#5800890">errInter</a></span>&nbsp;<span class="op" id="5800957">!=</span>&nbsp;<span class="ident" id="5800960">nil</span>&nbsp;<span class="op" id="5800964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5800968"><a href="/net/rpc/server.go.html#5800931">errmsg</a></span>&nbsp;<span class="op" id="5800975">=</span>&nbsp;<span class="ident" id="5800977"><a href="/net/rpc/server.go.html#5800890">errInter</a></span><span class="op" id="5800985">.</span><span class="op" id="5800986">(</span><span class="builtintype" id="5800987">error</span><span class="op" id="5800992">)</span><span class="op" id="5800993">.</span><span class="ident" id="5800994">Error</span><span class="op" id="5800999">(</span><span class="op" id="5801000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5801003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801006"><a href="/net/rpc/server.go.html#5800512">server</a></span><span class="op" id="5801012">.</span><span class="ident" id="5801013">sendResponse</span><span class="op" id="5801025">(</span><span class="ident" id="5801026"><a href="/net/rpc/server.go.html#5800528">sending</a></span><span class="op" id="5801033">,</span>&nbsp;<span class="ident" id="5801035"><a href="/net/rpc/server.go.html#5800568">req</a></span><span class="op" id="5801038">,</span>&nbsp;<span class="ident" id="5801040"><a href="/net/rpc/server.go.html#5800588">replyv</a></span><span class="op" id="5801046">.</span><span class="ident" id="5801047">Interface</span><span class="op" id="5801056">(</span><span class="op" id="5801057">)</span><span class="op" id="5801058">,</span>&nbsp;<span class="ident" id="5801060"><a href="/net/rpc/server.go.html#5800610">codec</a></span><span class="op" id="5801065">,</span>&nbsp;<span class="ident" id="5801067"><a href="/net/rpc/server.go.html#5800931">errmsg</a></span><span class="op" id="5801073">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801076"><a href="/net/rpc/server.go.html#5800512">server</a></span><span class="op" id="5801082">.</span><span class="ident" id="5801083">freeRequest</span><span class="op" id="5801094">(</span><span class="ident" id="5801095"><a href="/net/rpc/server.go.html#5800568">req</a></span><span class="op" id="5801098">)</span><br>
<span class="lineno"></span><span class="op" id="5801100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5801103">type</span>&nbsp;<span class="ident" id="5801108">gobServerCodec</span>&nbsp;<span class="keyword" id="5801123">struct</span>&nbsp;<span class="op" id="5801130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801133">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5801140"><a href="/net/rpc/server.go.html#5793255">io</a></span><span class="op" id="5801142">.</span><span class="ident" id="5801143">ReadWriteCloser</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801160">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5801167">*</span><span class="ident" id="5801168"><a href="/net/rpc/server.go.html#5793229">gob</a></span><span class="op" id="5801171">.</span><span class="ident" id="5801172">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801181">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5801188">*</span><span class="ident" id="5801189"><a href="/net/rpc/server.go.html#5793229">gob</a></span><span class="op" id="5801192">.</span><span class="ident" id="5801193">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801202">encBuf</span>&nbsp;<span class="op" id="5801209">*</span><span class="ident" id="5801210"><a href="/net/rpc/server.go.html#5793220">bufio</a></span><span class="op" id="5801215">.</span><span class="ident" id="5801216">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801224">closed</span>&nbsp;<span class="builtintype" id="5801231">bool</span><br>
<span class="lineno"></span><span class="op" id="5801236">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="keyword" id="5801239">func</span>&nbsp;<span class="op" id="5801244">(</span><span class="ident" id="5801245">c</span>&nbsp;<span class="op" id="5801247">*</span><span class="ident" id="5801248"><a href="/net/rpc/server.go.html#5801108">gobServerCodec</a></span><span class="op" id="5801262">)</span>&nbsp;<span class="ident" id="5801264">ReadRequestHeader</span><span class="op" id="5801281">(</span><span class="ident" id="5801282">r</span>&nbsp;<span class="op" id="5801284">*</span><span class="ident" id="5801285"><a href="/net/rpc/server.go.html#5794226">Request</a></span><span class="op" id="5801292">)</span>&nbsp;<span class="builtintype" id="5801294">error</span>&nbsp;<span class="op" id="5801300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5801303">return</span>&nbsp;<span class="ident" id="5801310"><a href="/net/rpc/server.go.html#5801245">c</a></span><span class="op" id="5801311">.</span><span class="ident" id="5801312">dec</span><span class="op" id="5801315">.</span><span class="ident" id="5801316">Decode</span><span class="op" id="5801322">(</span><span class="ident" id="5801323"><a href="/net/rpc/server.go.html#5801282">r</a></span><span class="op" id="5801324">)</span><br>
<span class="lineno"></span><span class="op" id="5801326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="keyword" id="5801329">func</span>&nbsp;<span class="op" id="5801334">(</span><span class="ident" id="5801335">c</span>&nbsp;<span class="op" id="5801337">*</span><span class="ident" id="5801338"><a href="/net/rpc/server.go.html#5801108">gobServerCodec</a></span><span class="op" id="5801352">)</span>&nbsp;<span class="ident" id="5801354">ReadRequestBody</span><span class="op" id="5801369">(</span><span class="ident" id="5801370">body</span>&nbsp;<span class="keyword" id="5801375">interface</span><span class="op" id="5801384">{</span><span class="op" id="5801385">}</span><span class="op" id="5801386">)</span>&nbsp;<span class="builtintype" id="5801388">error</span>&nbsp;<span class="op" id="5801394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5801397">return</span>&nbsp;<span class="ident" id="5801404"><a href="/net/rpc/server.go.html#5801335">c</a></span><span class="op" id="5801405">.</span><span class="ident" id="5801406">dec</span><span class="op" id="5801409">.</span><span class="ident" id="5801410">Decode</span><span class="op" id="5801416">(</span><span class="ident" id="5801417"><a href="/net/rpc/server.go.html#5801370">body</a></span><span class="op" id="5801421">)</span><br>
<span class="lineno"></span><span class="op" id="5801423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5801426">func</span>&nbsp;<span class="op" id="5801431">(</span><span class="ident" id="5801432">c</span>&nbsp;<span class="op" id="5801434">*</span><span class="ident" id="5801435"><a href="/net/rpc/server.go.html#5801108">gobServerCodec</a></span><span class="op" id="5801449">)</span>&nbsp;<span class="ident" id="5801451">WriteResponse</span><span class="op" id="5801464">(</span><span class="ident" id="5801465">r</span>&nbsp;<span class="op" id="5801467">*</span><span class="ident" id="5801468"><a href="/net/rpc/server.go.html#5794584">Response</a></span><span class="op" id="5801476">,</span>&nbsp;<span class="ident" id="5801478">body</span>&nbsp;<span class="keyword" id="5801483">interface</span><span class="op" id="5801492">{</span><span class="op" id="5801493">}</span><span class="op" id="5801494">)</span>&nbsp;<span class="op" id="5801496">(</span><span class="ident" id="5801497">err</span>&nbsp;<span class="builtintype" id="5801501">error</span><span class="op" id="5801506">)</span>&nbsp;<span class="op" id="5801508">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5801511">if</span>&nbsp;<span class="ident" id="5801514"><a href="/net/rpc/server.go.html#5801497">err</a></span>&nbsp;<span class="op" id="5801518">=</span>&nbsp;<span class="ident" id="5801520"><a href="/net/rpc/server.go.html#5801432">c</a></span><span class="op" id="5801521">.</span><span class="ident" id="5801522">enc</span><span class="op" id="5801525">.</span><span class="ident" id="5801526">Encode</span><span class="op" id="5801532">(</span><span class="ident" id="5801533"><a href="/net/rpc/server.go.html#5801465">r</a></span><span class="op" id="5801534">)</span><span class="op" id="5801535">;</span>&nbsp;<span class="ident" id="5801537"><a href="/net/rpc/server.go.html#5801497">err</a></span>&nbsp;<span class="op" id="5801541">!=</span>&nbsp;<span class="ident" id="5801544">nil</span>&nbsp;<span class="op" id="5801548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5801552">if</span>&nbsp;<span class="ident" id="5801555"><a href="/net/rpc/server.go.html#5801432">c</a></span><span class="op" id="5801556">.</span><span class="ident" id="5801557">encBuf</span><span class="op" id="5801563">.</span><span class="ident" id="5801564">Flush</span><span class="op" id="5801569">(</span><span class="op" id="5801570">)</span>&nbsp;<span class="op" id="5801572">==</span>&nbsp;<span class="ident" id="5801575">nil</span>&nbsp;<span class="op" id="5801579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5801584">//&nbsp;Gob&nbsp;couldn&#39;t&nbsp;encode&nbsp;the&nbsp;header.&nbsp;Should&nbsp;not&nbsp;happen,&nbsp;so&nbsp;if&nbsp;it&nbsp;does,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5801656">//&nbsp;shut&nbsp;down&nbsp;the&nbsp;connection&nbsp;to&nbsp;signal&nbsp;that&nbsp;the&nbsp;connection&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801728"><a href="/net/rpc/server.go.html#5793261">log</a></span><span class="op" id="5801731">.</span><span class="ident" id="5801732">Println</span><span class="op" id="5801739">(</span><span class="string" id="5801740">&#34;rpc:&nbsp;gob&nbsp;error&nbsp;encoding&nbsp;response:&#34;</span><span class="op" id="5801775">,</span>&nbsp;<span class="ident" id="5801777"><a href="/net/rpc/server.go.html#5801497">err</a></span><span class="op" id="5801780">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5801785"><a href="/net/rpc/server.go.html#5801432">c</a></span><span class="op" id="5801786">.</span><span class="ident" id="5801787">Close</span><span class="op" id="5801792">(</span><span class="op" id="5801793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5801797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5801801">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5801809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5801812">if</span>&nbsp;<span class="ident" id="5801815"><a href="/net/rpc/server.go.html#5801497">err</a></span>&nbsp;<span class="op" id="5801819">=</span>&nbsp;<span class="ident" id="5801821"><a href="/net/rpc/server.go.html#5801432">c</a></span><span class="op" id="5801822">.</span><span class="ident" id="5801823">enc</span><span class="op" id="5801826">.</span><span class="ident" id="5801827">Encode</span><span class="op" id="5801833">(</span><span class="ident" id="5801834"><a href="/net/rpc/server.go.html#5801478">body</a></span><span class="op" id="5801838">)</span><span class="op" id="5801839">;</span>&nbsp;<span class="ident" id="5801841"><a href="/net/rpc/server.go.html#5801497">err</a></span>&nbsp;<span class="op" id="5801845">!=</span>&nbsp;<span class="ident" id="5801848">nil</span>&nbsp;<span class="op" id="5801852">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5801856">if</span>&nbsp;<span class="ident" id="5801859"><a href="/net/rpc/server.go.html#5801432">c</a></span><span class="op" id="5801860">.</span><span class="ident" id="5801861">encBuf</span><span class="op" id="5801867">.</span><span class="ident" id="5801868">Flush</span><span class="op" id="5801873">(</span><span class="op" id="5801874">)</span>&nbsp;<span class="op" id="5801876">==</span>&nbsp;<span class="ident" id="5801879">nil</span>&nbsp;<span class="op" id="5801883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5801888">//&nbsp;Was&nbsp;a&nbsp;gob&nbsp;problem&nbsp;encoding&nbsp;the&nbsp;body&nbsp;but&nbsp;the&nbsp;header&nbsp;has&nbsp;been&nbsp;written.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5801963">//&nbsp;Shut&nbsp;down&nbsp;the&nbsp;connection&nbsp;to&nbsp;signal&nbsp;that&nbsp;the&nbsp;connection&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5802035"><a href="/net/rpc/server.go.html#5793261">log</a></span><span class="op" id="5802038">.</span><span class="ident" id="5802039">Println</span><span class="op" id="5802046">(</span><span class="string" id="5802047">&#34;rpc:&nbsp;gob&nbsp;error&nbsp;encoding&nbsp;body:&#34;</span><span class="op" id="5802078">,</span>&nbsp;<span class="ident" id="5802080"><a href="/net/rpc/server.go.html#5801497">err</a></span><span class="op" id="5802083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5802088"><a href="/net/rpc/server.go.html#5801432">c</a></span><span class="op" id="5802089">.</span><span class="ident" id="5802090">Close</span><span class="op" id="5802095">(</span><span class="op" id="5802096">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5802100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5802104">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5802112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5802115">return</span>&nbsp;<span class="ident" id="5802122"><a href="/net/rpc/server.go.html#5801432">c</a></span><span class="op" id="5802123">.</span><span class="ident" id="5802124">encBuf</span><span class="op" id="5802130">.</span><span class="ident" id="5802131">Flush</span><span class="op" id="5802136">(</span><span class="op" id="5802137">)</span><br>
<span class="lineno"></span><span class="op" id="5802139">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span><span class="keyword" id="5802142">func</span>&nbsp;<span class="op" id="5802147">(</span><span class="ident" id="5802148">c</span>&nbsp;<span class="op" id="5802150">*</span><span class="ident" id="5802151"><a href="/net/rpc/server.go.html#5801108">gobServerCodec</a></span><span class="op" id="5802165">)</span>&nbsp;<span class="ident" id="5802167">Close</span><span class="op" id="5802172">(</span><span class="op" id="5802173">)</span>&nbsp;<span class="builtintype" id="5802175">error</span>&nbsp;<span class="op" id="5802181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5802184">if</span>&nbsp;<span class="ident" id="5802187"><a href="/net/rpc/server.go.html#5802148">c</a></span><span class="op" id="5802188">.</span><span class="ident" id="5802189">closed</span>&nbsp;<span class="op" id="5802196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5802200">//&nbsp;Only&nbsp;call&nbsp;c.rwc.Close&nbsp;once;&nbsp;otherwise&nbsp;the&nbsp;semantics&nbsp;are&nbsp;undefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5802272">return</span>&nbsp;<span class="ident" id="5802279">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5802284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5802287"><a href="/net/rpc/server.go.html#5802148">c</a></span><span class="op" id="5802288">.</span><span class="ident" id="5802289">closed</span>&nbsp;<span class="op" id="5802296">=</span>&nbsp;<span class="builtintype" id="5802298">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5802304">return</span>&nbsp;<span class="ident" id="5802311"><a href="/net/rpc/server.go.html#5802148">c</a></span><span class="op" id="5802312">.</span><span class="ident" id="5802313">rwc</span><span class="op" id="5802316">.</span><span class="ident" id="5802317">Close</span><span class="op" id="5802322">(</span><span class="op" id="5802323">)</span><br>
<span class="lineno"></span><span class="op" id="5802325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="5802328">//&nbsp;ServeConn&nbsp;runs&nbsp;the&nbsp;server&nbsp;on&nbsp;a&nbsp;single&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5802381">//&nbsp;ServeConn&nbsp;blocks,&nbsp;serving&nbsp;the&nbsp;connection&nbsp;until&nbsp;the&nbsp;client&nbsp;hangs&nbsp;up.</span><br>
<span class="lineno"></span><span class="comment" id="5802452">//&nbsp;The&nbsp;caller&nbsp;typically&nbsp;invokes&nbsp;ServeConn&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5802513">//&nbsp;ServeConn&nbsp;uses&nbsp;the&nbsp;gob&nbsp;wire&nbsp;format&nbsp;(see&nbsp;package&nbsp;gob)&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5802576">//&nbsp;connection.&nbsp;&nbsp;To&nbsp;use&nbsp;an&nbsp;alternate&nbsp;codec,&nbsp;use&nbsp;ServeCodec.</span><br>
<span class="lineno">445</span><span class="keyword" id="5802635">func</span>&nbsp;<span class="op" id="5802640">(</span><span class="ident" id="5802641">server</span>&nbsp;<span class="op" id="5802648">*</span><span class="ident" id="5802649"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5802655">)</span>&nbsp;<span class="ident" id="5802657">ServeConn</span><span class="op" id="5802666">(</span><span class="ident" id="5802667">conn</span>&nbsp;<span class="ident" id="5802672"><a href="/net/rpc/server.go.html#5793255">io</a></span><span class="op" id="5802674">.</span><span class="ident" id="5802675">ReadWriteCloser</span><span class="op" id="5802690">)</span>&nbsp;<span class="op" id="5802692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5802695">buf</span>&nbsp;<span class="op" id="5802699">:=</span>&nbsp;<span class="ident" id="5802702"><a href="/net/rpc/server.go.html#5793220">bufio</a></span><span class="op" id="5802707">.</span><span class="ident" id="5802708">NewWriter</span><span class="op" id="5802717">(</span><span class="ident" id="5802718"><a href="/net/rpc/server.go.html#5802667">conn</a></span><span class="op" id="5802722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5802725">srv</span>&nbsp;<span class="op" id="5802729">:=</span>&nbsp;<span class="op" id="5802732">&amp;</span><span class="ident" id="5802733"><a href="/net/rpc/server.go.html#5801108">gobServerCodec</a></span><span class="op" id="5802747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5802751">rwc</span><span class="op" id="5802754">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5802759"><a href="/net/rpc/server.go.html#5802667">conn</a></span><span class="op" id="5802763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5802767">dec</span><span class="op" id="5802770">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5802775"><a href="/net/rpc/server.go.html#5793229">gob</a></span><span class="op" id="5802778">.</span><span class="ident" id="5802779">NewDecoder</span><span class="op" id="5802789">(</span><span class="ident" id="5802790"><a href="/net/rpc/server.go.html#5802667">conn</a></span><span class="op" id="5802794">)</span><span class="op" id="5802795">,</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5802799">enc</span><span class="op" id="5802802">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5802807"><a href="/net/rpc/server.go.html#5793229">gob</a></span><span class="op" id="5802810">.</span><span class="ident" id="5802811">NewEncoder</span><span class="op" id="5802821">(</span><span class="ident" id="5802822"><a href="/net/rpc/server.go.html#5802695">buf</a></span><span class="op" id="5802825">)</span><span class="op" id="5802826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5802830">encBuf</span><span class="op" id="5802836">:</span>&nbsp;<span class="ident" id="5802838"><a href="/net/rpc/server.go.html#5802695">buf</a></span><span class="op" id="5802841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5802844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5802847"><a href="/net/rpc/server.go.html#5802641">server</a></span><span class="op" id="5802853">.</span><span class="ident" id="5802854">ServeCodec</span><span class="op" id="5802864">(</span><span class="ident" id="5802865"><a href="/net/rpc/server.go.html#5802725">srv</a></span><span class="op" id="5802868">)</span><br>
<span class="lineno"></span><span class="op" id="5802870">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="5802873">//&nbsp;ServeCodec&nbsp;is&nbsp;like&nbsp;ServeConn&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified&nbsp;codec&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5802937">//&nbsp;decode&nbsp;requests&nbsp;and&nbsp;encode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="5802978">func</span>&nbsp;<span class="op" id="5802983">(</span><span class="ident" id="5802984">server</span>&nbsp;<span class="op" id="5802991">*</span><span class="ident" id="5802992"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5802998">)</span>&nbsp;<span class="ident" id="5803000">ServeCodec</span><span class="op" id="5803010">(</span><span class="ident" id="5803011">codec</span>&nbsp;<span class="ident" id="5803017"><a href="/net/rpc/server.go.html#5808144">ServerCodec</a></span><span class="op" id="5803028">)</span>&nbsp;<span class="op" id="5803030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5803033">sending</span>&nbsp;<span class="op" id="5803041">:=</span>&nbsp;<span class="builtinfunc" id="5803044">new</span><span class="op" id="5803047">(</span><span class="ident" id="5803048"><a href="/net/rpc/server.go.html#5793309">sync</a></span><span class="op" id="5803052">.</span><span class="ident" id="5803053">Mutex</span><span class="op" id="5803058">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5803061">for</span>&nbsp;<span class="op" id="5803065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5803069">service</span><span class="op" id="5803076">,</span>&nbsp;<span class="ident" id="5803078">mtype</span><span class="op" id="5803083">,</span>&nbsp;<span class="ident" id="5803085">req</span><span class="op" id="5803088">,</span>&nbsp;<span class="ident" id="5803090">argv</span><span class="op" id="5803094">,</span>&nbsp;<span class="ident" id="5803096">replyv</span><span class="op" id="5803102">,</span>&nbsp;<span class="ident" id="5803104">keepReading</span><span class="op" id="5803115">,</span>&nbsp;<span class="ident" id="5803117">err</span>&nbsp;<span class="op" id="5803121">:=</span>&nbsp;<span class="ident" id="5803124"><a href="/net/rpc/server.go.html#5802984">server</a></span><span class="op" id="5803130">.</span><span class="ident" id="5803131">readRequest</span><span class="op" id="5803142">(</span><span class="ident" id="5803143"><a href="/net/rpc/server.go.html#5803011">codec</a></span><span class="op" id="5803148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5803152">if</span>&nbsp;<span class="ident" id="5803155"><a href="/net/rpc/server.go.html#5803117">err</a></span>&nbsp;<span class="op" id="5803159">!=</span>&nbsp;<span class="ident" id="5803162">nil</span>&nbsp;<span class="op" id="5803166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5803171">if</span>&nbsp;<span class="ident" id="5803174"><a href="/net/rpc/debug.go.html#5787850">debugLog</a></span>&nbsp;<span class="op" id="5803183">&amp;&amp;</span>&nbsp;<span class="ident" id="5803186"><a href="/net/rpc/server.go.html#5803117">err</a></span>&nbsp;<span class="op" id="5803190">!=</span>&nbsp;<span class="ident" id="5803193"><a href="/net/rpc/server.go.html#5793255">io</a></span><span class="op" id="5803195">.</span><span class="ident" id="5803196">EOF</span>&nbsp;<span class="op" id="5803200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5803206"><a href="/net/rpc/server.go.html#5793261">log</a></span><span class="op" id="5803209">.</span><span class="ident" id="5803210">Println</span><span class="op" id="5803217">(</span><span class="string" id="5803218">&#34;rpc:&#34;</span><span class="op" id="5803224">,</span>&nbsp;<span class="ident" id="5803226"><a href="/net/rpc/server.go.html#5803117">err</a></span><span class="op" id="5803229">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5803234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5803239">if</span>&nbsp;<span class="op" id="5803242">!</span><span class="ident" id="5803243"><a href="/net/rpc/server.go.html#5803104">keepReading</a></span>&nbsp;<span class="op" id="5803255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5803261">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5803270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5803275">//&nbsp;send&nbsp;a&nbsp;response&nbsp;if&nbsp;we&nbsp;actually&nbsp;managed&nbsp;to&nbsp;read&nbsp;a&nbsp;header.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5803338">if</span>&nbsp;<span class="ident" id="5803341"><a href="/net/rpc/server.go.html#5803085">req</a></span>&nbsp;<span class="op" id="5803345">!=</span>&nbsp;<span class="ident" id="5803348">nil</span>&nbsp;<span class="op" id="5803352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5803358"><a href="/net/rpc/server.go.html#5802984">server</a></span><span class="op" id="5803364">.</span><span class="ident" id="5803365">sendResponse</span><span class="op" id="5803377">(</span><span class="ident" id="5803378"><a href="/net/rpc/server.go.html#5803033">sending</a></span><span class="op" id="5803385">,</span>&nbsp;<span class="ident" id="5803387"><a href="/net/rpc/server.go.html#5803085">req</a></span><span class="op" id="5803390">,</span>&nbsp;<span class="ident" id="5803392"><a href="/net/rpc/server.go.html#5799869">invalidRequest</a></span><span class="op" id="5803406">,</span>&nbsp;<span class="ident" id="5803408"><a href="/net/rpc/server.go.html#5803011">codec</a></span><span class="op" id="5803413">,</span>&nbsp;<span class="ident" id="5803415"><a href="/net/rpc/server.go.html#5803117">err</a></span><span class="op" id="5803418">.</span><span class="ident" id="5803419">Error</span><span class="op" id="5803424">(</span><span class="op" id="5803425">)</span><span class="op" id="5803426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5803432"><a href="/net/rpc/server.go.html#5802984">server</a></span><span class="op" id="5803438">.</span><span class="ident" id="5803439">freeRequest</span><span class="op" id="5803450">(</span><span class="ident" id="5803451"><a href="/net/rpc/server.go.html#5803085">req</a></span><span class="op" id="5803454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5803459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5803464">continue</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5803475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5803479">go</span>&nbsp;<span class="ident" id="5803482"><a href="/net/rpc/server.go.html#5803069">service</a></span><span class="op" id="5803489">.</span><span class="ident" id="5803490">call</span><span class="op" id="5803494">(</span><span class="ident" id="5803495"><a href="/net/rpc/server.go.html#5802984">server</a></span><span class="op" id="5803501">,</span>&nbsp;<span class="ident" id="5803503"><a href="/net/rpc/server.go.html#5803033">sending</a></span><span class="op" id="5803510">,</span>&nbsp;<span class="ident" id="5803512"><a href="/net/rpc/server.go.html#5803078">mtype</a></span><span class="op" id="5803517">,</span>&nbsp;<span class="ident" id="5803519"><a href="/net/rpc/server.go.html#5803085">req</a></span><span class="op" id="5803522">,</span>&nbsp;<span class="ident" id="5803524"><a href="/net/rpc/server.go.html#5803090">argv</a></span><span class="op" id="5803528">,</span>&nbsp;<span class="ident" id="5803530"><a href="/net/rpc/server.go.html#5803096">replyv</a></span><span class="op" id="5803536">,</span>&nbsp;<span class="ident" id="5803538"><a href="/net/rpc/server.go.html#5803011">codec</a></span><span class="op" id="5803543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5803546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5803549"><a href="/net/rpc/server.go.html#5803011">codec</a></span><span class="op" id="5803554">.</span><span class="ident" id="5803555">Close</span><span class="op" id="5803560">(</span><span class="op" id="5803561">)</span><br>
<span class="lineno"></span><span class="op" id="5803563">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="5803566">//&nbsp;ServeRequest&nbsp;is&nbsp;like&nbsp;ServeCodec&nbsp;but&nbsp;synchronously&nbsp;serves&nbsp;a&nbsp;single&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="5803644">//&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;codec&nbsp;upon&nbsp;completion.</span><br>
<span class="lineno"></span><span class="keyword" id="5803692">func</span>&nbsp;<span class="op" id="5803697">(</span><span class="ident" id="5803698">server</span>&nbsp;<span class="op" id="5803705">*</span><span class="ident" id="5803706"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5803712">)</span>&nbsp;<span class="ident" id="5803714">ServeRequest</span><span class="op" id="5803726">(</span><span class="ident" id="5803727">codec</span>&nbsp;<span class="ident" id="5803733"><a href="/net/rpc/server.go.html#5808144">ServerCodec</a></span><span class="op" id="5803744">)</span>&nbsp;<span class="builtintype" id="5803746">error</span>&nbsp;<span class="op" id="5803752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5803755">sending</span>&nbsp;<span class="op" id="5803763">:=</span>&nbsp;<span class="builtinfunc" id="5803766">new</span><span class="op" id="5803769">(</span><span class="ident" id="5803770"><a href="/net/rpc/server.go.html#5793309">sync</a></span><span class="op" id="5803774">.</span><span class="ident" id="5803775">Mutex</span><span class="op" id="5803780">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5803783">service</span><span class="op" id="5803790">,</span>&nbsp;<span class="ident" id="5803792">mtype</span><span class="op" id="5803797">,</span>&nbsp;<span class="ident" id="5803799">req</span><span class="op" id="5803802">,</span>&nbsp;<span class="ident" id="5803804">argv</span><span class="op" id="5803808">,</span>&nbsp;<span class="ident" id="5803810">replyv</span><span class="op" id="5803816">,</span>&nbsp;<span class="ident" id="5803818">keepReading</span><span class="op" id="5803829">,</span>&nbsp;<span class="ident" id="5803831">err</span>&nbsp;<span class="op" id="5803835">:=</span>&nbsp;<span class="ident" id="5803838"><a href="/net/rpc/server.go.html#5803698">server</a></span><span class="op" id="5803844">.</span><span class="ident" id="5803845">readRequest</span><span class="op" id="5803856">(</span><span class="ident" id="5803857"><a href="/net/rpc/server.go.html#5803727">codec</a></span><span class="op" id="5803862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5803865">if</span>&nbsp;<span class="ident" id="5803868"><a href="/net/rpc/server.go.html#5803831">err</a></span>&nbsp;<span class="op" id="5803872">!=</span>&nbsp;<span class="ident" id="5803875">nil</span>&nbsp;<span class="op" id="5803879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5803883">if</span>&nbsp;<span class="op" id="5803886">!</span><span class="ident" id="5803887"><a href="/net/rpc/server.go.html#5803818">keepReading</a></span>&nbsp;<span class="op" id="5803899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5803904">return</span>&nbsp;<span class="ident" id="5803911"><a href="/net/rpc/server.go.html#5803831">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5803917">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5803921">//&nbsp;send&nbsp;a&nbsp;response&nbsp;if&nbsp;we&nbsp;actually&nbsp;managed&nbsp;to&nbsp;read&nbsp;a&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5803983">if</span>&nbsp;<span class="ident" id="5803986"><a href="/net/rpc/server.go.html#5803799">req</a></span>&nbsp;<span class="op" id="5803990">!=</span>&nbsp;<span class="ident" id="5803993">nil</span>&nbsp;<span class="op" id="5803997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804002"><a href="/net/rpc/server.go.html#5803698">server</a></span><span class="op" id="5804008">.</span><span class="ident" id="5804009">sendResponse</span><span class="op" id="5804021">(</span><span class="ident" id="5804022"><a href="/net/rpc/server.go.html#5803755">sending</a></span><span class="op" id="5804029">,</span>&nbsp;<span class="ident" id="5804031"><a href="/net/rpc/server.go.html#5803799">req</a></span><span class="op" id="5804034">,</span>&nbsp;<span class="ident" id="5804036"><a href="/net/rpc/server.go.html#5799869">invalidRequest</a></span><span class="op" id="5804050">,</span>&nbsp;<span class="ident" id="5804052"><a href="/net/rpc/server.go.html#5803727">codec</a></span><span class="op" id="5804057">,</span>&nbsp;<span class="ident" id="5804059"><a href="/net/rpc/server.go.html#5803831">err</a></span><span class="op" id="5804062">.</span><span class="ident" id="5804063">Error</span><span class="op" id="5804068">(</span><span class="op" id="5804069">)</span><span class="op" id="5804070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804075"><a href="/net/rpc/server.go.html#5803698">server</a></span><span class="op" id="5804081">.</span><span class="ident" id="5804082">freeRequest</span><span class="op" id="5804093">(</span><span class="ident" id="5804094"><a href="/net/rpc/server.go.html#5803799">req</a></span><span class="op" id="5804097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5804101">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5804105">return</span>&nbsp;<span class="ident" id="5804112"><a href="/net/rpc/server.go.html#5803831">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5804117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804120"><a href="/net/rpc/server.go.html#5803783">service</a></span><span class="op" id="5804127">.</span><span class="ident" id="5804128">call</span><span class="op" id="5804132">(</span><span class="ident" id="5804133"><a href="/net/rpc/server.go.html#5803698">server</a></span><span class="op" id="5804139">,</span>&nbsp;<span class="ident" id="5804141"><a href="/net/rpc/server.go.html#5803755">sending</a></span><span class="op" id="5804148">,</span>&nbsp;<span class="ident" id="5804150"><a href="/net/rpc/server.go.html#5803792">mtype</a></span><span class="op" id="5804155">,</span>&nbsp;<span class="ident" id="5804157"><a href="/net/rpc/server.go.html#5803799">req</a></span><span class="op" id="5804160">,</span>&nbsp;<span class="ident" id="5804162"><a href="/net/rpc/server.go.html#5803804">argv</a></span><span class="op" id="5804166">,</span>&nbsp;<span class="ident" id="5804168"><a href="/net/rpc/server.go.html#5803810">replyv</a></span><span class="op" id="5804174">,</span>&nbsp;<span class="ident" id="5804176"><a href="/net/rpc/server.go.html#5803727">codec</a></span><span class="op" id="5804181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5804184">return</span>&nbsp;<span class="ident" id="5804191">nil</span><br>
<span class="lineno"></span><span class="op" id="5804195">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="5804198">func</span>&nbsp;<span class="op" id="5804203">(</span><span class="ident" id="5804204">server</span>&nbsp;<span class="op" id="5804211">*</span><span class="ident" id="5804212"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5804218">)</span>&nbsp;<span class="ident" id="5804220">getRequest</span><span class="op" id="5804230">(</span><span class="op" id="5804231">)</span>&nbsp;<span class="op" id="5804233">*</span><span class="ident" id="5804234"><a href="/net/rpc/server.go.html#5794226">Request</a></span>&nbsp;<span class="op" id="5804242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804245"><a href="/net/rpc/server.go.html#5804204">server</a></span><span class="op" id="5804251">.</span><span class="ident" id="5804252">reqLock</span><span class="op" id="5804259">.</span><span class="ident" id="5804260">Lock</span><span class="op" id="5804264">(</span><span class="op" id="5804265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804268">req</span>&nbsp;<span class="op" id="5804272">:=</span>&nbsp;<span class="ident" id="5804275"><a href="/net/rpc/server.go.html#5804204">server</a></span><span class="op" id="5804281">.</span><span class="ident" id="5804282">freeReq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5804291">if</span>&nbsp;<span class="ident" id="5804294"><a href="/net/rpc/server.go.html#5804268">req</a></span>&nbsp;<span class="op" id="5804298">==</span>&nbsp;<span class="ident" id="5804301">nil</span>&nbsp;<span class="op" id="5804305">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804309"><a href="/net/rpc/server.go.html#5804268">req</a></span>&nbsp;<span class="op" id="5804313">=</span>&nbsp;<span class="builtinfunc" id="5804315">new</span><span class="op" id="5804318">(</span><span class="ident" id="5804319"><a href="/net/rpc/server.go.html#5794226">Request</a></span><span class="op" id="5804326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5804329">}</span>&nbsp;<span class="keyword" id="5804331">else</span>&nbsp;<span class="op" id="5804336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804340"><a href="/net/rpc/server.go.html#5804204">server</a></span><span class="op" id="5804346">.</span><span class="ident" id="5804347">freeReq</span>&nbsp;<span class="op" id="5804355">=</span>&nbsp;<span class="ident" id="5804357"><a href="/net/rpc/server.go.html#5804268">req</a></span><span class="op" id="5804360">.</span><span class="ident" id="5804361">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5804368">*</span><span class="ident" id="5804369"><a href="/net/rpc/server.go.html#5804268">req</a></span>&nbsp;<span class="op" id="5804373">=</span>&nbsp;<span class="ident" id="5804375"><a href="/net/rpc/server.go.html#5794226">Request</a></span><span class="op" id="5804382">{</span><span class="op" id="5804383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5804386">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804389"><a href="/net/rpc/server.go.html#5804204">server</a></span><span class="op" id="5804395">.</span><span class="ident" id="5804396">reqLock</span><span class="op" id="5804403">.</span><span class="ident" id="5804404">Unlock</span><span class="op" id="5804410">(</span><span class="op" id="5804411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5804414">return</span>&nbsp;<span class="ident" id="5804421"><a href="/net/rpc/server.go.html#5804268">req</a></span><br>
<span class="lineno"></span><span class="op" id="5804425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5804428">func</span>&nbsp;<span class="op" id="5804433">(</span><span class="ident" id="5804434">server</span>&nbsp;<span class="op" id="5804441">*</span><span class="ident" id="5804442"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5804448">)</span>&nbsp;<span class="ident" id="5804450">freeRequest</span><span class="op" id="5804461">(</span><span class="ident" id="5804462">req</span>&nbsp;<span class="op" id="5804466">*</span><span class="ident" id="5804467"><a href="/net/rpc/server.go.html#5794226">Request</a></span><span class="op" id="5804474">)</span>&nbsp;<span class="op" id="5804476">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804479"><a href="/net/rpc/server.go.html#5804434">server</a></span><span class="op" id="5804485">.</span><span class="ident" id="5804486">reqLock</span><span class="op" id="5804493">.</span><span class="ident" id="5804494">Lock</span><span class="op" id="5804498">(</span><span class="op" id="5804499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804502"><a href="/net/rpc/server.go.html#5804462">req</a></span><span class="op" id="5804505">.</span><span class="ident" id="5804506">next</span>&nbsp;<span class="op" id="5804511">=</span>&nbsp;<span class="ident" id="5804513"><a href="/net/rpc/server.go.html#5804434">server</a></span><span class="op" id="5804519">.</span><span class="ident" id="5804520">freeReq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804529"><a href="/net/rpc/server.go.html#5804434">server</a></span><span class="op" id="5804535">.</span><span class="ident" id="5804536">freeReq</span>&nbsp;<span class="op" id="5804544">=</span>&nbsp;<span class="ident" id="5804546"><a href="/net/rpc/server.go.html#5804462">req</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804551"><a href="/net/rpc/server.go.html#5804434">server</a></span><span class="op" id="5804557">.</span><span class="ident" id="5804558">reqLock</span><span class="op" id="5804565">.</span><span class="ident" id="5804566">Unlock</span><span class="op" id="5804572">(</span><span class="op" id="5804573">)</span><br>
<span class="lineno"></span><span class="op" id="5804575">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="keyword" id="5804578">func</span>&nbsp;<span class="op" id="5804583">(</span><span class="ident" id="5804584">server</span>&nbsp;<span class="op" id="5804591">*</span><span class="ident" id="5804592"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5804598">)</span>&nbsp;<span class="ident" id="5804600">getResponse</span><span class="op" id="5804611">(</span><span class="op" id="5804612">)</span>&nbsp;<span class="op" id="5804614">*</span><span class="ident" id="5804615"><a href="/net/rpc/server.go.html#5794584">Response</a></span>&nbsp;<span class="op" id="5804624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804627"><a href="/net/rpc/server.go.html#5804584">server</a></span><span class="op" id="5804633">.</span><span class="ident" id="5804634">respLock</span><span class="op" id="5804642">.</span><span class="ident" id="5804643">Lock</span><span class="op" id="5804647">(</span><span class="op" id="5804648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804651">resp</span>&nbsp;<span class="op" id="5804656">:=</span>&nbsp;<span class="ident" id="5804659"><a href="/net/rpc/server.go.html#5804584">server</a></span><span class="op" id="5804665">.</span><span class="ident" id="5804666">freeResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5804676">if</span>&nbsp;<span class="ident" id="5804679"><a href="/net/rpc/server.go.html#5804651">resp</a></span>&nbsp;<span class="op" id="5804684">==</span>&nbsp;<span class="ident" id="5804687">nil</span>&nbsp;<span class="op" id="5804691">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804695"><a href="/net/rpc/server.go.html#5804651">resp</a></span>&nbsp;<span class="op" id="5804700">=</span>&nbsp;<span class="builtinfunc" id="5804702">new</span><span class="op" id="5804705">(</span><span class="ident" id="5804706"><a href="/net/rpc/server.go.html#5794584">Response</a></span><span class="op" id="5804714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5804717">}</span>&nbsp;<span class="keyword" id="5804719">else</span>&nbsp;<span class="op" id="5804724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804728"><a href="/net/rpc/server.go.html#5804584">server</a></span><span class="op" id="5804734">.</span><span class="ident" id="5804735">freeResp</span>&nbsp;<span class="op" id="5804744">=</span>&nbsp;<span class="ident" id="5804746"><a href="/net/rpc/server.go.html#5804651">resp</a></span><span class="op" id="5804750">.</span><span class="ident" id="5804751">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5804758">*</span><span class="ident" id="5804759"><a href="/net/rpc/server.go.html#5804651">resp</a></span>&nbsp;<span class="op" id="5804764">=</span>&nbsp;<span class="ident" id="5804766"><a href="/net/rpc/server.go.html#5794584">Response</a></span><span class="op" id="5804774">{</span><span class="op" id="5804775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5804778">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804781"><a href="/net/rpc/server.go.html#5804584">server</a></span><span class="op" id="5804787">.</span><span class="ident" id="5804788">respLock</span><span class="op" id="5804796">.</span><span class="ident" id="5804797">Unlock</span><span class="op" id="5804803">(</span><span class="op" id="5804804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5804807">return</span>&nbsp;<span class="ident" id="5804814"><a href="/net/rpc/server.go.html#5804651">resp</a></span><br>
<span class="lineno"></span><span class="op" id="5804819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5804822">func</span>&nbsp;<span class="op" id="5804827">(</span><span class="ident" id="5804828">server</span>&nbsp;<span class="op" id="5804835">*</span><span class="ident" id="5804836"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5804842">)</span>&nbsp;<span class="ident" id="5804844">freeResponse</span><span class="op" id="5804856">(</span><span class="ident" id="5804857">resp</span>&nbsp;<span class="op" id="5804862">*</span><span class="ident" id="5804863"><a href="/net/rpc/server.go.html#5794584">Response</a></span><span class="op" id="5804871">)</span>&nbsp;<span class="op" id="5804873">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804876"><a href="/net/rpc/server.go.html#5804828">server</a></span><span class="op" id="5804882">.</span><span class="ident" id="5804883">respLock</span><span class="op" id="5804891">.</span><span class="ident" id="5804892">Lock</span><span class="op" id="5804896">(</span><span class="op" id="5804897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804900"><a href="/net/rpc/server.go.html#5804857">resp</a></span><span class="op" id="5804904">.</span><span class="ident" id="5804905">next</span>&nbsp;<span class="op" id="5804910">=</span>&nbsp;<span class="ident" id="5804912"><a href="/net/rpc/server.go.html#5804828">server</a></span><span class="op" id="5804918">.</span><span class="ident" id="5804919">freeResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804929"><a href="/net/rpc/server.go.html#5804828">server</a></span><span class="op" id="5804935">.</span><span class="ident" id="5804936">freeResp</span>&nbsp;<span class="op" id="5804945">=</span>&nbsp;<span class="ident" id="5804947"><a href="/net/rpc/server.go.html#5804857">resp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5804953"><a href="/net/rpc/server.go.html#5804828">server</a></span><span class="op" id="5804959">.</span><span class="ident" id="5804960">respLock</span><span class="op" id="5804968">.</span><span class="ident" id="5804969">Unlock</span><span class="op" id="5804975">(</span><span class="op" id="5804976">)</span><br>
<span class="lineno"></span><span class="op" id="5804978">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span><span class="keyword" id="5804981">func</span>&nbsp;<span class="op" id="5804986">(</span><span class="ident" id="5804987">server</span>&nbsp;<span class="op" id="5804994">*</span><span class="ident" id="5804995"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5805001">)</span>&nbsp;<span class="ident" id="5805003">readRequest</span><span class="op" id="5805014">(</span><span class="ident" id="5805015">codec</span>&nbsp;<span class="ident" id="5805021"><a href="/net/rpc/server.go.html#5808144">ServerCodec</a></span><span class="op" id="5805032">)</span>&nbsp;<span class="op" id="5805034">(</span><span class="ident" id="5805035">service</span>&nbsp;<span class="op" id="5805043">*</span><span class="ident" id="5805044"><a href="/net/rpc/server.go.html#5793806">service</a></span><span class="op" id="5805051">,</span>&nbsp;<span class="ident" id="5805053">mtype</span>&nbsp;<span class="op" id="5805059">*</span><span class="ident" id="5805060"><a href="/net/rpc/server.go.html#5793651">methodType</a></span><span class="op" id="5805070">,</span>&nbsp;<span class="ident" id="5805072">req</span>&nbsp;<span class="op" id="5805076">*</span><span class="ident" id="5805077"><a href="/net/rpc/server.go.html#5794226">Request</a></span><span class="op" id="5805084">,</span>&nbsp;<span class="ident" id="5805086">argv</span><span class="op" id="5805090">,</span>&nbsp;<span class="ident" id="5805092">replyv</span>&nbsp;<span class="ident" id="5805099"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5805106">.</span><span class="ident" id="5805107">Value</span><span class="op" id="5805112">,</span>&nbsp;<span class="ident" id="5805114">keepReading</span>&nbsp;<span class="builtintype" id="5805126">bool</span><span class="op" id="5805130">,</span>&nbsp;<span class="ident" id="5805132">err</span>&nbsp;<span class="builtintype" id="5805136">error</span><span class="op" id="5805141">)</span>&nbsp;<span class="op" id="5805143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805146"><a href="/net/rpc/server.go.html#5805035">service</a></span><span class="op" id="5805153">,</span>&nbsp;<span class="ident" id="5805155"><a href="/net/rpc/server.go.html#5805053">mtype</a></span><span class="op" id="5805160">,</span>&nbsp;<span class="ident" id="5805162"><a href="/net/rpc/server.go.html#5805072">req</a></span><span class="op" id="5805165">,</span>&nbsp;<span class="ident" id="5805167"><a href="/net/rpc/server.go.html#5805114">keepReading</a></span><span class="op" id="5805178">,</span>&nbsp;<span class="ident" id="5805180"><a href="/net/rpc/server.go.html#5805132">err</a></span>&nbsp;<span class="op" id="5805184">=</span>&nbsp;<span class="ident" id="5805186"><a href="/net/rpc/server.go.html#5804987">server</a></span><span class="op" id="5805192">.</span><span class="ident" id="5805193">readRequestHeader</span><span class="op" id="5805210">(</span><span class="ident" id="5805211"><a href="/net/rpc/server.go.html#5805015">codec</a></span><span class="op" id="5805216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5805219">if</span>&nbsp;<span class="ident" id="5805222"><a href="/net/rpc/server.go.html#5805132">err</a></span>&nbsp;<span class="op" id="5805226">!=</span>&nbsp;<span class="ident" id="5805229">nil</span>&nbsp;<span class="op" id="5805233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5805237">if</span>&nbsp;<span class="op" id="5805240">!</span><span class="ident" id="5805241"><a href="/net/rpc/server.go.html#5805114">keepReading</a></span>&nbsp;<span class="op" id="5805253">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5805258">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5805267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5805271">//&nbsp;discard&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805289"><a href="/net/rpc/server.go.html#5805015">codec</a></span><span class="op" id="5805294">.</span><span class="ident" id="5805295">ReadRequestBody</span><span class="op" id="5805310">(</span><span class="ident" id="5805311">nil</span><span class="op" id="5805314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5805318">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5805326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5805330">//&nbsp;Decode&nbsp;the&nbsp;argument&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805361">argIsValue</span>&nbsp;<span class="op" id="5805372">:=</span>&nbsp;<span class="builtintype" id="5805375">false</span>&nbsp;<span class="comment" id="5805381">//&nbsp;if&nbsp;true,&nbsp;need&nbsp;to&nbsp;indirect&nbsp;before&nbsp;calling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5805427">if</span>&nbsp;<span class="ident" id="5805430"><a href="/net/rpc/server.go.html#5805053">mtype</a></span><span class="op" id="5805435">.</span><span class="ident" id="5805436">ArgType</span><span class="op" id="5805443">.</span><span class="ident" id="5805444">Kind</span><span class="op" id="5805448">(</span><span class="op" id="5805449">)</span>&nbsp;<span class="op" id="5805451">==</span>&nbsp;<span class="ident" id="5805454"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5805461">.</span><span class="ident" id="5805462">Ptr</span>&nbsp;<span class="op" id="5805466">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805470"><a href="/net/rpc/server.go.html#5805086">argv</a></span>&nbsp;<span class="op" id="5805475">=</span>&nbsp;<span class="ident" id="5805477"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5805484">.</span><span class="ident" id="5805485">New</span><span class="op" id="5805488">(</span><span class="ident" id="5805489"><a href="/net/rpc/server.go.html#5805053">mtype</a></span><span class="op" id="5805494">.</span><span class="ident" id="5805495">ArgType</span><span class="op" id="5805502">.</span><span class="ident" id="5805503">Elem</span><span class="op" id="5805507">(</span><span class="op" id="5805508">)</span><span class="op" id="5805509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5805512">}</span>&nbsp;<span class="keyword" id="5805514">else</span>&nbsp;<span class="op" id="5805519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805523"><a href="/net/rpc/server.go.html#5805086">argv</a></span>&nbsp;<span class="op" id="5805528">=</span>&nbsp;<span class="ident" id="5805530"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5805537">.</span><span class="ident" id="5805538">New</span><span class="op" id="5805541">(</span><span class="ident" id="5805542"><a href="/net/rpc/server.go.html#5805053">mtype</a></span><span class="op" id="5805547">.</span><span class="ident" id="5805548">ArgType</span><span class="op" id="5805555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805559"><a href="/net/rpc/server.go.html#5805361">argIsValue</a></span>&nbsp;<span class="op" id="5805570">=</span>&nbsp;<span class="builtintype" id="5805572">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5805578">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5805581">//&nbsp;argv&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;a&nbsp;pointer&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5805622">if</span>&nbsp;<span class="ident" id="5805625"><a href="/net/rpc/server.go.html#5805132">err</a></span>&nbsp;<span class="op" id="5805629">=</span>&nbsp;<span class="ident" id="5805631"><a href="/net/rpc/server.go.html#5805015">codec</a></span><span class="op" id="5805636">.</span><span class="ident" id="5805637">ReadRequestBody</span><span class="op" id="5805652">(</span><span class="ident" id="5805653"><a href="/net/rpc/server.go.html#5805086">argv</a></span><span class="op" id="5805657">.</span><span class="ident" id="5805658">Interface</span><span class="op" id="5805667">(</span><span class="op" id="5805668">)</span><span class="op" id="5805669">)</span><span class="op" id="5805670">;</span>&nbsp;<span class="ident" id="5805672"><a href="/net/rpc/server.go.html#5805132">err</a></span>&nbsp;<span class="op" id="5805676">!=</span>&nbsp;<span class="ident" id="5805679">nil</span>&nbsp;<span class="op" id="5805683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5805687">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5805695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5805698">if</span>&nbsp;<span class="ident" id="5805701"><a href="/net/rpc/server.go.html#5805361">argIsValue</a></span>&nbsp;<span class="op" id="5805712">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805716"><a href="/net/rpc/server.go.html#5805086">argv</a></span>&nbsp;<span class="op" id="5805721">=</span>&nbsp;<span class="ident" id="5805723"><a href="/net/rpc/server.go.html#5805086">argv</a></span><span class="op" id="5805727">.</span><span class="ident" id="5805728">Elem</span><span class="op" id="5805732">(</span><span class="op" id="5805733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5805736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805740"><a href="/net/rpc/server.go.html#5805092">replyv</a></span>&nbsp;<span class="op" id="5805747">=</span>&nbsp;<span class="ident" id="5805749"><a href="/net/rpc/server.go.html#5793287">reflect</a></span><span class="op" id="5805756">.</span><span class="ident" id="5805757">New</span><span class="op" id="5805760">(</span><span class="ident" id="5805761"><a href="/net/rpc/server.go.html#5805053">mtype</a></span><span class="op" id="5805766">.</span><span class="ident" id="5805767">ReplyType</span><span class="op" id="5805776">.</span><span class="ident" id="5805777">Elem</span><span class="op" id="5805781">(</span><span class="op" id="5805782">)</span><span class="op" id="5805783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5805786">return</span><br>
<span class="lineno">570</span><span class="op" id="5805793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5805796">func</span>&nbsp;<span class="op" id="5805801">(</span><span class="ident" id="5805802">server</span>&nbsp;<span class="op" id="5805809">*</span><span class="ident" id="5805810"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5805816">)</span>&nbsp;<span class="ident" id="5805818">readRequestHeader</span><span class="op" id="5805835">(</span><span class="ident" id="5805836">codec</span>&nbsp;<span class="ident" id="5805842"><a href="/net/rpc/server.go.html#5808144">ServerCodec</a></span><span class="op" id="5805853">)</span>&nbsp;<span class="op" id="5805855">(</span><span class="ident" id="5805856">service</span>&nbsp;<span class="op" id="5805864">*</span><span class="ident" id="5805865"><a href="/net/rpc/server.go.html#5793806">service</a></span><span class="op" id="5805872">,</span>&nbsp;<span class="ident" id="5805874">mtype</span>&nbsp;<span class="op" id="5805880">*</span><span class="ident" id="5805881"><a href="/net/rpc/server.go.html#5793651">methodType</a></span><span class="op" id="5805891">,</span>&nbsp;<span class="ident" id="5805893">req</span>&nbsp;<span class="op" id="5805897">*</span><span class="ident" id="5805898"><a href="/net/rpc/server.go.html#5794226">Request</a></span><span class="op" id="5805905">,</span>&nbsp;<span class="ident" id="5805907">keepReading</span>&nbsp;<span class="builtintype" id="5805919">bool</span><span class="op" id="5805923">,</span>&nbsp;<span class="ident" id="5805925">err</span>&nbsp;<span class="builtintype" id="5805929">error</span><span class="op" id="5805934">)</span>&nbsp;<span class="op" id="5805936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5805939">//&nbsp;Grab&nbsp;the&nbsp;request&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805968"><a href="/net/rpc/server.go.html#5805893">req</a></span>&nbsp;<span class="op" id="5805972">=</span>&nbsp;<span class="ident" id="5805974"><a href="/net/rpc/server.go.html#5805802">server</a></span><span class="op" id="5805980">.</span><span class="ident" id="5805981">getRequest</span><span class="op" id="5805991">(</span><span class="op" id="5805992">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5805995"><a href="/net/rpc/server.go.html#5805925">err</a></span>&nbsp;<span class="op" id="5805999">=</span>&nbsp;<span class="ident" id="5806001"><a href="/net/rpc/server.go.html#5805836">codec</a></span><span class="op" id="5806006">.</span><span class="ident" id="5806007">ReadRequestHeader</span><span class="op" id="5806024">(</span><span class="ident" id="5806025"><a href="/net/rpc/server.go.html#5805893">req</a></span><span class="op" id="5806028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5806031">if</span>&nbsp;<span class="ident" id="5806034"><a href="/net/rpc/server.go.html#5805925">err</a></span>&nbsp;<span class="op" id="5806038">!=</span>&nbsp;<span class="ident" id="5806041">nil</span>&nbsp;<span class="op" id="5806045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806049"><a href="/net/rpc/server.go.html#5805893">req</a></span>&nbsp;<span class="op" id="5806053">=</span>&nbsp;<span class="ident" id="5806055">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5806061">if</span>&nbsp;<span class="ident" id="5806064"><a href="/net/rpc/server.go.html#5805925">err</a></span>&nbsp;<span class="op" id="5806068">==</span>&nbsp;<span class="ident" id="5806071"><a href="/net/rpc/server.go.html#5793255">io</a></span><span class="op" id="5806073">.</span><span class="ident" id="5806074">EOF</span>&nbsp;<span class="op" id="5806078">||</span>&nbsp;<span class="ident" id="5806081"><a href="/net/rpc/server.go.html#5805925">err</a></span>&nbsp;<span class="op" id="5806085">==</span>&nbsp;<span class="ident" id="5806088"><a href="/net/rpc/server.go.html#5793255">io</a></span><span class="op" id="5806090">.</span><span class="ident" id="5806091">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="5806108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5806113">return</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5806122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806126"><a href="/net/rpc/server.go.html#5805925">err</a></span>&nbsp;<span class="op" id="5806130">=</span>&nbsp;<span class="ident" id="5806132"><a href="/net/rpc/server.go.html#5793245">errors</a></span><span class="op" id="5806138">.</span><span class="ident" id="5806139">New</span><span class="op" id="5806142">(</span><span class="string" id="5806143">&#34;rpc:&nbsp;server&nbsp;cannot&nbsp;decode&nbsp;request:&nbsp;&#34;</span>&nbsp;<span class="op" id="5806181">+</span>&nbsp;<span class="ident" id="5806183"><a href="/net/rpc/server.go.html#5805925">err</a></span><span class="op" id="5806186">.</span><span class="ident" id="5806187">Error</span><span class="op" id="5806192">(</span><span class="op" id="5806193">)</span><span class="op" id="5806194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5806198">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5806206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5806210">//&nbsp;We&nbsp;read&nbsp;the&nbsp;header&nbsp;successfully.&nbsp;&nbsp;If&nbsp;we&nbsp;see&nbsp;an&nbsp;error&nbsp;now,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5806272">//&nbsp;we&nbsp;can&nbsp;still&nbsp;recover&nbsp;and&nbsp;move&nbsp;on&nbsp;to&nbsp;the&nbsp;next&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806330"><a href="/net/rpc/server.go.html#5805907">keepReading</a></span>&nbsp;<span class="op" id="5806342">=</span>&nbsp;<span class="builtintype" id="5806344">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806351">dot</span>&nbsp;<span class="op" id="5806355">:=</span>&nbsp;<span class="ident" id="5806358"><a href="/net/rpc/server.go.html#5793298">strings</a></span><span class="op" id="5806365">.</span><span class="ident" id="5806366">LastIndex</span><span class="op" id="5806375">(</span><span class="ident" id="5806376"><a href="/net/rpc/server.go.html#5805893">req</a></span><span class="op" id="5806379">.</span><span class="ident" id="5806380">ServiceMethod</span><span class="op" id="5806393">,</span>&nbsp;<span class="string" id="5806395">&#34;.&#34;</span><span class="op" id="5806398">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5806401">if</span>&nbsp;<span class="ident" id="5806404"><a href="/net/rpc/server.go.html#5806351">dot</a></span>&nbsp;<span class="op" id="5806408">&lt;</span>&nbsp;<span class="num" id="5806410">0</span>&nbsp;<span class="op" id="5806412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806416"><a href="/net/rpc/server.go.html#5805925">err</a></span>&nbsp;<span class="op" id="5806420">=</span>&nbsp;<span class="ident" id="5806422"><a href="/net/rpc/server.go.html#5793245">errors</a></span><span class="op" id="5806428">.</span><span class="ident" id="5806429">New</span><span class="op" id="5806432">(</span><span class="string" id="5806433">&#34;rpc:&nbsp;service/method&nbsp;request&nbsp;ill-formed:&nbsp;&#34;</span>&nbsp;<span class="op" id="5806476">+</span>&nbsp;<span class="ident" id="5806478"><a href="/net/rpc/server.go.html#5805893">req</a></span><span class="op" id="5806481">.</span><span class="ident" id="5806482">ServiceMethod</span><span class="op" id="5806495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5806499">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5806507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806510">serviceName</span>&nbsp;<span class="op" id="5806522">:=</span>&nbsp;<span class="ident" id="5806525"><a href="/net/rpc/server.go.html#5805893">req</a></span><span class="op" id="5806528">.</span><span class="ident" id="5806529">ServiceMethod</span><span class="op" id="5806542">[</span><span class="op" id="5806543">:</span><span class="ident" id="5806544"><a href="/net/rpc/server.go.html#5806351">dot</a></span><span class="op" id="5806547">]</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806550">methodName</span>&nbsp;<span class="op" id="5806561">:=</span>&nbsp;<span class="ident" id="5806564"><a href="/net/rpc/server.go.html#5805893">req</a></span><span class="op" id="5806567">.</span><span class="ident" id="5806568">ServiceMethod</span><span class="op" id="5806581">[</span><span class="ident" id="5806582"><a href="/net/rpc/server.go.html#5806351">dot</a></span><span class="op" id="5806585">+</span><span class="num" id="5806586">1</span><span class="op" id="5806587">:</span><span class="op" id="5806588">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5806592">//&nbsp;Look&nbsp;up&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806617"><a href="/net/rpc/server.go.html#5805802">server</a></span><span class="op" id="5806623">.</span><span class="ident" id="5806624">mu</span><span class="op" id="5806626">.</span><span class="ident" id="5806627">RLock</span><span class="op" id="5806632">(</span><span class="op" id="5806633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806636"><a href="/net/rpc/server.go.html#5805856">service</a></span>&nbsp;<span class="op" id="5806644">=</span>&nbsp;<span class="ident" id="5806646"><a href="/net/rpc/server.go.html#5805802">server</a></span><span class="op" id="5806652">.</span><span class="ident" id="5806653">serviceMap</span><span class="op" id="5806663">[</span><span class="ident" id="5806664"><a href="/net/rpc/server.go.html#5806510">serviceName</a></span><span class="op" id="5806675">]</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806678"><a href="/net/rpc/server.go.html#5805802">server</a></span><span class="op" id="5806684">.</span><span class="ident" id="5806685">mu</span><span class="op" id="5806687">.</span><span class="ident" id="5806688">RUnlock</span><span class="op" id="5806695">(</span><span class="op" id="5806696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5806699">if</span>&nbsp;<span class="ident" id="5806702"><a href="/net/rpc/server.go.html#5805856">service</a></span>&nbsp;<span class="op" id="5806710">==</span>&nbsp;<span class="ident" id="5806713">nil</span>&nbsp;<span class="op" id="5806717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806721"><a href="/net/rpc/server.go.html#5805925">err</a></span>&nbsp;<span class="op" id="5806725">=</span>&nbsp;<span class="ident" id="5806727"><a href="/net/rpc/server.go.html#5793245">errors</a></span><span class="op" id="5806733">.</span><span class="ident" id="5806734">New</span><span class="op" id="5806737">(</span><span class="string" id="5806738">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;service&nbsp;&#34;</span>&nbsp;<span class="op" id="5806765">+</span>&nbsp;<span class="ident" id="5806767"><a href="/net/rpc/server.go.html#5805893">req</a></span><span class="op" id="5806770">.</span><span class="ident" id="5806771">ServiceMethod</span><span class="op" id="5806784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5806788">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5806796">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806799"><a href="/net/rpc/server.go.html#5805874">mtype</a></span>&nbsp;<span class="op" id="5806805">=</span>&nbsp;<span class="ident" id="5806807"><a href="/net/rpc/server.go.html#5805856">service</a></span><span class="op" id="5806814">.</span><span class="ident" id="5806815">method</span><span class="op" id="5806821">[</span><span class="ident" id="5806822"><a href="/net/rpc/server.go.html#5806550">methodName</a></span><span class="op" id="5806832">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5806835">if</span>&nbsp;<span class="ident" id="5806838"><a href="/net/rpc/server.go.html#5805874">mtype</a></span>&nbsp;<span class="op" id="5806844">==</span>&nbsp;<span class="ident" id="5806847">nil</span>&nbsp;<span class="op" id="5806851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5806855"><a href="/net/rpc/server.go.html#5805925">err</a></span>&nbsp;<span class="op" id="5806859">=</span>&nbsp;<span class="ident" id="5806861"><a href="/net/rpc/server.go.html#5793245">errors</a></span><span class="op" id="5806867">.</span><span class="ident" id="5806868">New</span><span class="op" id="5806871">(</span><span class="string" id="5806872">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span>&nbsp;<span class="op" id="5806898">+</span>&nbsp;<span class="ident" id="5806900"><a href="/net/rpc/server.go.html#5805893">req</a></span><span class="op" id="5806903">.</span><span class="ident" id="5806904">ServiceMethod</span><span class="op" id="5806917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5806920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5806923">return</span><br>
<span class="lineno">610</span><span class="op" id="5806930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5806933">//&nbsp;Accept&nbsp;accepts&nbsp;connections&nbsp;on&nbsp;the&nbsp;listener&nbsp;and&nbsp;serves&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="5806999">//&nbsp;for&nbsp;each&nbsp;incoming&nbsp;connection.&nbsp;&nbsp;Accept&nbsp;blocks;&nbsp;the&nbsp;caller&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="5807069">//&nbsp;invokes&nbsp;it&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno">615</span><span class="keyword" id="5807102">func</span>&nbsp;<span class="op" id="5807107">(</span><span class="ident" id="5807108">server</span>&nbsp;<span class="op" id="5807115">*</span><span class="ident" id="5807116"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5807122">)</span>&nbsp;<span class="ident" id="5807124">Accept</span><span class="op" id="5807130">(</span><span class="ident" id="5807131">lis</span>&nbsp;<span class="ident" id="5807135"><a href="/net/rpc/server.go.html#5793268">net</a></span><span class="op" id="5807138">.</span><span class="ident" id="5807139">Listener</span><span class="op" id="5807147">)</span>&nbsp;<span class="op" id="5807149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5807152">for</span>&nbsp;<span class="op" id="5807156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807160">conn</span><span class="op" id="5807164">,</span>&nbsp;<span class="ident" id="5807166">err</span>&nbsp;<span class="op" id="5807170">:=</span>&nbsp;<span class="ident" id="5807173"><a href="/net/rpc/server.go.html#5807131">lis</a></span><span class="op" id="5807176">.</span><span class="ident" id="5807177">Accept</span><span class="op" id="5807183">(</span><span class="op" id="5807184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5807188">if</span>&nbsp;<span class="ident" id="5807191"><a href="/net/rpc/server.go.html#5807166">err</a></span>&nbsp;<span class="op" id="5807195">!=</span>&nbsp;<span class="ident" id="5807198">nil</span>&nbsp;<span class="op" id="5807202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5807207"><a href="/net/rpc/server.go.html#5793261">log</a></span><span class="op" id="5807210">.</span><span class="ident" id="5807211">Fatal</span><span class="op" id="5807216">(</span><span class="string" id="5807217">&#34;rpc.Serve:&nbsp;accept:&#34;</span><span class="op" id="5807237">,</span>&nbsp;<span class="ident" id="5807239"><a href="/net/rpc/server.go.html#5807166">err</a></span><span class="op" id="5807242">.</span><span class="ident" id="5807243">Error</span><span class="op" id="5807248">(</span><span class="op" id="5807249">)</span><span class="op" id="5807250">)</span>&nbsp;<span class="comment" id="5807252">//&nbsp;TODO(r):&nbsp;exit?</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5807272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5807276">go</span>&nbsp;<span class="ident" id="5807279"><a href="/net/rpc/server.go.html#5807108">server</a></span><span class="op" id="5807285">.</span><span class="ident" id="5807286">ServeConn</span><span class="op" id="5807295">(</span><span class="ident" id="5807296"><a href="/net/rpc/server.go.html#5807160">conn</a></span><span class="op" id="5807300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5807303">}</span><br>
<span class="lineno"></span><span class="op" id="5807305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="5807308">//&nbsp;Register&nbsp;publishes&nbsp;the&nbsp;receiver&#39;s&nbsp;methods&nbsp;in&nbsp;the&nbsp;DefaultServer.</span><br>
<span class="lineno"></span><span class="keyword" id="5807375">func</span>&nbsp;<span class="ident" id="5807380">Register</span><span class="op" id="5807388">(</span><span class="ident" id="5807389">rcvr</span>&nbsp;<span class="keyword" id="5807394">interface</span><span class="op" id="5807403">{</span><span class="op" id="5807404">}</span><span class="op" id="5807405">)</span>&nbsp;<span class="builtintype" id="5807407">error</span>&nbsp;<span class="op" id="5807413">{</span>&nbsp;<span class="keyword" id="5807415">return</span>&nbsp;<span class="ident" id="5807422"><a href="/net/rpc/server.go.html#5795261">DefaultServer</a></span><span class="op" id="5807435">.</span><span class="ident" id="5807436">Register</span><span class="op" id="5807444">(</span><span class="ident" id="5807445"><a href="/net/rpc/server.go.html#5807389">rcvr</a></span><span class="op" id="5807449">)</span>&nbsp;<span class="op" id="5807451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5807454">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5807527">//&nbsp;instead&nbsp;of&nbsp;the&nbsp;receiver&#39;s&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">630</span><span class="keyword" id="5807571">func</span>&nbsp;<span class="ident" id="5807576">RegisterName</span><span class="op" id="5807588">(</span><span class="ident" id="5807589">name</span>&nbsp;<span class="builtintype" id="5807594">string</span><span class="op" id="5807600">,</span>&nbsp;<span class="ident" id="5807602">rcvr</span>&nbsp;<span class="keyword" id="5807607">interface</span><span class="op" id="5807616">{</span><span class="op" id="5807617">}</span><span class="op" id="5807618">)</span>&nbsp;<span class="builtintype" id="5807620">error</span>&nbsp;<span class="op" id="5807626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5807629">return</span>&nbsp;<span class="ident" id="5807636"><a href="/net/rpc/server.go.html#5795261">DefaultServer</a></span><span class="op" id="5807649">.</span><span class="ident" id="5807650">RegisterName</span><span class="op" id="5807662">(</span><span class="ident" id="5807663"><a href="/net/rpc/server.go.html#5807589">name</a></span><span class="op" id="5807667">,</span>&nbsp;<span class="ident" id="5807669"><a href="/net/rpc/server.go.html#5807602">rcvr</a></span><span class="op" id="5807673">)</span><br>
<span class="lineno"></span><span class="op" id="5807675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5807678">//&nbsp;A&nbsp;ServerCodec&nbsp;implements&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and&nbsp;writing&nbsp;of</span><br>
<span class="lineno">635</span><span class="comment" id="5807745">//&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;server&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="5807801">//&nbsp;The&nbsp;server&nbsp;calls&nbsp;ReadRequestHeader&nbsp;and&nbsp;ReadRequestBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5807868">//&nbsp;to&nbsp;read&nbsp;requests&nbsp;from&nbsp;the&nbsp;connection,&nbsp;and&nbsp;it&nbsp;calls&nbsp;WriteResponse&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5807939">//&nbsp;write&nbsp;a&nbsp;response&nbsp;back.&nbsp;&nbsp;The&nbsp;server&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5808012">//&nbsp;connection.&nbsp;ReadRequestBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">640</span><span class="comment" id="5808068">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;request&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5808139">type</span>&nbsp;<span class="ident" id="5808144">ServerCodec</span>&nbsp;<span class="keyword" id="5808156">interface</span>&nbsp;<span class="op" id="5808166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808169">ReadRequestHeader</span><span class="op" id="5808186">(</span><span class="op" id="5808187">*</span><span class="ident" id="5808188"><a href="/net/rpc/server.go.html#5794226">Request</a></span><span class="op" id="5808195">)</span>&nbsp;<span class="builtintype" id="5808197">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808204">ReadRequestBody</span><span class="op" id="5808219">(</span><span class="keyword" id="5808220">interface</span><span class="op" id="5808229">{</span><span class="op" id="5808230">}</span><span class="op" id="5808231">)</span>&nbsp;<span class="builtintype" id="5808233">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5808240">//&nbsp;WriteResponse&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808314">WriteResponse</span><span class="op" id="5808327">(</span><span class="op" id="5808328">*</span><span class="ident" id="5808329"><a href="/net/rpc/server.go.html#5794584">Response</a></span><span class="op" id="5808337">,</span>&nbsp;<span class="keyword" id="5808339">interface</span><span class="op" id="5808348">{</span><span class="op" id="5808349">}</span><span class="op" id="5808350">)</span>&nbsp;<span class="builtintype" id="5808352">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808360">Close</span><span class="op" id="5808365">(</span><span class="op" id="5808366">)</span>&nbsp;<span class="builtintype" id="5808368">error</span><br>
<span class="lineno"></span><span class="op" id="5808374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="comment" id="5808377">//&nbsp;ServeConn&nbsp;runs&nbsp;the&nbsp;DefaultServer&nbsp;on&nbsp;a&nbsp;single&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5808437">//&nbsp;ServeConn&nbsp;blocks,&nbsp;serving&nbsp;the&nbsp;connection&nbsp;until&nbsp;the&nbsp;client&nbsp;hangs&nbsp;up.</span><br>
<span class="lineno"></span><span class="comment" id="5808508">//&nbsp;The&nbsp;caller&nbsp;typically&nbsp;invokes&nbsp;ServeConn&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5808569">//&nbsp;ServeConn&nbsp;uses&nbsp;the&nbsp;gob&nbsp;wire&nbsp;format&nbsp;(see&nbsp;package&nbsp;gob)&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5808632">//&nbsp;connection.&nbsp;&nbsp;To&nbsp;use&nbsp;an&nbsp;alternate&nbsp;codec,&nbsp;use&nbsp;ServeCodec.</span><br>
<span class="lineno">655</span><span class="keyword" id="5808691">func</span>&nbsp;<span class="ident" id="5808696">ServeConn</span><span class="op" id="5808705">(</span><span class="ident" id="5808706">conn</span>&nbsp;<span class="ident" id="5808711"><a href="/net/rpc/server.go.html#5793255">io</a></span><span class="op" id="5808713">.</span><span class="ident" id="5808714">ReadWriteCloser</span><span class="op" id="5808729">)</span>&nbsp;<span class="op" id="5808731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808734"><a href="/net/rpc/server.go.html#5795261">DefaultServer</a></span><span class="op" id="5808747">.</span><span class="ident" id="5808748">ServeConn</span><span class="op" id="5808757">(</span><span class="ident" id="5808758"><a href="/net/rpc/server.go.html#5808706">conn</a></span><span class="op" id="5808762">)</span><br>
<span class="lineno"></span><span class="op" id="5808764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5808767">//&nbsp;ServeCodec&nbsp;is&nbsp;like&nbsp;ServeConn&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified&nbsp;codec&nbsp;to</span><br>
<span class="lineno">660</span><span class="comment" id="5808831">//&nbsp;decode&nbsp;requests&nbsp;and&nbsp;encode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="5808872">func</span>&nbsp;<span class="ident" id="5808877">ServeCodec</span><span class="op" id="5808887">(</span><span class="ident" id="5808888">codec</span>&nbsp;<span class="ident" id="5808894"><a href="/net/rpc/server.go.html#5808144">ServerCodec</a></span><span class="op" id="5808905">)</span>&nbsp;<span class="op" id="5808907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5808910"><a href="/net/rpc/server.go.html#5795261">DefaultServer</a></span><span class="op" id="5808923">.</span><span class="ident" id="5808924">ServeCodec</span><span class="op" id="5808934">(</span><span class="ident" id="5808935"><a href="/net/rpc/server.go.html#5808888">codec</a></span><span class="op" id="5808940">)</span><br>
<span class="lineno"></span><span class="op" id="5808942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">665</span><span class="comment" id="5808945">//&nbsp;ServeRequest&nbsp;is&nbsp;like&nbsp;ServeCodec&nbsp;but&nbsp;synchronously&nbsp;serves&nbsp;a&nbsp;single&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="5809023">//&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;codec&nbsp;upon&nbsp;completion.</span><br>
<span class="lineno"></span><span class="keyword" id="5809071">func</span>&nbsp;<span class="ident" id="5809076">ServeRequest</span><span class="op" id="5809088">(</span><span class="ident" id="5809089">codec</span>&nbsp;<span class="ident" id="5809095"><a href="/net/rpc/server.go.html#5808144">ServerCodec</a></span><span class="op" id="5809106">)</span>&nbsp;<span class="builtintype" id="5809108">error</span>&nbsp;<span class="op" id="5809114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809117">return</span>&nbsp;<span class="ident" id="5809124"><a href="/net/rpc/server.go.html#5795261">DefaultServer</a></span><span class="op" id="5809137">.</span><span class="ident" id="5809138">ServeRequest</span><span class="op" id="5809150">(</span><span class="ident" id="5809151"><a href="/net/rpc/server.go.html#5809089">codec</a></span><span class="op" id="5809156">)</span><br>
<span class="lineno"></span><span class="op" id="5809158">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="5809161">//&nbsp;Accept&nbsp;accepts&nbsp;connections&nbsp;on&nbsp;the&nbsp;listener&nbsp;and&nbsp;serves&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="5809227">//&nbsp;to&nbsp;DefaultServer&nbsp;for&nbsp;each&nbsp;incoming&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5809277">//&nbsp;Accept&nbsp;blocks;&nbsp;the&nbsp;caller&nbsp;typically&nbsp;invokes&nbsp;it&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="5809346">func</span>&nbsp;<span class="ident" id="5809351">Accept</span><span class="op" id="5809357">(</span><span class="ident" id="5809358">lis</span>&nbsp;<span class="ident" id="5809362"><a href="/net/rpc/server.go.html#5793268">net</a></span><span class="op" id="5809365">.</span><span class="ident" id="5809366">Listener</span><span class="op" id="5809374">)</span>&nbsp;<span class="op" id="5809376">{</span>&nbsp;<span class="ident" id="5809378"><a href="/net/rpc/server.go.html#5795261">DefaultServer</a></span><span class="op" id="5809391">.</span><span class="ident" id="5809392">Accept</span><span class="op" id="5809398">(</span><span class="ident" id="5809399"><a href="/net/rpc/server.go.html#5809358">lis</a></span><span class="op" id="5809402">)</span>&nbsp;<span class="op" id="5809404">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="comment" id="5809407">//&nbsp;Can&nbsp;connect&nbsp;to&nbsp;RPC&nbsp;service&nbsp;using&nbsp;HTTP&nbsp;CONNECT&nbsp;to&nbsp;rpcPath.</span><br>
<span class="lineno"></span><span class="keyword" id="5809468">var</span>&nbsp;<span class="ident" id="5809472">connected</span>&nbsp;<span class="op" id="5809482">=</span>&nbsp;<span class="string" id="5809484">&#34;200&nbsp;Connected&nbsp;to&nbsp;Go&nbsp;RPC&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5809511">//&nbsp;ServeHTTP&nbsp;implements&nbsp;an&nbsp;http.Handler&nbsp;that&nbsp;answers&nbsp;RPC&nbsp;requests.</span><br>
<span class="lineno">680</span><span class="keyword" id="5809578">func</span>&nbsp;<span class="op" id="5809583">(</span><span class="ident" id="5809584">server</span>&nbsp;<span class="op" id="5809591">*</span><span class="ident" id="5809592"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5809598">)</span>&nbsp;<span class="ident" id="5809600">ServeHTTP</span><span class="op" id="5809609">(</span><span class="ident" id="5809610">w</span>&nbsp;<span class="ident" id="5809612"><a href="/net/rpc/server.go.html#5793275">http</a></span><span class="op" id="5809616">.</span><span class="ident" id="5809617">ResponseWriter</span><span class="op" id="5809631">,</span>&nbsp;<span class="ident" id="5809633">req</span>&nbsp;<span class="op" id="5809637">*</span><span class="ident" id="5809638"><a href="/net/rpc/server.go.html#5793275">http</a></span><span class="op" id="5809642">.</span><span class="ident" id="5809643">Request</span><span class="op" id="5809650">)</span>&nbsp;<span class="op" id="5809652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809655">if</span>&nbsp;<span class="ident" id="5809658"><a href="/net/rpc/server.go.html#5809633">req</a></span><span class="op" id="5809661">.</span><span class="ident" id="5809662">Method</span>&nbsp;<span class="op" id="5809669">!=</span>&nbsp;<span class="string" id="5809672">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="5809682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809686"><a href="/net/rpc/server.go.html#5809610">w</a></span><span class="op" id="5809687">.</span><span class="ident" id="5809688">Header</span><span class="op" id="5809694">(</span><span class="op" id="5809695">)</span><span class="op" id="5809696">.</span><span class="ident" id="5809697">Set</span><span class="op" id="5809700">(</span><span class="string" id="5809701">&#34;Content-Type&#34;</span><span class="op" id="5809715">,</span>&nbsp;<span class="string" id="5809717">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5809744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809748"><a href="/net/rpc/server.go.html#5809610">w</a></span><span class="op" id="5809749">.</span><span class="ident" id="5809750">WriteHeader</span><span class="op" id="5809761">(</span><span class="ident" id="5809762"><a href="/net/rpc/server.go.html#5793275">http</a></span><span class="op" id="5809766">.</span><span class="ident" id="5809767">StatusMethodNotAllowed</span><span class="op" id="5809789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809793"><a href="/net/rpc/server.go.html#5793255">io</a></span><span class="op" id="5809795">.</span><span class="ident" id="5809796">WriteString</span><span class="op" id="5809807">(</span><span class="ident" id="5809808"><a href="/net/rpc/server.go.html#5809610">w</a></span><span class="op" id="5809809">,</span>&nbsp;<span class="string" id="5809811">&#34;405&nbsp;must&nbsp;CONNECT\n&#34;</span><span class="op" id="5809831">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809835">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809846">conn</span><span class="op" id="5809850">,</span>&nbsp;<span class="ident" id="5809852">_</span><span class="op" id="5809853">,</span>&nbsp;<span class="ident" id="5809855">err</span>&nbsp;<span class="op" id="5809859">:=</span>&nbsp;<span class="ident" id="5809862"><a href="/net/rpc/server.go.html#5809610">w</a></span><span class="op" id="5809863">.</span><span class="op" id="5809864">(</span><span class="ident" id="5809865"><a href="/net/rpc/server.go.html#5793275">http</a></span><span class="op" id="5809869">.</span><span class="ident" id="5809870">Hijacker</span><span class="op" id="5809878">)</span><span class="op" id="5809879">.</span><span class="ident" id="5809880">Hijack</span><span class="op" id="5809886">(</span><span class="op" id="5809887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809890">if</span>&nbsp;<span class="ident" id="5809893"><a href="/net/rpc/server.go.html#5809855">err</a></span>&nbsp;<span class="op" id="5809897">!=</span>&nbsp;<span class="ident" id="5809900">nil</span>&nbsp;<span class="op" id="5809904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809908"><a href="/net/rpc/server.go.html#5793261">log</a></span><span class="op" id="5809911">.</span><span class="ident" id="5809912">Print</span><span class="op" id="5809917">(</span><span class="string" id="5809918">&#34;rpc&nbsp;hijacking&nbsp;&#34;</span><span class="op" id="5809934">,</span>&nbsp;<span class="ident" id="5809936"><a href="/net/rpc/server.go.html#5809633">req</a></span><span class="op" id="5809939">.</span><span class="ident" id="5809940">RemoteAddr</span><span class="op" id="5809950">,</span>&nbsp;<span class="string" id="5809952">&#34;:&nbsp;&#34;</span><span class="op" id="5809956">,</span>&nbsp;<span class="ident" id="5809958"><a href="/net/rpc/server.go.html#5809855">err</a></span><span class="op" id="5809961">.</span><span class="ident" id="5809962">Error</span><span class="op" id="5809967">(</span><span class="op" id="5809968">)</span><span class="op" id="5809969">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5809973">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5809981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5809984"><a href="/net/rpc/server.go.html#5793255">io</a></span><span class="op" id="5809986">.</span><span class="ident" id="5809987">WriteString</span><span class="op" id="5809998">(</span><span class="ident" id="5809999"><a href="/net/rpc/server.go.html#5809846">conn</a></span><span class="op" id="5810003">,</span>&nbsp;<span class="string" id="5810005">&#34;HTTP/1.0&nbsp;&#34;</span><span class="op" id="5810016">+</span><span class="ident" id="5810017"><a href="/net/rpc/server.go.html#5809472">connected</a></span><span class="op" id="5810026">+</span><span class="string" id="5810027">&#34;\n\n&#34;</span><span class="op" id="5810033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810036"><a href="/net/rpc/server.go.html#5809584">server</a></span><span class="op" id="5810042">.</span><span class="ident" id="5810043">ServeConn</span><span class="op" id="5810052">(</span><span class="ident" id="5810053"><a href="/net/rpc/server.go.html#5809846">conn</a></span><span class="op" id="5810057">)</span><br>
<span class="lineno"></span><span class="op" id="5810059">}</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span><span class="comment" id="5810062">//&nbsp;HandleHTTP&nbsp;registers&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;for&nbsp;RPC&nbsp;messages&nbsp;on&nbsp;rpcPath,</span><br>
<span class="lineno"></span><span class="comment" id="5810131">//&nbsp;and&nbsp;a&nbsp;debugging&nbsp;handler&nbsp;on&nbsp;debugPath.</span><br>
<span class="lineno"></span><span class="comment" id="5810172">//&nbsp;It&nbsp;is&nbsp;still&nbsp;necessary&nbsp;to&nbsp;invoke&nbsp;http.Serve(),&nbsp;typically&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="5810250">func</span>&nbsp;<span class="op" id="5810255">(</span><span class="ident" id="5810256">server</span>&nbsp;<span class="op" id="5810263">*</span><span class="ident" id="5810264"><a href="/net/rpc/server.go.html#5794851">Server</a></span><span class="op" id="5810270">)</span>&nbsp;<span class="ident" id="5810272">HandleHTTP</span><span class="op" id="5810282">(</span><span class="ident" id="5810283">rpcPath</span><span class="op" id="5810290">,</span>&nbsp;<span class="ident" id="5810292">debugPath</span>&nbsp;<span class="builtintype" id="5810302">string</span><span class="op" id="5810308">)</span>&nbsp;<span class="op" id="5810310">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810313"><a href="/net/rpc/server.go.html#5793275">http</a></span><span class="op" id="5810317">.</span><span class="ident" id="5810318">Handle</span><span class="op" id="5810324">(</span><span class="ident" id="5810325"><a href="/net/rpc/server.go.html#5810283">rpcPath</a></span><span class="op" id="5810332">,</span>&nbsp;<span class="ident" id="5810334"><a href="/net/rpc/server.go.html#5810256">server</a></span><span class="op" id="5810340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810343"><a href="/net/rpc/server.go.html#5793275">http</a></span><span class="op" id="5810347">.</span><span class="ident" id="5810348">Handle</span><span class="op" id="5810354">(</span><span class="ident" id="5810355"><a href="/net/rpc/server.go.html#5810292">debugPath</a></span><span class="op" id="5810364">,</span>&nbsp;<span class="ident" id="5810366"><a href="/net/rpc/debug.go.html#5788493">debugHTTP</a></span><span class="op" id="5810375">{</span><span class="ident" id="5810376"><a href="/net/rpc/server.go.html#5810256">server</a></span><span class="op" id="5810382">}</span><span class="op" id="5810383">)</span><br>
<span class="lineno"></span><span class="op" id="5810385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5810388">//&nbsp;HandleHTTP&nbsp;registers&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;for&nbsp;RPC&nbsp;messages&nbsp;to&nbsp;DefaultServer</span><br>
<span class="lineno">705</span><span class="comment" id="5810462">//&nbsp;on&nbsp;DefaultRPCPath&nbsp;and&nbsp;a&nbsp;debugging&nbsp;handler&nbsp;on&nbsp;DefaultDebugPath.</span><br>
<span class="lineno"></span><span class="comment" id="5810528">//&nbsp;It&nbsp;is&nbsp;still&nbsp;necessary&nbsp;to&nbsp;invoke&nbsp;http.Serve(),&nbsp;typically&nbsp;in&nbsp;a&nbsp;go&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="5810606">func</span>&nbsp;<span class="ident" id="5810611">HandleHTTP</span><span class="op" id="5810621">(</span><span class="op" id="5810622">)</span>&nbsp;<span class="op" id="5810624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5810627"><a href="/net/rpc/server.go.html#5795261">DefaultServer</a></span><span class="op" id="5810640">.</span><span class="ident" id="5810641">HandleHTTP</span><span class="op" id="5810651">(</span><span class="ident" id="5810652"><a href="/net/rpc/server.go.html#5793387">DefaultRPCPath</a></span><span class="op" id="5810666">,</span>&nbsp;<span class="ident" id="5810668"><a href="/net/rpc/server.go.html#5793418">DefaultDebugPath</a></span><span class="op" id="5810684">)</span><br>
<span class="lineno"></span><span class="op" id="5810686">}</span>
</div>
</body>
</html>
