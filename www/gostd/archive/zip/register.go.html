<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2896742">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2896797">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2896851">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2896902">package</span>&nbsp;<span class="ident" id="2896910">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2896915">import</span>&nbsp;<span class="op" id="2896922">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2896925">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2896943">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2896953">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2896959">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2896972">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="2896979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2896982">//&nbsp;A&nbsp;Compressor&nbsp;returns&nbsp;a&nbsp;compressing&nbsp;writer,&nbsp;writing&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2897043">//&nbsp;provided&nbsp;writer.&nbsp;On&nbsp;Close,&nbsp;any&nbsp;pending&nbsp;data&nbsp;should&nbsp;be&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="2897109">type</span>&nbsp;<span class="ident" id="2897114">Compressor</span>&nbsp;<span class="keyword" id="2897125">func</span><span class="op" id="2897129">(</span><span class="ident" id="2897130">io</span><span class="op" id="2897132">.</span><span class="ident" id="2897133">Writer</span><span class="op" id="2897139">)</span>&nbsp;<span class="op" id="2897141">(</span><span class="ident" id="2897142">io</span><span class="op" id="2897144">.</span><span class="ident" id="2897145">WriteCloser</span><span class="op" id="2897156">,</span>&nbsp;<span class="builtintype" id="2897158">error</span><span class="op" id="2897163">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2897166">//&nbsp;Decompressor&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;with&nbsp;a&nbsp;decompressing&nbsp;Reader.</span><br>
<span class="lineno">20</span><span class="comment" id="2897245">//&nbsp;The&nbsp;decompressed&nbsp;ReadCloser&nbsp;is&nbsp;returned&nbsp;to&nbsp;callers&nbsp;who&nbsp;open&nbsp;files&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="2897319">//&nbsp;within&nbsp;the&nbsp;archive.&nbsp;&nbsp;These&nbsp;callers&nbsp;are&nbsp;responsible&nbsp;for&nbsp;closing&nbsp;this&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="2897397">//&nbsp;when&nbsp;they&#39;re&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="keyword" id="2897431">type</span>&nbsp;<span class="ident" id="2897436">Decompressor</span>&nbsp;<span class="keyword" id="2897449">func</span><span class="op" id="2897453">(</span><span class="ident" id="2897454">io</span><span class="op" id="2897456">.</span><span class="ident" id="2897457">Reader</span><span class="op" id="2897463">)</span>&nbsp;<span class="ident" id="2897465">io</span><span class="op" id="2897467">.</span><span class="ident" id="2897468">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="2897480">var</span>&nbsp;<span class="ident" id="2897484">flateWriterPool</span>&nbsp;<span class="ident" id="2897500">sync</span><span class="op" id="2897504">.</span><span class="ident" id="2897505">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2897511">func</span>&nbsp;<span class="ident" id="2897516">newFlateWriter</span><span class="op" id="2897530">(</span><span class="ident" id="2897531">w</span>&nbsp;<span class="ident" id="2897533">io</span><span class="op" id="2897535">.</span><span class="ident" id="2897536">Writer</span><span class="op" id="2897542">)</span>&nbsp;<span class="ident" id="2897544">io</span><span class="op" id="2897546">.</span><span class="ident" id="2897547">WriteCloser</span>&nbsp;<span class="op" id="2897559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897562">fw</span><span class="op" id="2897564">,</span>&nbsp;<span class="ident" id="2897566">ok</span>&nbsp;<span class="op" id="2897569">:=</span>&nbsp;<span class="ident" id="2897572">flateWriterPool</span><span class="op" id="2897587">.</span><span class="ident" id="2897588">Get</span><span class="op" id="2897591">(</span><span class="op" id="2897592">)</span><span class="op" id="2897593">.</span><span class="op" id="2897594">(</span><span class="op" id="2897595">*</span><span class="ident" id="2897596">flate</span><span class="op" id="2897601">.</span><span class="ident" id="2897602">Writer</span><span class="op" id="2897608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897611">if</span>&nbsp;<span class="ident" id="2897614">ok</span>&nbsp;<span class="op" id="2897617">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897621">fw</span><span class="op" id="2897623">.</span><span class="ident" id="2897624">Reset</span><span class="op" id="2897629">(</span><span class="ident" id="2897630">w</span><span class="op" id="2897631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2897634">}</span>&nbsp;<span class="keyword" id="2897636">else</span>&nbsp;<span class="op" id="2897641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897645">fw</span><span class="op" id="2897647">,</span>&nbsp;<span class="ident" id="2897649">_</span>&nbsp;<span class="op" id="2897651">=</span>&nbsp;<span class="ident" id="2897653">flate</span><span class="op" id="2897658">.</span><span class="ident" id="2897659">NewWriter</span><span class="op" id="2897668">(</span><span class="ident" id="2897669">w</span><span class="op" id="2897670">,</span>&nbsp;<span class="num" id="2897672">5</span><span class="op" id="2897673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2897676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897679">return</span>&nbsp;<span class="op" id="2897686">&amp;</span><span class="ident" id="2897687">pooledFlateWriter</span><span class="op" id="2897704">{</span><span class="ident" id="2897705">fw</span><span class="op" id="2897707">:</span>&nbsp;<span class="ident" id="2897709">fw</span><span class="op" id="2897711">}</span><br>
<span class="lineno">35</span><span class="op" id="2897713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2897716">type</span>&nbsp;<span class="ident" id="2897721">pooledFlateWriter</span>&nbsp;<span class="keyword" id="2897739">struct</span>&nbsp;<span class="op" id="2897746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897749">mu</span>&nbsp;<span class="ident" id="2897752">sync</span><span class="op" id="2897756">.</span><span class="ident" id="2897757">Mutex</span>&nbsp;<span class="comment" id="2897763">//&nbsp;guards&nbsp;Close&nbsp;and&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897790">fw</span>&nbsp;<span class="op" id="2897793">*</span><span class="ident" id="2897794">flate</span><span class="op" id="2897799">.</span><span class="ident" id="2897800">Writer</span><br>
<span class="lineno">40</span><span class="op" id="2897807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2897810">func</span>&nbsp;<span class="op" id="2897815">(</span><span class="ident" id="2897816">w</span>&nbsp;<span class="op" id="2897818">*</span><span class="ident" id="2897819">pooledFlateWriter</span><span class="op" id="2897836">)</span>&nbsp;<span class="ident" id="2897838">Write</span><span class="op" id="2897843">(</span><span class="ident" id="2897844">p</span>&nbsp;<span class="op" id="2897846">[</span><span class="op" id="2897847">]</span><span class="builtintype" id="2897848">byte</span><span class="op" id="2897852">)</span>&nbsp;<span class="op" id="2897854">(</span><span class="ident" id="2897855">n</span>&nbsp;<span class="builtintype" id="2897857">int</span><span class="op" id="2897860">,</span>&nbsp;<span class="ident" id="2897862">err</span>&nbsp;<span class="builtintype" id="2897866">error</span><span class="op" id="2897871">)</span>&nbsp;<span class="op" id="2897873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897876">w</span><span class="op" id="2897877">.</span><span class="ident" id="2897878">mu</span><span class="op" id="2897880">.</span><span class="ident" id="2897881">Lock</span><span class="op" id="2897885">(</span><span class="op" id="2897886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897889">defer</span>&nbsp;<span class="ident" id="2897895">w</span><span class="op" id="2897896">.</span><span class="ident" id="2897897">mu</span><span class="op" id="2897899">.</span><span class="ident" id="2897900">Unlock</span><span class="op" id="2897906">(</span><span class="op" id="2897907">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897910">if</span>&nbsp;<span class="ident" id="2897913">w</span><span class="op" id="2897914">.</span><span class="ident" id="2897915">fw</span>&nbsp;<span class="op" id="2897918">==</span>&nbsp;<span class="ident" id="2897921">nil</span>&nbsp;<span class="op" id="2897925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897929">return</span>&nbsp;<span class="num" id="2897936">0</span><span class="op" id="2897937">,</span>&nbsp;<span class="ident" id="2897939">errors</span><span class="op" id="2897945">.</span><span class="ident" id="2897946">New</span><span class="op" id="2897949">(</span><span class="string" id="2897950">&#34;Write&nbsp;after&nbsp;Close&#34;</span><span class="op" id="2897969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2897972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897975">return</span>&nbsp;<span class="ident" id="2897982">w</span><span class="op" id="2897983">.</span><span class="ident" id="2897984">fw</span><span class="op" id="2897986">.</span><span class="ident" id="2897987">Write</span><span class="op" id="2897992">(</span><span class="ident" id="2897993">p</span><span class="op" id="2897994">)</span><br>
<span class="lineno"></span><span class="op" id="2897996">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="2897999">func</span>&nbsp;<span class="op" id="2898004">(</span><span class="ident" id="2898005">w</span>&nbsp;<span class="op" id="2898007">*</span><span class="ident" id="2898008">pooledFlateWriter</span><span class="op" id="2898025">)</span>&nbsp;<span class="ident" id="2898027">Close</span><span class="op" id="2898032">(</span><span class="op" id="2898033">)</span>&nbsp;<span class="builtintype" id="2898035">error</span>&nbsp;<span class="op" id="2898041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2898044">w</span><span class="op" id="2898045">.</span><span class="ident" id="2898046">mu</span><span class="op" id="2898048">.</span><span class="ident" id="2898049">Lock</span><span class="op" id="2898053">(</span><span class="op" id="2898054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898057">defer</span>&nbsp;<span class="ident" id="2898063">w</span><span class="op" id="2898064">.</span><span class="ident" id="2898065">mu</span><span class="op" id="2898067">.</span><span class="ident" id="2898068">Unlock</span><span class="op" id="2898074">(</span><span class="op" id="2898075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898078">var</span>&nbsp;<span class="ident" id="2898082">err</span>&nbsp;<span class="builtintype" id="2898086">error</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898093">if</span>&nbsp;<span class="ident" id="2898096">w</span><span class="op" id="2898097">.</span><span class="ident" id="2898098">fw</span>&nbsp;<span class="op" id="2898101">!=</span>&nbsp;<span class="ident" id="2898104">nil</span>&nbsp;<span class="op" id="2898108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2898112">err</span>&nbsp;<span class="op" id="2898116">=</span>&nbsp;<span class="ident" id="2898118">w</span><span class="op" id="2898119">.</span><span class="ident" id="2898120">fw</span><span class="op" id="2898122">.</span><span class="ident" id="2898123">Close</span><span class="op" id="2898128">(</span><span class="op" id="2898129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2898133">flateWriterPool</span><span class="op" id="2898148">.</span><span class="ident" id="2898149">Put</span><span class="op" id="2898152">(</span><span class="ident" id="2898153">w</span><span class="op" id="2898154">.</span><span class="ident" id="2898155">fw</span><span class="op" id="2898157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2898161">w</span><span class="op" id="2898162">.</span><span class="ident" id="2898163">fw</span>&nbsp;<span class="op" id="2898166">=</span>&nbsp;<span class="ident" id="2898168">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2898173">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898176">return</span>&nbsp;<span class="ident" id="2898183">err</span><br>
<span class="lineno"></span><span class="op" id="2898187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2898190">var</span>&nbsp;<span class="op" id="2898194">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2898197">mu</span>&nbsp;<span class="ident" id="2898200">sync</span><span class="op" id="2898204">.</span><span class="ident" id="2898205">RWMutex</span>&nbsp;<span class="comment" id="2898213">//&nbsp;guards&nbsp;compressor&nbsp;and&nbsp;decompressor&nbsp;maps</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2898258">compressors</span>&nbsp;<span class="op" id="2898270">=</span>&nbsp;<span class="keyword" id="2898272">map</span><span class="op" id="2898275">[</span><span class="builtintype" id="2898276">uint16</span><span class="op" id="2898282">]</span><span class="ident" id="2898283">Compressor</span><span class="op" id="2898293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2898297">Store</span><span class="op" id="2898302">:</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="2898306">func</span><span class="op" id="2898310">(</span><span class="ident" id="2898311">w</span>&nbsp;<span class="ident" id="2898313">io</span><span class="op" id="2898315">.</span><span class="ident" id="2898316">Writer</span><span class="op" id="2898322">)</span>&nbsp;<span class="op" id="2898324">(</span><span class="ident" id="2898325">io</span><span class="op" id="2898327">.</span><span class="ident" id="2898328">WriteCloser</span><span class="op" id="2898339">,</span>&nbsp;<span class="builtintype" id="2898341">error</span><span class="op" id="2898346">)</span>&nbsp;<span class="op" id="2898348">{</span>&nbsp;<span class="keyword" id="2898350">return</span>&nbsp;<span class="op" id="2898357">&amp;</span><span class="ident" id="2898358">nopCloser</span><span class="op" id="2898367">{</span><span class="ident" id="2898368">w</span><span class="op" id="2898369">}</span><span class="op" id="2898370">,</span>&nbsp;<span class="ident" id="2898372">nil</span>&nbsp;<span class="op" id="2898376">}</span><span class="op" id="2898377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2898381">Deflate</span><span class="op" id="2898388">:</span>&nbsp;<span class="keyword" id="2898390">func</span><span class="op" id="2898394">(</span><span class="ident" id="2898395">w</span>&nbsp;<span class="ident" id="2898397">io</span><span class="op" id="2898399">.</span><span class="ident" id="2898400">Writer</span><span class="op" id="2898406">)</span>&nbsp;<span class="op" id="2898408">(</span><span class="ident" id="2898409">io</span><span class="op" id="2898411">.</span><span class="ident" id="2898412">WriteCloser</span><span class="op" id="2898423">,</span>&nbsp;<span class="builtintype" id="2898425">error</span><span class="op" id="2898430">)</span>&nbsp;<span class="op" id="2898432">{</span>&nbsp;<span class="keyword" id="2898434">return</span>&nbsp;<span class="ident" id="2898441">newFlateWriter</span><span class="op" id="2898455">(</span><span class="ident" id="2898456">w</span><span class="op" id="2898457">)</span><span class="op" id="2898458">,</span>&nbsp;<span class="ident" id="2898460">nil</span>&nbsp;<span class="op" id="2898464">}</span><span class="op" id="2898465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2898468">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2898472">decompressors</span>&nbsp;<span class="op" id="2898486">=</span>&nbsp;<span class="keyword" id="2898488">map</span><span class="op" id="2898491">[</span><span class="builtintype" id="2898492">uint16</span><span class="op" id="2898498">]</span><span class="ident" id="2898499">Decompressor</span><span class="op" id="2898511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2898515">Store</span><span class="op" id="2898520">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2898524">ioutil</span><span class="op" id="2898530">.</span><span class="ident" id="2898531">NopCloser</span><span class="op" id="2898540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2898544">Deflate</span><span class="op" id="2898551">:</span>&nbsp;<span class="ident" id="2898553">flate</span><span class="op" id="2898558">.</span><span class="ident" id="2898559">NewReader</span><span class="op" id="2898568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2898571">}</span><br>
<span class="lineno">75</span><span class="op" id="2898573">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2898576">//&nbsp;RegisterDecompressor&nbsp;allows&nbsp;custom&nbsp;decompressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="keyword" id="2898655">func</span>&nbsp;<span class="ident" id="2898660">RegisterDecompressor</span><span class="op" id="2898680">(</span><span class="ident" id="2898681">method</span>&nbsp;<span class="builtintype" id="2898688">uint16</span><span class="op" id="2898694">,</span>&nbsp;<span class="ident" id="2898696">d</span>&nbsp;<span class="ident" id="2898698">Decompressor</span><span class="op" id="2898710">)</span>&nbsp;<span class="op" id="2898712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2898715">mu</span><span class="op" id="2898717">.</span><span class="ident" id="2898718">Lock</span><span class="op" id="2898722">(</span><span class="op" id="2898723">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898726">defer</span>&nbsp;<span class="ident" id="2898732">mu</span><span class="op" id="2898734">.</span><span class="ident" id="2898735">Unlock</span><span class="op" id="2898741">(</span><span class="op" id="2898742">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898746">if</span>&nbsp;<span class="ident" id="2898749">_</span><span class="op" id="2898750">,</span>&nbsp;<span class="ident" id="2898752">ok</span>&nbsp;<span class="op" id="2898755">:=</span>&nbsp;<span class="ident" id="2898758">decompressors</span><span class="op" id="2898771">[</span><span class="ident" id="2898772">method</span><span class="op" id="2898778">]</span><span class="op" id="2898779">;</span>&nbsp;<span class="ident" id="2898781">ok</span>&nbsp;<span class="op" id="2898784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2898788">panic</span><span class="op" id="2898793">(</span><span class="string" id="2898794">&#34;decompressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="2898827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2898830">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2898833">decompressors</span><span class="op" id="2898846">[</span><span class="ident" id="2898847">method</span><span class="op" id="2898853">]</span>&nbsp;<span class="op" id="2898855">=</span>&nbsp;<span class="ident" id="2898857">d</span><br>
<span class="lineno"></span><span class="op" id="2898859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2898862">//&nbsp;RegisterCompressor&nbsp;registers&nbsp;custom&nbsp;compressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="comment" id="2898940">//&nbsp;The&nbsp;common&nbsp;methods&nbsp;Store&nbsp;and&nbsp;Deflate&nbsp;are&nbsp;built&nbsp;in.</span><br>
<span class="lineno">90</span><span class="keyword" id="2898994">func</span>&nbsp;<span class="ident" id="2898999">RegisterCompressor</span><span class="op" id="2899017">(</span><span class="ident" id="2899018">method</span>&nbsp;<span class="builtintype" id="2899025">uint16</span><span class="op" id="2899031">,</span>&nbsp;<span class="ident" id="2899033">comp</span>&nbsp;<span class="ident" id="2899038">Compressor</span><span class="op" id="2899048">)</span>&nbsp;<span class="op" id="2899050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2899053">mu</span><span class="op" id="2899055">.</span><span class="ident" id="2899056">Lock</span><span class="op" id="2899060">(</span><span class="op" id="2899061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899064">defer</span>&nbsp;<span class="ident" id="2899070">mu</span><span class="op" id="2899072">.</span><span class="ident" id="2899073">Unlock</span><span class="op" id="2899079">(</span><span class="op" id="2899080">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899084">if</span>&nbsp;<span class="ident" id="2899087">_</span><span class="op" id="2899088">,</span>&nbsp;<span class="ident" id="2899090">ok</span>&nbsp;<span class="op" id="2899093">:=</span>&nbsp;<span class="ident" id="2899096">compressors</span><span class="op" id="2899107">[</span><span class="ident" id="2899108">method</span><span class="op" id="2899114">]</span><span class="op" id="2899115">;</span>&nbsp;<span class="ident" id="2899117">ok</span>&nbsp;<span class="op" id="2899120">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2899124">panic</span><span class="op" id="2899129">(</span><span class="string" id="2899130">&#34;compressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="2899161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2899164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2899167">compressors</span><span class="op" id="2899178">[</span><span class="ident" id="2899179">method</span><span class="op" id="2899185">]</span>&nbsp;<span class="op" id="2899187">=</span>&nbsp;<span class="ident" id="2899189">comp</span><br>
<span class="lineno"></span><span class="op" id="2899194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="2899197">func</span>&nbsp;<span class="ident" id="2899202">compressor</span><span class="op" id="2899212">(</span><span class="ident" id="2899213">method</span>&nbsp;<span class="builtintype" id="2899220">uint16</span><span class="op" id="2899226">)</span>&nbsp;<span class="ident" id="2899228">Compressor</span>&nbsp;<span class="op" id="2899239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2899242">mu</span><span class="op" id="2899244">.</span><span class="ident" id="2899245">RLock</span><span class="op" id="2899250">(</span><span class="op" id="2899251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899254">defer</span>&nbsp;<span class="ident" id="2899260">mu</span><span class="op" id="2899262">.</span><span class="ident" id="2899263">RUnlock</span><span class="op" id="2899270">(</span><span class="op" id="2899271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899274">return</span>&nbsp;<span class="ident" id="2899281">compressors</span><span class="op" id="2899292">[</span><span class="ident" id="2899293">method</span><span class="op" id="2899299">]</span><br>
<span class="lineno"></span><span class="op" id="2899301">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="2899304">func</span>&nbsp;<span class="ident" id="2899309">decompressor</span><span class="op" id="2899321">(</span><span class="ident" id="2899322">method</span>&nbsp;<span class="builtintype" id="2899329">uint16</span><span class="op" id="2899335">)</span>&nbsp;<span class="ident" id="2899337">Decompressor</span>&nbsp;<span class="op" id="2899350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2899353">mu</span><span class="op" id="2899355">.</span><span class="ident" id="2899356">RLock</span><span class="op" id="2899361">(</span><span class="op" id="2899362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899365">defer</span>&nbsp;<span class="ident" id="2899371">mu</span><span class="op" id="2899373">.</span><span class="ident" id="2899374">RUnlock</span><span class="op" id="2899381">(</span><span class="op" id="2899382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899385">return</span>&nbsp;<span class="ident" id="2899392">decompressors</span><span class="op" id="2899405">[</span><span class="ident" id="2899406">method</span><span class="op" id="2899412">]</span><br>
<span class="lineno">110</span><span class="op" id="2899414">}</span>
</div>
</body>
</html>
