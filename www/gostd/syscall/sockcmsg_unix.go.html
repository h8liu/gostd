<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2526970">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2527026">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2527080">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2527131">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2527196">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2527224">package</span>&nbsp;<span class="ident" id="2527232">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2527241">import</span>&nbsp;<span class="string" id="2527248">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2527258">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;raw&nbsp;sockaddr&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2527321">func</span>&nbsp;<span class="ident" id="2527326">cmsgAlignOf</span><span class="op" id="2527337">(</span><span class="ident" id="2527338">salen</span>&nbsp;<span class="builtintype" id="2527344">int</span><span class="op" id="2527347">)</span>&nbsp;<span class="builtintype" id="2527349">int</span>&nbsp;<span class="op" id="2527353">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2527356">salign</span>&nbsp;<span class="op" id="2527363">:=</span>&nbsp;<span class="ident" id="2527366">sizeofPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2527377">//&nbsp;NOTE:&nbsp;It&nbsp;seems&nbsp;like&nbsp;64-bit&nbsp;Darwin&nbsp;and&nbsp;DragonFly&nbsp;BSD&nbsp;kernels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2527441">//&nbsp;still&nbsp;require&nbsp;32-bit&nbsp;aligned&nbsp;access&nbsp;to&nbsp;network&nbsp;subsystem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2527503">if</span>&nbsp;<span class="ident" id="2527506">darwin64Bit</span>&nbsp;<span class="op" id="2527518">||</span>&nbsp;<span class="ident" id="2527521">dragonfly64Bit</span>&nbsp;<span class="op" id="2527536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2527540">salign</span>&nbsp;<span class="op" id="2527547">=</span>&nbsp;<span class="num" id="2527549">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2527552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2527555">return</span>&nbsp;<span class="op" id="2527562">(</span><span class="ident" id="2527563">salen</span>&nbsp;<span class="op" id="2527569">+</span>&nbsp;<span class="ident" id="2527571">salign</span>&nbsp;<span class="op" id="2527578">-</span>&nbsp;<span class="num" id="2527580">1</span><span class="op" id="2527581">)</span>&nbsp;<span class="op" id="2527583">&amp;</span>&nbsp;<span class="op" id="2527585">^</span><span class="op" id="2527586">(</span><span class="ident" id="2527587">salign</span>&nbsp;<span class="op" id="2527594">-</span>&nbsp;<span class="num" id="2527596">1</span><span class="op" id="2527597">)</span><br>
<span class="lineno"></span><span class="op" id="2527599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2527602">//&nbsp;CmsgLen&nbsp;returns&nbsp;the&nbsp;value&nbsp;to&nbsp;store&nbsp;in&nbsp;the&nbsp;Len&nbsp;field&nbsp;of&nbsp;the&nbsp;Cmsghdr</span><br>
<span class="lineno">25</span><span class="comment" id="2527672">//&nbsp;structure,&nbsp;taking&nbsp;into&nbsp;account&nbsp;any&nbsp;necessary&nbsp;alignment.</span><br>
<span class="lineno"></span><span class="keyword" id="2527731">func</span>&nbsp;<span class="ident" id="2527736">CmsgLen</span><span class="op" id="2527743">(</span><span class="ident" id="2527744">datalen</span>&nbsp;<span class="builtintype" id="2527752">int</span><span class="op" id="2527755">)</span>&nbsp;<span class="builtintype" id="2527757">int</span>&nbsp;<span class="op" id="2527761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2527764">return</span>&nbsp;<span class="ident" id="2527771">cmsgAlignOf</span><span class="op" id="2527782">(</span><span class="ident" id="2527783">SizeofCmsghdr</span><span class="op" id="2527796">)</span>&nbsp;<span class="op" id="2527798">+</span>&nbsp;<span class="ident" id="2527800">datalen</span><br>
<span class="lineno"></span><span class="op" id="2527808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2527811">//&nbsp;CmsgSpace&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;an&nbsp;ancillary&nbsp;element&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2527878">//&nbsp;payload&nbsp;of&nbsp;the&nbsp;passed&nbsp;data&nbsp;length&nbsp;occupies.</span><br>
<span class="lineno"></span><span class="keyword" id="2527925">func</span>&nbsp;<span class="ident" id="2527930">CmsgSpace</span><span class="op" id="2527939">(</span><span class="ident" id="2527940">datalen</span>&nbsp;<span class="builtintype" id="2527948">int</span><span class="op" id="2527951">)</span>&nbsp;<span class="builtintype" id="2527953">int</span>&nbsp;<span class="op" id="2527957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2527960">return</span>&nbsp;<span class="ident" id="2527967">cmsgAlignOf</span><span class="op" id="2527978">(</span><span class="ident" id="2527979">SizeofCmsghdr</span><span class="op" id="2527992">)</span>&nbsp;<span class="op" id="2527994">+</span>&nbsp;<span class="ident" id="2527996">cmsgAlignOf</span><span class="op" id="2528007">(</span><span class="ident" id="2528008">datalen</span><span class="op" id="2528015">)</span><br>
<span class="lineno"></span><span class="op" id="2528017">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2528020">func</span>&nbsp;<span class="ident" id="2528025">cmsgData</span><span class="op" id="2528033">(</span><span class="ident" id="2528034">h</span>&nbsp;<span class="op" id="2528036">*</span><span class="ident" id="2528037">Cmsghdr</span><span class="op" id="2528044">)</span>&nbsp;<span class="ident" id="2528046">unsafe</span><span class="op" id="2528052">.</span><span class="ident" id="2528053">Pointer</span>&nbsp;<span class="op" id="2528061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2528064">return</span>&nbsp;<span class="ident" id="2528071">unsafe</span><span class="op" id="2528077">.</span><span class="ident" id="2528078">Pointer</span><span class="op" id="2528085">(</span><span class="builtintype" id="2528086">uintptr</span><span class="op" id="2528093">(</span><span class="ident" id="2528094">unsafe</span><span class="op" id="2528100">.</span><span class="ident" id="2528101">Pointer</span><span class="op" id="2528108">(</span><span class="ident" id="2528109">h</span><span class="op" id="2528110">)</span><span class="op" id="2528111">)</span>&nbsp;<span class="op" id="2528113">+</span>&nbsp;<span class="builtintype" id="2528115">uintptr</span><span class="op" id="2528122">(</span><span class="ident" id="2528123">cmsgAlignOf</span><span class="op" id="2528134">(</span><span class="ident" id="2528135">SizeofCmsghdr</span><span class="op" id="2528148">)</span><span class="op" id="2528149">)</span><span class="op" id="2528150">)</span><br>
<span class="lineno"></span><span class="op" id="2528152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2528155">//&nbsp;SocketControlMessage&nbsp;represents&nbsp;a&nbsp;socket&nbsp;control&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2528216">type</span>&nbsp;<span class="ident" id="2528221">SocketControlMessage</span>&nbsp;<span class="keyword" id="2528242">struct</span>&nbsp;<span class="op" id="2528249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2528252">Header</span>&nbsp;<span class="ident" id="2528259">Cmsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2528268">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2528275">[</span><span class="op" id="2528276">]</span><span class="builtintype" id="2528277">byte</span><br>
<span class="lineno"></span><span class="op" id="2528282">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2528285">//&nbsp;ParseSocketControlMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;socket&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="2528353">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="2528366">func</span>&nbsp;<span class="ident" id="2528371">ParseSocketControlMessage</span><span class="op" id="2528396">(</span><span class="ident" id="2528397">b</span>&nbsp;<span class="op" id="2528399">[</span><span class="op" id="2528400">]</span><span class="builtintype" id="2528401">byte</span><span class="op" id="2528405">)</span>&nbsp;<span class="op" id="2528407">(</span><span class="op" id="2528408">[</span><span class="op" id="2528409">]</span><span class="ident" id="2528410">SocketControlMessage</span><span class="op" id="2528430">,</span>&nbsp;<span class="builtintype" id="2528432">error</span><span class="op" id="2528437">)</span>&nbsp;<span class="op" id="2528439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2528442">var</span>&nbsp;<span class="ident" id="2528446">msgs</span>&nbsp;<span class="op" id="2528451">[</span><span class="op" id="2528452">]</span><span class="ident" id="2528453">SocketControlMessage</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2528475">i</span>&nbsp;<span class="op" id="2528477">:=</span>&nbsp;<span class="num" id="2528480">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2528483">for</span>&nbsp;<span class="ident" id="2528487">i</span><span class="op" id="2528488">+</span><span class="ident" id="2528489">CmsgLen</span><span class="op" id="2528496">(</span><span class="num" id="2528497">0</span><span class="op" id="2528498">)</span>&nbsp;<span class="op" id="2528500">&lt;=</span>&nbsp;<span class="builtinfunc" id="2528503">len</span><span class="op" id="2528506">(</span><span class="ident" id="2528507">b</span><span class="op" id="2528508">)</span>&nbsp;<span class="op" id="2528510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2528514">h</span><span class="op" id="2528515">,</span>&nbsp;<span class="ident" id="2528517">dbuf</span><span class="op" id="2528521">,</span>&nbsp;<span class="ident" id="2528523">err</span>&nbsp;<span class="op" id="2528527">:=</span>&nbsp;<span class="ident" id="2528530">socketControlMessageHeaderAndData</span><span class="op" id="2528563">(</span><span class="ident" id="2528564">b</span><span class="op" id="2528565">[</span><span class="ident" id="2528566">i</span><span class="op" id="2528567">:</span><span class="op" id="2528568">]</span><span class="op" id="2528569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2528573">if</span>&nbsp;<span class="ident" id="2528576">err</span>&nbsp;<span class="op" id="2528580">!=</span>&nbsp;<span class="ident" id="2528583">nil</span>&nbsp;<span class="op" id="2528587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2528592">return</span>&nbsp;<span class="ident" id="2528599">nil</span><span class="op" id="2528602">,</span>&nbsp;<span class="ident" id="2528604">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2528610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2528614">m</span>&nbsp;<span class="op" id="2528616">:=</span>&nbsp;<span class="ident" id="2528619">SocketControlMessage</span><span class="op" id="2528639">{</span><span class="ident" id="2528640">Header</span><span class="op" id="2528646">:</span>&nbsp;<span class="op" id="2528648">*</span><span class="ident" id="2528649">h</span><span class="op" id="2528650">,</span>&nbsp;<span class="ident" id="2528652">Data</span><span class="op" id="2528656">:</span>&nbsp;<span class="ident" id="2528658">dbuf</span><span class="op" id="2528662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2528666">msgs</span>&nbsp;<span class="op" id="2528671">=</span>&nbsp;<span class="builtinfunc" id="2528673">append</span><span class="op" id="2528679">(</span><span class="ident" id="2528680">msgs</span><span class="op" id="2528684">,</span>&nbsp;<span class="ident" id="2528686">m</span><span class="op" id="2528687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2528691">i</span>&nbsp;<span class="op" id="2528693">+=</span>&nbsp;<span class="ident" id="2528696">cmsgAlignOf</span><span class="op" id="2528707">(</span><span class="builtintype" id="2528708">int</span><span class="op" id="2528711">(</span><span class="ident" id="2528712">h</span><span class="op" id="2528713">.</span><span class="ident" id="2528714">Len</span><span class="op" id="2528717">)</span><span class="op" id="2528718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2528721">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2528724">return</span>&nbsp;<span class="ident" id="2528731">msgs</span><span class="op" id="2528735">,</span>&nbsp;<span class="ident" id="2528737">nil</span><br>
<span class="lineno"></span><span class="op" id="2528741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2528744">func</span>&nbsp;<span class="ident" id="2528749">socketControlMessageHeaderAndData</span><span class="op" id="2528782">(</span><span class="ident" id="2528783">b</span>&nbsp;<span class="op" id="2528785">[</span><span class="op" id="2528786">]</span><span class="builtintype" id="2528787">byte</span><span class="op" id="2528791">)</span>&nbsp;<span class="op" id="2528793">(</span><span class="op" id="2528794">*</span><span class="ident" id="2528795">Cmsghdr</span><span class="op" id="2528802">,</span>&nbsp;<span class="op" id="2528804">[</span><span class="op" id="2528805">]</span><span class="builtintype" id="2528806">byte</span><span class="op" id="2528810">,</span>&nbsp;<span class="builtintype" id="2528812">error</span><span class="op" id="2528817">)</span>&nbsp;<span class="op" id="2528819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2528822">h</span>&nbsp;<span class="op" id="2528824">:=</span>&nbsp;<span class="op" id="2528827">(</span><span class="op" id="2528828">*</span><span class="ident" id="2528829">Cmsghdr</span><span class="op" id="2528836">)</span><span class="op" id="2528837">(</span><span class="ident" id="2528838">unsafe</span><span class="op" id="2528844">.</span><span class="ident" id="2528845">Pointer</span><span class="op" id="2528852">(</span><span class="op" id="2528853">&amp;</span><span class="ident" id="2528854">b</span><span class="op" id="2528855">[</span><span class="num" id="2528856">0</span><span class="op" id="2528857">]</span><span class="op" id="2528858">)</span><span class="op" id="2528859">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2528862">if</span>&nbsp;<span class="ident" id="2528865">h</span><span class="op" id="2528866">.</span><span class="ident" id="2528867">Len</span>&nbsp;<span class="op" id="2528871">&lt;</span>&nbsp;<span class="ident" id="2528873">SizeofCmsghdr</span>&nbsp;<span class="op" id="2528887">||</span>&nbsp;<span class="builtintype" id="2528890">int</span><span class="op" id="2528893">(</span><span class="ident" id="2528894">h</span><span class="op" id="2528895">.</span><span class="ident" id="2528896">Len</span><span class="op" id="2528899">)</span>&nbsp;<span class="op" id="2528901">&gt;</span>&nbsp;<span class="builtinfunc" id="2528903">len</span><span class="op" id="2528906">(</span><span class="ident" id="2528907">b</span><span class="op" id="2528908">)</span>&nbsp;<span class="op" id="2528910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2528914">return</span>&nbsp;<span class="ident" id="2528921">nil</span><span class="op" id="2528924">,</span>&nbsp;<span class="ident" id="2528926">nil</span><span class="op" id="2528929">,</span>&nbsp;<span class="ident" id="2528931">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2528939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2528942">return</span>&nbsp;<span class="ident" id="2528949">h</span><span class="op" id="2528950">,</span>&nbsp;<span class="ident" id="2528952">b</span><span class="op" id="2528953">[</span><span class="ident" id="2528954">cmsgAlignOf</span><span class="op" id="2528965">(</span><span class="ident" id="2528966">SizeofCmsghdr</span><span class="op" id="2528979">)</span><span class="op" id="2528980">:</span><span class="ident" id="2528981">h</span><span class="op" id="2528982">.</span><span class="ident" id="2528983">Len</span><span class="op" id="2528986">]</span><span class="op" id="2528987">,</span>&nbsp;<span class="ident" id="2528989">nil</span><br>
<span class="lineno"></span><span class="op" id="2528993">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="2528996">//&nbsp;UnixRights&nbsp;encodes&nbsp;a&nbsp;set&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;into&nbsp;a&nbsp;socket</span><br>
<span class="lineno"></span><span class="comment" id="2529063">//&nbsp;control&nbsp;message&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="2529114">func</span>&nbsp;<span class="ident" id="2529119">UnixRights</span><span class="op" id="2529129">(</span><span class="ident" id="2529130">fds</span>&nbsp;<span class="op" id="2529134">...</span><span class="builtintype" id="2529137">int</span><span class="op" id="2529140">)</span>&nbsp;<span class="op" id="2529142">[</span><span class="op" id="2529143">]</span><span class="builtintype" id="2529144">byte</span>&nbsp;<span class="op" id="2529149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2529152">datalen</span>&nbsp;<span class="op" id="2529160">:=</span>&nbsp;<span class="builtinfunc" id="2529163">len</span><span class="op" id="2529166">(</span><span class="ident" id="2529167">fds</span><span class="op" id="2529170">)</span>&nbsp;<span class="op" id="2529172">*</span>&nbsp;<span class="num" id="2529174">4</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2529177">b</span>&nbsp;<span class="op" id="2529179">:=</span>&nbsp;<span class="builtinfunc" id="2529182">make</span><span class="op" id="2529186">(</span><span class="op" id="2529187">[</span><span class="op" id="2529188">]</span><span class="builtintype" id="2529189">byte</span><span class="op" id="2529193">,</span>&nbsp;<span class="ident" id="2529195">CmsgSpace</span><span class="op" id="2529204">(</span><span class="ident" id="2529205">datalen</span><span class="op" id="2529212">)</span><span class="op" id="2529213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2529216">h</span>&nbsp;<span class="op" id="2529218">:=</span>&nbsp;<span class="op" id="2529221">(</span><span class="op" id="2529222">*</span><span class="ident" id="2529223">Cmsghdr</span><span class="op" id="2529230">)</span><span class="op" id="2529231">(</span><span class="ident" id="2529232">unsafe</span><span class="op" id="2529238">.</span><span class="ident" id="2529239">Pointer</span><span class="op" id="2529246">(</span><span class="op" id="2529247">&amp;</span><span class="ident" id="2529248">b</span><span class="op" id="2529249">[</span><span class="num" id="2529250">0</span><span class="op" id="2529251">]</span><span class="op" id="2529252">)</span><span class="op" id="2529253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2529256">h</span><span class="op" id="2529257">.</span><span class="ident" id="2529258">Level</span>&nbsp;<span class="op" id="2529264">=</span>&nbsp;<span class="ident" id="2529266">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2529278">h</span><span class="op" id="2529279">.</span><span class="ident" id="2529280">Type</span>&nbsp;<span class="op" id="2529285">=</span>&nbsp;<span class="ident" id="2529287">SCM_RIGHTS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2529299">h</span><span class="op" id="2529300">.</span><span class="ident" id="2529301">SetLen</span><span class="op" id="2529307">(</span><span class="ident" id="2529308">CmsgLen</span><span class="op" id="2529315">(</span><span class="ident" id="2529316">datalen</span><span class="op" id="2529323">)</span><span class="op" id="2529324">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2529327">data</span>&nbsp;<span class="op" id="2529332">:=</span>&nbsp;<span class="builtintype" id="2529335">uintptr</span><span class="op" id="2529342">(</span><span class="ident" id="2529343">cmsgData</span><span class="op" id="2529351">(</span><span class="ident" id="2529352">h</span><span class="op" id="2529353">)</span><span class="op" id="2529354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2529357">for</span>&nbsp;<span class="ident" id="2529361">_</span><span class="op" id="2529362">,</span>&nbsp;<span class="ident" id="2529364">fd</span>&nbsp;<span class="op" id="2529367">:=</span>&nbsp;<span class="keyword" id="2529370">range</span>&nbsp;<span class="ident" id="2529376">fds</span>&nbsp;<span class="op" id="2529380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2529384">*</span><span class="op" id="2529385">(</span><span class="op" id="2529386">*</span><span class="builtintype" id="2529387">int32</span><span class="op" id="2529392">)</span><span class="op" id="2529393">(</span><span class="ident" id="2529394">unsafe</span><span class="op" id="2529400">.</span><span class="ident" id="2529401">Pointer</span><span class="op" id="2529408">(</span><span class="ident" id="2529409">data</span><span class="op" id="2529413">)</span><span class="op" id="2529414">)</span>&nbsp;<span class="op" id="2529416">=</span>&nbsp;<span class="builtintype" id="2529418">int32</span><span class="op" id="2529423">(</span><span class="ident" id="2529424">fd</span><span class="op" id="2529426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2529430">data</span>&nbsp;<span class="op" id="2529435">+=</span>&nbsp;<span class="num" id="2529438">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2529441">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2529444">return</span>&nbsp;<span class="ident" id="2529451">b</span><br>
<span class="lineno"></span><span class="op" id="2529453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2529456">//&nbsp;ParseUnixRights&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2529525">//&nbsp;integer&nbsp;array&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;from&nbsp;another&nbsp;process.</span><br>
<span class="lineno">90</span><span class="keyword" id="2529589">func</span>&nbsp;<span class="ident" id="2529594">ParseUnixRights</span><span class="op" id="2529609">(</span><span class="ident" id="2529610">m</span>&nbsp;<span class="op" id="2529612">*</span><span class="ident" id="2529613">SocketControlMessage</span><span class="op" id="2529633">)</span>&nbsp;<span class="op" id="2529635">(</span><span class="op" id="2529636">[</span><span class="op" id="2529637">]</span><span class="builtintype" id="2529638">int</span><span class="op" id="2529641">,</span>&nbsp;<span class="builtintype" id="2529643">error</span><span class="op" id="2529648">)</span>&nbsp;<span class="op" id="2529650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2529653">if</span>&nbsp;<span class="ident" id="2529656">m</span><span class="op" id="2529657">.</span><span class="ident" id="2529658">Header</span><span class="op" id="2529664">.</span><span class="ident" id="2529665">Level</span>&nbsp;<span class="op" id="2529671">!=</span>&nbsp;<span class="ident" id="2529674">SOL_SOCKET</span>&nbsp;<span class="op" id="2529685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2529689">return</span>&nbsp;<span class="ident" id="2529696">nil</span><span class="op" id="2529699">,</span>&nbsp;<span class="ident" id="2529701">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2529709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2529712">if</span>&nbsp;<span class="ident" id="2529715">m</span><span class="op" id="2529716">.</span><span class="ident" id="2529717">Header</span><span class="op" id="2529723">.</span><span class="ident" id="2529724">Type</span>&nbsp;<span class="op" id="2529729">!=</span>&nbsp;<span class="ident" id="2529732">SCM_RIGHTS</span>&nbsp;<span class="op" id="2529743">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2529747">return</span>&nbsp;<span class="ident" id="2529754">nil</span><span class="op" id="2529757">,</span>&nbsp;<span class="ident" id="2529759">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2529767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2529770">fds</span>&nbsp;<span class="op" id="2529774">:=</span>&nbsp;<span class="builtinfunc" id="2529777">make</span><span class="op" id="2529781">(</span><span class="op" id="2529782">[</span><span class="op" id="2529783">]</span><span class="builtintype" id="2529784">int</span><span class="op" id="2529787">,</span>&nbsp;<span class="builtinfunc" id="2529789">len</span><span class="op" id="2529792">(</span><span class="ident" id="2529793">m</span><span class="op" id="2529794">.</span><span class="ident" id="2529795">Data</span><span class="op" id="2529799">)</span><span class="op" id="2529800">&gt;&gt;</span><span class="num" id="2529802">2</span><span class="op" id="2529803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2529806">for</span>&nbsp;<span class="ident" id="2529810">i</span><span class="op" id="2529811">,</span>&nbsp;<span class="ident" id="2529813">j</span>&nbsp;<span class="op" id="2529815">:=</span>&nbsp;<span class="num" id="2529818">0</span><span class="op" id="2529819">,</span>&nbsp;<span class="num" id="2529821">0</span><span class="op" id="2529822">;</span>&nbsp;<span class="ident" id="2529824">i</span>&nbsp;<span class="op" id="2529826">&lt;</span>&nbsp;<span class="builtinfunc" id="2529828">len</span><span class="op" id="2529831">(</span><span class="ident" id="2529832">m</span><span class="op" id="2529833">.</span><span class="ident" id="2529834">Data</span><span class="op" id="2529838">)</span><span class="op" id="2529839">;</span>&nbsp;<span class="ident" id="2529841">i</span>&nbsp;<span class="op" id="2529843">+=</span>&nbsp;<span class="num" id="2529846">4</span>&nbsp;<span class="op" id="2529848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2529852">fds</span><span class="op" id="2529855">[</span><span class="ident" id="2529856">j</span><span class="op" id="2529857">]</span>&nbsp;<span class="op" id="2529859">=</span>&nbsp;<span class="builtintype" id="2529861">int</span><span class="op" id="2529864">(</span><span class="op" id="2529865">*</span><span class="op" id="2529866">(</span><span class="op" id="2529867">*</span><span class="builtintype" id="2529868">int32</span><span class="op" id="2529873">)</span><span class="op" id="2529874">(</span><span class="ident" id="2529875">unsafe</span><span class="op" id="2529881">.</span><span class="ident" id="2529882">Pointer</span><span class="op" id="2529889">(</span><span class="op" id="2529890">&amp;</span><span class="ident" id="2529891">m</span><span class="op" id="2529892">.</span><span class="ident" id="2529893">Data</span><span class="op" id="2529897">[</span><span class="ident" id="2529898">i</span><span class="op" id="2529899">]</span><span class="op" id="2529900">)</span><span class="op" id="2529901">)</span><span class="op" id="2529902">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2529906">j</span><span class="op" id="2529907">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2529911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2529914">return</span>&nbsp;<span class="ident" id="2529921">fds</span><span class="op" id="2529924">,</span>&nbsp;<span class="ident" id="2529926">nil</span><br>
<span class="lineno"></span><span class="op" id="2529930">}</span>
</div>
</body>
</html>
