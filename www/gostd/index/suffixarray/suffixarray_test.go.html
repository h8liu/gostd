<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6961517">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6961572">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6961626">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6961677">package</span>&nbsp;<span class="ident" id="6961685">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6961698">import</span>&nbsp;<span class="op" id="6961705">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6961708">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6961717">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6961730">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6961740">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6961748">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6961759">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6961769">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6961772">type</span>&nbsp;<span class="ident" id="6961777">testCase</span>&nbsp;<span class="keyword" id="6961786">struct</span>&nbsp;<span class="op" id="6961793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6961796">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6961805">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6961814">//&nbsp;name&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6961836">source</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6961845">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6961854">//&nbsp;source&nbsp;to&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6961874">patterns</span>&nbsp;<span class="op" id="6961883">[</span><span class="op" id="6961884">]</span><span class="builtintype" id="6961885">string</span>&nbsp;<span class="comment" id="6961892">//&nbsp;patterns&nbsp;to&nbsp;lookup</span><br>
<span class="lineno">20</span><span class="op" id="6961914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6961917">var</span>&nbsp;<span class="ident" id="6961921">testCases</span>&nbsp;<span class="op" id="6961931">=</span>&nbsp;<span class="op" id="6961933">[</span><span class="op" id="6961934">]</span><span class="ident" id="6961935">testCase</span><span class="op" id="6961943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6961946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6961950">&#34;empty&nbsp;string&#34;</span><span class="op" id="6961964">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6961968">&#34;&#34;</span><span class="op" id="6961970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6961974">[</span><span class="op" id="6961975">]</span><span class="builtintype" id="6961976">string</span><span class="op" id="6961982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6961987">&#34;&#34;</span><span class="op" id="6961989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6961994">&#34;foo&#34;</span><span class="op" id="6961999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962004">&#34;(foo)&#34;</span><span class="op" id="6962011">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962016">&#34;.*&#34;</span><span class="op" id="6962020">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962025">&#34;a*&#34;</span><span class="op" id="6962029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962033">}</span><span class="op" id="6962034">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962037">}</span><span class="op" id="6962038">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962046">&#34;all&nbsp;a&#39;s&#34;</span><span class="op" id="6962055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962059">&#34;aaaaaaaaaa&#34;</span><span class="op" id="6962071">,</span>&nbsp;<span class="comment" id="6962073">//&nbsp;10&nbsp;a&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962085">[</span><span class="op" id="6962086">]</span><span class="builtintype" id="6962087">string</span><span class="op" id="6962093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962098">&#34;&#34;</span><span class="op" id="6962100">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962105">&#34;a&#34;</span><span class="op" id="6962108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962113">&#34;aa&#34;</span><span class="op" id="6962117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962122">&#34;aaa&#34;</span><span class="op" id="6962127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962132">&#34;aaaa&#34;</span><span class="op" id="6962138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962143">&#34;aaaaa&#34;</span><span class="op" id="6962150">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962155">&#34;aaaaaa&#34;</span><span class="op" id="6962163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962168">&#34;aaaaaaa&#34;</span><span class="op" id="6962177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962182">&#34;aaaaaaaa&#34;</span><span class="op" id="6962192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962197">&#34;aaaaaaaaa&#34;</span><span class="op" id="6962208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962213">&#34;aaaaaaaaaa&#34;</span><span class="op" id="6962225">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962230">&#34;aaaaaaaaaaa&#34;</span><span class="op" id="6962243">,</span>&nbsp;<span class="comment" id="6962245">//&nbsp;11&nbsp;a&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962258">&#34;.&#34;</span><span class="op" id="6962261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962266">&#34;.*&#34;</span><span class="op" id="6962270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962275">&#34;a+&#34;</span><span class="op" id="6962279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962284">&#34;aa+&#34;</span><span class="op" id="6962289">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962294">&#34;aaaa[b]?&#34;</span><span class="op" id="6962304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962309">&#34;aaa*&#34;</span><span class="op" id="6962315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962319">}</span><span class="op" id="6962320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962323">}</span><span class="op" id="6962324">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962332">&#34;abc&#34;</span><span class="op" id="6962337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962341">&#34;abc&#34;</span><span class="op" id="6962346">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962350">[</span><span class="op" id="6962351">]</span><span class="builtintype" id="6962352">string</span><span class="op" id="6962358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962363">&#34;a&#34;</span><span class="op" id="6962366">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962371">&#34;b&#34;</span><span class="op" id="6962374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962379">&#34;c&#34;</span><span class="op" id="6962382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962387">&#34;ab&#34;</span><span class="op" id="6962391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962396">&#34;bc&#34;</span><span class="op" id="6962400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962405">&#34;abc&#34;</span><span class="op" id="6962410">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962415">&#34;a.c&#34;</span><span class="op" id="6962420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962425">&#34;a(b|c)&#34;</span><span class="op" id="6962433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962438">&#34;abc?&#34;</span><span class="op" id="6962444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962448">}</span><span class="op" id="6962449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962452">}</span><span class="op" id="6962453">,</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962461">&#34;barbara*3&#34;</span><span class="op" id="6962472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962476">&#34;barbarabarbarabarbara&#34;</span><span class="op" id="6962499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962503">[</span><span class="op" id="6962504">]</span><span class="builtintype" id="6962505">string</span><span class="op" id="6962511">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962516">&#34;a&#34;</span><span class="op" id="6962519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962524">&#34;bar&#34;</span><span class="op" id="6962529">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962534">&#34;rab&#34;</span><span class="op" id="6962539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962544">&#34;arab&#34;</span><span class="op" id="6962550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962555">&#34;barbar&#34;</span><span class="op" id="6962563">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962568">&#34;bara?bar&#34;</span><span class="op" id="6962578">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962582">}</span><span class="op" id="6962583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962586">}</span><span class="op" id="6962587">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962591">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962595">&#34;typing&nbsp;drill&#34;</span><span class="op" id="6962609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962613">&#34;Now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&nbsp;to&nbsp;come&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&nbsp;country.&#34;</span><span class="op" id="6962684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962688">[</span><span class="op" id="6962689">]</span><span class="builtintype" id="6962690">string</span><span class="op" id="6962696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962701">&#34;Now&#34;</span><span class="op" id="6962706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962711">&#34;the&nbsp;time&#34;</span><span class="op" id="6962721">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962726">&#34;to&nbsp;come&nbsp;the&nbsp;aid&#34;</span><span class="op" id="6962743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962748">&#34;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&nbsp;to&nbsp;come&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&#34;</span><span class="op" id="6962806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962811">&#34;to&nbsp;(come|the)?&#34;</span><span class="op" id="6962827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962831">}</span><span class="op" id="6962832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962835">}</span><span class="op" id="6962836">,</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962844">&#34;godoc&nbsp;simulation&#34;</span><span class="op" id="6962862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6962866">&#34;package&nbsp;main\n\nimport(\n&nbsp;&nbsp;&nbsp;&nbsp;\&#34;rand\&#34;\n&nbsp;&nbsp;&nbsp;&nbsp;&#34;</span><span class="op" id="6962911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962915">[</span><span class="op" id="6962916">]</span><span class="builtintype" id="6962917">string</span><span class="op" id="6962923">{</span><span class="op" id="6962924">}</span><span class="op" id="6962925">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6962928">}</span><span class="op" id="6962929">,</span><br>
<span class="lineno"></span><span class="op" id="6962931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6962934">//&nbsp;find&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;s&nbsp;in&nbsp;source;&nbsp;report&nbsp;at&nbsp;most&nbsp;n&nbsp;occurrences</span><br>
<span class="lineno"></span><span class="keyword" id="6963003">func</span>&nbsp;<span class="ident" id="6963008">find</span><span class="op" id="6963012">(</span><span class="ident" id="6963013">src</span><span class="op" id="6963016">,</span>&nbsp;<span class="ident" id="6963018">s</span>&nbsp;<span class="builtintype" id="6963020">string</span><span class="op" id="6963026">,</span>&nbsp;<span class="ident" id="6963028">n</span>&nbsp;<span class="builtintype" id="6963030">int</span><span class="op" id="6963033">)</span>&nbsp;<span class="op" id="6963035">[</span><span class="op" id="6963036">]</span><span class="builtintype" id="6963037">int</span>&nbsp;<span class="op" id="6963041">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6963044">var</span>&nbsp;<span class="ident" id="6963048">res</span>&nbsp;<span class="op" id="6963052">[</span><span class="op" id="6963053">]</span><span class="builtintype" id="6963054">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6963059">if</span>&nbsp;<span class="ident" id="6963062">s</span>&nbsp;<span class="op" id="6963064">!=</span>&nbsp;<span class="string" id="6963067">&#34;&#34;</span>&nbsp;<span class="op" id="6963070">&amp;&amp;</span>&nbsp;<span class="ident" id="6963073">n</span>&nbsp;<span class="op" id="6963075">!=</span>&nbsp;<span class="num" id="6963078">0</span>&nbsp;<span class="op" id="6963080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6963084">//&nbsp;find&nbsp;at&nbsp;most&nbsp;n&nbsp;occurrences&nbsp;of&nbsp;s&nbsp;in&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6963128">for</span>&nbsp;<span class="ident" id="6963132">i</span>&nbsp;<span class="op" id="6963134">:=</span>&nbsp;<span class="op" id="6963137">-</span><span class="num" id="6963138">1</span><span class="op" id="6963139">;</span>&nbsp;<span class="ident" id="6963141">n</span>&nbsp;<span class="op" id="6963143">&lt;</span>&nbsp;<span class="num" id="6963145">0</span>&nbsp;<span class="op" id="6963147">||</span>&nbsp;<span class="builtinfunc" id="6963150">len</span><span class="op" id="6963153">(</span><span class="ident" id="6963154">res</span><span class="op" id="6963157">)</span>&nbsp;<span class="op" id="6963159">&lt;</span>&nbsp;<span class="ident" id="6963161">n</span><span class="op" id="6963162">;</span>&nbsp;<span class="op" id="6963164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6963169">j</span>&nbsp;<span class="op" id="6963171">:=</span>&nbsp;<span class="ident" id="6963174">strings</span><span class="op" id="6963181">.</span><span class="ident" id="6963182">Index</span><span class="op" id="6963187">(</span><span class="ident" id="6963188">src</span><span class="op" id="6963191">[</span><span class="ident" id="6963192">i</span><span class="op" id="6963193">+</span><span class="num" id="6963194">1</span><span class="op" id="6963195">:</span><span class="op" id="6963196">]</span><span class="op" id="6963197">,</span>&nbsp;<span class="ident" id="6963199">s</span><span class="op" id="6963200">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6963205">if</span>&nbsp;<span class="ident" id="6963208">j</span>&nbsp;<span class="op" id="6963210">&lt;</span>&nbsp;<span class="num" id="6963212">0</span>&nbsp;<span class="op" id="6963214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6963220">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6963229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6963234">i</span>&nbsp;<span class="op" id="6963236">+=</span>&nbsp;<span class="ident" id="6963239">j</span>&nbsp;<span class="op" id="6963241">+</span>&nbsp;<span class="num" id="6963243">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6963248">res</span>&nbsp;<span class="op" id="6963252">=</span>&nbsp;<span class="builtinfunc" id="6963254">append</span><span class="op" id="6963260">(</span><span class="ident" id="6963261">res</span><span class="op" id="6963264">,</span>&nbsp;<span class="ident" id="6963266">i</span><span class="op" id="6963267">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6963271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6963274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6963277">return</span>&nbsp;<span class="ident" id="6963284">res</span><br>
<span class="lineno"></span><span class="op" id="6963288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="6963291">func</span>&nbsp;<span class="ident" id="6963296">testLookup</span><span class="op" id="6963306">(</span><span class="ident" id="6963307">t</span>&nbsp;<span class="op" id="6963309">*</span><span class="ident" id="6963310">testing</span><span class="op" id="6963317">.</span><span class="ident" id="6963318">T</span><span class="op" id="6963319">,</span>&nbsp;<span class="ident" id="6963321">tc</span>&nbsp;<span class="op" id="6963324">*</span><span class="ident" id="6963325">testCase</span><span class="op" id="6963333">,</span>&nbsp;<span class="ident" id="6963335">x</span>&nbsp;<span class="op" id="6963337">*</span><span class="ident" id="6963338">Index</span><span class="op" id="6963343">,</span>&nbsp;<span class="ident" id="6963345">s</span>&nbsp;<span class="builtintype" id="6963347">string</span><span class="op" id="6963353">,</span>&nbsp;<span class="ident" id="6963355">n</span>&nbsp;<span class="builtintype" id="6963357">int</span><span class="op" id="6963360">)</span>&nbsp;<span class="op" id="6963362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6963365">res</span>&nbsp;<span class="op" id="6963369">:=</span>&nbsp;<span class="ident" id="6963372">x</span><span class="op" id="6963373">.</span><span class="ident" id="6963374">Lookup</span><span class="op" id="6963380">(</span><span class="op" id="6963381">[</span><span class="op" id="6963382">]</span><span class="builtintype" id="6963383">byte</span><span class="op" id="6963387">(</span><span class="ident" id="6963388">s</span><span class="op" id="6963389">)</span><span class="op" id="6963390">,</span>&nbsp;<span class="ident" id="6963392">n</span><span class="op" id="6963393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6963396">exp</span>&nbsp;<span class="op" id="6963400">:=</span>&nbsp;<span class="ident" id="6963403">find</span><span class="op" id="6963407">(</span><span class="ident" id="6963408">tc</span><span class="op" id="6963410">.</span><span class="ident" id="6963411">source</span><span class="op" id="6963417">,</span>&nbsp;<span class="ident" id="6963419">s</span><span class="op" id="6963420">,</span>&nbsp;<span class="ident" id="6963422">n</span><span class="op" id="6963423">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6963427">//&nbsp;check&nbsp;that&nbsp;the&nbsp;lengths&nbsp;match</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6963460">if</span>&nbsp;<span class="builtinfunc" id="6963463">len</span><span class="op" id="6963466">(</span><span class="ident" id="6963467">res</span><span class="op" id="6963470">)</span>&nbsp;<span class="op" id="6963472">!=</span>&nbsp;<span class="builtinfunc" id="6963475">len</span><span class="op" id="6963478">(</span><span class="ident" id="6963479">exp</span><span class="op" id="6963482">)</span>&nbsp;<span class="op" id="6963484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6963488">t</span><span class="op" id="6963489">.</span><span class="ident" id="6963490">Errorf</span><span class="op" id="6963496">(</span><span class="string" id="6963497">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;expected&nbsp;%d&nbsp;results;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6963555">,</span>&nbsp;<span class="ident" id="6963557">tc</span><span class="op" id="6963559">.</span><span class="ident" id="6963560">name</span><span class="op" id="6963564">,</span>&nbsp;<span class="ident" id="6963566">s</span><span class="op" id="6963567">,</span>&nbsp;<span class="ident" id="6963569">n</span><span class="op" id="6963570">,</span>&nbsp;<span class="builtinfunc" id="6963572">len</span><span class="op" id="6963575">(</span><span class="ident" id="6963576">exp</span><span class="op" id="6963579">)</span><span class="op" id="6963580">,</span>&nbsp;<span class="builtinfunc" id="6963582">len</span><span class="op" id="6963585">(</span><span class="ident" id="6963586">res</span><span class="op" id="6963589">)</span><span class="op" id="6963590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6963593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6963597">//&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0&nbsp;the&nbsp;number&nbsp;of&nbsp;results&nbsp;is&nbsp;limited&nbsp;---&nbsp;unless&nbsp;n&nbsp;&gt;=&nbsp;all&nbsp;results,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6963673">//&nbsp;we&nbsp;may&nbsp;obtain&nbsp;different&nbsp;positions&nbsp;from&nbsp;the&nbsp;Index&nbsp;and&nbsp;from&nbsp;find&nbsp;(because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6963749">//&nbsp;Index&nbsp;may&nbsp;not&nbsp;find&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;as&nbsp;find)&nbsp;=&gt;&nbsp;in&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6963825">//&nbsp;we&nbsp;cannot&nbsp;simply&nbsp;check&nbsp;that&nbsp;the&nbsp;res&nbsp;and&nbsp;exp&nbsp;lists&nbsp;are&nbsp;equal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6963890">//&nbsp;check&nbsp;that&nbsp;each&nbsp;result&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;correct&nbsp;match&nbsp;and&nbsp;there&nbsp;are&nbsp;no&nbsp;duplicates</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6963972">sort</span><span class="op" id="6963976">.</span><span class="ident" id="6963977">Ints</span><span class="op" id="6963981">(</span><span class="ident" id="6963982">res</span><span class="op" id="6963985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6963988">for</span>&nbsp;<span class="ident" id="6963992">i</span><span class="op" id="6963993">,</span>&nbsp;<span class="ident" id="6963995">r</span>&nbsp;<span class="op" id="6963997">:=</span>&nbsp;<span class="keyword" id="6964000">range</span>&nbsp;<span class="ident" id="6964006">res</span>&nbsp;<span class="op" id="6964010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6964014">if</span>&nbsp;<span class="ident" id="6964017">r</span>&nbsp;<span class="op" id="6964019">&lt;</span>&nbsp;<span class="num" id="6964021">0</span>&nbsp;<span class="op" id="6964023">||</span>&nbsp;<span class="builtinfunc" id="6964026">len</span><span class="op" id="6964029">(</span><span class="ident" id="6964030">tc</span><span class="op" id="6964032">.</span><span class="ident" id="6964033">source</span><span class="op" id="6964039">)</span>&nbsp;<span class="op" id="6964041">&lt;=</span>&nbsp;<span class="ident" id="6964044">r</span>&nbsp;<span class="op" id="6964046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6964051">t</span><span class="op" id="6964052">.</span><span class="ident" id="6964053">Errorf</span><span class="op" id="6964059">(</span><span class="string" id="6964060">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;index&nbsp;%d&nbsp;out&nbsp;of&nbsp;range&nbsp;[0,&nbsp;%d[&#34;</span><span class="op" id="6964131">,</span>&nbsp;<span class="ident" id="6964133">tc</span><span class="op" id="6964135">.</span><span class="ident" id="6964136">name</span><span class="op" id="6964140">,</span>&nbsp;<span class="ident" id="6964142">s</span><span class="op" id="6964143">,</span>&nbsp;<span class="ident" id="6964145">i</span><span class="op" id="6964146">,</span>&nbsp;<span class="ident" id="6964148">n</span><span class="op" id="6964149">,</span>&nbsp;<span class="ident" id="6964151">r</span><span class="op" id="6964152">,</span>&nbsp;<span class="builtinfunc" id="6964154">len</span><span class="op" id="6964157">(</span><span class="ident" id="6964158">tc</span><span class="op" id="6964160">.</span><span class="ident" id="6964161">source</span><span class="op" id="6964167">)</span><span class="op" id="6964168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6964172">}</span>&nbsp;<span class="keyword" id="6964174">else</span>&nbsp;<span class="keyword" id="6964179">if</span>&nbsp;<span class="op" id="6964182">!</span><span class="ident" id="6964183">strings</span><span class="op" id="6964190">.</span><span class="ident" id="6964191">HasPrefix</span><span class="op" id="6964200">(</span><span class="ident" id="6964201">tc</span><span class="op" id="6964203">.</span><span class="ident" id="6964204">source</span><span class="op" id="6964210">[</span><span class="ident" id="6964211">r</span><span class="op" id="6964212">:</span><span class="op" id="6964213">]</span><span class="op" id="6964214">,</span>&nbsp;<span class="ident" id="6964216">s</span><span class="op" id="6964217">)</span>&nbsp;<span class="op" id="6964219">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6964224">t</span><span class="op" id="6964225">.</span><span class="ident" id="6964226">Errorf</span><span class="op" id="6964232">(</span><span class="string" id="6964233">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;index&nbsp;%d&nbsp;not&nbsp;a&nbsp;match&#34;</span><span class="op" id="6964295">,</span>&nbsp;<span class="ident" id="6964297">tc</span><span class="op" id="6964299">.</span><span class="ident" id="6964300">name</span><span class="op" id="6964304">,</span>&nbsp;<span class="ident" id="6964306">s</span><span class="op" id="6964307">,</span>&nbsp;<span class="ident" id="6964309">i</span><span class="op" id="6964310">,</span>&nbsp;<span class="ident" id="6964312">n</span><span class="op" id="6964313">,</span>&nbsp;<span class="ident" id="6964315">r</span><span class="op" id="6964316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6964320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6964324">if</span>&nbsp;<span class="ident" id="6964327">i</span>&nbsp;<span class="op" id="6964329">&gt;</span>&nbsp;<span class="num" id="6964331">0</span>&nbsp;<span class="op" id="6964333">&amp;&amp;</span>&nbsp;<span class="ident" id="6964336">res</span><span class="op" id="6964339">[</span><span class="ident" id="6964340">i</span><span class="op" id="6964341">-</span><span class="num" id="6964342">1</span><span class="op" id="6964343">]</span>&nbsp;<span class="op" id="6964345">==</span>&nbsp;<span class="ident" id="6964348">r</span>&nbsp;<span class="op" id="6964350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6964355">t</span><span class="op" id="6964356">.</span><span class="ident" id="6964357">Errorf</span><span class="op" id="6964363">(</span><span class="string" id="6964364">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;found&nbsp;duplicate&nbsp;index&nbsp;%d&#34;</span><span class="op" id="6964430">,</span>&nbsp;<span class="ident" id="6964432">tc</span><span class="op" id="6964434">.</span><span class="ident" id="6964435">name</span><span class="op" id="6964439">,</span>&nbsp;<span class="ident" id="6964441">s</span><span class="op" id="6964442">,</span>&nbsp;<span class="ident" id="6964444">i</span><span class="op" id="6964445">,</span>&nbsp;<span class="ident" id="6964447">n</span><span class="op" id="6964448">,</span>&nbsp;<span class="ident" id="6964450">r</span><span class="op" id="6964451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6964455">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6964458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6964462">if</span>&nbsp;<span class="ident" id="6964465">n</span>&nbsp;<span class="op" id="6964467">&lt;</span>&nbsp;<span class="num" id="6964469">0</span>&nbsp;<span class="op" id="6964471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6964475">//&nbsp;all&nbsp;results&nbsp;computed&nbsp;-&nbsp;sorted&nbsp;res&nbsp;and&nbsp;exp&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6964536">for</span>&nbsp;<span class="ident" id="6964540">i</span><span class="op" id="6964541">,</span>&nbsp;<span class="ident" id="6964543">r</span>&nbsp;<span class="op" id="6964545">:=</span>&nbsp;<span class="keyword" id="6964548">range</span>&nbsp;<span class="ident" id="6964554">res</span>&nbsp;<span class="op" id="6964558">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6964563">e</span>&nbsp;<span class="op" id="6964565">:=</span>&nbsp;<span class="ident" id="6964568">exp</span><span class="op" id="6964571">[</span><span class="ident" id="6964572">i</span><span class="op" id="6964573">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6964578">if</span>&nbsp;<span class="ident" id="6964581">r</span>&nbsp;<span class="op" id="6964583">!=</span>&nbsp;<span class="ident" id="6964586">e</span>&nbsp;<span class="op" id="6964588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6964594">t</span><span class="op" id="6964595">.</span><span class="ident" id="6964596">Errorf</span><span class="op" id="6964602">(</span><span class="string" id="6964603">&#34;test&nbsp;%q,&nbsp;lookup&nbsp;%q,&nbsp;result&nbsp;%d:&nbsp;expected&nbsp;index&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6964661">,</span>&nbsp;<span class="ident" id="6964663">tc</span><span class="op" id="6964665">.</span><span class="ident" id="6964666">name</span><span class="op" id="6964670">,</span>&nbsp;<span class="ident" id="6964672">s</span><span class="op" id="6964673">,</span>&nbsp;<span class="ident" id="6964675">i</span><span class="op" id="6964676">,</span>&nbsp;<span class="ident" id="6964678">e</span><span class="op" id="6964679">,</span>&nbsp;<span class="ident" id="6964681">r</span><span class="op" id="6964682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6964687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6964691">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6964694">}</span><br>
<span class="lineno"></span><span class="op" id="6964696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6964699">func</span>&nbsp;<span class="ident" id="6964704">testFindAllIndex</span><span class="op" id="6964720">(</span><span class="ident" id="6964721">t</span>&nbsp;<span class="op" id="6964723">*</span><span class="ident" id="6964724">testing</span><span class="op" id="6964731">.</span><span class="ident" id="6964732">T</span><span class="op" id="6964733">,</span>&nbsp;<span class="ident" id="6964735">tc</span>&nbsp;<span class="op" id="6964738">*</span><span class="ident" id="6964739">testCase</span><span class="op" id="6964747">,</span>&nbsp;<span class="ident" id="6964749">x</span>&nbsp;<span class="op" id="6964751">*</span><span class="ident" id="6964752">Index</span><span class="op" id="6964757">,</span>&nbsp;<span class="ident" id="6964759">rx</span>&nbsp;<span class="op" id="6964762">*</span><span class="ident" id="6964763">regexp</span><span class="op" id="6964769">.</span><span class="ident" id="6964770">Regexp</span><span class="op" id="6964776">,</span>&nbsp;<span class="ident" id="6964778">n</span>&nbsp;<span class="builtintype" id="6964780">int</span><span class="op" id="6964783">)</span>&nbsp;<span class="op" id="6964785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6964788">res</span>&nbsp;<span class="op" id="6964792">:=</span>&nbsp;<span class="ident" id="6964795">x</span><span class="op" id="6964796">.</span><span class="ident" id="6964797">FindAllIndex</span><span class="op" id="6964809">(</span><span class="ident" id="6964810">rx</span><span class="op" id="6964812">,</span>&nbsp;<span class="ident" id="6964814">n</span><span class="op" id="6964815">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6964818">exp</span>&nbsp;<span class="op" id="6964822">:=</span>&nbsp;<span class="ident" id="6964825">rx</span><span class="op" id="6964827">.</span><span class="ident" id="6964828">FindAllStringIndex</span><span class="op" id="6964846">(</span><span class="ident" id="6964847">tc</span><span class="op" id="6964849">.</span><span class="ident" id="6964850">source</span><span class="op" id="6964856">,</span>&nbsp;<span class="ident" id="6964858">n</span><span class="op" id="6964859">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6964863">//&nbsp;check&nbsp;that&nbsp;the&nbsp;lengths&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6964896">if</span>&nbsp;<span class="builtinfunc" id="6964899">len</span><span class="op" id="6964902">(</span><span class="ident" id="6964903">res</span><span class="op" id="6964906">)</span>&nbsp;<span class="op" id="6964908">!=</span>&nbsp;<span class="builtinfunc" id="6964911">len</span><span class="op" id="6964914">(</span><span class="ident" id="6964915">exp</span><span class="op" id="6964918">)</span>&nbsp;<span class="op" id="6964920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6964924">t</span><span class="op" id="6964925">.</span><span class="ident" id="6964926">Errorf</span><span class="op" id="6964932">(</span><span class="string" id="6964933">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;expected&nbsp;%d&nbsp;results;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6964997">,</span>&nbsp;<span class="ident" id="6964999">tc</span><span class="op" id="6965001">.</span><span class="ident" id="6965002">name</span><span class="op" id="6965006">,</span>&nbsp;<span class="ident" id="6965008">rx</span><span class="op" id="6965010">,</span>&nbsp;<span class="ident" id="6965012">n</span><span class="op" id="6965013">,</span>&nbsp;<span class="builtinfunc" id="6965015">len</span><span class="op" id="6965018">(</span><span class="ident" id="6965019">exp</span><span class="op" id="6965022">)</span><span class="op" id="6965023">,</span>&nbsp;<span class="builtinfunc" id="6965025">len</span><span class="op" id="6965028">(</span><span class="ident" id="6965029">res</span><span class="op" id="6965032">)</span><span class="op" id="6965033">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6965036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6965040">//&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0&nbsp;the&nbsp;number&nbsp;of&nbsp;results&nbsp;is&nbsp;limited&nbsp;---&nbsp;unless&nbsp;n&nbsp;&gt;=&nbsp;all&nbsp;results,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6965116">//&nbsp;we&nbsp;may&nbsp;obtain&nbsp;different&nbsp;positions&nbsp;from&nbsp;the&nbsp;Index&nbsp;and&nbsp;from&nbsp;regexp&nbsp;(because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6965194">//&nbsp;Index&nbsp;may&nbsp;not&nbsp;find&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;as&nbsp;regexp)&nbsp;=&gt;&nbsp;in&nbsp;general</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6965272">//&nbsp;we&nbsp;cannot&nbsp;simply&nbsp;check&nbsp;that&nbsp;the&nbsp;res&nbsp;and&nbsp;exp&nbsp;lists&nbsp;are&nbsp;equal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6965337">//&nbsp;check&nbsp;that&nbsp;each&nbsp;result&nbsp;is&nbsp;in&nbsp;fact&nbsp;a&nbsp;correct&nbsp;match&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6965416">for</span>&nbsp;<span class="ident" id="6965420">i</span><span class="op" id="6965421">,</span>&nbsp;<span class="ident" id="6965423">r</span>&nbsp;<span class="op" id="6965425">:=</span>&nbsp;<span class="keyword" id="6965428">range</span>&nbsp;<span class="ident" id="6965434">res</span>&nbsp;<span class="op" id="6965438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6965442">if</span>&nbsp;<span class="ident" id="6965445">r</span><span class="op" id="6965446">[</span><span class="num" id="6965447">0</span><span class="op" id="6965448">]</span>&nbsp;<span class="op" id="6965450">&lt;</span>&nbsp;<span class="num" id="6965452">0</span>&nbsp;<span class="op" id="6965454">||</span>&nbsp;<span class="ident" id="6965457">r</span><span class="op" id="6965458">[</span><span class="num" id="6965459">0</span><span class="op" id="6965460">]</span>&nbsp;<span class="op" id="6965462">&gt;</span>&nbsp;<span class="ident" id="6965464">r</span><span class="op" id="6965465">[</span><span class="num" id="6965466">1</span><span class="op" id="6965467">]</span>&nbsp;<span class="op" id="6965469">||</span>&nbsp;<span class="builtinfunc" id="6965472">len</span><span class="op" id="6965475">(</span><span class="ident" id="6965476">tc</span><span class="op" id="6965478">.</span><span class="ident" id="6965479">source</span><span class="op" id="6965485">)</span>&nbsp;<span class="op" id="6965487">&lt;</span>&nbsp;<span class="ident" id="6965489">r</span><span class="op" id="6965490">[</span><span class="num" id="6965491">1</span><span class="op" id="6965492">]</span>&nbsp;<span class="op" id="6965494">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6965499">t</span><span class="op" id="6965500">.</span><span class="ident" id="6965501">Errorf</span><span class="op" id="6965507">(</span><span class="string" id="6965508">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;==&nbsp;%d):&nbsp;illegal&nbsp;match&nbsp;[%d,&nbsp;%d]&#34;</span><span class="op" id="6965579">,</span>&nbsp;<span class="ident" id="6965581">tc</span><span class="op" id="6965583">.</span><span class="ident" id="6965584">name</span><span class="op" id="6965588">,</span>&nbsp;<span class="ident" id="6965590">rx</span><span class="op" id="6965592">,</span>&nbsp;<span class="ident" id="6965594">i</span><span class="op" id="6965595">,</span>&nbsp;<span class="ident" id="6965597">n</span><span class="op" id="6965598">,</span>&nbsp;<span class="ident" id="6965600">r</span><span class="op" id="6965601">[</span><span class="num" id="6965602">0</span><span class="op" id="6965603">]</span><span class="op" id="6965604">,</span>&nbsp;<span class="ident" id="6965606">r</span><span class="op" id="6965607">[</span><span class="num" id="6965608">1</span><span class="op" id="6965609">]</span><span class="op" id="6965610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6965614">}</span>&nbsp;<span class="keyword" id="6965616">else</span>&nbsp;<span class="keyword" id="6965621">if</span>&nbsp;<span class="op" id="6965624">!</span><span class="ident" id="6965625">rx</span><span class="op" id="6965627">.</span><span class="ident" id="6965628">MatchString</span><span class="op" id="6965639">(</span><span class="ident" id="6965640">tc</span><span class="op" id="6965642">.</span><span class="ident" id="6965643">source</span><span class="op" id="6965649">[</span><span class="ident" id="6965650">r</span><span class="op" id="6965651">[</span><span class="num" id="6965652">0</span><span class="op" id="6965653">]</span><span class="op" id="6965654">:</span><span class="ident" id="6965655">r</span><span class="op" id="6965656">[</span><span class="num" id="6965657">1</span><span class="op" id="6965658">]</span><span class="op" id="6965659">]</span><span class="op" id="6965660">)</span>&nbsp;<span class="op" id="6965662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6965667">t</span><span class="op" id="6965668">.</span><span class="ident" id="6965669">Errorf</span><span class="op" id="6965675">(</span><span class="string" id="6965676">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d&nbsp;(n&nbsp;=&nbsp;%d):&nbsp;[%d,&nbsp;%d]&nbsp;not&nbsp;a&nbsp;match&#34;</span><span class="op" id="6965744">,</span>&nbsp;<span class="ident" id="6965746">tc</span><span class="op" id="6965748">.</span><span class="ident" id="6965749">name</span><span class="op" id="6965753">,</span>&nbsp;<span class="ident" id="6965755">rx</span><span class="op" id="6965757">,</span>&nbsp;<span class="ident" id="6965759">i</span><span class="op" id="6965760">,</span>&nbsp;<span class="ident" id="6965762">n</span><span class="op" id="6965763">,</span>&nbsp;<span class="ident" id="6965765">r</span><span class="op" id="6965766">[</span><span class="num" id="6965767">0</span><span class="op" id="6965768">]</span><span class="op" id="6965769">,</span>&nbsp;<span class="ident" id="6965771">r</span><span class="op" id="6965772">[</span><span class="num" id="6965773">1</span><span class="op" id="6965774">]</span><span class="op" id="6965775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6965779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6965782">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6965786">if</span>&nbsp;<span class="ident" id="6965789">n</span>&nbsp;<span class="op" id="6965791">&lt;</span>&nbsp;<span class="num" id="6965793">0</span>&nbsp;<span class="op" id="6965795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6965799">//&nbsp;all&nbsp;results&nbsp;computed&nbsp;-&nbsp;sorted&nbsp;res&nbsp;and&nbsp;exp&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6965860">for</span>&nbsp;<span class="ident" id="6965864">i</span><span class="op" id="6965865">,</span>&nbsp;<span class="ident" id="6965867">r</span>&nbsp;<span class="op" id="6965869">:=</span>&nbsp;<span class="keyword" id="6965872">range</span>&nbsp;<span class="ident" id="6965878">res</span>&nbsp;<span class="op" id="6965882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6965887">e</span>&nbsp;<span class="op" id="6965889">:=</span>&nbsp;<span class="ident" id="6965892">exp</span><span class="op" id="6965895">[</span><span class="ident" id="6965896">i</span><span class="op" id="6965897">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6965902">if</span>&nbsp;<span class="ident" id="6965905">r</span><span class="op" id="6965906">[</span><span class="num" id="6965907">0</span><span class="op" id="6965908">]</span>&nbsp;<span class="op" id="6965910">!=</span>&nbsp;<span class="ident" id="6965913">e</span><span class="op" id="6965914">[</span><span class="num" id="6965915">0</span><span class="op" id="6965916">]</span>&nbsp;<span class="op" id="6965918">||</span>&nbsp;<span class="ident" id="6965921">r</span><span class="op" id="6965922">[</span><span class="num" id="6965923">1</span><span class="op" id="6965924">]</span>&nbsp;<span class="op" id="6965926">!=</span>&nbsp;<span class="ident" id="6965929">e</span><span class="op" id="6965930">[</span><span class="num" id="6965931">1</span><span class="op" id="6965932">]</span>&nbsp;<span class="op" id="6965934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6965940">t</span><span class="op" id="6965941">.</span><span class="ident" id="6965942">Errorf</span><span class="op" id="6965948">(</span><span class="string" id="6965949">&#34;test&nbsp;%q,&nbsp;FindAllIndex&nbsp;%q,&nbsp;result&nbsp;%d:&nbsp;expected&nbsp;match&nbsp;[%d,&nbsp;%d];&nbsp;got&nbsp;[%d,&nbsp;%d]&#34;</span><span class="op" id="6966025">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6966032">tc</span><span class="op" id="6966034">.</span><span class="ident" id="6966035">name</span><span class="op" id="6966039">,</span>&nbsp;<span class="ident" id="6966041">rx</span><span class="op" id="6966043">,</span>&nbsp;<span class="ident" id="6966045">i</span><span class="op" id="6966046">,</span>&nbsp;<span class="ident" id="6966048">e</span><span class="op" id="6966049">[</span><span class="num" id="6966050">0</span><span class="op" id="6966051">]</span><span class="op" id="6966052">,</span>&nbsp;<span class="ident" id="6966054">e</span><span class="op" id="6966055">[</span><span class="num" id="6966056">1</span><span class="op" id="6966057">]</span><span class="op" id="6966058">,</span>&nbsp;<span class="ident" id="6966060">r</span><span class="op" id="6966061">[</span><span class="num" id="6966062">0</span><span class="op" id="6966063">]</span><span class="op" id="6966064">,</span>&nbsp;<span class="ident" id="6966066">r</span><span class="op" id="6966067">[</span><span class="num" id="6966068">1</span><span class="op" id="6966069">]</span><span class="op" id="6966070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6966075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6966079">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6966082">}</span><br>
<span class="lineno"></span><span class="op" id="6966084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6966087">func</span>&nbsp;<span class="ident" id="6966092">testLookups</span><span class="op" id="6966103">(</span><span class="ident" id="6966104">t</span>&nbsp;<span class="op" id="6966106">*</span><span class="ident" id="6966107">testing</span><span class="op" id="6966114">.</span><span class="ident" id="6966115">T</span><span class="op" id="6966116">,</span>&nbsp;<span class="ident" id="6966118">tc</span>&nbsp;<span class="op" id="6966121">*</span><span class="ident" id="6966122">testCase</span><span class="op" id="6966130">,</span>&nbsp;<span class="ident" id="6966132">x</span>&nbsp;<span class="op" id="6966134">*</span><span class="ident" id="6966135">Index</span><span class="op" id="6966140">,</span>&nbsp;<span class="ident" id="6966142">n</span>&nbsp;<span class="builtintype" id="6966144">int</span><span class="op" id="6966147">)</span>&nbsp;<span class="op" id="6966149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6966152">for</span>&nbsp;<span class="ident" id="6966156">_</span><span class="op" id="6966157">,</span>&nbsp;<span class="ident" id="6966159">pat</span>&nbsp;<span class="op" id="6966163">:=</span>&nbsp;<span class="keyword" id="6966166">range</span>&nbsp;<span class="ident" id="6966172">tc</span><span class="op" id="6966174">.</span><span class="ident" id="6966175">patterns</span>&nbsp;<span class="op" id="6966184">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6966188">testLookup</span><span class="op" id="6966198">(</span><span class="ident" id="6966199">t</span><span class="op" id="6966200">,</span>&nbsp;<span class="ident" id="6966202">tc</span><span class="op" id="6966204">,</span>&nbsp;<span class="ident" id="6966206">x</span><span class="op" id="6966207">,</span>&nbsp;<span class="ident" id="6966209">pat</span><span class="op" id="6966212">,</span>&nbsp;<span class="ident" id="6966214">n</span><span class="op" id="6966215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6966219">if</span>&nbsp;<span class="ident" id="6966222">rx</span><span class="op" id="6966224">,</span>&nbsp;<span class="ident" id="6966226">err</span>&nbsp;<span class="op" id="6966230">:=</span>&nbsp;<span class="ident" id="6966233">regexp</span><span class="op" id="6966239">.</span><span class="ident" id="6966240">Compile</span><span class="op" id="6966247">(</span><span class="ident" id="6966248">pat</span><span class="op" id="6966251">)</span><span class="op" id="6966252">;</span>&nbsp;<span class="ident" id="6966254">err</span>&nbsp;<span class="op" id="6966258">==</span>&nbsp;<span class="ident" id="6966261">nil</span>&nbsp;<span class="op" id="6966265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6966270">testFindAllIndex</span><span class="op" id="6966286">(</span><span class="ident" id="6966287">t</span><span class="op" id="6966288">,</span>&nbsp;<span class="ident" id="6966290">tc</span><span class="op" id="6966292">,</span>&nbsp;<span class="ident" id="6966294">x</span><span class="op" id="6966295">,</span>&nbsp;<span class="ident" id="6966297">rx</span><span class="op" id="6966299">,</span>&nbsp;<span class="ident" id="6966301">n</span><span class="op" id="6966302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6966306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6966309">}</span><br>
<span class="lineno">205</span><span class="op" id="6966311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6966314">//&nbsp;index&nbsp;is&nbsp;used&nbsp;to&nbsp;hide&nbsp;the&nbsp;sort.Interface</span><br>
<span class="lineno"></span><span class="keyword" id="6966358">type</span>&nbsp;<span class="ident" id="6966363">index</span>&nbsp;<span class="ident" id="6966369">Index</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="6966376">func</span>&nbsp;<span class="op" id="6966381">(</span><span class="ident" id="6966382">x</span>&nbsp;<span class="op" id="6966384">*</span><span class="ident" id="6966385">index</span><span class="op" id="6966390">)</span>&nbsp;<span class="ident" id="6966392">Len</span><span class="op" id="6966395">(</span><span class="op" id="6966396">)</span>&nbsp;<span class="builtintype" id="6966398">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6966412">{</span>&nbsp;<span class="keyword" id="6966414">return</span>&nbsp;<span class="builtinfunc" id="6966421">len</span><span class="op" id="6966424">(</span><span class="ident" id="6966425">x</span><span class="op" id="6966426">.</span><span class="ident" id="6966427">sa</span><span class="op" id="6966429">)</span>&nbsp;<span class="op" id="6966431">}</span><br>
<span class="lineno"></span><span class="keyword" id="6966433">func</span>&nbsp;<span class="op" id="6966438">(</span><span class="ident" id="6966439">x</span>&nbsp;<span class="op" id="6966441">*</span><span class="ident" id="6966442">index</span><span class="op" id="6966447">)</span>&nbsp;<span class="ident" id="6966449">Less</span><span class="op" id="6966453">(</span><span class="ident" id="6966454">i</span><span class="op" id="6966455">,</span>&nbsp;<span class="ident" id="6966457">j</span>&nbsp;<span class="builtintype" id="6966459">int</span><span class="op" id="6966462">)</span>&nbsp;<span class="builtintype" id="6966464">bool</span>&nbsp;<span class="op" id="6966469">{</span>&nbsp;<span class="keyword" id="6966471">return</span>&nbsp;<span class="ident" id="6966478">bytes</span><span class="op" id="6966483">.</span><span class="ident" id="6966484">Compare</span><span class="op" id="6966491">(</span><span class="ident" id="6966492">x</span><span class="op" id="6966493">.</span><span class="ident" id="6966494">at</span><span class="op" id="6966496">(</span><span class="ident" id="6966497">i</span><span class="op" id="6966498">)</span><span class="op" id="6966499">,</span>&nbsp;<span class="ident" id="6966501">x</span><span class="op" id="6966502">.</span><span class="ident" id="6966503">at</span><span class="op" id="6966505">(</span><span class="ident" id="6966506">j</span><span class="op" id="6966507">)</span><span class="op" id="6966508">)</span>&nbsp;<span class="op" id="6966510">&lt;</span>&nbsp;<span class="num" id="6966512">0</span>&nbsp;<span class="op" id="6966514">}</span><br>
<span class="lineno"></span><span class="keyword" id="6966516">func</span>&nbsp;<span class="op" id="6966521">(</span><span class="ident" id="6966522">x</span>&nbsp;<span class="op" id="6966524">*</span><span class="ident" id="6966525">index</span><span class="op" id="6966530">)</span>&nbsp;<span class="ident" id="6966532">Swap</span><span class="op" id="6966536">(</span><span class="ident" id="6966537">i</span><span class="op" id="6966538">,</span>&nbsp;<span class="ident" id="6966540">j</span>&nbsp;<span class="builtintype" id="6966542">int</span><span class="op" id="6966545">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6966552">{</span>&nbsp;<span class="ident" id="6966554">x</span><span class="op" id="6966555">.</span><span class="ident" id="6966556">sa</span><span class="op" id="6966558">[</span><span class="ident" id="6966559">i</span><span class="op" id="6966560">]</span><span class="op" id="6966561">,</span>&nbsp;<span class="ident" id="6966563">x</span><span class="op" id="6966564">.</span><span class="ident" id="6966565">sa</span><span class="op" id="6966567">[</span><span class="ident" id="6966568">j</span><span class="op" id="6966569">]</span>&nbsp;<span class="op" id="6966571">=</span>&nbsp;<span class="ident" id="6966573">x</span><span class="op" id="6966574">.</span><span class="ident" id="6966575">sa</span><span class="op" id="6966577">[</span><span class="ident" id="6966578">j</span><span class="op" id="6966579">]</span><span class="op" id="6966580">,</span>&nbsp;<span class="ident" id="6966582">x</span><span class="op" id="6966583">.</span><span class="ident" id="6966584">sa</span><span class="op" id="6966586">[</span><span class="ident" id="6966587">i</span><span class="op" id="6966588">]</span>&nbsp;<span class="op" id="6966590">}</span><br>
<span class="lineno"></span><span class="keyword" id="6966592">func</span>&nbsp;<span class="op" id="6966597">(</span><span class="ident" id="6966598">a</span>&nbsp;<span class="op" id="6966600">*</span><span class="ident" id="6966601">index</span><span class="op" id="6966606">)</span>&nbsp;<span class="ident" id="6966608">at</span><span class="op" id="6966610">(</span><span class="ident" id="6966611">i</span>&nbsp;<span class="builtintype" id="6966613">int</span><span class="op" id="6966616">)</span>&nbsp;<span class="op" id="6966618">[</span><span class="op" id="6966619">]</span><span class="builtintype" id="6966620">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6966628">{</span>&nbsp;<span class="keyword" id="6966630">return</span>&nbsp;<span class="ident" id="6966637">a</span><span class="op" id="6966638">.</span><span class="ident" id="6966639">data</span><span class="op" id="6966643">[</span><span class="ident" id="6966644">a</span><span class="op" id="6966645">.</span><span class="ident" id="6966646">sa</span><span class="op" id="6966648">[</span><span class="ident" id="6966649">i</span><span class="op" id="6966650">]</span><span class="op" id="6966651">:</span><span class="op" id="6966652">]</span>&nbsp;<span class="op" id="6966654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="6966657">func</span>&nbsp;<span class="ident" id="6966662">testConstruction</span><span class="op" id="6966678">(</span><span class="ident" id="6966679">t</span>&nbsp;<span class="op" id="6966681">*</span><span class="ident" id="6966682">testing</span><span class="op" id="6966689">.</span><span class="ident" id="6966690">T</span><span class="op" id="6966691">,</span>&nbsp;<span class="ident" id="6966693">tc</span>&nbsp;<span class="op" id="6966696">*</span><span class="ident" id="6966697">testCase</span><span class="op" id="6966705">,</span>&nbsp;<span class="ident" id="6966707">x</span>&nbsp;<span class="op" id="6966709">*</span><span class="ident" id="6966710">Index</span><span class="op" id="6966715">)</span>&nbsp;<span class="op" id="6966717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6966720">if</span>&nbsp;<span class="op" id="6966723">!</span><span class="ident" id="6966724">sort</span><span class="op" id="6966728">.</span><span class="ident" id="6966729">IsSorted</span><span class="op" id="6966737">(</span><span class="op" id="6966738">(</span><span class="op" id="6966739">*</span><span class="ident" id="6966740">index</span><span class="op" id="6966745">)</span><span class="op" id="6966746">(</span><span class="ident" id="6966747">x</span><span class="op" id="6966748">)</span><span class="op" id="6966749">)</span>&nbsp;<span class="op" id="6966751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6966755">t</span><span class="op" id="6966756">.</span><span class="ident" id="6966757">Errorf</span><span class="op" id="6966763">(</span><span class="string" id="6966764">&#34;failed&nbsp;testConstruction&nbsp;%s&#34;</span><span class="op" id="6966792">,</span>&nbsp;<span class="ident" id="6966794">tc</span><span class="op" id="6966796">.</span><span class="ident" id="6966797">name</span><span class="op" id="6966801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6966804">}</span><br>
<span class="lineno"></span><span class="op" id="6966806">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="6966809">func</span>&nbsp;<span class="ident" id="6966814">equal</span><span class="op" id="6966819">(</span><span class="ident" id="6966820">x</span><span class="op" id="6966821">,</span>&nbsp;<span class="ident" id="6966823">y</span>&nbsp;<span class="op" id="6966825">*</span><span class="ident" id="6966826">Index</span><span class="op" id="6966831">)</span>&nbsp;<span class="builtintype" id="6966833">bool</span>&nbsp;<span class="op" id="6966838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6966841">if</span>&nbsp;<span class="op" id="6966844">!</span><span class="ident" id="6966845">bytes</span><span class="op" id="6966850">.</span><span class="ident" id="6966851">Equal</span><span class="op" id="6966856">(</span><span class="ident" id="6966857">x</span><span class="op" id="6966858">.</span><span class="ident" id="6966859">data</span><span class="op" id="6966863">,</span>&nbsp;<span class="ident" id="6966865">y</span><span class="op" id="6966866">.</span><span class="ident" id="6966867">data</span><span class="op" id="6966871">)</span>&nbsp;<span class="op" id="6966873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6966877">return</span>&nbsp;<span class="builtintype" id="6966884">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6966891">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6966894">for</span>&nbsp;<span class="ident" id="6966898">i</span><span class="op" id="6966899">,</span>&nbsp;<span class="ident" id="6966901">j</span>&nbsp;<span class="op" id="6966903">:=</span>&nbsp;<span class="keyword" id="6966906">range</span>&nbsp;<span class="ident" id="6966912">x</span><span class="op" id="6966913">.</span><span class="ident" id="6966914">sa</span>&nbsp;<span class="op" id="6966917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6966921">if</span>&nbsp;<span class="ident" id="6966924">j</span>&nbsp;<span class="op" id="6966926">!=</span>&nbsp;<span class="ident" id="6966929">y</span><span class="op" id="6966930">.</span><span class="ident" id="6966931">sa</span><span class="op" id="6966933">[</span><span class="ident" id="6966934">i</span><span class="op" id="6966935">]</span>&nbsp;<span class="op" id="6966937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6966942">return</span>&nbsp;<span class="builtintype" id="6966949">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6966957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6966960">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6966963">return</span>&nbsp;<span class="builtintype" id="6966970">true</span><br>
<span class="lineno"></span><span class="op" id="6966975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6966978">//&nbsp;returns&nbsp;the&nbsp;serialized&nbsp;index&nbsp;size</span><br>
<span class="lineno"></span><span class="keyword" id="6967015">func</span>&nbsp;<span class="ident" id="6967020">testSaveRestore</span><span class="op" id="6967035">(</span><span class="ident" id="6967036">t</span>&nbsp;<span class="op" id="6967038">*</span><span class="ident" id="6967039">testing</span><span class="op" id="6967046">.</span><span class="ident" id="6967047">T</span><span class="op" id="6967048">,</span>&nbsp;<span class="ident" id="6967050">tc</span>&nbsp;<span class="op" id="6967053">*</span><span class="ident" id="6967054">testCase</span><span class="op" id="6967062">,</span>&nbsp;<span class="ident" id="6967064">x</span>&nbsp;<span class="op" id="6967066">*</span><span class="ident" id="6967067">Index</span><span class="op" id="6967072">)</span>&nbsp;<span class="builtintype" id="6967074">int</span>&nbsp;<span class="op" id="6967078">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6967081">var</span>&nbsp;<span class="ident" id="6967085">buf</span>&nbsp;<span class="ident" id="6967089">bytes</span><span class="op" id="6967094">.</span><span class="ident" id="6967095">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6967103">if</span>&nbsp;<span class="ident" id="6967106">err</span>&nbsp;<span class="op" id="6967110">:=</span>&nbsp;<span class="ident" id="6967113">x</span><span class="op" id="6967114">.</span><span class="ident" id="6967115">Write</span><span class="op" id="6967120">(</span><span class="op" id="6967121">&amp;</span><span class="ident" id="6967122">buf</span><span class="op" id="6967125">)</span><span class="op" id="6967126">;</span>&nbsp;<span class="ident" id="6967128">err</span>&nbsp;<span class="op" id="6967132">!=</span>&nbsp;<span class="ident" id="6967135">nil</span>&nbsp;<span class="op" id="6967139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6967143">t</span><span class="op" id="6967144">.</span><span class="ident" id="6967145">Errorf</span><span class="op" id="6967151">(</span><span class="string" id="6967152">&#34;failed&nbsp;writing&nbsp;index&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="6967182">,</span>&nbsp;<span class="ident" id="6967184">tc</span><span class="op" id="6967186">.</span><span class="ident" id="6967187">name</span><span class="op" id="6967191">,</span>&nbsp;<span class="ident" id="6967193">err</span><span class="op" id="6967196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6967199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6967202">size</span>&nbsp;<span class="op" id="6967207">:=</span>&nbsp;<span class="ident" id="6967210">buf</span><span class="op" id="6967213">.</span><span class="ident" id="6967214">Len</span><span class="op" id="6967217">(</span><span class="op" id="6967218">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6967221">var</span>&nbsp;<span class="ident" id="6967225">y</span>&nbsp;<span class="ident" id="6967227">Index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6967234">if</span>&nbsp;<span class="ident" id="6967237">err</span>&nbsp;<span class="op" id="6967241">:=</span>&nbsp;<span class="ident" id="6967244">y</span><span class="op" id="6967245">.</span><span class="ident" id="6967246">Read</span><span class="op" id="6967250">(</span><span class="op" id="6967251">&amp;</span><span class="ident" id="6967252">buf</span><span class="op" id="6967255">)</span><span class="op" id="6967256">;</span>&nbsp;<span class="ident" id="6967258">err</span>&nbsp;<span class="op" id="6967262">!=</span>&nbsp;<span class="ident" id="6967265">nil</span>&nbsp;<span class="op" id="6967269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6967273">t</span><span class="op" id="6967274">.</span><span class="ident" id="6967275">Errorf</span><span class="op" id="6967281">(</span><span class="string" id="6967282">&#34;failed&nbsp;reading&nbsp;index&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="6967312">,</span>&nbsp;<span class="ident" id="6967314">tc</span><span class="op" id="6967316">.</span><span class="ident" id="6967317">name</span><span class="op" id="6967321">,</span>&nbsp;<span class="ident" id="6967323">err</span><span class="op" id="6967326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6967329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6967332">if</span>&nbsp;<span class="op" id="6967335">!</span><span class="ident" id="6967336">equal</span><span class="op" id="6967341">(</span><span class="ident" id="6967342">x</span><span class="op" id="6967343">,</span>&nbsp;<span class="op" id="6967345">&amp;</span><span class="ident" id="6967346">y</span><span class="op" id="6967347">)</span>&nbsp;<span class="op" id="6967349">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6967353">t</span><span class="op" id="6967354">.</span><span class="ident" id="6967355">Errorf</span><span class="op" id="6967361">(</span><span class="string" id="6967362">&#34;restored&nbsp;index&nbsp;doesn&#39;t&nbsp;match&nbsp;saved&nbsp;index&nbsp;%s&#34;</span><span class="op" id="6967407">,</span>&nbsp;<span class="ident" id="6967409">tc</span><span class="op" id="6967411">.</span><span class="ident" id="6967412">name</span><span class="op" id="6967416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6967419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6967422">return</span>&nbsp;<span class="ident" id="6967429">size</span><br>
<span class="lineno"></span><span class="op" id="6967434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="6967437">func</span>&nbsp;<span class="ident" id="6967442">TestIndex</span><span class="op" id="6967451">(</span><span class="ident" id="6967452">t</span>&nbsp;<span class="op" id="6967454">*</span><span class="ident" id="6967455">testing</span><span class="op" id="6967462">.</span><span class="ident" id="6967463">T</span><span class="op" id="6967464">)</span>&nbsp;<span class="op" id="6967466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6967469">for</span>&nbsp;<span class="ident" id="6967473">_</span><span class="op" id="6967474">,</span>&nbsp;<span class="ident" id="6967476">tc</span>&nbsp;<span class="op" id="6967479">:=</span>&nbsp;<span class="keyword" id="6967482">range</span>&nbsp;<span class="ident" id="6967488">testCases</span>&nbsp;<span class="op" id="6967498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6967502">x</span>&nbsp;<span class="op" id="6967504">:=</span>&nbsp;<span class="ident" id="6967507">New</span><span class="op" id="6967510">(</span><span class="op" id="6967511">[</span><span class="op" id="6967512">]</span><span class="builtintype" id="6967513">byte</span><span class="op" id="6967517">(</span><span class="ident" id="6967518">tc</span><span class="op" id="6967520">.</span><span class="ident" id="6967521">source</span><span class="op" id="6967527">)</span><span class="op" id="6967528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6967532">testConstruction</span><span class="op" id="6967548">(</span><span class="ident" id="6967549">t</span><span class="op" id="6967550">,</span>&nbsp;<span class="op" id="6967552">&amp;</span><span class="ident" id="6967553">tc</span><span class="op" id="6967555">,</span>&nbsp;<span class="ident" id="6967557">x</span><span class="op" id="6967558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6967562">testSaveRestore</span><span class="op" id="6967577">(</span><span class="ident" id="6967578">t</span><span class="op" id="6967579">,</span>&nbsp;<span class="op" id="6967581">&amp;</span><span class="ident" id="6967582">tc</span><span class="op" id="6967584">,</span>&nbsp;<span class="ident" id="6967586">x</span><span class="op" id="6967587">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6967591">testLookups</span><span class="op" id="6967602">(</span><span class="ident" id="6967603">t</span><span class="op" id="6967604">,</span>&nbsp;<span class="op" id="6967606">&amp;</span><span class="ident" id="6967607">tc</span><span class="op" id="6967609">,</span>&nbsp;<span class="ident" id="6967611">x</span><span class="op" id="6967612">,</span>&nbsp;<span class="num" id="6967614">0</span><span class="op" id="6967615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6967619">testLookups</span><span class="op" id="6967630">(</span><span class="ident" id="6967631">t</span><span class="op" id="6967632">,</span>&nbsp;<span class="op" id="6967634">&amp;</span><span class="ident" id="6967635">tc</span><span class="op" id="6967637">,</span>&nbsp;<span class="ident" id="6967639">x</span><span class="op" id="6967640">,</span>&nbsp;<span class="num" id="6967642">1</span><span class="op" id="6967643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6967647">testLookups</span><span class="op" id="6967658">(</span><span class="ident" id="6967659">t</span><span class="op" id="6967660">,</span>&nbsp;<span class="op" id="6967662">&amp;</span><span class="ident" id="6967663">tc</span><span class="op" id="6967665">,</span>&nbsp;<span class="ident" id="6967667">x</span><span class="op" id="6967668">,</span>&nbsp;<span class="num" id="6967670">10</span><span class="op" id="6967672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6967676">testLookups</span><span class="op" id="6967687">(</span><span class="ident" id="6967688">t</span><span class="op" id="6967689">,</span>&nbsp;<span class="op" id="6967691">&amp;</span><span class="ident" id="6967692">tc</span><span class="op" id="6967694">,</span>&nbsp;<span class="ident" id="6967696">x</span><span class="op" id="6967697">,</span>&nbsp;<span class="num" id="6967699">2e9</span><span class="op" id="6967702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6967706">testLookups</span><span class="op" id="6967717">(</span><span class="ident" id="6967718">t</span><span class="op" id="6967719">,</span>&nbsp;<span class="op" id="6967721">&amp;</span><span class="ident" id="6967722">tc</span><span class="op" id="6967724">,</span>&nbsp;<span class="ident" id="6967726">x</span><span class="op" id="6967727">,</span>&nbsp;<span class="op" id="6967729">-</span><span class="num" id="6967730">1</span><span class="op" id="6967731">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6967734">}</span><br>
<span class="lineno"></span><span class="op" id="6967736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6967739">//&nbsp;Of&nbsp;all&nbsp;possible&nbsp;inputs,&nbsp;the&nbsp;random&nbsp;bytes&nbsp;have&nbsp;the&nbsp;least&nbsp;amount&nbsp;of&nbsp;substring</span><br>
<span class="lineno"></span><span class="comment" id="6967818">//&nbsp;repetition,&nbsp;and&nbsp;the&nbsp;repeated&nbsp;bytes&nbsp;have&nbsp;the&nbsp;most.&nbsp;For&nbsp;most&nbsp;algorithms,</span><br>
<span class="lineno">265</span><span class="comment" id="6967892">//&nbsp;the&nbsp;running&nbsp;time&nbsp;of&nbsp;every&nbsp;input&nbsp;will&nbsp;be&nbsp;between&nbsp;these&nbsp;two.</span><br>
<span class="lineno"></span><span class="keyword" id="6967954">func</span>&nbsp;<span class="ident" id="6967959">benchmarkNew</span><span class="op" id="6967971">(</span><span class="ident" id="6967972">b</span>&nbsp;<span class="op" id="6967974">*</span><span class="ident" id="6967975">testing</span><span class="op" id="6967982">.</span><span class="ident" id="6967983">B</span><span class="op" id="6967984">,</span>&nbsp;<span class="ident" id="6967986">random</span>&nbsp;<span class="builtintype" id="6967993">bool</span><span class="op" id="6967997">)</span>&nbsp;<span class="op" id="6967999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968002">b</span><span class="op" id="6968003">.</span><span class="ident" id="6968004">StopTimer</span><span class="op" id="6968013">(</span><span class="op" id="6968014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968017">data</span>&nbsp;<span class="op" id="6968022">:=</span>&nbsp;<span class="builtinfunc" id="6968025">make</span><span class="op" id="6968029">(</span><span class="op" id="6968030">[</span><span class="op" id="6968031">]</span><span class="builtintype" id="6968032">byte</span><span class="op" id="6968036">,</span>&nbsp;<span class="num" id="6968038">1e6</span><span class="op" id="6968041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6968044">if</span>&nbsp;<span class="ident" id="6968047">random</span>&nbsp;<span class="op" id="6968054">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6968058">for</span>&nbsp;<span class="ident" id="6968062">i</span>&nbsp;<span class="op" id="6968064">:=</span>&nbsp;<span class="keyword" id="6968067">range</span>&nbsp;<span class="ident" id="6968073">data</span>&nbsp;<span class="op" id="6968078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968083">data</span><span class="op" id="6968087">[</span><span class="ident" id="6968088">i</span><span class="op" id="6968089">]</span>&nbsp;<span class="op" id="6968091">=</span>&nbsp;<span class="builtintype" id="6968093">byte</span><span class="op" id="6968097">(</span><span class="ident" id="6968098">rand</span><span class="op" id="6968102">.</span><span class="ident" id="6968103">Intn</span><span class="op" id="6968107">(</span><span class="num" id="6968108">256</span><span class="op" id="6968111">)</span><span class="op" id="6968112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6968116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6968119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968122">b</span><span class="op" id="6968123">.</span><span class="ident" id="6968124">StartTimer</span><span class="op" id="6968134">(</span><span class="op" id="6968135">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6968138">for</span>&nbsp;<span class="ident" id="6968142">i</span>&nbsp;<span class="op" id="6968144">:=</span>&nbsp;<span class="num" id="6968147">0</span><span class="op" id="6968148">;</span>&nbsp;<span class="ident" id="6968150">i</span>&nbsp;<span class="op" id="6968152">&lt;</span>&nbsp;<span class="ident" id="6968154">b</span><span class="op" id="6968155">.</span><span class="ident" id="6968156">N</span><span class="op" id="6968157">;</span>&nbsp;<span class="ident" id="6968159">i</span><span class="op" id="6968160">++</span>&nbsp;<span class="op" id="6968163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968167">New</span><span class="op" id="6968170">(</span><span class="ident" id="6968171">data</span><span class="op" id="6968175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6968178">}</span><br>
<span class="lineno"></span><span class="op" id="6968180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="6968183">func</span>&nbsp;<span class="ident" id="6968188">BenchmarkNewIndexRandom</span><span class="op" id="6968211">(</span><span class="ident" id="6968212">b</span>&nbsp;<span class="op" id="6968214">*</span><span class="ident" id="6968215">testing</span><span class="op" id="6968222">.</span><span class="ident" id="6968223">B</span><span class="op" id="6968224">)</span>&nbsp;<span class="op" id="6968226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968229">benchmarkNew</span><span class="op" id="6968241">(</span><span class="ident" id="6968242">b</span><span class="op" id="6968243">,</span>&nbsp;<span class="builtintype" id="6968245">true</span><span class="op" id="6968249">)</span><br>
<span class="lineno"></span><span class="op" id="6968251">}</span><br>
<span class="lineno"></span><span class="keyword" id="6968253">func</span>&nbsp;<span class="ident" id="6968258">BenchmarkNewIndexRepeat</span><span class="op" id="6968281">(</span><span class="ident" id="6968282">b</span>&nbsp;<span class="op" id="6968284">*</span><span class="ident" id="6968285">testing</span><span class="op" id="6968292">.</span><span class="ident" id="6968293">B</span><span class="op" id="6968294">)</span>&nbsp;<span class="op" id="6968296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968299">benchmarkNew</span><span class="op" id="6968311">(</span><span class="ident" id="6968312">b</span><span class="op" id="6968313">,</span>&nbsp;<span class="builtintype" id="6968315">false</span><span class="op" id="6968320">)</span><br>
<span class="lineno">285</span><span class="op" id="6968322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6968325">func</span>&nbsp;<span class="ident" id="6968330">BenchmarkSaveRestore</span><span class="op" id="6968350">(</span><span class="ident" id="6968351">b</span>&nbsp;<span class="op" id="6968353">*</span><span class="ident" id="6968354">testing</span><span class="op" id="6968361">.</span><span class="ident" id="6968362">B</span><span class="op" id="6968363">)</span>&nbsp;<span class="op" id="6968365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968368">b</span><span class="op" id="6968369">.</span><span class="ident" id="6968370">StopTimer</span><span class="op" id="6968379">(</span><span class="op" id="6968380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968383">r</span>&nbsp;<span class="op" id="6968385">:=</span>&nbsp;<span class="ident" id="6968388">rand</span><span class="op" id="6968392">.</span><span class="ident" id="6968393">New</span><span class="op" id="6968396">(</span><span class="ident" id="6968397">rand</span><span class="op" id="6968401">.</span><span class="ident" id="6968402">NewSource</span><span class="op" id="6968411">(</span><span class="num" id="6968412">0x5a77a1</span><span class="op" id="6968420">)</span><span class="op" id="6968421">)</span>&nbsp;<span class="comment" id="6968423">//&nbsp;guarantee&nbsp;always&nbsp;same&nbsp;sequence</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968458">data</span>&nbsp;<span class="op" id="6968463">:=</span>&nbsp;<span class="builtinfunc" id="6968466">make</span><span class="op" id="6968470">(</span><span class="op" id="6968471">[</span><span class="op" id="6968472">]</span><span class="builtintype" id="6968473">byte</span><span class="op" id="6968477">,</span>&nbsp;<span class="num" id="6968479">1</span><span class="op" id="6968480">&lt;&lt;</span><span class="num" id="6968482">20</span><span class="op" id="6968484">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6968498">//&nbsp;1MB&nbsp;of&nbsp;data&nbsp;to&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6968523">for</span>&nbsp;<span class="ident" id="6968527">i</span>&nbsp;<span class="op" id="6968529">:=</span>&nbsp;<span class="keyword" id="6968532">range</span>&nbsp;<span class="ident" id="6968538">data</span>&nbsp;<span class="op" id="6968543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968547">data</span><span class="op" id="6968551">[</span><span class="ident" id="6968552">i</span><span class="op" id="6968553">]</span>&nbsp;<span class="op" id="6968555">=</span>&nbsp;<span class="builtintype" id="6968557">byte</span><span class="op" id="6968561">(</span><span class="ident" id="6968562">r</span><span class="op" id="6968563">.</span><span class="ident" id="6968564">Intn</span><span class="op" id="6968568">(</span><span class="num" id="6968569">256</span><span class="op" id="6968572">)</span><span class="op" id="6968573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6968576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968579">x</span>&nbsp;<span class="op" id="6968581">:=</span>&nbsp;<span class="ident" id="6968584">New</span><span class="op" id="6968587">(</span><span class="ident" id="6968588">data</span><span class="op" id="6968592">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968595">size</span>&nbsp;<span class="op" id="6968600">:=</span>&nbsp;<span class="ident" id="6968603">testSaveRestore</span><span class="op" id="6968618">(</span><span class="ident" id="6968619">nil</span><span class="op" id="6968622">,</span>&nbsp;<span class="ident" id="6968624">nil</span><span class="op" id="6968627">,</span>&nbsp;<span class="ident" id="6968629">x</span><span class="op" id="6968630">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6968638">//&nbsp;verify&nbsp;correctness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968661">buf</span>&nbsp;<span class="op" id="6968665">:=</span>&nbsp;<span class="ident" id="6968668">bytes</span><span class="op" id="6968673">.</span><span class="ident" id="6968674">NewBuffer</span><span class="op" id="6968683">(</span><span class="builtinfunc" id="6968684">make</span><span class="op" id="6968688">(</span><span class="op" id="6968689">[</span><span class="op" id="6968690">]</span><span class="builtintype" id="6968691">byte</span><span class="op" id="6968695">,</span>&nbsp;<span class="ident" id="6968697">size</span><span class="op" id="6968701">)</span><span class="op" id="6968702">)</span>&nbsp;<span class="comment" id="6968704">//&nbsp;avoid&nbsp;growing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968722">b</span><span class="op" id="6968723">.</span><span class="ident" id="6968724">SetBytes</span><span class="op" id="6968732">(</span><span class="ident" id="6968733">int64</span><span class="op" id="6968738">(</span><span class="ident" id="6968739">size</span><span class="op" id="6968743">)</span><span class="op" id="6968744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968747">b</span><span class="op" id="6968748">.</span><span class="ident" id="6968749">StartTimer</span><span class="op" id="6968759">(</span><span class="op" id="6968760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6968763">for</span>&nbsp;<span class="ident" id="6968767">i</span>&nbsp;<span class="op" id="6968769">:=</span>&nbsp;<span class="num" id="6968772">0</span><span class="op" id="6968773">;</span>&nbsp;<span class="ident" id="6968775">i</span>&nbsp;<span class="op" id="6968777">&lt;</span>&nbsp;<span class="ident" id="6968779">b</span><span class="op" id="6968780">.</span><span class="ident" id="6968781">N</span><span class="op" id="6968782">;</span>&nbsp;<span class="ident" id="6968784">i</span><span class="op" id="6968785">++</span>&nbsp;<span class="op" id="6968788">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968792">x</span><span class="op" id="6968793">.</span><span class="ident" id="6968794">Write</span><span class="op" id="6968799">(</span><span class="ident" id="6968800">buf</span><span class="op" id="6968803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6968807">var</span>&nbsp;<span class="ident" id="6968811">y</span>&nbsp;<span class="ident" id="6968813">Index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6968821">y</span><span class="op" id="6968822">.</span><span class="ident" id="6968823">Read</span><span class="op" id="6968827">(</span><span class="ident" id="6968828">buf</span><span class="op" id="6968831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6968834">}</span><br>
<span class="lineno"></span><span class="op" id="6968836">}</span>
</div>
</body>
</html>
