<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html" class="current">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1667419">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1667474">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1667528">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1667579">package</span>&nbsp;<span class="ident" id="1667587">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1667596">import</span>&nbsp;<span class="string" id="1667603">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1667613">func</span>&nbsp;<span class="ident" id="1667618">newsysmon</span><span class="op" id="1667627">(</span><span class="op" id="1667628">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1667631">func</span>&nbsp;<span class="ident" id="1667636">runtime_init</span><span class="op" id="1667648">(</span><span class="op" id="1667649">)</span><br>
<span class="lineno"></span><span class="keyword" id="1667651">func</span>&nbsp;<span class="ident" id="1667656">main_init</span><span class="op" id="1667665">(</span><span class="op" id="1667666">)</span><br>
<span class="lineno"></span><span class="keyword" id="1667668">func</span>&nbsp;<span class="ident" id="1667673">main_main</span><span class="op" id="1667682">(</span><span class="op" id="1667683">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1667686">//&nbsp;The&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="1667709">func</span>&nbsp;<span class="ident" id="1667714">main</span><span class="op" id="1667718">(</span><span class="op" id="1667719">)</span>&nbsp;<span class="op" id="1667721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667724">g</span>&nbsp;<span class="op" id="1667726">:=</span>&nbsp;<span class="ident" id="1667729">getg</span><span class="op" id="1667733">(</span><span class="op" id="1667734">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1667738">//&nbsp;Racectx&nbsp;of&nbsp;m0-&gt;g0&nbsp;is&nbsp;used&nbsp;only&nbsp;as&nbsp;the&nbsp;parent&nbsp;of&nbsp;the&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1667810">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;used&nbsp;for&nbsp;anything&nbsp;else.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667853">g</span><span class="op" id="1667854">.</span><span class="ident" id="1667855">m</span><span class="op" id="1667856">.</span><span class="ident" id="1667857">g0</span><span class="op" id="1667859">.</span><span class="ident" id="1667860">racectx</span>&nbsp;<span class="op" id="1667868">=</span>&nbsp;<span class="num" id="1667870">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1667874">//&nbsp;Max&nbsp;stack&nbsp;size&nbsp;is&nbsp;1&nbsp;GB&nbsp;on&nbsp;64-bit,&nbsp;250&nbsp;MB&nbsp;on&nbsp;32-bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1667930">//&nbsp;Using&nbsp;decimal&nbsp;instead&nbsp;of&nbsp;binary&nbsp;GB&nbsp;and&nbsp;MB&nbsp;because</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1667984">//&nbsp;they&nbsp;look&nbsp;nicer&nbsp;in&nbsp;the&nbsp;stack&nbsp;overflow&nbsp;failure&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1668043">if</span>&nbsp;<span class="ident" id="1668046">ptrSize</span>&nbsp;<span class="op" id="1668054">==</span>&nbsp;<span class="num" id="1668057">8</span>&nbsp;<span class="op" id="1668059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668063">maxstacksize</span>&nbsp;<span class="op" id="1668076">=</span>&nbsp;<span class="num" id="1668078">1000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1668090">}</span>&nbsp;<span class="keyword" id="1668092">else</span>&nbsp;<span class="op" id="1668097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668101">maxstacksize</span>&nbsp;<span class="op" id="1668114">=</span>&nbsp;<span class="num" id="1668116">250000000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1668127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668131">onM</span><span class="op" id="1668134">(</span><span class="ident" id="1668135">newsysmon</span><span class="op" id="1668144">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1668148">//&nbsp;Lock&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;onto&nbsp;this,&nbsp;the&nbsp;main&nbsp;OS&nbsp;thread,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1668207">//&nbsp;during&nbsp;initialization.&nbsp;&nbsp;Most&nbsp;programs&nbsp;won&#39;t&nbsp;care,&nbsp;but&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1668271">//&nbsp;do&nbsp;require&nbsp;certain&nbsp;calls&nbsp;to&nbsp;be&nbsp;made&nbsp;by&nbsp;the&nbsp;main&nbsp;thread.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1668331">//&nbsp;Those&nbsp;can&nbsp;arrange&nbsp;for&nbsp;main.main&nbsp;to&nbsp;run&nbsp;in&nbsp;the&nbsp;main&nbsp;thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1668393">//&nbsp;by&nbsp;calling&nbsp;runtime.LockOSThread&nbsp;during&nbsp;initialization</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1668451">//&nbsp;to&nbsp;preserve&nbsp;the&nbsp;lock.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668477">lockOSThread</span><span class="op" id="1668489">(</span><span class="op" id="1668490">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1668494">if</span>&nbsp;<span class="ident" id="1668497">g</span><span class="op" id="1668498">.</span><span class="ident" id="1668499">m</span>&nbsp;<span class="op" id="1668501">!=</span>&nbsp;<span class="op" id="1668504">&amp;</span><span class="ident" id="1668505">m0</span>&nbsp;<span class="op" id="1668508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668512">gothrow</span><span class="op" id="1668519">(</span><span class="string" id="1668520">&#34;runtime.main&nbsp;not&nbsp;on&nbsp;m0&#34;</span><span class="op" id="1668544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1668547">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668551">runtime_init</span><span class="op" id="1668563">(</span><span class="op" id="1668564">)</span>&nbsp;<span class="comment" id="1668566">//&nbsp;must&nbsp;be&nbsp;before&nbsp;defer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1668592">//&nbsp;Defer&nbsp;unlock&nbsp;so&nbsp;that&nbsp;runtime.Goexit&nbsp;during&nbsp;init&nbsp;does&nbsp;the&nbsp;unlock&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668665">needUnlock</span>&nbsp;<span class="op" id="1668676">:=</span>&nbsp;<span class="builtintype" id="1668679">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1668685">defer</span>&nbsp;<span class="keyword" id="1668691">func</span><span class="op" id="1668695">(</span><span class="op" id="1668696">)</span>&nbsp;<span class="op" id="1668698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1668702">if</span>&nbsp;<span class="ident" id="1668705">needUnlock</span>&nbsp;<span class="op" id="1668716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668721">unlockOSThread</span><span class="op" id="1668735">(</span><span class="op" id="1668736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1668740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1668743">}</span><span class="op" id="1668744">(</span><span class="op" id="1668745">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668749">memstats</span><span class="op" id="1668757">.</span><span class="ident" id="1668758">enablegc</span>&nbsp;<span class="op" id="1668767">=</span>&nbsp;<span class="builtintype" id="1668769">true</span>&nbsp;<span class="comment" id="1668774">//&nbsp;now&nbsp;that&nbsp;runtime&nbsp;is&nbsp;initialized,&nbsp;GC&nbsp;is&nbsp;okay</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668823">main_init</span><span class="op" id="1668832">(</span><span class="op" id="1668833">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668837">needUnlock</span>&nbsp;<span class="op" id="1668848">=</span>&nbsp;<span class="builtintype" id="1668850">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668857">unlockOSThread</span><span class="op" id="1668871">(</span><span class="op" id="1668872">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668876">main_main</span><span class="op" id="1668885">(</span><span class="op" id="1668886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1668889">if</span>&nbsp;<span class="ident" id="1668892">raceenabled</span>&nbsp;<span class="op" id="1668904">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668908">racefini</span><span class="op" id="1668916">(</span><span class="op" id="1668917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1668920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1668924">//&nbsp;Make&nbsp;racy&nbsp;client&nbsp;program&nbsp;work:&nbsp;if&nbsp;panicking&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1668975">//&nbsp;another&nbsp;goroutine&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;as&nbsp;main&nbsp;returns,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1669031">//&nbsp;let&nbsp;the&nbsp;other&nbsp;goroutine&nbsp;finish&nbsp;printing&nbsp;the&nbsp;panic&nbsp;trace.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1669092">//&nbsp;Once&nbsp;it&nbsp;does,&nbsp;it&nbsp;will&nbsp;exit.&nbsp;See&nbsp;issue&nbsp;3934.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669140">if</span>&nbsp;<span class="ident" id="1669143">panicking</span>&nbsp;<span class="op" id="1669153">!=</span>&nbsp;<span class="num" id="1669156">0</span>&nbsp;<span class="op" id="1669158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669162">gopark</span><span class="op" id="1669168">(</span><span class="ident" id="1669169">nil</span><span class="op" id="1669172">,</span>&nbsp;<span class="ident" id="1669174">nil</span><span class="op" id="1669177">,</span>&nbsp;<span class="string" id="1669179">&#34;panicwait&#34;</span><span class="op" id="1669190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669193">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669197">exit</span><span class="op" id="1669201">(</span><span class="num" id="1669202">0</span><span class="op" id="1669203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669206">for</span>&nbsp;<span class="op" id="1669210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669214">var</span>&nbsp;<span class="ident" id="1669218">x</span>&nbsp;<span class="op" id="1669220">*</span><span class="builtintype" id="1669221">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669229">*</span><span class="ident" id="1669230">x</span>&nbsp;<span class="op" id="1669232">=</span>&nbsp;<span class="num" id="1669234">0</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669237">}</span><br>
<span class="lineno"></span><span class="op" id="1669239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1669242">var</span>&nbsp;<span class="ident" id="1669246">parkunlock_c</span>&nbsp;<span class="builtintype" id="1669259">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1669265">//&nbsp;start&nbsp;forcegc&nbsp;helper&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="keyword" id="1669299">func</span>&nbsp;<span class="ident" id="1669304">init</span><span class="op" id="1669308">(</span><span class="op" id="1669309">)</span>&nbsp;<span class="op" id="1669311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669314">go</span>&nbsp;<span class="ident" id="1669317">forcegchelper</span><span class="op" id="1669330">(</span><span class="op" id="1669331">)</span><br>
<span class="lineno"></span><span class="op" id="1669333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="1669336">func</span>&nbsp;<span class="ident" id="1669341">forcegchelper</span><span class="op" id="1669354">(</span><span class="op" id="1669355">)</span>&nbsp;<span class="op" id="1669357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669360">forcegc</span><span class="op" id="1669367">.</span><span class="ident" id="1669368">g</span>&nbsp;<span class="op" id="1669370">=</span>&nbsp;<span class="ident" id="1669372">getg</span><span class="op" id="1669376">(</span><span class="op" id="1669377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669380">forcegc</span><span class="op" id="1669387">.</span><span class="ident" id="1669388">g</span><span class="op" id="1669389">.</span><span class="ident" id="1669390">issystem</span>&nbsp;<span class="op" id="1669399">=</span>&nbsp;<span class="builtintype" id="1669401">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669407">for</span>&nbsp;<span class="op" id="1669411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669415">lock</span><span class="op" id="1669419">(</span><span class="op" id="1669420">&amp;</span><span class="ident" id="1669421">forcegc</span><span class="op" id="1669428">.</span><span class="ident" id="1669429">lock</span><span class="op" id="1669433">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669437">if</span>&nbsp;<span class="ident" id="1669440">forcegc</span><span class="op" id="1669447">.</span><span class="ident" id="1669448">idle</span>&nbsp;<span class="op" id="1669453">!=</span>&nbsp;<span class="num" id="1669456">0</span>&nbsp;<span class="op" id="1669458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669463">gothrow</span><span class="op" id="1669470">(</span><span class="string" id="1669471">&#34;forcegc:&nbsp;phase&nbsp;error&#34;</span><span class="op" id="1669493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669501">atomicstore</span><span class="op" id="1669512">(</span><span class="op" id="1669513">&amp;</span><span class="ident" id="1669514">forcegc</span><span class="op" id="1669521">.</span><span class="ident" id="1669522">idle</span><span class="op" id="1669526">,</span>&nbsp;<span class="num" id="1669528">1</span><span class="op" id="1669529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669533">goparkunlock</span><span class="op" id="1669545">(</span><span class="op" id="1669546">&amp;</span><span class="ident" id="1669547">forcegc</span><span class="op" id="1669554">.</span><span class="ident" id="1669555">lock</span><span class="op" id="1669559">,</span>&nbsp;<span class="string" id="1669561">&#34;force&nbsp;gc&nbsp;(idle)&#34;</span><span class="op" id="1669578">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1669582">//&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;explicitly&nbsp;resumed&nbsp;by&nbsp;sysmon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669634">if</span>&nbsp;<span class="ident" id="1669637">debug</span><span class="op" id="1669642">.</span><span class="ident" id="1669643">gctrace</span>&nbsp;<span class="op" id="1669651">&gt;</span>&nbsp;<span class="num" id="1669653">0</span>&nbsp;<span class="op" id="1669655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1669660">println</span><span class="op" id="1669667">(</span><span class="string" id="1669668">&#34;GC&nbsp;forced&#34;</span><span class="op" id="1669679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669687">gogc</span><span class="op" id="1669691">(</span><span class="num" id="1669692">1</span><span class="op" id="1669693">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669696">}</span><br>
<span class="lineno"></span><span class="op" id="1669698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1669701">//go:nosplit</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1669715">//&nbsp;Gosched&nbsp;yields&nbsp;the&nbsp;processor,&nbsp;allowing&nbsp;other&nbsp;goroutines&nbsp;to&nbsp;run.&nbsp;&nbsp;It&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="1669795">//&nbsp;suspend&nbsp;the&nbsp;current&nbsp;goroutine,&nbsp;so&nbsp;execution&nbsp;resumes&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="keyword" id="1669865">func</span>&nbsp;<span class="ident" id="1669870">Gosched</span><span class="op" id="1669877">(</span><span class="op" id="1669878">)</span>&nbsp;<span class="op" id="1669880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669883">mcall</span><span class="op" id="1669888">(</span><span class="ident" id="1669889">gosched_m</span><span class="op" id="1669898">)</span><br>
<span class="lineno"></span><span class="op" id="1669900">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1669903">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;calls&nbsp;unlockf.</span><br>
<span class="lineno"></span><span class="comment" id="1669973">//&nbsp;If&nbsp;unlockf&nbsp;returns&nbsp;false,&nbsp;the&nbsp;goroutine&nbsp;is&nbsp;resumed.</span><br>
<span class="lineno"></span><span class="keyword" id="1670028">func</span>&nbsp;<span class="ident" id="1670033">gopark</span><span class="op" id="1670039">(</span><span class="ident" id="1670040">unlockf</span>&nbsp;<span class="ident" id="1670048">unsafe</span><span class="op" id="1670054">.</span><span class="ident" id="1670055">Pointer</span><span class="op" id="1670062">,</span>&nbsp;<span class="ident" id="1670064">lock</span>&nbsp;<span class="ident" id="1670069">unsafe</span><span class="op" id="1670075">.</span><span class="ident" id="1670076">Pointer</span><span class="op" id="1670083">,</span>&nbsp;<span class="ident" id="1670085">reason</span>&nbsp;<span class="builtintype" id="1670092">string</span><span class="op" id="1670098">)</span>&nbsp;<span class="op" id="1670100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670103">mp</span>&nbsp;<span class="op" id="1670106">:=</span>&nbsp;<span class="ident" id="1670109">acquirem</span><span class="op" id="1670117">(</span><span class="op" id="1670118">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670121">gp</span>&nbsp;<span class="op" id="1670124">:=</span>&nbsp;<span class="ident" id="1670127">mp</span><span class="op" id="1670129">.</span><span class="ident" id="1670130">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670136">status</span>&nbsp;<span class="op" id="1670143">:=</span>&nbsp;<span class="ident" id="1670146">readgstatus</span><span class="op" id="1670157">(</span><span class="ident" id="1670158">gp</span><span class="op" id="1670160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670163">if</span>&nbsp;<span class="ident" id="1670166">status</span>&nbsp;<span class="op" id="1670173">!=</span>&nbsp;<span class="ident" id="1670176">_Grunning</span>&nbsp;<span class="op" id="1670186">&amp;&amp;</span>&nbsp;<span class="ident" id="1670189">status</span>&nbsp;<span class="op" id="1670196">!=</span>&nbsp;<span class="ident" id="1670199">_Gscanrunning</span>&nbsp;<span class="op" id="1670213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670217">gothrow</span><span class="op" id="1670224">(</span><span class="string" id="1670225">&#34;gopark:&nbsp;bad&nbsp;g&nbsp;status&#34;</span><span class="op" id="1670247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1670250">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670253">mp</span><span class="op" id="1670255">.</span><span class="ident" id="1670256">waitlock</span>&nbsp;<span class="op" id="1670265">=</span>&nbsp;<span class="ident" id="1670267">lock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670273">mp</span><span class="op" id="1670275">.</span><span class="ident" id="1670276">waitunlockf</span>&nbsp;<span class="op" id="1670288">=</span>&nbsp;<span class="ident" id="1670290">unlockf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670299">gp</span><span class="op" id="1670301">.</span><span class="ident" id="1670302">waitreason</span>&nbsp;<span class="op" id="1670313">=</span>&nbsp;<span class="ident" id="1670315">reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670323">releasem</span><span class="op" id="1670331">(</span><span class="ident" id="1670332">mp</span><span class="op" id="1670334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1670337">//&nbsp;can&#39;t&nbsp;do&nbsp;anything&nbsp;that&nbsp;might&nbsp;move&nbsp;the&nbsp;G&nbsp;between&nbsp;Ms&nbsp;here.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670398">mcall</span><span class="op" id="1670403">(</span><span class="ident" id="1670404">park_m</span><span class="op" id="1670410">)</span><br>
<span class="lineno"></span><span class="op" id="1670412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1670415">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;unlocks&nbsp;the&nbsp;lock.</span><br>
<span class="lineno"></span><span class="comment" id="1670488">//&nbsp;The&nbsp;goroutine&nbsp;can&nbsp;be&nbsp;made&nbsp;runnable&nbsp;again&nbsp;by&nbsp;calling&nbsp;goready(gp).</span><br>
<span class="lineno">135</span><span class="keyword" id="1670556">func</span>&nbsp;<span class="ident" id="1670561">goparkunlock</span><span class="op" id="1670573">(</span><span class="ident" id="1670574">lock</span>&nbsp;<span class="op" id="1670579">*</span><span class="ident" id="1670580">mutex</span><span class="op" id="1670585">,</span>&nbsp;<span class="ident" id="1670587">reason</span>&nbsp;<span class="builtintype" id="1670594">string</span><span class="op" id="1670600">)</span>&nbsp;<span class="op" id="1670602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670605">gopark</span><span class="op" id="1670611">(</span><span class="ident" id="1670612">unsafe</span><span class="op" id="1670618">.</span><span class="ident" id="1670619">Pointer</span><span class="op" id="1670626">(</span><span class="op" id="1670627">&amp;</span><span class="ident" id="1670628">parkunlock_c</span><span class="op" id="1670640">)</span><span class="op" id="1670641">,</span>&nbsp;<span class="ident" id="1670643">unsafe</span><span class="op" id="1670649">.</span><span class="ident" id="1670650">Pointer</span><span class="op" id="1670657">(</span><span class="ident" id="1670658">lock</span><span class="op" id="1670662">)</span><span class="op" id="1670663">,</span>&nbsp;<span class="ident" id="1670665">reason</span><span class="op" id="1670671">)</span><br>
<span class="lineno"></span><span class="op" id="1670673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1670676">func</span>&nbsp;<span class="ident" id="1670681">goready</span><span class="op" id="1670688">(</span><span class="ident" id="1670689">gp</span>&nbsp;<span class="op" id="1670692">*</span><span class="ident" id="1670693">g</span><span class="op" id="1670694">)</span>&nbsp;<span class="op" id="1670696">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670699">mp</span>&nbsp;<span class="op" id="1670702">:=</span>&nbsp;<span class="ident" id="1670705">acquirem</span><span class="op" id="1670713">(</span><span class="op" id="1670714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670717">mp</span><span class="op" id="1670719">.</span><span class="ident" id="1670720">ptrarg</span><span class="op" id="1670726">[</span><span class="num" id="1670727">0</span><span class="op" id="1670728">]</span>&nbsp;<span class="op" id="1670730">=</span>&nbsp;<span class="ident" id="1670732">unsafe</span><span class="op" id="1670738">.</span><span class="ident" id="1670739">Pointer</span><span class="op" id="1670746">(</span><span class="ident" id="1670747">gp</span><span class="op" id="1670749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670752">onM</span><span class="op" id="1670755">(</span><span class="ident" id="1670756">ready_m</span><span class="op" id="1670763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670766">releasem</span><span class="op" id="1670774">(</span><span class="ident" id="1670775">mp</span><span class="op" id="1670777">)</span><br>
<span class="lineno"></span><span class="op" id="1670779">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1670782">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1670795">func</span>&nbsp;<span class="ident" id="1670800">acquireSudog</span><span class="op" id="1670812">(</span><span class="op" id="1670813">)</span>&nbsp;<span class="op" id="1670815">*</span><span class="ident" id="1670816">sudog</span>&nbsp;<span class="op" id="1670822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670825">c</span>&nbsp;<span class="op" id="1670827">:=</span>&nbsp;<span class="ident" id="1670830">gomcache</span><span class="op" id="1670838">(</span><span class="op" id="1670839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670842">s</span>&nbsp;<span class="op" id="1670844">:=</span>&nbsp;<span class="ident" id="1670847">c</span><span class="op" id="1670848">.</span><span class="ident" id="1670849">sudogcache</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670861">if</span>&nbsp;<span class="ident" id="1670864">s</span>&nbsp;<span class="op" id="1670866">!=</span>&nbsp;<span class="ident" id="1670869">nil</span>&nbsp;<span class="op" id="1670873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670877">if</span>&nbsp;<span class="ident" id="1670880">s</span><span class="op" id="1670881">.</span><span class="ident" id="1670882">elem</span>&nbsp;<span class="op" id="1670887">!=</span>&nbsp;<span class="ident" id="1670890">nil</span>&nbsp;<span class="op" id="1670894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670899">gothrow</span><span class="op" id="1670906">(</span><span class="string" id="1670907">&#34;acquireSudog:&nbsp;found&nbsp;s.elem&nbsp;!=&nbsp;nil&nbsp;in&nbsp;cache&#34;</span><span class="op" id="1670951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1670955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670959">c</span><span class="op" id="1670960">.</span><span class="ident" id="1670961">sudogcache</span>&nbsp;<span class="op" id="1670972">=</span>&nbsp;<span class="ident" id="1670974">s</span><span class="op" id="1670975">.</span><span class="ident" id="1670976">next</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670983">s</span><span class="op" id="1670984">.</span><span class="ident" id="1670985">next</span>&nbsp;<span class="op" id="1670990">=</span>&nbsp;<span class="ident" id="1670992">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670998">return</span>&nbsp;<span class="ident" id="1671005">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1671012">//&nbsp;Delicate&nbsp;dance:&nbsp;the&nbsp;semaphore&nbsp;implementation&nbsp;calls</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1671067">//&nbsp;acquireSudog,&nbsp;acquireSudog&nbsp;calls&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1671116">//&nbsp;new&nbsp;calls&nbsp;malloc,&nbsp;malloc&nbsp;can&nbsp;call&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1671177">//&nbsp;and&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;calls&nbsp;the&nbsp;semaphore&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1671242">//&nbsp;in&nbsp;stoptheworld.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1671263">//&nbsp;Break&nbsp;the&nbsp;cycle&nbsp;by&nbsp;doing&nbsp;acquirem/releasem&nbsp;around&nbsp;new(sudog).</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1671329">//&nbsp;The&nbsp;acquirem/releasem&nbsp;increments&nbsp;m.locks&nbsp;during&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1671393">//&nbsp;which&nbsp;keeps&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;from&nbsp;being&nbsp;invoked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671451">mp</span>&nbsp;<span class="op" id="1671454">:=</span>&nbsp;<span class="ident" id="1671457">acquirem</span><span class="op" id="1671465">(</span><span class="op" id="1671466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671469">p</span>&nbsp;<span class="op" id="1671471">:=</span>&nbsp;<span class="builtinfunc" id="1671474">new</span><span class="op" id="1671477">(</span><span class="ident" id="1671478">sudog</span><span class="op" id="1671483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671486">releasem</span><span class="op" id="1671494">(</span><span class="ident" id="1671495">mp</span><span class="op" id="1671497">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671500">return</span>&nbsp;<span class="ident" id="1671507">p</span><br>
<span class="lineno"></span><span class="op" id="1671509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1671512">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1671525">func</span>&nbsp;<span class="ident" id="1671530">releaseSudog</span><span class="op" id="1671542">(</span><span class="ident" id="1671543">s</span>&nbsp;<span class="op" id="1671545">*</span><span class="ident" id="1671546">sudog</span><span class="op" id="1671551">)</span>&nbsp;<span class="op" id="1671553">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671556">if</span>&nbsp;<span class="ident" id="1671559">s</span><span class="op" id="1671560">.</span><span class="ident" id="1671561">elem</span>&nbsp;<span class="op" id="1671566">!=</span>&nbsp;<span class="ident" id="1671569">nil</span>&nbsp;<span class="op" id="1671573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671577">gothrow</span><span class="op" id="1671584">(</span><span class="string" id="1671585">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;elem&#34;</span><span class="op" id="1671619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671625">if</span>&nbsp;<span class="ident" id="1671628">s</span><span class="op" id="1671629">.</span><span class="ident" id="1671630">selectdone</span>&nbsp;<span class="op" id="1671641">!=</span>&nbsp;<span class="ident" id="1671644">nil</span>&nbsp;<span class="op" id="1671648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671652">gothrow</span><span class="op" id="1671659">(</span><span class="string" id="1671660">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;selectdone&#34;</span><span class="op" id="1671700">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671706">if</span>&nbsp;<span class="ident" id="1671709">s</span><span class="op" id="1671710">.</span><span class="ident" id="1671711">next</span>&nbsp;<span class="op" id="1671716">!=</span>&nbsp;<span class="ident" id="1671719">nil</span>&nbsp;<span class="op" id="1671723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671727">gothrow</span><span class="op" id="1671734">(</span><span class="string" id="1671735">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;next&#34;</span><span class="op" id="1671769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671775">if</span>&nbsp;<span class="ident" id="1671778">s</span><span class="op" id="1671779">.</span><span class="ident" id="1671780">prev</span>&nbsp;<span class="op" id="1671785">!=</span>&nbsp;<span class="ident" id="1671788">nil</span>&nbsp;<span class="op" id="1671792">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671796">gothrow</span><span class="op" id="1671803">(</span><span class="string" id="1671804">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;prev&#34;</span><span class="op" id="1671838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671844">if</span>&nbsp;<span class="ident" id="1671847">s</span><span class="op" id="1671848">.</span><span class="ident" id="1671849">waitlink</span>&nbsp;<span class="op" id="1671858">!=</span>&nbsp;<span class="ident" id="1671861">nil</span>&nbsp;<span class="op" id="1671865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671869">gothrow</span><span class="op" id="1671876">(</span><span class="string" id="1671877">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;waitlink&#34;</span><span class="op" id="1671915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671918">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671921">gp</span>&nbsp;<span class="op" id="1671924">:=</span>&nbsp;<span class="ident" id="1671927">getg</span><span class="op" id="1671931">(</span><span class="op" id="1671932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671935">if</span>&nbsp;<span class="ident" id="1671938">gp</span><span class="op" id="1671940">.</span><span class="ident" id="1671941">param</span>&nbsp;<span class="op" id="1671947">!=</span>&nbsp;<span class="ident" id="1671950">nil</span>&nbsp;<span class="op" id="1671954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671958">gothrow</span><span class="op" id="1671965">(</span><span class="string" id="1671966">&#34;runtime:&nbsp;releaseSudog&nbsp;with&nbsp;non-nil&nbsp;gp.param&#34;</span><span class="op" id="1672011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1672014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672017">c</span>&nbsp;<span class="op" id="1672019">:=</span>&nbsp;<span class="ident" id="1672022">gomcache</span><span class="op" id="1672030">(</span><span class="op" id="1672031">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672034">s</span><span class="op" id="1672035">.</span><span class="ident" id="1672036">next</span>&nbsp;<span class="op" id="1672041">=</span>&nbsp;<span class="ident" id="1672043">c</span><span class="op" id="1672044">.</span><span class="ident" id="1672045">sudogcache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672057">c</span><span class="op" id="1672058">.</span><span class="ident" id="1672059">sudogcache</span>&nbsp;<span class="op" id="1672070">=</span>&nbsp;<span class="ident" id="1672072">s</span><br>
<span class="lineno"></span><span class="op" id="1672074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1672077">//&nbsp;funcPC&nbsp;returns&nbsp;the&nbsp;entry&nbsp;PC&nbsp;of&nbsp;the&nbsp;function&nbsp;f.</span><br>
<span class="lineno">200</span><span class="comment" id="1672127">//&nbsp;It&nbsp;assumes&nbsp;that&nbsp;f&nbsp;is&nbsp;a&nbsp;func&nbsp;value.&nbsp;Otherwise&nbsp;the&nbsp;behavior&nbsp;is&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="comment" id="1672202">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1672215">func</span>&nbsp;<span class="ident" id="1672220">funcPC</span><span class="op" id="1672226">(</span><span class="ident" id="1672227">f</span>&nbsp;<span class="keyword" id="1672229">interface</span><span class="op" id="1672238">{</span><span class="op" id="1672239">}</span><span class="op" id="1672240">)</span>&nbsp;<span class="builtintype" id="1672242">uintptr</span>&nbsp;<span class="op" id="1672250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672253">return</span>&nbsp;<span class="op" id="1672260">*</span><span class="op" id="1672261">*</span><span class="op" id="1672262">(</span><span class="op" id="1672263">*</span><span class="op" id="1672264">*</span><span class="builtintype" id="1672265">uintptr</span><span class="op" id="1672272">)</span><span class="op" id="1672273">(</span><span class="ident" id="1672274">add</span><span class="op" id="1672277">(</span><span class="ident" id="1672278">unsafe</span><span class="op" id="1672284">.</span><span class="ident" id="1672285">Pointer</span><span class="op" id="1672292">(</span><span class="op" id="1672293">&amp;</span><span class="ident" id="1672294">f</span><span class="op" id="1672295">)</span><span class="op" id="1672296">,</span>&nbsp;<span class="ident" id="1672298">ptrSize</span><span class="op" id="1672305">)</span><span class="op" id="1672306">)</span><br>
<span class="lineno"></span><span class="op" id="1672308">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="1672311">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno"></span><span class="keyword" id="1672335">func</span>&nbsp;<span class="ident" id="1672340">badmcall</span><span class="op" id="1672348">(</span><span class="ident" id="1672349">fn</span>&nbsp;<span class="keyword" id="1672352">func</span><span class="op" id="1672356">(</span><span class="op" id="1672357">*</span><span class="ident" id="1672358">g</span><span class="op" id="1672359">)</span><span class="op" id="1672360">)</span>&nbsp;<span class="op" id="1672362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672365">gothrow</span><span class="op" id="1672372">(</span><span class="string" id="1672373">&#34;runtime:&nbsp;mcall&nbsp;called&nbsp;on&nbsp;m-&gt;g0&nbsp;stack&#34;</span><span class="op" id="1672411">)</span><br>
<span class="lineno"></span><span class="op" id="1672413">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="1672416">func</span>&nbsp;<span class="ident" id="1672421">badmcall2</span><span class="op" id="1672430">(</span><span class="ident" id="1672431">fn</span>&nbsp;<span class="keyword" id="1672434">func</span><span class="op" id="1672438">(</span><span class="op" id="1672439">*</span><span class="ident" id="1672440">g</span><span class="op" id="1672441">)</span><span class="op" id="1672442">)</span>&nbsp;<span class="op" id="1672444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672447">gothrow</span><span class="op" id="1672454">(</span><span class="string" id="1672455">&#34;runtime:&nbsp;mcall&nbsp;function&nbsp;returned&#34;</span><span class="op" id="1672489">)</span><br>
<span class="lineno"></span><span class="op" id="1672491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1672494">func</span>&nbsp;<span class="ident" id="1672499">badreflectcall</span><span class="op" id="1672513">(</span><span class="op" id="1672514">)</span>&nbsp;<span class="op" id="1672516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1672519">panic</span><span class="op" id="1672524">(</span><span class="string" id="1672525">&#34;runtime:&nbsp;arg&nbsp;size&nbsp;to&nbsp;reflect.call&nbsp;more&nbsp;than&nbsp;1GB&#34;</span><span class="op" id="1672574">)</span><br>
<span class="lineno"></span><span class="op" id="1672576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1672579">func</span>&nbsp;<span class="ident" id="1672584">lockedOSThread</span><span class="op" id="1672598">(</span><span class="op" id="1672599">)</span>&nbsp;<span class="builtintype" id="1672601">bool</span>&nbsp;<span class="op" id="1672606">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672609">gp</span>&nbsp;<span class="op" id="1672612">:=</span>&nbsp;<span class="ident" id="1672615">getg</span><span class="op" id="1672619">(</span><span class="op" id="1672620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672623">return</span>&nbsp;<span class="ident" id="1672630">gp</span><span class="op" id="1672632">.</span><span class="ident" id="1672633">lockedm</span>&nbsp;<span class="op" id="1672641">!=</span>&nbsp;<span class="ident" id="1672644">nil</span>&nbsp;<span class="op" id="1672648">&amp;&amp;</span>&nbsp;<span class="ident" id="1672651">gp</span><span class="op" id="1672653">.</span><span class="ident" id="1672654">m</span><span class="op" id="1672655">.</span><span class="ident" id="1672656">lockedg</span>&nbsp;<span class="op" id="1672664">!=</span>&nbsp;<span class="ident" id="1672667">nil</span><br>
<span class="lineno"></span><span class="op" id="1672671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1672674">func</span>&nbsp;<span class="ident" id="1672679">newP</span><span class="op" id="1672683">(</span><span class="op" id="1672684">)</span>&nbsp;<span class="op" id="1672686">*</span><span class="ident" id="1672687">p</span>&nbsp;<span class="op" id="1672689">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672692">return</span>&nbsp;<span class="builtinfunc" id="1672699">new</span><span class="op" id="1672702">(</span><span class="ident" id="1672703">p</span><span class="op" id="1672704">)</span><br>
<span class="lineno"></span><span class="op" id="1672706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1672709">func</span>&nbsp;<span class="ident" id="1672714">newM</span><span class="op" id="1672718">(</span><span class="op" id="1672719">)</span>&nbsp;<span class="op" id="1672721">*</span><span class="ident" id="1672722">m</span>&nbsp;<span class="op" id="1672724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672727">return</span>&nbsp;<span class="builtinfunc" id="1672734">new</span><span class="op" id="1672737">(</span><span class="ident" id="1672738">m</span><span class="op" id="1672739">)</span><br>
<span class="lineno">230</span><span class="op" id="1672741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1672744">func</span>&nbsp;<span class="ident" id="1672749">newG</span><span class="op" id="1672753">(</span><span class="op" id="1672754">)</span>&nbsp;<span class="op" id="1672756">*</span><span class="ident" id="1672757">g</span>&nbsp;<span class="op" id="1672759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672762">return</span>&nbsp;<span class="builtinfunc" id="1672769">new</span><span class="op" id="1672772">(</span><span class="ident" id="1672773">g</span><span class="op" id="1672774">)</span><br>
<span class="lineno"></span><span class="op" id="1672776">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="1672779">func</span>&nbsp;<span class="ident" id="1672784">allgadd</span><span class="op" id="1672791">(</span><span class="ident" id="1672792">gp</span>&nbsp;<span class="op" id="1672795">*</span><span class="ident" id="1672796">g</span><span class="op" id="1672797">)</span>&nbsp;<span class="op" id="1672799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672802">if</span>&nbsp;<span class="ident" id="1672805">readgstatus</span><span class="op" id="1672816">(</span><span class="ident" id="1672817">gp</span><span class="op" id="1672819">)</span>&nbsp;<span class="op" id="1672821">==</span>&nbsp;<span class="ident" id="1672824">_Gidle</span>&nbsp;<span class="op" id="1672831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672835">gothrow</span><span class="op" id="1672842">(</span><span class="string" id="1672843">&#34;allgadd:&nbsp;bad&nbsp;status&nbsp;Gidle&#34;</span><span class="op" id="1672870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1672873">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672877">lock</span><span class="op" id="1672881">(</span><span class="op" id="1672882">&amp;</span><span class="ident" id="1672883">allglock</span><span class="op" id="1672891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672894">allgs</span>&nbsp;<span class="op" id="1672900">=</span>&nbsp;<span class="builtinfunc" id="1672902">append</span><span class="op" id="1672908">(</span><span class="ident" id="1672909">allgs</span><span class="op" id="1672914">,</span>&nbsp;<span class="ident" id="1672916">gp</span><span class="op" id="1672918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672921">allg</span>&nbsp;<span class="op" id="1672926">=</span>&nbsp;<span class="op" id="1672928">&amp;</span><span class="ident" id="1672929">allgs</span><span class="op" id="1672934">[</span><span class="num" id="1672935">0</span><span class="op" id="1672936">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672939">allglen</span>&nbsp;<span class="op" id="1672947">=</span>&nbsp;<span class="builtintype" id="1672949">uintptr</span><span class="op" id="1672956">(</span><span class="builtinfunc" id="1672957">len</span><span class="op" id="1672960">(</span><span class="ident" id="1672961">allgs</span><span class="op" id="1672966">)</span><span class="op" id="1672967">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672970">unlock</span><span class="op" id="1672976">(</span><span class="op" id="1672977">&amp;</span><span class="ident" id="1672978">allglock</span><span class="op" id="1672986">)</span><br>
<span class="lineno"></span><span class="op" id="1672988">}</span>
</div>
</body>
</html>
