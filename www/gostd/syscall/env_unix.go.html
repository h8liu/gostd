<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2192910">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2192966">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2193020">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2193071">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2193141">//&nbsp;Unix&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2193173">package</span>&nbsp;<span class="ident" id="2193181">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2193190">import</span>&nbsp;<span class="string" id="2193197">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2193205">var</span>&nbsp;<span class="op" id="2193209">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2193212">//&nbsp;envOnce&nbsp;guards&nbsp;initialization&nbsp;by&nbsp;copyenv,&nbsp;which&nbsp;populates&nbsp;env.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193279">envOnce</span>&nbsp;<span class="ident" id="2193287">sync</span><span class="op" id="2193291">.</span><span class="ident" id="2193292">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2193299">//&nbsp;envLock&nbsp;guards&nbsp;env&nbsp;and&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193332">envLock</span>&nbsp;<span class="ident" id="2193340">sync</span><span class="op" id="2193344">.</span><span class="ident" id="2193345">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2193355">//&nbsp;env&nbsp;maps&nbsp;from&nbsp;an&nbsp;environment&nbsp;variable&nbsp;to&nbsp;its&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193430">env</span>&nbsp;<span class="keyword" id="2193434">map</span><span class="op" id="2193437">[</span><span class="builtintype" id="2193438">string</span><span class="op" id="2193444">]</span><span class="builtintype" id="2193445">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2193451">//&nbsp;envs&nbsp;is&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime.&nbsp;elements&nbsp;are&nbsp;expected&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2193513">//&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;key=value&#34;.&nbsp;An&nbsp;empty&nbsp;string&nbsp;means&nbsp;deleted</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2193575">//&nbsp;(or&nbsp;a&nbsp;duplicate&nbsp;to&nbsp;be&nbsp;ignored).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193611">envs</span>&nbsp;<span class="op" id="2193616">[</span><span class="op" id="2193617">]</span><span class="builtintype" id="2193618">string</span>&nbsp;<span class="op" id="2193625">=</span>&nbsp;<span class="ident" id="2193627">runtime_envs</span><span class="op" id="2193639">(</span><span class="op" id="2193640">)</span><br>
<span class="lineno"></span><span class="op" id="2193642">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2193645">func</span>&nbsp;<span class="ident" id="2193650">runtime_envs</span><span class="op" id="2193662">(</span><span class="op" id="2193663">)</span>&nbsp;<span class="op" id="2193665">[</span><span class="op" id="2193666">]</span><span class="builtintype" id="2193667">string</span>&nbsp;<span class="comment" id="2193674">//&nbsp;in&nbsp;package&nbsp;runtime</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2193697">//&nbsp;setenv_c&nbsp;and&nbsp;unsetenv_c&nbsp;are&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime&nbsp;but&nbsp;are&nbsp;no-ops</span><br>
<span class="lineno"></span><span class="comment" id="2193767">//&nbsp;if&nbsp;cgo&nbsp;isn&#39;t&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="keyword" id="2193791">func</span>&nbsp;<span class="ident" id="2193796">setenv_c</span><span class="op" id="2193804">(</span><span class="ident" id="2193805">k</span><span class="op" id="2193806">,</span>&nbsp;<span class="ident" id="2193808">v</span>&nbsp;<span class="builtintype" id="2193810">string</span><span class="op" id="2193816">)</span><br>
<span class="lineno"></span><span class="keyword" id="2193818">func</span>&nbsp;<span class="ident" id="2193823">unsetenv_c</span><span class="op" id="2193833">(</span><span class="ident" id="2193834">k</span>&nbsp;<span class="builtintype" id="2193836">string</span><span class="op" id="2193842">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2193845">func</span>&nbsp;<span class="ident" id="2193850">copyenv</span><span class="op" id="2193857">(</span><span class="op" id="2193858">)</span>&nbsp;<span class="op" id="2193860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193863">env</span>&nbsp;<span class="op" id="2193867">=</span>&nbsp;<span class="builtinfunc" id="2193869">make</span><span class="op" id="2193873">(</span><span class="keyword" id="2193874">map</span><span class="op" id="2193877">[</span><span class="builtintype" id="2193878">string</span><span class="op" id="2193884">]</span><span class="builtintype" id="2193885">int</span><span class="op" id="2193888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193891">for</span>&nbsp;<span class="ident" id="2193895">i</span><span class="op" id="2193896">,</span>&nbsp;<span class="ident" id="2193898">s</span>&nbsp;<span class="op" id="2193900">:=</span>&nbsp;<span class="keyword" id="2193903">range</span>&nbsp;<span class="ident" id="2193909">envs</span>&nbsp;<span class="op" id="2193914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193918">for</span>&nbsp;<span class="ident" id="2193922">j</span>&nbsp;<span class="op" id="2193924">:=</span>&nbsp;<span class="num" id="2193927">0</span><span class="op" id="2193928">;</span>&nbsp;<span class="ident" id="2193930">j</span>&nbsp;<span class="op" id="2193932">&lt;</span>&nbsp;<span class="builtinfunc" id="2193934">len</span><span class="op" id="2193937">(</span><span class="ident" id="2193938">s</span><span class="op" id="2193939">)</span><span class="op" id="2193940">;</span>&nbsp;<span class="ident" id="2193942">j</span><span class="op" id="2193943">++</span>&nbsp;<span class="op" id="2193946">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193951">if</span>&nbsp;<span class="ident" id="2193954">s</span><span class="op" id="2193955">[</span><span class="ident" id="2193956">j</span><span class="op" id="2193957">]</span>&nbsp;<span class="op" id="2193959">==</span>&nbsp;<span class="string" id="2193962">&#39;=&#39;</span>&nbsp;<span class="op" id="2193966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2193972">key</span>&nbsp;<span class="op" id="2193976">:=</span>&nbsp;<span class="ident" id="2193979">s</span><span class="op" id="2193980">[</span><span class="op" id="2193981">:</span><span class="ident" id="2193982">j</span><span class="op" id="2193983">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2193989">if</span>&nbsp;<span class="ident" id="2193992">_</span><span class="op" id="2193993">,</span>&nbsp;<span class="ident" id="2193995">ok</span>&nbsp;<span class="op" id="2193998">:=</span>&nbsp;<span class="ident" id="2194001">env</span><span class="op" id="2194004">[</span><span class="ident" id="2194005">key</span><span class="op" id="2194008">]</span><span class="op" id="2194009">;</span>&nbsp;<span class="op" id="2194011">!</span><span class="ident" id="2194012">ok</span>&nbsp;<span class="op" id="2194015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194022">env</span><span class="op" id="2194025">[</span><span class="ident" id="2194026">key</span><span class="op" id="2194029">]</span>&nbsp;<span class="op" id="2194031">=</span>&nbsp;<span class="ident" id="2194033">i</span>&nbsp;<span class="comment" id="2194035">//&nbsp;first&nbsp;mention&nbsp;of&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194063">}</span>&nbsp;<span class="keyword" id="2194065">else</span>&nbsp;<span class="op" id="2194070">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2194077">//&nbsp;Clear&nbsp;duplicate&nbsp;keys.&nbsp;This&nbsp;permits&nbsp;Unsetenv&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2194132">//&nbsp;safely&nbsp;delete&nbsp;only&nbsp;the&nbsp;first&nbsp;item&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2194182">//&nbsp;worrying&nbsp;about&nbsp;unshadowing&nbsp;a&nbsp;later&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2194230">//&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;security&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194273">envs</span><span class="op" id="2194277">[</span><span class="ident" id="2194278">i</span><span class="op" id="2194279">]</span>&nbsp;<span class="op" id="2194281">=</span>&nbsp;<span class="string" id="2194283">&#34;&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194296">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194312">}</span><br>
<span class="lineno">55</span><span class="op" id="2194314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2194317">func</span>&nbsp;<span class="ident" id="2194322">Unsetenv</span><span class="op" id="2194330">(</span><span class="ident" id="2194331">key</span>&nbsp;<span class="builtintype" id="2194335">string</span><span class="op" id="2194341">)</span>&nbsp;<span class="builtintype" id="2194343">error</span>&nbsp;<span class="op" id="2194349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194352">envOnce</span><span class="op" id="2194359">.</span><span class="ident" id="2194360">Do</span><span class="op" id="2194362">(</span><span class="ident" id="2194363">copyenv</span><span class="op" id="2194370">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194374">envLock</span><span class="op" id="2194381">.</span><span class="ident" id="2194382">Lock</span><span class="op" id="2194386">(</span><span class="op" id="2194387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194390">defer</span>&nbsp;<span class="ident" id="2194396">envLock</span><span class="op" id="2194403">.</span><span class="ident" id="2194404">Unlock</span><span class="op" id="2194410">(</span><span class="op" id="2194411">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194415">if</span>&nbsp;<span class="ident" id="2194418">i</span><span class="op" id="2194419">,</span>&nbsp;<span class="ident" id="2194421">ok</span>&nbsp;<span class="op" id="2194424">:=</span>&nbsp;<span class="ident" id="2194427">env</span><span class="op" id="2194430">[</span><span class="ident" id="2194431">key</span><span class="op" id="2194434">]</span><span class="op" id="2194435">;</span>&nbsp;<span class="ident" id="2194437">ok</span>&nbsp;<span class="op" id="2194440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194444">envs</span><span class="op" id="2194448">[</span><span class="ident" id="2194449">i</span><span class="op" id="2194450">]</span>&nbsp;<span class="op" id="2194452">=</span>&nbsp;<span class="string" id="2194454">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2194459">delete</span><span class="op" id="2194465">(</span><span class="ident" id="2194466">env</span><span class="op" id="2194469">,</span>&nbsp;<span class="ident" id="2194471">key</span><span class="op" id="2194474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194480">unsetenv_c</span><span class="op" id="2194490">(</span><span class="ident" id="2194491">key</span><span class="op" id="2194494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194497">return</span>&nbsp;<span class="ident" id="2194504">nil</span><br>
<span class="lineno"></span><span class="op" id="2194508">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2194511">func</span>&nbsp;<span class="ident" id="2194516">Getenv</span><span class="op" id="2194522">(</span><span class="ident" id="2194523">key</span>&nbsp;<span class="builtintype" id="2194527">string</span><span class="op" id="2194533">)</span>&nbsp;<span class="op" id="2194535">(</span><span class="ident" id="2194536">value</span>&nbsp;<span class="builtintype" id="2194542">string</span><span class="op" id="2194548">,</span>&nbsp;<span class="ident" id="2194550">found</span>&nbsp;<span class="builtintype" id="2194556">bool</span><span class="op" id="2194560">)</span>&nbsp;<span class="op" id="2194562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194565">envOnce</span><span class="op" id="2194572">.</span><span class="ident" id="2194573">Do</span><span class="op" id="2194575">(</span><span class="ident" id="2194576">copyenv</span><span class="op" id="2194583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194586">if</span>&nbsp;<span class="builtinfunc" id="2194589">len</span><span class="op" id="2194592">(</span><span class="ident" id="2194593">key</span><span class="op" id="2194596">)</span>&nbsp;<span class="op" id="2194598">==</span>&nbsp;<span class="num" id="2194601">0</span>&nbsp;<span class="op" id="2194603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194607">return</span>&nbsp;<span class="string" id="2194614">&#34;&#34;</span><span class="op" id="2194616">,</span>&nbsp;<span class="builtintype" id="2194618">false</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194629">envLock</span><span class="op" id="2194636">.</span><span class="ident" id="2194637">RLock</span><span class="op" id="2194642">(</span><span class="op" id="2194643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194646">defer</span>&nbsp;<span class="ident" id="2194652">envLock</span><span class="op" id="2194659">.</span><span class="ident" id="2194660">RUnlock</span><span class="op" id="2194667">(</span><span class="op" id="2194668">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194672">i</span><span class="op" id="2194673">,</span>&nbsp;<span class="ident" id="2194675">ok</span>&nbsp;<span class="op" id="2194678">:=</span>&nbsp;<span class="ident" id="2194681">env</span><span class="op" id="2194684">[</span><span class="ident" id="2194685">key</span><span class="op" id="2194688">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194691">if</span>&nbsp;<span class="op" id="2194694">!</span><span class="ident" id="2194695">ok</span>&nbsp;<span class="op" id="2194698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194702">return</span>&nbsp;<span class="string" id="2194709">&#34;&#34;</span><span class="op" id="2194711">,</span>&nbsp;<span class="builtintype" id="2194713">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194723">s</span>&nbsp;<span class="op" id="2194725">:=</span>&nbsp;<span class="ident" id="2194728">envs</span><span class="op" id="2194732">[</span><span class="ident" id="2194733">i</span><span class="op" id="2194734">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194737">for</span>&nbsp;<span class="ident" id="2194741">i</span>&nbsp;<span class="op" id="2194743">:=</span>&nbsp;<span class="num" id="2194746">0</span><span class="op" id="2194747">;</span>&nbsp;<span class="ident" id="2194749">i</span>&nbsp;<span class="op" id="2194751">&lt;</span>&nbsp;<span class="builtinfunc" id="2194753">len</span><span class="op" id="2194756">(</span><span class="ident" id="2194757">s</span><span class="op" id="2194758">)</span><span class="op" id="2194759">;</span>&nbsp;<span class="ident" id="2194761">i</span><span class="op" id="2194762">++</span>&nbsp;<span class="op" id="2194765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194769">if</span>&nbsp;<span class="ident" id="2194772">s</span><span class="op" id="2194773">[</span><span class="ident" id="2194774">i</span><span class="op" id="2194775">]</span>&nbsp;<span class="op" id="2194777">==</span>&nbsp;<span class="string" id="2194780">&#39;=&#39;</span>&nbsp;<span class="op" id="2194784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194789">return</span>&nbsp;<span class="ident" id="2194796">s</span><span class="op" id="2194797">[</span><span class="ident" id="2194798">i</span><span class="op" id="2194799">+</span><span class="num" id="2194800">1</span><span class="op" id="2194801">:</span><span class="op" id="2194802">]</span><span class="op" id="2194803">,</span>&nbsp;<span class="builtintype" id="2194805">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194815">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194818">return</span>&nbsp;<span class="string" id="2194825">&#34;&#34;</span><span class="op" id="2194827">,</span>&nbsp;<span class="builtintype" id="2194829">false</span><br>
<span class="lineno"></span><span class="op" id="2194835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2194838">func</span>&nbsp;<span class="ident" id="2194843">Setenv</span><span class="op" id="2194849">(</span><span class="ident" id="2194850">key</span><span class="op" id="2194853">,</span>&nbsp;<span class="ident" id="2194855">value</span>&nbsp;<span class="builtintype" id="2194861">string</span><span class="op" id="2194867">)</span>&nbsp;<span class="builtintype" id="2194869">error</span>&nbsp;<span class="op" id="2194875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2194878">envOnce</span><span class="op" id="2194885">.</span><span class="ident" id="2194886">Do</span><span class="op" id="2194888">(</span><span class="ident" id="2194889">copyenv</span><span class="op" id="2194896">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194899">if</span>&nbsp;<span class="builtinfunc" id="2194902">len</span><span class="op" id="2194905">(</span><span class="ident" id="2194906">key</span><span class="op" id="2194909">)</span>&nbsp;<span class="op" id="2194911">==</span>&nbsp;<span class="num" id="2194914">0</span>&nbsp;<span class="op" id="2194916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194920">return</span>&nbsp;<span class="ident" id="2194927">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2194935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194938">for</span>&nbsp;<span class="ident" id="2194942">i</span>&nbsp;<span class="op" id="2194944">:=</span>&nbsp;<span class="num" id="2194947">0</span><span class="op" id="2194948">;</span>&nbsp;<span class="ident" id="2194950">i</span>&nbsp;<span class="op" id="2194952">&lt;</span>&nbsp;<span class="builtinfunc" id="2194954">len</span><span class="op" id="2194957">(</span><span class="ident" id="2194958">key</span><span class="op" id="2194961">)</span><span class="op" id="2194962">;</span>&nbsp;<span class="ident" id="2194964">i</span><span class="op" id="2194965">++</span>&nbsp;<span class="op" id="2194968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2194972">if</span>&nbsp;<span class="ident" id="2194975">key</span><span class="op" id="2194978">[</span><span class="ident" id="2194979">i</span><span class="op" id="2194980">]</span>&nbsp;<span class="op" id="2194982">==</span>&nbsp;<span class="string" id="2194985">&#39;=&#39;</span>&nbsp;<span class="op" id="2194989">||</span>&nbsp;<span class="ident" id="2194992">key</span><span class="op" id="2194995">[</span><span class="ident" id="2194996">i</span><span class="op" id="2194997">]</span>&nbsp;<span class="op" id="2194999">==</span>&nbsp;<span class="num" id="2195002">0</span>&nbsp;<span class="op" id="2195004">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195009">return</span>&nbsp;<span class="ident" id="2195016">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2195025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2195028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195031">for</span>&nbsp;<span class="ident" id="2195035">i</span>&nbsp;<span class="op" id="2195037">:=</span>&nbsp;<span class="num" id="2195040">0</span><span class="op" id="2195041">;</span>&nbsp;<span class="ident" id="2195043">i</span>&nbsp;<span class="op" id="2195045">&lt;</span>&nbsp;<span class="builtinfunc" id="2195047">len</span><span class="op" id="2195050">(</span><span class="ident" id="2195051">value</span><span class="op" id="2195056">)</span><span class="op" id="2195057">;</span>&nbsp;<span class="ident" id="2195059">i</span><span class="op" id="2195060">++</span>&nbsp;<span class="op" id="2195063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195067">if</span>&nbsp;<span class="ident" id="2195070">value</span><span class="op" id="2195075">[</span><span class="ident" id="2195076">i</span><span class="op" id="2195077">]</span>&nbsp;<span class="op" id="2195079">==</span>&nbsp;<span class="num" id="2195082">0</span>&nbsp;<span class="op" id="2195084">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195089">return</span>&nbsp;<span class="ident" id="2195096">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2195105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2195108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195112">envLock</span><span class="op" id="2195119">.</span><span class="ident" id="2195120">Lock</span><span class="op" id="2195124">(</span><span class="op" id="2195125">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195128">defer</span>&nbsp;<span class="ident" id="2195134">envLock</span><span class="op" id="2195141">.</span><span class="ident" id="2195142">Unlock</span><span class="op" id="2195148">(</span><span class="op" id="2195149">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195153">i</span><span class="op" id="2195154">,</span>&nbsp;<span class="ident" id="2195156">ok</span>&nbsp;<span class="op" id="2195159">:=</span>&nbsp;<span class="ident" id="2195162">env</span><span class="op" id="2195165">[</span><span class="ident" id="2195166">key</span><span class="op" id="2195169">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195172">kv</span>&nbsp;<span class="op" id="2195175">:=</span>&nbsp;<span class="ident" id="2195178">key</span>&nbsp;<span class="op" id="2195182">+</span>&nbsp;<span class="string" id="2195184">&#34;=&#34;</span>&nbsp;<span class="op" id="2195188">+</span>&nbsp;<span class="ident" id="2195190">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195197">if</span>&nbsp;<span class="ident" id="2195200">ok</span>&nbsp;<span class="op" id="2195203">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195207">envs</span><span class="op" id="2195211">[</span><span class="ident" id="2195212">i</span><span class="op" id="2195213">]</span>&nbsp;<span class="op" id="2195215">=</span>&nbsp;<span class="ident" id="2195217">kv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2195221">}</span>&nbsp;<span class="keyword" id="2195223">else</span>&nbsp;<span class="op" id="2195228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195232">i</span>&nbsp;<span class="op" id="2195234">=</span>&nbsp;<span class="builtinfunc" id="2195236">len</span><span class="op" id="2195239">(</span><span class="ident" id="2195240">envs</span><span class="op" id="2195244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195248">envs</span>&nbsp;<span class="op" id="2195253">=</span>&nbsp;<span class="builtinfunc" id="2195255">append</span><span class="op" id="2195261">(</span><span class="ident" id="2195262">envs</span><span class="op" id="2195266">,</span>&nbsp;<span class="ident" id="2195268">kv</span><span class="op" id="2195270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2195273">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195276">env</span><span class="op" id="2195279">[</span><span class="ident" id="2195280">key</span><span class="op" id="2195283">]</span>&nbsp;<span class="op" id="2195285">=</span>&nbsp;<span class="ident" id="2195287">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195290">setenv_c</span><span class="op" id="2195298">(</span><span class="ident" id="2195299">key</span><span class="op" id="2195302">,</span>&nbsp;<span class="ident" id="2195304">value</span><span class="op" id="2195309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195312">return</span>&nbsp;<span class="ident" id="2195319">nil</span><br>
<span class="lineno"></span><span class="op" id="2195323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2195326">func</span>&nbsp;<span class="ident" id="2195331">Clearenv</span><span class="op" id="2195339">(</span><span class="op" id="2195340">)</span>&nbsp;<span class="op" id="2195342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195345">envOnce</span><span class="op" id="2195352">.</span><span class="ident" id="2195353">Do</span><span class="op" id="2195355">(</span><span class="ident" id="2195356">copyenv</span><span class="op" id="2195363">)</span>&nbsp;<span class="comment" id="2195365">//&nbsp;prevent&nbsp;copyenv&nbsp;in&nbsp;Getenv/Setenv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195403">envLock</span><span class="op" id="2195410">.</span><span class="ident" id="2195411">Lock</span><span class="op" id="2195415">(</span><span class="op" id="2195416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195419">defer</span>&nbsp;<span class="ident" id="2195425">envLock</span><span class="op" id="2195432">.</span><span class="ident" id="2195433">Unlock</span><span class="op" id="2195439">(</span><span class="op" id="2195440">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195444">for</span>&nbsp;<span class="ident" id="2195448">k</span>&nbsp;<span class="op" id="2195450">:=</span>&nbsp;<span class="keyword" id="2195453">range</span>&nbsp;<span class="ident" id="2195459">env</span>&nbsp;<span class="op" id="2195463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195467">unsetenv_c</span><span class="op" id="2195477">(</span><span class="ident" id="2195478">k</span><span class="op" id="2195479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2195482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195485">env</span>&nbsp;<span class="op" id="2195489">=</span>&nbsp;<span class="builtinfunc" id="2195491">make</span><span class="op" id="2195495">(</span><span class="keyword" id="2195496">map</span><span class="op" id="2195499">[</span><span class="builtintype" id="2195500">string</span><span class="op" id="2195506">]</span><span class="builtintype" id="2195507">int</span><span class="op" id="2195510">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195513">envs</span>&nbsp;<span class="op" id="2195518">=</span>&nbsp;<span class="op" id="2195520">[</span><span class="op" id="2195521">]</span><span class="builtintype" id="2195522">string</span><span class="op" id="2195528">{</span><span class="op" id="2195529">}</span><br>
<span class="lineno"></span><span class="op" id="2195531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2195534">func</span>&nbsp;<span class="ident" id="2195539">Environ</span><span class="op" id="2195546">(</span><span class="op" id="2195547">)</span>&nbsp;<span class="op" id="2195549">[</span><span class="op" id="2195550">]</span><span class="builtintype" id="2195551">string</span>&nbsp;<span class="op" id="2195558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195561">envOnce</span><span class="op" id="2195568">.</span><span class="ident" id="2195569">Do</span><span class="op" id="2195571">(</span><span class="ident" id="2195572">copyenv</span><span class="op" id="2195579">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195582">envLock</span><span class="op" id="2195589">.</span><span class="ident" id="2195590">RLock</span><span class="op" id="2195595">(</span><span class="op" id="2195596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195599">defer</span>&nbsp;<span class="ident" id="2195605">envLock</span><span class="op" id="2195612">.</span><span class="ident" id="2195613">RUnlock</span><span class="op" id="2195620">(</span><span class="op" id="2195621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195624">a</span>&nbsp;<span class="op" id="2195626">:=</span>&nbsp;<span class="builtinfunc" id="2195629">make</span><span class="op" id="2195633">(</span><span class="op" id="2195634">[</span><span class="op" id="2195635">]</span><span class="builtintype" id="2195636">string</span><span class="op" id="2195642">,</span>&nbsp;<span class="num" id="2195644">0</span><span class="op" id="2195645">,</span>&nbsp;<span class="builtinfunc" id="2195647">len</span><span class="op" id="2195650">(</span><span class="ident" id="2195651">envs</span><span class="op" id="2195655">)</span><span class="op" id="2195656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195659">for</span>&nbsp;<span class="ident" id="2195663">_</span><span class="op" id="2195664">,</span>&nbsp;<span class="ident" id="2195666">env</span>&nbsp;<span class="op" id="2195670">:=</span>&nbsp;<span class="keyword" id="2195673">range</span>&nbsp;<span class="ident" id="2195679">envs</span>&nbsp;<span class="op" id="2195684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195688">if</span>&nbsp;<span class="ident" id="2195691">env</span>&nbsp;<span class="op" id="2195695">!=</span>&nbsp;<span class="string" id="2195698">&#34;&#34;</span>&nbsp;<span class="op" id="2195701">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2195706">a</span>&nbsp;<span class="op" id="2195708">=</span>&nbsp;<span class="builtinfunc" id="2195710">append</span><span class="op" id="2195716">(</span><span class="ident" id="2195717">a</span><span class="op" id="2195718">,</span>&nbsp;<span class="ident" id="2195720">env</span><span class="op" id="2195723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2195727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2195730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2195733">return</span>&nbsp;<span class="ident" id="2195740">a</span><br>
<span class="lineno"></span><span class="op" id="2195742">}</span>
</div>
</body>
</html>
