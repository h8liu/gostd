<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html" class="current">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4628076">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4628131">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4628185">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4628236">package</span>&nbsp;<span class="ident" id="4628244">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4628252">import</span>&nbsp;<span class="string" id="4628259">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4628265">//&nbsp;TruncateWriter&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w</span><br>
<span class="lineno">10</span><span class="comment" id="4628317">//&nbsp;but&nbsp;stops&nbsp;silently&nbsp;after&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4628354">func</span>&nbsp;<span class="ident" id="4628359">TruncateWriter</span><span class="op" id="4628373">(</span><span class="ident" id="4628374">w</span>&nbsp;<span class="ident" id="4628376">io</span><span class="op" id="4628378">.</span><span class="ident" id="4628379">Writer</span><span class="op" id="4628385">,</span>&nbsp;<span class="ident" id="4628387">n</span>&nbsp;<span class="ident" id="4628389">int64</span><span class="op" id="4628394">)</span>&nbsp;<span class="ident" id="4628396">io</span><span class="op" id="4628398">.</span><span class="ident" id="4628399">Writer</span>&nbsp;<span class="op" id="4628406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4628409">return</span>&nbsp;<span class="op" id="4628416">&amp;</span><span class="ident" id="4628417">truncateWriter</span><span class="op" id="4628431">{</span><span class="ident" id="4628432">w</span><span class="op" id="4628433">,</span>&nbsp;<span class="ident" id="4628435">n</span><span class="op" id="4628436">}</span><br>
<span class="lineno"></span><span class="op" id="4628438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4628441">type</span>&nbsp;<span class="ident" id="4628446">truncateWriter</span>&nbsp;<span class="keyword" id="4628461">struct</span>&nbsp;<span class="op" id="4628468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4628471">w</span>&nbsp;<span class="ident" id="4628473">io</span><span class="op" id="4628475">.</span><span class="ident" id="4628476">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4628484">n</span>&nbsp;<span class="ident" id="4628486">int64</span><br>
<span class="lineno"></span><span class="op" id="4628492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4628495">func</span>&nbsp;<span class="op" id="4628500">(</span><span class="ident" id="4628501">t</span>&nbsp;<span class="op" id="4628503">*</span><span class="ident" id="4628504">truncateWriter</span><span class="op" id="4628518">)</span>&nbsp;<span class="ident" id="4628520">Write</span><span class="op" id="4628525">(</span><span class="ident" id="4628526">p</span>&nbsp;<span class="op" id="4628528">[</span><span class="op" id="4628529">]</span><span class="builtintype" id="4628530">byte</span><span class="op" id="4628534">)</span>&nbsp;<span class="op" id="4628536">(</span><span class="ident" id="4628537">n</span>&nbsp;<span class="builtintype" id="4628539">int</span><span class="op" id="4628542">,</span>&nbsp;<span class="ident" id="4628544">err</span>&nbsp;<span class="builtintype" id="4628548">error</span><span class="op" id="4628553">)</span>&nbsp;<span class="op" id="4628555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4628558">if</span>&nbsp;<span class="ident" id="4628561">t</span><span class="op" id="4628562">.</span><span class="ident" id="4628563">n</span>&nbsp;<span class="op" id="4628565">&lt;=</span>&nbsp;<span class="num" id="4628568">0</span>&nbsp;<span class="op" id="4628570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4628574">return</span>&nbsp;<span class="builtinfunc" id="4628581">len</span><span class="op" id="4628584">(</span><span class="ident" id="4628585">p</span><span class="op" id="4628586">)</span><span class="op" id="4628587">,</span>&nbsp;<span class="ident" id="4628589">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4628594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4628597">//&nbsp;real&nbsp;write</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4628612">n</span>&nbsp;<span class="op" id="4628614">=</span>&nbsp;<span class="builtinfunc" id="4628616">len</span><span class="op" id="4628619">(</span><span class="ident" id="4628620">p</span><span class="op" id="4628621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4628624">if</span>&nbsp;<span class="ident" id="4628627">int64</span><span class="op" id="4628632">(</span><span class="ident" id="4628633">n</span><span class="op" id="4628634">)</span>&nbsp;<span class="op" id="4628636">&gt;</span>&nbsp;<span class="ident" id="4628638">t</span><span class="op" id="4628639">.</span><span class="ident" id="4628640">n</span>&nbsp;<span class="op" id="4628642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4628646">n</span>&nbsp;<span class="op" id="4628648">=</span>&nbsp;<span class="builtintype" id="4628650">int</span><span class="op" id="4628653">(</span><span class="ident" id="4628654">t</span><span class="op" id="4628655">.</span><span class="ident" id="4628656">n</span><span class="op" id="4628657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4628660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4628663">n</span><span class="op" id="4628664">,</span>&nbsp;<span class="ident" id="4628666">err</span>&nbsp;<span class="op" id="4628670">=</span>&nbsp;<span class="ident" id="4628672">t</span><span class="op" id="4628673">.</span><span class="ident" id="4628674">w</span><span class="op" id="4628675">.</span><span class="ident" id="4628676">Write</span><span class="op" id="4628681">(</span><span class="ident" id="4628682">p</span><span class="op" id="4628683">[</span><span class="num" id="4628684">0</span><span class="op" id="4628685">:</span><span class="ident" id="4628686">n</span><span class="op" id="4628687">]</span><span class="op" id="4628688">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4628691">t</span><span class="op" id="4628692">.</span><span class="ident" id="4628693">n</span>&nbsp;<span class="op" id="4628695">-=</span>&nbsp;<span class="ident" id="4628698">int64</span><span class="op" id="4628703">(</span><span class="ident" id="4628704">n</span><span class="op" id="4628705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4628708">if</span>&nbsp;<span class="ident" id="4628711">err</span>&nbsp;<span class="op" id="4628715">==</span>&nbsp;<span class="ident" id="4628718">nil</span>&nbsp;<span class="op" id="4628722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4628726">n</span>&nbsp;<span class="op" id="4628728">=</span>&nbsp;<span class="builtinfunc" id="4628730">len</span><span class="op" id="4628733">(</span><span class="ident" id="4628734">p</span><span class="op" id="4628735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4628738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4628741">return</span><br>
<span class="lineno">35</span><span class="op" id="4628748">}</span>
</div>
</body>
</html>
