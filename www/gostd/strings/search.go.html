<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html" class="current">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2927828">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2927883">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2927937">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2927988">package</span>&nbsp;<span class="ident" id="2927996">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2928005">//&nbsp;stringFinder&nbsp;efficiently&nbsp;finds&nbsp;strings&nbsp;in&nbsp;a&nbsp;source&nbsp;text.&nbsp;It&#39;s&nbsp;implemented</span><br>
<span class="lineno"></span><span class="comment" id="2928082">//&nbsp;using&nbsp;the&nbsp;Boyer-Moore&nbsp;string&nbsp;search&nbsp;algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2928132">//&nbsp;http://en.wikipedia.org/wiki/Boyer-Moore_string_search_algorithm</span><br>
<span class="lineno">10</span><span class="comment" id="2928200">//&nbsp;http://www.cs.utexas.edu/~moore/publications/fstrpos.pdf&nbsp;(note:&nbsp;this&nbsp;aged</span><br>
<span class="lineno"></span><span class="comment" id="2928277">//&nbsp;document&nbsp;uses&nbsp;1-based&nbsp;indexing)</span><br>
<span class="lineno"></span><span class="keyword" id="2928312">type</span>&nbsp;<span class="ident" id="2928317">stringFinder</span>&nbsp;<span class="keyword" id="2928330">struct</span>&nbsp;<span class="op" id="2928337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2928340">//&nbsp;pattern&nbsp;is&nbsp;the&nbsp;string&nbsp;that&nbsp;we&nbsp;are&nbsp;searching&nbsp;for&nbsp;in&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928405">pattern</span>&nbsp;<span class="builtintype" id="2928413">string</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2928422">//&nbsp;badCharSkip[b]&nbsp;contains&nbsp;the&nbsp;distance&nbsp;between&nbsp;the&nbsp;last&nbsp;byte&nbsp;of&nbsp;pattern</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2928496">//&nbsp;and&nbsp;the&nbsp;rightmost&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;pattern.&nbsp;If&nbsp;b&nbsp;is&nbsp;not&nbsp;in&nbsp;pattern,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2928570">//&nbsp;badCharSkip[b]&nbsp;is&nbsp;len(pattern).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2928606">//</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2928610">//&nbsp;Whenever&nbsp;a&nbsp;mismatch&nbsp;is&nbsp;found&nbsp;with&nbsp;byte&nbsp;b&nbsp;in&nbsp;the&nbsp;text,&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2928682">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;at&nbsp;least&nbsp;badCharSkip[b]&nbsp;until&nbsp;the&nbsp;next&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2928755">//&nbsp;the&nbsp;matching&nbsp;char&nbsp;could&nbsp;be&nbsp;in&nbsp;alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928800">badCharSkip</span>&nbsp;<span class="op" id="2928812">[</span><span class="num" id="2928813">256</span><span class="op" id="2928816">]</span><span class="builtintype" id="2928817">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2928823">//&nbsp;goodSuffixSkip[i]&nbsp;defines&nbsp;how&nbsp;far&nbsp;we&nbsp;can&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2928899">//&nbsp;that&nbsp;the&nbsp;suffix&nbsp;pattern[i+1:]&nbsp;matches,&nbsp;but&nbsp;the&nbsp;byte&nbsp;pattern[i]&nbsp;does</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2928971">//&nbsp;not.&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929013">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929017">//&nbsp;1.&nbsp;The&nbsp;matched&nbsp;suffix&nbsp;occurs&nbsp;elsewhere&nbsp;in&nbsp;pattern&nbsp;(with&nbsp;a&nbsp;different</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929089">//&nbsp;byte&nbsp;preceding&nbsp;it&nbsp;that&nbsp;we&nbsp;might&nbsp;possibly&nbsp;match).&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929163">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;to&nbsp;align&nbsp;with&nbsp;the&nbsp;next&nbsp;suffix&nbsp;chunk.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929233">//&nbsp;example,&nbsp;the&nbsp;pattern&nbsp;&#34;mississi&#34;&nbsp;has&nbsp;the&nbsp;suffix&nbsp;&#34;issi&#34;&nbsp;next&nbsp;occurring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929306">//&nbsp;(in&nbsp;right-to-left&nbsp;order)&nbsp;at&nbsp;index&nbsp;1,&nbsp;so&nbsp;goodSuffixSkip[3]&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929371">//&nbsp;shift+len(suffix)&nbsp;==&nbsp;3+4&nbsp;==&nbsp;7.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929406">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929410">//&nbsp;2.&nbsp;If&nbsp;the&nbsp;matched&nbsp;suffix&nbsp;does&nbsp;not&nbsp;occur&nbsp;elsewhere&nbsp;in&nbsp;pattern,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929485">//&nbsp;matching&nbsp;frame&nbsp;may&nbsp;share&nbsp;part&nbsp;of&nbsp;its&nbsp;prefix&nbsp;with&nbsp;the&nbsp;end&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929553">//&nbsp;matching&nbsp;suffix.&nbsp;In&nbsp;this&nbsp;case,&nbsp;goodSuffixSkip[i]&nbsp;will&nbsp;contain&nbsp;how&nbsp;far</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929627">//&nbsp;to&nbsp;shift&nbsp;the&nbsp;frame&nbsp;to&nbsp;align&nbsp;this&nbsp;portion&nbsp;of&nbsp;the&nbsp;prefix&nbsp;to&nbsp;the</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929693">//&nbsp;suffix.&nbsp;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;pattern&nbsp;&#34;abcxxxabc&#34;,&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929761">//&nbsp;mismatch&nbsp;from&nbsp;the&nbsp;back&nbsp;is&nbsp;found&nbsp;to&nbsp;be&nbsp;in&nbsp;position&nbsp;3,&nbsp;the&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929831">//&nbsp;suffix&nbsp;&#34;xxabc&#34;&nbsp;is&nbsp;not&nbsp;found&nbsp;elsewhere&nbsp;in&nbsp;the&nbsp;pattern.&nbsp;However,&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929902">//&nbsp;rightmost&nbsp;&#34;abc&#34;&nbsp;(at&nbsp;position&nbsp;6)&nbsp;is&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;whole&nbsp;pattern,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929975">//&nbsp;goodSuffixSkip[3]&nbsp;==&nbsp;shift+len(suffix)&nbsp;==&nbsp;6+5&nbsp;==&nbsp;11.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930032">goodSuffixSkip</span>&nbsp;<span class="op" id="2930047">[</span><span class="op" id="2930048">]</span><span class="builtintype" id="2930049">int</span><br>
<span class="lineno"></span><span class="op" id="2930053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2930056">func</span>&nbsp;<span class="ident" id="2930061">makeStringFinder</span><span class="op" id="2930077">(</span><span class="ident" id="2930078">pattern</span>&nbsp;<span class="builtintype" id="2930086">string</span><span class="op" id="2930092">)</span>&nbsp;<span class="op" id="2930094">*</span><span class="ident" id="2930095">stringFinder</span>&nbsp;<span class="op" id="2930108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930111">f</span>&nbsp;<span class="op" id="2930113">:=</span>&nbsp;<span class="op" id="2930116">&amp;</span><span class="ident" id="2930117">stringFinder</span><span class="op" id="2930129">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930133">pattern</span><span class="op" id="2930140">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2930149">pattern</span><span class="op" id="2930156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930160">goodSuffixSkip</span><span class="op" id="2930174">:</span>&nbsp;<span class="builtinfunc" id="2930176">make</span><span class="op" id="2930180">(</span><span class="op" id="2930181">[</span><span class="op" id="2930182">]</span><span class="builtintype" id="2930183">int</span><span class="op" id="2930186">,</span>&nbsp;<span class="builtinfunc" id="2930188">len</span><span class="op" id="2930191">(</span><span class="ident" id="2930192">pattern</span><span class="op" id="2930199">)</span><span class="op" id="2930200">)</span><span class="op" id="2930201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2930204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2930207">//&nbsp;last&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;character&nbsp;in&nbsp;the&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930267">last</span>&nbsp;<span class="op" id="2930272">:=</span>&nbsp;<span class="builtinfunc" id="2930275">len</span><span class="op" id="2930278">(</span><span class="ident" id="2930279">pattern</span><span class="op" id="2930286">)</span>&nbsp;<span class="op" id="2930288">-</span>&nbsp;<span class="num" id="2930290">1</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2930294">//&nbsp;Build&nbsp;bad&nbsp;character&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2930325">//&nbsp;Bytes&nbsp;not&nbsp;in&nbsp;the&nbsp;pattern&nbsp;can&nbsp;skip&nbsp;one&nbsp;pattern&#39;s&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2930385">for</span>&nbsp;<span class="ident" id="2930389">i</span>&nbsp;<span class="op" id="2930391">:=</span>&nbsp;<span class="keyword" id="2930394">range</span>&nbsp;<span class="ident" id="2930400">f</span><span class="op" id="2930401">.</span><span class="ident" id="2930402">badCharSkip</span>&nbsp;<span class="op" id="2930414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930418">f</span><span class="op" id="2930419">.</span><span class="ident" id="2930420">badCharSkip</span><span class="op" id="2930431">[</span><span class="ident" id="2930432">i</span><span class="op" id="2930433">]</span>&nbsp;<span class="op" id="2930435">=</span>&nbsp;<span class="builtinfunc" id="2930437">len</span><span class="op" id="2930440">(</span><span class="ident" id="2930441">pattern</span><span class="op" id="2930448">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2930451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2930454">//&nbsp;The&nbsp;loop&nbsp;condition&nbsp;is&nbsp;&lt;&nbsp;instead&nbsp;of&nbsp;&lt;=&nbsp;so&nbsp;that&nbsp;the&nbsp;last&nbsp;byte&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2930527">//&nbsp;have&nbsp;a&nbsp;zero&nbsp;distance&nbsp;to&nbsp;itself.&nbsp;Finding&nbsp;this&nbsp;byte&nbsp;out&nbsp;of&nbsp;place&nbsp;implies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2930602">//&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;last&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2930643">for</span>&nbsp;<span class="ident" id="2930647">i</span>&nbsp;<span class="op" id="2930649">:=</span>&nbsp;<span class="num" id="2930652">0</span><span class="op" id="2930653">;</span>&nbsp;<span class="ident" id="2930655">i</span>&nbsp;<span class="op" id="2930657">&lt;</span>&nbsp;<span class="ident" id="2930659">last</span><span class="op" id="2930663">;</span>&nbsp;<span class="ident" id="2930665">i</span><span class="op" id="2930666">++</span>&nbsp;<span class="op" id="2930669">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930673">f</span><span class="op" id="2930674">.</span><span class="ident" id="2930675">badCharSkip</span><span class="op" id="2930686">[</span><span class="ident" id="2930687">pattern</span><span class="op" id="2930694">[</span><span class="ident" id="2930695">i</span><span class="op" id="2930696">]</span><span class="op" id="2930697">]</span>&nbsp;<span class="op" id="2930699">=</span>&nbsp;<span class="ident" id="2930701">last</span>&nbsp;<span class="op" id="2930706">-</span>&nbsp;<span class="ident" id="2930708">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2930711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2930715">//&nbsp;Build&nbsp;good&nbsp;suffix&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2930744">//&nbsp;First&nbsp;pass:&nbsp;set&nbsp;each&nbsp;value&nbsp;to&nbsp;the&nbsp;next&nbsp;index&nbsp;which&nbsp;starts&nbsp;a&nbsp;prefix&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2930818">//&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930831">lastPrefix</span>&nbsp;<span class="op" id="2930842">:=</span>&nbsp;<span class="ident" id="2930845">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2930851">for</span>&nbsp;<span class="ident" id="2930855">i</span>&nbsp;<span class="op" id="2930857">:=</span>&nbsp;<span class="ident" id="2930860">last</span><span class="op" id="2930864">;</span>&nbsp;<span class="ident" id="2930866">i</span>&nbsp;<span class="op" id="2930868">&gt;=</span>&nbsp;<span class="num" id="2930871">0</span><span class="op" id="2930872">;</span>&nbsp;<span class="ident" id="2930874">i</span><span class="op" id="2930875">--</span>&nbsp;<span class="op" id="2930878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2930882">if</span>&nbsp;<span class="ident" id="2930885">HasPrefix</span><span class="op" id="2930894">(</span><span class="ident" id="2930895">pattern</span><span class="op" id="2930902">,</span>&nbsp;<span class="ident" id="2930904">pattern</span><span class="op" id="2930911">[</span><span class="ident" id="2930912">i</span><span class="op" id="2930913">+</span><span class="num" id="2930914">1</span><span class="op" id="2930915">:</span><span class="op" id="2930916">]</span><span class="op" id="2930917">)</span>&nbsp;<span class="op" id="2930919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930924">lastPrefix</span>&nbsp;<span class="op" id="2930935">=</span>&nbsp;<span class="ident" id="2930937">i</span>&nbsp;<span class="op" id="2930939">+</span>&nbsp;<span class="num" id="2930941">1</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2930945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2930949">//&nbsp;lastPrefix&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;(last-i)&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2931008">f</span><span class="op" id="2931009">.</span><span class="ident" id="2931010">goodSuffixSkip</span><span class="op" id="2931024">[</span><span class="ident" id="2931025">i</span><span class="op" id="2931026">]</span>&nbsp;<span class="op" id="2931028">=</span>&nbsp;<span class="ident" id="2931030">lastPrefix</span>&nbsp;<span class="op" id="2931041">+</span>&nbsp;<span class="ident" id="2931043">last</span>&nbsp;<span class="op" id="2931048">-</span>&nbsp;<span class="ident" id="2931050">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2931053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931056">//&nbsp;Second&nbsp;pass:&nbsp;find&nbsp;repeats&nbsp;of&nbsp;pattern&#39;s&nbsp;suffix&nbsp;starting&nbsp;from&nbsp;the&nbsp;front.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931131">for</span>&nbsp;<span class="ident" id="2931135">i</span>&nbsp;<span class="op" id="2931137">:=</span>&nbsp;<span class="num" id="2931140">0</span><span class="op" id="2931141">;</span>&nbsp;<span class="ident" id="2931143">i</span>&nbsp;<span class="op" id="2931145">&lt;</span>&nbsp;<span class="ident" id="2931147">last</span><span class="op" id="2931151">;</span>&nbsp;<span class="ident" id="2931153">i</span><span class="op" id="2931154">++</span>&nbsp;<span class="op" id="2931157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2931161">lenSuffix</span>&nbsp;<span class="op" id="2931171">:=</span>&nbsp;<span class="ident" id="2931174">longestCommonSuffix</span><span class="op" id="2931193">(</span><span class="ident" id="2931194">pattern</span><span class="op" id="2931201">,</span>&nbsp;<span class="ident" id="2931203">pattern</span><span class="op" id="2931210">[</span><span class="num" id="2931211">1</span><span class="op" id="2931212">:</span><span class="ident" id="2931213">i</span><span class="op" id="2931214">+</span><span class="num" id="2931215">1</span><span class="op" id="2931216">]</span><span class="op" id="2931217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931221">if</span>&nbsp;<span class="ident" id="2931224">pattern</span><span class="op" id="2931231">[</span><span class="ident" id="2931232">i</span><span class="op" id="2931233">-</span><span class="ident" id="2931234">lenSuffix</span><span class="op" id="2931243">]</span>&nbsp;<span class="op" id="2931245">!=</span>&nbsp;<span class="ident" id="2931248">pattern</span><span class="op" id="2931255">[</span><span class="ident" id="2931256">last</span><span class="op" id="2931260">-</span><span class="ident" id="2931261">lenSuffix</span><span class="op" id="2931270">]</span>&nbsp;<span class="op" id="2931272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931277">//&nbsp;(last-i)&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;lenSuffix&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2931336">f</span><span class="op" id="2931337">.</span><span class="ident" id="2931338">goodSuffixSkip</span><span class="op" id="2931352">[</span><span class="ident" id="2931353">last</span><span class="op" id="2931357">-</span><span class="ident" id="2931358">lenSuffix</span><span class="op" id="2931367">]</span>&nbsp;<span class="op" id="2931369">=</span>&nbsp;<span class="ident" id="2931371">lenSuffix</span>&nbsp;<span class="op" id="2931381">+</span>&nbsp;<span class="ident" id="2931383">last</span>&nbsp;<span class="op" id="2931388">-</span>&nbsp;<span class="ident" id="2931390">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2931394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2931397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931401">return</span>&nbsp;<span class="ident" id="2931408">f</span><br>
<span class="lineno"></span><span class="op" id="2931410">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2931413">func</span>&nbsp;<span class="ident" id="2931418">longestCommonSuffix</span><span class="op" id="2931437">(</span><span class="ident" id="2931438">a</span><span class="op" id="2931439">,</span>&nbsp;<span class="ident" id="2931441">b</span>&nbsp;<span class="builtintype" id="2931443">string</span><span class="op" id="2931449">)</span>&nbsp;<span class="op" id="2931451">(</span><span class="ident" id="2931452">i</span>&nbsp;<span class="builtintype" id="2931454">int</span><span class="op" id="2931457">)</span>&nbsp;<span class="op" id="2931459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931462">for</span>&nbsp;<span class="op" id="2931466">;</span>&nbsp;<span class="ident" id="2931468">i</span>&nbsp;<span class="op" id="2931470">&lt;</span>&nbsp;<span class="builtinfunc" id="2931472">len</span><span class="op" id="2931475">(</span><span class="ident" id="2931476">a</span><span class="op" id="2931477">)</span>&nbsp;<span class="op" id="2931479">&amp;&amp;</span>&nbsp;<span class="ident" id="2931482">i</span>&nbsp;<span class="op" id="2931484">&lt;</span>&nbsp;<span class="builtinfunc" id="2931486">len</span><span class="op" id="2931489">(</span><span class="ident" id="2931490">b</span><span class="op" id="2931491">)</span><span class="op" id="2931492">;</span>&nbsp;<span class="ident" id="2931494">i</span><span class="op" id="2931495">++</span>&nbsp;<span class="op" id="2931498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931502">if</span>&nbsp;<span class="ident" id="2931505">a</span><span class="op" id="2931506">[</span><span class="builtinfunc" id="2931507">len</span><span class="op" id="2931510">(</span><span class="ident" id="2931511">a</span><span class="op" id="2931512">)</span><span class="op" id="2931513">-</span><span class="num" id="2931514">1</span><span class="op" id="2931515">-</span><span class="ident" id="2931516">i</span><span class="op" id="2931517">]</span>&nbsp;<span class="op" id="2931519">!=</span>&nbsp;<span class="ident" id="2931522">b</span><span class="op" id="2931523">[</span><span class="builtinfunc" id="2931524">len</span><span class="op" id="2931527">(</span><span class="ident" id="2931528">b</span><span class="op" id="2931529">)</span><span class="op" id="2931530">-</span><span class="num" id="2931531">1</span><span class="op" id="2931532">-</span><span class="ident" id="2931533">i</span><span class="op" id="2931534">]</span>&nbsp;<span class="op" id="2931536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931541">break</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2931549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2931552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931555">return</span><br>
<span class="lineno"></span><span class="op" id="2931562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2931565">//&nbsp;next&nbsp;returns&nbsp;the&nbsp;index&nbsp;in&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;the&nbsp;pattern.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2931642">//&nbsp;the&nbsp;pattern&nbsp;is&nbsp;not&nbsp;found,&nbsp;it&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2931686">func</span>&nbsp;<span class="op" id="2931691">(</span><span class="ident" id="2931692">f</span>&nbsp;<span class="op" id="2931694">*</span><span class="ident" id="2931695">stringFinder</span><span class="op" id="2931707">)</span>&nbsp;<span class="ident" id="2931709">next</span><span class="op" id="2931713">(</span><span class="ident" id="2931714">text</span>&nbsp;<span class="builtintype" id="2931719">string</span><span class="op" id="2931725">)</span>&nbsp;<span class="builtintype" id="2931727">int</span>&nbsp;<span class="op" id="2931731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2931734">i</span>&nbsp;<span class="op" id="2931736">:=</span>&nbsp;<span class="builtinfunc" id="2931739">len</span><span class="op" id="2931742">(</span><span class="ident" id="2931743">f</span><span class="op" id="2931744">.</span><span class="ident" id="2931745">pattern</span><span class="op" id="2931752">)</span>&nbsp;<span class="op" id="2931754">-</span>&nbsp;<span class="num" id="2931756">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931759">for</span>&nbsp;<span class="ident" id="2931763">i</span>&nbsp;<span class="op" id="2931765">&lt;</span>&nbsp;<span class="builtinfunc" id="2931767">len</span><span class="op" id="2931770">(</span><span class="ident" id="2931771">text</span><span class="op" id="2931775">)</span>&nbsp;<span class="op" id="2931777">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931781">//&nbsp;Compare&nbsp;backwards&nbsp;from&nbsp;the&nbsp;end&nbsp;until&nbsp;the&nbsp;first&nbsp;unmatching&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2931855">j</span>&nbsp;<span class="op" id="2931857">:=</span>&nbsp;<span class="builtinfunc" id="2931860">len</span><span class="op" id="2931863">(</span><span class="ident" id="2931864">f</span><span class="op" id="2931865">.</span><span class="ident" id="2931866">pattern</span><span class="op" id="2931873">)</span>&nbsp;<span class="op" id="2931875">-</span>&nbsp;<span class="num" id="2931877">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931881">for</span>&nbsp;<span class="ident" id="2931885">j</span>&nbsp;<span class="op" id="2931887">&gt;=</span>&nbsp;<span class="num" id="2931890">0</span>&nbsp;<span class="op" id="2931892">&amp;&amp;</span>&nbsp;<span class="ident" id="2931895">text</span><span class="op" id="2931899">[</span><span class="ident" id="2931900">i</span><span class="op" id="2931901">]</span>&nbsp;<span class="op" id="2931903">==</span>&nbsp;<span class="ident" id="2931906">f</span><span class="op" id="2931907">.</span><span class="ident" id="2931908">pattern</span><span class="op" id="2931915">[</span><span class="ident" id="2931916">j</span><span class="op" id="2931917">]</span>&nbsp;<span class="op" id="2931919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2931924">i</span><span class="op" id="2931925">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2931931">j</span><span class="op" id="2931932">--</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2931937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931941">if</span>&nbsp;<span class="ident" id="2931944">j</span>&nbsp;<span class="op" id="2931946">&lt;</span>&nbsp;<span class="num" id="2931948">0</span>&nbsp;<span class="op" id="2931950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2931955">return</span>&nbsp;<span class="ident" id="2931962">i</span>&nbsp;<span class="op" id="2931964">+</span>&nbsp;<span class="num" id="2931966">1</span>&nbsp;<span class="comment" id="2931968">//&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2931979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2931983">i</span>&nbsp;<span class="op" id="2931985">+=</span>&nbsp;<span class="ident" id="2931988">max</span><span class="op" id="2931991">(</span><span class="ident" id="2931992">f</span><span class="op" id="2931993">.</span><span class="ident" id="2931994">badCharSkip</span><span class="op" id="2932005">[</span><span class="ident" id="2932006">text</span><span class="op" id="2932010">[</span><span class="ident" id="2932011">i</span><span class="op" id="2932012">]</span><span class="op" id="2932013">]</span><span class="op" id="2932014">,</span>&nbsp;<span class="ident" id="2932016">f</span><span class="op" id="2932017">.</span><span class="ident" id="2932018">goodSuffixSkip</span><span class="op" id="2932032">[</span><span class="ident" id="2932033">j</span><span class="op" id="2932034">]</span><span class="op" id="2932035">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932041">return</span>&nbsp;<span class="op" id="2932048">-</span><span class="num" id="2932049">1</span><br>
<span class="lineno"></span><span class="op" id="2932051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2932054">func</span>&nbsp;<span class="ident" id="2932059">max</span><span class="op" id="2932062">(</span><span class="ident" id="2932063">a</span><span class="op" id="2932064">,</span>&nbsp;<span class="ident" id="2932066">b</span>&nbsp;<span class="builtintype" id="2932068">int</span><span class="op" id="2932071">)</span>&nbsp;<span class="builtintype" id="2932073">int</span>&nbsp;<span class="op" id="2932077">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932080">if</span>&nbsp;<span class="ident" id="2932083">a</span>&nbsp;<span class="op" id="2932085">&gt;</span>&nbsp;<span class="ident" id="2932087">b</span>&nbsp;<span class="op" id="2932089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932093">return</span>&nbsp;<span class="ident" id="2932100">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932106">return</span>&nbsp;<span class="ident" id="2932113">b</span><br>
<span class="lineno"></span><span class="op" id="2932115">}</span>
</div>
</body>
</html>
