<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html" class="current">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6765573">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6765629">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6765683">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6765734">//&nbsp;+build&nbsp;!nacl,!plan9,!windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6765767">package</span>&nbsp;<span class="ident" id="6765775">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6765780">import</span>&nbsp;<span class="op" id="6765787">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6765790">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6765799">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6765805">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6765816">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6765827">&#34;syscall&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6765838">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6765849">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6765856">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6765859">func</span>&nbsp;<span class="ident" id="6765864">TestReadUnixgramWithUnnamedSocket</span><span class="op" id="6765897">(</span><span class="ident" id="6765898">t</span>&nbsp;<span class="op" id="6765900">*</span><span class="ident" id="6765901">testing</span><span class="op" id="6765908">.</span><span class="ident" id="6765909">T</span><span class="op" id="6765910">)</span>&nbsp;<span class="op" id="6765912">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765915">addr</span>&nbsp;<span class="op" id="6765920">:=</span>&nbsp;<span class="ident" id="6765923">testUnixAddr</span><span class="op" id="6765935">(</span><span class="op" id="6765936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765939">la</span><span class="op" id="6765941">,</span>&nbsp;<span class="ident" id="6765943">err</span>&nbsp;<span class="op" id="6765947">:=</span>&nbsp;<span class="ident" id="6765950">ResolveUnixAddr</span><span class="op" id="6765965">(</span><span class="string" id="6765966">&#34;unixgram&#34;</span><span class="op" id="6765976">,</span>&nbsp;<span class="ident" id="6765978">addr</span><span class="op" id="6765982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6765985">if</span>&nbsp;<span class="ident" id="6765988">err</span>&nbsp;<span class="op" id="6765992">!=</span>&nbsp;<span class="ident" id="6765995">nil</span>&nbsp;<span class="op" id="6765999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766003">t</span><span class="op" id="6766004">.</span><span class="ident" id="6766005">Fatalf</span><span class="op" id="6766011">(</span><span class="string" id="6766012">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6766040">,</span>&nbsp;<span class="ident" id="6766042">err</span><span class="op" id="6766045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6766048">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766051">c</span><span class="op" id="6766052">,</span>&nbsp;<span class="ident" id="6766054">err</span>&nbsp;<span class="op" id="6766058">:=</span>&nbsp;<span class="ident" id="6766061">ListenUnixgram</span><span class="op" id="6766075">(</span><span class="string" id="6766076">&#34;unixgram&#34;</span><span class="op" id="6766086">,</span>&nbsp;<span class="ident" id="6766088">la</span><span class="op" id="6766090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6766093">if</span>&nbsp;<span class="ident" id="6766096">err</span>&nbsp;<span class="op" id="6766100">!=</span>&nbsp;<span class="ident" id="6766103">nil</span>&nbsp;<span class="op" id="6766107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766111">t</span><span class="op" id="6766112">.</span><span class="ident" id="6766113">Fatalf</span><span class="op" id="6766119">(</span><span class="string" id="6766120">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6766147">,</span>&nbsp;<span class="ident" id="6766149">err</span><span class="op" id="6766152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6766155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6766158">defer</span>&nbsp;<span class="keyword" id="6766164">func</span><span class="op" id="6766168">(</span><span class="op" id="6766169">)</span>&nbsp;<span class="op" id="6766171">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766175">c</span><span class="op" id="6766176">.</span><span class="ident" id="6766177">Close</span><span class="op" id="6766182">(</span><span class="op" id="6766183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766187">os</span><span class="op" id="6766189">.</span><span class="ident" id="6766190">Remove</span><span class="op" id="6766196">(</span><span class="ident" id="6766197">addr</span><span class="op" id="6766201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6766204">}</span><span class="op" id="6766205">(</span><span class="op" id="6766206">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766210">off</span>&nbsp;<span class="op" id="6766214">:=</span>&nbsp;<span class="builtinfunc" id="6766217">make</span><span class="op" id="6766221">(</span><span class="keyword" id="6766222">chan</span>&nbsp;<span class="builtintype" id="6766227">bool</span><span class="op" id="6766231">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766234">data</span>&nbsp;<span class="op" id="6766239">:=</span>&nbsp;<span class="op" id="6766242">[</span><span class="num" id="6766243">5</span><span class="op" id="6766244">]</span><span class="builtintype" id="6766245">byte</span><span class="op" id="6766249">{</span><span class="num" id="6766250">1</span><span class="op" id="6766251">,</span>&nbsp;<span class="num" id="6766253">2</span><span class="op" id="6766254">,</span>&nbsp;<span class="num" id="6766256">3</span><span class="op" id="6766257">,</span>&nbsp;<span class="num" id="6766259">4</span><span class="op" id="6766260">,</span>&nbsp;<span class="num" id="6766262">5</span><span class="op" id="6766263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6766266">go</span>&nbsp;<span class="keyword" id="6766269">func</span><span class="op" id="6766273">(</span><span class="op" id="6766274">)</span>&nbsp;<span class="op" id="6766276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6766280">defer</span>&nbsp;<span class="keyword" id="6766286">func</span><span class="op" id="6766290">(</span><span class="op" id="6766291">)</span>&nbsp;<span class="op" id="6766293">{</span>&nbsp;<span class="ident" id="6766295">off</span>&nbsp;<span class="op" id="6766299">&lt;-</span>&nbsp;<span class="builtintype" id="6766302">true</span>&nbsp;<span class="op" id="6766307">}</span><span class="op" id="6766308">(</span><span class="op" id="6766309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766313">s</span><span class="op" id="6766314">,</span>&nbsp;<span class="ident" id="6766316">err</span>&nbsp;<span class="op" id="6766320">:=</span>&nbsp;<span class="ident" id="6766323">syscall</span><span class="op" id="6766330">.</span><span class="ident" id="6766331">Socket</span><span class="op" id="6766337">(</span><span class="ident" id="6766338">syscall</span><span class="op" id="6766345">.</span><span class="ident" id="6766346">AF_UNIX</span><span class="op" id="6766353">,</span>&nbsp;<span class="ident" id="6766355">syscall</span><span class="op" id="6766362">.</span><span class="ident" id="6766363">SOCK_DGRAM</span><span class="op" id="6766373">,</span>&nbsp;<span class="num" id="6766375">0</span><span class="op" id="6766376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6766380">if</span>&nbsp;<span class="ident" id="6766383">err</span>&nbsp;<span class="op" id="6766387">!=</span>&nbsp;<span class="ident" id="6766390">nil</span>&nbsp;<span class="op" id="6766394">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766399">t</span><span class="op" id="6766400">.</span><span class="ident" id="6766401">Errorf</span><span class="op" id="6766407">(</span><span class="string" id="6766408">&#34;syscall.Socket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6766435">,</span>&nbsp;<span class="ident" id="6766437">err</span><span class="op" id="6766440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6766445">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6766454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6766458">defer</span>&nbsp;<span class="ident" id="6766464">syscall</span><span class="op" id="6766471">.</span><span class="ident" id="6766472">Close</span><span class="op" id="6766477">(</span><span class="ident" id="6766478">s</span><span class="op" id="6766479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766483">rsa</span>&nbsp;<span class="op" id="6766487">:=</span>&nbsp;<span class="op" id="6766490">&amp;</span><span class="ident" id="6766491">syscall</span><span class="op" id="6766498">.</span><span class="ident" id="6766499">SockaddrUnix</span><span class="op" id="6766511">{</span><span class="ident" id="6766512">Name</span><span class="op" id="6766516">:</span>&nbsp;<span class="ident" id="6766518">addr</span><span class="op" id="6766522">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6766526">if</span>&nbsp;<span class="ident" id="6766529">err</span>&nbsp;<span class="op" id="6766533">:=</span>&nbsp;<span class="ident" id="6766536">syscall</span><span class="op" id="6766543">.</span><span class="ident" id="6766544">Sendto</span><span class="op" id="6766550">(</span><span class="ident" id="6766551">s</span><span class="op" id="6766552">,</span>&nbsp;<span class="ident" id="6766554">data</span><span class="op" id="6766558">[</span><span class="op" id="6766559">:</span><span class="op" id="6766560">]</span><span class="op" id="6766561">,</span>&nbsp;<span class="num" id="6766563">0</span><span class="op" id="6766564">,</span>&nbsp;<span class="ident" id="6766566">rsa</span><span class="op" id="6766569">)</span><span class="op" id="6766570">;</span>&nbsp;<span class="ident" id="6766572">err</span>&nbsp;<span class="op" id="6766576">!=</span>&nbsp;<span class="ident" id="6766579">nil</span>&nbsp;<span class="op" id="6766583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766588">t</span><span class="op" id="6766589">.</span><span class="ident" id="6766590">Errorf</span><span class="op" id="6766596">(</span><span class="string" id="6766597">&#34;syscall.Sendto&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6766624">,</span>&nbsp;<span class="ident" id="6766626">err</span><span class="op" id="6766629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6766634">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6766643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6766646">}</span><span class="op" id="6766647">(</span><span class="op" id="6766648">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6766652">&lt;-</span><span class="ident" id="6766654">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766659">b</span>&nbsp;<span class="op" id="6766661">:=</span>&nbsp;<span class="builtinfunc" id="6766664">make</span><span class="op" id="6766668">(</span><span class="op" id="6766669">[</span><span class="op" id="6766670">]</span><span class="builtintype" id="6766671">byte</span><span class="op" id="6766675">,</span>&nbsp;<span class="num" id="6766677">64</span><span class="op" id="6766679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766682">c</span><span class="op" id="6766683">.</span><span class="ident" id="6766684">SetReadDeadline</span><span class="op" id="6766699">(</span><span class="ident" id="6766700">time</span><span class="op" id="6766704">.</span><span class="ident" id="6766705">Now</span><span class="op" id="6766708">(</span><span class="op" id="6766709">)</span><span class="op" id="6766710">.</span><span class="ident" id="6766711">Add</span><span class="op" id="6766714">(</span><span class="num" id="6766715">100</span>&nbsp;<span class="op" id="6766719">*</span>&nbsp;<span class="ident" id="6766721">time</span><span class="op" id="6766725">.</span><span class="ident" id="6766726">Millisecond</span><span class="op" id="6766737">)</span><span class="op" id="6766738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766741">n</span><span class="op" id="6766742">,</span>&nbsp;<span class="ident" id="6766744">from</span><span class="op" id="6766748">,</span>&nbsp;<span class="ident" id="6766750">err</span>&nbsp;<span class="op" id="6766754">:=</span>&nbsp;<span class="ident" id="6766757">c</span><span class="op" id="6766758">.</span><span class="ident" id="6766759">ReadFrom</span><span class="op" id="6766767">(</span><span class="ident" id="6766768">b</span><span class="op" id="6766769">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6766772">if</span>&nbsp;<span class="ident" id="6766775">err</span>&nbsp;<span class="op" id="6766779">!=</span>&nbsp;<span class="ident" id="6766782">nil</span>&nbsp;<span class="op" id="6766786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766790">t</span><span class="op" id="6766791">.</span><span class="ident" id="6766792">Fatalf</span><span class="op" id="6766798">(</span><span class="string" id="6766799">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6766829">,</span>&nbsp;<span class="ident" id="6766831">err</span><span class="op" id="6766834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6766837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6766840">if</span>&nbsp;<span class="ident" id="6766843">from</span>&nbsp;<span class="op" id="6766848">!=</span>&nbsp;<span class="ident" id="6766851">nil</span>&nbsp;<span class="op" id="6766855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766859">t</span><span class="op" id="6766860">.</span><span class="ident" id="6766861">Fatalf</span><span class="op" id="6766867">(</span><span class="string" id="6766868">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="6766892">,</span>&nbsp;<span class="ident" id="6766894">from</span><span class="op" id="6766898">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6766901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6766904">if</span>&nbsp;<span class="op" id="6766907">!</span><span class="ident" id="6766908">bytes</span><span class="op" id="6766913">.</span><span class="ident" id="6766914">Equal</span><span class="op" id="6766919">(</span><span class="ident" id="6766920">b</span><span class="op" id="6766921">[</span><span class="op" id="6766922">:</span><span class="ident" id="6766923">n</span><span class="op" id="6766924">]</span><span class="op" id="6766925">,</span>&nbsp;<span class="ident" id="6766927">data</span><span class="op" id="6766931">[</span><span class="op" id="6766932">:</span><span class="op" id="6766933">]</span><span class="op" id="6766934">)</span>&nbsp;<span class="op" id="6766936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766940">t</span><span class="op" id="6766941">.</span><span class="ident" id="6766942">Fatalf</span><span class="op" id="6766948">(</span><span class="string" id="6766949">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6766966">,</span>&nbsp;<span class="ident" id="6766968">b</span><span class="op" id="6766969">[</span><span class="op" id="6766970">:</span><span class="ident" id="6766971">n</span><span class="op" id="6766972">]</span><span class="op" id="6766973">,</span>&nbsp;<span class="ident" id="6766975">data</span><span class="op" id="6766979">[</span><span class="op" id="6766980">:</span><span class="op" id="6766981">]</span><span class="op" id="6766982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6766985">}</span><br>
<span class="lineno"></span><span class="op" id="6766987">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="6766990">func</span>&nbsp;<span class="ident" id="6766995">TestReadUnixgramWithZeroBytesBuffer</span><span class="op" id="6767030">(</span><span class="ident" id="6767031">t</span>&nbsp;<span class="op" id="6767033">*</span><span class="ident" id="6767034">testing</span><span class="op" id="6767041">.</span><span class="ident" id="6767042">T</span><span class="op" id="6767043">)</span>&nbsp;<span class="op" id="6767045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6767048">//&nbsp;issue&nbsp;4352:&nbsp;Recvfrom&nbsp;failed&nbsp;with&nbsp;&#34;address&nbsp;family&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6767105">//&nbsp;supported&nbsp;by&nbsp;protocol&nbsp;family&#34;&nbsp;if&nbsp;zero-length&nbsp;buffer&nbsp;provided</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767171">addr</span>&nbsp;<span class="op" id="6767176">:=</span>&nbsp;<span class="ident" id="6767179">testUnixAddr</span><span class="op" id="6767191">(</span><span class="op" id="6767192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767195">la</span><span class="op" id="6767197">,</span>&nbsp;<span class="ident" id="6767199">err</span>&nbsp;<span class="op" id="6767203">:=</span>&nbsp;<span class="ident" id="6767206">ResolveUnixAddr</span><span class="op" id="6767221">(</span><span class="string" id="6767222">&#34;unixgram&#34;</span><span class="op" id="6767232">,</span>&nbsp;<span class="ident" id="6767234">addr</span><span class="op" id="6767238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767241">if</span>&nbsp;<span class="ident" id="6767244">err</span>&nbsp;<span class="op" id="6767248">!=</span>&nbsp;<span class="ident" id="6767251">nil</span>&nbsp;<span class="op" id="6767255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767259">t</span><span class="op" id="6767260">.</span><span class="ident" id="6767261">Fatalf</span><span class="op" id="6767267">(</span><span class="string" id="6767268">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6767296">,</span>&nbsp;<span class="ident" id="6767298">err</span><span class="op" id="6767301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6767304">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767307">c</span><span class="op" id="6767308">,</span>&nbsp;<span class="ident" id="6767310">err</span>&nbsp;<span class="op" id="6767314">:=</span>&nbsp;<span class="ident" id="6767317">ListenUnixgram</span><span class="op" id="6767331">(</span><span class="string" id="6767332">&#34;unixgram&#34;</span><span class="op" id="6767342">,</span>&nbsp;<span class="ident" id="6767344">la</span><span class="op" id="6767346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767349">if</span>&nbsp;<span class="ident" id="6767352">err</span>&nbsp;<span class="op" id="6767356">!=</span>&nbsp;<span class="ident" id="6767359">nil</span>&nbsp;<span class="op" id="6767363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767367">t</span><span class="op" id="6767368">.</span><span class="ident" id="6767369">Fatalf</span><span class="op" id="6767375">(</span><span class="string" id="6767376">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6767403">,</span>&nbsp;<span class="ident" id="6767405">err</span><span class="op" id="6767408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6767411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767414">defer</span>&nbsp;<span class="keyword" id="6767420">func</span><span class="op" id="6767424">(</span><span class="op" id="6767425">)</span>&nbsp;<span class="op" id="6767427">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767431">c</span><span class="op" id="6767432">.</span><span class="ident" id="6767433">Close</span><span class="op" id="6767438">(</span><span class="op" id="6767439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767443">os</span><span class="op" id="6767445">.</span><span class="ident" id="6767446">Remove</span><span class="op" id="6767452">(</span><span class="ident" id="6767453">addr</span><span class="op" id="6767457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6767460">}</span><span class="op" id="6767461">(</span><span class="op" id="6767462">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767466">off</span>&nbsp;<span class="op" id="6767470">:=</span>&nbsp;<span class="builtinfunc" id="6767473">make</span><span class="op" id="6767477">(</span><span class="keyword" id="6767478">chan</span>&nbsp;<span class="builtintype" id="6767483">bool</span><span class="op" id="6767487">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767490">go</span>&nbsp;<span class="keyword" id="6767493">func</span><span class="op" id="6767497">(</span><span class="op" id="6767498">)</span>&nbsp;<span class="op" id="6767500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767504">defer</span>&nbsp;<span class="keyword" id="6767510">func</span><span class="op" id="6767514">(</span><span class="op" id="6767515">)</span>&nbsp;<span class="op" id="6767517">{</span>&nbsp;<span class="ident" id="6767519">off</span>&nbsp;<span class="op" id="6767523">&lt;-</span>&nbsp;<span class="builtintype" id="6767526">true</span>&nbsp;<span class="op" id="6767531">}</span><span class="op" id="6767532">(</span><span class="op" id="6767533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767537">c</span><span class="op" id="6767538">,</span>&nbsp;<span class="ident" id="6767540">err</span>&nbsp;<span class="op" id="6767544">:=</span>&nbsp;<span class="ident" id="6767547">DialUnix</span><span class="op" id="6767555">(</span><span class="string" id="6767556">&#34;unixgram&#34;</span><span class="op" id="6767566">,</span>&nbsp;<span class="ident" id="6767568">nil</span><span class="op" id="6767571">,</span>&nbsp;<span class="ident" id="6767573">la</span><span class="op" id="6767575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767579">if</span>&nbsp;<span class="ident" id="6767582">err</span>&nbsp;<span class="op" id="6767586">!=</span>&nbsp;<span class="ident" id="6767589">nil</span>&nbsp;<span class="op" id="6767593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767598">t</span><span class="op" id="6767599">.</span><span class="ident" id="6767600">Errorf</span><span class="op" id="6767606">(</span><span class="string" id="6767607">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6767628">,</span>&nbsp;<span class="ident" id="6767630">err</span><span class="op" id="6767633">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767638">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6767647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767651">defer</span>&nbsp;<span class="ident" id="6767657">c</span><span class="op" id="6767658">.</span><span class="ident" id="6767659">Close</span><span class="op" id="6767664">(</span><span class="op" id="6767665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767669">if</span>&nbsp;<span class="ident" id="6767672">_</span><span class="op" id="6767673">,</span>&nbsp;<span class="ident" id="6767675">err</span>&nbsp;<span class="op" id="6767679">:=</span>&nbsp;<span class="ident" id="6767682">c</span><span class="op" id="6767683">.</span><span class="ident" id="6767684">Write</span><span class="op" id="6767689">(</span><span class="op" id="6767690">[</span><span class="op" id="6767691">]</span><span class="builtintype" id="6767692">byte</span><span class="op" id="6767696">{</span><span class="num" id="6767697">1</span><span class="op" id="6767698">,</span>&nbsp;<span class="num" id="6767700">2</span><span class="op" id="6767701">,</span>&nbsp;<span class="num" id="6767703">3</span><span class="op" id="6767704">,</span>&nbsp;<span class="num" id="6767706">4</span><span class="op" id="6767707">,</span>&nbsp;<span class="num" id="6767709">5</span><span class="op" id="6767710">}</span><span class="op" id="6767711">)</span><span class="op" id="6767712">;</span>&nbsp;<span class="ident" id="6767714">err</span>&nbsp;<span class="op" id="6767718">!=</span>&nbsp;<span class="ident" id="6767721">nil</span>&nbsp;<span class="op" id="6767725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767730">t</span><span class="op" id="6767731">.</span><span class="ident" id="6767732">Errorf</span><span class="op" id="6767738">(</span><span class="string" id="6767739">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6767766">,</span>&nbsp;<span class="ident" id="6767768">err</span><span class="op" id="6767771">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767776">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6767785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6767788">}</span><span class="op" id="6767789">(</span><span class="op" id="6767790">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6767794">&lt;-</span><span class="ident" id="6767796">off</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767801">c</span><span class="op" id="6767802">.</span><span class="ident" id="6767803">SetReadDeadline</span><span class="op" id="6767818">(</span><span class="ident" id="6767819">time</span><span class="op" id="6767823">.</span><span class="ident" id="6767824">Now</span><span class="op" id="6767827">(</span><span class="op" id="6767828">)</span><span class="op" id="6767829">.</span><span class="ident" id="6767830">Add</span><span class="op" id="6767833">(</span><span class="num" id="6767834">100</span>&nbsp;<span class="op" id="6767838">*</span>&nbsp;<span class="ident" id="6767840">time</span><span class="op" id="6767844">.</span><span class="ident" id="6767845">Millisecond</span><span class="op" id="6767856">)</span><span class="op" id="6767857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767860">_</span><span class="op" id="6767861">,</span>&nbsp;<span class="ident" id="6767863">from</span><span class="op" id="6767867">,</span>&nbsp;<span class="ident" id="6767869">err</span>&nbsp;<span class="op" id="6767873">:=</span>&nbsp;<span class="ident" id="6767876">c</span><span class="op" id="6767877">.</span><span class="ident" id="6767878">ReadFrom</span><span class="op" id="6767886">(</span><span class="ident" id="6767887">nil</span><span class="op" id="6767890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767893">if</span>&nbsp;<span class="ident" id="6767896">err</span>&nbsp;<span class="op" id="6767900">!=</span>&nbsp;<span class="ident" id="6767903">nil</span>&nbsp;<span class="op" id="6767907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767911">t</span><span class="op" id="6767912">.</span><span class="ident" id="6767913">Fatalf</span><span class="op" id="6767919">(</span><span class="string" id="6767920">&#34;UnixConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6767950">,</span>&nbsp;<span class="ident" id="6767952">err</span><span class="op" id="6767955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6767958">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767961">if</span>&nbsp;<span class="ident" id="6767964">from</span>&nbsp;<span class="op" id="6767969">!=</span>&nbsp;<span class="ident" id="6767972">nil</span>&nbsp;<span class="op" id="6767976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767980">t</span><span class="op" id="6767981">.</span><span class="ident" id="6767982">Fatalf</span><span class="op" id="6767988">(</span><span class="string" id="6767989">&#34;neighbor&nbsp;address&nbsp;is&nbsp;%v&#34;</span><span class="op" id="6768013">,</span>&nbsp;<span class="ident" id="6768015">from</span><span class="op" id="6768019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768022">}</span><br>
<span class="lineno"></span><span class="op" id="6768024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6768027">func</span>&nbsp;<span class="ident" id="6768032">TestUnixgramAutobind</span><span class="op" id="6768052">(</span><span class="ident" id="6768053">t</span>&nbsp;<span class="op" id="6768055">*</span><span class="ident" id="6768056">testing</span><span class="op" id="6768063">.</span><span class="ident" id="6768064">T</span><span class="op" id="6768065">)</span>&nbsp;<span class="op" id="6768067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768070">if</span>&nbsp;<span class="ident" id="6768073">runtime</span><span class="op" id="6768080">.</span><span class="ident" id="6768081">GOOS</span>&nbsp;<span class="op" id="6768086">!=</span>&nbsp;<span class="string" id="6768089">&#34;linux&#34;</span>&nbsp;<span class="op" id="6768097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768101">t</span><span class="op" id="6768102">.</span><span class="ident" id="6768103">Skip</span><span class="op" id="6768107">(</span><span class="string" id="6768108">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="6768142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768149">laddr</span>&nbsp;<span class="op" id="6768155">:=</span>&nbsp;<span class="op" id="6768158">&amp;</span><span class="ident" id="6768159">UnixAddr</span><span class="op" id="6768167">{</span><span class="ident" id="6768168">Name</span><span class="op" id="6768172">:</span>&nbsp;<span class="string" id="6768174">&#34;&#34;</span><span class="op" id="6768176">,</span>&nbsp;<span class="ident" id="6768178">Net</span><span class="op" id="6768181">:</span>&nbsp;<span class="string" id="6768183">&#34;unixgram&#34;</span><span class="op" id="6768193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768196">c1</span><span class="op" id="6768198">,</span>&nbsp;<span class="ident" id="6768200">err</span>&nbsp;<span class="op" id="6768204">:=</span>&nbsp;<span class="ident" id="6768207">ListenUnixgram</span><span class="op" id="6768221">(</span><span class="string" id="6768222">&#34;unixgram&#34;</span><span class="op" id="6768232">,</span>&nbsp;<span class="ident" id="6768234">laddr</span><span class="op" id="6768239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768242">if</span>&nbsp;<span class="ident" id="6768245">err</span>&nbsp;<span class="op" id="6768249">!=</span>&nbsp;<span class="ident" id="6768252">nil</span>&nbsp;<span class="op" id="6768256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768260">t</span><span class="op" id="6768261">.</span><span class="ident" id="6768262">Fatalf</span><span class="op" id="6768268">(</span><span class="string" id="6768269">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6768296">,</span>&nbsp;<span class="ident" id="6768298">err</span><span class="op" id="6768301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768304">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768307">defer</span>&nbsp;<span class="ident" id="6768313">c1</span><span class="op" id="6768315">.</span><span class="ident" id="6768316">Close</span><span class="op" id="6768321">(</span><span class="op" id="6768322">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6768326">//&nbsp;retrieve&nbsp;the&nbsp;autobind&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768360">autoAddr</span>&nbsp;<span class="op" id="6768369">:=</span>&nbsp;<span class="ident" id="6768372">c1</span><span class="op" id="6768374">.</span><span class="ident" id="6768375">LocalAddr</span><span class="op" id="6768384">(</span><span class="op" id="6768385">)</span><span class="op" id="6768386">.</span><span class="op" id="6768387">(</span><span class="op" id="6768388">*</span><span class="ident" id="6768389">UnixAddr</span><span class="op" id="6768397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768400">if</span>&nbsp;<span class="builtinfunc" id="6768403">len</span><span class="op" id="6768406">(</span><span class="ident" id="6768407">autoAddr</span><span class="op" id="6768415">.</span><span class="ident" id="6768416">Name</span><span class="op" id="6768420">)</span>&nbsp;<span class="op" id="6768422">&lt;=</span>&nbsp;<span class="num" id="6768425">1</span>&nbsp;<span class="op" id="6768427">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768431">t</span><span class="op" id="6768432">.</span><span class="ident" id="6768433">Fatalf</span><span class="op" id="6768439">(</span><span class="string" id="6768440">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="6768470">,</span>&nbsp;<span class="ident" id="6768472">autoAddr</span><span class="op" id="6768480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768486">if</span>&nbsp;<span class="ident" id="6768489">autoAddr</span><span class="op" id="6768497">.</span><span class="ident" id="6768498">Name</span><span class="op" id="6768502">[</span><span class="num" id="6768503">0</span><span class="op" id="6768504">]</span>&nbsp;<span class="op" id="6768506">!=</span>&nbsp;<span class="string" id="6768509">&#39;@&#39;</span>&nbsp;<span class="op" id="6768513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768517">t</span><span class="op" id="6768518">.</span><span class="ident" id="6768519">Fatalf</span><span class="op" id="6768525">(</span><span class="string" id="6768526">&#34;invalid&nbsp;autobind&nbsp;address:&nbsp;%v&#34;</span><span class="op" id="6768556">,</span>&nbsp;<span class="ident" id="6768558">autoAddr</span><span class="op" id="6768566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768569">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768573">c2</span><span class="op" id="6768575">,</span>&nbsp;<span class="ident" id="6768577">err</span>&nbsp;<span class="op" id="6768581">:=</span>&nbsp;<span class="ident" id="6768584">DialUnix</span><span class="op" id="6768592">(</span><span class="string" id="6768593">&#34;unixgram&#34;</span><span class="op" id="6768603">,</span>&nbsp;<span class="ident" id="6768605">nil</span><span class="op" id="6768608">,</span>&nbsp;<span class="ident" id="6768610">autoAddr</span><span class="op" id="6768618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768621">if</span>&nbsp;<span class="ident" id="6768624">err</span>&nbsp;<span class="op" id="6768628">!=</span>&nbsp;<span class="ident" id="6768631">nil</span>&nbsp;<span class="op" id="6768635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768639">t</span><span class="op" id="6768640">.</span><span class="ident" id="6768641">Fatalf</span><span class="op" id="6768647">(</span><span class="string" id="6768648">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6768669">,</span>&nbsp;<span class="ident" id="6768671">err</span><span class="op" id="6768674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768677">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768680">defer</span>&nbsp;<span class="ident" id="6768686">c2</span><span class="op" id="6768688">.</span><span class="ident" id="6768689">Close</span><span class="op" id="6768694">(</span><span class="op" id="6768695">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768699">if</span>&nbsp;<span class="op" id="6768702">!</span><span class="ident" id="6768703">reflect</span><span class="op" id="6768710">.</span><span class="ident" id="6768711">DeepEqual</span><span class="op" id="6768720">(</span><span class="ident" id="6768721">c1</span><span class="op" id="6768723">.</span><span class="ident" id="6768724">LocalAddr</span><span class="op" id="6768733">(</span><span class="op" id="6768734">)</span><span class="op" id="6768735">,</span>&nbsp;<span class="ident" id="6768737">c2</span><span class="op" id="6768739">.</span><span class="ident" id="6768740">RemoteAddr</span><span class="op" id="6768750">(</span><span class="op" id="6768751">)</span><span class="op" id="6768752">)</span>&nbsp;<span class="op" id="6768754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768758">t</span><span class="op" id="6768759">.</span><span class="ident" id="6768760">Fatalf</span><span class="op" id="6768766">(</span><span class="string" id="6768767">&#34;expected&nbsp;autobind&nbsp;address&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6768805">,</span>&nbsp;<span class="ident" id="6768807">c1</span><span class="op" id="6768809">.</span><span class="ident" id="6768810">LocalAddr</span><span class="op" id="6768819">(</span><span class="op" id="6768820">)</span><span class="op" id="6768821">,</span>&nbsp;<span class="ident" id="6768823">c2</span><span class="op" id="6768825">.</span><span class="ident" id="6768826">RemoteAddr</span><span class="op" id="6768836">(</span><span class="op" id="6768837">)</span><span class="op" id="6768838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768841">}</span><br>
<span class="lineno">140</span><span class="op" id="6768843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6768846">func</span>&nbsp;<span class="ident" id="6768851">TestUnixAutobindClose</span><span class="op" id="6768872">(</span><span class="ident" id="6768873">t</span>&nbsp;<span class="op" id="6768875">*</span><span class="ident" id="6768876">testing</span><span class="op" id="6768883">.</span><span class="ident" id="6768884">T</span><span class="op" id="6768885">)</span>&nbsp;<span class="op" id="6768887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768890">if</span>&nbsp;<span class="ident" id="6768893">runtime</span><span class="op" id="6768900">.</span><span class="ident" id="6768901">GOOS</span>&nbsp;<span class="op" id="6768906">!=</span>&nbsp;<span class="string" id="6768909">&#34;linux&#34;</span>&nbsp;<span class="op" id="6768917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768921">t</span><span class="op" id="6768922">.</span><span class="ident" id="6768923">Skip</span><span class="op" id="6768927">(</span><span class="string" id="6768928">&#34;skipping:&nbsp;autobind&nbsp;is&nbsp;linux&nbsp;only&#34;</span><span class="op" id="6768962">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768968">laddr</span>&nbsp;<span class="op" id="6768974">:=</span>&nbsp;<span class="op" id="6768977">&amp;</span><span class="ident" id="6768978">UnixAddr</span><span class="op" id="6768986">{</span><span class="ident" id="6768987">Name</span><span class="op" id="6768991">:</span>&nbsp;<span class="string" id="6768993">&#34;&#34;</span><span class="op" id="6768995">,</span>&nbsp;<span class="ident" id="6768997">Net</span><span class="op" id="6769000">:</span>&nbsp;<span class="string" id="6769002">&#34;unix&#34;</span><span class="op" id="6769008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769011">ln</span><span class="op" id="6769013">,</span>&nbsp;<span class="ident" id="6769015">err</span>&nbsp;<span class="op" id="6769019">:=</span>&nbsp;<span class="ident" id="6769022">ListenUnix</span><span class="op" id="6769032">(</span><span class="string" id="6769033">&#34;unix&#34;</span><span class="op" id="6769039">,</span>&nbsp;<span class="ident" id="6769041">laddr</span><span class="op" id="6769046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769049">if</span>&nbsp;<span class="ident" id="6769052">err</span>&nbsp;<span class="op" id="6769056">!=</span>&nbsp;<span class="ident" id="6769059">nil</span>&nbsp;<span class="op" id="6769063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769067">t</span><span class="op" id="6769068">.</span><span class="ident" id="6769069">Fatalf</span><span class="op" id="6769075">(</span><span class="string" id="6769076">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6769099">,</span>&nbsp;<span class="ident" id="6769101">err</span><span class="op" id="6769104">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6769107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769110">ln</span><span class="op" id="6769112">.</span><span class="ident" id="6769113">Close</span><span class="op" id="6769118">(</span><span class="op" id="6769119">)</span><br>
<span class="lineno"></span><span class="op" id="6769121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6769124">func</span>&nbsp;<span class="ident" id="6769129">TestUnixgramWrite</span><span class="op" id="6769146">(</span><span class="ident" id="6769147">t</span>&nbsp;<span class="op" id="6769149">*</span><span class="ident" id="6769150">testing</span><span class="op" id="6769157">.</span><span class="ident" id="6769158">T</span><span class="op" id="6769159">)</span>&nbsp;<span class="op" id="6769161">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769164">addr</span>&nbsp;<span class="op" id="6769169">:=</span>&nbsp;<span class="ident" id="6769172">testUnixAddr</span><span class="op" id="6769184">(</span><span class="op" id="6769185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769188">laddr</span><span class="op" id="6769193">,</span>&nbsp;<span class="ident" id="6769195">err</span>&nbsp;<span class="op" id="6769199">:=</span>&nbsp;<span class="ident" id="6769202">ResolveUnixAddr</span><span class="op" id="6769217">(</span><span class="string" id="6769218">&#34;unixgram&#34;</span><span class="op" id="6769228">,</span>&nbsp;<span class="ident" id="6769230">addr</span><span class="op" id="6769234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769237">if</span>&nbsp;<span class="ident" id="6769240">err</span>&nbsp;<span class="op" id="6769244">!=</span>&nbsp;<span class="ident" id="6769247">nil</span>&nbsp;<span class="op" id="6769251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769255">t</span><span class="op" id="6769256">.</span><span class="ident" id="6769257">Fatalf</span><span class="op" id="6769263">(</span><span class="string" id="6769264">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6769292">,</span>&nbsp;<span class="ident" id="6769294">err</span><span class="op" id="6769297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6769300">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769303">c</span><span class="op" id="6769304">,</span>&nbsp;<span class="ident" id="6769306">err</span>&nbsp;<span class="op" id="6769310">:=</span>&nbsp;<span class="ident" id="6769313">ListenPacket</span><span class="op" id="6769325">(</span><span class="string" id="6769326">&#34;unixgram&#34;</span><span class="op" id="6769336">,</span>&nbsp;<span class="ident" id="6769338">addr</span><span class="op" id="6769342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769345">if</span>&nbsp;<span class="ident" id="6769348">err</span>&nbsp;<span class="op" id="6769352">!=</span>&nbsp;<span class="ident" id="6769355">nil</span>&nbsp;<span class="op" id="6769359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769363">t</span><span class="op" id="6769364">.</span><span class="ident" id="6769365">Fatalf</span><span class="op" id="6769371">(</span><span class="string" id="6769372">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6769397">,</span>&nbsp;<span class="ident" id="6769399">err</span><span class="op" id="6769402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6769405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769408">defer</span>&nbsp;<span class="ident" id="6769414">os</span><span class="op" id="6769416">.</span><span class="ident" id="6769417">Remove</span><span class="op" id="6769423">(</span><span class="ident" id="6769424">addr</span><span class="op" id="6769428">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769431">defer</span>&nbsp;<span class="ident" id="6769437">c</span><span class="op" id="6769438">.</span><span class="ident" id="6769439">Close</span><span class="op" id="6769444">(</span><span class="op" id="6769445">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769449">testUnixgramWriteConn</span><span class="op" id="6769470">(</span><span class="ident" id="6769471">t</span><span class="op" id="6769472">,</span>&nbsp;<span class="ident" id="6769474">laddr</span><span class="op" id="6769479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769482">testUnixgramWritePacketConn</span><span class="op" id="6769509">(</span><span class="ident" id="6769510">t</span><span class="op" id="6769511">,</span>&nbsp;<span class="ident" id="6769513">laddr</span><span class="op" id="6769518">)</span><br>
<span class="lineno"></span><span class="op" id="6769520">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6769523">func</span>&nbsp;<span class="ident" id="6769528">testUnixgramWriteConn</span><span class="op" id="6769549">(</span><span class="ident" id="6769550">t</span>&nbsp;<span class="op" id="6769552">*</span><span class="ident" id="6769553">testing</span><span class="op" id="6769560">.</span><span class="ident" id="6769561">T</span><span class="op" id="6769562">,</span>&nbsp;<span class="ident" id="6769564">raddr</span>&nbsp;<span class="op" id="6769570">*</span><span class="ident" id="6769571">UnixAddr</span><span class="op" id="6769579">)</span>&nbsp;<span class="op" id="6769581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769584">c</span><span class="op" id="6769585">,</span>&nbsp;<span class="ident" id="6769587">err</span>&nbsp;<span class="op" id="6769591">:=</span>&nbsp;<span class="ident" id="6769594">Dial</span><span class="op" id="6769598">(</span><span class="string" id="6769599">&#34;unixgram&#34;</span><span class="op" id="6769609">,</span>&nbsp;<span class="ident" id="6769611">raddr</span><span class="op" id="6769616">.</span><span class="ident" id="6769617">String</span><span class="op" id="6769623">(</span><span class="op" id="6769624">)</span><span class="op" id="6769625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769628">if</span>&nbsp;<span class="ident" id="6769631">err</span>&nbsp;<span class="op" id="6769635">!=</span>&nbsp;<span class="ident" id="6769638">nil</span>&nbsp;<span class="op" id="6769642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769646">t</span><span class="op" id="6769647">.</span><span class="ident" id="6769648">Fatalf</span><span class="op" id="6769654">(</span><span class="string" id="6769655">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6769672">,</span>&nbsp;<span class="ident" id="6769674">err</span><span class="op" id="6769677">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6769680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769683">defer</span>&nbsp;<span class="ident" id="6769689">c</span><span class="op" id="6769690">.</span><span class="ident" id="6769691">Close</span><span class="op" id="6769696">(</span><span class="op" id="6769697">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769701">if</span>&nbsp;<span class="ident" id="6769704">_</span><span class="op" id="6769705">,</span>&nbsp;<span class="ident" id="6769707">err</span>&nbsp;<span class="op" id="6769711">:=</span>&nbsp;<span class="ident" id="6769714">c</span><span class="op" id="6769715">.</span><span class="op" id="6769716">(</span><span class="op" id="6769717">*</span><span class="ident" id="6769718">UnixConn</span><span class="op" id="6769726">)</span><span class="op" id="6769727">.</span><span class="ident" id="6769728">WriteToUnix</span><span class="op" id="6769739">(</span><span class="op" id="6769740">[</span><span class="op" id="6769741">]</span><span class="builtintype" id="6769742">byte</span><span class="op" id="6769746">(</span><span class="string" id="6769747">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6769780">)</span><span class="op" id="6769781">,</span>&nbsp;<span class="ident" id="6769783">raddr</span><span class="op" id="6769788">)</span><span class="op" id="6769789">;</span>&nbsp;<span class="ident" id="6769791">err</span>&nbsp;<span class="op" id="6769795">==</span>&nbsp;<span class="ident" id="6769798">nil</span>&nbsp;<span class="op" id="6769802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769806">t</span><span class="op" id="6769807">.</span><span class="ident" id="6769808">Fatal</span><span class="op" id="6769813">(</span><span class="string" id="6769814">&#34;WriteToUnix&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6769839">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6769842">}</span>&nbsp;<span class="keyword" id="6769844">else</span>&nbsp;<span class="keyword" id="6769849">if</span>&nbsp;<span class="ident" id="6769852">err</span><span class="op" id="6769855">.</span><span class="op" id="6769856">(</span><span class="op" id="6769857">*</span><span class="ident" id="6769858">OpError</span><span class="op" id="6769865">)</span><span class="op" id="6769866">.</span><span class="ident" id="6769867">Err</span>&nbsp;<span class="op" id="6769871">!=</span>&nbsp;<span class="ident" id="6769874">ErrWriteToConnected</span>&nbsp;<span class="op" id="6769894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769898">t</span><span class="op" id="6769899">.</span><span class="ident" id="6769900">Fatalf</span><span class="op" id="6769906">(</span><span class="string" id="6769907">&#34;WriteToUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="6769959">,</span>&nbsp;<span class="ident" id="6769961">err</span><span class="op" id="6769964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6769967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769970">if</span>&nbsp;<span class="ident" id="6769973">_</span><span class="op" id="6769974">,</span>&nbsp;<span class="ident" id="6769976">err</span>&nbsp;<span class="op" id="6769980">=</span>&nbsp;<span class="ident" id="6769982">c</span><span class="op" id="6769983">.</span><span class="op" id="6769984">(</span><span class="op" id="6769985">*</span><span class="ident" id="6769986">UnixConn</span><span class="op" id="6769994">)</span><span class="op" id="6769995">.</span><span class="ident" id="6769996">WriteTo</span><span class="op" id="6770003">(</span><span class="op" id="6770004">[</span><span class="op" id="6770005">]</span><span class="builtintype" id="6770006">byte</span><span class="op" id="6770010">(</span><span class="string" id="6770011">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6770044">)</span><span class="op" id="6770045">,</span>&nbsp;<span class="ident" id="6770047">raddr</span><span class="op" id="6770052">)</span><span class="op" id="6770053">;</span>&nbsp;<span class="ident" id="6770055">err</span>&nbsp;<span class="op" id="6770059">==</span>&nbsp;<span class="ident" id="6770062">nil</span>&nbsp;<span class="op" id="6770066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770070">t</span><span class="op" id="6770071">.</span><span class="ident" id="6770072">Fatal</span><span class="op" id="6770077">(</span><span class="string" id="6770078">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6770099">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770102">}</span>&nbsp;<span class="keyword" id="6770104">else</span>&nbsp;<span class="keyword" id="6770109">if</span>&nbsp;<span class="ident" id="6770112">err</span><span class="op" id="6770115">.</span><span class="op" id="6770116">(</span><span class="op" id="6770117">*</span><span class="ident" id="6770118">OpError</span><span class="op" id="6770125">)</span><span class="op" id="6770126">.</span><span class="ident" id="6770127">Err</span>&nbsp;<span class="op" id="6770131">!=</span>&nbsp;<span class="ident" id="6770134">ErrWriteToConnected</span>&nbsp;<span class="op" id="6770154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770158">t</span><span class="op" id="6770159">.</span><span class="ident" id="6770160">Fatalf</span><span class="op" id="6770166">(</span><span class="string" id="6770167">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="6770215">,</span>&nbsp;<span class="ident" id="6770217">err</span><span class="op" id="6770220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770226">if</span>&nbsp;<span class="ident" id="6770229">_</span><span class="op" id="6770230">,</span>&nbsp;<span class="ident" id="6770232">_</span><span class="op" id="6770233">,</span>&nbsp;<span class="ident" id="6770235">err</span>&nbsp;<span class="op" id="6770239">=</span>&nbsp;<span class="ident" id="6770241">c</span><span class="op" id="6770242">.</span><span class="op" id="6770243">(</span><span class="op" id="6770244">*</span><span class="ident" id="6770245">UnixConn</span><span class="op" id="6770253">)</span><span class="op" id="6770254">.</span><span class="ident" id="6770255">WriteMsgUnix</span><span class="op" id="6770267">(</span><span class="op" id="6770268">[</span><span class="op" id="6770269">]</span><span class="builtintype" id="6770270">byte</span><span class="op" id="6770274">(</span><span class="string" id="6770275">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6770308">)</span><span class="op" id="6770309">,</span>&nbsp;<span class="ident" id="6770311">nil</span><span class="op" id="6770314">,</span>&nbsp;<span class="ident" id="6770316">raddr</span><span class="op" id="6770321">)</span><span class="op" id="6770322">;</span>&nbsp;<span class="ident" id="6770324">err</span>&nbsp;<span class="op" id="6770328">==</span>&nbsp;<span class="ident" id="6770331">nil</span>&nbsp;<span class="op" id="6770335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770339">t</span><span class="op" id="6770340">.</span><span class="ident" id="6770341">Fatal</span><span class="op" id="6770346">(</span><span class="string" id="6770347">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6770368">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770371">}</span>&nbsp;<span class="keyword" id="6770373">else</span>&nbsp;<span class="keyword" id="6770378">if</span>&nbsp;<span class="ident" id="6770381">err</span><span class="op" id="6770384">.</span><span class="op" id="6770385">(</span><span class="op" id="6770386">*</span><span class="ident" id="6770387">OpError</span><span class="op" id="6770394">)</span><span class="op" id="6770395">.</span><span class="ident" id="6770396">Err</span>&nbsp;<span class="op" id="6770400">!=</span>&nbsp;<span class="ident" id="6770403">ErrWriteToConnected</span>&nbsp;<span class="op" id="6770423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770427">t</span><span class="op" id="6770428">.</span><span class="ident" id="6770429">Fatalf</span><span class="op" id="6770435">(</span><span class="string" id="6770436">&#34;WriteMsgUnix&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="6770489">,</span>&nbsp;<span class="ident" id="6770491">err</span><span class="op" id="6770494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770500">if</span>&nbsp;<span class="ident" id="6770503">_</span><span class="op" id="6770504">,</span>&nbsp;<span class="ident" id="6770506">err</span>&nbsp;<span class="op" id="6770510">:=</span>&nbsp;<span class="ident" id="6770513">c</span><span class="op" id="6770514">.</span><span class="ident" id="6770515">Write</span><span class="op" id="6770520">(</span><span class="op" id="6770521">[</span><span class="op" id="6770522">]</span><span class="builtintype" id="6770523">byte</span><span class="op" id="6770527">(</span><span class="string" id="6770528">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6770561">)</span><span class="op" id="6770562">)</span><span class="op" id="6770563">;</span>&nbsp;<span class="ident" id="6770565">err</span>&nbsp;<span class="op" id="6770569">!=</span>&nbsp;<span class="ident" id="6770572">nil</span>&nbsp;<span class="op" id="6770576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770580">t</span><span class="op" id="6770581">.</span><span class="ident" id="6770582">Fatalf</span><span class="op" id="6770588">(</span><span class="string" id="6770589">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6770607">,</span>&nbsp;<span class="ident" id="6770609">err</span><span class="op" id="6770612">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770615">}</span><br>
<span class="lineno"></span><span class="op" id="6770617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6770620">func</span>&nbsp;<span class="ident" id="6770625">testUnixgramWritePacketConn</span><span class="op" id="6770652">(</span><span class="ident" id="6770653">t</span>&nbsp;<span class="op" id="6770655">*</span><span class="ident" id="6770656">testing</span><span class="op" id="6770663">.</span><span class="ident" id="6770664">T</span><span class="op" id="6770665">,</span>&nbsp;<span class="ident" id="6770667">raddr</span>&nbsp;<span class="op" id="6770673">*</span><span class="ident" id="6770674">UnixAddr</span><span class="op" id="6770682">)</span>&nbsp;<span class="op" id="6770684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770687">addr</span>&nbsp;<span class="op" id="6770692">:=</span>&nbsp;<span class="ident" id="6770695">testUnixAddr</span><span class="op" id="6770707">(</span><span class="op" id="6770708">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770711">c</span><span class="op" id="6770712">,</span>&nbsp;<span class="ident" id="6770714">err</span>&nbsp;<span class="op" id="6770718">:=</span>&nbsp;<span class="ident" id="6770721">ListenPacket</span><span class="op" id="6770733">(</span><span class="string" id="6770734">&#34;unixgram&#34;</span><span class="op" id="6770744">,</span>&nbsp;<span class="ident" id="6770746">addr</span><span class="op" id="6770750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770753">if</span>&nbsp;<span class="ident" id="6770756">err</span>&nbsp;<span class="op" id="6770760">!=</span>&nbsp;<span class="ident" id="6770763">nil</span>&nbsp;<span class="op" id="6770767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770771">t</span><span class="op" id="6770772">.</span><span class="ident" id="6770773">Fatalf</span><span class="op" id="6770779">(</span><span class="string" id="6770780">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6770805">,</span>&nbsp;<span class="ident" id="6770807">err</span><span class="op" id="6770810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770816">defer</span>&nbsp;<span class="ident" id="6770822">os</span><span class="op" id="6770824">.</span><span class="ident" id="6770825">Remove</span><span class="op" id="6770831">(</span><span class="ident" id="6770832">addr</span><span class="op" id="6770836">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770839">defer</span>&nbsp;<span class="ident" id="6770845">c</span><span class="op" id="6770846">.</span><span class="ident" id="6770847">Close</span><span class="op" id="6770852">(</span><span class="op" id="6770853">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770857">if</span>&nbsp;<span class="ident" id="6770860">_</span><span class="op" id="6770861">,</span>&nbsp;<span class="ident" id="6770863">err</span>&nbsp;<span class="op" id="6770867">:=</span>&nbsp;<span class="ident" id="6770870">c</span><span class="op" id="6770871">.</span><span class="op" id="6770872">(</span><span class="op" id="6770873">*</span><span class="ident" id="6770874">UnixConn</span><span class="op" id="6770882">)</span><span class="op" id="6770883">.</span><span class="ident" id="6770884">WriteToUnix</span><span class="op" id="6770895">(</span><span class="op" id="6770896">[</span><span class="op" id="6770897">]</span><span class="builtintype" id="6770898">byte</span><span class="op" id="6770902">(</span><span class="string" id="6770903">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6770931">)</span><span class="op" id="6770932">,</span>&nbsp;<span class="ident" id="6770934">raddr</span><span class="op" id="6770939">)</span><span class="op" id="6770940">;</span>&nbsp;<span class="ident" id="6770942">err</span>&nbsp;<span class="op" id="6770946">!=</span>&nbsp;<span class="ident" id="6770949">nil</span>&nbsp;<span class="op" id="6770953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770957">t</span><span class="op" id="6770958">.</span><span class="ident" id="6770959">Fatalf</span><span class="op" id="6770965">(</span><span class="string" id="6770966">&#34;WriteToUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6770990">,</span>&nbsp;<span class="ident" id="6770992">err</span><span class="op" id="6770995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770998">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771001">if</span>&nbsp;<span class="ident" id="6771004">_</span><span class="op" id="6771005">,</span>&nbsp;<span class="ident" id="6771007">err</span>&nbsp;<span class="op" id="6771011">:=</span>&nbsp;<span class="ident" id="6771014">c</span><span class="op" id="6771015">.</span><span class="ident" id="6771016">WriteTo</span><span class="op" id="6771023">(</span><span class="op" id="6771024">[</span><span class="op" id="6771025">]</span><span class="builtintype" id="6771026">byte</span><span class="op" id="6771030">(</span><span class="string" id="6771031">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6771059">)</span><span class="op" id="6771060">,</span>&nbsp;<span class="ident" id="6771062">raddr</span><span class="op" id="6771067">)</span><span class="op" id="6771068">;</span>&nbsp;<span class="ident" id="6771070">err</span>&nbsp;<span class="op" id="6771074">!=</span>&nbsp;<span class="ident" id="6771077">nil</span>&nbsp;<span class="op" id="6771081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771085">t</span><span class="op" id="6771086">.</span><span class="ident" id="6771087">Fatalf</span><span class="op" id="6771093">(</span><span class="string" id="6771094">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6771114">,</span>&nbsp;<span class="ident" id="6771116">err</span><span class="op" id="6771119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6771122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771125">if</span>&nbsp;<span class="ident" id="6771128">_</span><span class="op" id="6771129">,</span>&nbsp;<span class="ident" id="6771131">_</span><span class="op" id="6771132">,</span>&nbsp;<span class="ident" id="6771134">err</span>&nbsp;<span class="op" id="6771138">:=</span>&nbsp;<span class="ident" id="6771141">c</span><span class="op" id="6771142">.</span><span class="op" id="6771143">(</span><span class="op" id="6771144">*</span><span class="ident" id="6771145">UnixConn</span><span class="op" id="6771153">)</span><span class="op" id="6771154">.</span><span class="ident" id="6771155">WriteMsgUnix</span><span class="op" id="6771167">(</span><span class="op" id="6771168">[</span><span class="op" id="6771169">]</span><span class="builtintype" id="6771170">byte</span><span class="op" id="6771174">(</span><span class="string" id="6771175">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6771203">)</span><span class="op" id="6771204">,</span>&nbsp;<span class="ident" id="6771206">nil</span><span class="op" id="6771209">,</span>&nbsp;<span class="ident" id="6771211">raddr</span><span class="op" id="6771216">)</span><span class="op" id="6771217">;</span>&nbsp;<span class="ident" id="6771219">err</span>&nbsp;<span class="op" id="6771223">!=</span>&nbsp;<span class="ident" id="6771226">nil</span>&nbsp;<span class="op" id="6771230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771234">t</span><span class="op" id="6771235">.</span><span class="ident" id="6771236">Fatalf</span><span class="op" id="6771242">(</span><span class="string" id="6771243">&#34;WriteMsgUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6771268">,</span>&nbsp;<span class="ident" id="6771270">err</span><span class="op" id="6771273">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6771276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771279">if</span>&nbsp;<span class="ident" id="6771282">_</span><span class="op" id="6771283">,</span>&nbsp;<span class="ident" id="6771285">err</span>&nbsp;<span class="op" id="6771289">:=</span>&nbsp;<span class="ident" id="6771292">c</span><span class="op" id="6771293">.</span><span class="op" id="6771294">(</span><span class="op" id="6771295">*</span><span class="ident" id="6771296">UnixConn</span><span class="op" id="6771304">)</span><span class="op" id="6771305">.</span><span class="ident" id="6771306">Write</span><span class="op" id="6771311">(</span><span class="op" id="6771312">[</span><span class="op" id="6771313">]</span><span class="builtintype" id="6771314">byte</span><span class="op" id="6771318">(</span><span class="string" id="6771319">&#34;Connectionless&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="6771347">)</span><span class="op" id="6771348">)</span><span class="op" id="6771349">;</span>&nbsp;<span class="ident" id="6771351">err</span>&nbsp;<span class="op" id="6771355">==</span>&nbsp;<span class="ident" id="6771358">nil</span>&nbsp;<span class="op" id="6771362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771366">t</span><span class="op" id="6771367">.</span><span class="ident" id="6771368">Fatal</span><span class="op" id="6771373">(</span><span class="string" id="6771374">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6771393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6771396">}</span><br>
<span class="lineno"></span><span class="op" id="6771398">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="6771401">func</span>&nbsp;<span class="ident" id="6771406">TestUnixConnLocalAndRemoteNames</span><span class="op" id="6771437">(</span><span class="ident" id="6771438">t</span>&nbsp;<span class="op" id="6771440">*</span><span class="ident" id="6771441">testing</span><span class="op" id="6771448">.</span><span class="ident" id="6771449">T</span><span class="op" id="6771450">)</span>&nbsp;<span class="op" id="6771452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771455">for</span>&nbsp;<span class="ident" id="6771459">_</span><span class="op" id="6771460">,</span>&nbsp;<span class="ident" id="6771462">laddr</span>&nbsp;<span class="op" id="6771468">:=</span>&nbsp;<span class="keyword" id="6771471">range</span>&nbsp;<span class="op" id="6771477">[</span><span class="op" id="6771478">]</span><span class="builtintype" id="6771479">string</span><span class="op" id="6771485">{</span><span class="string" id="6771486">&#34;&#34;</span><span class="op" id="6771488">,</span>&nbsp;<span class="ident" id="6771490">testUnixAddr</span><span class="op" id="6771502">(</span><span class="op" id="6771503">)</span><span class="op" id="6771504">}</span>&nbsp;<span class="op" id="6771506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771510">laddr</span>&nbsp;<span class="op" id="6771516">:=</span>&nbsp;<span class="ident" id="6771519">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771527">taddr</span>&nbsp;<span class="op" id="6771533">:=</span>&nbsp;<span class="ident" id="6771536">testUnixAddr</span><span class="op" id="6771548">(</span><span class="op" id="6771549">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771553">ta</span><span class="op" id="6771555">,</span>&nbsp;<span class="ident" id="6771557">err</span>&nbsp;<span class="op" id="6771561">:=</span>&nbsp;<span class="ident" id="6771564">ResolveUnixAddr</span><span class="op" id="6771579">(</span><span class="string" id="6771580">&#34;unix&#34;</span><span class="op" id="6771586">,</span>&nbsp;<span class="ident" id="6771588">taddr</span><span class="op" id="6771593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771597">if</span>&nbsp;<span class="ident" id="6771600">err</span>&nbsp;<span class="op" id="6771604">!=</span>&nbsp;<span class="ident" id="6771607">nil</span>&nbsp;<span class="op" id="6771611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771616">t</span><span class="op" id="6771617">.</span><span class="ident" id="6771618">Fatalf</span><span class="op" id="6771624">(</span><span class="string" id="6771625">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6771653">,</span>&nbsp;<span class="ident" id="6771655">err</span><span class="op" id="6771658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6771662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771666">ln</span><span class="op" id="6771668">,</span>&nbsp;<span class="ident" id="6771670">err</span>&nbsp;<span class="op" id="6771674">:=</span>&nbsp;<span class="ident" id="6771677">ListenUnix</span><span class="op" id="6771687">(</span><span class="string" id="6771688">&#34;unix&#34;</span><span class="op" id="6771694">,</span>&nbsp;<span class="ident" id="6771696">ta</span><span class="op" id="6771698">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771702">if</span>&nbsp;<span class="ident" id="6771705">err</span>&nbsp;<span class="op" id="6771709">!=</span>&nbsp;<span class="ident" id="6771712">nil</span>&nbsp;<span class="op" id="6771716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771721">t</span><span class="op" id="6771722">.</span><span class="ident" id="6771723">Fatalf</span><span class="op" id="6771729">(</span><span class="string" id="6771730">&#34;ListenUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6771753">,</span>&nbsp;<span class="ident" id="6771755">err</span><span class="op" id="6771758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6771762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771766">defer</span>&nbsp;<span class="keyword" id="6771772">func</span><span class="op" id="6771776">(</span><span class="op" id="6771777">)</span>&nbsp;<span class="op" id="6771779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771784">ln</span><span class="op" id="6771786">.</span><span class="ident" id="6771787">Close</span><span class="op" id="6771792">(</span><span class="op" id="6771793">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771798">os</span><span class="op" id="6771800">.</span><span class="ident" id="6771801">Remove</span><span class="op" id="6771807">(</span><span class="ident" id="6771808">taddr</span><span class="op" id="6771813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6771817">}</span><span class="op" id="6771818">(</span><span class="op" id="6771819">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771824">done</span>&nbsp;<span class="op" id="6771829">:=</span>&nbsp;<span class="builtinfunc" id="6771832">make</span><span class="op" id="6771836">(</span><span class="keyword" id="6771837">chan</span>&nbsp;<span class="builtintype" id="6771842">int</span><span class="op" id="6771845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771849">go</span>&nbsp;<span class="ident" id="6771852">transponder</span><span class="op" id="6771863">(</span><span class="ident" id="6771864">t</span><span class="op" id="6771865">,</span>&nbsp;<span class="ident" id="6771867">ln</span><span class="op" id="6771869">,</span>&nbsp;<span class="ident" id="6771871">done</span><span class="op" id="6771875">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771880">la</span><span class="op" id="6771882">,</span>&nbsp;<span class="ident" id="6771884">err</span>&nbsp;<span class="op" id="6771888">:=</span>&nbsp;<span class="ident" id="6771891">ResolveUnixAddr</span><span class="op" id="6771906">(</span><span class="string" id="6771907">&#34;unix&#34;</span><span class="op" id="6771913">,</span>&nbsp;<span class="ident" id="6771915">laddr</span><span class="op" id="6771920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771924">if</span>&nbsp;<span class="ident" id="6771927">err</span>&nbsp;<span class="op" id="6771931">!=</span>&nbsp;<span class="ident" id="6771934">nil</span>&nbsp;<span class="op" id="6771938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771943">t</span><span class="op" id="6771944">.</span><span class="ident" id="6771945">Fatalf</span><span class="op" id="6771951">(</span><span class="string" id="6771952">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6771980">,</span>&nbsp;<span class="ident" id="6771982">err</span><span class="op" id="6771985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6771989">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771993">c</span><span class="op" id="6771994">,</span>&nbsp;<span class="ident" id="6771996">err</span>&nbsp;<span class="op" id="6772000">:=</span>&nbsp;<span class="ident" id="6772003">DialUnix</span><span class="op" id="6772011">(</span><span class="string" id="6772012">&#34;unix&#34;</span><span class="op" id="6772018">,</span>&nbsp;<span class="ident" id="6772020">la</span><span class="op" id="6772022">,</span>&nbsp;<span class="ident" id="6772024">ta</span><span class="op" id="6772026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772030">if</span>&nbsp;<span class="ident" id="6772033">err</span>&nbsp;<span class="op" id="6772037">!=</span>&nbsp;<span class="ident" id="6772040">nil</span>&nbsp;<span class="op" id="6772044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772049">t</span><span class="op" id="6772050">.</span><span class="ident" id="6772051">Fatalf</span><span class="op" id="6772057">(</span><span class="string" id="6772058">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6772079">,</span>&nbsp;<span class="ident" id="6772081">err</span><span class="op" id="6772084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772092">defer</span>&nbsp;<span class="keyword" id="6772098">func</span><span class="op" id="6772102">(</span><span class="op" id="6772103">)</span>&nbsp;<span class="op" id="6772105">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772110">c</span><span class="op" id="6772111">.</span><span class="ident" id="6772112">Close</span><span class="op" id="6772117">(</span><span class="op" id="6772118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772123">if</span>&nbsp;<span class="ident" id="6772126">la</span>&nbsp;<span class="op" id="6772129">!=</span>&nbsp;<span class="ident" id="6772132">nil</span>&nbsp;<span class="op" id="6772136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772142">defer</span>&nbsp;<span class="ident" id="6772148">os</span><span class="op" id="6772150">.</span><span class="ident" id="6772151">Remove</span><span class="op" id="6772157">(</span><span class="ident" id="6772158">laddr</span><span class="op" id="6772163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772172">}</span><span class="op" id="6772173">(</span><span class="op" id="6772174">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772178">if</span>&nbsp;<span class="ident" id="6772181">_</span><span class="op" id="6772182">,</span>&nbsp;<span class="ident" id="6772184">err</span>&nbsp;<span class="op" id="6772188">:=</span>&nbsp;<span class="ident" id="6772191">c</span><span class="op" id="6772192">.</span><span class="ident" id="6772193">Write</span><span class="op" id="6772198">(</span><span class="op" id="6772199">[</span><span class="op" id="6772200">]</span><span class="builtintype" id="6772201">byte</span><span class="op" id="6772205">(</span><span class="string" id="6772206">&#34;UNIXCONN&nbsp;LOCAL&nbsp;AND&nbsp;REMOTE&nbsp;NAME&nbsp;TEST&#34;</span><span class="op" id="6772243">)</span><span class="op" id="6772244">)</span><span class="op" id="6772245">;</span>&nbsp;<span class="ident" id="6772247">err</span>&nbsp;<span class="op" id="6772251">!=</span>&nbsp;<span class="ident" id="6772254">nil</span>&nbsp;<span class="op" id="6772258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772263">t</span><span class="op" id="6772264">.</span><span class="ident" id="6772265">Fatalf</span><span class="op" id="6772271">(</span><span class="string" id="6772272">&#34;UnixConn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6772299">,</span>&nbsp;<span class="ident" id="6772301">err</span><span class="op" id="6772304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772313">switch</span>&nbsp;<span class="ident" id="6772320">runtime</span><span class="op" id="6772327">.</span><span class="ident" id="6772328">GOOS</span>&nbsp;<span class="op" id="6772333">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772337">case</span>&nbsp;<span class="string" id="6772342">&#34;android&#34;</span><span class="op" id="6772351">,</span>&nbsp;<span class="string" id="6772353">&#34;linux&#34;</span><span class="op" id="6772360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772365">if</span>&nbsp;<span class="ident" id="6772368">laddr</span>&nbsp;<span class="op" id="6772374">==</span>&nbsp;<span class="string" id="6772377">&#34;&#34;</span>&nbsp;<span class="op" id="6772380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772386">laddr</span>&nbsp;<span class="op" id="6772392">=</span>&nbsp;<span class="string" id="6772394">&#34;@&#34;</span>&nbsp;<span class="comment" id="6772398">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772425">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772429">var</span>&nbsp;<span class="ident" id="6772433">connAddrs</span>&nbsp;<span class="op" id="6772443">=</span>&nbsp;<span class="op" id="6772445">[</span><span class="num" id="6772446">3</span><span class="op" id="6772447">]</span><span class="keyword" id="6772448">struct</span><span class="op" id="6772454">{</span>&nbsp;<span class="ident" id="6772456">got</span><span class="op" id="6772459">,</span>&nbsp;<span class="ident" id="6772461">want</span>&nbsp;<span class="ident" id="6772466">Addr</span>&nbsp;<span class="op" id="6772471">}</span><span class="op" id="6772472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772477">{</span><span class="ident" id="6772478">ln</span><span class="op" id="6772480">.</span><span class="ident" id="6772481">Addr</span><span class="op" id="6772485">(</span><span class="op" id="6772486">)</span><span class="op" id="6772487">,</span>&nbsp;<span class="ident" id="6772489">ta</span><span class="op" id="6772491">}</span><span class="op" id="6772492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772497">{</span><span class="ident" id="6772498">c</span><span class="op" id="6772499">.</span><span class="ident" id="6772500">LocalAddr</span><span class="op" id="6772509">(</span><span class="op" id="6772510">)</span><span class="op" id="6772511">,</span>&nbsp;<span class="op" id="6772513">&amp;</span><span class="ident" id="6772514">UnixAddr</span><span class="op" id="6772522">{</span><span class="ident" id="6772523">Name</span><span class="op" id="6772527">:</span>&nbsp;<span class="ident" id="6772529">laddr</span><span class="op" id="6772534">,</span>&nbsp;<span class="ident" id="6772536">Net</span><span class="op" id="6772539">:</span>&nbsp;<span class="string" id="6772541">&#34;unix&#34;</span><span class="op" id="6772547">}</span><span class="op" id="6772548">}</span><span class="op" id="6772549">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772554">{</span><span class="ident" id="6772555">c</span><span class="op" id="6772556">.</span><span class="ident" id="6772557">RemoteAddr</span><span class="op" id="6772567">(</span><span class="op" id="6772568">)</span><span class="op" id="6772569">,</span>&nbsp;<span class="ident" id="6772571">ta</span><span class="op" id="6772573">}</span><span class="op" id="6772574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772578">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772582">for</span>&nbsp;<span class="ident" id="6772586">_</span><span class="op" id="6772587">,</span>&nbsp;<span class="ident" id="6772589">ca</span>&nbsp;<span class="op" id="6772592">:=</span>&nbsp;<span class="keyword" id="6772595">range</span>&nbsp;<span class="ident" id="6772601">connAddrs</span>&nbsp;<span class="op" id="6772611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772616">if</span>&nbsp;<span class="op" id="6772619">!</span><span class="ident" id="6772620">reflect</span><span class="op" id="6772627">.</span><span class="ident" id="6772628">DeepEqual</span><span class="op" id="6772637">(</span><span class="ident" id="6772638">ca</span><span class="op" id="6772640">.</span><span class="ident" id="6772641">got</span><span class="op" id="6772644">,</span>&nbsp;<span class="ident" id="6772646">ca</span><span class="op" id="6772648">.</span><span class="ident" id="6772649">want</span><span class="op" id="6772653">)</span>&nbsp;<span class="op" id="6772655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772661">t</span><span class="op" id="6772662">.</span><span class="ident" id="6772663">Fatalf</span><span class="op" id="6772669">(</span><span class="string" id="6772670">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6772693">,</span>&nbsp;<span class="ident" id="6772695">ca</span><span class="op" id="6772697">.</span><span class="ident" id="6772698">got</span><span class="op" id="6772701">,</span>&nbsp;<span class="ident" id="6772703">ca</span><span class="op" id="6772705">.</span><span class="ident" id="6772706">want</span><span class="op" id="6772710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772719">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772724">&lt;-</span><span class="ident" id="6772726">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772732">}</span><br>
<span class="lineno"></span><span class="op" id="6772734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="6772737">func</span>&nbsp;<span class="ident" id="6772742">TestUnixgramConnLocalAndRemoteNames</span><span class="op" id="6772777">(</span><span class="ident" id="6772778">t</span>&nbsp;<span class="op" id="6772780">*</span><span class="ident" id="6772781">testing</span><span class="op" id="6772788">.</span><span class="ident" id="6772789">T</span><span class="op" id="6772790">)</span>&nbsp;<span class="op" id="6772792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772795">for</span>&nbsp;<span class="ident" id="6772799">_</span><span class="op" id="6772800">,</span>&nbsp;<span class="ident" id="6772802">laddr</span>&nbsp;<span class="op" id="6772808">:=</span>&nbsp;<span class="keyword" id="6772811">range</span>&nbsp;<span class="op" id="6772817">[</span><span class="op" id="6772818">]</span><span class="builtintype" id="6772819">string</span><span class="op" id="6772825">{</span><span class="string" id="6772826">&#34;&#34;</span><span class="op" id="6772828">,</span>&nbsp;<span class="ident" id="6772830">testUnixAddr</span><span class="op" id="6772842">(</span><span class="op" id="6772843">)</span><span class="op" id="6772844">}</span>&nbsp;<span class="op" id="6772846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772850">laddr</span>&nbsp;<span class="op" id="6772856">:=</span>&nbsp;<span class="ident" id="6772859">laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772867">taddr</span>&nbsp;<span class="op" id="6772873">:=</span>&nbsp;<span class="ident" id="6772876">testUnixAddr</span><span class="op" id="6772888">(</span><span class="op" id="6772889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772893">ta</span><span class="op" id="6772895">,</span>&nbsp;<span class="ident" id="6772897">err</span>&nbsp;<span class="op" id="6772901">:=</span>&nbsp;<span class="ident" id="6772904">ResolveUnixAddr</span><span class="op" id="6772919">(</span><span class="string" id="6772920">&#34;unixgram&#34;</span><span class="op" id="6772930">,</span>&nbsp;<span class="ident" id="6772932">taddr</span><span class="op" id="6772937">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772941">if</span>&nbsp;<span class="ident" id="6772944">err</span>&nbsp;<span class="op" id="6772948">!=</span>&nbsp;<span class="ident" id="6772951">nil</span>&nbsp;<span class="op" id="6772955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772960">t</span><span class="op" id="6772961">.</span><span class="ident" id="6772962">Fatalf</span><span class="op" id="6772968">(</span><span class="string" id="6772969">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6772997">,</span>&nbsp;<span class="ident" id="6772999">err</span><span class="op" id="6773002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773010">c1</span><span class="op" id="6773012">,</span>&nbsp;<span class="ident" id="6773014">err</span>&nbsp;<span class="op" id="6773018">:=</span>&nbsp;<span class="ident" id="6773021">ListenUnixgram</span><span class="op" id="6773035">(</span><span class="string" id="6773036">&#34;unixgram&#34;</span><span class="op" id="6773046">,</span>&nbsp;<span class="ident" id="6773048">ta</span><span class="op" id="6773050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773054">if</span>&nbsp;<span class="ident" id="6773057">err</span>&nbsp;<span class="op" id="6773061">!=</span>&nbsp;<span class="ident" id="6773064">nil</span>&nbsp;<span class="op" id="6773068">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773073">t</span><span class="op" id="6773074">.</span><span class="ident" id="6773075">Fatalf</span><span class="op" id="6773081">(</span><span class="string" id="6773082">&#34;ListenUnixgram&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6773109">,</span>&nbsp;<span class="ident" id="6773111">err</span><span class="op" id="6773114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773122">defer</span>&nbsp;<span class="keyword" id="6773128">func</span><span class="op" id="6773132">(</span><span class="op" id="6773133">)</span>&nbsp;<span class="op" id="6773135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773140">c1</span><span class="op" id="6773142">.</span><span class="ident" id="6773143">Close</span><span class="op" id="6773148">(</span><span class="op" id="6773149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773154">os</span><span class="op" id="6773156">.</span><span class="ident" id="6773157">Remove</span><span class="op" id="6773163">(</span><span class="ident" id="6773164">taddr</span><span class="op" id="6773169">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773173">}</span><span class="op" id="6773174">(</span><span class="op" id="6773175">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773180">var</span>&nbsp;<span class="ident" id="6773184">la</span>&nbsp;<span class="op" id="6773187">*</span><span class="ident" id="6773188">UnixAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773199">if</span>&nbsp;<span class="ident" id="6773202">laddr</span>&nbsp;<span class="op" id="6773208">!=</span>&nbsp;<span class="string" id="6773211">&#34;&#34;</span>&nbsp;<span class="op" id="6773214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773219">if</span>&nbsp;<span class="ident" id="6773222">la</span><span class="op" id="6773224">,</span>&nbsp;<span class="ident" id="6773226">err</span>&nbsp;<span class="op" id="6773230">=</span>&nbsp;<span class="ident" id="6773232">ResolveUnixAddr</span><span class="op" id="6773247">(</span><span class="string" id="6773248">&#34;unixgram&#34;</span><span class="op" id="6773258">,</span>&nbsp;<span class="ident" id="6773260">laddr</span><span class="op" id="6773265">)</span><span class="op" id="6773266">;</span>&nbsp;<span class="ident" id="6773268">err</span>&nbsp;<span class="op" id="6773272">!=</span>&nbsp;<span class="ident" id="6773275">nil</span>&nbsp;<span class="op" id="6773279">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773285">t</span><span class="op" id="6773286">.</span><span class="ident" id="6773287">Fatalf</span><span class="op" id="6773293">(</span><span class="string" id="6773294">&#34;ResolveUnixAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6773322">,</span>&nbsp;<span class="ident" id="6773324">err</span><span class="op" id="6773327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773340">c2</span><span class="op" id="6773342">,</span>&nbsp;<span class="ident" id="6773344">err</span>&nbsp;<span class="op" id="6773348">:=</span>&nbsp;<span class="ident" id="6773351">DialUnix</span><span class="op" id="6773359">(</span><span class="string" id="6773360">&#34;unixgram&#34;</span><span class="op" id="6773370">,</span>&nbsp;<span class="ident" id="6773372">la</span><span class="op" id="6773374">,</span>&nbsp;<span class="ident" id="6773376">ta</span><span class="op" id="6773378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773382">if</span>&nbsp;<span class="ident" id="6773385">err</span>&nbsp;<span class="op" id="6773389">!=</span>&nbsp;<span class="ident" id="6773392">nil</span>&nbsp;<span class="op" id="6773396">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773401">t</span><span class="op" id="6773402">.</span><span class="ident" id="6773403">Fatalf</span><span class="op" id="6773409">(</span><span class="string" id="6773410">&#34;DialUnix&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6773431">,</span>&nbsp;<span class="ident" id="6773433">err</span><span class="op" id="6773436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773444">defer</span>&nbsp;<span class="keyword" id="6773450">func</span><span class="op" id="6773454">(</span><span class="op" id="6773455">)</span>&nbsp;<span class="op" id="6773457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773462">c2</span><span class="op" id="6773464">.</span><span class="ident" id="6773465">Close</span><span class="op" id="6773470">(</span><span class="op" id="6773471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773476">if</span>&nbsp;<span class="ident" id="6773479">la</span>&nbsp;<span class="op" id="6773482">!=</span>&nbsp;<span class="ident" id="6773485">nil</span>&nbsp;<span class="op" id="6773489">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773495">defer</span>&nbsp;<span class="ident" id="6773501">os</span><span class="op" id="6773503">.</span><span class="ident" id="6773504">Remove</span><span class="op" id="6773510">(</span><span class="ident" id="6773511">laddr</span><span class="op" id="6773516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773525">}</span><span class="op" id="6773526">(</span><span class="op" id="6773527">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773532">switch</span>&nbsp;<span class="ident" id="6773539">runtime</span><span class="op" id="6773546">.</span><span class="ident" id="6773547">GOOS</span>&nbsp;<span class="op" id="6773552">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773556">case</span>&nbsp;<span class="string" id="6773561">&#34;android&#34;</span><span class="op" id="6773570">,</span>&nbsp;<span class="string" id="6773572">&#34;linux&#34;</span><span class="op" id="6773579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773584">if</span>&nbsp;<span class="ident" id="6773587">laddr</span>&nbsp;<span class="op" id="6773593">==</span>&nbsp;<span class="string" id="6773596">&#34;&#34;</span>&nbsp;<span class="op" id="6773599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773605">laddr</span>&nbsp;<span class="op" id="6773611">=</span>&nbsp;<span class="string" id="6773613">&#34;@&#34;</span>&nbsp;<span class="comment" id="6773617">//&nbsp;autobind&nbsp;feature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773644">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773649">var</span>&nbsp;<span class="ident" id="6773653">connAddrs</span>&nbsp;<span class="op" id="6773663">=</span>&nbsp;<span class="op" id="6773665">[</span><span class="num" id="6773666">4</span><span class="op" id="6773667">]</span><span class="keyword" id="6773668">struct</span><span class="op" id="6773674">{</span>&nbsp;<span class="ident" id="6773676">got</span><span class="op" id="6773679">,</span>&nbsp;<span class="ident" id="6773681">want</span>&nbsp;<span class="ident" id="6773686">Addr</span>&nbsp;<span class="op" id="6773691">}</span><span class="op" id="6773692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773697">{</span><span class="ident" id="6773698">c1</span><span class="op" id="6773700">.</span><span class="ident" id="6773701">LocalAddr</span><span class="op" id="6773710">(</span><span class="op" id="6773711">)</span><span class="op" id="6773712">,</span>&nbsp;<span class="ident" id="6773714">ta</span><span class="op" id="6773716">}</span><span class="op" id="6773717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773722">{</span><span class="ident" id="6773723">c1</span><span class="op" id="6773725">.</span><span class="ident" id="6773726">RemoteAddr</span><span class="op" id="6773736">(</span><span class="op" id="6773737">)</span><span class="op" id="6773738">,</span>&nbsp;<span class="ident" id="6773740">nil</span><span class="op" id="6773743">}</span><span class="op" id="6773744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773749">{</span><span class="ident" id="6773750">c2</span><span class="op" id="6773752">.</span><span class="ident" id="6773753">LocalAddr</span><span class="op" id="6773762">(</span><span class="op" id="6773763">)</span><span class="op" id="6773764">,</span>&nbsp;<span class="op" id="6773766">&amp;</span><span class="ident" id="6773767">UnixAddr</span><span class="op" id="6773775">{</span><span class="ident" id="6773776">Name</span><span class="op" id="6773780">:</span>&nbsp;<span class="ident" id="6773782">laddr</span><span class="op" id="6773787">,</span>&nbsp;<span class="ident" id="6773789">Net</span><span class="op" id="6773792">:</span>&nbsp;<span class="string" id="6773794">&#34;unixgram&#34;</span><span class="op" id="6773804">}</span><span class="op" id="6773805">}</span><span class="op" id="6773806">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773811">{</span><span class="ident" id="6773812">c2</span><span class="op" id="6773814">.</span><span class="ident" id="6773815">RemoteAddr</span><span class="op" id="6773825">(</span><span class="op" id="6773826">)</span><span class="op" id="6773827">,</span>&nbsp;<span class="ident" id="6773829">ta</span><span class="op" id="6773831">}</span><span class="op" id="6773832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773840">for</span>&nbsp;<span class="ident" id="6773844">_</span><span class="op" id="6773845">,</span>&nbsp;<span class="ident" id="6773847">ca</span>&nbsp;<span class="op" id="6773850">:=</span>&nbsp;<span class="keyword" id="6773853">range</span>&nbsp;<span class="ident" id="6773859">connAddrs</span>&nbsp;<span class="op" id="6773869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773874">if</span>&nbsp;<span class="op" id="6773877">!</span><span class="ident" id="6773878">reflect</span><span class="op" id="6773885">.</span><span class="ident" id="6773886">DeepEqual</span><span class="op" id="6773895">(</span><span class="ident" id="6773896">ca</span><span class="op" id="6773898">.</span><span class="ident" id="6773899">got</span><span class="op" id="6773902">,</span>&nbsp;<span class="ident" id="6773904">ca</span><span class="op" id="6773906">.</span><span class="ident" id="6773907">want</span><span class="op" id="6773911">)</span>&nbsp;<span class="op" id="6773913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773919">t</span><span class="op" id="6773920">.</span><span class="ident" id="6773921">Fatalf</span><span class="op" id="6773927">(</span><span class="string" id="6773928">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6773951">,</span>&nbsp;<span class="ident" id="6773953">ca</span><span class="op" id="6773955">.</span><span class="ident" id="6773956">got</span><span class="op" id="6773959">,</span>&nbsp;<span class="ident" id="6773961">ca</span><span class="op" id="6773963">.</span><span class="ident" id="6773964">want</span><span class="op" id="6773968">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773980">}</span><br>
<span class="lineno"></span><span class="op" id="6773982">}</span>
</div>
</body>
</html>
