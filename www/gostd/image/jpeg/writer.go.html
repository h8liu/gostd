<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4924733">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4924788">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4924842">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4924893">package</span>&nbsp;<span class="ident" id="4924901">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4924907">import</span>&nbsp;<span class="op" id="4924914">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4924917">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4924926">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4924936">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4924945">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4924960">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4924965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4924968">//&nbsp;min&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;of&nbsp;two&nbsp;integers.</span><br>
<span class="lineno"></span><span class="keyword" id="4925012">func</span>&nbsp;<span class="ident" id="4925017">min</span><span class="op" id="4925020">(</span><span class="ident" id="4925021">x</span><span class="op" id="4925022">,</span>&nbsp;<span class="ident" id="4925024">y</span>&nbsp;<span class="builtintype" id="4925026">int</span><span class="op" id="4925029">)</span>&nbsp;<span class="builtintype" id="4925031">int</span>&nbsp;<span class="op" id="4925035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4925038">if</span>&nbsp;<span class="ident" id="4925041">x</span>&nbsp;<span class="op" id="4925043">&lt;</span>&nbsp;<span class="ident" id="4925045">y</span>&nbsp;<span class="op" id="4925047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4925051">return</span>&nbsp;<span class="ident" id="4925058">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4925061">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4925064">return</span>&nbsp;<span class="ident" id="4925071">y</span><br>
<span class="lineno"></span><span class="op" id="4925073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4925076">//&nbsp;div&nbsp;returns&nbsp;a/b&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer,&nbsp;instead&nbsp;of&nbsp;rounded&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="4925155">func</span>&nbsp;<span class="ident" id="4925160">div</span><span class="op" id="4925163">(</span><span class="ident" id="4925164">a</span><span class="op" id="4925165">,</span>&nbsp;<span class="ident" id="4925167">b</span>&nbsp;<span class="builtintype" id="4925169">int32</span><span class="op" id="4925174">)</span>&nbsp;<span class="builtintype" id="4925176">int32</span>&nbsp;<span class="op" id="4925182">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4925185">if</span>&nbsp;<span class="ident" id="4925188">a</span>&nbsp;<span class="op" id="4925190">&gt;=</span>&nbsp;<span class="num" id="4925193">0</span>&nbsp;<span class="op" id="4925195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4925199">return</span>&nbsp;<span class="op" id="4925206">(</span><span class="ident" id="4925207">a</span>&nbsp;<span class="op" id="4925209">+</span>&nbsp;<span class="op" id="4925211">(</span><span class="ident" id="4925212">b</span>&nbsp;<span class="op" id="4925214">&gt;&gt;</span>&nbsp;<span class="num" id="4925217">1</span><span class="op" id="4925218">)</span><span class="op" id="4925219">)</span>&nbsp;<span class="op" id="4925221">/</span>&nbsp;<span class="ident" id="4925223">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4925226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4925229">return</span>&nbsp;<span class="op" id="4925236">-</span><span class="op" id="4925237">(</span><span class="op" id="4925238">(</span><span class="op" id="4925239">-</span><span class="ident" id="4925240">a</span>&nbsp;<span class="op" id="4925242">+</span>&nbsp;<span class="op" id="4925244">(</span><span class="ident" id="4925245">b</span>&nbsp;<span class="op" id="4925247">&gt;&gt;</span>&nbsp;<span class="num" id="4925250">1</span><span class="op" id="4925251">)</span><span class="op" id="4925252">)</span>&nbsp;<span class="op" id="4925254">/</span>&nbsp;<span class="ident" id="4925256">b</span><span class="op" id="4925257">)</span><br>
<span class="lineno"></span><span class="op" id="4925259">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4925262">//&nbsp;bitCount&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;needed&nbsp;to&nbsp;hold&nbsp;an&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="4925327">var</span>&nbsp;<span class="ident" id="4925331">bitCount</span>&nbsp;<span class="op" id="4925340">=</span>&nbsp;<span class="op" id="4925342">[</span><span class="num" id="4925343">256</span><span class="op" id="4925346">]</span><span class="builtintype" id="4925347">byte</span><span class="op" id="4925351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4925354">0</span><span class="op" id="4925355">,</span>&nbsp;<span class="num" id="4925357">1</span><span class="op" id="4925358">,</span>&nbsp;<span class="num" id="4925360">2</span><span class="op" id="4925361">,</span>&nbsp;<span class="num" id="4925363">2</span><span class="op" id="4925364">,</span>&nbsp;<span class="num" id="4925366">3</span><span class="op" id="4925367">,</span>&nbsp;<span class="num" id="4925369">3</span><span class="op" id="4925370">,</span>&nbsp;<span class="num" id="4925372">3</span><span class="op" id="4925373">,</span>&nbsp;<span class="num" id="4925375">3</span><span class="op" id="4925376">,</span>&nbsp;<span class="num" id="4925378">4</span><span class="op" id="4925379">,</span>&nbsp;<span class="num" id="4925381">4</span><span class="op" id="4925382">,</span>&nbsp;<span class="num" id="4925384">4</span><span class="op" id="4925385">,</span>&nbsp;<span class="num" id="4925387">4</span><span class="op" id="4925388">,</span>&nbsp;<span class="num" id="4925390">4</span><span class="op" id="4925391">,</span>&nbsp;<span class="num" id="4925393">4</span><span class="op" id="4925394">,</span>&nbsp;<span class="num" id="4925396">4</span><span class="op" id="4925397">,</span>&nbsp;<span class="num" id="4925399">4</span><span class="op" id="4925400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4925403">5</span><span class="op" id="4925404">,</span>&nbsp;<span class="num" id="4925406">5</span><span class="op" id="4925407">,</span>&nbsp;<span class="num" id="4925409">5</span><span class="op" id="4925410">,</span>&nbsp;<span class="num" id="4925412">5</span><span class="op" id="4925413">,</span>&nbsp;<span class="num" id="4925415">5</span><span class="op" id="4925416">,</span>&nbsp;<span class="num" id="4925418">5</span><span class="op" id="4925419">,</span>&nbsp;<span class="num" id="4925421">5</span><span class="op" id="4925422">,</span>&nbsp;<span class="num" id="4925424">5</span><span class="op" id="4925425">,</span>&nbsp;<span class="num" id="4925427">5</span><span class="op" id="4925428">,</span>&nbsp;<span class="num" id="4925430">5</span><span class="op" id="4925431">,</span>&nbsp;<span class="num" id="4925433">5</span><span class="op" id="4925434">,</span>&nbsp;<span class="num" id="4925436">5</span><span class="op" id="4925437">,</span>&nbsp;<span class="num" id="4925439">5</span><span class="op" id="4925440">,</span>&nbsp;<span class="num" id="4925442">5</span><span class="op" id="4925443">,</span>&nbsp;<span class="num" id="4925445">5</span><span class="op" id="4925446">,</span>&nbsp;<span class="num" id="4925448">5</span><span class="op" id="4925449">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4925452">6</span><span class="op" id="4925453">,</span>&nbsp;<span class="num" id="4925455">6</span><span class="op" id="4925456">,</span>&nbsp;<span class="num" id="4925458">6</span><span class="op" id="4925459">,</span>&nbsp;<span class="num" id="4925461">6</span><span class="op" id="4925462">,</span>&nbsp;<span class="num" id="4925464">6</span><span class="op" id="4925465">,</span>&nbsp;<span class="num" id="4925467">6</span><span class="op" id="4925468">,</span>&nbsp;<span class="num" id="4925470">6</span><span class="op" id="4925471">,</span>&nbsp;<span class="num" id="4925473">6</span><span class="op" id="4925474">,</span>&nbsp;<span class="num" id="4925476">6</span><span class="op" id="4925477">,</span>&nbsp;<span class="num" id="4925479">6</span><span class="op" id="4925480">,</span>&nbsp;<span class="num" id="4925482">6</span><span class="op" id="4925483">,</span>&nbsp;<span class="num" id="4925485">6</span><span class="op" id="4925486">,</span>&nbsp;<span class="num" id="4925488">6</span><span class="op" id="4925489">,</span>&nbsp;<span class="num" id="4925491">6</span><span class="op" id="4925492">,</span>&nbsp;<span class="num" id="4925494">6</span><span class="op" id="4925495">,</span>&nbsp;<span class="num" id="4925497">6</span><span class="op" id="4925498">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4925501">6</span><span class="op" id="4925502">,</span>&nbsp;<span class="num" id="4925504">6</span><span class="op" id="4925505">,</span>&nbsp;<span class="num" id="4925507">6</span><span class="op" id="4925508">,</span>&nbsp;<span class="num" id="4925510">6</span><span class="op" id="4925511">,</span>&nbsp;<span class="num" id="4925513">6</span><span class="op" id="4925514">,</span>&nbsp;<span class="num" id="4925516">6</span><span class="op" id="4925517">,</span>&nbsp;<span class="num" id="4925519">6</span><span class="op" id="4925520">,</span>&nbsp;<span class="num" id="4925522">6</span><span class="op" id="4925523">,</span>&nbsp;<span class="num" id="4925525">6</span><span class="op" id="4925526">,</span>&nbsp;<span class="num" id="4925528">6</span><span class="op" id="4925529">,</span>&nbsp;<span class="num" id="4925531">6</span><span class="op" id="4925532">,</span>&nbsp;<span class="num" id="4925534">6</span><span class="op" id="4925535">,</span>&nbsp;<span class="num" id="4925537">6</span><span class="op" id="4925538">,</span>&nbsp;<span class="num" id="4925540">6</span><span class="op" id="4925541">,</span>&nbsp;<span class="num" id="4925543">6</span><span class="op" id="4925544">,</span>&nbsp;<span class="num" id="4925546">6</span><span class="op" id="4925547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4925550">7</span><span class="op" id="4925551">,</span>&nbsp;<span class="num" id="4925553">7</span><span class="op" id="4925554">,</span>&nbsp;<span class="num" id="4925556">7</span><span class="op" id="4925557">,</span>&nbsp;<span class="num" id="4925559">7</span><span class="op" id="4925560">,</span>&nbsp;<span class="num" id="4925562">7</span><span class="op" id="4925563">,</span>&nbsp;<span class="num" id="4925565">7</span><span class="op" id="4925566">,</span>&nbsp;<span class="num" id="4925568">7</span><span class="op" id="4925569">,</span>&nbsp;<span class="num" id="4925571">7</span><span class="op" id="4925572">,</span>&nbsp;<span class="num" id="4925574">7</span><span class="op" id="4925575">,</span>&nbsp;<span class="num" id="4925577">7</span><span class="op" id="4925578">,</span>&nbsp;<span class="num" id="4925580">7</span><span class="op" id="4925581">,</span>&nbsp;<span class="num" id="4925583">7</span><span class="op" id="4925584">,</span>&nbsp;<span class="num" id="4925586">7</span><span class="op" id="4925587">,</span>&nbsp;<span class="num" id="4925589">7</span><span class="op" id="4925590">,</span>&nbsp;<span class="num" id="4925592">7</span><span class="op" id="4925593">,</span>&nbsp;<span class="num" id="4925595">7</span><span class="op" id="4925596">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4925599">7</span><span class="op" id="4925600">,</span>&nbsp;<span class="num" id="4925602">7</span><span class="op" id="4925603">,</span>&nbsp;<span class="num" id="4925605">7</span><span class="op" id="4925606">,</span>&nbsp;<span class="num" id="4925608">7</span><span class="op" id="4925609">,</span>&nbsp;<span class="num" id="4925611">7</span><span class="op" id="4925612">,</span>&nbsp;<span class="num" id="4925614">7</span><span class="op" id="4925615">,</span>&nbsp;<span class="num" id="4925617">7</span><span class="op" id="4925618">,</span>&nbsp;<span class="num" id="4925620">7</span><span class="op" id="4925621">,</span>&nbsp;<span class="num" id="4925623">7</span><span class="op" id="4925624">,</span>&nbsp;<span class="num" id="4925626">7</span><span class="op" id="4925627">,</span>&nbsp;<span class="num" id="4925629">7</span><span class="op" id="4925630">,</span>&nbsp;<span class="num" id="4925632">7</span><span class="op" id="4925633">,</span>&nbsp;<span class="num" id="4925635">7</span><span class="op" id="4925636">,</span>&nbsp;<span class="num" id="4925638">7</span><span class="op" id="4925639">,</span>&nbsp;<span class="num" id="4925641">7</span><span class="op" id="4925642">,</span>&nbsp;<span class="num" id="4925644">7</span><span class="op" id="4925645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4925648">7</span><span class="op" id="4925649">,</span>&nbsp;<span class="num" id="4925651">7</span><span class="op" id="4925652">,</span>&nbsp;<span class="num" id="4925654">7</span><span class="op" id="4925655">,</span>&nbsp;<span class="num" id="4925657">7</span><span class="op" id="4925658">,</span>&nbsp;<span class="num" id="4925660">7</span><span class="op" id="4925661">,</span>&nbsp;<span class="num" id="4925663">7</span><span class="op" id="4925664">,</span>&nbsp;<span class="num" id="4925666">7</span><span class="op" id="4925667">,</span>&nbsp;<span class="num" id="4925669">7</span><span class="op" id="4925670">,</span>&nbsp;<span class="num" id="4925672">7</span><span class="op" id="4925673">,</span>&nbsp;<span class="num" id="4925675">7</span><span class="op" id="4925676">,</span>&nbsp;<span class="num" id="4925678">7</span><span class="op" id="4925679">,</span>&nbsp;<span class="num" id="4925681">7</span><span class="op" id="4925682">,</span>&nbsp;<span class="num" id="4925684">7</span><span class="op" id="4925685">,</span>&nbsp;<span class="num" id="4925687">7</span><span class="op" id="4925688">,</span>&nbsp;<span class="num" id="4925690">7</span><span class="op" id="4925691">,</span>&nbsp;<span class="num" id="4925693">7</span><span class="op" id="4925694">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4925697">7</span><span class="op" id="4925698">,</span>&nbsp;<span class="num" id="4925700">7</span><span class="op" id="4925701">,</span>&nbsp;<span class="num" id="4925703">7</span><span class="op" id="4925704">,</span>&nbsp;<span class="num" id="4925706">7</span><span class="op" id="4925707">,</span>&nbsp;<span class="num" id="4925709">7</span><span class="op" id="4925710">,</span>&nbsp;<span class="num" id="4925712">7</span><span class="op" id="4925713">,</span>&nbsp;<span class="num" id="4925715">7</span><span class="op" id="4925716">,</span>&nbsp;<span class="num" id="4925718">7</span><span class="op" id="4925719">,</span>&nbsp;<span class="num" id="4925721">7</span><span class="op" id="4925722">,</span>&nbsp;<span class="num" id="4925724">7</span><span class="op" id="4925725">,</span>&nbsp;<span class="num" id="4925727">7</span><span class="op" id="4925728">,</span>&nbsp;<span class="num" id="4925730">7</span><span class="op" id="4925731">,</span>&nbsp;<span class="num" id="4925733">7</span><span class="op" id="4925734">,</span>&nbsp;<span class="num" id="4925736">7</span><span class="op" id="4925737">,</span>&nbsp;<span class="num" id="4925739">7</span><span class="op" id="4925740">,</span>&nbsp;<span class="num" id="4925742">7</span><span class="op" id="4925743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4925746">8</span><span class="op" id="4925747">,</span>&nbsp;<span class="num" id="4925749">8</span><span class="op" id="4925750">,</span>&nbsp;<span class="num" id="4925752">8</span><span class="op" id="4925753">,</span>&nbsp;<span class="num" id="4925755">8</span><span class="op" id="4925756">,</span>&nbsp;<span class="num" id="4925758">8</span><span class="op" id="4925759">,</span>&nbsp;<span class="num" id="4925761">8</span><span class="op" id="4925762">,</span>&nbsp;<span class="num" id="4925764">8</span><span class="op" id="4925765">,</span>&nbsp;<span class="num" id="4925767">8</span><span class="op" id="4925768">,</span>&nbsp;<span class="num" id="4925770">8</span><span class="op" id="4925771">,</span>&nbsp;<span class="num" id="4925773">8</span><span class="op" id="4925774">,</span>&nbsp;<span class="num" id="4925776">8</span><span class="op" id="4925777">,</span>&nbsp;<span class="num" id="4925779">8</span><span class="op" id="4925780">,</span>&nbsp;<span class="num" id="4925782">8</span><span class="op" id="4925783">,</span>&nbsp;<span class="num" id="4925785">8</span><span class="op" id="4925786">,</span>&nbsp;<span class="num" id="4925788">8</span><span class="op" id="4925789">,</span>&nbsp;<span class="num" id="4925791">8</span><span class="op" id="4925792">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4925795">8</span><span class="op" id="4925796">,</span>&nbsp;<span class="num" id="4925798">8</span><span class="op" id="4925799">,</span>&nbsp;<span class="num" id="4925801">8</span><span class="op" id="4925802">,</span>&nbsp;<span class="num" id="4925804">8</span><span class="op" id="4925805">,</span>&nbsp;<span class="num" id="4925807">8</span><span class="op" id="4925808">,</span>&nbsp;<span class="num" id="4925810">8</span><span class="op" id="4925811">,</span>&nbsp;<span class="num" id="4925813">8</span><span class="op" id="4925814">,</span>&nbsp;<span class="num" id="4925816">8</span><span class="op" id="4925817">,</span>&nbsp;<span class="num" id="4925819">8</span><span class="op" id="4925820">,</span>&nbsp;<span class="num" id="4925822">8</span><span class="op" id="4925823">,</span>&nbsp;<span class="num" id="4925825">8</span><span class="op" id="4925826">,</span>&nbsp;<span class="num" id="4925828">8</span><span class="op" id="4925829">,</span>&nbsp;<span class="num" id="4925831">8</span><span class="op" id="4925832">,</span>&nbsp;<span class="num" id="4925834">8</span><span class="op" id="4925835">,</span>&nbsp;<span class="num" id="4925837">8</span><span class="op" id="4925838">,</span>&nbsp;<span class="num" id="4925840">8</span><span class="op" id="4925841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4925844">8</span><span class="op" id="4925845">,</span>&nbsp;<span class="num" id="4925847">8</span><span class="op" id="4925848">,</span>&nbsp;<span class="num" id="4925850">8</span><span class="op" id="4925851">,</span>&nbsp;<span class="num" id="4925853">8</span><span class="op" id="4925854">,</span>&nbsp;<span class="num" id="4925856">8</span><span class="op" id="4925857">,</span>&nbsp;<span class="num" id="4925859">8</span><span class="op" id="4925860">,</span>&nbsp;<span class="num" id="4925862">8</span><span class="op" id="4925863">,</span>&nbsp;<span class="num" id="4925865">8</span><span class="op" id="4925866">,</span>&nbsp;<span class="num" id="4925868">8</span><span class="op" id="4925869">,</span>&nbsp;<span class="num" id="4925871">8</span><span class="op" id="4925872">,</span>&nbsp;<span class="num" id="4925874">8</span><span class="op" id="4925875">,</span>&nbsp;<span class="num" id="4925877">8</span><span class="op" id="4925878">,</span>&nbsp;<span class="num" id="4925880">8</span><span class="op" id="4925881">,</span>&nbsp;<span class="num" id="4925883">8</span><span class="op" id="4925884">,</span>&nbsp;<span class="num" id="4925886">8</span><span class="op" id="4925887">,</span>&nbsp;<span class="num" id="4925889">8</span><span class="op" id="4925890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4925893">8</span><span class="op" id="4925894">,</span>&nbsp;<span class="num" id="4925896">8</span><span class="op" id="4925897">,</span>&nbsp;<span class="num" id="4925899">8</span><span class="op" id="4925900">,</span>&nbsp;<span class="num" id="4925902">8</span><span class="op" id="4925903">,</span>&nbsp;<span class="num" id="4925905">8</span><span class="op" id="4925906">,</span>&nbsp;<span class="num" id="4925908">8</span><span class="op" id="4925909">,</span>&nbsp;<span class="num" id="4925911">8</span><span class="op" id="4925912">,</span>&nbsp;<span class="num" id="4925914">8</span><span class="op" id="4925915">,</span>&nbsp;<span class="num" id="4925917">8</span><span class="op" id="4925918">,</span>&nbsp;<span class="num" id="4925920">8</span><span class="op" id="4925921">,</span>&nbsp;<span class="num" id="4925923">8</span><span class="op" id="4925924">,</span>&nbsp;<span class="num" id="4925926">8</span><span class="op" id="4925927">,</span>&nbsp;<span class="num" id="4925929">8</span><span class="op" id="4925930">,</span>&nbsp;<span class="num" id="4925932">8</span><span class="op" id="4925933">,</span>&nbsp;<span class="num" id="4925935">8</span><span class="op" id="4925936">,</span>&nbsp;<span class="num" id="4925938">8</span><span class="op" id="4925939">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4925942">8</span><span class="op" id="4925943">,</span>&nbsp;<span class="num" id="4925945">8</span><span class="op" id="4925946">,</span>&nbsp;<span class="num" id="4925948">8</span><span class="op" id="4925949">,</span>&nbsp;<span class="num" id="4925951">8</span><span class="op" id="4925952">,</span>&nbsp;<span class="num" id="4925954">8</span><span class="op" id="4925955">,</span>&nbsp;<span class="num" id="4925957">8</span><span class="op" id="4925958">,</span>&nbsp;<span class="num" id="4925960">8</span><span class="op" id="4925961">,</span>&nbsp;<span class="num" id="4925963">8</span><span class="op" id="4925964">,</span>&nbsp;<span class="num" id="4925966">8</span><span class="op" id="4925967">,</span>&nbsp;<span class="num" id="4925969">8</span><span class="op" id="4925970">,</span>&nbsp;<span class="num" id="4925972">8</span><span class="op" id="4925973">,</span>&nbsp;<span class="num" id="4925975">8</span><span class="op" id="4925976">,</span>&nbsp;<span class="num" id="4925978">8</span><span class="op" id="4925979">,</span>&nbsp;<span class="num" id="4925981">8</span><span class="op" id="4925982">,</span>&nbsp;<span class="num" id="4925984">8</span><span class="op" id="4925985">,</span>&nbsp;<span class="num" id="4925987">8</span><span class="op" id="4925988">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4925991">8</span><span class="op" id="4925992">,</span>&nbsp;<span class="num" id="4925994">8</span><span class="op" id="4925995">,</span>&nbsp;<span class="num" id="4925997">8</span><span class="op" id="4925998">,</span>&nbsp;<span class="num" id="4926000">8</span><span class="op" id="4926001">,</span>&nbsp;<span class="num" id="4926003">8</span><span class="op" id="4926004">,</span>&nbsp;<span class="num" id="4926006">8</span><span class="op" id="4926007">,</span>&nbsp;<span class="num" id="4926009">8</span><span class="op" id="4926010">,</span>&nbsp;<span class="num" id="4926012">8</span><span class="op" id="4926013">,</span>&nbsp;<span class="num" id="4926015">8</span><span class="op" id="4926016">,</span>&nbsp;<span class="num" id="4926018">8</span><span class="op" id="4926019">,</span>&nbsp;<span class="num" id="4926021">8</span><span class="op" id="4926022">,</span>&nbsp;<span class="num" id="4926024">8</span><span class="op" id="4926025">,</span>&nbsp;<span class="num" id="4926027">8</span><span class="op" id="4926028">,</span>&nbsp;<span class="num" id="4926030">8</span><span class="op" id="4926031">,</span>&nbsp;<span class="num" id="4926033">8</span><span class="op" id="4926034">,</span>&nbsp;<span class="num" id="4926036">8</span><span class="op" id="4926037">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4926040">8</span><span class="op" id="4926041">,</span>&nbsp;<span class="num" id="4926043">8</span><span class="op" id="4926044">,</span>&nbsp;<span class="num" id="4926046">8</span><span class="op" id="4926047">,</span>&nbsp;<span class="num" id="4926049">8</span><span class="op" id="4926050">,</span>&nbsp;<span class="num" id="4926052">8</span><span class="op" id="4926053">,</span>&nbsp;<span class="num" id="4926055">8</span><span class="op" id="4926056">,</span>&nbsp;<span class="num" id="4926058">8</span><span class="op" id="4926059">,</span>&nbsp;<span class="num" id="4926061">8</span><span class="op" id="4926062">,</span>&nbsp;<span class="num" id="4926064">8</span><span class="op" id="4926065">,</span>&nbsp;<span class="num" id="4926067">8</span><span class="op" id="4926068">,</span>&nbsp;<span class="num" id="4926070">8</span><span class="op" id="4926071">,</span>&nbsp;<span class="num" id="4926073">8</span><span class="op" id="4926074">,</span>&nbsp;<span class="num" id="4926076">8</span><span class="op" id="4926077">,</span>&nbsp;<span class="num" id="4926079">8</span><span class="op" id="4926080">,</span>&nbsp;<span class="num" id="4926082">8</span><span class="op" id="4926083">,</span>&nbsp;<span class="num" id="4926085">8</span><span class="op" id="4926086">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4926089">8</span><span class="op" id="4926090">,</span>&nbsp;<span class="num" id="4926092">8</span><span class="op" id="4926093">,</span>&nbsp;<span class="num" id="4926095">8</span><span class="op" id="4926096">,</span>&nbsp;<span class="num" id="4926098">8</span><span class="op" id="4926099">,</span>&nbsp;<span class="num" id="4926101">8</span><span class="op" id="4926102">,</span>&nbsp;<span class="num" id="4926104">8</span><span class="op" id="4926105">,</span>&nbsp;<span class="num" id="4926107">8</span><span class="op" id="4926108">,</span>&nbsp;<span class="num" id="4926110">8</span><span class="op" id="4926111">,</span>&nbsp;<span class="num" id="4926113">8</span><span class="op" id="4926114">,</span>&nbsp;<span class="num" id="4926116">8</span><span class="op" id="4926117">,</span>&nbsp;<span class="num" id="4926119">8</span><span class="op" id="4926120">,</span>&nbsp;<span class="num" id="4926122">8</span><span class="op" id="4926123">,</span>&nbsp;<span class="num" id="4926125">8</span><span class="op" id="4926126">,</span>&nbsp;<span class="num" id="4926128">8</span><span class="op" id="4926129">,</span>&nbsp;<span class="num" id="4926131">8</span><span class="op" id="4926132">,</span>&nbsp;<span class="num" id="4926134">8</span><span class="op" id="4926135">,</span><br>
<span class="lineno"></span><span class="op" id="4926137">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4926140">type</span>&nbsp;<span class="ident" id="4926145">quantIndex</span>&nbsp;<span class="builtintype" id="4926156">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4926161">const</span>&nbsp;<span class="op" id="4926167">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4926170">quantIndexLuminance</span>&nbsp;<span class="ident" id="4926190">quantIndex</span>&nbsp;<span class="op" id="4926201">=</span>&nbsp;<span class="ident" id="4926203">iota</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4926209">quantIndexChrominance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4926232">nQuantIndex</span><br>
<span class="lineno"></span><span class="op" id="4926244">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4926247">//&nbsp;unscaledQuant&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;Each</span><br>
<span class="lineno">60</span><span class="comment" id="4926324">//&nbsp;encoder&nbsp;copies&nbsp;and&nbsp;scales&nbsp;the&nbsp;tables&nbsp;according&nbsp;to&nbsp;its&nbsp;quality&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="4926400">//&nbsp;The&nbsp;values&nbsp;are&nbsp;derived&nbsp;from&nbsp;section&nbsp;K.1&nbsp;after&nbsp;converting&nbsp;from&nbsp;natural&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4926476">//&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="4926494">var</span>&nbsp;<span class="ident" id="4926498">unscaledQuant</span>&nbsp;<span class="op" id="4926512">=</span>&nbsp;<span class="op" id="4926514">[</span><span class="ident" id="4926515">nQuantIndex</span><span class="op" id="4926526">]</span><span class="op" id="4926527">[</span><span class="ident" id="4926528">blockSize</span><span class="op" id="4926537">]</span><span class="builtintype" id="4926538">byte</span><span class="op" id="4926542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4926545">//&nbsp;Luminance.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4926560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4926564">16</span><span class="op" id="4926566">,</span>&nbsp;<span class="num" id="4926568">11</span><span class="op" id="4926570">,</span>&nbsp;<span class="num" id="4926572">12</span><span class="op" id="4926574">,</span>&nbsp;<span class="num" id="4926576">14</span><span class="op" id="4926578">,</span>&nbsp;<span class="num" id="4926580">12</span><span class="op" id="4926582">,</span>&nbsp;<span class="num" id="4926584">10</span><span class="op" id="4926586">,</span>&nbsp;<span class="num" id="4926588">16</span><span class="op" id="4926590">,</span>&nbsp;<span class="num" id="4926592">14</span><span class="op" id="4926594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4926598">13</span><span class="op" id="4926600">,</span>&nbsp;<span class="num" id="4926602">14</span><span class="op" id="4926604">,</span>&nbsp;<span class="num" id="4926606">18</span><span class="op" id="4926608">,</span>&nbsp;<span class="num" id="4926610">17</span><span class="op" id="4926612">,</span>&nbsp;<span class="num" id="4926614">16</span><span class="op" id="4926616">,</span>&nbsp;<span class="num" id="4926618">19</span><span class="op" id="4926620">,</span>&nbsp;<span class="num" id="4926622">24</span><span class="op" id="4926624">,</span>&nbsp;<span class="num" id="4926626">40</span><span class="op" id="4926628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4926632">26</span><span class="op" id="4926634">,</span>&nbsp;<span class="num" id="4926636">24</span><span class="op" id="4926638">,</span>&nbsp;<span class="num" id="4926640">22</span><span class="op" id="4926642">,</span>&nbsp;<span class="num" id="4926644">22</span><span class="op" id="4926646">,</span>&nbsp;<span class="num" id="4926648">24</span><span class="op" id="4926650">,</span>&nbsp;<span class="num" id="4926652">49</span><span class="op" id="4926654">,</span>&nbsp;<span class="num" id="4926656">35</span><span class="op" id="4926658">,</span>&nbsp;<span class="num" id="4926660">37</span><span class="op" id="4926662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4926666">29</span><span class="op" id="4926668">,</span>&nbsp;<span class="num" id="4926670">40</span><span class="op" id="4926672">,</span>&nbsp;<span class="num" id="4926674">58</span><span class="op" id="4926676">,</span>&nbsp;<span class="num" id="4926678">51</span><span class="op" id="4926680">,</span>&nbsp;<span class="num" id="4926682">61</span><span class="op" id="4926684">,</span>&nbsp;<span class="num" id="4926686">60</span><span class="op" id="4926688">,</span>&nbsp;<span class="num" id="4926690">57</span><span class="op" id="4926692">,</span>&nbsp;<span class="num" id="4926694">51</span><span class="op" id="4926696">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4926700">56</span><span class="op" id="4926702">,</span>&nbsp;<span class="num" id="4926704">55</span><span class="op" id="4926706">,</span>&nbsp;<span class="num" id="4926708">64</span><span class="op" id="4926710">,</span>&nbsp;<span class="num" id="4926712">72</span><span class="op" id="4926714">,</span>&nbsp;<span class="num" id="4926716">92</span><span class="op" id="4926718">,</span>&nbsp;<span class="num" id="4926720">78</span><span class="op" id="4926722">,</span>&nbsp;<span class="num" id="4926724">64</span><span class="op" id="4926726">,</span>&nbsp;<span class="num" id="4926728">68</span><span class="op" id="4926730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4926734">87</span><span class="op" id="4926736">,</span>&nbsp;<span class="num" id="4926738">69</span><span class="op" id="4926740">,</span>&nbsp;<span class="num" id="4926742">55</span><span class="op" id="4926744">,</span>&nbsp;<span class="num" id="4926746">56</span><span class="op" id="4926748">,</span>&nbsp;<span class="num" id="4926750">80</span><span class="op" id="4926752">,</span>&nbsp;<span class="num" id="4926754">109</span><span class="op" id="4926757">,</span>&nbsp;<span class="num" id="4926759">81</span><span class="op" id="4926761">,</span>&nbsp;<span class="num" id="4926763">87</span><span class="op" id="4926765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4926769">95</span><span class="op" id="4926771">,</span>&nbsp;<span class="num" id="4926773">98</span><span class="op" id="4926775">,</span>&nbsp;<span class="num" id="4926777">103</span><span class="op" id="4926780">,</span>&nbsp;<span class="num" id="4926782">104</span><span class="op" id="4926785">,</span>&nbsp;<span class="num" id="4926787">103</span><span class="op" id="4926790">,</span>&nbsp;<span class="num" id="4926792">62</span><span class="op" id="4926794">,</span>&nbsp;<span class="num" id="4926796">77</span><span class="op" id="4926798">,</span>&nbsp;<span class="num" id="4926800">113</span><span class="op" id="4926803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4926807">121</span><span class="op" id="4926810">,</span>&nbsp;<span class="num" id="4926812">112</span><span class="op" id="4926815">,</span>&nbsp;<span class="num" id="4926817">100</span><span class="op" id="4926820">,</span>&nbsp;<span class="num" id="4926822">120</span><span class="op" id="4926825">,</span>&nbsp;<span class="num" id="4926827">92</span><span class="op" id="4926829">,</span>&nbsp;<span class="num" id="4926831">101</span><span class="op" id="4926834">,</span>&nbsp;<span class="num" id="4926836">103</span><span class="op" id="4926839">,</span>&nbsp;<span class="num" id="4926841">99</span><span class="op" id="4926843">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4926846">}</span><span class="op" id="4926847">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4926850">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4926867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4926871">17</span><span class="op" id="4926873">,</span>&nbsp;<span class="num" id="4926875">18</span><span class="op" id="4926877">,</span>&nbsp;<span class="num" id="4926879">18</span><span class="op" id="4926881">,</span>&nbsp;<span class="num" id="4926883">24</span><span class="op" id="4926885">,</span>&nbsp;<span class="num" id="4926887">21</span><span class="op" id="4926889">,</span>&nbsp;<span class="num" id="4926891">24</span><span class="op" id="4926893">,</span>&nbsp;<span class="num" id="4926895">47</span><span class="op" id="4926897">,</span>&nbsp;<span class="num" id="4926899">26</span><span class="op" id="4926901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4926905">26</span><span class="op" id="4926907">,</span>&nbsp;<span class="num" id="4926909">47</span><span class="op" id="4926911">,</span>&nbsp;<span class="num" id="4926913">99</span><span class="op" id="4926915">,</span>&nbsp;<span class="num" id="4926917">66</span><span class="op" id="4926919">,</span>&nbsp;<span class="num" id="4926921">56</span><span class="op" id="4926923">,</span>&nbsp;<span class="num" id="4926925">66</span><span class="op" id="4926927">,</span>&nbsp;<span class="num" id="4926929">99</span><span class="op" id="4926931">,</span>&nbsp;<span class="num" id="4926933">99</span><span class="op" id="4926935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4926939">99</span><span class="op" id="4926941">,</span>&nbsp;<span class="num" id="4926943">99</span><span class="op" id="4926945">,</span>&nbsp;<span class="num" id="4926947">99</span><span class="op" id="4926949">,</span>&nbsp;<span class="num" id="4926951">99</span><span class="op" id="4926953">,</span>&nbsp;<span class="num" id="4926955">99</span><span class="op" id="4926957">,</span>&nbsp;<span class="num" id="4926959">99</span><span class="op" id="4926961">,</span>&nbsp;<span class="num" id="4926963">99</span><span class="op" id="4926965">,</span>&nbsp;<span class="num" id="4926967">99</span><span class="op" id="4926969">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4926973">99</span><span class="op" id="4926975">,</span>&nbsp;<span class="num" id="4926977">99</span><span class="op" id="4926979">,</span>&nbsp;<span class="num" id="4926981">99</span><span class="op" id="4926983">,</span>&nbsp;<span class="num" id="4926985">99</span><span class="op" id="4926987">,</span>&nbsp;<span class="num" id="4926989">99</span><span class="op" id="4926991">,</span>&nbsp;<span class="num" id="4926993">99</span><span class="op" id="4926995">,</span>&nbsp;<span class="num" id="4926997">99</span><span class="op" id="4926999">,</span>&nbsp;<span class="num" id="4927001">99</span><span class="op" id="4927003">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4927007">99</span><span class="op" id="4927009">,</span>&nbsp;<span class="num" id="4927011">99</span><span class="op" id="4927013">,</span>&nbsp;<span class="num" id="4927015">99</span><span class="op" id="4927017">,</span>&nbsp;<span class="num" id="4927019">99</span><span class="op" id="4927021">,</span>&nbsp;<span class="num" id="4927023">99</span><span class="op" id="4927025">,</span>&nbsp;<span class="num" id="4927027">99</span><span class="op" id="4927029">,</span>&nbsp;<span class="num" id="4927031">99</span><span class="op" id="4927033">,</span>&nbsp;<span class="num" id="4927035">99</span><span class="op" id="4927037">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4927041">99</span><span class="op" id="4927043">,</span>&nbsp;<span class="num" id="4927045">99</span><span class="op" id="4927047">,</span>&nbsp;<span class="num" id="4927049">99</span><span class="op" id="4927051">,</span>&nbsp;<span class="num" id="4927053">99</span><span class="op" id="4927055">,</span>&nbsp;<span class="num" id="4927057">99</span><span class="op" id="4927059">,</span>&nbsp;<span class="num" id="4927061">99</span><span class="op" id="4927063">,</span>&nbsp;<span class="num" id="4927065">99</span><span class="op" id="4927067">,</span>&nbsp;<span class="num" id="4927069">99</span><span class="op" id="4927071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4927075">99</span><span class="op" id="4927077">,</span>&nbsp;<span class="num" id="4927079">99</span><span class="op" id="4927081">,</span>&nbsp;<span class="num" id="4927083">99</span><span class="op" id="4927085">,</span>&nbsp;<span class="num" id="4927087">99</span><span class="op" id="4927089">,</span>&nbsp;<span class="num" id="4927091">99</span><span class="op" id="4927093">,</span>&nbsp;<span class="num" id="4927095">99</span><span class="op" id="4927097">,</span>&nbsp;<span class="num" id="4927099">99</span><span class="op" id="4927101">,</span>&nbsp;<span class="num" id="4927103">99</span><span class="op" id="4927105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4927109">99</span><span class="op" id="4927111">,</span>&nbsp;<span class="num" id="4927113">99</span><span class="op" id="4927115">,</span>&nbsp;<span class="num" id="4927117">99</span><span class="op" id="4927119">,</span>&nbsp;<span class="num" id="4927121">99</span><span class="op" id="4927123">,</span>&nbsp;<span class="num" id="4927125">99</span><span class="op" id="4927127">,</span>&nbsp;<span class="num" id="4927129">99</span><span class="op" id="4927131">,</span>&nbsp;<span class="num" id="4927133">99</span><span class="op" id="4927135">,</span>&nbsp;<span class="num" id="4927137">99</span><span class="op" id="4927139">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4927142">}</span><span class="op" id="4927143">,</span><br>
<span class="lineno"></span><span class="op" id="4927145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4927148">type</span>&nbsp;<span class="ident" id="4927153">huffIndex</span>&nbsp;<span class="builtintype" id="4927163">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4927168">const</span>&nbsp;<span class="op" id="4927174">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4927177">huffIndexLuminanceDC</span>&nbsp;<span class="ident" id="4927198">huffIndex</span>&nbsp;<span class="op" id="4927208">=</span>&nbsp;<span class="ident" id="4927210">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4927216">huffIndexLuminanceAC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4927238">huffIndexChrominanceDC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4927262">huffIndexChrominanceAC</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4927286">nHuffIndex</span><br>
<span class="lineno"></span><span class="op" id="4927297">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4927300">//&nbsp;huffmanSpec&nbsp;specifies&nbsp;a&nbsp;Huffman&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4927345">type</span>&nbsp;<span class="ident" id="4927350">huffmanSpec</span>&nbsp;<span class="keyword" id="4927362">struct</span>&nbsp;<span class="op" id="4927369">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4927372">//&nbsp;count[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;length&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4927426">count</span>&nbsp;<span class="op" id="4927432">[</span><span class="num" id="4927433">16</span><span class="op" id="4927435">]</span><span class="builtintype" id="4927436">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4927442">//&nbsp;value[i]&nbsp;is&nbsp;the&nbsp;decoded&nbsp;value&nbsp;of&nbsp;the&nbsp;i&#39;th&nbsp;codeword.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4927498">value</span>&nbsp;<span class="op" id="4927504">[</span><span class="op" id="4927505">]</span><span class="builtintype" id="4927506">byte</span><br>
<span class="lineno"></span><span class="op" id="4927511">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="4927514">//&nbsp;theHuffmanSpec&nbsp;is&nbsp;the&nbsp;Huffman&nbsp;encoding&nbsp;specifications.</span><br>
<span class="lineno"></span><span class="comment" id="4927572">//&nbsp;This&nbsp;encoder&nbsp;uses&nbsp;the&nbsp;same&nbsp;Huffman&nbsp;encoding&nbsp;for&nbsp;all&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="4927635">var</span>&nbsp;<span class="ident" id="4927639">theHuffmanSpec</span>&nbsp;<span class="op" id="4927654">=</span>&nbsp;<span class="op" id="4927656">[</span><span class="ident" id="4927657">nHuffIndex</span><span class="op" id="4927667">]</span><span class="ident" id="4927668">huffmanSpec</span><span class="op" id="4927679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4927682">//&nbsp;Luminance&nbsp;DC.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4927700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4927704">[</span><span class="num" id="4927705">16</span><span class="op" id="4927707">]</span><span class="builtintype" id="4927708">byte</span><span class="op" id="4927712">{</span><span class="num" id="4927713">0</span><span class="op" id="4927714">,</span>&nbsp;<span class="num" id="4927716">1</span><span class="op" id="4927717">,</span>&nbsp;<span class="num" id="4927719">5</span><span class="op" id="4927720">,</span>&nbsp;<span class="num" id="4927722">1</span><span class="op" id="4927723">,</span>&nbsp;<span class="num" id="4927725">1</span><span class="op" id="4927726">,</span>&nbsp;<span class="num" id="4927728">1</span><span class="op" id="4927729">,</span>&nbsp;<span class="num" id="4927731">1</span><span class="op" id="4927732">,</span>&nbsp;<span class="num" id="4927734">1</span><span class="op" id="4927735">,</span>&nbsp;<span class="num" id="4927737">1</span><span class="op" id="4927738">,</span>&nbsp;<span class="num" id="4927740">0</span><span class="op" id="4927741">,</span>&nbsp;<span class="num" id="4927743">0</span><span class="op" id="4927744">,</span>&nbsp;<span class="num" id="4927746">0</span><span class="op" id="4927747">,</span>&nbsp;<span class="num" id="4927749">0</span><span class="op" id="4927750">,</span>&nbsp;<span class="num" id="4927752">0</span><span class="op" id="4927753">,</span>&nbsp;<span class="num" id="4927755">0</span><span class="op" id="4927756">,</span>&nbsp;<span class="num" id="4927758">0</span><span class="op" id="4927759">}</span><span class="op" id="4927760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4927764">[</span><span class="op" id="4927765">]</span><span class="builtintype" id="4927766">byte</span><span class="op" id="4927770">{</span><span class="num" id="4927771">0</span><span class="op" id="4927772">,</span>&nbsp;<span class="num" id="4927774">1</span><span class="op" id="4927775">,</span>&nbsp;<span class="num" id="4927777">2</span><span class="op" id="4927778">,</span>&nbsp;<span class="num" id="4927780">3</span><span class="op" id="4927781">,</span>&nbsp;<span class="num" id="4927783">4</span><span class="op" id="4927784">,</span>&nbsp;<span class="num" id="4927786">5</span><span class="op" id="4927787">,</span>&nbsp;<span class="num" id="4927789">6</span><span class="op" id="4927790">,</span>&nbsp;<span class="num" id="4927792">7</span><span class="op" id="4927793">,</span>&nbsp;<span class="num" id="4927795">8</span><span class="op" id="4927796">,</span>&nbsp;<span class="num" id="4927798">9</span><span class="op" id="4927799">,</span>&nbsp;<span class="num" id="4927801">10</span><span class="op" id="4927803">,</span>&nbsp;<span class="num" id="4927805">11</span><span class="op" id="4927807">}</span><span class="op" id="4927808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4927811">}</span><span class="op" id="4927812">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4927815">//&nbsp;Luminance&nbsp;AC.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4927833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4927837">[</span><span class="num" id="4927838">16</span><span class="op" id="4927840">]</span><span class="builtintype" id="4927841">byte</span><span class="op" id="4927845">{</span><span class="num" id="4927846">0</span><span class="op" id="4927847">,</span>&nbsp;<span class="num" id="4927849">2</span><span class="op" id="4927850">,</span>&nbsp;<span class="num" id="4927852">1</span><span class="op" id="4927853">,</span>&nbsp;<span class="num" id="4927855">3</span><span class="op" id="4927856">,</span>&nbsp;<span class="num" id="4927858">3</span><span class="op" id="4927859">,</span>&nbsp;<span class="num" id="4927861">2</span><span class="op" id="4927862">,</span>&nbsp;<span class="num" id="4927864">4</span><span class="op" id="4927865">,</span>&nbsp;<span class="num" id="4927867">3</span><span class="op" id="4927868">,</span>&nbsp;<span class="num" id="4927870">5</span><span class="op" id="4927871">,</span>&nbsp;<span class="num" id="4927873">5</span><span class="op" id="4927874">,</span>&nbsp;<span class="num" id="4927876">4</span><span class="op" id="4927877">,</span>&nbsp;<span class="num" id="4927879">4</span><span class="op" id="4927880">,</span>&nbsp;<span class="num" id="4927882">0</span><span class="op" id="4927883">,</span>&nbsp;<span class="num" id="4927885">0</span><span class="op" id="4927886">,</span>&nbsp;<span class="num" id="4927888">1</span><span class="op" id="4927889">,</span>&nbsp;<span class="num" id="4927891">125</span><span class="op" id="4927894">}</span><span class="op" id="4927895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4927899">[</span><span class="op" id="4927900">]</span><span class="builtintype" id="4927901">byte</span><span class="op" id="4927905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4927910">0x01</span><span class="op" id="4927914">,</span>&nbsp;<span class="num" id="4927916">0x02</span><span class="op" id="4927920">,</span>&nbsp;<span class="num" id="4927922">0x03</span><span class="op" id="4927926">,</span>&nbsp;<span class="num" id="4927928">0x00</span><span class="op" id="4927932">,</span>&nbsp;<span class="num" id="4927934">0x04</span><span class="op" id="4927938">,</span>&nbsp;<span class="num" id="4927940">0x11</span><span class="op" id="4927944">,</span>&nbsp;<span class="num" id="4927946">0x05</span><span class="op" id="4927950">,</span>&nbsp;<span class="num" id="4927952">0x12</span><span class="op" id="4927956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4927961">0x21</span><span class="op" id="4927965">,</span>&nbsp;<span class="num" id="4927967">0x31</span><span class="op" id="4927971">,</span>&nbsp;<span class="num" id="4927973">0x41</span><span class="op" id="4927977">,</span>&nbsp;<span class="num" id="4927979">0x06</span><span class="op" id="4927983">,</span>&nbsp;<span class="num" id="4927985">0x13</span><span class="op" id="4927989">,</span>&nbsp;<span class="num" id="4927991">0x51</span><span class="op" id="4927995">,</span>&nbsp;<span class="num" id="4927997">0x61</span><span class="op" id="4928001">,</span>&nbsp;<span class="num" id="4928003">0x07</span><span class="op" id="4928007">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928012">0x22</span><span class="op" id="4928016">,</span>&nbsp;<span class="num" id="4928018">0x71</span><span class="op" id="4928022">,</span>&nbsp;<span class="num" id="4928024">0x14</span><span class="op" id="4928028">,</span>&nbsp;<span class="num" id="4928030">0x32</span><span class="op" id="4928034">,</span>&nbsp;<span class="num" id="4928036">0x81</span><span class="op" id="4928040">,</span>&nbsp;<span class="num" id="4928042">0x91</span><span class="op" id="4928046">,</span>&nbsp;<span class="num" id="4928048">0xa1</span><span class="op" id="4928052">,</span>&nbsp;<span class="num" id="4928054">0x08</span><span class="op" id="4928058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928063">0x23</span><span class="op" id="4928067">,</span>&nbsp;<span class="num" id="4928069">0x42</span><span class="op" id="4928073">,</span>&nbsp;<span class="num" id="4928075">0xb1</span><span class="op" id="4928079">,</span>&nbsp;<span class="num" id="4928081">0xc1</span><span class="op" id="4928085">,</span>&nbsp;<span class="num" id="4928087">0x15</span><span class="op" id="4928091">,</span>&nbsp;<span class="num" id="4928093">0x52</span><span class="op" id="4928097">,</span>&nbsp;<span class="num" id="4928099">0xd1</span><span class="op" id="4928103">,</span>&nbsp;<span class="num" id="4928105">0xf0</span><span class="op" id="4928109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928114">0x24</span><span class="op" id="4928118">,</span>&nbsp;<span class="num" id="4928120">0x33</span><span class="op" id="4928124">,</span>&nbsp;<span class="num" id="4928126">0x62</span><span class="op" id="4928130">,</span>&nbsp;<span class="num" id="4928132">0x72</span><span class="op" id="4928136">,</span>&nbsp;<span class="num" id="4928138">0x82</span><span class="op" id="4928142">,</span>&nbsp;<span class="num" id="4928144">0x09</span><span class="op" id="4928148">,</span>&nbsp;<span class="num" id="4928150">0x0a</span><span class="op" id="4928154">,</span>&nbsp;<span class="num" id="4928156">0x16</span><span class="op" id="4928160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928165">0x17</span><span class="op" id="4928169">,</span>&nbsp;<span class="num" id="4928171">0x18</span><span class="op" id="4928175">,</span>&nbsp;<span class="num" id="4928177">0x19</span><span class="op" id="4928181">,</span>&nbsp;<span class="num" id="4928183">0x1a</span><span class="op" id="4928187">,</span>&nbsp;<span class="num" id="4928189">0x25</span><span class="op" id="4928193">,</span>&nbsp;<span class="num" id="4928195">0x26</span><span class="op" id="4928199">,</span>&nbsp;<span class="num" id="4928201">0x27</span><span class="op" id="4928205">,</span>&nbsp;<span class="num" id="4928207">0x28</span><span class="op" id="4928211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928216">0x29</span><span class="op" id="4928220">,</span>&nbsp;<span class="num" id="4928222">0x2a</span><span class="op" id="4928226">,</span>&nbsp;<span class="num" id="4928228">0x34</span><span class="op" id="4928232">,</span>&nbsp;<span class="num" id="4928234">0x35</span><span class="op" id="4928238">,</span>&nbsp;<span class="num" id="4928240">0x36</span><span class="op" id="4928244">,</span>&nbsp;<span class="num" id="4928246">0x37</span><span class="op" id="4928250">,</span>&nbsp;<span class="num" id="4928252">0x38</span><span class="op" id="4928256">,</span>&nbsp;<span class="num" id="4928258">0x39</span><span class="op" id="4928262">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928267">0x3a</span><span class="op" id="4928271">,</span>&nbsp;<span class="num" id="4928273">0x43</span><span class="op" id="4928277">,</span>&nbsp;<span class="num" id="4928279">0x44</span><span class="op" id="4928283">,</span>&nbsp;<span class="num" id="4928285">0x45</span><span class="op" id="4928289">,</span>&nbsp;<span class="num" id="4928291">0x46</span><span class="op" id="4928295">,</span>&nbsp;<span class="num" id="4928297">0x47</span><span class="op" id="4928301">,</span>&nbsp;<span class="num" id="4928303">0x48</span><span class="op" id="4928307">,</span>&nbsp;<span class="num" id="4928309">0x49</span><span class="op" id="4928313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928318">0x4a</span><span class="op" id="4928322">,</span>&nbsp;<span class="num" id="4928324">0x53</span><span class="op" id="4928328">,</span>&nbsp;<span class="num" id="4928330">0x54</span><span class="op" id="4928334">,</span>&nbsp;<span class="num" id="4928336">0x55</span><span class="op" id="4928340">,</span>&nbsp;<span class="num" id="4928342">0x56</span><span class="op" id="4928346">,</span>&nbsp;<span class="num" id="4928348">0x57</span><span class="op" id="4928352">,</span>&nbsp;<span class="num" id="4928354">0x58</span><span class="op" id="4928358">,</span>&nbsp;<span class="num" id="4928360">0x59</span><span class="op" id="4928364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928369">0x5a</span><span class="op" id="4928373">,</span>&nbsp;<span class="num" id="4928375">0x63</span><span class="op" id="4928379">,</span>&nbsp;<span class="num" id="4928381">0x64</span><span class="op" id="4928385">,</span>&nbsp;<span class="num" id="4928387">0x65</span><span class="op" id="4928391">,</span>&nbsp;<span class="num" id="4928393">0x66</span><span class="op" id="4928397">,</span>&nbsp;<span class="num" id="4928399">0x67</span><span class="op" id="4928403">,</span>&nbsp;<span class="num" id="4928405">0x68</span><span class="op" id="4928409">,</span>&nbsp;<span class="num" id="4928411">0x69</span><span class="op" id="4928415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928420">0x6a</span><span class="op" id="4928424">,</span>&nbsp;<span class="num" id="4928426">0x73</span><span class="op" id="4928430">,</span>&nbsp;<span class="num" id="4928432">0x74</span><span class="op" id="4928436">,</span>&nbsp;<span class="num" id="4928438">0x75</span><span class="op" id="4928442">,</span>&nbsp;<span class="num" id="4928444">0x76</span><span class="op" id="4928448">,</span>&nbsp;<span class="num" id="4928450">0x77</span><span class="op" id="4928454">,</span>&nbsp;<span class="num" id="4928456">0x78</span><span class="op" id="4928460">,</span>&nbsp;<span class="num" id="4928462">0x79</span><span class="op" id="4928466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928471">0x7a</span><span class="op" id="4928475">,</span>&nbsp;<span class="num" id="4928477">0x83</span><span class="op" id="4928481">,</span>&nbsp;<span class="num" id="4928483">0x84</span><span class="op" id="4928487">,</span>&nbsp;<span class="num" id="4928489">0x85</span><span class="op" id="4928493">,</span>&nbsp;<span class="num" id="4928495">0x86</span><span class="op" id="4928499">,</span>&nbsp;<span class="num" id="4928501">0x87</span><span class="op" id="4928505">,</span>&nbsp;<span class="num" id="4928507">0x88</span><span class="op" id="4928511">,</span>&nbsp;<span class="num" id="4928513">0x89</span><span class="op" id="4928517">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928522">0x8a</span><span class="op" id="4928526">,</span>&nbsp;<span class="num" id="4928528">0x92</span><span class="op" id="4928532">,</span>&nbsp;<span class="num" id="4928534">0x93</span><span class="op" id="4928538">,</span>&nbsp;<span class="num" id="4928540">0x94</span><span class="op" id="4928544">,</span>&nbsp;<span class="num" id="4928546">0x95</span><span class="op" id="4928550">,</span>&nbsp;<span class="num" id="4928552">0x96</span><span class="op" id="4928556">,</span>&nbsp;<span class="num" id="4928558">0x97</span><span class="op" id="4928562">,</span>&nbsp;<span class="num" id="4928564">0x98</span><span class="op" id="4928568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928573">0x99</span><span class="op" id="4928577">,</span>&nbsp;<span class="num" id="4928579">0x9a</span><span class="op" id="4928583">,</span>&nbsp;<span class="num" id="4928585">0xa2</span><span class="op" id="4928589">,</span>&nbsp;<span class="num" id="4928591">0xa3</span><span class="op" id="4928595">,</span>&nbsp;<span class="num" id="4928597">0xa4</span><span class="op" id="4928601">,</span>&nbsp;<span class="num" id="4928603">0xa5</span><span class="op" id="4928607">,</span>&nbsp;<span class="num" id="4928609">0xa6</span><span class="op" id="4928613">,</span>&nbsp;<span class="num" id="4928615">0xa7</span><span class="op" id="4928619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928624">0xa8</span><span class="op" id="4928628">,</span>&nbsp;<span class="num" id="4928630">0xa9</span><span class="op" id="4928634">,</span>&nbsp;<span class="num" id="4928636">0xaa</span><span class="op" id="4928640">,</span>&nbsp;<span class="num" id="4928642">0xb2</span><span class="op" id="4928646">,</span>&nbsp;<span class="num" id="4928648">0xb3</span><span class="op" id="4928652">,</span>&nbsp;<span class="num" id="4928654">0xb4</span><span class="op" id="4928658">,</span>&nbsp;<span class="num" id="4928660">0xb5</span><span class="op" id="4928664">,</span>&nbsp;<span class="num" id="4928666">0xb6</span><span class="op" id="4928670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928675">0xb7</span><span class="op" id="4928679">,</span>&nbsp;<span class="num" id="4928681">0xb8</span><span class="op" id="4928685">,</span>&nbsp;<span class="num" id="4928687">0xb9</span><span class="op" id="4928691">,</span>&nbsp;<span class="num" id="4928693">0xba</span><span class="op" id="4928697">,</span>&nbsp;<span class="num" id="4928699">0xc2</span><span class="op" id="4928703">,</span>&nbsp;<span class="num" id="4928705">0xc3</span><span class="op" id="4928709">,</span>&nbsp;<span class="num" id="4928711">0xc4</span><span class="op" id="4928715">,</span>&nbsp;<span class="num" id="4928717">0xc5</span><span class="op" id="4928721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928726">0xc6</span><span class="op" id="4928730">,</span>&nbsp;<span class="num" id="4928732">0xc7</span><span class="op" id="4928736">,</span>&nbsp;<span class="num" id="4928738">0xc8</span><span class="op" id="4928742">,</span>&nbsp;<span class="num" id="4928744">0xc9</span><span class="op" id="4928748">,</span>&nbsp;<span class="num" id="4928750">0xca</span><span class="op" id="4928754">,</span>&nbsp;<span class="num" id="4928756">0xd2</span><span class="op" id="4928760">,</span>&nbsp;<span class="num" id="4928762">0xd3</span><span class="op" id="4928766">,</span>&nbsp;<span class="num" id="4928768">0xd4</span><span class="op" id="4928772">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928777">0xd5</span><span class="op" id="4928781">,</span>&nbsp;<span class="num" id="4928783">0xd6</span><span class="op" id="4928787">,</span>&nbsp;<span class="num" id="4928789">0xd7</span><span class="op" id="4928793">,</span>&nbsp;<span class="num" id="4928795">0xd8</span><span class="op" id="4928799">,</span>&nbsp;<span class="num" id="4928801">0xd9</span><span class="op" id="4928805">,</span>&nbsp;<span class="num" id="4928807">0xda</span><span class="op" id="4928811">,</span>&nbsp;<span class="num" id="4928813">0xe1</span><span class="op" id="4928817">,</span>&nbsp;<span class="num" id="4928819">0xe2</span><span class="op" id="4928823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928828">0xe3</span><span class="op" id="4928832">,</span>&nbsp;<span class="num" id="4928834">0xe4</span><span class="op" id="4928838">,</span>&nbsp;<span class="num" id="4928840">0xe5</span><span class="op" id="4928844">,</span>&nbsp;<span class="num" id="4928846">0xe6</span><span class="op" id="4928850">,</span>&nbsp;<span class="num" id="4928852">0xe7</span><span class="op" id="4928856">,</span>&nbsp;<span class="num" id="4928858">0xe8</span><span class="op" id="4928862">,</span>&nbsp;<span class="num" id="4928864">0xe9</span><span class="op" id="4928868">,</span>&nbsp;<span class="num" id="4928870">0xea</span><span class="op" id="4928874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928879">0xf1</span><span class="op" id="4928883">,</span>&nbsp;<span class="num" id="4928885">0xf2</span><span class="op" id="4928889">,</span>&nbsp;<span class="num" id="4928891">0xf3</span><span class="op" id="4928895">,</span>&nbsp;<span class="num" id="4928897">0xf4</span><span class="op" id="4928901">,</span>&nbsp;<span class="num" id="4928903">0xf5</span><span class="op" id="4928907">,</span>&nbsp;<span class="num" id="4928909">0xf6</span><span class="op" id="4928913">,</span>&nbsp;<span class="num" id="4928915">0xf7</span><span class="op" id="4928919">,</span>&nbsp;<span class="num" id="4928921">0xf8</span><span class="op" id="4928925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4928930">0xf9</span><span class="op" id="4928934">,</span>&nbsp;<span class="num" id="4928936">0xfa</span><span class="op" id="4928940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4928944">}</span><span class="op" id="4928945">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4928948">}</span><span class="op" id="4928949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4928952">//&nbsp;Chrominance&nbsp;DC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4928972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4928976">[</span><span class="num" id="4928977">16</span><span class="op" id="4928979">]</span><span class="builtintype" id="4928980">byte</span><span class="op" id="4928984">{</span><span class="num" id="4928985">0</span><span class="op" id="4928986">,</span>&nbsp;<span class="num" id="4928988">3</span><span class="op" id="4928989">,</span>&nbsp;<span class="num" id="4928991">1</span><span class="op" id="4928992">,</span>&nbsp;<span class="num" id="4928994">1</span><span class="op" id="4928995">,</span>&nbsp;<span class="num" id="4928997">1</span><span class="op" id="4928998">,</span>&nbsp;<span class="num" id="4929000">1</span><span class="op" id="4929001">,</span>&nbsp;<span class="num" id="4929003">1</span><span class="op" id="4929004">,</span>&nbsp;<span class="num" id="4929006">1</span><span class="op" id="4929007">,</span>&nbsp;<span class="num" id="4929009">1</span><span class="op" id="4929010">,</span>&nbsp;<span class="num" id="4929012">1</span><span class="op" id="4929013">,</span>&nbsp;<span class="num" id="4929015">1</span><span class="op" id="4929016">,</span>&nbsp;<span class="num" id="4929018">0</span><span class="op" id="4929019">,</span>&nbsp;<span class="num" id="4929021">0</span><span class="op" id="4929022">,</span>&nbsp;<span class="num" id="4929024">0</span><span class="op" id="4929025">,</span>&nbsp;<span class="num" id="4929027">0</span><span class="op" id="4929028">,</span>&nbsp;<span class="num" id="4929030">0</span><span class="op" id="4929031">}</span><span class="op" id="4929032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4929036">[</span><span class="op" id="4929037">]</span><span class="builtintype" id="4929038">byte</span><span class="op" id="4929042">{</span><span class="num" id="4929043">0</span><span class="op" id="4929044">,</span>&nbsp;<span class="num" id="4929046">1</span><span class="op" id="4929047">,</span>&nbsp;<span class="num" id="4929049">2</span><span class="op" id="4929050">,</span>&nbsp;<span class="num" id="4929052">3</span><span class="op" id="4929053">,</span>&nbsp;<span class="num" id="4929055">4</span><span class="op" id="4929056">,</span>&nbsp;<span class="num" id="4929058">5</span><span class="op" id="4929059">,</span>&nbsp;<span class="num" id="4929061">6</span><span class="op" id="4929062">,</span>&nbsp;<span class="num" id="4929064">7</span><span class="op" id="4929065">,</span>&nbsp;<span class="num" id="4929067">8</span><span class="op" id="4929068">,</span>&nbsp;<span class="num" id="4929070">9</span><span class="op" id="4929071">,</span>&nbsp;<span class="num" id="4929073">10</span><span class="op" id="4929075">,</span>&nbsp;<span class="num" id="4929077">11</span><span class="op" id="4929079">}</span><span class="op" id="4929080">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4929083">}</span><span class="op" id="4929084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4929087">//&nbsp;Chrominance&nbsp;AC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4929107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4929111">[</span><span class="num" id="4929112">16</span><span class="op" id="4929114">]</span><span class="builtintype" id="4929115">byte</span><span class="op" id="4929119">{</span><span class="num" id="4929120">0</span><span class="op" id="4929121">,</span>&nbsp;<span class="num" id="4929123">2</span><span class="op" id="4929124">,</span>&nbsp;<span class="num" id="4929126">1</span><span class="op" id="4929127">,</span>&nbsp;<span class="num" id="4929129">2</span><span class="op" id="4929130">,</span>&nbsp;<span class="num" id="4929132">4</span><span class="op" id="4929133">,</span>&nbsp;<span class="num" id="4929135">4</span><span class="op" id="4929136">,</span>&nbsp;<span class="num" id="4929138">3</span><span class="op" id="4929139">,</span>&nbsp;<span class="num" id="4929141">4</span><span class="op" id="4929142">,</span>&nbsp;<span class="num" id="4929144">7</span><span class="op" id="4929145">,</span>&nbsp;<span class="num" id="4929147">5</span><span class="op" id="4929148">,</span>&nbsp;<span class="num" id="4929150">4</span><span class="op" id="4929151">,</span>&nbsp;<span class="num" id="4929153">4</span><span class="op" id="4929154">,</span>&nbsp;<span class="num" id="4929156">0</span><span class="op" id="4929157">,</span>&nbsp;<span class="num" id="4929159">1</span><span class="op" id="4929160">,</span>&nbsp;<span class="num" id="4929162">2</span><span class="op" id="4929163">,</span>&nbsp;<span class="num" id="4929165">119</span><span class="op" id="4929168">}</span><span class="op" id="4929169">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4929173">[</span><span class="op" id="4929174">]</span><span class="builtintype" id="4929175">byte</span><span class="op" id="4929179">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929184">0x00</span><span class="op" id="4929188">,</span>&nbsp;<span class="num" id="4929190">0x01</span><span class="op" id="4929194">,</span>&nbsp;<span class="num" id="4929196">0x02</span><span class="op" id="4929200">,</span>&nbsp;<span class="num" id="4929202">0x03</span><span class="op" id="4929206">,</span>&nbsp;<span class="num" id="4929208">0x11</span><span class="op" id="4929212">,</span>&nbsp;<span class="num" id="4929214">0x04</span><span class="op" id="4929218">,</span>&nbsp;<span class="num" id="4929220">0x05</span><span class="op" id="4929224">,</span>&nbsp;<span class="num" id="4929226">0x21</span><span class="op" id="4929230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929235">0x31</span><span class="op" id="4929239">,</span>&nbsp;<span class="num" id="4929241">0x06</span><span class="op" id="4929245">,</span>&nbsp;<span class="num" id="4929247">0x12</span><span class="op" id="4929251">,</span>&nbsp;<span class="num" id="4929253">0x41</span><span class="op" id="4929257">,</span>&nbsp;<span class="num" id="4929259">0x51</span><span class="op" id="4929263">,</span>&nbsp;<span class="num" id="4929265">0x07</span><span class="op" id="4929269">,</span>&nbsp;<span class="num" id="4929271">0x61</span><span class="op" id="4929275">,</span>&nbsp;<span class="num" id="4929277">0x71</span><span class="op" id="4929281">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929286">0x13</span><span class="op" id="4929290">,</span>&nbsp;<span class="num" id="4929292">0x22</span><span class="op" id="4929296">,</span>&nbsp;<span class="num" id="4929298">0x32</span><span class="op" id="4929302">,</span>&nbsp;<span class="num" id="4929304">0x81</span><span class="op" id="4929308">,</span>&nbsp;<span class="num" id="4929310">0x08</span><span class="op" id="4929314">,</span>&nbsp;<span class="num" id="4929316">0x14</span><span class="op" id="4929320">,</span>&nbsp;<span class="num" id="4929322">0x42</span><span class="op" id="4929326">,</span>&nbsp;<span class="num" id="4929328">0x91</span><span class="op" id="4929332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929337">0xa1</span><span class="op" id="4929341">,</span>&nbsp;<span class="num" id="4929343">0xb1</span><span class="op" id="4929347">,</span>&nbsp;<span class="num" id="4929349">0xc1</span><span class="op" id="4929353">,</span>&nbsp;<span class="num" id="4929355">0x09</span><span class="op" id="4929359">,</span>&nbsp;<span class="num" id="4929361">0x23</span><span class="op" id="4929365">,</span>&nbsp;<span class="num" id="4929367">0x33</span><span class="op" id="4929371">,</span>&nbsp;<span class="num" id="4929373">0x52</span><span class="op" id="4929377">,</span>&nbsp;<span class="num" id="4929379">0xf0</span><span class="op" id="4929383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929388">0x15</span><span class="op" id="4929392">,</span>&nbsp;<span class="num" id="4929394">0x62</span><span class="op" id="4929398">,</span>&nbsp;<span class="num" id="4929400">0x72</span><span class="op" id="4929404">,</span>&nbsp;<span class="num" id="4929406">0xd1</span><span class="op" id="4929410">,</span>&nbsp;<span class="num" id="4929412">0x0a</span><span class="op" id="4929416">,</span>&nbsp;<span class="num" id="4929418">0x16</span><span class="op" id="4929422">,</span>&nbsp;<span class="num" id="4929424">0x24</span><span class="op" id="4929428">,</span>&nbsp;<span class="num" id="4929430">0x34</span><span class="op" id="4929434">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929439">0xe1</span><span class="op" id="4929443">,</span>&nbsp;<span class="num" id="4929445">0x25</span><span class="op" id="4929449">,</span>&nbsp;<span class="num" id="4929451">0xf1</span><span class="op" id="4929455">,</span>&nbsp;<span class="num" id="4929457">0x17</span><span class="op" id="4929461">,</span>&nbsp;<span class="num" id="4929463">0x18</span><span class="op" id="4929467">,</span>&nbsp;<span class="num" id="4929469">0x19</span><span class="op" id="4929473">,</span>&nbsp;<span class="num" id="4929475">0x1a</span><span class="op" id="4929479">,</span>&nbsp;<span class="num" id="4929481">0x26</span><span class="op" id="4929485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929490">0x27</span><span class="op" id="4929494">,</span>&nbsp;<span class="num" id="4929496">0x28</span><span class="op" id="4929500">,</span>&nbsp;<span class="num" id="4929502">0x29</span><span class="op" id="4929506">,</span>&nbsp;<span class="num" id="4929508">0x2a</span><span class="op" id="4929512">,</span>&nbsp;<span class="num" id="4929514">0x35</span><span class="op" id="4929518">,</span>&nbsp;<span class="num" id="4929520">0x36</span><span class="op" id="4929524">,</span>&nbsp;<span class="num" id="4929526">0x37</span><span class="op" id="4929530">,</span>&nbsp;<span class="num" id="4929532">0x38</span><span class="op" id="4929536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929541">0x39</span><span class="op" id="4929545">,</span>&nbsp;<span class="num" id="4929547">0x3a</span><span class="op" id="4929551">,</span>&nbsp;<span class="num" id="4929553">0x43</span><span class="op" id="4929557">,</span>&nbsp;<span class="num" id="4929559">0x44</span><span class="op" id="4929563">,</span>&nbsp;<span class="num" id="4929565">0x45</span><span class="op" id="4929569">,</span>&nbsp;<span class="num" id="4929571">0x46</span><span class="op" id="4929575">,</span>&nbsp;<span class="num" id="4929577">0x47</span><span class="op" id="4929581">,</span>&nbsp;<span class="num" id="4929583">0x48</span><span class="op" id="4929587">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929592">0x49</span><span class="op" id="4929596">,</span>&nbsp;<span class="num" id="4929598">0x4a</span><span class="op" id="4929602">,</span>&nbsp;<span class="num" id="4929604">0x53</span><span class="op" id="4929608">,</span>&nbsp;<span class="num" id="4929610">0x54</span><span class="op" id="4929614">,</span>&nbsp;<span class="num" id="4929616">0x55</span><span class="op" id="4929620">,</span>&nbsp;<span class="num" id="4929622">0x56</span><span class="op" id="4929626">,</span>&nbsp;<span class="num" id="4929628">0x57</span><span class="op" id="4929632">,</span>&nbsp;<span class="num" id="4929634">0x58</span><span class="op" id="4929638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929643">0x59</span><span class="op" id="4929647">,</span>&nbsp;<span class="num" id="4929649">0x5a</span><span class="op" id="4929653">,</span>&nbsp;<span class="num" id="4929655">0x63</span><span class="op" id="4929659">,</span>&nbsp;<span class="num" id="4929661">0x64</span><span class="op" id="4929665">,</span>&nbsp;<span class="num" id="4929667">0x65</span><span class="op" id="4929671">,</span>&nbsp;<span class="num" id="4929673">0x66</span><span class="op" id="4929677">,</span>&nbsp;<span class="num" id="4929679">0x67</span><span class="op" id="4929683">,</span>&nbsp;<span class="num" id="4929685">0x68</span><span class="op" id="4929689">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929694">0x69</span><span class="op" id="4929698">,</span>&nbsp;<span class="num" id="4929700">0x6a</span><span class="op" id="4929704">,</span>&nbsp;<span class="num" id="4929706">0x73</span><span class="op" id="4929710">,</span>&nbsp;<span class="num" id="4929712">0x74</span><span class="op" id="4929716">,</span>&nbsp;<span class="num" id="4929718">0x75</span><span class="op" id="4929722">,</span>&nbsp;<span class="num" id="4929724">0x76</span><span class="op" id="4929728">,</span>&nbsp;<span class="num" id="4929730">0x77</span><span class="op" id="4929734">,</span>&nbsp;<span class="num" id="4929736">0x78</span><span class="op" id="4929740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929745">0x79</span><span class="op" id="4929749">,</span>&nbsp;<span class="num" id="4929751">0x7a</span><span class="op" id="4929755">,</span>&nbsp;<span class="num" id="4929757">0x82</span><span class="op" id="4929761">,</span>&nbsp;<span class="num" id="4929763">0x83</span><span class="op" id="4929767">,</span>&nbsp;<span class="num" id="4929769">0x84</span><span class="op" id="4929773">,</span>&nbsp;<span class="num" id="4929775">0x85</span><span class="op" id="4929779">,</span>&nbsp;<span class="num" id="4929781">0x86</span><span class="op" id="4929785">,</span>&nbsp;<span class="num" id="4929787">0x87</span><span class="op" id="4929791">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929796">0x88</span><span class="op" id="4929800">,</span>&nbsp;<span class="num" id="4929802">0x89</span><span class="op" id="4929806">,</span>&nbsp;<span class="num" id="4929808">0x8a</span><span class="op" id="4929812">,</span>&nbsp;<span class="num" id="4929814">0x92</span><span class="op" id="4929818">,</span>&nbsp;<span class="num" id="4929820">0x93</span><span class="op" id="4929824">,</span>&nbsp;<span class="num" id="4929826">0x94</span><span class="op" id="4929830">,</span>&nbsp;<span class="num" id="4929832">0x95</span><span class="op" id="4929836">,</span>&nbsp;<span class="num" id="4929838">0x96</span><span class="op" id="4929842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929847">0x97</span><span class="op" id="4929851">,</span>&nbsp;<span class="num" id="4929853">0x98</span><span class="op" id="4929857">,</span>&nbsp;<span class="num" id="4929859">0x99</span><span class="op" id="4929863">,</span>&nbsp;<span class="num" id="4929865">0x9a</span><span class="op" id="4929869">,</span>&nbsp;<span class="num" id="4929871">0xa2</span><span class="op" id="4929875">,</span>&nbsp;<span class="num" id="4929877">0xa3</span><span class="op" id="4929881">,</span>&nbsp;<span class="num" id="4929883">0xa4</span><span class="op" id="4929887">,</span>&nbsp;<span class="num" id="4929889">0xa5</span><span class="op" id="4929893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929898">0xa6</span><span class="op" id="4929902">,</span>&nbsp;<span class="num" id="4929904">0xa7</span><span class="op" id="4929908">,</span>&nbsp;<span class="num" id="4929910">0xa8</span><span class="op" id="4929914">,</span>&nbsp;<span class="num" id="4929916">0xa9</span><span class="op" id="4929920">,</span>&nbsp;<span class="num" id="4929922">0xaa</span><span class="op" id="4929926">,</span>&nbsp;<span class="num" id="4929928">0xb2</span><span class="op" id="4929932">,</span>&nbsp;<span class="num" id="4929934">0xb3</span><span class="op" id="4929938">,</span>&nbsp;<span class="num" id="4929940">0xb4</span><span class="op" id="4929944">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4929949">0xb5</span><span class="op" id="4929953">,</span>&nbsp;<span class="num" id="4929955">0xb6</span><span class="op" id="4929959">,</span>&nbsp;<span class="num" id="4929961">0xb7</span><span class="op" id="4929965">,</span>&nbsp;<span class="num" id="4929967">0xb8</span><span class="op" id="4929971">,</span>&nbsp;<span class="num" id="4929973">0xb9</span><span class="op" id="4929977">,</span>&nbsp;<span class="num" id="4929979">0xba</span><span class="op" id="4929983">,</span>&nbsp;<span class="num" id="4929985">0xc2</span><span class="op" id="4929989">,</span>&nbsp;<span class="num" id="4929991">0xc3</span><span class="op" id="4929995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4930000">0xc4</span><span class="op" id="4930004">,</span>&nbsp;<span class="num" id="4930006">0xc5</span><span class="op" id="4930010">,</span>&nbsp;<span class="num" id="4930012">0xc6</span><span class="op" id="4930016">,</span>&nbsp;<span class="num" id="4930018">0xc7</span><span class="op" id="4930022">,</span>&nbsp;<span class="num" id="4930024">0xc8</span><span class="op" id="4930028">,</span>&nbsp;<span class="num" id="4930030">0xc9</span><span class="op" id="4930034">,</span>&nbsp;<span class="num" id="4930036">0xca</span><span class="op" id="4930040">,</span>&nbsp;<span class="num" id="4930042">0xd2</span><span class="op" id="4930046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4930051">0xd3</span><span class="op" id="4930055">,</span>&nbsp;<span class="num" id="4930057">0xd4</span><span class="op" id="4930061">,</span>&nbsp;<span class="num" id="4930063">0xd5</span><span class="op" id="4930067">,</span>&nbsp;<span class="num" id="4930069">0xd6</span><span class="op" id="4930073">,</span>&nbsp;<span class="num" id="4930075">0xd7</span><span class="op" id="4930079">,</span>&nbsp;<span class="num" id="4930081">0xd8</span><span class="op" id="4930085">,</span>&nbsp;<span class="num" id="4930087">0xd9</span><span class="op" id="4930091">,</span>&nbsp;<span class="num" id="4930093">0xda</span><span class="op" id="4930097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4930102">0xe2</span><span class="op" id="4930106">,</span>&nbsp;<span class="num" id="4930108">0xe3</span><span class="op" id="4930112">,</span>&nbsp;<span class="num" id="4930114">0xe4</span><span class="op" id="4930118">,</span>&nbsp;<span class="num" id="4930120">0xe5</span><span class="op" id="4930124">,</span>&nbsp;<span class="num" id="4930126">0xe6</span><span class="op" id="4930130">,</span>&nbsp;<span class="num" id="4930132">0xe7</span><span class="op" id="4930136">,</span>&nbsp;<span class="num" id="4930138">0xe8</span><span class="op" id="4930142">,</span>&nbsp;<span class="num" id="4930144">0xe9</span><span class="op" id="4930148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4930153">0xea</span><span class="op" id="4930157">,</span>&nbsp;<span class="num" id="4930159">0xf2</span><span class="op" id="4930163">,</span>&nbsp;<span class="num" id="4930165">0xf3</span><span class="op" id="4930169">,</span>&nbsp;<span class="num" id="4930171">0xf4</span><span class="op" id="4930175">,</span>&nbsp;<span class="num" id="4930177">0xf5</span><span class="op" id="4930181">,</span>&nbsp;<span class="num" id="4930183">0xf6</span><span class="op" id="4930187">,</span>&nbsp;<span class="num" id="4930189">0xf7</span><span class="op" id="4930193">,</span>&nbsp;<span class="num" id="4930195">0xf8</span><span class="op" id="4930199">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4930204">0xf9</span><span class="op" id="4930208">,</span>&nbsp;<span class="num" id="4930210">0xfa</span><span class="op" id="4930214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4930218">}</span><span class="op" id="4930219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4930222">}</span><span class="op" id="4930223">,</span><br>
<span class="lineno"></span><span class="op" id="4930225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="4930228">//&nbsp;huffmanLUT&nbsp;is&nbsp;a&nbsp;compiled&nbsp;look-up&nbsp;table&nbsp;representation&nbsp;of&nbsp;a&nbsp;huffmanSpec.</span><br>
<span class="lineno"></span><span class="comment" id="4930303">//&nbsp;Each&nbsp;value&nbsp;maps&nbsp;to&nbsp;a&nbsp;uint32&nbsp;of&nbsp;which&nbsp;the&nbsp;8&nbsp;most&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4930380">//&nbsp;codeword&nbsp;size&nbsp;in&nbsp;bits&nbsp;and&nbsp;the&nbsp;24&nbsp;least&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the&nbsp;codeword.</span><br>
<span class="lineno"></span><span class="comment" id="4930458">//&nbsp;The&nbsp;maximum&nbsp;codeword&nbsp;size&nbsp;is&nbsp;16&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4930499">type</span>&nbsp;<span class="ident" id="4930504">huffmanLUT</span>&nbsp;<span class="op" id="4930515">[</span><span class="op" id="4930516">]</span><span class="builtintype" id="4930517">uint32</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="4930525">func</span>&nbsp;<span class="op" id="4930530">(</span><span class="ident" id="4930531">h</span>&nbsp;<span class="op" id="4930533">*</span><span class="ident" id="4930534">huffmanLUT</span><span class="op" id="4930544">)</span>&nbsp;<span class="ident" id="4930546">init</span><span class="op" id="4930550">(</span><span class="ident" id="4930551">s</span>&nbsp;<span class="ident" id="4930553">huffmanSpec</span><span class="op" id="4930564">)</span>&nbsp;<span class="op" id="4930566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4930569">maxValue</span>&nbsp;<span class="op" id="4930578">:=</span>&nbsp;<span class="num" id="4930581">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4930584">for</span>&nbsp;<span class="ident" id="4930588">_</span><span class="op" id="4930589">,</span>&nbsp;<span class="ident" id="4930591">v</span>&nbsp;<span class="op" id="4930593">:=</span>&nbsp;<span class="keyword" id="4930596">range</span>&nbsp;<span class="ident" id="4930602">s</span><span class="op" id="4930603">.</span><span class="ident" id="4930604">value</span>&nbsp;<span class="op" id="4930610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4930614">if</span>&nbsp;<span class="builtintype" id="4930617">int</span><span class="op" id="4930620">(</span><span class="ident" id="4930621">v</span><span class="op" id="4930622">)</span>&nbsp;<span class="op" id="4930624">&gt;</span>&nbsp;<span class="ident" id="4930626">maxValue</span>&nbsp;<span class="op" id="4930635">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4930640">maxValue</span>&nbsp;<span class="op" id="4930649">=</span>&nbsp;<span class="builtintype" id="4930651">int</span><span class="op" id="4930654">(</span><span class="ident" id="4930655">v</span><span class="op" id="4930656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4930660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4930663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4930666">*</span><span class="ident" id="4930667">h</span>&nbsp;<span class="op" id="4930669">=</span>&nbsp;<span class="builtinfunc" id="4930671">make</span><span class="op" id="4930675">(</span><span class="op" id="4930676">[</span><span class="op" id="4930677">]</span><span class="builtintype" id="4930678">uint32</span><span class="op" id="4930684">,</span>&nbsp;<span class="ident" id="4930686">maxValue</span><span class="op" id="4930694">+</span><span class="num" id="4930695">1</span><span class="op" id="4930696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4930699">code</span><span class="op" id="4930703">,</span>&nbsp;<span class="ident" id="4930705">k</span>&nbsp;<span class="op" id="4930707">:=</span>&nbsp;<span class="builtintype" id="4930710">uint32</span><span class="op" id="4930716">(</span><span class="num" id="4930717">0</span><span class="op" id="4930718">)</span><span class="op" id="4930719">,</span>&nbsp;<span class="num" id="4930721">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4930724">for</span>&nbsp;<span class="ident" id="4930728">i</span>&nbsp;<span class="op" id="4930730">:=</span>&nbsp;<span class="num" id="4930733">0</span><span class="op" id="4930734">;</span>&nbsp;<span class="ident" id="4930736">i</span>&nbsp;<span class="op" id="4930738">&lt;</span>&nbsp;<span class="builtinfunc" id="4930740">len</span><span class="op" id="4930743">(</span><span class="ident" id="4930744">s</span><span class="op" id="4930745">.</span><span class="ident" id="4930746">count</span><span class="op" id="4930751">)</span><span class="op" id="4930752">;</span>&nbsp;<span class="ident" id="4930754">i</span><span class="op" id="4930755">++</span>&nbsp;<span class="op" id="4930758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4930762">nBits</span>&nbsp;<span class="op" id="4930768">:=</span>&nbsp;<span class="builtintype" id="4930771">uint32</span><span class="op" id="4930777">(</span><span class="ident" id="4930778">i</span><span class="op" id="4930779">+</span><span class="num" id="4930780">1</span><span class="op" id="4930781">)</span>&nbsp;<span class="op" id="4930783">&lt;&lt;</span>&nbsp;<span class="num" id="4930786">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4930791">for</span>&nbsp;<span class="ident" id="4930795">j</span>&nbsp;<span class="op" id="4930797">:=</span>&nbsp;<span class="builtintype" id="4930800">uint8</span><span class="op" id="4930805">(</span><span class="num" id="4930806">0</span><span class="op" id="4930807">)</span><span class="op" id="4930808">;</span>&nbsp;<span class="ident" id="4930810">j</span>&nbsp;<span class="op" id="4930812">&lt;</span>&nbsp;<span class="ident" id="4930814">s</span><span class="op" id="4930815">.</span><span class="ident" id="4930816">count</span><span class="op" id="4930821">[</span><span class="ident" id="4930822">i</span><span class="op" id="4930823">]</span><span class="op" id="4930824">;</span>&nbsp;<span class="ident" id="4930826">j</span><span class="op" id="4930827">++</span>&nbsp;<span class="op" id="4930830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4930835">(</span><span class="op" id="4930836">*</span><span class="ident" id="4930837">h</span><span class="op" id="4930838">)</span><span class="op" id="4930839">[</span><span class="ident" id="4930840">s</span><span class="op" id="4930841">.</span><span class="ident" id="4930842">value</span><span class="op" id="4930847">[</span><span class="ident" id="4930848">k</span><span class="op" id="4930849">]</span><span class="op" id="4930850">]</span>&nbsp;<span class="op" id="4930852">=</span>&nbsp;<span class="ident" id="4930854">nBits</span>&nbsp;<span class="op" id="4930860">|</span>&nbsp;<span class="ident" id="4930862">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4930870">code</span><span class="op" id="4930874">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4930880">k</span><span class="op" id="4930881">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4930886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4930890">code</span>&nbsp;<span class="op" id="4930895">&lt;&lt;=</span>&nbsp;<span class="num" id="4930899">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4930902">}</span><br>
<span class="lineno"></span><span class="op" id="4930904">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="4930907">//&nbsp;theHuffmanLUT&nbsp;are&nbsp;compiled&nbsp;representations&nbsp;of&nbsp;theHuffmanSpec.</span><br>
<span class="lineno"></span><span class="keyword" id="4930972">var</span>&nbsp;<span class="ident" id="4930976">theHuffmanLUT</span>&nbsp;<span class="op" id="4930990">[</span><span class="num" id="4930991">4</span><span class="op" id="4930992">]</span><span class="ident" id="4930993">huffmanLUT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4931005">func</span>&nbsp;<span class="ident" id="4931010">init</span><span class="op" id="4931014">(</span><span class="op" id="4931015">)</span>&nbsp;<span class="op" id="4931017">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4931020">for</span>&nbsp;<span class="ident" id="4931024">i</span><span class="op" id="4931025">,</span>&nbsp;<span class="ident" id="4931027">s</span>&nbsp;<span class="op" id="4931029">:=</span>&nbsp;<span class="keyword" id="4931032">range</span>&nbsp;<span class="ident" id="4931038">theHuffmanSpec</span>&nbsp;<span class="op" id="4931053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4931057">theHuffmanLUT</span><span class="op" id="4931070">[</span><span class="ident" id="4931071">i</span><span class="op" id="4931072">]</span><span class="op" id="4931073">.</span><span class="ident" id="4931074">init</span><span class="op" id="4931078">(</span><span class="ident" id="4931079">s</span><span class="op" id="4931080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4931083">}</span><br>
<span class="lineno"></span><span class="op" id="4931085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="4931088">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4931120">type</span>&nbsp;<span class="ident" id="4931125">writer</span>&nbsp;<span class="keyword" id="4931132">interface</span>&nbsp;<span class="op" id="4931142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4931145">Flush</span><span class="op" id="4931150">(</span><span class="op" id="4931151">)</span>&nbsp;<span class="builtintype" id="4931153">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4931160">io</span><span class="op" id="4931162">.</span><span class="ident" id="4931163">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4931171">io</span><span class="op" id="4931173">.</span><span class="ident" id="4931174">ByteWriter</span><br>
<span class="lineno">215</span><span class="op" id="4931185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4931188">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;JPEG&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="4931236">type</span>&nbsp;<span class="ident" id="4931241">encoder</span>&nbsp;<span class="keyword" id="4931249">struct</span>&nbsp;<span class="op" id="4931256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4931259">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4931334">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4931405">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4931409">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4931417">err</span>&nbsp;<span class="builtintype" id="4931421">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4931428">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4931457">buf</span>&nbsp;<span class="op" id="4931461">[</span><span class="num" id="4931462">16</span><span class="op" id="4931464">]</span><span class="builtintype" id="4931465">byte</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4931471">//&nbsp;bits&nbsp;and&nbsp;nBits&nbsp;are&nbsp;accumulated&nbsp;bits&nbsp;to&nbsp;write&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4931526">bits</span><span class="op" id="4931530">,</span>&nbsp;<span class="ident" id="4931532">nBits</span>&nbsp;<span class="builtintype" id="4931538">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4931546">//&nbsp;quant&nbsp;is&nbsp;the&nbsp;scaled&nbsp;quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4931609">quant</span>&nbsp;<span class="op" id="4931615">[</span><span class="ident" id="4931616">nQuantIndex</span><span class="op" id="4931627">]</span><span class="op" id="4931628">[</span><span class="ident" id="4931629">blockSize</span><span class="op" id="4931638">]</span><span class="builtintype" id="4931639">byte</span><br>
<span class="lineno"></span><span class="op" id="4931644">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="4931647">func</span>&nbsp;<span class="op" id="4931652">(</span><span class="ident" id="4931653">e</span>&nbsp;<span class="op" id="4931655">*</span><span class="ident" id="4931656">encoder</span><span class="op" id="4931663">)</span>&nbsp;<span class="ident" id="4931665">flush</span><span class="op" id="4931670">(</span><span class="op" id="4931671">)</span>&nbsp;<span class="op" id="4931673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4931676">if</span>&nbsp;<span class="ident" id="4931679">e</span><span class="op" id="4931680">.</span><span class="ident" id="4931681">err</span>&nbsp;<span class="op" id="4931685">!=</span>&nbsp;<span class="builtintype" id="4931688">nil</span>&nbsp;<span class="op" id="4931692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4931696">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4931704">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4931707">e</span><span class="op" id="4931708">.</span><span class="ident" id="4931709">err</span>&nbsp;<span class="op" id="4931713">=</span>&nbsp;<span class="ident" id="4931715">e</span><span class="op" id="4931716">.</span><span class="ident" id="4931717">w</span><span class="op" id="4931718">.</span><span class="ident" id="4931719">Flush</span><span class="op" id="4931724">(</span><span class="op" id="4931725">)</span><br>
<span class="lineno"></span><span class="op" id="4931727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4931730">func</span>&nbsp;<span class="op" id="4931735">(</span><span class="ident" id="4931736">e</span>&nbsp;<span class="op" id="4931738">*</span><span class="ident" id="4931739">encoder</span><span class="op" id="4931746">)</span>&nbsp;<span class="ident" id="4931748">write</span><span class="op" id="4931753">(</span><span class="ident" id="4931754">p</span>&nbsp;<span class="op" id="4931756">[</span><span class="op" id="4931757">]</span><span class="builtintype" id="4931758">byte</span><span class="op" id="4931762">)</span>&nbsp;<span class="op" id="4931764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4931767">if</span>&nbsp;<span class="ident" id="4931770">e</span><span class="op" id="4931771">.</span><span class="ident" id="4931772">err</span>&nbsp;<span class="op" id="4931776">!=</span>&nbsp;<span class="builtintype" id="4931779">nil</span>&nbsp;<span class="op" id="4931783">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4931787">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4931795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4931798">_</span><span class="op" id="4931799">,</span>&nbsp;<span class="ident" id="4931801">e</span><span class="op" id="4931802">.</span><span class="ident" id="4931803">err</span>&nbsp;<span class="op" id="4931807">=</span>&nbsp;<span class="ident" id="4931809">e</span><span class="op" id="4931810">.</span><span class="ident" id="4931811">w</span><span class="op" id="4931812">.</span><span class="ident" id="4931813">Write</span><span class="op" id="4931818">(</span><span class="ident" id="4931819">p</span><span class="op" id="4931820">)</span><br>
<span class="lineno"></span><span class="op" id="4931822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="4931825">func</span>&nbsp;<span class="op" id="4931830">(</span><span class="ident" id="4931831">e</span>&nbsp;<span class="op" id="4931833">*</span><span class="ident" id="4931834">encoder</span><span class="op" id="4931841">)</span>&nbsp;<span class="ident" id="4931843">writeByte</span><span class="op" id="4931852">(</span><span class="ident" id="4931853">b</span>&nbsp;<span class="builtintype" id="4931855">byte</span><span class="op" id="4931859">)</span>&nbsp;<span class="op" id="4931861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4931864">if</span>&nbsp;<span class="ident" id="4931867">e</span><span class="op" id="4931868">.</span><span class="ident" id="4931869">err</span>&nbsp;<span class="op" id="4931873">!=</span>&nbsp;<span class="builtintype" id="4931876">nil</span>&nbsp;<span class="op" id="4931880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4931884">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4931892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4931895">e</span><span class="op" id="4931896">.</span><span class="ident" id="4931897">err</span>&nbsp;<span class="op" id="4931901">=</span>&nbsp;<span class="ident" id="4931903">e</span><span class="op" id="4931904">.</span><span class="ident" id="4931905">w</span><span class="op" id="4931906">.</span><span class="ident" id="4931907">WriteByte</span><span class="op" id="4931916">(</span><span class="ident" id="4931917">b</span><span class="op" id="4931918">)</span><br>
<span class="lineno">250</span><span class="op" id="4931920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4931923">//&nbsp;emit&nbsp;emits&nbsp;the&nbsp;least&nbsp;significant&nbsp;nBits&nbsp;bits&nbsp;of&nbsp;bits&nbsp;to&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno"></span><span class="comment" id="4931997">//&nbsp;The&nbsp;precondition&nbsp;is&nbsp;bits&nbsp;&lt;&nbsp;1&lt;&lt;nBits&nbsp;&amp;&amp;&nbsp;nBits&nbsp;&lt;=&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="4932052">func</span>&nbsp;<span class="op" id="4932057">(</span><span class="ident" id="4932058">e</span>&nbsp;<span class="op" id="4932060">*</span><span class="ident" id="4932061">encoder</span><span class="op" id="4932068">)</span>&nbsp;<span class="ident" id="4932070">emit</span><span class="op" id="4932074">(</span><span class="ident" id="4932075">bits</span><span class="op" id="4932079">,</span>&nbsp;<span class="ident" id="4932081">nBits</span>&nbsp;<span class="builtintype" id="4932087">uint32</span><span class="op" id="4932093">)</span>&nbsp;<span class="op" id="4932095">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932098">nBits</span>&nbsp;<span class="op" id="4932104">+=</span>&nbsp;<span class="ident" id="4932107">e</span><span class="op" id="4932108">.</span><span class="ident" id="4932109">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932116">bits</span>&nbsp;<span class="op" id="4932121">&lt;&lt;=</span>&nbsp;<span class="num" id="4932125">32</span>&nbsp;<span class="op" id="4932128">-</span>&nbsp;<span class="ident" id="4932130">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932137">bits</span>&nbsp;<span class="op" id="4932142">|=</span>&nbsp;<span class="ident" id="4932145">e</span><span class="op" id="4932146">.</span><span class="ident" id="4932147">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4932153">for</span>&nbsp;<span class="ident" id="4932157">nBits</span>&nbsp;<span class="op" id="4932163">&gt;=</span>&nbsp;<span class="num" id="4932166">8</span>&nbsp;<span class="op" id="4932168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932172">b</span>&nbsp;<span class="op" id="4932174">:=</span>&nbsp;<span class="builtintype" id="4932177">uint8</span><span class="op" id="4932182">(</span><span class="ident" id="4932183">bits</span>&nbsp;<span class="op" id="4932188">&gt;&gt;</span>&nbsp;<span class="num" id="4932191">24</span><span class="op" id="4932193">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932197">e</span><span class="op" id="4932198">.</span><span class="ident" id="4932199">writeByte</span><span class="op" id="4932208">(</span><span class="ident" id="4932209">b</span><span class="op" id="4932210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4932214">if</span>&nbsp;<span class="ident" id="4932217">b</span>&nbsp;<span class="op" id="4932219">==</span>&nbsp;<span class="num" id="4932222">0xff</span>&nbsp;<span class="op" id="4932227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932232">e</span><span class="op" id="4932233">.</span><span class="ident" id="4932234">writeByte</span><span class="op" id="4932243">(</span><span class="num" id="4932244">0x00</span><span class="op" id="4932248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4932252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932256">bits</span>&nbsp;<span class="op" id="4932261">&lt;&lt;=</span>&nbsp;<span class="num" id="4932265">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932269">nBits</span>&nbsp;<span class="op" id="4932275">-=</span>&nbsp;<span class="num" id="4932278">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4932281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932284">e</span><span class="op" id="4932285">.</span><span class="ident" id="4932286">bits</span><span class="op" id="4932290">,</span>&nbsp;<span class="ident" id="4932292">e</span><span class="op" id="4932293">.</span><span class="ident" id="4932294">nBits</span>&nbsp;<span class="op" id="4932300">=</span>&nbsp;<span class="ident" id="4932302">bits</span><span class="op" id="4932306">,</span>&nbsp;<span class="ident" id="4932308">nBits</span><br>
<span class="lineno"></span><span class="op" id="4932314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4932317">//&nbsp;emitHuff&nbsp;emits&nbsp;the&nbsp;given&nbsp;value&nbsp;with&nbsp;the&nbsp;given&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="4932383">func</span>&nbsp;<span class="op" id="4932388">(</span><span class="ident" id="4932389">e</span>&nbsp;<span class="op" id="4932391">*</span><span class="ident" id="4932392">encoder</span><span class="op" id="4932399">)</span>&nbsp;<span class="ident" id="4932401">emitHuff</span><span class="op" id="4932409">(</span><span class="ident" id="4932410">h</span>&nbsp;<span class="ident" id="4932412">huffIndex</span><span class="op" id="4932421">,</span>&nbsp;<span class="ident" id="4932423">value</span>&nbsp;<span class="builtintype" id="4932429">int32</span><span class="op" id="4932434">)</span>&nbsp;<span class="op" id="4932436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932439">x</span>&nbsp;<span class="op" id="4932441">:=</span>&nbsp;<span class="ident" id="4932444">theHuffmanLUT</span><span class="op" id="4932457">[</span><span class="ident" id="4932458">h</span><span class="op" id="4932459">]</span><span class="op" id="4932460">[</span><span class="ident" id="4932461">value</span><span class="op" id="4932466">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932469">e</span><span class="op" id="4932470">.</span><span class="ident" id="4932471">emit</span><span class="op" id="4932475">(</span><span class="ident" id="4932476">x</span><span class="op" id="4932477">&amp;</span><span class="op" id="4932478">(</span><span class="num" id="4932479">1</span><span class="op" id="4932480">&lt;&lt;</span><span class="num" id="4932482">24</span><span class="op" id="4932484">-</span><span class="num" id="4932485">1</span><span class="op" id="4932486">)</span><span class="op" id="4932487">,</span>&nbsp;<span class="ident" id="4932489">x</span><span class="op" id="4932490">&gt;&gt;</span><span class="num" id="4932492">24</span><span class="op" id="4932494">)</span><br>
<span class="lineno"></span><span class="op" id="4932496">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="4932499">//&nbsp;emitHuffRLE&nbsp;emits&nbsp;a&nbsp;run&nbsp;of&nbsp;runLength&nbsp;copies&nbsp;of&nbsp;value&nbsp;encoded&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="4932578">//&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="4932598">func</span>&nbsp;<span class="op" id="4932603">(</span><span class="ident" id="4932604">e</span>&nbsp;<span class="op" id="4932606">*</span><span class="ident" id="4932607">encoder</span><span class="op" id="4932614">)</span>&nbsp;<span class="ident" id="4932616">emitHuffRLE</span><span class="op" id="4932627">(</span><span class="ident" id="4932628">h</span>&nbsp;<span class="ident" id="4932630">huffIndex</span><span class="op" id="4932639">,</span>&nbsp;<span class="ident" id="4932641">runLength</span><span class="op" id="4932650">,</span>&nbsp;<span class="ident" id="4932652">value</span>&nbsp;<span class="builtintype" id="4932658">int32</span><span class="op" id="4932663">)</span>&nbsp;<span class="op" id="4932665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932668">a</span><span class="op" id="4932669">,</span>&nbsp;<span class="ident" id="4932671">b</span>&nbsp;<span class="op" id="4932673">:=</span>&nbsp;<span class="ident" id="4932676">value</span><span class="op" id="4932681">,</span>&nbsp;<span class="ident" id="4932683">value</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4932690">if</span>&nbsp;<span class="ident" id="4932693">a</span>&nbsp;<span class="op" id="4932695">&lt;</span>&nbsp;<span class="num" id="4932697">0</span>&nbsp;<span class="op" id="4932699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932703">a</span><span class="op" id="4932704">,</span>&nbsp;<span class="ident" id="4932706">b</span>&nbsp;<span class="op" id="4932708">=</span>&nbsp;<span class="op" id="4932710">-</span><span class="ident" id="4932711">value</span><span class="op" id="4932716">,</span>&nbsp;<span class="ident" id="4932718">value</span><span class="op" id="4932723">-</span><span class="num" id="4932724">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4932727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4932730">var</span>&nbsp;<span class="ident" id="4932734">nBits</span>&nbsp;<span class="builtintype" id="4932740">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4932748">if</span>&nbsp;<span class="ident" id="4932751">a</span>&nbsp;<span class="op" id="4932753">&lt;</span>&nbsp;<span class="num" id="4932755">0x100</span>&nbsp;<span class="op" id="4932761">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932765">nBits</span>&nbsp;<span class="op" id="4932771">=</span>&nbsp;<span class="builtintype" id="4932773">uint32</span><span class="op" id="4932779">(</span><span class="ident" id="4932780">bitCount</span><span class="op" id="4932788">[</span><span class="ident" id="4932789">a</span><span class="op" id="4932790">]</span><span class="op" id="4932791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4932794">}</span>&nbsp;<span class="keyword" id="4932796">else</span>&nbsp;<span class="op" id="4932801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932805">nBits</span>&nbsp;<span class="op" id="4932811">=</span>&nbsp;<span class="num" id="4932813">8</span>&nbsp;<span class="op" id="4932815">+</span>&nbsp;<span class="builtintype" id="4932817">uint32</span><span class="op" id="4932823">(</span><span class="ident" id="4932824">bitCount</span><span class="op" id="4932832">[</span><span class="ident" id="4932833">a</span><span class="op" id="4932834">&gt;&gt;</span><span class="num" id="4932836">8</span><span class="op" id="4932837">]</span><span class="op" id="4932838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4932841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932844">e</span><span class="op" id="4932845">.</span><span class="ident" id="4932846">emitHuff</span><span class="op" id="4932854">(</span><span class="ident" id="4932855">h</span><span class="op" id="4932856">,</span>&nbsp;<span class="ident" id="4932858">runLength</span><span class="op" id="4932867">&lt;&lt;</span><span class="num" id="4932869">4</span><span class="op" id="4932870">|</span><span class="builtintype" id="4932871">int32</span><span class="op" id="4932876">(</span><span class="ident" id="4932877">nBits</span><span class="op" id="4932882">)</span><span class="op" id="4932883">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4932886">if</span>&nbsp;<span class="ident" id="4932889">nBits</span>&nbsp;<span class="op" id="4932895">&gt;</span>&nbsp;<span class="num" id="4932897">0</span>&nbsp;<span class="op" id="4932899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4932903">e</span><span class="op" id="4932904">.</span><span class="ident" id="4932905">emit</span><span class="op" id="4932909">(</span><span class="builtintype" id="4932910">uint32</span><span class="op" id="4932916">(</span><span class="ident" id="4932917">b</span><span class="op" id="4932918">)</span><span class="op" id="4932919">&amp;</span><span class="op" id="4932920">(</span><span class="num" id="4932921">1</span><span class="op" id="4932922">&lt;&lt;</span><span class="ident" id="4932924">nBits</span><span class="op" id="4932929">-</span><span class="num" id="4932930">1</span><span class="op" id="4932931">)</span><span class="op" id="4932932">,</span>&nbsp;<span class="ident" id="4932934">nBits</span><span class="op" id="4932939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4932942">}</span><br>
<span class="lineno"></span><span class="op" id="4932944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="4932947">//&nbsp;writeMarkerHeader&nbsp;writes&nbsp;the&nbsp;header&nbsp;for&nbsp;a&nbsp;marker&nbsp;with&nbsp;the&nbsp;given&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4933022">func</span>&nbsp;<span class="op" id="4933027">(</span><span class="ident" id="4933028">e</span>&nbsp;<span class="op" id="4933030">*</span><span class="ident" id="4933031">encoder</span><span class="op" id="4933038">)</span>&nbsp;<span class="ident" id="4933040">writeMarkerHeader</span><span class="op" id="4933057">(</span><span class="ident" id="4933058">marker</span>&nbsp;<span class="builtintype" id="4933065">uint8</span><span class="op" id="4933070">,</span>&nbsp;<span class="ident" id="4933072">markerlen</span>&nbsp;<span class="builtintype" id="4933082">int</span><span class="op" id="4933085">)</span>&nbsp;<span class="op" id="4933087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933090">e</span><span class="op" id="4933091">.</span><span class="ident" id="4933092">buf</span><span class="op" id="4933095">[</span><span class="num" id="4933096">0</span><span class="op" id="4933097">]</span>&nbsp;<span class="op" id="4933099">=</span>&nbsp;<span class="num" id="4933101">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933107">e</span><span class="op" id="4933108">.</span><span class="ident" id="4933109">buf</span><span class="op" id="4933112">[</span><span class="num" id="4933113">1</span><span class="op" id="4933114">]</span>&nbsp;<span class="op" id="4933116">=</span>&nbsp;<span class="ident" id="4933118">marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933126">e</span><span class="op" id="4933127">.</span><span class="ident" id="4933128">buf</span><span class="op" id="4933131">[</span><span class="num" id="4933132">2</span><span class="op" id="4933133">]</span>&nbsp;<span class="op" id="4933135">=</span>&nbsp;<span class="builtintype" id="4933137">uint8</span><span class="op" id="4933142">(</span><span class="ident" id="4933143">markerlen</span>&nbsp;<span class="op" id="4933153">&gt;&gt;</span>&nbsp;<span class="num" id="4933156">8</span><span class="op" id="4933157">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933160">e</span><span class="op" id="4933161">.</span><span class="ident" id="4933162">buf</span><span class="op" id="4933165">[</span><span class="num" id="4933166">3</span><span class="op" id="4933167">]</span>&nbsp;<span class="op" id="4933169">=</span>&nbsp;<span class="builtintype" id="4933171">uint8</span><span class="op" id="4933176">(</span><span class="ident" id="4933177">markerlen</span>&nbsp;<span class="op" id="4933187">&amp;</span>&nbsp;<span class="num" id="4933189">0xff</span><span class="op" id="4933193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933196">e</span><span class="op" id="4933197">.</span><span class="ident" id="4933198">write</span><span class="op" id="4933203">(</span><span class="ident" id="4933204">e</span><span class="op" id="4933205">.</span><span class="ident" id="4933206">buf</span><span class="op" id="4933209">[</span><span class="op" id="4933210">:</span><span class="num" id="4933211">4</span><span class="op" id="4933212">]</span><span class="op" id="4933213">)</span><br>
<span class="lineno"></span><span class="op" id="4933215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4933218">//&nbsp;writeDQT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Quantization&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno">305</span><span class="keyword" id="4933275">func</span>&nbsp;<span class="op" id="4933280">(</span><span class="ident" id="4933281">e</span>&nbsp;<span class="op" id="4933283">*</span><span class="ident" id="4933284">encoder</span><span class="op" id="4933291">)</span>&nbsp;<span class="ident" id="4933293">writeDQT</span><span class="op" id="4933301">(</span><span class="op" id="4933302">)</span>&nbsp;<span class="op" id="4933304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4933307">const</span>&nbsp;<span class="ident" id="4933313">markerlen</span>&nbsp;<span class="op" id="4933323">=</span>&nbsp;<span class="num" id="4933325">2</span>&nbsp;<span class="op" id="4933327">+</span>&nbsp;<span class="builtintype" id="4933329">int</span><span class="op" id="4933332">(</span><span class="ident" id="4933333">nQuantIndex</span><span class="op" id="4933344">)</span><span class="op" id="4933345">*</span><span class="op" id="4933346">(</span><span class="num" id="4933347">1</span><span class="op" id="4933348">+</span><span class="ident" id="4933349">blockSize</span><span class="op" id="4933358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933361">e</span><span class="op" id="4933362">.</span><span class="ident" id="4933363">writeMarkerHeader</span><span class="op" id="4933380">(</span><span class="ident" id="4933381">dqtMarker</span><span class="op" id="4933390">,</span>&nbsp;<span class="ident" id="4933392">markerlen</span><span class="op" id="4933401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4933404">for</span>&nbsp;<span class="ident" id="4933408">i</span>&nbsp;<span class="op" id="4933410">:=</span>&nbsp;<span class="keyword" id="4933413">range</span>&nbsp;<span class="ident" id="4933419">e</span><span class="op" id="4933420">.</span><span class="ident" id="4933421">quant</span>&nbsp;<span class="op" id="4933427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933431">e</span><span class="op" id="4933432">.</span><span class="ident" id="4933433">writeByte</span><span class="op" id="4933442">(</span><span class="builtintype" id="4933443">uint8</span><span class="op" id="4933448">(</span><span class="ident" id="4933449">i</span><span class="op" id="4933450">)</span><span class="op" id="4933451">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933455">e</span><span class="op" id="4933456">.</span><span class="ident" id="4933457">write</span><span class="op" id="4933462">(</span><span class="ident" id="4933463">e</span><span class="op" id="4933464">.</span><span class="ident" id="4933465">quant</span><span class="op" id="4933470">[</span><span class="ident" id="4933471">i</span><span class="op" id="4933472">]</span><span class="op" id="4933473">[</span><span class="op" id="4933474">:</span><span class="op" id="4933475">]</span><span class="op" id="4933476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4933479">}</span><br>
<span class="lineno"></span><span class="op" id="4933481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4933484">//&nbsp;writeSOF0&nbsp;writes&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline)&nbsp;marker.</span><br>
<span class="lineno">315</span><span class="keyword" id="4933542">func</span>&nbsp;<span class="op" id="4933547">(</span><span class="ident" id="4933548">e</span>&nbsp;<span class="op" id="4933550">*</span><span class="ident" id="4933551">encoder</span><span class="op" id="4933558">)</span>&nbsp;<span class="ident" id="4933560">writeSOF0</span><span class="op" id="4933569">(</span><span class="ident" id="4933570">size</span>&nbsp;<span class="ident" id="4933575">image</span><span class="op" id="4933580">.</span><span class="ident" id="4933581">Point</span><span class="op" id="4933586">,</span>&nbsp;<span class="ident" id="4933588">nComponent</span>&nbsp;<span class="builtintype" id="4933599">int</span><span class="op" id="4933602">)</span>&nbsp;<span class="op" id="4933604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933607">markerlen</span>&nbsp;<span class="op" id="4933617">:=</span>&nbsp;<span class="num" id="4933620">8</span>&nbsp;<span class="op" id="4933622">+</span>&nbsp;<span class="num" id="4933624">3</span><span class="op" id="4933625">*</span><span class="ident" id="4933626">nComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933638">e</span><span class="op" id="4933639">.</span><span class="ident" id="4933640">writeMarkerHeader</span><span class="op" id="4933657">(</span><span class="ident" id="4933658">sof0Marker</span><span class="op" id="4933668">,</span>&nbsp;<span class="ident" id="4933670">markerlen</span><span class="op" id="4933679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933682">e</span><span class="op" id="4933683">.</span><span class="ident" id="4933684">buf</span><span class="op" id="4933687">[</span><span class="num" id="4933688">0</span><span class="op" id="4933689">]</span>&nbsp;<span class="op" id="4933691">=</span>&nbsp;<span class="num" id="4933693">8</span>&nbsp;<span class="comment" id="4933695">//&nbsp;8-bit&nbsp;color.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933712">e</span><span class="op" id="4933713">.</span><span class="ident" id="4933714">buf</span><span class="op" id="4933717">[</span><span class="num" id="4933718">1</span><span class="op" id="4933719">]</span>&nbsp;<span class="op" id="4933721">=</span>&nbsp;<span class="builtintype" id="4933723">uint8</span><span class="op" id="4933728">(</span><span class="ident" id="4933729">size</span><span class="op" id="4933733">.</span><span class="ident" id="4933734">Y</span>&nbsp;<span class="op" id="4933736">&gt;&gt;</span>&nbsp;<span class="num" id="4933739">8</span><span class="op" id="4933740">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933743">e</span><span class="op" id="4933744">.</span><span class="ident" id="4933745">buf</span><span class="op" id="4933748">[</span><span class="num" id="4933749">2</span><span class="op" id="4933750">]</span>&nbsp;<span class="op" id="4933752">=</span>&nbsp;<span class="builtintype" id="4933754">uint8</span><span class="op" id="4933759">(</span><span class="ident" id="4933760">size</span><span class="op" id="4933764">.</span><span class="ident" id="4933765">Y</span>&nbsp;<span class="op" id="4933767">&amp;</span>&nbsp;<span class="num" id="4933769">0xff</span><span class="op" id="4933773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933776">e</span><span class="op" id="4933777">.</span><span class="ident" id="4933778">buf</span><span class="op" id="4933781">[</span><span class="num" id="4933782">3</span><span class="op" id="4933783">]</span>&nbsp;<span class="op" id="4933785">=</span>&nbsp;<span class="builtintype" id="4933787">uint8</span><span class="op" id="4933792">(</span><span class="ident" id="4933793">size</span><span class="op" id="4933797">.</span><span class="ident" id="4933798">X</span>&nbsp;<span class="op" id="4933800">&gt;&gt;</span>&nbsp;<span class="num" id="4933803">8</span><span class="op" id="4933804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933807">e</span><span class="op" id="4933808">.</span><span class="ident" id="4933809">buf</span><span class="op" id="4933812">[</span><span class="num" id="4933813">4</span><span class="op" id="4933814">]</span>&nbsp;<span class="op" id="4933816">=</span>&nbsp;<span class="builtintype" id="4933818">uint8</span><span class="op" id="4933823">(</span><span class="ident" id="4933824">size</span><span class="op" id="4933828">.</span><span class="ident" id="4933829">X</span>&nbsp;<span class="op" id="4933831">&amp;</span>&nbsp;<span class="num" id="4933833">0xff</span><span class="op" id="4933837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933840">e</span><span class="op" id="4933841">.</span><span class="ident" id="4933842">buf</span><span class="op" id="4933845">[</span><span class="num" id="4933846">5</span><span class="op" id="4933847">]</span>&nbsp;<span class="op" id="4933849">=</span>&nbsp;<span class="builtintype" id="4933851">uint8</span><span class="op" id="4933856">(</span><span class="ident" id="4933857">nComponent</span><span class="op" id="4933867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4933870">if</span>&nbsp;<span class="ident" id="4933873">nComponent</span>&nbsp;<span class="op" id="4933884">==</span>&nbsp;<span class="num" id="4933887">1</span>&nbsp;<span class="op" id="4933889">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933893">e</span><span class="op" id="4933894">.</span><span class="ident" id="4933895">buf</span><span class="op" id="4933898">[</span><span class="num" id="4933899">6</span><span class="op" id="4933900">]</span>&nbsp;<span class="op" id="4933902">=</span>&nbsp;<span class="num" id="4933904">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4933908">//&nbsp;No&nbsp;subsampling&nbsp;for&nbsp;grayscale&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933949">e</span><span class="op" id="4933950">.</span><span class="ident" id="4933951">buf</span><span class="op" id="4933954">[</span><span class="num" id="4933955">7</span><span class="op" id="4933956">]</span>&nbsp;<span class="op" id="4933958">=</span>&nbsp;<span class="num" id="4933960">0x11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4933967">e</span><span class="op" id="4933968">.</span><span class="ident" id="4933969">buf</span><span class="op" id="4933972">[</span><span class="num" id="4933973">8</span><span class="op" id="4933974">]</span>&nbsp;<span class="op" id="4933976">=</span>&nbsp;<span class="num" id="4933978">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4933984">}</span>&nbsp;<span class="keyword" id="4933986">else</span>&nbsp;<span class="op" id="4933991">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4933995">for</span>&nbsp;<span class="ident" id="4933999">i</span>&nbsp;<span class="op" id="4934001">:=</span>&nbsp;<span class="num" id="4934004">0</span><span class="op" id="4934005">;</span>&nbsp;<span class="ident" id="4934007">i</span>&nbsp;<span class="op" id="4934009">&lt;</span>&nbsp;<span class="ident" id="4934011">nComponent</span><span class="op" id="4934021">;</span>&nbsp;<span class="ident" id="4934023">i</span><span class="op" id="4934024">++</span>&nbsp;<span class="op" id="4934027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934032">e</span><span class="op" id="4934033">.</span><span class="ident" id="4934034">buf</span><span class="op" id="4934037">[</span><span class="num" id="4934038">3</span><span class="op" id="4934039">*</span><span class="ident" id="4934040">i</span><span class="op" id="4934041">+</span><span class="num" id="4934042">6</span><span class="op" id="4934043">]</span>&nbsp;<span class="op" id="4934045">=</span>&nbsp;<span class="builtintype" id="4934047">uint8</span><span class="op" id="4934052">(</span><span class="ident" id="4934053">i</span>&nbsp;<span class="op" id="4934055">+</span>&nbsp;<span class="num" id="4934057">1</span><span class="op" id="4934058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4934063">//&nbsp;We&nbsp;use&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934102">e</span><span class="op" id="4934103">.</span><span class="ident" id="4934104">buf</span><span class="op" id="4934107">[</span><span class="num" id="4934108">3</span><span class="op" id="4934109">*</span><span class="ident" id="4934110">i</span><span class="op" id="4934111">+</span><span class="num" id="4934112">7</span><span class="op" id="4934113">]</span>&nbsp;<span class="op" id="4934115">=</span>&nbsp;<span class="string" id="4934117">&#34;\x22\x11\x11&#34;</span><span class="op" id="4934131">[</span><span class="ident" id="4934132">i</span><span class="op" id="4934133">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934138">e</span><span class="op" id="4934139">.</span><span class="ident" id="4934140">buf</span><span class="op" id="4934143">[</span><span class="num" id="4934144">3</span><span class="op" id="4934145">*</span><span class="ident" id="4934146">i</span><span class="op" id="4934147">+</span><span class="num" id="4934148">8</span><span class="op" id="4934149">]</span>&nbsp;<span class="op" id="4934151">=</span>&nbsp;<span class="string" id="4934153">&#34;\x00\x01\x01&#34;</span><span class="op" id="4934167">[</span><span class="ident" id="4934168">i</span><span class="op" id="4934169">]</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4934173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4934176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934179">e</span><span class="op" id="4934180">.</span><span class="ident" id="4934181">write</span><span class="op" id="4934186">(</span><span class="ident" id="4934187">e</span><span class="op" id="4934188">.</span><span class="ident" id="4934189">buf</span><span class="op" id="4934192">[</span><span class="op" id="4934193">:</span><span class="num" id="4934194">3</span><span class="op" id="4934195">*</span><span class="op" id="4934196">(</span><span class="ident" id="4934197">nComponent</span><span class="op" id="4934207">-</span><span class="num" id="4934208">1</span><span class="op" id="4934209">)</span><span class="op" id="4934210">+</span><span class="num" id="4934211">9</span><span class="op" id="4934212">]</span><span class="op" id="4934213">)</span><br>
<span class="lineno"></span><span class="op" id="4934215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="4934218">//&nbsp;writeDHT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno"></span><span class="keyword" id="4934270">func</span>&nbsp;<span class="op" id="4934275">(</span><span class="ident" id="4934276">e</span>&nbsp;<span class="op" id="4934278">*</span><span class="ident" id="4934279">encoder</span><span class="op" id="4934286">)</span>&nbsp;<span class="ident" id="4934288">writeDHT</span><span class="op" id="4934296">(</span><span class="ident" id="4934297">nComponent</span>&nbsp;<span class="builtintype" id="4934308">int</span><span class="op" id="4934311">)</span>&nbsp;<span class="op" id="4934313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934316">markerlen</span>&nbsp;<span class="op" id="4934326">:=</span>&nbsp;<span class="num" id="4934329">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934332">specs</span>&nbsp;<span class="op" id="4934338">:=</span>&nbsp;<span class="ident" id="4934341">theHuffmanSpec</span><span class="op" id="4934355">[</span><span class="op" id="4934356">:</span><span class="op" id="4934357">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4934360">if</span>&nbsp;<span class="ident" id="4934363">nComponent</span>&nbsp;<span class="op" id="4934374">==</span>&nbsp;<span class="num" id="4934377">1</span>&nbsp;<span class="op" id="4934379">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4934383">//&nbsp;Drop&nbsp;the&nbsp;Chrominance&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934417">specs</span>&nbsp;<span class="op" id="4934423">=</span>&nbsp;<span class="ident" id="4934425">specs</span><span class="op" id="4934430">[</span><span class="op" id="4934431">:</span><span class="num" id="4934432">2</span><span class="op" id="4934433">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4934436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4934439">for</span>&nbsp;<span class="ident" id="4934443">_</span><span class="op" id="4934444">,</span>&nbsp;<span class="ident" id="4934446">s</span>&nbsp;<span class="op" id="4934448">:=</span>&nbsp;<span class="keyword" id="4934451">range</span>&nbsp;<span class="ident" id="4934457">specs</span>&nbsp;<span class="op" id="4934463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934467">markerlen</span>&nbsp;<span class="op" id="4934477">+=</span>&nbsp;<span class="num" id="4934480">1</span>&nbsp;<span class="op" id="4934482">+</span>&nbsp;<span class="num" id="4934484">16</span>&nbsp;<span class="op" id="4934487">+</span>&nbsp;<span class="builtinfunc" id="4934489">len</span><span class="op" id="4934492">(</span><span class="ident" id="4934493">s</span><span class="op" id="4934494">.</span><span class="ident" id="4934495">value</span><span class="op" id="4934500">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4934503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934506">e</span><span class="op" id="4934507">.</span><span class="ident" id="4934508">writeMarkerHeader</span><span class="op" id="4934525">(</span><span class="ident" id="4934526">dhtMarker</span><span class="op" id="4934535">,</span>&nbsp;<span class="ident" id="4934537">markerlen</span><span class="op" id="4934546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4934549">for</span>&nbsp;<span class="ident" id="4934553">i</span><span class="op" id="4934554">,</span>&nbsp;<span class="ident" id="4934556">s</span>&nbsp;<span class="op" id="4934558">:=</span>&nbsp;<span class="keyword" id="4934561">range</span>&nbsp;<span class="ident" id="4934567">specs</span>&nbsp;<span class="op" id="4934573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934577">e</span><span class="op" id="4934578">.</span><span class="ident" id="4934579">writeByte</span><span class="op" id="4934588">(</span><span class="string" id="4934589">&#34;\x00\x10\x01\x11&#34;</span><span class="op" id="4934607">[</span><span class="ident" id="4934608">i</span><span class="op" id="4934609">]</span><span class="op" id="4934610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934614">e</span><span class="op" id="4934615">.</span><span class="ident" id="4934616">write</span><span class="op" id="4934621">(</span><span class="ident" id="4934622">s</span><span class="op" id="4934623">.</span><span class="ident" id="4934624">count</span><span class="op" id="4934629">[</span><span class="op" id="4934630">:</span><span class="op" id="4934631">]</span><span class="op" id="4934632">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934636">e</span><span class="op" id="4934637">.</span><span class="ident" id="4934638">write</span><span class="op" id="4934643">(</span><span class="ident" id="4934644">s</span><span class="op" id="4934645">.</span><span class="ident" id="4934646">value</span><span class="op" id="4934651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4934654">}</span><br>
<span class="lineno"></span><span class="op" id="4934656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4934659">//&nbsp;writeBlock&nbsp;writes&nbsp;a&nbsp;block&nbsp;of&nbsp;pixel&nbsp;data&nbsp;using&nbsp;the&nbsp;given&nbsp;quantization&nbsp;table,</span><br>
<span class="lineno">360</span><span class="comment" id="4934738">//&nbsp;returning&nbsp;the&nbsp;post-quantized&nbsp;DC&nbsp;value&nbsp;of&nbsp;the&nbsp;DCT-transformed&nbsp;block.&nbsp;b&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4934817">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="4934849">func</span>&nbsp;<span class="op" id="4934854">(</span><span class="ident" id="4934855">e</span>&nbsp;<span class="op" id="4934857">*</span><span class="ident" id="4934858">encoder</span><span class="op" id="4934865">)</span>&nbsp;<span class="ident" id="4934867">writeBlock</span><span class="op" id="4934877">(</span><span class="ident" id="4934878">b</span>&nbsp;<span class="op" id="4934880">*</span><span class="ident" id="4934881">block</span><span class="op" id="4934886">,</span>&nbsp;<span class="ident" id="4934888">q</span>&nbsp;<span class="ident" id="4934890">quantIndex</span><span class="op" id="4934900">,</span>&nbsp;<span class="ident" id="4934902">prevDC</span>&nbsp;<span class="builtintype" id="4934909">int32</span><span class="op" id="4934914">)</span>&nbsp;<span class="builtintype" id="4934916">int32</span>&nbsp;<span class="op" id="4934922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934925">fdct</span><span class="op" id="4934929">(</span><span class="ident" id="4934930">b</span><span class="op" id="4934931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4934934">//&nbsp;Emit&nbsp;the&nbsp;DC&nbsp;delta.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934957">dc</span>&nbsp;<span class="op" id="4934960">:=</span>&nbsp;<span class="ident" id="4934963">div</span><span class="op" id="4934966">(</span><span class="ident" id="4934967">b</span><span class="op" id="4934968">[</span><span class="num" id="4934969">0</span><span class="op" id="4934970">]</span><span class="op" id="4934971">,</span>&nbsp;<span class="num" id="4934973">8</span><span class="op" id="4934974">*</span><span class="builtintype" id="4934975">int32</span><span class="op" id="4934980">(</span><span class="ident" id="4934981">e</span><span class="op" id="4934982">.</span><span class="ident" id="4934983">quant</span><span class="op" id="4934988">[</span><span class="ident" id="4934989">q</span><span class="op" id="4934990">]</span><span class="op" id="4934991">[</span><span class="num" id="4934992">0</span><span class="op" id="4934993">]</span><span class="op" id="4934994">)</span><span class="op" id="4934995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4934998">e</span><span class="op" id="4934999">.</span><span class="ident" id="4935000">emitHuffRLE</span><span class="op" id="4935011">(</span><span class="ident" id="4935012">huffIndex</span><span class="op" id="4935021">(</span><span class="num" id="4935022">2</span><span class="op" id="4935023">*</span><span class="ident" id="4935024">q</span><span class="op" id="4935025">+</span><span class="num" id="4935026">0</span><span class="op" id="4935027">)</span><span class="op" id="4935028">,</span>&nbsp;<span class="num" id="4935030">0</span><span class="op" id="4935031">,</span>&nbsp;<span class="ident" id="4935033">dc</span><span class="op" id="4935035">-</span><span class="ident" id="4935036">prevDC</span><span class="op" id="4935042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4935045">//&nbsp;Emit&nbsp;the&nbsp;AC&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935073">h</span><span class="op" id="4935074">,</span>&nbsp;<span class="ident" id="4935076">runLength</span>&nbsp;<span class="op" id="4935086">:=</span>&nbsp;<span class="ident" id="4935089">huffIndex</span><span class="op" id="4935098">(</span><span class="num" id="4935099">2</span><span class="op" id="4935100">*</span><span class="ident" id="4935101">q</span><span class="op" id="4935102">+</span><span class="num" id="4935103">1</span><span class="op" id="4935104">)</span><span class="op" id="4935105">,</span>&nbsp;<span class="builtintype" id="4935107">int32</span><span class="op" id="4935112">(</span><span class="num" id="4935113">0</span><span class="op" id="4935114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4935117">for</span>&nbsp;<span class="ident" id="4935121">zig</span>&nbsp;<span class="op" id="4935125">:=</span>&nbsp;<span class="num" id="4935128">1</span><span class="op" id="4935129">;</span>&nbsp;<span class="ident" id="4935131">zig</span>&nbsp;<span class="op" id="4935135">&lt;</span>&nbsp;<span class="ident" id="4935137">blockSize</span><span class="op" id="4935146">;</span>&nbsp;<span class="ident" id="4935148">zig</span><span class="op" id="4935151">++</span>&nbsp;<span class="op" id="4935154">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935158">ac</span>&nbsp;<span class="op" id="4935161">:=</span>&nbsp;<span class="ident" id="4935164">div</span><span class="op" id="4935167">(</span><span class="ident" id="4935168">b</span><span class="op" id="4935169">[</span><span class="ident" id="4935170">unzig</span><span class="op" id="4935175">[</span><span class="ident" id="4935176">zig</span><span class="op" id="4935179">]</span><span class="op" id="4935180">]</span><span class="op" id="4935181">,</span>&nbsp;<span class="num" id="4935183">8</span><span class="op" id="4935184">*</span><span class="builtintype" id="4935185">int32</span><span class="op" id="4935190">(</span><span class="ident" id="4935191">e</span><span class="op" id="4935192">.</span><span class="ident" id="4935193">quant</span><span class="op" id="4935198">[</span><span class="ident" id="4935199">q</span><span class="op" id="4935200">]</span><span class="op" id="4935201">[</span><span class="ident" id="4935202">zig</span><span class="op" id="4935205">]</span><span class="op" id="4935206">)</span><span class="op" id="4935207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4935211">if</span>&nbsp;<span class="ident" id="4935214">ac</span>&nbsp;<span class="op" id="4935217">==</span>&nbsp;<span class="num" id="4935220">0</span>&nbsp;<span class="op" id="4935222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935227">runLength</span><span class="op" id="4935236">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4935241">}</span>&nbsp;<span class="keyword" id="4935243">else</span>&nbsp;<span class="op" id="4935248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4935253">for</span>&nbsp;<span class="ident" id="4935257">runLength</span>&nbsp;<span class="op" id="4935267">&gt;</span>&nbsp;<span class="num" id="4935269">15</span>&nbsp;<span class="op" id="4935272">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935278">e</span><span class="op" id="4935279">.</span><span class="ident" id="4935280">emitHuff</span><span class="op" id="4935288">(</span><span class="ident" id="4935289">h</span><span class="op" id="4935290">,</span>&nbsp;<span class="num" id="4935292">0xf0</span><span class="op" id="4935296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935302">runLength</span>&nbsp;<span class="op" id="4935312">-=</span>&nbsp;<span class="num" id="4935315">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4935321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935326">e</span><span class="op" id="4935327">.</span><span class="ident" id="4935328">emitHuffRLE</span><span class="op" id="4935339">(</span><span class="ident" id="4935340">h</span><span class="op" id="4935341">,</span>&nbsp;<span class="ident" id="4935343">runLength</span><span class="op" id="4935352">,</span>&nbsp;<span class="ident" id="4935354">ac</span><span class="op" id="4935356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935361">runLength</span>&nbsp;<span class="op" id="4935371">=</span>&nbsp;<span class="num" id="4935373">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4935377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4935380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4935383">if</span>&nbsp;<span class="ident" id="4935386">runLength</span>&nbsp;<span class="op" id="4935396">&gt;</span>&nbsp;<span class="num" id="4935398">0</span>&nbsp;<span class="op" id="4935400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935404">e</span><span class="op" id="4935405">.</span><span class="ident" id="4935406">emitHuff</span><span class="op" id="4935414">(</span><span class="ident" id="4935415">h</span><span class="op" id="4935416">,</span>&nbsp;<span class="num" id="4935418">0x00</span><span class="op" id="4935422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4935425">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4935428">return</span>&nbsp;<span class="ident" id="4935435">dc</span><br>
<span class="lineno"></span><span class="op" id="4935438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4935441">//&nbsp;toYCbCr&nbsp;converts&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4935515">//&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno">390</span><span class="keyword" id="4935532">func</span>&nbsp;<span class="ident" id="4935537">toYCbCr</span><span class="op" id="4935544">(</span><span class="ident" id="4935545">m</span>&nbsp;<span class="ident" id="4935547">image</span><span class="op" id="4935552">.</span><span class="ident" id="4935553">Image</span><span class="op" id="4935558">,</span>&nbsp;<span class="ident" id="4935560">p</span>&nbsp;<span class="ident" id="4935562">image</span><span class="op" id="4935567">.</span><span class="ident" id="4935568">Point</span><span class="op" id="4935573">,</span>&nbsp;<span class="ident" id="4935575">yBlock</span><span class="op" id="4935581">,</span>&nbsp;<span class="ident" id="4935583">cbBlock</span><span class="op" id="4935590">,</span>&nbsp;<span class="ident" id="4935592">crBlock</span>&nbsp;<span class="op" id="4935600">*</span><span class="ident" id="4935601">block</span><span class="op" id="4935606">)</span>&nbsp;<span class="op" id="4935608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935611">b</span>&nbsp;<span class="op" id="4935613">:=</span>&nbsp;<span class="ident" id="4935616">m</span><span class="op" id="4935617">.</span><span class="ident" id="4935618">Bounds</span><span class="op" id="4935624">(</span><span class="op" id="4935625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935628">xmax</span>&nbsp;<span class="op" id="4935633">:=</span>&nbsp;<span class="ident" id="4935636">b</span><span class="op" id="4935637">.</span><span class="ident" id="4935638">Max</span><span class="op" id="4935641">.</span><span class="ident" id="4935642">X</span>&nbsp;<span class="op" id="4935644">-</span>&nbsp;<span class="num" id="4935646">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935649">ymax</span>&nbsp;<span class="op" id="4935654">:=</span>&nbsp;<span class="ident" id="4935657">b</span><span class="op" id="4935658">.</span><span class="ident" id="4935659">Max</span><span class="op" id="4935662">.</span><span class="ident" id="4935663">Y</span>&nbsp;<span class="op" id="4935665">-</span>&nbsp;<span class="num" id="4935667">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4935670">for</span>&nbsp;<span class="ident" id="4935674">j</span>&nbsp;<span class="op" id="4935676">:=</span>&nbsp;<span class="num" id="4935679">0</span><span class="op" id="4935680">;</span>&nbsp;<span class="ident" id="4935682">j</span>&nbsp;<span class="op" id="4935684">&lt;</span>&nbsp;<span class="num" id="4935686">8</span><span class="op" id="4935687">;</span>&nbsp;<span class="ident" id="4935689">j</span><span class="op" id="4935690">++</span>&nbsp;<span class="op" id="4935693">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4935697">for</span>&nbsp;<span class="ident" id="4935701">i</span>&nbsp;<span class="op" id="4935703">:=</span>&nbsp;<span class="num" id="4935706">0</span><span class="op" id="4935707">;</span>&nbsp;<span class="ident" id="4935709">i</span>&nbsp;<span class="op" id="4935711">&lt;</span>&nbsp;<span class="num" id="4935713">8</span><span class="op" id="4935714">;</span>&nbsp;<span class="ident" id="4935716">i</span><span class="op" id="4935717">++</span>&nbsp;<span class="op" id="4935720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935725">r</span><span class="op" id="4935726">,</span>&nbsp;<span class="ident" id="4935728">g</span><span class="op" id="4935729">,</span>&nbsp;<span class="ident" id="4935731">b</span><span class="op" id="4935732">,</span>&nbsp;<span class="ident" id="4935734">_</span>&nbsp;<span class="op" id="4935736">:=</span>&nbsp;<span class="ident" id="4935739">m</span><span class="op" id="4935740">.</span><span class="ident" id="4935741">At</span><span class="op" id="4935743">(</span><span class="ident" id="4935744">min</span><span class="op" id="4935747">(</span><span class="ident" id="4935748">p</span><span class="op" id="4935749">.</span><span class="ident" id="4935750">X</span><span class="op" id="4935751">+</span><span class="ident" id="4935752">i</span><span class="op" id="4935753">,</span>&nbsp;<span class="ident" id="4935755">xmax</span><span class="op" id="4935759">)</span><span class="op" id="4935760">,</span>&nbsp;<span class="ident" id="4935762">min</span><span class="op" id="4935765">(</span><span class="ident" id="4935766">p</span><span class="op" id="4935767">.</span><span class="ident" id="4935768">Y</span><span class="op" id="4935769">+</span><span class="ident" id="4935770">j</span><span class="op" id="4935771">,</span>&nbsp;<span class="ident" id="4935773">ymax</span><span class="op" id="4935777">)</span><span class="op" id="4935778">)</span><span class="op" id="4935779">.</span><span class="ident" id="4935780">RGBA</span><span class="op" id="4935784">(</span><span class="op" id="4935785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935790">yy</span><span class="op" id="4935792">,</span>&nbsp;<span class="ident" id="4935794">cb</span><span class="op" id="4935796">,</span>&nbsp;<span class="ident" id="4935798">cr</span>&nbsp;<span class="op" id="4935801">:=</span>&nbsp;<span class="ident" id="4935804">color</span><span class="op" id="4935809">.</span><span class="ident" id="4935810">RGBToYCbCr</span><span class="op" id="4935820">(</span><span class="builtintype" id="4935821">uint8</span><span class="op" id="4935826">(</span><span class="ident" id="4935827">r</span><span class="op" id="4935828">&gt;&gt;</span><span class="num" id="4935830">8</span><span class="op" id="4935831">)</span><span class="op" id="4935832">,</span>&nbsp;<span class="builtintype" id="4935834">uint8</span><span class="op" id="4935839">(</span><span class="ident" id="4935840">g</span><span class="op" id="4935841">&gt;&gt;</span><span class="num" id="4935843">8</span><span class="op" id="4935844">)</span><span class="op" id="4935845">,</span>&nbsp;<span class="builtintype" id="4935847">uint8</span><span class="op" id="4935852">(</span><span class="ident" id="4935853">b</span><span class="op" id="4935854">&gt;&gt;</span><span class="num" id="4935856">8</span><span class="op" id="4935857">)</span><span class="op" id="4935858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935863">yBlock</span><span class="op" id="4935869">[</span><span class="num" id="4935870">8</span><span class="op" id="4935871">*</span><span class="ident" id="4935872">j</span><span class="op" id="4935873">+</span><span class="ident" id="4935874">i</span><span class="op" id="4935875">]</span>&nbsp;<span class="op" id="4935877">=</span>&nbsp;<span class="builtintype" id="4935879">int32</span><span class="op" id="4935884">(</span><span class="ident" id="4935885">yy</span><span class="op" id="4935887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935892">cbBlock</span><span class="op" id="4935899">[</span><span class="num" id="4935900">8</span><span class="op" id="4935901">*</span><span class="ident" id="4935902">j</span><span class="op" id="4935903">+</span><span class="ident" id="4935904">i</span><span class="op" id="4935905">]</span>&nbsp;<span class="op" id="4935907">=</span>&nbsp;<span class="builtintype" id="4935909">int32</span><span class="op" id="4935914">(</span><span class="ident" id="4935915">cb</span><span class="op" id="4935917">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4935922">crBlock</span><span class="op" id="4935929">[</span><span class="num" id="4935930">8</span><span class="op" id="4935931">*</span><span class="ident" id="4935932">j</span><span class="op" id="4935933">+</span><span class="ident" id="4935934">i</span><span class="op" id="4935935">]</span>&nbsp;<span class="op" id="4935937">=</span>&nbsp;<span class="builtintype" id="4935939">int32</span><span class="op" id="4935944">(</span><span class="ident" id="4935945">cr</span><span class="op" id="4935947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4935951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4935954">}</span><br>
<span class="lineno"></span><span class="op" id="4935956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="4935959">//&nbsp;grayToY&nbsp;stores&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;in&nbsp;yBlock.</span><br>
<span class="lineno"></span><span class="keyword" id="4936035">func</span>&nbsp;<span class="ident" id="4936040">grayToY</span><span class="op" id="4936047">(</span><span class="ident" id="4936048">m</span>&nbsp;<span class="op" id="4936050">*</span><span class="ident" id="4936051">image</span><span class="op" id="4936056">.</span><span class="ident" id="4936057">Gray</span><span class="op" id="4936061">,</span>&nbsp;<span class="ident" id="4936063">p</span>&nbsp;<span class="ident" id="4936065">image</span><span class="op" id="4936070">.</span><span class="ident" id="4936071">Point</span><span class="op" id="4936076">,</span>&nbsp;<span class="ident" id="4936078">yBlock</span>&nbsp;<span class="op" id="4936085">*</span><span class="ident" id="4936086">block</span><span class="op" id="4936091">)</span>&nbsp;<span class="op" id="4936093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936096">b</span>&nbsp;<span class="op" id="4936098">:=</span>&nbsp;<span class="ident" id="4936101">m</span><span class="op" id="4936102">.</span><span class="ident" id="4936103">Bounds</span><span class="op" id="4936109">(</span><span class="op" id="4936110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936113">xmax</span>&nbsp;<span class="op" id="4936118">:=</span>&nbsp;<span class="ident" id="4936121">b</span><span class="op" id="4936122">.</span><span class="ident" id="4936123">Max</span><span class="op" id="4936126">.</span><span class="ident" id="4936127">X</span>&nbsp;<span class="op" id="4936129">-</span>&nbsp;<span class="num" id="4936131">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936134">ymax</span>&nbsp;<span class="op" id="4936139">:=</span>&nbsp;<span class="ident" id="4936142">b</span><span class="op" id="4936143">.</span><span class="ident" id="4936144">Max</span><span class="op" id="4936147">.</span><span class="ident" id="4936148">Y</span>&nbsp;<span class="op" id="4936150">-</span>&nbsp;<span class="num" id="4936152">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936155">pix</span>&nbsp;<span class="op" id="4936159">:=</span>&nbsp;<span class="ident" id="4936162">m</span><span class="op" id="4936163">.</span><span class="ident" id="4936164">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936169">for</span>&nbsp;<span class="ident" id="4936173">j</span>&nbsp;<span class="op" id="4936175">:=</span>&nbsp;<span class="num" id="4936178">0</span><span class="op" id="4936179">;</span>&nbsp;<span class="ident" id="4936181">j</span>&nbsp;<span class="op" id="4936183">&lt;</span>&nbsp;<span class="num" id="4936185">8</span><span class="op" id="4936186">;</span>&nbsp;<span class="ident" id="4936188">j</span><span class="op" id="4936189">++</span>&nbsp;<span class="op" id="4936192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936196">for</span>&nbsp;<span class="ident" id="4936200">i</span>&nbsp;<span class="op" id="4936202">:=</span>&nbsp;<span class="num" id="4936205">0</span><span class="op" id="4936206">;</span>&nbsp;<span class="ident" id="4936208">i</span>&nbsp;<span class="op" id="4936210">&lt;</span>&nbsp;<span class="num" id="4936212">8</span><span class="op" id="4936213">;</span>&nbsp;<span class="ident" id="4936215">i</span><span class="op" id="4936216">++</span>&nbsp;<span class="op" id="4936219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936224">idx</span>&nbsp;<span class="op" id="4936228">:=</span>&nbsp;<span class="ident" id="4936231">m</span><span class="op" id="4936232">.</span><span class="ident" id="4936233">PixOffset</span><span class="op" id="4936242">(</span><span class="ident" id="4936243">min</span><span class="op" id="4936246">(</span><span class="ident" id="4936247">p</span><span class="op" id="4936248">.</span><span class="ident" id="4936249">X</span><span class="op" id="4936250">+</span><span class="ident" id="4936251">i</span><span class="op" id="4936252">,</span>&nbsp;<span class="ident" id="4936254">xmax</span><span class="op" id="4936258">)</span><span class="op" id="4936259">,</span>&nbsp;<span class="ident" id="4936261">min</span><span class="op" id="4936264">(</span><span class="ident" id="4936265">p</span><span class="op" id="4936266">.</span><span class="ident" id="4936267">Y</span><span class="op" id="4936268">+</span><span class="ident" id="4936269">j</span><span class="op" id="4936270">,</span>&nbsp;<span class="ident" id="4936272">ymax</span><span class="op" id="4936276">)</span><span class="op" id="4936277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936282">yBlock</span><span class="op" id="4936288">[</span><span class="num" id="4936289">8</span><span class="op" id="4936290">*</span><span class="ident" id="4936291">j</span><span class="op" id="4936292">+</span><span class="ident" id="4936293">i</span><span class="op" id="4936294">]</span>&nbsp;<span class="op" id="4936296">=</span>&nbsp;<span class="builtintype" id="4936298">int32</span><span class="op" id="4936303">(</span><span class="ident" id="4936304">pix</span><span class="op" id="4936307">[</span><span class="ident" id="4936308">idx</span><span class="op" id="4936311">]</span><span class="op" id="4936312">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936319">}</span><br>
<span class="lineno"></span><span class="op" id="4936321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4936324">//&nbsp;rgbaToYCbCr&nbsp;is&nbsp;a&nbsp;specialized&nbsp;version&nbsp;of&nbsp;toYCbCr&nbsp;for&nbsp;image.RGBA&nbsp;images.</span><br>
<span class="lineno">420</span><span class="keyword" id="4936398">func</span>&nbsp;<span class="ident" id="4936403">rgbaToYCbCr</span><span class="op" id="4936414">(</span><span class="ident" id="4936415">m</span>&nbsp;<span class="op" id="4936417">*</span><span class="ident" id="4936418">image</span><span class="op" id="4936423">.</span><span class="ident" id="4936424">RGBA</span><span class="op" id="4936428">,</span>&nbsp;<span class="ident" id="4936430">p</span>&nbsp;<span class="ident" id="4936432">image</span><span class="op" id="4936437">.</span><span class="ident" id="4936438">Point</span><span class="op" id="4936443">,</span>&nbsp;<span class="ident" id="4936445">yBlock</span><span class="op" id="4936451">,</span>&nbsp;<span class="ident" id="4936453">cbBlock</span><span class="op" id="4936460">,</span>&nbsp;<span class="ident" id="4936462">crBlock</span>&nbsp;<span class="op" id="4936470">*</span><span class="ident" id="4936471">block</span><span class="op" id="4936476">)</span>&nbsp;<span class="op" id="4936478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936481">b</span>&nbsp;<span class="op" id="4936483">:=</span>&nbsp;<span class="ident" id="4936486">m</span><span class="op" id="4936487">.</span><span class="ident" id="4936488">Bounds</span><span class="op" id="4936494">(</span><span class="op" id="4936495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936498">xmax</span>&nbsp;<span class="op" id="4936503">:=</span>&nbsp;<span class="ident" id="4936506">b</span><span class="op" id="4936507">.</span><span class="ident" id="4936508">Max</span><span class="op" id="4936511">.</span><span class="ident" id="4936512">X</span>&nbsp;<span class="op" id="4936514">-</span>&nbsp;<span class="num" id="4936516">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936519">ymax</span>&nbsp;<span class="op" id="4936524">:=</span>&nbsp;<span class="ident" id="4936527">b</span><span class="op" id="4936528">.</span><span class="ident" id="4936529">Max</span><span class="op" id="4936532">.</span><span class="ident" id="4936533">Y</span>&nbsp;<span class="op" id="4936535">-</span>&nbsp;<span class="num" id="4936537">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936540">for</span>&nbsp;<span class="ident" id="4936544">j</span>&nbsp;<span class="op" id="4936546">:=</span>&nbsp;<span class="num" id="4936549">0</span><span class="op" id="4936550">;</span>&nbsp;<span class="ident" id="4936552">j</span>&nbsp;<span class="op" id="4936554">&lt;</span>&nbsp;<span class="num" id="4936556">8</span><span class="op" id="4936557">;</span>&nbsp;<span class="ident" id="4936559">j</span><span class="op" id="4936560">++</span>&nbsp;<span class="op" id="4936563">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936567">sj</span>&nbsp;<span class="op" id="4936570">:=</span>&nbsp;<span class="ident" id="4936573">p</span><span class="op" id="4936574">.</span><span class="ident" id="4936575">Y</span>&nbsp;<span class="op" id="4936577">+</span>&nbsp;<span class="ident" id="4936579">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936583">if</span>&nbsp;<span class="ident" id="4936586">sj</span>&nbsp;<span class="op" id="4936589">&gt;</span>&nbsp;<span class="ident" id="4936591">ymax</span>&nbsp;<span class="op" id="4936596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936601">sj</span>&nbsp;<span class="op" id="4936604">=</span>&nbsp;<span class="ident" id="4936606">ymax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936617">offset</span>&nbsp;<span class="op" id="4936624">:=</span>&nbsp;<span class="op" id="4936627">(</span><span class="ident" id="4936628">sj</span><span class="op" id="4936630">-</span><span class="ident" id="4936631">b</span><span class="op" id="4936632">.</span><span class="ident" id="4936633">Min</span><span class="op" id="4936636">.</span><span class="ident" id="4936637">Y</span><span class="op" id="4936638">)</span><span class="op" id="4936639">*</span><span class="ident" id="4936640">m</span><span class="op" id="4936641">.</span><span class="ident" id="4936642">Stride</span>&nbsp;<span class="op" id="4936649">-</span>&nbsp;<span class="ident" id="4936651">b</span><span class="op" id="4936652">.</span><span class="ident" id="4936653">Min</span><span class="op" id="4936656">.</span><span class="ident" id="4936657">X</span><span class="op" id="4936658">*</span><span class="num" id="4936659">4</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936663">for</span>&nbsp;<span class="ident" id="4936667">i</span>&nbsp;<span class="op" id="4936669">:=</span>&nbsp;<span class="num" id="4936672">0</span><span class="op" id="4936673">;</span>&nbsp;<span class="ident" id="4936675">i</span>&nbsp;<span class="op" id="4936677">&lt;</span>&nbsp;<span class="num" id="4936679">8</span><span class="op" id="4936680">;</span>&nbsp;<span class="ident" id="4936682">i</span><span class="op" id="4936683">++</span>&nbsp;<span class="op" id="4936686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936691">sx</span>&nbsp;<span class="op" id="4936694">:=</span>&nbsp;<span class="ident" id="4936697">p</span><span class="op" id="4936698">.</span><span class="ident" id="4936699">X</span>&nbsp;<span class="op" id="4936701">+</span>&nbsp;<span class="ident" id="4936703">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4936708">if</span>&nbsp;<span class="ident" id="4936711">sx</span>&nbsp;<span class="op" id="4936714">&gt;</span>&nbsp;<span class="ident" id="4936716">xmax</span>&nbsp;<span class="op" id="4936721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936727">sx</span>&nbsp;<span class="op" id="4936730">=</span>&nbsp;<span class="ident" id="4936732">xmax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936740">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936745">pix</span>&nbsp;<span class="op" id="4936749">:=</span>&nbsp;<span class="ident" id="4936752">m</span><span class="op" id="4936753">.</span><span class="ident" id="4936754">Pix</span><span class="op" id="4936757">[</span><span class="ident" id="4936758">offset</span><span class="op" id="4936764">+</span><span class="ident" id="4936765">sx</span><span class="op" id="4936767">*</span><span class="num" id="4936768">4</span><span class="op" id="4936769">:</span><span class="op" id="4936770">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936775">yy</span><span class="op" id="4936777">,</span>&nbsp;<span class="ident" id="4936779">cb</span><span class="op" id="4936781">,</span>&nbsp;<span class="ident" id="4936783">cr</span>&nbsp;<span class="op" id="4936786">:=</span>&nbsp;<span class="ident" id="4936789">color</span><span class="op" id="4936794">.</span><span class="ident" id="4936795">RGBToYCbCr</span><span class="op" id="4936805">(</span><span class="ident" id="4936806">pix</span><span class="op" id="4936809">[</span><span class="num" id="4936810">0</span><span class="op" id="4936811">]</span><span class="op" id="4936812">,</span>&nbsp;<span class="ident" id="4936814">pix</span><span class="op" id="4936817">[</span><span class="num" id="4936818">1</span><span class="op" id="4936819">]</span><span class="op" id="4936820">,</span>&nbsp;<span class="ident" id="4936822">pix</span><span class="op" id="4936825">[</span><span class="num" id="4936826">2</span><span class="op" id="4936827">]</span><span class="op" id="4936828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936833">yBlock</span><span class="op" id="4936839">[</span><span class="num" id="4936840">8</span><span class="op" id="4936841">*</span><span class="ident" id="4936842">j</span><span class="op" id="4936843">+</span><span class="ident" id="4936844">i</span><span class="op" id="4936845">]</span>&nbsp;<span class="op" id="4936847">=</span>&nbsp;<span class="builtintype" id="4936849">int32</span><span class="op" id="4936854">(</span><span class="ident" id="4936855">yy</span><span class="op" id="4936857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936862">cbBlock</span><span class="op" id="4936869">[</span><span class="num" id="4936870">8</span><span class="op" id="4936871">*</span><span class="ident" id="4936872">j</span><span class="op" id="4936873">+</span><span class="ident" id="4936874">i</span><span class="op" id="4936875">]</span>&nbsp;<span class="op" id="4936877">=</span>&nbsp;<span class="builtintype" id="4936879">int32</span><span class="op" id="4936884">(</span><span class="ident" id="4936885">cb</span><span class="op" id="4936887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4936892">crBlock</span><span class="op" id="4936899">[</span><span class="num" id="4936900">8</span><span class="op" id="4936901">*</span><span class="ident" id="4936902">j</span><span class="op" id="4936903">+</span><span class="ident" id="4936904">i</span><span class="op" id="4936905">]</span>&nbsp;<span class="op" id="4936907">=</span>&nbsp;<span class="builtintype" id="4936909">int32</span><span class="op" id="4936914">(</span><span class="ident" id="4936915">cr</span><span class="op" id="4936917">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4936924">}</span><br>
<span class="lineno"></span><span class="op" id="4936926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4936929">//&nbsp;scale&nbsp;scales&nbsp;the&nbsp;16x16&nbsp;region&nbsp;represented&nbsp;by&nbsp;the&nbsp;4&nbsp;src&nbsp;blocks&nbsp;to&nbsp;the&nbsp;8x8</span><br>
<span class="lineno">445</span><span class="comment" id="4937005">//&nbsp;dst&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="4937019">func</span>&nbsp;<span class="ident" id="4937024">scale</span><span class="op" id="4937029">(</span><span class="ident" id="4937030">dst</span>&nbsp;<span class="op" id="4937034">*</span><span class="ident" id="4937035">block</span><span class="op" id="4937040">,</span>&nbsp;<span class="ident" id="4937042">src</span>&nbsp;<span class="op" id="4937046">*</span><span class="op" id="4937047">[</span><span class="num" id="4937048">4</span><span class="op" id="4937049">]</span><span class="ident" id="4937050">block</span><span class="op" id="4937055">)</span>&nbsp;<span class="op" id="4937057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937060">for</span>&nbsp;<span class="ident" id="4937064">i</span>&nbsp;<span class="op" id="4937066">:=</span>&nbsp;<span class="num" id="4937069">0</span><span class="op" id="4937070">;</span>&nbsp;<span class="ident" id="4937072">i</span>&nbsp;<span class="op" id="4937074">&lt;</span>&nbsp;<span class="num" id="4937076">4</span><span class="op" id="4937077">;</span>&nbsp;<span class="ident" id="4937079">i</span><span class="op" id="4937080">++</span>&nbsp;<span class="op" id="4937083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4937087">dstOff</span>&nbsp;<span class="op" id="4937094">:=</span>&nbsp;<span class="op" id="4937097">(</span><span class="ident" id="4937098">i</span><span class="op" id="4937099">&amp;</span><span class="num" id="4937100">2</span><span class="op" id="4937101">)</span><span class="op" id="4937102">&lt;&lt;</span><span class="num" id="4937104">4</span>&nbsp;<span class="op" id="4937106">|</span>&nbsp;<span class="op" id="4937108">(</span><span class="ident" id="4937109">i</span><span class="op" id="4937110">&amp;</span><span class="num" id="4937111">1</span><span class="op" id="4937112">)</span><span class="op" id="4937113">&lt;&lt;</span><span class="num" id="4937115">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937119">for</span>&nbsp;<span class="ident" id="4937123">y</span>&nbsp;<span class="op" id="4937125">:=</span>&nbsp;<span class="num" id="4937128">0</span><span class="op" id="4937129">;</span>&nbsp;<span class="ident" id="4937131">y</span>&nbsp;<span class="op" id="4937133">&lt;</span>&nbsp;<span class="num" id="4937135">4</span><span class="op" id="4937136">;</span>&nbsp;<span class="ident" id="4937138">y</span><span class="op" id="4937139">++</span>&nbsp;<span class="op" id="4937142">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4937147">for</span>&nbsp;<span class="ident" id="4937151">x</span>&nbsp;<span class="op" id="4937153">:=</span>&nbsp;<span class="num" id="4937156">0</span><span class="op" id="4937157">;</span>&nbsp;<span class="ident" id="4937159">x</span>&nbsp;<span class="op" id="4937161">&lt;</span>&nbsp;<span class="num" id="4937163">4</span><span class="op" id="4937164">;</span>&nbsp;<span class="ident" id="4937166">x</span><span class="op" id="4937167">++</span>&nbsp;<span class="op" id="4937170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4937176">j</span>&nbsp;<span class="op" id="4937178">:=</span>&nbsp;<span class="num" id="4937181">16</span><span class="op" id="4937183">*</span><span class="ident" id="4937184">y</span>&nbsp;<span class="op" id="4937186">+</span>&nbsp;<span class="num" id="4937188">2</span><span class="op" id="4937189">*</span><span class="ident" id="4937190">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4937196">sum</span>&nbsp;<span class="op" id="4937200">:=</span>&nbsp;<span class="ident" id="4937203">src</span><span class="op" id="4937206">[</span><span class="ident" id="4937207">i</span><span class="op" id="4937208">]</span><span class="op" id="4937209">[</span><span class="ident" id="4937210">j</span><span class="op" id="4937211">]</span>&nbsp;<span class="op" id="4937213">+</span>&nbsp;<span class="ident" id="4937215">src</span><span class="op" id="4937218">[</span><span class="ident" id="4937219">i</span><span class="op" id="4937220">]</span><span class="op" id="4937221">[</span><span class="ident" id="4937222">j</span><span class="op" id="4937223">+</span><span class="num" id="4937224">1</span><span class="op" id="4937225">]</span>&nbsp;<span class="op" id="4937227">+</span>&nbsp;<span class="ident" id="4937229">src</span><span class="op" id="4937232">[</span><span class="ident" id="4937233">i</span><span class="op" id="4937234">]</span><span class="op" id="4937235">[</span><span class="ident" id="4937236">j</span><span class="op" id="4937237">+</span><span class="num" id="4937238">8</span><span class="op" id="4937239">]</span>&nbsp;<span class="op" id="4937241">+</span>&nbsp;<span class="ident" id="4937243">src</span><span class="op" id="4937246">[</span><span class="ident" id="4937247">i</span><span class="op" id="4937248">]</span><span class="op" id="4937249">[</span><span class="ident" id="4937250">j</span><span class="op" id="4937251">+</span><span class="num" id="4937252">9</span><span class="op" id="4937253">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4937259">dst</span><span class="op" id="4937262">[</span><span class="num" id="4937263">8</span><span class="op" id="4937264">*</span><span class="ident" id="4937265">y</span><span class="op" id="4937266">+</span><span class="ident" id="4937267">x</span><span class="op" id="4937268">+</span><span class="ident" id="4937269">dstOff</span><span class="op" id="4937275">]</span>&nbsp;<span class="op" id="4937277">=</span>&nbsp;<span class="op" id="4937279">(</span><span class="ident" id="4937280">sum</span>&nbsp;<span class="op" id="4937284">+</span>&nbsp;<span class="num" id="4937286">2</span><span class="op" id="4937287">)</span>&nbsp;<span class="op" id="4937289">&gt;&gt;</span>&nbsp;<span class="num" id="4937292">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4937297">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4937301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4937304">}</span><br>
<span class="lineno"></span><span class="op" id="4937306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4937309">//&nbsp;sosHeaderY&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;8&nbsp;bytes:</span><br>
<span class="lineno">460</span><span class="comment" id="4937373">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x08&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4937408">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x01&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4937446">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4937506">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4937577">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno">465</span><span class="comment" id="4937652">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="4937695">var</span>&nbsp;<span class="ident" id="4937699">sosHeaderY</span>&nbsp;<span class="op" id="4937710">=</span>&nbsp;<span class="op" id="4937712">[</span><span class="op" id="4937713">]</span><span class="builtintype" id="4937714">byte</span><span class="op" id="4937718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4937721">0xff</span><span class="op" id="4937725">,</span>&nbsp;<span class="num" id="4937727">0xda</span><span class="op" id="4937731">,</span>&nbsp;<span class="num" id="4937733">0x00</span><span class="op" id="4937737">,</span>&nbsp;<span class="num" id="4937739">0x08</span><span class="op" id="4937743">,</span>&nbsp;<span class="num" id="4937745">0x01</span><span class="op" id="4937749">,</span>&nbsp;<span class="num" id="4937751">0x01</span><span class="op" id="4937755">,</span>&nbsp;<span class="num" id="4937757">0x00</span><span class="op" id="4937761">,</span>&nbsp;<span class="num" id="4937763">0x00</span><span class="op" id="4937767">,</span>&nbsp;<span class="num" id="4937769">0x3f</span><span class="op" id="4937773">,</span>&nbsp;<span class="num" id="4937775">0x00</span><span class="op" id="4937779">,</span><br>
<span class="lineno"></span><span class="op" id="4937781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="4937784">//&nbsp;sosHeaderYCbCr&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;12&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="4937853">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x0c&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4937888">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x03&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4937926">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4937986">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;2&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x02\x11&#34;,</span><br>
<span class="lineno">475</span><span class="comment" id="4938046">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;component&nbsp;3&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x03\x11&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4938106">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4938177">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno"></span><span class="comment" id="4938252">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="4938295">var</span>&nbsp;<span class="ident" id="4938299">sosHeaderYCbCr</span>&nbsp;<span class="op" id="4938314">=</span>&nbsp;<span class="op" id="4938316">[</span><span class="op" id="4938317">]</span><span class="builtintype" id="4938318">byte</span><span class="op" id="4938322">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4938325">0xff</span><span class="op" id="4938329">,</span>&nbsp;<span class="num" id="4938331">0xda</span><span class="op" id="4938335">,</span>&nbsp;<span class="num" id="4938337">0x00</span><span class="op" id="4938341">,</span>&nbsp;<span class="num" id="4938343">0x0c</span><span class="op" id="4938347">,</span>&nbsp;<span class="num" id="4938349">0x03</span><span class="op" id="4938353">,</span>&nbsp;<span class="num" id="4938355">0x01</span><span class="op" id="4938359">,</span>&nbsp;<span class="num" id="4938361">0x00</span><span class="op" id="4938365">,</span>&nbsp;<span class="num" id="4938367">0x02</span><span class="op" id="4938371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4938374">0x11</span><span class="op" id="4938378">,</span>&nbsp;<span class="num" id="4938380">0x03</span><span class="op" id="4938384">,</span>&nbsp;<span class="num" id="4938386">0x11</span><span class="op" id="4938390">,</span>&nbsp;<span class="num" id="4938392">0x00</span><span class="op" id="4938396">,</span>&nbsp;<span class="num" id="4938398">0x3f</span><span class="op" id="4938402">,</span>&nbsp;<span class="num" id="4938404">0x00</span><span class="op" id="4938408">,</span><br>
<span class="lineno"></span><span class="op" id="4938410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4938413">//&nbsp;writeSOS&nbsp;writes&nbsp;the&nbsp;StartOfScan&nbsp;marker.</span><br>
<span class="lineno">485</span><span class="keyword" id="4938456">func</span>&nbsp;<span class="op" id="4938461">(</span><span class="ident" id="4938462">e</span>&nbsp;<span class="op" id="4938464">*</span><span class="ident" id="4938465">encoder</span><span class="op" id="4938472">)</span>&nbsp;<span class="ident" id="4938474">writeSOS</span><span class="op" id="4938482">(</span><span class="ident" id="4938483">m</span>&nbsp;<span class="ident" id="4938485">image</span><span class="op" id="4938490">.</span><span class="ident" id="4938491">Image</span><span class="op" id="4938496">)</span>&nbsp;<span class="op" id="4938498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938501">switch</span>&nbsp;<span class="ident" id="4938508">m</span><span class="op" id="4938509">.</span><span class="op" id="4938510">(</span><span class="keyword" id="4938511">type</span><span class="op" id="4938515">)</span>&nbsp;<span class="op" id="4938517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938520">case</span>&nbsp;<span class="op" id="4938525">*</span><span class="ident" id="4938526">image</span><span class="op" id="4938531">.</span><span class="ident" id="4938532">Gray</span><span class="op" id="4938536">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4938540">e</span><span class="op" id="4938541">.</span><span class="ident" id="4938542">write</span><span class="op" id="4938547">(</span><span class="ident" id="4938548">sosHeaderY</span><span class="op" id="4938558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938561">default</span><span class="op" id="4938568">:</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4938572">e</span><span class="op" id="4938573">.</span><span class="ident" id="4938574">write</span><span class="op" id="4938579">(</span><span class="ident" id="4938580">sosHeaderYCbCr</span><span class="op" id="4938594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4938597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938600">var</span>&nbsp;<span class="op" id="4938604">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4938608">//&nbsp;Scratch&nbsp;buffers&nbsp;to&nbsp;hold&nbsp;the&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4938655">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4938707">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4938714">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4938722">cb</span><span class="op" id="4938724">,</span>&nbsp;<span class="ident" id="4938726">cr</span>&nbsp;<span class="op" id="4938729">[</span><span class="num" id="4938730">4</span><span class="op" id="4938731">]</span><span class="ident" id="4938732">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4938740">//&nbsp;DC&nbsp;components&nbsp;are&nbsp;delta-encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4938778">prevDCY</span><span class="op" id="4938785">,</span>&nbsp;<span class="ident" id="4938787">prevDCCb</span><span class="op" id="4938795">,</span>&nbsp;<span class="ident" id="4938797">prevDCCr</span>&nbsp;<span class="builtintype" id="4938806">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4938813">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4938816">bounds</span>&nbsp;<span class="op" id="4938823">:=</span>&nbsp;<span class="ident" id="4938826">m</span><span class="op" id="4938827">.</span><span class="ident" id="4938828">Bounds</span><span class="op" id="4938834">(</span><span class="op" id="4938835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938838">switch</span>&nbsp;<span class="ident" id="4938845">m</span>&nbsp;<span class="op" id="4938847">:=</span>&nbsp;<span class="ident" id="4938850">m</span><span class="op" id="4938851">.</span><span class="op" id="4938852">(</span><span class="keyword" id="4938853">type</span><span class="op" id="4938857">)</span>&nbsp;<span class="op" id="4938859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4938862">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938924">case</span>&nbsp;<span class="op" id="4938929">*</span><span class="ident" id="4938930">image</span><span class="op" id="4938935">.</span><span class="ident" id="4938936">Gray</span><span class="op" id="4938940">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938944">for</span>&nbsp;<span class="ident" id="4938948">y</span>&nbsp;<span class="op" id="4938950">:=</span>&nbsp;<span class="ident" id="4938953">bounds</span><span class="op" id="4938959">.</span><span class="ident" id="4938960">Min</span><span class="op" id="4938963">.</span><span class="ident" id="4938964">Y</span><span class="op" id="4938965">;</span>&nbsp;<span class="ident" id="4938967">y</span>&nbsp;<span class="op" id="4938969">&lt;</span>&nbsp;<span class="ident" id="4938971">bounds</span><span class="op" id="4938977">.</span><span class="ident" id="4938978">Max</span><span class="op" id="4938981">.</span><span class="ident" id="4938982">Y</span><span class="op" id="4938983">;</span>&nbsp;<span class="ident" id="4938985">y</span>&nbsp;<span class="op" id="4938987">+=</span>&nbsp;<span class="num" id="4938990">8</span>&nbsp;<span class="op" id="4938992">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4938997">for</span>&nbsp;<span class="ident" id="4939001">x</span>&nbsp;<span class="op" id="4939003">:=</span>&nbsp;<span class="ident" id="4939006">bounds</span><span class="op" id="4939012">.</span><span class="ident" id="4939013">Min</span><span class="op" id="4939016">.</span><span class="ident" id="4939017">X</span><span class="op" id="4939018">;</span>&nbsp;<span class="ident" id="4939020">x</span>&nbsp;<span class="op" id="4939022">&lt;</span>&nbsp;<span class="ident" id="4939024">bounds</span><span class="op" id="4939030">.</span><span class="ident" id="4939031">Max</span><span class="op" id="4939034">.</span><span class="ident" id="4939035">X</span><span class="op" id="4939036">;</span>&nbsp;<span class="ident" id="4939038">x</span>&nbsp;<span class="op" id="4939040">+=</span>&nbsp;<span class="num" id="4939043">8</span>&nbsp;<span class="op" id="4939045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939051">p</span>&nbsp;<span class="op" id="4939053">:=</span>&nbsp;<span class="ident" id="4939056">image</span><span class="op" id="4939061">.</span><span class="ident" id="4939062">Pt</span><span class="op" id="4939064">(</span><span class="ident" id="4939065">x</span><span class="op" id="4939066">,</span>&nbsp;<span class="ident" id="4939068">y</span><span class="op" id="4939069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939075">grayToY</span><span class="op" id="4939082">(</span><span class="ident" id="4939083">m</span><span class="op" id="4939084">,</span>&nbsp;<span class="ident" id="4939086">p</span><span class="op" id="4939087">,</span>&nbsp;<span class="op" id="4939089">&amp;</span><span class="ident" id="4939090">b</span><span class="op" id="4939091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939097">prevDCY</span>&nbsp;<span class="op" id="4939105">=</span>&nbsp;<span class="ident" id="4939107">e</span><span class="op" id="4939108">.</span><span class="ident" id="4939109">writeBlock</span><span class="op" id="4939119">(</span><span class="op" id="4939120">&amp;</span><span class="ident" id="4939121">b</span><span class="op" id="4939122">,</span>&nbsp;<span class="num" id="4939124">0</span><span class="op" id="4939125">,</span>&nbsp;<span class="ident" id="4939127">prevDCY</span><span class="op" id="4939134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4939139">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4939143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4939146">default</span><span class="op" id="4939153">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939157">rgba</span><span class="op" id="4939161">,</span>&nbsp;<span class="ident" id="4939163">_</span>&nbsp;<span class="op" id="4939165">:=</span>&nbsp;<span class="ident" id="4939168">m</span><span class="op" id="4939169">.</span><span class="op" id="4939170">(</span><span class="op" id="4939171">*</span><span class="ident" id="4939172">image</span><span class="op" id="4939177">.</span><span class="ident" id="4939178">RGBA</span><span class="op" id="4939182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4939186">for</span>&nbsp;<span class="ident" id="4939190">y</span>&nbsp;<span class="op" id="4939192">:=</span>&nbsp;<span class="ident" id="4939195">bounds</span><span class="op" id="4939201">.</span><span class="ident" id="4939202">Min</span><span class="op" id="4939205">.</span><span class="ident" id="4939206">Y</span><span class="op" id="4939207">;</span>&nbsp;<span class="ident" id="4939209">y</span>&nbsp;<span class="op" id="4939211">&lt;</span>&nbsp;<span class="ident" id="4939213">bounds</span><span class="op" id="4939219">.</span><span class="ident" id="4939220">Max</span><span class="op" id="4939223">.</span><span class="ident" id="4939224">Y</span><span class="op" id="4939225">;</span>&nbsp;<span class="ident" id="4939227">y</span>&nbsp;<span class="op" id="4939229">+=</span>&nbsp;<span class="num" id="4939232">16</span>&nbsp;<span class="op" id="4939235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4939240">for</span>&nbsp;<span class="ident" id="4939244">x</span>&nbsp;<span class="op" id="4939246">:=</span>&nbsp;<span class="ident" id="4939249">bounds</span><span class="op" id="4939255">.</span><span class="ident" id="4939256">Min</span><span class="op" id="4939259">.</span><span class="ident" id="4939260">X</span><span class="op" id="4939261">;</span>&nbsp;<span class="ident" id="4939263">x</span>&nbsp;<span class="op" id="4939265">&lt;</span>&nbsp;<span class="ident" id="4939267">bounds</span><span class="op" id="4939273">.</span><span class="ident" id="4939274">Max</span><span class="op" id="4939277">.</span><span class="ident" id="4939278">X</span><span class="op" id="4939279">;</span>&nbsp;<span class="ident" id="4939281">x</span>&nbsp;<span class="op" id="4939283">+=</span>&nbsp;<span class="num" id="4939286">16</span>&nbsp;<span class="op" id="4939289">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4939295">for</span>&nbsp;<span class="ident" id="4939299">i</span>&nbsp;<span class="op" id="4939301">:=</span>&nbsp;<span class="num" id="4939304">0</span><span class="op" id="4939305">;</span>&nbsp;<span class="ident" id="4939307">i</span>&nbsp;<span class="op" id="4939309">&lt;</span>&nbsp;<span class="num" id="4939311">4</span><span class="op" id="4939312">;</span>&nbsp;<span class="ident" id="4939314">i</span><span class="op" id="4939315">++</span>&nbsp;<span class="op" id="4939318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939325">xOff</span>&nbsp;<span class="op" id="4939330">:=</span>&nbsp;<span class="op" id="4939333">(</span><span class="ident" id="4939334">i</span>&nbsp;<span class="op" id="4939336">&amp;</span>&nbsp;<span class="num" id="4939338">1</span><span class="op" id="4939339">)</span>&nbsp;<span class="op" id="4939341">*</span>&nbsp;<span class="num" id="4939343">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939350">yOff</span>&nbsp;<span class="op" id="4939355">:=</span>&nbsp;<span class="op" id="4939358">(</span><span class="ident" id="4939359">i</span>&nbsp;<span class="op" id="4939361">&amp;</span>&nbsp;<span class="num" id="4939363">2</span><span class="op" id="4939364">)</span>&nbsp;<span class="op" id="4939366">*</span>&nbsp;<span class="num" id="4939368">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939375">p</span>&nbsp;<span class="op" id="4939377">:=</span>&nbsp;<span class="ident" id="4939380">image</span><span class="op" id="4939385">.</span><span class="ident" id="4939386">Pt</span><span class="op" id="4939388">(</span><span class="ident" id="4939389">x</span><span class="op" id="4939390">+</span><span class="ident" id="4939391">xOff</span><span class="op" id="4939395">,</span>&nbsp;<span class="ident" id="4939397">y</span><span class="op" id="4939398">+</span><span class="ident" id="4939399">yOff</span><span class="op" id="4939403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4939410">if</span>&nbsp;<span class="ident" id="4939413">rgba</span>&nbsp;<span class="op" id="4939418">!=</span>&nbsp;<span class="builtintype" id="4939421">nil</span>&nbsp;<span class="op" id="4939425">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939433">rgbaToYCbCr</span><span class="op" id="4939444">(</span><span class="ident" id="4939445">rgba</span><span class="op" id="4939449">,</span>&nbsp;<span class="ident" id="4939451">p</span><span class="op" id="4939452">,</span>&nbsp;<span class="op" id="4939454">&amp;</span><span class="ident" id="4939455">b</span><span class="op" id="4939456">,</span>&nbsp;<span class="op" id="4939458">&amp;</span><span class="ident" id="4939459">cb</span><span class="op" id="4939461">[</span><span class="ident" id="4939462">i</span><span class="op" id="4939463">]</span><span class="op" id="4939464">,</span>&nbsp;<span class="op" id="4939466">&amp;</span><span class="ident" id="4939467">cr</span><span class="op" id="4939469">[</span><span class="ident" id="4939470">i</span><span class="op" id="4939471">]</span><span class="op" id="4939472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4939479">}</span>&nbsp;<span class="keyword" id="4939481">else</span>&nbsp;<span class="op" id="4939486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939494">toYCbCr</span><span class="op" id="4939501">(</span><span class="ident" id="4939502">m</span><span class="op" id="4939503">,</span>&nbsp;<span class="ident" id="4939505">p</span><span class="op" id="4939506">,</span>&nbsp;<span class="op" id="4939508">&amp;</span><span class="ident" id="4939509">b</span><span class="op" id="4939510">,</span>&nbsp;<span class="op" id="4939512">&amp;</span><span class="ident" id="4939513">cb</span><span class="op" id="4939515">[</span><span class="ident" id="4939516">i</span><span class="op" id="4939517">]</span><span class="op" id="4939518">,</span>&nbsp;<span class="op" id="4939520">&amp;</span><span class="ident" id="4939521">cr</span><span class="op" id="4939523">[</span><span class="ident" id="4939524">i</span><span class="op" id="4939525">]</span><span class="op" id="4939526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4939533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939540">prevDCY</span>&nbsp;<span class="op" id="4939548">=</span>&nbsp;<span class="ident" id="4939550">e</span><span class="op" id="4939551">.</span><span class="ident" id="4939552">writeBlock</span><span class="op" id="4939562">(</span><span class="op" id="4939563">&amp;</span><span class="ident" id="4939564">b</span><span class="op" id="4939565">,</span>&nbsp;<span class="num" id="4939567">0</span><span class="op" id="4939568">,</span>&nbsp;<span class="ident" id="4939570">prevDCY</span><span class="op" id="4939577">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4939583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939589">scale</span><span class="op" id="4939594">(</span><span class="op" id="4939595">&amp;</span><span class="ident" id="4939596">b</span><span class="op" id="4939597">,</span>&nbsp;<span class="op" id="4939599">&amp;</span><span class="ident" id="4939600">cb</span><span class="op" id="4939602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939608">prevDCCb</span>&nbsp;<span class="op" id="4939617">=</span>&nbsp;<span class="ident" id="4939619">e</span><span class="op" id="4939620">.</span><span class="ident" id="4939621">writeBlock</span><span class="op" id="4939631">(</span><span class="op" id="4939632">&amp;</span><span class="ident" id="4939633">b</span><span class="op" id="4939634">,</span>&nbsp;<span class="num" id="4939636">1</span><span class="op" id="4939637">,</span>&nbsp;<span class="ident" id="4939639">prevDCCb</span><span class="op" id="4939647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939653">scale</span><span class="op" id="4939658">(</span><span class="op" id="4939659">&amp;</span><span class="ident" id="4939660">b</span><span class="op" id="4939661">,</span>&nbsp;<span class="op" id="4939663">&amp;</span><span class="ident" id="4939664">cr</span><span class="op" id="4939666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939672">prevDCCr</span>&nbsp;<span class="op" id="4939681">=</span>&nbsp;<span class="ident" id="4939683">e</span><span class="op" id="4939684">.</span><span class="ident" id="4939685">writeBlock</span><span class="op" id="4939695">(</span><span class="op" id="4939696">&amp;</span><span class="ident" id="4939697">b</span><span class="op" id="4939698">,</span>&nbsp;<span class="num" id="4939700">1</span><span class="op" id="4939701">,</span>&nbsp;<span class="ident" id="4939703">prevDCCr</span><span class="op" id="4939711">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4939716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4939720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4939723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4939726">//&nbsp;Pad&nbsp;the&nbsp;last&nbsp;byte&nbsp;with&nbsp;1&#39;s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939758">e</span><span class="op" id="4939759">.</span><span class="ident" id="4939760">emit</span><span class="op" id="4939764">(</span><span class="num" id="4939765">0x7f</span><span class="op" id="4939769">,</span>&nbsp;<span class="num" id="4939771">7</span><span class="op" id="4939772">)</span><br>
<span class="lineno">535</span><span class="op" id="4939774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4939777">//&nbsp;DefaultQuality&nbsp;is&nbsp;the&nbsp;default&nbsp;quality&nbsp;encoding&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="4939838">const</span>&nbsp;<span class="ident" id="4939844">DefaultQuality</span>&nbsp;<span class="op" id="4939859">=</span>&nbsp;<span class="num" id="4939861">75</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="4939865">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment" id="4939905">//&nbsp;Quality&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;inclusive,&nbsp;higher&nbsp;is&nbsp;better.</span><br>
<span class="lineno"></span><span class="keyword" id="4939966">type</span>&nbsp;<span class="ident" id="4939971">Options</span>&nbsp;<span class="keyword" id="4939979">struct</span>&nbsp;<span class="op" id="4939986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4939989">Quality</span>&nbsp;<span class="builtintype" id="4939997">int</span><br>
<span class="lineno"></span><span class="op" id="4940001">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="4940004">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;JPEG&nbsp;4:2:0&nbsp;baseline&nbsp;format&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="4940083">//&nbsp;options.&nbsp;Default&nbsp;parameters&nbsp;are&nbsp;used&nbsp;if&nbsp;a&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;passed.</span><br>
<span class="lineno"></span><span class="keyword" id="4940152">func</span>&nbsp;<span class="ident" id="4940157">Encode</span><span class="op" id="4940163">(</span><span class="ident" id="4940164">w</span>&nbsp;<span class="ident" id="4940166">io</span><span class="op" id="4940168">.</span><span class="ident" id="4940169">Writer</span><span class="op" id="4940175">,</span>&nbsp;<span class="ident" id="4940177">m</span>&nbsp;<span class="ident" id="4940179">image</span><span class="op" id="4940184">.</span><span class="ident" id="4940185">Image</span><span class="op" id="4940190">,</span>&nbsp;<span class="ident" id="4940192">o</span>&nbsp;<span class="op" id="4940194">*</span><span class="ident" id="4940195">Options</span><span class="op" id="4940202">)</span>&nbsp;<span class="builtintype" id="4940204">error</span>&nbsp;<span class="op" id="4940210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940213">b</span>&nbsp;<span class="op" id="4940215">:=</span>&nbsp;<span class="ident" id="4940218">m</span><span class="op" id="4940219">.</span><span class="ident" id="4940220">Bounds</span><span class="op" id="4940226">(</span><span class="op" id="4940227">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940230">if</span>&nbsp;<span class="ident" id="4940233">b</span><span class="op" id="4940234">.</span><span class="ident" id="4940235">Dx</span><span class="op" id="4940237">(</span><span class="op" id="4940238">)</span>&nbsp;<span class="op" id="4940240">&gt;=</span>&nbsp;<span class="num" id="4940243">1</span><span class="op" id="4940244">&lt;&lt;</span><span class="num" id="4940246">16</span>&nbsp;<span class="op" id="4940249">||</span>&nbsp;<span class="ident" id="4940252">b</span><span class="op" id="4940253">.</span><span class="ident" id="4940254">Dy</span><span class="op" id="4940256">(</span><span class="op" id="4940257">)</span>&nbsp;<span class="op" id="4940259">&gt;=</span>&nbsp;<span class="num" id="4940262">1</span><span class="op" id="4940263">&lt;&lt;</span><span class="num" id="4940265">16</span>&nbsp;<span class="op" id="4940268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940272">return</span>&nbsp;<span class="ident" id="4940279">errors</span><span class="op" id="4940285">.</span><span class="ident" id="4940286">New</span><span class="op" id="4940289">(</span><span class="string" id="4940290">&#34;jpeg:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="4940326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4940329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940332">var</span>&nbsp;<span class="ident" id="4940336">e</span>&nbsp;<span class="ident" id="4940338">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940347">if</span>&nbsp;<span class="ident" id="4940350">ww</span><span class="op" id="4940352">,</span>&nbsp;<span class="ident" id="4940354">ok</span>&nbsp;<span class="op" id="4940357">:=</span>&nbsp;<span class="ident" id="4940360">w</span><span class="op" id="4940361">.</span><span class="op" id="4940362">(</span><span class="ident" id="4940363">writer</span><span class="op" id="4940369">)</span><span class="op" id="4940370">;</span>&nbsp;<span class="ident" id="4940372">ok</span>&nbsp;<span class="op" id="4940375">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940379">e</span><span class="op" id="4940380">.</span><span class="ident" id="4940381">w</span>&nbsp;<span class="op" id="4940383">=</span>&nbsp;<span class="ident" id="4940385">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4940389">}</span>&nbsp;<span class="keyword" id="4940391">else</span>&nbsp;<span class="op" id="4940396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940400">e</span><span class="op" id="4940401">.</span><span class="ident" id="4940402">w</span>&nbsp;<span class="op" id="4940404">=</span>&nbsp;<span class="ident" id="4940406">bufio</span><span class="op" id="4940411">.</span><span class="ident" id="4940412">NewWriter</span><span class="op" id="4940421">(</span><span class="ident" id="4940422">w</span><span class="op" id="4940423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4940426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4940429">//&nbsp;Clip&nbsp;quality&nbsp;to&nbsp;[1,&nbsp;100].</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940459">quality</span>&nbsp;<span class="op" id="4940467">:=</span>&nbsp;<span class="ident" id="4940470">DefaultQuality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940486">if</span>&nbsp;<span class="ident" id="4940489">o</span>&nbsp;<span class="op" id="4940491">!=</span>&nbsp;<span class="builtintype" id="4940494">nil</span>&nbsp;<span class="op" id="4940498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940502">quality</span>&nbsp;<span class="op" id="4940510">=</span>&nbsp;<span class="ident" id="4940512">o</span><span class="op" id="4940513">.</span><span class="ident" id="4940514">Quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940524">if</span>&nbsp;<span class="ident" id="4940527">quality</span>&nbsp;<span class="op" id="4940535">&lt;</span>&nbsp;<span class="num" id="4940537">1</span>&nbsp;<span class="op" id="4940539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940544">quality</span>&nbsp;<span class="op" id="4940552">=</span>&nbsp;<span class="num" id="4940554">1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4940558">}</span>&nbsp;<span class="keyword" id="4940560">else</span>&nbsp;<span class="keyword" id="4940565">if</span>&nbsp;<span class="ident" id="4940568">quality</span>&nbsp;<span class="op" id="4940576">&gt;</span>&nbsp;<span class="num" id="4940578">100</span>&nbsp;<span class="op" id="4940582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940587">quality</span>&nbsp;<span class="op" id="4940595">=</span>&nbsp;<span class="num" id="4940597">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4940603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4940606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4940609">//&nbsp;Convert&nbsp;from&nbsp;a&nbsp;quality&nbsp;rating&nbsp;to&nbsp;a&nbsp;scaling&nbsp;factor.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940664">var</span>&nbsp;<span class="ident" id="4940668">scale</span>&nbsp;<span class="builtintype" id="4940674">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940679">if</span>&nbsp;<span class="ident" id="4940682">quality</span>&nbsp;<span class="op" id="4940690">&lt;</span>&nbsp;<span class="num" id="4940692">50</span>&nbsp;<span class="op" id="4940695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940699">scale</span>&nbsp;<span class="op" id="4940705">=</span>&nbsp;<span class="num" id="4940707">5000</span>&nbsp;<span class="op" id="4940712">/</span>&nbsp;<span class="ident" id="4940714">quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4940723">}</span>&nbsp;<span class="keyword" id="4940725">else</span>&nbsp;<span class="op" id="4940730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940734">scale</span>&nbsp;<span class="op" id="4940740">=</span>&nbsp;<span class="num" id="4940742">200</span>&nbsp;<span class="op" id="4940746">-</span>&nbsp;<span class="ident" id="4940748">quality</span><span class="op" id="4940755">*</span><span class="num" id="4940756">2</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4940759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4940762">//&nbsp;Initialize&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940802">for</span>&nbsp;<span class="ident" id="4940806">i</span>&nbsp;<span class="op" id="4940808">:=</span>&nbsp;<span class="keyword" id="4940811">range</span>&nbsp;<span class="ident" id="4940817">e</span><span class="op" id="4940818">.</span><span class="ident" id="4940819">quant</span>&nbsp;<span class="op" id="4940825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940829">for</span>&nbsp;<span class="ident" id="4940833">j</span>&nbsp;<span class="op" id="4940835">:=</span>&nbsp;<span class="keyword" id="4940838">range</span>&nbsp;<span class="ident" id="4940844">e</span><span class="op" id="4940845">.</span><span class="ident" id="4940846">quant</span><span class="op" id="4940851">[</span><span class="ident" id="4940852">i</span><span class="op" id="4940853">]</span>&nbsp;<span class="op" id="4940855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940860">x</span>&nbsp;<span class="op" id="4940862">:=</span>&nbsp;<span class="builtintype" id="4940865">int</span><span class="op" id="4940868">(</span><span class="ident" id="4940869">unscaledQuant</span><span class="op" id="4940882">[</span><span class="ident" id="4940883">i</span><span class="op" id="4940884">]</span><span class="op" id="4940885">[</span><span class="ident" id="4940886">j</span><span class="op" id="4940887">]</span><span class="op" id="4940888">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940893">x</span>&nbsp;<span class="op" id="4940895">=</span>&nbsp;<span class="op" id="4940897">(</span><span class="ident" id="4940898">x</span><span class="op" id="4940899">*</span><span class="ident" id="4940900">scale</span>&nbsp;<span class="op" id="4940906">+</span>&nbsp;<span class="num" id="4940908">50</span><span class="op" id="4940910">)</span>&nbsp;<span class="op" id="4940912">/</span>&nbsp;<span class="num" id="4940914">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4940921">if</span>&nbsp;<span class="ident" id="4940924">x</span>&nbsp;<span class="op" id="4940926">&lt;</span>&nbsp;<span class="num" id="4940928">1</span>&nbsp;<span class="op" id="4940930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940936">x</span>&nbsp;<span class="op" id="4940938">=</span>&nbsp;<span class="num" id="4940940">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4940945">}</span>&nbsp;<span class="keyword" id="4940947">else</span>&nbsp;<span class="keyword" id="4940952">if</span>&nbsp;<span class="ident" id="4940955">x</span>&nbsp;<span class="op" id="4940957">&gt;</span>&nbsp;<span class="num" id="4940959">255</span>&nbsp;<span class="op" id="4940963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940969">x</span>&nbsp;<span class="op" id="4940971">=</span>&nbsp;<span class="num" id="4940973">255</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4940980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4940985">e</span><span class="op" id="4940986">.</span><span class="ident" id="4940987">quant</span><span class="op" id="4940992">[</span><span class="ident" id="4940993">i</span><span class="op" id="4940994">]</span><span class="op" id="4940995">[</span><span class="ident" id="4940996">j</span><span class="op" id="4940997">]</span>&nbsp;<span class="op" id="4940999">=</span>&nbsp;<span class="builtintype" id="4941001">uint8</span><span class="op" id="4941006">(</span><span class="ident" id="4941007">x</span><span class="op" id="4941008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4941012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4941015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4941018">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;components&nbsp;based&nbsp;on&nbsp;input&nbsp;image&nbsp;type.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941078">nComponent</span>&nbsp;<span class="op" id="4941089">:=</span>&nbsp;<span class="num" id="4941092">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4941095">switch</span>&nbsp;<span class="ident" id="4941102">m</span><span class="op" id="4941103">.</span><span class="op" id="4941104">(</span><span class="keyword" id="4941105">type</span><span class="op" id="4941109">)</span>&nbsp;<span class="op" id="4941111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4941114">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4941176">case</span>&nbsp;<span class="op" id="4941181">*</span><span class="ident" id="4941182">image</span><span class="op" id="4941187">.</span><span class="ident" id="4941188">Gray</span><span class="op" id="4941192">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941196">nComponent</span>&nbsp;<span class="op" id="4941207">=</span>&nbsp;<span class="num" id="4941209">1</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4941212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4941215">//&nbsp;Write&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941252">e</span><span class="op" id="4941253">.</span><span class="ident" id="4941254">buf</span><span class="op" id="4941257">[</span><span class="num" id="4941258">0</span><span class="op" id="4941259">]</span>&nbsp;<span class="op" id="4941261">=</span>&nbsp;<span class="num" id="4941263">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941269">e</span><span class="op" id="4941270">.</span><span class="ident" id="4941271">buf</span><span class="op" id="4941274">[</span><span class="num" id="4941275">1</span><span class="op" id="4941276">]</span>&nbsp;<span class="op" id="4941278">=</span>&nbsp;<span class="num" id="4941280">0xd8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941286">e</span><span class="op" id="4941287">.</span><span class="ident" id="4941288">write</span><span class="op" id="4941293">(</span><span class="ident" id="4941294">e</span><span class="op" id="4941295">.</span><span class="ident" id="4941296">buf</span><span class="op" id="4941299">[</span><span class="op" id="4941300">:</span><span class="num" id="4941301">2</span><span class="op" id="4941302">]</span><span class="op" id="4941303">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4941306">//&nbsp;Write&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941341">e</span><span class="op" id="4941342">.</span><span class="ident" id="4941343">writeDQT</span><span class="op" id="4941351">(</span><span class="op" id="4941352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4941355">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;dimensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941387">e</span><span class="op" id="4941388">.</span><span class="ident" id="4941389">writeSOF0</span><span class="op" id="4941398">(</span><span class="ident" id="4941399">b</span><span class="op" id="4941400">.</span><span class="ident" id="4941401">Size</span><span class="op" id="4941405">(</span><span class="op" id="4941406">)</span><span class="op" id="4941407">,</span>&nbsp;<span class="ident" id="4941409">nComponent</span><span class="op" id="4941419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4941422">//&nbsp;Write&nbsp;the&nbsp;Huffman&nbsp;tables.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941452">e</span><span class="op" id="4941453">.</span><span class="ident" id="4941454">writeDHT</span><span class="op" id="4941462">(</span><span class="ident" id="4941463">nComponent</span><span class="op" id="4941473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4941476">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941502">e</span><span class="op" id="4941503">.</span><span class="ident" id="4941504">writeSOS</span><span class="op" id="4941512">(</span><span class="ident" id="4941513">m</span><span class="op" id="4941514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4941517">//&nbsp;Write&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941552">e</span><span class="op" id="4941553">.</span><span class="ident" id="4941554">buf</span><span class="op" id="4941557">[</span><span class="num" id="4941558">0</span><span class="op" id="4941559">]</span>&nbsp;<span class="op" id="4941561">=</span>&nbsp;<span class="num" id="4941563">0xff</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941569">e</span><span class="op" id="4941570">.</span><span class="ident" id="4941571">buf</span><span class="op" id="4941574">[</span><span class="num" id="4941575">1</span><span class="op" id="4941576">]</span>&nbsp;<span class="op" id="4941578">=</span>&nbsp;<span class="num" id="4941580">0xd9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941586">e</span><span class="op" id="4941587">.</span><span class="ident" id="4941588">write</span><span class="op" id="4941593">(</span><span class="ident" id="4941594">e</span><span class="op" id="4941595">.</span><span class="ident" id="4941596">buf</span><span class="op" id="4941599">[</span><span class="op" id="4941600">:</span><span class="num" id="4941601">2</span><span class="op" id="4941602">]</span><span class="op" id="4941603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4941606">e</span><span class="op" id="4941607">.</span><span class="ident" id="4941608">flush</span><span class="op" id="4941613">(</span><span class="op" id="4941614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4941617">return</span>&nbsp;<span class="ident" id="4941624">e</span><span class="op" id="4941625">.</span><span class="ident" id="4941626">err</span><br>
<span class="lineno"></span><span class="op" id="4941630">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
