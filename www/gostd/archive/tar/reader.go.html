<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5906425">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5906480">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5906534">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5906585">package</span>&nbsp;<span class="ident" id="5906593">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5906598">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="5906617">//&nbsp;&nbsp;&nbsp;-&nbsp;pax&nbsp;extensions</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5906640">import</span>&nbsp;<span class="op" id="5906647">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5906650">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5906659">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5906669">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5906675">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5906688">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5906694">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5906705">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5906716">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5906723">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5906726">var</span>&nbsp;<span class="op" id="5906730">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906733">ErrHeader</span>&nbsp;<span class="op" id="5906743">=</span>&nbsp;<span class="ident" id="5906745">errors</span><span class="op" id="5906751">.</span><span class="ident" id="5906752">New</span><span class="op" id="5906755">(</span><span class="string" id="5906756">&#34;archive/tar:&nbsp;invalid&nbsp;tar&nbsp;header&#34;</span><span class="op" id="5906789">)</span><br>
<span class="lineno"></span><span class="op" id="5906791">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5906794">const</span>&nbsp;<span class="ident" id="5906800">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5906821">=</span>&nbsp;<span class="num" id="5906823">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5906826">//&nbsp;A&nbsp;Reader&nbsp;provides&nbsp;sequential&nbsp;access&nbsp;to&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5906899">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5906949">//&nbsp;The&nbsp;Next&nbsp;method&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;file&nbsp;in&nbsp;the&nbsp;archive&nbsp;(including&nbsp;the&nbsp;first),</span><br>
<span class="lineno">30</span><span class="comment" id="5907032">//&nbsp;and&nbsp;then&nbsp;it&nbsp;can&nbsp;be&nbsp;treated&nbsp;as&nbsp;an&nbsp;io.Reader&nbsp;to&nbsp;access&nbsp;the&nbsp;file&#39;s&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5907105">type</span>&nbsp;<span class="ident" id="5907110">Reader</span>&nbsp;<span class="keyword" id="5907117">struct</span>&nbsp;<span class="op" id="5907124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907127">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5907135">io</span><span class="op" id="5907137">.</span><span class="ident" id="5907138">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907146">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5907154">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907161">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5907169">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5907185">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;(ignored)&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907242">curr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5907250">numBytesReader</span>&nbsp;&nbsp;<span class="comment" id="5907266">//&nbsp;reader&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907300">hdrBuff</span>&nbsp;<span class="op" id="5907308">[</span><span class="ident" id="5907309">blockSize</span><span class="op" id="5907318">]</span><span class="builtintype" id="5907319">byte</span>&nbsp;<span class="comment" id="5907324">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;readHeader</span><br>
<span class="lineno"></span><span class="op" id="5907355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5907358">//&nbsp;A&nbsp;numBytesReader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;with&nbsp;a&nbsp;numBytes&nbsp;method,&nbsp;returning&nbsp;the&nbsp;number</span><br>
<span class="lineno">40</span><span class="comment" id="5907439">//&nbsp;of&nbsp;bytes&nbsp;remaining&nbsp;in&nbsp;the&nbsp;underlying&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5907493">type</span>&nbsp;<span class="ident" id="5907498">numBytesReader</span>&nbsp;<span class="keyword" id="5907513">interface</span>&nbsp;<span class="op" id="5907523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907526">io</span><span class="op" id="5907528">.</span><span class="ident" id="5907529">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907537">numBytes</span><span class="op" id="5907545">(</span><span class="op" id="5907546">)</span>&nbsp;<span class="ident" id="5907548">int64</span><br>
<span class="lineno"></span><span class="op" id="5907554">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5907557">//&nbsp;A&nbsp;regFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5907638">type</span>&nbsp;<span class="ident" id="5907643">regFileReader</span>&nbsp;<span class="keyword" id="5907657">struct</span>&nbsp;<span class="op" id="5907664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907667">r</span>&nbsp;&nbsp;<span class="ident" id="5907670">io</span><span class="op" id="5907672">.</span><span class="ident" id="5907673">Reader</span>&nbsp;<span class="comment" id="5907680">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907702">nb</span>&nbsp;<span class="ident" id="5907705">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5907715">//&nbsp;number&nbsp;of&nbsp;unread&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">50</span><span class="op" id="5907764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5907767">//&nbsp;A&nbsp;sparseFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;sparse&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5907858">type</span>&nbsp;<span class="ident" id="5907863">sparseFileReader</span>&nbsp;<span class="keyword" id="5907880">struct</span>&nbsp;<span class="op" id="5907887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907890">rfr</span>&nbsp;<span class="op" id="5907894">*</span><span class="ident" id="5907895">regFileReader</span>&nbsp;<span class="comment" id="5907909">//&nbsp;reads&nbsp;the&nbsp;sparse-encoded&nbsp;file&nbsp;data</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907948">sp</span>&nbsp;&nbsp;<span class="op" id="5907952">[</span><span class="op" id="5907953">]</span><span class="ident" id="5907954">sparseEntry</span>&nbsp;&nbsp;<span class="comment" id="5907967">//&nbsp;the&nbsp;sparse&nbsp;map&nbsp;for&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907999">pos</span>&nbsp;<span class="ident" id="5908003">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5908018">//&nbsp;keeps&nbsp;track&nbsp;of&nbsp;file&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908051">tot</span>&nbsp;<span class="ident" id="5908055">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5908070">//&nbsp;total&nbsp;size&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="5908096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5908099">//&nbsp;Keywords&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;files&nbsp;in&nbsp;a&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span><span class="keyword" id="5908157">const</span>&nbsp;<span class="op" id="5908163">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908166">paxGNUSparseNumBlocks</span>&nbsp;<span class="op" id="5908188">=</span>&nbsp;<span class="string" id="5908190">&#34;GNU.sparse.numblocks&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908214">paxGNUSparseOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908236">=</span>&nbsp;<span class="string" id="5908238">&#34;GNU.sparse.offset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908259">paxGNUSparseNumBytes</span>&nbsp;&nbsp;<span class="op" id="5908281">=</span>&nbsp;<span class="string" id="5908283">&#34;GNU.sparse.numbytes&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908306">paxGNUSparseMap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908328">=</span>&nbsp;<span class="string" id="5908330">&#34;GNU.sparse.map&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908348">paxGNUSparseName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908370">=</span>&nbsp;<span class="string" id="5908372">&#34;GNU.sparse.name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908391">paxGNUSparseMajor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908413">=</span>&nbsp;<span class="string" id="5908415">&#34;GNU.sparse.major&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908435">paxGNUSparseMinor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908457">=</span>&nbsp;<span class="string" id="5908459">&#34;GNU.sparse.minor&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908479">paxGNUSparseSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908501">=</span>&nbsp;<span class="string" id="5908503">&#34;GNU.sparse.size&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908522">paxGNUSparseRealSize</span>&nbsp;&nbsp;<span class="op" id="5908544">=</span>&nbsp;<span class="string" id="5908546">&#34;GNU.sparse.realsize&#34;</span><br>
<span class="lineno"></span><span class="op" id="5908568">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5908571">//&nbsp;Keywords&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;headers</span><br>
<span class="lineno"></span><span class="keyword" id="5908610">const</span>&nbsp;<span class="op" id="5908616">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908619">oldGNUSparseMainHeaderOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908662">=</span>&nbsp;<span class="num" id="5908664">386</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908669">oldGNUSparseMainHeaderIsExtendedOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908712">=</span>&nbsp;<span class="num" id="5908714">482</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908719">oldGNUSparseMainHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908762">=</span>&nbsp;<span class="num" id="5908764">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908767">oldGNUSparseExtendedHeaderIsExtendedOffset</span>&nbsp;<span class="op" id="5908810">=</span>&nbsp;<span class="num" id="5908812">504</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908817">oldGNUSparseExtendedHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908860">=</span>&nbsp;<span class="num" id="5908862">21</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908866">oldGNUSparseOffsetSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908909">=</span>&nbsp;<span class="num" id="5908911">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908915">oldGNUSparseNumBytesSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5908958">=</span>&nbsp;<span class="num" id="5908960">12</span><br>
<span class="lineno"></span><span class="op" id="5908963">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5908966">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno">85</span><span class="keyword" id="5909016">func</span>&nbsp;<span class="ident" id="5909021">NewReader</span><span class="op" id="5909030">(</span><span class="ident" id="5909031">r</span>&nbsp;<span class="ident" id="5909033">io</span><span class="op" id="5909035">.</span><span class="ident" id="5909036">Reader</span><span class="op" id="5909042">)</span>&nbsp;<span class="op" id="5909044">*</span><span class="ident" id="5909045">Reader</span>&nbsp;<span class="op" id="5909052">{</span>&nbsp;<span class="keyword" id="5909054">return</span>&nbsp;<span class="op" id="5909061">&amp;</span><span class="ident" id="5909062">Reader</span><span class="op" id="5909068">{</span><span class="ident" id="5909069">r</span><span class="op" id="5909070">:</span>&nbsp;<span class="ident" id="5909072">r</span><span class="op" id="5909073">}</span>&nbsp;<span class="op" id="5909075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5909078">//&nbsp;Next&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5909133">func</span>&nbsp;<span class="op" id="5909138">(</span><span class="ident" id="5909139">tr</span>&nbsp;<span class="op" id="5909142">*</span><span class="ident" id="5909143">Reader</span><span class="op" id="5909149">)</span>&nbsp;<span class="ident" id="5909151">Next</span><span class="op" id="5909155">(</span><span class="op" id="5909156">)</span>&nbsp;<span class="op" id="5909158">(</span><span class="op" id="5909159">*</span><span class="ident" id="5909160">Header</span><span class="op" id="5909166">,</span>&nbsp;<span class="builtintype" id="5909168">error</span><span class="op" id="5909173">)</span>&nbsp;<span class="op" id="5909175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909178">var</span>&nbsp;<span class="ident" id="5909182">hdr</span>&nbsp;<span class="op" id="5909186">*</span><span class="ident" id="5909187">Header</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909195">if</span>&nbsp;<span class="ident" id="5909198">tr</span><span class="op" id="5909200">.</span><span class="ident" id="5909201">err</span>&nbsp;<span class="op" id="5909205">==</span>&nbsp;<span class="ident" id="5909208">nil</span>&nbsp;<span class="op" id="5909212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909216">tr</span><span class="op" id="5909218">.</span><span class="ident" id="5909219">skipUnread</span><span class="op" id="5909229">(</span><span class="op" id="5909230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909236">if</span>&nbsp;<span class="ident" id="5909239">tr</span><span class="op" id="5909241">.</span><span class="ident" id="5909242">err</span>&nbsp;<span class="op" id="5909246">!=</span>&nbsp;<span class="ident" id="5909249">nil</span>&nbsp;<span class="op" id="5909253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909257">return</span>&nbsp;<span class="ident" id="5909264">hdr</span><span class="op" id="5909267">,</span>&nbsp;<span class="ident" id="5909269">tr</span><span class="op" id="5909271">.</span><span class="ident" id="5909272">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909280">hdr</span>&nbsp;<span class="op" id="5909284">=</span>&nbsp;<span class="ident" id="5909286">tr</span><span class="op" id="5909288">.</span><span class="ident" id="5909289">readHeader</span><span class="op" id="5909299">(</span><span class="op" id="5909300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909303">if</span>&nbsp;<span class="ident" id="5909306">hdr</span>&nbsp;<span class="op" id="5909310">==</span>&nbsp;<span class="ident" id="5909313">nil</span>&nbsp;<span class="op" id="5909317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909321">return</span>&nbsp;<span class="ident" id="5909328">hdr</span><span class="op" id="5909331">,</span>&nbsp;<span class="ident" id="5909333">tr</span><span class="op" id="5909335">.</span><span class="ident" id="5909336">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909341">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909344">//&nbsp;Check&nbsp;for&nbsp;PAX/GNU&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909374">switch</span>&nbsp;<span class="ident" id="5909381">hdr</span><span class="op" id="5909384">.</span><span class="ident" id="5909385">Typeflag</span>&nbsp;<span class="op" id="5909394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909397">case</span>&nbsp;<span class="ident" id="5909402">TypeXHeader</span><span class="op" id="5909413">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909417">//&nbsp;&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909443">headers</span><span class="op" id="5909450">,</span>&nbsp;<span class="ident" id="5909452">err</span>&nbsp;<span class="op" id="5909456">:=</span>&nbsp;<span class="ident" id="5909459">parsePAX</span><span class="op" id="5909467">(</span><span class="ident" id="5909468">tr</span><span class="op" id="5909470">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909474">if</span>&nbsp;<span class="ident" id="5909477">err</span>&nbsp;<span class="op" id="5909481">!=</span>&nbsp;<span class="ident" id="5909484">nil</span>&nbsp;<span class="op" id="5909488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909493">return</span>&nbsp;<span class="ident" id="5909500">nil</span><span class="op" id="5909503">,</span>&nbsp;<span class="ident" id="5909505">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909515">//&nbsp;We&nbsp;actually&nbsp;read&nbsp;the&nbsp;whole&nbsp;file,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909553">//&nbsp;but&nbsp;this&nbsp;skips&nbsp;alignment&nbsp;padding</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909591">tr</span><span class="op" id="5909593">.</span><span class="ident" id="5909594">skipUnread</span><span class="op" id="5909604">(</span><span class="op" id="5909605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909609">hdr</span>&nbsp;<span class="op" id="5909613">=</span>&nbsp;<span class="ident" id="5909615">tr</span><span class="op" id="5909617">.</span><span class="ident" id="5909618">readHeader</span><span class="op" id="5909628">(</span><span class="op" id="5909629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909633">mergePAX</span><span class="op" id="5909641">(</span><span class="ident" id="5909642">hdr</span><span class="op" id="5909645">,</span>&nbsp;<span class="ident" id="5909647">headers</span><span class="op" id="5909654">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909659">//&nbsp;Check&nbsp;for&nbsp;a&nbsp;PAX&nbsp;format&nbsp;sparse&nbsp;file</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909699">sp</span><span class="op" id="5909701">,</span>&nbsp;<span class="ident" id="5909703">err</span>&nbsp;<span class="op" id="5909707">:=</span>&nbsp;<span class="ident" id="5909710">tr</span><span class="op" id="5909712">.</span><span class="ident" id="5909713">checkForGNUSparsePAXHeaders</span><span class="op" id="5909740">(</span><span class="ident" id="5909741">hdr</span><span class="op" id="5909744">,</span>&nbsp;<span class="ident" id="5909746">headers</span><span class="op" id="5909753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909757">if</span>&nbsp;<span class="ident" id="5909760">err</span>&nbsp;<span class="op" id="5909764">!=</span>&nbsp;<span class="ident" id="5909767">nil</span>&nbsp;<span class="op" id="5909771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909776">tr</span><span class="op" id="5909778">.</span><span class="ident" id="5909779">err</span>&nbsp;<span class="op" id="5909783">=</span>&nbsp;<span class="ident" id="5909785">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909792">return</span>&nbsp;<span class="ident" id="5909799">nil</span><span class="op" id="5909802">,</span>&nbsp;<span class="ident" id="5909804">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909810">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909814">if</span>&nbsp;<span class="ident" id="5909817">sp</span>&nbsp;<span class="op" id="5909820">!=</span>&nbsp;<span class="ident" id="5909823">nil</span>&nbsp;<span class="op" id="5909827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909832">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909884">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader&nbsp;to&nbsp;a&nbsp;sparse&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909943">tr</span><span class="op" id="5909945">.</span><span class="ident" id="5909946">curr</span>&nbsp;<span class="op" id="5909951">=</span>&nbsp;<span class="op" id="5909953">&amp;</span><span class="ident" id="5909954">sparseFileReader</span><span class="op" id="5909970">{</span><span class="ident" id="5909971">rfr</span><span class="op" id="5909974">:</span>&nbsp;<span class="ident" id="5909976">tr</span><span class="op" id="5909978">.</span><span class="ident" id="5909979">curr</span><span class="op" id="5909983">.</span><span class="op" id="5909984">(</span><span class="op" id="5909985">*</span><span class="ident" id="5909986">regFileReader</span><span class="op" id="5909999">)</span><span class="op" id="5910000">,</span>&nbsp;<span class="ident" id="5910002">sp</span><span class="op" id="5910004">:</span>&nbsp;<span class="ident" id="5910006">sp</span><span class="op" id="5910008">,</span>&nbsp;<span class="ident" id="5910010">tot</span><span class="op" id="5910013">:</span>&nbsp;<span class="ident" id="5910015">hdr</span><span class="op" id="5910018">.</span><span class="ident" id="5910019">Size</span><span class="op" id="5910023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910027">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910031">return</span>&nbsp;<span class="ident" id="5910038">hdr</span><span class="op" id="5910041">,</span>&nbsp;<span class="ident" id="5910043">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910048">case</span>&nbsp;<span class="ident" id="5910053">TypeGNULongName</span><span class="op" id="5910068">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910072">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;name&nbsp;header.&nbsp;Its&nbsp;contents&nbsp;are&nbsp;the&nbsp;real&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910146">realname</span><span class="op" id="5910154">,</span>&nbsp;<span class="ident" id="5910156">err</span>&nbsp;<span class="op" id="5910160">:=</span>&nbsp;<span class="ident" id="5910163">ioutil</span><span class="op" id="5910169">.</span><span class="ident" id="5910170">ReadAll</span><span class="op" id="5910177">(</span><span class="ident" id="5910178">tr</span><span class="op" id="5910180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910184">if</span>&nbsp;<span class="ident" id="5910187">err</span>&nbsp;<span class="op" id="5910191">!=</span>&nbsp;<span class="ident" id="5910194">nil</span>&nbsp;<span class="op" id="5910198">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910203">return</span>&nbsp;<span class="ident" id="5910210">nil</span><span class="op" id="5910213">,</span>&nbsp;<span class="ident" id="5910215">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910225">hdr</span><span class="op" id="5910228">,</span>&nbsp;<span class="ident" id="5910230">err</span>&nbsp;<span class="op" id="5910234">:=</span>&nbsp;<span class="ident" id="5910237">tr</span><span class="op" id="5910239">.</span><span class="ident" id="5910240">Next</span><span class="op" id="5910244">(</span><span class="op" id="5910245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910249">hdr</span><span class="op" id="5910252">.</span><span class="ident" id="5910253">Name</span>&nbsp;<span class="op" id="5910258">=</span>&nbsp;<span class="ident" id="5910260">cString</span><span class="op" id="5910267">(</span><span class="ident" id="5910268">realname</span><span class="op" id="5910276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910280">return</span>&nbsp;<span class="ident" id="5910287">hdr</span><span class="op" id="5910290">,</span>&nbsp;<span class="ident" id="5910292">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910297">case</span>&nbsp;<span class="ident" id="5910302">TypeGNULongLink</span><span class="op" id="5910317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910321">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;link&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910358">realname</span><span class="op" id="5910366">,</span>&nbsp;<span class="ident" id="5910368">err</span>&nbsp;<span class="op" id="5910372">:=</span>&nbsp;<span class="ident" id="5910375">ioutil</span><span class="op" id="5910381">.</span><span class="ident" id="5910382">ReadAll</span><span class="op" id="5910389">(</span><span class="ident" id="5910390">tr</span><span class="op" id="5910392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910396">if</span>&nbsp;<span class="ident" id="5910399">err</span>&nbsp;<span class="op" id="5910403">!=</span>&nbsp;<span class="ident" id="5910406">nil</span>&nbsp;<span class="op" id="5910410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910415">return</span>&nbsp;<span class="ident" id="5910422">nil</span><span class="op" id="5910425">,</span>&nbsp;<span class="ident" id="5910427">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910437">hdr</span><span class="op" id="5910440">,</span>&nbsp;<span class="ident" id="5910442">err</span>&nbsp;<span class="op" id="5910446">:=</span>&nbsp;<span class="ident" id="5910449">tr</span><span class="op" id="5910451">.</span><span class="ident" id="5910452">Next</span><span class="op" id="5910456">(</span><span class="op" id="5910457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910461">hdr</span><span class="op" id="5910464">.</span><span class="ident" id="5910465">Linkname</span>&nbsp;<span class="op" id="5910474">=</span>&nbsp;<span class="ident" id="5910476">cString</span><span class="op" id="5910483">(</span><span class="ident" id="5910484">realname</span><span class="op" id="5910492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910496">return</span>&nbsp;<span class="ident" id="5910503">hdr</span><span class="op" id="5910506">,</span>&nbsp;<span class="ident" id="5910508">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910513">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910516">return</span>&nbsp;<span class="ident" id="5910523">hdr</span><span class="op" id="5910526">,</span>&nbsp;<span class="ident" id="5910528">tr</span><span class="op" id="5910530">.</span><span class="ident" id="5910531">err</span><br>
<span class="lineno"></span><span class="op" id="5910535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5910538">//&nbsp;checkForGNUSparsePAXHeaders&nbsp;checks&nbsp;the&nbsp;PAX&nbsp;headers&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;headers.&nbsp;If&nbsp;they&nbsp;are&nbsp;found,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5910640">//&nbsp;this&nbsp;function&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;and&nbsp;returns&nbsp;it.&nbsp;Unknown&nbsp;sparse&nbsp;formats&nbsp;are&nbsp;ignored,&nbsp;causing&nbsp;the&nbsp;file&nbsp;to</span><br>
<span class="lineno">150</span><span class="comment" id="5910750">//&nbsp;be&nbsp;treated&nbsp;as&nbsp;a&nbsp;regular&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5910783">func</span>&nbsp;<span class="op" id="5910788">(</span><span class="ident" id="5910789">tr</span>&nbsp;<span class="op" id="5910792">*</span><span class="ident" id="5910793">Reader</span><span class="op" id="5910799">)</span>&nbsp;<span class="ident" id="5910801">checkForGNUSparsePAXHeaders</span><span class="op" id="5910828">(</span><span class="ident" id="5910829">hdr</span>&nbsp;<span class="op" id="5910833">*</span><span class="ident" id="5910834">Header</span><span class="op" id="5910840">,</span>&nbsp;<span class="ident" id="5910842">headers</span>&nbsp;<span class="keyword" id="5910850">map</span><span class="op" id="5910853">[</span><span class="builtintype" id="5910854">string</span><span class="op" id="5910860">]</span><span class="builtintype" id="5910861">string</span><span class="op" id="5910867">)</span>&nbsp;<span class="op" id="5910869">(</span><span class="op" id="5910870">[</span><span class="op" id="5910871">]</span><span class="ident" id="5910872">sparseEntry</span><span class="op" id="5910883">,</span>&nbsp;<span class="builtintype" id="5910885">error</span><span class="op" id="5910890">)</span>&nbsp;<span class="op" id="5910892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910895">var</span>&nbsp;<span class="ident" id="5910899">sparseFormat</span>&nbsp;<span class="builtintype" id="5910912">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910921">//&nbsp;Check&nbsp;for&nbsp;sparse&nbsp;format&nbsp;indicators</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910960">major</span><span class="op" id="5910965">,</span>&nbsp;<span class="ident" id="5910967">majorOk</span>&nbsp;<span class="op" id="5910975">:=</span>&nbsp;<span class="ident" id="5910978">headers</span><span class="op" id="5910985">[</span><span class="ident" id="5910986">paxGNUSparseMajor</span><span class="op" id="5911003">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911006">minor</span><span class="op" id="5911011">,</span>&nbsp;<span class="ident" id="5911013">minorOk</span>&nbsp;<span class="op" id="5911021">:=</span>&nbsp;<span class="ident" id="5911024">headers</span><span class="op" id="5911031">[</span><span class="ident" id="5911032">paxGNUSparseMinor</span><span class="op" id="5911049">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911052">sparseName</span><span class="op" id="5911062">,</span>&nbsp;<span class="ident" id="5911064">sparseNameOk</span>&nbsp;<span class="op" id="5911077">:=</span>&nbsp;<span class="ident" id="5911080">headers</span><span class="op" id="5911087">[</span><span class="ident" id="5911088">paxGNUSparseName</span><span class="op" id="5911104">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911107">_</span><span class="op" id="5911108">,</span>&nbsp;<span class="ident" id="5911110">sparseMapOk</span>&nbsp;<span class="op" id="5911122">:=</span>&nbsp;<span class="ident" id="5911125">headers</span><span class="op" id="5911132">[</span><span class="ident" id="5911133">paxGNUSparseMap</span><span class="op" id="5911148">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911151">sparseSize</span><span class="op" id="5911161">,</span>&nbsp;<span class="ident" id="5911163">sparseSizeOk</span>&nbsp;<span class="op" id="5911176">:=</span>&nbsp;<span class="ident" id="5911179">headers</span><span class="op" id="5911186">[</span><span class="ident" id="5911187">paxGNUSparseSize</span><span class="op" id="5911203">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911206">sparseRealSize</span><span class="op" id="5911220">,</span>&nbsp;<span class="ident" id="5911222">sparseRealSizeOk</span>&nbsp;<span class="op" id="5911239">:=</span>&nbsp;<span class="ident" id="5911242">headers</span><span class="op" id="5911249">[</span><span class="ident" id="5911250">paxGNUSparseRealSize</span><span class="op" id="5911270">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911274">//&nbsp;Identify&nbsp;which,&nbsp;if&nbsp;any,&nbsp;sparse&nbsp;format&nbsp;applies&nbsp;from&nbsp;which&nbsp;PAX&nbsp;headers&nbsp;are&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911355">if</span>&nbsp;<span class="ident" id="5911358">majorOk</span>&nbsp;<span class="op" id="5911366">&amp;&amp;</span>&nbsp;<span class="ident" id="5911369">minorOk</span>&nbsp;<span class="op" id="5911377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911381">sparseFormat</span>&nbsp;<span class="op" id="5911394">=</span>&nbsp;<span class="ident" id="5911396">major</span>&nbsp;<span class="op" id="5911402">+</span>&nbsp;<span class="string" id="5911404">&#34;.&#34;</span>&nbsp;<span class="op" id="5911408">+</span>&nbsp;<span class="ident" id="5911410">minor</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5911417">}</span>&nbsp;<span class="keyword" id="5911419">else</span>&nbsp;<span class="keyword" id="5911424">if</span>&nbsp;<span class="ident" id="5911427">sparseNameOk</span>&nbsp;<span class="op" id="5911440">&amp;&amp;</span>&nbsp;<span class="ident" id="5911443">sparseMapOk</span>&nbsp;<span class="op" id="5911455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911459">sparseFormat</span>&nbsp;<span class="op" id="5911472">=</span>&nbsp;<span class="string" id="5911474">&#34;0.1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5911481">}</span>&nbsp;<span class="keyword" id="5911483">else</span>&nbsp;<span class="keyword" id="5911488">if</span>&nbsp;<span class="ident" id="5911491">sparseSizeOk</span>&nbsp;<span class="op" id="5911504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911508">sparseFormat</span>&nbsp;<span class="op" id="5911521">=</span>&nbsp;<span class="string" id="5911523">&#34;0.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5911530">}</span>&nbsp;<span class="keyword" id="5911532">else</span>&nbsp;<span class="op" id="5911537">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911541">//&nbsp;Not&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911580">return</span>&nbsp;<span class="ident" id="5911587">nil</span><span class="op" id="5911590">,</span>&nbsp;<span class="ident" id="5911592">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5911597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911601">//&nbsp;Check&nbsp;for&nbsp;unknown&nbsp;sparse&nbsp;format</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911637">if</span>&nbsp;<span class="ident" id="5911640">sparseFormat</span>&nbsp;<span class="op" id="5911653">!=</span>&nbsp;<span class="string" id="5911656">&#34;0.0&#34;</span>&nbsp;<span class="op" id="5911662">&amp;&amp;</span>&nbsp;<span class="ident" id="5911665">sparseFormat</span>&nbsp;<span class="op" id="5911678">!=</span>&nbsp;<span class="string" id="5911681">&#34;0.1&#34;</span>&nbsp;<span class="op" id="5911687">&amp;&amp;</span>&nbsp;<span class="ident" id="5911690">sparseFormat</span>&nbsp;<span class="op" id="5911703">!=</span>&nbsp;<span class="string" id="5911706">&#34;1.0&#34;</span>&nbsp;<span class="op" id="5911712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911716">return</span>&nbsp;<span class="ident" id="5911723">nil</span><span class="op" id="5911726">,</span>&nbsp;<span class="ident" id="5911728">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5911733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911737">//&nbsp;Update&nbsp;hdr&nbsp;from&nbsp;GNU&nbsp;sparse&nbsp;PAX&nbsp;headers</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911780">if</span>&nbsp;<span class="ident" id="5911783">sparseNameOk</span>&nbsp;<span class="op" id="5911796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911800">hdr</span><span class="op" id="5911803">.</span><span class="ident" id="5911804">Name</span>&nbsp;<span class="op" id="5911809">=</span>&nbsp;<span class="ident" id="5911811">sparseName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5911823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911826">if</span>&nbsp;<span class="ident" id="5911829">sparseSizeOk</span>&nbsp;<span class="op" id="5911842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911846">realSize</span><span class="op" id="5911854">,</span>&nbsp;<span class="ident" id="5911856">err</span>&nbsp;<span class="op" id="5911860">:=</span>&nbsp;<span class="ident" id="5911863">strconv</span><span class="op" id="5911870">.</span><span class="ident" id="5911871">ParseInt</span><span class="op" id="5911879">(</span><span class="ident" id="5911880">sparseSize</span><span class="op" id="5911890">,</span>&nbsp;<span class="num" id="5911892">10</span><span class="op" id="5911894">,</span>&nbsp;<span class="num" id="5911896">0</span><span class="op" id="5911897">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911901">if</span>&nbsp;<span class="ident" id="5911904">err</span>&nbsp;<span class="op" id="5911908">!=</span>&nbsp;<span class="ident" id="5911911">nil</span>&nbsp;<span class="op" id="5911915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911920">return</span>&nbsp;<span class="ident" id="5911927">nil</span><span class="op" id="5911930">,</span>&nbsp;<span class="ident" id="5911932">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5911944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911948">hdr</span><span class="op" id="5911951">.</span><span class="ident" id="5911952">Size</span>&nbsp;<span class="op" id="5911957">=</span>&nbsp;<span class="ident" id="5911959">realSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5911969">}</span>&nbsp;<span class="keyword" id="5911971">else</span>&nbsp;<span class="keyword" id="5911976">if</span>&nbsp;<span class="ident" id="5911979">sparseRealSizeOk</span>&nbsp;<span class="op" id="5911996">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912000">realSize</span><span class="op" id="5912008">,</span>&nbsp;<span class="ident" id="5912010">err</span>&nbsp;<span class="op" id="5912014">:=</span>&nbsp;<span class="ident" id="5912017">strconv</span><span class="op" id="5912024">.</span><span class="ident" id="5912025">ParseInt</span><span class="op" id="5912033">(</span><span class="ident" id="5912034">sparseRealSize</span><span class="op" id="5912048">,</span>&nbsp;<span class="num" id="5912050">10</span><span class="op" id="5912052">,</span>&nbsp;<span class="num" id="5912054">0</span><span class="op" id="5912055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912059">if</span>&nbsp;<span class="ident" id="5912062">err</span>&nbsp;<span class="op" id="5912066">!=</span>&nbsp;<span class="ident" id="5912069">nil</span>&nbsp;<span class="op" id="5912073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912078">return</span>&nbsp;<span class="ident" id="5912085">nil</span><span class="op" id="5912088">,</span>&nbsp;<span class="ident" id="5912090">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912106">hdr</span><span class="op" id="5912109">.</span><span class="ident" id="5912110">Size</span>&nbsp;<span class="op" id="5912115">=</span>&nbsp;<span class="ident" id="5912117">realSize</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5912131">//&nbsp;Set&nbsp;up&nbsp;the&nbsp;sparse&nbsp;map,&nbsp;according&nbsp;to&nbsp;the&nbsp;particular&nbsp;sparse&nbsp;format&nbsp;in&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912207">var</span>&nbsp;<span class="ident" id="5912211">sp</span>&nbsp;<span class="op" id="5912214">[</span><span class="op" id="5912215">]</span><span class="ident" id="5912216">sparseEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912229">var</span>&nbsp;<span class="ident" id="5912233">err</span>&nbsp;<span class="builtintype" id="5912237">error</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912244">switch</span>&nbsp;<span class="ident" id="5912251">sparseFormat</span>&nbsp;<span class="op" id="5912264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912267">case</span>&nbsp;<span class="string" id="5912272">&#34;0.0&#34;</span><span class="op" id="5912277">,</span>&nbsp;<span class="string" id="5912279">&#34;0.1&#34;</span><span class="op" id="5912284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912288">sp</span><span class="op" id="5912290">,</span>&nbsp;<span class="ident" id="5912292">err</span>&nbsp;<span class="op" id="5912296">=</span>&nbsp;<span class="ident" id="5912298">readGNUSparseMap0x1</span><span class="op" id="5912317">(</span><span class="ident" id="5912318">headers</span><span class="op" id="5912325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912328">case</span>&nbsp;<span class="string" id="5912333">&#34;1.0&#34;</span><span class="op" id="5912338">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912342">sp</span><span class="op" id="5912344">,</span>&nbsp;<span class="ident" id="5912346">err</span>&nbsp;<span class="op" id="5912350">=</span>&nbsp;<span class="ident" id="5912352">readGNUSparseMap1x0</span><span class="op" id="5912371">(</span><span class="ident" id="5912372">tr</span><span class="op" id="5912374">.</span><span class="ident" id="5912375">curr</span><span class="op" id="5912379">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912385">return</span>&nbsp;<span class="ident" id="5912392">sp</span><span class="op" id="5912394">,</span>&nbsp;<span class="ident" id="5912396">err</span><br>
<span class="lineno"></span><span class="op" id="5912400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5912403">//&nbsp;mergePAX&nbsp;merges&nbsp;well&nbsp;known&nbsp;headers&nbsp;according&nbsp;to&nbsp;PAX&nbsp;standard.</span><br>
<span class="lineno">210</span><span class="comment" id="5912468">//&nbsp;In&nbsp;general&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;as&nbsp;those&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="5912524">//&nbsp;in&nbsp;the&nbsp;header&nbsp;struct&nbsp;overwrite&nbsp;those&nbsp;found&nbsp;in&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5912584">//&nbsp;struct&nbsp;with&nbsp;higher&nbsp;precision&nbsp;or&nbsp;longer&nbsp;values.&nbsp;Esp.&nbsp;useful</span><br>
<span class="lineno"></span><span class="comment" id="5912646">//&nbsp;for&nbsp;name&nbsp;and&nbsp;linkname&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="5912679">func</span>&nbsp;<span class="ident" id="5912684">mergePAX</span><span class="op" id="5912692">(</span><span class="ident" id="5912693">hdr</span>&nbsp;<span class="op" id="5912697">*</span><span class="ident" id="5912698">Header</span><span class="op" id="5912704">,</span>&nbsp;<span class="ident" id="5912706">headers</span>&nbsp;<span class="keyword" id="5912714">map</span><span class="op" id="5912717">[</span><span class="builtintype" id="5912718">string</span><span class="op" id="5912724">]</span><span class="builtintype" id="5912725">string</span><span class="op" id="5912731">)</span>&nbsp;<span class="builtintype" id="5912733">error</span>&nbsp;<span class="op" id="5912739">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912742">for</span>&nbsp;<span class="ident" id="5912746">k</span><span class="op" id="5912747">,</span>&nbsp;<span class="ident" id="5912749">v</span>&nbsp;<span class="op" id="5912751">:=</span>&nbsp;<span class="keyword" id="5912754">range</span>&nbsp;<span class="ident" id="5912760">headers</span>&nbsp;<span class="op" id="5912768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912772">switch</span>&nbsp;<span class="ident" id="5912779">k</span>&nbsp;<span class="op" id="5912781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912785">case</span>&nbsp;<span class="ident" id="5912790">paxPath</span><span class="op" id="5912797">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912802">hdr</span><span class="op" id="5912805">.</span><span class="ident" id="5912806">Name</span>&nbsp;<span class="op" id="5912811">=</span>&nbsp;<span class="ident" id="5912813">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912817">case</span>&nbsp;<span class="ident" id="5912822">paxLinkpath</span><span class="op" id="5912833">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912838">hdr</span><span class="op" id="5912841">.</span><span class="ident" id="5912842">Linkname</span>&nbsp;<span class="op" id="5912851">=</span>&nbsp;<span class="ident" id="5912853">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912857">case</span>&nbsp;<span class="ident" id="5912862">paxGname</span><span class="op" id="5912870">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912875">hdr</span><span class="op" id="5912878">.</span><span class="ident" id="5912879">Gname</span>&nbsp;<span class="op" id="5912885">=</span>&nbsp;<span class="ident" id="5912887">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912891">case</span>&nbsp;<span class="ident" id="5912896">paxUname</span><span class="op" id="5912904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912909">hdr</span><span class="op" id="5912912">.</span><span class="ident" id="5912913">Uname</span>&nbsp;<span class="op" id="5912919">=</span>&nbsp;<span class="ident" id="5912921">v</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912925">case</span>&nbsp;<span class="ident" id="5912930">paxUid</span><span class="op" id="5912936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912941">uid</span><span class="op" id="5912944">,</span>&nbsp;<span class="ident" id="5912946">err</span>&nbsp;<span class="op" id="5912950">:=</span>&nbsp;<span class="ident" id="5912953">strconv</span><span class="op" id="5912960">.</span><span class="ident" id="5912961">ParseInt</span><span class="op" id="5912969">(</span><span class="ident" id="5912970">v</span><span class="op" id="5912971">,</span>&nbsp;<span class="num" id="5912973">10</span><span class="op" id="5912975">,</span>&nbsp;<span class="num" id="5912977">0</span><span class="op" id="5912978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912983">if</span>&nbsp;<span class="ident" id="5912986">err</span>&nbsp;<span class="op" id="5912990">!=</span>&nbsp;<span class="ident" id="5912993">nil</span>&nbsp;<span class="op" id="5912997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913003">return</span>&nbsp;<span class="ident" id="5913010">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913017">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913022">hdr</span><span class="op" id="5913025">.</span><span class="ident" id="5913026">Uid</span>&nbsp;<span class="op" id="5913030">=</span>&nbsp;<span class="builtintype" id="5913032">int</span><span class="op" id="5913035">(</span><span class="ident" id="5913036">uid</span><span class="op" id="5913039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913043">case</span>&nbsp;<span class="ident" id="5913048">paxGid</span><span class="op" id="5913054">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913059">gid</span><span class="op" id="5913062">,</span>&nbsp;<span class="ident" id="5913064">err</span>&nbsp;<span class="op" id="5913068">:=</span>&nbsp;<span class="ident" id="5913071">strconv</span><span class="op" id="5913078">.</span><span class="ident" id="5913079">ParseInt</span><span class="op" id="5913087">(</span><span class="ident" id="5913088">v</span><span class="op" id="5913089">,</span>&nbsp;<span class="num" id="5913091">10</span><span class="op" id="5913093">,</span>&nbsp;<span class="num" id="5913095">0</span><span class="op" id="5913096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913101">if</span>&nbsp;<span class="ident" id="5913104">err</span>&nbsp;<span class="op" id="5913108">!=</span>&nbsp;<span class="ident" id="5913111">nil</span>&nbsp;<span class="op" id="5913115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913121">return</span>&nbsp;<span class="ident" id="5913128">err</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913140">hdr</span><span class="op" id="5913143">.</span><span class="ident" id="5913144">Gid</span>&nbsp;<span class="op" id="5913148">=</span>&nbsp;<span class="builtintype" id="5913150">int</span><span class="op" id="5913153">(</span><span class="ident" id="5913154">gid</span><span class="op" id="5913157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913161">case</span>&nbsp;<span class="ident" id="5913166">paxAtime</span><span class="op" id="5913174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913179">t</span><span class="op" id="5913180">,</span>&nbsp;<span class="ident" id="5913182">err</span>&nbsp;<span class="op" id="5913186">:=</span>&nbsp;<span class="ident" id="5913189">parsePAXTime</span><span class="op" id="5913201">(</span><span class="ident" id="5913202">v</span><span class="op" id="5913203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913208">if</span>&nbsp;<span class="ident" id="5913211">err</span>&nbsp;<span class="op" id="5913215">!=</span>&nbsp;<span class="ident" id="5913218">nil</span>&nbsp;<span class="op" id="5913222">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913228">return</span>&nbsp;<span class="ident" id="5913235">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913247">hdr</span><span class="op" id="5913250">.</span><span class="ident" id="5913251">AccessTime</span>&nbsp;<span class="op" id="5913262">=</span>&nbsp;<span class="ident" id="5913264">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913268">case</span>&nbsp;<span class="ident" id="5913273">paxMtime</span><span class="op" id="5913281">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913286">t</span><span class="op" id="5913287">,</span>&nbsp;<span class="ident" id="5913289">err</span>&nbsp;<span class="op" id="5913293">:=</span>&nbsp;<span class="ident" id="5913296">parsePAXTime</span><span class="op" id="5913308">(</span><span class="ident" id="5913309">v</span><span class="op" id="5913310">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913315">if</span>&nbsp;<span class="ident" id="5913318">err</span>&nbsp;<span class="op" id="5913322">!=</span>&nbsp;<span class="ident" id="5913325">nil</span>&nbsp;<span class="op" id="5913329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913335">return</span>&nbsp;<span class="ident" id="5913342">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913354">hdr</span><span class="op" id="5913357">.</span><span class="ident" id="5913358">ModTime</span>&nbsp;<span class="op" id="5913366">=</span>&nbsp;<span class="ident" id="5913368">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913372">case</span>&nbsp;<span class="ident" id="5913377">paxCtime</span><span class="op" id="5913385">:</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913390">t</span><span class="op" id="5913391">,</span>&nbsp;<span class="ident" id="5913393">err</span>&nbsp;<span class="op" id="5913397">:=</span>&nbsp;<span class="ident" id="5913400">parsePAXTime</span><span class="op" id="5913412">(</span><span class="ident" id="5913413">v</span><span class="op" id="5913414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913419">if</span>&nbsp;<span class="ident" id="5913422">err</span>&nbsp;<span class="op" id="5913426">!=</span>&nbsp;<span class="ident" id="5913429">nil</span>&nbsp;<span class="op" id="5913433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913439">return</span>&nbsp;<span class="ident" id="5913446">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913458">hdr</span><span class="op" id="5913461">.</span><span class="ident" id="5913462">ChangeTime</span>&nbsp;<span class="op" id="5913473">=</span>&nbsp;<span class="ident" id="5913475">t</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913479">case</span>&nbsp;<span class="ident" id="5913484">paxSize</span><span class="op" id="5913491">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913496">size</span><span class="op" id="5913500">,</span>&nbsp;<span class="ident" id="5913502">err</span>&nbsp;<span class="op" id="5913506">:=</span>&nbsp;<span class="ident" id="5913509">strconv</span><span class="op" id="5913516">.</span><span class="ident" id="5913517">ParseInt</span><span class="op" id="5913525">(</span><span class="ident" id="5913526">v</span><span class="op" id="5913527">,</span>&nbsp;<span class="num" id="5913529">10</span><span class="op" id="5913531">,</span>&nbsp;<span class="num" id="5913533">0</span><span class="op" id="5913534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913539">if</span>&nbsp;<span class="ident" id="5913542">err</span>&nbsp;<span class="op" id="5913546">!=</span>&nbsp;<span class="ident" id="5913549">nil</span>&nbsp;<span class="op" id="5913553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913559">return</span>&nbsp;<span class="ident" id="5913566">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913573">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913578">hdr</span><span class="op" id="5913581">.</span><span class="ident" id="5913582">Size</span>&nbsp;<span class="op" id="5913587">=</span>&nbsp;<span class="ident" id="5913589">int64</span><span class="op" id="5913594">(</span><span class="ident" id="5913595">size</span><span class="op" id="5913599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913603">default</span><span class="op" id="5913610">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913615">if</span>&nbsp;<span class="ident" id="5913618">strings</span><span class="op" id="5913625">.</span><span class="ident" id="5913626">HasPrefix</span><span class="op" id="5913635">(</span><span class="ident" id="5913636">k</span><span class="op" id="5913637">,</span>&nbsp;<span class="ident" id="5913639">paxXattr</span><span class="op" id="5913647">)</span>&nbsp;<span class="op" id="5913649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913655">if</span>&nbsp;<span class="ident" id="5913658">hdr</span><span class="op" id="5913661">.</span><span class="ident" id="5913662">Xattrs</span>&nbsp;<span class="op" id="5913669">==</span>&nbsp;<span class="ident" id="5913672">nil</span>&nbsp;<span class="op" id="5913676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913683">hdr</span><span class="op" id="5913686">.</span><span class="ident" id="5913687">Xattrs</span>&nbsp;<span class="op" id="5913694">=</span>&nbsp;<span class="builtinfunc" id="5913696">make</span><span class="op" id="5913700">(</span><span class="keyword" id="5913701">map</span><span class="op" id="5913704">[</span><span class="builtintype" id="5913705">string</span><span class="op" id="5913711">]</span><span class="builtintype" id="5913712">string</span><span class="op" id="5913718">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913730">hdr</span><span class="op" id="5913733">.</span><span class="ident" id="5913734">Xattrs</span><span class="op" id="5913740">[</span><span class="ident" id="5913741">k</span><span class="op" id="5913742">[</span><span class="builtinfunc" id="5913743">len</span><span class="op" id="5913746">(</span><span class="ident" id="5913747">paxXattr</span><span class="op" id="5913755">)</span><span class="op" id="5913756">:</span><span class="op" id="5913757">]</span><span class="op" id="5913758">]</span>&nbsp;<span class="op" id="5913760">=</span>&nbsp;<span class="ident" id="5913762">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913774">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913777">return</span>&nbsp;<span class="ident" id="5913784">nil</span><br>
<span class="lineno"></span><span class="op" id="5913788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5913791">//&nbsp;parsePAXTime&nbsp;takes&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;%d.%d&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5913856">//&nbsp;the&nbsp;PAX&nbsp;specification.</span><br>
<span class="lineno">275</span><span class="keyword" id="5913882">func</span>&nbsp;<span class="ident" id="5913887">parsePAXTime</span><span class="op" id="5913899">(</span><span class="ident" id="5913900">t</span>&nbsp;<span class="builtintype" id="5913902">string</span><span class="op" id="5913908">)</span>&nbsp;<span class="op" id="5913910">(</span><span class="ident" id="5913911">time</span><span class="op" id="5913915">.</span><span class="ident" id="5913916">Time</span><span class="op" id="5913920">,</span>&nbsp;<span class="builtintype" id="5913922">error</span><span class="op" id="5913927">)</span>&nbsp;<span class="op" id="5913929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913932">buf</span>&nbsp;<span class="op" id="5913936">:=</span>&nbsp;<span class="op" id="5913939">[</span><span class="op" id="5913940">]</span><span class="builtintype" id="5913941">byte</span><span class="op" id="5913945">(</span><span class="ident" id="5913946">t</span><span class="op" id="5913947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913950">pos</span>&nbsp;<span class="op" id="5913954">:=</span>&nbsp;<span class="ident" id="5913957">bytes</span><span class="op" id="5913962">.</span><span class="ident" id="5913963">IndexByte</span><span class="op" id="5913972">(</span><span class="ident" id="5913973">buf</span><span class="op" id="5913976">,</span>&nbsp;<span class="string" id="5913978">&#39;.&#39;</span><span class="op" id="5913981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913984">var</span>&nbsp;<span class="ident" id="5913988">seconds</span><span class="op" id="5913995">,</span>&nbsp;<span class="ident" id="5913997">nanoseconds</span>&nbsp;<span class="ident" id="5914009">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914016">var</span>&nbsp;<span class="ident" id="5914020">err</span>&nbsp;<span class="builtintype" id="5914024">error</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914031">if</span>&nbsp;<span class="ident" id="5914034">pos</span>&nbsp;<span class="op" id="5914038">==</span>&nbsp;<span class="op" id="5914041">-</span><span class="num" id="5914042">1</span>&nbsp;<span class="op" id="5914044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914048">seconds</span><span class="op" id="5914055">,</span>&nbsp;<span class="ident" id="5914057">err</span>&nbsp;<span class="op" id="5914061">=</span>&nbsp;<span class="ident" id="5914063">strconv</span><span class="op" id="5914070">.</span><span class="ident" id="5914071">ParseInt</span><span class="op" id="5914079">(</span><span class="ident" id="5914080">t</span><span class="op" id="5914081">,</span>&nbsp;<span class="num" id="5914083">10</span><span class="op" id="5914085">,</span>&nbsp;<span class="num" id="5914087">0</span><span class="op" id="5914088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914092">if</span>&nbsp;<span class="ident" id="5914095">err</span>&nbsp;<span class="op" id="5914099">!=</span>&nbsp;<span class="ident" id="5914102">nil</span>&nbsp;<span class="op" id="5914106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914111">return</span>&nbsp;<span class="ident" id="5914118">time</span><span class="op" id="5914122">.</span><span class="ident" id="5914123">Time</span><span class="op" id="5914127">{</span><span class="op" id="5914128">}</span><span class="op" id="5914129">,</span>&nbsp;<span class="ident" id="5914131">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914137">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914140">}</span>&nbsp;<span class="keyword" id="5914142">else</span>&nbsp;<span class="op" id="5914147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914151">seconds</span><span class="op" id="5914158">,</span>&nbsp;<span class="ident" id="5914160">err</span>&nbsp;<span class="op" id="5914164">=</span>&nbsp;<span class="ident" id="5914166">strconv</span><span class="op" id="5914173">.</span><span class="ident" id="5914174">ParseInt</span><span class="op" id="5914182">(</span><span class="builtintype" id="5914183">string</span><span class="op" id="5914189">(</span><span class="ident" id="5914190">buf</span><span class="op" id="5914193">[</span><span class="op" id="5914194">:</span><span class="ident" id="5914195">pos</span><span class="op" id="5914198">]</span><span class="op" id="5914199">)</span><span class="op" id="5914200">,</span>&nbsp;<span class="num" id="5914202">10</span><span class="op" id="5914204">,</span>&nbsp;<span class="num" id="5914206">0</span><span class="op" id="5914207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914211">if</span>&nbsp;<span class="ident" id="5914214">err</span>&nbsp;<span class="op" id="5914218">!=</span>&nbsp;<span class="ident" id="5914221">nil</span>&nbsp;<span class="op" id="5914225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914230">return</span>&nbsp;<span class="ident" id="5914237">time</span><span class="op" id="5914241">.</span><span class="ident" id="5914242">Time</span><span class="op" id="5914246">{</span><span class="op" id="5914247">}</span><span class="op" id="5914248">,</span>&nbsp;<span class="ident" id="5914250">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914256">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914260">nano_buf</span>&nbsp;<span class="op" id="5914269">:=</span>&nbsp;<span class="builtintype" id="5914272">string</span><span class="op" id="5914278">(</span><span class="ident" id="5914279">buf</span><span class="op" id="5914282">[</span><span class="ident" id="5914283">pos</span><span class="op" id="5914286">+</span><span class="num" id="5914287">1</span><span class="op" id="5914288">:</span><span class="op" id="5914289">]</span><span class="op" id="5914290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914294">//&nbsp;Pad&nbsp;as&nbsp;needed&nbsp;before&nbsp;converting&nbsp;to&nbsp;a&nbsp;decimal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914345">//&nbsp;For&nbsp;example&nbsp;.030&nbsp;-&gt;&nbsp;.030000000&nbsp;-&gt;&nbsp;30000000&nbsp;nanoseconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914405">if</span>&nbsp;<span class="builtinfunc" id="5914408">len</span><span class="op" id="5914411">(</span><span class="ident" id="5914412">nano_buf</span><span class="op" id="5914420">)</span>&nbsp;<span class="op" id="5914422">&lt;</span>&nbsp;<span class="ident" id="5914424">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5914445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914450">//&nbsp;Right&nbsp;pad</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914466">nano_buf</span>&nbsp;<span class="op" id="5914475">+=</span>&nbsp;<span class="ident" id="5914478">strings</span><span class="op" id="5914485">.</span><span class="ident" id="5914486">Repeat</span><span class="op" id="5914492">(</span><span class="string" id="5914493">&#34;0&#34;</span><span class="op" id="5914496">,</span>&nbsp;<span class="ident" id="5914498">maxNanoSecondIntSize</span><span class="op" id="5914518">-</span><span class="builtinfunc" id="5914519">len</span><span class="op" id="5914522">(</span><span class="ident" id="5914523">nano_buf</span><span class="op" id="5914531">)</span><span class="op" id="5914532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914536">}</span>&nbsp;<span class="keyword" id="5914538">else</span>&nbsp;<span class="keyword" id="5914543">if</span>&nbsp;<span class="builtinfunc" id="5914546">len</span><span class="op" id="5914549">(</span><span class="ident" id="5914550">nano_buf</span><span class="op" id="5914558">)</span>&nbsp;<span class="op" id="5914560">&gt;</span>&nbsp;<span class="ident" id="5914562">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5914583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914588">//&nbsp;Right&nbsp;truncate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914609">nano_buf</span>&nbsp;<span class="op" id="5914618">=</span>&nbsp;<span class="ident" id="5914620">nano_buf</span><span class="op" id="5914628">[</span><span class="op" id="5914629">:</span><span class="ident" id="5914630">maxNanoSecondIntSize</span><span class="op" id="5914650">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914654">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914658">nanoseconds</span><span class="op" id="5914669">,</span>&nbsp;<span class="ident" id="5914671">err</span>&nbsp;<span class="op" id="5914675">=</span>&nbsp;<span class="ident" id="5914677">strconv</span><span class="op" id="5914684">.</span><span class="ident" id="5914685">ParseInt</span><span class="op" id="5914693">(</span><span class="builtintype" id="5914694">string</span><span class="op" id="5914700">(</span><span class="ident" id="5914701">nano_buf</span><span class="op" id="5914709">)</span><span class="op" id="5914710">,</span>&nbsp;<span class="num" id="5914712">10</span><span class="op" id="5914714">,</span>&nbsp;<span class="num" id="5914716">0</span><span class="op" id="5914717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914721">if</span>&nbsp;<span class="ident" id="5914724">err</span>&nbsp;<span class="op" id="5914728">!=</span>&nbsp;<span class="ident" id="5914731">nil</span>&nbsp;<span class="op" id="5914735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914740">return</span>&nbsp;<span class="ident" id="5914747">time</span><span class="op" id="5914751">.</span><span class="ident" id="5914752">Time</span><span class="op" id="5914756">{</span><span class="op" id="5914757">}</span><span class="op" id="5914758">,</span>&nbsp;<span class="ident" id="5914760">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914769">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914772">ts</span>&nbsp;<span class="op" id="5914775">:=</span>&nbsp;<span class="ident" id="5914778">time</span><span class="op" id="5914782">.</span><span class="ident" id="5914783">Unix</span><span class="op" id="5914787">(</span><span class="ident" id="5914788">seconds</span><span class="op" id="5914795">,</span>&nbsp;<span class="ident" id="5914797">nanoseconds</span><span class="op" id="5914808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914811">return</span>&nbsp;<span class="ident" id="5914818">ts</span><span class="op" id="5914820">,</span>&nbsp;<span class="ident" id="5914822">nil</span><br>
<span class="lineno"></span><span class="op" id="5914826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5914829">//&nbsp;parsePAX&nbsp;parses&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno">310</span><span class="comment" id="5914861">//&nbsp;If&nbsp;an&nbsp;extended&nbsp;header&nbsp;(type&nbsp;&#39;x&#39;)&nbsp;is&nbsp;invalid,&nbsp;ErrHeader&nbsp;is&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="5914931">func</span>&nbsp;<span class="ident" id="5914936">parsePAX</span><span class="op" id="5914944">(</span><span class="ident" id="5914945">r</span>&nbsp;<span class="ident" id="5914947">io</span><span class="op" id="5914949">.</span><span class="ident" id="5914950">Reader</span><span class="op" id="5914956">)</span>&nbsp;<span class="op" id="5914958">(</span><span class="keyword" id="5914959">map</span><span class="op" id="5914962">[</span><span class="builtintype" id="5914963">string</span><span class="op" id="5914969">]</span><span class="builtintype" id="5914970">string</span><span class="op" id="5914976">,</span>&nbsp;<span class="builtintype" id="5914978">error</span><span class="op" id="5914983">)</span>&nbsp;<span class="op" id="5914985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914988">buf</span><span class="op" id="5914991">,</span>&nbsp;<span class="ident" id="5914993">err</span>&nbsp;<span class="op" id="5914997">:=</span>&nbsp;<span class="ident" id="5915000">ioutil</span><span class="op" id="5915006">.</span><span class="ident" id="5915007">ReadAll</span><span class="op" id="5915014">(</span><span class="ident" id="5915015">r</span><span class="op" id="5915016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915019">if</span>&nbsp;<span class="ident" id="5915022">err</span>&nbsp;<span class="op" id="5915026">!=</span>&nbsp;<span class="ident" id="5915029">nil</span>&nbsp;<span class="op" id="5915033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915037">return</span>&nbsp;<span class="ident" id="5915044">nil</span><span class="op" id="5915047">,</span>&nbsp;<span class="ident" id="5915049">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915058">//&nbsp;For&nbsp;GNU&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915101">//&nbsp;This&nbsp;function&nbsp;transforms&nbsp;the&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;headers&nbsp;into&nbsp;sparse&nbsp;format&nbsp;0.1&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915192">var</span>&nbsp;<span class="ident" id="5915196">sparseMap</span>&nbsp;<span class="ident" id="5915206">bytes</span><span class="op" id="5915211">.</span><span class="ident" id="5915212">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915221">headers</span>&nbsp;<span class="op" id="5915229">:=</span>&nbsp;<span class="builtinfunc" id="5915232">make</span><span class="op" id="5915236">(</span><span class="keyword" id="5915237">map</span><span class="op" id="5915240">[</span><span class="builtintype" id="5915241">string</span><span class="op" id="5915247">]</span><span class="builtintype" id="5915248">string</span><span class="op" id="5915254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915257">//&nbsp;Each&nbsp;record&nbsp;is&nbsp;constructed&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915291">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;%d&nbsp;%s=%s\n&#34;,&nbsp;length,&nbsp;keyword,&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915336">for</span>&nbsp;<span class="builtinfunc" id="5915340">len</span><span class="op" id="5915343">(</span><span class="ident" id="5915344">buf</span><span class="op" id="5915347">)</span>&nbsp;<span class="op" id="5915349">&gt;</span>&nbsp;<span class="num" id="5915351">0</span>&nbsp;<span class="op" id="5915353">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915357">//&nbsp;or&nbsp;the&nbsp;header&nbsp;was&nbsp;empty&nbsp;to&nbsp;start&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915401">var</span>&nbsp;<span class="ident" id="5915405">sp</span>&nbsp;<span class="builtintype" id="5915408">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915414">//&nbsp;The&nbsp;size&nbsp;field&nbsp;ends&nbsp;at&nbsp;the&nbsp;first&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915459">sp</span>&nbsp;<span class="op" id="5915462">=</span>&nbsp;<span class="ident" id="5915464">bytes</span><span class="op" id="5915469">.</span><span class="ident" id="5915470">IndexByte</span><span class="op" id="5915479">(</span><span class="ident" id="5915480">buf</span><span class="op" id="5915483">,</span>&nbsp;<span class="string" id="5915485">&#39;&nbsp;&#39;</span><span class="op" id="5915488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915492">if</span>&nbsp;<span class="ident" id="5915495">sp</span>&nbsp;<span class="op" id="5915498">==</span>&nbsp;<span class="op" id="5915501">-</span><span class="num" id="5915502">1</span>&nbsp;<span class="op" id="5915504">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915509">return</span>&nbsp;<span class="ident" id="5915516">nil</span><span class="op" id="5915519">,</span>&nbsp;<span class="ident" id="5915521">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915537">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;token&nbsp;as&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915586">n</span><span class="op" id="5915587">,</span>&nbsp;<span class="ident" id="5915589">err</span>&nbsp;<span class="op" id="5915593">:=</span>&nbsp;<span class="ident" id="5915596">strconv</span><span class="op" id="5915603">.</span><span class="ident" id="5915604">ParseInt</span><span class="op" id="5915612">(</span><span class="builtintype" id="5915613">string</span><span class="op" id="5915619">(</span><span class="ident" id="5915620">buf</span><span class="op" id="5915623">[</span><span class="op" id="5915624">:</span><span class="ident" id="5915625">sp</span><span class="op" id="5915627">]</span><span class="op" id="5915628">)</span><span class="op" id="5915629">,</span>&nbsp;<span class="num" id="5915631">10</span><span class="op" id="5915633">,</span>&nbsp;<span class="num" id="5915635">0</span><span class="op" id="5915636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915640">if</span>&nbsp;<span class="ident" id="5915643">err</span>&nbsp;<span class="op" id="5915647">!=</span>&nbsp;<span class="ident" id="5915650">nil</span>&nbsp;<span class="op" id="5915654">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915659">return</span>&nbsp;<span class="ident" id="5915666">nil</span><span class="op" id="5915669">,</span>&nbsp;<span class="ident" id="5915671">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915687">//&nbsp;Extract&nbsp;everything&nbsp;between&nbsp;the&nbsp;decimal&nbsp;and&nbsp;the&nbsp;n&nbsp;-1&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915751">//&nbsp;beginning&nbsp;to&nbsp;eat&nbsp;the&nbsp;&#39;&nbsp;&#39;,&nbsp;-1&nbsp;on&nbsp;the&nbsp;end&nbsp;to&nbsp;skip&nbsp;the&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915817">var</span>&nbsp;<span class="ident" id="5915821">record</span>&nbsp;<span class="op" id="5915828">[</span><span class="op" id="5915829">]</span><span class="builtintype" id="5915830">byte</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915837">record</span><span class="op" id="5915843">,</span>&nbsp;<span class="ident" id="5915845">buf</span>&nbsp;<span class="op" id="5915849">=</span>&nbsp;<span class="ident" id="5915851">buf</span><span class="op" id="5915854">[</span><span class="ident" id="5915855">sp</span><span class="op" id="5915857">+</span><span class="num" id="5915858">1</span><span class="op" id="5915859">:</span><span class="ident" id="5915860">n</span><span class="op" id="5915861">-</span><span class="num" id="5915862">1</span><span class="op" id="5915863">]</span><span class="op" id="5915864">,</span>&nbsp;<span class="ident" id="5915866">buf</span><span class="op" id="5915869">[</span><span class="ident" id="5915870">n</span><span class="op" id="5915871">:</span><span class="op" id="5915872">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915876">//&nbsp;The&nbsp;first&nbsp;equals&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915940">//&nbsp;Everything&nbsp;else&nbsp;is&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915971">eq</span>&nbsp;<span class="op" id="5915974">:=</span>&nbsp;<span class="ident" id="5915977">bytes</span><span class="op" id="5915982">.</span><span class="ident" id="5915983">IndexByte</span><span class="op" id="5915992">(</span><span class="ident" id="5915993">record</span><span class="op" id="5915999">,</span>&nbsp;<span class="string" id="5916001">&#39;=&#39;</span><span class="op" id="5916004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916008">if</span>&nbsp;<span class="ident" id="5916011">eq</span>&nbsp;<span class="op" id="5916014">==</span>&nbsp;<span class="op" id="5916017">-</span><span class="num" id="5916018">1</span>&nbsp;<span class="op" id="5916020">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916025">return</span>&nbsp;<span class="ident" id="5916032">nil</span><span class="op" id="5916035">,</span>&nbsp;<span class="ident" id="5916037">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916053">key</span><span class="op" id="5916056">,</span>&nbsp;<span class="ident" id="5916058">value</span>&nbsp;<span class="op" id="5916064">:=</span>&nbsp;<span class="ident" id="5916067">record</span><span class="op" id="5916073">[</span><span class="op" id="5916074">:</span><span class="ident" id="5916075">eq</span><span class="op" id="5916077">]</span><span class="op" id="5916078">,</span>&nbsp;<span class="ident" id="5916080">record</span><span class="op" id="5916086">[</span><span class="ident" id="5916087">eq</span><span class="op" id="5916089">+</span><span class="num" id="5916090">1</span><span class="op" id="5916091">:</span><span class="op" id="5916092">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916097">keyStr</span>&nbsp;<span class="op" id="5916104">:=</span>&nbsp;<span class="builtintype" id="5916107">string</span><span class="op" id="5916113">(</span><span class="ident" id="5916114">key</span><span class="op" id="5916117">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916121">if</span>&nbsp;<span class="ident" id="5916124">keyStr</span>&nbsp;<span class="op" id="5916131">==</span>&nbsp;<span class="ident" id="5916134">paxGNUSparseOffset</span>&nbsp;<span class="op" id="5916153">||</span>&nbsp;<span class="ident" id="5916156">keyStr</span>&nbsp;<span class="op" id="5916163">==</span>&nbsp;<span class="ident" id="5916166">paxGNUSparseNumBytes</span>&nbsp;<span class="op" id="5916187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916192">//&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;special&nbsp;key.&nbsp;Write&nbsp;to&nbsp;sparseMap&nbsp;instead&nbsp;of&nbsp;using&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916286">sparseMap</span><span class="op" id="5916295">.</span><span class="ident" id="5916296">Write</span><span class="op" id="5916301">(</span><span class="ident" id="5916302">value</span><span class="op" id="5916307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916312">sparseMap</span><span class="op" id="5916321">.</span><span class="ident" id="5916322">Write</span><span class="op" id="5916327">(</span><span class="op" id="5916328">[</span><span class="op" id="5916329">]</span><span class="builtintype" id="5916330">byte</span><span class="op" id="5916334">{</span><span class="string" id="5916335">&#39;,&#39;</span><span class="op" id="5916338">}</span><span class="op" id="5916339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916343">}</span>&nbsp;<span class="keyword" id="5916345">else</span>&nbsp;<span class="op" id="5916350">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916355">//&nbsp;Normal&nbsp;key.&nbsp;Set&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916407">headers</span><span class="op" id="5916414">[</span><span class="ident" id="5916415">keyStr</span><span class="op" id="5916421">]</span>&nbsp;<span class="op" id="5916423">=</span>&nbsp;<span class="builtintype" id="5916425">string</span><span class="op" id="5916431">(</span><span class="ident" id="5916432">value</span><span class="op" id="5916437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916447">if</span>&nbsp;<span class="ident" id="5916450">sparseMap</span><span class="op" id="5916459">.</span><span class="ident" id="5916460">Len</span><span class="op" id="5916463">(</span><span class="op" id="5916464">)</span>&nbsp;<span class="op" id="5916466">!=</span>&nbsp;<span class="num" id="5916469">0</span>&nbsp;<span class="op" id="5916471">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916475">//&nbsp;Add&nbsp;sparse&nbsp;info&nbsp;to&nbsp;headers,&nbsp;chopping&nbsp;off&nbsp;the&nbsp;extra&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916537">sparseMap</span><span class="op" id="5916546">.</span><span class="ident" id="5916547">Truncate</span><span class="op" id="5916555">(</span><span class="ident" id="5916556">sparseMap</span><span class="op" id="5916565">.</span><span class="ident" id="5916566">Len</span><span class="op" id="5916569">(</span><span class="op" id="5916570">)</span>&nbsp;<span class="op" id="5916572">-</span>&nbsp;<span class="num" id="5916574">1</span><span class="op" id="5916575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916579">headers</span><span class="op" id="5916586">[</span><span class="ident" id="5916587">paxGNUSparseMap</span><span class="op" id="5916602">]</span>&nbsp;<span class="op" id="5916604">=</span>&nbsp;<span class="ident" id="5916606">sparseMap</span><span class="op" id="5916615">.</span><span class="ident" id="5916616">String</span><span class="op" id="5916622">(</span><span class="op" id="5916623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916629">return</span>&nbsp;<span class="ident" id="5916636">headers</span><span class="op" id="5916643">,</span>&nbsp;<span class="ident" id="5916645">nil</span><br>
<span class="lineno">365</span><span class="op" id="5916649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5916652">//&nbsp;cString&nbsp;parses&nbsp;bytes&nbsp;as&nbsp;a&nbsp;NUL-terminated&nbsp;C-style&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="5916712">//&nbsp;If&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;is&nbsp;not&nbsp;found&nbsp;then&nbsp;the&nbsp;whole&nbsp;slice&nbsp;is&nbsp;returned&nbsp;as&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5916788">func</span>&nbsp;<span class="ident" id="5916793">cString</span><span class="op" id="5916800">(</span><span class="ident" id="5916801">b</span>&nbsp;<span class="op" id="5916803">[</span><span class="op" id="5916804">]</span><span class="builtintype" id="5916805">byte</span><span class="op" id="5916809">)</span>&nbsp;<span class="builtintype" id="5916811">string</span>&nbsp;<span class="op" id="5916818">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916821">n</span>&nbsp;<span class="op" id="5916823">:=</span>&nbsp;<span class="num" id="5916826">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916829">for</span>&nbsp;<span class="ident" id="5916833">n</span>&nbsp;<span class="op" id="5916835">&lt;</span>&nbsp;<span class="builtinfunc" id="5916837">len</span><span class="op" id="5916840">(</span><span class="ident" id="5916841">b</span><span class="op" id="5916842">)</span>&nbsp;<span class="op" id="5916844">&amp;&amp;</span>&nbsp;<span class="ident" id="5916847">b</span><span class="op" id="5916848">[</span><span class="ident" id="5916849">n</span><span class="op" id="5916850">]</span>&nbsp;<span class="op" id="5916852">!=</span>&nbsp;<span class="num" id="5916855">0</span>&nbsp;<span class="op" id="5916857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916861">n</span><span class="op" id="5916862">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916869">return</span>&nbsp;<span class="builtintype" id="5916876">string</span><span class="op" id="5916882">(</span><span class="ident" id="5916883">b</span><span class="op" id="5916884">[</span><span class="num" id="5916885">0</span><span class="op" id="5916886">:</span><span class="ident" id="5916887">n</span><span class="op" id="5916888">]</span><span class="op" id="5916889">)</span><br>
<span class="lineno">375</span><span class="op" id="5916891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5916894">func</span>&nbsp;<span class="op" id="5916899">(</span><span class="ident" id="5916900">tr</span>&nbsp;<span class="op" id="5916903">*</span><span class="ident" id="5916904">Reader</span><span class="op" id="5916910">)</span>&nbsp;<span class="ident" id="5916912">octal</span><span class="op" id="5916917">(</span><span class="ident" id="5916918">b</span>&nbsp;<span class="op" id="5916920">[</span><span class="op" id="5916921">]</span><span class="builtintype" id="5916922">byte</span><span class="op" id="5916926">)</span>&nbsp;<span class="ident" id="5916928">int64</span>&nbsp;<span class="op" id="5916934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916937">//&nbsp;Check&nbsp;for&nbsp;binary&nbsp;format&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916972">if</span>&nbsp;<span class="builtinfunc" id="5916975">len</span><span class="op" id="5916978">(</span><span class="ident" id="5916979">b</span><span class="op" id="5916980">)</span>&nbsp;<span class="op" id="5916982">&gt;</span>&nbsp;<span class="num" id="5916984">0</span>&nbsp;<span class="op" id="5916986">&amp;&amp;</span>&nbsp;<span class="ident" id="5916989">b</span><span class="op" id="5916990">[</span><span class="num" id="5916991">0</span><span class="op" id="5916992">]</span><span class="op" id="5916993">&amp;</span><span class="num" id="5916994">0x80</span>&nbsp;<span class="op" id="5916999">!=</span>&nbsp;<span class="num" id="5917002">0</span>&nbsp;<span class="op" id="5917004">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917008">var</span>&nbsp;<span class="ident" id="5917012">x</span>&nbsp;<span class="ident" id="5917014">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917022">for</span>&nbsp;<span class="ident" id="5917026">i</span><span class="op" id="5917027">,</span>&nbsp;<span class="ident" id="5917029">c</span>&nbsp;<span class="op" id="5917031">:=</span>&nbsp;<span class="keyword" id="5917034">range</span>&nbsp;<span class="ident" id="5917040">b</span>&nbsp;<span class="op" id="5917042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917047">if</span>&nbsp;<span class="ident" id="5917050">i</span>&nbsp;<span class="op" id="5917052">==</span>&nbsp;<span class="num" id="5917055">0</span>&nbsp;<span class="op" id="5917057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917063">c</span>&nbsp;<span class="op" id="5917065">&amp;=</span>&nbsp;<span class="num" id="5917068">0x7f</span>&nbsp;<span class="comment" id="5917073">//&nbsp;ignore&nbsp;signal&nbsp;bit&nbsp;in&nbsp;first&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917111">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917116">x</span>&nbsp;<span class="op" id="5917118">=</span>&nbsp;<span class="ident" id="5917120">x</span><span class="op" id="5917121">&lt;&lt;</span><span class="num" id="5917123">8</span>&nbsp;<span class="op" id="5917125">|</span>&nbsp;<span class="ident" id="5917127">int64</span><span class="op" id="5917132">(</span><span class="ident" id="5917133">c</span><span class="op" id="5917134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917142">return</span>&nbsp;<span class="ident" id="5917149">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917156">//&nbsp;Because&nbsp;unused&nbsp;fields&nbsp;are&nbsp;filled&nbsp;with&nbsp;NULs,&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917212">//&nbsp;to&nbsp;skip&nbsp;leading&nbsp;NULs.&nbsp;Fields&nbsp;may&nbsp;also&nbsp;be&nbsp;padded&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917269">//&nbsp;spaces&nbsp;or&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917289">//&nbsp;So&nbsp;we&nbsp;remove&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;NULs&nbsp;and&nbsp;spaces&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917346">//&nbsp;be&nbsp;sure.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917359">b</span>&nbsp;<span class="op" id="5917361">=</span>&nbsp;<span class="ident" id="5917363">bytes</span><span class="op" id="5917368">.</span><span class="ident" id="5917369">Trim</span><span class="op" id="5917373">(</span><span class="ident" id="5917374">b</span><span class="op" id="5917375">,</span>&nbsp;<span class="string" id="5917377">&#34;&nbsp;\x00&#34;</span><span class="op" id="5917384">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917388">if</span>&nbsp;<span class="builtinfunc" id="5917391">len</span><span class="op" id="5917394">(</span><span class="ident" id="5917395">b</span><span class="op" id="5917396">)</span>&nbsp;<span class="op" id="5917398">==</span>&nbsp;<span class="num" id="5917401">0</span>&nbsp;<span class="op" id="5917403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917407">return</span>&nbsp;<span class="num" id="5917414">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917417">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917420">x</span><span class="op" id="5917421">,</span>&nbsp;<span class="ident" id="5917423">err</span>&nbsp;<span class="op" id="5917427">:=</span>&nbsp;<span class="ident" id="5917430">strconv</span><span class="op" id="5917437">.</span><span class="ident" id="5917438">ParseUint</span><span class="op" id="5917447">(</span><span class="ident" id="5917448">cString</span><span class="op" id="5917455">(</span><span class="ident" id="5917456">b</span><span class="op" id="5917457">)</span><span class="op" id="5917458">,</span>&nbsp;<span class="num" id="5917460">8</span><span class="op" id="5917461">,</span>&nbsp;<span class="num" id="5917463">64</span><span class="op" id="5917465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917468">if</span>&nbsp;<span class="ident" id="5917471">err</span>&nbsp;<span class="op" id="5917475">!=</span>&nbsp;<span class="ident" id="5917478">nil</span>&nbsp;<span class="op" id="5917482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917486">tr</span><span class="op" id="5917488">.</span><span class="ident" id="5917489">err</span>&nbsp;<span class="op" id="5917493">=</span>&nbsp;<span class="ident" id="5917495">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917503">return</span>&nbsp;<span class="ident" id="5917510">int64</span><span class="op" id="5917515">(</span><span class="ident" id="5917516">x</span><span class="op" id="5917517">)</span><br>
<span class="lineno">405</span><span class="op" id="5917519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5917522">//&nbsp;skipUnread&nbsp;skips&nbsp;any&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;the&nbsp;existing&nbsp;file&nbsp;entry,&nbsp;as&nbsp;well&nbsp;as&nbsp;any&nbsp;alignment&nbsp;padding.</span><br>
<span class="lineno"></span><span class="keyword" id="5917621">func</span>&nbsp;<span class="op" id="5917626">(</span><span class="ident" id="5917627">tr</span>&nbsp;<span class="op" id="5917630">*</span><span class="ident" id="5917631">Reader</span><span class="op" id="5917637">)</span>&nbsp;<span class="ident" id="5917639">skipUnread</span><span class="op" id="5917649">(</span><span class="op" id="5917650">)</span>&nbsp;<span class="op" id="5917652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917655">nr</span>&nbsp;<span class="op" id="5917658">:=</span>&nbsp;<span class="ident" id="5917661">tr</span><span class="op" id="5917663">.</span><span class="ident" id="5917664">numBytes</span><span class="op" id="5917672">(</span><span class="op" id="5917673">)</span>&nbsp;<span class="op" id="5917675">+</span>&nbsp;<span class="ident" id="5917677">tr</span><span class="op" id="5917679">.</span><span class="ident" id="5917680">pad</span>&nbsp;<span class="comment" id="5917684">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;skip</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917712">tr</span><span class="op" id="5917714">.</span><span class="ident" id="5917715">curr</span><span class="op" id="5917719">,</span>&nbsp;<span class="ident" id="5917721">tr</span><span class="op" id="5917723">.</span><span class="ident" id="5917724">pad</span>&nbsp;<span class="op" id="5917728">=</span>&nbsp;<span class="ident" id="5917730">nil</span><span class="op" id="5917733">,</span>&nbsp;<span class="num" id="5917735">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917738">if</span>&nbsp;<span class="ident" id="5917741">sr</span><span class="op" id="5917743">,</span>&nbsp;<span class="ident" id="5917745">ok</span>&nbsp;<span class="op" id="5917748">:=</span>&nbsp;<span class="ident" id="5917751">tr</span><span class="op" id="5917753">.</span><span class="ident" id="5917754">r</span><span class="op" id="5917755">.</span><span class="op" id="5917756">(</span><span class="ident" id="5917757">io</span><span class="op" id="5917759">.</span><span class="ident" id="5917760">Seeker</span><span class="op" id="5917766">)</span><span class="op" id="5917767">;</span>&nbsp;<span class="ident" id="5917769">ok</span>&nbsp;<span class="op" id="5917772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917776">if</span>&nbsp;<span class="ident" id="5917779">_</span><span class="op" id="5917780">,</span>&nbsp;<span class="ident" id="5917782">err</span>&nbsp;<span class="op" id="5917786">:=</span>&nbsp;<span class="ident" id="5917789">sr</span><span class="op" id="5917791">.</span><span class="ident" id="5917792">Seek</span><span class="op" id="5917796">(</span><span class="ident" id="5917797">nr</span><span class="op" id="5917799">,</span>&nbsp;<span class="ident" id="5917801">os</span><span class="op" id="5917803">.</span><span class="ident" id="5917804">SEEK_CUR</span><span class="op" id="5917812">)</span><span class="op" id="5917813">;</span>&nbsp;<span class="ident" id="5917815">err</span>&nbsp;<span class="op" id="5917819">==</span>&nbsp;<span class="ident" id="5917822">nil</span>&nbsp;<span class="op" id="5917826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917831">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917840">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917846">_</span><span class="op" id="5917847">,</span>&nbsp;<span class="ident" id="5917849">tr</span><span class="op" id="5917851">.</span><span class="ident" id="5917852">err</span>&nbsp;<span class="op" id="5917856">=</span>&nbsp;<span class="ident" id="5917858">io</span><span class="op" id="5917860">.</span><span class="ident" id="5917861">CopyN</span><span class="op" id="5917866">(</span><span class="ident" id="5917867">ioutil</span><span class="op" id="5917873">.</span><span class="ident" id="5917874">Discard</span><span class="op" id="5917881">,</span>&nbsp;<span class="ident" id="5917883">tr</span><span class="op" id="5917885">.</span><span class="ident" id="5917886">r</span><span class="op" id="5917887">,</span>&nbsp;<span class="ident" id="5917889">nr</span><span class="op" id="5917891">)</span><br>
<span class="lineno"></span><span class="op" id="5917893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5917896">func</span>&nbsp;<span class="op" id="5917901">(</span><span class="ident" id="5917902">tr</span>&nbsp;<span class="op" id="5917905">*</span><span class="ident" id="5917906">Reader</span><span class="op" id="5917912">)</span>&nbsp;<span class="ident" id="5917914">verifyChecksum</span><span class="op" id="5917928">(</span><span class="ident" id="5917929">header</span>&nbsp;<span class="op" id="5917936">[</span><span class="op" id="5917937">]</span><span class="builtintype" id="5917938">byte</span><span class="op" id="5917942">)</span>&nbsp;<span class="builtintype" id="5917944">bool</span>&nbsp;<span class="op" id="5917949">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917952">if</span>&nbsp;<span class="ident" id="5917955">tr</span><span class="op" id="5917957">.</span><span class="ident" id="5917958">err</span>&nbsp;<span class="op" id="5917962">!=</span>&nbsp;<span class="ident" id="5917965">nil</span>&nbsp;<span class="op" id="5917969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917973">return</span>&nbsp;<span class="builtintype" id="5917980">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917991">given</span>&nbsp;<span class="op" id="5917997">:=</span>&nbsp;<span class="ident" id="5918000">tr</span><span class="op" id="5918002">.</span><span class="ident" id="5918003">octal</span><span class="op" id="5918008">(</span><span class="ident" id="5918009">header</span><span class="op" id="5918015">[</span><span class="num" id="5918016">148</span><span class="op" id="5918019">:</span><span class="num" id="5918020">156</span><span class="op" id="5918023">]</span><span class="op" id="5918024">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918027">unsigned</span><span class="op" id="5918035">,</span>&nbsp;<span class="ident" id="5918037">signed</span>&nbsp;<span class="op" id="5918044">:=</span>&nbsp;<span class="ident" id="5918047">checksum</span><span class="op" id="5918055">(</span><span class="ident" id="5918056">header</span><span class="op" id="5918062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918065">return</span>&nbsp;<span class="ident" id="5918072">given</span>&nbsp;<span class="op" id="5918078">==</span>&nbsp;<span class="ident" id="5918081">unsigned</span>&nbsp;<span class="op" id="5918090">||</span>&nbsp;<span class="ident" id="5918093">given</span>&nbsp;<span class="op" id="5918099">==</span>&nbsp;<span class="ident" id="5918102">signed</span><br>
<span class="lineno"></span><span class="op" id="5918109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5918112">func</span>&nbsp;<span class="op" id="5918117">(</span><span class="ident" id="5918118">tr</span>&nbsp;<span class="op" id="5918121">*</span><span class="ident" id="5918122">Reader</span><span class="op" id="5918128">)</span>&nbsp;<span class="ident" id="5918130">readHeader</span><span class="op" id="5918140">(</span><span class="op" id="5918141">)</span>&nbsp;<span class="op" id="5918143">*</span><span class="ident" id="5918144">Header</span>&nbsp;<span class="op" id="5918151">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918154">header</span>&nbsp;<span class="op" id="5918161">:=</span>&nbsp;<span class="ident" id="5918164">tr</span><span class="op" id="5918166">.</span><span class="ident" id="5918167">hdrBuff</span><span class="op" id="5918174">[</span><span class="op" id="5918175">:</span><span class="op" id="5918176">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5918179">copy</span><span class="op" id="5918183">(</span><span class="ident" id="5918184">header</span><span class="op" id="5918190">,</span>&nbsp;<span class="ident" id="5918192">zeroBlock</span><span class="op" id="5918201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918205">if</span>&nbsp;<span class="ident" id="5918208">_</span><span class="op" id="5918209">,</span>&nbsp;<span class="ident" id="5918211">tr</span><span class="op" id="5918213">.</span><span class="ident" id="5918214">err</span>&nbsp;<span class="op" id="5918218">=</span>&nbsp;<span class="ident" id="5918220">io</span><span class="op" id="5918222">.</span><span class="ident" id="5918223">ReadFull</span><span class="op" id="5918231">(</span><span class="ident" id="5918232">tr</span><span class="op" id="5918234">.</span><span class="ident" id="5918235">r</span><span class="op" id="5918236">,</span>&nbsp;<span class="ident" id="5918238">header</span><span class="op" id="5918244">)</span><span class="op" id="5918245">;</span>&nbsp;<span class="ident" id="5918247">tr</span><span class="op" id="5918249">.</span><span class="ident" id="5918250">err</span>&nbsp;<span class="op" id="5918254">!=</span>&nbsp;<span class="ident" id="5918257">nil</span>&nbsp;<span class="op" id="5918261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918265">return</span>&nbsp;<span class="ident" id="5918272">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918281">//&nbsp;Two&nbsp;blocks&nbsp;of&nbsp;zero&nbsp;bytes&nbsp;marks&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918340">if</span>&nbsp;<span class="ident" id="5918343">bytes</span><span class="op" id="5918348">.</span><span class="ident" id="5918349">Equal</span><span class="op" id="5918354">(</span><span class="ident" id="5918355">header</span><span class="op" id="5918361">,</span>&nbsp;<span class="ident" id="5918363">zeroBlock</span><span class="op" id="5918372">[</span><span class="num" id="5918373">0</span><span class="op" id="5918374">:</span><span class="ident" id="5918375">blockSize</span><span class="op" id="5918384">]</span><span class="op" id="5918385">)</span>&nbsp;<span class="op" id="5918387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918391">if</span>&nbsp;<span class="ident" id="5918394">_</span><span class="op" id="5918395">,</span>&nbsp;<span class="ident" id="5918397">tr</span><span class="op" id="5918399">.</span><span class="ident" id="5918400">err</span>&nbsp;<span class="op" id="5918404">=</span>&nbsp;<span class="ident" id="5918406">io</span><span class="op" id="5918408">.</span><span class="ident" id="5918409">ReadFull</span><span class="op" id="5918417">(</span><span class="ident" id="5918418">tr</span><span class="op" id="5918420">.</span><span class="ident" id="5918421">r</span><span class="op" id="5918422">,</span>&nbsp;<span class="ident" id="5918424">header</span><span class="op" id="5918430">)</span><span class="op" id="5918431">;</span>&nbsp;<span class="ident" id="5918433">tr</span><span class="op" id="5918435">.</span><span class="ident" id="5918436">err</span>&nbsp;<span class="op" id="5918440">!=</span>&nbsp;<span class="ident" id="5918443">nil</span>&nbsp;<span class="op" id="5918447">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918452">return</span>&nbsp;<span class="ident" id="5918459">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918469">if</span>&nbsp;<span class="ident" id="5918472">bytes</span><span class="op" id="5918477">.</span><span class="ident" id="5918478">Equal</span><span class="op" id="5918483">(</span><span class="ident" id="5918484">header</span><span class="op" id="5918490">,</span>&nbsp;<span class="ident" id="5918492">zeroBlock</span><span class="op" id="5918501">[</span><span class="num" id="5918502">0</span><span class="op" id="5918503">:</span><span class="ident" id="5918504">blockSize</span><span class="op" id="5918513">]</span><span class="op" id="5918514">)</span>&nbsp;<span class="op" id="5918516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918521">tr</span><span class="op" id="5918523">.</span><span class="ident" id="5918524">err</span>&nbsp;<span class="op" id="5918528">=</span>&nbsp;<span class="ident" id="5918530">io</span><span class="op" id="5918532">.</span><span class="ident" id="5918533">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918539">}</span>&nbsp;<span class="keyword" id="5918541">else</span>&nbsp;<span class="op" id="5918546">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918551">tr</span><span class="op" id="5918553">.</span><span class="ident" id="5918554">err</span>&nbsp;<span class="op" id="5918558">=</span>&nbsp;<span class="ident" id="5918560">ErrHeader</span>&nbsp;<span class="comment" id="5918570">//&nbsp;zero&nbsp;block&nbsp;and&nbsp;then&nbsp;non-zero&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918614">return</span>&nbsp;<span class="ident" id="5918621">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918630">if</span>&nbsp;<span class="op" id="5918633">!</span><span class="ident" id="5918634">tr</span><span class="op" id="5918636">.</span><span class="ident" id="5918637">verifyChecksum</span><span class="op" id="5918651">(</span><span class="ident" id="5918652">header</span><span class="op" id="5918658">)</span>&nbsp;<span class="op" id="5918660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918664">tr</span><span class="op" id="5918666">.</span><span class="ident" id="5918667">err</span>&nbsp;<span class="op" id="5918671">=</span>&nbsp;<span class="ident" id="5918673">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918685">return</span>&nbsp;<span class="ident" id="5918692">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5918701">//&nbsp;Unpack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918712">hdr</span>&nbsp;<span class="op" id="5918716">:=</span>&nbsp;<span class="builtinfunc" id="5918719">new</span><span class="op" id="5918722">(</span><span class="ident" id="5918723">Header</span><span class="op" id="5918729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918732">s</span>&nbsp;<span class="op" id="5918734">:=</span>&nbsp;<span class="ident" id="5918737">slicer</span><span class="op" id="5918743">(</span><span class="ident" id="5918744">header</span><span class="op" id="5918750">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918754">hdr</span><span class="op" id="5918757">.</span><span class="ident" id="5918758">Name</span>&nbsp;<span class="op" id="5918763">=</span>&nbsp;<span class="ident" id="5918765">cString</span><span class="op" id="5918772">(</span><span class="ident" id="5918773">s</span><span class="op" id="5918774">.</span><span class="ident" id="5918775">next</span><span class="op" id="5918779">(</span><span class="num" id="5918780">100</span><span class="op" id="5918783">)</span><span class="op" id="5918784">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918787">hdr</span><span class="op" id="5918790">.</span><span class="ident" id="5918791">Mode</span>&nbsp;<span class="op" id="5918796">=</span>&nbsp;<span class="ident" id="5918798">tr</span><span class="op" id="5918800">.</span><span class="ident" id="5918801">octal</span><span class="op" id="5918806">(</span><span class="ident" id="5918807">s</span><span class="op" id="5918808">.</span><span class="ident" id="5918809">next</span><span class="op" id="5918813">(</span><span class="num" id="5918814">8</span><span class="op" id="5918815">)</span><span class="op" id="5918816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918819">hdr</span><span class="op" id="5918822">.</span><span class="ident" id="5918823">Uid</span>&nbsp;<span class="op" id="5918827">=</span>&nbsp;<span class="builtintype" id="5918829">int</span><span class="op" id="5918832">(</span><span class="ident" id="5918833">tr</span><span class="op" id="5918835">.</span><span class="ident" id="5918836">octal</span><span class="op" id="5918841">(</span><span class="ident" id="5918842">s</span><span class="op" id="5918843">.</span><span class="ident" id="5918844">next</span><span class="op" id="5918848">(</span><span class="num" id="5918849">8</span><span class="op" id="5918850">)</span><span class="op" id="5918851">)</span><span class="op" id="5918852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918855">hdr</span><span class="op" id="5918858">.</span><span class="ident" id="5918859">Gid</span>&nbsp;<span class="op" id="5918863">=</span>&nbsp;<span class="builtintype" id="5918865">int</span><span class="op" id="5918868">(</span><span class="ident" id="5918869">tr</span><span class="op" id="5918871">.</span><span class="ident" id="5918872">octal</span><span class="op" id="5918877">(</span><span class="ident" id="5918878">s</span><span class="op" id="5918879">.</span><span class="ident" id="5918880">next</span><span class="op" id="5918884">(</span><span class="num" id="5918885">8</span><span class="op" id="5918886">)</span><span class="op" id="5918887">)</span><span class="op" id="5918888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918891">hdr</span><span class="op" id="5918894">.</span><span class="ident" id="5918895">Size</span>&nbsp;<span class="op" id="5918900">=</span>&nbsp;<span class="ident" id="5918902">tr</span><span class="op" id="5918904">.</span><span class="ident" id="5918905">octal</span><span class="op" id="5918910">(</span><span class="ident" id="5918911">s</span><span class="op" id="5918912">.</span><span class="ident" id="5918913">next</span><span class="op" id="5918917">(</span><span class="num" id="5918918">12</span><span class="op" id="5918920">)</span><span class="op" id="5918921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918924">hdr</span><span class="op" id="5918927">.</span><span class="ident" id="5918928">ModTime</span>&nbsp;<span class="op" id="5918936">=</span>&nbsp;<span class="ident" id="5918938">time</span><span class="op" id="5918942">.</span><span class="ident" id="5918943">Unix</span><span class="op" id="5918947">(</span><span class="ident" id="5918948">tr</span><span class="op" id="5918950">.</span><span class="ident" id="5918951">octal</span><span class="op" id="5918956">(</span><span class="ident" id="5918957">s</span><span class="op" id="5918958">.</span><span class="ident" id="5918959">next</span><span class="op" id="5918963">(</span><span class="num" id="5918964">12</span><span class="op" id="5918966">)</span><span class="op" id="5918967">)</span><span class="op" id="5918968">,</span>&nbsp;<span class="num" id="5918970">0</span><span class="op" id="5918971">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918974">s</span><span class="op" id="5918975">.</span><span class="ident" id="5918976">next</span><span class="op" id="5918980">(</span><span class="num" id="5918981">8</span><span class="op" id="5918982">)</span>&nbsp;<span class="comment" id="5918984">//&nbsp;chksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918995">hdr</span><span class="op" id="5918998">.</span><span class="ident" id="5918999">Typeflag</span>&nbsp;<span class="op" id="5919008">=</span>&nbsp;<span class="ident" id="5919010">s</span><span class="op" id="5919011">.</span><span class="ident" id="5919012">next</span><span class="op" id="5919016">(</span><span class="num" id="5919017">1</span><span class="op" id="5919018">)</span><span class="op" id="5919019">[</span><span class="num" id="5919020">0</span><span class="op" id="5919021">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919024">hdr</span><span class="op" id="5919027">.</span><span class="ident" id="5919028">Linkname</span>&nbsp;<span class="op" id="5919037">=</span>&nbsp;<span class="ident" id="5919039">cString</span><span class="op" id="5919046">(</span><span class="ident" id="5919047">s</span><span class="op" id="5919048">.</span><span class="ident" id="5919049">next</span><span class="op" id="5919053">(</span><span class="num" id="5919054">100</span><span class="op" id="5919057">)</span><span class="op" id="5919058">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919062">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;header&nbsp;depends&nbsp;on&nbsp;the&nbsp;value&nbsp;of&nbsp;magic.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919125">//&nbsp;The&nbsp;original&nbsp;(v7)&nbsp;version&nbsp;of&nbsp;tar&nbsp;had&nbsp;no&nbsp;explicit&nbsp;magic&nbsp;field,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919191">//&nbsp;so&nbsp;its&nbsp;magic&nbsp;bytes,&nbsp;like&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;block,&nbsp;are&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919253">magic</span>&nbsp;<span class="op" id="5919259">:=</span>&nbsp;<span class="builtintype" id="5919262">string</span><span class="op" id="5919268">(</span><span class="ident" id="5919269">s</span><span class="op" id="5919270">.</span><span class="ident" id="5919271">next</span><span class="op" id="5919275">(</span><span class="num" id="5919276">8</span><span class="op" id="5919277">)</span><span class="op" id="5919278">)</span>&nbsp;<span class="comment" id="5919280">//&nbsp;contains&nbsp;version&nbsp;field&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919316">var</span>&nbsp;<span class="ident" id="5919320">format</span>&nbsp;<span class="builtintype" id="5919327">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919335">switch</span>&nbsp;<span class="op" id="5919342">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919345">case</span>&nbsp;<span class="ident" id="5919350">magic</span><span class="op" id="5919355">[</span><span class="op" id="5919356">:</span><span class="num" id="5919357">6</span><span class="op" id="5919358">]</span>&nbsp;<span class="op" id="5919360">==</span>&nbsp;<span class="string" id="5919363">&#34;ustar\x00&#34;</span><span class="op" id="5919374">:</span>&nbsp;<span class="comment" id="5919376">//&nbsp;POSIX&nbsp;tar&nbsp;(1003.1-1988)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919405">if</span>&nbsp;<span class="builtintype" id="5919408">string</span><span class="op" id="5919414">(</span><span class="ident" id="5919415">header</span><span class="op" id="5919421">[</span><span class="num" id="5919422">508</span><span class="op" id="5919425">:</span><span class="num" id="5919426">512</span><span class="op" id="5919429">]</span><span class="op" id="5919430">)</span>&nbsp;<span class="op" id="5919432">==</span>&nbsp;<span class="string" id="5919435">&#34;tar\x00&#34;</span>&nbsp;<span class="op" id="5919445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919450">format</span>&nbsp;<span class="op" id="5919457">=</span>&nbsp;<span class="string" id="5919459">&#34;star&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919468">}</span>&nbsp;<span class="keyword" id="5919470">else</span>&nbsp;<span class="op" id="5919475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919480">format</span>&nbsp;<span class="op" id="5919487">=</span>&nbsp;<span class="string" id="5919489">&#34;posix&#34;</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919502">case</span>&nbsp;<span class="ident" id="5919507">magic</span>&nbsp;<span class="op" id="5919513">==</span>&nbsp;<span class="string" id="5919516">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="5919529">:</span>&nbsp;<span class="comment" id="5919531">//&nbsp;old&nbsp;GNU&nbsp;tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919548">format</span>&nbsp;<span class="op" id="5919555">=</span>&nbsp;<span class="string" id="5919557">&#34;gnu&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919568">switch</span>&nbsp;<span class="ident" id="5919575">format</span>&nbsp;<span class="op" id="5919582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919585">case</span>&nbsp;<span class="string" id="5919590">&#34;posix&#34;</span><span class="op" id="5919597">,</span>&nbsp;<span class="string" id="5919599">&#34;gnu&#34;</span><span class="op" id="5919604">,</span>&nbsp;<span class="string" id="5919606">&#34;star&#34;</span><span class="op" id="5919612">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919616">hdr</span><span class="op" id="5919619">.</span><span class="ident" id="5919620">Uname</span>&nbsp;<span class="op" id="5919626">=</span>&nbsp;<span class="ident" id="5919628">cString</span><span class="op" id="5919635">(</span><span class="ident" id="5919636">s</span><span class="op" id="5919637">.</span><span class="ident" id="5919638">next</span><span class="op" id="5919642">(</span><span class="num" id="5919643">32</span><span class="op" id="5919645">)</span><span class="op" id="5919646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919650">hdr</span><span class="op" id="5919653">.</span><span class="ident" id="5919654">Gname</span>&nbsp;<span class="op" id="5919660">=</span>&nbsp;<span class="ident" id="5919662">cString</span><span class="op" id="5919669">(</span><span class="ident" id="5919670">s</span><span class="op" id="5919671">.</span><span class="ident" id="5919672">next</span><span class="op" id="5919676">(</span><span class="num" id="5919677">32</span><span class="op" id="5919679">)</span><span class="op" id="5919680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919684">devmajor</span>&nbsp;<span class="op" id="5919693">:=</span>&nbsp;<span class="ident" id="5919696">s</span><span class="op" id="5919697">.</span><span class="ident" id="5919698">next</span><span class="op" id="5919702">(</span><span class="num" id="5919703">8</span><span class="op" id="5919704">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919708">devminor</span>&nbsp;<span class="op" id="5919717">:=</span>&nbsp;<span class="ident" id="5919720">s</span><span class="op" id="5919721">.</span><span class="ident" id="5919722">next</span><span class="op" id="5919726">(</span><span class="num" id="5919727">8</span><span class="op" id="5919728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919732">if</span>&nbsp;<span class="ident" id="5919735">hdr</span><span class="op" id="5919738">.</span><span class="ident" id="5919739">Typeflag</span>&nbsp;<span class="op" id="5919748">==</span>&nbsp;<span class="ident" id="5919751">TypeChar</span>&nbsp;<span class="op" id="5919760">||</span>&nbsp;<span class="ident" id="5919763">hdr</span><span class="op" id="5919766">.</span><span class="ident" id="5919767">Typeflag</span>&nbsp;<span class="op" id="5919776">==</span>&nbsp;<span class="ident" id="5919779">TypeBlock</span>&nbsp;<span class="op" id="5919789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919794">hdr</span><span class="op" id="5919797">.</span><span class="ident" id="5919798">Devmajor</span>&nbsp;<span class="op" id="5919807">=</span>&nbsp;<span class="ident" id="5919809">tr</span><span class="op" id="5919811">.</span><span class="ident" id="5919812">octal</span><span class="op" id="5919817">(</span><span class="ident" id="5919818">devmajor</span><span class="op" id="5919826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919831">hdr</span><span class="op" id="5919834">.</span><span class="ident" id="5919835">Devminor</span>&nbsp;<span class="op" id="5919844">=</span>&nbsp;<span class="ident" id="5919846">tr</span><span class="op" id="5919848">.</span><span class="ident" id="5919849">octal</span><span class="op" id="5919854">(</span><span class="ident" id="5919855">devminor</span><span class="op" id="5919863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919867">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919871">var</span>&nbsp;<span class="ident" id="5919875">prefix</span>&nbsp;<span class="builtintype" id="5919882">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919891">switch</span>&nbsp;<span class="ident" id="5919898">format</span>&nbsp;<span class="op" id="5919905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919909">case</span>&nbsp;<span class="string" id="5919914">&#34;posix&#34;</span><span class="op" id="5919921">,</span>&nbsp;<span class="string" id="5919923">&#34;gnu&#34;</span><span class="op" id="5919928">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919933">prefix</span>&nbsp;<span class="op" id="5919940">=</span>&nbsp;<span class="ident" id="5919942">cString</span><span class="op" id="5919949">(</span><span class="ident" id="5919950">s</span><span class="op" id="5919951">.</span><span class="ident" id="5919952">next</span><span class="op" id="5919956">(</span><span class="num" id="5919957">155</span><span class="op" id="5919960">)</span><span class="op" id="5919961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919965">case</span>&nbsp;<span class="string" id="5919970">&#34;star&#34;</span><span class="op" id="5919976">:</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919981">prefix</span>&nbsp;<span class="op" id="5919988">=</span>&nbsp;<span class="ident" id="5919990">cString</span><span class="op" id="5919997">(</span><span class="ident" id="5919998">s</span><span class="op" id="5919999">.</span><span class="ident" id="5920000">next</span><span class="op" id="5920004">(</span><span class="num" id="5920005">131</span><span class="op" id="5920008">)</span><span class="op" id="5920009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920014">hdr</span><span class="op" id="5920017">.</span><span class="ident" id="5920018">AccessTime</span>&nbsp;<span class="op" id="5920029">=</span>&nbsp;<span class="ident" id="5920031">time</span><span class="op" id="5920035">.</span><span class="ident" id="5920036">Unix</span><span class="op" id="5920040">(</span><span class="ident" id="5920041">tr</span><span class="op" id="5920043">.</span><span class="ident" id="5920044">octal</span><span class="op" id="5920049">(</span><span class="ident" id="5920050">s</span><span class="op" id="5920051">.</span><span class="ident" id="5920052">next</span><span class="op" id="5920056">(</span><span class="num" id="5920057">12</span><span class="op" id="5920059">)</span><span class="op" id="5920060">)</span><span class="op" id="5920061">,</span>&nbsp;<span class="num" id="5920063">0</span><span class="op" id="5920064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920069">hdr</span><span class="op" id="5920072">.</span><span class="ident" id="5920073">ChangeTime</span>&nbsp;<span class="op" id="5920084">=</span>&nbsp;<span class="ident" id="5920086">time</span><span class="op" id="5920090">.</span><span class="ident" id="5920091">Unix</span><span class="op" id="5920095">(</span><span class="ident" id="5920096">tr</span><span class="op" id="5920098">.</span><span class="ident" id="5920099">octal</span><span class="op" id="5920104">(</span><span class="ident" id="5920105">s</span><span class="op" id="5920106">.</span><span class="ident" id="5920107">next</span><span class="op" id="5920111">(</span><span class="num" id="5920112">12</span><span class="op" id="5920114">)</span><span class="op" id="5920115">)</span><span class="op" id="5920116">,</span>&nbsp;<span class="num" id="5920118">0</span><span class="op" id="5920119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920127">if</span>&nbsp;<span class="builtinfunc" id="5920130">len</span><span class="op" id="5920133">(</span><span class="ident" id="5920134">prefix</span><span class="op" id="5920140">)</span>&nbsp;<span class="op" id="5920142">&gt;</span>&nbsp;<span class="num" id="5920144">0</span>&nbsp;<span class="op" id="5920146">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920151">hdr</span><span class="op" id="5920154">.</span><span class="ident" id="5920155">Name</span>&nbsp;<span class="op" id="5920160">=</span>&nbsp;<span class="ident" id="5920162">prefix</span>&nbsp;<span class="op" id="5920169">+</span>&nbsp;<span class="string" id="5920171">&#34;/&#34;</span>&nbsp;<span class="op" id="5920175">+</span>&nbsp;<span class="ident" id="5920177">hdr</span><span class="op" id="5920180">.</span><span class="ident" id="5920181">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920195">if</span>&nbsp;<span class="ident" id="5920198">tr</span><span class="op" id="5920200">.</span><span class="ident" id="5920201">err</span>&nbsp;<span class="op" id="5920205">!=</span>&nbsp;<span class="ident" id="5920208">nil</span>&nbsp;<span class="op" id="5920212">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920216">tr</span><span class="op" id="5920218">.</span><span class="ident" id="5920219">err</span>&nbsp;<span class="op" id="5920223">=</span>&nbsp;<span class="ident" id="5920225">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920237">return</span>&nbsp;<span class="ident" id="5920244">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920253">//&nbsp;Maximum&nbsp;value&nbsp;of&nbsp;hdr.Size&nbsp;is&nbsp;64&nbsp;GB&nbsp;(12&nbsp;octal&nbsp;digits),</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920311">//&nbsp;so&nbsp;there&#39;s&nbsp;no&nbsp;risk&nbsp;of&nbsp;int64&nbsp;overflowing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920356">nb</span>&nbsp;<span class="op" id="5920359">:=</span>&nbsp;<span class="ident" id="5920362">int64</span><span class="op" id="5920367">(</span><span class="ident" id="5920368">hdr</span><span class="op" id="5920371">.</span><span class="ident" id="5920372">Size</span><span class="op" id="5920376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920379">tr</span><span class="op" id="5920381">.</span><span class="ident" id="5920382">pad</span>&nbsp;<span class="op" id="5920386">=</span>&nbsp;<span class="op" id="5920388">-</span><span class="ident" id="5920389">nb</span>&nbsp;<span class="op" id="5920392">&amp;</span>&nbsp;<span class="op" id="5920394">(</span><span class="ident" id="5920395">blockSize</span>&nbsp;<span class="op" id="5920405">-</span>&nbsp;<span class="num" id="5920407">1</span><span class="op" id="5920408">)</span>&nbsp;<span class="comment" id="5920410">//&nbsp;blockSize&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;two</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920443">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920476">tr</span><span class="op" id="5920478">.</span><span class="ident" id="5920479">curr</span>&nbsp;<span class="op" id="5920484">=</span>&nbsp;<span class="op" id="5920486">&amp;</span><span class="ident" id="5920487">regFileReader</span><span class="op" id="5920500">{</span><span class="ident" id="5920501">r</span><span class="op" id="5920502">:</span>&nbsp;<span class="ident" id="5920504">tr</span><span class="op" id="5920506">.</span><span class="ident" id="5920507">r</span><span class="op" id="5920508">,</span>&nbsp;<span class="ident" id="5920510">nb</span><span class="op" id="5920512">:</span>&nbsp;<span class="ident" id="5920514">nb</span><span class="op" id="5920516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920520">//&nbsp;Check&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920563">if</span>&nbsp;<span class="ident" id="5920566">hdr</span><span class="op" id="5920569">.</span><span class="ident" id="5920570">Typeflag</span>&nbsp;<span class="op" id="5920579">==</span>&nbsp;<span class="ident" id="5920582">TypeGNUSparse</span>&nbsp;<span class="op" id="5920596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920600">//&nbsp;Get&nbsp;the&nbsp;real&nbsp;size&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920636">hdr</span><span class="op" id="5920639">.</span><span class="ident" id="5920640">Size</span>&nbsp;<span class="op" id="5920645">=</span>&nbsp;<span class="ident" id="5920647">tr</span><span class="op" id="5920649">.</span><span class="ident" id="5920650">octal</span><span class="op" id="5920655">(</span><span class="ident" id="5920656">header</span><span class="op" id="5920662">[</span><span class="num" id="5920663">483</span><span class="op" id="5920666">:</span><span class="num" id="5920667">495</span><span class="op" id="5920670">]</span><span class="op" id="5920671">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920676">//&nbsp;Read&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920702">sp</span>&nbsp;<span class="op" id="5920705">:=</span>&nbsp;<span class="ident" id="5920708">tr</span><span class="op" id="5920710">.</span><span class="ident" id="5920711">readOldGNUSparseMap</span><span class="op" id="5920730">(</span><span class="ident" id="5920731">header</span><span class="op" id="5920737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920741">if</span>&nbsp;<span class="ident" id="5920744">tr</span><span class="op" id="5920746">.</span><span class="ident" id="5920747">err</span>&nbsp;<span class="op" id="5920751">!=</span>&nbsp;<span class="ident" id="5920754">nil</span>&nbsp;<span class="op" id="5920758">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920763">return</span>&nbsp;<span class="ident" id="5920770">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5920780">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;GNU&nbsp;sparse&nbsp;file.&nbsp;Update&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5920852">tr</span><span class="op" id="5920854">.</span><span class="ident" id="5920855">curr</span>&nbsp;<span class="op" id="5920860">=</span>&nbsp;<span class="op" id="5920862">&amp;</span><span class="ident" id="5920863">sparseFileReader</span><span class="op" id="5920879">{</span><span class="ident" id="5920880">rfr</span><span class="op" id="5920883">:</span>&nbsp;<span class="ident" id="5920885">tr</span><span class="op" id="5920887">.</span><span class="ident" id="5920888">curr</span><span class="op" id="5920892">.</span><span class="op" id="5920893">(</span><span class="op" id="5920894">*</span><span class="ident" id="5920895">regFileReader</span><span class="op" id="5920908">)</span><span class="op" id="5920909">,</span>&nbsp;<span class="ident" id="5920911">sp</span><span class="op" id="5920913">:</span>&nbsp;<span class="ident" id="5920915">sp</span><span class="op" id="5920917">,</span>&nbsp;<span class="ident" id="5920919">tot</span><span class="op" id="5920922">:</span>&nbsp;<span class="ident" id="5920924">hdr</span><span class="op" id="5920927">.</span><span class="ident" id="5920928">Size</span><span class="op" id="5920932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5920935">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5920939">return</span>&nbsp;<span class="ident" id="5920946">hdr</span><br>
<span class="lineno"></span><span class="op" id="5920950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5920953">//&nbsp;A&nbsp;sparseEntry&nbsp;holds&nbsp;a&nbsp;single&nbsp;entry&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&#39;s&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">540</span><span class="comment" id="5921022">//&nbsp;A&nbsp;sparse&nbsp;entry&nbsp;indicates&nbsp;the&nbsp;offset&nbsp;and&nbsp;size&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5921092">//&nbsp;block&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5921110">type</span>&nbsp;<span class="ident" id="5921115">sparseEntry</span>&nbsp;<span class="keyword" id="5921127">struct</span>&nbsp;<span class="op" id="5921134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921137">offset</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5921146">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921153">numBytes</span>&nbsp;<span class="ident" id="5921162">int64</span><br>
<span class="lineno">545</span><span class="op" id="5921168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5921171">//&nbsp;readOldGNUSparseMap&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;the&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="5921255">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;tar&nbsp;header&nbsp;if&nbsp;it&#39;s&nbsp;small&nbsp;enough.&nbsp;If&nbsp;it&#39;s&nbsp;larger&nbsp;than&nbsp;four&nbsp;entries,</span><br>
<span class="lineno"></span><span class="comment" id="5921357">//&nbsp;then&nbsp;one&nbsp;or&nbsp;more&nbsp;extension&nbsp;headers&nbsp;are&nbsp;used&nbsp;to&nbsp;store&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">550</span><span class="keyword" id="5921441">func</span>&nbsp;<span class="op" id="5921446">(</span><span class="ident" id="5921447">tr</span>&nbsp;<span class="op" id="5921450">*</span><span class="ident" id="5921451">Reader</span><span class="op" id="5921457">)</span>&nbsp;<span class="ident" id="5921459">readOldGNUSparseMap</span><span class="op" id="5921478">(</span><span class="ident" id="5921479">header</span>&nbsp;<span class="op" id="5921486">[</span><span class="op" id="5921487">]</span><span class="builtintype" id="5921488">byte</span><span class="op" id="5921492">)</span>&nbsp;<span class="op" id="5921494">[</span><span class="op" id="5921495">]</span><span class="ident" id="5921496">sparseEntry</span>&nbsp;<span class="op" id="5921508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921511">isExtended</span>&nbsp;<span class="op" id="5921522">:=</span>&nbsp;<span class="ident" id="5921525">header</span><span class="op" id="5921531">[</span><span class="ident" id="5921532">oldGNUSparseMainHeaderIsExtendedOffset</span><span class="op" id="5921570">]</span>&nbsp;<span class="op" id="5921572">!=</span>&nbsp;<span class="num" id="5921575">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921578">spCap</span>&nbsp;<span class="op" id="5921584">:=</span>&nbsp;<span class="ident" id="5921587">oldGNUSparseMainHeaderNumEntries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921621">if</span>&nbsp;<span class="ident" id="5921624">isExtended</span>&nbsp;<span class="op" id="5921635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921639">spCap</span>&nbsp;<span class="op" id="5921645">+=</span>&nbsp;<span class="ident" id="5921648">oldGNUSparseExtendedHeaderNumEntries</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921689">sp</span>&nbsp;<span class="op" id="5921692">:=</span>&nbsp;<span class="builtinfunc" id="5921695">make</span><span class="op" id="5921699">(</span><span class="op" id="5921700">[</span><span class="op" id="5921701">]</span><span class="ident" id="5921702">sparseEntry</span><span class="op" id="5921713">,</span>&nbsp;<span class="num" id="5921715">0</span><span class="op" id="5921716">,</span>&nbsp;<span class="ident" id="5921718">spCap</span><span class="op" id="5921723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921726">s</span>&nbsp;<span class="op" id="5921728">:=</span>&nbsp;<span class="ident" id="5921731">slicer</span><span class="op" id="5921737">(</span><span class="ident" id="5921738">header</span><span class="op" id="5921744">[</span><span class="ident" id="5921745">oldGNUSparseMainHeaderOffset</span><span class="op" id="5921773">:</span><span class="op" id="5921774">]</span><span class="op" id="5921775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921779">//&nbsp;Read&nbsp;the&nbsp;four&nbsp;entries&nbsp;from&nbsp;the&nbsp;main&nbsp;tar&nbsp;header</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921830">for</span>&nbsp;<span class="ident" id="5921834">i</span>&nbsp;<span class="op" id="5921836">:=</span>&nbsp;<span class="num" id="5921839">0</span><span class="op" id="5921840">;</span>&nbsp;<span class="ident" id="5921842">i</span>&nbsp;<span class="op" id="5921844">&lt;</span>&nbsp;<span class="ident" id="5921846">oldGNUSparseMainHeaderNumEntries</span><span class="op" id="5921878">;</span>&nbsp;<span class="ident" id="5921880">i</span><span class="op" id="5921881">++</span>&nbsp;<span class="op" id="5921884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921888">offset</span>&nbsp;<span class="op" id="5921895">:=</span>&nbsp;<span class="ident" id="5921898">tr</span><span class="op" id="5921900">.</span><span class="ident" id="5921901">octal</span><span class="op" id="5921906">(</span><span class="ident" id="5921907">s</span><span class="op" id="5921908">.</span><span class="ident" id="5921909">next</span><span class="op" id="5921913">(</span><span class="ident" id="5921914">oldGNUSparseOffsetSize</span><span class="op" id="5921936">)</span><span class="op" id="5921937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921941">numBytes</span>&nbsp;<span class="op" id="5921950">:=</span>&nbsp;<span class="ident" id="5921953">tr</span><span class="op" id="5921955">.</span><span class="ident" id="5921956">octal</span><span class="op" id="5921961">(</span><span class="ident" id="5921962">s</span><span class="op" id="5921963">.</span><span class="ident" id="5921964">next</span><span class="op" id="5921968">(</span><span class="ident" id="5921969">oldGNUSparseNumBytesSize</span><span class="op" id="5921993">)</span><span class="op" id="5921994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921998">if</span>&nbsp;<span class="ident" id="5922001">tr</span><span class="op" id="5922003">.</span><span class="ident" id="5922004">err</span>&nbsp;<span class="op" id="5922008">!=</span>&nbsp;<span class="ident" id="5922011">nil</span>&nbsp;<span class="op" id="5922015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922020">tr</span><span class="op" id="5922022">.</span><span class="ident" id="5922023">err</span>&nbsp;<span class="op" id="5922027">=</span>&nbsp;<span class="ident" id="5922029">ErrHeader</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922042">return</span>&nbsp;<span class="ident" id="5922049">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922059">if</span>&nbsp;<span class="ident" id="5922062">offset</span>&nbsp;<span class="op" id="5922069">==</span>&nbsp;<span class="num" id="5922072">0</span>&nbsp;<span class="op" id="5922074">&amp;&amp;</span>&nbsp;<span class="ident" id="5922077">numBytes</span>&nbsp;<span class="op" id="5922086">==</span>&nbsp;<span class="num" id="5922089">0</span>&nbsp;<span class="op" id="5922091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922096">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922104">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922108">sp</span>&nbsp;<span class="op" id="5922111">=</span>&nbsp;<span class="builtinfunc" id="5922113">append</span><span class="op" id="5922119">(</span><span class="ident" id="5922120">sp</span><span class="op" id="5922122">,</span>&nbsp;<span class="ident" id="5922124">sparseEntry</span><span class="op" id="5922135">{</span><span class="ident" id="5922136">offset</span><span class="op" id="5922142">:</span>&nbsp;<span class="ident" id="5922144">offset</span><span class="op" id="5922150">,</span>&nbsp;<span class="ident" id="5922152">numBytes</span><span class="op" id="5922160">:</span>&nbsp;<span class="ident" id="5922162">numBytes</span><span class="op" id="5922170">}</span><span class="op" id="5922171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922178">for</span>&nbsp;<span class="ident" id="5922182">isExtended</span>&nbsp;<span class="op" id="5922193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922197">//&nbsp;There&nbsp;are&nbsp;more&nbsp;entries.&nbsp;Read&nbsp;an&nbsp;extension&nbsp;header&nbsp;and&nbsp;parse&nbsp;its&nbsp;entries.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922274">sparseHeader</span>&nbsp;<span class="op" id="5922287">:=</span>&nbsp;<span class="builtinfunc" id="5922290">make</span><span class="op" id="5922294">(</span><span class="op" id="5922295">[</span><span class="op" id="5922296">]</span><span class="builtintype" id="5922297">byte</span><span class="op" id="5922301">,</span>&nbsp;<span class="ident" id="5922303">blockSize</span><span class="op" id="5922312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922316">if</span>&nbsp;<span class="ident" id="5922319">_</span><span class="op" id="5922320">,</span>&nbsp;<span class="ident" id="5922322">tr</span><span class="op" id="5922324">.</span><span class="ident" id="5922325">err</span>&nbsp;<span class="op" id="5922329">=</span>&nbsp;<span class="ident" id="5922331">io</span><span class="op" id="5922333">.</span><span class="ident" id="5922334">ReadFull</span><span class="op" id="5922342">(</span><span class="ident" id="5922343">tr</span><span class="op" id="5922345">.</span><span class="ident" id="5922346">r</span><span class="op" id="5922347">,</span>&nbsp;<span class="ident" id="5922349">sparseHeader</span><span class="op" id="5922361">)</span><span class="op" id="5922362">;</span>&nbsp;<span class="ident" id="5922364">tr</span><span class="op" id="5922366">.</span><span class="ident" id="5922367">err</span>&nbsp;<span class="op" id="5922371">!=</span>&nbsp;<span class="ident" id="5922374">nil</span>&nbsp;<span class="op" id="5922378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922383">return</span>&nbsp;<span class="ident" id="5922390">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922400">isExtended</span>&nbsp;<span class="op" id="5922411">=</span>&nbsp;<span class="ident" id="5922413">sparseHeader</span><span class="op" id="5922425">[</span><span class="ident" id="5922426">oldGNUSparseExtendedHeaderIsExtendedOffset</span><span class="op" id="5922468">]</span>&nbsp;<span class="op" id="5922470">!=</span>&nbsp;<span class="num" id="5922473">0</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922477">s</span>&nbsp;<span class="op" id="5922479">=</span>&nbsp;<span class="ident" id="5922481">slicer</span><span class="op" id="5922487">(</span><span class="ident" id="5922488">sparseHeader</span><span class="op" id="5922500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922504">for</span>&nbsp;<span class="ident" id="5922508">i</span>&nbsp;<span class="op" id="5922510">:=</span>&nbsp;<span class="num" id="5922513">0</span><span class="op" id="5922514">;</span>&nbsp;<span class="ident" id="5922516">i</span>&nbsp;<span class="op" id="5922518">&lt;</span>&nbsp;<span class="ident" id="5922520">oldGNUSparseExtendedHeaderNumEntries</span><span class="op" id="5922556">;</span>&nbsp;<span class="ident" id="5922558">i</span><span class="op" id="5922559">++</span>&nbsp;<span class="op" id="5922562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922567">offset</span>&nbsp;<span class="op" id="5922574">:=</span>&nbsp;<span class="ident" id="5922577">tr</span><span class="op" id="5922579">.</span><span class="ident" id="5922580">octal</span><span class="op" id="5922585">(</span><span class="ident" id="5922586">s</span><span class="op" id="5922587">.</span><span class="ident" id="5922588">next</span><span class="op" id="5922592">(</span><span class="ident" id="5922593">oldGNUSparseOffsetSize</span><span class="op" id="5922615">)</span><span class="op" id="5922616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922621">numBytes</span>&nbsp;<span class="op" id="5922630">:=</span>&nbsp;<span class="ident" id="5922633">tr</span><span class="op" id="5922635">.</span><span class="ident" id="5922636">octal</span><span class="op" id="5922641">(</span><span class="ident" id="5922642">s</span><span class="op" id="5922643">.</span><span class="ident" id="5922644">next</span><span class="op" id="5922648">(</span><span class="ident" id="5922649">oldGNUSparseNumBytesSize</span><span class="op" id="5922673">)</span><span class="op" id="5922674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922679">if</span>&nbsp;<span class="ident" id="5922682">tr</span><span class="op" id="5922684">.</span><span class="ident" id="5922685">err</span>&nbsp;<span class="op" id="5922689">!=</span>&nbsp;<span class="ident" id="5922692">nil</span>&nbsp;<span class="op" id="5922696">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922702">tr</span><span class="op" id="5922704">.</span><span class="ident" id="5922705">err</span>&nbsp;<span class="op" id="5922709">=</span>&nbsp;<span class="ident" id="5922711">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922725">return</span>&nbsp;<span class="ident" id="5922732">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922744">if</span>&nbsp;<span class="ident" id="5922747">offset</span>&nbsp;<span class="op" id="5922754">==</span>&nbsp;<span class="num" id="5922757">0</span>&nbsp;<span class="op" id="5922759">&amp;&amp;</span>&nbsp;<span class="ident" id="5922762">numBytes</span>&nbsp;<span class="op" id="5922771">==</span>&nbsp;<span class="num" id="5922774">0</span>&nbsp;<span class="op" id="5922776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922782">break</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922796">sp</span>&nbsp;<span class="op" id="5922799">=</span>&nbsp;<span class="builtinfunc" id="5922801">append</span><span class="op" id="5922807">(</span><span class="ident" id="5922808">sp</span><span class="op" id="5922810">,</span>&nbsp;<span class="ident" id="5922812">sparseEntry</span><span class="op" id="5922823">{</span><span class="ident" id="5922824">offset</span><span class="op" id="5922830">:</span>&nbsp;<span class="ident" id="5922832">offset</span><span class="op" id="5922838">,</span>&nbsp;<span class="ident" id="5922840">numBytes</span><span class="op" id="5922848">:</span>&nbsp;<span class="ident" id="5922850">numBytes</span><span class="op" id="5922858">}</span><span class="op" id="5922859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922869">return</span>&nbsp;<span class="ident" id="5922876">sp</span><br>
<span class="lineno">595</span><span class="op" id="5922879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5922882">//&nbsp;readGNUSparseMap1x0&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;1.0.</span><br>
<span class="lineno"></span><span class="comment" id="5922976">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;just&nbsp;before&nbsp;the&nbsp;file&nbsp;data&nbsp;and&nbsp;padded&nbsp;out&nbsp;to&nbsp;the&nbsp;nearest&nbsp;block&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="5923076">func</span>&nbsp;<span class="ident" id="5923081">readGNUSparseMap1x0</span><span class="op" id="5923100">(</span><span class="ident" id="5923101">r</span>&nbsp;<span class="ident" id="5923103">io</span><span class="op" id="5923105">.</span><span class="ident" id="5923106">Reader</span><span class="op" id="5923112">)</span>&nbsp;<span class="op" id="5923114">(</span><span class="op" id="5923115">[</span><span class="op" id="5923116">]</span><span class="ident" id="5923117">sparseEntry</span><span class="op" id="5923128">,</span>&nbsp;<span class="builtintype" id="5923130">error</span><span class="op" id="5923135">)</span>&nbsp;<span class="op" id="5923137">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923140">buf</span>&nbsp;<span class="op" id="5923144">:=</span>&nbsp;<span class="builtinfunc" id="5923147">make</span><span class="op" id="5923151">(</span><span class="op" id="5923152">[</span><span class="op" id="5923153">]</span><span class="builtintype" id="5923154">byte</span><span class="op" id="5923158">,</span>&nbsp;<span class="num" id="5923160">2</span><span class="op" id="5923161">*</span><span class="ident" id="5923162">blockSize</span><span class="op" id="5923171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923174">sparseHeader</span>&nbsp;<span class="op" id="5923187">:=</span>&nbsp;<span class="ident" id="5923190">buf</span><span class="op" id="5923193">[</span><span class="op" id="5923194">:</span><span class="ident" id="5923195">blockSize</span><span class="op" id="5923204">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923208">//&nbsp;readDecimal&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;to&nbsp;read&nbsp;a&nbsp;decimal&nbsp;integer&nbsp;from&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923291">//&nbsp;while&nbsp;making&nbsp;sure&nbsp;to&nbsp;read&nbsp;from&nbsp;the&nbsp;file&nbsp;in&nbsp;blocks&nbsp;of&nbsp;size&nbsp;blockSize</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923363">readDecimal</span>&nbsp;<span class="op" id="5923375">:=</span>&nbsp;<span class="keyword" id="5923378">func</span><span class="op" id="5923382">(</span><span class="op" id="5923383">)</span>&nbsp;<span class="op" id="5923385">(</span><span class="ident" id="5923386">int64</span><span class="op" id="5923391">,</span>&nbsp;<span class="builtintype" id="5923393">error</span><span class="op" id="5923398">)</span>&nbsp;<span class="op" id="5923400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923404">//&nbsp;Look&nbsp;for&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923426">nl</span>&nbsp;<span class="op" id="5923429">:=</span>&nbsp;<span class="ident" id="5923432">bytes</span><span class="op" id="5923437">.</span><span class="ident" id="5923438">IndexByte</span><span class="op" id="5923447">(</span><span class="ident" id="5923448">sparseHeader</span><span class="op" id="5923460">,</span>&nbsp;<span class="string" id="5923462">&#39;\n&#39;</span><span class="op" id="5923466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923470">if</span>&nbsp;<span class="ident" id="5923473">nl</span>&nbsp;<span class="op" id="5923476">==</span>&nbsp;<span class="op" id="5923479">-</span><span class="num" id="5923480">1</span>&nbsp;<span class="op" id="5923482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923487">if</span>&nbsp;<span class="builtinfunc" id="5923490">len</span><span class="op" id="5923493">(</span><span class="ident" id="5923494">sparseHeader</span><span class="op" id="5923506">)</span>&nbsp;<span class="op" id="5923508">&gt;=</span>&nbsp;<span class="ident" id="5923511">blockSize</span>&nbsp;<span class="op" id="5923521">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923527">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923551">return</span>&nbsp;<span class="num" id="5923558">0</span><span class="op" id="5923559">,</span>&nbsp;<span class="ident" id="5923561">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923579">oldLen</span>&nbsp;<span class="op" id="5923586">:=</span>&nbsp;<span class="builtinfunc" id="5923589">len</span><span class="op" id="5923592">(</span><span class="ident" id="5923593">sparseHeader</span><span class="op" id="5923605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923610">newLen</span>&nbsp;<span class="op" id="5923617">:=</span>&nbsp;<span class="ident" id="5923620">oldLen</span>&nbsp;<span class="op" id="5923627">+</span>&nbsp;<span class="ident" id="5923629">blockSize</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923642">if</span>&nbsp;<span class="builtinfunc" id="5923645">cap</span><span class="op" id="5923648">(</span><span class="ident" id="5923649">sparseHeader</span><span class="op" id="5923661">)</span>&nbsp;<span class="op" id="5923663">&lt;</span>&nbsp;<span class="ident" id="5923665">newLen</span>&nbsp;<span class="op" id="5923672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923678">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;the&nbsp;next&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5923750">copy</span><span class="op" id="5923754">(</span><span class="ident" id="5923755">buf</span><span class="op" id="5923758">,</span>&nbsp;<span class="ident" id="5923760">sparseHeader</span><span class="op" id="5923772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923778">sparseHeader</span>&nbsp;<span class="op" id="5923791">=</span>&nbsp;<span class="ident" id="5923793">buf</span><span class="op" id="5923796">[</span><span class="op" id="5923797">:</span><span class="ident" id="5923798">newLen</span><span class="op" id="5923804">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923809">}</span>&nbsp;<span class="keyword" id="5923811">else</span>&nbsp;<span class="op" id="5923816">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923822">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;and&nbsp;we&nbsp;can&nbsp;just&nbsp;reslice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923874">sparseHeader</span>&nbsp;<span class="op" id="5923887">=</span>&nbsp;<span class="ident" id="5923889">sparseHeader</span><span class="op" id="5923901">[</span><span class="op" id="5923902">:</span><span class="ident" id="5923903">newLen</span><span class="op" id="5923909">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923920">//&nbsp;Now&nbsp;that&nbsp;sparseHeader&nbsp;is&nbsp;large&nbsp;enough,&nbsp;read&nbsp;next&nbsp;block</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923981">if</span>&nbsp;<span class="ident" id="5923984">_</span><span class="op" id="5923985">,</span>&nbsp;<span class="ident" id="5923987">err</span>&nbsp;<span class="op" id="5923991">:=</span>&nbsp;<span class="ident" id="5923994">io</span><span class="op" id="5923996">.</span><span class="ident" id="5923997">ReadFull</span><span class="op" id="5924005">(</span><span class="ident" id="5924006">r</span><span class="op" id="5924007">,</span>&nbsp;<span class="ident" id="5924009">sparseHeader</span><span class="op" id="5924021">[</span><span class="ident" id="5924022">oldLen</span><span class="op" id="5924028">:</span><span class="ident" id="5924029">newLen</span><span class="op" id="5924035">]</span><span class="op" id="5924036">)</span><span class="op" id="5924037">;</span>&nbsp;<span class="ident" id="5924039">err</span>&nbsp;<span class="op" id="5924043">!=</span>&nbsp;<span class="ident" id="5924046">nil</span>&nbsp;<span class="op" id="5924050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924056">return</span>&nbsp;<span class="num" id="5924063">0</span><span class="op" id="5924064">,</span>&nbsp;<span class="ident" id="5924066">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924079">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;newline&nbsp;in&nbsp;the&nbsp;new&nbsp;data</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924120">nl</span>&nbsp;<span class="op" id="5924123">=</span>&nbsp;<span class="ident" id="5924125">bytes</span><span class="op" id="5924130">.</span><span class="ident" id="5924131">IndexByte</span><span class="op" id="5924140">(</span><span class="ident" id="5924141">sparseHeader</span><span class="op" id="5924153">[</span><span class="ident" id="5924154">oldLen</span><span class="op" id="5924160">:</span><span class="ident" id="5924161">newLen</span><span class="op" id="5924167">]</span><span class="op" id="5924168">,</span>&nbsp;<span class="string" id="5924170">&#39;\n&#39;</span><span class="op" id="5924174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924179">if</span>&nbsp;<span class="ident" id="5924182">nl</span>&nbsp;<span class="op" id="5924185">==</span>&nbsp;<span class="op" id="5924188">-</span><span class="num" id="5924189">1</span>&nbsp;<span class="op" id="5924191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924197">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924221">return</span>&nbsp;<span class="num" id="5924228">0</span><span class="op" id="5924229">,</span>&nbsp;<span class="ident" id="5924231">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924244">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924249">nl</span>&nbsp;<span class="op" id="5924252">+=</span>&nbsp;<span class="ident" id="5924255">oldLen</span>&nbsp;<span class="comment" id="5924262">//&nbsp;We&nbsp;want&nbsp;the&nbsp;position&nbsp;from&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924311">//&nbsp;Now&nbsp;that&nbsp;we&#39;ve&nbsp;found&nbsp;a&nbsp;newline,&nbsp;read&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924362">n</span><span class="op" id="5924363">,</span>&nbsp;<span class="ident" id="5924365">err</span>&nbsp;<span class="op" id="5924369">:=</span>&nbsp;<span class="ident" id="5924372">strconv</span><span class="op" id="5924379">.</span><span class="ident" id="5924380">ParseInt</span><span class="op" id="5924388">(</span><span class="builtintype" id="5924389">string</span><span class="op" id="5924395">(</span><span class="ident" id="5924396">sparseHeader</span><span class="op" id="5924408">[</span><span class="op" id="5924409">:</span><span class="ident" id="5924410">nl</span><span class="op" id="5924412">]</span><span class="op" id="5924413">)</span><span class="op" id="5924414">,</span>&nbsp;<span class="num" id="5924416">10</span><span class="op" id="5924418">,</span>&nbsp;<span class="num" id="5924420">0</span><span class="op" id="5924421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924425">if</span>&nbsp;<span class="ident" id="5924428">err</span>&nbsp;<span class="op" id="5924432">!=</span>&nbsp;<span class="ident" id="5924435">nil</span>&nbsp;<span class="op" id="5924439">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924444">return</span>&nbsp;<span class="num" id="5924451">0</span><span class="op" id="5924452">,</span>&nbsp;<span class="ident" id="5924454">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924471">//&nbsp;Update&nbsp;sparseHeader&nbsp;to&nbsp;consume&nbsp;this&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924519">sparseHeader</span>&nbsp;<span class="op" id="5924532">=</span>&nbsp;<span class="ident" id="5924534">sparseHeader</span><span class="op" id="5924546">[</span><span class="ident" id="5924547">nl</span><span class="op" id="5924549">+</span><span class="num" id="5924550">1</span><span class="op" id="5924551">:</span><span class="op" id="5924552">]</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924556">return</span>&nbsp;<span class="ident" id="5924563">n</span><span class="op" id="5924564">,</span>&nbsp;<span class="ident" id="5924566">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924575">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924600">if</span>&nbsp;<span class="ident" id="5924603">_</span><span class="op" id="5924604">,</span>&nbsp;<span class="ident" id="5924606">err</span>&nbsp;<span class="op" id="5924610">:=</span>&nbsp;<span class="ident" id="5924613">io</span><span class="op" id="5924615">.</span><span class="ident" id="5924616">ReadFull</span><span class="op" id="5924624">(</span><span class="ident" id="5924625">r</span><span class="op" id="5924626">,</span>&nbsp;<span class="ident" id="5924628">sparseHeader</span><span class="op" id="5924640">)</span><span class="op" id="5924641">;</span>&nbsp;<span class="ident" id="5924643">err</span>&nbsp;<span class="op" id="5924647">!=</span>&nbsp;<span class="ident" id="5924650">nil</span>&nbsp;<span class="op" id="5924654">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924658">return</span>&nbsp;<span class="ident" id="5924665">nil</span><span class="op" id="5924668">,</span>&nbsp;<span class="ident" id="5924670">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924679">//&nbsp;The&nbsp;first&nbsp;line&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924729">numEntries</span><span class="op" id="5924739">,</span>&nbsp;<span class="ident" id="5924741">err</span>&nbsp;<span class="op" id="5924745">:=</span>&nbsp;<span class="ident" id="5924748">readDecimal</span><span class="op" id="5924759">(</span><span class="op" id="5924760">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924763">if</span>&nbsp;<span class="ident" id="5924766">err</span>&nbsp;<span class="op" id="5924770">!=</span>&nbsp;<span class="ident" id="5924773">nil</span>&nbsp;<span class="op" id="5924777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924781">return</span>&nbsp;<span class="ident" id="5924788">nil</span><span class="op" id="5924791">,</span>&nbsp;<span class="ident" id="5924793">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924802">//&nbsp;Read&nbsp;all&nbsp;the&nbsp;entries</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924827">sp</span>&nbsp;<span class="op" id="5924830">:=</span>&nbsp;<span class="builtinfunc" id="5924833">make</span><span class="op" id="5924837">(</span><span class="op" id="5924838">[</span><span class="op" id="5924839">]</span><span class="ident" id="5924840">sparseEntry</span><span class="op" id="5924851">,</span>&nbsp;<span class="num" id="5924853">0</span><span class="op" id="5924854">,</span>&nbsp;<span class="ident" id="5924856">numEntries</span><span class="op" id="5924866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924869">for</span>&nbsp;<span class="ident" id="5924873">i</span>&nbsp;<span class="op" id="5924875">:=</span>&nbsp;<span class="ident" id="5924878">int64</span><span class="op" id="5924883">(</span><span class="num" id="5924884">0</span><span class="op" id="5924885">)</span><span class="op" id="5924886">;</span>&nbsp;<span class="ident" id="5924888">i</span>&nbsp;<span class="op" id="5924890">&lt;</span>&nbsp;<span class="ident" id="5924892">numEntries</span><span class="op" id="5924902">;</span>&nbsp;<span class="ident" id="5924904">i</span><span class="op" id="5924905">++</span>&nbsp;<span class="op" id="5924908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5924912">//&nbsp;Read&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5924933">offset</span><span class="op" id="5924939">,</span>&nbsp;<span class="ident" id="5924941">err</span>&nbsp;<span class="op" id="5924945">:=</span>&nbsp;<span class="ident" id="5924948">readDecimal</span><span class="op" id="5924959">(</span><span class="op" id="5924960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924964">if</span>&nbsp;<span class="ident" id="5924967">err</span>&nbsp;<span class="op" id="5924971">!=</span>&nbsp;<span class="ident" id="5924974">nil</span>&nbsp;<span class="op" id="5924978">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924983">return</span>&nbsp;<span class="ident" id="5924990">nil</span><span class="op" id="5924993">,</span>&nbsp;<span class="ident" id="5924995">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925005">//&nbsp;Read&nbsp;numBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925024">numBytes</span><span class="op" id="5925032">,</span>&nbsp;<span class="ident" id="5925034">err</span>&nbsp;<span class="op" id="5925038">:=</span>&nbsp;<span class="ident" id="5925041">readDecimal</span><span class="op" id="5925052">(</span><span class="op" id="5925053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925057">if</span>&nbsp;<span class="ident" id="5925060">err</span>&nbsp;<span class="op" id="5925064">!=</span>&nbsp;<span class="ident" id="5925067">nil</span>&nbsp;<span class="op" id="5925071">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925076">return</span>&nbsp;<span class="ident" id="5925083">nil</span><span class="op" id="5925086">,</span>&nbsp;<span class="ident" id="5925088">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925099">sp</span>&nbsp;<span class="op" id="5925102">=</span>&nbsp;<span class="builtinfunc" id="5925104">append</span><span class="op" id="5925110">(</span><span class="ident" id="5925111">sp</span><span class="op" id="5925113">,</span>&nbsp;<span class="ident" id="5925115">sparseEntry</span><span class="op" id="5925126">{</span><span class="ident" id="5925127">offset</span><span class="op" id="5925133">:</span>&nbsp;<span class="ident" id="5925135">offset</span><span class="op" id="5925141">,</span>&nbsp;<span class="ident" id="5925143">numBytes</span><span class="op" id="5925151">:</span>&nbsp;<span class="ident" id="5925153">numBytes</span><span class="op" id="5925161">}</span><span class="op" id="5925162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925165">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925169">return</span>&nbsp;<span class="ident" id="5925176">sp</span><span class="op" id="5925178">,</span>&nbsp;<span class="ident" id="5925180">nil</span><br>
<span class="lineno"></span><span class="op" id="5925184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5925187">//&nbsp;readGNUSparseMap0x1&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;0.1.</span><br>
<span class="lineno">680</span><span class="comment" id="5925281">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="5925329">func</span>&nbsp;<span class="ident" id="5925334">readGNUSparseMap0x1</span><span class="op" id="5925353">(</span><span class="ident" id="5925354">headers</span>&nbsp;<span class="keyword" id="5925362">map</span><span class="op" id="5925365">[</span><span class="builtintype" id="5925366">string</span><span class="op" id="5925372">]</span><span class="builtintype" id="5925373">string</span><span class="op" id="5925379">)</span>&nbsp;<span class="op" id="5925381">(</span><span class="op" id="5925382">[</span><span class="op" id="5925383">]</span><span class="ident" id="5925384">sparseEntry</span><span class="op" id="5925395">,</span>&nbsp;<span class="builtintype" id="5925397">error</span><span class="op" id="5925402">)</span>&nbsp;<span class="op" id="5925404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925407">//&nbsp;Get&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925433">numEntriesStr</span><span class="op" id="5925446">,</span>&nbsp;<span class="ident" id="5925448">ok</span>&nbsp;<span class="op" id="5925451">:=</span>&nbsp;<span class="ident" id="5925454">headers</span><span class="op" id="5925461">[</span><span class="ident" id="5925462">paxGNUSparseNumBlocks</span><span class="op" id="5925483">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925486">if</span>&nbsp;<span class="op" id="5925489">!</span><span class="ident" id="5925490">ok</span>&nbsp;<span class="op" id="5925493">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925497">return</span>&nbsp;<span class="ident" id="5925504">nil</span><span class="op" id="5925507">,</span>&nbsp;<span class="ident" id="5925509">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925523">numEntries</span><span class="op" id="5925533">,</span>&nbsp;<span class="ident" id="5925535">err</span>&nbsp;<span class="op" id="5925539">:=</span>&nbsp;<span class="ident" id="5925542">strconv</span><span class="op" id="5925549">.</span><span class="ident" id="5925550">ParseInt</span><span class="op" id="5925558">(</span><span class="ident" id="5925559">numEntriesStr</span><span class="op" id="5925572">,</span>&nbsp;<span class="num" id="5925574">10</span><span class="op" id="5925576">,</span>&nbsp;<span class="num" id="5925578">0</span><span class="op" id="5925579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925582">if</span>&nbsp;<span class="ident" id="5925585">err</span>&nbsp;<span class="op" id="5925589">!=</span>&nbsp;<span class="ident" id="5925592">nil</span>&nbsp;<span class="op" id="5925596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925600">return</span>&nbsp;<span class="ident" id="5925607">nil</span><span class="op" id="5925610">,</span>&nbsp;<span class="ident" id="5925612">ErrHeader</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925627">sparseMap</span>&nbsp;<span class="op" id="5925637">:=</span>&nbsp;<span class="ident" id="5925640">strings</span><span class="op" id="5925647">.</span><span class="ident" id="5925648">Split</span><span class="op" id="5925653">(</span><span class="ident" id="5925654">headers</span><span class="op" id="5925661">[</span><span class="ident" id="5925662">paxGNUSparseMap</span><span class="op" id="5925677">]</span><span class="op" id="5925678">,</span>&nbsp;<span class="string" id="5925680">&#34;,&#34;</span><span class="op" id="5925683">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925687">//&nbsp;There&nbsp;should&nbsp;be&nbsp;two&nbsp;numbers&nbsp;in&nbsp;sparseMap&nbsp;for&nbsp;each&nbsp;entry</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925747">if</span>&nbsp;<span class="ident" id="5925750">int64</span><span class="op" id="5925755">(</span><span class="builtinfunc" id="5925756">len</span><span class="op" id="5925759">(</span><span class="ident" id="5925760">sparseMap</span><span class="op" id="5925769">)</span><span class="op" id="5925770">)</span>&nbsp;<span class="op" id="5925772">!=</span>&nbsp;<span class="num" id="5925775">2</span><span class="op" id="5925776">*</span><span class="ident" id="5925777">numEntries</span>&nbsp;<span class="op" id="5925788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925792">return</span>&nbsp;<span class="ident" id="5925799">nil</span><span class="op" id="5925802">,</span>&nbsp;<span class="ident" id="5925804">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925819">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;entries&nbsp;in&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925866">sp</span>&nbsp;<span class="op" id="5925869">:=</span>&nbsp;<span class="builtinfunc" id="5925872">make</span><span class="op" id="5925876">(</span><span class="op" id="5925877">[</span><span class="op" id="5925878">]</span><span class="ident" id="5925879">sparseEntry</span><span class="op" id="5925890">,</span>&nbsp;<span class="num" id="5925892">0</span><span class="op" id="5925893">,</span>&nbsp;<span class="ident" id="5925895">numEntries</span><span class="op" id="5925905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925908">for</span>&nbsp;<span class="ident" id="5925912">i</span>&nbsp;<span class="op" id="5925914">:=</span>&nbsp;<span class="ident" id="5925917">int64</span><span class="op" id="5925922">(</span><span class="num" id="5925923">0</span><span class="op" id="5925924">)</span><span class="op" id="5925925">;</span>&nbsp;<span class="ident" id="5925927">i</span>&nbsp;<span class="op" id="5925929">&lt;</span>&nbsp;<span class="ident" id="5925931">numEntries</span><span class="op" id="5925941">;</span>&nbsp;<span class="ident" id="5925943">i</span><span class="op" id="5925944">++</span>&nbsp;<span class="op" id="5925947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925951">offset</span><span class="op" id="5925957">,</span>&nbsp;<span class="ident" id="5925959">err</span>&nbsp;<span class="op" id="5925963">:=</span>&nbsp;<span class="ident" id="5925966">strconv</span><span class="op" id="5925973">.</span><span class="ident" id="5925974">ParseInt</span><span class="op" id="5925982">(</span><span class="ident" id="5925983">sparseMap</span><span class="op" id="5925992">[</span><span class="num" id="5925993">2</span><span class="op" id="5925994">*</span><span class="ident" id="5925995">i</span><span class="op" id="5925996">]</span><span class="op" id="5925997">,</span>&nbsp;<span class="num" id="5925999">10</span><span class="op" id="5926001">,</span>&nbsp;<span class="num" id="5926003">0</span><span class="op" id="5926004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926008">if</span>&nbsp;<span class="ident" id="5926011">err</span>&nbsp;<span class="op" id="5926015">!=</span>&nbsp;<span class="ident" id="5926018">nil</span>&nbsp;<span class="op" id="5926022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926027">return</span>&nbsp;<span class="ident" id="5926034">nil</span><span class="op" id="5926037">,</span>&nbsp;<span class="ident" id="5926039">ErrHeader</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926055">numBytes</span><span class="op" id="5926063">,</span>&nbsp;<span class="ident" id="5926065">err</span>&nbsp;<span class="op" id="5926069">:=</span>&nbsp;<span class="ident" id="5926072">strconv</span><span class="op" id="5926079">.</span><span class="ident" id="5926080">ParseInt</span><span class="op" id="5926088">(</span><span class="ident" id="5926089">sparseMap</span><span class="op" id="5926098">[</span><span class="num" id="5926099">2</span><span class="op" id="5926100">*</span><span class="ident" id="5926101">i</span><span class="op" id="5926102">+</span><span class="num" id="5926103">1</span><span class="op" id="5926104">]</span><span class="op" id="5926105">,</span>&nbsp;<span class="num" id="5926107">10</span><span class="op" id="5926109">,</span>&nbsp;<span class="num" id="5926111">0</span><span class="op" id="5926112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926116">if</span>&nbsp;<span class="ident" id="5926119">err</span>&nbsp;<span class="op" id="5926123">!=</span>&nbsp;<span class="ident" id="5926126">nil</span>&nbsp;<span class="op" id="5926130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926135">return</span>&nbsp;<span class="ident" id="5926142">nil</span><span class="op" id="5926145">,</span>&nbsp;<span class="ident" id="5926147">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926159">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926163">sp</span>&nbsp;<span class="op" id="5926166">=</span>&nbsp;<span class="builtinfunc" id="5926168">append</span><span class="op" id="5926174">(</span><span class="ident" id="5926175">sp</span><span class="op" id="5926177">,</span>&nbsp;<span class="ident" id="5926179">sparseEntry</span><span class="op" id="5926190">{</span><span class="ident" id="5926191">offset</span><span class="op" id="5926197">:</span>&nbsp;<span class="ident" id="5926199">offset</span><span class="op" id="5926205">,</span>&nbsp;<span class="ident" id="5926207">numBytes</span><span class="op" id="5926215">:</span>&nbsp;<span class="ident" id="5926217">numBytes</span><span class="op" id="5926225">}</span><span class="op" id="5926226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926233">return</span>&nbsp;<span class="ident" id="5926240">sp</span><span class="op" id="5926242">,</span>&nbsp;<span class="ident" id="5926244">nil</span><br>
<span class="lineno"></span><span class="op" id="5926248">}</span><br>
<span class="lineno">715</span><br>
<span class="lineno"></span><span class="comment" id="5926251">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;current&nbsp;file&#39;s&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="5926332">//&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;or&nbsp;0&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;current&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5926389">func</span>&nbsp;<span class="op" id="5926394">(</span><span class="ident" id="5926395">tr</span>&nbsp;<span class="op" id="5926398">*</span><span class="ident" id="5926399">Reader</span><span class="op" id="5926405">)</span>&nbsp;<span class="ident" id="5926407">numBytes</span><span class="op" id="5926415">(</span><span class="op" id="5926416">)</span>&nbsp;<span class="ident" id="5926418">int64</span>&nbsp;<span class="op" id="5926424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926427">if</span>&nbsp;<span class="ident" id="5926430">tr</span><span class="op" id="5926432">.</span><span class="ident" id="5926433">curr</span>&nbsp;<span class="op" id="5926438">==</span>&nbsp;<span class="ident" id="5926441">nil</span>&nbsp;<span class="op" id="5926445">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926449">//&nbsp;No&nbsp;current&nbsp;file,&nbsp;so&nbsp;no&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926483">return</span>&nbsp;<span class="num" id="5926490">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926496">return</span>&nbsp;<span class="ident" id="5926503">tr</span><span class="op" id="5926505">.</span><span class="ident" id="5926506">curr</span><span class="op" id="5926510">.</span><span class="ident" id="5926511">numBytes</span><span class="op" id="5926519">(</span><span class="op" id="5926520">)</span><br>
<span class="lineno"></span><span class="op" id="5926522">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="5926525">//&nbsp;Read&nbsp;reads&nbsp;from&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5926582">//&nbsp;It&nbsp;returns&nbsp;0,&nbsp;io.EOF&nbsp;when&nbsp;it&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;that&nbsp;entry,</span><br>
<span class="lineno"></span><span class="comment" id="5926645">//&nbsp;until&nbsp;Next&nbsp;is&nbsp;called&nbsp;to&nbsp;advance&nbsp;to&nbsp;the&nbsp;next&nbsp;entry.</span><br>
<span class="lineno"></span><span class="keyword" id="5926699">func</span>&nbsp;<span class="op" id="5926704">(</span><span class="ident" id="5926705">tr</span>&nbsp;<span class="op" id="5926708">*</span><span class="ident" id="5926709">Reader</span><span class="op" id="5926715">)</span>&nbsp;<span class="ident" id="5926717">Read</span><span class="op" id="5926721">(</span><span class="ident" id="5926722">b</span>&nbsp;<span class="op" id="5926724">[</span><span class="op" id="5926725">]</span><span class="builtintype" id="5926726">byte</span><span class="op" id="5926730">)</span>&nbsp;<span class="op" id="5926732">(</span><span class="ident" id="5926733">n</span>&nbsp;<span class="builtintype" id="5926735">int</span><span class="op" id="5926738">,</span>&nbsp;<span class="ident" id="5926740">err</span>&nbsp;<span class="builtintype" id="5926744">error</span><span class="op" id="5926749">)</span>&nbsp;<span class="op" id="5926751">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926754">if</span>&nbsp;<span class="ident" id="5926757">tr</span><span class="op" id="5926759">.</span><span class="ident" id="5926760">curr</span>&nbsp;<span class="op" id="5926765">==</span>&nbsp;<span class="ident" id="5926768">nil</span>&nbsp;<span class="op" id="5926772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926776">return</span>&nbsp;<span class="num" id="5926783">0</span><span class="op" id="5926784">,</span>&nbsp;<span class="ident" id="5926786">io</span><span class="op" id="5926788">.</span><span class="ident" id="5926789">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926797">n</span><span class="op" id="5926798">,</span>&nbsp;<span class="ident" id="5926800">err</span>&nbsp;<span class="op" id="5926804">=</span>&nbsp;<span class="ident" id="5926806">tr</span><span class="op" id="5926808">.</span><span class="ident" id="5926809">curr</span><span class="op" id="5926813">.</span><span class="ident" id="5926814">Read</span><span class="op" id="5926818">(</span><span class="ident" id="5926819">b</span><span class="op" id="5926820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926823">if</span>&nbsp;<span class="ident" id="5926826">err</span>&nbsp;<span class="op" id="5926830">!=</span>&nbsp;<span class="ident" id="5926833">nil</span>&nbsp;<span class="op" id="5926837">&amp;&amp;</span>&nbsp;<span class="ident" id="5926840">err</span>&nbsp;<span class="op" id="5926844">!=</span>&nbsp;<span class="ident" id="5926847">io</span><span class="op" id="5926849">.</span><span class="ident" id="5926850">EOF</span>&nbsp;<span class="op" id="5926854">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926858">tr</span><span class="op" id="5926860">.</span><span class="ident" id="5926861">err</span>&nbsp;<span class="op" id="5926865">=</span>&nbsp;<span class="ident" id="5926867">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926875">return</span><br>
<span class="lineno"></span><span class="op" id="5926882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="5926885">func</span>&nbsp;<span class="op" id="5926890">(</span><span class="ident" id="5926891">rfr</span>&nbsp;<span class="op" id="5926895">*</span><span class="ident" id="5926896">regFileReader</span><span class="op" id="5926909">)</span>&nbsp;<span class="ident" id="5926911">Read</span><span class="op" id="5926915">(</span><span class="ident" id="5926916">b</span>&nbsp;<span class="op" id="5926918">[</span><span class="op" id="5926919">]</span><span class="builtintype" id="5926920">byte</span><span class="op" id="5926924">)</span>&nbsp;<span class="op" id="5926926">(</span><span class="ident" id="5926927">n</span>&nbsp;<span class="builtintype" id="5926929">int</span><span class="op" id="5926932">,</span>&nbsp;<span class="ident" id="5926934">err</span>&nbsp;<span class="builtintype" id="5926938">error</span><span class="op" id="5926943">)</span>&nbsp;<span class="op" id="5926945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926948">if</span>&nbsp;<span class="ident" id="5926951">rfr</span><span class="op" id="5926954">.</span><span class="ident" id="5926955">nb</span>&nbsp;<span class="op" id="5926958">==</span>&nbsp;<span class="num" id="5926961">0</span>&nbsp;<span class="op" id="5926963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926967">//&nbsp;file&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926986">return</span>&nbsp;<span class="num" id="5926993">0</span><span class="op" id="5926994">,</span>&nbsp;<span class="ident" id="5926996">io</span><span class="op" id="5926998">.</span><span class="ident" id="5926999">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927004">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927007">if</span>&nbsp;<span class="ident" id="5927010">int64</span><span class="op" id="5927015">(</span><span class="builtinfunc" id="5927016">len</span><span class="op" id="5927019">(</span><span class="ident" id="5927020">b</span><span class="op" id="5927021">)</span><span class="op" id="5927022">)</span>&nbsp;<span class="op" id="5927024">&gt;</span>&nbsp;<span class="ident" id="5927026">rfr</span><span class="op" id="5927029">.</span><span class="ident" id="5927030">nb</span>&nbsp;<span class="op" id="5927033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927037">b</span>&nbsp;<span class="op" id="5927039">=</span>&nbsp;<span class="ident" id="5927041">b</span><span class="op" id="5927042">[</span><span class="num" id="5927043">0</span><span class="op" id="5927044">:</span><span class="ident" id="5927045">rfr</span><span class="op" id="5927048">.</span><span class="ident" id="5927049">nb</span><span class="op" id="5927051">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927057">n</span><span class="op" id="5927058">,</span>&nbsp;<span class="ident" id="5927060">err</span>&nbsp;<span class="op" id="5927064">=</span>&nbsp;<span class="ident" id="5927066">rfr</span><span class="op" id="5927069">.</span><span class="ident" id="5927070">r</span><span class="op" id="5927071">.</span><span class="ident" id="5927072">Read</span><span class="op" id="5927076">(</span><span class="ident" id="5927077">b</span><span class="op" id="5927078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927081">rfr</span><span class="op" id="5927084">.</span><span class="ident" id="5927085">nb</span>&nbsp;<span class="op" id="5927088">-=</span>&nbsp;<span class="ident" id="5927091">int64</span><span class="op" id="5927096">(</span><span class="ident" id="5927097">n</span><span class="op" id="5927098">)</span><br>
<span class="lineno">750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927102">if</span>&nbsp;<span class="ident" id="5927105">err</span>&nbsp;<span class="op" id="5927109">==</span>&nbsp;<span class="ident" id="5927112">io</span><span class="op" id="5927114">.</span><span class="ident" id="5927115">EOF</span>&nbsp;<span class="op" id="5927119">&amp;&amp;</span>&nbsp;<span class="ident" id="5927122">rfr</span><span class="op" id="5927125">.</span><span class="ident" id="5927126">nb</span>&nbsp;<span class="op" id="5927129">&gt;</span>&nbsp;<span class="num" id="5927131">0</span>&nbsp;<span class="op" id="5927133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927137">err</span>&nbsp;<span class="op" id="5927141">=</span>&nbsp;<span class="ident" id="5927143">io</span><span class="op" id="5927145">.</span><span class="ident" id="5927146">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927167">return</span><br>
<span class="lineno">755</span><span class="op" id="5927174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5927177">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;file&#39;s&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5927269">func</span>&nbsp;<span class="op" id="5927274">(</span><span class="ident" id="5927275">rfr</span>&nbsp;<span class="op" id="5927279">*</span><span class="ident" id="5927280">regFileReader</span><span class="op" id="5927293">)</span>&nbsp;<span class="ident" id="5927295">numBytes</span><span class="op" id="5927303">(</span><span class="op" id="5927304">)</span>&nbsp;<span class="ident" id="5927306">int64</span>&nbsp;<span class="op" id="5927312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927315">return</span>&nbsp;<span class="ident" id="5927322">rfr</span><span class="op" id="5927325">.</span><span class="ident" id="5927326">nb</span><br>
<span class="lineno">760</span><span class="op" id="5927329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5927332">//&nbsp;readHole&nbsp;reads&nbsp;a&nbsp;sparse&nbsp;file&nbsp;hole&nbsp;ending&nbsp;at&nbsp;offset&nbsp;toOffset</span><br>
<span class="lineno"></span><span class="keyword" id="5927395">func</span>&nbsp;<span class="op" id="5927400">(</span><span class="ident" id="5927401">sfr</span>&nbsp;<span class="op" id="5927405">*</span><span class="ident" id="5927406">sparseFileReader</span><span class="op" id="5927422">)</span>&nbsp;<span class="ident" id="5927424">readHole</span><span class="op" id="5927432">(</span><span class="ident" id="5927433">b</span>&nbsp;<span class="op" id="5927435">[</span><span class="op" id="5927436">]</span><span class="builtintype" id="5927437">byte</span><span class="op" id="5927441">,</span>&nbsp;<span class="ident" id="5927443">toOffset</span>&nbsp;<span class="ident" id="5927452">int64</span><span class="op" id="5927457">)</span>&nbsp;<span class="builtintype" id="5927459">int</span>&nbsp;<span class="op" id="5927463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927466">n64</span>&nbsp;<span class="op" id="5927470">:=</span>&nbsp;<span class="ident" id="5927473">toOffset</span>&nbsp;<span class="op" id="5927482">-</span>&nbsp;<span class="ident" id="5927484">sfr</span><span class="op" id="5927487">.</span><span class="ident" id="5927488">pos</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927493">if</span>&nbsp;<span class="ident" id="5927496">n64</span>&nbsp;<span class="op" id="5927500">&gt;</span>&nbsp;<span class="ident" id="5927502">int64</span><span class="op" id="5927507">(</span><span class="builtinfunc" id="5927508">len</span><span class="op" id="5927511">(</span><span class="ident" id="5927512">b</span><span class="op" id="5927513">)</span><span class="op" id="5927514">)</span>&nbsp;<span class="op" id="5927516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927520">n64</span>&nbsp;<span class="op" id="5927524">=</span>&nbsp;<span class="ident" id="5927526">int64</span><span class="op" id="5927531">(</span><span class="builtinfunc" id="5927532">len</span><span class="op" id="5927535">(</span><span class="ident" id="5927536">b</span><span class="op" id="5927537">)</span><span class="op" id="5927538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927544">n</span>&nbsp;<span class="op" id="5927546">:=</span>&nbsp;<span class="builtintype" id="5927549">int</span><span class="op" id="5927552">(</span><span class="ident" id="5927553">n64</span><span class="op" id="5927556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927559">for</span>&nbsp;<span class="ident" id="5927563">i</span>&nbsp;<span class="op" id="5927565">:=</span>&nbsp;<span class="num" id="5927568">0</span><span class="op" id="5927569">;</span>&nbsp;<span class="ident" id="5927571">i</span>&nbsp;<span class="op" id="5927573">&lt;</span>&nbsp;<span class="ident" id="5927575">n</span><span class="op" id="5927576">;</span>&nbsp;<span class="ident" id="5927578">i</span><span class="op" id="5927579">++</span>&nbsp;<span class="op" id="5927582">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927586">b</span><span class="op" id="5927587">[</span><span class="ident" id="5927588">i</span><span class="op" id="5927589">]</span>&nbsp;<span class="op" id="5927591">=</span>&nbsp;<span class="num" id="5927593">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927599">sfr</span><span class="op" id="5927602">.</span><span class="ident" id="5927603">pos</span>&nbsp;<span class="op" id="5927607">+=</span>&nbsp;<span class="ident" id="5927610">n64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927615">return</span>&nbsp;<span class="ident" id="5927622">n</span><br>
<span class="lineno"></span><span class="op" id="5927624">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="5927627">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;file&nbsp;data&nbsp;in&nbsp;expanded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="5927680">func</span>&nbsp;<span class="op" id="5927685">(</span><span class="ident" id="5927686">sfr</span>&nbsp;<span class="op" id="5927690">*</span><span class="ident" id="5927691">sparseFileReader</span><span class="op" id="5927707">)</span>&nbsp;<span class="ident" id="5927709">Read</span><span class="op" id="5927713">(</span><span class="ident" id="5927714">b</span>&nbsp;<span class="op" id="5927716">[</span><span class="op" id="5927717">]</span><span class="builtintype" id="5927718">byte</span><span class="op" id="5927722">)</span>&nbsp;<span class="op" id="5927724">(</span><span class="ident" id="5927725">n</span>&nbsp;<span class="builtintype" id="5927727">int</span><span class="op" id="5927730">,</span>&nbsp;<span class="ident" id="5927732">err</span>&nbsp;<span class="builtintype" id="5927736">error</span><span class="op" id="5927741">)</span>&nbsp;<span class="op" id="5927743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927746">if</span>&nbsp;<span class="builtinfunc" id="5927749">len</span><span class="op" id="5927752">(</span><span class="ident" id="5927753">sfr</span><span class="op" id="5927756">.</span><span class="ident" id="5927757">sp</span><span class="op" id="5927759">)</span>&nbsp;<span class="op" id="5927761">==</span>&nbsp;<span class="num" id="5927764">0</span>&nbsp;<span class="op" id="5927766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5927770">//&nbsp;No&nbsp;more&nbsp;data&nbsp;fragments&nbsp;to&nbsp;read&nbsp;from.</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927812">if</span>&nbsp;<span class="ident" id="5927815">sfr</span><span class="op" id="5927818">.</span><span class="ident" id="5927819">pos</span>&nbsp;<span class="op" id="5927823">&lt;</span>&nbsp;<span class="ident" id="5927825">sfr</span><span class="op" id="5927828">.</span><span class="ident" id="5927829">tot</span>&nbsp;<span class="op" id="5927833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5927838">//&nbsp;We&#39;re&nbsp;in&nbsp;the&nbsp;last&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927867">n</span>&nbsp;<span class="op" id="5927869">=</span>&nbsp;<span class="ident" id="5927871">sfr</span><span class="op" id="5927874">.</span><span class="ident" id="5927875">readHole</span><span class="op" id="5927883">(</span><span class="ident" id="5927884">b</span><span class="op" id="5927885">,</span>&nbsp;<span class="ident" id="5927887">sfr</span><span class="op" id="5927890">.</span><span class="ident" id="5927891">tot</span><span class="op" id="5927894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927899">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927908">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5927912">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927957">return</span>&nbsp;<span class="num" id="5927964">0</span><span class="op" id="5927965">,</span>&nbsp;<span class="ident" id="5927967">io</span><span class="op" id="5927969">.</span><span class="ident" id="5927970">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927978">if</span>&nbsp;<span class="ident" id="5927981">sfr</span><span class="op" id="5927984">.</span><span class="ident" id="5927985">pos</span>&nbsp;<span class="op" id="5927989">&lt;</span>&nbsp;<span class="ident" id="5927991">sfr</span><span class="op" id="5927994">.</span><span class="ident" id="5927995">sp</span><span class="op" id="5927997">[</span><span class="num" id="5927998">0</span><span class="op" id="5927999">]</span><span class="op" id="5928000">.</span><span class="ident" id="5928001">offset</span>&nbsp;<span class="op" id="5928008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928012">//&nbsp;We&#39;re&nbsp;in&nbsp;a&nbsp;hole</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928033">n</span>&nbsp;<span class="op" id="5928035">=</span>&nbsp;<span class="ident" id="5928037">sfr</span><span class="op" id="5928040">.</span><span class="ident" id="5928041">readHole</span><span class="op" id="5928049">(</span><span class="ident" id="5928050">b</span><span class="op" id="5928051">,</span>&nbsp;<span class="ident" id="5928053">sfr</span><span class="op" id="5928056">.</span><span class="ident" id="5928057">sp</span><span class="op" id="5928059">[</span><span class="num" id="5928060">0</span><span class="op" id="5928061">]</span><span class="op" id="5928062">.</span><span class="ident" id="5928063">offset</span><span class="op" id="5928069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928073">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928085">//&nbsp;We&#39;re&nbsp;not&nbsp;in&nbsp;a&nbsp;hole,&nbsp;so&nbsp;we&#39;ll&nbsp;read&nbsp;from&nbsp;the&nbsp;next&nbsp;data&nbsp;fragment</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928152">posInFragment</span>&nbsp;<span class="op" id="5928166">:=</span>&nbsp;<span class="ident" id="5928169">sfr</span><span class="op" id="5928172">.</span><span class="ident" id="5928173">pos</span>&nbsp;<span class="op" id="5928177">-</span>&nbsp;<span class="ident" id="5928179">sfr</span><span class="op" id="5928182">.</span><span class="ident" id="5928183">sp</span><span class="op" id="5928185">[</span><span class="num" id="5928186">0</span><span class="op" id="5928187">]</span><span class="op" id="5928188">.</span><span class="ident" id="5928189">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928197">bytesLeft</span>&nbsp;<span class="op" id="5928207">:=</span>&nbsp;<span class="ident" id="5928210">sfr</span><span class="op" id="5928213">.</span><span class="ident" id="5928214">sp</span><span class="op" id="5928216">[</span><span class="num" id="5928217">0</span><span class="op" id="5928218">]</span><span class="op" id="5928219">.</span><span class="ident" id="5928220">numBytes</span>&nbsp;<span class="op" id="5928229">-</span>&nbsp;<span class="ident" id="5928231">posInFragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928246">if</span>&nbsp;<span class="ident" id="5928249">int64</span><span class="op" id="5928254">(</span><span class="builtinfunc" id="5928255">len</span><span class="op" id="5928258">(</span><span class="ident" id="5928259">b</span><span class="op" id="5928260">)</span><span class="op" id="5928261">)</span>&nbsp;<span class="op" id="5928263">&gt;</span>&nbsp;<span class="ident" id="5928265">bytesLeft</span>&nbsp;<span class="op" id="5928275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928279">b</span>&nbsp;<span class="op" id="5928281">=</span>&nbsp;<span class="ident" id="5928283">b</span><span class="op" id="5928284">[</span><span class="num" id="5928285">0</span><span class="op" id="5928286">:</span><span class="ident" id="5928287">bytesLeft</span><span class="op" id="5928296">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928299">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928303">n</span><span class="op" id="5928304">,</span>&nbsp;<span class="ident" id="5928306">err</span>&nbsp;<span class="op" id="5928310">=</span>&nbsp;<span class="ident" id="5928312">sfr</span><span class="op" id="5928315">.</span><span class="ident" id="5928316">rfr</span><span class="op" id="5928319">.</span><span class="ident" id="5928320">Read</span><span class="op" id="5928324">(</span><span class="ident" id="5928325">b</span><span class="op" id="5928326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928329">sfr</span><span class="op" id="5928332">.</span><span class="ident" id="5928333">pos</span>&nbsp;<span class="op" id="5928337">+=</span>&nbsp;<span class="ident" id="5928340">int64</span><span class="op" id="5928345">(</span><span class="ident" id="5928346">n</span><span class="op" id="5928347">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928351">if</span>&nbsp;<span class="ident" id="5928354">int64</span><span class="op" id="5928359">(</span><span class="ident" id="5928360">n</span><span class="op" id="5928361">)</span>&nbsp;<span class="op" id="5928363">==</span>&nbsp;<span class="ident" id="5928366">bytesLeft</span>&nbsp;<span class="op" id="5928376">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928380">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928415">sfr</span><span class="op" id="5928418">.</span><span class="ident" id="5928419">sp</span>&nbsp;<span class="op" id="5928422">=</span>&nbsp;<span class="ident" id="5928424">sfr</span><span class="op" id="5928427">.</span><span class="ident" id="5928428">sp</span><span class="op" id="5928430">[</span><span class="num" id="5928431">1</span><span class="op" id="5928432">:</span><span class="op" id="5928433">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928440">if</span>&nbsp;<span class="ident" id="5928443">err</span>&nbsp;<span class="op" id="5928447">==</span>&nbsp;<span class="ident" id="5928450">io</span><span class="op" id="5928452">.</span><span class="ident" id="5928453">EOF</span>&nbsp;<span class="op" id="5928457">&amp;&amp;</span>&nbsp;<span class="ident" id="5928460">sfr</span><span class="op" id="5928463">.</span><span class="ident" id="5928464">pos</span>&nbsp;<span class="op" id="5928468">&lt;</span>&nbsp;<span class="ident" id="5928470">sfr</span><span class="op" id="5928473">.</span><span class="ident" id="5928474">tot</span>&nbsp;<span class="op" id="5928478">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5928482">//&nbsp;We&nbsp;reached&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;last&nbsp;fragment&#39;s&nbsp;data,&nbsp;but&nbsp;there&#39;s&nbsp;a&nbsp;final&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5928560">err</span>&nbsp;<span class="op" id="5928564">=</span>&nbsp;<span class="ident" id="5928566">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5928571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928574">return</span><br>
<span class="lineno"></span><span class="op" id="5928581">}</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="5928584">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;sparse&nbsp;file&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5928658">//&nbsp;sparse-encoded&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5928701">func</span>&nbsp;<span class="op" id="5928706">(</span><span class="ident" id="5928707">sfr</span>&nbsp;<span class="op" id="5928711">*</span><span class="ident" id="5928712">sparseFileReader</span><span class="op" id="5928728">)</span>&nbsp;<span class="ident" id="5928730">numBytes</span><span class="op" id="5928738">(</span><span class="op" id="5928739">)</span>&nbsp;<span class="ident" id="5928741">int64</span>&nbsp;<span class="op" id="5928747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5928750">return</span>&nbsp;<span class="ident" id="5928757">sfr</span><span class="op" id="5928760">.</span><span class="ident" id="5928761">rfr</span><span class="op" id="5928764">.</span><span class="ident" id="5928765">nb</span><br>
<span class="lineno">820</span><span class="op" id="5928768">}</span>
</div>
</body>
</html>
