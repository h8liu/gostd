<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html" class="current">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8316683">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8316738">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8316792">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8316843">package</span>&nbsp;<span class="ident" id="8316851">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8316856">import</span>&nbsp;<span class="op" id="8316863">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8316866">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8316875">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8316882">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8316888">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8316895">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8316906">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8316917">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8316924">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8316927">var</span>&nbsp;<span class="ident" id="8316931">rsaCertPEM</span>&nbsp;<span class="op" id="8316942">=</span>&nbsp;<span class="string" id="8316944">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB0zCCAX2gAwIBAgIJAI/M7BYjwB+uMA0GCSqGSIb3DQEBBQUAMEUxCzAJBgNV<br>
<span class="lineno"></span>BAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBX<br>
<span class="lineno">20</span>aWRnaXRzIFB0eSBMdGQwHhcNMTIwOTEyMjE1MjAyWhcNMTUwOTEyMjE1MjAyWjBF<br>
<span class="lineno"></span>MQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50<br>
<span class="lineno"></span>ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBANLJ<br>
<span class="lineno"></span>hPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wok/4xIA+ui35/MmNa<br>
<span class="lineno"></span>rtNuC+BdZ1tMuVCPFZcCAwEAAaNQME4wHQYDVR0OBBYEFJvKs8RfJaXTH08W+SGv<br>
<span class="lineno">25</span>zQyKn0H8MB8GA1UdIwQYMBaAFJvKs8RfJaXTH08W+SGvzQyKn0H8MAwGA1UdEwQF<br>
<span class="lineno"></span>MAMBAf8wDQYJKoZIhvcNAQEFBQADQQBJlffJHybjDGxRMqaRmDhX0+6v02TUKZsW<br>
<span class="lineno"></span>r5QuVbpQhH6u+0UgcW0jp9QwpxoPTLTWGXEWBBBurxFwiCBhkQ+V<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="8317640">var</span>&nbsp;<span class="ident" id="8317644">rsaKeyPEM</span>&nbsp;<span class="op" id="8317654">=</span>&nbsp;<span class="string" id="8317656">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno">35</span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno"></span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">40</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8318157">//&nbsp;keyPEM&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;rsaKeyPEM,&nbsp;but&nbsp;declares&nbsp;itself&nbsp;as&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="8318221">//&nbsp;&#34;PRIVATE&nbsp;KEY&#34;,&nbsp;not&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;.&nbsp;&nbsp;http://golang.org/issue/4477</span><br>
<span class="lineno"></span><span class="keyword" id="8318292">var</span>&nbsp;<span class="ident" id="8318296">keyPEM</span>&nbsp;<span class="op" id="8318303">=</span>&nbsp;<span class="string" id="8318305">`-----BEGIN&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">45</span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno"></span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno">50</span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="8318798">var</span>&nbsp;<span class="ident" id="8318802">ecdsaCertPEM</span>&nbsp;<span class="op" id="8318815">=</span>&nbsp;<span class="string" id="8318817">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/jCCAWICCQDscdUxw16XFDAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTI0MDQ4WhcNMTUxMTE0MTI0MDQ4WjBFMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTETMBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lk<br>
<span class="lineno">60</span>Z2l0cyBQdHkgTHRkMIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQBY9+my9OoeSUR<br>
<span class="lineno"></span>lDQdV/x8LsOuLilthhiS1Tz4aGDHIPwC1mlvnf7fg5lecYpMCrLLhauAc1UJXcgl<br>
<span class="lineno"></span>01xoLuzgtAEAgv2P/jgytzRSpUYvgLBt1UA0leLYBy6mQQbrNEuqT3INapKIcUv8<br>
<span class="lineno"></span>XxYP0xMEUksLPq6Ca+CRSqTtrd/23uTnapkwCQYHKoZIzj0EAQOBigAwgYYCQXJo<br>
<span class="lineno"></span>A7Sl2nLVf+4Iu/tAX/IF4MavARKC4PPHK3zfuGfPR3oCCcsAoz3kAzOeijvd0iXb<br>
<span class="lineno">65</span>H5jBImIxPL4WxQNiBTexAkF8D1EtpYuWdlVQ80/h/f4pBcGiXPqX5h2PQSQY7hP1<br>
<span class="lineno"></span>+jwM1FGS4fREIOvlBYr/SzzQRtwrvrzGYxDEDbsC0ZGRnA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="8319574">var</span>&nbsp;<span class="ident" id="8319578">ecdsaKeyPEM</span>&nbsp;<span class="op" id="8319590">=</span>&nbsp;<span class="string" id="8319592">`-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBrsoKp0oqcv6/JovJJDoDVSGWdirrkgCWxrprGlzB9o0X8fV675X0<br>
<span class="lineno">75</span>NwuBenXFfeZvVcwluO7/Q9wkYoPd/t3jGImgBwYFK4EEACOhgYkDgYYABAFj36bL<br>
<span class="lineno"></span>06h5JRGUNB1X/Hwuw64uKW2GGJLVPPhoYMcg/ALWaW+d/t+DmV5xikwKssuFq4Bz<br>
<span class="lineno"></span>VQldyCXTXGgu7OC0AQCC/Y/+ODK3NFKlRi+AsG3VQDSV4tgHLqZBBus0S6pPcg1q<br>
<span class="lineno"></span>kohxS/xfFg/TEwRSSws+roJr4JFKpO2t3/be5OdqmQ==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">80</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8320032">var</span>&nbsp;<span class="ident" id="8320036">keyPairTests</span>&nbsp;<span class="op" id="8320049">=</span>&nbsp;<span class="op" id="8320051">[</span><span class="op" id="8320052">]</span><span class="keyword" id="8320053">struct</span>&nbsp;<span class="op" id="8320060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320063">algo</span>&nbsp;<span class="builtintype" id="8320068">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320076">cert</span>&nbsp;<span class="builtintype" id="8320081">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320089">key</span>&nbsp;&nbsp;<span class="builtintype" id="8320094">string</span><br>
<span class="lineno"></span><span class="op" id="8320101">}</span><span class="op" id="8320102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8320105">{</span><span class="string" id="8320106">&#34;ECDSA&#34;</span><span class="op" id="8320113">,</span>&nbsp;<span class="ident" id="8320115">ecdsaCertPEM</span><span class="op" id="8320127">,</span>&nbsp;<span class="ident" id="8320129">ecdsaKeyPEM</span><span class="op" id="8320140">}</span><span class="op" id="8320141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8320144">{</span><span class="string" id="8320145">&#34;RSA&#34;</span><span class="op" id="8320150">,</span>&nbsp;<span class="ident" id="8320152">rsaCertPEM</span><span class="op" id="8320162">,</span>&nbsp;<span class="ident" id="8320164">rsaKeyPEM</span><span class="op" id="8320173">}</span><span class="op" id="8320174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8320177">{</span><span class="string" id="8320178">&#34;RSA-untyped&#34;</span><span class="op" id="8320191">,</span>&nbsp;<span class="ident" id="8320193">rsaCertPEM</span><span class="op" id="8320203">,</span>&nbsp;<span class="ident" id="8320205">keyPEM</span><span class="op" id="8320211">}</span><span class="op" id="8320212">,</span>&nbsp;<span class="comment" id="8320214">//&nbsp;golang.org/issue/4477</span><br>
<span class="lineno">90</span><span class="op" id="8320239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8320242">func</span>&nbsp;<span class="ident" id="8320247">TestX509KeyPair</span><span class="op" id="8320262">(</span><span class="ident" id="8320263">t</span>&nbsp;<span class="op" id="8320265">*</span><span class="ident" id="8320266">testing</span><span class="op" id="8320273">.</span><span class="ident" id="8320274">T</span><span class="op" id="8320275">)</span>&nbsp;<span class="op" id="8320277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320280">var</span>&nbsp;<span class="ident" id="8320284">pem</span>&nbsp;<span class="op" id="8320288">[</span><span class="op" id="8320289">]</span><span class="builtintype" id="8320290">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320296">for</span>&nbsp;<span class="ident" id="8320300">_</span><span class="op" id="8320301">,</span>&nbsp;<span class="ident" id="8320303">test</span>&nbsp;<span class="op" id="8320308">:=</span>&nbsp;<span class="keyword" id="8320311">range</span>&nbsp;<span class="ident" id="8320317">keyPairTests</span>&nbsp;<span class="op" id="8320330">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320334">pem</span>&nbsp;<span class="op" id="8320338">=</span>&nbsp;<span class="op" id="8320340">[</span><span class="op" id="8320341">]</span><span class="builtintype" id="8320342">byte</span><span class="op" id="8320346">(</span><span class="ident" id="8320347">test</span><span class="op" id="8320351">.</span><span class="ident" id="8320352">cert</span>&nbsp;<span class="op" id="8320357">+</span>&nbsp;<span class="ident" id="8320359">test</span><span class="op" id="8320363">.</span><span class="ident" id="8320364">key</span><span class="op" id="8320367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320371">if</span>&nbsp;<span class="ident" id="8320374">_</span><span class="op" id="8320375">,</span>&nbsp;<span class="ident" id="8320377">err</span>&nbsp;<span class="op" id="8320381">:=</span>&nbsp;<span class="ident" id="8320384">X509KeyPair</span><span class="op" id="8320395">(</span><span class="ident" id="8320396">pem</span><span class="op" id="8320399">,</span>&nbsp;<span class="ident" id="8320401">pem</span><span class="op" id="8320404">)</span><span class="op" id="8320405">;</span>&nbsp;<span class="ident" id="8320407">err</span>&nbsp;<span class="op" id="8320411">!=</span>&nbsp;<span class="ident" id="8320414">nil</span>&nbsp;<span class="op" id="8320418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320423">t</span><span class="op" id="8320424">.</span><span class="ident" id="8320425">Errorf</span><span class="op" id="8320431">(</span><span class="string" id="8320432">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;cert&nbsp;followed&nbsp;by&nbsp;%s&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="8320479">,</span>&nbsp;<span class="ident" id="8320481">test</span><span class="op" id="8320485">.</span><span class="ident" id="8320486">algo</span><span class="op" id="8320490">,</span>&nbsp;<span class="ident" id="8320492">test</span><span class="op" id="8320496">.</span><span class="ident" id="8320497">algo</span><span class="op" id="8320501">,</span>&nbsp;<span class="ident" id="8320503">err</span><span class="op" id="8320506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8320510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320514">pem</span>&nbsp;<span class="op" id="8320518">=</span>&nbsp;<span class="op" id="8320520">[</span><span class="op" id="8320521">]</span><span class="builtintype" id="8320522">byte</span><span class="op" id="8320526">(</span><span class="ident" id="8320527">test</span><span class="op" id="8320531">.</span><span class="ident" id="8320532">key</span>&nbsp;<span class="op" id="8320536">+</span>&nbsp;<span class="ident" id="8320538">test</span><span class="op" id="8320542">.</span><span class="ident" id="8320543">cert</span><span class="op" id="8320547">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320551">if</span>&nbsp;<span class="ident" id="8320554">_</span><span class="op" id="8320555">,</span>&nbsp;<span class="ident" id="8320557">err</span>&nbsp;<span class="op" id="8320561">:=</span>&nbsp;<span class="ident" id="8320564">X509KeyPair</span><span class="op" id="8320575">(</span><span class="ident" id="8320576">pem</span><span class="op" id="8320579">,</span>&nbsp;<span class="ident" id="8320581">pem</span><span class="op" id="8320584">)</span><span class="op" id="8320585">;</span>&nbsp;<span class="ident" id="8320587">err</span>&nbsp;<span class="op" id="8320591">!=</span>&nbsp;<span class="ident" id="8320594">nil</span>&nbsp;<span class="op" id="8320598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320603">t</span><span class="op" id="8320604">.</span><span class="ident" id="8320605">Errorf</span><span class="op" id="8320611">(</span><span class="string" id="8320612">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;key&nbsp;followed&nbsp;by&nbsp;%s&nbsp;cert:&nbsp;%s&#34;</span><span class="op" id="8320659">,</span>&nbsp;<span class="ident" id="8320661">test</span><span class="op" id="8320665">.</span><span class="ident" id="8320666">algo</span><span class="op" id="8320670">,</span>&nbsp;<span class="ident" id="8320672">test</span><span class="op" id="8320676">.</span><span class="ident" id="8320677">algo</span><span class="op" id="8320681">,</span>&nbsp;<span class="ident" id="8320683">err</span><span class="op" id="8320686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8320690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8320693">}</span><br>
<span class="lineno"></span><span class="op" id="8320695">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="8320698">func</span>&nbsp;<span class="ident" id="8320703">TestX509MixedKeyPair</span><span class="op" id="8320723">(</span><span class="ident" id="8320724">t</span>&nbsp;<span class="op" id="8320726">*</span><span class="ident" id="8320727">testing</span><span class="op" id="8320734">.</span><span class="ident" id="8320735">T</span><span class="op" id="8320736">)</span>&nbsp;<span class="op" id="8320738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320741">if</span>&nbsp;<span class="ident" id="8320744">_</span><span class="op" id="8320745">,</span>&nbsp;<span class="ident" id="8320747">err</span>&nbsp;<span class="op" id="8320751">:=</span>&nbsp;<span class="ident" id="8320754">X509KeyPair</span><span class="op" id="8320765">(</span><span class="op" id="8320766">[</span><span class="op" id="8320767">]</span><span class="builtintype" id="8320768">byte</span><span class="op" id="8320772">(</span><span class="ident" id="8320773">rsaCertPEM</span><span class="op" id="8320783">)</span><span class="op" id="8320784">,</span>&nbsp;<span class="op" id="8320786">[</span><span class="op" id="8320787">]</span><span class="builtintype" id="8320788">byte</span><span class="op" id="8320792">(</span><span class="ident" id="8320793">ecdsaKeyPEM</span><span class="op" id="8320804">)</span><span class="op" id="8320805">)</span><span class="op" id="8320806">;</span>&nbsp;<span class="ident" id="8320808">err</span>&nbsp;<span class="op" id="8320812">==</span>&nbsp;<span class="ident" id="8320815">nil</span>&nbsp;<span class="op" id="8320819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320823">t</span><span class="op" id="8320824">.</span><span class="ident" id="8320825">Error</span><span class="op" id="8320830">(</span><span class="string" id="8320831">&#34;Load&nbsp;of&nbsp;RSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;ECDSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="8320889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8320892">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8320895">if</span>&nbsp;<span class="ident" id="8320898">_</span><span class="op" id="8320899">,</span>&nbsp;<span class="ident" id="8320901">err</span>&nbsp;<span class="op" id="8320905">:=</span>&nbsp;<span class="ident" id="8320908">X509KeyPair</span><span class="op" id="8320919">(</span><span class="op" id="8320920">[</span><span class="op" id="8320921">]</span><span class="builtintype" id="8320922">byte</span><span class="op" id="8320926">(</span><span class="ident" id="8320927">ecdsaCertPEM</span><span class="op" id="8320939">)</span><span class="op" id="8320940">,</span>&nbsp;<span class="op" id="8320942">[</span><span class="op" id="8320943">]</span><span class="builtintype" id="8320944">byte</span><span class="op" id="8320948">(</span><span class="ident" id="8320949">rsaKeyPEM</span><span class="op" id="8320958">)</span><span class="op" id="8320959">)</span><span class="op" id="8320960">;</span>&nbsp;<span class="ident" id="8320962">err</span>&nbsp;<span class="op" id="8320966">==</span>&nbsp;<span class="ident" id="8320969">nil</span>&nbsp;<span class="op" id="8320973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8320977">t</span><span class="op" id="8320978">.</span><span class="ident" id="8320979">Error</span><span class="op" id="8320984">(</span><span class="string" id="8320985">&#34;Load&nbsp;of&nbsp;ECDSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;RSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="8321043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321046">}</span><br>
<span class="lineno"></span><span class="op" id="8321048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="8321051">func</span>&nbsp;<span class="ident" id="8321056">newLocalListener</span><span class="op" id="8321072">(</span><span class="ident" id="8321073">t</span>&nbsp;<span class="op" id="8321075">*</span><span class="ident" id="8321076">testing</span><span class="op" id="8321083">.</span><span class="ident" id="8321084">T</span><span class="op" id="8321085">)</span>&nbsp;<span class="ident" id="8321087">net</span><span class="op" id="8321090">.</span><span class="ident" id="8321091">Listener</span>&nbsp;<span class="op" id="8321100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321103">ln</span><span class="op" id="8321105">,</span>&nbsp;<span class="ident" id="8321107">err</span>&nbsp;<span class="op" id="8321111">:=</span>&nbsp;<span class="ident" id="8321114">net</span><span class="op" id="8321117">.</span><span class="ident" id="8321118">Listen</span><span class="op" id="8321124">(</span><span class="string" id="8321125">&#34;tcp&#34;</span><span class="op" id="8321130">,</span>&nbsp;<span class="string" id="8321132">&#34;127.0.0.1:0&#34;</span><span class="op" id="8321145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321148">if</span>&nbsp;<span class="ident" id="8321151">err</span>&nbsp;<span class="op" id="8321155">!=</span>&nbsp;<span class="ident" id="8321158">nil</span>&nbsp;<span class="op" id="8321162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321166">ln</span><span class="op" id="8321168">,</span>&nbsp;<span class="ident" id="8321170">err</span>&nbsp;<span class="op" id="8321174">=</span>&nbsp;<span class="ident" id="8321176">net</span><span class="op" id="8321179">.</span><span class="ident" id="8321180">Listen</span><span class="op" id="8321186">(</span><span class="string" id="8321187">&#34;tcp6&#34;</span><span class="op" id="8321193">,</span>&nbsp;<span class="string" id="8321195">&#34;[::1]:0&#34;</span><span class="op" id="8321204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321207">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321210">if</span>&nbsp;<span class="ident" id="8321213">err</span>&nbsp;<span class="op" id="8321217">!=</span>&nbsp;<span class="ident" id="8321220">nil</span>&nbsp;<span class="op" id="8321224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321228">t</span><span class="op" id="8321229">.</span><span class="ident" id="8321230">Fatal</span><span class="op" id="8321235">(</span><span class="ident" id="8321236">err</span><span class="op" id="8321239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321245">return</span>&nbsp;<span class="ident" id="8321252">ln</span><br>
<span class="lineno"></span><span class="op" id="8321255">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="8321258">func</span>&nbsp;<span class="ident" id="8321263">TestDialTimeout</span><span class="op" id="8321278">(</span><span class="ident" id="8321279">t</span>&nbsp;<span class="op" id="8321281">*</span><span class="ident" id="8321282">testing</span><span class="op" id="8321289">.</span><span class="ident" id="8321290">T</span><span class="op" id="8321291">)</span>&nbsp;<span class="op" id="8321293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321296">if</span>&nbsp;<span class="ident" id="8321299">testing</span><span class="op" id="8321306">.</span><span class="ident" id="8321307">Short</span><span class="op" id="8321312">(</span><span class="op" id="8321313">)</span>&nbsp;<span class="op" id="8321315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321319">t</span><span class="op" id="8321320">.</span><span class="ident" id="8321321">Skip</span><span class="op" id="8321325">(</span><span class="string" id="8321326">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="8321350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321353">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321356">listener</span>&nbsp;<span class="op" id="8321365">:=</span>&nbsp;<span class="ident" id="8321368">newLocalListener</span><span class="op" id="8321384">(</span><span class="ident" id="8321385">t</span><span class="op" id="8321386">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321390">addr</span>&nbsp;<span class="op" id="8321395">:=</span>&nbsp;<span class="ident" id="8321398">listener</span><span class="op" id="8321406">.</span><span class="ident" id="8321407">Addr</span><span class="op" id="8321411">(</span><span class="op" id="8321412">)</span><span class="op" id="8321413">.</span><span class="ident" id="8321414">String</span><span class="op" id="8321420">(</span><span class="op" id="8321421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321424">defer</span>&nbsp;<span class="ident" id="8321430">listener</span><span class="op" id="8321438">.</span><span class="ident" id="8321439">Close</span><span class="op" id="8321444">(</span><span class="op" id="8321445">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321449">complete</span>&nbsp;<span class="op" id="8321458">:=</span>&nbsp;<span class="builtinfunc" id="8321461">make</span><span class="op" id="8321465">(</span><span class="keyword" id="8321466">chan</span>&nbsp;<span class="builtintype" id="8321471">bool</span><span class="op" id="8321475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321478">defer</span>&nbsp;<span class="builtinfunc" id="8321484">close</span><span class="op" id="8321489">(</span><span class="ident" id="8321490">complete</span><span class="op" id="8321498">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321502">go</span>&nbsp;<span class="keyword" id="8321505">func</span><span class="op" id="8321509">(</span><span class="op" id="8321510">)</span>&nbsp;<span class="op" id="8321512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321516">conn</span><span class="op" id="8321520">,</span>&nbsp;<span class="ident" id="8321522">err</span>&nbsp;<span class="op" id="8321526">:=</span>&nbsp;<span class="ident" id="8321529">listener</span><span class="op" id="8321537">.</span><span class="ident" id="8321538">Accept</span><span class="op" id="8321544">(</span><span class="op" id="8321545">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321549">if</span>&nbsp;<span class="ident" id="8321552">err</span>&nbsp;<span class="op" id="8321556">!=</span>&nbsp;<span class="ident" id="8321559">nil</span>&nbsp;<span class="op" id="8321563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321568">t</span><span class="op" id="8321569">.</span><span class="ident" id="8321570">Error</span><span class="op" id="8321575">(</span><span class="ident" id="8321576">err</span><span class="op" id="8321579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321584">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321597">&lt;-</span><span class="ident" id="8321599">complete</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321610">conn</span><span class="op" id="8321614">.</span><span class="ident" id="8321615">Close</span><span class="op" id="8321620">(</span><span class="op" id="8321621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321624">}</span><span class="op" id="8321625">(</span><span class="op" id="8321626">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321630">dialer</span>&nbsp;<span class="op" id="8321637">:=</span>&nbsp;<span class="op" id="8321640">&amp;</span><span class="ident" id="8321641">net</span><span class="op" id="8321644">.</span><span class="ident" id="8321645">Dialer</span><span class="op" id="8321651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321655">Timeout</span><span class="op" id="8321662">:</span>&nbsp;<span class="num" id="8321664">10</span>&nbsp;<span class="op" id="8321667">*</span>&nbsp;<span class="ident" id="8321669">time</span><span class="op" id="8321673">.</span><span class="ident" id="8321674">Millisecond</span><span class="op" id="8321685">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321692">var</span>&nbsp;<span class="ident" id="8321696">err</span>&nbsp;<span class="builtintype" id="8321700">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321707">if</span>&nbsp;<span class="ident" id="8321710">_</span><span class="op" id="8321711">,</span>&nbsp;<span class="ident" id="8321713">err</span>&nbsp;<span class="op" id="8321717">=</span>&nbsp;<span class="ident" id="8321719">DialWithDialer</span><span class="op" id="8321733">(</span><span class="ident" id="8321734">dialer</span><span class="op" id="8321740">,</span>&nbsp;<span class="string" id="8321742">&#34;tcp&#34;</span><span class="op" id="8321747">,</span>&nbsp;<span class="ident" id="8321749">addr</span><span class="op" id="8321753">,</span>&nbsp;<span class="ident" id="8321755">nil</span><span class="op" id="8321758">)</span><span class="op" id="8321759">;</span>&nbsp;<span class="ident" id="8321761">err</span>&nbsp;<span class="op" id="8321765">==</span>&nbsp;<span class="ident" id="8321768">nil</span>&nbsp;<span class="op" id="8321772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321776">t</span><span class="op" id="8321777">.</span><span class="ident" id="8321778">Fatal</span><span class="op" id="8321783">(</span><span class="string" id="8321784">&#34;DialWithTimeout&nbsp;completed&nbsp;successfully&#34;</span><span class="op" id="8321824">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8321831">if</span>&nbsp;<span class="op" id="8321834">!</span><span class="ident" id="8321835">strings</span><span class="op" id="8321842">.</span><span class="ident" id="8321843">Contains</span><span class="op" id="8321851">(</span><span class="ident" id="8321852">err</span><span class="op" id="8321855">.</span><span class="ident" id="8321856">Error</span><span class="op" id="8321861">(</span><span class="op" id="8321862">)</span><span class="op" id="8321863">,</span>&nbsp;<span class="string" id="8321865">&#34;timed&nbsp;out&#34;</span><span class="op" id="8321876">)</span>&nbsp;<span class="op" id="8321878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8321882">t</span><span class="op" id="8321883">.</span><span class="ident" id="8321884">Errorf</span><span class="op" id="8321890">(</span><span class="string" id="8321891">&#34;resulting&nbsp;error&nbsp;not&nbsp;a&nbsp;timeout:&nbsp;%s&#34;</span><span class="op" id="8321926">,</span>&nbsp;<span class="ident" id="8321928">err</span><span class="op" id="8321931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8321934">}</span><br>
<span class="lineno">160</span><span class="op" id="8321936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8321939">//&nbsp;tests&nbsp;that&nbsp;Conn.Read&nbsp;returns&nbsp;(non-zero,&nbsp;io.EOF)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="8322001">//&nbsp;(non-zero,&nbsp;nil)&nbsp;when&nbsp;a&nbsp;Close&nbsp;(alertCloseNotify)&nbsp;is&nbsp;sitting&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="8322069">//&nbsp;behind&nbsp;the&nbsp;application&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">165</span><span class="keyword" id="8322115">func</span>&nbsp;<span class="ident" id="8322120">TestConnReadNonzeroAndEOF</span><span class="op" id="8322145">(</span><span class="ident" id="8322146">t</span>&nbsp;<span class="op" id="8322148">*</span><span class="ident" id="8322149">testing</span><span class="op" id="8322156">.</span><span class="ident" id="8322157">T</span><span class="op" id="8322158">)</span>&nbsp;<span class="op" id="8322160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8322163">//&nbsp;This&nbsp;test&nbsp;is&nbsp;racy:&nbsp;it&nbsp;assumes&nbsp;that&nbsp;after&nbsp;a&nbsp;write&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8322221">//&nbsp;localhost&nbsp;TCP&nbsp;connection,&nbsp;the&nbsp;peer&nbsp;TCP&nbsp;connection&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8322279">//&nbsp;immediately&nbsp;read&nbsp;it.&nbsp;&nbsp;Because&nbsp;it&#39;s&nbsp;racy,&nbsp;we&nbsp;skip&nbsp;this&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8322342">//&nbsp;in&nbsp;short&nbsp;mode,&nbsp;and&nbsp;then&nbsp;retry&nbsp;it&nbsp;several&nbsp;times&nbsp;with&nbsp;an</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8322401">//&nbsp;increasing&nbsp;sleep&nbsp;in&nbsp;between&nbsp;our&nbsp;final&nbsp;write&nbsp;(via&nbsp;srv.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8322464">//&nbsp;below)&nbsp;and&nbsp;the&nbsp;following&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322499">if</span>&nbsp;<span class="ident" id="8322502">testing</span><span class="op" id="8322509">.</span><span class="ident" id="8322510">Short</span><span class="op" id="8322515">(</span><span class="op" id="8322516">)</span>&nbsp;<span class="op" id="8322518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322522">t</span><span class="op" id="8322523">.</span><span class="ident" id="8322524">Skip</span><span class="op" id="8322528">(</span><span class="string" id="8322529">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="8322553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322556">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322559">var</span>&nbsp;<span class="ident" id="8322563">err</span>&nbsp;<span class="builtintype" id="8322567">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322574">for</span>&nbsp;<span class="ident" id="8322578">delay</span>&nbsp;<span class="op" id="8322584">:=</span>&nbsp;<span class="ident" id="8322587">time</span><span class="op" id="8322591">.</span><span class="ident" id="8322592">Millisecond</span><span class="op" id="8322603">;</span>&nbsp;<span class="ident" id="8322605">delay</span>&nbsp;<span class="op" id="8322611">&lt;=</span>&nbsp;<span class="num" id="8322614">64</span><span class="op" id="8322616">*</span><span class="ident" id="8322617">time</span><span class="op" id="8322621">.</span><span class="ident" id="8322622">Millisecond</span><span class="op" id="8322633">;</span>&nbsp;<span class="ident" id="8322635">delay</span>&nbsp;<span class="op" id="8322641">*=</span>&nbsp;<span class="num" id="8322644">2</span>&nbsp;<span class="op" id="8322646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322650">if</span>&nbsp;<span class="ident" id="8322653">err</span>&nbsp;<span class="op" id="8322657">=</span>&nbsp;<span class="ident" id="8322659">testConnReadNonzeroAndEOF</span><span class="op" id="8322684">(</span><span class="ident" id="8322685">t</span><span class="op" id="8322686">,</span>&nbsp;<span class="ident" id="8322688">delay</span><span class="op" id="8322693">)</span><span class="op" id="8322694">;</span>&nbsp;<span class="ident" id="8322696">err</span>&nbsp;<span class="op" id="8322700">==</span>&nbsp;<span class="ident" id="8322703">nil</span>&nbsp;<span class="op" id="8322707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322712">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322721">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8322724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322727">t</span><span class="op" id="8322728">.</span><span class="ident" id="8322729">Error</span><span class="op" id="8322734">(</span><span class="ident" id="8322735">err</span><span class="op" id="8322738">)</span><br>
<span class="lineno"></span><span class="op" id="8322740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8322743">func</span>&nbsp;<span class="ident" id="8322748">testConnReadNonzeroAndEOF</span><span class="op" id="8322773">(</span><span class="ident" id="8322774">t</span>&nbsp;<span class="op" id="8322776">*</span><span class="ident" id="8322777">testing</span><span class="op" id="8322784">.</span><span class="ident" id="8322785">T</span><span class="op" id="8322786">,</span>&nbsp;<span class="ident" id="8322788">delay</span>&nbsp;<span class="ident" id="8322794">time</span><span class="op" id="8322798">.</span><span class="ident" id="8322799">Duration</span><span class="op" id="8322807">)</span>&nbsp;<span class="builtintype" id="8322809">error</span>&nbsp;<span class="op" id="8322815">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322818">ln</span>&nbsp;<span class="op" id="8322821">:=</span>&nbsp;<span class="ident" id="8322824">newLocalListener</span><span class="op" id="8322840">(</span><span class="ident" id="8322841">t</span><span class="op" id="8322842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322845">defer</span>&nbsp;<span class="ident" id="8322851">ln</span><span class="op" id="8322853">.</span><span class="ident" id="8322854">Close</span><span class="op" id="8322859">(</span><span class="op" id="8322860">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322864">srvCh</span>&nbsp;<span class="op" id="8322870">:=</span>&nbsp;<span class="builtinfunc" id="8322873">make</span><span class="op" id="8322877">(</span><span class="keyword" id="8322878">chan</span>&nbsp;<span class="op" id="8322883">*</span><span class="ident" id="8322884">Conn</span><span class="op" id="8322888">,</span>&nbsp;<span class="num" id="8322890">1</span><span class="op" id="8322891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322894">var</span>&nbsp;<span class="ident" id="8322898">serr</span>&nbsp;<span class="builtintype" id="8322903">error</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322910">go</span>&nbsp;<span class="keyword" id="8322913">func</span><span class="op" id="8322917">(</span><span class="op" id="8322918">)</span>&nbsp;<span class="op" id="8322920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322924">sconn</span><span class="op" id="8322929">,</span>&nbsp;<span class="ident" id="8322931">err</span>&nbsp;<span class="op" id="8322935">:=</span>&nbsp;<span class="ident" id="8322938">ln</span><span class="op" id="8322940">.</span><span class="ident" id="8322941">Accept</span><span class="op" id="8322947">(</span><span class="op" id="8322948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8322952">if</span>&nbsp;<span class="ident" id="8322955">err</span>&nbsp;<span class="op" id="8322959">!=</span>&nbsp;<span class="ident" id="8322962">nil</span>&nbsp;<span class="op" id="8322966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322971">serr</span>&nbsp;<span class="op" id="8322976">=</span>&nbsp;<span class="ident" id="8322978">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8322985">srvCh</span>&nbsp;<span class="op" id="8322991">&lt;-</span>&nbsp;<span class="ident" id="8322994">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323001">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323014">serverConfig</span>&nbsp;<span class="op" id="8323027">:=</span>&nbsp;<span class="op" id="8323030">*</span><span class="ident" id="8323031">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323044">srv</span>&nbsp;<span class="op" id="8323048">:=</span>&nbsp;<span class="ident" id="8323051">Server</span><span class="op" id="8323057">(</span><span class="ident" id="8323058">sconn</span><span class="op" id="8323063">,</span>&nbsp;<span class="op" id="8323065">&amp;</span><span class="ident" id="8323066">serverConfig</span><span class="op" id="8323078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323082">if</span>&nbsp;<span class="ident" id="8323085">err</span>&nbsp;<span class="op" id="8323089">:=</span>&nbsp;<span class="ident" id="8323092">srv</span><span class="op" id="8323095">.</span><span class="ident" id="8323096">Handshake</span><span class="op" id="8323105">(</span><span class="op" id="8323106">)</span><span class="op" id="8323107">;</span>&nbsp;<span class="ident" id="8323109">err</span>&nbsp;<span class="op" id="8323113">!=</span>&nbsp;<span class="ident" id="8323116">nil</span>&nbsp;<span class="op" id="8323120">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323125">serr</span>&nbsp;<span class="op" id="8323130">=</span>&nbsp;<span class="ident" id="8323132">fmt</span><span class="op" id="8323135">.</span><span class="ident" id="8323136">Errorf</span><span class="op" id="8323142">(</span><span class="string" id="8323143">&#34;handshake:&nbsp;%v&#34;</span><span class="op" id="8323158">,</span>&nbsp;<span class="ident" id="8323160">err</span><span class="op" id="8323163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323168">srvCh</span>&nbsp;<span class="op" id="8323174">&lt;-</span>&nbsp;<span class="ident" id="8323177">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323184">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323197">srvCh</span>&nbsp;<span class="op" id="8323203">&lt;-</span>&nbsp;<span class="ident" id="8323206">srv</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323211">}</span><span class="op" id="8323212">(</span><span class="op" id="8323213">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323217">clientConfig</span>&nbsp;<span class="op" id="8323230">:=</span>&nbsp;<span class="op" id="8323233">*</span><span class="ident" id="8323234">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323246">conn</span><span class="op" id="8323250">,</span>&nbsp;<span class="ident" id="8323252">err</span>&nbsp;<span class="op" id="8323256">:=</span>&nbsp;<span class="ident" id="8323259">Dial</span><span class="op" id="8323263">(</span><span class="string" id="8323264">&#34;tcp&#34;</span><span class="op" id="8323269">,</span>&nbsp;<span class="ident" id="8323271">ln</span><span class="op" id="8323273">.</span><span class="ident" id="8323274">Addr</span><span class="op" id="8323278">(</span><span class="op" id="8323279">)</span><span class="op" id="8323280">.</span><span class="ident" id="8323281">String</span><span class="op" id="8323287">(</span><span class="op" id="8323288">)</span><span class="op" id="8323289">,</span>&nbsp;<span class="op" id="8323291">&amp;</span><span class="ident" id="8323292">clientConfig</span><span class="op" id="8323304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323307">if</span>&nbsp;<span class="ident" id="8323310">err</span>&nbsp;<span class="op" id="8323314">!=</span>&nbsp;<span class="ident" id="8323317">nil</span>&nbsp;<span class="op" id="8323321">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323325">t</span><span class="op" id="8323326">.</span><span class="ident" id="8323327">Fatal</span><span class="op" id="8323332">(</span><span class="ident" id="8323333">err</span><span class="op" id="8323336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323342">defer</span>&nbsp;<span class="ident" id="8323348">conn</span><span class="op" id="8323352">.</span><span class="ident" id="8323353">Close</span><span class="op" id="8323358">(</span><span class="op" id="8323359">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323363">srv</span>&nbsp;<span class="op" id="8323367">:=</span>&nbsp;<span class="op" id="8323370">&lt;-</span><span class="ident" id="8323372">srvCh</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323379">if</span>&nbsp;<span class="ident" id="8323382">srv</span>&nbsp;<span class="op" id="8323386">==</span>&nbsp;<span class="ident" id="8323389">nil</span>&nbsp;<span class="op" id="8323393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323397">return</span>&nbsp;<span class="ident" id="8323404">serr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323414">buf</span>&nbsp;<span class="op" id="8323418">:=</span>&nbsp;<span class="builtinfunc" id="8323421">make</span><span class="op" id="8323425">(</span><span class="op" id="8323426">[</span><span class="op" id="8323427">]</span><span class="builtintype" id="8323428">byte</span><span class="op" id="8323432">,</span>&nbsp;<span class="num" id="8323434">6</span><span class="op" id="8323435">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323439">srv</span><span class="op" id="8323442">.</span><span class="ident" id="8323443">Write</span><span class="op" id="8323448">(</span><span class="op" id="8323449">[</span><span class="op" id="8323450">]</span><span class="builtintype" id="8323451">byte</span><span class="op" id="8323455">(</span><span class="string" id="8323456">&#34;foobar&#34;</span><span class="op" id="8323464">)</span><span class="op" id="8323465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323468">n</span><span class="op" id="8323469">,</span>&nbsp;<span class="ident" id="8323471">err</span>&nbsp;<span class="op" id="8323475">:=</span>&nbsp;<span class="ident" id="8323478">conn</span><span class="op" id="8323482">.</span><span class="ident" id="8323483">Read</span><span class="op" id="8323487">(</span><span class="ident" id="8323488">buf</span><span class="op" id="8323491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323494">if</span>&nbsp;<span class="ident" id="8323497">n</span>&nbsp;<span class="op" id="8323499">!=</span>&nbsp;<span class="num" id="8323502">6</span>&nbsp;<span class="op" id="8323504">||</span>&nbsp;<span class="ident" id="8323507">err</span>&nbsp;<span class="op" id="8323511">!=</span>&nbsp;<span class="ident" id="8323514">nil</span>&nbsp;<span class="op" id="8323518">||</span>&nbsp;<span class="builtintype" id="8323521">string</span><span class="op" id="8323527">(</span><span class="ident" id="8323528">buf</span><span class="op" id="8323531">)</span>&nbsp;<span class="op" id="8323533">!=</span>&nbsp;<span class="string" id="8323536">&#34;foobar&#34;</span>&nbsp;<span class="op" id="8323545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323549">return</span>&nbsp;<span class="ident" id="8323556">fmt</span><span class="op" id="8323559">.</span><span class="ident" id="8323560">Errorf</span><span class="op" id="8323566">(</span><span class="string" id="8323567">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;data&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;nil,&nbsp;foobar&#34;</span><span class="op" id="8323612">,</span>&nbsp;<span class="ident" id="8323614">n</span><span class="op" id="8323615">,</span>&nbsp;<span class="ident" id="8323617">err</span><span class="op" id="8323620">,</span>&nbsp;<span class="ident" id="8323622">buf</span><span class="op" id="8323625">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323632">srv</span><span class="op" id="8323635">.</span><span class="ident" id="8323636">Write</span><span class="op" id="8323641">(</span><span class="op" id="8323642">[</span><span class="op" id="8323643">]</span><span class="builtintype" id="8323644">byte</span><span class="op" id="8323648">(</span><span class="string" id="8323649">&#34;abcdef&#34;</span><span class="op" id="8323657">)</span><span class="op" id="8323658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323661">srv</span><span class="op" id="8323664">.</span><span class="ident" id="8323665">Close</span><span class="op" id="8323670">(</span><span class="op" id="8323671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323674">time</span><span class="op" id="8323678">.</span><span class="ident" id="8323679">Sleep</span><span class="op" id="8323684">(</span><span class="ident" id="8323685">delay</span><span class="op" id="8323690">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323693">n</span><span class="op" id="8323694">,</span>&nbsp;<span class="ident" id="8323696">err</span>&nbsp;<span class="op" id="8323700">=</span>&nbsp;<span class="ident" id="8323702">conn</span><span class="op" id="8323706">.</span><span class="ident" id="8323707">Read</span><span class="op" id="8323711">(</span><span class="ident" id="8323712">buf</span><span class="op" id="8323715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323718">if</span>&nbsp;<span class="ident" id="8323721">n</span>&nbsp;<span class="op" id="8323723">!=</span>&nbsp;<span class="num" id="8323726">6</span>&nbsp;<span class="op" id="8323728">||</span>&nbsp;<span class="builtintype" id="8323731">string</span><span class="op" id="8323737">(</span><span class="ident" id="8323738">buf</span><span class="op" id="8323741">)</span>&nbsp;<span class="op" id="8323743">!=</span>&nbsp;<span class="string" id="8323746">&#34;abcdef&#34;</span>&nbsp;<span class="op" id="8323755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323759">return</span>&nbsp;<span class="ident" id="8323766">fmt</span><span class="op" id="8323769">.</span><span class="ident" id="8323770">Errorf</span><span class="op" id="8323776">(</span><span class="string" id="8323777">&#34;Read&nbsp;=&nbsp;%d,&nbsp;buf=&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;abcdef&#34;</span><span class="op" id="8323813">,</span>&nbsp;<span class="ident" id="8323815">n</span><span class="op" id="8323816">,</span>&nbsp;<span class="ident" id="8323818">buf</span><span class="op" id="8323821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323827">if</span>&nbsp;<span class="ident" id="8323830">err</span>&nbsp;<span class="op" id="8323834">!=</span>&nbsp;<span class="ident" id="8323837">io</span><span class="op" id="8323839">.</span><span class="ident" id="8323840">EOF</span>&nbsp;<span class="op" id="8323844">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323848">return</span>&nbsp;<span class="ident" id="8323855">fmt</span><span class="op" id="8323858">.</span><span class="ident" id="8323859">Errorf</span><span class="op" id="8323865">(</span><span class="string" id="8323866">&#34;Second&nbsp;Read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="8323903">,</span>&nbsp;<span class="ident" id="8323905">err</span><span class="op" id="8323908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323914">return</span>&nbsp;<span class="ident" id="8323921">nil</span><br>
<span class="lineno"></span><span class="op" id="8323925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="8323928">func</span>&nbsp;<span class="ident" id="8323933">TestTLSUniqueMatches</span><span class="op" id="8323953">(</span><span class="ident" id="8323954">t</span>&nbsp;<span class="op" id="8323956">*</span><span class="ident" id="8323957">testing</span><span class="op" id="8323964">.</span><span class="ident" id="8323965">T</span><span class="op" id="8323966">)</span>&nbsp;<span class="op" id="8323968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323971">ln</span>&nbsp;<span class="op" id="8323974">:=</span>&nbsp;<span class="ident" id="8323977">newLocalListener</span><span class="op" id="8323993">(</span><span class="ident" id="8323994">t</span><span class="op" id="8323995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323998">defer</span>&nbsp;<span class="ident" id="8324004">ln</span><span class="op" id="8324006">.</span><span class="ident" id="8324007">Close</span><span class="op" id="8324012">(</span><span class="op" id="8324013">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324017">serverTLSUniques</span>&nbsp;<span class="op" id="8324034">:=</span>&nbsp;<span class="builtinfunc" id="8324037">make</span><span class="op" id="8324041">(</span><span class="keyword" id="8324042">chan</span>&nbsp;<span class="op" id="8324047">[</span><span class="op" id="8324048">]</span><span class="builtintype" id="8324049">byte</span><span class="op" id="8324053">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324056">go</span>&nbsp;<span class="keyword" id="8324059">func</span><span class="op" id="8324063">(</span><span class="op" id="8324064">)</span>&nbsp;<span class="op" id="8324066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324070">for</span>&nbsp;<span class="ident" id="8324074">i</span>&nbsp;<span class="op" id="8324076">:=</span>&nbsp;<span class="num" id="8324079">0</span><span class="op" id="8324080">;</span>&nbsp;<span class="ident" id="8324082">i</span>&nbsp;<span class="op" id="8324084">&lt;</span>&nbsp;<span class="num" id="8324086">2</span><span class="op" id="8324087">;</span>&nbsp;<span class="ident" id="8324089">i</span><span class="op" id="8324090">++</span>&nbsp;<span class="op" id="8324093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324098">sconn</span><span class="op" id="8324103">,</span>&nbsp;<span class="ident" id="8324105">err</span>&nbsp;<span class="op" id="8324109">:=</span>&nbsp;<span class="ident" id="8324112">ln</span><span class="op" id="8324114">.</span><span class="ident" id="8324115">Accept</span><span class="op" id="8324121">(</span><span class="op" id="8324122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324127">if</span>&nbsp;<span class="ident" id="8324130">err</span>&nbsp;<span class="op" id="8324134">!=</span>&nbsp;<span class="ident" id="8324137">nil</span>&nbsp;<span class="op" id="8324141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324147">t</span><span class="op" id="8324148">.</span><span class="ident" id="8324149">Fatal</span><span class="op" id="8324154">(</span><span class="ident" id="8324155">err</span><span class="op" id="8324158">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324168">serverConfig</span>&nbsp;<span class="op" id="8324181">:=</span>&nbsp;<span class="op" id="8324184">*</span><span class="ident" id="8324185">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324199">srv</span>&nbsp;<span class="op" id="8324203">:=</span>&nbsp;<span class="ident" id="8324206">Server</span><span class="op" id="8324212">(</span><span class="ident" id="8324213">sconn</span><span class="op" id="8324218">,</span>&nbsp;<span class="op" id="8324220">&amp;</span><span class="ident" id="8324221">serverConfig</span><span class="op" id="8324233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324238">if</span>&nbsp;<span class="ident" id="8324241">err</span>&nbsp;<span class="op" id="8324245">:=</span>&nbsp;<span class="ident" id="8324248">srv</span><span class="op" id="8324251">.</span><span class="ident" id="8324252">Handshake</span><span class="op" id="8324261">(</span><span class="op" id="8324262">)</span><span class="op" id="8324263">;</span>&nbsp;<span class="ident" id="8324265">err</span>&nbsp;<span class="op" id="8324269">!=</span>&nbsp;<span class="ident" id="8324272">nil</span>&nbsp;<span class="op" id="8324276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324282">t</span><span class="op" id="8324283">.</span><span class="ident" id="8324284">Fatal</span><span class="op" id="8324289">(</span><span class="ident" id="8324290">err</span><span class="op" id="8324293">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324303">serverTLSUniques</span>&nbsp;<span class="op" id="8324320">&lt;-</span>&nbsp;<span class="ident" id="8324323">srv</span><span class="op" id="8324326">.</span><span class="ident" id="8324327">ConnectionState</span><span class="op" id="8324342">(</span><span class="op" id="8324343">)</span><span class="op" id="8324344">.</span><span class="ident" id="8324345">TLSUnique</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324360">}</span><span class="op" id="8324361">(</span><span class="op" id="8324362">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324366">clientConfig</span>&nbsp;<span class="op" id="8324379">:=</span>&nbsp;<span class="op" id="8324382">*</span><span class="ident" id="8324383">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324395">clientConfig</span><span class="op" id="8324407">.</span><span class="ident" id="8324408">ClientSessionCache</span>&nbsp;<span class="op" id="8324427">=</span>&nbsp;<span class="ident" id="8324429">NewLRUClientSessionCache</span><span class="op" id="8324453">(</span><span class="num" id="8324454">1</span><span class="op" id="8324455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324458">conn</span><span class="op" id="8324462">,</span>&nbsp;<span class="ident" id="8324464">err</span>&nbsp;<span class="op" id="8324468">:=</span>&nbsp;<span class="ident" id="8324471">Dial</span><span class="op" id="8324475">(</span><span class="string" id="8324476">&#34;tcp&#34;</span><span class="op" id="8324481">,</span>&nbsp;<span class="ident" id="8324483">ln</span><span class="op" id="8324485">.</span><span class="ident" id="8324486">Addr</span><span class="op" id="8324490">(</span><span class="op" id="8324491">)</span><span class="op" id="8324492">.</span><span class="ident" id="8324493">String</span><span class="op" id="8324499">(</span><span class="op" id="8324500">)</span><span class="op" id="8324501">,</span>&nbsp;<span class="op" id="8324503">&amp;</span><span class="ident" id="8324504">clientConfig</span><span class="op" id="8324516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324519">if</span>&nbsp;<span class="ident" id="8324522">err</span>&nbsp;<span class="op" id="8324526">!=</span>&nbsp;<span class="ident" id="8324529">nil</span>&nbsp;<span class="op" id="8324533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324537">t</span><span class="op" id="8324538">.</span><span class="ident" id="8324539">Fatal</span><span class="op" id="8324544">(</span><span class="ident" id="8324545">err</span><span class="op" id="8324548">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324554">if</span>&nbsp;<span class="op" id="8324557">!</span><span class="ident" id="8324558">bytes</span><span class="op" id="8324563">.</span><span class="ident" id="8324564">Equal</span><span class="op" id="8324569">(</span><span class="ident" id="8324570">conn</span><span class="op" id="8324574">.</span><span class="ident" id="8324575">ConnectionState</span><span class="op" id="8324590">(</span><span class="op" id="8324591">)</span><span class="op" id="8324592">.</span><span class="ident" id="8324593">TLSUnique</span><span class="op" id="8324602">,</span>&nbsp;<span class="op" id="8324604">&lt;-</span><span class="ident" id="8324606">serverTLSUniques</span><span class="op" id="8324622">)</span>&nbsp;<span class="op" id="8324624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324628">t</span><span class="op" id="8324629">.</span><span class="ident" id="8324630">Error</span><span class="op" id="8324635">(</span><span class="string" id="8324636">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&#34;</span><span class="op" id="8324679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324685">conn</span><span class="op" id="8324689">.</span><span class="ident" id="8324690">Close</span><span class="op" id="8324695">(</span><span class="op" id="8324696">)</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324700">conn</span><span class="op" id="8324704">,</span>&nbsp;<span class="ident" id="8324706">err</span>&nbsp;<span class="op" id="8324710">=</span>&nbsp;<span class="ident" id="8324712">Dial</span><span class="op" id="8324716">(</span><span class="string" id="8324717">&#34;tcp&#34;</span><span class="op" id="8324722">,</span>&nbsp;<span class="ident" id="8324724">ln</span><span class="op" id="8324726">.</span><span class="ident" id="8324727">Addr</span><span class="op" id="8324731">(</span><span class="op" id="8324732">)</span><span class="op" id="8324733">.</span><span class="ident" id="8324734">String</span><span class="op" id="8324740">(</span><span class="op" id="8324741">)</span><span class="op" id="8324742">,</span>&nbsp;<span class="op" id="8324744">&amp;</span><span class="ident" id="8324745">clientConfig</span><span class="op" id="8324757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324760">if</span>&nbsp;<span class="ident" id="8324763">err</span>&nbsp;<span class="op" id="8324767">!=</span>&nbsp;<span class="ident" id="8324770">nil</span>&nbsp;<span class="op" id="8324774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324778">t</span><span class="op" id="8324779">.</span><span class="ident" id="8324780">Fatal</span><span class="op" id="8324785">(</span><span class="ident" id="8324786">err</span><span class="op" id="8324789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324792">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324795">defer</span>&nbsp;<span class="ident" id="8324801">conn</span><span class="op" id="8324805">.</span><span class="ident" id="8324806">Close</span><span class="op" id="8324811">(</span><span class="op" id="8324812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324815">if</span>&nbsp;<span class="op" id="8324818">!</span><span class="ident" id="8324819">conn</span><span class="op" id="8324823">.</span><span class="ident" id="8324824">ConnectionState</span><span class="op" id="8324839">(</span><span class="op" id="8324840">)</span><span class="op" id="8324841">.</span><span class="ident" id="8324842">DidResume</span>&nbsp;<span class="op" id="8324852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324856">t</span><span class="op" id="8324857">.</span><span class="ident" id="8324858">Error</span><span class="op" id="8324863">(</span><span class="string" id="8324864">&#34;second&nbsp;session&nbsp;did&nbsp;not&nbsp;use&nbsp;resumption&#34;</span><span class="op" id="8324903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324909">if</span>&nbsp;<span class="op" id="8324912">!</span><span class="ident" id="8324913">bytes</span><span class="op" id="8324918">.</span><span class="ident" id="8324919">Equal</span><span class="op" id="8324924">(</span><span class="ident" id="8324925">conn</span><span class="op" id="8324929">.</span><span class="ident" id="8324930">ConnectionState</span><span class="op" id="8324945">(</span><span class="op" id="8324946">)</span><span class="op" id="8324947">.</span><span class="ident" id="8324948">TLSUnique</span><span class="op" id="8324957">,</span>&nbsp;<span class="op" id="8324959">&lt;-</span><span class="ident" id="8324961">serverTLSUniques</span><span class="op" id="8324977">)</span>&nbsp;<span class="op" id="8324979">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324983">t</span><span class="op" id="8324984">.</span><span class="ident" id="8324985">Error</span><span class="op" id="8324990">(</span><span class="string" id="8324991">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&nbsp;when&nbsp;session&nbsp;resumption&nbsp;is&nbsp;used&#34;</span><span class="op" id="8325066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325069">}</span><br>
<span class="lineno"></span><span class="op" id="8325071">}</span>
</div>
</body>
</html>
