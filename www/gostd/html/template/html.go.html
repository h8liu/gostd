<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html" class="current">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4350804">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4350859">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4350913">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4350964">package</span>&nbsp;<span class="ident" id="4350972">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4350982">import</span>&nbsp;<span class="op" id="4350989">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4350992">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4351001">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4351008">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4351019">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4351034">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4351037">//&nbsp;htmlNospaceEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;unquoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno">15</span><span class="keyword" id="4351111">func</span>&nbsp;<span class="ident" id="4351116">htmlNospaceEscaper</span><span class="op" id="4351134">(</span><span class="ident" id="4351135">args</span>&nbsp;<span class="op" id="4351140">...</span><span class="keyword" id="4351143">interface</span><span class="op" id="4351152">{</span><span class="op" id="4351153">}</span><span class="op" id="4351154">)</span>&nbsp;<span class="builtintype" id="4351156">string</span>&nbsp;<span class="op" id="4351163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351166">s</span><span class="op" id="4351167">,</span>&nbsp;<span class="ident" id="4351169">t</span>&nbsp;<span class="op" id="4351171">:=</span>&nbsp;<span class="ident" id="4351174">stringify</span><span class="op" id="4351183">(</span><span class="ident" id="4351184">args</span><span class="op" id="4351188">...</span><span class="op" id="4351191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4351194">if</span>&nbsp;<span class="ident" id="4351197">t</span>&nbsp;<span class="op" id="4351199">==</span>&nbsp;<span class="ident" id="4351202">contentTypeHTML</span>&nbsp;<span class="op" id="4351218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4351222">return</span>&nbsp;<span class="ident" id="4351229">htmlReplacer</span><span class="op" id="4351241">(</span><span class="ident" id="4351242">stripTags</span><span class="op" id="4351251">(</span><span class="ident" id="4351252">s</span><span class="op" id="4351253">)</span><span class="op" id="4351254">,</span>&nbsp;<span class="ident" id="4351256">htmlNospaceNormReplacementTable</span><span class="op" id="4351287">,</span>&nbsp;<span class="builtintype" id="4351289">false</span><span class="op" id="4351294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4351297">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4351300">return</span>&nbsp;<span class="ident" id="4351307">htmlReplacer</span><span class="op" id="4351319">(</span><span class="ident" id="4351320">s</span><span class="op" id="4351321">,</span>&nbsp;<span class="ident" id="4351323">htmlNospaceReplacementTable</span><span class="op" id="4351350">,</span>&nbsp;<span class="builtintype" id="4351352">false</span><span class="op" id="4351357">)</span><br>
<span class="lineno"></span><span class="op" id="4351359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4351362">//&nbsp;attrEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;quoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4351427">func</span>&nbsp;<span class="ident" id="4351432">attrEscaper</span><span class="op" id="4351443">(</span><span class="ident" id="4351444">args</span>&nbsp;<span class="op" id="4351449">...</span><span class="keyword" id="4351452">interface</span><span class="op" id="4351461">{</span><span class="op" id="4351462">}</span><span class="op" id="4351463">)</span>&nbsp;<span class="builtintype" id="4351465">string</span>&nbsp;<span class="op" id="4351472">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351475">s</span><span class="op" id="4351476">,</span>&nbsp;<span class="ident" id="4351478">t</span>&nbsp;<span class="op" id="4351480">:=</span>&nbsp;<span class="ident" id="4351483">stringify</span><span class="op" id="4351492">(</span><span class="ident" id="4351493">args</span><span class="op" id="4351497">...</span><span class="op" id="4351500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4351503">if</span>&nbsp;<span class="ident" id="4351506">t</span>&nbsp;<span class="op" id="4351508">==</span>&nbsp;<span class="ident" id="4351511">contentTypeHTML</span>&nbsp;<span class="op" id="4351527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4351531">return</span>&nbsp;<span class="ident" id="4351538">htmlReplacer</span><span class="op" id="4351550">(</span><span class="ident" id="4351551">stripTags</span><span class="op" id="4351560">(</span><span class="ident" id="4351561">s</span><span class="op" id="4351562">)</span><span class="op" id="4351563">,</span>&nbsp;<span class="ident" id="4351565">htmlNormReplacementTable</span><span class="op" id="4351589">,</span>&nbsp;<span class="builtintype" id="4351591">true</span><span class="op" id="4351595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4351598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4351601">return</span>&nbsp;<span class="ident" id="4351608">htmlReplacer</span><span class="op" id="4351620">(</span><span class="ident" id="4351621">s</span><span class="op" id="4351622">,</span>&nbsp;<span class="ident" id="4351624">htmlReplacementTable</span><span class="op" id="4351644">,</span>&nbsp;<span class="builtintype" id="4351646">true</span><span class="op" id="4351650">)</span><br>
<span class="lineno">30</span><span class="op" id="4351652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4351655">//&nbsp;rcdataEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="4351721">func</span>&nbsp;<span class="ident" id="4351726">rcdataEscaper</span><span class="op" id="4351739">(</span><span class="ident" id="4351740">args</span>&nbsp;<span class="op" id="4351745">...</span><span class="keyword" id="4351748">interface</span><span class="op" id="4351757">{</span><span class="op" id="4351758">}</span><span class="op" id="4351759">)</span>&nbsp;<span class="builtintype" id="4351761">string</span>&nbsp;<span class="op" id="4351768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4351771">s</span><span class="op" id="4351772">,</span>&nbsp;<span class="ident" id="4351774">t</span>&nbsp;<span class="op" id="4351776">:=</span>&nbsp;<span class="ident" id="4351779">stringify</span><span class="op" id="4351788">(</span><span class="ident" id="4351789">args</span><span class="op" id="4351793">...</span><span class="op" id="4351796">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4351799">if</span>&nbsp;<span class="ident" id="4351802">t</span>&nbsp;<span class="op" id="4351804">==</span>&nbsp;<span class="ident" id="4351807">contentTypeHTML</span>&nbsp;<span class="op" id="4351823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4351827">return</span>&nbsp;<span class="ident" id="4351834">htmlReplacer</span><span class="op" id="4351846">(</span><span class="ident" id="4351847">s</span><span class="op" id="4351848">,</span>&nbsp;<span class="ident" id="4351850">htmlNormReplacementTable</span><span class="op" id="4351874">,</span>&nbsp;<span class="builtintype" id="4351876">true</span><span class="op" id="4351880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4351883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4351886">return</span>&nbsp;<span class="ident" id="4351893">htmlReplacer</span><span class="op" id="4351905">(</span><span class="ident" id="4351906">s</span><span class="op" id="4351907">,</span>&nbsp;<span class="ident" id="4351909">htmlReplacementTable</span><span class="op" id="4351929">,</span>&nbsp;<span class="builtintype" id="4351931">true</span><span class="op" id="4351935">)</span><br>
<span class="lineno"></span><span class="op" id="4351937">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4351940">//&nbsp;htmlEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="4351991">func</span>&nbsp;<span class="ident" id="4351996">htmlEscaper</span><span class="op" id="4352007">(</span><span class="ident" id="4352008">args</span>&nbsp;<span class="op" id="4352013">...</span><span class="keyword" id="4352016">interface</span><span class="op" id="4352025">{</span><span class="op" id="4352026">}</span><span class="op" id="4352027">)</span>&nbsp;<span class="builtintype" id="4352029">string</span>&nbsp;<span class="op" id="4352036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4352039">s</span><span class="op" id="4352040">,</span>&nbsp;<span class="ident" id="4352042">t</span>&nbsp;<span class="op" id="4352044">:=</span>&nbsp;<span class="ident" id="4352047">stringify</span><span class="op" id="4352056">(</span><span class="ident" id="4352057">args</span><span class="op" id="4352061">...</span><span class="op" id="4352064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4352067">if</span>&nbsp;<span class="ident" id="4352070">t</span>&nbsp;<span class="op" id="4352072">==</span>&nbsp;<span class="ident" id="4352075">contentTypeHTML</span>&nbsp;<span class="op" id="4352091">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4352095">return</span>&nbsp;<span class="ident" id="4352102">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4352105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4352108">return</span>&nbsp;<span class="ident" id="4352115">htmlReplacer</span><span class="op" id="4352127">(</span><span class="ident" id="4352128">s</span><span class="op" id="4352129">,</span>&nbsp;<span class="ident" id="4352131">htmlReplacementTable</span><span class="op" id="4352151">,</span>&nbsp;<span class="builtintype" id="4352153">true</span><span class="op" id="4352157">)</span><br>
<span class="lineno"></span><span class="op" id="4352159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4352162">//&nbsp;htmlReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno"></span><span class="comment" id="4352229">//&nbsp;inside&nbsp;a&nbsp;quoted&nbsp;attribute&nbsp;value&nbsp;or&nbsp;in&nbsp;a&nbsp;text&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4352283">var</span>&nbsp;<span class="ident" id="4352287">htmlReplacementTable</span>&nbsp;<span class="op" id="4352308">=</span>&nbsp;<span class="op" id="4352310">[</span><span class="op" id="4352311">]</span><span class="builtintype" id="4352312">string</span><span class="op" id="4352318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4352321">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4352397">//&nbsp;U+0000&nbsp;NULL&nbsp;Parse&nbsp;error.&nbsp;Append&nbsp;a&nbsp;U+FFFD&nbsp;REPLACEMENT</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4352454">//&nbsp;CHARACTER&nbsp;character&nbsp;to&nbsp;the&nbsp;current&nbsp;attribute&#39;s&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4352512">//&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4352518">//&nbsp;and&nbsp;similarly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4352536">//&nbsp;http://www.w3.org/TR/html5/syntax.html#before-attribute-value-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4352608">0</span><span class="op" id="4352609">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4352614">&#34;\uFFFD&#34;</span><span class="op" id="4352622">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4352625">&#39;&#34;&#39;</span><span class="op" id="4352628">:</span>&nbsp;&nbsp;<span class="string" id="4352631">&#34;&amp;#34;&#34;</span><span class="op" id="4352638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4352641">&#39;&amp;&#39;</span><span class="op" id="4352644">:</span>&nbsp;&nbsp;<span class="string" id="4352647">&#34;&amp;amp;&#34;</span><span class="op" id="4352654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4352657">&#39;\&#39;&#39;</span><span class="op" id="4352661">:</span>&nbsp;<span class="string" id="4352663">&#34;&amp;#39;&#34;</span><span class="op" id="4352670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4352673">&#39;+&#39;</span><span class="op" id="4352676">:</span>&nbsp;&nbsp;<span class="string" id="4352679">&#34;&amp;#43;&#34;</span><span class="op" id="4352686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4352689">&#39;&lt;&#39;</span><span class="op" id="4352692">:</span>&nbsp;&nbsp;<span class="string" id="4352695">&#34;&amp;lt;&#34;</span><span class="op" id="4352701">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4352704">&#39;&gt;&#39;</span><span class="op" id="4352707">:</span>&nbsp;&nbsp;<span class="string" id="4352710">&#34;&amp;gt;&#34;</span><span class="op" id="4352716">,</span><br>
<span class="lineno"></span><span class="op" id="4352718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4352721">//&nbsp;htmlNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlReplacementTable&nbsp;but&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4352797">//&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno">70</span><span class="keyword" id="4352839">var</span>&nbsp;<span class="ident" id="4352843">htmlNormReplacementTable</span>&nbsp;<span class="op" id="4352868">=</span>&nbsp;<span class="op" id="4352870">[</span><span class="op" id="4352871">]</span><span class="builtintype" id="4352872">string</span><span class="op" id="4352878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4352881">0</span><span class="op" id="4352882">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4352887">&#34;\uFFFD&#34;</span><span class="op" id="4352895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4352898">&#39;&#34;&#39;</span><span class="op" id="4352901">:</span>&nbsp;&nbsp;<span class="string" id="4352904">&#34;&amp;#34;&#34;</span><span class="op" id="4352911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4352914">&#39;\&#39;&#39;</span><span class="op" id="4352918">:</span>&nbsp;<span class="string" id="4352920">&#34;&amp;#39;&#34;</span><span class="op" id="4352927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4352930">&#39;+&#39;</span><span class="op" id="4352933">:</span>&nbsp;&nbsp;<span class="string" id="4352936">&#34;&amp;#43;&#34;</span><span class="op" id="4352943">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4352946">&#39;&lt;&#39;</span><span class="op" id="4352949">:</span>&nbsp;&nbsp;<span class="string" id="4352952">&#34;&amp;lt;&#34;</span><span class="op" id="4352958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4352961">&#39;&gt;&#39;</span><span class="op" id="4352964">:</span>&nbsp;&nbsp;<span class="string" id="4352967">&#34;&amp;gt;&#34;</span><span class="op" id="4352973">,</span><br>
<span class="lineno"></span><span class="op" id="4352975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4352978">//&nbsp;htmlNospaceReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno">80</span><span class="comment" id="4353052">//&nbsp;inside&nbsp;an&nbsp;unquoted&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4353091">//&nbsp;The&nbsp;set&nbsp;of&nbsp;runes&nbsp;escaped&nbsp;is&nbsp;the&nbsp;union&nbsp;of&nbsp;the&nbsp;HTML&nbsp;specials&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4353157">//&nbsp;those&nbsp;determined&nbsp;by&nbsp;running&nbsp;the&nbsp;JS&nbsp;below&nbsp;in&nbsp;browsers:</span><br>
<span class="lineno"></span><span class="comment" id="4353214">//&nbsp;&lt;div&nbsp;id=d&gt;&lt;/div&gt;</span><br>
<span class="lineno"></span><span class="comment" id="4353234">//&nbsp;&lt;script&gt;(function&nbsp;()&nbsp;{</span><br>
<span class="lineno">85</span><span class="comment" id="4353260">//&nbsp;var&nbsp;a&nbsp;=&nbsp;[],&nbsp;d&nbsp;=&nbsp;document.getElementById(&#34;d&#34;),&nbsp;i,&nbsp;c,&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="4353318">//&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="4353353">//&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;String.fromCharCode(i);</span><br>
<span class="lineno"></span><span class="comment" id="4353386">//&nbsp;&nbsp;&nbsp;d.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;&gt;&lt;/span&gt;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4353448">//&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;d.getElementsByTagName(&#34;SPAN&#34;)[0];</span><br>
<span class="lineno">90</span><span class="comment" id="4353492">//&nbsp;&nbsp;&nbsp;if&nbsp;(!s&nbsp;||&nbsp;s.title&nbsp;!==&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c)&nbsp;{&nbsp;a.push(i.toString(16));&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="4353561">//&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="4353566">//&nbsp;document.write(a.join(&#34;,&nbsp;&#34;));</span><br>
<span class="lineno"></span><span class="comment" id="4353599">//&nbsp;})()&lt;/script&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="4353616">var</span>&nbsp;<span class="ident" id="4353620">htmlNospaceReplacementTable</span>&nbsp;<span class="op" id="4353648">=</span>&nbsp;<span class="op" id="4353650">[</span><span class="op" id="4353651">]</span><span class="builtintype" id="4353652">string</span><span class="op" id="4353658">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4353661">0</span><span class="op" id="4353662">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4353667">&#34;&amp;#xfffd;&#34;</span><span class="op" id="4353677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4353680">&#39;\t&#39;</span><span class="op" id="4353684">:</span>&nbsp;<span class="string" id="4353686">&#34;&amp;#9;&#34;</span><span class="op" id="4353692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4353695">&#39;\n&#39;</span><span class="op" id="4353699">:</span>&nbsp;<span class="string" id="4353701">&#34;&amp;#10;&#34;</span><span class="op" id="4353708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4353711">&#39;\v&#39;</span><span class="op" id="4353715">:</span>&nbsp;<span class="string" id="4353717">&#34;&amp;#11;&#34;</span><span class="op" id="4353724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4353727">&#39;\f&#39;</span><span class="op" id="4353731">:</span>&nbsp;<span class="string" id="4353733">&#34;&amp;#12;&#34;</span><span class="op" id="4353740">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4353743">&#39;\r&#39;</span><span class="op" id="4353747">:</span>&nbsp;<span class="string" id="4353749">&#34;&amp;#13;&#34;</span><span class="op" id="4353756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4353759">&#39;&nbsp;&#39;</span><span class="op" id="4353762">:</span>&nbsp;&nbsp;<span class="string" id="4353765">&#34;&amp;#32;&#34;</span><span class="op" id="4353772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4353775">&#39;&#34;&#39;</span><span class="op" id="4353778">:</span>&nbsp;&nbsp;<span class="string" id="4353781">&#34;&amp;#34;&#34;</span><span class="op" id="4353788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4353791">&#39;&amp;&#39;</span><span class="op" id="4353794">:</span>&nbsp;&nbsp;<span class="string" id="4353797">&#34;&amp;amp;&#34;</span><span class="op" id="4353804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4353807">&#39;\&#39;&#39;</span><span class="op" id="4353811">:</span>&nbsp;<span class="string" id="4353813">&#34;&amp;#39;&#34;</span><span class="op" id="4353820">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4353823">&#39;+&#39;</span><span class="op" id="4353826">:</span>&nbsp;&nbsp;<span class="string" id="4353829">&#34;&amp;#43;&#34;</span><span class="op" id="4353836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4353839">&#39;&lt;&#39;</span><span class="op" id="4353842">:</span>&nbsp;&nbsp;<span class="string" id="4353845">&#34;&amp;lt;&#34;</span><span class="op" id="4353851">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4353854">&#39;=&#39;</span><span class="op" id="4353857">:</span>&nbsp;&nbsp;<span class="string" id="4353860">&#34;&amp;#61;&#34;</span><span class="op" id="4353867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4353870">&#39;&gt;&#39;</span><span class="op" id="4353873">:</span>&nbsp;&nbsp;<span class="string" id="4353876">&#34;&amp;gt;&#34;</span><span class="op" id="4353882">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4353885">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4353941">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4353976">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4354018">&#39;`&#39;</span><span class="op" id="4354021">:</span>&nbsp;<span class="string" id="4354023">&#34;&amp;#96;&#34;</span><span class="op" id="4354030">,</span><br>
<span class="lineno"></span><span class="op" id="4354032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="4354035">//&nbsp;htmlNospaceNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlNospaceReplacementTable&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="4354110">//&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno"></span><span class="keyword" id="4354167">var</span>&nbsp;<span class="ident" id="4354171">htmlNospaceNormReplacementTable</span>&nbsp;<span class="op" id="4354203">=</span>&nbsp;<span class="op" id="4354205">[</span><span class="op" id="4354206">]</span><span class="builtintype" id="4354207">string</span><span class="op" id="4354213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4354216">0</span><span class="op" id="4354217">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4354222">&#34;&amp;#xfffd;&#34;</span><span class="op" id="4354232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4354235">&#39;\t&#39;</span><span class="op" id="4354239">:</span>&nbsp;<span class="string" id="4354241">&#34;&amp;#9;&#34;</span><span class="op" id="4354247">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4354250">&#39;\n&#39;</span><span class="op" id="4354254">:</span>&nbsp;<span class="string" id="4354256">&#34;&amp;#10;&#34;</span><span class="op" id="4354263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4354266">&#39;\v&#39;</span><span class="op" id="4354270">:</span>&nbsp;<span class="string" id="4354272">&#34;&amp;#11;&#34;</span><span class="op" id="4354279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4354282">&#39;\f&#39;</span><span class="op" id="4354286">:</span>&nbsp;<span class="string" id="4354288">&#34;&amp;#12;&#34;</span><span class="op" id="4354295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4354298">&#39;\r&#39;</span><span class="op" id="4354302">:</span>&nbsp;<span class="string" id="4354304">&#34;&amp;#13;&#34;</span><span class="op" id="4354311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4354314">&#39;&nbsp;&#39;</span><span class="op" id="4354317">:</span>&nbsp;&nbsp;<span class="string" id="4354320">&#34;&amp;#32;&#34;</span><span class="op" id="4354327">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4354330">&#39;&#34;&#39;</span><span class="op" id="4354333">:</span>&nbsp;&nbsp;<span class="string" id="4354336">&#34;&amp;#34;&#34;</span><span class="op" id="4354343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4354346">&#39;\&#39;&#39;</span><span class="op" id="4354350">:</span>&nbsp;<span class="string" id="4354352">&#34;&amp;#39;&#34;</span><span class="op" id="4354359">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4354362">&#39;+&#39;</span><span class="op" id="4354365">:</span>&nbsp;&nbsp;<span class="string" id="4354368">&#34;&amp;#43;&#34;</span><span class="op" id="4354375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4354378">&#39;&lt;&#39;</span><span class="op" id="4354381">:</span>&nbsp;&nbsp;<span class="string" id="4354384">&#34;&amp;lt;&#34;</span><span class="op" id="4354390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4354393">&#39;=&#39;</span><span class="op" id="4354396">:</span>&nbsp;&nbsp;<span class="string" id="4354399">&#34;&amp;#61;&#34;</span><span class="op" id="4354406">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4354409">&#39;&gt;&#39;</span><span class="op" id="4354412">:</span>&nbsp;&nbsp;<span class="string" id="4354415">&#34;&amp;gt;&#34;</span><span class="op" id="4354421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4354424">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4354480">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4354515">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4354557">&#39;`&#39;</span><span class="op" id="4354560">:</span>&nbsp;<span class="string" id="4354562">&#34;&amp;#96;&#34;</span><span class="op" id="4354569">,</span><br>
<span class="lineno">135</span><span class="op" id="4354571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4354574">//&nbsp;htmlReplacer&nbsp;returns&nbsp;s&nbsp;with&nbsp;runes&nbsp;replaced&nbsp;according&nbsp;to&nbsp;replacementTable</span><br>
<span class="lineno"></span><span class="comment" id="4354650">//&nbsp;and&nbsp;when&nbsp;badRunes&nbsp;is&nbsp;true,&nbsp;certain&nbsp;bad&nbsp;runes&nbsp;are&nbsp;allowed&nbsp;through&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="4354729">func</span>&nbsp;<span class="ident" id="4354734">htmlReplacer</span><span class="op" id="4354746">(</span><span class="ident" id="4354747">s</span>&nbsp;<span class="builtintype" id="4354749">string</span><span class="op" id="4354755">,</span>&nbsp;<span class="ident" id="4354757">replacementTable</span>&nbsp;<span class="op" id="4354774">[</span><span class="op" id="4354775">]</span><span class="builtintype" id="4354776">string</span><span class="op" id="4354782">,</span>&nbsp;<span class="ident" id="4354784">badRunes</span>&nbsp;<span class="builtintype" id="4354793">bool</span><span class="op" id="4354797">)</span>&nbsp;<span class="builtintype" id="4354799">string</span>&nbsp;<span class="op" id="4354806">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4354809">written</span><span class="op" id="4354816">,</span>&nbsp;<span class="ident" id="4354818">b</span>&nbsp;<span class="op" id="4354820">:=</span>&nbsp;<span class="num" id="4354823">0</span><span class="op" id="4354824">,</span>&nbsp;<span class="builtinfunc" id="4354826">new</span><span class="op" id="4354829">(</span><span class="ident" id="4354830">bytes</span><span class="op" id="4354835">.</span><span class="ident" id="4354836">Buffer</span><span class="op" id="4354842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4354845">for</span>&nbsp;<span class="ident" id="4354849">i</span><span class="op" id="4354850">,</span>&nbsp;<span class="ident" id="4354852">r</span>&nbsp;<span class="op" id="4354854">:=</span>&nbsp;<span class="keyword" id="4354857">range</span>&nbsp;<span class="ident" id="4354863">s</span>&nbsp;<span class="op" id="4354865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4354869">if</span>&nbsp;<span class="builtintype" id="4354872">int</span><span class="op" id="4354875">(</span><span class="ident" id="4354876">r</span><span class="op" id="4354877">)</span>&nbsp;<span class="op" id="4354879">&lt;</span>&nbsp;<span class="builtinfunc" id="4354881">len</span><span class="op" id="4354884">(</span><span class="ident" id="4354885">replacementTable</span><span class="op" id="4354901">)</span>&nbsp;<span class="op" id="4354903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4354908">if</span>&nbsp;<span class="ident" id="4354911">repl</span>&nbsp;<span class="op" id="4354916">:=</span>&nbsp;<span class="ident" id="4354919">replacementTable</span><span class="op" id="4354935">[</span><span class="ident" id="4354936">r</span><span class="op" id="4354937">]</span><span class="op" id="4354938">;</span>&nbsp;<span class="builtinfunc" id="4354940">len</span><span class="op" id="4354943">(</span><span class="ident" id="4354944">repl</span><span class="op" id="4354948">)</span>&nbsp;<span class="op" id="4354950">!=</span>&nbsp;<span class="num" id="4354953">0</span>&nbsp;<span class="op" id="4354955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4354961">b</span><span class="op" id="4354962">.</span><span class="ident" id="4354963">WriteString</span><span class="op" id="4354974">(</span><span class="ident" id="4354975">s</span><span class="op" id="4354976">[</span><span class="ident" id="4354977">written</span><span class="op" id="4354984">:</span><span class="ident" id="4354985">i</span><span class="op" id="4354986">]</span><span class="op" id="4354987">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4354993">b</span><span class="op" id="4354994">.</span><span class="ident" id="4354995">WriteString</span><span class="op" id="4355006">(</span><span class="ident" id="4355007">repl</span><span class="op" id="4355011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355017">//&nbsp;Valid&nbsp;as&nbsp;long&nbsp;as&nbsp;replacementTable&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355066">//&nbsp;include&nbsp;anything&nbsp;above&nbsp;0x7f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4355102">written</span>&nbsp;<span class="op" id="4355110">=</span>&nbsp;<span class="ident" id="4355112">i</span>&nbsp;<span class="op" id="4355114">+</span>&nbsp;<span class="ident" id="4355116">utf8</span><span class="op" id="4355120">.</span><span class="ident" id="4355121">RuneLen</span><span class="op" id="4355128">(</span><span class="ident" id="4355129">r</span><span class="op" id="4355130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4355135">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4355139">}</span>&nbsp;<span class="keyword" id="4355141">else</span>&nbsp;<span class="keyword" id="4355146">if</span>&nbsp;<span class="ident" id="4355149">badRunes</span>&nbsp;<span class="op" id="4355158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355163">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355176">//&nbsp;IE&nbsp;does&nbsp;not&nbsp;allow&nbsp;these&nbsp;ranges&nbsp;in&nbsp;unquoted&nbsp;attrs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4355231">}</span>&nbsp;<span class="keyword" id="4355233">else</span>&nbsp;<span class="keyword" id="4355238">if</span>&nbsp;<span class="num" id="4355241">0xfdd0</span>&nbsp;<span class="op" id="4355248">&lt;=</span>&nbsp;<span class="ident" id="4355251">r</span>&nbsp;<span class="op" id="4355253">&amp;&amp;</span>&nbsp;<span class="ident" id="4355256">r</span>&nbsp;<span class="op" id="4355258">&lt;=</span>&nbsp;<span class="num" id="4355261">0xfdef</span>&nbsp;<span class="op" id="4355268">||</span>&nbsp;<span class="num" id="4355271">0xfff0</span>&nbsp;<span class="op" id="4355278">&lt;=</span>&nbsp;<span class="ident" id="4355281">r</span>&nbsp;<span class="op" id="4355283">&amp;&amp;</span>&nbsp;<span class="ident" id="4355286">r</span>&nbsp;<span class="op" id="4355288">&lt;=</span>&nbsp;<span class="num" id="4355291">0xffff</span>&nbsp;<span class="op" id="4355298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4355303">fmt</span><span class="op" id="4355306">.</span><span class="ident" id="4355307">Fprintf</span><span class="op" id="4355314">(</span><span class="ident" id="4355315">b</span><span class="op" id="4355316">,</span>&nbsp;<span class="string" id="4355318">&#34;%s&amp;#x%x;&#34;</span><span class="op" id="4355328">,</span>&nbsp;<span class="ident" id="4355330">s</span><span class="op" id="4355331">[</span><span class="ident" id="4355332">written</span><span class="op" id="4355339">:</span><span class="ident" id="4355340">i</span><span class="op" id="4355341">]</span><span class="op" id="4355342">,</span>&nbsp;<span class="ident" id="4355344">r</span><span class="op" id="4355345">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4355350">written</span>&nbsp;<span class="op" id="4355358">=</span>&nbsp;<span class="ident" id="4355360">i</span>&nbsp;<span class="op" id="4355362">+</span>&nbsp;<span class="ident" id="4355364">utf8</span><span class="op" id="4355368">.</span><span class="ident" id="4355369">RuneLen</span><span class="op" id="4355376">(</span><span class="ident" id="4355377">r</span><span class="op" id="4355378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4355382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4355385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355388">if</span>&nbsp;<span class="ident" id="4355391">written</span>&nbsp;<span class="op" id="4355399">==</span>&nbsp;<span class="num" id="4355402">0</span>&nbsp;<span class="op" id="4355404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355408">return</span>&nbsp;<span class="ident" id="4355415">s</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4355418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4355421">b</span><span class="op" id="4355422">.</span><span class="ident" id="4355423">WriteString</span><span class="op" id="4355434">(</span><span class="ident" id="4355435">s</span><span class="op" id="4355436">[</span><span class="ident" id="4355437">written</span><span class="op" id="4355444">:</span><span class="op" id="4355445">]</span><span class="op" id="4355446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355449">return</span>&nbsp;<span class="ident" id="4355456">b</span><span class="op" id="4355457">.</span><span class="ident" id="4355458">String</span><span class="op" id="4355464">(</span><span class="op" id="4355465">)</span><br>
<span class="lineno"></span><span class="op" id="4355467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4355470">//&nbsp;stripTags&nbsp;takes&nbsp;a&nbsp;snippet&nbsp;of&nbsp;HTML&nbsp;and&nbsp;returns&nbsp;only&nbsp;the&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="4355542">//&nbsp;For&nbsp;example,&nbsp;`&lt;b&gt;&amp;iexcl;Hi!&lt;/b&gt;&nbsp;&lt;script&gt;...&lt;/script&gt;`&nbsp;-&gt;&nbsp;`&amp;iexcl;Hi!&nbsp;`.</span><br>
<span class="lineno"></span><span class="keyword" id="4355617">func</span>&nbsp;<span class="ident" id="4355622">stripTags</span><span class="op" id="4355631">(</span><span class="ident" id="4355632">html</span>&nbsp;<span class="builtintype" id="4355637">string</span><span class="op" id="4355643">)</span>&nbsp;<span class="builtintype" id="4355645">string</span>&nbsp;<span class="op" id="4355652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355655">var</span>&nbsp;<span class="ident" id="4355659">b</span>&nbsp;<span class="ident" id="4355661">bytes</span><span class="op" id="4355666">.</span><span class="ident" id="4355667">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4355675">s</span><span class="op" id="4355676">,</span>&nbsp;<span class="ident" id="4355678">c</span><span class="op" id="4355679">,</span>&nbsp;<span class="ident" id="4355681">i</span><span class="op" id="4355682">,</span>&nbsp;<span class="ident" id="4355684">allText</span>&nbsp;<span class="op" id="4355692">:=</span>&nbsp;<span class="op" id="4355695">[</span><span class="op" id="4355696">]</span><span class="builtintype" id="4355697">byte</span><span class="op" id="4355701">(</span><span class="ident" id="4355702">html</span><span class="op" id="4355706">)</span><span class="op" id="4355707">,</span>&nbsp;<span class="ident" id="4355709">context</span><span class="op" id="4355716">{</span><span class="op" id="4355717">}</span><span class="op" id="4355718">,</span>&nbsp;<span class="num" id="4355720">0</span><span class="op" id="4355721">,</span>&nbsp;<span class="builtintype" id="4355723">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355729">//&nbsp;Using&nbsp;the&nbsp;transition&nbsp;funcs&nbsp;helps&nbsp;us&nbsp;avoid&nbsp;mangling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355784">//&nbsp;`&lt;div&nbsp;title=&#34;1&gt;2&#34;&gt;`&nbsp;or&nbsp;`I&nbsp;&lt;3&nbsp;Ponies!`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355827">for</span>&nbsp;<span class="ident" id="4355831">i</span>&nbsp;<span class="op" id="4355833">!=</span>&nbsp;<span class="builtinfunc" id="4355836">len</span><span class="op" id="4355839">(</span><span class="ident" id="4355840">s</span><span class="op" id="4355841">)</span>&nbsp;<span class="op" id="4355843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355847">if</span>&nbsp;<span class="ident" id="4355850">c</span><span class="op" id="4355851">.</span><span class="ident" id="4355852">delim</span>&nbsp;<span class="op" id="4355858">==</span>&nbsp;<span class="ident" id="4355861">delimNone</span>&nbsp;<span class="op" id="4355871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4355876">st</span>&nbsp;<span class="op" id="4355879">:=</span>&nbsp;<span class="ident" id="4355882">c</span><span class="op" id="4355883">.</span><span class="ident" id="4355884">state</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355893">//&nbsp;Use&nbsp;RCDATA&nbsp;instead&nbsp;of&nbsp;parsing&nbsp;into&nbsp;JS&nbsp;or&nbsp;CSS&nbsp;styles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355952">if</span>&nbsp;<span class="ident" id="4355955">c</span><span class="op" id="4355956">.</span><span class="ident" id="4355957">element</span>&nbsp;<span class="op" id="4355965">!=</span>&nbsp;<span class="ident" id="4355968">elementNone</span>&nbsp;<span class="op" id="4355980">&amp;&amp;</span>&nbsp;<span class="op" id="4355983">!</span><span class="ident" id="4355984">isInTag</span><span class="op" id="4355991">(</span><span class="ident" id="4355992">st</span><span class="op" id="4355994">)</span>&nbsp;<span class="op" id="4355996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356002">st</span>&nbsp;<span class="op" id="4356005">=</span>&nbsp;<span class="ident" id="4356007">stateRCDATA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356027">d</span><span class="op" id="4356028">,</span>&nbsp;<span class="ident" id="4356030">nread</span>&nbsp;<span class="op" id="4356036">:=</span>&nbsp;<span class="ident" id="4356039">transitionFunc</span><span class="op" id="4356053">[</span><span class="ident" id="4356054">st</span><span class="op" id="4356056">]</span><span class="op" id="4356057">(</span><span class="ident" id="4356058">c</span><span class="op" id="4356059">,</span>&nbsp;<span class="ident" id="4356061">s</span><span class="op" id="4356062">[</span><span class="ident" id="4356063">i</span><span class="op" id="4356064">:</span><span class="op" id="4356065">]</span><span class="op" id="4356066">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356071">i1</span>&nbsp;<span class="op" id="4356074">:=</span>&nbsp;<span class="ident" id="4356077">i</span>&nbsp;<span class="op" id="4356079">+</span>&nbsp;<span class="ident" id="4356081">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356090">if</span>&nbsp;<span class="ident" id="4356093">c</span><span class="op" id="4356094">.</span><span class="ident" id="4356095">state</span>&nbsp;<span class="op" id="4356101">==</span>&nbsp;<span class="ident" id="4356104">stateText</span>&nbsp;<span class="op" id="4356114">||</span>&nbsp;<span class="ident" id="4356117">c</span><span class="op" id="4356118">.</span><span class="ident" id="4356119">state</span>&nbsp;<span class="op" id="4356125">==</span>&nbsp;<span class="ident" id="4356128">stateRCDATA</span>&nbsp;<span class="op" id="4356140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4356146">//&nbsp;Emit&nbsp;text&nbsp;up&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;tag&nbsp;or&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356202">j</span>&nbsp;<span class="op" id="4356204">:=</span>&nbsp;<span class="ident" id="4356207">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356214">if</span>&nbsp;<span class="ident" id="4356217">d</span><span class="op" id="4356218">.</span><span class="ident" id="4356219">state</span>&nbsp;<span class="op" id="4356225">!=</span>&nbsp;<span class="ident" id="4356228">c</span><span class="op" id="4356229">.</span><span class="ident" id="4356230">state</span>&nbsp;<span class="op" id="4356236">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356243">for</span>&nbsp;<span class="ident" id="4356247">j1</span>&nbsp;<span class="op" id="4356250">:=</span>&nbsp;<span class="ident" id="4356253">j</span>&nbsp;<span class="op" id="4356255">-</span>&nbsp;<span class="num" id="4356257">1</span><span class="op" id="4356258">;</span>&nbsp;<span class="ident" id="4356260">j1</span>&nbsp;<span class="op" id="4356263">&gt;=</span>&nbsp;<span class="ident" id="4356266">i</span><span class="op" id="4356267">;</span>&nbsp;<span class="ident" id="4356269">j1</span><span class="op" id="4356271">--</span>&nbsp;<span class="op" id="4356274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356282">if</span>&nbsp;<span class="ident" id="4356285">s</span><span class="op" id="4356286">[</span><span class="ident" id="4356287">j1</span><span class="op" id="4356289">]</span>&nbsp;<span class="op" id="4356291">==</span>&nbsp;<span class="string" id="4356294">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4356298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356307">j</span>&nbsp;<span class="op" id="4356309">=</span>&nbsp;<span class="ident" id="4356311">j1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356321">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356333">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356352">b</span><span class="op" id="4356353">.</span><span class="ident" id="4356354">Write</span><span class="op" id="4356359">(</span><span class="ident" id="4356360">s</span><span class="op" id="4356361">[</span><span class="ident" id="4356362">i</span><span class="op" id="4356363">:</span><span class="ident" id="4356364">j</span><span class="op" id="4356365">]</span><span class="op" id="4356366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356371">}</span>&nbsp;<span class="keyword" id="4356373">else</span>&nbsp;<span class="op" id="4356378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356384">allText</span>&nbsp;<span class="op" id="4356392">=</span>&nbsp;<span class="builtintype" id="4356394">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356408">c</span><span class="op" id="4356409">,</span>&nbsp;<span class="ident" id="4356411">i</span>&nbsp;<span class="op" id="4356413">=</span>&nbsp;<span class="ident" id="4356415">d</span><span class="op" id="4356416">,</span>&nbsp;<span class="ident" id="4356418">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356424">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356439">i1</span>&nbsp;<span class="op" id="4356442">:=</span>&nbsp;<span class="ident" id="4356445">i</span>&nbsp;<span class="op" id="4356447">+</span>&nbsp;<span class="ident" id="4356449">bytes</span><span class="op" id="4356454">.</span><span class="ident" id="4356455">IndexAny</span><span class="op" id="4356463">(</span><span class="ident" id="4356464">s</span><span class="op" id="4356465">[</span><span class="ident" id="4356466">i</span><span class="op" id="4356467">:</span><span class="op" id="4356468">]</span><span class="op" id="4356469">,</span>&nbsp;<span class="ident" id="4356471">delimEnds</span><span class="op" id="4356480">[</span><span class="ident" id="4356481">c</span><span class="op" id="4356482">.</span><span class="ident" id="4356483">delim</span><span class="op" id="4356488">]</span><span class="op" id="4356489">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356493">if</span>&nbsp;<span class="ident" id="4356496">i1</span>&nbsp;<span class="op" id="4356499">&lt;</span>&nbsp;<span class="ident" id="4356501">i</span>&nbsp;<span class="op" id="4356503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356508">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356520">if</span>&nbsp;<span class="ident" id="4356523">c</span><span class="op" id="4356524">.</span><span class="ident" id="4356525">delim</span>&nbsp;<span class="op" id="4356531">!=</span>&nbsp;<span class="ident" id="4356534">delimSpaceOrTagEnd</span>&nbsp;<span class="op" id="4356553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4356558">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356583">i1</span><span class="op" id="4356585">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356594">c</span><span class="op" id="4356595">,</span>&nbsp;<span class="ident" id="4356597">i</span>&nbsp;<span class="op" id="4356599">=</span>&nbsp;<span class="ident" id="4356601">context</span><span class="op" id="4356608">{</span><span class="ident" id="4356609">state</span><span class="op" id="4356614">:</span>&nbsp;<span class="ident" id="4356616">stateTag</span><span class="op" id="4356624">,</span>&nbsp;<span class="ident" id="4356626">element</span><span class="op" id="4356633">:</span>&nbsp;<span class="ident" id="4356635">c</span><span class="op" id="4356636">.</span><span class="ident" id="4356637">element</span><span class="op" id="4356644">}</span><span class="op" id="4356645">,</span>&nbsp;<span class="ident" id="4356647">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356654">if</span>&nbsp;<span class="ident" id="4356657">allText</span>&nbsp;<span class="op" id="4356665">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356669">return</span>&nbsp;<span class="ident" id="4356676">html</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356682">}</span>&nbsp;<span class="keyword" id="4356684">else</span>&nbsp;<span class="keyword" id="4356689">if</span>&nbsp;<span class="ident" id="4356692">c</span><span class="op" id="4356693">.</span><span class="ident" id="4356694">state</span>&nbsp;<span class="op" id="4356700">==</span>&nbsp;<span class="ident" id="4356703">stateText</span>&nbsp;<span class="op" id="4356713">||</span>&nbsp;<span class="ident" id="4356716">c</span><span class="op" id="4356717">.</span><span class="ident" id="4356718">state</span>&nbsp;<span class="op" id="4356724">==</span>&nbsp;<span class="ident" id="4356727">stateRCDATA</span>&nbsp;<span class="op" id="4356739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356743">b</span><span class="op" id="4356744">.</span><span class="ident" id="4356745">Write</span><span class="op" id="4356750">(</span><span class="ident" id="4356751">s</span><span class="op" id="4356752">[</span><span class="ident" id="4356753">i</span><span class="op" id="4356754">:</span><span class="op" id="4356755">]</span><span class="op" id="4356756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4356759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356762">return</span>&nbsp;<span class="ident" id="4356769">b</span><span class="op" id="4356770">.</span><span class="ident" id="4356771">String</span><span class="op" id="4356777">(</span><span class="op" id="4356778">)</span><br>
<span class="lineno">215</span><span class="op" id="4356780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4356783">//&nbsp;htmlNameFilter&nbsp;accepts&nbsp;valid&nbsp;parts&nbsp;of&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;tag&nbsp;name&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4356857">//&nbsp;a&nbsp;known-safe&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="4356889">func</span>&nbsp;<span class="ident" id="4356894">htmlNameFilter</span><span class="op" id="4356908">(</span><span class="ident" id="4356909">args</span>&nbsp;<span class="op" id="4356914">...</span><span class="keyword" id="4356917">interface</span><span class="op" id="4356926">{</span><span class="op" id="4356927">}</span><span class="op" id="4356928">)</span>&nbsp;<span class="builtintype" id="4356930">string</span>&nbsp;<span class="op" id="4356937">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356940">s</span><span class="op" id="4356941">,</span>&nbsp;<span class="ident" id="4356943">t</span>&nbsp;<span class="op" id="4356945">:=</span>&nbsp;<span class="ident" id="4356948">stringify</span><span class="op" id="4356957">(</span><span class="ident" id="4356958">args</span><span class="op" id="4356962">...</span><span class="op" id="4356965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356968">if</span>&nbsp;<span class="ident" id="4356971">t</span>&nbsp;<span class="op" id="4356973">==</span>&nbsp;<span class="ident" id="4356976">contentTypeHTMLAttr</span>&nbsp;<span class="op" id="4356996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4357000">return</span>&nbsp;<span class="ident" id="4357007">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4357010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4357013">if</span>&nbsp;<span class="builtinfunc" id="4357016">len</span><span class="op" id="4357019">(</span><span class="ident" id="4357020">s</span><span class="op" id="4357021">)</span>&nbsp;<span class="op" id="4357023">==</span>&nbsp;<span class="num" id="4357026">0</span>&nbsp;<span class="op" id="4357028">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4357032">//&nbsp;Avoid&nbsp;violation&nbsp;of&nbsp;structure&nbsp;preservation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4357080">//&nbsp;&lt;input&nbsp;checked&nbsp;{{.K}}={{.V}}&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4357116">//&nbsp;Without&nbsp;this,&nbsp;if&nbsp;.K&nbsp;is&nbsp;empty&nbsp;then&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4357174">//&nbsp;checked,&nbsp;but&nbsp;otherwise&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;attribute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4357235">//&nbsp;named&nbsp;.K.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4357250">return</span>&nbsp;<span class="ident" id="4357257">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4357273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4357276">s</span>&nbsp;<span class="op" id="4357278">=</span>&nbsp;<span class="ident" id="4357280">strings</span><span class="op" id="4357287">.</span><span class="ident" id="4357288">ToLower</span><span class="op" id="4357295">(</span><span class="ident" id="4357296">s</span><span class="op" id="4357297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4357300">if</span>&nbsp;<span class="ident" id="4357303">t</span>&nbsp;<span class="op" id="4357305">:=</span>&nbsp;<span class="ident" id="4357308">attrType</span><span class="op" id="4357316">(</span><span class="ident" id="4357317">s</span><span class="op" id="4357318">)</span><span class="op" id="4357319">;</span>&nbsp;<span class="ident" id="4357321">t</span>&nbsp;<span class="op" id="4357323">!=</span>&nbsp;<span class="ident" id="4357326">contentTypePlain</span>&nbsp;<span class="op" id="4357343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4357347">//&nbsp;TODO:&nbsp;Split&nbsp;attr&nbsp;and&nbsp;element&nbsp;name&nbsp;part&nbsp;filters&nbsp;so&nbsp;we&nbsp;can&nbsp;whitelist</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4357419">//&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4357436">return</span>&nbsp;<span class="ident" id="4357443">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4357459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4357462">for</span>&nbsp;<span class="ident" id="4357466">_</span><span class="op" id="4357467">,</span>&nbsp;<span class="ident" id="4357469">r</span>&nbsp;<span class="op" id="4357471">:=</span>&nbsp;<span class="keyword" id="4357474">range</span>&nbsp;<span class="ident" id="4357480">s</span>&nbsp;<span class="op" id="4357482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4357486">switch</span>&nbsp;<span class="op" id="4357493">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4357497">case</span>&nbsp;<span class="string" id="4357502">&#39;0&#39;</span>&nbsp;<span class="op" id="4357506">&lt;=</span>&nbsp;<span class="ident" id="4357509">r</span>&nbsp;<span class="op" id="4357511">&amp;&amp;</span>&nbsp;<span class="ident" id="4357514">r</span>&nbsp;<span class="op" id="4357516">&lt;=</span>&nbsp;<span class="string" id="4357519">&#39;9&#39;</span><span class="op" id="4357522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4357526">case</span>&nbsp;<span class="string" id="4357531">&#39;a&#39;</span>&nbsp;<span class="op" id="4357535">&lt;=</span>&nbsp;<span class="ident" id="4357538">r</span>&nbsp;<span class="op" id="4357540">&amp;&amp;</span>&nbsp;<span class="ident" id="4357543">r</span>&nbsp;<span class="op" id="4357545">&lt;=</span>&nbsp;<span class="string" id="4357548">&#39;z&#39;</span><span class="op" id="4357551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4357555">default</span><span class="op" id="4357562">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4357567">return</span>&nbsp;<span class="ident" id="4357574">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4357591">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4357594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4357597">return</span>&nbsp;<span class="ident" id="4357604">s</span><br>
<span class="lineno"></span><span class="op" id="4357606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4357609">//&nbsp;commentEscaper&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string&nbsp;regardless&nbsp;of&nbsp;input.</span><br>
<span class="lineno">250</span><span class="comment" id="4357673">//&nbsp;Comment&nbsp;content&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;any&nbsp;parsed&nbsp;structure&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4357739">//&nbsp;human-readable&nbsp;content,&nbsp;so&nbsp;the&nbsp;simplest&nbsp;and&nbsp;most&nbsp;secure&nbsp;policy&nbsp;is&nbsp;to&nbsp;drop</span><br>
<span class="lineno"></span><span class="comment" id="4357816">//&nbsp;content&nbsp;interpolated&nbsp;into&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="4357855">//&nbsp;This&nbsp;approach&nbsp;is&nbsp;equally&nbsp;valid&nbsp;whether&nbsp;or&nbsp;not&nbsp;static&nbsp;comment&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4357930">//&nbsp;removed&nbsp;from&nbsp;the&nbsp;template.</span><br>
<span class="lineno">255</span><span class="keyword" id="4357960">func</span>&nbsp;<span class="ident" id="4357965">commentEscaper</span><span class="op" id="4357979">(</span><span class="ident" id="4357980">args</span>&nbsp;<span class="op" id="4357985">...</span><span class="keyword" id="4357988">interface</span><span class="op" id="4357997">{</span><span class="op" id="4357998">}</span><span class="op" id="4357999">)</span>&nbsp;<span class="builtintype" id="4358001">string</span>&nbsp;<span class="op" id="4358008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4358011">return</span>&nbsp;<span class="string" id="4358018">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="4358021">}</span>
</div>
</body>
</html>
