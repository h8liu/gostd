<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>log/syslog</h2>
<ul>
<li><a href="/gostd/log/syslog/syslog.go.html">syslog.go</a></li>
<li><a href="/gostd/log/syslog/syslog_test.go.html">syslog_test.go</a></li>
<li><a href="/gostd/log/syslog/syslog_unix.go.html">syslog_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6007855">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6007910">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6007964">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6008015">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6008048">//&nbsp;Package&nbsp;syslog&nbsp;provides&nbsp;a&nbsp;simple&nbsp;interface&nbsp;to&nbsp;the&nbsp;system&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="6008112">//&nbsp;service.&nbsp;It&nbsp;can&nbsp;send&nbsp;messages&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon&nbsp;using&nbsp;UNIX</span><br>
<span class="lineno"></span><span class="comment" id="6008177">//&nbsp;domain&nbsp;sockets,&nbsp;UDP&nbsp;or&nbsp;TCP.</span><br>
<span class="lineno">10</span><span class="comment" id="6008208">//</span><br>
<span class="lineno"></span><span class="comment" id="6008211">//&nbsp;Only&nbsp;one&nbsp;call&nbsp;to&nbsp;Dial&nbsp;is&nbsp;necessary.&nbsp;On&nbsp;write&nbsp;failures,</span><br>
<span class="lineno"></span><span class="comment" id="6008269">//&nbsp;the&nbsp;syslog&nbsp;client&nbsp;will&nbsp;attempt&nbsp;to&nbsp;reconnect&nbsp;to&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="6008330">//&nbsp;and&nbsp;write&nbsp;again.</span><br>
<span class="lineno"></span><span class="keyword" id="6008350">package</span>&nbsp;<span class="ident" id="6008358">syslog</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6008366">import</span>&nbsp;<span class="op" id="6008373">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6008376">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6008386">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6008393">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6008400">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6008407">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6008413">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6008424">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6008432">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6008439">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6008442">//&nbsp;The&nbsp;Priority&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;the&nbsp;syslog&nbsp;facility&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6008502">//&nbsp;severity.&nbsp;For&nbsp;example,&nbsp;LOG_ALERT&nbsp;|&nbsp;LOG_FTP&nbsp;sends&nbsp;an&nbsp;alert&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6008572">//&nbsp;message&nbsp;from&nbsp;the&nbsp;FTP&nbsp;facility.&nbsp;The&nbsp;default&nbsp;severity&nbsp;is&nbsp;LOG_EMERG;</span><br>
<span class="lineno">30</span><span class="comment" id="6008641">//&nbsp;the&nbsp;default&nbsp;facility&nbsp;is&nbsp;LOG_KERN.</span><br>
<span class="lineno"></span><span class="keyword" id="6008678">type</span>&nbsp;<span class="ident" id="6008683">Priority</span>&nbsp;<span class="builtintype" id="6008692">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6008697">const</span>&nbsp;<span class="ident" id="6008703">severityMask</span>&nbsp;<span class="op" id="6008716">=</span>&nbsp;<span class="num" id="6008718">0x07</span><br>
<span class="lineno"></span><span class="keyword" id="6008723">const</span>&nbsp;<span class="ident" id="6008729">facilityMask</span>&nbsp;<span class="op" id="6008742">=</span>&nbsp;<span class="num" id="6008744">0xf8</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="6008750">const</span>&nbsp;<span class="op" id="6008756">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008759">//&nbsp;Severity.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008774">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008810">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008858">LOG_EMERG</span>&nbsp;<span class="ident" id="6008868">Priority</span>&nbsp;<span class="op" id="6008877">=</span>&nbsp;<span class="ident" id="6008879">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008885">LOG_ALERT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008896">LOG_CRIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008906">LOG_ERR</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008915">LOG_WARNING</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008928">LOG_NOTICE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008940">LOG_INFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008950">LOG_DEBUG</span><br>
<span class="lineno"></span><span class="op" id="6008960">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6008963">const</span>&nbsp;<span class="op" id="6008969">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008972">//&nbsp;Facility.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008987">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009023">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;up&nbsp;to&nbsp;LOG_FTP&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009085">LOG_KERN</span>&nbsp;<span class="ident" id="6009094">Priority</span>&nbsp;<span class="op" id="6009103">=</span>&nbsp;<span class="ident" id="6009105">iota</span>&nbsp;<span class="op" id="6009110">&lt;&lt;</span>&nbsp;<span class="num" id="6009113">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009116">LOG_USER</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009126">LOG_MAIL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009136">LOG_DAEMON</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009148">LOG_AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009158">LOG_SYSLOG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009170">LOG_LPR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009179">LOG_NEWS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009189">LOG_UUCP</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009199">LOG_CRON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009209">LOG_AUTHPRIV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009223">LOG_FTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009232">_</span>&nbsp;<span class="comment" id="6009234">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009245">_</span>&nbsp;<span class="comment" id="6009247">//&nbsp;unused</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009258">_</span>&nbsp;<span class="comment" id="6009260">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009271">_</span>&nbsp;<span class="comment" id="6009273">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009284">LOG_LOCAL0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009296">LOG_LOCAL1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009308">LOG_LOCAL2</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009320">LOG_LOCAL3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009332">LOG_LOCAL4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009344">LOG_LOCAL5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009356">LOG_LOCAL6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009368">LOG_LOCAL7</span><br>
<span class="lineno">80</span><span class="op" id="6009379">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6009382">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6009430">type</span>&nbsp;<span class="ident" id="6009435">Writer</span>&nbsp;<span class="keyword" id="6009442">struct</span>&nbsp;<span class="op" id="6009449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009452">priority</span>&nbsp;<span class="ident" id="6009461">Priority</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009471">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6009480">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009488">hostname</span>&nbsp;<span class="builtintype" id="6009497">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009505">network</span>&nbsp;&nbsp;<span class="builtintype" id="6009514">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009522">raddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6009531">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009540">mu</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6009545">sync</span><span class="op" id="6009549">.</span><span class="ident" id="6009550">Mutex</span>&nbsp;<span class="comment" id="6009556">//&nbsp;guards&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009572">conn</span>&nbsp;<span class="ident" id="6009577">serverConn</span><br>
<span class="lineno"></span><span class="op" id="6009588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6009591">//&nbsp;This&nbsp;interface&nbsp;and&nbsp;the&nbsp;separate&nbsp;syslog_unix.go&nbsp;file&nbsp;exist&nbsp;for</span><br>
<span class="lineno">95</span><span class="comment" id="6009656">//&nbsp;Solaris&nbsp;support&nbsp;as&nbsp;implemented&nbsp;by&nbsp;gccgo.&nbsp;&nbsp;On&nbsp;Solaris&nbsp;you&nbsp;can&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6009724">//&nbsp;simply&nbsp;open&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.&nbsp;&nbsp;The&nbsp;gccgo</span><br>
<span class="lineno"></span><span class="comment" id="6009789">//&nbsp;sources&nbsp;have&nbsp;a&nbsp;syslog_solaris.go&nbsp;file&nbsp;that&nbsp;implements&nbsp;unixSyslog&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6009860">//&nbsp;return&nbsp;a&nbsp;type&nbsp;that&nbsp;satisfies&nbsp;this&nbsp;interface&nbsp;and&nbsp;simply&nbsp;calls&nbsp;the&nbsp;C</span><br>
<span class="lineno"></span><span class="comment" id="6009930">//&nbsp;library&nbsp;syslog&nbsp;function.</span><br>
<span class="lineno">100</span><span class="keyword" id="6009958">type</span>&nbsp;<span class="ident" id="6009963">serverConn</span>&nbsp;<span class="keyword" id="6009974">interface</span>&nbsp;<span class="op" id="6009984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009987">writeString</span><span class="op" id="6009998">(</span><span class="ident" id="6009999">p</span>&nbsp;<span class="ident" id="6010001">Priority</span><span class="op" id="6010009">,</span>&nbsp;<span class="ident" id="6010011">hostname</span><span class="op" id="6010019">,</span>&nbsp;<span class="ident" id="6010021">tag</span><span class="op" id="6010024">,</span>&nbsp;<span class="ident" id="6010026">s</span><span class="op" id="6010027">,</span>&nbsp;<span class="ident" id="6010029">nl</span>&nbsp;<span class="builtintype" id="6010032">string</span><span class="op" id="6010038">)</span>&nbsp;<span class="builtintype" id="6010040">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6010047">close</span><span class="op" id="6010052">(</span><span class="op" id="6010053">)</span>&nbsp;<span class="builtintype" id="6010055">error</span><br>
<span class="lineno"></span><span class="op" id="6010061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6010064">type</span>&nbsp;<span class="ident" id="6010069">netConn</span>&nbsp;<span class="keyword" id="6010077">struct</span>&nbsp;<span class="op" id="6010084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010087">local</span>&nbsp;<span class="builtintype" id="6010093">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010099">conn</span>&nbsp;&nbsp;<span class="ident" id="6010105">net</span><span class="op" id="6010108">.</span><span class="ident" id="6010109">Conn</span><br>
<span class="lineno"></span><span class="op" id="6010114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6010117">//&nbsp;New&nbsp;establishes&nbsp;a&nbsp;new&nbsp;connection&nbsp;to&nbsp;the&nbsp;system&nbsp;log&nbsp;daemon.&nbsp;&nbsp;Each</span><br>
<span class="lineno"></span><span class="comment" id="6010185">//&nbsp;write&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6010252">//&nbsp;priority&nbsp;and&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6010276">func</span>&nbsp;<span class="ident" id="6010281">New</span><span class="op" id="6010284">(</span><span class="ident" id="6010285">priority</span>&nbsp;<span class="ident" id="6010294">Priority</span><span class="op" id="6010302">,</span>&nbsp;<span class="ident" id="6010304">tag</span>&nbsp;<span class="builtintype" id="6010308">string</span><span class="op" id="6010314">)</span>&nbsp;<span class="op" id="6010316">(</span><span class="ident" id="6010317">w</span>&nbsp;<span class="op" id="6010319">*</span><span class="ident" id="6010320">Writer</span><span class="op" id="6010326">,</span>&nbsp;<span class="ident" id="6010328">err</span>&nbsp;<span class="builtintype" id="6010332">error</span><span class="op" id="6010337">)</span>&nbsp;<span class="op" id="6010339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010342">return</span>&nbsp;<span class="ident" id="6010349">Dial</span><span class="op" id="6010353">(</span><span class="string" id="6010354">&#34;&#34;</span><span class="op" id="6010356">,</span>&nbsp;<span class="string" id="6010358">&#34;&#34;</span><span class="op" id="6010360">,</span>&nbsp;<span class="ident" id="6010362">priority</span><span class="op" id="6010370">,</span>&nbsp;<span class="ident" id="6010372">tag</span><span class="op" id="6010375">)</span><br>
<span class="lineno">115</span><span class="op" id="6010377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6010380">//&nbsp;Dial&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;log&nbsp;daemon&nbsp;by&nbsp;connecting&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6010446">//&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;specified&nbsp;network.&nbsp;&nbsp;Each&nbsp;write&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="6010517">//&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given&nbsp;facility,&nbsp;severity&nbsp;and</span><br>
<span class="lineno">120</span><span class="comment" id="6010585">//&nbsp;tag.</span><br>
<span class="lineno"></span><span class="comment" id="6010593">//&nbsp;If&nbsp;network&nbsp;is&nbsp;empty,&nbsp;Dial&nbsp;will&nbsp;connect&nbsp;to&nbsp;the&nbsp;local&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6010663">func</span>&nbsp;<span class="ident" id="6010668">Dial</span><span class="op" id="6010672">(</span><span class="ident" id="6010673">network</span><span class="op" id="6010680">,</span>&nbsp;<span class="ident" id="6010682">raddr</span>&nbsp;<span class="builtintype" id="6010688">string</span><span class="op" id="6010694">,</span>&nbsp;<span class="ident" id="6010696">priority</span>&nbsp;<span class="ident" id="6010705">Priority</span><span class="op" id="6010713">,</span>&nbsp;<span class="ident" id="6010715">tag</span>&nbsp;<span class="builtintype" id="6010719">string</span><span class="op" id="6010725">)</span>&nbsp;<span class="op" id="6010727">(</span><span class="op" id="6010728">*</span><span class="ident" id="6010729">Writer</span><span class="op" id="6010735">,</span>&nbsp;<span class="builtintype" id="6010737">error</span><span class="op" id="6010742">)</span>&nbsp;<span class="op" id="6010744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010747">if</span>&nbsp;<span class="ident" id="6010750">priority</span>&nbsp;<span class="op" id="6010759">&lt;</span>&nbsp;<span class="num" id="6010761">0</span>&nbsp;<span class="op" id="6010763">||</span>&nbsp;<span class="ident" id="6010766">priority</span>&nbsp;<span class="op" id="6010775">&gt;</span>&nbsp;<span class="ident" id="6010777">LOG_LOCAL7</span><span class="op" id="6010787">|</span><span class="ident" id="6010788">LOG_DEBUG</span>&nbsp;<span class="op" id="6010798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010802">return</span>&nbsp;<span class="ident" id="6010809">nil</span><span class="op" id="6010812">,</span>&nbsp;<span class="ident" id="6010814">errors</span><span class="op" id="6010820">.</span><span class="ident" id="6010821">New</span><span class="op" id="6010824">(</span><span class="string" id="6010825">&#34;log/syslog:&nbsp;invalid&nbsp;priority&#34;</span><span class="op" id="6010855">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010862">if</span>&nbsp;<span class="ident" id="6010865">tag</span>&nbsp;<span class="op" id="6010869">==</span>&nbsp;<span class="string" id="6010872">&#34;&#34;</span>&nbsp;<span class="op" id="6010875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010879">tag</span>&nbsp;<span class="op" id="6010883">=</span>&nbsp;<span class="ident" id="6010885">os</span><span class="op" id="6010887">.</span><span class="ident" id="6010888">Args</span><span class="op" id="6010892">[</span><span class="num" id="6010893">0</span><span class="op" id="6010894">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010897">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010900">hostname</span><span class="op" id="6010908">,</span>&nbsp;<span class="ident" id="6010910">_</span>&nbsp;<span class="op" id="6010912">:=</span>&nbsp;<span class="ident" id="6010915">os</span><span class="op" id="6010917">.</span><span class="ident" id="6010918">Hostname</span><span class="op" id="6010926">(</span><span class="op" id="6010927">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010931">w</span>&nbsp;<span class="op" id="6010933">:=</span>&nbsp;<span class="op" id="6010936">&amp;</span><span class="ident" id="6010937">Writer</span><span class="op" id="6010943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010947">priority</span><span class="op" id="6010955">:</span>&nbsp;<span class="ident" id="6010957">priority</span><span class="op" id="6010965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010969">tag</span><span class="op" id="6010972">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6010979">tag</span><span class="op" id="6010982">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010986">hostname</span><span class="op" id="6010994">:</span>&nbsp;<span class="ident" id="6010996">hostname</span><span class="op" id="6011004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011008">network</span><span class="op" id="6011015">:</span>&nbsp;&nbsp;<span class="ident" id="6011018">network</span><span class="op" id="6011025">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011029">raddr</span><span class="op" id="6011034">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6011039">raddr</span><span class="op" id="6011044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011051">w</span><span class="op" id="6011052">.</span><span class="ident" id="6011053">mu</span><span class="op" id="6011055">.</span><span class="ident" id="6011056">Lock</span><span class="op" id="6011060">(</span><span class="op" id="6011061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011064">defer</span>&nbsp;<span class="ident" id="6011070">w</span><span class="op" id="6011071">.</span><span class="ident" id="6011072">mu</span><span class="op" id="6011074">.</span><span class="ident" id="6011075">Unlock</span><span class="op" id="6011081">(</span><span class="op" id="6011082">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011086">err</span>&nbsp;<span class="op" id="6011090">:=</span>&nbsp;<span class="ident" id="6011093">w</span><span class="op" id="6011094">.</span><span class="ident" id="6011095">connect</span><span class="op" id="6011102">(</span><span class="op" id="6011103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011106">if</span>&nbsp;<span class="ident" id="6011109">err</span>&nbsp;<span class="op" id="6011113">!=</span>&nbsp;<span class="ident" id="6011116">nil</span>&nbsp;<span class="op" id="6011120">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011124">return</span>&nbsp;<span class="ident" id="6011131">nil</span><span class="op" id="6011134">,</span>&nbsp;<span class="ident" id="6011136">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011144">return</span>&nbsp;<span class="ident" id="6011151">w</span><span class="op" id="6011152">,</span>&nbsp;<span class="ident" id="6011154">err</span><br>
<span class="lineno"></span><span class="op" id="6011158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="6011161">//&nbsp;connect&nbsp;makes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6011213">//&nbsp;It&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;w.mu&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="6011250">func</span>&nbsp;<span class="op" id="6011255">(</span><span class="ident" id="6011256">w</span>&nbsp;<span class="op" id="6011258">*</span><span class="ident" id="6011259">Writer</span><span class="op" id="6011265">)</span>&nbsp;<span class="ident" id="6011267">connect</span><span class="op" id="6011274">(</span><span class="op" id="6011275">)</span>&nbsp;<span class="op" id="6011277">(</span><span class="ident" id="6011278">err</span>&nbsp;<span class="builtintype" id="6011282">error</span><span class="op" id="6011287">)</span>&nbsp;<span class="op" id="6011289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011292">if</span>&nbsp;<span class="ident" id="6011295">w</span><span class="op" id="6011296">.</span><span class="ident" id="6011297">conn</span>&nbsp;<span class="op" id="6011302">!=</span>&nbsp;<span class="ident" id="6011305">nil</span>&nbsp;<span class="op" id="6011309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011313">//&nbsp;ignore&nbsp;err&nbsp;from&nbsp;close,&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;continue&nbsp;anyway</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011375">w</span><span class="op" id="6011376">.</span><span class="ident" id="6011377">conn</span><span class="op" id="6011381">.</span><span class="builtinfunc" id="6011382">close</span><span class="op" id="6011387">(</span><span class="op" id="6011388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011392">w</span><span class="op" id="6011393">.</span><span class="ident" id="6011394">conn</span>&nbsp;<span class="op" id="6011399">=</span>&nbsp;<span class="ident" id="6011401">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011410">if</span>&nbsp;<span class="ident" id="6011413">w</span><span class="op" id="6011414">.</span><span class="ident" id="6011415">network</span>&nbsp;<span class="op" id="6011423">==</span>&nbsp;<span class="string" id="6011426">&#34;&#34;</span>&nbsp;<span class="op" id="6011429">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011433">w</span><span class="op" id="6011434">.</span><span class="ident" id="6011435">conn</span><span class="op" id="6011439">,</span>&nbsp;<span class="ident" id="6011441">err</span>&nbsp;<span class="op" id="6011445">=</span>&nbsp;<span class="ident" id="6011447">unixSyslog</span><span class="op" id="6011457">(</span><span class="op" id="6011458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011462">if</span>&nbsp;<span class="ident" id="6011465">w</span><span class="op" id="6011466">.</span><span class="ident" id="6011467">hostname</span>&nbsp;<span class="op" id="6011476">==</span>&nbsp;<span class="string" id="6011479">&#34;&#34;</span>&nbsp;<span class="op" id="6011482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011487">w</span><span class="op" id="6011488">.</span><span class="ident" id="6011489">hostname</span>&nbsp;<span class="op" id="6011498">=</span>&nbsp;<span class="string" id="6011500">&#34;localhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011517">}</span>&nbsp;<span class="keyword" id="6011519">else</span>&nbsp;<span class="op" id="6011524">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011528">var</span>&nbsp;<span class="ident" id="6011532">c</span>&nbsp;<span class="ident" id="6011534">net</span><span class="op" id="6011537">.</span><span class="ident" id="6011538">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011545">c</span><span class="op" id="6011546">,</span>&nbsp;<span class="ident" id="6011548">err</span>&nbsp;<span class="op" id="6011552">=</span>&nbsp;<span class="ident" id="6011554">net</span><span class="op" id="6011557">.</span><span class="ident" id="6011558">Dial</span><span class="op" id="6011562">(</span><span class="ident" id="6011563">w</span><span class="op" id="6011564">.</span><span class="ident" id="6011565">network</span><span class="op" id="6011572">,</span>&nbsp;<span class="ident" id="6011574">w</span><span class="op" id="6011575">.</span><span class="ident" id="6011576">raddr</span><span class="op" id="6011581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011585">if</span>&nbsp;<span class="ident" id="6011588">err</span>&nbsp;<span class="op" id="6011592">==</span>&nbsp;<span class="ident" id="6011595">nil</span>&nbsp;<span class="op" id="6011599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011604">w</span><span class="op" id="6011605">.</span><span class="ident" id="6011606">conn</span>&nbsp;<span class="op" id="6011611">=</span>&nbsp;<span class="op" id="6011613">&amp;</span><span class="ident" id="6011614">netConn</span><span class="op" id="6011621">{</span><span class="ident" id="6011622">conn</span><span class="op" id="6011626">:</span>&nbsp;<span class="ident" id="6011628">c</span><span class="op" id="6011629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011634">if</span>&nbsp;<span class="ident" id="6011637">w</span><span class="op" id="6011638">.</span><span class="ident" id="6011639">hostname</span>&nbsp;<span class="op" id="6011648">==</span>&nbsp;<span class="string" id="6011651">&#34;&#34;</span>&nbsp;<span class="op" id="6011654">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011660">w</span><span class="op" id="6011661">.</span><span class="ident" id="6011662">hostname</span>&nbsp;<span class="op" id="6011671">=</span>&nbsp;<span class="ident" id="6011673">c</span><span class="op" id="6011674">.</span><span class="ident" id="6011675">LocalAddr</span><span class="op" id="6011684">(</span><span class="op" id="6011685">)</span><span class="op" id="6011686">.</span><span class="ident" id="6011687">String</span><span class="op" id="6011693">(</span><span class="op" id="6011694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011709">return</span><br>
<span class="lineno">175</span><span class="op" id="6011716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6011719">//&nbsp;Write&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6011770">func</span>&nbsp;<span class="op" id="6011775">(</span><span class="ident" id="6011776">w</span>&nbsp;<span class="op" id="6011778">*</span><span class="ident" id="6011779">Writer</span><span class="op" id="6011785">)</span>&nbsp;<span class="ident" id="6011787">Write</span><span class="op" id="6011792">(</span><span class="ident" id="6011793">b</span>&nbsp;<span class="op" id="6011795">[</span><span class="op" id="6011796">]</span><span class="builtintype" id="6011797">byte</span><span class="op" id="6011801">)</span>&nbsp;<span class="op" id="6011803">(</span><span class="builtintype" id="6011804">int</span><span class="op" id="6011807">,</span>&nbsp;<span class="builtintype" id="6011809">error</span><span class="op" id="6011814">)</span>&nbsp;<span class="op" id="6011816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011819">return</span>&nbsp;<span class="ident" id="6011826">w</span><span class="op" id="6011827">.</span><span class="ident" id="6011828">writeAndRetry</span><span class="op" id="6011841">(</span><span class="ident" id="6011842">w</span><span class="op" id="6011843">.</span><span class="ident" id="6011844">priority</span><span class="op" id="6011852">,</span>&nbsp;<span class="builtintype" id="6011854">string</span><span class="op" id="6011860">(</span><span class="ident" id="6011861">b</span><span class="op" id="6011862">)</span><span class="op" id="6011863">)</span><br>
<span class="lineno">180</span><span class="op" id="6011865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6011868">//&nbsp;Close&nbsp;closes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="6011919">func</span>&nbsp;<span class="op" id="6011924">(</span><span class="ident" id="6011925">w</span>&nbsp;<span class="op" id="6011927">*</span><span class="ident" id="6011928">Writer</span><span class="op" id="6011934">)</span>&nbsp;<span class="ident" id="6011936">Close</span><span class="op" id="6011941">(</span><span class="op" id="6011942">)</span>&nbsp;<span class="builtintype" id="6011944">error</span>&nbsp;<span class="op" id="6011950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011953">w</span><span class="op" id="6011954">.</span><span class="ident" id="6011955">mu</span><span class="op" id="6011957">.</span><span class="ident" id="6011958">Lock</span><span class="op" id="6011962">(</span><span class="op" id="6011963">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011966">defer</span>&nbsp;<span class="ident" id="6011972">w</span><span class="op" id="6011973">.</span><span class="ident" id="6011974">mu</span><span class="op" id="6011976">.</span><span class="ident" id="6011977">Unlock</span><span class="op" id="6011983">(</span><span class="op" id="6011984">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011988">if</span>&nbsp;<span class="ident" id="6011991">w</span><span class="op" id="6011992">.</span><span class="ident" id="6011993">conn</span>&nbsp;<span class="op" id="6011998">!=</span>&nbsp;<span class="ident" id="6012001">nil</span>&nbsp;<span class="op" id="6012005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012009">err</span>&nbsp;<span class="op" id="6012013">:=</span>&nbsp;<span class="ident" id="6012016">w</span><span class="op" id="6012017">.</span><span class="ident" id="6012018">conn</span><span class="op" id="6012022">.</span><span class="builtinfunc" id="6012023">close</span><span class="op" id="6012028">(</span><span class="op" id="6012029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012033">w</span><span class="op" id="6012034">.</span><span class="ident" id="6012035">conn</span>&nbsp;<span class="op" id="6012040">=</span>&nbsp;<span class="ident" id="6012042">nil</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012048">return</span>&nbsp;<span class="ident" id="6012055">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012063">return</span>&nbsp;<span class="ident" id="6012070">nil</span><br>
<span class="lineno"></span><span class="op" id="6012074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="6012077">//&nbsp;Emerg&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_EMERG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6012148">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6012166">func</span>&nbsp;<span class="op" id="6012171">(</span><span class="ident" id="6012172">w</span>&nbsp;<span class="op" id="6012174">*</span><span class="ident" id="6012175">Writer</span><span class="op" id="6012181">)</span>&nbsp;<span class="ident" id="6012183">Emerg</span><span class="op" id="6012188">(</span><span class="ident" id="6012189">m</span>&nbsp;<span class="builtintype" id="6012191">string</span><span class="op" id="6012197">)</span>&nbsp;<span class="op" id="6012199">(</span><span class="ident" id="6012200">err</span>&nbsp;<span class="builtintype" id="6012204">error</span><span class="op" id="6012209">)</span>&nbsp;<span class="op" id="6012211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012214">_</span><span class="op" id="6012215">,</span>&nbsp;<span class="ident" id="6012217">err</span>&nbsp;<span class="op" id="6012221">=</span>&nbsp;<span class="ident" id="6012223">w</span><span class="op" id="6012224">.</span><span class="ident" id="6012225">writeAndRetry</span><span class="op" id="6012238">(</span><span class="ident" id="6012239">LOG_EMERG</span><span class="op" id="6012248">,</span>&nbsp;<span class="ident" id="6012250">m</span><span class="op" id="6012251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012254">return</span>&nbsp;<span class="ident" id="6012261">err</span><br>
<span class="lineno">200</span><span class="op" id="6012265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6012268">//&nbsp;Alert&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ALERT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6012339">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6012357">func</span>&nbsp;<span class="op" id="6012362">(</span><span class="ident" id="6012363">w</span>&nbsp;<span class="op" id="6012365">*</span><span class="ident" id="6012366">Writer</span><span class="op" id="6012372">)</span>&nbsp;<span class="ident" id="6012374">Alert</span><span class="op" id="6012379">(</span><span class="ident" id="6012380">m</span>&nbsp;<span class="builtintype" id="6012382">string</span><span class="op" id="6012388">)</span>&nbsp;<span class="op" id="6012390">(</span><span class="ident" id="6012391">err</span>&nbsp;<span class="builtintype" id="6012395">error</span><span class="op" id="6012400">)</span>&nbsp;<span class="op" id="6012402">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012405">_</span><span class="op" id="6012406">,</span>&nbsp;<span class="ident" id="6012408">err</span>&nbsp;<span class="op" id="6012412">=</span>&nbsp;<span class="ident" id="6012414">w</span><span class="op" id="6012415">.</span><span class="ident" id="6012416">writeAndRetry</span><span class="op" id="6012429">(</span><span class="ident" id="6012430">LOG_ALERT</span><span class="op" id="6012439">,</span>&nbsp;<span class="ident" id="6012441">m</span><span class="op" id="6012442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012445">return</span>&nbsp;<span class="ident" id="6012452">err</span><br>
<span class="lineno"></span><span class="op" id="6012456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6012459">//&nbsp;Crit&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_CRIT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">210</span><span class="comment" id="6012528">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6012546">func</span>&nbsp;<span class="op" id="6012551">(</span><span class="ident" id="6012552">w</span>&nbsp;<span class="op" id="6012554">*</span><span class="ident" id="6012555">Writer</span><span class="op" id="6012561">)</span>&nbsp;<span class="ident" id="6012563">Crit</span><span class="op" id="6012567">(</span><span class="ident" id="6012568">m</span>&nbsp;<span class="builtintype" id="6012570">string</span><span class="op" id="6012576">)</span>&nbsp;<span class="op" id="6012578">(</span><span class="ident" id="6012579">err</span>&nbsp;<span class="builtintype" id="6012583">error</span><span class="op" id="6012588">)</span>&nbsp;<span class="op" id="6012590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012593">_</span><span class="op" id="6012594">,</span>&nbsp;<span class="ident" id="6012596">err</span>&nbsp;<span class="op" id="6012600">=</span>&nbsp;<span class="ident" id="6012602">w</span><span class="op" id="6012603">.</span><span class="ident" id="6012604">writeAndRetry</span><span class="op" id="6012617">(</span><span class="ident" id="6012618">LOG_CRIT</span><span class="op" id="6012626">,</span>&nbsp;<span class="ident" id="6012628">m</span><span class="op" id="6012629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012632">return</span>&nbsp;<span class="ident" id="6012639">err</span><br>
<span class="lineno"></span><span class="op" id="6012643">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="6012646">//&nbsp;Err&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ERR,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6012713">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6012731">func</span>&nbsp;<span class="op" id="6012736">(</span><span class="ident" id="6012737">w</span>&nbsp;<span class="op" id="6012739">*</span><span class="ident" id="6012740">Writer</span><span class="op" id="6012746">)</span>&nbsp;<span class="ident" id="6012748">Err</span><span class="op" id="6012751">(</span><span class="ident" id="6012752">m</span>&nbsp;<span class="builtintype" id="6012754">string</span><span class="op" id="6012760">)</span>&nbsp;<span class="op" id="6012762">(</span><span class="ident" id="6012763">err</span>&nbsp;<span class="builtintype" id="6012767">error</span><span class="op" id="6012772">)</span>&nbsp;<span class="op" id="6012774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012777">_</span><span class="op" id="6012778">,</span>&nbsp;<span class="ident" id="6012780">err</span>&nbsp;<span class="op" id="6012784">=</span>&nbsp;<span class="ident" id="6012786">w</span><span class="op" id="6012787">.</span><span class="ident" id="6012788">writeAndRetry</span><span class="op" id="6012801">(</span><span class="ident" id="6012802">LOG_ERR</span><span class="op" id="6012809">,</span>&nbsp;<span class="ident" id="6012811">m</span><span class="op" id="6012812">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012815">return</span>&nbsp;<span class="ident" id="6012822">err</span><br>
<span class="lineno"></span><span class="op" id="6012826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6012829">//&nbsp;Warning&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_WARNING,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6012895">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno">225</span><span class="keyword" id="6012922">func</span>&nbsp;<span class="op" id="6012927">(</span><span class="ident" id="6012928">w</span>&nbsp;<span class="op" id="6012930">*</span><span class="ident" id="6012931">Writer</span><span class="op" id="6012937">)</span>&nbsp;<span class="ident" id="6012939">Warning</span><span class="op" id="6012946">(</span><span class="ident" id="6012947">m</span>&nbsp;<span class="builtintype" id="6012949">string</span><span class="op" id="6012955">)</span>&nbsp;<span class="op" id="6012957">(</span><span class="ident" id="6012958">err</span>&nbsp;<span class="builtintype" id="6012962">error</span><span class="op" id="6012967">)</span>&nbsp;<span class="op" id="6012969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012972">_</span><span class="op" id="6012973">,</span>&nbsp;<span class="ident" id="6012975">err</span>&nbsp;<span class="op" id="6012979">=</span>&nbsp;<span class="ident" id="6012981">w</span><span class="op" id="6012982">.</span><span class="ident" id="6012983">writeAndRetry</span><span class="op" id="6012996">(</span><span class="ident" id="6012997">LOG_WARNING</span><span class="op" id="6013008">,</span>&nbsp;<span class="ident" id="6013010">m</span><span class="op" id="6013011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013014">return</span>&nbsp;<span class="ident" id="6013021">err</span><br>
<span class="lineno"></span><span class="op" id="6013025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="6013028">//&nbsp;Notice&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_NOTICE,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6013092">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6013119">func</span>&nbsp;<span class="op" id="6013124">(</span><span class="ident" id="6013125">w</span>&nbsp;<span class="op" id="6013127">*</span><span class="ident" id="6013128">Writer</span><span class="op" id="6013134">)</span>&nbsp;<span class="ident" id="6013136">Notice</span><span class="op" id="6013142">(</span><span class="ident" id="6013143">m</span>&nbsp;<span class="builtintype" id="6013145">string</span><span class="op" id="6013151">)</span>&nbsp;<span class="op" id="6013153">(</span><span class="ident" id="6013154">err</span>&nbsp;<span class="builtintype" id="6013158">error</span><span class="op" id="6013163">)</span>&nbsp;<span class="op" id="6013165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013168">_</span><span class="op" id="6013169">,</span>&nbsp;<span class="ident" id="6013171">err</span>&nbsp;<span class="op" id="6013175">=</span>&nbsp;<span class="ident" id="6013177">w</span><span class="op" id="6013178">.</span><span class="ident" id="6013179">writeAndRetry</span><span class="op" id="6013192">(</span><span class="ident" id="6013193">LOG_NOTICE</span><span class="op" id="6013203">,</span>&nbsp;<span class="ident" id="6013205">m</span><span class="op" id="6013206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013209">return</span>&nbsp;<span class="ident" id="6013216">err</span><br>
<span class="lineno">235</span><span class="op" id="6013220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6013223">//&nbsp;Info&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_INFO,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="6013292">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6013310">func</span>&nbsp;<span class="op" id="6013315">(</span><span class="ident" id="6013316">w</span>&nbsp;<span class="op" id="6013318">*</span><span class="ident" id="6013319">Writer</span><span class="op" id="6013325">)</span>&nbsp;<span class="ident" id="6013327">Info</span><span class="op" id="6013331">(</span><span class="ident" id="6013332">m</span>&nbsp;<span class="builtintype" id="6013334">string</span><span class="op" id="6013340">)</span>&nbsp;<span class="op" id="6013342">(</span><span class="ident" id="6013343">err</span>&nbsp;<span class="builtintype" id="6013347">error</span><span class="op" id="6013352">)</span>&nbsp;<span class="op" id="6013354">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013357">_</span><span class="op" id="6013358">,</span>&nbsp;<span class="ident" id="6013360">err</span>&nbsp;<span class="op" id="6013364">=</span>&nbsp;<span class="ident" id="6013366">w</span><span class="op" id="6013367">.</span><span class="ident" id="6013368">writeAndRetry</span><span class="op" id="6013381">(</span><span class="ident" id="6013382">LOG_INFO</span><span class="op" id="6013390">,</span>&nbsp;<span class="ident" id="6013392">m</span><span class="op" id="6013393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013396">return</span>&nbsp;<span class="ident" id="6013403">err</span><br>
<span class="lineno"></span><span class="op" id="6013407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6013410">//&nbsp;Debug&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_DEBUG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">245</span><span class="comment" id="6013481">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="6013499">func</span>&nbsp;<span class="op" id="6013504">(</span><span class="ident" id="6013505">w</span>&nbsp;<span class="op" id="6013507">*</span><span class="ident" id="6013508">Writer</span><span class="op" id="6013514">)</span>&nbsp;<span class="ident" id="6013516">Debug</span><span class="op" id="6013521">(</span><span class="ident" id="6013522">m</span>&nbsp;<span class="builtintype" id="6013524">string</span><span class="op" id="6013530">)</span>&nbsp;<span class="op" id="6013532">(</span><span class="ident" id="6013533">err</span>&nbsp;<span class="builtintype" id="6013537">error</span><span class="op" id="6013542">)</span>&nbsp;<span class="op" id="6013544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013547">_</span><span class="op" id="6013548">,</span>&nbsp;<span class="ident" id="6013550">err</span>&nbsp;<span class="op" id="6013554">=</span>&nbsp;<span class="ident" id="6013556">w</span><span class="op" id="6013557">.</span><span class="ident" id="6013558">writeAndRetry</span><span class="op" id="6013571">(</span><span class="ident" id="6013572">LOG_DEBUG</span><span class="op" id="6013581">,</span>&nbsp;<span class="ident" id="6013583">m</span><span class="op" id="6013584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013587">return</span>&nbsp;<span class="ident" id="6013594">err</span><br>
<span class="lineno"></span><span class="op" id="6013598">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6013601">func</span>&nbsp;<span class="op" id="6013606">(</span><span class="ident" id="6013607">w</span>&nbsp;<span class="op" id="6013609">*</span><span class="ident" id="6013610">Writer</span><span class="op" id="6013616">)</span>&nbsp;<span class="ident" id="6013618">writeAndRetry</span><span class="op" id="6013631">(</span><span class="ident" id="6013632">p</span>&nbsp;<span class="ident" id="6013634">Priority</span><span class="op" id="6013642">,</span>&nbsp;<span class="ident" id="6013644">s</span>&nbsp;<span class="builtintype" id="6013646">string</span><span class="op" id="6013652">)</span>&nbsp;<span class="op" id="6013654">(</span><span class="builtintype" id="6013655">int</span><span class="op" id="6013658">,</span>&nbsp;<span class="builtintype" id="6013660">error</span><span class="op" id="6013665">)</span>&nbsp;<span class="op" id="6013667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013670">pr</span>&nbsp;<span class="op" id="6013673">:=</span>&nbsp;<span class="op" id="6013676">(</span><span class="ident" id="6013677">w</span><span class="op" id="6013678">.</span><span class="ident" id="6013679">priority</span>&nbsp;<span class="op" id="6013688">&amp;</span>&nbsp;<span class="ident" id="6013690">facilityMask</span><span class="op" id="6013702">)</span>&nbsp;<span class="op" id="6013704">|</span>&nbsp;<span class="op" id="6013706">(</span><span class="ident" id="6013707">p</span>&nbsp;<span class="op" id="6013709">&amp;</span>&nbsp;<span class="ident" id="6013711">severityMask</span><span class="op" id="6013723">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013727">w</span><span class="op" id="6013728">.</span><span class="ident" id="6013729">mu</span><span class="op" id="6013731">.</span><span class="ident" id="6013732">Lock</span><span class="op" id="6013736">(</span><span class="op" id="6013737">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013740">defer</span>&nbsp;<span class="ident" id="6013746">w</span><span class="op" id="6013747">.</span><span class="ident" id="6013748">mu</span><span class="op" id="6013750">.</span><span class="ident" id="6013751">Unlock</span><span class="op" id="6013757">(</span><span class="op" id="6013758">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013762">if</span>&nbsp;<span class="ident" id="6013765">w</span><span class="op" id="6013766">.</span><span class="ident" id="6013767">conn</span>&nbsp;<span class="op" id="6013772">!=</span>&nbsp;<span class="ident" id="6013775">nil</span>&nbsp;<span class="op" id="6013779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013783">if</span>&nbsp;<span class="ident" id="6013786">n</span><span class="op" id="6013787">,</span>&nbsp;<span class="ident" id="6013789">err</span>&nbsp;<span class="op" id="6013793">:=</span>&nbsp;<span class="ident" id="6013796">w</span><span class="op" id="6013797">.</span><span class="ident" id="6013798">write</span><span class="op" id="6013803">(</span><span class="ident" id="6013804">pr</span><span class="op" id="6013806">,</span>&nbsp;<span class="ident" id="6013808">s</span><span class="op" id="6013809">)</span><span class="op" id="6013810">;</span>&nbsp;<span class="ident" id="6013812">err</span>&nbsp;<span class="op" id="6013816">==</span>&nbsp;<span class="ident" id="6013819">nil</span>&nbsp;<span class="op" id="6013823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013828">return</span>&nbsp;<span class="ident" id="6013835">n</span><span class="op" id="6013836">,</span>&nbsp;<span class="ident" id="6013838">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013850">if</span>&nbsp;<span class="ident" id="6013853">err</span>&nbsp;<span class="op" id="6013857">:=</span>&nbsp;<span class="ident" id="6013860">w</span><span class="op" id="6013861">.</span><span class="ident" id="6013862">connect</span><span class="op" id="6013869">(</span><span class="op" id="6013870">)</span><span class="op" id="6013871">;</span>&nbsp;<span class="ident" id="6013873">err</span>&nbsp;<span class="op" id="6013877">!=</span>&nbsp;<span class="ident" id="6013880">nil</span>&nbsp;<span class="op" id="6013884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013888">return</span>&nbsp;<span class="num" id="6013895">0</span><span class="op" id="6013896">,</span>&nbsp;<span class="ident" id="6013898">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013903">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013906">return</span>&nbsp;<span class="ident" id="6013913">w</span><span class="op" id="6013914">.</span><span class="ident" id="6013915">write</span><span class="op" id="6013920">(</span><span class="ident" id="6013921">pr</span><span class="op" id="6013923">,</span>&nbsp;<span class="ident" id="6013925">s</span><span class="op" id="6013926">)</span><br>
<span class="lineno"></span><span class="op" id="6013928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6013931">//&nbsp;write&nbsp;generates&nbsp;and&nbsp;writes&nbsp;a&nbsp;syslog&nbsp;formatted&nbsp;string.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="6013992">//&nbsp;format&nbsp;is&nbsp;as&nbsp;follows:&nbsp;&lt;PRI&gt;TIMESTAMP&nbsp;HOSTNAME&nbsp;TAG[PID]:&nbsp;MSG</span><br>
<span class="lineno">270</span><span class="keyword" id="6014055">func</span>&nbsp;<span class="op" id="6014060">(</span><span class="ident" id="6014061">w</span>&nbsp;<span class="op" id="6014063">*</span><span class="ident" id="6014064">Writer</span><span class="op" id="6014070">)</span>&nbsp;<span class="ident" id="6014072">write</span><span class="op" id="6014077">(</span><span class="ident" id="6014078">p</span>&nbsp;<span class="ident" id="6014080">Priority</span><span class="op" id="6014088">,</span>&nbsp;<span class="ident" id="6014090">msg</span>&nbsp;<span class="builtintype" id="6014094">string</span><span class="op" id="6014100">)</span>&nbsp;<span class="op" id="6014102">(</span><span class="builtintype" id="6014103">int</span><span class="op" id="6014106">,</span>&nbsp;<span class="builtintype" id="6014108">error</span><span class="op" id="6014113">)</span>&nbsp;<span class="op" id="6014115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014118">//&nbsp;ensure&nbsp;it&nbsp;ends&nbsp;in&nbsp;a&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014145">nl</span>&nbsp;<span class="op" id="6014148">:=</span>&nbsp;<span class="string" id="6014151">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014155">if</span>&nbsp;<span class="op" id="6014158">!</span><span class="ident" id="6014159">strings</span><span class="op" id="6014166">.</span><span class="ident" id="6014167">HasSuffix</span><span class="op" id="6014176">(</span><span class="ident" id="6014177">msg</span><span class="op" id="6014180">,</span>&nbsp;<span class="string" id="6014182">&#34;\n&#34;</span><span class="op" id="6014186">)</span>&nbsp;<span class="op" id="6014188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014192">nl</span>&nbsp;<span class="op" id="6014195">=</span>&nbsp;<span class="string" id="6014197">&#34;\n&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014207">err</span>&nbsp;<span class="op" id="6014211">:=</span>&nbsp;<span class="ident" id="6014214">w</span><span class="op" id="6014215">.</span><span class="ident" id="6014216">conn</span><span class="op" id="6014220">.</span><span class="ident" id="6014221">writeString</span><span class="op" id="6014232">(</span><span class="ident" id="6014233">p</span><span class="op" id="6014234">,</span>&nbsp;<span class="ident" id="6014236">w</span><span class="op" id="6014237">.</span><span class="ident" id="6014238">hostname</span><span class="op" id="6014246">,</span>&nbsp;<span class="ident" id="6014248">w</span><span class="op" id="6014249">.</span><span class="ident" id="6014250">tag</span><span class="op" id="6014253">,</span>&nbsp;<span class="ident" id="6014255">msg</span><span class="op" id="6014258">,</span>&nbsp;<span class="ident" id="6014260">nl</span><span class="op" id="6014262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014265">if</span>&nbsp;<span class="ident" id="6014268">err</span>&nbsp;<span class="op" id="6014272">!=</span>&nbsp;<span class="ident" id="6014275">nil</span>&nbsp;<span class="op" id="6014279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014283">return</span>&nbsp;<span class="num" id="6014290">0</span><span class="op" id="6014291">,</span>&nbsp;<span class="ident" id="6014293">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014301">//&nbsp;Note:&nbsp;return&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input,&nbsp;not&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014361">//&nbsp;bytes&nbsp;printed&nbsp;by&nbsp;Fprintf,&nbsp;because&nbsp;this&nbsp;must&nbsp;behave&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014421">//&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014439">return</span>&nbsp;<span class="builtinfunc" id="6014446">len</span><span class="op" id="6014449">(</span><span class="ident" id="6014450">msg</span><span class="op" id="6014453">)</span><span class="op" id="6014454">,</span>&nbsp;<span class="ident" id="6014456">nil</span><br>
<span class="lineno">285</span><span class="op" id="6014460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6014463">func</span>&nbsp;<span class="op" id="6014468">(</span><span class="ident" id="6014469">n</span>&nbsp;<span class="op" id="6014471">*</span><span class="ident" id="6014472">netConn</span><span class="op" id="6014479">)</span>&nbsp;<span class="ident" id="6014481">writeString</span><span class="op" id="6014492">(</span><span class="ident" id="6014493">p</span>&nbsp;<span class="ident" id="6014495">Priority</span><span class="op" id="6014503">,</span>&nbsp;<span class="ident" id="6014505">hostname</span><span class="op" id="6014513">,</span>&nbsp;<span class="ident" id="6014515">tag</span><span class="op" id="6014518">,</span>&nbsp;<span class="ident" id="6014520">msg</span><span class="op" id="6014523">,</span>&nbsp;<span class="ident" id="6014525">nl</span>&nbsp;<span class="builtintype" id="6014528">string</span><span class="op" id="6014534">)</span>&nbsp;<span class="builtintype" id="6014536">error</span>&nbsp;<span class="op" id="6014542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014545">if</span>&nbsp;<span class="ident" id="6014548">n</span><span class="op" id="6014549">.</span><span class="ident" id="6014550">local</span>&nbsp;<span class="op" id="6014556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014560">//&nbsp;Compared&nbsp;to&nbsp;the&nbsp;network&nbsp;form&nbsp;below,&nbsp;the&nbsp;changes&nbsp;are:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014618">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Use&nbsp;time.Stamp&nbsp;instead&nbsp;of&nbsp;time.RFC3339.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014666">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Drop&nbsp;the&nbsp;hostname&nbsp;field&nbsp;from&nbsp;the&nbsp;Fprintf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014716">timestamp</span>&nbsp;<span class="op" id="6014726">:=</span>&nbsp;<span class="ident" id="6014729">time</span><span class="op" id="6014733">.</span><span class="ident" id="6014734">Now</span><span class="op" id="6014737">(</span><span class="op" id="6014738">)</span><span class="op" id="6014739">.</span><span class="ident" id="6014740">Format</span><span class="op" id="6014746">(</span><span class="ident" id="6014747">time</span><span class="op" id="6014751">.</span><span class="ident" id="6014752">Stamp</span><span class="op" id="6014757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014761">_</span><span class="op" id="6014762">,</span>&nbsp;<span class="ident" id="6014764">err</span>&nbsp;<span class="op" id="6014768">:=</span>&nbsp;<span class="ident" id="6014771">fmt</span><span class="op" id="6014774">.</span><span class="ident" id="6014775">Fprintf</span><span class="op" id="6014782">(</span><span class="ident" id="6014783">n</span><span class="op" id="6014784">.</span><span class="ident" id="6014785">conn</span><span class="op" id="6014789">,</span>&nbsp;<span class="string" id="6014791">&#34;&lt;%d&gt;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6014812">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014817">p</span><span class="op" id="6014818">,</span>&nbsp;<span class="ident" id="6014820">timestamp</span><span class="op" id="6014829">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014834">tag</span><span class="op" id="6014837">,</span>&nbsp;<span class="ident" id="6014839">os</span><span class="op" id="6014841">.</span><span class="ident" id="6014842">Getpid</span><span class="op" id="6014848">(</span><span class="op" id="6014849">)</span><span class="op" id="6014850">,</span>&nbsp;<span class="ident" id="6014852">msg</span><span class="op" id="6014855">,</span>&nbsp;<span class="ident" id="6014857">nl</span><span class="op" id="6014859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014863">return</span>&nbsp;<span class="ident" id="6014870">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014878">timestamp</span>&nbsp;<span class="op" id="6014888">:=</span>&nbsp;<span class="ident" id="6014891">time</span><span class="op" id="6014895">.</span><span class="ident" id="6014896">Now</span><span class="op" id="6014899">(</span><span class="op" id="6014900">)</span><span class="op" id="6014901">.</span><span class="ident" id="6014902">Format</span><span class="op" id="6014908">(</span><span class="ident" id="6014909">time</span><span class="op" id="6014913">.</span><span class="ident" id="6014914">RFC3339</span><span class="op" id="6014921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014924">_</span><span class="op" id="6014925">,</span>&nbsp;<span class="ident" id="6014927">err</span>&nbsp;<span class="op" id="6014931">:=</span>&nbsp;<span class="ident" id="6014934">fmt</span><span class="op" id="6014937">.</span><span class="ident" id="6014938">Fprintf</span><span class="op" id="6014945">(</span><span class="ident" id="6014946">n</span><span class="op" id="6014947">.</span><span class="ident" id="6014948">conn</span><span class="op" id="6014952">,</span>&nbsp;<span class="string" id="6014954">&#34;&lt;%d&gt;%s&nbsp;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="6014978">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014982">p</span><span class="op" id="6014983">,</span>&nbsp;<span class="ident" id="6014985">timestamp</span><span class="op" id="6014994">,</span>&nbsp;<span class="ident" id="6014996">hostname</span><span class="op" id="6015004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015008">tag</span><span class="op" id="6015011">,</span>&nbsp;<span class="ident" id="6015013">os</span><span class="op" id="6015015">.</span><span class="ident" id="6015016">Getpid</span><span class="op" id="6015022">(</span><span class="op" id="6015023">)</span><span class="op" id="6015024">,</span>&nbsp;<span class="ident" id="6015026">msg</span><span class="op" id="6015029">,</span>&nbsp;<span class="ident" id="6015031">nl</span><span class="op" id="6015033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015036">return</span>&nbsp;<span class="ident" id="6015043">err</span><br>
<span class="lineno"></span><span class="op" id="6015047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="6015050">func</span>&nbsp;<span class="op" id="6015055">(</span><span class="ident" id="6015056">n</span>&nbsp;<span class="op" id="6015058">*</span><span class="ident" id="6015059">netConn</span><span class="op" id="6015066">)</span>&nbsp;<span class="builtinfunc" id="6015068">close</span><span class="op" id="6015073">(</span><span class="op" id="6015074">)</span>&nbsp;<span class="builtintype" id="6015076">error</span>&nbsp;<span class="op" id="6015082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015085">return</span>&nbsp;<span class="ident" id="6015092">n</span><span class="op" id="6015093">.</span><span class="ident" id="6015094">conn</span><span class="op" id="6015098">.</span><span class="ident" id="6015099">Close</span><span class="op" id="6015104">(</span><span class="op" id="6015105">)</span><br>
<span class="lineno"></span><span class="op" id="6015107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6015110">//&nbsp;NewLogger&nbsp;creates&nbsp;a&nbsp;log.Logger&nbsp;whose&nbsp;output&nbsp;is&nbsp;written&nbsp;to</span><br>
<span class="lineno">310</span><span class="comment" id="6015171">//&nbsp;the&nbsp;system&nbsp;log&nbsp;service&nbsp;with&nbsp;the&nbsp;specified&nbsp;priority.&nbsp;The&nbsp;logFlag</span><br>
<span class="lineno"></span><span class="comment" id="6015238">//&nbsp;argument&nbsp;is&nbsp;the&nbsp;flag&nbsp;set&nbsp;passed&nbsp;through&nbsp;to&nbsp;log.New&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="6015302">//&nbsp;the&nbsp;Logger.</span><br>
<span class="lineno"></span><span class="keyword" id="6015317">func</span>&nbsp;<span class="ident" id="6015322">NewLogger</span><span class="op" id="6015331">(</span><span class="ident" id="6015332">p</span>&nbsp;<span class="ident" id="6015334">Priority</span><span class="op" id="6015342">,</span>&nbsp;<span class="ident" id="6015344">logFlag</span>&nbsp;<span class="builtintype" id="6015352">int</span><span class="op" id="6015355">)</span>&nbsp;<span class="op" id="6015357">(</span><span class="op" id="6015358">*</span><span class="ident" id="6015359">log</span><span class="op" id="6015362">.</span><span class="ident" id="6015363">Logger</span><span class="op" id="6015369">,</span>&nbsp;<span class="builtintype" id="6015371">error</span><span class="op" id="6015376">)</span>&nbsp;<span class="op" id="6015378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015381">s</span><span class="op" id="6015382">,</span>&nbsp;<span class="ident" id="6015384">err</span>&nbsp;<span class="op" id="6015388">:=</span>&nbsp;<span class="ident" id="6015391">New</span><span class="op" id="6015394">(</span><span class="ident" id="6015395">p</span><span class="op" id="6015396">,</span>&nbsp;<span class="string" id="6015398">&#34;&#34;</span><span class="op" id="6015400">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015403">if</span>&nbsp;<span class="ident" id="6015406">err</span>&nbsp;<span class="op" id="6015410">!=</span>&nbsp;<span class="ident" id="6015413">nil</span>&nbsp;<span class="op" id="6015417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015421">return</span>&nbsp;<span class="ident" id="6015428">nil</span><span class="op" id="6015431">,</span>&nbsp;<span class="ident" id="6015433">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015441">return</span>&nbsp;<span class="ident" id="6015448">log</span><span class="op" id="6015451">.</span><span class="ident" id="6015452">New</span><span class="op" id="6015455">(</span><span class="ident" id="6015456">s</span><span class="op" id="6015457">,</span>&nbsp;<span class="string" id="6015459">&#34;&#34;</span><span class="op" id="6015461">,</span>&nbsp;<span class="ident" id="6015463">logFlag</span><span class="op" id="6015470">)</span><span class="op" id="6015471">,</span>&nbsp;<span class="ident" id="6015473">nil</span><br>
<span class="lineno"></span><span class="op" id="6015477">}</span>
</div>
</body>
</html>
