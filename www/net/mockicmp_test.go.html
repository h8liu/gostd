<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7921091">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7921147">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7921201">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7921252">package</span>&nbsp;<span class="ident" id="7921260">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7921265">import</span>&nbsp;<span class="string" id="7921272">&#34;errors&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7921282">const</span>&nbsp;<span class="op" id="7921288">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921291">icmpv4EchoRequest</span>&nbsp;<span class="op" id="7921309">=</span>&nbsp;<span class="num" id="7921311">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921314">icmpv4EchoReply</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7921332">=</span>&nbsp;<span class="num" id="7921334">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921337">icmpv6EchoRequest</span>&nbsp;<span class="op" id="7921355">=</span>&nbsp;<span class="num" id="7921357">128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921362">icmpv6EchoReply</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7921380">=</span>&nbsp;<span class="num" id="7921382">129</span><br>
<span class="lineno"></span><span class="op" id="7921386">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7921389">//&nbsp;icmpMessage&nbsp;represents&nbsp;an&nbsp;ICMP&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="7921432">type</span>&nbsp;<span class="ident" id="7921437">icmpMessage</span>&nbsp;<span class="keyword" id="7921449">struct</span>&nbsp;<span class="op" id="7921456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921459">Type</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7921468">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7921484">//&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921493">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7921502">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7921518">//&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921527">Checksum</span>&nbsp;<span class="builtintype" id="7921536">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7921552">//&nbsp;checksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921565">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7921574"><a href="/net/mockicmp_test.go.html#7921658">icmpMessageBody</a></span>&nbsp;<span class="comment" id="7921590">//&nbsp;body</span><br>
<span class="lineno"></span><span class="op" id="7921598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7921601">//&nbsp;icmpMessageBody&nbsp;represents&nbsp;an&nbsp;ICMP&nbsp;message&nbsp;body.</span><br>
<span class="lineno">25</span><span class="keyword" id="7921653">type</span>&nbsp;<span class="ident" id="7921658">icmpMessageBody</span>&nbsp;<span class="keyword" id="7921674">interface</span>&nbsp;<span class="op" id="7921684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921687">Len</span><span class="op" id="7921690">(</span><span class="op" id="7921691">)</span>&nbsp;<span class="builtintype" id="7921693">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921698">Marshal</span><span class="op" id="7921705">(</span><span class="op" id="7921706">)</span>&nbsp;<span class="op" id="7921708">(</span><span class="op" id="7921709">[</span><span class="op" id="7921710">]</span><span class="builtintype" id="7921711">byte</span><span class="op" id="7921715">,</span>&nbsp;<span class="builtintype" id="7921717">error</span><span class="op" id="7921722">)</span><br>
<span class="lineno"></span><span class="op" id="7921724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="7921727">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;binary&nbsp;enconding&nbsp;of&nbsp;the&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="7921795">//&nbsp;reply&nbsp;message&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="7921815">func</span>&nbsp;<span class="op" id="7921820">(</span><span class="ident" id="7921821">m</span>&nbsp;<span class="op" id="7921823">*</span><span class="ident" id="7921824"><a href="/net/mockicmp_test.go.html#7921437">icmpMessage</a></span><span class="op" id="7921835">)</span>&nbsp;<span class="ident" id="7921837">Marshal</span><span class="op" id="7921844">(</span><span class="op" id="7921845">)</span>&nbsp;<span class="op" id="7921847">(</span><span class="op" id="7921848">[</span><span class="op" id="7921849">]</span><span class="builtintype" id="7921850">byte</span><span class="op" id="7921854">,</span>&nbsp;<span class="builtintype" id="7921856">error</span><span class="op" id="7921861">)</span>&nbsp;<span class="op" id="7921863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921866">b</span>&nbsp;<span class="op" id="7921868">:=</span>&nbsp;<span class="op" id="7921871">[</span><span class="op" id="7921872">]</span><span class="builtintype" id="7921873">byte</span><span class="op" id="7921877">{</span><span class="builtintype" id="7921878">byte</span><span class="op" id="7921882">(</span><span class="ident" id="7921883"><a href="/net/mockicmp_test.go.html#7921821">m</a></span><span class="op" id="7921884">.</span><span class="ident" id="7921885">Type</span><span class="op" id="7921889">)</span><span class="op" id="7921890">,</span>&nbsp;<span class="builtintype" id="7921892">byte</span><span class="op" id="7921896">(</span><span class="ident" id="7921897"><a href="/net/mockicmp_test.go.html#7921821">m</a></span><span class="op" id="7921898">.</span><span class="ident" id="7921899">Code</span><span class="op" id="7921903">)</span><span class="op" id="7921904">,</span>&nbsp;<span class="num" id="7921906">0</span><span class="op" id="7921907">,</span>&nbsp;<span class="num" id="7921909">0</span><span class="op" id="7921910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921913">if</span>&nbsp;<span class="ident" id="7921916"><a href="/net/mockicmp_test.go.html#7921821">m</a></span><span class="op" id="7921917">.</span><span class="ident" id="7921918">Body</span>&nbsp;<span class="op" id="7921923">!=</span>&nbsp;<span class="ident" id="7921926">nil</span>&nbsp;<span class="op" id="7921930">&amp;&amp;</span>&nbsp;<span class="ident" id="7921933"><a href="/net/mockicmp_test.go.html#7921821">m</a></span><span class="op" id="7921934">.</span><span class="ident" id="7921935">Body</span><span class="op" id="7921939">.</span><span class="ident" id="7921940">Len</span><span class="op" id="7921943">(</span><span class="op" id="7921944">)</span>&nbsp;<span class="op" id="7921946">!=</span>&nbsp;<span class="num" id="7921949">0</span>&nbsp;<span class="op" id="7921951">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7921955">mb</span><span class="op" id="7921957">,</span>&nbsp;<span class="ident" id="7921959">err</span>&nbsp;<span class="op" id="7921963">:=</span>&nbsp;<span class="ident" id="7921966"><a href="/net/mockicmp_test.go.html#7921821">m</a></span><span class="op" id="7921967">.</span><span class="ident" id="7921968">Body</span><span class="op" id="7921972">.</span><span class="ident" id="7921973">Marshal</span><span class="op" id="7921980">(</span><span class="op" id="7921981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7921985">if</span>&nbsp;<span class="ident" id="7921988"><a href="/net/mockicmp_test.go.html#7921959">err</a></span>&nbsp;<span class="op" id="7921992">!=</span>&nbsp;<span class="ident" id="7921995">nil</span>&nbsp;<span class="op" id="7921999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922004">return</span>&nbsp;<span class="ident" id="7922011">nil</span><span class="op" id="7922014">,</span>&nbsp;<span class="ident" id="7922016"><a href="/net/mockicmp_test.go.html#7921959">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922026"><a href="/net/mockicmp_test.go.html#7921866">b</a></span>&nbsp;<span class="op" id="7922028">=</span>&nbsp;<span class="builtinfunc" id="7922030">append</span><span class="op" id="7922036">(</span><span class="ident" id="7922037"><a href="/net/mockicmp_test.go.html#7921866">b</a></span><span class="op" id="7922038">,</span>&nbsp;<span class="ident" id="7922040"><a href="/net/mockicmp_test.go.html#7921955">mb</a></span><span class="op" id="7922042">...</span><span class="op" id="7922045">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922051">switch</span>&nbsp;<span class="ident" id="7922058"><a href="/net/mockicmp_test.go.html#7921821">m</a></span><span class="op" id="7922059">.</span><span class="ident" id="7922060">Type</span>&nbsp;<span class="op" id="7922065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922068">case</span>&nbsp;<span class="ident" id="7922073"><a href="/net/mockicmp_test.go.html#7921337">icmpv6EchoRequest</a></span><span class="op" id="7922090">,</span>&nbsp;<span class="ident" id="7922092"><a href="/net/mockicmp_test.go.html#7921362">icmpv6EchoReply</a></span><span class="op" id="7922107">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922111">return</span>&nbsp;<span class="ident" id="7922118"><a href="/net/mockicmp_test.go.html#7921866">b</a></span><span class="op" id="7922119">,</span>&nbsp;<span class="ident" id="7922121">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922126">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922129">csumcv</span>&nbsp;<span class="op" id="7922136">:=</span>&nbsp;<span class="builtinfunc" id="7922139">len</span><span class="op" id="7922142">(</span><span class="ident" id="7922143"><a href="/net/mockicmp_test.go.html#7921866">b</a></span><span class="op" id="7922144">)</span>&nbsp;<span class="op" id="7922146">-</span>&nbsp;<span class="num" id="7922148">1</span>&nbsp;<span class="comment" id="7922150">//&nbsp;checksum&nbsp;coverage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922172">s</span>&nbsp;<span class="op" id="7922174">:=</span>&nbsp;<span class="builtintype" id="7922177">uint32</span><span class="op" id="7922183">(</span><span class="num" id="7922184">0</span><span class="op" id="7922185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922188">for</span>&nbsp;<span class="ident" id="7922192">i</span>&nbsp;<span class="op" id="7922194">:=</span>&nbsp;<span class="num" id="7922197">0</span><span class="op" id="7922198">;</span>&nbsp;<span class="ident" id="7922200"><a href="/net/mockicmp_test.go.html#7922192">i</a></span>&nbsp;<span class="op" id="7922202">&lt;</span>&nbsp;<span class="ident" id="7922204"><a href="/net/mockicmp_test.go.html#7922129">csumcv</a></span><span class="op" id="7922210">;</span>&nbsp;<span class="ident" id="7922212"><a href="/net/mockicmp_test.go.html#7922192">i</a></span>&nbsp;<span class="op" id="7922214">+=</span>&nbsp;<span class="num" id="7922217">2</span>&nbsp;<span class="op" id="7922219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922223"><a href="/net/mockicmp_test.go.html#7922172">s</a></span>&nbsp;<span class="op" id="7922225">+=</span>&nbsp;<span class="builtintype" id="7922228">uint32</span><span class="op" id="7922234">(</span><span class="ident" id="7922235"><a href="/net/mockicmp_test.go.html#7921866">b</a></span><span class="op" id="7922236">[</span><span class="ident" id="7922237"><a href="/net/mockicmp_test.go.html#7922192">i</a></span><span class="op" id="7922238">+</span><span class="num" id="7922239">1</span><span class="op" id="7922240">]</span><span class="op" id="7922241">)</span><span class="op" id="7922242">&lt;&lt;</span><span class="num" id="7922244">8</span>&nbsp;<span class="op" id="7922246">|</span>&nbsp;<span class="builtintype" id="7922248">uint32</span><span class="op" id="7922254">(</span><span class="ident" id="7922255"><a href="/net/mockicmp_test.go.html#7921866">b</a></span><span class="op" id="7922256">[</span><span class="ident" id="7922257"><a href="/net/mockicmp_test.go.html#7922192">i</a></span><span class="op" id="7922258">]</span><span class="op" id="7922259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922262">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922265">if</span>&nbsp;<span class="ident" id="7922268"><a href="/net/mockicmp_test.go.html#7922129">csumcv</a></span><span class="op" id="7922274">&amp;</span><span class="num" id="7922275">1</span>&nbsp;<span class="op" id="7922277">==</span>&nbsp;<span class="num" id="7922280">0</span>&nbsp;<span class="op" id="7922282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922286"><a href="/net/mockicmp_test.go.html#7922172">s</a></span>&nbsp;<span class="op" id="7922288">+=</span>&nbsp;<span class="builtintype" id="7922291">uint32</span><span class="op" id="7922297">(</span><span class="ident" id="7922298"><a href="/net/mockicmp_test.go.html#7921866">b</a></span><span class="op" id="7922299">[</span><span class="ident" id="7922300"><a href="/net/mockicmp_test.go.html#7922129">csumcv</a></span><span class="op" id="7922306">]</span><span class="op" id="7922307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922313"><a href="/net/mockicmp_test.go.html#7922172">s</a></span>&nbsp;<span class="op" id="7922315">=</span>&nbsp;<span class="ident" id="7922317"><a href="/net/mockicmp_test.go.html#7922172">s</a></span><span class="op" id="7922318">&gt;&gt;</span><span class="num" id="7922320">16</span>&nbsp;<span class="op" id="7922323">+</span>&nbsp;<span class="ident" id="7922325"><a href="/net/mockicmp_test.go.html#7922172">s</a></span><span class="op" id="7922326">&amp;</span><span class="num" id="7922327">0xffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922335"><a href="/net/mockicmp_test.go.html#7922172">s</a></span>&nbsp;<span class="op" id="7922337">=</span>&nbsp;<span class="ident" id="7922339"><a href="/net/mockicmp_test.go.html#7922172">s</a></span>&nbsp;<span class="op" id="7922341">+</span>&nbsp;<span class="ident" id="7922343"><a href="/net/mockicmp_test.go.html#7922172">s</a></span><span class="op" id="7922344">&gt;&gt;</span><span class="num" id="7922346">16</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7922350">//&nbsp;Place&nbsp;checksum&nbsp;back&nbsp;in&nbsp;header;&nbsp;using&nbsp;^=&nbsp;avoids&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7922405">//&nbsp;assumption&nbsp;the&nbsp;checksum&nbsp;bytes&nbsp;are&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922449"><a href="/net/mockicmp_test.go.html#7921866">b</a></span><span class="op" id="7922450">[</span><span class="num" id="7922451">2</span><span class="op" id="7922452">]</span>&nbsp;<span class="op" id="7922454">^=</span>&nbsp;<span class="builtintype" id="7922457">byte</span><span class="op" id="7922461">(</span><span class="op" id="7922462">^</span><span class="ident" id="7922463"><a href="/net/mockicmp_test.go.html#7922172">s</a></span><span class="op" id="7922464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922467"><a href="/net/mockicmp_test.go.html#7921866">b</a></span><span class="op" id="7922468">[</span><span class="num" id="7922469">3</span><span class="op" id="7922470">]</span>&nbsp;<span class="op" id="7922472">^=</span>&nbsp;<span class="builtintype" id="7922475">byte</span><span class="op" id="7922479">(</span><span class="op" id="7922480">^</span><span class="ident" id="7922481"><a href="/net/mockicmp_test.go.html#7922172">s</a></span>&nbsp;<span class="op" id="7922483">&gt;&gt;</span>&nbsp;<span class="num" id="7922486">8</span><span class="op" id="7922487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922490">return</span>&nbsp;<span class="ident" id="7922497"><a href="/net/mockicmp_test.go.html#7921866">b</a></span><span class="op" id="7922498">,</span>&nbsp;<span class="ident" id="7922500">nil</span><br>
<span class="lineno">60</span><span class="op" id="7922504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7922507">//&nbsp;parseICMPMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;ICMP&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="7922556">func</span>&nbsp;<span class="ident" id="7922561">parseICMPMessage</span><span class="op" id="7922577">(</span><span class="ident" id="7922578">b</span>&nbsp;<span class="op" id="7922580">[</span><span class="op" id="7922581">]</span><span class="builtintype" id="7922582">byte</span><span class="op" id="7922586">)</span>&nbsp;<span class="op" id="7922588">(</span><span class="op" id="7922589">*</span><span class="ident" id="7922590"><a href="/net/mockicmp_test.go.html#7921437">icmpMessage</a></span><span class="op" id="7922601">,</span>&nbsp;<span class="builtintype" id="7922603">error</span><span class="op" id="7922608">)</span>&nbsp;<span class="op" id="7922610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922613">msglen</span>&nbsp;<span class="op" id="7922620">:=</span>&nbsp;<span class="builtinfunc" id="7922623">len</span><span class="op" id="7922626">(</span><span class="ident" id="7922627"><a href="/net/mockicmp_test.go.html#7922578">b</a></span><span class="op" id="7922628">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922631">if</span>&nbsp;<span class="ident" id="7922634"><a href="/net/mockicmp_test.go.html#7922613">msglen</a></span>&nbsp;<span class="op" id="7922641">&lt;</span>&nbsp;<span class="num" id="7922643">4</span>&nbsp;<span class="op" id="7922645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922649">return</span>&nbsp;<span class="ident" id="7922656">nil</span><span class="op" id="7922659">,</span>&nbsp;<span class="ident" id="7922661"><a href="/net/mockicmp_test.go.html#7921272">errors</a></span><span class="op" id="7922667">.</span><span class="ident" id="7922668">New</span><span class="op" id="7922671">(</span><span class="string" id="7922672">&#34;message&nbsp;too&nbsp;short&#34;</span><span class="op" id="7922691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922697">m</span>&nbsp;<span class="op" id="7922699">:=</span>&nbsp;<span class="op" id="7922702">&amp;</span><span class="ident" id="7922703"><a href="/net/mockicmp_test.go.html#7921437">icmpMessage</a></span><span class="op" id="7922714">{</span><span class="ident" id="7922715">Type</span><span class="op" id="7922719">:</span>&nbsp;<span class="builtintype" id="7922721">int</span><span class="op" id="7922724">(</span><span class="ident" id="7922725"><a href="/net/mockicmp_test.go.html#7922578">b</a></span><span class="op" id="7922726">[</span><span class="num" id="7922727">0</span><span class="op" id="7922728">]</span><span class="op" id="7922729">)</span><span class="op" id="7922730">,</span>&nbsp;<span class="ident" id="7922732">Code</span><span class="op" id="7922736">:</span>&nbsp;<span class="builtintype" id="7922738">int</span><span class="op" id="7922741">(</span><span class="ident" id="7922742"><a href="/net/mockicmp_test.go.html#7922578">b</a></span><span class="op" id="7922743">[</span><span class="num" id="7922744">1</span><span class="op" id="7922745">]</span><span class="op" id="7922746">)</span><span class="op" id="7922747">,</span>&nbsp;<span class="ident" id="7922749">Checksum</span><span class="op" id="7922757">:</span>&nbsp;<span class="builtintype" id="7922759">int</span><span class="op" id="7922762">(</span><span class="ident" id="7922763"><a href="/net/mockicmp_test.go.html#7922578">b</a></span><span class="op" id="7922764">[</span><span class="num" id="7922765">2</span><span class="op" id="7922766">]</span><span class="op" id="7922767">)</span><span class="op" id="7922768">&lt;&lt;</span><span class="num" id="7922770">8</span>&nbsp;<span class="op" id="7922772">|</span>&nbsp;<span class="builtintype" id="7922774">int</span><span class="op" id="7922777">(</span><span class="ident" id="7922778"><a href="/net/mockicmp_test.go.html#7922578">b</a></span><span class="op" id="7922779">[</span><span class="num" id="7922780">3</span><span class="op" id="7922781">]</span><span class="op" id="7922782">)</span><span class="op" id="7922783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922786">if</span>&nbsp;<span class="ident" id="7922789"><a href="/net/mockicmp_test.go.html#7922613">msglen</a></span>&nbsp;<span class="op" id="7922796">&gt;</span>&nbsp;<span class="num" id="7922798">4</span>&nbsp;<span class="op" id="7922800">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922804">var</span>&nbsp;<span class="ident" id="7922808">err</span>&nbsp;<span class="builtintype" id="7922812">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922820">switch</span>&nbsp;<span class="ident" id="7922827"><a href="/net/mockicmp_test.go.html#7922697">m</a></span><span class="op" id="7922828">.</span><span class="ident" id="7922829">Type</span>&nbsp;<span class="op" id="7922834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922838">case</span>&nbsp;<span class="ident" id="7922843"><a href="/net/mockicmp_test.go.html#7921291">icmpv4EchoRequest</a></span><span class="op" id="7922860">,</span>&nbsp;<span class="ident" id="7922862"><a href="/net/mockicmp_test.go.html#7921314">icmpv4EchoReply</a></span><span class="op" id="7922877">,</span>&nbsp;<span class="ident" id="7922879"><a href="/net/mockicmp_test.go.html#7921337">icmpv6EchoRequest</a></span><span class="op" id="7922896">,</span>&nbsp;<span class="ident" id="7922898"><a href="/net/mockicmp_test.go.html#7921362">icmpv6EchoReply</a></span><span class="op" id="7922913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7922918"><a href="/net/mockicmp_test.go.html#7922697">m</a></span><span class="op" id="7922919">.</span><span class="ident" id="7922920">Body</span><span class="op" id="7922924">,</span>&nbsp;<span class="ident" id="7922926"><a href="/net/mockicmp_test.go.html#7922808">err</a></span>&nbsp;<span class="op" id="7922930">=</span>&nbsp;<span class="ident" id="7922932"><a href="/net/mockicmp_test.go.html#7923659">parseICMPEcho</a></span><span class="op" id="7922945">(</span><span class="ident" id="7922946"><a href="/net/mockicmp_test.go.html#7922578">b</a></span><span class="op" id="7922947">[</span><span class="num" id="7922948">4</span><span class="op" id="7922949">:</span><span class="op" id="7922950">]</span><span class="op" id="7922951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922956">if</span>&nbsp;<span class="ident" id="7922959"><a href="/net/mockicmp_test.go.html#7922808">err</a></span>&nbsp;<span class="op" id="7922963">!=</span>&nbsp;<span class="ident" id="7922966">nil</span>&nbsp;<span class="op" id="7922970">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7922976">return</span>&nbsp;<span class="ident" id="7922983">nil</span><span class="op" id="7922986">,</span>&nbsp;<span class="ident" id="7922988"><a href="/net/mockicmp_test.go.html#7922808">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7922999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7923002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923005">return</span>&nbsp;<span class="ident" id="7923012"><a href="/net/mockicmp_test.go.html#7922697">m</a></span><span class="op" id="7923013">,</span>&nbsp;<span class="ident" id="7923015">nil</span><br>
<span class="lineno">80</span><span class="op" id="7923019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7923022">//&nbsp;imcpEcho&nbsp;represenets&nbsp;an&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or&nbsp;reply&nbsp;message&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="7923090">type</span>&nbsp;<span class="ident" id="7923095">icmpEcho</span>&nbsp;<span class="keyword" id="7923104">struct</span>&nbsp;<span class="op" id="7923111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923114">ID</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7923119">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7923126">//&nbsp;identifier</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923141">Seq</span>&nbsp;&nbsp;<span class="builtintype" id="7923146">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7923153">//&nbsp;sequence&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923173">Data</span>&nbsp;<span class="op" id="7923178">[</span><span class="op" id="7923179">]</span><span class="builtintype" id="7923180">byte</span>&nbsp;<span class="comment" id="7923185">//&nbsp;data</span><br>
<span class="lineno"></span><span class="op" id="7923193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7923196">func</span>&nbsp;<span class="op" id="7923201">(</span><span class="ident" id="7923202">p</span>&nbsp;<span class="op" id="7923204">*</span><span class="ident" id="7923205"><a href="/net/mockicmp_test.go.html#7923095">icmpEcho</a></span><span class="op" id="7923213">)</span>&nbsp;<span class="ident" id="7923215">Len</span><span class="op" id="7923218">(</span><span class="op" id="7923219">)</span>&nbsp;<span class="builtintype" id="7923221">int</span>&nbsp;<span class="op" id="7923225">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923228">if</span>&nbsp;<span class="ident" id="7923231"><a href="/net/mockicmp_test.go.html#7923202">p</a></span>&nbsp;<span class="op" id="7923233">==</span>&nbsp;<span class="ident" id="7923236">nil</span>&nbsp;<span class="op" id="7923240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923244">return</span>&nbsp;<span class="num" id="7923251">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7923254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923257">return</span>&nbsp;<span class="num" id="7923264">4</span>&nbsp;<span class="op" id="7923266">+</span>&nbsp;<span class="builtinfunc" id="7923268">len</span><span class="op" id="7923271">(</span><span class="ident" id="7923272"><a href="/net/mockicmp_test.go.html#7923202">p</a></span><span class="op" id="7923273">.</span><span class="ident" id="7923274">Data</span><span class="op" id="7923278">)</span><br>
<span class="lineno"></span><span class="op" id="7923280">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="7923283">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;binary&nbsp;enconding&nbsp;of&nbsp;the&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="7923351">//&nbsp;reply&nbsp;message&nbsp;body&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="7923376">func</span>&nbsp;<span class="op" id="7923381">(</span><span class="ident" id="7923382">p</span>&nbsp;<span class="op" id="7923384">*</span><span class="ident" id="7923385"><a href="/net/mockicmp_test.go.html#7923095">icmpEcho</a></span><span class="op" id="7923393">)</span>&nbsp;<span class="ident" id="7923395">Marshal</span><span class="op" id="7923402">(</span><span class="op" id="7923403">)</span>&nbsp;<span class="op" id="7923405">(</span><span class="op" id="7923406">[</span><span class="op" id="7923407">]</span><span class="builtintype" id="7923408">byte</span><span class="op" id="7923412">,</span>&nbsp;<span class="builtintype" id="7923414">error</span><span class="op" id="7923419">)</span>&nbsp;<span class="op" id="7923421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923424">b</span>&nbsp;<span class="op" id="7923426">:=</span>&nbsp;<span class="builtinfunc" id="7923429">make</span><span class="op" id="7923433">(</span><span class="op" id="7923434">[</span><span class="op" id="7923435">]</span><span class="builtintype" id="7923436">byte</span><span class="op" id="7923440">,</span>&nbsp;<span class="num" id="7923442">4</span><span class="op" id="7923443">+</span><span class="builtinfunc" id="7923444">len</span><span class="op" id="7923447">(</span><span class="ident" id="7923448"><a href="/net/mockicmp_test.go.html#7923382">p</a></span><span class="op" id="7923449">.</span><span class="ident" id="7923450">Data</span><span class="op" id="7923454">)</span><span class="op" id="7923455">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923458"><a href="/net/mockicmp_test.go.html#7923424">b</a></span><span class="op" id="7923459">[</span><span class="num" id="7923460">0</span><span class="op" id="7923461">]</span><span class="op" id="7923462">,</span>&nbsp;<span class="ident" id="7923464"><a href="/net/mockicmp_test.go.html#7923424">b</a></span><span class="op" id="7923465">[</span><span class="num" id="7923466">1</span><span class="op" id="7923467">]</span>&nbsp;<span class="op" id="7923469">=</span>&nbsp;<span class="builtintype" id="7923471">byte</span><span class="op" id="7923475">(</span><span class="ident" id="7923476"><a href="/net/mockicmp_test.go.html#7923382">p</a></span><span class="op" id="7923477">.</span><span class="ident" id="7923478">ID</span><span class="op" id="7923480">&gt;&gt;</span><span class="num" id="7923482">8</span><span class="op" id="7923483">)</span><span class="op" id="7923484">,</span>&nbsp;<span class="builtintype" id="7923486">byte</span><span class="op" id="7923490">(</span><span class="ident" id="7923491"><a href="/net/mockicmp_test.go.html#7923382">p</a></span><span class="op" id="7923492">.</span><span class="ident" id="7923493">ID</span><span class="op" id="7923495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923498"><a href="/net/mockicmp_test.go.html#7923424">b</a></span><span class="op" id="7923499">[</span><span class="num" id="7923500">2</span><span class="op" id="7923501">]</span><span class="op" id="7923502">,</span>&nbsp;<span class="ident" id="7923504"><a href="/net/mockicmp_test.go.html#7923424">b</a></span><span class="op" id="7923505">[</span><span class="num" id="7923506">3</span><span class="op" id="7923507">]</span>&nbsp;<span class="op" id="7923509">=</span>&nbsp;<span class="builtintype" id="7923511">byte</span><span class="op" id="7923515">(</span><span class="ident" id="7923516"><a href="/net/mockicmp_test.go.html#7923382">p</a></span><span class="op" id="7923517">.</span><span class="ident" id="7923518">Seq</span><span class="op" id="7923521">&gt;&gt;</span><span class="num" id="7923523">8</span><span class="op" id="7923524">)</span><span class="op" id="7923525">,</span>&nbsp;<span class="builtintype" id="7923527">byte</span><span class="op" id="7923531">(</span><span class="ident" id="7923532"><a href="/net/mockicmp_test.go.html#7923382">p</a></span><span class="op" id="7923533">.</span><span class="ident" id="7923534">Seq</span><span class="op" id="7923537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7923540">copy</span><span class="op" id="7923544">(</span><span class="ident" id="7923545"><a href="/net/mockicmp_test.go.html#7923424">b</a></span><span class="op" id="7923546">[</span><span class="num" id="7923547">4</span><span class="op" id="7923548">:</span><span class="op" id="7923549">]</span><span class="op" id="7923550">,</span>&nbsp;<span class="ident" id="7923552"><a href="/net/mockicmp_test.go.html#7923382">p</a></span><span class="op" id="7923553">.</span><span class="ident" id="7923554">Data</span><span class="op" id="7923558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923561">return</span>&nbsp;<span class="ident" id="7923568"><a href="/net/mockicmp_test.go.html#7923424">b</a></span><span class="op" id="7923569">,</span>&nbsp;<span class="ident" id="7923571">nil</span><br>
<span class="lineno"></span><span class="op" id="7923575">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="7923578">//&nbsp;parseICMPEcho&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or&nbsp;reply&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="7923645">//&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="7923654">func</span>&nbsp;<span class="ident" id="7923659">parseICMPEcho</span><span class="op" id="7923672">(</span><span class="ident" id="7923673">b</span>&nbsp;<span class="op" id="7923675">[</span><span class="op" id="7923676">]</span><span class="builtintype" id="7923677">byte</span><span class="op" id="7923681">)</span>&nbsp;<span class="op" id="7923683">(</span><span class="op" id="7923684">*</span><span class="ident" id="7923685"><a href="/net/mockicmp_test.go.html#7923095">icmpEcho</a></span><span class="op" id="7923693">,</span>&nbsp;<span class="builtintype" id="7923695">error</span><span class="op" id="7923700">)</span>&nbsp;<span class="op" id="7923702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923705">bodylen</span>&nbsp;<span class="op" id="7923713">:=</span>&nbsp;<span class="builtinfunc" id="7923716">len</span><span class="op" id="7923719">(</span><span class="ident" id="7923720"><a href="/net/mockicmp_test.go.html#7923673">b</a></span><span class="op" id="7923721">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923724">p</span>&nbsp;<span class="op" id="7923726">:=</span>&nbsp;<span class="op" id="7923729">&amp;</span><span class="ident" id="7923730"><a href="/net/mockicmp_test.go.html#7923095">icmpEcho</a></span><span class="op" id="7923738">{</span><span class="ident" id="7923739">ID</span><span class="op" id="7923741">:</span>&nbsp;<span class="builtintype" id="7923743">int</span><span class="op" id="7923746">(</span><span class="ident" id="7923747"><a href="/net/mockicmp_test.go.html#7923673">b</a></span><span class="op" id="7923748">[</span><span class="num" id="7923749">0</span><span class="op" id="7923750">]</span><span class="op" id="7923751">)</span><span class="op" id="7923752">&lt;&lt;</span><span class="num" id="7923754">8</span>&nbsp;<span class="op" id="7923756">|</span>&nbsp;<span class="builtintype" id="7923758">int</span><span class="op" id="7923761">(</span><span class="ident" id="7923762"><a href="/net/mockicmp_test.go.html#7923673">b</a></span><span class="op" id="7923763">[</span><span class="num" id="7923764">1</span><span class="op" id="7923765">]</span><span class="op" id="7923766">)</span><span class="op" id="7923767">,</span>&nbsp;<span class="ident" id="7923769">Seq</span><span class="op" id="7923772">:</span>&nbsp;<span class="builtintype" id="7923774">int</span><span class="op" id="7923777">(</span><span class="ident" id="7923778"><a href="/net/mockicmp_test.go.html#7923673">b</a></span><span class="op" id="7923779">[</span><span class="num" id="7923780">2</span><span class="op" id="7923781">]</span><span class="op" id="7923782">)</span><span class="op" id="7923783">&lt;&lt;</span><span class="num" id="7923785">8</span>&nbsp;<span class="op" id="7923787">|</span>&nbsp;<span class="builtintype" id="7923789">int</span><span class="op" id="7923792">(</span><span class="ident" id="7923793"><a href="/net/mockicmp_test.go.html#7923673">b</a></span><span class="op" id="7923794">[</span><span class="num" id="7923795">3</span><span class="op" id="7923796">]</span><span class="op" id="7923797">)</span><span class="op" id="7923798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923801">if</span>&nbsp;<span class="ident" id="7923804"><a href="/net/mockicmp_test.go.html#7923705">bodylen</a></span>&nbsp;<span class="op" id="7923812">&gt;</span>&nbsp;<span class="num" id="7923814">4</span>&nbsp;<span class="op" id="7923816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7923820"><a href="/net/mockicmp_test.go.html#7923724">p</a></span><span class="op" id="7923821">.</span><span class="ident" id="7923822">Data</span>&nbsp;<span class="op" id="7923827">=</span>&nbsp;<span class="builtinfunc" id="7923829">make</span><span class="op" id="7923833">(</span><span class="op" id="7923834">[</span><span class="op" id="7923835">]</span><span class="builtintype" id="7923836">byte</span><span class="op" id="7923840">,</span>&nbsp;<span class="ident" id="7923842"><a href="/net/mockicmp_test.go.html#7923705">bodylen</a></span><span class="op" id="7923849">-</span><span class="num" id="7923850">4</span><span class="op" id="7923851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7923855">copy</span><span class="op" id="7923859">(</span><span class="ident" id="7923860"><a href="/net/mockicmp_test.go.html#7923724">p</a></span><span class="op" id="7923861">.</span><span class="ident" id="7923862">Data</span><span class="op" id="7923866">,</span>&nbsp;<span class="ident" id="7923868"><a href="/net/mockicmp_test.go.html#7923673">b</a></span><span class="op" id="7923869">[</span><span class="num" id="7923870">4</span><span class="op" id="7923871">:</span><span class="op" id="7923872">]</span><span class="op" id="7923873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7923876">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7923879">return</span>&nbsp;<span class="ident" id="7923886"><a href="/net/mockicmp_test.go.html#7923724">p</a></span><span class="op" id="7923887">,</span>&nbsp;<span class="ident" id="7923889">nil</span><br>
<span class="lineno"></span><span class="op" id="7923893">}</span>
</div>
</body>
</html>
