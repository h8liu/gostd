<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html" class="current">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3519901">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3519957">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3520011">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3520062">//&nbsp;Package&nbsp;textproto&nbsp;implements&nbsp;generic&nbsp;support&nbsp;for&nbsp;text-based&nbsp;request/response</span><br>
<span class="lineno"></span><span class="comment" id="3520142">//&nbsp;protocols&nbsp;in&nbsp;the&nbsp;style&nbsp;of&nbsp;HTTP,&nbsp;NNTP,&nbsp;and&nbsp;SMTP.</span><br>
<span class="lineno"></span><span class="comment" id="3520193">//</span><br>
<span class="lineno"></span><span class="comment" id="3520196">//&nbsp;The&nbsp;package&nbsp;provides:</span><br>
<span class="lineno"></span><span class="comment" id="3520221">//</span><br>
<span class="lineno">10</span><span class="comment" id="3520224">//&nbsp;Error,&nbsp;which&nbsp;represents&nbsp;a&nbsp;numeric&nbsp;error&nbsp;response&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3520281">//&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="3520294">//</span><br>
<span class="lineno"></span><span class="comment" id="3520297">//&nbsp;Pipeline,&nbsp;to&nbsp;manage&nbsp;pipelined&nbsp;requests&nbsp;and&nbsp;responses</span><br>
<span class="lineno"></span><span class="comment" id="3520353">//&nbsp;in&nbsp;a&nbsp;client.</span><br>
<span class="lineno">15</span><span class="comment" id="3520369">//</span><br>
<span class="lineno"></span><span class="comment" id="3520372">//&nbsp;Reader,&nbsp;to&nbsp;read&nbsp;numeric&nbsp;response&nbsp;code&nbsp;lines,</span><br>
<span class="lineno"></span><span class="comment" id="3520420">//&nbsp;key:&nbsp;value&nbsp;headers,&nbsp;lines&nbsp;wrapped&nbsp;with&nbsp;leading&nbsp;spaces</span><br>
<span class="lineno"></span><span class="comment" id="3520477">//&nbsp;on&nbsp;continuation&nbsp;lines,&nbsp;and&nbsp;whole&nbsp;text&nbsp;blocks&nbsp;ending</span><br>
<span class="lineno"></span><span class="comment" id="3520532">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;on&nbsp;a&nbsp;line&nbsp;by&nbsp;itself.</span><br>
<span class="lineno">20</span><span class="comment" id="3520567">//</span><br>
<span class="lineno"></span><span class="comment" id="3520570">//&nbsp;Writer,&nbsp;to&nbsp;write&nbsp;dot-encoded&nbsp;text&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="comment" id="3520615">//</span><br>
<span class="lineno"></span><span class="comment" id="3520618">//&nbsp;Conn,&nbsp;a&nbsp;convenient&nbsp;packaging&nbsp;of&nbsp;Reader,&nbsp;Writer,&nbsp;and&nbsp;Pipeline&nbsp;for&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="3520690">//&nbsp;with&nbsp;a&nbsp;single&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">25</span><span class="comment" id="3520727">//</span><br>
<span class="lineno"></span><span class="keyword" id="3520730">package</span>&nbsp;<span class="ident" id="3520738">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3520749">import</span>&nbsp;<span class="op" id="3520756">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3520759">&#34;bufio&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3520768">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3520775">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3520781">&#34;net&#34;</span><br>
<span class="lineno"></span><span class="op" id="3520787">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3520790">//&nbsp;An&nbsp;Error&nbsp;represents&nbsp;a&nbsp;numeric&nbsp;error&nbsp;response&nbsp;from&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="3520853">type</span>&nbsp;<span class="ident" id="3520858">Error</span>&nbsp;<span class="keyword" id="3520864">struct</span>&nbsp;<span class="op" id="3520871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3520874">Code</span>&nbsp;<span class="builtintype" id="3520879">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3520884">Msg</span>&nbsp;&nbsp;<span class="builtintype" id="3520889">string</span><br>
<span class="lineno"></span><span class="op" id="3520896">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3520899">func</span>&nbsp;<span class="op" id="3520904">(</span><span class="ident" id="3520905">e</span>&nbsp;<span class="op" id="3520907">*</span><span class="ident" id="3520908">Error</span><span class="op" id="3520913">)</span>&nbsp;<span class="ident" id="3520915">Error</span><span class="op" id="3520920">(</span><span class="op" id="3520921">)</span>&nbsp;<span class="builtintype" id="3520923">string</span>&nbsp;<span class="op" id="3520930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3520933">return</span>&nbsp;<span class="ident" id="3520940">fmt</span><span class="op" id="3520943">.</span><span class="ident" id="3520944">Sprintf</span><span class="op" id="3520951">(</span><span class="string" id="3520952">&#34;%03d&nbsp;%s&#34;</span><span class="op" id="3520961">,</span>&nbsp;<span class="ident" id="3520963">e</span><span class="op" id="3520964">.</span><span class="ident" id="3520965">Code</span><span class="op" id="3520969">,</span>&nbsp;<span class="ident" id="3520971">e</span><span class="op" id="3520972">.</span><span class="ident" id="3520973">Msg</span><span class="op" id="3520976">)</span><br>
<span class="lineno"></span><span class="op" id="3520978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="3520981">//&nbsp;A&nbsp;ProtocolError&nbsp;describes&nbsp;a&nbsp;protocol&nbsp;violation&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="3521036">//&nbsp;as&nbsp;an&nbsp;invalid&nbsp;response&nbsp;or&nbsp;a&nbsp;hung-up&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3521087">type</span>&nbsp;<span class="ident" id="3521092">ProtocolError</span>&nbsp;<span class="builtintype" id="3521106">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3521114">func</span>&nbsp;<span class="op" id="3521119">(</span><span class="ident" id="3521120">p</span>&nbsp;<span class="ident" id="3521122">ProtocolError</span><span class="op" id="3521135">)</span>&nbsp;<span class="ident" id="3521137">Error</span><span class="op" id="3521142">(</span><span class="op" id="3521143">)</span>&nbsp;<span class="builtintype" id="3521145">string</span>&nbsp;<span class="op" id="3521152">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3521155">return</span>&nbsp;<span class="builtintype" id="3521162">string</span><span class="op" id="3521168">(</span><span class="ident" id="3521169">p</span><span class="op" id="3521170">)</span><br>
<span class="lineno"></span><span class="op" id="3521172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3521175">//&nbsp;A&nbsp;Conn&nbsp;represents&nbsp;a&nbsp;textual&nbsp;network&nbsp;protocol&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3521235">//&nbsp;It&nbsp;consists&nbsp;of&nbsp;a&nbsp;Reader&nbsp;and&nbsp;Writer&nbsp;to&nbsp;manage&nbsp;I/O</span><br>
<span class="lineno">55</span><span class="comment" id="3521287">//&nbsp;and&nbsp;a&nbsp;Pipeline&nbsp;to&nbsp;sequence&nbsp;concurrent&nbsp;requests&nbsp;on&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3521356">//&nbsp;These&nbsp;embedded&nbsp;types&nbsp;carry&nbsp;methods&nbsp;with&nbsp;them;</span><br>
<span class="lineno"></span><span class="comment" id="3521405">//&nbsp;see&nbsp;the&nbsp;documentation&nbsp;of&nbsp;those&nbsp;types&nbsp;for&nbsp;details.</span><br>
<span class="lineno"></span><span class="keyword" id="3521458">type</span>&nbsp;<span class="ident" id="3521463">Conn</span>&nbsp;<span class="keyword" id="3521468">struct</span>&nbsp;<span class="op" id="3521475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3521478">Reader</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3521486">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3521494">Pipeline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3521504">conn</span>&nbsp;<span class="ident" id="3521509">io</span><span class="op" id="3521511">.</span><span class="ident" id="3521512">ReadWriteCloser</span><br>
<span class="lineno"></span><span class="op" id="3521528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3521531">//&nbsp;NewConn&nbsp;returns&nbsp;a&nbsp;new&nbsp;Conn&nbsp;using&nbsp;conn&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="3521581">func</span>&nbsp;<span class="ident" id="3521586">NewConn</span><span class="op" id="3521593">(</span><span class="ident" id="3521594">conn</span>&nbsp;<span class="ident" id="3521599">io</span><span class="op" id="3521601">.</span><span class="ident" id="3521602">ReadWriteCloser</span><span class="op" id="3521617">)</span>&nbsp;<span class="op" id="3521619">*</span><span class="ident" id="3521620">Conn</span>&nbsp;<span class="op" id="3521625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3521628">return</span>&nbsp;<span class="op" id="3521635">&amp;</span><span class="ident" id="3521636">Conn</span><span class="op" id="3521640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3521644">Reader</span><span class="op" id="3521650">:</span>&nbsp;<span class="ident" id="3521652">Reader</span><span class="op" id="3521658">{</span><span class="ident" id="3521659">R</span><span class="op" id="3521660">:</span>&nbsp;<span class="ident" id="3521662">bufio</span><span class="op" id="3521667">.</span><span class="ident" id="3521668">NewReader</span><span class="op" id="3521677">(</span><span class="ident" id="3521678">conn</span><span class="op" id="3521682">)</span><span class="op" id="3521683">}</span><span class="op" id="3521684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3521688">Writer</span><span class="op" id="3521694">:</span>&nbsp;<span class="ident" id="3521696">Writer</span><span class="op" id="3521702">{</span><span class="ident" id="3521703">W</span><span class="op" id="3521704">:</span>&nbsp;<span class="ident" id="3521706">bufio</span><span class="op" id="3521711">.</span><span class="ident" id="3521712">NewWriter</span><span class="op" id="3521721">(</span><span class="ident" id="3521722">conn</span><span class="op" id="3521726">)</span><span class="op" id="3521727">}</span><span class="op" id="3521728">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3521732">conn</span><span class="op" id="3521736">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3521740">conn</span><span class="op" id="3521744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3521747">}</span><br>
<span class="lineno"></span><span class="op" id="3521749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3521752">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno">75</span><span class="keyword" id="3521784">func</span>&nbsp;<span class="op" id="3521789">(</span><span class="ident" id="3521790">c</span>&nbsp;<span class="op" id="3521792">*</span><span class="ident" id="3521793">Conn</span><span class="op" id="3521797">)</span>&nbsp;<span class="ident" id="3521799">Close</span><span class="op" id="3521804">(</span><span class="op" id="3521805">)</span>&nbsp;<span class="builtintype" id="3521807">error</span>&nbsp;<span class="op" id="3521813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3521816">return</span>&nbsp;<span class="ident" id="3521823">c</span><span class="op" id="3521824">.</span><span class="ident" id="3521825">conn</span><span class="op" id="3521829">.</span><span class="ident" id="3521830">Close</span><span class="op" id="3521835">(</span><span class="op" id="3521836">)</span><br>
<span class="lineno"></span><span class="op" id="3521838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3521841">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;given&nbsp;address&nbsp;on&nbsp;the&nbsp;given&nbsp;network&nbsp;using&nbsp;net.Dial</span><br>
<span class="lineno">80</span><span class="comment" id="3521915">//&nbsp;and&nbsp;then&nbsp;returns&nbsp;a&nbsp;new&nbsp;Conn&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3521966">func</span>&nbsp;<span class="ident" id="3521971">Dial</span><span class="op" id="3521975">(</span><span class="ident" id="3521976">network</span><span class="op" id="3521983">,</span>&nbsp;<span class="ident" id="3521985">addr</span>&nbsp;<span class="builtintype" id="3521990">string</span><span class="op" id="3521996">)</span>&nbsp;<span class="op" id="3521998">(</span><span class="op" id="3521999">*</span><span class="ident" id="3522000">Conn</span><span class="op" id="3522004">,</span>&nbsp;<span class="builtintype" id="3522006">error</span><span class="op" id="3522011">)</span>&nbsp;<span class="op" id="3522013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3522016">c</span><span class="op" id="3522017">,</span>&nbsp;<span class="ident" id="3522019">err</span>&nbsp;<span class="op" id="3522023">:=</span>&nbsp;<span class="ident" id="3522026">net</span><span class="op" id="3522029">.</span><span class="ident" id="3522030">Dial</span><span class="op" id="3522034">(</span><span class="ident" id="3522035">network</span><span class="op" id="3522042">,</span>&nbsp;<span class="ident" id="3522044">addr</span><span class="op" id="3522048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3522051">if</span>&nbsp;<span class="ident" id="3522054">err</span>&nbsp;<span class="op" id="3522058">!=</span>&nbsp;<span class="builtintype" id="3522061">nil</span>&nbsp;<span class="op" id="3522065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3522069">return</span>&nbsp;<span class="builtintype" id="3522076">nil</span><span class="op" id="3522079">,</span>&nbsp;<span class="ident" id="3522081">err</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3522086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3522089">return</span>&nbsp;<span class="ident" id="3522096">NewConn</span><span class="op" id="3522103">(</span><span class="ident" id="3522104">c</span><span class="op" id="3522105">)</span><span class="op" id="3522106">,</span>&nbsp;<span class="builtintype" id="3522108">nil</span><br>
<span class="lineno"></span><span class="op" id="3522112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3522115">//&nbsp;Cmd&nbsp;is&nbsp;a&nbsp;convenience&nbsp;method&nbsp;that&nbsp;sends&nbsp;a&nbsp;command&nbsp;after</span><br>
<span class="lineno">90</span><span class="comment" id="3522173">//&nbsp;waiting&nbsp;its&nbsp;turn&nbsp;in&nbsp;the&nbsp;pipeline.&nbsp;&nbsp;The&nbsp;command&nbsp;text&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3522235">//&nbsp;result&nbsp;of&nbsp;formatting&nbsp;format&nbsp;with&nbsp;args&nbsp;and&nbsp;appending&nbsp;\r\n.</span><br>
<span class="lineno"></span><span class="comment" id="3522296">//&nbsp;Cmd&nbsp;returns&nbsp;the&nbsp;id&nbsp;of&nbsp;the&nbsp;command,&nbsp;for&nbsp;use&nbsp;with&nbsp;StartResponse&nbsp;and&nbsp;EndResponse.</span><br>
<span class="lineno"></span><span class="comment" id="3522378">//</span><br>
<span class="lineno"></span><span class="comment" id="3522381">//&nbsp;For&nbsp;example,&nbsp;a&nbsp;client&nbsp;might&nbsp;run&nbsp;a&nbsp;HELP&nbsp;command&nbsp;that&nbsp;returns&nbsp;a&nbsp;dot-body</span><br>
<span class="lineno">95</span><span class="comment" id="3522455">//&nbsp;by&nbsp;using:</span><br>
<span class="lineno"></span><span class="comment" id="3522468">//</span><br>
<span class="lineno"></span><span class="comment" id="3522471">//&nbsp;&nbsp;&nbsp;&nbsp;id,&nbsp;err&nbsp;:=&nbsp;c.Cmd(&#34;HELP&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3522499">//&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="3522518">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;nil,&nbsp;err</span><br>
<span class="lineno">100</span><span class="comment" id="3522538">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="3522543">//</span><br>
<span class="lineno"></span><span class="comment" id="3522546">//&nbsp;&nbsp;&nbsp;&nbsp;c.StartResponse(id)</span><br>
<span class="lineno"></span><span class="comment" id="3522569">//&nbsp;&nbsp;&nbsp;&nbsp;defer&nbsp;c.EndResponse(id)</span><br>
<span class="lineno"></span><span class="comment" id="3522596">//</span><br>
<span class="lineno">105</span><span class="comment" id="3522599">//&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;_,&nbsp;_,&nbsp;err&nbsp;=&nbsp;c.ReadCodeLine(110);&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="3522651">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;nil,&nbsp;err</span><br>
<span class="lineno"></span><span class="comment" id="3522671">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="3522676">//&nbsp;&nbsp;&nbsp;&nbsp;text,&nbsp;err&nbsp;:=&nbsp;c.ReadDotBytes()</span><br>
<span class="lineno"></span><span class="comment" id="3522709">//&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{</span><br>
<span class="lineno">110</span><span class="comment" id="3522728">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;nil,&nbsp;err</span><br>
<span class="lineno"></span><span class="comment" id="3522748">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="3522753">//&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;c.ReadCodeLine(250)</span><br>
<span class="lineno"></span><span class="comment" id="3522783">//</span><br>
<span class="lineno"></span><span class="keyword" id="3522786">func</span>&nbsp;<span class="op" id="3522791">(</span><span class="ident" id="3522792">c</span>&nbsp;<span class="op" id="3522794">*</span><span class="ident" id="3522795">Conn</span><span class="op" id="3522799">)</span>&nbsp;<span class="ident" id="3522801">Cmd</span><span class="op" id="3522804">(</span><span class="ident" id="3522805">format</span>&nbsp;<span class="builtintype" id="3522812">string</span><span class="op" id="3522818">,</span>&nbsp;<span class="ident" id="3522820">args</span>&nbsp;<span class="op" id="3522825">...</span><span class="keyword" id="3522828">interface</span><span class="op" id="3522837">{</span><span class="op" id="3522838">}</span><span class="op" id="3522839">)</span>&nbsp;<span class="op" id="3522841">(</span><span class="ident" id="3522842">id</span>&nbsp;<span class="builtintype" id="3522845">uint</span><span class="op" id="3522849">,</span>&nbsp;<span class="ident" id="3522851">err</span>&nbsp;<span class="builtintype" id="3522855">error</span><span class="op" id="3522860">)</span>&nbsp;<span class="op" id="3522862">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3522865">id</span>&nbsp;<span class="op" id="3522868">=</span>&nbsp;<span class="ident" id="3522870">c</span><span class="op" id="3522871">.</span><span class="ident" id="3522872">Next</span><span class="op" id="3522876">(</span><span class="op" id="3522877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3522880">c</span><span class="op" id="3522881">.</span><span class="ident" id="3522882">StartRequest</span><span class="op" id="3522894">(</span><span class="ident" id="3522895">id</span><span class="op" id="3522897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3522900">err</span>&nbsp;<span class="op" id="3522904">=</span>&nbsp;<span class="ident" id="3522906">c</span><span class="op" id="3522907">.</span><span class="ident" id="3522908">PrintfLine</span><span class="op" id="3522918">(</span><span class="ident" id="3522919">format</span><span class="op" id="3522925">,</span>&nbsp;<span class="ident" id="3522927">args</span><span class="op" id="3522931">...</span><span class="op" id="3522934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3522937">c</span><span class="op" id="3522938">.</span><span class="ident" id="3522939">EndRequest</span><span class="op" id="3522949">(</span><span class="ident" id="3522950">id</span><span class="op" id="3522952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3522955">if</span>&nbsp;<span class="ident" id="3522958">err</span>&nbsp;<span class="op" id="3522962">!=</span>&nbsp;<span class="builtintype" id="3522965">nil</span>&nbsp;<span class="op" id="3522969">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3522973">return</span>&nbsp;<span class="num" id="3522980">0</span><span class="op" id="3522981">,</span>&nbsp;<span class="ident" id="3522983">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3522988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3522991">return</span>&nbsp;<span class="ident" id="3522998">id</span><span class="op" id="3523000">,</span>&nbsp;<span class="builtintype" id="3523002">nil</span><br>
<span class="lineno"></span><span class="op" id="3523006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3523009">//&nbsp;TrimString&nbsp;returns&nbsp;s&nbsp;without&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;ASCII&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="3523075">func</span>&nbsp;<span class="ident" id="3523080">TrimString</span><span class="op" id="3523090">(</span><span class="ident" id="3523091">s</span>&nbsp;<span class="builtintype" id="3523093">string</span><span class="op" id="3523099">)</span>&nbsp;<span class="builtintype" id="3523101">string</span>&nbsp;<span class="op" id="3523108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3523111">for</span>&nbsp;<span class="builtinfunc" id="3523115">len</span><span class="op" id="3523118">(</span><span class="ident" id="3523119">s</span><span class="op" id="3523120">)</span>&nbsp;<span class="op" id="3523122">&gt;</span>&nbsp;<span class="num" id="3523124">0</span>&nbsp;<span class="op" id="3523126">&amp;&amp;</span>&nbsp;<span class="ident" id="3523129">isASCIISpace</span><span class="op" id="3523141">(</span><span class="ident" id="3523142">s</span><span class="op" id="3523143">[</span><span class="num" id="3523144">0</span><span class="op" id="3523145">]</span><span class="op" id="3523146">)</span>&nbsp;<span class="op" id="3523148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3523152">s</span>&nbsp;<span class="op" id="3523154">=</span>&nbsp;<span class="ident" id="3523156">s</span><span class="op" id="3523157">[</span><span class="num" id="3523158">1</span><span class="op" id="3523159">:</span><span class="op" id="3523160">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3523163">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3523166">for</span>&nbsp;<span class="builtinfunc" id="3523170">len</span><span class="op" id="3523173">(</span><span class="ident" id="3523174">s</span><span class="op" id="3523175">)</span>&nbsp;<span class="op" id="3523177">&gt;</span>&nbsp;<span class="num" id="3523179">0</span>&nbsp;<span class="op" id="3523181">&amp;&amp;</span>&nbsp;<span class="ident" id="3523184">isASCIISpace</span><span class="op" id="3523196">(</span><span class="ident" id="3523197">s</span><span class="op" id="3523198">[</span><span class="builtinfunc" id="3523199">len</span><span class="op" id="3523202">(</span><span class="ident" id="3523203">s</span><span class="op" id="3523204">)</span><span class="op" id="3523205">-</span><span class="num" id="3523206">1</span><span class="op" id="3523207">]</span><span class="op" id="3523208">)</span>&nbsp;<span class="op" id="3523210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3523214">s</span>&nbsp;<span class="op" id="3523216">=</span>&nbsp;<span class="ident" id="3523218">s</span><span class="op" id="3523219">[</span><span class="op" id="3523220">:</span><span class="builtinfunc" id="3523221">len</span><span class="op" id="3523224">(</span><span class="ident" id="3523225">s</span><span class="op" id="3523226">)</span><span class="op" id="3523227">-</span><span class="num" id="3523228">1</span><span class="op" id="3523229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3523232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3523235">return</span>&nbsp;<span class="ident" id="3523242">s</span><br>
<span class="lineno"></span><span class="op" id="3523244">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="3523247">//&nbsp;TrimBytes&nbsp;returns&nbsp;b&nbsp;without&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;ASCII&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="3523312">func</span>&nbsp;<span class="ident" id="3523317">TrimBytes</span><span class="op" id="3523326">(</span><span class="ident" id="3523327">b</span>&nbsp;<span class="op" id="3523329">[</span><span class="op" id="3523330">]</span><span class="builtintype" id="3523331">byte</span><span class="op" id="3523335">)</span>&nbsp;<span class="op" id="3523337">[</span><span class="op" id="3523338">]</span><span class="builtintype" id="3523339">byte</span>&nbsp;<span class="op" id="3523344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3523347">for</span>&nbsp;<span class="builtinfunc" id="3523351">len</span><span class="op" id="3523354">(</span><span class="ident" id="3523355">b</span><span class="op" id="3523356">)</span>&nbsp;<span class="op" id="3523358">&gt;</span>&nbsp;<span class="num" id="3523360">0</span>&nbsp;<span class="op" id="3523362">&amp;&amp;</span>&nbsp;<span class="ident" id="3523365">isASCIISpace</span><span class="op" id="3523377">(</span><span class="ident" id="3523378">b</span><span class="op" id="3523379">[</span><span class="num" id="3523380">0</span><span class="op" id="3523381">]</span><span class="op" id="3523382">)</span>&nbsp;<span class="op" id="3523384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3523388">b</span>&nbsp;<span class="op" id="3523390">=</span>&nbsp;<span class="ident" id="3523392">b</span><span class="op" id="3523393">[</span><span class="num" id="3523394">1</span><span class="op" id="3523395">:</span><span class="op" id="3523396">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3523399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3523402">for</span>&nbsp;<span class="builtinfunc" id="3523406">len</span><span class="op" id="3523409">(</span><span class="ident" id="3523410">b</span><span class="op" id="3523411">)</span>&nbsp;<span class="op" id="3523413">&gt;</span>&nbsp;<span class="num" id="3523415">0</span>&nbsp;<span class="op" id="3523417">&amp;&amp;</span>&nbsp;<span class="ident" id="3523420">isASCIISpace</span><span class="op" id="3523432">(</span><span class="ident" id="3523433">b</span><span class="op" id="3523434">[</span><span class="builtinfunc" id="3523435">len</span><span class="op" id="3523438">(</span><span class="ident" id="3523439">b</span><span class="op" id="3523440">)</span><span class="op" id="3523441">-</span><span class="num" id="3523442">1</span><span class="op" id="3523443">]</span><span class="op" id="3523444">)</span>&nbsp;<span class="op" id="3523446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3523450">b</span>&nbsp;<span class="op" id="3523452">=</span>&nbsp;<span class="ident" id="3523454">b</span><span class="op" id="3523455">[</span><span class="op" id="3523456">:</span><span class="builtinfunc" id="3523457">len</span><span class="op" id="3523460">(</span><span class="ident" id="3523461">b</span><span class="op" id="3523462">)</span><span class="op" id="3523463">-</span><span class="num" id="3523464">1</span><span class="op" id="3523465">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3523468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3523471">return</span>&nbsp;<span class="ident" id="3523478">b</span><br>
<span class="lineno">145</span><span class="op" id="3523480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3523483">func</span>&nbsp;<span class="ident" id="3523488">isASCIISpace</span><span class="op" id="3523500">(</span><span class="ident" id="3523501">b</span>&nbsp;<span class="builtintype" id="3523503">byte</span><span class="op" id="3523507">)</span>&nbsp;<span class="builtintype" id="3523509">bool</span>&nbsp;<span class="op" id="3523514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3523517">return</span>&nbsp;<span class="ident" id="3523524">b</span>&nbsp;<span class="op" id="3523526">==</span>&nbsp;<span class="string" id="3523529">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3523533">||</span>&nbsp;<span class="ident" id="3523536">b</span>&nbsp;<span class="op" id="3523538">==</span>&nbsp;<span class="string" id="3523541">&#39;\t&#39;</span>&nbsp;<span class="op" id="3523546">||</span>&nbsp;<span class="ident" id="3523549">b</span>&nbsp;<span class="op" id="3523551">==</span>&nbsp;<span class="string" id="3523554">&#39;\n&#39;</span>&nbsp;<span class="op" id="3523559">||</span>&nbsp;<span class="ident" id="3523562">b</span>&nbsp;<span class="op" id="3523564">==</span>&nbsp;<span class="string" id="3523567">&#39;\r&#39;</span><br>
<span class="lineno"></span><span class="op" id="3523572">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="3523575">func</span>&nbsp;<span class="ident" id="3523580">isASCIILetter</span><span class="op" id="3523593">(</span><span class="ident" id="3523594">b</span>&nbsp;<span class="builtintype" id="3523596">byte</span><span class="op" id="3523600">)</span>&nbsp;<span class="builtintype" id="3523602">bool</span>&nbsp;<span class="op" id="3523607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3523610">b</span>&nbsp;<span class="op" id="3523612">|=</span>&nbsp;<span class="num" id="3523615">0x20</span>&nbsp;<span class="comment" id="3523620">//&nbsp;make&nbsp;lower&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3523640">return</span>&nbsp;<span class="string" id="3523647">&#39;a&#39;</span>&nbsp;<span class="op" id="3523651">&lt;=</span>&nbsp;<span class="ident" id="3523654">b</span>&nbsp;<span class="op" id="3523656">&amp;&amp;</span>&nbsp;<span class="ident" id="3523659">b</span>&nbsp;<span class="op" id="3523661">&lt;=</span>&nbsp;<span class="string" id="3523664">&#39;z&#39;</span><br>
<span class="lineno"></span><span class="op" id="3523668">}</span>
</div>
</body>
</html>
