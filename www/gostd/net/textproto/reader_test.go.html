<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8592199">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8592255">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8592309">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8592360">package</span>&nbsp;<span class="ident" id="8592368">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8592379">import</span>&nbsp;<span class="op" id="8592386">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8592389">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8592398">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8592407">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8592413">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8592424">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8592435">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8592445">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8592448">type</span>&nbsp;<span class="ident" id="8592453">canonicalHeaderKeyTest</span>&nbsp;<span class="keyword" id="8592476">struct</span>&nbsp;<span class="op" id="8592483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8592486">in</span><span class="op" id="8592488">,</span>&nbsp;<span class="ident" id="8592490">out</span>&nbsp;<span class="builtintype" id="8592494">string</span><br>
<span class="lineno"></span><span class="op" id="8592501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8592504">var</span>&nbsp;<span class="ident" id="8592508">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="8592532">=</span>&nbsp;<span class="op" id="8592534">[</span><span class="op" id="8592535">]</span><span class="ident" id="8592536">canonicalHeaderKeyTest</span><span class="op" id="8592558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8592561">{</span><span class="string" id="8592562">&#34;a-b-c&#34;</span><span class="op" id="8592569">,</span>&nbsp;<span class="string" id="8592571">&#34;A-B-C&#34;</span><span class="op" id="8592578">}</span><span class="op" id="8592579">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8592582">{</span><span class="string" id="8592583">&#34;a-1-c&#34;</span><span class="op" id="8592590">,</span>&nbsp;<span class="string" id="8592592">&#34;A-1-C&#34;</span><span class="op" id="8592599">}</span><span class="op" id="8592600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8592603">{</span><span class="string" id="8592604">&#34;User-Agent&#34;</span><span class="op" id="8592616">,</span>&nbsp;<span class="string" id="8592618">&#34;User-Agent&#34;</span><span class="op" id="8592630">}</span><span class="op" id="8592631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8592634">{</span><span class="string" id="8592635">&#34;uSER-aGENT&#34;</span><span class="op" id="8592647">,</span>&nbsp;<span class="string" id="8592649">&#34;User-Agent&#34;</span><span class="op" id="8592661">}</span><span class="op" id="8592662">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8592665">{</span><span class="string" id="8592666">&#34;user-agent&#34;</span><span class="op" id="8592678">,</span>&nbsp;<span class="string" id="8592680">&#34;User-Agent&#34;</span><span class="op" id="8592692">}</span><span class="op" id="8592693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8592696">{</span><span class="string" id="8592697">&#34;USER-AGENT&#34;</span><span class="op" id="8592709">,</span>&nbsp;<span class="string" id="8592711">&#34;User-Agent&#34;</span><span class="op" id="8592723">}</span><span class="op" id="8592724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8592727">{</span><span class="string" id="8592728">&#34;üser-agenT&#34;</span><span class="op" id="8592741">,</span>&nbsp;<span class="string" id="8592743">&#34;üser-Agent&#34;</span><span class="op" id="8592756">}</span><span class="op" id="8592757">,</span>&nbsp;<span class="comment" id="8592759">//&nbsp;non-ASCII&nbsp;unchanged</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8592784">//&nbsp;This&nbsp;caused&nbsp;a&nbsp;panic&nbsp;due&nbsp;to&nbsp;mishandling&nbsp;of&nbsp;a&nbsp;space:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8592839">{</span><span class="string" id="8592840">&#34;C&nbsp;Ontent-Transfer-Encoding&#34;</span><span class="op" id="8592868">,</span>&nbsp;<span class="string" id="8592870">&#34;C-Ontent-Transfer-Encoding&#34;</span><span class="op" id="8592898">}</span><span class="op" id="8592899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8592902">{</span><span class="string" id="8592903">&#34;foo&nbsp;bar&#34;</span><span class="op" id="8592912">,</span>&nbsp;<span class="string" id="8592914">&#34;Foo-Bar&#34;</span><span class="op" id="8592923">}</span><span class="op" id="8592924">,</span><br>
<span class="lineno"></span><span class="op" id="8592926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8592929">func</span>&nbsp;<span class="ident" id="8592934">TestCanonicalMIMEHeaderKey</span><span class="op" id="8592960">(</span><span class="ident" id="8592961">t</span>&nbsp;<span class="op" id="8592963">*</span><span class="ident" id="8592964">testing</span><span class="op" id="8592971">.</span><span class="ident" id="8592972">T</span><span class="op" id="8592973">)</span>&nbsp;<span class="op" id="8592975">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8592978">for</span>&nbsp;<span class="ident" id="8592982">_</span><span class="op" id="8592983">,</span>&nbsp;<span class="ident" id="8592985">tt</span>&nbsp;<span class="op" id="8592988">:=</span>&nbsp;<span class="keyword" id="8592991">range</span>&nbsp;<span class="ident" id="8592997">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="8593021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8593025">if</span>&nbsp;<span class="ident" id="8593028">s</span>&nbsp;<span class="op" id="8593030">:=</span>&nbsp;<span class="ident" id="8593033">CanonicalMIMEHeaderKey</span><span class="op" id="8593055">(</span><span class="ident" id="8593056">tt</span><span class="op" id="8593058">.</span><span class="ident" id="8593059">in</span><span class="op" id="8593061">)</span><span class="op" id="8593062">;</span>&nbsp;<span class="ident" id="8593064">s</span>&nbsp;<span class="op" id="8593066">!=</span>&nbsp;<span class="ident" id="8593069">tt</span><span class="op" id="8593071">.</span><span class="ident" id="8593072">out</span>&nbsp;<span class="op" id="8593076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8593081">t</span><span class="op" id="8593082">.</span><span class="ident" id="8593083">Errorf</span><span class="op" id="8593089">(</span><span class="string" id="8593090">&#34;CanonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8593132">,</span>&nbsp;<span class="ident" id="8593134">tt</span><span class="op" id="8593136">.</span><span class="ident" id="8593137">in</span><span class="op" id="8593139">,</span>&nbsp;<span class="ident" id="8593141">s</span><span class="op" id="8593142">,</span>&nbsp;<span class="ident" id="8593144">tt</span><span class="op" id="8593146">.</span><span class="ident" id="8593147">out</span><span class="op" id="8593150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8593154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8593157">}</span><br>
<span class="lineno">40</span><span class="op" id="8593159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8593162">func</span>&nbsp;<span class="ident" id="8593167">reader</span><span class="op" id="8593173">(</span><span class="ident" id="8593174">s</span>&nbsp;<span class="builtintype" id="8593176">string</span><span class="op" id="8593182">)</span>&nbsp;<span class="op" id="8593184">*</span><span class="ident" id="8593185">Reader</span>&nbsp;<span class="op" id="8593192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8593195">return</span>&nbsp;<span class="ident" id="8593202">NewReader</span><span class="op" id="8593211">(</span><span class="ident" id="8593212">bufio</span><span class="op" id="8593217">.</span><span class="ident" id="8593218">NewReader</span><span class="op" id="8593227">(</span><span class="ident" id="8593228">strings</span><span class="op" id="8593235">.</span><span class="ident" id="8593236">NewReader</span><span class="op" id="8593245">(</span><span class="ident" id="8593246">s</span><span class="op" id="8593247">)</span><span class="op" id="8593248">)</span><span class="op" id="8593249">)</span><br>
<span class="lineno"></span><span class="op" id="8593251">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8593254">func</span>&nbsp;<span class="ident" id="8593259">TestReadLine</span><span class="op" id="8593271">(</span><span class="ident" id="8593272">t</span>&nbsp;<span class="op" id="8593274">*</span><span class="ident" id="8593275">testing</span><span class="op" id="8593282">.</span><span class="ident" id="8593283">T</span><span class="op" id="8593284">)</span>&nbsp;<span class="op" id="8593286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8593289">r</span>&nbsp;<span class="op" id="8593291">:=</span>&nbsp;<span class="ident" id="8593294">reader</span><span class="op" id="8593300">(</span><span class="string" id="8593301">&#34;line1\nline2\n&#34;</span><span class="op" id="8593317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8593320">s</span><span class="op" id="8593321">,</span>&nbsp;<span class="ident" id="8593323">err</span>&nbsp;<span class="op" id="8593327">:=</span>&nbsp;<span class="ident" id="8593330">r</span><span class="op" id="8593331">.</span><span class="ident" id="8593332">ReadLine</span><span class="op" id="8593340">(</span><span class="op" id="8593341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8593344">if</span>&nbsp;<span class="ident" id="8593347">s</span>&nbsp;<span class="op" id="8593349">!=</span>&nbsp;<span class="string" id="8593352">&#34;line1&#34;</span>&nbsp;<span class="op" id="8593360">||</span>&nbsp;<span class="ident" id="8593363">err</span>&nbsp;<span class="op" id="8593367">!=</span>&nbsp;<span class="ident" id="8593370">nil</span>&nbsp;<span class="op" id="8593374">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8593378">t</span><span class="op" id="8593379">.</span><span class="ident" id="8593380">Fatalf</span><span class="op" id="8593386">(</span><span class="string" id="8593387">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8593403">,</span>&nbsp;<span class="ident" id="8593405">s</span><span class="op" id="8593406">,</span>&nbsp;<span class="ident" id="8593408">err</span><span class="op" id="8593411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8593414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8593417">s</span><span class="op" id="8593418">,</span>&nbsp;<span class="ident" id="8593420">err</span>&nbsp;<span class="op" id="8593424">=</span>&nbsp;<span class="ident" id="8593426">r</span><span class="op" id="8593427">.</span><span class="ident" id="8593428">ReadLine</span><span class="op" id="8593436">(</span><span class="op" id="8593437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8593440">if</span>&nbsp;<span class="ident" id="8593443">s</span>&nbsp;<span class="op" id="8593445">!=</span>&nbsp;<span class="string" id="8593448">&#34;line2&#34;</span>&nbsp;<span class="op" id="8593456">||</span>&nbsp;<span class="ident" id="8593459">err</span>&nbsp;<span class="op" id="8593463">!=</span>&nbsp;<span class="ident" id="8593466">nil</span>&nbsp;<span class="op" id="8593470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8593474">t</span><span class="op" id="8593475">.</span><span class="ident" id="8593476">Fatalf</span><span class="op" id="8593482">(</span><span class="string" id="8593483">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8593499">,</span>&nbsp;<span class="ident" id="8593501">s</span><span class="op" id="8593502">,</span>&nbsp;<span class="ident" id="8593504">err</span><span class="op" id="8593507">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8593510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8593513">s</span><span class="op" id="8593514">,</span>&nbsp;<span class="ident" id="8593516">err</span>&nbsp;<span class="op" id="8593520">=</span>&nbsp;<span class="ident" id="8593522">r</span><span class="op" id="8593523">.</span><span class="ident" id="8593524">ReadLine</span><span class="op" id="8593532">(</span><span class="op" id="8593533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8593536">if</span>&nbsp;<span class="ident" id="8593539">s</span>&nbsp;<span class="op" id="8593541">!=</span>&nbsp;<span class="string" id="8593544">&#34;&#34;</span>&nbsp;<span class="op" id="8593547">||</span>&nbsp;<span class="ident" id="8593550">err</span>&nbsp;<span class="op" id="8593554">!=</span>&nbsp;<span class="ident" id="8593557">io</span><span class="op" id="8593559">.</span><span class="ident" id="8593560">EOF</span>&nbsp;<span class="op" id="8593564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8593568">t</span><span class="op" id="8593569">.</span><span class="ident" id="8593570">Fatalf</span><span class="op" id="8593576">(</span><span class="string" id="8593577">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8593590">,</span>&nbsp;<span class="ident" id="8593592">s</span><span class="op" id="8593593">,</span>&nbsp;<span class="ident" id="8593595">err</span><span class="op" id="8593598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8593601">}</span><br>
<span class="lineno">60</span><span class="op" id="8593603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8593606">func</span>&nbsp;<span class="ident" id="8593611">TestReadContinuedLine</span><span class="op" id="8593632">(</span><span class="ident" id="8593633">t</span>&nbsp;<span class="op" id="8593635">*</span><span class="ident" id="8593636">testing</span><span class="op" id="8593643">.</span><span class="ident" id="8593644">T</span><span class="op" id="8593645">)</span>&nbsp;<span class="op" id="8593647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8593650">r</span>&nbsp;<span class="op" id="8593652">:=</span>&nbsp;<span class="ident" id="8593655">reader</span><span class="op" id="8593661">(</span><span class="string" id="8593662">&#34;line1\nline\n&nbsp;2\nline3\n&#34;</span><span class="op" id="8593688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8593691">s</span><span class="op" id="8593692">,</span>&nbsp;<span class="ident" id="8593694">err</span>&nbsp;<span class="op" id="8593698">:=</span>&nbsp;<span class="ident" id="8593701">r</span><span class="op" id="8593702">.</span><span class="ident" id="8593703">ReadContinuedLine</span><span class="op" id="8593720">(</span><span class="op" id="8593721">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8593724">if</span>&nbsp;<span class="ident" id="8593727">s</span>&nbsp;<span class="op" id="8593729">!=</span>&nbsp;<span class="string" id="8593732">&#34;line1&#34;</span>&nbsp;<span class="op" id="8593740">||</span>&nbsp;<span class="ident" id="8593743">err</span>&nbsp;<span class="op" id="8593747">!=</span>&nbsp;<span class="ident" id="8593750">nil</span>&nbsp;<span class="op" id="8593754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8593758">t</span><span class="op" id="8593759">.</span><span class="ident" id="8593760">Fatalf</span><span class="op" id="8593766">(</span><span class="string" id="8593767">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8593783">,</span>&nbsp;<span class="ident" id="8593785">s</span><span class="op" id="8593786">,</span>&nbsp;<span class="ident" id="8593788">err</span><span class="op" id="8593791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8593794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8593797">s</span><span class="op" id="8593798">,</span>&nbsp;<span class="ident" id="8593800">err</span>&nbsp;<span class="op" id="8593804">=</span>&nbsp;<span class="ident" id="8593806">r</span><span class="op" id="8593807">.</span><span class="ident" id="8593808">ReadContinuedLine</span><span class="op" id="8593825">(</span><span class="op" id="8593826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8593829">if</span>&nbsp;<span class="ident" id="8593832">s</span>&nbsp;<span class="op" id="8593834">!=</span>&nbsp;<span class="string" id="8593837">&#34;line&nbsp;2&#34;</span>&nbsp;<span class="op" id="8593846">||</span>&nbsp;<span class="ident" id="8593849">err</span>&nbsp;<span class="op" id="8593853">!=</span>&nbsp;<span class="ident" id="8593856">nil</span>&nbsp;<span class="op" id="8593860">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8593864">t</span><span class="op" id="8593865">.</span><span class="ident" id="8593866">Fatalf</span><span class="op" id="8593872">(</span><span class="string" id="8593873">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8593889">,</span>&nbsp;<span class="ident" id="8593891">s</span><span class="op" id="8593892">,</span>&nbsp;<span class="ident" id="8593894">err</span><span class="op" id="8593897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8593900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8593903">s</span><span class="op" id="8593904">,</span>&nbsp;<span class="ident" id="8593906">err</span>&nbsp;<span class="op" id="8593910">=</span>&nbsp;<span class="ident" id="8593912">r</span><span class="op" id="8593913">.</span><span class="ident" id="8593914">ReadContinuedLine</span><span class="op" id="8593931">(</span><span class="op" id="8593932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8593935">if</span>&nbsp;<span class="ident" id="8593938">s</span>&nbsp;<span class="op" id="8593940">!=</span>&nbsp;<span class="string" id="8593943">&#34;line3&#34;</span>&nbsp;<span class="op" id="8593951">||</span>&nbsp;<span class="ident" id="8593954">err</span>&nbsp;<span class="op" id="8593958">!=</span>&nbsp;<span class="ident" id="8593961">nil</span>&nbsp;<span class="op" id="8593965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8593969">t</span><span class="op" id="8593970">.</span><span class="ident" id="8593971">Fatalf</span><span class="op" id="8593977">(</span><span class="string" id="8593978">&#34;Line&nbsp;3:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8593994">,</span>&nbsp;<span class="ident" id="8593996">s</span><span class="op" id="8593997">,</span>&nbsp;<span class="ident" id="8593999">err</span><span class="op" id="8594002">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8594005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8594008">s</span><span class="op" id="8594009">,</span>&nbsp;<span class="ident" id="8594011">err</span>&nbsp;<span class="op" id="8594015">=</span>&nbsp;<span class="ident" id="8594017">r</span><span class="op" id="8594018">.</span><span class="ident" id="8594019">ReadContinuedLine</span><span class="op" id="8594036">(</span><span class="op" id="8594037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8594040">if</span>&nbsp;<span class="ident" id="8594043">s</span>&nbsp;<span class="op" id="8594045">!=</span>&nbsp;<span class="string" id="8594048">&#34;&#34;</span>&nbsp;<span class="op" id="8594051">||</span>&nbsp;<span class="ident" id="8594054">err</span>&nbsp;<span class="op" id="8594058">!=</span>&nbsp;<span class="ident" id="8594061">io</span><span class="op" id="8594063">.</span><span class="ident" id="8594064">EOF</span>&nbsp;<span class="op" id="8594068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8594072">t</span><span class="op" id="8594073">.</span><span class="ident" id="8594074">Fatalf</span><span class="op" id="8594080">(</span><span class="string" id="8594081">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8594094">,</span>&nbsp;<span class="ident" id="8594096">s</span><span class="op" id="8594097">,</span>&nbsp;<span class="ident" id="8594099">err</span><span class="op" id="8594102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8594105">}</span><br>
<span class="lineno">80</span><span class="op" id="8594107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8594110">func</span>&nbsp;<span class="ident" id="8594115">TestReadCodeLine</span><span class="op" id="8594131">(</span><span class="ident" id="8594132">t</span>&nbsp;<span class="op" id="8594134">*</span><span class="ident" id="8594135">testing</span><span class="op" id="8594142">.</span><span class="ident" id="8594143">T</span><span class="op" id="8594144">)</span>&nbsp;<span class="op" id="8594146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8594149">r</span>&nbsp;<span class="op" id="8594151">:=</span>&nbsp;<span class="ident" id="8594154">reader</span><span class="op" id="8594160">(</span><span class="string" id="8594161">&#34;123&nbsp;hi\n234&nbsp;bye\n345&nbsp;no&nbsp;way\n&#34;</span><span class="op" id="8594192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8594195">code</span><span class="op" id="8594199">,</span>&nbsp;<span class="ident" id="8594201">msg</span><span class="op" id="8594204">,</span>&nbsp;<span class="ident" id="8594206">err</span>&nbsp;<span class="op" id="8594210">:=</span>&nbsp;<span class="ident" id="8594213">r</span><span class="op" id="8594214">.</span><span class="ident" id="8594215">ReadCodeLine</span><span class="op" id="8594227">(</span><span class="num" id="8594228">0</span><span class="op" id="8594229">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8594232">if</span>&nbsp;<span class="ident" id="8594235">code</span>&nbsp;<span class="op" id="8594240">!=</span>&nbsp;<span class="num" id="8594243">123</span>&nbsp;<span class="op" id="8594247">||</span>&nbsp;<span class="ident" id="8594250">msg</span>&nbsp;<span class="op" id="8594254">!=</span>&nbsp;<span class="string" id="8594257">&#34;hi&#34;</span>&nbsp;<span class="op" id="8594262">||</span>&nbsp;<span class="ident" id="8594265">err</span>&nbsp;<span class="op" id="8594269">!=</span>&nbsp;<span class="ident" id="8594272">nil</span>&nbsp;<span class="op" id="8594276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8594280">t</span><span class="op" id="8594281">.</span><span class="ident" id="8594282">Fatalf</span><span class="op" id="8594288">(</span><span class="string" id="8594289">&#34;Line&nbsp;1:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8594309">,</span>&nbsp;<span class="ident" id="8594311">code</span><span class="op" id="8594315">,</span>&nbsp;<span class="ident" id="8594317">msg</span><span class="op" id="8594320">,</span>&nbsp;<span class="ident" id="8594322">err</span><span class="op" id="8594325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8594328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8594331">code</span><span class="op" id="8594335">,</span>&nbsp;<span class="ident" id="8594337">msg</span><span class="op" id="8594340">,</span>&nbsp;<span class="ident" id="8594342">err</span>&nbsp;<span class="op" id="8594346">=</span>&nbsp;<span class="ident" id="8594348">r</span><span class="op" id="8594349">.</span><span class="ident" id="8594350">ReadCodeLine</span><span class="op" id="8594362">(</span><span class="num" id="8594363">23</span><span class="op" id="8594365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8594368">if</span>&nbsp;<span class="ident" id="8594371">code</span>&nbsp;<span class="op" id="8594376">!=</span>&nbsp;<span class="num" id="8594379">234</span>&nbsp;<span class="op" id="8594383">||</span>&nbsp;<span class="ident" id="8594386">msg</span>&nbsp;<span class="op" id="8594390">!=</span>&nbsp;<span class="string" id="8594393">&#34;bye&#34;</span>&nbsp;<span class="op" id="8594399">||</span>&nbsp;<span class="ident" id="8594402">err</span>&nbsp;<span class="op" id="8594406">!=</span>&nbsp;<span class="ident" id="8594409">nil</span>&nbsp;<span class="op" id="8594413">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8594417">t</span><span class="op" id="8594418">.</span><span class="ident" id="8594419">Fatalf</span><span class="op" id="8594425">(</span><span class="string" id="8594426">&#34;Line&nbsp;2:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8594446">,</span>&nbsp;<span class="ident" id="8594448">code</span><span class="op" id="8594452">,</span>&nbsp;<span class="ident" id="8594454">msg</span><span class="op" id="8594457">,</span>&nbsp;<span class="ident" id="8594459">err</span><span class="op" id="8594462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8594465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8594468">code</span><span class="op" id="8594472">,</span>&nbsp;<span class="ident" id="8594474">msg</span><span class="op" id="8594477">,</span>&nbsp;<span class="ident" id="8594479">err</span>&nbsp;<span class="op" id="8594483">=</span>&nbsp;<span class="ident" id="8594485">r</span><span class="op" id="8594486">.</span><span class="ident" id="8594487">ReadCodeLine</span><span class="op" id="8594499">(</span><span class="num" id="8594500">346</span><span class="op" id="8594503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8594506">if</span>&nbsp;<span class="ident" id="8594509">code</span>&nbsp;<span class="op" id="8594514">!=</span>&nbsp;<span class="num" id="8594517">345</span>&nbsp;<span class="op" id="8594521">||</span>&nbsp;<span class="ident" id="8594524">msg</span>&nbsp;<span class="op" id="8594528">!=</span>&nbsp;<span class="string" id="8594531">&#34;no&nbsp;way&#34;</span>&nbsp;<span class="op" id="8594540">||</span>&nbsp;<span class="ident" id="8594543">err</span>&nbsp;<span class="op" id="8594547">==</span>&nbsp;<span class="ident" id="8594550">nil</span>&nbsp;<span class="op" id="8594554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8594558">t</span><span class="op" id="8594559">.</span><span class="ident" id="8594560">Fatalf</span><span class="op" id="8594566">(</span><span class="string" id="8594567">&#34;Line&nbsp;3:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8594587">,</span>&nbsp;<span class="ident" id="8594589">code</span><span class="op" id="8594593">,</span>&nbsp;<span class="ident" id="8594595">msg</span><span class="op" id="8594598">,</span>&nbsp;<span class="ident" id="8594600">err</span><span class="op" id="8594603">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8594606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8594609">if</span>&nbsp;<span class="ident" id="8594612">e</span><span class="op" id="8594613">,</span>&nbsp;<span class="ident" id="8594615">ok</span>&nbsp;<span class="op" id="8594618">:=</span>&nbsp;<span class="ident" id="8594621">err</span><span class="op" id="8594624">.</span><span class="op" id="8594625">(</span><span class="op" id="8594626">*</span><span class="ident" id="8594627">Error</span><span class="op" id="8594632">)</span><span class="op" id="8594633">;</span>&nbsp;<span class="op" id="8594635">!</span><span class="ident" id="8594636">ok</span>&nbsp;<span class="op" id="8594639">||</span>&nbsp;<span class="ident" id="8594642">e</span><span class="op" id="8594643">.</span><span class="ident" id="8594644">Code</span>&nbsp;<span class="op" id="8594649">!=</span>&nbsp;<span class="ident" id="8594652">code</span>&nbsp;<span class="op" id="8594657">||</span>&nbsp;<span class="ident" id="8594660">e</span><span class="op" id="8594661">.</span><span class="ident" id="8594662">Msg</span>&nbsp;<span class="op" id="8594666">!=</span>&nbsp;<span class="ident" id="8594669">msg</span>&nbsp;<span class="op" id="8594673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8594677">t</span><span class="op" id="8594678">.</span><span class="ident" id="8594679">Fatalf</span><span class="op" id="8594685">(</span><span class="string" id="8594686">&#34;Line&nbsp;3:&nbsp;wrong&nbsp;error&nbsp;%v\n&#34;</span><span class="op" id="8594712">,</span>&nbsp;<span class="ident" id="8594714">err</span><span class="op" id="8594717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8594720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8594723">code</span><span class="op" id="8594727">,</span>&nbsp;<span class="ident" id="8594729">msg</span><span class="op" id="8594732">,</span>&nbsp;<span class="ident" id="8594734">err</span>&nbsp;<span class="op" id="8594738">=</span>&nbsp;<span class="ident" id="8594740">r</span><span class="op" id="8594741">.</span><span class="ident" id="8594742">ReadCodeLine</span><span class="op" id="8594754">(</span><span class="num" id="8594755">1</span><span class="op" id="8594756">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8594759">if</span>&nbsp;<span class="ident" id="8594762">code</span>&nbsp;<span class="op" id="8594767">!=</span>&nbsp;<span class="num" id="8594770">0</span>&nbsp;<span class="op" id="8594772">||</span>&nbsp;<span class="ident" id="8594775">msg</span>&nbsp;<span class="op" id="8594779">!=</span>&nbsp;<span class="string" id="8594782">&#34;&#34;</span>&nbsp;<span class="op" id="8594785">||</span>&nbsp;<span class="ident" id="8594788">err</span>&nbsp;<span class="op" id="8594792">!=</span>&nbsp;<span class="ident" id="8594795">io</span><span class="op" id="8594797">.</span><span class="ident" id="8594798">EOF</span>&nbsp;<span class="op" id="8594802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8594806">t</span><span class="op" id="8594807">.</span><span class="ident" id="8594808">Fatalf</span><span class="op" id="8594814">(</span><span class="string" id="8594815">&#34;EOF:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8594832">,</span>&nbsp;<span class="ident" id="8594834">code</span><span class="op" id="8594838">,</span>&nbsp;<span class="ident" id="8594840">msg</span><span class="op" id="8594843">,</span>&nbsp;<span class="ident" id="8594845">err</span><span class="op" id="8594848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8594851">}</span><br>
<span class="lineno"></span><span class="op" id="8594853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="8594856">func</span>&nbsp;<span class="ident" id="8594861">TestReadDotLines</span><span class="op" id="8594877">(</span><span class="ident" id="8594878">t</span>&nbsp;<span class="op" id="8594880">*</span><span class="ident" id="8594881">testing</span><span class="op" id="8594888">.</span><span class="ident" id="8594889">T</span><span class="op" id="8594890">)</span>&nbsp;<span class="op" id="8594892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8594895">r</span>&nbsp;<span class="op" id="8594897">:=</span>&nbsp;<span class="ident" id="8594900">reader</span><span class="op" id="8594906">(</span><span class="string" id="8594907">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanother\n&#34;</span><span class="op" id="8594970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8594973">s</span><span class="op" id="8594974">,</span>&nbsp;<span class="ident" id="8594976">err</span>&nbsp;<span class="op" id="8594980">:=</span>&nbsp;<span class="ident" id="8594983">r</span><span class="op" id="8594984">.</span><span class="ident" id="8594985">ReadDotLines</span><span class="op" id="8594997">(</span><span class="op" id="8594998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8595001">want</span>&nbsp;<span class="op" id="8595006">:=</span>&nbsp;<span class="op" id="8595009">[</span><span class="op" id="8595010">]</span><span class="builtintype" id="8595011">string</span><span class="op" id="8595017">{</span><span class="string" id="8595018">&#34;dotlines&#34;</span><span class="op" id="8595028">,</span>&nbsp;<span class="string" id="8595030">&#34;foo&#34;</span><span class="op" id="8595035">,</span>&nbsp;<span class="string" id="8595037">&#34;.bar&#34;</span><span class="op" id="8595043">,</span>&nbsp;<span class="string" id="8595045">&#34;..baz&#34;</span><span class="op" id="8595052">,</span>&nbsp;<span class="string" id="8595054">&#34;quux&#34;</span><span class="op" id="8595060">,</span>&nbsp;<span class="string" id="8595062">&#34;&#34;</span><span class="op" id="8595064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8595067">if</span>&nbsp;<span class="op" id="8595070">!</span><span class="ident" id="8595071">reflect</span><span class="op" id="8595078">.</span><span class="ident" id="8595079">DeepEqual</span><span class="op" id="8595088">(</span><span class="ident" id="8595089">s</span><span class="op" id="8595090">,</span>&nbsp;<span class="ident" id="8595092">want</span><span class="op" id="8595096">)</span>&nbsp;<span class="op" id="8595098">||</span>&nbsp;<span class="ident" id="8595101">err</span>&nbsp;<span class="op" id="8595105">!=</span>&nbsp;<span class="ident" id="8595108">nil</span>&nbsp;<span class="op" id="8595112">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8595116">t</span><span class="op" id="8595117">.</span><span class="ident" id="8595118">Fatalf</span><span class="op" id="8595124">(</span><span class="string" id="8595125">&#34;ReadDotLines:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8595147">,</span>&nbsp;<span class="ident" id="8595149">s</span><span class="op" id="8595150">,</span>&nbsp;<span class="ident" id="8595152">err</span><span class="op" id="8595155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8595158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8595162">s</span><span class="op" id="8595163">,</span>&nbsp;<span class="ident" id="8595165">err</span>&nbsp;<span class="op" id="8595169">=</span>&nbsp;<span class="ident" id="8595171">r</span><span class="op" id="8595172">.</span><span class="ident" id="8595173">ReadDotLines</span><span class="op" id="8595185">(</span><span class="op" id="8595186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8595189">want</span>&nbsp;<span class="op" id="8595194">=</span>&nbsp;<span class="op" id="8595196">[</span><span class="op" id="8595197">]</span><span class="builtintype" id="8595198">string</span><span class="op" id="8595204">{</span><span class="string" id="8595205">&#34;another&#34;</span><span class="op" id="8595214">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8595217">if</span>&nbsp;<span class="op" id="8595220">!</span><span class="ident" id="8595221">reflect</span><span class="op" id="8595228">.</span><span class="ident" id="8595229">DeepEqual</span><span class="op" id="8595238">(</span><span class="ident" id="8595239">s</span><span class="op" id="8595240">,</span>&nbsp;<span class="ident" id="8595242">want</span><span class="op" id="8595246">)</span>&nbsp;<span class="op" id="8595248">||</span>&nbsp;<span class="ident" id="8595251">err</span>&nbsp;<span class="op" id="8595255">!=</span>&nbsp;<span class="ident" id="8595258">io</span><span class="op" id="8595260">.</span><span class="ident" id="8595261">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="8595278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8595282">t</span><span class="op" id="8595283">.</span><span class="ident" id="8595284">Fatalf</span><span class="op" id="8595290">(</span><span class="string" id="8595291">&#34;ReadDotLines2:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8595314">,</span>&nbsp;<span class="ident" id="8595316">s</span><span class="op" id="8595317">,</span>&nbsp;<span class="ident" id="8595319">err</span><span class="op" id="8595322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8595325">}</span><br>
<span class="lineno"></span><span class="op" id="8595327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8595330">func</span>&nbsp;<span class="ident" id="8595335">TestReadDotBytes</span><span class="op" id="8595351">(</span><span class="ident" id="8595352">t</span>&nbsp;<span class="op" id="8595354">*</span><span class="ident" id="8595355">testing</span><span class="op" id="8595362">.</span><span class="ident" id="8595363">T</span><span class="op" id="8595364">)</span>&nbsp;<span class="op" id="8595366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8595369">r</span>&nbsp;<span class="op" id="8595371">:=</span>&nbsp;<span class="ident" id="8595374">reader</span><span class="op" id="8595380">(</span><span class="string" id="8595381">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanot.her\r\n&#34;</span><span class="op" id="8595447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8595450">b</span><span class="op" id="8595451">,</span>&nbsp;<span class="ident" id="8595453">err</span>&nbsp;<span class="op" id="8595457">:=</span>&nbsp;<span class="ident" id="8595460">r</span><span class="op" id="8595461">.</span><span class="ident" id="8595462">ReadDotBytes</span><span class="op" id="8595474">(</span><span class="op" id="8595475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8595478">want</span>&nbsp;<span class="op" id="8595483">:=</span>&nbsp;<span class="op" id="8595486">[</span><span class="op" id="8595487">]</span><span class="builtintype" id="8595488">byte</span><span class="op" id="8595492">(</span><span class="string" id="8595493">&#34;dotlines\nfoo\n.bar\n..baz\nquux\n\n&#34;</span><span class="op" id="8595531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8595534">if</span>&nbsp;<span class="op" id="8595537">!</span><span class="ident" id="8595538">reflect</span><span class="op" id="8595545">.</span><span class="ident" id="8595546">DeepEqual</span><span class="op" id="8595555">(</span><span class="ident" id="8595556">b</span><span class="op" id="8595557">,</span>&nbsp;<span class="ident" id="8595559">want</span><span class="op" id="8595563">)</span>&nbsp;<span class="op" id="8595565">||</span>&nbsp;<span class="ident" id="8595568">err</span>&nbsp;<span class="op" id="8595572">!=</span>&nbsp;<span class="ident" id="8595575">nil</span>&nbsp;<span class="op" id="8595579">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8595583">t</span><span class="op" id="8595584">.</span><span class="ident" id="8595585">Fatalf</span><span class="op" id="8595591">(</span><span class="string" id="8595592">&#34;ReadDotBytes:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8595614">,</span>&nbsp;<span class="ident" id="8595616">b</span><span class="op" id="8595617">,</span>&nbsp;<span class="ident" id="8595619">err</span><span class="op" id="8595622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8595625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8595629">b</span><span class="op" id="8595630">,</span>&nbsp;<span class="ident" id="8595632">err</span>&nbsp;<span class="op" id="8595636">=</span>&nbsp;<span class="ident" id="8595638">r</span><span class="op" id="8595639">.</span><span class="ident" id="8595640">ReadDotBytes</span><span class="op" id="8595652">(</span><span class="op" id="8595653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8595656">want</span>&nbsp;<span class="op" id="8595661">=</span>&nbsp;<span class="op" id="8595663">[</span><span class="op" id="8595664">]</span><span class="builtintype" id="8595665">byte</span><span class="op" id="8595669">(</span><span class="string" id="8595670">&#34;anot.her\n&#34;</span><span class="op" id="8595682">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8595685">if</span>&nbsp;<span class="op" id="8595688">!</span><span class="ident" id="8595689">reflect</span><span class="op" id="8595696">.</span><span class="ident" id="8595697">DeepEqual</span><span class="op" id="8595706">(</span><span class="ident" id="8595707">b</span><span class="op" id="8595708">,</span>&nbsp;<span class="ident" id="8595710">want</span><span class="op" id="8595714">)</span>&nbsp;<span class="op" id="8595716">||</span>&nbsp;<span class="ident" id="8595719">err</span>&nbsp;<span class="op" id="8595723">!=</span>&nbsp;<span class="ident" id="8595726">io</span><span class="op" id="8595728">.</span><span class="ident" id="8595729">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="8595746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8595750">t</span><span class="op" id="8595751">.</span><span class="ident" id="8595752">Fatalf</span><span class="op" id="8595758">(</span><span class="string" id="8595759">&#34;ReadDotBytes2:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8595782">,</span>&nbsp;<span class="ident" id="8595784">b</span><span class="op" id="8595785">,</span>&nbsp;<span class="ident" id="8595787">err</span><span class="op" id="8595790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8595793">}</span><br>
<span class="lineno"></span><span class="op" id="8595795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="8595798">func</span>&nbsp;<span class="ident" id="8595803">TestReadMIMEHeader</span><span class="op" id="8595821">(</span><span class="ident" id="8595822">t</span>&nbsp;<span class="op" id="8595824">*</span><span class="ident" id="8595825">testing</span><span class="op" id="8595832">.</span><span class="ident" id="8595833">T</span><span class="op" id="8595834">)</span>&nbsp;<span class="op" id="8595836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8595839">r</span>&nbsp;<span class="op" id="8595841">:=</span>&nbsp;<span class="ident" id="8595844">reader</span><span class="op" id="8595850">(</span><span class="string" id="8595851">&#34;my-key:&nbsp;Value&nbsp;1&nbsp;&nbsp;\r\nLong-key:&nbsp;Even&nbsp;\n&nbsp;Longer&nbsp;Value\r\nmy-Key:&nbsp;Value&nbsp;2\r\n\n&#34;</span><span class="op" id="8595929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8595932">m</span><span class="op" id="8595933">,</span>&nbsp;<span class="ident" id="8595935">err</span>&nbsp;<span class="op" id="8595939">:=</span>&nbsp;<span class="ident" id="8595942">r</span><span class="op" id="8595943">.</span><span class="ident" id="8595944">ReadMIMEHeader</span><span class="op" id="8595958">(</span><span class="op" id="8595959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8595962">want</span>&nbsp;<span class="op" id="8595967">:=</span>&nbsp;<span class="ident" id="8595970">MIMEHeader</span><span class="op" id="8595980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8595984">&#34;My-Key&#34;</span><span class="op" id="8595992">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8595996">{</span><span class="string" id="8595997">&#34;Value&nbsp;1&#34;</span><span class="op" id="8596006">,</span>&nbsp;<span class="string" id="8596008">&#34;Value&nbsp;2&#34;</span><span class="op" id="8596017">}</span><span class="op" id="8596018">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8596022">&#34;Long-Key&#34;</span><span class="op" id="8596032">:</span>&nbsp;<span class="op" id="8596034">{</span><span class="string" id="8596035">&#34;Even&nbsp;Longer&nbsp;Value&#34;</span><span class="op" id="8596054">}</span><span class="op" id="8596055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8596058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8596061">if</span>&nbsp;<span class="op" id="8596064">!</span><span class="ident" id="8596065">reflect</span><span class="op" id="8596072">.</span><span class="ident" id="8596073">DeepEqual</span><span class="op" id="8596082">(</span><span class="ident" id="8596083">m</span><span class="op" id="8596084">,</span>&nbsp;<span class="ident" id="8596086">want</span><span class="op" id="8596090">)</span>&nbsp;<span class="op" id="8596092">||</span>&nbsp;<span class="ident" id="8596095">err</span>&nbsp;<span class="op" id="8596099">!=</span>&nbsp;<span class="ident" id="8596102">nil</span>&nbsp;<span class="op" id="8596106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8596110">t</span><span class="op" id="8596111">.</span><span class="ident" id="8596112">Fatalf</span><span class="op" id="8596118">(</span><span class="string" id="8596119">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8596152">,</span>&nbsp;<span class="ident" id="8596154">m</span><span class="op" id="8596155">,</span>&nbsp;<span class="ident" id="8596157">err</span><span class="op" id="8596160">,</span>&nbsp;<span class="ident" id="8596162">want</span><span class="op" id="8596166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8596169">}</span><br>
<span class="lineno">145</span><span class="op" id="8596171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8596174">func</span>&nbsp;<span class="ident" id="8596179">TestReadMIMEHeaderSingle</span><span class="op" id="8596203">(</span><span class="ident" id="8596204">t</span>&nbsp;<span class="op" id="8596206">*</span><span class="ident" id="8596207">testing</span><span class="op" id="8596214">.</span><span class="ident" id="8596215">T</span><span class="op" id="8596216">)</span>&nbsp;<span class="op" id="8596218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8596221">r</span>&nbsp;<span class="op" id="8596223">:=</span>&nbsp;<span class="ident" id="8596226">reader</span><span class="op" id="8596232">(</span><span class="string" id="8596233">&#34;Foo:&nbsp;bar\n\n&#34;</span><span class="op" id="8596247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8596250">m</span><span class="op" id="8596251">,</span>&nbsp;<span class="ident" id="8596253">err</span>&nbsp;<span class="op" id="8596257">:=</span>&nbsp;<span class="ident" id="8596260">r</span><span class="op" id="8596261">.</span><span class="ident" id="8596262">ReadMIMEHeader</span><span class="op" id="8596276">(</span><span class="op" id="8596277">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8596280">want</span>&nbsp;<span class="op" id="8596285">:=</span>&nbsp;<span class="ident" id="8596288">MIMEHeader</span><span class="op" id="8596298">{</span><span class="string" id="8596299">&#34;Foo&#34;</span><span class="op" id="8596304">:</span>&nbsp;<span class="op" id="8596306">{</span><span class="string" id="8596307">&#34;bar&#34;</span><span class="op" id="8596312">}</span><span class="op" id="8596313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8596316">if</span>&nbsp;<span class="op" id="8596319">!</span><span class="ident" id="8596320">reflect</span><span class="op" id="8596327">.</span><span class="ident" id="8596328">DeepEqual</span><span class="op" id="8596337">(</span><span class="ident" id="8596338">m</span><span class="op" id="8596339">,</span>&nbsp;<span class="ident" id="8596341">want</span><span class="op" id="8596345">)</span>&nbsp;<span class="op" id="8596347">||</span>&nbsp;<span class="ident" id="8596350">err</span>&nbsp;<span class="op" id="8596354">!=</span>&nbsp;<span class="ident" id="8596357">nil</span>&nbsp;<span class="op" id="8596361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8596365">t</span><span class="op" id="8596366">.</span><span class="ident" id="8596367">Fatalf</span><span class="op" id="8596373">(</span><span class="string" id="8596374">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8596407">,</span>&nbsp;<span class="ident" id="8596409">m</span><span class="op" id="8596410">,</span>&nbsp;<span class="ident" id="8596412">err</span><span class="op" id="8596415">,</span>&nbsp;<span class="ident" id="8596417">want</span><span class="op" id="8596421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8596424">}</span><br>
<span class="lineno"></span><span class="op" id="8596426">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="8596429">func</span>&nbsp;<span class="ident" id="8596434">TestLargeReadMIMEHeader</span><span class="op" id="8596457">(</span><span class="ident" id="8596458">t</span>&nbsp;<span class="op" id="8596460">*</span><span class="ident" id="8596461">testing</span><span class="op" id="8596468">.</span><span class="ident" id="8596469">T</span><span class="op" id="8596470">)</span>&nbsp;<span class="op" id="8596472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8596475">data</span>&nbsp;<span class="op" id="8596480">:=</span>&nbsp;<span class="builtinfunc" id="8596483">make</span><span class="op" id="8596487">(</span><span class="op" id="8596488">[</span><span class="op" id="8596489">]</span><span class="builtintype" id="8596490">byte</span><span class="op" id="8596494">,</span>&nbsp;<span class="num" id="8596496">16</span><span class="op" id="8596498">*</span><span class="num" id="8596499">1024</span><span class="op" id="8596503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8596506">for</span>&nbsp;<span class="ident" id="8596510">i</span>&nbsp;<span class="op" id="8596512">:=</span>&nbsp;<span class="num" id="8596515">0</span><span class="op" id="8596516">;</span>&nbsp;<span class="ident" id="8596518">i</span>&nbsp;<span class="op" id="8596520">&lt;</span>&nbsp;<span class="builtinfunc" id="8596522">len</span><span class="op" id="8596525">(</span><span class="ident" id="8596526">data</span><span class="op" id="8596530">)</span><span class="op" id="8596531">;</span>&nbsp;<span class="ident" id="8596533">i</span><span class="op" id="8596534">++</span>&nbsp;<span class="op" id="8596537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8596541">data</span><span class="op" id="8596545">[</span><span class="ident" id="8596546">i</span><span class="op" id="8596547">]</span>&nbsp;<span class="op" id="8596549">=</span>&nbsp;<span class="string" id="8596551">&#39;x&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8596556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8596559">sdata</span>&nbsp;<span class="op" id="8596565">:=</span>&nbsp;<span class="builtintype" id="8596568">string</span><span class="op" id="8596574">(</span><span class="ident" id="8596575">data</span><span class="op" id="8596579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8596582">r</span>&nbsp;<span class="op" id="8596584">:=</span>&nbsp;<span class="ident" id="8596587">reader</span><span class="op" id="8596593">(</span><span class="string" id="8596594">&#34;Cookie:&nbsp;&#34;</span>&nbsp;<span class="op" id="8596605">+</span>&nbsp;<span class="ident" id="8596607">sdata</span>&nbsp;<span class="op" id="8596613">+</span>&nbsp;<span class="string" id="8596615">&#34;\r\n\n&#34;</span><span class="op" id="8596623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8596626">m</span><span class="op" id="8596627">,</span>&nbsp;<span class="ident" id="8596629">err</span>&nbsp;<span class="op" id="8596633">:=</span>&nbsp;<span class="ident" id="8596636">r</span><span class="op" id="8596637">.</span><span class="ident" id="8596638">ReadMIMEHeader</span><span class="op" id="8596652">(</span><span class="op" id="8596653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8596656">if</span>&nbsp;<span class="ident" id="8596659">err</span>&nbsp;<span class="op" id="8596663">!=</span>&nbsp;<span class="ident" id="8596666">nil</span>&nbsp;<span class="op" id="8596670">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8596674">t</span><span class="op" id="8596675">.</span><span class="ident" id="8596676">Fatalf</span><span class="op" id="8596682">(</span><span class="string" id="8596683">&#34;ReadMIMEHeader:&nbsp;%v&#34;</span><span class="op" id="8596703">,</span>&nbsp;<span class="ident" id="8596705">err</span><span class="op" id="8596708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8596711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8596714">cookie</span>&nbsp;<span class="op" id="8596721">:=</span>&nbsp;<span class="ident" id="8596724">m</span><span class="op" id="8596725">.</span><span class="ident" id="8596726">Get</span><span class="op" id="8596729">(</span><span class="string" id="8596730">&#34;Cookie&#34;</span><span class="op" id="8596738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8596741">if</span>&nbsp;<span class="ident" id="8596744">cookie</span>&nbsp;<span class="op" id="8596751">!=</span>&nbsp;<span class="ident" id="8596754">sdata</span>&nbsp;<span class="op" id="8596760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8596764">t</span><span class="op" id="8596765">.</span><span class="ident" id="8596766">Fatalf</span><span class="op" id="8596772">(</span><span class="string" id="8596773">&#34;ReadMIMEHeader:&nbsp;%v&nbsp;bytes,&nbsp;want&nbsp;%v&nbsp;bytes&#34;</span><span class="op" id="8596814">,</span>&nbsp;<span class="builtinfunc" id="8596816">len</span><span class="op" id="8596819">(</span><span class="ident" id="8596820">cookie</span><span class="op" id="8596826">)</span><span class="op" id="8596827">,</span>&nbsp;<span class="builtinfunc" id="8596829">len</span><span class="op" id="8596832">(</span><span class="ident" id="8596833">sdata</span><span class="op" id="8596838">)</span><span class="op" id="8596839">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8596842">}</span><br>
<span class="lineno"></span><span class="op" id="8596844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8596847">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;read&nbsp;slightly-bogus&nbsp;MIME&nbsp;headers&nbsp;seen&nbsp;in&nbsp;the&nbsp;wild,</span><br>
<span class="lineno"></span><span class="comment" id="8596914">//&nbsp;with&nbsp;spaces&nbsp;before&nbsp;colons,&nbsp;and&nbsp;spaces&nbsp;in&nbsp;keys.</span><br>
<span class="lineno">175</span><span class="keyword" id="8596964">func</span>&nbsp;<span class="ident" id="8596969">TestReadMIMEHeaderNonCompliant</span><span class="op" id="8596999">(</span><span class="ident" id="8597000">t</span>&nbsp;<span class="op" id="8597002">*</span><span class="ident" id="8597003">testing</span><span class="op" id="8597010">.</span><span class="ident" id="8597011">T</span><span class="op" id="8597012">)</span>&nbsp;<span class="op" id="8597014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8597017">//&nbsp;Invalid&nbsp;HTTP&nbsp;response&nbsp;header&nbsp;as&nbsp;sent&nbsp;by&nbsp;an&nbsp;Axis&nbsp;security</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8597078">//&nbsp;camera:&nbsp;(this&nbsp;is&nbsp;handled&nbsp;by&nbsp;IE,&nbsp;Firefox,&nbsp;Chrome,&nbsp;curl,&nbsp;etc.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8597143">r</span>&nbsp;<span class="op" id="8597145">:=</span>&nbsp;<span class="ident" id="8597148">reader</span><span class="op" id="8597154">(</span><span class="string" id="8597155">&#34;Foo:&nbsp;bar\r\n&#34;</span>&nbsp;<span class="op" id="8597170">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8597174">&#34;Content-Language:&nbsp;en\r\n&#34;</span>&nbsp;<span class="op" id="8597201">+</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8597205">&#34;SID&nbsp;:&nbsp;0\r\n&#34;</span>&nbsp;<span class="op" id="8597219">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8597223">&#34;Audio&nbsp;Mode&nbsp;:&nbsp;None\r\n&#34;</span>&nbsp;<span class="op" id="8597247">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8597251">&#34;Privilege&nbsp;:&nbsp;127\r\n\r\n&#34;</span><span class="op" id="8597276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8597279">m</span><span class="op" id="8597280">,</span>&nbsp;<span class="ident" id="8597282">err</span>&nbsp;<span class="op" id="8597286">:=</span>&nbsp;<span class="ident" id="8597289">r</span><span class="op" id="8597290">.</span><span class="ident" id="8597291">ReadMIMEHeader</span><span class="op" id="8597305">(</span><span class="op" id="8597306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8597309">want</span>&nbsp;<span class="op" id="8597314">:=</span>&nbsp;<span class="ident" id="8597317">MIMEHeader</span><span class="op" id="8597327">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8597331">&#34;Foo&#34;</span><span class="op" id="8597336">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8597351">{</span><span class="string" id="8597352">&#34;bar&#34;</span><span class="op" id="8597357">}</span><span class="op" id="8597358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8597362">&#34;Content-Language&#34;</span><span class="op" id="8597380">:</span>&nbsp;<span class="op" id="8597382">{</span><span class="string" id="8597383">&#34;en&#34;</span><span class="op" id="8597387">}</span><span class="op" id="8597388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8597392">&#34;Sid&#34;</span><span class="op" id="8597397">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8597412">{</span><span class="string" id="8597413">&#34;0&#34;</span><span class="op" id="8597416">}</span><span class="op" id="8597417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8597421">&#34;Audio-Mode&#34;</span><span class="op" id="8597433">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8597441">{</span><span class="string" id="8597442">&#34;None&#34;</span><span class="op" id="8597448">}</span><span class="op" id="8597449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8597453">&#34;Privilege&#34;</span><span class="op" id="8597464">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8597473">{</span><span class="string" id="8597474">&#34;127&#34;</span><span class="op" id="8597479">}</span><span class="op" id="8597480">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8597483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8597486">if</span>&nbsp;<span class="op" id="8597489">!</span><span class="ident" id="8597490">reflect</span><span class="op" id="8597497">.</span><span class="ident" id="8597498">DeepEqual</span><span class="op" id="8597507">(</span><span class="ident" id="8597508">m</span><span class="op" id="8597509">,</span>&nbsp;<span class="ident" id="8597511">want</span><span class="op" id="8597515">)</span>&nbsp;<span class="op" id="8597517">||</span>&nbsp;<span class="ident" id="8597520">err</span>&nbsp;<span class="op" id="8597524">!=</span>&nbsp;<span class="ident" id="8597527">nil</span>&nbsp;<span class="op" id="8597531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8597535">t</span><span class="op" id="8597536">.</span><span class="ident" id="8597537">Fatalf</span><span class="op" id="8597543">(</span><span class="string" id="8597544">&#34;ReadMIMEHeader&nbsp;=\n%v,&nbsp;%v;&nbsp;want:\n%v&#34;</span><span class="op" id="8597581">,</span>&nbsp;<span class="ident" id="8597583">m</span><span class="op" id="8597584">,</span>&nbsp;<span class="ident" id="8597586">err</span><span class="op" id="8597589">,</span>&nbsp;<span class="ident" id="8597591">want</span><span class="op" id="8597595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8597598">}</span><br>
<span class="lineno"></span><span class="op" id="8597600">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="8597603">type</span>&nbsp;<span class="ident" id="8597608">readResponseTest</span>&nbsp;<span class="keyword" id="8597625">struct</span>&nbsp;<span class="op" id="8597632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8597635">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8597644">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8597652">inCode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8597661">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8597666">wantCode</span>&nbsp;<span class="builtintype" id="8597675">int</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8597680">wantMsg</span>&nbsp;&nbsp;<span class="builtintype" id="8597689">string</span><br>
<span class="lineno"></span><span class="op" id="8597696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8597699">var</span>&nbsp;<span class="ident" id="8597703">readResponseTests</span>&nbsp;<span class="op" id="8597721">=</span>&nbsp;<span class="op" id="8597723">[</span><span class="op" id="8597724">]</span><span class="ident" id="8597725">readResponseTest</span><span class="op" id="8597741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8597744">{</span><span class="string" id="8597745">&#34;230-Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span>&nbsp;<span class="op" id="8597798">+</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8597802">&#34;Read&nbsp;the&nbsp;file&nbsp;README.txt,\n&#34;</span>&nbsp;<span class="op" id="8597832">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8597836">&#34;230&nbsp;&nbsp;please&#34;</span><span class="op" id="8597849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8597853">23</span><span class="op" id="8597855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8597859">230</span><span class="op" id="8597862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8597866">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\nRead&nbsp;the&nbsp;file&nbsp;README.txt,\n&nbsp;please&#34;</span><span class="op" id="8597948">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8597951">}</span><span class="op" id="8597952">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8597956">{</span><span class="string" id="8597957">&#34;230&nbsp;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span><span class="op" id="8598009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8598013">23</span><span class="op" id="8598015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8598019">230</span><span class="op" id="8598022">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8598026">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply&#34;</span><span class="op" id="8598072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8598075">}</span><span class="op" id="8598076">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8598080">{</span><span class="string" id="8598081">&#34;400-A\n400-B\n400&nbsp;C&#34;</span><span class="op" id="8598102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8598106">4</span><span class="op" id="8598107">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8598111">400</span><span class="op" id="8598114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8598118">&#34;A\nB\nC&#34;</span><span class="op" id="8598127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8598130">}</span><span class="op" id="8598131">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8598135">{</span><span class="string" id="8598136">&#34;400-A\r\n400-B\r\n400&nbsp;C\r\n&#34;</span><span class="op" id="8598165">,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8598169">4</span><span class="op" id="8598170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8598174">400</span><span class="op" id="8598177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8598181">&#34;A\nB\nC&#34;</span><span class="op" id="8598190">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8598193">}</span><span class="op" id="8598194">,</span><br>
<span class="lineno"></span><span class="op" id="8598196">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="8598199">//&nbsp;See&nbsp;http://www.ietf.org/rfc/rfc959.txt&nbsp;page&nbsp;36.</span><br>
<span class="lineno"></span><span class="keyword" id="8598250">func</span>&nbsp;<span class="ident" id="8598255">TestRFC959Lines</span><span class="op" id="8598270">(</span><span class="ident" id="8598271">t</span>&nbsp;<span class="op" id="8598273">*</span><span class="ident" id="8598274">testing</span><span class="op" id="8598281">.</span><span class="ident" id="8598282">T</span><span class="op" id="8598283">)</span>&nbsp;<span class="op" id="8598285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8598288">for</span>&nbsp;<span class="ident" id="8598292">i</span><span class="op" id="8598293">,</span>&nbsp;<span class="ident" id="8598295">tt</span>&nbsp;<span class="op" id="8598298">:=</span>&nbsp;<span class="keyword" id="8598301">range</span>&nbsp;<span class="ident" id="8598307">readResponseTests</span>&nbsp;<span class="op" id="8598325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8598329">r</span>&nbsp;<span class="op" id="8598331">:=</span>&nbsp;<span class="ident" id="8598334">reader</span><span class="op" id="8598340">(</span><span class="ident" id="8598341">tt</span><span class="op" id="8598343">.</span><span class="ident" id="8598344">in</span>&nbsp;<span class="op" id="8598347">+</span>&nbsp;<span class="string" id="8598349">&#34;\nFOLLOWING&nbsp;DATA&#34;</span><span class="op" id="8598367">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8598371">code</span><span class="op" id="8598375">,</span>&nbsp;<span class="ident" id="8598377">msg</span><span class="op" id="8598380">,</span>&nbsp;<span class="ident" id="8598382">err</span>&nbsp;<span class="op" id="8598386">:=</span>&nbsp;<span class="ident" id="8598389">r</span><span class="op" id="8598390">.</span><span class="ident" id="8598391">ReadResponse</span><span class="op" id="8598403">(</span><span class="ident" id="8598404">tt</span><span class="op" id="8598406">.</span><span class="ident" id="8598407">inCode</span><span class="op" id="8598413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8598417">if</span>&nbsp;<span class="ident" id="8598420">err</span>&nbsp;<span class="op" id="8598424">!=</span>&nbsp;<span class="ident" id="8598427">nil</span>&nbsp;<span class="op" id="8598431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8598436">t</span><span class="op" id="8598437">.</span><span class="ident" id="8598438">Errorf</span><span class="op" id="8598444">(</span><span class="string" id="8598445">&#34;#%d:&nbsp;ReadResponse:&nbsp;%v&#34;</span><span class="op" id="8598468">,</span>&nbsp;<span class="ident" id="8598470">i</span><span class="op" id="8598471">,</span>&nbsp;<span class="ident" id="8598473">err</span><span class="op" id="8598476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8598481">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8598492">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8598496">if</span>&nbsp;<span class="ident" id="8598499">code</span>&nbsp;<span class="op" id="8598504">!=</span>&nbsp;<span class="ident" id="8598507">tt</span><span class="op" id="8598509">.</span><span class="ident" id="8598510">wantCode</span>&nbsp;<span class="op" id="8598519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8598524">t</span><span class="op" id="8598525">.</span><span class="ident" id="8598526">Errorf</span><span class="op" id="8598532">(</span><span class="string" id="8598533">&#34;#%d:&nbsp;code=%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8598556">,</span>&nbsp;<span class="ident" id="8598558">i</span><span class="op" id="8598559">,</span>&nbsp;<span class="ident" id="8598561">code</span><span class="op" id="8598565">,</span>&nbsp;<span class="ident" id="8598567">tt</span><span class="op" id="8598569">.</span><span class="ident" id="8598570">wantCode</span><span class="op" id="8598578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8598582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8598586">if</span>&nbsp;<span class="ident" id="8598589">msg</span>&nbsp;<span class="op" id="8598593">!=</span>&nbsp;<span class="ident" id="8598596">tt</span><span class="op" id="8598598">.</span><span class="ident" id="8598599">wantMsg</span>&nbsp;<span class="op" id="8598607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8598612">t</span><span class="op" id="8598613">.</span><span class="ident" id="8598614">Errorf</span><span class="op" id="8598620">(</span><span class="string" id="8598621">&#34;#%d:&nbsp;msg=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8598643">,</span>&nbsp;<span class="ident" id="8598645">i</span><span class="op" id="8598646">,</span>&nbsp;<span class="ident" id="8598648">msg</span><span class="op" id="8598651">,</span>&nbsp;<span class="ident" id="8598653">tt</span><span class="op" id="8598655">.</span><span class="ident" id="8598656">wantMsg</span><span class="op" id="8598663">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8598667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8598670">}</span><br>
<span class="lineno"></span><span class="op" id="8598672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8598675">func</span>&nbsp;<span class="ident" id="8598680">TestCommonHeaders</span><span class="op" id="8598697">(</span><span class="ident" id="8598698">t</span>&nbsp;<span class="op" id="8598700">*</span><span class="ident" id="8598701">testing</span><span class="op" id="8598708">.</span><span class="ident" id="8598709">T</span><span class="op" id="8598710">)</span>&nbsp;<span class="op" id="8598712">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8598715">for</span>&nbsp;<span class="ident" id="8598719">h</span>&nbsp;<span class="op" id="8598721">:=</span>&nbsp;<span class="keyword" id="8598724">range</span>&nbsp;<span class="ident" id="8598730">commonHeader</span>&nbsp;<span class="op" id="8598743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8598747">if</span>&nbsp;<span class="ident" id="8598750">h</span>&nbsp;<span class="op" id="8598752">!=</span>&nbsp;<span class="ident" id="8598755">CanonicalMIMEHeaderKey</span><span class="op" id="8598777">(</span><span class="ident" id="8598778">h</span><span class="op" id="8598779">)</span>&nbsp;<span class="op" id="8598781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8598786">t</span><span class="op" id="8598787">.</span><span class="ident" id="8598788">Errorf</span><span class="op" id="8598794">(</span><span class="string" id="8598795">&#34;Non-canonical&nbsp;header&nbsp;%q&nbsp;in&nbsp;commonHeader&#34;</span><span class="op" id="8598836">,</span>&nbsp;<span class="ident" id="8598838">h</span><span class="op" id="8598839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8598843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8598846">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8598849">b</span>&nbsp;<span class="op" id="8598851">:=</span>&nbsp;<span class="op" id="8598854">[</span><span class="op" id="8598855">]</span><span class="builtintype" id="8598856">byte</span><span class="op" id="8598860">(</span><span class="string" id="8598861">&#34;content-Length&#34;</span><span class="op" id="8598877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8598880">want</span>&nbsp;<span class="op" id="8598885">:=</span>&nbsp;<span class="string" id="8598888">&#34;Content-Length&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8598906">n</span>&nbsp;<span class="op" id="8598908">:=</span>&nbsp;<span class="ident" id="8598911">testing</span><span class="op" id="8598918">.</span><span class="ident" id="8598919">AllocsPerRun</span><span class="op" id="8598931">(</span><span class="num" id="8598932">200</span><span class="op" id="8598935">,</span>&nbsp;<span class="keyword" id="8598937">func</span><span class="op" id="8598941">(</span><span class="op" id="8598942">)</span>&nbsp;<span class="op" id="8598944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8598948">if</span>&nbsp;<span class="ident" id="8598951">x</span>&nbsp;<span class="op" id="8598953">:=</span>&nbsp;<span class="ident" id="8598956">canonicalMIMEHeaderKey</span><span class="op" id="8598978">(</span><span class="ident" id="8598979">b</span><span class="op" id="8598980">)</span><span class="op" id="8598981">;</span>&nbsp;<span class="ident" id="8598983">x</span>&nbsp;<span class="op" id="8598985">!=</span>&nbsp;<span class="ident" id="8598988">want</span>&nbsp;<span class="op" id="8598993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8598998">t</span><span class="op" id="8598999">.</span><span class="ident" id="8599000">Fatalf</span><span class="op" id="8599006">(</span><span class="string" id="8599007">&#34;canonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8599049">,</span>&nbsp;<span class="ident" id="8599051">b</span><span class="op" id="8599052">,</span>&nbsp;<span class="ident" id="8599054">x</span><span class="op" id="8599055">,</span>&nbsp;<span class="ident" id="8599057">want</span><span class="op" id="8599061">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8599065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8599068">}</span><span class="op" id="8599069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8599072">if</span>&nbsp;<span class="ident" id="8599075">n</span>&nbsp;<span class="op" id="8599077">&gt;</span>&nbsp;<span class="num" id="8599079">0</span>&nbsp;<span class="op" id="8599081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8599085">t</span><span class="op" id="8599086">.</span><span class="ident" id="8599087">Errorf</span><span class="op" id="8599093">(</span><span class="string" id="8599094">&#34;canonicalMIMEHeaderKey&nbsp;allocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;0&#34;</span><span class="op" id="8599138">,</span>&nbsp;<span class="ident" id="8599140">n</span><span class="op" id="8599141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8599144">}</span><br>
<span class="lineno">265</span><span class="op" id="8599146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8599149">var</span>&nbsp;<span class="ident" id="8599153">clientHeaders</span>&nbsp;<span class="op" id="8599167">=</span>&nbsp;<span class="ident" id="8599169">strings</span><span class="op" id="8599176">.</span><span class="ident" id="8599177">Replace</span><span class="op" id="8599184">(</span><span class="string" id="8599185">`Host:&nbsp;golang.org<br>
<span class="lineno"></span>Connection:&nbsp;keep-alive<br>
<span class="lineno"></span>Cache-Control:&nbsp;max-age=0<br>
<span class="lineno">270</span>Accept:&nbsp;application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5<br>
<span class="lineno"></span>User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;U;&nbsp;Linux&nbsp;x86_64;&nbsp;en-US)&nbsp;AppleWebKit/534.3&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/6.0.472.63&nbsp;Safari/534.3<br>
<span class="lineno"></span>Accept-Encoding:&nbsp;gzip,deflate,sdch<br>
<span class="lineno"></span>Accept-Language:&nbsp;en-US,en;q=0.8,fr-CH;q=0.6<br>
<span class="lineno"></span>Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.3<br>
<span class="lineno">275</span>COOKIE:&nbsp;__utma=000000000.0000000000.0000000000.0000000000.0000000000.00;&nbsp;__utmb=000000000.0.00.0000000000;&nbsp;__utmc=000000000;&nbsp;__utmz=000000000.0000000000.00.0.utmcsr=code.google.com|utmccn=(referral)|utmcmd=referral|utmcct=/p/go/issues/detail<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno"></span>`</span><span class="op" id="8599862">,</span>&nbsp;<span class="string" id="8599864">&#34;\n&#34;</span><span class="op" id="8599868">,</span>&nbsp;<span class="string" id="8599870">&#34;\r\n&#34;</span><span class="op" id="8599876">,</span>&nbsp;<span class="op" id="8599878">-</span><span class="num" id="8599879">1</span><span class="op" id="8599880">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8599883">var</span>&nbsp;<span class="ident" id="8599887">serverHeaders</span>&nbsp;<span class="op" id="8599901">=</span>&nbsp;<span class="ident" id="8599903">strings</span><span class="op" id="8599910">.</span><span class="ident" id="8599911">Replace</span><span class="op" id="8599918">(</span><span class="string" id="8599919">`Content-Type:&nbsp;text/html;&nbsp;charset=utf-8<br>
<span class="lineno"></span>Content-Encoding:&nbsp;gzip<br>
<span class="lineno"></span>Date:&nbsp;Thu,&nbsp;27&nbsp;Sep&nbsp;2012&nbsp;09:03:33&nbsp;GMT<br>
<span class="lineno"></span>Server:&nbsp;Google&nbsp;Frontend<br>
<span class="lineno"></span>Cache-Control:&nbsp;private<br>
<span class="lineno">285</span>Content-Length:&nbsp;2298<br>
<span class="lineno"></span>VIA:&nbsp;1.1&nbsp;proxy.example.com:80&nbsp;(XXX/n.n.n-nnn)<br>
<span class="lineno"></span>Connection:&nbsp;Close<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno">290</span>`</span><span class="op" id="8600171">,</span>&nbsp;<span class="string" id="8600173">&#34;\n&#34;</span><span class="op" id="8600177">,</span>&nbsp;<span class="string" id="8600179">&#34;\r\n&#34;</span><span class="op" id="8600185">,</span>&nbsp;<span class="op" id="8600187">-</span><span class="num" id="8600188">1</span><span class="op" id="8600189">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8600192">func</span>&nbsp;<span class="ident" id="8600197">BenchmarkReadMIMEHeader</span><span class="op" id="8600220">(</span><span class="ident" id="8600221">b</span>&nbsp;<span class="op" id="8600223">*</span><span class="ident" id="8600224">testing</span><span class="op" id="8600231">.</span><span class="ident" id="8600232">B</span><span class="op" id="8600233">)</span>&nbsp;<span class="op" id="8600235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600238">b</span><span class="op" id="8600239">.</span><span class="ident" id="8600240">ReportAllocs</span><span class="op" id="8600252">(</span><span class="op" id="8600253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8600256">var</span>&nbsp;<span class="ident" id="8600260">buf</span>&nbsp;<span class="ident" id="8600264">bytes</span><span class="op" id="8600269">.</span><span class="ident" id="8600270">Buffer</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600278">br</span>&nbsp;<span class="op" id="8600281">:=</span>&nbsp;<span class="ident" id="8600284">bufio</span><span class="op" id="8600289">.</span><span class="ident" id="8600290">NewReader</span><span class="op" id="8600299">(</span><span class="op" id="8600300">&amp;</span><span class="ident" id="8600301">buf</span><span class="op" id="8600304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600307">r</span>&nbsp;<span class="op" id="8600309">:=</span>&nbsp;<span class="ident" id="8600312">NewReader</span><span class="op" id="8600321">(</span><span class="ident" id="8600322">br</span><span class="op" id="8600324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8600327">for</span>&nbsp;<span class="ident" id="8600331">i</span>&nbsp;<span class="op" id="8600333">:=</span>&nbsp;<span class="num" id="8600336">0</span><span class="op" id="8600337">;</span>&nbsp;<span class="ident" id="8600339">i</span>&nbsp;<span class="op" id="8600341">&lt;</span>&nbsp;<span class="ident" id="8600343">b</span><span class="op" id="8600344">.</span><span class="ident" id="8600345">N</span><span class="op" id="8600346">;</span>&nbsp;<span class="ident" id="8600348">i</span><span class="op" id="8600349">++</span>&nbsp;<span class="op" id="8600352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8600356">var</span>&nbsp;<span class="ident" id="8600360">want</span>&nbsp;<span class="builtintype" id="8600365">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8600371">var</span>&nbsp;<span class="ident" id="8600375">find</span>&nbsp;<span class="builtintype" id="8600380">string</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8600389">if</span>&nbsp;<span class="op" id="8600392">(</span><span class="ident" id="8600393">i</span>&nbsp;<span class="op" id="8600395">&amp;</span>&nbsp;<span class="num" id="8600397">1</span><span class="op" id="8600398">)</span>&nbsp;<span class="op" id="8600400">==</span>&nbsp;<span class="num" id="8600403">1</span>&nbsp;<span class="op" id="8600405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600410">buf</span><span class="op" id="8600413">.</span><span class="ident" id="8600414">WriteString</span><span class="op" id="8600425">(</span><span class="ident" id="8600426">clientHeaders</span><span class="op" id="8600439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600444">want</span>&nbsp;<span class="op" id="8600449">=</span>&nbsp;<span class="num" id="8600451">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600457">find</span>&nbsp;<span class="op" id="8600462">=</span>&nbsp;<span class="string" id="8600464">&#34;Cookie&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8600475">}</span>&nbsp;<span class="keyword" id="8600477">else</span>&nbsp;<span class="op" id="8600482">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600487">buf</span><span class="op" id="8600490">.</span><span class="ident" id="8600491">WriteString</span><span class="op" id="8600502">(</span><span class="ident" id="8600503">serverHeaders</span><span class="op" id="8600516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600521">want</span>&nbsp;<span class="op" id="8600526">=</span>&nbsp;<span class="num" id="8600528">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600533">find</span>&nbsp;<span class="op" id="8600538">=</span>&nbsp;<span class="string" id="8600540">&#34;Via&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8600548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600552">h</span><span class="op" id="8600553">,</span>&nbsp;<span class="ident" id="8600555">err</span>&nbsp;<span class="op" id="8600559">:=</span>&nbsp;<span class="ident" id="8600562">r</span><span class="op" id="8600563">.</span><span class="ident" id="8600564">ReadMIMEHeader</span><span class="op" id="8600578">(</span><span class="op" id="8600579">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8600583">if</span>&nbsp;<span class="ident" id="8600586">err</span>&nbsp;<span class="op" id="8600590">!=</span>&nbsp;<span class="ident" id="8600593">nil</span>&nbsp;<span class="op" id="8600597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600602">b</span><span class="op" id="8600603">.</span><span class="ident" id="8600604">Fatal</span><span class="op" id="8600609">(</span><span class="ident" id="8600610">err</span><span class="op" id="8600613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8600617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8600621">if</span>&nbsp;<span class="builtinfunc" id="8600624">len</span><span class="op" id="8600627">(</span><span class="ident" id="8600628">h</span><span class="op" id="8600629">)</span>&nbsp;<span class="op" id="8600631">!=</span>&nbsp;<span class="ident" id="8600634">want</span>&nbsp;<span class="op" id="8600639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600644">b</span><span class="op" id="8600645">.</span><span class="ident" id="8600646">Fatalf</span><span class="op" id="8600652">(</span><span class="string" id="8600653">&#34;wrong&nbsp;number&nbsp;of&nbsp;headers:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8600695">,</span>&nbsp;<span class="builtinfunc" id="8600697">len</span><span class="op" id="8600700">(</span><span class="ident" id="8600701">h</span><span class="op" id="8600702">)</span><span class="op" id="8600703">,</span>&nbsp;<span class="ident" id="8600705">want</span><span class="op" id="8600709">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8600713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8600717">if</span>&nbsp;<span class="ident" id="8600720">_</span><span class="op" id="8600721">,</span>&nbsp;<span class="ident" id="8600723">ok</span>&nbsp;<span class="op" id="8600726">:=</span>&nbsp;<span class="ident" id="8600729">h</span><span class="op" id="8600730">[</span><span class="ident" id="8600731">find</span><span class="op" id="8600735">]</span><span class="op" id="8600736">;</span>&nbsp;<span class="op" id="8600738">!</span><span class="ident" id="8600739">ok</span>&nbsp;<span class="op" id="8600742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600747">b</span><span class="op" id="8600748">.</span><span class="ident" id="8600749">Fatalf</span><span class="op" id="8600755">(</span><span class="string" id="8600756">&#34;did&nbsp;not&nbsp;find&nbsp;key&nbsp;%s&#34;</span><span class="op" id="8600777">,</span>&nbsp;<span class="ident" id="8600779">find</span><span class="op" id="8600783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8600787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8600790">}</span><br>
<span class="lineno">320</span><span class="op" id="8600792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8600795">func</span>&nbsp;<span class="ident" id="8600800">BenchmarkUncommon</span><span class="op" id="8600817">(</span><span class="ident" id="8600818">b</span>&nbsp;<span class="op" id="8600820">*</span><span class="ident" id="8600821">testing</span><span class="op" id="8600828">.</span><span class="ident" id="8600829">B</span><span class="op" id="8600830">)</span>&nbsp;<span class="op" id="8600832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600835">b</span><span class="op" id="8600836">.</span><span class="ident" id="8600837">ReportAllocs</span><span class="op" id="8600849">(</span><span class="op" id="8600850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8600853">var</span>&nbsp;<span class="ident" id="8600857">buf</span>&nbsp;<span class="ident" id="8600861">bytes</span><span class="op" id="8600866">.</span><span class="ident" id="8600867">Buffer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600875">br</span>&nbsp;<span class="op" id="8600878">:=</span>&nbsp;<span class="ident" id="8600881">bufio</span><span class="op" id="8600886">.</span><span class="ident" id="8600887">NewReader</span><span class="op" id="8600896">(</span><span class="op" id="8600897">&amp;</span><span class="ident" id="8600898">buf</span><span class="op" id="8600901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600904">r</span>&nbsp;<span class="op" id="8600906">:=</span>&nbsp;<span class="ident" id="8600909">NewReader</span><span class="op" id="8600918">(</span><span class="ident" id="8600919">br</span><span class="op" id="8600921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8600924">for</span>&nbsp;<span class="ident" id="8600928">i</span>&nbsp;<span class="op" id="8600930">:=</span>&nbsp;<span class="num" id="8600933">0</span><span class="op" id="8600934">;</span>&nbsp;<span class="ident" id="8600936">i</span>&nbsp;<span class="op" id="8600938">&lt;</span>&nbsp;<span class="ident" id="8600940">b</span><span class="op" id="8600941">.</span><span class="ident" id="8600942">N</span><span class="op" id="8600943">;</span>&nbsp;<span class="ident" id="8600945">i</span><span class="op" id="8600946">++</span>&nbsp;<span class="op" id="8600949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8600953">buf</span><span class="op" id="8600956">.</span><span class="ident" id="8600957">WriteString</span><span class="op" id="8600968">(</span><span class="string" id="8600969">&#34;uncommon-header-for-benchmark:&nbsp;foo\r\n\r\n&#34;</span><span class="op" id="8601013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8601017">h</span><span class="op" id="8601018">,</span>&nbsp;<span class="ident" id="8601020">err</span>&nbsp;<span class="op" id="8601024">:=</span>&nbsp;<span class="ident" id="8601027">r</span><span class="op" id="8601028">.</span><span class="ident" id="8601029">ReadMIMEHeader</span><span class="op" id="8601043">(</span><span class="op" id="8601044">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8601048">if</span>&nbsp;<span class="ident" id="8601051">err</span>&nbsp;<span class="op" id="8601055">!=</span>&nbsp;<span class="ident" id="8601058">nil</span>&nbsp;<span class="op" id="8601062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8601067">b</span><span class="op" id="8601068">.</span><span class="ident" id="8601069">Fatal</span><span class="op" id="8601074">(</span><span class="ident" id="8601075">err</span><span class="op" id="8601078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8601082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8601086">if</span>&nbsp;<span class="ident" id="8601089">_</span><span class="op" id="8601090">,</span>&nbsp;<span class="ident" id="8601092">ok</span>&nbsp;<span class="op" id="8601095">:=</span>&nbsp;<span class="ident" id="8601098">h</span><span class="op" id="8601099">[</span><span class="string" id="8601100">&#34;Uncommon-Header-For-Benchmark&#34;</span><span class="op" id="8601131">]</span><span class="op" id="8601132">;</span>&nbsp;<span class="op" id="8601134">!</span><span class="ident" id="8601135">ok</span>&nbsp;<span class="op" id="8601138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8601143">b</span><span class="op" id="8601144">.</span><span class="ident" id="8601145">Fatal</span><span class="op" id="8601150">(</span><span class="string" id="8601151">&#34;Missing&nbsp;result&nbsp;header.&#34;</span><span class="op" id="8601175">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8601179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8601182">}</span><br>
<span class="lineno"></span><span class="op" id="8601184">}</span>
</div>
</body>
</html>
