<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/sha1</h2>
<ul>
<li><a href="/gostd/crypto/sha1/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1.go.html" class="current">sha1.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1_test.go.html">sha1_test.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1block.go.html">sha1block.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1block_decl.go.html">sha1block_decl.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4029571">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4029626">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4029680">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4029731">//&nbsp;Package&nbsp;sha1&nbsp;implements&nbsp;the&nbsp;SHA1&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;3174.</span><br>
<span class="lineno"></span><span class="keyword" id="4029806">package</span>&nbsp;<span class="ident" id="4029814">sha1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4029820">import</span>&nbsp;<span class="op" id="4029827">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4029830">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4029840">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4029847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4029850">func</span>&nbsp;<span class="ident" id="4029855">init</span><span class="op" id="4029859">(</span><span class="op" id="4029860">)</span>&nbsp;<span class="op" id="4029862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4029865">crypto</span><span class="op" id="4029871">.</span><span class="ident" id="4029872">RegisterHash</span><span class="op" id="4029884">(</span><span class="ident" id="4029885">crypto</span><span class="op" id="4029891">.</span><span class="ident" id="4029892">SHA1</span><span class="op" id="4029896">,</span>&nbsp;<span class="ident" id="4029898">New</span><span class="op" id="4029901">)</span><br>
<span class="lineno">15</span><span class="op" id="4029903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4029906">//&nbsp;The&nbsp;size&nbsp;of&nbsp;a&nbsp;SHA1&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4029947">const</span>&nbsp;<span class="ident" id="4029953">Size</span>&nbsp;<span class="op" id="4029958">=</span>&nbsp;<span class="num" id="4029960">20</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4029964">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;SHA1&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4029999">const</span>&nbsp;<span class="ident" id="4030005">BlockSize</span>&nbsp;<span class="op" id="4030015">=</span>&nbsp;<span class="num" id="4030017">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4030021">const</span>&nbsp;<span class="op" id="4030027">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030030">chunk</span>&nbsp;<span class="op" id="4030036">=</span>&nbsp;<span class="num" id="4030038">64</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030042">init0</span>&nbsp;<span class="op" id="4030048">=</span>&nbsp;<span class="num" id="4030050">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030062">init1</span>&nbsp;<span class="op" id="4030068">=</span>&nbsp;<span class="num" id="4030070">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030082">init2</span>&nbsp;<span class="op" id="4030088">=</span>&nbsp;<span class="num" id="4030090">0x98BADCFE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030102">init3</span>&nbsp;<span class="op" id="4030108">=</span>&nbsp;<span class="num" id="4030110">0x10325476</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030122">init4</span>&nbsp;<span class="op" id="4030128">=</span>&nbsp;<span class="num" id="4030130">0xC3D2E1F0</span><br>
<span class="lineno">30</span><span class="op" id="4030141">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4030144">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4030203">type</span>&nbsp;<span class="ident" id="4030208">digest</span>&nbsp;<span class="keyword" id="4030215">struct</span>&nbsp;<span class="op" id="4030222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030225">h</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4030229">[</span><span class="num" id="4030230">5</span><span class="op" id="4030231">]</span><span class="builtintype" id="4030232">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030240">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4030244">[</span><span class="ident" id="4030245">chunk</span><span class="op" id="4030250">]</span><span class="builtintype" id="4030251">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030257">nx</span>&nbsp;&nbsp;<span class="builtintype" id="4030261">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4030266">len</span>&nbsp;<span class="ident" id="4030270">uint64</span><br>
<span class="lineno"></span><span class="op" id="4030277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="4030280">func</span>&nbsp;<span class="op" id="4030285">(</span><span class="ident" id="4030286">d</span>&nbsp;<span class="op" id="4030288">*</span><span class="ident" id="4030289">digest</span><span class="op" id="4030295">)</span>&nbsp;<span class="ident" id="4030297">Reset</span><span class="op" id="4030302">(</span><span class="op" id="4030303">)</span>&nbsp;<span class="op" id="4030305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030308">d</span><span class="op" id="4030309">.</span><span class="ident" id="4030310">h</span><span class="op" id="4030311">[</span><span class="num" id="4030312">0</span><span class="op" id="4030313">]</span>&nbsp;<span class="op" id="4030315">=</span>&nbsp;<span class="ident" id="4030317">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030324">d</span><span class="op" id="4030325">.</span><span class="ident" id="4030326">h</span><span class="op" id="4030327">[</span><span class="num" id="4030328">1</span><span class="op" id="4030329">]</span>&nbsp;<span class="op" id="4030331">=</span>&nbsp;<span class="ident" id="4030333">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030340">d</span><span class="op" id="4030341">.</span><span class="ident" id="4030342">h</span><span class="op" id="4030343">[</span><span class="num" id="4030344">2</span><span class="op" id="4030345">]</span>&nbsp;<span class="op" id="4030347">=</span>&nbsp;<span class="ident" id="4030349">init2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030356">d</span><span class="op" id="4030357">.</span><span class="ident" id="4030358">h</span><span class="op" id="4030359">[</span><span class="num" id="4030360">3</span><span class="op" id="4030361">]</span>&nbsp;<span class="op" id="4030363">=</span>&nbsp;<span class="ident" id="4030365">init3</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030372">d</span><span class="op" id="4030373">.</span><span class="ident" id="4030374">h</span><span class="op" id="4030375">[</span><span class="num" id="4030376">4</span><span class="op" id="4030377">]</span>&nbsp;<span class="op" id="4030379">=</span>&nbsp;<span class="ident" id="4030381">init4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030388">d</span><span class="op" id="4030389">.</span><span class="ident" id="4030390">nx</span>&nbsp;<span class="op" id="4030393">=</span>&nbsp;<span class="num" id="4030395">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030398">d</span><span class="op" id="4030399">.</span><span class="builtinfunc" id="4030400">len</span>&nbsp;<span class="op" id="4030404">=</span>&nbsp;<span class="num" id="4030406">0</span><br>
<span class="lineno"></span><span class="op" id="4030408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4030411">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;SHA1&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4030471">func</span>&nbsp;<span class="ident" id="4030476">New</span><span class="op" id="4030479">(</span><span class="op" id="4030480">)</span>&nbsp;<span class="ident" id="4030482">hash</span><span class="op" id="4030486">.</span><span class="ident" id="4030487">Hash</span>&nbsp;<span class="op" id="4030492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030495">d</span>&nbsp;<span class="op" id="4030497">:=</span>&nbsp;<span class="builtinfunc" id="4030500">new</span><span class="op" id="4030503">(</span><span class="ident" id="4030504">digest</span><span class="op" id="4030510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030513">d</span><span class="op" id="4030514">.</span><span class="ident" id="4030515">Reset</span><span class="op" id="4030520">(</span><span class="op" id="4030521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4030524">return</span>&nbsp;<span class="ident" id="4030531">d</span><br>
<span class="lineno">55</span><span class="op" id="4030533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4030536">func</span>&nbsp;<span class="op" id="4030541">(</span><span class="ident" id="4030542">d</span>&nbsp;<span class="op" id="4030544">*</span><span class="ident" id="4030545">digest</span><span class="op" id="4030551">)</span>&nbsp;<span class="ident" id="4030553">Size</span><span class="op" id="4030557">(</span><span class="op" id="4030558">)</span>&nbsp;<span class="builtintype" id="4030560">int</span>&nbsp;<span class="op" id="4030564">{</span>&nbsp;<span class="keyword" id="4030566">return</span>&nbsp;<span class="ident" id="4030573">Size</span>&nbsp;<span class="op" id="4030578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4030581">func</span>&nbsp;<span class="op" id="4030586">(</span><span class="ident" id="4030587">d</span>&nbsp;<span class="op" id="4030589">*</span><span class="ident" id="4030590">digest</span><span class="op" id="4030596">)</span>&nbsp;<span class="ident" id="4030598">BlockSize</span><span class="op" id="4030607">(</span><span class="op" id="4030608">)</span>&nbsp;<span class="builtintype" id="4030610">int</span>&nbsp;<span class="op" id="4030614">{</span>&nbsp;<span class="keyword" id="4030616">return</span>&nbsp;<span class="ident" id="4030623">BlockSize</span>&nbsp;<span class="op" id="4030633">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4030636">func</span>&nbsp;<span class="op" id="4030641">(</span><span class="ident" id="4030642">d</span>&nbsp;<span class="op" id="4030644">*</span><span class="ident" id="4030645">digest</span><span class="op" id="4030651">)</span>&nbsp;<span class="ident" id="4030653">Write</span><span class="op" id="4030658">(</span><span class="ident" id="4030659">p</span>&nbsp;<span class="op" id="4030661">[</span><span class="op" id="4030662">]</span><span class="builtintype" id="4030663">byte</span><span class="op" id="4030667">)</span>&nbsp;<span class="op" id="4030669">(</span><span class="ident" id="4030670">nn</span>&nbsp;<span class="builtintype" id="4030673">int</span><span class="op" id="4030676">,</span>&nbsp;<span class="ident" id="4030678">err</span>&nbsp;<span class="builtintype" id="4030682">error</span><span class="op" id="4030687">)</span>&nbsp;<span class="op" id="4030689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030692">nn</span>&nbsp;<span class="op" id="4030695">=</span>&nbsp;<span class="builtinfunc" id="4030697">len</span><span class="op" id="4030700">(</span><span class="ident" id="4030701">p</span><span class="op" id="4030702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030705">d</span><span class="op" id="4030706">.</span><span class="builtinfunc" id="4030707">len</span>&nbsp;<span class="op" id="4030711">+=</span>&nbsp;<span class="ident" id="4030714">uint64</span><span class="op" id="4030720">(</span><span class="ident" id="4030721">nn</span><span class="op" id="4030723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4030726">if</span>&nbsp;<span class="ident" id="4030729">d</span><span class="op" id="4030730">.</span><span class="ident" id="4030731">nx</span>&nbsp;<span class="op" id="4030734">&gt;</span>&nbsp;<span class="num" id="4030736">0</span>&nbsp;<span class="op" id="4030738">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030742">n</span>&nbsp;<span class="op" id="4030744">:=</span>&nbsp;<span class="builtinfunc" id="4030747">copy</span><span class="op" id="4030751">(</span><span class="ident" id="4030752">d</span><span class="op" id="4030753">.</span><span class="ident" id="4030754">x</span><span class="op" id="4030755">[</span><span class="ident" id="4030756">d</span><span class="op" id="4030757">.</span><span class="ident" id="4030758">nx</span><span class="op" id="4030760">:</span><span class="op" id="4030761">]</span><span class="op" id="4030762">,</span>&nbsp;<span class="ident" id="4030764">p</span><span class="op" id="4030765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030769">d</span><span class="op" id="4030770">.</span><span class="ident" id="4030771">nx</span>&nbsp;<span class="op" id="4030774">+=</span>&nbsp;<span class="ident" id="4030777">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4030781">if</span>&nbsp;<span class="ident" id="4030784">d</span><span class="op" id="4030785">.</span><span class="ident" id="4030786">nx</span>&nbsp;<span class="op" id="4030789">==</span>&nbsp;<span class="ident" id="4030792">chunk</span>&nbsp;<span class="op" id="4030798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030803">block</span><span class="op" id="4030808">(</span><span class="ident" id="4030809">d</span><span class="op" id="4030810">,</span>&nbsp;<span class="ident" id="4030812">d</span><span class="op" id="4030813">.</span><span class="ident" id="4030814">x</span><span class="op" id="4030815">[</span><span class="op" id="4030816">:</span><span class="op" id="4030817">]</span><span class="op" id="4030818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030823">d</span><span class="op" id="4030824">.</span><span class="ident" id="4030825">nx</span>&nbsp;<span class="op" id="4030828">=</span>&nbsp;<span class="num" id="4030830">0</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4030834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030838">p</span>&nbsp;<span class="op" id="4030840">=</span>&nbsp;<span class="ident" id="4030842">p</span><span class="op" id="4030843">[</span><span class="ident" id="4030844">n</span><span class="op" id="4030845">:</span><span class="op" id="4030846">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4030849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4030852">if</span>&nbsp;<span class="builtinfunc" id="4030855">len</span><span class="op" id="4030858">(</span><span class="ident" id="4030859">p</span><span class="op" id="4030860">)</span>&nbsp;<span class="op" id="4030862">&gt;=</span>&nbsp;<span class="ident" id="4030865">chunk</span>&nbsp;<span class="op" id="4030871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030875">n</span>&nbsp;<span class="op" id="4030877">:=</span>&nbsp;<span class="builtinfunc" id="4030880">len</span><span class="op" id="4030883">(</span><span class="ident" id="4030884">p</span><span class="op" id="4030885">)</span>&nbsp;<span class="op" id="4030887">&amp;^</span>&nbsp;<span class="op" id="4030890">(</span><span class="ident" id="4030891">chunk</span>&nbsp;<span class="op" id="4030897">-</span>&nbsp;<span class="num" id="4030899">1</span><span class="op" id="4030900">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030904">block</span><span class="op" id="4030909">(</span><span class="ident" id="4030910">d</span><span class="op" id="4030911">,</span>&nbsp;<span class="ident" id="4030913">p</span><span class="op" id="4030914">[</span><span class="op" id="4030915">:</span><span class="ident" id="4030916">n</span><span class="op" id="4030917">]</span><span class="op" id="4030918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030922">p</span>&nbsp;<span class="op" id="4030924">=</span>&nbsp;<span class="ident" id="4030926">p</span><span class="op" id="4030927">[</span><span class="ident" id="4030928">n</span><span class="op" id="4030929">:</span><span class="op" id="4030930">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4030933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4030936">if</span>&nbsp;<span class="builtinfunc" id="4030939">len</span><span class="op" id="4030942">(</span><span class="ident" id="4030943">p</span><span class="op" id="4030944">)</span>&nbsp;<span class="op" id="4030946">&gt;</span>&nbsp;<span class="num" id="4030948">0</span>&nbsp;<span class="op" id="4030950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4030954">d</span><span class="op" id="4030955">.</span><span class="ident" id="4030956">nx</span>&nbsp;<span class="op" id="4030959">=</span>&nbsp;<span class="builtinfunc" id="4030961">copy</span><span class="op" id="4030965">(</span><span class="ident" id="4030966">d</span><span class="op" id="4030967">.</span><span class="ident" id="4030968">x</span><span class="op" id="4030969">[</span><span class="op" id="4030970">:</span><span class="op" id="4030971">]</span><span class="op" id="4030972">,</span>&nbsp;<span class="ident" id="4030974">p</span><span class="op" id="4030975">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4030978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4030981">return</span><br>
<span class="lineno"></span><span class="op" id="4030988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4030991">func</span>&nbsp;<span class="op" id="4030996">(</span><span class="ident" id="4030997">d0</span>&nbsp;<span class="op" id="4031000">*</span><span class="ident" id="4031001">digest</span><span class="op" id="4031007">)</span>&nbsp;<span class="ident" id="4031009">Sum</span><span class="op" id="4031012">(</span><span class="ident" id="4031013">in</span>&nbsp;<span class="op" id="4031016">[</span><span class="op" id="4031017">]</span><span class="builtintype" id="4031018">byte</span><span class="op" id="4031022">)</span>&nbsp;<span class="op" id="4031024">[</span><span class="op" id="4031025">]</span><span class="builtintype" id="4031026">byte</span>&nbsp;<span class="op" id="4031031">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4031034">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031101">d</span>&nbsp;<span class="op" id="4031103">:=</span>&nbsp;<span class="op" id="4031106">*</span><span class="ident" id="4031107">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031111">hash</span>&nbsp;<span class="op" id="4031116">:=</span>&nbsp;<span class="ident" id="4031119">d</span><span class="op" id="4031120">.</span><span class="ident" id="4031121">checkSum</span><span class="op" id="4031129">(</span><span class="op" id="4031130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031133">return</span>&nbsp;<span class="builtinfunc" id="4031140">append</span><span class="op" id="4031146">(</span><span class="ident" id="4031147">in</span><span class="op" id="4031149">,</span>&nbsp;<span class="ident" id="4031151">hash</span><span class="op" id="4031155">[</span><span class="op" id="4031156">:</span><span class="op" id="4031157">]</span><span class="op" id="4031158">...</span><span class="op" id="4031161">)</span><br>
<span class="lineno"></span><span class="op" id="4031163">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="4031166">func</span>&nbsp;<span class="op" id="4031171">(</span><span class="ident" id="4031172">d</span>&nbsp;<span class="op" id="4031174">*</span><span class="ident" id="4031175">digest</span><span class="op" id="4031181">)</span>&nbsp;<span class="ident" id="4031183">checkSum</span><span class="op" id="4031191">(</span><span class="op" id="4031192">)</span>&nbsp;<span class="op" id="4031194">[</span><span class="ident" id="4031195">Size</span><span class="op" id="4031199">]</span><span class="builtintype" id="4031200">byte</span>&nbsp;<span class="op" id="4031205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4031208">len</span>&nbsp;<span class="op" id="4031212">:=</span>&nbsp;<span class="ident" id="4031215">d</span><span class="op" id="4031216">.</span><span class="builtinfunc" id="4031217">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4031222">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031282">var</span>&nbsp;<span class="ident" id="4031286">tmp</span>&nbsp;<span class="op" id="4031290">[</span><span class="num" id="4031291">64</span><span class="op" id="4031293">]</span><span class="builtintype" id="4031294">byte</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031300">tmp</span><span class="op" id="4031303">[</span><span class="num" id="4031304">0</span><span class="op" id="4031305">]</span>&nbsp;<span class="op" id="4031307">=</span>&nbsp;<span class="num" id="4031309">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031315">if</span>&nbsp;<span class="builtinfunc" id="4031318">len</span><span class="op" id="4031321">%</span><span class="num" id="4031322">64</span>&nbsp;<span class="op" id="4031325">&lt;</span>&nbsp;<span class="num" id="4031327">56</span>&nbsp;<span class="op" id="4031330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031334">d</span><span class="op" id="4031335">.</span><span class="ident" id="4031336">Write</span><span class="op" id="4031341">(</span><span class="ident" id="4031342">tmp</span><span class="op" id="4031345">[</span><span class="num" id="4031346">0</span>&nbsp;<span class="op" id="4031348">:</span>&nbsp;<span class="num" id="4031350">56</span><span class="op" id="4031352">-</span><span class="builtinfunc" id="4031353">len</span><span class="op" id="4031356">%</span><span class="num" id="4031357">64</span><span class="op" id="4031359">]</span><span class="op" id="4031360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4031363">}</span>&nbsp;<span class="keyword" id="4031365">else</span>&nbsp;<span class="op" id="4031370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031374">d</span><span class="op" id="4031375">.</span><span class="ident" id="4031376">Write</span><span class="op" id="4031381">(</span><span class="ident" id="4031382">tmp</span><span class="op" id="4031385">[</span><span class="num" id="4031386">0</span>&nbsp;<span class="op" id="4031388">:</span>&nbsp;<span class="num" id="4031390">64</span><span class="op" id="4031392">+</span><span class="num" id="4031393">56</span><span class="op" id="4031395">-</span><span class="builtinfunc" id="4031396">len</span><span class="op" id="4031399">%</span><span class="num" id="4031400">64</span><span class="op" id="4031402">]</span><span class="op" id="4031403">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4031406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4031410">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4031430">len</span>&nbsp;<span class="op" id="4031434">&lt;&lt;=</span>&nbsp;<span class="num" id="4031438">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031441">for</span>&nbsp;<span class="ident" id="4031445">i</span>&nbsp;<span class="op" id="4031447">:=</span>&nbsp;<span class="builtintype" id="4031450">uint</span><span class="op" id="4031454">(</span><span class="num" id="4031455">0</span><span class="op" id="4031456">)</span><span class="op" id="4031457">;</span>&nbsp;<span class="ident" id="4031459">i</span>&nbsp;<span class="op" id="4031461">&lt;</span>&nbsp;<span class="num" id="4031463">8</span><span class="op" id="4031464">;</span>&nbsp;<span class="ident" id="4031466">i</span><span class="op" id="4031467">++</span>&nbsp;<span class="op" id="4031470">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031474">tmp</span><span class="op" id="4031477">[</span><span class="ident" id="4031478">i</span><span class="op" id="4031479">]</span>&nbsp;<span class="op" id="4031481">=</span>&nbsp;<span class="builtintype" id="4031483">byte</span><span class="op" id="4031487">(</span><span class="builtinfunc" id="4031488">len</span>&nbsp;<span class="op" id="4031492">&gt;&gt;</span>&nbsp;<span class="op" id="4031495">(</span><span class="num" id="4031496">56</span>&nbsp;<span class="op" id="4031499">-</span>&nbsp;<span class="num" id="4031501">8</span><span class="op" id="4031502">*</span><span class="ident" id="4031503">i</span><span class="op" id="4031504">)</span><span class="op" id="4031505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4031508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031511">d</span><span class="op" id="4031512">.</span><span class="ident" id="4031513">Write</span><span class="op" id="4031518">(</span><span class="ident" id="4031519">tmp</span><span class="op" id="4031522">[</span><span class="num" id="4031523">0</span><span class="op" id="4031524">:</span><span class="num" id="4031525">8</span><span class="op" id="4031526">]</span><span class="op" id="4031527">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031531">if</span>&nbsp;<span class="ident" id="4031534">d</span><span class="op" id="4031535">.</span><span class="ident" id="4031536">nx</span>&nbsp;<span class="op" id="4031539">!=</span>&nbsp;<span class="num" id="4031542">0</span>&nbsp;<span class="op" id="4031544">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4031548">panic</span><span class="op" id="4031553">(</span><span class="string" id="4031554">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="4031565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4031568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031572">var</span>&nbsp;<span class="ident" id="4031576">digest</span>&nbsp;<span class="op" id="4031583">[</span><span class="ident" id="4031584">Size</span><span class="op" id="4031588">]</span><span class="builtintype" id="4031589">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031595">for</span>&nbsp;<span class="ident" id="4031599">i</span><span class="op" id="4031600">,</span>&nbsp;<span class="ident" id="4031602">s</span>&nbsp;<span class="op" id="4031604">:=</span>&nbsp;<span class="keyword" id="4031607">range</span>&nbsp;<span class="ident" id="4031613">d</span><span class="op" id="4031614">.</span><span class="ident" id="4031615">h</span>&nbsp;<span class="op" id="4031617">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031621">digest</span><span class="op" id="4031627">[</span><span class="ident" id="4031628">i</span><span class="op" id="4031629">*</span><span class="num" id="4031630">4</span><span class="op" id="4031631">]</span>&nbsp;<span class="op" id="4031633">=</span>&nbsp;<span class="builtintype" id="4031635">byte</span><span class="op" id="4031639">(</span><span class="ident" id="4031640">s</span>&nbsp;<span class="op" id="4031642">&gt;&gt;</span>&nbsp;<span class="num" id="4031645">24</span><span class="op" id="4031647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031651">digest</span><span class="op" id="4031657">[</span><span class="ident" id="4031658">i</span><span class="op" id="4031659">*</span><span class="num" id="4031660">4</span><span class="op" id="4031661">+</span><span class="num" id="4031662">1</span><span class="op" id="4031663">]</span>&nbsp;<span class="op" id="4031665">=</span>&nbsp;<span class="builtintype" id="4031667">byte</span><span class="op" id="4031671">(</span><span class="ident" id="4031672">s</span>&nbsp;<span class="op" id="4031674">&gt;&gt;</span>&nbsp;<span class="num" id="4031677">16</span><span class="op" id="4031679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031683">digest</span><span class="op" id="4031689">[</span><span class="ident" id="4031690">i</span><span class="op" id="4031691">*</span><span class="num" id="4031692">4</span><span class="op" id="4031693">+</span><span class="num" id="4031694">2</span><span class="op" id="4031695">]</span>&nbsp;<span class="op" id="4031697">=</span>&nbsp;<span class="builtintype" id="4031699">byte</span><span class="op" id="4031703">(</span><span class="ident" id="4031704">s</span>&nbsp;<span class="op" id="4031706">&gt;&gt;</span>&nbsp;<span class="num" id="4031709">8</span><span class="op" id="4031710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031714">digest</span><span class="op" id="4031720">[</span><span class="ident" id="4031721">i</span><span class="op" id="4031722">*</span><span class="num" id="4031723">4</span><span class="op" id="4031724">+</span><span class="num" id="4031725">3</span><span class="op" id="4031726">]</span>&nbsp;<span class="op" id="4031728">=</span>&nbsp;<span class="builtintype" id="4031730">byte</span><span class="op" id="4031734">(</span><span class="ident" id="4031735">s</span><span class="op" id="4031736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4031739">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031743">return</span>&nbsp;<span class="ident" id="4031750">digest</span><br>
<span class="lineno"></span><span class="op" id="4031757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4031760">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;SHA1&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno">125</span><span class="keyword" id="4031806">func</span>&nbsp;<span class="ident" id="4031811">Sum</span><span class="op" id="4031814">(</span><span class="ident" id="4031815">data</span>&nbsp;<span class="op" id="4031820">[</span><span class="op" id="4031821">]</span><span class="builtintype" id="4031822">byte</span><span class="op" id="4031826">)</span>&nbsp;<span class="op" id="4031828">[</span><span class="ident" id="4031829">Size</span><span class="op" id="4031833">]</span><span class="builtintype" id="4031834">byte</span>&nbsp;<span class="op" id="4031839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031842">var</span>&nbsp;<span class="ident" id="4031846">d</span>&nbsp;<span class="ident" id="4031848">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031856">d</span><span class="op" id="4031857">.</span><span class="ident" id="4031858">Reset</span><span class="op" id="4031863">(</span><span class="op" id="4031864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4031867">d</span><span class="op" id="4031868">.</span><span class="ident" id="4031869">Write</span><span class="op" id="4031874">(</span><span class="ident" id="4031875">data</span><span class="op" id="4031879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4031882">return</span>&nbsp;<span class="ident" id="4031889">d</span><span class="op" id="4031890">.</span><span class="ident" id="4031891">checkSum</span><span class="op" id="4031899">(</span><span class="op" id="4031900">)</span><br>
<span class="lineno">130</span><span class="op" id="4031902">}</span>
</div>
</body>
</html>
