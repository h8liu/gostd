<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>unicode/utf8</h2>
<ul>
<li><a href="/gostd/unicode/utf8/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8.go.html">utf8.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8_test.go.html">utf8_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1794621">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1794676">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1794730">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1794781">//&nbsp;Package&nbsp;utf8&nbsp;implements&nbsp;functions&nbsp;and&nbsp;constants&nbsp;to&nbsp;support&nbsp;text&nbsp;encoded&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1794859">//&nbsp;UTF-8.&nbsp;It&nbsp;includes&nbsp;functions&nbsp;to&nbsp;translate&nbsp;between&nbsp;runes&nbsp;and&nbsp;UTF-8&nbsp;byte&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="keyword" id="1794944">package</span>&nbsp;<span class="ident" id="1794952">utf8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1794958">//&nbsp;The&nbsp;conditions&nbsp;RuneError==unicode.ReplacementChar&nbsp;and</span><br>
<span class="lineno">10</span><span class="comment" id="1795015">//&nbsp;MaxRune==unicode.MaxRune&nbsp;are&nbsp;verified&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="comment" id="1795070">//&nbsp;Defining&nbsp;them&nbsp;locally&nbsp;avoids&nbsp;this&nbsp;package&nbsp;depending&nbsp;on&nbsp;package&nbsp;unicode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1795146">//&nbsp;Numbers&nbsp;fundamental&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="1795186">const</span>&nbsp;<span class="op" id="1795192">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795195">RuneError</span>&nbsp;<span class="op" id="1795205">=</span>&nbsp;<span class="string" id="1795207">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1795220">//&nbsp;the&nbsp;&#34;error&#34;&nbsp;Rune&nbsp;or&nbsp;&#34;Unicode&nbsp;replacement&nbsp;character&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795276">RuneSelf</span>&nbsp;&nbsp;<span class="op" id="1795286">=</span>&nbsp;<span class="num" id="1795288">0x80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1795301">//&nbsp;characters&nbsp;below&nbsp;Runeself&nbsp;are&nbsp;represented&nbsp;as&nbsp;themselves&nbsp;in&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795379">MaxRune</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1795389">=</span>&nbsp;<span class="string" id="1795391">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="1795404">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795442">UTFMax</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1795452">=</span>&nbsp;<span class="num" id="1795454">4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1795467">//&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;a&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character.</span><br>
<span class="lineno"></span><span class="op" id="1795532">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="1795535">//&nbsp;Code&nbsp;points&nbsp;in&nbsp;the&nbsp;surrogate&nbsp;range&nbsp;are&nbsp;not&nbsp;valid&nbsp;for&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="1795598">const</span>&nbsp;<span class="op" id="1795604">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795607">surrogateMin</span>&nbsp;<span class="op" id="1795620">=</span>&nbsp;<span class="num" id="1795622">0xD800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795630">surrogateMax</span>&nbsp;<span class="op" id="1795643">=</span>&nbsp;<span class="num" id="1795645">0xDFFF</span><br>
<span class="lineno">25</span><span class="op" id="1795652">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1795655">const</span>&nbsp;<span class="op" id="1795661">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795664">t1</span>&nbsp;<span class="op" id="1795667">=</span>&nbsp;<span class="num" id="1795669">0x00</span>&nbsp;<span class="comment" id="1795674">//&nbsp;0000&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795688">tx</span>&nbsp;<span class="op" id="1795691">=</span>&nbsp;<span class="num" id="1795693">0x80</span>&nbsp;<span class="comment" id="1795698">//&nbsp;1000&nbsp;0000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795712">t2</span>&nbsp;<span class="op" id="1795715">=</span>&nbsp;<span class="num" id="1795717">0xC0</span>&nbsp;<span class="comment" id="1795722">//&nbsp;1100&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795736">t3</span>&nbsp;<span class="op" id="1795739">=</span>&nbsp;<span class="num" id="1795741">0xE0</span>&nbsp;<span class="comment" id="1795746">//&nbsp;1110&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795760">t4</span>&nbsp;<span class="op" id="1795763">=</span>&nbsp;<span class="num" id="1795765">0xF0</span>&nbsp;<span class="comment" id="1795770">//&nbsp;1111&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795784">t5</span>&nbsp;<span class="op" id="1795787">=</span>&nbsp;<span class="num" id="1795789">0xF8</span>&nbsp;<span class="comment" id="1795794">//&nbsp;1111&nbsp;1000</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795809">maskx</span>&nbsp;<span class="op" id="1795815">=</span>&nbsp;<span class="num" id="1795817">0x3F</span>&nbsp;<span class="comment" id="1795822">//&nbsp;0011&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795836">mask2</span>&nbsp;<span class="op" id="1795842">=</span>&nbsp;<span class="num" id="1795844">0x1F</span>&nbsp;<span class="comment" id="1795849">//&nbsp;0001&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795863">mask3</span>&nbsp;<span class="op" id="1795869">=</span>&nbsp;<span class="num" id="1795871">0x0F</span>&nbsp;<span class="comment" id="1795876">//&nbsp;0000&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795890">mask4</span>&nbsp;<span class="op" id="1795896">=</span>&nbsp;<span class="num" id="1795898">0x07</span>&nbsp;<span class="comment" id="1795903">//&nbsp;0000&nbsp;0111</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795918">rune1Max</span>&nbsp;<span class="op" id="1795927">=</span>&nbsp;<span class="num" id="1795929">1</span><span class="op" id="1795930">&lt;&lt;</span><span class="num" id="1795932">7</span>&nbsp;<span class="op" id="1795934">-</span>&nbsp;<span class="num" id="1795936">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795939">rune2Max</span>&nbsp;<span class="op" id="1795948">=</span>&nbsp;<span class="num" id="1795950">1</span><span class="op" id="1795951">&lt;&lt;</span><span class="num" id="1795953">11</span>&nbsp;<span class="op" id="1795956">-</span>&nbsp;<span class="num" id="1795958">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1795961">rune3Max</span>&nbsp;<span class="op" id="1795970">=</span>&nbsp;<span class="num" id="1795972">1</span><span class="op" id="1795973">&lt;&lt;</span><span class="num" id="1795975">16</span>&nbsp;<span class="op" id="1795978">-</span>&nbsp;<span class="num" id="1795980">1</span><br>
<span class="lineno"></span><span class="op" id="1795982">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1795985">func</span>&nbsp;<span class="ident" id="1795990">decodeRuneInternal</span><span class="op" id="1796008">(</span><span class="ident" id="1796009">p</span>&nbsp;<span class="op" id="1796011">[</span><span class="op" id="1796012">]</span><span class="builtintype" id="1796013">byte</span><span class="op" id="1796017">)</span>&nbsp;<span class="op" id="1796019">(</span><span class="ident" id="1796020">r</span>&nbsp;<span class="builtintype" id="1796022">rune</span><span class="op" id="1796026">,</span>&nbsp;<span class="ident" id="1796028">size</span>&nbsp;<span class="builtintype" id="1796033">int</span><span class="op" id="1796036">,</span>&nbsp;<span class="ident" id="1796038">short</span>&nbsp;<span class="builtintype" id="1796044">bool</span><span class="op" id="1796048">)</span>&nbsp;<span class="op" id="1796050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1796053">n</span>&nbsp;<span class="op" id="1796055">:=</span>&nbsp;<span class="builtinfunc" id="1796058">len</span><span class="op" id="1796061">(</span><span class="ident" id="1796062">p</span><span class="op" id="1796063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796066">if</span>&nbsp;<span class="ident" id="1796069">n</span>&nbsp;<span class="op" id="1796071">&lt;</span>&nbsp;<span class="num" id="1796073">1</span>&nbsp;<span class="op" id="1796075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796079">return</span>&nbsp;<span class="ident" id="1796086">RuneError</span><span class="op" id="1796095">,</span>&nbsp;<span class="num" id="1796097">0</span><span class="op" id="1796098">,</span>&nbsp;<span class="builtintype" id="1796100">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1796106">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1796109">c0</span>&nbsp;<span class="op" id="1796112">:=</span>&nbsp;<span class="ident" id="1796115">p</span><span class="op" id="1796116">[</span><span class="num" id="1796117">0</span><span class="op" id="1796118">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1796122">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796150">if</span>&nbsp;<span class="ident" id="1796153">c0</span>&nbsp;<span class="op" id="1796156">&lt;</span>&nbsp;<span class="ident" id="1796158">tx</span>&nbsp;<span class="op" id="1796161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796165">return</span>&nbsp;<span class="builtintype" id="1796172">rune</span><span class="op" id="1796176">(</span><span class="ident" id="1796177">c0</span><span class="op" id="1796179">)</span><span class="op" id="1796180">,</span>&nbsp;<span class="num" id="1796182">1</span><span class="op" id="1796183">,</span>&nbsp;<span class="builtintype" id="1796185">false</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1796192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1796196">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796230">if</span>&nbsp;<span class="ident" id="1796233">c0</span>&nbsp;<span class="op" id="1796236">&lt;</span>&nbsp;<span class="ident" id="1796238">t2</span>&nbsp;<span class="op" id="1796241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796245">return</span>&nbsp;<span class="ident" id="1796252">RuneError</span><span class="op" id="1796261">,</span>&nbsp;<span class="num" id="1796263">1</span><span class="op" id="1796264">,</span>&nbsp;<span class="builtintype" id="1796266">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1796273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1796277">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796310">if</span>&nbsp;<span class="ident" id="1796313">n</span>&nbsp;<span class="op" id="1796315">&lt;</span>&nbsp;<span class="num" id="1796317">2</span>&nbsp;<span class="op" id="1796319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796323">return</span>&nbsp;<span class="ident" id="1796330">RuneError</span><span class="op" id="1796339">,</span>&nbsp;<span class="num" id="1796341">1</span><span class="op" id="1796342">,</span>&nbsp;<span class="builtintype" id="1796344">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1796350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1796353">c1</span>&nbsp;<span class="op" id="1796356">:=</span>&nbsp;<span class="ident" id="1796359">p</span><span class="op" id="1796360">[</span><span class="num" id="1796361">1</span><span class="op" id="1796362">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796365">if</span>&nbsp;<span class="ident" id="1796368">c1</span>&nbsp;<span class="op" id="1796371">&lt;</span>&nbsp;<span class="ident" id="1796373">tx</span>&nbsp;<span class="op" id="1796376">||</span>&nbsp;<span class="ident" id="1796379">t2</span>&nbsp;<span class="op" id="1796382">&lt;=</span>&nbsp;<span class="ident" id="1796385">c1</span>&nbsp;<span class="op" id="1796388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796392">return</span>&nbsp;<span class="ident" id="1796399">RuneError</span><span class="op" id="1796408">,</span>&nbsp;<span class="num" id="1796410">1</span><span class="op" id="1796411">,</span>&nbsp;<span class="builtintype" id="1796413">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1796420">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1796424">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796453">if</span>&nbsp;<span class="ident" id="1796456">c0</span>&nbsp;<span class="op" id="1796459">&lt;</span>&nbsp;<span class="ident" id="1796461">t3</span>&nbsp;<span class="op" id="1796464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1796468">r</span>&nbsp;<span class="op" id="1796470">=</span>&nbsp;<span class="builtintype" id="1796472">rune</span><span class="op" id="1796476">(</span><span class="ident" id="1796477">c0</span><span class="op" id="1796479">&amp;</span><span class="ident" id="1796480">mask2</span><span class="op" id="1796485">)</span><span class="op" id="1796486">&lt;&lt;</span><span class="num" id="1796488">6</span>&nbsp;<span class="op" id="1796490">|</span>&nbsp;<span class="builtintype" id="1796492">rune</span><span class="op" id="1796496">(</span><span class="ident" id="1796497">c1</span><span class="op" id="1796499">&amp;</span><span class="ident" id="1796500">maskx</span><span class="op" id="1796505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796509">if</span>&nbsp;<span class="ident" id="1796512">r</span>&nbsp;<span class="op" id="1796514">&lt;=</span>&nbsp;<span class="ident" id="1796517">rune1Max</span>&nbsp;<span class="op" id="1796526">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796531">return</span>&nbsp;<span class="ident" id="1796538">RuneError</span><span class="op" id="1796547">,</span>&nbsp;<span class="num" id="1796549">1</span><span class="op" id="1796550">,</span>&nbsp;<span class="builtintype" id="1796552">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1796560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796564">return</span>&nbsp;<span class="ident" id="1796571">r</span><span class="op" id="1796572">,</span>&nbsp;<span class="num" id="1796574">2</span><span class="op" id="1796575">,</span>&nbsp;<span class="builtintype" id="1796577">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1796584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1796588">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796622">if</span>&nbsp;<span class="ident" id="1796625">n</span>&nbsp;<span class="op" id="1796627">&lt;</span>&nbsp;<span class="num" id="1796629">3</span>&nbsp;<span class="op" id="1796631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796635">return</span>&nbsp;<span class="ident" id="1796642">RuneError</span><span class="op" id="1796651">,</span>&nbsp;<span class="num" id="1796653">1</span><span class="op" id="1796654">,</span>&nbsp;<span class="builtintype" id="1796656">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1796662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1796665">c2</span>&nbsp;<span class="op" id="1796668">:=</span>&nbsp;<span class="ident" id="1796671">p</span><span class="op" id="1796672">[</span><span class="num" id="1796673">2</span><span class="op" id="1796674">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796677">if</span>&nbsp;<span class="ident" id="1796680">c2</span>&nbsp;<span class="op" id="1796683">&lt;</span>&nbsp;<span class="ident" id="1796685">tx</span>&nbsp;<span class="op" id="1796688">||</span>&nbsp;<span class="ident" id="1796691">t2</span>&nbsp;<span class="op" id="1796694">&lt;=</span>&nbsp;<span class="ident" id="1796697">c2</span>&nbsp;<span class="op" id="1796700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796704">return</span>&nbsp;<span class="ident" id="1796711">RuneError</span><span class="op" id="1796720">,</span>&nbsp;<span class="num" id="1796722">1</span><span class="op" id="1796723">,</span>&nbsp;<span class="builtintype" id="1796725">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1796732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1796736">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796765">if</span>&nbsp;<span class="ident" id="1796768">c0</span>&nbsp;<span class="op" id="1796771">&lt;</span>&nbsp;<span class="ident" id="1796773">t4</span>&nbsp;<span class="op" id="1796776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1796780">r</span>&nbsp;<span class="op" id="1796782">=</span>&nbsp;<span class="builtintype" id="1796784">rune</span><span class="op" id="1796788">(</span><span class="ident" id="1796789">c0</span><span class="op" id="1796791">&amp;</span><span class="ident" id="1796792">mask3</span><span class="op" id="1796797">)</span><span class="op" id="1796798">&lt;&lt;</span><span class="num" id="1796800">12</span>&nbsp;<span class="op" id="1796803">|</span>&nbsp;<span class="builtintype" id="1796805">rune</span><span class="op" id="1796809">(</span><span class="ident" id="1796810">c1</span><span class="op" id="1796812">&amp;</span><span class="ident" id="1796813">maskx</span><span class="op" id="1796818">)</span><span class="op" id="1796819">&lt;&lt;</span><span class="num" id="1796821">6</span>&nbsp;<span class="op" id="1796823">|</span>&nbsp;<span class="builtintype" id="1796825">rune</span><span class="op" id="1796829">(</span><span class="ident" id="1796830">c2</span><span class="op" id="1796832">&amp;</span><span class="ident" id="1796833">maskx</span><span class="op" id="1796838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796842">if</span>&nbsp;<span class="ident" id="1796845">r</span>&nbsp;<span class="op" id="1796847">&lt;=</span>&nbsp;<span class="ident" id="1796850">rune2Max</span>&nbsp;<span class="op" id="1796859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796864">return</span>&nbsp;<span class="ident" id="1796871">RuneError</span><span class="op" id="1796880">,</span>&nbsp;<span class="num" id="1796882">1</span><span class="op" id="1796883">,</span>&nbsp;<span class="builtintype" id="1796885">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1796893">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796897">if</span>&nbsp;<span class="ident" id="1796900">surrogateMin</span>&nbsp;<span class="op" id="1796913">&lt;=</span>&nbsp;<span class="ident" id="1796916">r</span>&nbsp;<span class="op" id="1796918">&amp;&amp;</span>&nbsp;<span class="ident" id="1796921">r</span>&nbsp;<span class="op" id="1796923">&lt;=</span>&nbsp;<span class="ident" id="1796926">surrogateMax</span>&nbsp;<span class="op" id="1796939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796944">return</span>&nbsp;<span class="ident" id="1796951">RuneError</span><span class="op" id="1796960">,</span>&nbsp;<span class="num" id="1796962">1</span><span class="op" id="1796963">,</span>&nbsp;<span class="builtintype" id="1796965">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1796973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1796977">return</span>&nbsp;<span class="ident" id="1796984">r</span><span class="op" id="1796985">,</span>&nbsp;<span class="num" id="1796987">3</span><span class="op" id="1796988">,</span>&nbsp;<span class="builtintype" id="1796990">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1796997">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1797001">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797034">if</span>&nbsp;<span class="ident" id="1797037">n</span>&nbsp;<span class="op" id="1797039">&lt;</span>&nbsp;<span class="num" id="1797041">4</span>&nbsp;<span class="op" id="1797043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797047">return</span>&nbsp;<span class="ident" id="1797054">RuneError</span><span class="op" id="1797063">,</span>&nbsp;<span class="num" id="1797065">1</span><span class="op" id="1797066">,</span>&nbsp;<span class="builtintype" id="1797068">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1797074">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1797077">c3</span>&nbsp;<span class="op" id="1797080">:=</span>&nbsp;<span class="ident" id="1797083">p</span><span class="op" id="1797084">[</span><span class="num" id="1797085">3</span><span class="op" id="1797086">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797089">if</span>&nbsp;<span class="ident" id="1797092">c3</span>&nbsp;<span class="op" id="1797095">&lt;</span>&nbsp;<span class="ident" id="1797097">tx</span>&nbsp;<span class="op" id="1797100">||</span>&nbsp;<span class="ident" id="1797103">t2</span>&nbsp;<span class="op" id="1797106">&lt;=</span>&nbsp;<span class="ident" id="1797109">c3</span>&nbsp;<span class="op" id="1797112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797116">return</span>&nbsp;<span class="ident" id="1797123">RuneError</span><span class="op" id="1797132">,</span>&nbsp;<span class="num" id="1797134">1</span><span class="op" id="1797135">,</span>&nbsp;<span class="builtintype" id="1797137">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1797144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1797148">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797177">if</span>&nbsp;<span class="ident" id="1797180">c0</span>&nbsp;<span class="op" id="1797183">&lt;</span>&nbsp;<span class="ident" id="1797185">t5</span>&nbsp;<span class="op" id="1797188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1797192">r</span>&nbsp;<span class="op" id="1797194">=</span>&nbsp;<span class="builtintype" id="1797196">rune</span><span class="op" id="1797200">(</span><span class="ident" id="1797201">c0</span><span class="op" id="1797203">&amp;</span><span class="ident" id="1797204">mask4</span><span class="op" id="1797209">)</span><span class="op" id="1797210">&lt;&lt;</span><span class="num" id="1797212">18</span>&nbsp;<span class="op" id="1797215">|</span>&nbsp;<span class="builtintype" id="1797217">rune</span><span class="op" id="1797221">(</span><span class="ident" id="1797222">c1</span><span class="op" id="1797224">&amp;</span><span class="ident" id="1797225">maskx</span><span class="op" id="1797230">)</span><span class="op" id="1797231">&lt;&lt;</span><span class="num" id="1797233">12</span>&nbsp;<span class="op" id="1797236">|</span>&nbsp;<span class="builtintype" id="1797238">rune</span><span class="op" id="1797242">(</span><span class="ident" id="1797243">c2</span><span class="op" id="1797245">&amp;</span><span class="ident" id="1797246">maskx</span><span class="op" id="1797251">)</span><span class="op" id="1797252">&lt;&lt;</span><span class="num" id="1797254">6</span>&nbsp;<span class="op" id="1797256">|</span>&nbsp;<span class="builtintype" id="1797258">rune</span><span class="op" id="1797262">(</span><span class="ident" id="1797263">c3</span><span class="op" id="1797265">&amp;</span><span class="ident" id="1797266">maskx</span><span class="op" id="1797271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797275">if</span>&nbsp;<span class="ident" id="1797278">r</span>&nbsp;<span class="op" id="1797280">&lt;=</span>&nbsp;<span class="ident" id="1797283">rune3Max</span>&nbsp;<span class="op" id="1797292">||</span>&nbsp;<span class="ident" id="1797295">MaxRune</span>&nbsp;<span class="op" id="1797303">&lt;</span>&nbsp;<span class="ident" id="1797305">r</span>&nbsp;<span class="op" id="1797307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797312">return</span>&nbsp;<span class="ident" id="1797319">RuneError</span><span class="op" id="1797328">,</span>&nbsp;<span class="num" id="1797330">1</span><span class="op" id="1797331">,</span>&nbsp;<span class="builtintype" id="1797333">false</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1797341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797345">return</span>&nbsp;<span class="ident" id="1797352">r</span><span class="op" id="1797353">,</span>&nbsp;<span class="num" id="1797355">4</span><span class="op" id="1797356">,</span>&nbsp;<span class="builtintype" id="1797358">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1797365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1797369">//&nbsp;error</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797379">return</span>&nbsp;<span class="ident" id="1797386">RuneError</span><span class="op" id="1797395">,</span>&nbsp;<span class="num" id="1797397">1</span><span class="op" id="1797398">,</span>&nbsp;<span class="builtintype" id="1797400">false</span><br>
<span class="lineno"></span><span class="op" id="1797406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1797409">func</span>&nbsp;<span class="ident" id="1797414">decodeRuneInStringInternal</span><span class="op" id="1797440">(</span><span class="ident" id="1797441">s</span>&nbsp;<span class="builtintype" id="1797443">string</span><span class="op" id="1797449">)</span>&nbsp;<span class="op" id="1797451">(</span><span class="ident" id="1797452">r</span>&nbsp;<span class="builtintype" id="1797454">rune</span><span class="op" id="1797458">,</span>&nbsp;<span class="ident" id="1797460">size</span>&nbsp;<span class="builtintype" id="1797465">int</span><span class="op" id="1797468">,</span>&nbsp;<span class="ident" id="1797470">short</span>&nbsp;<span class="builtintype" id="1797476">bool</span><span class="op" id="1797480">)</span>&nbsp;<span class="op" id="1797482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1797485">n</span>&nbsp;<span class="op" id="1797487">:=</span>&nbsp;<span class="builtinfunc" id="1797490">len</span><span class="op" id="1797493">(</span><span class="ident" id="1797494">s</span><span class="op" id="1797495">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797498">if</span>&nbsp;<span class="ident" id="1797501">n</span>&nbsp;<span class="op" id="1797503">&lt;</span>&nbsp;<span class="num" id="1797505">1</span>&nbsp;<span class="op" id="1797507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797511">return</span>&nbsp;<span class="ident" id="1797518">RuneError</span><span class="op" id="1797527">,</span>&nbsp;<span class="num" id="1797529">0</span><span class="op" id="1797530">,</span>&nbsp;<span class="builtintype" id="1797532">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1797538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1797541">c0</span>&nbsp;<span class="op" id="1797544">:=</span>&nbsp;<span class="ident" id="1797547">s</span><span class="op" id="1797548">[</span><span class="num" id="1797549">0</span><span class="op" id="1797550">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1797554">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797582">if</span>&nbsp;<span class="ident" id="1797585">c0</span>&nbsp;<span class="op" id="1797588">&lt;</span>&nbsp;<span class="ident" id="1797590">tx</span>&nbsp;<span class="op" id="1797593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797597">return</span>&nbsp;<span class="builtintype" id="1797604">rune</span><span class="op" id="1797608">(</span><span class="ident" id="1797609">c0</span><span class="op" id="1797611">)</span><span class="op" id="1797612">,</span>&nbsp;<span class="num" id="1797614">1</span><span class="op" id="1797615">,</span>&nbsp;<span class="builtintype" id="1797617">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1797624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1797628">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797662">if</span>&nbsp;<span class="ident" id="1797665">c0</span>&nbsp;<span class="op" id="1797668">&lt;</span>&nbsp;<span class="ident" id="1797670">t2</span>&nbsp;<span class="op" id="1797673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797677">return</span>&nbsp;<span class="ident" id="1797684">RuneError</span><span class="op" id="1797693">,</span>&nbsp;<span class="num" id="1797695">1</span><span class="op" id="1797696">,</span>&nbsp;<span class="builtintype" id="1797698">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1797705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1797709">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797742">if</span>&nbsp;<span class="ident" id="1797745">n</span>&nbsp;<span class="op" id="1797747">&lt;</span>&nbsp;<span class="num" id="1797749">2</span>&nbsp;<span class="op" id="1797751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797755">return</span>&nbsp;<span class="ident" id="1797762">RuneError</span><span class="op" id="1797771">,</span>&nbsp;<span class="num" id="1797773">1</span><span class="op" id="1797774">,</span>&nbsp;<span class="builtintype" id="1797776">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1797782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1797785">c1</span>&nbsp;<span class="op" id="1797788">:=</span>&nbsp;<span class="ident" id="1797791">s</span><span class="op" id="1797792">[</span><span class="num" id="1797793">1</span><span class="op" id="1797794">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797797">if</span>&nbsp;<span class="ident" id="1797800">c1</span>&nbsp;<span class="op" id="1797803">&lt;</span>&nbsp;<span class="ident" id="1797805">tx</span>&nbsp;<span class="op" id="1797808">||</span>&nbsp;<span class="ident" id="1797811">t2</span>&nbsp;<span class="op" id="1797814">&lt;=</span>&nbsp;<span class="ident" id="1797817">c1</span>&nbsp;<span class="op" id="1797820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797824">return</span>&nbsp;<span class="ident" id="1797831">RuneError</span><span class="op" id="1797840">,</span>&nbsp;<span class="num" id="1797842">1</span><span class="op" id="1797843">,</span>&nbsp;<span class="builtintype" id="1797845">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1797852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1797856">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797885">if</span>&nbsp;<span class="ident" id="1797888">c0</span>&nbsp;<span class="op" id="1797891">&lt;</span>&nbsp;<span class="ident" id="1797893">t3</span>&nbsp;<span class="op" id="1797896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1797900">r</span>&nbsp;<span class="op" id="1797902">=</span>&nbsp;<span class="builtintype" id="1797904">rune</span><span class="op" id="1797908">(</span><span class="ident" id="1797909">c0</span><span class="op" id="1797911">&amp;</span><span class="ident" id="1797912">mask2</span><span class="op" id="1797917">)</span><span class="op" id="1797918">&lt;&lt;</span><span class="num" id="1797920">6</span>&nbsp;<span class="op" id="1797922">|</span>&nbsp;<span class="builtintype" id="1797924">rune</span><span class="op" id="1797928">(</span><span class="ident" id="1797929">c1</span><span class="op" id="1797931">&amp;</span><span class="ident" id="1797932">maskx</span><span class="op" id="1797937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797941">if</span>&nbsp;<span class="ident" id="1797944">r</span>&nbsp;<span class="op" id="1797946">&lt;=</span>&nbsp;<span class="ident" id="1797949">rune1Max</span>&nbsp;<span class="op" id="1797958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797963">return</span>&nbsp;<span class="ident" id="1797970">RuneError</span><span class="op" id="1797979">,</span>&nbsp;<span class="num" id="1797981">1</span><span class="op" id="1797982">,</span>&nbsp;<span class="builtintype" id="1797984">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1797992">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1797996">return</span>&nbsp;<span class="ident" id="1798003">r</span><span class="op" id="1798004">,</span>&nbsp;<span class="num" id="1798006">2</span><span class="op" id="1798007">,</span>&nbsp;<span class="builtintype" id="1798009">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1798016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1798020">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798054">if</span>&nbsp;<span class="ident" id="1798057">n</span>&nbsp;<span class="op" id="1798059">&lt;</span>&nbsp;<span class="num" id="1798061">3</span>&nbsp;<span class="op" id="1798063">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798067">return</span>&nbsp;<span class="ident" id="1798074">RuneError</span><span class="op" id="1798083">,</span>&nbsp;<span class="num" id="1798085">1</span><span class="op" id="1798086">,</span>&nbsp;<span class="builtintype" id="1798088">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1798094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1798097">c2</span>&nbsp;<span class="op" id="1798100">:=</span>&nbsp;<span class="ident" id="1798103">s</span><span class="op" id="1798104">[</span><span class="num" id="1798105">2</span><span class="op" id="1798106">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798109">if</span>&nbsp;<span class="ident" id="1798112">c2</span>&nbsp;<span class="op" id="1798115">&lt;</span>&nbsp;<span class="ident" id="1798117">tx</span>&nbsp;<span class="op" id="1798120">||</span>&nbsp;<span class="ident" id="1798123">t2</span>&nbsp;<span class="op" id="1798126">&lt;=</span>&nbsp;<span class="ident" id="1798129">c2</span>&nbsp;<span class="op" id="1798132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798136">return</span>&nbsp;<span class="ident" id="1798143">RuneError</span><span class="op" id="1798152">,</span>&nbsp;<span class="num" id="1798154">1</span><span class="op" id="1798155">,</span>&nbsp;<span class="builtintype" id="1798157">false</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1798164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1798168">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798197">if</span>&nbsp;<span class="ident" id="1798200">c0</span>&nbsp;<span class="op" id="1798203">&lt;</span>&nbsp;<span class="ident" id="1798205">t4</span>&nbsp;<span class="op" id="1798208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1798212">r</span>&nbsp;<span class="op" id="1798214">=</span>&nbsp;<span class="builtintype" id="1798216">rune</span><span class="op" id="1798220">(</span><span class="ident" id="1798221">c0</span><span class="op" id="1798223">&amp;</span><span class="ident" id="1798224">mask3</span><span class="op" id="1798229">)</span><span class="op" id="1798230">&lt;&lt;</span><span class="num" id="1798232">12</span>&nbsp;<span class="op" id="1798235">|</span>&nbsp;<span class="builtintype" id="1798237">rune</span><span class="op" id="1798241">(</span><span class="ident" id="1798242">c1</span><span class="op" id="1798244">&amp;</span><span class="ident" id="1798245">maskx</span><span class="op" id="1798250">)</span><span class="op" id="1798251">&lt;&lt;</span><span class="num" id="1798253">6</span>&nbsp;<span class="op" id="1798255">|</span>&nbsp;<span class="builtintype" id="1798257">rune</span><span class="op" id="1798261">(</span><span class="ident" id="1798262">c2</span><span class="op" id="1798264">&amp;</span><span class="ident" id="1798265">maskx</span><span class="op" id="1798270">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798274">if</span>&nbsp;<span class="ident" id="1798277">r</span>&nbsp;<span class="op" id="1798279">&lt;=</span>&nbsp;<span class="ident" id="1798282">rune2Max</span>&nbsp;<span class="op" id="1798291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798296">return</span>&nbsp;<span class="ident" id="1798303">RuneError</span><span class="op" id="1798312">,</span>&nbsp;<span class="num" id="1798314">1</span><span class="op" id="1798315">,</span>&nbsp;<span class="builtintype" id="1798317">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1798325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798329">if</span>&nbsp;<span class="ident" id="1798332">surrogateMin</span>&nbsp;<span class="op" id="1798345">&lt;=</span>&nbsp;<span class="ident" id="1798348">r</span>&nbsp;<span class="op" id="1798350">&amp;&amp;</span>&nbsp;<span class="ident" id="1798353">r</span>&nbsp;<span class="op" id="1798355">&lt;=</span>&nbsp;<span class="ident" id="1798358">surrogateMax</span>&nbsp;<span class="op" id="1798371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798376">return</span>&nbsp;<span class="ident" id="1798383">RuneError</span><span class="op" id="1798392">,</span>&nbsp;<span class="num" id="1798394">1</span><span class="op" id="1798395">,</span>&nbsp;<span class="builtintype" id="1798397">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1798405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798409">return</span>&nbsp;<span class="ident" id="1798416">r</span><span class="op" id="1798417">,</span>&nbsp;<span class="num" id="1798419">3</span><span class="op" id="1798420">,</span>&nbsp;<span class="builtintype" id="1798422">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1798429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1798433">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798466">if</span>&nbsp;<span class="ident" id="1798469">n</span>&nbsp;<span class="op" id="1798471">&lt;</span>&nbsp;<span class="num" id="1798473">4</span>&nbsp;<span class="op" id="1798475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798479">return</span>&nbsp;<span class="ident" id="1798486">RuneError</span><span class="op" id="1798495">,</span>&nbsp;<span class="num" id="1798497">1</span><span class="op" id="1798498">,</span>&nbsp;<span class="builtintype" id="1798500">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1798506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1798509">c3</span>&nbsp;<span class="op" id="1798512">:=</span>&nbsp;<span class="ident" id="1798515">s</span><span class="op" id="1798516">[</span><span class="num" id="1798517">3</span><span class="op" id="1798518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798521">if</span>&nbsp;<span class="ident" id="1798524">c3</span>&nbsp;<span class="op" id="1798527">&lt;</span>&nbsp;<span class="ident" id="1798529">tx</span>&nbsp;<span class="op" id="1798532">||</span>&nbsp;<span class="ident" id="1798535">t2</span>&nbsp;<span class="op" id="1798538">&lt;=</span>&nbsp;<span class="ident" id="1798541">c3</span>&nbsp;<span class="op" id="1798544">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798548">return</span>&nbsp;<span class="ident" id="1798555">RuneError</span><span class="op" id="1798564">,</span>&nbsp;<span class="num" id="1798566">1</span><span class="op" id="1798567">,</span>&nbsp;<span class="builtintype" id="1798569">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1798576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1798580">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798609">if</span>&nbsp;<span class="ident" id="1798612">c0</span>&nbsp;<span class="op" id="1798615">&lt;</span>&nbsp;<span class="ident" id="1798617">t5</span>&nbsp;<span class="op" id="1798620">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1798624">r</span>&nbsp;<span class="op" id="1798626">=</span>&nbsp;<span class="builtintype" id="1798628">rune</span><span class="op" id="1798632">(</span><span class="ident" id="1798633">c0</span><span class="op" id="1798635">&amp;</span><span class="ident" id="1798636">mask4</span><span class="op" id="1798641">)</span><span class="op" id="1798642">&lt;&lt;</span><span class="num" id="1798644">18</span>&nbsp;<span class="op" id="1798647">|</span>&nbsp;<span class="builtintype" id="1798649">rune</span><span class="op" id="1798653">(</span><span class="ident" id="1798654">c1</span><span class="op" id="1798656">&amp;</span><span class="ident" id="1798657">maskx</span><span class="op" id="1798662">)</span><span class="op" id="1798663">&lt;&lt;</span><span class="num" id="1798665">12</span>&nbsp;<span class="op" id="1798668">|</span>&nbsp;<span class="builtintype" id="1798670">rune</span><span class="op" id="1798674">(</span><span class="ident" id="1798675">c2</span><span class="op" id="1798677">&amp;</span><span class="ident" id="1798678">maskx</span><span class="op" id="1798683">)</span><span class="op" id="1798684">&lt;&lt;</span><span class="num" id="1798686">6</span>&nbsp;<span class="op" id="1798688">|</span>&nbsp;<span class="builtintype" id="1798690">rune</span><span class="op" id="1798694">(</span><span class="ident" id="1798695">c3</span><span class="op" id="1798697">&amp;</span><span class="ident" id="1798698">maskx</span><span class="op" id="1798703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798707">if</span>&nbsp;<span class="ident" id="1798710">r</span>&nbsp;<span class="op" id="1798712">&lt;=</span>&nbsp;<span class="ident" id="1798715">rune3Max</span>&nbsp;<span class="op" id="1798724">||</span>&nbsp;<span class="ident" id="1798727">MaxRune</span>&nbsp;<span class="op" id="1798735">&lt;</span>&nbsp;<span class="ident" id="1798737">r</span>&nbsp;<span class="op" id="1798739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798744">return</span>&nbsp;<span class="ident" id="1798751">RuneError</span><span class="op" id="1798760">,</span>&nbsp;<span class="num" id="1798762">1</span><span class="op" id="1798763">,</span>&nbsp;<span class="builtintype" id="1798765">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1798773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798777">return</span>&nbsp;<span class="ident" id="1798784">r</span><span class="op" id="1798785">,</span>&nbsp;<span class="num" id="1798787">4</span><span class="op" id="1798788">,</span>&nbsp;<span class="builtintype" id="1798790">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1798797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1798801">//&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1798811">return</span>&nbsp;<span class="ident" id="1798818">RuneError</span><span class="op" id="1798827">,</span>&nbsp;<span class="num" id="1798829">1</span><span class="op" id="1798830">,</span>&nbsp;<span class="builtintype" id="1798832">false</span><br>
<span class="lineno"></span><span class="op" id="1798838">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="1798841">//&nbsp;FullRune&nbsp;reports&nbsp;whether&nbsp;the&nbsp;bytes&nbsp;in&nbsp;p&nbsp;begin&nbsp;with&nbsp;a&nbsp;full&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;a&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1798928">//&nbsp;An&nbsp;invalid&nbsp;encoding&nbsp;is&nbsp;considered&nbsp;a&nbsp;full&nbsp;Rune&nbsp;since&nbsp;it&nbsp;will&nbsp;convert&nbsp;as&nbsp;a&nbsp;width-1&nbsp;error&nbsp;rune.</span><br>
<span class="lineno"></span><span class="keyword" id="1799024">func</span>&nbsp;<span class="ident" id="1799029">FullRune</span><span class="op" id="1799037">(</span><span class="ident" id="1799038">p</span>&nbsp;<span class="op" id="1799040">[</span><span class="op" id="1799041">]</span><span class="builtintype" id="1799042">byte</span><span class="op" id="1799046">)</span>&nbsp;<span class="builtintype" id="1799048">bool</span>&nbsp;<span class="op" id="1799053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1799056">_</span><span class="op" id="1799057">,</span>&nbsp;<span class="ident" id="1799059">_</span><span class="op" id="1799060">,</span>&nbsp;<span class="ident" id="1799062">short</span>&nbsp;<span class="op" id="1799068">:=</span>&nbsp;<span class="ident" id="1799071">decodeRuneInternal</span><span class="op" id="1799089">(</span><span class="ident" id="1799090">p</span><span class="op" id="1799091">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1799094">return</span>&nbsp;<span class="op" id="1799101">!</span><span class="ident" id="1799102">short</span><br>
<span class="lineno"></span><span class="op" id="1799108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1799111">//&nbsp;FullRuneInString&nbsp;is&nbsp;like&nbsp;FullRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1799175">func</span>&nbsp;<span class="ident" id="1799180">FullRuneInString</span><span class="op" id="1799196">(</span><span class="ident" id="1799197">s</span>&nbsp;<span class="builtintype" id="1799199">string</span><span class="op" id="1799205">)</span>&nbsp;<span class="builtintype" id="1799207">bool</span>&nbsp;<span class="op" id="1799212">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1799215">_</span><span class="op" id="1799216">,</span>&nbsp;<span class="ident" id="1799218">_</span><span class="op" id="1799219">,</span>&nbsp;<span class="ident" id="1799221">short</span>&nbsp;<span class="op" id="1799227">:=</span>&nbsp;<span class="ident" id="1799230">decodeRuneInStringInternal</span><span class="op" id="1799256">(</span><span class="ident" id="1799257">s</span><span class="op" id="1799258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1799261">return</span>&nbsp;<span class="op" id="1799268">!</span><span class="ident" id="1799269">short</span><br>
<span class="lineno"></span><span class="op" id="1799275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1799278">//&nbsp;DecodeRune&nbsp;unpacks&nbsp;the&nbsp;first&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">215</span><span class="comment" id="1799355">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1799433">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1799508">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1799538">//</span><br>
<span class="lineno"></span><span class="comment" id="1799541">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">220</span><span class="comment" id="1799616">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1799688">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1799732">func</span>&nbsp;<span class="ident" id="1799737">DecodeRune</span><span class="op" id="1799747">(</span><span class="ident" id="1799748">p</span>&nbsp;<span class="op" id="1799750">[</span><span class="op" id="1799751">]</span><span class="builtintype" id="1799752">byte</span><span class="op" id="1799756">)</span>&nbsp;<span class="op" id="1799758">(</span><span class="ident" id="1799759">r</span>&nbsp;<span class="builtintype" id="1799761">rune</span><span class="op" id="1799765">,</span>&nbsp;<span class="ident" id="1799767">size</span>&nbsp;<span class="builtintype" id="1799772">int</span><span class="op" id="1799775">)</span>&nbsp;<span class="op" id="1799777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1799780">r</span><span class="op" id="1799781">,</span>&nbsp;<span class="ident" id="1799783">size</span><span class="op" id="1799787">,</span>&nbsp;<span class="ident" id="1799789">_</span>&nbsp;<span class="op" id="1799791">=</span>&nbsp;<span class="ident" id="1799793">decodeRuneInternal</span><span class="op" id="1799811">(</span><span class="ident" id="1799812">p</span><span class="op" id="1799813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1799816">return</span><br>
<span class="lineno">225</span><span class="op" id="1799823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1799826">//&nbsp;DecodeRuneInString&nbsp;is&nbsp;like&nbsp;DecodeRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If&nbsp;s&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1799902">//&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1799980">//&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno">230</span><span class="comment" id="1800054">//</span><br>
<span class="lineno"></span><span class="comment" id="1800057">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1800132">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1800204">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1800248">func</span>&nbsp;<span class="ident" id="1800253">DecodeRuneInString</span><span class="op" id="1800271">(</span><span class="ident" id="1800272">s</span>&nbsp;<span class="builtintype" id="1800274">string</span><span class="op" id="1800280">)</span>&nbsp;<span class="op" id="1800282">(</span><span class="ident" id="1800283">r</span>&nbsp;<span class="builtintype" id="1800285">rune</span><span class="op" id="1800289">,</span>&nbsp;<span class="ident" id="1800291">size</span>&nbsp;<span class="builtintype" id="1800296">int</span><span class="op" id="1800299">)</span>&nbsp;<span class="op" id="1800301">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1800304">r</span><span class="op" id="1800305">,</span>&nbsp;<span class="ident" id="1800307">size</span><span class="op" id="1800311">,</span>&nbsp;<span class="ident" id="1800313">_</span>&nbsp;<span class="op" id="1800315">=</span>&nbsp;<span class="ident" id="1800317">decodeRuneInStringInternal</span><span class="op" id="1800343">(</span><span class="ident" id="1800344">s</span><span class="op" id="1800345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1800348">return</span><br>
<span class="lineno"></span><span class="op" id="1800355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1800358">//&nbsp;DecodeLastRune&nbsp;unpacks&nbsp;the&nbsp;last&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">240</span><span class="comment" id="1800438">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1800516">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1800591">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1800621">//</span><br>
<span class="lineno"></span><span class="comment" id="1800624">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">245</span><span class="comment" id="1800699">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1800771">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1800815">func</span>&nbsp;<span class="ident" id="1800820">DecodeLastRune</span><span class="op" id="1800834">(</span><span class="ident" id="1800835">p</span>&nbsp;<span class="op" id="1800837">[</span><span class="op" id="1800838">]</span><span class="builtintype" id="1800839">byte</span><span class="op" id="1800843">)</span>&nbsp;<span class="op" id="1800845">(</span><span class="ident" id="1800846">r</span>&nbsp;<span class="builtintype" id="1800848">rune</span><span class="op" id="1800852">,</span>&nbsp;<span class="ident" id="1800854">size</span>&nbsp;<span class="builtintype" id="1800859">int</span><span class="op" id="1800862">)</span>&nbsp;<span class="op" id="1800864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1800867">end</span>&nbsp;<span class="op" id="1800871">:=</span>&nbsp;<span class="builtinfunc" id="1800874">len</span><span class="op" id="1800877">(</span><span class="ident" id="1800878">p</span><span class="op" id="1800879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1800882">if</span>&nbsp;<span class="ident" id="1800885">end</span>&nbsp;<span class="op" id="1800889">==</span>&nbsp;<span class="num" id="1800892">0</span>&nbsp;<span class="op" id="1800894">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1800898">return</span>&nbsp;<span class="ident" id="1800905">RuneError</span><span class="op" id="1800914">,</span>&nbsp;<span class="num" id="1800916">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1800919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1800922">start</span>&nbsp;<span class="op" id="1800928">:=</span>&nbsp;<span class="ident" id="1800931">end</span>&nbsp;<span class="op" id="1800935">-</span>&nbsp;<span class="num" id="1800937">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1800940">r</span>&nbsp;<span class="op" id="1800942">=</span>&nbsp;<span class="builtintype" id="1800944">rune</span><span class="op" id="1800948">(</span><span class="ident" id="1800949">p</span><span class="op" id="1800950">[</span><span class="ident" id="1800951">start</span><span class="op" id="1800956">]</span><span class="op" id="1800957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1800960">if</span>&nbsp;<span class="ident" id="1800963">r</span>&nbsp;<span class="op" id="1800965">&lt;</span>&nbsp;<span class="ident" id="1800967">RuneSelf</span>&nbsp;<span class="op" id="1800976">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1800980">return</span>&nbsp;<span class="ident" id="1800987">r</span><span class="op" id="1800988">,</span>&nbsp;<span class="num" id="1800990">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1800993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1800996">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1801046">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1801099">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1801118">lim</span>&nbsp;<span class="op" id="1801122">:=</span>&nbsp;<span class="ident" id="1801125">end</span>&nbsp;<span class="op" id="1801129">-</span>&nbsp;<span class="ident" id="1801131">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1801139">if</span>&nbsp;<span class="ident" id="1801142">lim</span>&nbsp;<span class="op" id="1801146">&lt;</span>&nbsp;<span class="num" id="1801148">0</span>&nbsp;<span class="op" id="1801150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1801154">lim</span>&nbsp;<span class="op" id="1801158">=</span>&nbsp;<span class="num" id="1801160">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1801163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1801166">for</span>&nbsp;<span class="ident" id="1801170">start</span><span class="op" id="1801175">--</span><span class="op" id="1801177">;</span>&nbsp;<span class="ident" id="1801179">start</span>&nbsp;<span class="op" id="1801185">&gt;=</span>&nbsp;<span class="ident" id="1801188">lim</span><span class="op" id="1801191">;</span>&nbsp;<span class="ident" id="1801193">start</span><span class="op" id="1801198">--</span>&nbsp;<span class="op" id="1801201">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1801205">if</span>&nbsp;<span class="ident" id="1801208">RuneStart</span><span class="op" id="1801217">(</span><span class="ident" id="1801218">p</span><span class="op" id="1801219">[</span><span class="ident" id="1801220">start</span><span class="op" id="1801225">]</span><span class="op" id="1801226">)</span>&nbsp;<span class="op" id="1801228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1801233">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1801241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1801244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1801247">if</span>&nbsp;<span class="ident" id="1801250">start</span>&nbsp;<span class="op" id="1801256">&lt;</span>&nbsp;<span class="num" id="1801258">0</span>&nbsp;<span class="op" id="1801260">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1801264">start</span>&nbsp;<span class="op" id="1801270">=</span>&nbsp;<span class="num" id="1801272">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1801275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1801278">r</span><span class="op" id="1801279">,</span>&nbsp;<span class="ident" id="1801281">size</span>&nbsp;<span class="op" id="1801286">=</span>&nbsp;<span class="ident" id="1801288">DecodeRune</span><span class="op" id="1801298">(</span><span class="ident" id="1801299">p</span><span class="op" id="1801300">[</span><span class="ident" id="1801301">start</span><span class="op" id="1801306">:</span><span class="ident" id="1801307">end</span><span class="op" id="1801310">]</span><span class="op" id="1801311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1801314">if</span>&nbsp;<span class="ident" id="1801317">start</span><span class="op" id="1801322">+</span><span class="ident" id="1801323">size</span>&nbsp;<span class="op" id="1801328">!=</span>&nbsp;<span class="ident" id="1801331">end</span>&nbsp;<span class="op" id="1801335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1801339">return</span>&nbsp;<span class="ident" id="1801346">RuneError</span><span class="op" id="1801355">,</span>&nbsp;<span class="num" id="1801357">1</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1801360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1801363">return</span>&nbsp;<span class="ident" id="1801370">r</span><span class="op" id="1801371">,</span>&nbsp;<span class="ident" id="1801373">size</span><br>
<span class="lineno"></span><span class="op" id="1801378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1801381">//&nbsp;DecodeLastRuneInString&nbsp;is&nbsp;like&nbsp;DecodeLastRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If</span><br>
<span class="lineno">280</span><span class="comment" id="1801460">//&nbsp;s&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,</span><br>
<span class="lineno"></span><span class="comment" id="1801540">//&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1801617">//</span><br>
<span class="lineno"></span><span class="comment" id="1801620">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1801695">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno">285</span><span class="comment" id="1801767">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1801811">func</span>&nbsp;<span class="ident" id="1801816">DecodeLastRuneInString</span><span class="op" id="1801838">(</span><span class="ident" id="1801839">s</span>&nbsp;<span class="builtintype" id="1801841">string</span><span class="op" id="1801847">)</span>&nbsp;<span class="op" id="1801849">(</span><span class="ident" id="1801850">r</span>&nbsp;<span class="builtintype" id="1801852">rune</span><span class="op" id="1801856">,</span>&nbsp;<span class="ident" id="1801858">size</span>&nbsp;<span class="builtintype" id="1801863">int</span><span class="op" id="1801866">)</span>&nbsp;<span class="op" id="1801868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1801871">end</span>&nbsp;<span class="op" id="1801875">:=</span>&nbsp;<span class="builtinfunc" id="1801878">len</span><span class="op" id="1801881">(</span><span class="ident" id="1801882">s</span><span class="op" id="1801883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1801886">if</span>&nbsp;<span class="ident" id="1801889">end</span>&nbsp;<span class="op" id="1801893">==</span>&nbsp;<span class="num" id="1801896">0</span>&nbsp;<span class="op" id="1801898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1801902">return</span>&nbsp;<span class="ident" id="1801909">RuneError</span><span class="op" id="1801918">,</span>&nbsp;<span class="num" id="1801920">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1801923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1801926">start</span>&nbsp;<span class="op" id="1801932">:=</span>&nbsp;<span class="ident" id="1801935">end</span>&nbsp;<span class="op" id="1801939">-</span>&nbsp;<span class="num" id="1801941">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1801944">r</span>&nbsp;<span class="op" id="1801946">=</span>&nbsp;<span class="builtintype" id="1801948">rune</span><span class="op" id="1801952">(</span><span class="ident" id="1801953">s</span><span class="op" id="1801954">[</span><span class="ident" id="1801955">start</span><span class="op" id="1801960">]</span><span class="op" id="1801961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1801964">if</span>&nbsp;<span class="ident" id="1801967">r</span>&nbsp;<span class="op" id="1801969">&lt;</span>&nbsp;<span class="ident" id="1801971">RuneSelf</span>&nbsp;<span class="op" id="1801980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1801984">return</span>&nbsp;<span class="ident" id="1801991">r</span><span class="op" id="1801992">,</span>&nbsp;<span class="num" id="1801994">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1801997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1802000">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1802050">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1802103">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802122">lim</span>&nbsp;<span class="op" id="1802126">:=</span>&nbsp;<span class="ident" id="1802129">end</span>&nbsp;<span class="op" id="1802133">-</span>&nbsp;<span class="ident" id="1802135">UTFMax</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802143">if</span>&nbsp;<span class="ident" id="1802146">lim</span>&nbsp;<span class="op" id="1802150">&lt;</span>&nbsp;<span class="num" id="1802152">0</span>&nbsp;<span class="op" id="1802154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802158">lim</span>&nbsp;<span class="op" id="1802162">=</span>&nbsp;<span class="num" id="1802164">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1802167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802170">for</span>&nbsp;<span class="ident" id="1802174">start</span><span class="op" id="1802179">--</span><span class="op" id="1802181">;</span>&nbsp;<span class="ident" id="1802183">start</span>&nbsp;<span class="op" id="1802189">&gt;=</span>&nbsp;<span class="ident" id="1802192">lim</span><span class="op" id="1802195">;</span>&nbsp;<span class="ident" id="1802197">start</span><span class="op" id="1802202">--</span>&nbsp;<span class="op" id="1802205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802209">if</span>&nbsp;<span class="ident" id="1802212">RuneStart</span><span class="op" id="1802221">(</span><span class="ident" id="1802222">s</span><span class="op" id="1802223">[</span><span class="ident" id="1802224">start</span><span class="op" id="1802229">]</span><span class="op" id="1802230">)</span>&nbsp;<span class="op" id="1802232">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802237">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1802245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1802248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802251">if</span>&nbsp;<span class="ident" id="1802254">start</span>&nbsp;<span class="op" id="1802260">&lt;</span>&nbsp;<span class="num" id="1802262">0</span>&nbsp;<span class="op" id="1802264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802268">start</span>&nbsp;<span class="op" id="1802274">=</span>&nbsp;<span class="num" id="1802276">0</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1802279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802282">r</span><span class="op" id="1802283">,</span>&nbsp;<span class="ident" id="1802285">size</span>&nbsp;<span class="op" id="1802290">=</span>&nbsp;<span class="ident" id="1802292">DecodeRuneInString</span><span class="op" id="1802310">(</span><span class="ident" id="1802311">s</span><span class="op" id="1802312">[</span><span class="ident" id="1802313">start</span><span class="op" id="1802318">:</span><span class="ident" id="1802319">end</span><span class="op" id="1802322">]</span><span class="op" id="1802323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802326">if</span>&nbsp;<span class="ident" id="1802329">start</span><span class="op" id="1802334">+</span><span class="ident" id="1802335">size</span>&nbsp;<span class="op" id="1802340">!=</span>&nbsp;<span class="ident" id="1802343">end</span>&nbsp;<span class="op" id="1802347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802351">return</span>&nbsp;<span class="ident" id="1802358">RuneError</span><span class="op" id="1802367">,</span>&nbsp;<span class="num" id="1802369">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1802372">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802375">return</span>&nbsp;<span class="ident" id="1802382">r</span><span class="op" id="1802383">,</span>&nbsp;<span class="ident" id="1802385">size</span><br>
<span class="lineno"></span><span class="op" id="1802390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1802393">//&nbsp;RuneLen&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;required&nbsp;to&nbsp;encode&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1802461">//&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;the&nbsp;rune&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;value&nbsp;to&nbsp;encode&nbsp;in&nbsp;UTF-8.</span><br>
<span class="lineno">320</span><span class="keyword" id="1802531">func</span>&nbsp;<span class="ident" id="1802536">RuneLen</span><span class="op" id="1802543">(</span><span class="ident" id="1802544">r</span>&nbsp;<span class="builtintype" id="1802546">rune</span><span class="op" id="1802550">)</span>&nbsp;<span class="builtintype" id="1802552">int</span>&nbsp;<span class="op" id="1802556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802559">switch</span>&nbsp;<span class="op" id="1802566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802569">case</span>&nbsp;<span class="ident" id="1802574">r</span>&nbsp;<span class="op" id="1802576">&lt;</span>&nbsp;<span class="num" id="1802578">0</span><span class="op" id="1802579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802583">return</span>&nbsp;<span class="op" id="1802590">-</span><span class="num" id="1802591">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802594">case</span>&nbsp;<span class="ident" id="1802599">r</span>&nbsp;<span class="op" id="1802601">&lt;=</span>&nbsp;<span class="ident" id="1802604">rune1Max</span><span class="op" id="1802612">:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802616">return</span>&nbsp;<span class="num" id="1802623">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802626">case</span>&nbsp;<span class="ident" id="1802631">r</span>&nbsp;<span class="op" id="1802633">&lt;=</span>&nbsp;<span class="ident" id="1802636">rune2Max</span><span class="op" id="1802644">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802648">return</span>&nbsp;<span class="num" id="1802655">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802658">case</span>&nbsp;<span class="ident" id="1802663">surrogateMin</span>&nbsp;<span class="op" id="1802676">&lt;=</span>&nbsp;<span class="ident" id="1802679">r</span>&nbsp;<span class="op" id="1802681">&amp;&amp;</span>&nbsp;<span class="ident" id="1802684">r</span>&nbsp;<span class="op" id="1802686">&lt;=</span>&nbsp;<span class="ident" id="1802689">surrogateMax</span><span class="op" id="1802701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802705">return</span>&nbsp;<span class="op" id="1802712">-</span><span class="num" id="1802713">1</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802716">case</span>&nbsp;<span class="ident" id="1802721">r</span>&nbsp;<span class="op" id="1802723">&lt;=</span>&nbsp;<span class="ident" id="1802726">rune3Max</span><span class="op" id="1802734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802738">return</span>&nbsp;<span class="num" id="1802745">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802748">case</span>&nbsp;<span class="ident" id="1802753">r</span>&nbsp;<span class="op" id="1802755">&lt;=</span>&nbsp;<span class="ident" id="1802758">MaxRune</span><span class="op" id="1802765">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802769">return</span>&nbsp;<span class="num" id="1802776">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1802779">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1802782">return</span>&nbsp;<span class="op" id="1802789">-</span><span class="num" id="1802790">1</span><br>
<span class="lineno"></span><span class="op" id="1802792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1802795">//&nbsp;EncodeRune&nbsp;writes&nbsp;into&nbsp;p&nbsp;(which&nbsp;must&nbsp;be&nbsp;large&nbsp;enough)&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1802884">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">340</span><span class="keyword" id="1802927">func</span>&nbsp;<span class="ident" id="1802932">EncodeRune</span><span class="op" id="1802942">(</span><span class="ident" id="1802943">p</span>&nbsp;<span class="op" id="1802945">[</span><span class="op" id="1802946">]</span><span class="builtintype" id="1802947">byte</span><span class="op" id="1802951">,</span>&nbsp;<span class="ident" id="1802953">r</span>&nbsp;<span class="builtintype" id="1802955">rune</span><span class="op" id="1802959">)</span>&nbsp;<span class="builtintype" id="1802961">int</span>&nbsp;<span class="op" id="1802965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1802968">//&nbsp;Negative&nbsp;values&nbsp;are&nbsp;erroneous.&nbsp;&nbsp;Making&nbsp;it&nbsp;unsigned&nbsp;addresses&nbsp;the&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803046">switch</span>&nbsp;<span class="ident" id="1803053">i</span>&nbsp;<span class="op" id="1803055">:=</span>&nbsp;<span class="builtintype" id="1803058">uint32</span><span class="op" id="1803064">(</span><span class="ident" id="1803065">r</span><span class="op" id="1803066">)</span><span class="op" id="1803067">;</span>&nbsp;<span class="op" id="1803069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803072">case</span>&nbsp;<span class="ident" id="1803077">i</span>&nbsp;<span class="op" id="1803079">&lt;=</span>&nbsp;<span class="ident" id="1803082">rune1Max</span><span class="op" id="1803090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803094">p</span><span class="op" id="1803095">[</span><span class="num" id="1803096">0</span><span class="op" id="1803097">]</span>&nbsp;<span class="op" id="1803099">=</span>&nbsp;<span class="builtintype" id="1803101">byte</span><span class="op" id="1803105">(</span><span class="ident" id="1803106">r</span><span class="op" id="1803107">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803111">return</span>&nbsp;<span class="num" id="1803118">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803121">case</span>&nbsp;<span class="ident" id="1803126">i</span>&nbsp;<span class="op" id="1803128">&lt;=</span>&nbsp;<span class="ident" id="1803131">rune2Max</span><span class="op" id="1803139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803143">p</span><span class="op" id="1803144">[</span><span class="num" id="1803145">0</span><span class="op" id="1803146">]</span>&nbsp;<span class="op" id="1803148">=</span>&nbsp;<span class="ident" id="1803150">t2</span>&nbsp;<span class="op" id="1803153">|</span>&nbsp;<span class="builtintype" id="1803155">byte</span><span class="op" id="1803159">(</span><span class="ident" id="1803160">r</span><span class="op" id="1803161">&gt;&gt;</span><span class="num" id="1803163">6</span><span class="op" id="1803164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803168">p</span><span class="op" id="1803169">[</span><span class="num" id="1803170">1</span><span class="op" id="1803171">]</span>&nbsp;<span class="op" id="1803173">=</span>&nbsp;<span class="ident" id="1803175">tx</span>&nbsp;<span class="op" id="1803178">|</span>&nbsp;<span class="builtintype" id="1803180">byte</span><span class="op" id="1803184">(</span><span class="ident" id="1803185">r</span><span class="op" id="1803186">)</span><span class="op" id="1803187">&amp;</span><span class="ident" id="1803188">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803196">return</span>&nbsp;<span class="num" id="1803203">2</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803206">case</span>&nbsp;<span class="ident" id="1803211">i</span>&nbsp;<span class="op" id="1803213">&gt;</span>&nbsp;<span class="ident" id="1803215">MaxRune</span><span class="op" id="1803222">,</span>&nbsp;<span class="ident" id="1803224">surrogateMin</span>&nbsp;<span class="op" id="1803237">&lt;=</span>&nbsp;<span class="ident" id="1803240">i</span>&nbsp;<span class="op" id="1803242">&amp;&amp;</span>&nbsp;<span class="ident" id="1803245">i</span>&nbsp;<span class="op" id="1803247">&lt;=</span>&nbsp;<span class="ident" id="1803250">surrogateMax</span><span class="op" id="1803262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803266">r</span>&nbsp;<span class="op" id="1803268">=</span>&nbsp;<span class="ident" id="1803270">RuneError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803282">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803295">case</span>&nbsp;<span class="ident" id="1803300">i</span>&nbsp;<span class="op" id="1803302">&lt;=</span>&nbsp;<span class="ident" id="1803305">rune3Max</span><span class="op" id="1803313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803317">p</span><span class="op" id="1803318">[</span><span class="num" id="1803319">0</span><span class="op" id="1803320">]</span>&nbsp;<span class="op" id="1803322">=</span>&nbsp;<span class="ident" id="1803324">t3</span>&nbsp;<span class="op" id="1803327">|</span>&nbsp;<span class="builtintype" id="1803329">byte</span><span class="op" id="1803333">(</span><span class="ident" id="1803334">r</span><span class="op" id="1803335">&gt;&gt;</span><span class="num" id="1803337">12</span><span class="op" id="1803339">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803343">p</span><span class="op" id="1803344">[</span><span class="num" id="1803345">1</span><span class="op" id="1803346">]</span>&nbsp;<span class="op" id="1803348">=</span>&nbsp;<span class="ident" id="1803350">tx</span>&nbsp;<span class="op" id="1803353">|</span>&nbsp;<span class="builtintype" id="1803355">byte</span><span class="op" id="1803359">(</span><span class="ident" id="1803360">r</span><span class="op" id="1803361">&gt;&gt;</span><span class="num" id="1803363">6</span><span class="op" id="1803364">)</span><span class="op" id="1803365">&amp;</span><span class="ident" id="1803366">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803374">p</span><span class="op" id="1803375">[</span><span class="num" id="1803376">2</span><span class="op" id="1803377">]</span>&nbsp;<span class="op" id="1803379">=</span>&nbsp;<span class="ident" id="1803381">tx</span>&nbsp;<span class="op" id="1803384">|</span>&nbsp;<span class="builtintype" id="1803386">byte</span><span class="op" id="1803390">(</span><span class="ident" id="1803391">r</span><span class="op" id="1803392">)</span><span class="op" id="1803393">&amp;</span><span class="ident" id="1803394">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803402">return</span>&nbsp;<span class="num" id="1803409">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803412">default</span><span class="op" id="1803419">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803423">p</span><span class="op" id="1803424">[</span><span class="num" id="1803425">0</span><span class="op" id="1803426">]</span>&nbsp;<span class="op" id="1803428">=</span>&nbsp;<span class="ident" id="1803430">t4</span>&nbsp;<span class="op" id="1803433">|</span>&nbsp;<span class="builtintype" id="1803435">byte</span><span class="op" id="1803439">(</span><span class="ident" id="1803440">r</span><span class="op" id="1803441">&gt;&gt;</span><span class="num" id="1803443">18</span><span class="op" id="1803445">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803449">p</span><span class="op" id="1803450">[</span><span class="num" id="1803451">1</span><span class="op" id="1803452">]</span>&nbsp;<span class="op" id="1803454">=</span>&nbsp;<span class="ident" id="1803456">tx</span>&nbsp;<span class="op" id="1803459">|</span>&nbsp;<span class="builtintype" id="1803461">byte</span><span class="op" id="1803465">(</span><span class="ident" id="1803466">r</span><span class="op" id="1803467">&gt;&gt;</span><span class="num" id="1803469">12</span><span class="op" id="1803471">)</span><span class="op" id="1803472">&amp;</span><span class="ident" id="1803473">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803481">p</span><span class="op" id="1803482">[</span><span class="num" id="1803483">2</span><span class="op" id="1803484">]</span>&nbsp;<span class="op" id="1803486">=</span>&nbsp;<span class="ident" id="1803488">tx</span>&nbsp;<span class="op" id="1803491">|</span>&nbsp;<span class="builtintype" id="1803493">byte</span><span class="op" id="1803497">(</span><span class="ident" id="1803498">r</span><span class="op" id="1803499">&gt;&gt;</span><span class="num" id="1803501">6</span><span class="op" id="1803502">)</span><span class="op" id="1803503">&amp;</span><span class="ident" id="1803504">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803512">p</span><span class="op" id="1803513">[</span><span class="num" id="1803514">3</span><span class="op" id="1803515">]</span>&nbsp;<span class="op" id="1803517">=</span>&nbsp;<span class="ident" id="1803519">tx</span>&nbsp;<span class="op" id="1803522">|</span>&nbsp;<span class="builtintype" id="1803524">byte</span><span class="op" id="1803528">(</span><span class="ident" id="1803529">r</span><span class="op" id="1803530">)</span><span class="op" id="1803531">&amp;</span><span class="ident" id="1803532">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803540">return</span>&nbsp;<span class="num" id="1803547">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803550">}</span><br>
<span class="lineno">365</span><span class="op" id="1803552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1803555">//&nbsp;RuneCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;runes&nbsp;in&nbsp;p.&nbsp;&nbsp;Erroneous&nbsp;and&nbsp;short</span><br>
<span class="lineno"></span><span class="comment" id="1803623">//&nbsp;encodings&nbsp;are&nbsp;treated&nbsp;as&nbsp;single&nbsp;runes&nbsp;of&nbsp;width&nbsp;1&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="1803681">func</span>&nbsp;<span class="ident" id="1803686">RuneCount</span><span class="op" id="1803695">(</span><span class="ident" id="1803696">p</span>&nbsp;<span class="op" id="1803698">[</span><span class="op" id="1803699">]</span><span class="builtintype" id="1803700">byte</span><span class="op" id="1803704">)</span>&nbsp;<span class="builtintype" id="1803706">int</span>&nbsp;<span class="op" id="1803710">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803713">i</span>&nbsp;<span class="op" id="1803715">:=</span>&nbsp;<span class="num" id="1803718">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803721">var</span>&nbsp;<span class="ident" id="1803725">n</span>&nbsp;<span class="builtintype" id="1803727">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803732">for</span>&nbsp;<span class="ident" id="1803736">n</span>&nbsp;<span class="op" id="1803738">=</span>&nbsp;<span class="num" id="1803740">0</span><span class="op" id="1803741">;</span>&nbsp;<span class="ident" id="1803743">i</span>&nbsp;<span class="op" id="1803745">&lt;</span>&nbsp;<span class="builtinfunc" id="1803747">len</span><span class="op" id="1803750">(</span><span class="ident" id="1803751">p</span><span class="op" id="1803752">)</span><span class="op" id="1803753">;</span>&nbsp;<span class="ident" id="1803755">n</span><span class="op" id="1803756">++</span>&nbsp;<span class="op" id="1803759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803763">if</span>&nbsp;<span class="ident" id="1803766">p</span><span class="op" id="1803767">[</span><span class="ident" id="1803768">i</span><span class="op" id="1803769">]</span>&nbsp;<span class="op" id="1803771">&lt;</span>&nbsp;<span class="ident" id="1803773">RuneSelf</span>&nbsp;<span class="op" id="1803782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803787">i</span><span class="op" id="1803788">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803793">}</span>&nbsp;<span class="keyword" id="1803795">else</span>&nbsp;<span class="op" id="1803800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803805">_</span><span class="op" id="1803806">,</span>&nbsp;<span class="ident" id="1803808">size</span>&nbsp;<span class="op" id="1803813">:=</span>&nbsp;<span class="ident" id="1803816">DecodeRune</span><span class="op" id="1803826">(</span><span class="ident" id="1803827">p</span><span class="op" id="1803828">[</span><span class="ident" id="1803829">i</span><span class="op" id="1803830">:</span><span class="op" id="1803831">]</span><span class="op" id="1803832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803837">i</span>&nbsp;<span class="op" id="1803839">+=</span>&nbsp;<span class="ident" id="1803842">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803852">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803855">return</span>&nbsp;<span class="ident" id="1803862">n</span><br>
<span class="lineno"></span><span class="op" id="1803864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1803867">//&nbsp;RuneCountInString&nbsp;is&nbsp;like&nbsp;RuneCount&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1803933">func</span>&nbsp;<span class="ident" id="1803938">RuneCountInString</span><span class="op" id="1803955">(</span><span class="ident" id="1803956">s</span>&nbsp;<span class="builtintype" id="1803958">string</span><span class="op" id="1803964">)</span>&nbsp;<span class="op" id="1803966">(</span><span class="ident" id="1803967">n</span>&nbsp;<span class="builtintype" id="1803969">int</span><span class="op" id="1803972">)</span>&nbsp;<span class="op" id="1803974">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803977">for</span>&nbsp;<span class="keyword" id="1803981">range</span>&nbsp;<span class="ident" id="1803987">s</span>&nbsp;<span class="op" id="1803989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803993">n</span><span class="op" id="1803994">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804001">return</span><br>
<span class="lineno"></span><span class="op" id="1804008">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="1804011">//&nbsp;RuneStart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;byte&nbsp;could&nbsp;be&nbsp;the&nbsp;first&nbsp;byte&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1804076">//&nbsp;an&nbsp;encoded&nbsp;rune.&nbsp;&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;bytes&nbsp;always&nbsp;have&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span><span class="comment" id="1804145">//&nbsp;two&nbsp;bits&nbsp;set&nbsp;to&nbsp;10.</span><br>
<span class="lineno"></span><span class="keyword" id="1804168">func</span>&nbsp;<span class="ident" id="1804173">RuneStart</span><span class="op" id="1804182">(</span><span class="ident" id="1804183">b</span>&nbsp;<span class="builtintype" id="1804185">byte</span><span class="op" id="1804189">)</span>&nbsp;<span class="builtintype" id="1804191">bool</span>&nbsp;<span class="op" id="1804196">{</span>&nbsp;<span class="keyword" id="1804198">return</span>&nbsp;<span class="ident" id="1804205">b</span><span class="op" id="1804206">&amp;</span><span class="num" id="1804207">0xC0</span>&nbsp;<span class="op" id="1804212">!=</span>&nbsp;<span class="num" id="1804215">0x80</span>&nbsp;<span class="op" id="1804220">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="1804223">//&nbsp;Valid&nbsp;reports&nbsp;whether&nbsp;p&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1804298">func</span>&nbsp;<span class="ident" id="1804303">Valid</span><span class="op" id="1804308">(</span><span class="ident" id="1804309">p</span>&nbsp;<span class="op" id="1804311">[</span><span class="op" id="1804312">]</span><span class="builtintype" id="1804313">byte</span><span class="op" id="1804317">)</span>&nbsp;<span class="builtintype" id="1804319">bool</span>&nbsp;<span class="op" id="1804324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1804327">i</span>&nbsp;<span class="op" id="1804329">:=</span>&nbsp;<span class="num" id="1804332">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804335">for</span>&nbsp;<span class="ident" id="1804339">i</span>&nbsp;<span class="op" id="1804341">&lt;</span>&nbsp;<span class="builtinfunc" id="1804343">len</span><span class="op" id="1804346">(</span><span class="ident" id="1804347">p</span><span class="op" id="1804348">)</span>&nbsp;<span class="op" id="1804350">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804354">if</span>&nbsp;<span class="ident" id="1804357">p</span><span class="op" id="1804358">[</span><span class="ident" id="1804359">i</span><span class="op" id="1804360">]</span>&nbsp;<span class="op" id="1804362">&lt;</span>&nbsp;<span class="ident" id="1804364">RuneSelf</span>&nbsp;<span class="op" id="1804373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1804378">i</span><span class="op" id="1804379">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1804384">}</span>&nbsp;<span class="keyword" id="1804386">else</span>&nbsp;<span class="op" id="1804391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1804396">_</span><span class="op" id="1804397">,</span>&nbsp;<span class="ident" id="1804399">size</span>&nbsp;<span class="op" id="1804404">:=</span>&nbsp;<span class="ident" id="1804407">DecodeRune</span><span class="op" id="1804417">(</span><span class="ident" id="1804418">p</span><span class="op" id="1804419">[</span><span class="ident" id="1804420">i</span><span class="op" id="1804421">:</span><span class="op" id="1804422">]</span><span class="op" id="1804423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804428">if</span>&nbsp;<span class="ident" id="1804431">size</span>&nbsp;<span class="op" id="1804436">==</span>&nbsp;<span class="num" id="1804439">1</span>&nbsp;<span class="op" id="1804441">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1804447">//&nbsp;All&nbsp;valid&nbsp;runes&nbsp;of&nbsp;size&nbsp;1&nbsp;(those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1804487">//&nbsp;below&nbsp;RuneSelf)&nbsp;were&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1804530">//&nbsp;This&nbsp;must&nbsp;be&nbsp;a&nbsp;RuneError.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804563">return</span>&nbsp;<span class="builtintype" id="1804570">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1804579">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1804584">i</span>&nbsp;<span class="op" id="1804586">+=</span>&nbsp;<span class="ident" id="1804589">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1804596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1804599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804602">return</span>&nbsp;<span class="builtintype" id="1804609">true</span><br>
<span class="lineno"></span><span class="op" id="1804614">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="1804617">//&nbsp;ValidString&nbsp;reports&nbsp;whether&nbsp;s&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1804698">func</span>&nbsp;<span class="ident" id="1804703">ValidString</span><span class="op" id="1804714">(</span><span class="ident" id="1804715">s</span>&nbsp;<span class="builtintype" id="1804717">string</span><span class="op" id="1804723">)</span>&nbsp;<span class="builtintype" id="1804725">bool</span>&nbsp;<span class="op" id="1804730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804733">for</span>&nbsp;<span class="ident" id="1804737">i</span><span class="op" id="1804738">,</span>&nbsp;<span class="ident" id="1804740">r</span>&nbsp;<span class="op" id="1804742">:=</span>&nbsp;<span class="keyword" id="1804745">range</span>&nbsp;<span class="ident" id="1804751">s</span>&nbsp;<span class="op" id="1804753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804757">if</span>&nbsp;<span class="ident" id="1804760">r</span>&nbsp;<span class="op" id="1804762">==</span>&nbsp;<span class="ident" id="1804765">RuneError</span>&nbsp;<span class="op" id="1804775">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1804780">//&nbsp;The&nbsp;RuneError&nbsp;value&nbsp;can&nbsp;be&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1804822">//&nbsp;sentinel&nbsp;value&nbsp;(if&nbsp;it&#39;s&nbsp;size&nbsp;1)&nbsp;or&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1804872">//&nbsp;value&nbsp;encoded&nbsp;properly.&nbsp;Decode&nbsp;it&nbsp;to&nbsp;see&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1804922">//&nbsp;it&#39;s&nbsp;the&nbsp;1&nbsp;byte&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1804960">_</span><span class="op" id="1804961">,</span>&nbsp;<span class="ident" id="1804963">size</span>&nbsp;<span class="op" id="1804968">:=</span>&nbsp;<span class="ident" id="1804971">DecodeRuneInString</span><span class="op" id="1804989">(</span><span class="ident" id="1804990">s</span><span class="op" id="1804991">[</span><span class="ident" id="1804992">i</span><span class="op" id="1804993">:</span><span class="op" id="1804994">]</span><span class="op" id="1804995">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805000">if</span>&nbsp;<span class="ident" id="1805003">size</span>&nbsp;<span class="op" id="1805008">==</span>&nbsp;<span class="num" id="1805011">1</span>&nbsp;<span class="op" id="1805013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805019">return</span>&nbsp;<span class="builtintype" id="1805026">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1805035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1805039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1805042">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805045">return</span>&nbsp;<span class="builtintype" id="1805052">true</span><br>
<span class="lineno"></span><span class="op" id="1805057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1805060">//&nbsp;ValidRune&nbsp;reports&nbsp;whether&nbsp;r&nbsp;can&nbsp;be&nbsp;legally&nbsp;encoded&nbsp;as&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1805124">//&nbsp;Code&nbsp;points&nbsp;that&nbsp;are&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;a&nbsp;surrogate&nbsp;half&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno">435</span><span class="keyword" id="1805194">func</span>&nbsp;<span class="ident" id="1805199">ValidRune</span><span class="op" id="1805208">(</span><span class="ident" id="1805209">r</span>&nbsp;<span class="builtintype" id="1805211">rune</span><span class="op" id="1805215">)</span>&nbsp;<span class="builtintype" id="1805217">bool</span>&nbsp;<span class="op" id="1805222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805225">switch</span>&nbsp;<span class="op" id="1805232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805235">case</span>&nbsp;<span class="ident" id="1805240">r</span>&nbsp;<span class="op" id="1805242">&lt;</span>&nbsp;<span class="num" id="1805244">0</span><span class="op" id="1805245">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805249">return</span>&nbsp;<span class="builtintype" id="1805256">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805263">case</span>&nbsp;<span class="ident" id="1805268">surrogateMin</span>&nbsp;<span class="op" id="1805281">&lt;=</span>&nbsp;<span class="ident" id="1805284">r</span>&nbsp;<span class="op" id="1805286">&amp;&amp;</span>&nbsp;<span class="ident" id="1805289">r</span>&nbsp;<span class="op" id="1805291">&lt;=</span>&nbsp;<span class="ident" id="1805294">surrogateMax</span><span class="op" id="1805306">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805310">return</span>&nbsp;<span class="builtintype" id="1805317">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805324">case</span>&nbsp;<span class="ident" id="1805329">r</span>&nbsp;<span class="op" id="1805331">&gt;</span>&nbsp;<span class="ident" id="1805333">MaxRune</span><span class="op" id="1805340">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805344">return</span>&nbsp;<span class="builtintype" id="1805351">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1805358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805361">return</span>&nbsp;<span class="builtintype" id="1805368">true</span><br>
<span class="lineno">445</span><span class="op" id="1805373">}</span>
</div>
</body>
</html>
