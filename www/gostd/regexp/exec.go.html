<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html" class="current">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3391351">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3391406">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3391460">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3391511">package</span>&nbsp;<span class="ident" id="3391519">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3391527">import</span>&nbsp;<span class="op" id="3391534">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3391537">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3391543">&#34;regexp/syntax&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3391559">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3391562">//&nbsp;A&nbsp;queue&nbsp;is&nbsp;a&nbsp;&#39;sparse&nbsp;array&#39;&nbsp;holding&nbsp;pending&nbsp;threads&nbsp;of&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="3391631">//&nbsp;See&nbsp;http://research.swtch.com/2008/03/using-uninitialized-memory-for-fun-and.html</span><br>
<span class="lineno"></span><span class="keyword" id="3391716">type</span>&nbsp;<span class="ident" id="3391721">queue</span>&nbsp;<span class="keyword" id="3391727">struct</span>&nbsp;<span class="op" id="3391734">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391737">sparse</span>&nbsp;<span class="op" id="3391744">[</span><span class="op" id="3391745">]</span><span class="builtintype" id="3391746">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391754">dense</span>&nbsp;&nbsp;<span class="op" id="3391761">[</span><span class="op" id="3391762">]</span><span class="ident" id="3391763">entry</span><br>
<span class="lineno"></span><span class="op" id="3391769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3391772">//&nbsp;A&nbsp;entry&nbsp;is&nbsp;an&nbsp;entry&nbsp;on&nbsp;a&nbsp;queue.</span><br>
<span class="lineno">20</span><span class="comment" id="3391807">//&nbsp;It&nbsp;holds&nbsp;both&nbsp;the&nbsp;instruction&nbsp;pc&nbsp;and&nbsp;the&nbsp;actual&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="3391866">//&nbsp;Some&nbsp;queue&nbsp;entries&nbsp;are&nbsp;just&nbsp;place&nbsp;holders&nbsp;so&nbsp;that&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span><span class="comment" id="3391931">//&nbsp;knows&nbsp;it&nbsp;has&nbsp;considered&nbsp;that&nbsp;pc.&nbsp;&nbsp;Such&nbsp;entries&nbsp;have&nbsp;t&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3391996">type</span>&nbsp;<span class="ident" id="3392001">entry</span>&nbsp;<span class="keyword" id="3392007">struct</span>&nbsp;<span class="op" id="3392014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392017">pc</span>&nbsp;<span class="builtintype" id="3392020">uint32</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392028">t</span>&nbsp;&nbsp;<span class="op" id="3392031">*</span><span class="ident" id="3392032">thread</span><br>
<span class="lineno"></span><span class="op" id="3392039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3392042">//&nbsp;A&nbsp;thread&nbsp;is&nbsp;the&nbsp;state&nbsp;of&nbsp;a&nbsp;single&nbsp;path&nbsp;through&nbsp;the&nbsp;machine:</span><br>
<span class="lineno"></span><span class="comment" id="3392105">//&nbsp;an&nbsp;instruction&nbsp;and&nbsp;a&nbsp;corresponding&nbsp;capture&nbsp;array.</span><br>
<span class="lineno">30</span><span class="comment" id="3392158">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html</span><br>
<span class="lineno"></span><span class="keyword" id="3392207">type</span>&nbsp;<span class="ident" id="3392212">thread</span>&nbsp;<span class="keyword" id="3392219">struct</span>&nbsp;<span class="op" id="3392226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392229">inst</span>&nbsp;<span class="op" id="3392234">*</span><span class="ident" id="3392235">syntax</span><span class="op" id="3392241">.</span><span class="ident" id="3392242">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3392248">cap</span>&nbsp;&nbsp;<span class="op" id="3392253">[</span><span class="op" id="3392254">]</span><span class="builtintype" id="3392255">int</span><br>
<span class="lineno"></span><span class="op" id="3392259">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="3392262">//&nbsp;A&nbsp;machine&nbsp;holds&nbsp;all&nbsp;the&nbsp;state&nbsp;during&nbsp;an&nbsp;NFA&nbsp;simulation&nbsp;for&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="3392327">type</span>&nbsp;<span class="ident" id="3392332">machine</span>&nbsp;<span class="keyword" id="3392340">struct</span>&nbsp;<span class="op" id="3392347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392350">re</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392359">*</span><span class="ident" id="3392360">Regexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392372">//&nbsp;corresponding&nbsp;Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392397">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392406">*</span><span class="ident" id="3392407">syntax</span><span class="op" id="3392413">.</span><span class="ident" id="3392414">Prog</span>&nbsp;<span class="comment" id="3392419">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392440">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392449">*</span><span class="ident" id="3392450">onePassProg</span>&nbsp;<span class="comment" id="3392462">//&nbsp;compiled&nbsp;onepass&nbsp;program,&nbsp;or&nbsp;notOnePass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392506">q0</span><span class="op" id="3392508">,</span>&nbsp;<span class="ident" id="3392510">q1</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3392515">queue</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392528">//&nbsp;two&nbsp;queues&nbsp;for&nbsp;runq,&nbsp;nextq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392559">pool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392568">[</span><span class="op" id="3392569">]</span><span class="op" id="3392570">*</span><span class="ident" id="3392571">thread</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392581">//&nbsp;pool&nbsp;of&nbsp;available&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392611">matched</span>&nbsp;&nbsp;<span class="builtintype" id="3392620">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392633">//&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392663">matchcap</span>&nbsp;<span class="op" id="3392672">[</span><span class="op" id="3392673">]</span><span class="builtintype" id="3392674">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392685">//&nbsp;capture&nbsp;information&nbsp;for&nbsp;the&nbsp;match</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392724">//&nbsp;cached&nbsp;inputs,&nbsp;to&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392763">inputBytes</span>&nbsp;&nbsp;<span class="ident" id="3392775">inputBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392787">inputString</span>&nbsp;<span class="ident" id="3392799">inputString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392812">inputReader</span>&nbsp;<span class="ident" id="3392824">inputReader</span><br>
<span class="lineno">50</span><span class="op" id="3392836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3392839">func</span>&nbsp;<span class="op" id="3392844">(</span><span class="ident" id="3392845">m</span>&nbsp;<span class="op" id="3392847">*</span><span class="ident" id="3392848">machine</span><span class="op" id="3392855">)</span>&nbsp;<span class="ident" id="3392857">newInputBytes</span><span class="op" id="3392870">(</span><span class="ident" id="3392871">b</span>&nbsp;<span class="op" id="3392873">[</span><span class="op" id="3392874">]</span><span class="builtintype" id="3392875">byte</span><span class="op" id="3392879">)</span>&nbsp;<span class="ident" id="3392881">input</span>&nbsp;<span class="op" id="3392887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392890">m</span><span class="op" id="3392891">.</span><span class="ident" id="3392892">inputBytes</span><span class="op" id="3392902">.</span><span class="ident" id="3392903">str</span>&nbsp;<span class="op" id="3392907">=</span>&nbsp;<span class="ident" id="3392909">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392912">return</span>&nbsp;<span class="op" id="3392919">&amp;</span><span class="ident" id="3392920">m</span><span class="op" id="3392921">.</span><span class="ident" id="3392922">inputBytes</span><br>
<span class="lineno">55</span><span class="op" id="3392933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3392936">func</span>&nbsp;<span class="op" id="3392941">(</span><span class="ident" id="3392942">m</span>&nbsp;<span class="op" id="3392944">*</span><span class="ident" id="3392945">machine</span><span class="op" id="3392952">)</span>&nbsp;<span class="ident" id="3392954">newInputString</span><span class="op" id="3392968">(</span><span class="ident" id="3392969">s</span>&nbsp;<span class="builtintype" id="3392971">string</span><span class="op" id="3392977">)</span>&nbsp;<span class="ident" id="3392979">input</span>&nbsp;<span class="op" id="3392985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392988">m</span><span class="op" id="3392989">.</span><span class="ident" id="3392990">inputString</span><span class="op" id="3393001">.</span><span class="ident" id="3393002">str</span>&nbsp;<span class="op" id="3393006">=</span>&nbsp;<span class="ident" id="3393008">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393011">return</span>&nbsp;<span class="op" id="3393018">&amp;</span><span class="ident" id="3393019">m</span><span class="op" id="3393020">.</span><span class="ident" id="3393021">inputString</span><br>
<span class="lineno">60</span><span class="op" id="3393033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3393036">func</span>&nbsp;<span class="op" id="3393041">(</span><span class="ident" id="3393042">m</span>&nbsp;<span class="op" id="3393044">*</span><span class="ident" id="3393045">machine</span><span class="op" id="3393052">)</span>&nbsp;<span class="ident" id="3393054">newInputReader</span><span class="op" id="3393068">(</span><span class="ident" id="3393069">r</span>&nbsp;<span class="ident" id="3393071">io</span><span class="op" id="3393073">.</span><span class="ident" id="3393074">RuneReader</span><span class="op" id="3393084">)</span>&nbsp;<span class="ident" id="3393086">input</span>&nbsp;<span class="op" id="3393092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393095">m</span><span class="op" id="3393096">.</span><span class="ident" id="3393097">inputReader</span><span class="op" id="3393108">.</span><span class="ident" id="3393109">r</span>&nbsp;<span class="op" id="3393111">=</span>&nbsp;<span class="ident" id="3393113">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393116">m</span><span class="op" id="3393117">.</span><span class="ident" id="3393118">inputReader</span><span class="op" id="3393129">.</span><span class="ident" id="3393130">atEOT</span>&nbsp;<span class="op" id="3393136">=</span>&nbsp;<span class="builtintype" id="3393138">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393145">m</span><span class="op" id="3393146">.</span><span class="ident" id="3393147">inputReader</span><span class="op" id="3393158">.</span><span class="ident" id="3393159">pos</span>&nbsp;<span class="op" id="3393163">=</span>&nbsp;<span class="num" id="3393165">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393168">return</span>&nbsp;<span class="op" id="3393175">&amp;</span><span class="ident" id="3393176">m</span><span class="op" id="3393177">.</span><span class="ident" id="3393178">inputReader</span><br>
<span class="lineno"></span><span class="op" id="3393190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3393193">//&nbsp;progMachine&nbsp;returns&nbsp;a&nbsp;new&nbsp;machine&nbsp;running&nbsp;the&nbsp;prog&nbsp;p.</span><br>
<span class="lineno">70</span><span class="keyword" id="3393250">func</span>&nbsp;<span class="ident" id="3393255">progMachine</span><span class="op" id="3393266">(</span><span class="ident" id="3393267">p</span>&nbsp;<span class="op" id="3393269">*</span><span class="ident" id="3393270">syntax</span><span class="op" id="3393276">.</span><span class="ident" id="3393277">Prog</span><span class="op" id="3393281">,</span>&nbsp;<span class="ident" id="3393283">op</span>&nbsp;<span class="op" id="3393286">*</span><span class="ident" id="3393287">onePassProg</span><span class="op" id="3393298">)</span>&nbsp;<span class="op" id="3393300">*</span><span class="ident" id="3393301">machine</span>&nbsp;<span class="op" id="3393309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393312">m</span>&nbsp;<span class="op" id="3393314">:=</span>&nbsp;<span class="op" id="3393317">&amp;</span><span class="ident" id="3393318">machine</span><span class="op" id="3393325">{</span><span class="ident" id="3393326">p</span><span class="op" id="3393327">:</span>&nbsp;<span class="ident" id="3393329">p</span><span class="op" id="3393330">,</span>&nbsp;<span class="ident" id="3393332">op</span><span class="op" id="3393334">:</span>&nbsp;<span class="ident" id="3393336">op</span><span class="op" id="3393338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393341">n</span>&nbsp;<span class="op" id="3393343">:=</span>&nbsp;<span class="builtinfunc" id="3393346">len</span><span class="op" id="3393349">(</span><span class="ident" id="3393350">m</span><span class="op" id="3393351">.</span><span class="ident" id="3393352">p</span><span class="op" id="3393353">.</span><span class="ident" id="3393354">Inst</span><span class="op" id="3393358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393361">m</span><span class="op" id="3393362">.</span><span class="ident" id="3393363">q0</span>&nbsp;<span class="op" id="3393366">=</span>&nbsp;<span class="ident" id="3393368">queue</span><span class="op" id="3393373">{</span><span class="builtinfunc" id="3393374">make</span><span class="op" id="3393378">(</span><span class="op" id="3393379">[</span><span class="op" id="3393380">]</span><span class="builtintype" id="3393381">uint32</span><span class="op" id="3393387">,</span>&nbsp;<span class="ident" id="3393389">n</span><span class="op" id="3393390">)</span><span class="op" id="3393391">,</span>&nbsp;<span class="builtinfunc" id="3393393">make</span><span class="op" id="3393397">(</span><span class="op" id="3393398">[</span><span class="op" id="3393399">]</span><span class="ident" id="3393400">entry</span><span class="op" id="3393405">,</span>&nbsp;<span class="num" id="3393407">0</span><span class="op" id="3393408">,</span>&nbsp;<span class="ident" id="3393410">n</span><span class="op" id="3393411">)</span><span class="op" id="3393412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393415">m</span><span class="op" id="3393416">.</span><span class="ident" id="3393417">q1</span>&nbsp;<span class="op" id="3393420">=</span>&nbsp;<span class="ident" id="3393422">queue</span><span class="op" id="3393427">{</span><span class="builtinfunc" id="3393428">make</span><span class="op" id="3393432">(</span><span class="op" id="3393433">[</span><span class="op" id="3393434">]</span><span class="builtintype" id="3393435">uint32</span><span class="op" id="3393441">,</span>&nbsp;<span class="ident" id="3393443">n</span><span class="op" id="3393444">)</span><span class="op" id="3393445">,</span>&nbsp;<span class="builtinfunc" id="3393447">make</span><span class="op" id="3393451">(</span><span class="op" id="3393452">[</span><span class="op" id="3393453">]</span><span class="ident" id="3393454">entry</span><span class="op" id="3393459">,</span>&nbsp;<span class="num" id="3393461">0</span><span class="op" id="3393462">,</span>&nbsp;<span class="ident" id="3393464">n</span><span class="op" id="3393465">)</span><span class="op" id="3393466">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393469">ncap</span>&nbsp;<span class="op" id="3393474">:=</span>&nbsp;<span class="ident" id="3393477">p</span><span class="op" id="3393478">.</span><span class="ident" id="3393479">NumCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393487">if</span>&nbsp;<span class="ident" id="3393490">ncap</span>&nbsp;<span class="op" id="3393495">&lt;</span>&nbsp;<span class="num" id="3393497">2</span>&nbsp;<span class="op" id="3393499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393503">ncap</span>&nbsp;<span class="op" id="3393508">=</span>&nbsp;<span class="num" id="3393510">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3393513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393516">m</span><span class="op" id="3393517">.</span><span class="ident" id="3393518">matchcap</span>&nbsp;<span class="op" id="3393527">=</span>&nbsp;<span class="builtinfunc" id="3393529">make</span><span class="op" id="3393533">(</span><span class="op" id="3393534">[</span><span class="op" id="3393535">]</span><span class="builtintype" id="3393536">int</span><span class="op" id="3393539">,</span>&nbsp;<span class="ident" id="3393541">ncap</span><span class="op" id="3393545">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393548">return</span>&nbsp;<span class="ident" id="3393555">m</span><br>
<span class="lineno"></span><span class="op" id="3393557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3393560">func</span>&nbsp;<span class="op" id="3393565">(</span><span class="ident" id="3393566">m</span>&nbsp;<span class="op" id="3393568">*</span><span class="ident" id="3393569">machine</span><span class="op" id="3393576">)</span>&nbsp;<span class="ident" id="3393578">init</span><span class="op" id="3393582">(</span><span class="ident" id="3393583">ncap</span>&nbsp;<span class="builtintype" id="3393588">int</span><span class="op" id="3393591">)</span>&nbsp;<span class="op" id="3393593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393596">for</span>&nbsp;<span class="ident" id="3393600">_</span><span class="op" id="3393601">,</span>&nbsp;<span class="ident" id="3393603">t</span>&nbsp;<span class="op" id="3393605">:=</span>&nbsp;<span class="keyword" id="3393608">range</span>&nbsp;<span class="ident" id="3393614">m</span><span class="op" id="3393615">.</span><span class="ident" id="3393616">pool</span>&nbsp;<span class="op" id="3393621">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393625">t</span><span class="op" id="3393626">.</span><span class="builtinfunc" id="3393627">cap</span>&nbsp;<span class="op" id="3393631">=</span>&nbsp;<span class="ident" id="3393633">t</span><span class="op" id="3393634">.</span><span class="builtinfunc" id="3393635">cap</span><span class="op" id="3393638">[</span><span class="op" id="3393639">:</span><span class="ident" id="3393640">ncap</span><span class="op" id="3393644">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3393647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393650">m</span><span class="op" id="3393651">.</span><span class="ident" id="3393652">matchcap</span>&nbsp;<span class="op" id="3393661">=</span>&nbsp;<span class="ident" id="3393663">m</span><span class="op" id="3393664">.</span><span class="ident" id="3393665">matchcap</span><span class="op" id="3393673">[</span><span class="op" id="3393674">:</span><span class="ident" id="3393675">ncap</span><span class="op" id="3393679">]</span><br>
<span class="lineno"></span><span class="op" id="3393681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="3393684">//&nbsp;alloc&nbsp;allocates&nbsp;a&nbsp;new&nbsp;thread&nbsp;with&nbsp;the&nbsp;given&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="3393744">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;free&nbsp;pool&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="3393782">func</span>&nbsp;<span class="op" id="3393787">(</span><span class="ident" id="3393788">m</span>&nbsp;<span class="op" id="3393790">*</span><span class="ident" id="3393791">machine</span><span class="op" id="3393798">)</span>&nbsp;<span class="ident" id="3393800">alloc</span><span class="op" id="3393805">(</span><span class="ident" id="3393806">i</span>&nbsp;<span class="op" id="3393808">*</span><span class="ident" id="3393809">syntax</span><span class="op" id="3393815">.</span><span class="ident" id="3393816">Inst</span><span class="op" id="3393820">)</span>&nbsp;<span class="op" id="3393822">*</span><span class="ident" id="3393823">thread</span>&nbsp;<span class="op" id="3393830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393833">var</span>&nbsp;<span class="ident" id="3393837">t</span>&nbsp;<span class="op" id="3393839">*</span><span class="ident" id="3393840">thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393848">if</span>&nbsp;<span class="ident" id="3393851">n</span>&nbsp;<span class="op" id="3393853">:=</span>&nbsp;<span class="builtinfunc" id="3393856">len</span><span class="op" id="3393859">(</span><span class="ident" id="3393860">m</span><span class="op" id="3393861">.</span><span class="ident" id="3393862">pool</span><span class="op" id="3393866">)</span><span class="op" id="3393867">;</span>&nbsp;<span class="ident" id="3393869">n</span>&nbsp;<span class="op" id="3393871">&gt;</span>&nbsp;<span class="num" id="3393873">0</span>&nbsp;<span class="op" id="3393875">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393879">t</span>&nbsp;<span class="op" id="3393881">=</span>&nbsp;<span class="ident" id="3393883">m</span><span class="op" id="3393884">.</span><span class="ident" id="3393885">pool</span><span class="op" id="3393889">[</span><span class="ident" id="3393890">n</span><span class="op" id="3393891">-</span><span class="num" id="3393892">1</span><span class="op" id="3393893">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393897">m</span><span class="op" id="3393898">.</span><span class="ident" id="3393899">pool</span>&nbsp;<span class="op" id="3393904">=</span>&nbsp;<span class="ident" id="3393906">m</span><span class="op" id="3393907">.</span><span class="ident" id="3393908">pool</span><span class="op" id="3393912">[</span><span class="op" id="3393913">:</span><span class="ident" id="3393914">n</span><span class="op" id="3393915">-</span><span class="num" id="3393916">1</span><span class="op" id="3393917">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3393920">}</span>&nbsp;<span class="keyword" id="3393922">else</span>&nbsp;<span class="op" id="3393927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393931">t</span>&nbsp;<span class="op" id="3393933">=</span>&nbsp;<span class="builtinfunc" id="3393935">new</span><span class="op" id="3393938">(</span><span class="ident" id="3393939">thread</span><span class="op" id="3393945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393949">t</span><span class="op" id="3393950">.</span><span class="builtinfunc" id="3393951">cap</span>&nbsp;<span class="op" id="3393955">=</span>&nbsp;<span class="builtinfunc" id="3393957">make</span><span class="op" id="3393961">(</span><span class="op" id="3393962">[</span><span class="op" id="3393963">]</span><span class="builtintype" id="3393964">int</span><span class="op" id="3393967">,</span>&nbsp;<span class="builtinfunc" id="3393969">len</span><span class="op" id="3393972">(</span><span class="ident" id="3393973">m</span><span class="op" id="3393974">.</span><span class="ident" id="3393975">matchcap</span><span class="op" id="3393983">)</span><span class="op" id="3393984">,</span>&nbsp;<span class="builtinfunc" id="3393986">cap</span><span class="op" id="3393989">(</span><span class="ident" id="3393990">m</span><span class="op" id="3393991">.</span><span class="ident" id="3393992">matchcap</span><span class="op" id="3394000">)</span><span class="op" id="3394001">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3394004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394007">t</span><span class="op" id="3394008">.</span><span class="ident" id="3394009">inst</span>&nbsp;<span class="op" id="3394014">=</span>&nbsp;<span class="ident" id="3394016">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394019">return</span>&nbsp;<span class="ident" id="3394026">t</span><br>
<span class="lineno"></span><span class="op" id="3394028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3394031">//&nbsp;free&nbsp;returns&nbsp;t&nbsp;to&nbsp;the&nbsp;free&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="3394067">func</span>&nbsp;<span class="op" id="3394072">(</span><span class="ident" id="3394073">m</span>&nbsp;<span class="op" id="3394075">*</span><span class="ident" id="3394076">machine</span><span class="op" id="3394083">)</span>&nbsp;<span class="ident" id="3394085">free</span><span class="op" id="3394089">(</span><span class="ident" id="3394090">t</span>&nbsp;<span class="op" id="3394092">*</span><span class="ident" id="3394093">thread</span><span class="op" id="3394099">)</span>&nbsp;<span class="op" id="3394101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394104">m</span><span class="op" id="3394105">.</span><span class="ident" id="3394106">inputBytes</span><span class="op" id="3394116">.</span><span class="ident" id="3394117">str</span>&nbsp;<span class="op" id="3394121">=</span>&nbsp;<span class="builtintype" id="3394123">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394128">m</span><span class="op" id="3394129">.</span><span class="ident" id="3394130">inputString</span><span class="op" id="3394141">.</span><span class="ident" id="3394142">str</span>&nbsp;<span class="op" id="3394146">=</span>&nbsp;<span class="string" id="3394148">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394152">m</span><span class="op" id="3394153">.</span><span class="ident" id="3394154">inputReader</span><span class="op" id="3394165">.</span><span class="ident" id="3394166">r</span>&nbsp;<span class="op" id="3394168">=</span>&nbsp;<span class="builtintype" id="3394170">nil</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394175">m</span><span class="op" id="3394176">.</span><span class="ident" id="3394177">pool</span>&nbsp;<span class="op" id="3394182">=</span>&nbsp;<span class="builtinfunc" id="3394184">append</span><span class="op" id="3394190">(</span><span class="ident" id="3394191">m</span><span class="op" id="3394192">.</span><span class="ident" id="3394193">pool</span><span class="op" id="3394197">,</span>&nbsp;<span class="ident" id="3394199">t</span><span class="op" id="3394200">)</span><br>
<span class="lineno"></span><span class="op" id="3394202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3394205">//&nbsp;match&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="3394263">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno">115</span><span class="comment" id="3394304">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="3394357">func</span>&nbsp;<span class="op" id="3394362">(</span><span class="ident" id="3394363">m</span>&nbsp;<span class="op" id="3394365">*</span><span class="ident" id="3394366">machine</span><span class="op" id="3394373">)</span>&nbsp;<span class="ident" id="3394375">match</span><span class="op" id="3394380">(</span><span class="ident" id="3394381">i</span>&nbsp;<span class="ident" id="3394383">input</span><span class="op" id="3394388">,</span>&nbsp;<span class="ident" id="3394390">pos</span>&nbsp;<span class="builtintype" id="3394394">int</span><span class="op" id="3394397">)</span>&nbsp;<span class="builtintype" id="3394399">bool</span>&nbsp;<span class="op" id="3394404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394407">startCond</span>&nbsp;<span class="op" id="3394417">:=</span>&nbsp;<span class="ident" id="3394420">m</span><span class="op" id="3394421">.</span><span class="ident" id="3394422">re</span><span class="op" id="3394424">.</span><span class="ident" id="3394425">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394431">if</span>&nbsp;<span class="ident" id="3394434">startCond</span>&nbsp;<span class="op" id="3394444">==</span>&nbsp;<span class="op" id="3394447">^</span><span class="ident" id="3394448">syntax</span><span class="op" id="3394454">.</span><span class="ident" id="3394455">EmptyOp</span><span class="op" id="3394462">(</span><span class="num" id="3394463">0</span><span class="op" id="3394464">)</span>&nbsp;<span class="op" id="3394466">{</span>&nbsp;<span class="comment" id="3394468">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394484">return</span>&nbsp;<span class="builtintype" id="3394491">false</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3394498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394501">m</span><span class="op" id="3394502">.</span><span class="ident" id="3394503">matched</span>&nbsp;<span class="op" id="3394511">=</span>&nbsp;<span class="builtintype" id="3394513">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394520">for</span>&nbsp;<span class="ident" id="3394524">i</span>&nbsp;<span class="op" id="3394526">:=</span>&nbsp;<span class="keyword" id="3394529">range</span>&nbsp;<span class="ident" id="3394535">m</span><span class="op" id="3394536">.</span><span class="ident" id="3394537">matchcap</span>&nbsp;<span class="op" id="3394546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394550">m</span><span class="op" id="3394551">.</span><span class="ident" id="3394552">matchcap</span><span class="op" id="3394560">[</span><span class="ident" id="3394561">i</span><span class="op" id="3394562">]</span>&nbsp;<span class="op" id="3394564">=</span>&nbsp;<span class="op" id="3394566">-</span><span class="num" id="3394567">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3394570">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394573">runq</span><span class="op" id="3394577">,</span>&nbsp;<span class="ident" id="3394579">nextq</span>&nbsp;<span class="op" id="3394585">:=</span>&nbsp;<span class="op" id="3394588">&amp;</span><span class="ident" id="3394589">m</span><span class="op" id="3394590">.</span><span class="ident" id="3394591">q0</span><span class="op" id="3394593">,</span>&nbsp;<span class="op" id="3394595">&amp;</span><span class="ident" id="3394596">m</span><span class="op" id="3394597">.</span><span class="ident" id="3394598">q1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394602">r</span><span class="op" id="3394603">,</span>&nbsp;<span class="ident" id="3394605">r1</span>&nbsp;<span class="op" id="3394608">:=</span>&nbsp;<span class="ident" id="3394611">endOfText</span><span class="op" id="3394620">,</span>&nbsp;<span class="ident" id="3394622">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394633">width</span><span class="op" id="3394638">,</span>&nbsp;<span class="ident" id="3394640">width1</span>&nbsp;<span class="op" id="3394647">:=</span>&nbsp;<span class="num" id="3394650">0</span><span class="op" id="3394651">,</span>&nbsp;<span class="num" id="3394653">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394656">r</span><span class="op" id="3394657">,</span>&nbsp;<span class="ident" id="3394659">width</span>&nbsp;<span class="op" id="3394665">=</span>&nbsp;<span class="ident" id="3394667">i</span><span class="op" id="3394668">.</span><span class="ident" id="3394669">step</span><span class="op" id="3394673">(</span><span class="ident" id="3394674">pos</span><span class="op" id="3394677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394680">if</span>&nbsp;<span class="ident" id="3394683">r</span>&nbsp;<span class="op" id="3394685">!=</span>&nbsp;<span class="ident" id="3394688">endOfText</span>&nbsp;<span class="op" id="3394698">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394702">r1</span><span class="op" id="3394704">,</span>&nbsp;<span class="ident" id="3394706">width1</span>&nbsp;<span class="op" id="3394713">=</span>&nbsp;<span class="ident" id="3394715">i</span><span class="op" id="3394716">.</span><span class="ident" id="3394717">step</span><span class="op" id="3394721">(</span><span class="ident" id="3394722">pos</span>&nbsp;<span class="op" id="3394726">+</span>&nbsp;<span class="ident" id="3394728">width</span><span class="op" id="3394733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3394736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394739">var</span>&nbsp;<span class="ident" id="3394743">flag</span>&nbsp;<span class="ident" id="3394748">syntax</span><span class="op" id="3394754">.</span><span class="ident" id="3394755">EmptyOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394764">if</span>&nbsp;<span class="ident" id="3394767">pos</span>&nbsp;<span class="op" id="3394771">==</span>&nbsp;<span class="num" id="3394774">0</span>&nbsp;<span class="op" id="3394776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394780">flag</span>&nbsp;<span class="op" id="3394785">=</span>&nbsp;<span class="ident" id="3394787">syntax</span><span class="op" id="3394793">.</span><span class="ident" id="3394794">EmptyOpContext</span><span class="op" id="3394808">(</span><span class="op" id="3394809">-</span><span class="num" id="3394810">1</span><span class="op" id="3394811">,</span>&nbsp;<span class="ident" id="3394813">r</span><span class="op" id="3394814">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3394817">}</span>&nbsp;<span class="keyword" id="3394819">else</span>&nbsp;<span class="op" id="3394824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3394828">flag</span>&nbsp;<span class="op" id="3394833">=</span>&nbsp;<span class="ident" id="3394835">i</span><span class="op" id="3394836">.</span><span class="ident" id="3394837">context</span><span class="op" id="3394844">(</span><span class="ident" id="3394845">pos</span><span class="op" id="3394848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3394851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394854">for</span>&nbsp;<span class="op" id="3394858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394862">if</span>&nbsp;<span class="builtinfunc" id="3394865">len</span><span class="op" id="3394868">(</span><span class="ident" id="3394869">runq</span><span class="op" id="3394873">.</span><span class="ident" id="3394874">dense</span><span class="op" id="3394879">)</span>&nbsp;<span class="op" id="3394881">==</span>&nbsp;<span class="num" id="3394884">0</span>&nbsp;<span class="op" id="3394886">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394891">if</span>&nbsp;<span class="ident" id="3394894">startCond</span><span class="op" id="3394903">&amp;</span><span class="ident" id="3394904">syntax</span><span class="op" id="3394910">.</span><span class="ident" id="3394911">EmptyBeginText</span>&nbsp;<span class="op" id="3394926">!=</span>&nbsp;<span class="num" id="3394929">0</span>&nbsp;<span class="op" id="3394931">&amp;&amp;</span>&nbsp;<span class="ident" id="3394934">pos</span>&nbsp;<span class="op" id="3394938">!=</span>&nbsp;<span class="num" id="3394941">0</span>&nbsp;<span class="op" id="3394943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3394949">//&nbsp;Anchored&nbsp;match,&nbsp;past&nbsp;beginning&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394996">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395010">if</span>&nbsp;<span class="ident" id="3395013">m</span><span class="op" id="3395014">.</span><span class="ident" id="3395015">matched</span>&nbsp;<span class="op" id="3395023">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3395029">//&nbsp;Have&nbsp;match;&nbsp;finished&nbsp;exploring&nbsp;alternatives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395081">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395095">if</span>&nbsp;<span class="builtinfunc" id="3395098">len</span><span class="op" id="3395101">(</span><span class="ident" id="3395102">m</span><span class="op" id="3395103">.</span><span class="ident" id="3395104">re</span><span class="op" id="3395106">.</span><span class="ident" id="3395107">prefix</span><span class="op" id="3395113">)</span>&nbsp;<span class="op" id="3395115">&gt;</span>&nbsp;<span class="num" id="3395117">0</span>&nbsp;<span class="op" id="3395119">&amp;&amp;</span>&nbsp;<span class="ident" id="3395122">r1</span>&nbsp;<span class="op" id="3395125">!=</span>&nbsp;<span class="ident" id="3395128">m</span><span class="op" id="3395129">.</span><span class="ident" id="3395130">re</span><span class="op" id="3395132">.</span><span class="ident" id="3395133">prefixRune</span>&nbsp;<span class="op" id="3395144">&amp;&amp;</span>&nbsp;<span class="ident" id="3395147">i</span><span class="op" id="3395148">.</span><span class="ident" id="3395149">canCheckPrefix</span><span class="op" id="3395163">(</span><span class="op" id="3395164">)</span>&nbsp;<span class="op" id="3395166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3395172">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395230">advance</span>&nbsp;<span class="op" id="3395238">:=</span>&nbsp;<span class="ident" id="3395241">i</span><span class="op" id="3395242">.</span><span class="ident" id="3395243">index</span><span class="op" id="3395248">(</span><span class="ident" id="3395249">m</span><span class="op" id="3395250">.</span><span class="ident" id="3395251">re</span><span class="op" id="3395253">,</span>&nbsp;<span class="ident" id="3395255">pos</span><span class="op" id="3395258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395264">if</span>&nbsp;<span class="ident" id="3395267">advance</span>&nbsp;<span class="op" id="3395275">&lt;</span>&nbsp;<span class="num" id="3395277">0</span>&nbsp;<span class="op" id="3395279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395286">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395302">pos</span>&nbsp;<span class="op" id="3395306">+=</span>&nbsp;<span class="ident" id="3395309">advance</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395321">r</span><span class="op" id="3395322">,</span>&nbsp;<span class="ident" id="3395324">width</span>&nbsp;<span class="op" id="3395330">=</span>&nbsp;<span class="ident" id="3395332">i</span><span class="op" id="3395333">.</span><span class="ident" id="3395334">step</span><span class="op" id="3395338">(</span><span class="ident" id="3395339">pos</span><span class="op" id="3395342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395348">r1</span><span class="op" id="3395350">,</span>&nbsp;<span class="ident" id="3395352">width1</span>&nbsp;<span class="op" id="3395359">=</span>&nbsp;<span class="ident" id="3395361">i</span><span class="op" id="3395362">.</span><span class="ident" id="3395363">step</span><span class="op" id="3395367">(</span><span class="ident" id="3395368">pos</span>&nbsp;<span class="op" id="3395372">+</span>&nbsp;<span class="ident" id="3395374">width</span><span class="op" id="3395379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395392">if</span>&nbsp;<span class="op" id="3395395">!</span><span class="ident" id="3395396">m</span><span class="op" id="3395397">.</span><span class="ident" id="3395398">matched</span>&nbsp;<span class="op" id="3395406">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395411">if</span>&nbsp;<span class="builtinfunc" id="3395414">len</span><span class="op" id="3395417">(</span><span class="ident" id="3395418">m</span><span class="op" id="3395419">.</span><span class="ident" id="3395420">matchcap</span><span class="op" id="3395428">)</span>&nbsp;<span class="op" id="3395430">&gt;</span>&nbsp;<span class="num" id="3395432">0</span>&nbsp;<span class="op" id="3395434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395440">m</span><span class="op" id="3395441">.</span><span class="ident" id="3395442">matchcap</span><span class="op" id="3395450">[</span><span class="num" id="3395451">0</span><span class="op" id="3395452">]</span>&nbsp;<span class="op" id="3395454">=</span>&nbsp;<span class="ident" id="3395456">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395468">m</span><span class="op" id="3395469">.</span><span class="ident" id="3395470">add</span><span class="op" id="3395473">(</span><span class="ident" id="3395474">runq</span><span class="op" id="3395478">,</span>&nbsp;<span class="builtintype" id="3395480">uint32</span><span class="op" id="3395486">(</span><span class="ident" id="3395487">m</span><span class="op" id="3395488">.</span><span class="ident" id="3395489">p</span><span class="op" id="3395490">.</span><span class="ident" id="3395491">Start</span><span class="op" id="3395496">)</span><span class="op" id="3395497">,</span>&nbsp;<span class="ident" id="3395499">pos</span><span class="op" id="3395502">,</span>&nbsp;<span class="ident" id="3395504">m</span><span class="op" id="3395505">.</span><span class="ident" id="3395506">matchcap</span><span class="op" id="3395514">,</span>&nbsp;<span class="ident" id="3395516">flag</span><span class="op" id="3395520">,</span>&nbsp;<span class="builtintype" id="3395522">nil</span><span class="op" id="3395525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395529">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395533">flag</span>&nbsp;<span class="op" id="3395538">=</span>&nbsp;<span class="ident" id="3395540">syntax</span><span class="op" id="3395546">.</span><span class="ident" id="3395547">EmptyOpContext</span><span class="op" id="3395561">(</span><span class="ident" id="3395562">r</span><span class="op" id="3395563">,</span>&nbsp;<span class="ident" id="3395565">r1</span><span class="op" id="3395567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395571">m</span><span class="op" id="3395572">.</span><span class="ident" id="3395573">step</span><span class="op" id="3395577">(</span><span class="ident" id="3395578">runq</span><span class="op" id="3395582">,</span>&nbsp;<span class="ident" id="3395584">nextq</span><span class="op" id="3395589">,</span>&nbsp;<span class="ident" id="3395591">pos</span><span class="op" id="3395594">,</span>&nbsp;<span class="ident" id="3395596">pos</span><span class="op" id="3395599">+</span><span class="ident" id="3395600">width</span><span class="op" id="3395605">,</span>&nbsp;<span class="ident" id="3395607">r</span><span class="op" id="3395608">,</span>&nbsp;<span class="ident" id="3395610">flag</span><span class="op" id="3395614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395618">if</span>&nbsp;<span class="ident" id="3395621">width</span>&nbsp;<span class="op" id="3395627">==</span>&nbsp;<span class="num" id="3395630">0</span>&nbsp;<span class="op" id="3395632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395637">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395645">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395649">if</span>&nbsp;<span class="builtinfunc" id="3395652">len</span><span class="op" id="3395655">(</span><span class="ident" id="3395656">m</span><span class="op" id="3395657">.</span><span class="ident" id="3395658">matchcap</span><span class="op" id="3395666">)</span>&nbsp;<span class="op" id="3395668">==</span>&nbsp;<span class="num" id="3395671">0</span>&nbsp;<span class="op" id="3395673">&amp;&amp;</span>&nbsp;<span class="ident" id="3395676">m</span><span class="op" id="3395677">.</span><span class="ident" id="3395678">matched</span>&nbsp;<span class="op" id="3395686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3395691">//&nbsp;Found&nbsp;a&nbsp;match&nbsp;and&nbsp;not&nbsp;paying&nbsp;attention</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3395736">//&nbsp;to&nbsp;where&nbsp;it&nbsp;is,&nbsp;so&nbsp;any&nbsp;match&nbsp;will&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395780">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395788">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395792">pos</span>&nbsp;<span class="op" id="3395796">+=</span>&nbsp;<span class="ident" id="3395799">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395807">r</span><span class="op" id="3395808">,</span>&nbsp;<span class="ident" id="3395810">width</span>&nbsp;<span class="op" id="3395816">=</span>&nbsp;<span class="ident" id="3395818">r1</span><span class="op" id="3395820">,</span>&nbsp;<span class="ident" id="3395822">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395831">if</span>&nbsp;<span class="ident" id="3395834">r</span>&nbsp;<span class="op" id="3395836">!=</span>&nbsp;<span class="ident" id="3395839">endOfText</span>&nbsp;<span class="op" id="3395849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395854">r1</span><span class="op" id="3395856">,</span>&nbsp;<span class="ident" id="3395858">width1</span>&nbsp;<span class="op" id="3395865">=</span>&nbsp;<span class="ident" id="3395867">i</span><span class="op" id="3395868">.</span><span class="ident" id="3395869">step</span><span class="op" id="3395873">(</span><span class="ident" id="3395874">pos</span>&nbsp;<span class="op" id="3395878">+</span>&nbsp;<span class="ident" id="3395880">width</span><span class="op" id="3395885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395889">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395893">runq</span><span class="op" id="3395897">,</span>&nbsp;<span class="ident" id="3395899">nextq</span>&nbsp;<span class="op" id="3395905">=</span>&nbsp;<span class="ident" id="3395907">nextq</span><span class="op" id="3395912">,</span>&nbsp;<span class="ident" id="3395914">runq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3395923">m</span><span class="op" id="3395924">.</span><span class="ident" id="3395925">clear</span><span class="op" id="3395930">(</span><span class="ident" id="3395931">nextq</span><span class="op" id="3395936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3395939">return</span>&nbsp;<span class="ident" id="3395946">m</span><span class="op" id="3395947">.</span><span class="ident" id="3395948">matched</span><br>
<span class="lineno"></span><span class="op" id="3395956">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="3395959">//&nbsp;clear&nbsp;frees&nbsp;all&nbsp;threads&nbsp;on&nbsp;the&nbsp;thread&nbsp;queue.</span><br>
<span class="lineno"></span><span class="keyword" id="3396007">func</span>&nbsp;<span class="op" id="3396012">(</span><span class="ident" id="3396013">m</span>&nbsp;<span class="op" id="3396015">*</span><span class="ident" id="3396016">machine</span><span class="op" id="3396023">)</span>&nbsp;<span class="ident" id="3396025">clear</span><span class="op" id="3396030">(</span><span class="ident" id="3396031">q</span>&nbsp;<span class="op" id="3396033">*</span><span class="ident" id="3396034">queue</span><span class="op" id="3396039">)</span>&nbsp;<span class="op" id="3396041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396044">for</span>&nbsp;<span class="ident" id="3396048">_</span><span class="op" id="3396049">,</span>&nbsp;<span class="ident" id="3396051">d</span>&nbsp;<span class="op" id="3396053">:=</span>&nbsp;<span class="keyword" id="3396056">range</span>&nbsp;<span class="ident" id="3396062">q</span><span class="op" id="3396063">.</span><span class="ident" id="3396064">dense</span>&nbsp;<span class="op" id="3396070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396074">if</span>&nbsp;<span class="ident" id="3396077">d</span><span class="op" id="3396078">.</span><span class="ident" id="3396079">t</span>&nbsp;<span class="op" id="3396081">!=</span>&nbsp;<span class="builtintype" id="3396084">nil</span>&nbsp;<span class="op" id="3396088">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3396093">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396111">m</span><span class="op" id="3396112">.</span><span class="ident" id="3396113">pool</span>&nbsp;<span class="op" id="3396118">=</span>&nbsp;<span class="builtinfunc" id="3396120">append</span><span class="op" id="3396126">(</span><span class="ident" id="3396127">m</span><span class="op" id="3396128">.</span><span class="ident" id="3396129">pool</span><span class="op" id="3396133">,</span>&nbsp;<span class="ident" id="3396135">d</span><span class="op" id="3396136">.</span><span class="ident" id="3396137">t</span><span class="op" id="3396138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3396142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3396145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396148">q</span><span class="op" id="3396149">.</span><span class="ident" id="3396150">dense</span>&nbsp;<span class="op" id="3396156">=</span>&nbsp;<span class="ident" id="3396158">q</span><span class="op" id="3396159">.</span><span class="ident" id="3396160">dense</span><span class="op" id="3396165">[</span><span class="op" id="3396166">:</span><span class="num" id="3396167">0</span><span class="op" id="3396168">]</span><br>
<span class="lineno">195</span><span class="op" id="3396170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3396173">//&nbsp;step&nbsp;executes&nbsp;one&nbsp;step&nbsp;of&nbsp;the&nbsp;machine,&nbsp;running&nbsp;each&nbsp;of&nbsp;the&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="3396243">//&nbsp;on&nbsp;runq&nbsp;and&nbsp;appending&nbsp;new&nbsp;threads&nbsp;to&nbsp;nextq.</span><br>
<span class="lineno"></span><span class="comment" id="3396290">//&nbsp;The&nbsp;step&nbsp;processes&nbsp;the&nbsp;rune&nbsp;c&nbsp;(which&nbsp;may&nbsp;be&nbsp;endOfText),</span><br>
<span class="lineno">200</span><span class="comment" id="3396349">//&nbsp;which&nbsp;starts&nbsp;at&nbsp;position&nbsp;pos&nbsp;and&nbsp;ends&nbsp;at&nbsp;nextPos.</span><br>
<span class="lineno"></span><span class="comment" id="3396402">//&nbsp;nextCond&nbsp;gives&nbsp;the&nbsp;setting&nbsp;for&nbsp;the&nbsp;empty-width&nbsp;flags&nbsp;after&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="3396467">func</span>&nbsp;<span class="op" id="3396472">(</span><span class="ident" id="3396473">m</span>&nbsp;<span class="op" id="3396475">*</span><span class="ident" id="3396476">machine</span><span class="op" id="3396483">)</span>&nbsp;<span class="ident" id="3396485">step</span><span class="op" id="3396489">(</span><span class="ident" id="3396490">runq</span><span class="op" id="3396494">,</span>&nbsp;<span class="ident" id="3396496">nextq</span>&nbsp;<span class="op" id="3396502">*</span><span class="ident" id="3396503">queue</span><span class="op" id="3396508">,</span>&nbsp;<span class="ident" id="3396510">pos</span><span class="op" id="3396513">,</span>&nbsp;<span class="ident" id="3396515">nextPos</span>&nbsp;<span class="builtintype" id="3396523">int</span><span class="op" id="3396526">,</span>&nbsp;<span class="ident" id="3396528">c</span>&nbsp;<span class="builtintype" id="3396530">rune</span><span class="op" id="3396534">,</span>&nbsp;<span class="ident" id="3396536">nextCond</span>&nbsp;<span class="ident" id="3396545">syntax</span><span class="op" id="3396551">.</span><span class="ident" id="3396552">EmptyOp</span><span class="op" id="3396559">)</span>&nbsp;<span class="op" id="3396561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396564">longest</span>&nbsp;<span class="op" id="3396572">:=</span>&nbsp;<span class="ident" id="3396575">m</span><span class="op" id="3396576">.</span><span class="ident" id="3396577">re</span><span class="op" id="3396579">.</span><span class="ident" id="3396580">longest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396589">for</span>&nbsp;<span class="ident" id="3396593">j</span>&nbsp;<span class="op" id="3396595">:=</span>&nbsp;<span class="num" id="3396598">0</span><span class="op" id="3396599">;</span>&nbsp;<span class="ident" id="3396601">j</span>&nbsp;<span class="op" id="3396603">&lt;</span>&nbsp;<span class="builtinfunc" id="3396605">len</span><span class="op" id="3396608">(</span><span class="ident" id="3396609">runq</span><span class="op" id="3396613">.</span><span class="ident" id="3396614">dense</span><span class="op" id="3396619">)</span><span class="op" id="3396620">;</span>&nbsp;<span class="ident" id="3396622">j</span><span class="op" id="3396623">++</span>&nbsp;<span class="op" id="3396626">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396630">d</span>&nbsp;<span class="op" id="3396632">:=</span>&nbsp;<span class="op" id="3396635">&amp;</span><span class="ident" id="3396636">runq</span><span class="op" id="3396640">.</span><span class="ident" id="3396641">dense</span><span class="op" id="3396646">[</span><span class="ident" id="3396647">j</span><span class="op" id="3396648">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396652">t</span>&nbsp;<span class="op" id="3396654">:=</span>&nbsp;<span class="ident" id="3396657">d</span><span class="op" id="3396658">.</span><span class="ident" id="3396659">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396663">if</span>&nbsp;<span class="ident" id="3396666">t</span>&nbsp;<span class="op" id="3396668">==</span>&nbsp;<span class="builtintype" id="3396671">nil</span>&nbsp;<span class="op" id="3396675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396680">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3396691">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396695">if</span>&nbsp;<span class="ident" id="3396698">longest</span>&nbsp;<span class="op" id="3396706">&amp;&amp;</span>&nbsp;<span class="ident" id="3396709">m</span><span class="op" id="3396710">.</span><span class="ident" id="3396711">matched</span>&nbsp;<span class="op" id="3396719">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3396722">len</span><span class="op" id="3396725">(</span><span class="ident" id="3396726">t</span><span class="op" id="3396727">.</span><span class="builtinfunc" id="3396728">cap</span><span class="op" id="3396731">)</span>&nbsp;<span class="op" id="3396733">&gt;</span>&nbsp;<span class="num" id="3396735">0</span>&nbsp;<span class="op" id="3396737">&amp;&amp;</span>&nbsp;<span class="ident" id="3396740">m</span><span class="op" id="3396741">.</span><span class="ident" id="3396742">matchcap</span><span class="op" id="3396750">[</span><span class="num" id="3396751">0</span><span class="op" id="3396752">]</span>&nbsp;<span class="op" id="3396754">&lt;</span>&nbsp;<span class="ident" id="3396756">t</span><span class="op" id="3396757">.</span><span class="builtinfunc" id="3396758">cap</span><span class="op" id="3396761">[</span><span class="num" id="3396762">0</span><span class="op" id="3396763">]</span>&nbsp;<span class="op" id="3396765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3396770">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396786">m</span><span class="op" id="3396787">.</span><span class="ident" id="3396788">pool</span>&nbsp;<span class="op" id="3396793">=</span>&nbsp;<span class="builtinfunc" id="3396795">append</span><span class="op" id="3396801">(</span><span class="ident" id="3396802">m</span><span class="op" id="3396803">.</span><span class="ident" id="3396804">pool</span><span class="op" id="3396808">,</span>&nbsp;<span class="ident" id="3396810">t</span><span class="op" id="3396811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396816">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3396827">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396831">i</span>&nbsp;<span class="op" id="3396833">:=</span>&nbsp;<span class="ident" id="3396836">t</span><span class="op" id="3396837">.</span><span class="ident" id="3396838">inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396845">add</span>&nbsp;<span class="op" id="3396849">:=</span>&nbsp;<span class="builtintype" id="3396852">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396860">switch</span>&nbsp;<span class="ident" id="3396867">i</span><span class="op" id="3396868">.</span><span class="ident" id="3396869">Op</span>&nbsp;<span class="op" id="3396872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396876">default</span><span class="op" id="3396883">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3396888">panic</span><span class="op" id="3396893">(</span><span class="string" id="3396894">&#34;bad&nbsp;inst&#34;</span><span class="op" id="3396904">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396909">case</span>&nbsp;<span class="ident" id="3396914">syntax</span><span class="op" id="3396920">.</span><span class="ident" id="3396921">InstMatch</span><span class="op" id="3396930">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3396935">if</span>&nbsp;<span class="builtinfunc" id="3396938">len</span><span class="op" id="3396941">(</span><span class="ident" id="3396942">t</span><span class="op" id="3396943">.</span><span class="builtinfunc" id="3396944">cap</span><span class="op" id="3396947">)</span>&nbsp;<span class="op" id="3396949">&gt;</span>&nbsp;<span class="num" id="3396951">0</span>&nbsp;<span class="op" id="3396953">&amp;&amp;</span>&nbsp;<span class="op" id="3396956">(</span><span class="op" id="3396957">!</span><span class="ident" id="3396958">longest</span>&nbsp;<span class="op" id="3396966">||</span>&nbsp;<span class="op" id="3396969">!</span><span class="ident" id="3396970">m</span><span class="op" id="3396971">.</span><span class="ident" id="3396972">matched</span>&nbsp;<span class="op" id="3396980">||</span>&nbsp;<span class="ident" id="3396983">m</span><span class="op" id="3396984">.</span><span class="ident" id="3396985">matchcap</span><span class="op" id="3396993">[</span><span class="num" id="3396994">1</span><span class="op" id="3396995">]</span>&nbsp;<span class="op" id="3396997">&lt;</span>&nbsp;<span class="ident" id="3396999">pos</span><span class="op" id="3397002">)</span>&nbsp;<span class="op" id="3397004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3397010">t</span><span class="op" id="3397011">.</span><span class="builtinfunc" id="3397012">cap</span><span class="op" id="3397015">[</span><span class="num" id="3397016">1</span><span class="op" id="3397017">]</span>&nbsp;<span class="op" id="3397019">=</span>&nbsp;<span class="ident" id="3397021">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3397029">copy</span><span class="op" id="3397033">(</span><span class="ident" id="3397034">m</span><span class="op" id="3397035">.</span><span class="ident" id="3397036">matchcap</span><span class="op" id="3397044">,</span>&nbsp;<span class="ident" id="3397046">t</span><span class="op" id="3397047">.</span><span class="builtinfunc" id="3397048">cap</span><span class="op" id="3397051">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397061">if</span>&nbsp;<span class="op" id="3397064">!</span><span class="ident" id="3397065">longest</span>&nbsp;<span class="op" id="3397073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3397079">//&nbsp;First-match&nbsp;mode:&nbsp;cut&nbsp;off&nbsp;all&nbsp;lower-priority&nbsp;threads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397140">for</span>&nbsp;<span class="ident" id="3397144">_</span><span class="op" id="3397145">,</span>&nbsp;<span class="ident" id="3397147">d</span>&nbsp;<span class="op" id="3397149">:=</span>&nbsp;<span class="keyword" id="3397152">range</span>&nbsp;<span class="ident" id="3397158">runq</span><span class="op" id="3397162">.</span><span class="ident" id="3397163">dense</span><span class="op" id="3397168">[</span><span class="ident" id="3397169">j</span><span class="op" id="3397170">+</span><span class="num" id="3397171">1</span><span class="op" id="3397172">:</span><span class="op" id="3397173">]</span>&nbsp;<span class="op" id="3397175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397182">if</span>&nbsp;<span class="ident" id="3397185">d</span><span class="op" id="3397186">.</span><span class="ident" id="3397187">t</span>&nbsp;<span class="op" id="3397189">!=</span>&nbsp;<span class="builtintype" id="3397192">nil</span>&nbsp;<span class="op" id="3397196">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3397204">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3397225">m</span><span class="op" id="3397226">.</span><span class="ident" id="3397227">pool</span>&nbsp;<span class="op" id="3397232">=</span>&nbsp;<span class="builtinfunc" id="3397234">append</span><span class="op" id="3397240">(</span><span class="ident" id="3397241">m</span><span class="op" id="3397242">.</span><span class="ident" id="3397243">pool</span><span class="op" id="3397247">,</span>&nbsp;<span class="ident" id="3397249">d</span><span class="op" id="3397250">.</span><span class="ident" id="3397251">t</span><span class="op" id="3397252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3397271">runq</span><span class="op" id="3397275">.</span><span class="ident" id="3397276">dense</span>&nbsp;<span class="op" id="3397282">=</span>&nbsp;<span class="ident" id="3397284">runq</span><span class="op" id="3397288">.</span><span class="ident" id="3397289">dense</span><span class="op" id="3397294">[</span><span class="op" id="3397295">:</span><span class="num" id="3397296">0</span><span class="op" id="3397297">]</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3397307">m</span><span class="op" id="3397308">.</span><span class="ident" id="3397309">matched</span>&nbsp;<span class="op" id="3397317">=</span>&nbsp;<span class="builtintype" id="3397319">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397327">case</span>&nbsp;<span class="ident" id="3397332">syntax</span><span class="op" id="3397338">.</span><span class="ident" id="3397339">InstRune</span><span class="op" id="3397347">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3397352">add</span>&nbsp;<span class="op" id="3397356">=</span>&nbsp;<span class="ident" id="3397358">i</span><span class="op" id="3397359">.</span><span class="ident" id="3397360">MatchRune</span><span class="op" id="3397369">(</span><span class="ident" id="3397370">c</span><span class="op" id="3397371">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397375">case</span>&nbsp;<span class="ident" id="3397380">syntax</span><span class="op" id="3397386">.</span><span class="ident" id="3397387">InstRune1</span><span class="op" id="3397396">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3397401">add</span>&nbsp;<span class="op" id="3397405">=</span>&nbsp;<span class="ident" id="3397407">c</span>&nbsp;<span class="op" id="3397409">==</span>&nbsp;<span class="ident" id="3397412">i</span><span class="op" id="3397413">.</span><span class="ident" id="3397414">Rune</span><span class="op" id="3397418">[</span><span class="num" id="3397419">0</span><span class="op" id="3397420">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397424">case</span>&nbsp;<span class="ident" id="3397429">syntax</span><span class="op" id="3397435">.</span><span class="ident" id="3397436">InstRuneAny</span><span class="op" id="3397447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3397452">add</span>&nbsp;<span class="op" id="3397456">=</span>&nbsp;<span class="builtintype" id="3397458">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397465">case</span>&nbsp;<span class="ident" id="3397470">syntax</span><span class="op" id="3397476">.</span><span class="ident" id="3397477">InstRuneAnyNotNL</span><span class="op" id="3397493">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3397498">add</span>&nbsp;<span class="op" id="3397502">=</span>&nbsp;<span class="ident" id="3397504">c</span>&nbsp;<span class="op" id="3397506">!=</span>&nbsp;<span class="string" id="3397509">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397520">if</span>&nbsp;<span class="ident" id="3397523">add</span>&nbsp;<span class="op" id="3397527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3397532">t</span>&nbsp;<span class="op" id="3397534">=</span>&nbsp;<span class="ident" id="3397536">m</span><span class="op" id="3397537">.</span><span class="ident" id="3397538">add</span><span class="op" id="3397541">(</span><span class="ident" id="3397542">nextq</span><span class="op" id="3397547">,</span>&nbsp;<span class="ident" id="3397549">i</span><span class="op" id="3397550">.</span><span class="ident" id="3397551">Out</span><span class="op" id="3397554">,</span>&nbsp;<span class="ident" id="3397556">nextPos</span><span class="op" id="3397563">,</span>&nbsp;<span class="ident" id="3397565">t</span><span class="op" id="3397566">.</span><span class="builtinfunc" id="3397567">cap</span><span class="op" id="3397570">,</span>&nbsp;<span class="ident" id="3397572">nextCond</span><span class="op" id="3397580">,</span>&nbsp;<span class="ident" id="3397582">t</span><span class="op" id="3397583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397587">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3397591">if</span>&nbsp;<span class="ident" id="3397594">t</span>&nbsp;<span class="op" id="3397596">!=</span>&nbsp;<span class="builtintype" id="3397599">nil</span>&nbsp;<span class="op" id="3397603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3397608">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3397624">m</span><span class="op" id="3397625">.</span><span class="ident" id="3397626">pool</span>&nbsp;<span class="op" id="3397631">=</span>&nbsp;<span class="builtinfunc" id="3397633">append</span><span class="op" id="3397639">(</span><span class="ident" id="3397640">m</span><span class="op" id="3397641">.</span><span class="ident" id="3397642">pool</span><span class="op" id="3397646">,</span>&nbsp;<span class="ident" id="3397648">t</span><span class="op" id="3397649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3397656">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3397659">runq</span><span class="op" id="3397663">.</span><span class="ident" id="3397664">dense</span>&nbsp;<span class="op" id="3397670">=</span>&nbsp;<span class="ident" id="3397672">runq</span><span class="op" id="3397676">.</span><span class="ident" id="3397677">dense</span><span class="op" id="3397682">[</span><span class="op" id="3397683">:</span><span class="num" id="3397684">0</span><span class="op" id="3397685">]</span><br>
<span class="lineno"></span><span class="op" id="3397687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3397690">//&nbsp;add&nbsp;adds&nbsp;an&nbsp;entry&nbsp;to&nbsp;q&nbsp;for&nbsp;pc,&nbsp;unless&nbsp;the&nbsp;q&nbsp;already&nbsp;has&nbsp;such&nbsp;an&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="3397764">//&nbsp;It&nbsp;also&nbsp;recursively&nbsp;adds&nbsp;an&nbsp;entry&nbsp;for&nbsp;all&nbsp;instructions&nbsp;reachable&nbsp;from&nbsp;pc&nbsp;by&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="3397853">//&nbsp;empty-width&nbsp;conditions&nbsp;satisfied&nbsp;by&nbsp;cond.&nbsp;&nbsp;pos&nbsp;gives&nbsp;the&nbsp;current&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="3397930">//&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="3397947">func</span>&nbsp;<span class="op" id="3397952">(</span><span class="ident" id="3397953">m</span>&nbsp;<span class="op" id="3397955">*</span><span class="ident" id="3397956">machine</span><span class="op" id="3397963">)</span>&nbsp;<span class="ident" id="3397965">add</span><span class="op" id="3397968">(</span><span class="ident" id="3397969">q</span>&nbsp;<span class="op" id="3397971">*</span><span class="ident" id="3397972">queue</span><span class="op" id="3397977">,</span>&nbsp;<span class="ident" id="3397979">pc</span>&nbsp;<span class="builtintype" id="3397982">uint32</span><span class="op" id="3397988">,</span>&nbsp;<span class="ident" id="3397990">pos</span>&nbsp;<span class="builtintype" id="3397994">int</span><span class="op" id="3397997">,</span>&nbsp;<span class="builtinfunc" id="3397999">cap</span>&nbsp;<span class="op" id="3398003">[</span><span class="op" id="3398004">]</span><span class="builtintype" id="3398005">int</span><span class="op" id="3398008">,</span>&nbsp;<span class="ident" id="3398010">cond</span>&nbsp;<span class="ident" id="3398015">syntax</span><span class="op" id="3398021">.</span><span class="ident" id="3398022">EmptyOp</span><span class="op" id="3398029">,</span>&nbsp;<span class="ident" id="3398031">t</span>&nbsp;<span class="op" id="3398033">*</span><span class="ident" id="3398034">thread</span><span class="op" id="3398040">)</span>&nbsp;<span class="op" id="3398042">*</span><span class="ident" id="3398043">thread</span>&nbsp;<span class="op" id="3398050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398053">if</span>&nbsp;<span class="ident" id="3398056">pc</span>&nbsp;<span class="op" id="3398059">==</span>&nbsp;<span class="num" id="3398062">0</span>&nbsp;<span class="op" id="3398064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398068">return</span>&nbsp;<span class="ident" id="3398075">t</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3398078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398081">if</span>&nbsp;<span class="ident" id="3398084">j</span>&nbsp;<span class="op" id="3398086">:=</span>&nbsp;<span class="ident" id="3398089">q</span><span class="op" id="3398090">.</span><span class="ident" id="3398091">sparse</span><span class="op" id="3398097">[</span><span class="ident" id="3398098">pc</span><span class="op" id="3398100">]</span><span class="op" id="3398101">;</span>&nbsp;<span class="ident" id="3398103">j</span>&nbsp;<span class="op" id="3398105">&lt;</span>&nbsp;<span class="builtintype" id="3398107">uint32</span><span class="op" id="3398113">(</span><span class="builtinfunc" id="3398114">len</span><span class="op" id="3398117">(</span><span class="ident" id="3398118">q</span><span class="op" id="3398119">.</span><span class="ident" id="3398120">dense</span><span class="op" id="3398125">)</span><span class="op" id="3398126">)</span>&nbsp;<span class="op" id="3398128">&amp;&amp;</span>&nbsp;<span class="ident" id="3398131">q</span><span class="op" id="3398132">.</span><span class="ident" id="3398133">dense</span><span class="op" id="3398138">[</span><span class="ident" id="3398139">j</span><span class="op" id="3398140">]</span><span class="op" id="3398141">.</span><span class="ident" id="3398142">pc</span>&nbsp;<span class="op" id="3398145">==</span>&nbsp;<span class="ident" id="3398148">pc</span>&nbsp;<span class="op" id="3398151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398155">return</span>&nbsp;<span class="ident" id="3398162">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3398165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398169">j</span>&nbsp;<span class="op" id="3398171">:=</span>&nbsp;<span class="builtinfunc" id="3398174">len</span><span class="op" id="3398177">(</span><span class="ident" id="3398178">q</span><span class="op" id="3398179">.</span><span class="ident" id="3398180">dense</span><span class="op" id="3398185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398188">q</span><span class="op" id="3398189">.</span><span class="ident" id="3398190">dense</span>&nbsp;<span class="op" id="3398196">=</span>&nbsp;<span class="ident" id="3398198">q</span><span class="op" id="3398199">.</span><span class="ident" id="3398200">dense</span><span class="op" id="3398205">[</span><span class="op" id="3398206">:</span><span class="ident" id="3398207">j</span><span class="op" id="3398208">+</span><span class="num" id="3398209">1</span><span class="op" id="3398210">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398213">d</span>&nbsp;<span class="op" id="3398215">:=</span>&nbsp;<span class="op" id="3398218">&amp;</span><span class="ident" id="3398219">q</span><span class="op" id="3398220">.</span><span class="ident" id="3398221">dense</span><span class="op" id="3398226">[</span><span class="ident" id="3398227">j</span><span class="op" id="3398228">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398231">d</span><span class="op" id="3398232">.</span><span class="ident" id="3398233">t</span>&nbsp;<span class="op" id="3398235">=</span>&nbsp;<span class="builtintype" id="3398237">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398242">d</span><span class="op" id="3398243">.</span><span class="ident" id="3398244">pc</span>&nbsp;<span class="op" id="3398247">=</span>&nbsp;<span class="ident" id="3398249">pc</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398253">q</span><span class="op" id="3398254">.</span><span class="ident" id="3398255">sparse</span><span class="op" id="3398261">[</span><span class="ident" id="3398262">pc</span><span class="op" id="3398264">]</span>&nbsp;<span class="op" id="3398266">=</span>&nbsp;<span class="builtintype" id="3398268">uint32</span><span class="op" id="3398274">(</span><span class="ident" id="3398275">j</span><span class="op" id="3398276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398280">i</span>&nbsp;<span class="op" id="3398282">:=</span>&nbsp;<span class="op" id="3398285">&amp;</span><span class="ident" id="3398286">m</span><span class="op" id="3398287">.</span><span class="ident" id="3398288">p</span><span class="op" id="3398289">.</span><span class="ident" id="3398290">Inst</span><span class="op" id="3398294">[</span><span class="ident" id="3398295">pc</span><span class="op" id="3398297">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398300">switch</span>&nbsp;<span class="ident" id="3398307">i</span><span class="op" id="3398308">.</span><span class="ident" id="3398309">Op</span>&nbsp;<span class="op" id="3398312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398315">default</span><span class="op" id="3398322">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3398326">panic</span><span class="op" id="3398331">(</span><span class="string" id="3398332">&#34;unhandled&#34;</span><span class="op" id="3398343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398346">case</span>&nbsp;<span class="ident" id="3398351">syntax</span><span class="op" id="3398357">.</span><span class="ident" id="3398358">InstFail</span><span class="op" id="3398366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3398370">//&nbsp;nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398382">case</span>&nbsp;<span class="ident" id="3398387">syntax</span><span class="op" id="3398393">.</span><span class="ident" id="3398394">InstAlt</span><span class="op" id="3398401">,</span>&nbsp;<span class="ident" id="3398403">syntax</span><span class="op" id="3398409">.</span><span class="ident" id="3398410">InstAltMatch</span><span class="op" id="3398422">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398426">t</span>&nbsp;<span class="op" id="3398428">=</span>&nbsp;<span class="ident" id="3398430">m</span><span class="op" id="3398431">.</span><span class="ident" id="3398432">add</span><span class="op" id="3398435">(</span><span class="ident" id="3398436">q</span><span class="op" id="3398437">,</span>&nbsp;<span class="ident" id="3398439">i</span><span class="op" id="3398440">.</span><span class="ident" id="3398441">Out</span><span class="op" id="3398444">,</span>&nbsp;<span class="ident" id="3398446">pos</span><span class="op" id="3398449">,</span>&nbsp;<span class="builtinfunc" id="3398451">cap</span><span class="op" id="3398454">,</span>&nbsp;<span class="ident" id="3398456">cond</span><span class="op" id="3398460">,</span>&nbsp;<span class="ident" id="3398462">t</span><span class="op" id="3398463">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398467">t</span>&nbsp;<span class="op" id="3398469">=</span>&nbsp;<span class="ident" id="3398471">m</span><span class="op" id="3398472">.</span><span class="ident" id="3398473">add</span><span class="op" id="3398476">(</span><span class="ident" id="3398477">q</span><span class="op" id="3398478">,</span>&nbsp;<span class="ident" id="3398480">i</span><span class="op" id="3398481">.</span><span class="ident" id="3398482">Arg</span><span class="op" id="3398485">,</span>&nbsp;<span class="ident" id="3398487">pos</span><span class="op" id="3398490">,</span>&nbsp;<span class="builtinfunc" id="3398492">cap</span><span class="op" id="3398495">,</span>&nbsp;<span class="ident" id="3398497">cond</span><span class="op" id="3398501">,</span>&nbsp;<span class="ident" id="3398503">t</span><span class="op" id="3398504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398507">case</span>&nbsp;<span class="ident" id="3398512">syntax</span><span class="op" id="3398518">.</span><span class="ident" id="3398519">InstEmptyWidth</span><span class="op" id="3398533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398537">if</span>&nbsp;<span class="ident" id="3398540">syntax</span><span class="op" id="3398546">.</span><span class="ident" id="3398547">EmptyOp</span><span class="op" id="3398554">(</span><span class="ident" id="3398555">i</span><span class="op" id="3398556">.</span><span class="ident" id="3398557">Arg</span><span class="op" id="3398560">)</span><span class="op" id="3398561">&amp;^</span><span class="ident" id="3398563">cond</span>&nbsp;<span class="op" id="3398568">==</span>&nbsp;<span class="num" id="3398571">0</span>&nbsp;<span class="op" id="3398573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398578">t</span>&nbsp;<span class="op" id="3398580">=</span>&nbsp;<span class="ident" id="3398582">m</span><span class="op" id="3398583">.</span><span class="ident" id="3398584">add</span><span class="op" id="3398587">(</span><span class="ident" id="3398588">q</span><span class="op" id="3398589">,</span>&nbsp;<span class="ident" id="3398591">i</span><span class="op" id="3398592">.</span><span class="ident" id="3398593">Out</span><span class="op" id="3398596">,</span>&nbsp;<span class="ident" id="3398598">pos</span><span class="op" id="3398601">,</span>&nbsp;<span class="builtinfunc" id="3398603">cap</span><span class="op" id="3398606">,</span>&nbsp;<span class="ident" id="3398608">cond</span><span class="op" id="3398612">,</span>&nbsp;<span class="ident" id="3398614">t</span><span class="op" id="3398615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3398619">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398622">case</span>&nbsp;<span class="ident" id="3398627">syntax</span><span class="op" id="3398633">.</span><span class="ident" id="3398634">InstNop</span><span class="op" id="3398641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398645">t</span>&nbsp;<span class="op" id="3398647">=</span>&nbsp;<span class="ident" id="3398649">m</span><span class="op" id="3398650">.</span><span class="ident" id="3398651">add</span><span class="op" id="3398654">(</span><span class="ident" id="3398655">q</span><span class="op" id="3398656">,</span>&nbsp;<span class="ident" id="3398658">i</span><span class="op" id="3398659">.</span><span class="ident" id="3398660">Out</span><span class="op" id="3398663">,</span>&nbsp;<span class="ident" id="3398665">pos</span><span class="op" id="3398668">,</span>&nbsp;<span class="builtinfunc" id="3398670">cap</span><span class="op" id="3398673">,</span>&nbsp;<span class="ident" id="3398675">cond</span><span class="op" id="3398679">,</span>&nbsp;<span class="ident" id="3398681">t</span><span class="op" id="3398682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398685">case</span>&nbsp;<span class="ident" id="3398690">syntax</span><span class="op" id="3398696">.</span><span class="ident" id="3398697">InstCapture</span><span class="op" id="3398708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398712">if</span>&nbsp;<span class="builtintype" id="3398715">int</span><span class="op" id="3398718">(</span><span class="ident" id="3398719">i</span><span class="op" id="3398720">.</span><span class="ident" id="3398721">Arg</span><span class="op" id="3398724">)</span>&nbsp;<span class="op" id="3398726">&lt;</span>&nbsp;<span class="builtinfunc" id="3398728">len</span><span class="op" id="3398731">(</span><span class="builtinfunc" id="3398732">cap</span><span class="op" id="3398735">)</span>&nbsp;<span class="op" id="3398737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398742">opos</span>&nbsp;<span class="op" id="3398747">:=</span>&nbsp;<span class="builtinfunc" id="3398750">cap</span><span class="op" id="3398753">[</span><span class="ident" id="3398754">i</span><span class="op" id="3398755">.</span><span class="ident" id="3398756">Arg</span><span class="op" id="3398759">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3398764">cap</span><span class="op" id="3398767">[</span><span class="ident" id="3398768">i</span><span class="op" id="3398769">.</span><span class="ident" id="3398770">Arg</span><span class="op" id="3398773">]</span>&nbsp;<span class="op" id="3398775">=</span>&nbsp;<span class="ident" id="3398777">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398784">m</span><span class="op" id="3398785">.</span><span class="ident" id="3398786">add</span><span class="op" id="3398789">(</span><span class="ident" id="3398790">q</span><span class="op" id="3398791">,</span>&nbsp;<span class="ident" id="3398793">i</span><span class="op" id="3398794">.</span><span class="ident" id="3398795">Out</span><span class="op" id="3398798">,</span>&nbsp;<span class="ident" id="3398800">pos</span><span class="op" id="3398803">,</span>&nbsp;<span class="builtinfunc" id="3398805">cap</span><span class="op" id="3398808">,</span>&nbsp;<span class="ident" id="3398810">cond</span><span class="op" id="3398814">,</span>&nbsp;<span class="builtintype" id="3398816">nil</span><span class="op" id="3398819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3398824">cap</span><span class="op" id="3398827">[</span><span class="ident" id="3398828">i</span><span class="op" id="3398829">.</span><span class="ident" id="3398830">Arg</span><span class="op" id="3398833">]</span>&nbsp;<span class="op" id="3398835">=</span>&nbsp;<span class="ident" id="3398837">opos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3398844">}</span>&nbsp;<span class="keyword" id="3398846">else</span>&nbsp;<span class="op" id="3398851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398856">t</span>&nbsp;<span class="op" id="3398858">=</span>&nbsp;<span class="ident" id="3398860">m</span><span class="op" id="3398861">.</span><span class="ident" id="3398862">add</span><span class="op" id="3398865">(</span><span class="ident" id="3398866">q</span><span class="op" id="3398867">,</span>&nbsp;<span class="ident" id="3398869">i</span><span class="op" id="3398870">.</span><span class="ident" id="3398871">Out</span><span class="op" id="3398874">,</span>&nbsp;<span class="ident" id="3398876">pos</span><span class="op" id="3398879">,</span>&nbsp;<span class="builtinfunc" id="3398881">cap</span><span class="op" id="3398884">,</span>&nbsp;<span class="ident" id="3398886">cond</span><span class="op" id="3398890">,</span>&nbsp;<span class="ident" id="3398892">t</span><span class="op" id="3398893">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3398897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3398900">case</span>&nbsp;<span class="ident" id="3398905">syntax</span><span class="op" id="3398911">.</span><span class="ident" id="3398912">InstMatch</span><span class="op" id="3398921">,</span>&nbsp;<span class="ident" id="3398923">syntax</span><span class="op" id="3398929">.</span><span class="ident" id="3398930">InstRune</span><span class="op" id="3398938">,</span>&nbsp;<span class="ident" id="3398940">syntax</span><span class="op" id="3398946">.</span><span class="ident" id="3398947">InstRune1</span><span class="op" id="3398956">,</span>&nbsp;<span class="ident" id="3398958">syntax</span><span class="op" id="3398964">.</span><span class="ident" id="3398965">InstRuneAny</span><span class="op" id="3398976">,</span>&nbsp;<span class="ident" id="3398978">syntax</span><span class="op" id="3398984">.</span><span class="ident" id="3398985">InstRuneAnyNotNL</span><span class="op" id="3399001">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399005">if</span>&nbsp;<span class="ident" id="3399008">t</span>&nbsp;<span class="op" id="3399010">==</span>&nbsp;<span class="builtintype" id="3399013">nil</span>&nbsp;<span class="op" id="3399017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399022">t</span>&nbsp;<span class="op" id="3399024">=</span>&nbsp;<span class="ident" id="3399026">m</span><span class="op" id="3399027">.</span><span class="ident" id="3399028">alloc</span><span class="op" id="3399033">(</span><span class="ident" id="3399034">i</span><span class="op" id="3399035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399039">}</span>&nbsp;<span class="keyword" id="3399041">else</span>&nbsp;<span class="op" id="3399046">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399051">t</span><span class="op" id="3399052">.</span><span class="ident" id="3399053">inst</span>&nbsp;<span class="op" id="3399058">=</span>&nbsp;<span class="ident" id="3399060">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399068">if</span>&nbsp;<span class="builtinfunc" id="3399071">len</span><span class="op" id="3399074">(</span><span class="builtinfunc" id="3399075">cap</span><span class="op" id="3399078">)</span>&nbsp;<span class="op" id="3399080">&gt;</span>&nbsp;<span class="num" id="3399082">0</span>&nbsp;<span class="op" id="3399084">&amp;&amp;</span>&nbsp;<span class="op" id="3399087">&amp;</span><span class="ident" id="3399088">t</span><span class="op" id="3399089">.</span><span class="builtinfunc" id="3399090">cap</span><span class="op" id="3399093">[</span><span class="num" id="3399094">0</span><span class="op" id="3399095">]</span>&nbsp;<span class="op" id="3399097">!=</span>&nbsp;<span class="op" id="3399100">&amp;</span><span class="builtinfunc" id="3399101">cap</span><span class="op" id="3399104">[</span><span class="num" id="3399105">0</span><span class="op" id="3399106">]</span>&nbsp;<span class="op" id="3399108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3399113">copy</span><span class="op" id="3399117">(</span><span class="ident" id="3399118">t</span><span class="op" id="3399119">.</span><span class="builtinfunc" id="3399120">cap</span><span class="op" id="3399123">,</span>&nbsp;<span class="builtinfunc" id="3399125">cap</span><span class="op" id="3399128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399132">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399136">d</span><span class="op" id="3399137">.</span><span class="ident" id="3399138">t</span>&nbsp;<span class="op" id="3399140">=</span>&nbsp;<span class="ident" id="3399142">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399146">t</span>&nbsp;<span class="op" id="3399148">=</span>&nbsp;<span class="builtintype" id="3399150">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399158">return</span>&nbsp;<span class="ident" id="3399165">t</span><br>
<span class="lineno"></span><span class="op" id="3399167">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="3399170">//&nbsp;onepass&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="3399230">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="3399271">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="3399324">func</span>&nbsp;<span class="op" id="3399329">(</span><span class="ident" id="3399330">m</span>&nbsp;<span class="op" id="3399332">*</span><span class="ident" id="3399333">machine</span><span class="op" id="3399340">)</span>&nbsp;<span class="ident" id="3399342">onepass</span><span class="op" id="3399349">(</span><span class="ident" id="3399350">i</span>&nbsp;<span class="ident" id="3399352">input</span><span class="op" id="3399357">,</span>&nbsp;<span class="ident" id="3399359">pos</span>&nbsp;<span class="builtintype" id="3399363">int</span><span class="op" id="3399366">)</span>&nbsp;<span class="builtintype" id="3399368">bool</span>&nbsp;<span class="op" id="3399373">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399376">startCond</span>&nbsp;<span class="op" id="3399386">:=</span>&nbsp;<span class="ident" id="3399389">m</span><span class="op" id="3399390">.</span><span class="ident" id="3399391">re</span><span class="op" id="3399393">.</span><span class="ident" id="3399394">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399400">if</span>&nbsp;<span class="ident" id="3399403">startCond</span>&nbsp;<span class="op" id="3399413">==</span>&nbsp;<span class="op" id="3399416">^</span><span class="ident" id="3399417">syntax</span><span class="op" id="3399423">.</span><span class="ident" id="3399424">EmptyOp</span><span class="op" id="3399431">(</span><span class="num" id="3399432">0</span><span class="op" id="3399433">)</span>&nbsp;<span class="op" id="3399435">{</span>&nbsp;<span class="comment" id="3399437">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399453">return</span>&nbsp;<span class="builtintype" id="3399460">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399470">m</span><span class="op" id="3399471">.</span><span class="ident" id="3399472">matched</span>&nbsp;<span class="op" id="3399480">=</span>&nbsp;<span class="builtintype" id="3399482">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399489">for</span>&nbsp;<span class="ident" id="3399493">i</span>&nbsp;<span class="op" id="3399495">:=</span>&nbsp;<span class="keyword" id="3399498">range</span>&nbsp;<span class="ident" id="3399504">m</span><span class="op" id="3399505">.</span><span class="ident" id="3399506">matchcap</span>&nbsp;<span class="op" id="3399515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399519">m</span><span class="op" id="3399520">.</span><span class="ident" id="3399521">matchcap</span><span class="op" id="3399529">[</span><span class="ident" id="3399530">i</span><span class="op" id="3399531">]</span>&nbsp;<span class="op" id="3399533">=</span>&nbsp;<span class="op" id="3399535">-</span><span class="num" id="3399536">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399542">r</span><span class="op" id="3399543">,</span>&nbsp;<span class="ident" id="3399545">r1</span>&nbsp;<span class="op" id="3399548">:=</span>&nbsp;<span class="ident" id="3399551">endOfText</span><span class="op" id="3399560">,</span>&nbsp;<span class="ident" id="3399562">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399573">width</span><span class="op" id="3399578">,</span>&nbsp;<span class="ident" id="3399580">width1</span>&nbsp;<span class="op" id="3399587">:=</span>&nbsp;<span class="num" id="3399590">0</span><span class="op" id="3399591">,</span>&nbsp;<span class="num" id="3399593">0</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399596">r</span><span class="op" id="3399597">,</span>&nbsp;<span class="ident" id="3399599">width</span>&nbsp;<span class="op" id="3399605">=</span>&nbsp;<span class="ident" id="3399607">i</span><span class="op" id="3399608">.</span><span class="ident" id="3399609">step</span><span class="op" id="3399613">(</span><span class="ident" id="3399614">pos</span><span class="op" id="3399617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399620">if</span>&nbsp;<span class="ident" id="3399623">r</span>&nbsp;<span class="op" id="3399625">!=</span>&nbsp;<span class="ident" id="3399628">endOfText</span>&nbsp;<span class="op" id="3399638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399642">r1</span><span class="op" id="3399644">,</span>&nbsp;<span class="ident" id="3399646">width1</span>&nbsp;<span class="op" id="3399653">=</span>&nbsp;<span class="ident" id="3399655">i</span><span class="op" id="3399656">.</span><span class="ident" id="3399657">step</span><span class="op" id="3399661">(</span><span class="ident" id="3399662">pos</span>&nbsp;<span class="op" id="3399666">+</span>&nbsp;<span class="ident" id="3399668">width</span><span class="op" id="3399673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399679">var</span>&nbsp;<span class="ident" id="3399683">flag</span>&nbsp;<span class="ident" id="3399688">syntax</span><span class="op" id="3399694">.</span><span class="ident" id="3399695">EmptyOp</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399704">if</span>&nbsp;<span class="ident" id="3399707">pos</span>&nbsp;<span class="op" id="3399711">==</span>&nbsp;<span class="num" id="3399714">0</span>&nbsp;<span class="op" id="3399716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399720">flag</span>&nbsp;<span class="op" id="3399725">=</span>&nbsp;<span class="ident" id="3399727">syntax</span><span class="op" id="3399733">.</span><span class="ident" id="3399734">EmptyOpContext</span><span class="op" id="3399748">(</span><span class="op" id="3399749">-</span><span class="num" id="3399750">1</span><span class="op" id="3399751">,</span>&nbsp;<span class="ident" id="3399753">r</span><span class="op" id="3399754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399757">}</span>&nbsp;<span class="keyword" id="3399759">else</span>&nbsp;<span class="op" id="3399764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399768">flag</span>&nbsp;<span class="op" id="3399773">=</span>&nbsp;<span class="ident" id="3399775">i</span><span class="op" id="3399776">.</span><span class="ident" id="3399777">context</span><span class="op" id="3399784">(</span><span class="ident" id="3399785">pos</span><span class="op" id="3399788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3399791">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399794">pc</span>&nbsp;<span class="op" id="3399797">:=</span>&nbsp;<span class="ident" id="3399800">m</span><span class="op" id="3399801">.</span><span class="ident" id="3399802">op</span><span class="op" id="3399804">.</span><span class="ident" id="3399805">Start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399812">inst</span>&nbsp;<span class="op" id="3399817">:=</span>&nbsp;<span class="ident" id="3399820">m</span><span class="op" id="3399821">.</span><span class="ident" id="3399822">op</span><span class="op" id="3399824">.</span><span class="ident" id="3399825">Inst</span><span class="op" id="3399829">[</span><span class="ident" id="3399830">pc</span><span class="op" id="3399832">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3399835">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;simple&nbsp;literal&nbsp;prefix,&nbsp;skip&nbsp;over&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3399890">if</span>&nbsp;<span class="ident" id="3399893">pos</span>&nbsp;<span class="op" id="3399897">==</span>&nbsp;<span class="num" id="3399900">0</span>&nbsp;<span class="op" id="3399902">&amp;&amp;</span>&nbsp;<span class="ident" id="3399905">syntax</span><span class="op" id="3399911">.</span><span class="ident" id="3399912">EmptyOp</span><span class="op" id="3399919">(</span><span class="ident" id="3399920">inst</span><span class="op" id="3399924">.</span><span class="ident" id="3399925">Arg</span><span class="op" id="3399928">)</span><span class="op" id="3399929">&amp;^</span><span class="ident" id="3399931">flag</span>&nbsp;<span class="op" id="3399936">==</span>&nbsp;<span class="num" id="3399939">0</span>&nbsp;<span class="op" id="3399941">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3399946">len</span><span class="op" id="3399949">(</span><span class="ident" id="3399950">m</span><span class="op" id="3399951">.</span><span class="ident" id="3399952">re</span><span class="op" id="3399954">.</span><span class="ident" id="3399955">prefix</span><span class="op" id="3399961">)</span>&nbsp;<span class="op" id="3399963">&gt;</span>&nbsp;<span class="num" id="3399965">0</span>&nbsp;<span class="op" id="3399967">&amp;&amp;</span>&nbsp;<span class="ident" id="3399970">i</span><span class="op" id="3399971">.</span><span class="ident" id="3399972">canCheckPrefix</span><span class="op" id="3399986">(</span><span class="op" id="3399987">)</span>&nbsp;<span class="op" id="3399989">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3399993">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400049">if</span>&nbsp;<span class="ident" id="3400052">i</span><span class="op" id="3400053">.</span><span class="ident" id="3400054">hasPrefix</span><span class="op" id="3400063">(</span><span class="ident" id="3400064">m</span><span class="op" id="3400065">.</span><span class="ident" id="3400066">re</span><span class="op" id="3400068">)</span>&nbsp;<span class="op" id="3400070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400075">pos</span>&nbsp;<span class="op" id="3400079">+=</span>&nbsp;<span class="builtinfunc" id="3400082">len</span><span class="op" id="3400085">(</span><span class="ident" id="3400086">m</span><span class="op" id="3400087">.</span><span class="ident" id="3400088">re</span><span class="op" id="3400090">.</span><span class="ident" id="3400091">prefix</span><span class="op" id="3400097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400102">r</span><span class="op" id="3400103">,</span>&nbsp;<span class="ident" id="3400105">width</span>&nbsp;<span class="op" id="3400111">=</span>&nbsp;<span class="ident" id="3400113">i</span><span class="op" id="3400114">.</span><span class="ident" id="3400115">step</span><span class="op" id="3400119">(</span><span class="ident" id="3400120">pos</span><span class="op" id="3400123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400128">r1</span><span class="op" id="3400130">,</span>&nbsp;<span class="ident" id="3400132">width1</span>&nbsp;<span class="op" id="3400139">=</span>&nbsp;<span class="ident" id="3400141">i</span><span class="op" id="3400142">.</span><span class="ident" id="3400143">step</span><span class="op" id="3400147">(</span><span class="ident" id="3400148">pos</span>&nbsp;<span class="op" id="3400152">+</span>&nbsp;<span class="ident" id="3400154">width</span><span class="op" id="3400159">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400164">flag</span>&nbsp;<span class="op" id="3400169">=</span>&nbsp;<span class="ident" id="3400171">i</span><span class="op" id="3400172">.</span><span class="ident" id="3400173">context</span><span class="op" id="3400180">(</span><span class="ident" id="3400181">pos</span><span class="op" id="3400184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400189">pc</span>&nbsp;<span class="op" id="3400192">=</span>&nbsp;<span class="builtintype" id="3400194">int</span><span class="op" id="3400197">(</span><span class="ident" id="3400198">m</span><span class="op" id="3400199">.</span><span class="ident" id="3400200">re</span><span class="op" id="3400202">.</span><span class="ident" id="3400203">prefixEnd</span><span class="op" id="3400212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3400216">}</span>&nbsp;<span class="keyword" id="3400218">else</span>&nbsp;<span class="op" id="3400223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400228">return</span>&nbsp;<span class="ident" id="3400235">m</span><span class="op" id="3400236">.</span><span class="ident" id="3400237">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3400247">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3400250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400253">for</span>&nbsp;<span class="op" id="3400257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400261">inst</span>&nbsp;<span class="op" id="3400266">=</span>&nbsp;<span class="ident" id="3400268">m</span><span class="op" id="3400269">.</span><span class="ident" id="3400270">op</span><span class="op" id="3400272">.</span><span class="ident" id="3400273">Inst</span><span class="op" id="3400277">[</span><span class="ident" id="3400278">pc</span><span class="op" id="3400280">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400284">pc</span>&nbsp;<span class="op" id="3400287">=</span>&nbsp;<span class="builtintype" id="3400289">int</span><span class="op" id="3400292">(</span><span class="ident" id="3400293">inst</span><span class="op" id="3400297">.</span><span class="ident" id="3400298">Out</span><span class="op" id="3400301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400305">switch</span>&nbsp;<span class="ident" id="3400312">inst</span><span class="op" id="3400316">.</span><span class="ident" id="3400317">Op</span>&nbsp;<span class="op" id="3400320">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400324">default</span><span class="op" id="3400331">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3400336">panic</span><span class="op" id="3400341">(</span><span class="string" id="3400342">&#34;bad&nbsp;inst&#34;</span><span class="op" id="3400352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400356">case</span>&nbsp;<span class="ident" id="3400361">syntax</span><span class="op" id="3400367">.</span><span class="ident" id="3400368">InstMatch</span><span class="op" id="3400377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400382">m</span><span class="op" id="3400383">.</span><span class="ident" id="3400384">matched</span>&nbsp;<span class="op" id="3400392">=</span>&nbsp;<span class="builtintype" id="3400394">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400402">if</span>&nbsp;<span class="builtinfunc" id="3400405">len</span><span class="op" id="3400408">(</span><span class="ident" id="3400409">m</span><span class="op" id="3400410">.</span><span class="ident" id="3400411">matchcap</span><span class="op" id="3400419">)</span>&nbsp;<span class="op" id="3400421">&gt;</span>&nbsp;<span class="num" id="3400423">0</span>&nbsp;<span class="op" id="3400425">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400431">m</span><span class="op" id="3400432">.</span><span class="ident" id="3400433">matchcap</span><span class="op" id="3400441">[</span><span class="num" id="3400442">0</span><span class="op" id="3400443">]</span>&nbsp;<span class="op" id="3400445">=</span>&nbsp;<span class="num" id="3400447">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400453">m</span><span class="op" id="3400454">.</span><span class="ident" id="3400455">matchcap</span><span class="op" id="3400463">[</span><span class="num" id="3400464">1</span><span class="op" id="3400465">]</span>&nbsp;<span class="op" id="3400467">=</span>&nbsp;<span class="ident" id="3400469">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3400476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400481">return</span>&nbsp;<span class="ident" id="3400488">m</span><span class="op" id="3400489">.</span><span class="ident" id="3400490">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400500">case</span>&nbsp;<span class="ident" id="3400505">syntax</span><span class="op" id="3400511">.</span><span class="ident" id="3400512">InstRune</span><span class="op" id="3400520">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400525">if</span>&nbsp;<span class="op" id="3400528">!</span><span class="ident" id="3400529">inst</span><span class="op" id="3400533">.</span><span class="ident" id="3400534">MatchRune</span><span class="op" id="3400543">(</span><span class="ident" id="3400544">r</span><span class="op" id="3400545">)</span>&nbsp;<span class="op" id="3400547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400553">return</span>&nbsp;<span class="ident" id="3400560">m</span><span class="op" id="3400561">.</span><span class="ident" id="3400562">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3400573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400577">case</span>&nbsp;<span class="ident" id="3400582">syntax</span><span class="op" id="3400588">.</span><span class="ident" id="3400589">InstRune1</span><span class="op" id="3400598">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400603">if</span>&nbsp;<span class="ident" id="3400606">r</span>&nbsp;<span class="op" id="3400608">!=</span>&nbsp;<span class="ident" id="3400611">inst</span><span class="op" id="3400615">.</span><span class="ident" id="3400616">Rune</span><span class="op" id="3400620">[</span><span class="num" id="3400621">0</span><span class="op" id="3400622">]</span>&nbsp;<span class="op" id="3400624">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400630">return</span>&nbsp;<span class="ident" id="3400637">m</span><span class="op" id="3400638">.</span><span class="ident" id="3400639">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3400650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400654">case</span>&nbsp;<span class="ident" id="3400659">syntax</span><span class="op" id="3400665">.</span><span class="ident" id="3400666">InstRuneAny</span><span class="op" id="3400677">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3400682">//&nbsp;Nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400695">case</span>&nbsp;<span class="ident" id="3400700">syntax</span><span class="op" id="3400706">.</span><span class="ident" id="3400707">InstRuneAnyNotNL</span><span class="op" id="3400723">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400728">if</span>&nbsp;<span class="ident" id="3400731">r</span>&nbsp;<span class="op" id="3400733">==</span>&nbsp;<span class="string" id="3400736">&#39;\n&#39;</span>&nbsp;<span class="op" id="3400741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400747">return</span>&nbsp;<span class="ident" id="3400754">m</span><span class="op" id="3400755">.</span><span class="ident" id="3400756">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3400767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3400771">//&nbsp;peek&nbsp;at&nbsp;the&nbsp;input&nbsp;rune&nbsp;to&nbsp;see&nbsp;which&nbsp;branch&nbsp;of&nbsp;the&nbsp;Alt&nbsp;to&nbsp;take</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400838">case</span>&nbsp;<span class="ident" id="3400843">syntax</span><span class="op" id="3400849">.</span><span class="ident" id="3400850">InstAlt</span><span class="op" id="3400857">,</span>&nbsp;<span class="ident" id="3400859">syntax</span><span class="op" id="3400865">.</span><span class="ident" id="3400866">InstAltMatch</span><span class="op" id="3400878">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3400883">pc</span>&nbsp;<span class="op" id="3400886">=</span>&nbsp;<span class="builtintype" id="3400888">int</span><span class="op" id="3400891">(</span><span class="ident" id="3400892">onePassNext</span><span class="op" id="3400903">(</span><span class="op" id="3400904">&amp;</span><span class="ident" id="3400905">inst</span><span class="op" id="3400909">,</span>&nbsp;<span class="ident" id="3400911">r</span><span class="op" id="3400912">)</span><span class="op" id="3400913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400918">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400929">case</span>&nbsp;<span class="ident" id="3400934">syntax</span><span class="op" id="3400940">.</span><span class="ident" id="3400941">InstFail</span><span class="op" id="3400949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400954">return</span>&nbsp;<span class="ident" id="3400961">m</span><span class="op" id="3400962">.</span><span class="ident" id="3400963">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400973">case</span>&nbsp;<span class="ident" id="3400978">syntax</span><span class="op" id="3400984">.</span><span class="ident" id="3400985">InstNop</span><span class="op" id="3400992">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3400997">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401008">case</span>&nbsp;<span class="ident" id="3401013">syntax</span><span class="op" id="3401019">.</span><span class="ident" id="3401020">InstEmptyWidth</span><span class="op" id="3401034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401039">if</span>&nbsp;<span class="ident" id="3401042">syntax</span><span class="op" id="3401048">.</span><span class="ident" id="3401049">EmptyOp</span><span class="op" id="3401056">(</span><span class="ident" id="3401057">inst</span><span class="op" id="3401061">.</span><span class="ident" id="3401062">Arg</span><span class="op" id="3401065">)</span><span class="op" id="3401066">&amp;^</span><span class="ident" id="3401068">flag</span>&nbsp;<span class="op" id="3401073">!=</span>&nbsp;<span class="num" id="3401076">0</span>&nbsp;<span class="op" id="3401078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401084">return</span>&nbsp;<span class="ident" id="3401091">m</span><span class="op" id="3401092">.</span><span class="ident" id="3401093">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3401104">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401109">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401120">case</span>&nbsp;<span class="ident" id="3401125">syntax</span><span class="op" id="3401131">.</span><span class="ident" id="3401132">InstCapture</span><span class="op" id="3401143">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401148">if</span>&nbsp;<span class="builtintype" id="3401151">int</span><span class="op" id="3401154">(</span><span class="ident" id="3401155">inst</span><span class="op" id="3401159">.</span><span class="ident" id="3401160">Arg</span><span class="op" id="3401163">)</span>&nbsp;<span class="op" id="3401165">&lt;</span>&nbsp;<span class="builtinfunc" id="3401167">len</span><span class="op" id="3401170">(</span><span class="ident" id="3401171">m</span><span class="op" id="3401172">.</span><span class="ident" id="3401173">matchcap</span><span class="op" id="3401181">)</span>&nbsp;<span class="op" id="3401183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401189">m</span><span class="op" id="3401190">.</span><span class="ident" id="3401191">matchcap</span><span class="op" id="3401199">[</span><span class="ident" id="3401200">inst</span><span class="op" id="3401204">.</span><span class="ident" id="3401205">Arg</span><span class="op" id="3401208">]</span>&nbsp;<span class="op" id="3401210">=</span>&nbsp;<span class="ident" id="3401212">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3401219">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401224">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3401235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401239">if</span>&nbsp;<span class="ident" id="3401242">width</span>&nbsp;<span class="op" id="3401248">==</span>&nbsp;<span class="num" id="3401251">0</span>&nbsp;<span class="op" id="3401253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401258">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3401266">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401270">flag</span>&nbsp;<span class="op" id="3401275">=</span>&nbsp;<span class="ident" id="3401277">syntax</span><span class="op" id="3401283">.</span><span class="ident" id="3401284">EmptyOpContext</span><span class="op" id="3401298">(</span><span class="ident" id="3401299">r</span><span class="op" id="3401300">,</span>&nbsp;<span class="ident" id="3401302">r1</span><span class="op" id="3401304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401308">pos</span>&nbsp;<span class="op" id="3401312">+=</span>&nbsp;<span class="ident" id="3401315">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401323">r</span><span class="op" id="3401324">,</span>&nbsp;<span class="ident" id="3401326">width</span>&nbsp;<span class="op" id="3401332">=</span>&nbsp;<span class="ident" id="3401334">r1</span><span class="op" id="3401336">,</span>&nbsp;<span class="ident" id="3401338">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401347">if</span>&nbsp;<span class="ident" id="3401350">r</span>&nbsp;<span class="op" id="3401352">!=</span>&nbsp;<span class="ident" id="3401355">endOfText</span>&nbsp;<span class="op" id="3401365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401370">r1</span><span class="op" id="3401372">,</span>&nbsp;<span class="ident" id="3401374">width1</span>&nbsp;<span class="op" id="3401381">=</span>&nbsp;<span class="ident" id="3401383">i</span><span class="op" id="3401384">.</span><span class="ident" id="3401385">step</span><span class="op" id="3401389">(</span><span class="ident" id="3401390">pos</span>&nbsp;<span class="op" id="3401394">+</span>&nbsp;<span class="ident" id="3401396">width</span><span class="op" id="3401401">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3401405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3401408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401411">return</span>&nbsp;<span class="ident" id="3401418">m</span><span class="op" id="3401419">.</span><span class="ident" id="3401420">matched</span><br>
<span class="lineno"></span><span class="op" id="3401428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="3401431">//&nbsp;empty&nbsp;is&nbsp;a&nbsp;non-nil&nbsp;0-element&nbsp;slice,</span><br>
<span class="lineno"></span><span class="comment" id="3401470">//&nbsp;so&nbsp;doExecute&nbsp;can&nbsp;avoid&nbsp;an&nbsp;allocation</span><br>
<span class="lineno"></span><span class="comment" id="3401510">//&nbsp;when&nbsp;0&nbsp;captures&nbsp;are&nbsp;requested&nbsp;from&nbsp;a&nbsp;successful&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3401568">var</span>&nbsp;<span class="ident" id="3401572">empty</span>&nbsp;<span class="op" id="3401578">=</span>&nbsp;<span class="builtinfunc" id="3401580">make</span><span class="op" id="3401584">(</span><span class="op" id="3401585">[</span><span class="op" id="3401586">]</span><span class="builtintype" id="3401587">int</span><span class="op" id="3401590">,</span>&nbsp;<span class="num" id="3401592">0</span><span class="op" id="3401593">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="3401596">//&nbsp;doExecute&nbsp;finds&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;the&nbsp;input&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3401659">//&nbsp;the&nbsp;position&nbsp;of&nbsp;its&nbsp;subexpressions.</span><br>
<span class="lineno"></span><span class="keyword" id="3401698">func</span>&nbsp;<span class="op" id="3401703">(</span><span class="ident" id="3401704">re</span>&nbsp;<span class="op" id="3401707">*</span><span class="ident" id="3401708">Regexp</span><span class="op" id="3401714">)</span>&nbsp;<span class="ident" id="3401716">doExecute</span><span class="op" id="3401725">(</span><span class="ident" id="3401726">r</span>&nbsp;<span class="ident" id="3401728">io</span><span class="op" id="3401730">.</span><span class="ident" id="3401731">RuneReader</span><span class="op" id="3401741">,</span>&nbsp;<span class="ident" id="3401743">b</span>&nbsp;<span class="op" id="3401745">[</span><span class="op" id="3401746">]</span><span class="builtintype" id="3401747">byte</span><span class="op" id="3401751">,</span>&nbsp;<span class="ident" id="3401753">s</span>&nbsp;<span class="builtintype" id="3401755">string</span><span class="op" id="3401761">,</span>&nbsp;<span class="ident" id="3401763">pos</span>&nbsp;<span class="builtintype" id="3401767">int</span><span class="op" id="3401770">,</span>&nbsp;<span class="ident" id="3401772">ncap</span>&nbsp;<span class="builtintype" id="3401777">int</span><span class="op" id="3401780">)</span>&nbsp;<span class="op" id="3401782">[</span><span class="op" id="3401783">]</span><span class="builtintype" id="3401784">int</span>&nbsp;<span class="op" id="3401788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401791">m</span>&nbsp;<span class="op" id="3401793">:=</span>&nbsp;<span class="ident" id="3401796">re</span><span class="op" id="3401798">.</span><span class="ident" id="3401799">get</span><span class="op" id="3401802">(</span><span class="op" id="3401803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401806">var</span>&nbsp;<span class="ident" id="3401810">i</span>&nbsp;<span class="ident" id="3401812">input</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401819">if</span>&nbsp;<span class="ident" id="3401822">r</span>&nbsp;<span class="op" id="3401824">!=</span>&nbsp;<span class="builtintype" id="3401827">nil</span>&nbsp;<span class="op" id="3401831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401835">i</span>&nbsp;<span class="op" id="3401837">=</span>&nbsp;<span class="ident" id="3401839">m</span><span class="op" id="3401840">.</span><span class="ident" id="3401841">newInputReader</span><span class="op" id="3401855">(</span><span class="ident" id="3401856">r</span><span class="op" id="3401857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3401860">}</span>&nbsp;<span class="keyword" id="3401862">else</span>&nbsp;<span class="keyword" id="3401867">if</span>&nbsp;<span class="ident" id="3401870">b</span>&nbsp;<span class="op" id="3401872">!=</span>&nbsp;<span class="builtintype" id="3401875">nil</span>&nbsp;<span class="op" id="3401879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401883">i</span>&nbsp;<span class="op" id="3401885">=</span>&nbsp;<span class="ident" id="3401887">m</span><span class="op" id="3401888">.</span><span class="ident" id="3401889">newInputBytes</span><span class="op" id="3401902">(</span><span class="ident" id="3401903">b</span><span class="op" id="3401904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3401907">}</span>&nbsp;<span class="keyword" id="3401909">else</span>&nbsp;<span class="op" id="3401914">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401918">i</span>&nbsp;<span class="op" id="3401920">=</span>&nbsp;<span class="ident" id="3401922">m</span><span class="op" id="3401923">.</span><span class="ident" id="3401924">newInputString</span><span class="op" id="3401938">(</span><span class="ident" id="3401939">s</span><span class="op" id="3401940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3401943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401946">if</span>&nbsp;<span class="ident" id="3401949">m</span><span class="op" id="3401950">.</span><span class="ident" id="3401951">op</span>&nbsp;<span class="op" id="3401954">!=</span>&nbsp;<span class="ident" id="3401957">notOnePass</span>&nbsp;<span class="op" id="3401968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3401972">if</span>&nbsp;<span class="op" id="3401975">!</span><span class="ident" id="3401976">m</span><span class="op" id="3401977">.</span><span class="ident" id="3401978">onepass</span><span class="op" id="3401985">(</span><span class="ident" id="3401986">i</span><span class="op" id="3401987">,</span>&nbsp;<span class="ident" id="3401989">pos</span><span class="op" id="3401992">)</span>&nbsp;<span class="op" id="3401994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3401999">re</span><span class="op" id="3402001">.</span><span class="ident" id="3402002">put</span><span class="op" id="3402005">(</span><span class="ident" id="3402006">m</span><span class="op" id="3402007">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3402012">return</span>&nbsp;<span class="builtintype" id="3402019">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3402025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3402028">}</span>&nbsp;<span class="keyword" id="3402030">else</span>&nbsp;<span class="op" id="3402035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3402039">m</span><span class="op" id="3402040">.</span><span class="ident" id="3402041">init</span><span class="op" id="3402045">(</span><span class="ident" id="3402046">ncap</span><span class="op" id="3402050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3402054">if</span>&nbsp;<span class="op" id="3402057">!</span><span class="ident" id="3402058">m</span><span class="op" id="3402059">.</span><span class="ident" id="3402060">match</span><span class="op" id="3402065">(</span><span class="ident" id="3402066">i</span><span class="op" id="3402067">,</span>&nbsp;<span class="ident" id="3402069">pos</span><span class="op" id="3402072">)</span>&nbsp;<span class="op" id="3402074">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3402079">re</span><span class="op" id="3402081">.</span><span class="ident" id="3402082">put</span><span class="op" id="3402085">(</span><span class="ident" id="3402086">m</span><span class="op" id="3402087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3402092">return</span>&nbsp;<span class="builtintype" id="3402099">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3402105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3402108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3402111">if</span>&nbsp;<span class="ident" id="3402114">ncap</span>&nbsp;<span class="op" id="3402119">==</span>&nbsp;<span class="num" id="3402122">0</span>&nbsp;<span class="op" id="3402124">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3402128">re</span><span class="op" id="3402130">.</span><span class="ident" id="3402131">put</span><span class="op" id="3402134">(</span><span class="ident" id="3402135">m</span><span class="op" id="3402136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3402140">return</span>&nbsp;<span class="ident" id="3402147">empty</span>&nbsp;<span class="comment" id="3402153">//&nbsp;empty&nbsp;but&nbsp;not&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3402175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3402178">cap</span>&nbsp;<span class="op" id="3402182">:=</span>&nbsp;<span class="builtinfunc" id="3402185">make</span><span class="op" id="3402189">(</span><span class="op" id="3402190">[</span><span class="op" id="3402191">]</span><span class="builtintype" id="3402192">int</span><span class="op" id="3402195">,</span>&nbsp;<span class="builtinfunc" id="3402197">len</span><span class="op" id="3402200">(</span><span class="ident" id="3402201">m</span><span class="op" id="3402202">.</span><span class="ident" id="3402203">matchcap</span><span class="op" id="3402211">)</span><span class="op" id="3402212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3402215">copy</span><span class="op" id="3402219">(</span><span class="builtinfunc" id="3402220">cap</span><span class="op" id="3402223">,</span>&nbsp;<span class="ident" id="3402225">m</span><span class="op" id="3402226">.</span><span class="ident" id="3402227">matchcap</span><span class="op" id="3402235">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3402238">re</span><span class="op" id="3402240">.</span><span class="ident" id="3402241">put</span><span class="op" id="3402244">(</span><span class="ident" id="3402245">m</span><span class="op" id="3402246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3402249">return</span>&nbsp;<span class="builtinfunc" id="3402256">cap</span><br>
<span class="lineno"></span><span class="op" id="3402260">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
