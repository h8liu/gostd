<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html" class="current">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7515650">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7515705">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7515759">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7515810">package</span>&nbsp;<span class="ident" id="7515818">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7515823">import</span>&nbsp;<span class="op" id="7515830">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7515833">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7515846">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7515857">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7515868">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7515875">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7515878">func</span>&nbsp;<span class="ident" id="7515883">TestMutexLock</span><span class="op" id="7515896">(</span><span class="ident" id="7515897">t</span>&nbsp;<span class="op" id="7515899">*</span><span class="ident" id="7515900">testing</span><span class="op" id="7515907">.</span><span class="ident" id="7515908">T</span><span class="op" id="7515909">)</span>&nbsp;<span class="op" id="7515911">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7515914">var</span>&nbsp;<span class="ident" id="7515918">mu</span>&nbsp;<span class="ident" id="7515921">fdMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7515931">if</span>&nbsp;<span class="op" id="7515934">!</span><span class="ident" id="7515935">mu</span><span class="op" id="7515937">.</span><span class="ident" id="7515938">Incref</span><span class="op" id="7515944">(</span><span class="op" id="7515945">)</span>&nbsp;<span class="op" id="7515947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515951">t</span><span class="op" id="7515952">.</span><span class="ident" id="7515953">Fatal</span><span class="op" id="7515958">(</span><span class="string" id="7515959">&#34;broken&#34;</span><span class="op" id="7515967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7515970">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7515973">if</span>&nbsp;<span class="ident" id="7515976">mu</span><span class="op" id="7515978">.</span><span class="ident" id="7515979">Decref</span><span class="op" id="7515985">(</span><span class="op" id="7515986">)</span>&nbsp;<span class="op" id="7515988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7515992">t</span><span class="op" id="7515993">.</span><span class="ident" id="7515994">Fatal</span><span class="op" id="7515999">(</span><span class="string" id="7516000">&#34;broken&#34;</span><span class="op" id="7516008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516015">if</span>&nbsp;<span class="op" id="7516018">!</span><span class="ident" id="7516019">mu</span><span class="op" id="7516021">.</span><span class="ident" id="7516022">RWLock</span><span class="op" id="7516028">(</span><span class="builtintype" id="7516029">true</span><span class="op" id="7516033">)</span>&nbsp;<span class="op" id="7516035">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516039">t</span><span class="op" id="7516040">.</span><span class="ident" id="7516041">Fatal</span><span class="op" id="7516046">(</span><span class="string" id="7516047">&#34;broken&#34;</span><span class="op" id="7516055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516061">if</span>&nbsp;<span class="ident" id="7516064">mu</span><span class="op" id="7516066">.</span><span class="ident" id="7516067">RWUnlock</span><span class="op" id="7516075">(</span><span class="builtintype" id="7516076">true</span><span class="op" id="7516080">)</span>&nbsp;<span class="op" id="7516082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516086">t</span><span class="op" id="7516087">.</span><span class="ident" id="7516088">Fatal</span><span class="op" id="7516093">(</span><span class="string" id="7516094">&#34;broken&#34;</span><span class="op" id="7516102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516105">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516109">if</span>&nbsp;<span class="op" id="7516112">!</span><span class="ident" id="7516113">mu</span><span class="op" id="7516115">.</span><span class="ident" id="7516116">RWLock</span><span class="op" id="7516122">(</span><span class="builtintype" id="7516123">false</span><span class="op" id="7516128">)</span>&nbsp;<span class="op" id="7516130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516134">t</span><span class="op" id="7516135">.</span><span class="ident" id="7516136">Fatal</span><span class="op" id="7516141">(</span><span class="string" id="7516142">&#34;broken&#34;</span><span class="op" id="7516150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516156">if</span>&nbsp;<span class="ident" id="7516159">mu</span><span class="op" id="7516161">.</span><span class="ident" id="7516162">RWUnlock</span><span class="op" id="7516170">(</span><span class="builtintype" id="7516171">false</span><span class="op" id="7516176">)</span>&nbsp;<span class="op" id="7516178">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516182">t</span><span class="op" id="7516183">.</span><span class="ident" id="7516184">Fatal</span><span class="op" id="7516189">(</span><span class="string" id="7516190">&#34;broken&#34;</span><span class="op" id="7516198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516201">}</span><br>
<span class="lineno"></span><span class="op" id="7516203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7516206">func</span>&nbsp;<span class="ident" id="7516211">TestMutexClose</span><span class="op" id="7516225">(</span><span class="ident" id="7516226">t</span>&nbsp;<span class="op" id="7516228">*</span><span class="ident" id="7516229">testing</span><span class="op" id="7516236">.</span><span class="ident" id="7516237">T</span><span class="op" id="7516238">)</span>&nbsp;<span class="op" id="7516240">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516243">var</span>&nbsp;<span class="ident" id="7516247">mu</span>&nbsp;<span class="ident" id="7516250">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516259">if</span>&nbsp;<span class="op" id="7516262">!</span><span class="ident" id="7516263">mu</span><span class="op" id="7516265">.</span><span class="ident" id="7516266">IncrefAndClose</span><span class="op" id="7516280">(</span><span class="op" id="7516281">)</span>&nbsp;<span class="op" id="7516283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516287">t</span><span class="op" id="7516288">.</span><span class="ident" id="7516289">Fatal</span><span class="op" id="7516294">(</span><span class="string" id="7516295">&#34;broken&#34;</span><span class="op" id="7516303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516310">if</span>&nbsp;<span class="ident" id="7516313">mu</span><span class="op" id="7516315">.</span><span class="ident" id="7516316">Incref</span><span class="op" id="7516322">(</span><span class="op" id="7516323">)</span>&nbsp;<span class="op" id="7516325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516329">t</span><span class="op" id="7516330">.</span><span class="ident" id="7516331">Fatal</span><span class="op" id="7516336">(</span><span class="string" id="7516337">&#34;broken&#34;</span><span class="op" id="7516345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516351">if</span>&nbsp;<span class="ident" id="7516354">mu</span><span class="op" id="7516356">.</span><span class="ident" id="7516357">RWLock</span><span class="op" id="7516363">(</span><span class="builtintype" id="7516364">true</span><span class="op" id="7516368">)</span>&nbsp;<span class="op" id="7516370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516374">t</span><span class="op" id="7516375">.</span><span class="ident" id="7516376">Fatal</span><span class="op" id="7516381">(</span><span class="string" id="7516382">&#34;broken&#34;</span><span class="op" id="7516390">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516396">if</span>&nbsp;<span class="ident" id="7516399">mu</span><span class="op" id="7516401">.</span><span class="ident" id="7516402">RWLock</span><span class="op" id="7516408">(</span><span class="builtintype" id="7516409">false</span><span class="op" id="7516414">)</span>&nbsp;<span class="op" id="7516416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516420">t</span><span class="op" id="7516421">.</span><span class="ident" id="7516422">Fatal</span><span class="op" id="7516427">(</span><span class="string" id="7516428">&#34;broken&#34;</span><span class="op" id="7516436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516442">if</span>&nbsp;<span class="ident" id="7516445">mu</span><span class="op" id="7516447">.</span><span class="ident" id="7516448">IncrefAndClose</span><span class="op" id="7516462">(</span><span class="op" id="7516463">)</span>&nbsp;<span class="op" id="7516465">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516469">t</span><span class="op" id="7516470">.</span><span class="ident" id="7516471">Fatal</span><span class="op" id="7516476">(</span><span class="string" id="7516477">&#34;broken&#34;</span><span class="op" id="7516485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516488">}</span><br>
<span class="lineno"></span><span class="op" id="7516490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7516493">func</span>&nbsp;<span class="ident" id="7516498">TestMutexCloseUnblock</span><span class="op" id="7516519">(</span><span class="ident" id="7516520">t</span>&nbsp;<span class="op" id="7516522">*</span><span class="ident" id="7516523">testing</span><span class="op" id="7516530">.</span><span class="ident" id="7516531">T</span><span class="op" id="7516532">)</span>&nbsp;<span class="op" id="7516534">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516537">c</span>&nbsp;<span class="op" id="7516539">:=</span>&nbsp;<span class="builtinfunc" id="7516542">make</span><span class="op" id="7516546">(</span><span class="keyword" id="7516547">chan</span>&nbsp;<span class="builtintype" id="7516552">bool</span><span class="op" id="7516556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516559">var</span>&nbsp;<span class="ident" id="7516563">mu</span>&nbsp;<span class="ident" id="7516566">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516575">mu</span><span class="op" id="7516577">.</span><span class="ident" id="7516578">RWLock</span><span class="op" id="7516584">(</span><span class="builtintype" id="7516585">true</span><span class="op" id="7516589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516592">for</span>&nbsp;<span class="ident" id="7516596">i</span>&nbsp;<span class="op" id="7516598">:=</span>&nbsp;<span class="num" id="7516601">0</span><span class="op" id="7516602">;</span>&nbsp;<span class="ident" id="7516604">i</span>&nbsp;<span class="op" id="7516606">&lt;</span>&nbsp;<span class="num" id="7516608">4</span><span class="op" id="7516609">;</span>&nbsp;<span class="ident" id="7516611">i</span><span class="op" id="7516612">++</span>&nbsp;<span class="op" id="7516615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516619">go</span>&nbsp;<span class="keyword" id="7516622">func</span><span class="op" id="7516626">(</span><span class="op" id="7516627">)</span>&nbsp;<span class="op" id="7516629">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516634">if</span>&nbsp;<span class="ident" id="7516637">mu</span><span class="op" id="7516639">.</span><span class="ident" id="7516640">RWLock</span><span class="op" id="7516646">(</span><span class="builtintype" id="7516647">true</span><span class="op" id="7516651">)</span>&nbsp;<span class="op" id="7516653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516659">t</span><span class="op" id="7516660">.</span><span class="ident" id="7516661">Error</span><span class="op" id="7516666">(</span><span class="string" id="7516667">&#34;broken&#34;</span><span class="op" id="7516675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516681">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516696">c</span>&nbsp;<span class="op" id="7516698">&lt;-</span>&nbsp;<span class="builtintype" id="7516701">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516708">}</span><span class="op" id="7516709">(</span><span class="op" id="7516710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7516716">//&nbsp;Concurrent&nbsp;goroutines&nbsp;must&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;lock&nbsp;the&nbsp;mutex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516783">time</span><span class="op" id="7516787">.</span><span class="ident" id="7516788">Sleep</span><span class="op" id="7516793">(</span><span class="ident" id="7516794">time</span><span class="op" id="7516798">.</span><span class="ident" id="7516799">Millisecond</span><span class="op" id="7516810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516813">select</span>&nbsp;<span class="op" id="7516820">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516823">case</span>&nbsp;<span class="op" id="7516828">&lt;-</span><span class="ident" id="7516830">c</span><span class="op" id="7516831">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516835">t</span><span class="op" id="7516836">.</span><span class="ident" id="7516837">Fatal</span><span class="op" id="7516842">(</span><span class="string" id="7516843">&#34;broken&#34;</span><span class="op" id="7516851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516854">default</span><span class="op" id="7516861">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7516864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7516867">mu</span><span class="op" id="7516869">.</span><span class="ident" id="7516870">IncrefAndClose</span><span class="op" id="7516884">(</span><span class="op" id="7516885">)</span>&nbsp;<span class="comment" id="7516887">//&nbsp;Must&nbsp;unblock&nbsp;the&nbsp;readers.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516917">for</span>&nbsp;<span class="ident" id="7516921">i</span>&nbsp;<span class="op" id="7516923">:=</span>&nbsp;<span class="num" id="7516926">0</span><span class="op" id="7516927">;</span>&nbsp;<span class="ident" id="7516929">i</span>&nbsp;<span class="op" id="7516931">&lt;</span>&nbsp;<span class="num" id="7516933">4</span><span class="op" id="7516934">;</span>&nbsp;<span class="ident" id="7516936">i</span><span class="op" id="7516937">++</span>&nbsp;<span class="op" id="7516940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516944">select</span>&nbsp;<span class="op" id="7516951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516955">case</span>&nbsp;<span class="op" id="7516960">&lt;-</span><span class="ident" id="7516962">c</span><span class="op" id="7516963">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7516967">case</span>&nbsp;<span class="op" id="7516972">&lt;-</span><span class="ident" id="7516974">time</span><span class="op" id="7516978">.</span><span class="ident" id="7516979">After</span><span class="op" id="7516984">(</span><span class="num" id="7516985">10</span>&nbsp;<span class="op" id="7516988">*</span>&nbsp;<span class="ident" id="7516990">time</span><span class="op" id="7516994">.</span><span class="ident" id="7516995">Second</span><span class="op" id="7517001">)</span><span class="op" id="7517002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517007">t</span><span class="op" id="7517008">.</span><span class="ident" id="7517009">Fatal</span><span class="op" id="7517014">(</span><span class="string" id="7517015">&#34;broken&#34;</span><span class="op" id="7517023">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517033">if</span>&nbsp;<span class="ident" id="7517036">mu</span><span class="op" id="7517038">.</span><span class="ident" id="7517039">Decref</span><span class="op" id="7517045">(</span><span class="op" id="7517046">)</span>&nbsp;<span class="op" id="7517048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517052">t</span><span class="op" id="7517053">.</span><span class="ident" id="7517054">Fatal</span><span class="op" id="7517059">(</span><span class="string" id="7517060">&#34;broken&#34;</span><span class="op" id="7517068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517071">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517074">if</span>&nbsp;<span class="op" id="7517077">!</span><span class="ident" id="7517078">mu</span><span class="op" id="7517080">.</span><span class="ident" id="7517081">RWUnlock</span><span class="op" id="7517089">(</span><span class="builtintype" id="7517090">true</span><span class="op" id="7517094">)</span>&nbsp;<span class="op" id="7517096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517100">t</span><span class="op" id="7517101">.</span><span class="ident" id="7517102">Fatal</span><span class="op" id="7517107">(</span><span class="string" id="7517108">&#34;broken&#34;</span><span class="op" id="7517116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517119">}</span><br>
<span class="lineno"></span><span class="op" id="7517121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7517124">func</span>&nbsp;<span class="ident" id="7517129">TestMutexPanic</span><span class="op" id="7517143">(</span><span class="ident" id="7517144">t</span>&nbsp;<span class="op" id="7517146">*</span><span class="ident" id="7517147">testing</span><span class="op" id="7517154">.</span><span class="ident" id="7517155">T</span><span class="op" id="7517156">)</span>&nbsp;<span class="op" id="7517158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517161">ensurePanics</span>&nbsp;<span class="op" id="7517174">:=</span>&nbsp;<span class="keyword" id="7517177">func</span><span class="op" id="7517181">(</span><span class="ident" id="7517182">f</span>&nbsp;<span class="keyword" id="7517184">func</span><span class="op" id="7517188">(</span><span class="op" id="7517189">)</span><span class="op" id="7517190">)</span>&nbsp;<span class="op" id="7517192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517196">defer</span>&nbsp;<span class="keyword" id="7517202">func</span><span class="op" id="7517206">(</span><span class="op" id="7517207">)</span>&nbsp;<span class="op" id="7517209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517214">if</span>&nbsp;<span class="builtinfunc" id="7517217">recover</span><span class="op" id="7517224">(</span><span class="op" id="7517225">)</span>&nbsp;<span class="op" id="7517227">==</span>&nbsp;<span class="ident" id="7517230">nil</span>&nbsp;<span class="op" id="7517234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517240">t</span><span class="op" id="7517241">.</span><span class="ident" id="7517242">Fatal</span><span class="op" id="7517247">(</span><span class="string" id="7517248">&#34;does&nbsp;not&nbsp;panic&#34;</span><span class="op" id="7517264">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517273">}</span><span class="op" id="7517274">(</span><span class="op" id="7517275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517279">f</span><span class="op" id="7517280">(</span><span class="op" id="7517281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517288">var</span>&nbsp;<span class="ident" id="7517292">mu</span>&nbsp;<span class="ident" id="7517295">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517304">ensurePanics</span><span class="op" id="7517316">(</span><span class="keyword" id="7517317">func</span><span class="op" id="7517321">(</span><span class="op" id="7517322">)</span>&nbsp;<span class="op" id="7517324">{</span>&nbsp;<span class="ident" id="7517326">mu</span><span class="op" id="7517328">.</span><span class="ident" id="7517329">Decref</span><span class="op" id="7517335">(</span><span class="op" id="7517336">)</span>&nbsp;<span class="op" id="7517338">}</span><span class="op" id="7517339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517342">ensurePanics</span><span class="op" id="7517354">(</span><span class="keyword" id="7517355">func</span><span class="op" id="7517359">(</span><span class="op" id="7517360">)</span>&nbsp;<span class="op" id="7517362">{</span>&nbsp;<span class="ident" id="7517364">mu</span><span class="op" id="7517366">.</span><span class="ident" id="7517367">RWUnlock</span><span class="op" id="7517375">(</span><span class="builtintype" id="7517376">true</span><span class="op" id="7517380">)</span>&nbsp;<span class="op" id="7517382">}</span><span class="op" id="7517383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517386">ensurePanics</span><span class="op" id="7517398">(</span><span class="keyword" id="7517399">func</span><span class="op" id="7517403">(</span><span class="op" id="7517404">)</span>&nbsp;<span class="op" id="7517406">{</span>&nbsp;<span class="ident" id="7517408">mu</span><span class="op" id="7517410">.</span><span class="ident" id="7517411">RWUnlock</span><span class="op" id="7517419">(</span><span class="builtintype" id="7517420">false</span><span class="op" id="7517425">)</span>&nbsp;<span class="op" id="7517427">}</span><span class="op" id="7517428">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517432">ensurePanics</span><span class="op" id="7517444">(</span><span class="keyword" id="7517445">func</span><span class="op" id="7517449">(</span><span class="op" id="7517450">)</span>&nbsp;<span class="op" id="7517452">{</span>&nbsp;<span class="ident" id="7517454">mu</span><span class="op" id="7517456">.</span><span class="ident" id="7517457">Incref</span><span class="op" id="7517463">(</span><span class="op" id="7517464">)</span><span class="op" id="7517465">;</span>&nbsp;<span class="ident" id="7517467">mu</span><span class="op" id="7517469">.</span><span class="ident" id="7517470">Decref</span><span class="op" id="7517476">(</span><span class="op" id="7517477">)</span><span class="op" id="7517478">;</span>&nbsp;<span class="ident" id="7517480">mu</span><span class="op" id="7517482">.</span><span class="ident" id="7517483">Decref</span><span class="op" id="7517489">(</span><span class="op" id="7517490">)</span>&nbsp;<span class="op" id="7517492">}</span><span class="op" id="7517493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517496">ensurePanics</span><span class="op" id="7517508">(</span><span class="keyword" id="7517509">func</span><span class="op" id="7517513">(</span><span class="op" id="7517514">)</span>&nbsp;<span class="op" id="7517516">{</span>&nbsp;<span class="ident" id="7517518">mu</span><span class="op" id="7517520">.</span><span class="ident" id="7517521">RWLock</span><span class="op" id="7517527">(</span><span class="builtintype" id="7517528">true</span><span class="op" id="7517532">)</span><span class="op" id="7517533">;</span>&nbsp;<span class="ident" id="7517535">mu</span><span class="op" id="7517537">.</span><span class="ident" id="7517538">RWUnlock</span><span class="op" id="7517546">(</span><span class="builtintype" id="7517547">true</span><span class="op" id="7517551">)</span><span class="op" id="7517552">;</span>&nbsp;<span class="ident" id="7517554">mu</span><span class="op" id="7517556">.</span><span class="ident" id="7517557">RWUnlock</span><span class="op" id="7517565">(</span><span class="builtintype" id="7517566">true</span><span class="op" id="7517570">)</span>&nbsp;<span class="op" id="7517572">}</span><span class="op" id="7517573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517576">ensurePanics</span><span class="op" id="7517588">(</span><span class="keyword" id="7517589">func</span><span class="op" id="7517593">(</span><span class="op" id="7517594">)</span>&nbsp;<span class="op" id="7517596">{</span>&nbsp;<span class="ident" id="7517598">mu</span><span class="op" id="7517600">.</span><span class="ident" id="7517601">RWLock</span><span class="op" id="7517607">(</span><span class="builtintype" id="7517608">false</span><span class="op" id="7517613">)</span><span class="op" id="7517614">;</span>&nbsp;<span class="ident" id="7517616">mu</span><span class="op" id="7517618">.</span><span class="ident" id="7517619">RWUnlock</span><span class="op" id="7517627">(</span><span class="builtintype" id="7517628">false</span><span class="op" id="7517633">)</span><span class="op" id="7517634">;</span>&nbsp;<span class="ident" id="7517636">mu</span><span class="op" id="7517638">.</span><span class="ident" id="7517639">RWUnlock</span><span class="op" id="7517647">(</span><span class="builtintype" id="7517648">false</span><span class="op" id="7517653">)</span>&nbsp;<span class="op" id="7517655">}</span><span class="op" id="7517656">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7517660">//&nbsp;ensure&nbsp;that&nbsp;it&#39;s&nbsp;still&nbsp;not&nbsp;broken</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517698">mu</span><span class="op" id="7517700">.</span><span class="ident" id="7517701">Incref</span><span class="op" id="7517707">(</span><span class="op" id="7517708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517711">mu</span><span class="op" id="7517713">.</span><span class="ident" id="7517714">Decref</span><span class="op" id="7517720">(</span><span class="op" id="7517721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517724">mu</span><span class="op" id="7517726">.</span><span class="ident" id="7517727">RWLock</span><span class="op" id="7517733">(</span><span class="builtintype" id="7517734">true</span><span class="op" id="7517738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517741">mu</span><span class="op" id="7517743">.</span><span class="ident" id="7517744">RWUnlock</span><span class="op" id="7517752">(</span><span class="builtintype" id="7517753">true</span><span class="op" id="7517757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517760">mu</span><span class="op" id="7517762">.</span><span class="ident" id="7517763">RWLock</span><span class="op" id="7517769">(</span><span class="builtintype" id="7517770">false</span><span class="op" id="7517775">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517778">mu</span><span class="op" id="7517780">.</span><span class="ident" id="7517781">RWUnlock</span><span class="op" id="7517789">(</span><span class="builtintype" id="7517790">false</span><span class="op" id="7517795">)</span><br>
<span class="lineno"></span><span class="op" id="7517797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7517800">func</span>&nbsp;<span class="ident" id="7517805">TestMutexStress</span><span class="op" id="7517820">(</span><span class="ident" id="7517821">t</span>&nbsp;<span class="op" id="7517823">*</span><span class="ident" id="7517824">testing</span><span class="op" id="7517831">.</span><span class="ident" id="7517832">T</span><span class="op" id="7517833">)</span>&nbsp;<span class="op" id="7517835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517838">P</span>&nbsp;<span class="op" id="7517840">:=</span>&nbsp;<span class="num" id="7517843">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517846">N</span>&nbsp;<span class="op" id="7517848">:=</span>&nbsp;<span class="builtintype" id="7517851">int</span><span class="op" id="7517854">(</span><span class="num" id="7517855">1e6</span><span class="op" id="7517858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517861">if</span>&nbsp;<span class="ident" id="7517864">testing</span><span class="op" id="7517871">.</span><span class="ident" id="7517872">Short</span><span class="op" id="7517877">(</span><span class="op" id="7517878">)</span>&nbsp;<span class="op" id="7517880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517884">P</span>&nbsp;<span class="op" id="7517886">=</span>&nbsp;<span class="num" id="7517888">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517892">N</span>&nbsp;<span class="op" id="7517894">=</span>&nbsp;<span class="num" id="7517896">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7517901">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517904">defer</span>&nbsp;<span class="ident" id="7517910">runtime</span><span class="op" id="7517917">.</span><span class="ident" id="7517918">GOMAXPROCS</span><span class="op" id="7517928">(</span><span class="ident" id="7517929">runtime</span><span class="op" id="7517936">.</span><span class="ident" id="7517937">GOMAXPROCS</span><span class="op" id="7517947">(</span><span class="ident" id="7517948">P</span><span class="op" id="7517949">)</span><span class="op" id="7517950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7517953">done</span>&nbsp;<span class="op" id="7517958">:=</span>&nbsp;<span class="builtinfunc" id="7517961">make</span><span class="op" id="7517965">(</span><span class="keyword" id="7517966">chan</span>&nbsp;<span class="builtintype" id="7517971">bool</span><span class="op" id="7517975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517978">var</span>&nbsp;<span class="ident" id="7517982">mu</span>&nbsp;<span class="ident" id="7517985">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7517994">var</span>&nbsp;<span class="ident" id="7517998">readState</span>&nbsp;<span class="op" id="7518008">[</span><span class="num" id="7518009">2</span><span class="op" id="7518010">]</span><span class="ident" id="7518011">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518019">var</span>&nbsp;<span class="ident" id="7518023">writeState</span>&nbsp;<span class="op" id="7518034">[</span><span class="num" id="7518035">2</span><span class="op" id="7518036">]</span><span class="ident" id="7518037">uint64</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518045">for</span>&nbsp;<span class="ident" id="7518049">p</span>&nbsp;<span class="op" id="7518051">:=</span>&nbsp;<span class="num" id="7518054">0</span><span class="op" id="7518055">;</span>&nbsp;<span class="ident" id="7518057">p</span>&nbsp;<span class="op" id="7518059">&lt;</span>&nbsp;<span class="ident" id="7518061">P</span><span class="op" id="7518062">;</span>&nbsp;<span class="ident" id="7518064">p</span><span class="op" id="7518065">++</span>&nbsp;<span class="op" id="7518068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518072">go</span>&nbsp;<span class="keyword" id="7518075">func</span><span class="op" id="7518079">(</span><span class="op" id="7518080">)</span>&nbsp;<span class="op" id="7518082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518087">r</span>&nbsp;<span class="op" id="7518089">:=</span>&nbsp;<span class="ident" id="7518092">rand</span><span class="op" id="7518096">.</span><span class="ident" id="7518097">New</span><span class="op" id="7518100">(</span><span class="ident" id="7518101">rand</span><span class="op" id="7518105">.</span><span class="ident" id="7518106">NewSource</span><span class="op" id="7518115">(</span><span class="ident" id="7518116">rand</span><span class="op" id="7518120">.</span><span class="ident" id="7518121">Int63</span><span class="op" id="7518126">(</span><span class="op" id="7518127">)</span><span class="op" id="7518128">)</span><span class="op" id="7518129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518134">for</span>&nbsp;<span class="ident" id="7518138">i</span>&nbsp;<span class="op" id="7518140">:=</span>&nbsp;<span class="num" id="7518143">0</span><span class="op" id="7518144">;</span>&nbsp;<span class="ident" id="7518146">i</span>&nbsp;<span class="op" id="7518148">&lt;</span>&nbsp;<span class="ident" id="7518150">N</span><span class="op" id="7518151">;</span>&nbsp;<span class="ident" id="7518153">i</span><span class="op" id="7518154">++</span>&nbsp;<span class="op" id="7518157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518163">switch</span>&nbsp;<span class="ident" id="7518170">r</span><span class="op" id="7518171">.</span><span class="ident" id="7518172">Intn</span><span class="op" id="7518176">(</span><span class="num" id="7518177">3</span><span class="op" id="7518178">)</span>&nbsp;<span class="op" id="7518180">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518186">case</span>&nbsp;<span class="num" id="7518191">0</span><span class="op" id="7518192">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518199">if</span>&nbsp;<span class="op" id="7518202">!</span><span class="ident" id="7518203">mu</span><span class="op" id="7518205">.</span><span class="ident" id="7518206">Incref</span><span class="op" id="7518212">(</span><span class="op" id="7518213">)</span>&nbsp;<span class="op" id="7518215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518223">t</span><span class="op" id="7518224">.</span><span class="ident" id="7518225">Error</span><span class="op" id="7518230">(</span><span class="string" id="7518231">&#34;broken&#34;</span><span class="op" id="7518239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518247">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518259">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518266">if</span>&nbsp;<span class="ident" id="7518269">mu</span><span class="op" id="7518271">.</span><span class="ident" id="7518272">Decref</span><span class="op" id="7518278">(</span><span class="op" id="7518279">)</span>&nbsp;<span class="op" id="7518281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518289">t</span><span class="op" id="7518290">.</span><span class="ident" id="7518291">Error</span><span class="op" id="7518296">(</span><span class="string" id="7518297">&#34;broken&#34;</span><span class="op" id="7518305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518313">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518331">case</span>&nbsp;<span class="num" id="7518336">1</span><span class="op" id="7518337">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518344">if</span>&nbsp;<span class="op" id="7518347">!</span><span class="ident" id="7518348">mu</span><span class="op" id="7518350">.</span><span class="ident" id="7518351">RWLock</span><span class="op" id="7518357">(</span><span class="builtintype" id="7518358">true</span><span class="op" id="7518362">)</span>&nbsp;<span class="op" id="7518364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518372">t</span><span class="op" id="7518373">.</span><span class="ident" id="7518374">Error</span><span class="op" id="7518379">(</span><span class="string" id="7518380">&#34;broken&#34;</span><span class="op" id="7518388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518396">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7518415">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;readers.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518477">if</span>&nbsp;<span class="ident" id="7518480">readState</span><span class="op" id="7518489">[</span><span class="num" id="7518490">0</span><span class="op" id="7518491">]</span>&nbsp;<span class="op" id="7518493">!=</span>&nbsp;<span class="ident" id="7518496">readState</span><span class="op" id="7518505">[</span><span class="num" id="7518506">1</span><span class="op" id="7518507">]</span>&nbsp;<span class="op" id="7518509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518517">t</span><span class="op" id="7518518">.</span><span class="ident" id="7518519">Error</span><span class="op" id="7518524">(</span><span class="string" id="7518525">&#34;broken&#34;</span><span class="op" id="7518533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518541">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518560">readState</span><span class="op" id="7518569">[</span><span class="num" id="7518570">0</span><span class="op" id="7518571">]</span><span class="op" id="7518572">++</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518580">readState</span><span class="op" id="7518589">[</span><span class="num" id="7518590">1</span><span class="op" id="7518591">]</span><span class="op" id="7518592">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518600">if</span>&nbsp;<span class="ident" id="7518603">mu</span><span class="op" id="7518605">.</span><span class="ident" id="7518606">RWUnlock</span><span class="op" id="7518614">(</span><span class="builtintype" id="7518615">true</span><span class="op" id="7518619">)</span>&nbsp;<span class="op" id="7518621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518629">t</span><span class="op" id="7518630">.</span><span class="ident" id="7518631">Error</span><span class="op" id="7518636">(</span><span class="string" id="7518637">&#34;broken&#34;</span><span class="op" id="7518645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518653">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518665">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518671">case</span>&nbsp;<span class="num" id="7518676">2</span><span class="op" id="7518677">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518684">if</span>&nbsp;<span class="op" id="7518687">!</span><span class="ident" id="7518688">mu</span><span class="op" id="7518690">.</span><span class="ident" id="7518691">RWLock</span><span class="op" id="7518697">(</span><span class="builtintype" id="7518698">false</span><span class="op" id="7518703">)</span>&nbsp;<span class="op" id="7518705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518713">t</span><span class="op" id="7518714">.</span><span class="ident" id="7518715">Error</span><span class="op" id="7518720">(</span><span class="string" id="7518721">&#34;broken&#34;</span><span class="op" id="7518729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518737">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518749">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7518756">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;writers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518818">if</span>&nbsp;<span class="ident" id="7518821">writeState</span><span class="op" id="7518831">[</span><span class="num" id="7518832">0</span><span class="op" id="7518833">]</span>&nbsp;<span class="op" id="7518835">!=</span>&nbsp;<span class="ident" id="7518838">writeState</span><span class="op" id="7518848">[</span><span class="num" id="7518849">1</span><span class="op" id="7518850">]</span>&nbsp;<span class="op" id="7518852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518860">t</span><span class="op" id="7518861">.</span><span class="ident" id="7518862">Error</span><span class="op" id="7518867">(</span><span class="string" id="7518868">&#34;broken&#34;</span><span class="op" id="7518876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518884">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7518896">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518903">writeState</span><span class="op" id="7518913">[</span><span class="num" id="7518914">0</span><span class="op" id="7518915">]</span><span class="op" id="7518916">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518924">writeState</span><span class="op" id="7518934">[</span><span class="num" id="7518935">1</span><span class="op" id="7518936">]</span><span class="op" id="7518937">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518945">if</span>&nbsp;<span class="ident" id="7518948">mu</span><span class="op" id="7518950">.</span><span class="ident" id="7518951">RWUnlock</span><span class="op" id="7518959">(</span><span class="builtintype" id="7518960">false</span><span class="op" id="7518965">)</span>&nbsp;<span class="op" id="7518967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7518975">t</span><span class="op" id="7518976">.</span><span class="ident" id="7518977">Error</span><span class="op" id="7518982">(</span><span class="string" id="7518983">&#34;broken&#34;</span><span class="op" id="7518991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7518999">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519027">done</span>&nbsp;<span class="op" id="7519032">&lt;-</span>&nbsp;<span class="builtintype" id="7519035">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519042">}</span><span class="op" id="7519043">(</span><span class="op" id="7519044">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519050">for</span>&nbsp;<span class="ident" id="7519054">p</span>&nbsp;<span class="op" id="7519056">:=</span>&nbsp;<span class="num" id="7519059">0</span><span class="op" id="7519060">;</span>&nbsp;<span class="ident" id="7519062">p</span>&nbsp;<span class="op" id="7519064">&lt;</span>&nbsp;<span class="ident" id="7519066">P</span><span class="op" id="7519067">;</span>&nbsp;<span class="ident" id="7519069">p</span><span class="op" id="7519070">++</span>&nbsp;<span class="op" id="7519073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519077">&lt;-</span><span class="ident" id="7519079">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519088">if</span>&nbsp;<span class="op" id="7519091">!</span><span class="ident" id="7519092">mu</span><span class="op" id="7519094">.</span><span class="ident" id="7519095">IncrefAndClose</span><span class="op" id="7519109">(</span><span class="op" id="7519110">)</span>&nbsp;<span class="op" id="7519112">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519116">t</span><span class="op" id="7519117">.</span><span class="ident" id="7519118">Fatal</span><span class="op" id="7519123">(</span><span class="string" id="7519124">&#34;broken&#34;</span><span class="op" id="7519132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7519138">if</span>&nbsp;<span class="op" id="7519141">!</span><span class="ident" id="7519142">mu</span><span class="op" id="7519144">.</span><span class="ident" id="7519145">Decref</span><span class="op" id="7519151">(</span><span class="op" id="7519152">)</span>&nbsp;<span class="op" id="7519154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7519158">t</span><span class="op" id="7519159">.</span><span class="ident" id="7519160">Fatal</span><span class="op" id="7519165">(</span><span class="string" id="7519166">&#34;broken&#34;</span><span class="op" id="7519174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7519177">}</span><br>
<span class="lineno">195</span><span class="op" id="7519179">}</span>
</div>
</body>
</html>
