<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html" class="current">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6089629">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6089684">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6089738">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6089789">package</span>&nbsp;<span class="ident" id="6089797">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6089803">import</span>&nbsp;<span class="op" id="6089810">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6089813">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6089828">&#34;crypto/md5&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6089842">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6089852">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="6089858">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6089861">//&nbsp;Auth&nbsp;is&nbsp;implemented&nbsp;by&nbsp;an&nbsp;SMTP&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno">15</span><span class="keyword" id="6089921">type</span>&nbsp;<span class="ident" id="6089926">Auth</span>&nbsp;<span class="keyword" id="6089931">interface</span>&nbsp;<span class="op" id="6089941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089944">//&nbsp;Start&nbsp;begins&nbsp;an&nbsp;authentication&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089994">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090049">//&nbsp;and&nbsp;optionally&nbsp;data&nbsp;to&nbsp;include&nbsp;in&nbsp;the&nbsp;initial&nbsp;AUTH&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090112">//&nbsp;sent&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;can&nbsp;return&nbsp;proto&nbsp;==&nbsp;&#34;&#34;&nbsp;to&nbsp;indicate</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090174">//&nbsp;that&nbsp;the&nbsp;authentication&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090221">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090279">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090337">Start</span><span class="op" id="6090342">(</span><span class="ident" id="6090343">server</span>&nbsp;<span class="op" id="6090350">*</span><span class="ident" id="6090351">ServerInfo</span><span class="op" id="6090361">)</span>&nbsp;<span class="op" id="6090363">(</span><span class="ident" id="6090364">proto</span>&nbsp;<span class="builtintype" id="6090370">string</span><span class="op" id="6090376">,</span>&nbsp;<span class="ident" id="6090378">toServer</span>&nbsp;<span class="op" id="6090387">[</span><span class="op" id="6090388">]</span><span class="builtintype" id="6090389">byte</span><span class="op" id="6090393">,</span>&nbsp;<span class="ident" id="6090395">err</span>&nbsp;<span class="builtintype" id="6090399">error</span><span class="op" id="6090404">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090408">//&nbsp;Next&nbsp;continues&nbsp;the&nbsp;authentication.&nbsp;The&nbsp;server&nbsp;has&nbsp;just&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090472">//&nbsp;the&nbsp;fromServer&nbsp;data.&nbsp;If&nbsp;more&nbsp;is&nbsp;true,&nbsp;the&nbsp;server&nbsp;expects&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090535">//&nbsp;response,&nbsp;which&nbsp;Next&nbsp;should&nbsp;return&nbsp;as&nbsp;toServer;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090597">//&nbsp;Next&nbsp;should&nbsp;return&nbsp;toServer&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090637">//&nbsp;If&nbsp;Next&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090697">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090755">Next</span><span class="op" id="6090759">(</span><span class="ident" id="6090760">fromServer</span>&nbsp;<span class="op" id="6090771">[</span><span class="op" id="6090772">]</span><span class="builtintype" id="6090773">byte</span><span class="op" id="6090777">,</span>&nbsp;<span class="ident" id="6090779">more</span>&nbsp;<span class="builtintype" id="6090784">bool</span><span class="op" id="6090788">)</span>&nbsp;<span class="op" id="6090790">(</span><span class="ident" id="6090791">toServer</span>&nbsp;<span class="op" id="6090800">[</span><span class="op" id="6090801">]</span><span class="builtintype" id="6090802">byte</span><span class="op" id="6090806">,</span>&nbsp;<span class="ident" id="6090808">err</span>&nbsp;<span class="builtintype" id="6090812">error</span><span class="op" id="6090817">)</span><br>
<span class="lineno"></span><span class="op" id="6090819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6090822">//&nbsp;ServerInfo&nbsp;records&nbsp;information&nbsp;about&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno">35</span><span class="keyword" id="6090878">type</span>&nbsp;<span class="ident" id="6090883">ServerInfo</span>&nbsp;<span class="keyword" id="6090894">struct</span>&nbsp;<span class="op" id="6090901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090904">Name</span>&nbsp;<span class="builtintype" id="6090909">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6090918">//&nbsp;SMTP&nbsp;server&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090939">TLS</span>&nbsp;&nbsp;<span class="builtintype" id="6090944">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6090953">//&nbsp;using&nbsp;TLS,&nbsp;with&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091000">Auth</span>&nbsp;<span class="op" id="6091005">[</span><span class="op" id="6091006">]</span><span class="builtintype" id="6091007">string</span>&nbsp;<span class="comment" id="6091014">//&nbsp;advertised&nbsp;authentication&nbsp;mechanisms</span><br>
<span class="lineno"></span><span class="op" id="6091054">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6091057">type</span>&nbsp;<span class="ident" id="6091062">plainAuth</span>&nbsp;<span class="keyword" id="6091072">struct</span>&nbsp;<span class="op" id="6091079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091082">identity</span><span class="op" id="6091090">,</span>&nbsp;<span class="ident" id="6091092">username</span><span class="op" id="6091100">,</span>&nbsp;<span class="ident" id="6091102">password</span>&nbsp;<span class="builtintype" id="6091111">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091119">host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6091148">string</span><br>
<span class="lineno"></span><span class="op" id="6091155">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6091158">//&nbsp;PlainAuth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;PLAIN&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6091228">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4616.</span><br>
<span class="lineno"></span><span class="comment" id="6091265">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno"></span><span class="comment" id="6091339">//&nbsp;on&nbsp;TLS&nbsp;connections&nbsp;to&nbsp;host&nbsp;and&nbsp;act&nbsp;as&nbsp;identity.&nbsp;Usually&nbsp;identity&nbsp;will&nbsp;be</span><br>
<span class="lineno">50</span><span class="comment" id="6091415">//&nbsp;left&nbsp;blank&nbsp;to&nbsp;act&nbsp;as&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="6091449">func</span>&nbsp;<span class="ident" id="6091454">PlainAuth</span><span class="op" id="6091463">(</span><span class="ident" id="6091464">identity</span><span class="op" id="6091472">,</span>&nbsp;<span class="ident" id="6091474">username</span><span class="op" id="6091482">,</span>&nbsp;<span class="ident" id="6091484">password</span><span class="op" id="6091492">,</span>&nbsp;<span class="ident" id="6091494">host</span>&nbsp;<span class="builtintype" id="6091499">string</span><span class="op" id="6091505">)</span>&nbsp;<span class="ident" id="6091507">Auth</span>&nbsp;<span class="op" id="6091512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091515">return</span>&nbsp;<span class="op" id="6091522">&amp;</span><span class="ident" id="6091523">plainAuth</span><span class="op" id="6091532">{</span><span class="ident" id="6091533">identity</span><span class="op" id="6091541">,</span>&nbsp;<span class="ident" id="6091543">username</span><span class="op" id="6091551">,</span>&nbsp;<span class="ident" id="6091553">password</span><span class="op" id="6091561">,</span>&nbsp;<span class="ident" id="6091563">host</span><span class="op" id="6091567">}</span><br>
<span class="lineno"></span><span class="op" id="6091569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6091572">func</span>&nbsp;<span class="op" id="6091577">(</span><span class="ident" id="6091578">a</span>&nbsp;<span class="op" id="6091580">*</span><span class="ident" id="6091581">plainAuth</span><span class="op" id="6091590">)</span>&nbsp;<span class="ident" id="6091592">Start</span><span class="op" id="6091597">(</span><span class="ident" id="6091598">server</span>&nbsp;<span class="op" id="6091605">*</span><span class="ident" id="6091606">ServerInfo</span><span class="op" id="6091616">)</span>&nbsp;<span class="op" id="6091618">(</span><span class="builtintype" id="6091619">string</span><span class="op" id="6091625">,</span>&nbsp;<span class="op" id="6091627">[</span><span class="op" id="6091628">]</span><span class="builtintype" id="6091629">byte</span><span class="op" id="6091633">,</span>&nbsp;<span class="builtintype" id="6091635">error</span><span class="op" id="6091640">)</span>&nbsp;<span class="op" id="6091642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091645">if</span>&nbsp;<span class="op" id="6091648">!</span><span class="ident" id="6091649">server</span><span class="op" id="6091655">.</span><span class="ident" id="6091656">TLS</span>&nbsp;<span class="op" id="6091660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091664">advertised</span>&nbsp;<span class="op" id="6091675">:=</span>&nbsp;<span class="builtintype" id="6091678">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091686">for</span>&nbsp;<span class="ident" id="6091690">_</span><span class="op" id="6091691">,</span>&nbsp;<span class="ident" id="6091693">mechanism</span>&nbsp;<span class="op" id="6091703">:=</span>&nbsp;<span class="keyword" id="6091706">range</span>&nbsp;<span class="ident" id="6091712">server</span><span class="op" id="6091718">.</span><span class="ident" id="6091719">Auth</span>&nbsp;<span class="op" id="6091724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091729">if</span>&nbsp;<span class="ident" id="6091732">mechanism</span>&nbsp;<span class="op" id="6091742">==</span>&nbsp;<span class="string" id="6091745">&#34;PLAIN&#34;</span>&nbsp;<span class="op" id="6091753">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091759">advertised</span>&nbsp;<span class="op" id="6091770">=</span>&nbsp;<span class="builtintype" id="6091772">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091781">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091798">if</span>&nbsp;<span class="op" id="6091801">!</span><span class="ident" id="6091802">advertised</span>&nbsp;<span class="op" id="6091813">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091818">return</span>&nbsp;<span class="string" id="6091825">&#34;&#34;</span><span class="op" id="6091827">,</span>&nbsp;<span class="ident" id="6091829">nil</span><span class="op" id="6091832">,</span>&nbsp;<span class="ident" id="6091834">errors</span><span class="op" id="6091840">.</span><span class="ident" id="6091841">New</span><span class="op" id="6091844">(</span><span class="string" id="6091845">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="6091869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091879">if</span>&nbsp;<span class="ident" id="6091882">server</span><span class="op" id="6091888">.</span><span class="ident" id="6091889">Name</span>&nbsp;<span class="op" id="6091894">!=</span>&nbsp;<span class="ident" id="6091897">a</span><span class="op" id="6091898">.</span><span class="ident" id="6091899">host</span>&nbsp;<span class="op" id="6091904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091908">return</span>&nbsp;<span class="string" id="6091915">&#34;&#34;</span><span class="op" id="6091917">,</span>&nbsp;<span class="ident" id="6091919">nil</span><span class="op" id="6091922">,</span>&nbsp;<span class="ident" id="6091924">errors</span><span class="op" id="6091930">.</span><span class="ident" id="6091931">New</span><span class="op" id="6091934">(</span><span class="string" id="6091935">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="6091952">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091958">resp</span>&nbsp;<span class="op" id="6091963">:=</span>&nbsp;<span class="op" id="6091966">[</span><span class="op" id="6091967">]</span><span class="builtintype" id="6091968">byte</span><span class="op" id="6091972">(</span><span class="ident" id="6091973">a</span><span class="op" id="6091974">.</span><span class="ident" id="6091975">identity</span>&nbsp;<span class="op" id="6091984">+</span>&nbsp;<span class="string" id="6091986">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6091993">+</span>&nbsp;<span class="ident" id="6091995">a</span><span class="op" id="6091996">.</span><span class="ident" id="6091997">username</span>&nbsp;<span class="op" id="6092006">+</span>&nbsp;<span class="string" id="6092008">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6092015">+</span>&nbsp;<span class="ident" id="6092017">a</span><span class="op" id="6092018">.</span><span class="ident" id="6092019">password</span><span class="op" id="6092027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092030">return</span>&nbsp;<span class="string" id="6092037">&#34;PLAIN&#34;</span><span class="op" id="6092044">,</span>&nbsp;<span class="ident" id="6092046">resp</span><span class="op" id="6092050">,</span>&nbsp;<span class="ident" id="6092052">nil</span><br>
<span class="lineno"></span><span class="op" id="6092056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6092059">func</span>&nbsp;<span class="op" id="6092064">(</span><span class="ident" id="6092065">a</span>&nbsp;<span class="op" id="6092067">*</span><span class="ident" id="6092068">plainAuth</span><span class="op" id="6092077">)</span>&nbsp;<span class="ident" id="6092079">Next</span><span class="op" id="6092083">(</span><span class="ident" id="6092084">fromServer</span>&nbsp;<span class="op" id="6092095">[</span><span class="op" id="6092096">]</span><span class="builtintype" id="6092097">byte</span><span class="op" id="6092101">,</span>&nbsp;<span class="ident" id="6092103">more</span>&nbsp;<span class="builtintype" id="6092108">bool</span><span class="op" id="6092112">)</span>&nbsp;<span class="op" id="6092114">(</span><span class="op" id="6092115">[</span><span class="op" id="6092116">]</span><span class="builtintype" id="6092117">byte</span><span class="op" id="6092121">,</span>&nbsp;<span class="builtintype" id="6092123">error</span><span class="op" id="6092128">)</span>&nbsp;<span class="op" id="6092130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092133">if</span>&nbsp;<span class="ident" id="6092136">more</span>&nbsp;<span class="op" id="6092141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6092145">//&nbsp;We&#39;ve&nbsp;already&nbsp;sent&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092181">return</span>&nbsp;<span class="ident" id="6092188">nil</span><span class="op" id="6092191">,</span>&nbsp;<span class="ident" id="6092193">errors</span><span class="op" id="6092199">.</span><span class="ident" id="6092200">New</span><span class="op" id="6092203">(</span><span class="string" id="6092204">&#34;unexpected&nbsp;server&nbsp;challenge&#34;</span><span class="op" id="6092233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6092236">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092239">return</span>&nbsp;<span class="ident" id="6092246">nil</span><span class="op" id="6092249">,</span>&nbsp;<span class="ident" id="6092251">nil</span><br>
<span class="lineno"></span><span class="op" id="6092255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6092258">type</span>&nbsp;<span class="ident" id="6092263">cramMD5Auth</span>&nbsp;<span class="keyword" id="6092275">struct</span>&nbsp;<span class="op" id="6092282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092285">username</span><span class="op" id="6092293">,</span>&nbsp;<span class="ident" id="6092295">secret</span>&nbsp;<span class="builtintype" id="6092302">string</span><br>
<span class="lineno">85</span><span class="op" id="6092309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6092312">//&nbsp;CRAMMD5Auth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;CRAM-MD5&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6092387">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2195.</span><br>
<span class="lineno"></span><span class="comment" id="6092424">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;secret&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno">90</span><span class="comment" id="6092496">//&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;challenge-response&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="keyword" id="6092553">func</span>&nbsp;<span class="ident" id="6092558">CRAMMD5Auth</span><span class="op" id="6092569">(</span><span class="ident" id="6092570">username</span><span class="op" id="6092578">,</span>&nbsp;<span class="ident" id="6092580">secret</span>&nbsp;<span class="builtintype" id="6092587">string</span><span class="op" id="6092593">)</span>&nbsp;<span class="ident" id="6092595">Auth</span>&nbsp;<span class="op" id="6092600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092603">return</span>&nbsp;<span class="op" id="6092610">&amp;</span><span class="ident" id="6092611">cramMD5Auth</span><span class="op" id="6092622">{</span><span class="ident" id="6092623">username</span><span class="op" id="6092631">,</span>&nbsp;<span class="ident" id="6092633">secret</span><span class="op" id="6092639">}</span><br>
<span class="lineno"></span><span class="op" id="6092641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6092644">func</span>&nbsp;<span class="op" id="6092649">(</span><span class="ident" id="6092650">a</span>&nbsp;<span class="op" id="6092652">*</span><span class="ident" id="6092653">cramMD5Auth</span><span class="op" id="6092664">)</span>&nbsp;<span class="ident" id="6092666">Start</span><span class="op" id="6092671">(</span><span class="ident" id="6092672">server</span>&nbsp;<span class="op" id="6092679">*</span><span class="ident" id="6092680">ServerInfo</span><span class="op" id="6092690">)</span>&nbsp;<span class="op" id="6092692">(</span><span class="builtintype" id="6092693">string</span><span class="op" id="6092699">,</span>&nbsp;<span class="op" id="6092701">[</span><span class="op" id="6092702">]</span><span class="builtintype" id="6092703">byte</span><span class="op" id="6092707">,</span>&nbsp;<span class="builtintype" id="6092709">error</span><span class="op" id="6092714">)</span>&nbsp;<span class="op" id="6092716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092719">return</span>&nbsp;<span class="string" id="6092726">&#34;CRAM-MD5&#34;</span><span class="op" id="6092736">,</span>&nbsp;<span class="ident" id="6092738">nil</span><span class="op" id="6092741">,</span>&nbsp;<span class="ident" id="6092743">nil</span><br>
<span class="lineno"></span><span class="op" id="6092747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6092750">func</span>&nbsp;<span class="op" id="6092755">(</span><span class="ident" id="6092756">a</span>&nbsp;<span class="op" id="6092758">*</span><span class="ident" id="6092759">cramMD5Auth</span><span class="op" id="6092770">)</span>&nbsp;<span class="ident" id="6092772">Next</span><span class="op" id="6092776">(</span><span class="ident" id="6092777">fromServer</span>&nbsp;<span class="op" id="6092788">[</span><span class="op" id="6092789">]</span><span class="builtintype" id="6092790">byte</span><span class="op" id="6092794">,</span>&nbsp;<span class="ident" id="6092796">more</span>&nbsp;<span class="builtintype" id="6092801">bool</span><span class="op" id="6092805">)</span>&nbsp;<span class="op" id="6092807">(</span><span class="op" id="6092808">[</span><span class="op" id="6092809">]</span><span class="builtintype" id="6092810">byte</span><span class="op" id="6092814">,</span>&nbsp;<span class="builtintype" id="6092816">error</span><span class="op" id="6092821">)</span>&nbsp;<span class="op" id="6092823">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092826">if</span>&nbsp;<span class="ident" id="6092829">more</span>&nbsp;<span class="op" id="6092834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092838">d</span>&nbsp;<span class="op" id="6092840">:=</span>&nbsp;<span class="ident" id="6092843">hmac</span><span class="op" id="6092847">.</span><span class="ident" id="6092848">New</span><span class="op" id="6092851">(</span><span class="ident" id="6092852">md5</span><span class="op" id="6092855">.</span><span class="ident" id="6092856">New</span><span class="op" id="6092859">,</span>&nbsp;<span class="op" id="6092861">[</span><span class="op" id="6092862">]</span><span class="builtintype" id="6092863">byte</span><span class="op" id="6092867">(</span><span class="ident" id="6092868">a</span><span class="op" id="6092869">.</span><span class="ident" id="6092870">secret</span><span class="op" id="6092876">)</span><span class="op" id="6092877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092881">d</span><span class="op" id="6092882">.</span><span class="ident" id="6092883">Write</span><span class="op" id="6092888">(</span><span class="ident" id="6092889">fromServer</span><span class="op" id="6092899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092903">s</span>&nbsp;<span class="op" id="6092905">:=</span>&nbsp;<span class="builtinfunc" id="6092908">make</span><span class="op" id="6092912">(</span><span class="op" id="6092913">[</span><span class="op" id="6092914">]</span><span class="builtintype" id="6092915">byte</span><span class="op" id="6092919">,</span>&nbsp;<span class="num" id="6092921">0</span><span class="op" id="6092922">,</span>&nbsp;<span class="ident" id="6092924">d</span><span class="op" id="6092925">.</span><span class="ident" id="6092926">Size</span><span class="op" id="6092930">(</span><span class="op" id="6092931">)</span><span class="op" id="6092932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092936">return</span>&nbsp;<span class="op" id="6092943">[</span><span class="op" id="6092944">]</span><span class="builtintype" id="6092945">byte</span><span class="op" id="6092949">(</span><span class="ident" id="6092950">fmt</span><span class="op" id="6092953">.</span><span class="ident" id="6092954">Sprintf</span><span class="op" id="6092961">(</span><span class="string" id="6092962">&#34;%s&nbsp;%x&#34;</span><span class="op" id="6092969">,</span>&nbsp;<span class="ident" id="6092971">a</span><span class="op" id="6092972">.</span><span class="ident" id="6092973">username</span><span class="op" id="6092981">,</span>&nbsp;<span class="ident" id="6092983">d</span><span class="op" id="6092984">.</span><span class="ident" id="6092985">Sum</span><span class="op" id="6092988">(</span><span class="ident" id="6092989">s</span><span class="op" id="6092990">)</span><span class="op" id="6092991">)</span><span class="op" id="6092992">)</span><span class="op" id="6092993">,</span>&nbsp;<span class="ident" id="6092995">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6093000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6093003">return</span>&nbsp;<span class="ident" id="6093010">nil</span><span class="op" id="6093013">,</span>&nbsp;<span class="ident" id="6093015">nil</span><br>
<span class="lineno"></span><span class="op" id="6093019">}</span>
</div>
</body>
</html>
