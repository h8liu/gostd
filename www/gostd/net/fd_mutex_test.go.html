<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7857583">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7857638">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7857692">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7857743">package</span>&nbsp;<span class="ident" id="7857751">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7857756">import</span>&nbsp;<span class="op" id="7857763">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7857766">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7857779">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7857790">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7857801">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7857808">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7857811">func</span>&nbsp;<span class="ident" id="7857816">TestMutexLock</span><span class="op" id="7857829">(</span><span class="ident" id="7857830">t</span>&nbsp;<span class="op" id="7857832">*</span><span class="ident" id="7857833">testing</span><span class="op" id="7857840">.</span><span class="ident" id="7857841">T</span><span class="op" id="7857842">)</span>&nbsp;<span class="op" id="7857844">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7857847">var</span>&nbsp;<span class="ident" id="7857851">mu</span>&nbsp;<span class="ident" id="7857854">fdMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7857864">if</span>&nbsp;<span class="op" id="7857867">!</span><span class="ident" id="7857868">mu</span><span class="op" id="7857870">.</span><span class="ident" id="7857871">Incref</span><span class="op" id="7857877">(</span><span class="op" id="7857878">)</span>&nbsp;<span class="op" id="7857880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7857884">t</span><span class="op" id="7857885">.</span><span class="ident" id="7857886">Fatal</span><span class="op" id="7857891">(</span><span class="string" id="7857892">&#34;broken&#34;</span><span class="op" id="7857900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7857903">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7857906">if</span>&nbsp;<span class="ident" id="7857909">mu</span><span class="op" id="7857911">.</span><span class="ident" id="7857912">Decref</span><span class="op" id="7857918">(</span><span class="op" id="7857919">)</span>&nbsp;<span class="op" id="7857921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7857925">t</span><span class="op" id="7857926">.</span><span class="ident" id="7857927">Fatal</span><span class="op" id="7857932">(</span><span class="string" id="7857933">&#34;broken&#34;</span><span class="op" id="7857941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7857944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7857948">if</span>&nbsp;<span class="op" id="7857951">!</span><span class="ident" id="7857952">mu</span><span class="op" id="7857954">.</span><span class="ident" id="7857955">RWLock</span><span class="op" id="7857961">(</span><span class="builtintype" id="7857962">true</span><span class="op" id="7857966">)</span>&nbsp;<span class="op" id="7857968">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7857972">t</span><span class="op" id="7857973">.</span><span class="ident" id="7857974">Fatal</span><span class="op" id="7857979">(</span><span class="string" id="7857980">&#34;broken&#34;</span><span class="op" id="7857988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7857991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7857994">if</span>&nbsp;<span class="ident" id="7857997">mu</span><span class="op" id="7857999">.</span><span class="ident" id="7858000">RWUnlock</span><span class="op" id="7858008">(</span><span class="builtintype" id="7858009">true</span><span class="op" id="7858013">)</span>&nbsp;<span class="op" id="7858015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858019">t</span><span class="op" id="7858020">.</span><span class="ident" id="7858021">Fatal</span><span class="op" id="7858026">(</span><span class="string" id="7858027">&#34;broken&#34;</span><span class="op" id="7858035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7858038">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858042">if</span>&nbsp;<span class="op" id="7858045">!</span><span class="ident" id="7858046">mu</span><span class="op" id="7858048">.</span><span class="ident" id="7858049">RWLock</span><span class="op" id="7858055">(</span><span class="builtintype" id="7858056">false</span><span class="op" id="7858061">)</span>&nbsp;<span class="op" id="7858063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858067">t</span><span class="op" id="7858068">.</span><span class="ident" id="7858069">Fatal</span><span class="op" id="7858074">(</span><span class="string" id="7858075">&#34;broken&#34;</span><span class="op" id="7858083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7858086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858089">if</span>&nbsp;<span class="ident" id="7858092">mu</span><span class="op" id="7858094">.</span><span class="ident" id="7858095">RWUnlock</span><span class="op" id="7858103">(</span><span class="builtintype" id="7858104">false</span><span class="op" id="7858109">)</span>&nbsp;<span class="op" id="7858111">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858115">t</span><span class="op" id="7858116">.</span><span class="ident" id="7858117">Fatal</span><span class="op" id="7858122">(</span><span class="string" id="7858123">&#34;broken&#34;</span><span class="op" id="7858131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7858134">}</span><br>
<span class="lineno"></span><span class="op" id="7858136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7858139">func</span>&nbsp;<span class="ident" id="7858144">TestMutexClose</span><span class="op" id="7858158">(</span><span class="ident" id="7858159">t</span>&nbsp;<span class="op" id="7858161">*</span><span class="ident" id="7858162">testing</span><span class="op" id="7858169">.</span><span class="ident" id="7858170">T</span><span class="op" id="7858171">)</span>&nbsp;<span class="op" id="7858173">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858176">var</span>&nbsp;<span class="ident" id="7858180">mu</span>&nbsp;<span class="ident" id="7858183">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858192">if</span>&nbsp;<span class="op" id="7858195">!</span><span class="ident" id="7858196">mu</span><span class="op" id="7858198">.</span><span class="ident" id="7858199">IncrefAndClose</span><span class="op" id="7858213">(</span><span class="op" id="7858214">)</span>&nbsp;<span class="op" id="7858216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858220">t</span><span class="op" id="7858221">.</span><span class="ident" id="7858222">Fatal</span><span class="op" id="7858227">(</span><span class="string" id="7858228">&#34;broken&#34;</span><span class="op" id="7858236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7858239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858243">if</span>&nbsp;<span class="ident" id="7858246">mu</span><span class="op" id="7858248">.</span><span class="ident" id="7858249">Incref</span><span class="op" id="7858255">(</span><span class="op" id="7858256">)</span>&nbsp;<span class="op" id="7858258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858262">t</span><span class="op" id="7858263">.</span><span class="ident" id="7858264">Fatal</span><span class="op" id="7858269">(</span><span class="string" id="7858270">&#34;broken&#34;</span><span class="op" id="7858278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7858281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858284">if</span>&nbsp;<span class="ident" id="7858287">mu</span><span class="op" id="7858289">.</span><span class="ident" id="7858290">RWLock</span><span class="op" id="7858296">(</span><span class="builtintype" id="7858297">true</span><span class="op" id="7858301">)</span>&nbsp;<span class="op" id="7858303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858307">t</span><span class="op" id="7858308">.</span><span class="ident" id="7858309">Fatal</span><span class="op" id="7858314">(</span><span class="string" id="7858315">&#34;broken&#34;</span><span class="op" id="7858323">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7858326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858329">if</span>&nbsp;<span class="ident" id="7858332">mu</span><span class="op" id="7858334">.</span><span class="ident" id="7858335">RWLock</span><span class="op" id="7858341">(</span><span class="builtintype" id="7858342">false</span><span class="op" id="7858347">)</span>&nbsp;<span class="op" id="7858349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858353">t</span><span class="op" id="7858354">.</span><span class="ident" id="7858355">Fatal</span><span class="op" id="7858360">(</span><span class="string" id="7858361">&#34;broken&#34;</span><span class="op" id="7858369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7858372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858375">if</span>&nbsp;<span class="ident" id="7858378">mu</span><span class="op" id="7858380">.</span><span class="ident" id="7858381">IncrefAndClose</span><span class="op" id="7858395">(</span><span class="op" id="7858396">)</span>&nbsp;<span class="op" id="7858398">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858402">t</span><span class="op" id="7858403">.</span><span class="ident" id="7858404">Fatal</span><span class="op" id="7858409">(</span><span class="string" id="7858410">&#34;broken&#34;</span><span class="op" id="7858418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7858421">}</span><br>
<span class="lineno"></span><span class="op" id="7858423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7858426">func</span>&nbsp;<span class="ident" id="7858431">TestMutexCloseUnblock</span><span class="op" id="7858452">(</span><span class="ident" id="7858453">t</span>&nbsp;<span class="op" id="7858455">*</span><span class="ident" id="7858456">testing</span><span class="op" id="7858463">.</span><span class="ident" id="7858464">T</span><span class="op" id="7858465">)</span>&nbsp;<span class="op" id="7858467">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858470">c</span>&nbsp;<span class="op" id="7858472">:=</span>&nbsp;<span class="builtinfunc" id="7858475">make</span><span class="op" id="7858479">(</span><span class="keyword" id="7858480">chan</span>&nbsp;<span class="builtintype" id="7858485">bool</span><span class="op" id="7858489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858492">var</span>&nbsp;<span class="ident" id="7858496">mu</span>&nbsp;<span class="ident" id="7858499">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858508">mu</span><span class="op" id="7858510">.</span><span class="ident" id="7858511">RWLock</span><span class="op" id="7858517">(</span><span class="builtintype" id="7858518">true</span><span class="op" id="7858522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858525">for</span>&nbsp;<span class="ident" id="7858529">i</span>&nbsp;<span class="op" id="7858531">:=</span>&nbsp;<span class="num" id="7858534">0</span><span class="op" id="7858535">;</span>&nbsp;<span class="ident" id="7858537">i</span>&nbsp;<span class="op" id="7858539">&lt;</span>&nbsp;<span class="num" id="7858541">4</span><span class="op" id="7858542">;</span>&nbsp;<span class="ident" id="7858544">i</span><span class="op" id="7858545">++</span>&nbsp;<span class="op" id="7858548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858552">go</span>&nbsp;<span class="keyword" id="7858555">func</span><span class="op" id="7858559">(</span><span class="op" id="7858560">)</span>&nbsp;<span class="op" id="7858562">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858567">if</span>&nbsp;<span class="ident" id="7858570">mu</span><span class="op" id="7858572">.</span><span class="ident" id="7858573">RWLock</span><span class="op" id="7858579">(</span><span class="builtintype" id="7858580">true</span><span class="op" id="7858584">)</span>&nbsp;<span class="op" id="7858586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858592">t</span><span class="op" id="7858593">.</span><span class="ident" id="7858594">Error</span><span class="op" id="7858599">(</span><span class="string" id="7858600">&#34;broken&#34;</span><span class="op" id="7858608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858614">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7858624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858629">c</span>&nbsp;<span class="op" id="7858631">&lt;-</span>&nbsp;<span class="builtintype" id="7858634">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7858641">}</span><span class="op" id="7858642">(</span><span class="op" id="7858643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7858646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7858649">//&nbsp;Concurrent&nbsp;goroutines&nbsp;must&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;lock&nbsp;the&nbsp;mutex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858716">time</span><span class="op" id="7858720">.</span><span class="ident" id="7858721">Sleep</span><span class="op" id="7858726">(</span><span class="ident" id="7858727">time</span><span class="op" id="7858731">.</span><span class="ident" id="7858732">Millisecond</span><span class="op" id="7858743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858746">select</span>&nbsp;<span class="op" id="7858753">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858756">case</span>&nbsp;<span class="op" id="7858761">&lt;-</span><span class="ident" id="7858763">c</span><span class="op" id="7858764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858768">t</span><span class="op" id="7858769">.</span><span class="ident" id="7858770">Fatal</span><span class="op" id="7858775">(</span><span class="string" id="7858776">&#34;broken&#34;</span><span class="op" id="7858784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858787">default</span><span class="op" id="7858794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7858797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858800">mu</span><span class="op" id="7858802">.</span><span class="ident" id="7858803">IncrefAndClose</span><span class="op" id="7858817">(</span><span class="op" id="7858818">)</span>&nbsp;<span class="comment" id="7858820">//&nbsp;Must&nbsp;unblock&nbsp;the&nbsp;readers.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858850">for</span>&nbsp;<span class="ident" id="7858854">i</span>&nbsp;<span class="op" id="7858856">:=</span>&nbsp;<span class="num" id="7858859">0</span><span class="op" id="7858860">;</span>&nbsp;<span class="ident" id="7858862">i</span>&nbsp;<span class="op" id="7858864">&lt;</span>&nbsp;<span class="num" id="7858866">4</span><span class="op" id="7858867">;</span>&nbsp;<span class="ident" id="7858869">i</span><span class="op" id="7858870">++</span>&nbsp;<span class="op" id="7858873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858877">select</span>&nbsp;<span class="op" id="7858884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858888">case</span>&nbsp;<span class="op" id="7858893">&lt;-</span><span class="ident" id="7858895">c</span><span class="op" id="7858896">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858900">case</span>&nbsp;<span class="op" id="7858905">&lt;-</span><span class="ident" id="7858907">time</span><span class="op" id="7858911">.</span><span class="ident" id="7858912">After</span><span class="op" id="7858917">(</span><span class="num" id="7858918">10</span>&nbsp;<span class="op" id="7858921">*</span>&nbsp;<span class="ident" id="7858923">time</span><span class="op" id="7858927">.</span><span class="ident" id="7858928">Second</span><span class="op" id="7858934">)</span><span class="op" id="7858935">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858940">t</span><span class="op" id="7858941">.</span><span class="ident" id="7858942">Fatal</span><span class="op" id="7858947">(</span><span class="string" id="7858948">&#34;broken&#34;</span><span class="op" id="7858956">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7858960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7858963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7858966">if</span>&nbsp;<span class="ident" id="7858969">mu</span><span class="op" id="7858971">.</span><span class="ident" id="7858972">Decref</span><span class="op" id="7858978">(</span><span class="op" id="7858979">)</span>&nbsp;<span class="op" id="7858981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7858985">t</span><span class="op" id="7858986">.</span><span class="ident" id="7858987">Fatal</span><span class="op" id="7858992">(</span><span class="string" id="7858993">&#34;broken&#34;</span><span class="op" id="7859001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7859004">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7859007">if</span>&nbsp;<span class="op" id="7859010">!</span><span class="ident" id="7859011">mu</span><span class="op" id="7859013">.</span><span class="ident" id="7859014">RWUnlock</span><span class="op" id="7859022">(</span><span class="builtintype" id="7859023">true</span><span class="op" id="7859027">)</span>&nbsp;<span class="op" id="7859029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859033">t</span><span class="op" id="7859034">.</span><span class="ident" id="7859035">Fatal</span><span class="op" id="7859040">(</span><span class="string" id="7859041">&#34;broken&#34;</span><span class="op" id="7859049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7859052">}</span><br>
<span class="lineno"></span><span class="op" id="7859054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7859057">func</span>&nbsp;<span class="ident" id="7859062">TestMutexPanic</span><span class="op" id="7859076">(</span><span class="ident" id="7859077">t</span>&nbsp;<span class="op" id="7859079">*</span><span class="ident" id="7859080">testing</span><span class="op" id="7859087">.</span><span class="ident" id="7859088">T</span><span class="op" id="7859089">)</span>&nbsp;<span class="op" id="7859091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859094">ensurePanics</span>&nbsp;<span class="op" id="7859107">:=</span>&nbsp;<span class="keyword" id="7859110">func</span><span class="op" id="7859114">(</span><span class="ident" id="7859115">f</span>&nbsp;<span class="keyword" id="7859117">func</span><span class="op" id="7859121">(</span><span class="op" id="7859122">)</span><span class="op" id="7859123">)</span>&nbsp;<span class="op" id="7859125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7859129">defer</span>&nbsp;<span class="keyword" id="7859135">func</span><span class="op" id="7859139">(</span><span class="op" id="7859140">)</span>&nbsp;<span class="op" id="7859142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7859147">if</span>&nbsp;<span class="builtinfunc" id="7859150">recover</span><span class="op" id="7859157">(</span><span class="op" id="7859158">)</span>&nbsp;<span class="op" id="7859160">==</span>&nbsp;<span class="ident" id="7859163">nil</span>&nbsp;<span class="op" id="7859167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859173">t</span><span class="op" id="7859174">.</span><span class="ident" id="7859175">Fatal</span><span class="op" id="7859180">(</span><span class="string" id="7859181">&#34;does&nbsp;not&nbsp;panic&#34;</span><span class="op" id="7859197">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7859202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7859206">}</span><span class="op" id="7859207">(</span><span class="op" id="7859208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859212">f</span><span class="op" id="7859213">(</span><span class="op" id="7859214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7859217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7859221">var</span>&nbsp;<span class="ident" id="7859225">mu</span>&nbsp;<span class="ident" id="7859228">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859237">ensurePanics</span><span class="op" id="7859249">(</span><span class="keyword" id="7859250">func</span><span class="op" id="7859254">(</span><span class="op" id="7859255">)</span>&nbsp;<span class="op" id="7859257">{</span>&nbsp;<span class="ident" id="7859259">mu</span><span class="op" id="7859261">.</span><span class="ident" id="7859262">Decref</span><span class="op" id="7859268">(</span><span class="op" id="7859269">)</span>&nbsp;<span class="op" id="7859271">}</span><span class="op" id="7859272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859275">ensurePanics</span><span class="op" id="7859287">(</span><span class="keyword" id="7859288">func</span><span class="op" id="7859292">(</span><span class="op" id="7859293">)</span>&nbsp;<span class="op" id="7859295">{</span>&nbsp;<span class="ident" id="7859297">mu</span><span class="op" id="7859299">.</span><span class="ident" id="7859300">RWUnlock</span><span class="op" id="7859308">(</span><span class="builtintype" id="7859309">true</span><span class="op" id="7859313">)</span>&nbsp;<span class="op" id="7859315">}</span><span class="op" id="7859316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859319">ensurePanics</span><span class="op" id="7859331">(</span><span class="keyword" id="7859332">func</span><span class="op" id="7859336">(</span><span class="op" id="7859337">)</span>&nbsp;<span class="op" id="7859339">{</span>&nbsp;<span class="ident" id="7859341">mu</span><span class="op" id="7859343">.</span><span class="ident" id="7859344">RWUnlock</span><span class="op" id="7859352">(</span><span class="builtintype" id="7859353">false</span><span class="op" id="7859358">)</span>&nbsp;<span class="op" id="7859360">}</span><span class="op" id="7859361">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859365">ensurePanics</span><span class="op" id="7859377">(</span><span class="keyword" id="7859378">func</span><span class="op" id="7859382">(</span><span class="op" id="7859383">)</span>&nbsp;<span class="op" id="7859385">{</span>&nbsp;<span class="ident" id="7859387">mu</span><span class="op" id="7859389">.</span><span class="ident" id="7859390">Incref</span><span class="op" id="7859396">(</span><span class="op" id="7859397">)</span><span class="op" id="7859398">;</span>&nbsp;<span class="ident" id="7859400">mu</span><span class="op" id="7859402">.</span><span class="ident" id="7859403">Decref</span><span class="op" id="7859409">(</span><span class="op" id="7859410">)</span><span class="op" id="7859411">;</span>&nbsp;<span class="ident" id="7859413">mu</span><span class="op" id="7859415">.</span><span class="ident" id="7859416">Decref</span><span class="op" id="7859422">(</span><span class="op" id="7859423">)</span>&nbsp;<span class="op" id="7859425">}</span><span class="op" id="7859426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859429">ensurePanics</span><span class="op" id="7859441">(</span><span class="keyword" id="7859442">func</span><span class="op" id="7859446">(</span><span class="op" id="7859447">)</span>&nbsp;<span class="op" id="7859449">{</span>&nbsp;<span class="ident" id="7859451">mu</span><span class="op" id="7859453">.</span><span class="ident" id="7859454">RWLock</span><span class="op" id="7859460">(</span><span class="builtintype" id="7859461">true</span><span class="op" id="7859465">)</span><span class="op" id="7859466">;</span>&nbsp;<span class="ident" id="7859468">mu</span><span class="op" id="7859470">.</span><span class="ident" id="7859471">RWUnlock</span><span class="op" id="7859479">(</span><span class="builtintype" id="7859480">true</span><span class="op" id="7859484">)</span><span class="op" id="7859485">;</span>&nbsp;<span class="ident" id="7859487">mu</span><span class="op" id="7859489">.</span><span class="ident" id="7859490">RWUnlock</span><span class="op" id="7859498">(</span><span class="builtintype" id="7859499">true</span><span class="op" id="7859503">)</span>&nbsp;<span class="op" id="7859505">}</span><span class="op" id="7859506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859509">ensurePanics</span><span class="op" id="7859521">(</span><span class="keyword" id="7859522">func</span><span class="op" id="7859526">(</span><span class="op" id="7859527">)</span>&nbsp;<span class="op" id="7859529">{</span>&nbsp;<span class="ident" id="7859531">mu</span><span class="op" id="7859533">.</span><span class="ident" id="7859534">RWLock</span><span class="op" id="7859540">(</span><span class="builtintype" id="7859541">false</span><span class="op" id="7859546">)</span><span class="op" id="7859547">;</span>&nbsp;<span class="ident" id="7859549">mu</span><span class="op" id="7859551">.</span><span class="ident" id="7859552">RWUnlock</span><span class="op" id="7859560">(</span><span class="builtintype" id="7859561">false</span><span class="op" id="7859566">)</span><span class="op" id="7859567">;</span>&nbsp;<span class="ident" id="7859569">mu</span><span class="op" id="7859571">.</span><span class="ident" id="7859572">RWUnlock</span><span class="op" id="7859580">(</span><span class="builtintype" id="7859581">false</span><span class="op" id="7859586">)</span>&nbsp;<span class="op" id="7859588">}</span><span class="op" id="7859589">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7859593">//&nbsp;ensure&nbsp;that&nbsp;it&#39;s&nbsp;still&nbsp;not&nbsp;broken</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859631">mu</span><span class="op" id="7859633">.</span><span class="ident" id="7859634">Incref</span><span class="op" id="7859640">(</span><span class="op" id="7859641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859644">mu</span><span class="op" id="7859646">.</span><span class="ident" id="7859647">Decref</span><span class="op" id="7859653">(</span><span class="op" id="7859654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859657">mu</span><span class="op" id="7859659">.</span><span class="ident" id="7859660">RWLock</span><span class="op" id="7859666">(</span><span class="builtintype" id="7859667">true</span><span class="op" id="7859671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859674">mu</span><span class="op" id="7859676">.</span><span class="ident" id="7859677">RWUnlock</span><span class="op" id="7859685">(</span><span class="builtintype" id="7859686">true</span><span class="op" id="7859690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859693">mu</span><span class="op" id="7859695">.</span><span class="ident" id="7859696">RWLock</span><span class="op" id="7859702">(</span><span class="builtintype" id="7859703">false</span><span class="op" id="7859708">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859711">mu</span><span class="op" id="7859713">.</span><span class="ident" id="7859714">RWUnlock</span><span class="op" id="7859722">(</span><span class="builtintype" id="7859723">false</span><span class="op" id="7859728">)</span><br>
<span class="lineno"></span><span class="op" id="7859730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7859733">func</span>&nbsp;<span class="ident" id="7859738">TestMutexStress</span><span class="op" id="7859753">(</span><span class="ident" id="7859754">t</span>&nbsp;<span class="op" id="7859756">*</span><span class="ident" id="7859757">testing</span><span class="op" id="7859764">.</span><span class="ident" id="7859765">T</span><span class="op" id="7859766">)</span>&nbsp;<span class="op" id="7859768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859771">P</span>&nbsp;<span class="op" id="7859773">:=</span>&nbsp;<span class="num" id="7859776">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859779">N</span>&nbsp;<span class="op" id="7859781">:=</span>&nbsp;<span class="builtintype" id="7859784">int</span><span class="op" id="7859787">(</span><span class="num" id="7859788">1e6</span><span class="op" id="7859791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7859794">if</span>&nbsp;<span class="ident" id="7859797">testing</span><span class="op" id="7859804">.</span><span class="ident" id="7859805">Short</span><span class="op" id="7859810">(</span><span class="op" id="7859811">)</span>&nbsp;<span class="op" id="7859813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859817">P</span>&nbsp;<span class="op" id="7859819">=</span>&nbsp;<span class="num" id="7859821">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859825">N</span>&nbsp;<span class="op" id="7859827">=</span>&nbsp;<span class="num" id="7859829">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7859834">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7859837">defer</span>&nbsp;<span class="ident" id="7859843">runtime</span><span class="op" id="7859850">.</span><span class="ident" id="7859851">GOMAXPROCS</span><span class="op" id="7859861">(</span><span class="ident" id="7859862">runtime</span><span class="op" id="7859869">.</span><span class="ident" id="7859870">GOMAXPROCS</span><span class="op" id="7859880">(</span><span class="ident" id="7859881">P</span><span class="op" id="7859882">)</span><span class="op" id="7859883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7859886">done</span>&nbsp;<span class="op" id="7859891">:=</span>&nbsp;<span class="builtinfunc" id="7859894">make</span><span class="op" id="7859898">(</span><span class="keyword" id="7859899">chan</span>&nbsp;<span class="builtintype" id="7859904">bool</span><span class="op" id="7859908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7859911">var</span>&nbsp;<span class="ident" id="7859915">mu</span>&nbsp;<span class="ident" id="7859918">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7859927">var</span>&nbsp;<span class="ident" id="7859931">readState</span>&nbsp;<span class="op" id="7859941">[</span><span class="num" id="7859942">2</span><span class="op" id="7859943">]</span><span class="ident" id="7859944">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7859952">var</span>&nbsp;<span class="ident" id="7859956">writeState</span>&nbsp;<span class="op" id="7859967">[</span><span class="num" id="7859968">2</span><span class="op" id="7859969">]</span><span class="ident" id="7859970">uint64</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7859978">for</span>&nbsp;<span class="ident" id="7859982">p</span>&nbsp;<span class="op" id="7859984">:=</span>&nbsp;<span class="num" id="7859987">0</span><span class="op" id="7859988">;</span>&nbsp;<span class="ident" id="7859990">p</span>&nbsp;<span class="op" id="7859992">&lt;</span>&nbsp;<span class="ident" id="7859994">P</span><span class="op" id="7859995">;</span>&nbsp;<span class="ident" id="7859997">p</span><span class="op" id="7859998">++</span>&nbsp;<span class="op" id="7860001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860005">go</span>&nbsp;<span class="keyword" id="7860008">func</span><span class="op" id="7860012">(</span><span class="op" id="7860013">)</span>&nbsp;<span class="op" id="7860015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860020">r</span>&nbsp;<span class="op" id="7860022">:=</span>&nbsp;<span class="ident" id="7860025">rand</span><span class="op" id="7860029">.</span><span class="ident" id="7860030">New</span><span class="op" id="7860033">(</span><span class="ident" id="7860034">rand</span><span class="op" id="7860038">.</span><span class="ident" id="7860039">NewSource</span><span class="op" id="7860048">(</span><span class="ident" id="7860049">rand</span><span class="op" id="7860053">.</span><span class="ident" id="7860054">Int63</span><span class="op" id="7860059">(</span><span class="op" id="7860060">)</span><span class="op" id="7860061">)</span><span class="op" id="7860062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860067">for</span>&nbsp;<span class="ident" id="7860071">i</span>&nbsp;<span class="op" id="7860073">:=</span>&nbsp;<span class="num" id="7860076">0</span><span class="op" id="7860077">;</span>&nbsp;<span class="ident" id="7860079">i</span>&nbsp;<span class="op" id="7860081">&lt;</span>&nbsp;<span class="ident" id="7860083">N</span><span class="op" id="7860084">;</span>&nbsp;<span class="ident" id="7860086">i</span><span class="op" id="7860087">++</span>&nbsp;<span class="op" id="7860090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860096">switch</span>&nbsp;<span class="ident" id="7860103">r</span><span class="op" id="7860104">.</span><span class="ident" id="7860105">Intn</span><span class="op" id="7860109">(</span><span class="num" id="7860110">3</span><span class="op" id="7860111">)</span>&nbsp;<span class="op" id="7860113">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860119">case</span>&nbsp;<span class="num" id="7860124">0</span><span class="op" id="7860125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860132">if</span>&nbsp;<span class="op" id="7860135">!</span><span class="ident" id="7860136">mu</span><span class="op" id="7860138">.</span><span class="ident" id="7860139">Incref</span><span class="op" id="7860145">(</span><span class="op" id="7860146">)</span>&nbsp;<span class="op" id="7860148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860156">t</span><span class="op" id="7860157">.</span><span class="ident" id="7860158">Error</span><span class="op" id="7860163">(</span><span class="string" id="7860164">&#34;broken&#34;</span><span class="op" id="7860172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860180">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860192">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860199">if</span>&nbsp;<span class="ident" id="7860202">mu</span><span class="op" id="7860204">.</span><span class="ident" id="7860205">Decref</span><span class="op" id="7860211">(</span><span class="op" id="7860212">)</span>&nbsp;<span class="op" id="7860214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860222">t</span><span class="op" id="7860223">.</span><span class="ident" id="7860224">Error</span><span class="op" id="7860229">(</span><span class="string" id="7860230">&#34;broken&#34;</span><span class="op" id="7860238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860246">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860264">case</span>&nbsp;<span class="num" id="7860269">1</span><span class="op" id="7860270">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860277">if</span>&nbsp;<span class="op" id="7860280">!</span><span class="ident" id="7860281">mu</span><span class="op" id="7860283">.</span><span class="ident" id="7860284">RWLock</span><span class="op" id="7860290">(</span><span class="builtintype" id="7860291">true</span><span class="op" id="7860295">)</span>&nbsp;<span class="op" id="7860297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860305">t</span><span class="op" id="7860306">.</span><span class="ident" id="7860307">Error</span><span class="op" id="7860312">(</span><span class="string" id="7860313">&#34;broken&#34;</span><span class="op" id="7860321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860329">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7860348">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;readers.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860410">if</span>&nbsp;<span class="ident" id="7860413">readState</span><span class="op" id="7860422">[</span><span class="num" id="7860423">0</span><span class="op" id="7860424">]</span>&nbsp;<span class="op" id="7860426">!=</span>&nbsp;<span class="ident" id="7860429">readState</span><span class="op" id="7860438">[</span><span class="num" id="7860439">1</span><span class="op" id="7860440">]</span>&nbsp;<span class="op" id="7860442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860450">t</span><span class="op" id="7860451">.</span><span class="ident" id="7860452">Error</span><span class="op" id="7860457">(</span><span class="string" id="7860458">&#34;broken&#34;</span><span class="op" id="7860466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860474">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860493">readState</span><span class="op" id="7860502">[</span><span class="num" id="7860503">0</span><span class="op" id="7860504">]</span><span class="op" id="7860505">++</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860513">readState</span><span class="op" id="7860522">[</span><span class="num" id="7860523">1</span><span class="op" id="7860524">]</span><span class="op" id="7860525">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860533">if</span>&nbsp;<span class="ident" id="7860536">mu</span><span class="op" id="7860538">.</span><span class="ident" id="7860539">RWUnlock</span><span class="op" id="7860547">(</span><span class="builtintype" id="7860548">true</span><span class="op" id="7860552">)</span>&nbsp;<span class="op" id="7860554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860562">t</span><span class="op" id="7860563">.</span><span class="ident" id="7860564">Error</span><span class="op" id="7860569">(</span><span class="string" id="7860570">&#34;broken&#34;</span><span class="op" id="7860578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860586">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860598">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860604">case</span>&nbsp;<span class="num" id="7860609">2</span><span class="op" id="7860610">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860617">if</span>&nbsp;<span class="op" id="7860620">!</span><span class="ident" id="7860621">mu</span><span class="op" id="7860623">.</span><span class="ident" id="7860624">RWLock</span><span class="op" id="7860630">(</span><span class="builtintype" id="7860631">false</span><span class="op" id="7860636">)</span>&nbsp;<span class="op" id="7860638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860646">t</span><span class="op" id="7860647">.</span><span class="ident" id="7860648">Error</span><span class="op" id="7860653">(</span><span class="string" id="7860654">&#34;broken&#34;</span><span class="op" id="7860662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860670">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860682">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7860689">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;writers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860751">if</span>&nbsp;<span class="ident" id="7860754">writeState</span><span class="op" id="7860764">[</span><span class="num" id="7860765">0</span><span class="op" id="7860766">]</span>&nbsp;<span class="op" id="7860768">!=</span>&nbsp;<span class="ident" id="7860771">writeState</span><span class="op" id="7860781">[</span><span class="num" id="7860782">1</span><span class="op" id="7860783">]</span>&nbsp;<span class="op" id="7860785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860793">t</span><span class="op" id="7860794">.</span><span class="ident" id="7860795">Error</span><span class="op" id="7860800">(</span><span class="string" id="7860801">&#34;broken&#34;</span><span class="op" id="7860809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860817">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860829">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860836">writeState</span><span class="op" id="7860846">[</span><span class="num" id="7860847">0</span><span class="op" id="7860848">]</span><span class="op" id="7860849">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860857">writeState</span><span class="op" id="7860867">[</span><span class="num" id="7860868">1</span><span class="op" id="7860869">]</span><span class="op" id="7860870">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860878">if</span>&nbsp;<span class="ident" id="7860881">mu</span><span class="op" id="7860883">.</span><span class="ident" id="7860884">RWUnlock</span><span class="op" id="7860892">(</span><span class="builtintype" id="7860893">false</span><span class="op" id="7860898">)</span>&nbsp;<span class="op" id="7860900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860908">t</span><span class="op" id="7860909">.</span><span class="ident" id="7860910">Error</span><span class="op" id="7860915">(</span><span class="string" id="7860916">&#34;broken&#34;</span><span class="op" id="7860924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860932">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7860960">done</span>&nbsp;<span class="op" id="7860965">&lt;-</span>&nbsp;<span class="builtintype" id="7860968">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860975">}</span><span class="op" id="7860976">(</span><span class="op" id="7860977">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7860980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7860983">for</span>&nbsp;<span class="ident" id="7860987">p</span>&nbsp;<span class="op" id="7860989">:=</span>&nbsp;<span class="num" id="7860992">0</span><span class="op" id="7860993">;</span>&nbsp;<span class="ident" id="7860995">p</span>&nbsp;<span class="op" id="7860997">&lt;</span>&nbsp;<span class="ident" id="7860999">P</span><span class="op" id="7861000">;</span>&nbsp;<span class="ident" id="7861002">p</span><span class="op" id="7861003">++</span>&nbsp;<span class="op" id="7861006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861010">&lt;-</span><span class="ident" id="7861012">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861021">if</span>&nbsp;<span class="op" id="7861024">!</span><span class="ident" id="7861025">mu</span><span class="op" id="7861027">.</span><span class="ident" id="7861028">IncrefAndClose</span><span class="op" id="7861042">(</span><span class="op" id="7861043">)</span>&nbsp;<span class="op" id="7861045">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861049">t</span><span class="op" id="7861050">.</span><span class="ident" id="7861051">Fatal</span><span class="op" id="7861056">(</span><span class="string" id="7861057">&#34;broken&#34;</span><span class="op" id="7861065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7861071">if</span>&nbsp;<span class="op" id="7861074">!</span><span class="ident" id="7861075">mu</span><span class="op" id="7861077">.</span><span class="ident" id="7861078">Decref</span><span class="op" id="7861084">(</span><span class="op" id="7861085">)</span>&nbsp;<span class="op" id="7861087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7861091">t</span><span class="op" id="7861092">.</span><span class="ident" id="7861093">Fatal</span><span class="op" id="7861098">(</span><span class="string" id="7861099">&#34;broken&#34;</span><span class="op" id="7861107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7861110">}</span><br>
<span class="lineno">195</span><span class="op" id="7861112">}</span>
</div>
</body>
</html>
