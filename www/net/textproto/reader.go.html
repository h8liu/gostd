<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3763044">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3763100">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3763154">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3763205">package</span>&nbsp;<span class="ident" id="3763213">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3763224">import</span>&nbsp;<span class="op" id="3763231">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763234">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763243">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763252">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763258">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763271">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3763282">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3763292">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3763295">//&nbsp;BUG(rsc):&nbsp;To&nbsp;let&nbsp;callers&nbsp;manage&nbsp;exposure&nbsp;to&nbsp;denial&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="3763360">//&nbsp;attacks,&nbsp;Reader&nbsp;should&nbsp;allow&nbsp;them&nbsp;to&nbsp;set&nbsp;and&nbsp;reset&nbsp;a&nbsp;limit&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3763425">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3763475">//&nbsp;A&nbsp;Reader&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;reading&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="3763539">//&nbsp;or&nbsp;responses&nbsp;from&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3763596">type</span>&nbsp;<span class="ident" id="3763601">Reader</span>&nbsp;<span class="keyword" id="3763608">struct</span>&nbsp;<span class="op" id="3763615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763618">R</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3763622">*</span><span class="ident" id="3763623">bufio</span><span class="op" id="3763628">.</span><span class="ident" id="3763629">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763637">dot</span>&nbsp;<span class="op" id="3763641">*</span><span class="ident" id="3763642">dotReader</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763653">buf</span>&nbsp;<span class="op" id="3763657">[</span><span class="op" id="3763658">]</span><span class="builtintype" id="3763659">byte</span>&nbsp;<span class="comment" id="3763664">//&nbsp;a&nbsp;re-usable&nbsp;buffer&nbsp;for&nbsp;readContinuedLineSlice</span><br>
<span class="lineno"></span><span class="op" id="3763713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3763716">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3763766">func</span>&nbsp;<span class="ident" id="3763771">NewReader</span><span class="op" id="3763780">(</span><span class="ident" id="3763781">r</span>&nbsp;<span class="op" id="3763783">*</span><span class="ident" id="3763784">bufio</span><span class="op" id="3763789">.</span><span class="ident" id="3763790">Reader</span><span class="op" id="3763796">)</span>&nbsp;<span class="op" id="3763798">*</span><span class="ident" id="3763799">Reader</span>&nbsp;<span class="op" id="3763806">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3763809">return</span>&nbsp;<span class="op" id="3763816">&amp;</span><span class="ident" id="3763817">Reader</span><span class="op" id="3763823">{</span><span class="ident" id="3763824">R</span><span class="op" id="3763825">:</span>&nbsp;<span class="ident" id="3763827">r</span><span class="op" id="3763828">}</span><br>
<span class="lineno"></span><span class="op" id="3763830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3763833">//&nbsp;ReadLine&nbsp;reads&nbsp;a&nbsp;single&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3763873">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;\n&nbsp;or&nbsp;\r\n&nbsp;from&nbsp;the&nbsp;returned&nbsp;string.</span><br>
<span class="lineno">35</span><span class="keyword" id="3763931">func</span>&nbsp;<span class="op" id="3763936">(</span><span class="ident" id="3763937">r</span>&nbsp;<span class="op" id="3763939">*</span><span class="ident" id="3763940">Reader</span><span class="op" id="3763946">)</span>&nbsp;<span class="ident" id="3763948">ReadLine</span><span class="op" id="3763956">(</span><span class="op" id="3763957">)</span>&nbsp;<span class="op" id="3763959">(</span><span class="builtintype" id="3763960">string</span><span class="op" id="3763966">,</span>&nbsp;<span class="builtintype" id="3763968">error</span><span class="op" id="3763973">)</span>&nbsp;<span class="op" id="3763975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3763978">line</span><span class="op" id="3763982">,</span>&nbsp;<span class="ident" id="3763984">err</span>&nbsp;<span class="op" id="3763988">:=</span>&nbsp;<span class="ident" id="3763991">r</span><span class="op" id="3763992">.</span><span class="ident" id="3763993">readLineSlice</span><span class="op" id="3764006">(</span><span class="op" id="3764007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764010">return</span>&nbsp;<span class="builtintype" id="3764017">string</span><span class="op" id="3764023">(</span><span class="ident" id="3764024">line</span><span class="op" id="3764028">)</span><span class="op" id="3764029">,</span>&nbsp;<span class="ident" id="3764031">err</span><br>
<span class="lineno"></span><span class="op" id="3764035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3764038">//&nbsp;ReadLineBytes&nbsp;is&nbsp;like&nbsp;ReadLine&nbsp;but&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3764114">func</span>&nbsp;<span class="op" id="3764119">(</span><span class="ident" id="3764120">r</span>&nbsp;<span class="op" id="3764122">*</span><span class="ident" id="3764123">Reader</span><span class="op" id="3764129">)</span>&nbsp;<span class="ident" id="3764131">ReadLineBytes</span><span class="op" id="3764144">(</span><span class="op" id="3764145">)</span>&nbsp;<span class="op" id="3764147">(</span><span class="op" id="3764148">[</span><span class="op" id="3764149">]</span><span class="builtintype" id="3764150">byte</span><span class="op" id="3764154">,</span>&nbsp;<span class="builtintype" id="3764156">error</span><span class="op" id="3764161">)</span>&nbsp;<span class="op" id="3764163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764166">line</span><span class="op" id="3764170">,</span>&nbsp;<span class="ident" id="3764172">err</span>&nbsp;<span class="op" id="3764176">:=</span>&nbsp;<span class="ident" id="3764179">r</span><span class="op" id="3764180">.</span><span class="ident" id="3764181">readLineSlice</span><span class="op" id="3764194">(</span><span class="op" id="3764195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764198">if</span>&nbsp;<span class="ident" id="3764201">line</span>&nbsp;<span class="op" id="3764206">!=</span>&nbsp;<span class="ident" id="3764209">nil</span>&nbsp;<span class="op" id="3764213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764217">buf</span>&nbsp;<span class="op" id="3764221">:=</span>&nbsp;<span class="builtinfunc" id="3764224">make</span><span class="op" id="3764228">(</span><span class="op" id="3764229">[</span><span class="op" id="3764230">]</span><span class="builtintype" id="3764231">byte</span><span class="op" id="3764235">,</span>&nbsp;<span class="builtinfunc" id="3764237">len</span><span class="op" id="3764240">(</span><span class="ident" id="3764241">line</span><span class="op" id="3764245">)</span><span class="op" id="3764246">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3764250">copy</span><span class="op" id="3764254">(</span><span class="ident" id="3764255">buf</span><span class="op" id="3764258">,</span>&nbsp;<span class="ident" id="3764260">line</span><span class="op" id="3764264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764268">line</span>&nbsp;<span class="op" id="3764273">=</span>&nbsp;<span class="ident" id="3764275">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3764280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764283">return</span>&nbsp;<span class="ident" id="3764290">line</span><span class="op" id="3764294">,</span>&nbsp;<span class="ident" id="3764296">err</span><br>
<span class="lineno"></span><span class="op" id="3764300">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="3764303">func</span>&nbsp;<span class="op" id="3764308">(</span><span class="ident" id="3764309">r</span>&nbsp;<span class="op" id="3764311">*</span><span class="ident" id="3764312">Reader</span><span class="op" id="3764318">)</span>&nbsp;<span class="ident" id="3764320">readLineSlice</span><span class="op" id="3764333">(</span><span class="op" id="3764334">)</span>&nbsp;<span class="op" id="3764336">(</span><span class="op" id="3764337">[</span><span class="op" id="3764338">]</span><span class="builtintype" id="3764339">byte</span><span class="op" id="3764343">,</span>&nbsp;<span class="builtintype" id="3764345">error</span><span class="op" id="3764350">)</span>&nbsp;<span class="op" id="3764352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764355">r</span><span class="op" id="3764356">.</span><span class="ident" id="3764357">closeDot</span><span class="op" id="3764365">(</span><span class="op" id="3764366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764369">var</span>&nbsp;<span class="ident" id="3764373">line</span>&nbsp;<span class="op" id="3764378">[</span><span class="op" id="3764379">]</span><span class="builtintype" id="3764380">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764386">for</span>&nbsp;<span class="op" id="3764390">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764394">l</span><span class="op" id="3764395">,</span>&nbsp;<span class="ident" id="3764397">more</span><span class="op" id="3764401">,</span>&nbsp;<span class="ident" id="3764403">err</span>&nbsp;<span class="op" id="3764407">:=</span>&nbsp;<span class="ident" id="3764410">r</span><span class="op" id="3764411">.</span><span class="ident" id="3764412">R</span><span class="op" id="3764413">.</span><span class="ident" id="3764414">ReadLine</span><span class="op" id="3764422">(</span><span class="op" id="3764423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764427">if</span>&nbsp;<span class="ident" id="3764430">err</span>&nbsp;<span class="op" id="3764434">!=</span>&nbsp;<span class="ident" id="3764437">nil</span>&nbsp;<span class="op" id="3764441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764446">return</span>&nbsp;<span class="ident" id="3764453">nil</span><span class="op" id="3764456">,</span>&nbsp;<span class="ident" id="3764458">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3764464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3764468">//&nbsp;Avoid&nbsp;the&nbsp;copy&nbsp;if&nbsp;the&nbsp;first&nbsp;call&nbsp;produced&nbsp;a&nbsp;full&nbsp;line.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764528">if</span>&nbsp;<span class="ident" id="3764531">line</span>&nbsp;<span class="op" id="3764536">==</span>&nbsp;<span class="ident" id="3764539">nil</span>&nbsp;<span class="op" id="3764543">&amp;&amp;</span>&nbsp;<span class="op" id="3764546">!</span><span class="ident" id="3764547">more</span>&nbsp;<span class="op" id="3764552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764557">return</span>&nbsp;<span class="ident" id="3764564">l</span><span class="op" id="3764565">,</span>&nbsp;<span class="ident" id="3764567">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3764573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3764577">line</span>&nbsp;<span class="op" id="3764582">=</span>&nbsp;<span class="builtinfunc" id="3764584">append</span><span class="op" id="3764590">(</span><span class="ident" id="3764591">line</span><span class="op" id="3764595">,</span>&nbsp;<span class="ident" id="3764597">l</span><span class="op" id="3764598">...</span><span class="op" id="3764601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764605">if</span>&nbsp;<span class="op" id="3764608">!</span><span class="ident" id="3764609">more</span>&nbsp;<span class="op" id="3764614">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764619">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3764627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3764630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3764633">return</span>&nbsp;<span class="ident" id="3764640">line</span><span class="op" id="3764644">,</span>&nbsp;<span class="ident" id="3764646">nil</span><br>
<span class="lineno"></span><span class="op" id="3764650">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3764653">//&nbsp;ReadContinuedLine&nbsp;reads&nbsp;a&nbsp;possibly&nbsp;continued&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3764714">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;trailing&nbsp;ASCII&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="comment" id="3764763">//&nbsp;Lines&nbsp;after&nbsp;the&nbsp;first&nbsp;are&nbsp;considered&nbsp;continuations&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="3764825">//&nbsp;begin&nbsp;with&nbsp;a&nbsp;space&nbsp;or&nbsp;tab&nbsp;character.&nbsp;&nbsp;In&nbsp;the&nbsp;returned&nbsp;data,</span><br>
<span class="lineno">75</span><span class="comment" id="3764888">//&nbsp;continuation&nbsp;lines&nbsp;are&nbsp;separated&nbsp;from&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3764947">//&nbsp;only&nbsp;by&nbsp;a&nbsp;single&nbsp;space:&nbsp;the&nbsp;newline&nbsp;and&nbsp;leading&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="3765010">//&nbsp;are&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3765026">//</span><br>
<span class="lineno"></span><span class="comment" id="3765029">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">80</span><span class="comment" id="3765066">//</span><br>
<span class="lineno"></span><span class="comment" id="3765069">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3765079">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;continued...</span><br>
<span class="lineno"></span><span class="comment" id="3765097">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3765107">//</span><br>
<span class="lineno">85</span><span class="comment" id="3765110">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;ReadContinuedLine&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;1&nbsp;continued...&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3765183">//&nbsp;and&nbsp;the&nbsp;second&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;2&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3765223">//</span><br>
<span class="lineno"></span><span class="comment" id="3765226">//&nbsp;A&nbsp;line&nbsp;consisting&nbsp;of&nbsp;only&nbsp;white&nbsp;space&nbsp;is&nbsp;never&nbsp;continued.</span><br>
<span class="lineno"></span><span class="comment" id="3765287">//</span><br>
<span class="lineno">90</span><span class="keyword" id="3765290">func</span>&nbsp;<span class="op" id="3765295">(</span><span class="ident" id="3765296">r</span>&nbsp;<span class="op" id="3765298">*</span><span class="ident" id="3765299">Reader</span><span class="op" id="3765305">)</span>&nbsp;<span class="ident" id="3765307">ReadContinuedLine</span><span class="op" id="3765324">(</span><span class="op" id="3765325">)</span>&nbsp;<span class="op" id="3765327">(</span><span class="builtintype" id="3765328">string</span><span class="op" id="3765334">,</span>&nbsp;<span class="builtintype" id="3765336">error</span><span class="op" id="3765341">)</span>&nbsp;<span class="op" id="3765343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765346">line</span><span class="op" id="3765350">,</span>&nbsp;<span class="ident" id="3765352">err</span>&nbsp;<span class="op" id="3765356">:=</span>&nbsp;<span class="ident" id="3765359">r</span><span class="op" id="3765360">.</span><span class="ident" id="3765361">readContinuedLineSlice</span><span class="op" id="3765383">(</span><span class="op" id="3765384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765387">return</span>&nbsp;<span class="builtintype" id="3765394">string</span><span class="op" id="3765400">(</span><span class="ident" id="3765401">line</span><span class="op" id="3765405">)</span><span class="op" id="3765406">,</span>&nbsp;<span class="ident" id="3765408">err</span><br>
<span class="lineno"></span><span class="op" id="3765412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3765415">//&nbsp;trim&nbsp;returns&nbsp;s&nbsp;with&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;spaces&nbsp;and&nbsp;tabs&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3765484">//&nbsp;It&nbsp;does&nbsp;not&nbsp;assume&nbsp;Unicode&nbsp;or&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="3765524">func</span>&nbsp;<span class="ident" id="3765529">trim</span><span class="op" id="3765533">(</span><span class="ident" id="3765534">s</span>&nbsp;<span class="op" id="3765536">[</span><span class="op" id="3765537">]</span><span class="builtintype" id="3765538">byte</span><span class="op" id="3765542">)</span>&nbsp;<span class="op" id="3765544">[</span><span class="op" id="3765545">]</span><span class="builtintype" id="3765546">byte</span>&nbsp;<span class="op" id="3765551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765554">i</span>&nbsp;<span class="op" id="3765556">:=</span>&nbsp;<span class="num" id="3765559">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765562">for</span>&nbsp;<span class="ident" id="3765566">i</span>&nbsp;<span class="op" id="3765568">&lt;</span>&nbsp;<span class="builtinfunc" id="3765570">len</span><span class="op" id="3765573">(</span><span class="ident" id="3765574">s</span><span class="op" id="3765575">)</span>&nbsp;<span class="op" id="3765577">&amp;&amp;</span>&nbsp;<span class="op" id="3765580">(</span><span class="ident" id="3765581">s</span><span class="op" id="3765582">[</span><span class="ident" id="3765583">i</span><span class="op" id="3765584">]</span>&nbsp;<span class="op" id="3765586">==</span>&nbsp;<span class="string" id="3765589">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3765593">||</span>&nbsp;<span class="ident" id="3765596">s</span><span class="op" id="3765597">[</span><span class="ident" id="3765598">i</span><span class="op" id="3765599">]</span>&nbsp;<span class="op" id="3765601">==</span>&nbsp;<span class="string" id="3765604">&#39;\t&#39;</span><span class="op" id="3765608">)</span>&nbsp;<span class="op" id="3765610">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765614">i</span><span class="op" id="3765615">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3765619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765622">n</span>&nbsp;<span class="op" id="3765624">:=</span>&nbsp;<span class="builtinfunc" id="3765627">len</span><span class="op" id="3765630">(</span><span class="ident" id="3765631">s</span><span class="op" id="3765632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765635">for</span>&nbsp;<span class="ident" id="3765639">n</span>&nbsp;<span class="op" id="3765641">&gt;</span>&nbsp;<span class="ident" id="3765643">i</span>&nbsp;<span class="op" id="3765645">&amp;&amp;</span>&nbsp;<span class="op" id="3765648">(</span><span class="ident" id="3765649">s</span><span class="op" id="3765650">[</span><span class="ident" id="3765651">n</span><span class="op" id="3765652">-</span><span class="num" id="3765653">1</span><span class="op" id="3765654">]</span>&nbsp;<span class="op" id="3765656">==</span>&nbsp;<span class="string" id="3765659">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3765663">||</span>&nbsp;<span class="ident" id="3765666">s</span><span class="op" id="3765667">[</span><span class="ident" id="3765668">n</span><span class="op" id="3765669">-</span><span class="num" id="3765670">1</span><span class="op" id="3765671">]</span>&nbsp;<span class="op" id="3765673">==</span>&nbsp;<span class="string" id="3765676">&#39;\t&#39;</span><span class="op" id="3765680">)</span>&nbsp;<span class="op" id="3765682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765686">n</span><span class="op" id="3765687">--</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3765691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765694">return</span>&nbsp;<span class="ident" id="3765701">s</span><span class="op" id="3765702">[</span><span class="ident" id="3765703">i</span><span class="op" id="3765704">:</span><span class="ident" id="3765705">n</span><span class="op" id="3765706">]</span><br>
<span class="lineno"></span><span class="op" id="3765708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3765711">//&nbsp;ReadContinuedLineBytes&nbsp;is&nbsp;like&nbsp;ReadContinuedLine&nbsp;but</span><br>
<span class="lineno">110</span><span class="comment" id="3765767">//&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3765808">func</span>&nbsp;<span class="op" id="3765813">(</span><span class="ident" id="3765814">r</span>&nbsp;<span class="op" id="3765816">*</span><span class="ident" id="3765817">Reader</span><span class="op" id="3765823">)</span>&nbsp;<span class="ident" id="3765825">ReadContinuedLineBytes</span><span class="op" id="3765847">(</span><span class="op" id="3765848">)</span>&nbsp;<span class="op" id="3765850">(</span><span class="op" id="3765851">[</span><span class="op" id="3765852">]</span><span class="builtintype" id="3765853">byte</span><span class="op" id="3765857">,</span>&nbsp;<span class="builtintype" id="3765859">error</span><span class="op" id="3765864">)</span>&nbsp;<span class="op" id="3765866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765869">line</span><span class="op" id="3765873">,</span>&nbsp;<span class="ident" id="3765875">err</span>&nbsp;<span class="op" id="3765879">:=</span>&nbsp;<span class="ident" id="3765882">r</span><span class="op" id="3765883">.</span><span class="ident" id="3765884">readContinuedLineSlice</span><span class="op" id="3765906">(</span><span class="op" id="3765907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765910">if</span>&nbsp;<span class="ident" id="3765913">line</span>&nbsp;<span class="op" id="3765918">!=</span>&nbsp;<span class="ident" id="3765921">nil</span>&nbsp;<span class="op" id="3765925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765929">buf</span>&nbsp;<span class="op" id="3765933">:=</span>&nbsp;<span class="builtinfunc" id="3765936">make</span><span class="op" id="3765940">(</span><span class="op" id="3765941">[</span><span class="op" id="3765942">]</span><span class="builtintype" id="3765943">byte</span><span class="op" id="3765947">,</span>&nbsp;<span class="builtinfunc" id="3765949">len</span><span class="op" id="3765952">(</span><span class="ident" id="3765953">line</span><span class="op" id="3765957">)</span><span class="op" id="3765958">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3765962">copy</span><span class="op" id="3765966">(</span><span class="ident" id="3765967">buf</span><span class="op" id="3765970">,</span>&nbsp;<span class="ident" id="3765972">line</span><span class="op" id="3765976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3765980">line</span>&nbsp;<span class="op" id="3765985">=</span>&nbsp;<span class="ident" id="3765987">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3765992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3765995">return</span>&nbsp;<span class="ident" id="3766002">line</span><span class="op" id="3766006">,</span>&nbsp;<span class="ident" id="3766008">err</span><br>
<span class="lineno"></span><span class="op" id="3766012">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="3766015">func</span>&nbsp;<span class="op" id="3766020">(</span><span class="ident" id="3766021">r</span>&nbsp;<span class="op" id="3766023">*</span><span class="ident" id="3766024">Reader</span><span class="op" id="3766030">)</span>&nbsp;<span class="ident" id="3766032">readContinuedLineSlice</span><span class="op" id="3766054">(</span><span class="op" id="3766055">)</span>&nbsp;<span class="op" id="3766057">(</span><span class="op" id="3766058">[</span><span class="op" id="3766059">]</span><span class="builtintype" id="3766060">byte</span><span class="op" id="3766064">,</span>&nbsp;<span class="builtintype" id="3766066">error</span><span class="op" id="3766071">)</span>&nbsp;<span class="op" id="3766073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766076">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766101">line</span><span class="op" id="3766105">,</span>&nbsp;<span class="ident" id="3766107">err</span>&nbsp;<span class="op" id="3766111">:=</span>&nbsp;<span class="ident" id="3766114">r</span><span class="op" id="3766115">.</span><span class="ident" id="3766116">readLineSlice</span><span class="op" id="3766129">(</span><span class="op" id="3766130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766133">if</span>&nbsp;<span class="ident" id="3766136">err</span>&nbsp;<span class="op" id="3766140">!=</span>&nbsp;<span class="ident" id="3766143">nil</span>&nbsp;<span class="op" id="3766147">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766151">return</span>&nbsp;<span class="ident" id="3766158">nil</span><span class="op" id="3766161">,</span>&nbsp;<span class="ident" id="3766163">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766171">if</span>&nbsp;<span class="builtinfunc" id="3766174">len</span><span class="op" id="3766177">(</span><span class="ident" id="3766178">line</span><span class="op" id="3766182">)</span>&nbsp;<span class="op" id="3766184">==</span>&nbsp;<span class="num" id="3766187">0</span>&nbsp;<span class="op" id="3766189">{</span>&nbsp;<span class="comment" id="3766191">//&nbsp;blank&nbsp;line&nbsp;-&nbsp;no&nbsp;continuation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766225">return</span>&nbsp;<span class="ident" id="3766232">line</span><span class="op" id="3766236">,</span>&nbsp;<span class="ident" id="3766238">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766243">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766247">//&nbsp;Optimistically&nbsp;assume&nbsp;that&nbsp;we&nbsp;have&nbsp;started&nbsp;to&nbsp;buffer&nbsp;the&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766318">//&nbsp;and&nbsp;it&nbsp;starts&nbsp;with&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;(the&nbsp;next&nbsp;header&nbsp;key),&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766390">//&nbsp;avoid&nbsp;copying&nbsp;that&nbsp;buffered&nbsp;data&nbsp;around&nbsp;in&nbsp;memory&nbsp;and&nbsp;skipping&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766462">//&nbsp;non-existent&nbsp;whitespace.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766491">if</span>&nbsp;<span class="ident" id="3766494">r</span><span class="op" id="3766495">.</span><span class="ident" id="3766496">R</span><span class="op" id="3766497">.</span><span class="ident" id="3766498">Buffered</span><span class="op" id="3766506">(</span><span class="op" id="3766507">)</span>&nbsp;<span class="op" id="3766509">&gt;</span>&nbsp;<span class="num" id="3766511">1</span>&nbsp;<span class="op" id="3766513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766517">peek</span><span class="op" id="3766521">,</span>&nbsp;<span class="ident" id="3766523">err</span>&nbsp;<span class="op" id="3766527">:=</span>&nbsp;<span class="ident" id="3766530">r</span><span class="op" id="3766531">.</span><span class="ident" id="3766532">R</span><span class="op" id="3766533">.</span><span class="ident" id="3766534">Peek</span><span class="op" id="3766538">(</span><span class="num" id="3766539">1</span><span class="op" id="3766540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766544">if</span>&nbsp;<span class="ident" id="3766547">err</span>&nbsp;<span class="op" id="3766551">==</span>&nbsp;<span class="ident" id="3766554">nil</span>&nbsp;<span class="op" id="3766558">&amp;&amp;</span>&nbsp;<span class="ident" id="3766561">isASCIILetter</span><span class="op" id="3766574">(</span><span class="ident" id="3766575">peek</span><span class="op" id="3766579">[</span><span class="num" id="3766580">0</span><span class="op" id="3766581">]</span><span class="op" id="3766582">)</span>&nbsp;<span class="op" id="3766584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766589">return</span>&nbsp;<span class="ident" id="3766596">trim</span><span class="op" id="3766600">(</span><span class="ident" id="3766601">line</span><span class="op" id="3766605">)</span><span class="op" id="3766606">,</span>&nbsp;<span class="ident" id="3766608">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766614">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766621">//&nbsp;ReadByte&nbsp;or&nbsp;the&nbsp;next&nbsp;readLineSlice&nbsp;will&nbsp;flush&nbsp;the&nbsp;read&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766688">//&nbsp;copy&nbsp;the&nbsp;slice&nbsp;into&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766717">r</span><span class="op" id="3766718">.</span><span class="ident" id="3766719">buf</span>&nbsp;<span class="op" id="3766723">=</span>&nbsp;<span class="builtinfunc" id="3766725">append</span><span class="op" id="3766731">(</span><span class="ident" id="3766732">r</span><span class="op" id="3766733">.</span><span class="ident" id="3766734">buf</span><span class="op" id="3766737">[</span><span class="op" id="3766738">:</span><span class="num" id="3766739">0</span><span class="op" id="3766740">]</span><span class="op" id="3766741">,</span>&nbsp;<span class="ident" id="3766743">trim</span><span class="op" id="3766747">(</span><span class="ident" id="3766748">line</span><span class="op" id="3766752">)</span><span class="op" id="3766753">...</span><span class="op" id="3766756">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3766760">//&nbsp;Read&nbsp;continuation&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766789">for</span>&nbsp;<span class="ident" id="3766793">r</span><span class="op" id="3766794">.</span><span class="ident" id="3766795">skipSpace</span><span class="op" id="3766804">(</span><span class="op" id="3766805">)</span>&nbsp;<span class="op" id="3766807">&gt;</span>&nbsp;<span class="num" id="3766809">0</span>&nbsp;<span class="op" id="3766811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766815">line</span><span class="op" id="3766819">,</span>&nbsp;<span class="ident" id="3766821">err</span>&nbsp;<span class="op" id="3766825">:=</span>&nbsp;<span class="ident" id="3766828">r</span><span class="op" id="3766829">.</span><span class="ident" id="3766830">readLineSlice</span><span class="op" id="3766843">(</span><span class="op" id="3766844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766848">if</span>&nbsp;<span class="ident" id="3766851">err</span>&nbsp;<span class="op" id="3766855">!=</span>&nbsp;<span class="ident" id="3766858">nil</span>&nbsp;<span class="op" id="3766862">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766867">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766879">r</span><span class="op" id="3766880">.</span><span class="ident" id="3766881">buf</span>&nbsp;<span class="op" id="3766885">=</span>&nbsp;<span class="builtinfunc" id="3766887">append</span><span class="op" id="3766893">(</span><span class="ident" id="3766894">r</span><span class="op" id="3766895">.</span><span class="ident" id="3766896">buf</span><span class="op" id="3766899">,</span>&nbsp;<span class="string" id="3766901">&#39;&nbsp;&#39;</span><span class="op" id="3766904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3766908">r</span><span class="op" id="3766909">.</span><span class="ident" id="3766910">buf</span>&nbsp;<span class="op" id="3766914">=</span>&nbsp;<span class="builtinfunc" id="3766916">append</span><span class="op" id="3766922">(</span><span class="ident" id="3766923">r</span><span class="op" id="3766924">.</span><span class="ident" id="3766925">buf</span><span class="op" id="3766928">,</span>&nbsp;<span class="ident" id="3766930">line</span><span class="op" id="3766934">...</span><span class="op" id="3766937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3766940">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3766943">return</span>&nbsp;<span class="ident" id="3766950">r</span><span class="op" id="3766951">.</span><span class="ident" id="3766952">buf</span><span class="op" id="3766955">,</span>&nbsp;<span class="ident" id="3766957">nil</span><br>
<span class="lineno"></span><span class="op" id="3766961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3766964">//&nbsp;skipSpace&nbsp;skips&nbsp;R&nbsp;over&nbsp;all&nbsp;spaces&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="3767042">func</span>&nbsp;<span class="op" id="3767047">(</span><span class="ident" id="3767048">r</span>&nbsp;<span class="op" id="3767050">*</span><span class="ident" id="3767051">Reader</span><span class="op" id="3767057">)</span>&nbsp;<span class="ident" id="3767059">skipSpace</span><span class="op" id="3767068">(</span><span class="op" id="3767069">)</span>&nbsp;<span class="builtintype" id="3767071">int</span>&nbsp;<span class="op" id="3767075">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767078">n</span>&nbsp;<span class="op" id="3767080">:=</span>&nbsp;<span class="num" id="3767083">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767086">for</span>&nbsp;<span class="op" id="3767090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767094">c</span><span class="op" id="3767095">,</span>&nbsp;<span class="ident" id="3767097">err</span>&nbsp;<span class="op" id="3767101">:=</span>&nbsp;<span class="ident" id="3767104">r</span><span class="op" id="3767105">.</span><span class="ident" id="3767106">R</span><span class="op" id="3767107">.</span><span class="ident" id="3767108">ReadByte</span><span class="op" id="3767116">(</span><span class="op" id="3767117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767121">if</span>&nbsp;<span class="ident" id="3767124">err</span>&nbsp;<span class="op" id="3767128">!=</span>&nbsp;<span class="ident" id="3767131">nil</span>&nbsp;<span class="op" id="3767135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3767140">//&nbsp;Bufio&nbsp;will&nbsp;keep&nbsp;err&nbsp;until&nbsp;next&nbsp;read.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767183">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767195">if</span>&nbsp;<span class="ident" id="3767198">c</span>&nbsp;<span class="op" id="3767200">!=</span>&nbsp;<span class="string" id="3767203">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3767207">&amp;&amp;</span>&nbsp;<span class="ident" id="3767210">c</span>&nbsp;<span class="op" id="3767212">!=</span>&nbsp;<span class="string" id="3767215">&#39;\t&#39;</span>&nbsp;<span class="op" id="3767220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767225">r</span><span class="op" id="3767226">.</span><span class="ident" id="3767227">R</span><span class="op" id="3767228">.</span><span class="ident" id="3767229">UnreadByte</span><span class="op" id="3767239">(</span><span class="op" id="3767240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767245">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767257">n</span><span class="op" id="3767258">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767265">return</span>&nbsp;<span class="ident" id="3767272">n</span><br>
<span class="lineno"></span><span class="op" id="3767274">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="3767277">func</span>&nbsp;<span class="op" id="3767282">(</span><span class="ident" id="3767283">r</span>&nbsp;<span class="op" id="3767285">*</span><span class="ident" id="3767286">Reader</span><span class="op" id="3767292">)</span>&nbsp;<span class="ident" id="3767294">readCodeLine</span><span class="op" id="3767306">(</span><span class="ident" id="3767307">expectCode</span>&nbsp;<span class="builtintype" id="3767318">int</span><span class="op" id="3767321">)</span>&nbsp;<span class="op" id="3767323">(</span><span class="ident" id="3767324">code</span>&nbsp;<span class="builtintype" id="3767329">int</span><span class="op" id="3767332">,</span>&nbsp;<span class="ident" id="3767334">continued</span>&nbsp;<span class="builtintype" id="3767344">bool</span><span class="op" id="3767348">,</span>&nbsp;<span class="ident" id="3767350">message</span>&nbsp;<span class="builtintype" id="3767358">string</span><span class="op" id="3767364">,</span>&nbsp;<span class="ident" id="3767366">err</span>&nbsp;<span class="builtintype" id="3767370">error</span><span class="op" id="3767375">)</span>&nbsp;<span class="op" id="3767377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767380">line</span><span class="op" id="3767384">,</span>&nbsp;<span class="ident" id="3767386">err</span>&nbsp;<span class="op" id="3767390">:=</span>&nbsp;<span class="ident" id="3767393">r</span><span class="op" id="3767394">.</span><span class="ident" id="3767395">ReadLine</span><span class="op" id="3767403">(</span><span class="op" id="3767404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767407">if</span>&nbsp;<span class="ident" id="3767410">err</span>&nbsp;<span class="op" id="3767414">!=</span>&nbsp;<span class="ident" id="3767417">nil</span>&nbsp;<span class="op" id="3767421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767425">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767436">return</span>&nbsp;<span class="ident" id="3767443">parseCodeLine</span><span class="op" id="3767456">(</span><span class="ident" id="3767457">line</span><span class="op" id="3767461">,</span>&nbsp;<span class="ident" id="3767463">expectCode</span><span class="op" id="3767473">)</span><br>
<span class="lineno"></span><span class="op" id="3767475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3767478">func</span>&nbsp;<span class="ident" id="3767483">parseCodeLine</span><span class="op" id="3767496">(</span><span class="ident" id="3767497">line</span>&nbsp;<span class="builtintype" id="3767502">string</span><span class="op" id="3767508">,</span>&nbsp;<span class="ident" id="3767510">expectCode</span>&nbsp;<span class="builtintype" id="3767521">int</span><span class="op" id="3767524">)</span>&nbsp;<span class="op" id="3767526">(</span><span class="ident" id="3767527">code</span>&nbsp;<span class="builtintype" id="3767532">int</span><span class="op" id="3767535">,</span>&nbsp;<span class="ident" id="3767537">continued</span>&nbsp;<span class="builtintype" id="3767547">bool</span><span class="op" id="3767551">,</span>&nbsp;<span class="ident" id="3767553">message</span>&nbsp;<span class="builtintype" id="3767561">string</span><span class="op" id="3767567">,</span>&nbsp;<span class="ident" id="3767569">err</span>&nbsp;<span class="builtintype" id="3767573">error</span><span class="op" id="3767578">)</span>&nbsp;<span class="op" id="3767580">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767583">if</span>&nbsp;<span class="builtinfunc" id="3767586">len</span><span class="op" id="3767589">(</span><span class="ident" id="3767590">line</span><span class="op" id="3767594">)</span>&nbsp;<span class="op" id="3767596">&lt;</span>&nbsp;<span class="num" id="3767598">4</span>&nbsp;<span class="op" id="3767600">||</span>&nbsp;<span class="ident" id="3767603">line</span><span class="op" id="3767607">[</span><span class="num" id="3767608">3</span><span class="op" id="3767609">]</span>&nbsp;<span class="op" id="3767611">!=</span>&nbsp;<span class="string" id="3767614">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3767618">&amp;&amp;</span>&nbsp;<span class="ident" id="3767621">line</span><span class="op" id="3767625">[</span><span class="num" id="3767626">3</span><span class="op" id="3767627">]</span>&nbsp;<span class="op" id="3767629">!=</span>&nbsp;<span class="string" id="3767632">&#39;-&#39;</span>&nbsp;<span class="op" id="3767636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767640">err</span>&nbsp;<span class="op" id="3767644">=</span>&nbsp;<span class="ident" id="3767646">ProtocolError</span><span class="op" id="3767659">(</span><span class="string" id="3767660">&#34;short&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3767679">+</span>&nbsp;<span class="ident" id="3767681">line</span><span class="op" id="3767685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767689">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767700">continued</span>&nbsp;<span class="op" id="3767710">=</span>&nbsp;<span class="ident" id="3767712">line</span><span class="op" id="3767716">[</span><span class="num" id="3767717">3</span><span class="op" id="3767718">]</span>&nbsp;<span class="op" id="3767720">==</span>&nbsp;<span class="string" id="3767723">&#39;-&#39;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767728">code</span><span class="op" id="3767732">,</span>&nbsp;<span class="ident" id="3767734">err</span>&nbsp;<span class="op" id="3767738">=</span>&nbsp;<span class="ident" id="3767740">strconv</span><span class="op" id="3767747">.</span><span class="ident" id="3767748">Atoi</span><span class="op" id="3767752">(</span><span class="ident" id="3767753">line</span><span class="op" id="3767757">[</span><span class="num" id="3767758">0</span><span class="op" id="3767759">:</span><span class="num" id="3767760">3</span><span class="op" id="3767761">]</span><span class="op" id="3767762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767765">if</span>&nbsp;<span class="ident" id="3767768">err</span>&nbsp;<span class="op" id="3767772">!=</span>&nbsp;<span class="ident" id="3767775">nil</span>&nbsp;<span class="op" id="3767779">||</span>&nbsp;<span class="ident" id="3767782">code</span>&nbsp;<span class="op" id="3767787">&lt;</span>&nbsp;<span class="num" id="3767789">100</span>&nbsp;<span class="op" id="3767793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767797">err</span>&nbsp;<span class="op" id="3767801">=</span>&nbsp;<span class="ident" id="3767803">ProtocolError</span><span class="op" id="3767816">(</span><span class="string" id="3767817">&#34;invalid&nbsp;response&nbsp;code:&nbsp;&#34;</span>&nbsp;<span class="op" id="3767843">+</span>&nbsp;<span class="ident" id="3767845">line</span><span class="op" id="3767849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767853">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3767861">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3767864">message</span>&nbsp;<span class="op" id="3767872">=</span>&nbsp;<span class="ident" id="3767874">line</span><span class="op" id="3767878">[</span><span class="num" id="3767879">4</span><span class="op" id="3767880">:</span><span class="op" id="3767881">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3767884">if</span>&nbsp;<span class="num" id="3767887">1</span>&nbsp;<span class="op" id="3767889">&lt;=</span>&nbsp;<span class="ident" id="3767892">expectCode</span>&nbsp;<span class="op" id="3767903">&amp;&amp;</span>&nbsp;<span class="ident" id="3767906">expectCode</span>&nbsp;<span class="op" id="3767917">&lt;</span>&nbsp;<span class="num" id="3767919">10</span>&nbsp;<span class="op" id="3767922">&amp;&amp;</span>&nbsp;<span class="ident" id="3767925">code</span><span class="op" id="3767929">/</span><span class="num" id="3767930">100</span>&nbsp;<span class="op" id="3767934">!=</span>&nbsp;<span class="ident" id="3767937">expectCode</span>&nbsp;<span class="op" id="3767948">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3767953">10</span>&nbsp;<span class="op" id="3767956">&lt;=</span>&nbsp;<span class="ident" id="3767959">expectCode</span>&nbsp;<span class="op" id="3767970">&amp;&amp;</span>&nbsp;<span class="ident" id="3767973">expectCode</span>&nbsp;<span class="op" id="3767984">&lt;</span>&nbsp;<span class="num" id="3767986">100</span>&nbsp;<span class="op" id="3767990">&amp;&amp;</span>&nbsp;<span class="ident" id="3767993">code</span><span class="op" id="3767997">/</span><span class="num" id="3767998">10</span>&nbsp;<span class="op" id="3768001">!=</span>&nbsp;<span class="ident" id="3768004">expectCode</span>&nbsp;<span class="op" id="3768015">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3768020">100</span>&nbsp;<span class="op" id="3768024">&lt;=</span>&nbsp;<span class="ident" id="3768027">expectCode</span>&nbsp;<span class="op" id="3768038">&amp;&amp;</span>&nbsp;<span class="ident" id="3768041">expectCode</span>&nbsp;<span class="op" id="3768052">&lt;</span>&nbsp;<span class="num" id="3768054">1000</span>&nbsp;<span class="op" id="3768059">&amp;&amp;</span>&nbsp;<span class="ident" id="3768062">code</span>&nbsp;<span class="op" id="3768067">!=</span>&nbsp;<span class="ident" id="3768070">expectCode</span>&nbsp;<span class="op" id="3768081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768085">err</span>&nbsp;<span class="op" id="3768089">=</span>&nbsp;<span class="op" id="3768091">&amp;</span><span class="ident" id="3768092">Error</span><span class="op" id="3768097">{</span><span class="ident" id="3768098">code</span><span class="op" id="3768102">,</span>&nbsp;<span class="ident" id="3768104">message</span><span class="op" id="3768111">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3768114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768117">return</span><br>
<span class="lineno"></span><span class="op" id="3768124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3768127">//&nbsp;ReadCodeLine&nbsp;reads&nbsp;a&nbsp;response&nbsp;code&nbsp;line&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno">205</span><span class="comment" id="3768182">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3768198">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code&nbsp;and&nbsp;the&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3768257">//&nbsp;extends&nbsp;to&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;line.&nbsp;&nbsp;An&nbsp;example&nbsp;of&nbsp;such&nbsp;a&nbsp;line&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3768324">//&nbsp;&nbsp;&nbsp;&nbsp220&nbsp;plan9.bell-labs.com&nbsp;ESMTP</span><br>
<span class="lineno"></span><span class="comment" id="3768357">//</span><br>
<span class="lineno">210</span><span class="comment" id="3768360">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3768432">//&nbsp;ReadCodeLine&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3768495">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3768561">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3768606">//</span><br>
<span class="lineno">215</span><span class="comment" id="3768609">//&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;multi-line,&nbsp;ReadCodeLine&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3768674">//</span><br>
<span class="lineno"></span><span class="comment" id="3768677">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3768738">//</span><br>
<span class="lineno"></span><span class="keyword" id="3768741">func</span>&nbsp;<span class="op" id="3768746">(</span><span class="ident" id="3768747">r</span>&nbsp;<span class="op" id="3768749">*</span><span class="ident" id="3768750">Reader</span><span class="op" id="3768756">)</span>&nbsp;<span class="ident" id="3768758">ReadCodeLine</span><span class="op" id="3768770">(</span><span class="ident" id="3768771">expectCode</span>&nbsp;<span class="builtintype" id="3768782">int</span><span class="op" id="3768785">)</span>&nbsp;<span class="op" id="3768787">(</span><span class="ident" id="3768788">code</span>&nbsp;<span class="builtintype" id="3768793">int</span><span class="op" id="3768796">,</span>&nbsp;<span class="ident" id="3768798">message</span>&nbsp;<span class="builtintype" id="3768806">string</span><span class="op" id="3768812">,</span>&nbsp;<span class="ident" id="3768814">err</span>&nbsp;<span class="builtintype" id="3768818">error</span><span class="op" id="3768823">)</span>&nbsp;<span class="op" id="3768825">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768828">code</span><span class="op" id="3768832">,</span>&nbsp;<span class="ident" id="3768834">continued</span><span class="op" id="3768843">,</span>&nbsp;<span class="ident" id="3768845">message</span><span class="op" id="3768852">,</span>&nbsp;<span class="ident" id="3768854">err</span>&nbsp;<span class="op" id="3768858">:=</span>&nbsp;<span class="ident" id="3768861">r</span><span class="op" id="3768862">.</span><span class="ident" id="3768863">readCodeLine</span><span class="op" id="3768875">(</span><span class="ident" id="3768876">expectCode</span><span class="op" id="3768886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768889">if</span>&nbsp;<span class="ident" id="3768892">err</span>&nbsp;<span class="op" id="3768896">==</span>&nbsp;<span class="ident" id="3768899">nil</span>&nbsp;<span class="op" id="3768903">&amp;&amp;</span>&nbsp;<span class="ident" id="3768906">continued</span>&nbsp;<span class="op" id="3768916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3768920">err</span>&nbsp;<span class="op" id="3768924">=</span>&nbsp;<span class="ident" id="3768926">ProtocolError</span><span class="op" id="3768939">(</span><span class="string" id="3768940">&#34;unexpected&nbsp;multi-line&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3768975">+</span>&nbsp;<span class="ident" id="3768977">message</span><span class="op" id="3768984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3768987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3768990">return</span><br>
<span class="lineno">225</span><span class="op" id="3768997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3769000">//&nbsp;ReadResponse&nbsp;reads&nbsp;a&nbsp;multi-line&nbsp;response&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3769057">//</span><br>
<span class="lineno"></span><span class="comment" id="3769060">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;1</span><br>
<span class="lineno">230</span><span class="comment" id="3769083">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3769106">//&nbsp;&nbsp;&nbsp;&nbsp...</span><br>
<span class="lineno"></span><span class="comment" id="3769113">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message&nbsp;line&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3769136">//</span><br>
<span class="lineno"></span><span class="comment" id="3769139">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code.&nbsp;The&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;the</span><br>
<span class="lineno">235</span><span class="comment" id="3769214">//&nbsp;code&nbsp;and&nbsp;a&nbsp;hyphen.&nbsp;The&nbsp;response&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;line&nbsp;that&nbsp;starts</span><br>
<span class="lineno"></span><span class="comment" id="3769285">//&nbsp;with&nbsp;the&nbsp;same&nbsp;code&nbsp;followed&nbsp;by&nbsp;a&nbsp;space.&nbsp;Each&nbsp;line&nbsp;in&nbsp;message&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3769352">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;newline&nbsp;(\n).</span><br>
<span class="lineno"></span><span class="comment" id="3769384">//</span><br>
<span class="lineno"></span><span class="comment" id="3769387">//&nbsp;See&nbsp;page&nbsp;36&nbsp;of&nbsp;RFC&nbsp;959&nbsp;(http://www.ietf.org/rfc/rfc959.txt)&nbsp;for</span><br>
<span class="lineno">240</span><span class="comment" id="3769454">//&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3769466">//</span><br>
<span class="lineno"></span><span class="comment" id="3769469">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3769541">//&nbsp;ReadResponse&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3769604">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno">245</span><span class="comment" id="3769670">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3769715">//</span><br>
<span class="lineno"></span><span class="comment" id="3769718">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3769779">//</span><br>
<span class="lineno"></span><span class="keyword" id="3769782">func</span>&nbsp;<span class="op" id="3769787">(</span><span class="ident" id="3769788">r</span>&nbsp;<span class="op" id="3769790">*</span><span class="ident" id="3769791">Reader</span><span class="op" id="3769797">)</span>&nbsp;<span class="ident" id="3769799">ReadResponse</span><span class="op" id="3769811">(</span><span class="ident" id="3769812">expectCode</span>&nbsp;<span class="builtintype" id="3769823">int</span><span class="op" id="3769826">)</span>&nbsp;<span class="op" id="3769828">(</span><span class="ident" id="3769829">code</span>&nbsp;<span class="builtintype" id="3769834">int</span><span class="op" id="3769837">,</span>&nbsp;<span class="ident" id="3769839">message</span>&nbsp;<span class="builtintype" id="3769847">string</span><span class="op" id="3769853">,</span>&nbsp;<span class="ident" id="3769855">err</span>&nbsp;<span class="builtintype" id="3769859">error</span><span class="op" id="3769864">)</span>&nbsp;<span class="op" id="3769866">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769869">code</span><span class="op" id="3769873">,</span>&nbsp;<span class="ident" id="3769875">continued</span><span class="op" id="3769884">,</span>&nbsp;<span class="ident" id="3769886">message</span><span class="op" id="3769893">,</span>&nbsp;<span class="ident" id="3769895">err</span>&nbsp;<span class="op" id="3769899">:=</span>&nbsp;<span class="ident" id="3769902">r</span><span class="op" id="3769903">.</span><span class="ident" id="3769904">readCodeLine</span><span class="op" id="3769916">(</span><span class="ident" id="3769917">expectCode</span><span class="op" id="3769927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769930">for</span>&nbsp;<span class="ident" id="3769934">err</span>&nbsp;<span class="op" id="3769938">==</span>&nbsp;<span class="ident" id="3769941">nil</span>&nbsp;<span class="op" id="3769945">&amp;&amp;</span>&nbsp;<span class="ident" id="3769948">continued</span>&nbsp;<span class="op" id="3769958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3769962">line</span><span class="op" id="3769966">,</span>&nbsp;<span class="ident" id="3769968">err</span>&nbsp;<span class="op" id="3769972">:=</span>&nbsp;<span class="ident" id="3769975">r</span><span class="op" id="3769976">.</span><span class="ident" id="3769977">ReadLine</span><span class="op" id="3769985">(</span><span class="op" id="3769986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3769990">if</span>&nbsp;<span class="ident" id="3769993">err</span>&nbsp;<span class="op" id="3769997">!=</span>&nbsp;<span class="ident" id="3770000">nil</span>&nbsp;<span class="op" id="3770004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770009">return</span>&nbsp;<span class="num" id="3770016">0</span><span class="op" id="3770017">,</span>&nbsp;<span class="string" id="3770019">&#34;&#34;</span><span class="op" id="3770021">,</span>&nbsp;<span class="ident" id="3770023">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770034">var</span>&nbsp;<span class="ident" id="3770038">code2</span>&nbsp;<span class="builtintype" id="3770044">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770050">var</span>&nbsp;<span class="ident" id="3770054">moreMessage</span>&nbsp;<span class="builtintype" id="3770066">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770075">code2</span><span class="op" id="3770080">,</span>&nbsp;<span class="ident" id="3770082">continued</span><span class="op" id="3770091">,</span>&nbsp;<span class="ident" id="3770093">moreMessage</span><span class="op" id="3770104">,</span>&nbsp;<span class="ident" id="3770106">err</span>&nbsp;<span class="op" id="3770110">=</span>&nbsp;<span class="ident" id="3770112">parseCodeLine</span><span class="op" id="3770125">(</span><span class="ident" id="3770126">line</span><span class="op" id="3770130">,</span>&nbsp;<span class="ident" id="3770132">expectCode</span><span class="op" id="3770142">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770146">if</span>&nbsp;<span class="ident" id="3770149">err</span>&nbsp;<span class="op" id="3770153">!=</span>&nbsp;<span class="ident" id="3770156">nil</span>&nbsp;<span class="op" id="3770160">||</span>&nbsp;<span class="ident" id="3770163">code2</span>&nbsp;<span class="op" id="3770169">!=</span>&nbsp;<span class="ident" id="3770172">code</span>&nbsp;<span class="op" id="3770177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770182">message</span>&nbsp;<span class="op" id="3770190">+=</span>&nbsp;<span class="string" id="3770193">&#34;\n&#34;</span>&nbsp;<span class="op" id="3770198">+</span>&nbsp;<span class="ident" id="3770200">strings</span><span class="op" id="3770207">.</span><span class="ident" id="3770208">TrimRight</span><span class="op" id="3770217">(</span><span class="ident" id="3770218">line</span><span class="op" id="3770222">,</span>&nbsp;<span class="string" id="3770224">&#34;\r\n&#34;</span><span class="op" id="3770230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770235">continued</span>&nbsp;<span class="op" id="3770245">=</span>&nbsp;<span class="ident" id="3770247">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770255">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770266">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3770270">message</span>&nbsp;<span class="op" id="3770278">+=</span>&nbsp;<span class="string" id="3770281">&#34;\n&#34;</span>&nbsp;<span class="op" id="3770286">+</span>&nbsp;<span class="ident" id="3770288">moreMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3770301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3770304">return</span><br>
<span class="lineno"></span><span class="op" id="3770311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3770314">//&nbsp;DotReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;that&nbsp;satisfies&nbsp;Reads&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3770379">//&nbsp;decoded&nbsp;text&nbsp;of&nbsp;a&nbsp;dot-encoded&nbsp;block&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3770431">//&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3770488">//&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3770509">//</span><br>
<span class="lineno">275</span><span class="comment" id="3770512">//&nbsp;Dot&nbsp;encoding&nbsp;is&nbsp;a&nbsp;common&nbsp;framing&nbsp;used&nbsp;for&nbsp;data&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="3770569">//&nbsp;in&nbsp;text&nbsp;protocols&nbsp;such&nbsp;as&nbsp;SMTP.&nbsp;&nbsp;The&nbsp;data&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="3770637">//&nbsp;of&nbsp;lines,&nbsp;each&nbsp;of&nbsp;which&nbsp;ends&nbsp;in&nbsp;&#34;\r\n&#34;.&nbsp;&nbsp;The&nbsp;sequence&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="3770701">//&nbsp;ends&nbsp;at&nbsp;a&nbsp;line&nbsp;containing&nbsp;just&nbsp;a&nbsp;dot:&nbsp;&#34;.\r\n&#34;.&nbsp;&nbsp;Lines&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="3770768">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;are&nbsp;escaped&nbsp;with&nbsp;an&nbsp;additional&nbsp;dot&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">280</span><span class="comment" id="3770826">//&nbsp;looking&nbsp;like&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="3770867">//</span><br>
<span class="lineno"></span><span class="comment" id="3770870">//&nbsp;The&nbsp;decoded&nbsp;form&nbsp;returned&nbsp;by&nbsp;the&nbsp;Reader&#39;s&nbsp;Read&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="3770927">//&nbsp;rewrites&nbsp;the&nbsp;&#34;\r\n&#34;&nbsp;line&nbsp;endings&nbsp;into&nbsp;the&nbsp;simpler&nbsp;&#34;\n&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3770986">//&nbsp;removes&nbsp;leading&nbsp;dot&nbsp;escapes&nbsp;if&nbsp;present,&nbsp;and&nbsp;stops&nbsp;with&nbsp;error&nbsp;io.EOF</span><br>
<span class="lineno">285</span><span class="comment" id="3771057">//&nbsp;after&nbsp;consuming&nbsp;(and&nbsp;discarding)&nbsp;the&nbsp;end-of-sequence&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3771119">func</span>&nbsp;<span class="op" id="3771124">(</span><span class="ident" id="3771125">r</span>&nbsp;<span class="op" id="3771127">*</span><span class="ident" id="3771128">Reader</span><span class="op" id="3771134">)</span>&nbsp;<span class="ident" id="3771136">DotReader</span><span class="op" id="3771145">(</span><span class="op" id="3771146">)</span>&nbsp;<span class="ident" id="3771148">io</span><span class="op" id="3771150">.</span><span class="ident" id="3771151">Reader</span>&nbsp;<span class="op" id="3771158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771161">r</span><span class="op" id="3771162">.</span><span class="ident" id="3771163">closeDot</span><span class="op" id="3771171">(</span><span class="op" id="3771172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771175">r</span><span class="op" id="3771176">.</span><span class="ident" id="3771177">dot</span>&nbsp;<span class="op" id="3771181">=</span>&nbsp;<span class="op" id="3771183">&amp;</span><span class="ident" id="3771184">dotReader</span><span class="op" id="3771193">{</span><span class="ident" id="3771194">r</span><span class="op" id="3771195">:</span>&nbsp;<span class="ident" id="3771197">r</span><span class="op" id="3771198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771201">return</span>&nbsp;<span class="ident" id="3771208">r</span><span class="op" id="3771209">.</span><span class="ident" id="3771210">dot</span><br>
<span class="lineno">290</span><span class="op" id="3771214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3771217">type</span>&nbsp;<span class="ident" id="3771222">dotReader</span>&nbsp;<span class="keyword" id="3771232">struct</span>&nbsp;<span class="op" id="3771239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771242">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3771248">*</span><span class="ident" id="3771249">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771257">state</span>&nbsp;<span class="builtintype" id="3771263">int</span><br>
<span class="lineno">295</span><span class="op" id="3771267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3771270">//&nbsp;Read&nbsp;satisfies&nbsp;reads&nbsp;by&nbsp;decoding&nbsp;dot-encoded&nbsp;data&nbsp;read&nbsp;from&nbsp;d.r.</span><br>
<span class="lineno"></span><span class="keyword" id="3771338">func</span>&nbsp;<span class="op" id="3771343">(</span><span class="ident" id="3771344">d</span>&nbsp;<span class="op" id="3771346">*</span><span class="ident" id="3771347">dotReader</span><span class="op" id="3771356">)</span>&nbsp;<span class="ident" id="3771358">Read</span><span class="op" id="3771362">(</span><span class="ident" id="3771363">b</span>&nbsp;<span class="op" id="3771365">[</span><span class="op" id="3771366">]</span><span class="builtintype" id="3771367">byte</span><span class="op" id="3771371">)</span>&nbsp;<span class="op" id="3771373">(</span><span class="ident" id="3771374">n</span>&nbsp;<span class="builtintype" id="3771376">int</span><span class="op" id="3771379">,</span>&nbsp;<span class="ident" id="3771381">err</span>&nbsp;<span class="builtintype" id="3771385">error</span><span class="op" id="3771390">)</span>&nbsp;<span class="op" id="3771392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771395">//&nbsp;Run&nbsp;data&nbsp;through&nbsp;a&nbsp;simple&nbsp;state&nbsp;machine&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771442">//&nbsp;elide&nbsp;leading&nbsp;dots,&nbsp;rewrite&nbsp;trailing&nbsp;\r\n&nbsp;into&nbsp;\n,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3771497">//&nbsp;and&nbsp;detect&nbsp;ending&nbsp;.\r\n&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771531">const</span>&nbsp;<span class="op" id="3771537">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771541">stateBeginLine</span>&nbsp;<span class="op" id="3771556">=</span>&nbsp;<span class="ident" id="3771558">iota</span>&nbsp;<span class="comment" id="3771563">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771615">stateDot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3771637">//&nbsp;read&nbsp;.&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771670">stateDotCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3771692">//&nbsp;read&nbsp;.\r&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771727">stateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3771749">//&nbsp;read&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771788">stateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3771810">//&nbsp;reading&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771846">stateEOF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3771868">//&nbsp;reached&nbsp;.\r\n&nbsp;end&nbsp;marker&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3771902">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771905">br</span>&nbsp;<span class="op" id="3771908">:=</span>&nbsp;<span class="ident" id="3771911">d</span><span class="op" id="3771912">.</span><span class="ident" id="3771913">r</span><span class="op" id="3771914">.</span><span class="ident" id="3771915">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771918">for</span>&nbsp;<span class="ident" id="3771922">n</span>&nbsp;<span class="op" id="3771924">&lt;</span>&nbsp;<span class="builtinfunc" id="3771926">len</span><span class="op" id="3771929">(</span><span class="ident" id="3771930">b</span><span class="op" id="3771931">)</span>&nbsp;<span class="op" id="3771933">&amp;&amp;</span>&nbsp;<span class="ident" id="3771936">d</span><span class="op" id="3771937">.</span><span class="ident" id="3771938">state</span>&nbsp;<span class="op" id="3771944">!=</span>&nbsp;<span class="ident" id="3771947">stateEOF</span>&nbsp;<span class="op" id="3771956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771960">var</span>&nbsp;<span class="ident" id="3771964">c</span>&nbsp;<span class="builtintype" id="3771966">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3771973">c</span><span class="op" id="3771974">,</span>&nbsp;<span class="ident" id="3771976">err</span>&nbsp;<span class="op" id="3771980">=</span>&nbsp;<span class="ident" id="3771982">br</span><span class="op" id="3771984">.</span><span class="ident" id="3771985">ReadByte</span><span class="op" id="3771993">(</span><span class="op" id="3771994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3771998">if</span>&nbsp;<span class="ident" id="3772001">err</span>&nbsp;<span class="op" id="3772005">!=</span>&nbsp;<span class="ident" id="3772008">nil</span>&nbsp;<span class="op" id="3772012">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772017">if</span>&nbsp;<span class="ident" id="3772020">err</span>&nbsp;<span class="op" id="3772024">==</span>&nbsp;<span class="ident" id="3772027">io</span><span class="op" id="3772029">.</span><span class="ident" id="3772030">EOF</span>&nbsp;<span class="op" id="3772034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772040">err</span>&nbsp;<span class="op" id="3772044">=</span>&nbsp;<span class="ident" id="3772046">io</span><span class="op" id="3772048">.</span><span class="ident" id="3772049">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772074">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772082">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772086">switch</span>&nbsp;<span class="ident" id="3772093">d</span><span class="op" id="3772094">.</span><span class="ident" id="3772095">state</span>&nbsp;<span class="op" id="3772101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772105">case</span>&nbsp;<span class="ident" id="3772110">stateBeginLine</span><span class="op" id="3772124">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772129">if</span>&nbsp;<span class="ident" id="3772132">c</span>&nbsp;<span class="op" id="3772134">==</span>&nbsp;<span class="string" id="3772137">&#39;.&#39;</span>&nbsp;<span class="op" id="3772141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772147">d</span><span class="op" id="3772148">.</span><span class="ident" id="3772149">state</span>&nbsp;<span class="op" id="3772155">=</span>&nbsp;<span class="ident" id="3772157">stateDot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772170">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772187">if</span>&nbsp;<span class="ident" id="3772190">c</span>&nbsp;<span class="op" id="3772192">==</span>&nbsp;<span class="string" id="3772195">&#39;\r&#39;</span>&nbsp;<span class="op" id="3772200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772206">d</span><span class="op" id="3772207">.</span><span class="ident" id="3772208">state</span>&nbsp;<span class="op" id="3772214">=</span>&nbsp;<span class="ident" id="3772216">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772228">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772240">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772245">d</span><span class="op" id="3772246">.</span><span class="ident" id="3772247">state</span>&nbsp;<span class="op" id="3772253">=</span>&nbsp;<span class="ident" id="3772255">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772268">case</span>&nbsp;<span class="ident" id="3772273">stateDot</span><span class="op" id="3772281">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772286">if</span>&nbsp;<span class="ident" id="3772289">c</span>&nbsp;<span class="op" id="3772291">==</span>&nbsp;<span class="string" id="3772294">&#39;\r&#39;</span>&nbsp;<span class="op" id="3772299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772305">d</span><span class="op" id="3772306">.</span><span class="ident" id="3772307">state</span>&nbsp;<span class="op" id="3772313">=</span>&nbsp;<span class="ident" id="3772315">stateDotCR</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772330">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772347">if</span>&nbsp;<span class="ident" id="3772350">c</span>&nbsp;<span class="op" id="3772352">==</span>&nbsp;<span class="string" id="3772355">&#39;\n&#39;</span>&nbsp;<span class="op" id="3772360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772366">d</span><span class="op" id="3772367">.</span><span class="ident" id="3772368">state</span>&nbsp;<span class="op" id="3772374">=</span>&nbsp;<span class="ident" id="3772376">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772389">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772406">d</span><span class="op" id="3772407">.</span><span class="ident" id="3772408">state</span>&nbsp;<span class="op" id="3772414">=</span>&nbsp;<span class="ident" id="3772416">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772429">case</span>&nbsp;<span class="ident" id="3772434">stateDotCR</span><span class="op" id="3772444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772449">if</span>&nbsp;<span class="ident" id="3772452">c</span>&nbsp;<span class="op" id="3772454">==</span>&nbsp;<span class="string" id="3772457">&#39;\n&#39;</span>&nbsp;<span class="op" id="3772462">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772468">d</span><span class="op" id="3772469">.</span><span class="ident" id="3772470">state</span>&nbsp;<span class="op" id="3772476">=</span>&nbsp;<span class="ident" id="3772478">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772491">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772508">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;.\r\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772533">//&nbsp;Consume&nbsp;leading&nbsp;dot&nbsp;and&nbsp;emit&nbsp;saved&nbsp;\r.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772578">br</span><span class="op" id="3772580">.</span><span class="ident" id="3772581">UnreadByte</span><span class="op" id="3772591">(</span><span class="op" id="3772592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772597">c</span>&nbsp;<span class="op" id="3772599">=</span>&nbsp;<span class="string" id="3772601">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772609">d</span><span class="op" id="3772610">.</span><span class="ident" id="3772611">state</span>&nbsp;<span class="op" id="3772617">=</span>&nbsp;<span class="ident" id="3772619">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772632">case</span>&nbsp;<span class="ident" id="3772637">stateCR</span><span class="op" id="3772644">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772649">if</span>&nbsp;<span class="ident" id="3772652">c</span>&nbsp;<span class="op" id="3772654">==</span>&nbsp;<span class="string" id="3772657">&#39;\n&#39;</span>&nbsp;<span class="op" id="3772662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772668">d</span><span class="op" id="3772669">.</span><span class="ident" id="3772670">state</span>&nbsp;<span class="op" id="3772676">=</span>&nbsp;<span class="ident" id="3772678">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772697">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3772711">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;\r\n.&nbsp;&nbsp;Emit&nbsp;saved&nbsp;\r</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772750">br</span><span class="op" id="3772752">.</span><span class="ident" id="3772753">UnreadByte</span><span class="op" id="3772763">(</span><span class="op" id="3772764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772769">c</span>&nbsp;<span class="op" id="3772771">=</span>&nbsp;<span class="string" id="3772773">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772781">d</span><span class="op" id="3772782">.</span><span class="ident" id="3772783">state</span>&nbsp;<span class="op" id="3772789">=</span>&nbsp;<span class="ident" id="3772791">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772804">case</span>&nbsp;<span class="ident" id="3772809">stateData</span><span class="op" id="3772818">:</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772823">if</span>&nbsp;<span class="ident" id="3772826">c</span>&nbsp;<span class="op" id="3772828">==</span>&nbsp;<span class="string" id="3772831">&#39;\r&#39;</span>&nbsp;<span class="op" id="3772836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772842">d</span><span class="op" id="3772843">.</span><span class="ident" id="3772844">state</span>&nbsp;<span class="op" id="3772850">=</span>&nbsp;<span class="ident" id="3772852">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772864">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772881">if</span>&nbsp;<span class="ident" id="3772884">c</span>&nbsp;<span class="op" id="3772886">==</span>&nbsp;<span class="string" id="3772889">&#39;\n&#39;</span>&nbsp;<span class="op" id="3772894">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772900">d</span><span class="op" id="3772901">.</span><span class="ident" id="3772902">state</span>&nbsp;<span class="op" id="3772908">=</span>&nbsp;<span class="ident" id="3772910">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772936">b</span><span class="op" id="3772937">[</span><span class="ident" id="3772938">n</span><span class="op" id="3772939">]</span>&nbsp;<span class="op" id="3772941">=</span>&nbsp;<span class="ident" id="3772943">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772947">n</span><span class="op" id="3772948">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3772952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3772955">if</span>&nbsp;<span class="ident" id="3772958">err</span>&nbsp;<span class="op" id="3772962">==</span>&nbsp;<span class="ident" id="3772965">nil</span>&nbsp;<span class="op" id="3772969">&amp;&amp;</span>&nbsp;<span class="ident" id="3772972">d</span><span class="op" id="3772973">.</span><span class="ident" id="3772974">state</span>&nbsp;<span class="op" id="3772980">==</span>&nbsp;<span class="ident" id="3772983">stateEOF</span>&nbsp;<span class="op" id="3772992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3772996">err</span>&nbsp;<span class="op" id="3773000">=</span>&nbsp;<span class="ident" id="3773002">io</span><span class="op" id="3773004">.</span><span class="ident" id="3773005">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773013">if</span>&nbsp;<span class="ident" id="3773016">err</span>&nbsp;<span class="op" id="3773020">!=</span>&nbsp;<span class="ident" id="3773023">nil</span>&nbsp;<span class="op" id="3773027">&amp;&amp;</span>&nbsp;<span class="ident" id="3773030">d</span><span class="op" id="3773031">.</span><span class="ident" id="3773032">r</span><span class="op" id="3773033">.</span><span class="ident" id="3773034">dot</span>&nbsp;<span class="op" id="3773038">==</span>&nbsp;<span class="ident" id="3773041">d</span>&nbsp;<span class="op" id="3773043">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773047">d</span><span class="op" id="3773048">.</span><span class="ident" id="3773049">r</span><span class="op" id="3773050">.</span><span class="ident" id="3773051">dot</span>&nbsp;<span class="op" id="3773055">=</span>&nbsp;<span class="ident" id="3773057">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773065">return</span><br>
<span class="lineno"></span><span class="op" id="3773072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3773075">//&nbsp;closeDot&nbsp;drains&nbsp;the&nbsp;current&nbsp;DotReader&nbsp;if&nbsp;any,</span><br>
<span class="lineno"></span><span class="comment" id="3773124">//&nbsp;making&nbsp;sure&nbsp;that&nbsp;it&nbsp;reads&nbsp;until&nbsp;the&nbsp;ending&nbsp;dot&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3773180">func</span>&nbsp;<span class="op" id="3773185">(</span><span class="ident" id="3773186">r</span>&nbsp;<span class="op" id="3773188">*</span><span class="ident" id="3773189">Reader</span><span class="op" id="3773195">)</span>&nbsp;<span class="ident" id="3773197">closeDot</span><span class="op" id="3773205">(</span><span class="op" id="3773206">)</span>&nbsp;<span class="op" id="3773208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773211">if</span>&nbsp;<span class="ident" id="3773214">r</span><span class="op" id="3773215">.</span><span class="ident" id="3773216">dot</span>&nbsp;<span class="op" id="3773220">==</span>&nbsp;<span class="ident" id="3773223">nil</span>&nbsp;<span class="op" id="3773227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773231">return</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773242">buf</span>&nbsp;<span class="op" id="3773246">:=</span>&nbsp;<span class="builtinfunc" id="3773249">make</span><span class="op" id="3773253">(</span><span class="op" id="3773254">[</span><span class="op" id="3773255">]</span><span class="builtintype" id="3773256">byte</span><span class="op" id="3773260">,</span>&nbsp;<span class="num" id="3773262">128</span><span class="op" id="3773265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773268">for</span>&nbsp;<span class="ident" id="3773272">r</span><span class="op" id="3773273">.</span><span class="ident" id="3773274">dot</span>&nbsp;<span class="op" id="3773278">!=</span>&nbsp;<span class="ident" id="3773281">nil</span>&nbsp;<span class="op" id="3773285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773289">//&nbsp;When&nbsp;Read&nbsp;reaches&nbsp;EOF&nbsp;or&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773329">//&nbsp;it&nbsp;will&nbsp;set&nbsp;r.dot&nbsp;==&nbsp;nil.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3773360">r</span><span class="op" id="3773361">.</span><span class="ident" id="3773362">dot</span><span class="op" id="3773365">.</span><span class="ident" id="3773366">Read</span><span class="op" id="3773370">(</span><span class="ident" id="3773371">buf</span><span class="op" id="3773374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3773377">}</span><br>
<span class="lineno"></span><span class="op" id="3773379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3773382">//&nbsp;ReadDotBytes&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;the&nbsp;decoded&nbsp;data.</span><br>
<span class="lineno">400</span><span class="comment" id="3773449">//</span><br>
<span class="lineno"></span><span class="comment" id="3773452">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3773534">func</span>&nbsp;<span class="op" id="3773539">(</span><span class="ident" id="3773540">r</span>&nbsp;<span class="op" id="3773542">*</span><span class="ident" id="3773543">Reader</span><span class="op" id="3773549">)</span>&nbsp;<span class="ident" id="3773551">ReadDotBytes</span><span class="op" id="3773563">(</span><span class="op" id="3773564">)</span>&nbsp;<span class="op" id="3773566">(</span><span class="op" id="3773567">[</span><span class="op" id="3773568">]</span><span class="builtintype" id="3773569">byte</span><span class="op" id="3773573">,</span>&nbsp;<span class="builtintype" id="3773575">error</span><span class="op" id="3773580">)</span>&nbsp;<span class="op" id="3773582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3773585">return</span>&nbsp;<span class="ident" id="3773592">ioutil</span><span class="op" id="3773598">.</span><span class="ident" id="3773599">ReadAll</span><span class="op" id="3773606">(</span><span class="ident" id="3773607">r</span><span class="op" id="3773608">.</span><span class="ident" id="3773609">DotReader</span><span class="op" id="3773618">(</span><span class="op" id="3773619">)</span><span class="op" id="3773620">)</span><br>
<span class="lineno"></span><span class="op" id="3773622">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3773625">//&nbsp;ReadDotLines&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3773682">//&nbsp;containing&nbsp;the&nbsp;decoded&nbsp;lines,&nbsp;with&nbsp;the&nbsp;final&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;elided&nbsp;from&nbsp;each.</span><br>
<span class="lineno"></span><span class="comment" id="3773759">//</span><br>
<span class="lineno"></span><span class="comment" id="3773762">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno">410</span><span class="keyword" id="3773844">func</span>&nbsp;<span class="op" id="3773849">(</span><span class="ident" id="3773850">r</span>&nbsp;<span class="op" id="3773852">*</span><span class="ident" id="3773853">Reader</span><span class="op" id="3773859">)</span>&nbsp;<span class="ident" id="3773861">ReadDotLines</span><span class="op" id="3773873">(</span><span class="op" id="3773874">)</span>&nbsp;<span class="op" id="3773876">(</span><span class="op" id="3773877">[</span><span class="op" id="3773878">]</span><span class="builtintype" id="3773879">string</span><span class="op" id="3773885">,</span>&nbsp;<span class="builtintype" id="3773887">error</span><span class="op" id="3773892">)</span>&nbsp;<span class="op" id="3773894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773897">//&nbsp;We&nbsp;could&nbsp;use&nbsp;ReadDotBytes&nbsp;and&nbsp;then&nbsp;Split&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773946">//&nbsp;but&nbsp;reading&nbsp;a&nbsp;line&nbsp;at&nbsp;a&nbsp;time&nbsp;avoids&nbsp;needing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3773996">//&nbsp;large&nbsp;contiguous&nbsp;block&nbsp;of&nbsp;memory&nbsp;and&nbsp;is&nbsp;simpler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774049">var</span>&nbsp;<span class="ident" id="3774053">v</span>&nbsp;<span class="op" id="3774055">[</span><span class="op" id="3774056">]</span><span class="builtintype" id="3774057">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774065">var</span>&nbsp;<span class="ident" id="3774069">err</span>&nbsp;<span class="builtintype" id="3774073">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774080">for</span>&nbsp;<span class="op" id="3774084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774088">var</span>&nbsp;<span class="ident" id="3774092">line</span>&nbsp;<span class="builtintype" id="3774097">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774106">line</span><span class="op" id="3774110">,</span>&nbsp;<span class="ident" id="3774112">err</span>&nbsp;<span class="op" id="3774116">=</span>&nbsp;<span class="ident" id="3774118">r</span><span class="op" id="3774119">.</span><span class="ident" id="3774120">ReadLine</span><span class="op" id="3774128">(</span><span class="op" id="3774129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774133">if</span>&nbsp;<span class="ident" id="3774136">err</span>&nbsp;<span class="op" id="3774140">!=</span>&nbsp;<span class="ident" id="3774143">nil</span>&nbsp;<span class="op" id="3774147">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774152">if</span>&nbsp;<span class="ident" id="3774155">err</span>&nbsp;<span class="op" id="3774159">==</span>&nbsp;<span class="ident" id="3774162">io</span><span class="op" id="3774164">.</span><span class="ident" id="3774165">EOF</span>&nbsp;<span class="op" id="3774169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774175">err</span>&nbsp;<span class="op" id="3774179">=</span>&nbsp;<span class="ident" id="3774181">io</span><span class="op" id="3774183">.</span><span class="ident" id="3774184">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774209">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774217">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3774222">//&nbsp;Dot&nbsp;by&nbsp;itself&nbsp;marks&nbsp;end;&nbsp;otherwise&nbsp;cut&nbsp;one&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774275">if</span>&nbsp;<span class="builtinfunc" id="3774278">len</span><span class="op" id="3774281">(</span><span class="ident" id="3774282">line</span><span class="op" id="3774286">)</span>&nbsp;<span class="op" id="3774288">&gt;</span>&nbsp;<span class="num" id="3774290">0</span>&nbsp;<span class="op" id="3774292">&amp;&amp;</span>&nbsp;<span class="ident" id="3774295">line</span><span class="op" id="3774299">[</span><span class="num" id="3774300">0</span><span class="op" id="3774301">]</span>&nbsp;<span class="op" id="3774303">==</span>&nbsp;<span class="string" id="3774306">&#39;.&#39;</span>&nbsp;<span class="op" id="3774310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774315">if</span>&nbsp;<span class="builtinfunc" id="3774318">len</span><span class="op" id="3774321">(</span><span class="ident" id="3774322">line</span><span class="op" id="3774326">)</span>&nbsp;<span class="op" id="3774328">==</span>&nbsp;<span class="num" id="3774331">1</span>&nbsp;<span class="op" id="3774333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774339">break</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774353">line</span>&nbsp;<span class="op" id="3774358">=</span>&nbsp;<span class="ident" id="3774360">line</span><span class="op" id="3774364">[</span><span class="num" id="3774365">1</span><span class="op" id="3774366">:</span><span class="op" id="3774367">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3774375">v</span>&nbsp;<span class="op" id="3774377">=</span>&nbsp;<span class="builtinfunc" id="3774379">append</span><span class="op" id="3774385">(</span><span class="ident" id="3774386">v</span><span class="op" id="3774387">,</span>&nbsp;<span class="ident" id="3774389">line</span><span class="op" id="3774393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3774396">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3774399">return</span>&nbsp;<span class="ident" id="3774406">v</span><span class="op" id="3774407">,</span>&nbsp;<span class="ident" id="3774409">err</span><br>
<span class="lineno"></span><span class="op" id="3774413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3774416">//&nbsp;ReadMIMEHeader&nbsp;reads&nbsp;a&nbsp;MIME-style&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3774468">//&nbsp;The&nbsp;header&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;possibly&nbsp;continued&nbsp;Key:&nbsp;Value&nbsp;lines</span><br>
<span class="lineno">440</span><span class="comment" id="3774535">//&nbsp;ending&nbsp;in&nbsp;a&nbsp;blank&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="3774562">//&nbsp;The&nbsp;returned&nbsp;map&nbsp;m&nbsp;maps&nbsp;CanonicalMIMEHeaderKey(key)&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3774622">//&nbsp;sequence&nbsp;of&nbsp;values&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;encountered&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3774688">//</span><br>
<span class="lineno"></span><span class="comment" id="3774691">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">445</span><span class="comment" id="3774728">//</span><br>
<span class="lineno"></span><span class="comment" id="3774731">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3774750">//&nbsp;&nbsp;&nbsp;&nbspLong-Key:&nbsp;Even</span><br>
<span class="lineno"></span><span class="comment" id="3774768">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Longer&nbsp;Value</span><br>
<span class="lineno"></span><span class="comment" id="3774791">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;2</span><br>
<span class="lineno">450</span><span class="comment" id="3774810">//</span><br>
<span class="lineno"></span><span class="comment" id="3774813">//&nbsp;Given&nbsp;that&nbsp;input,&nbsp;ReadMIMEHeader&nbsp;returns&nbsp;the&nbsp;map:</span><br>
<span class="lineno"></span><span class="comment" id="3774866">//</span><br>
<span class="lineno"></span><span class="comment" id="3774869">//&nbsp;&nbsp;&nbsp;&nbspmap[string][]string{</span><br>
<span class="lineno"></span><span class="comment" id="3774893">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;My-Key&#34;:&nbsp;{&#34;Value&nbsp;1&#34;,&nbsp;&#34;Value&nbsp;2&#34;},</span><br>
<span class="lineno">455</span><span class="comment" id="3774931">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Long-Key&#34;:&nbsp;{&#34;Even&nbsp;Longer&nbsp;Value&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="3774970">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="3774975">//</span><br>
<span class="lineno"></span><span class="keyword" id="3774978">func</span>&nbsp;<span class="op" id="3774983">(</span><span class="ident" id="3774984">r</span>&nbsp;<span class="op" id="3774986">*</span><span class="ident" id="3774987">Reader</span><span class="op" id="3774993">)</span>&nbsp;<span class="ident" id="3774995">ReadMIMEHeader</span><span class="op" id="3775009">(</span><span class="op" id="3775010">)</span>&nbsp;<span class="op" id="3775012">(</span><span class="ident" id="3775013">MIMEHeader</span><span class="op" id="3775023">,</span>&nbsp;<span class="builtintype" id="3775025">error</span><span class="op" id="3775030">)</span>&nbsp;<span class="op" id="3775032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775035">//&nbsp;Avoid&nbsp;lots&nbsp;of&nbsp;small&nbsp;slice&nbsp;allocations&nbsp;later&nbsp;by&nbsp;allocating&nbsp;one</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775101">//&nbsp;large&nbsp;one&nbsp;ahead&nbsp;of&nbsp;time&nbsp;which&nbsp;we&#39;ll&nbsp;cut&nbsp;up&nbsp;into&nbsp;smaller</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775161">//&nbsp;slices.&nbsp;If&nbsp;this&nbsp;isn&#39;t&nbsp;big&nbsp;enough&nbsp;later,&nbsp;we&nbsp;allocate&nbsp;small&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775229">var</span>&nbsp;<span class="ident" id="3775233">strs</span>&nbsp;<span class="op" id="3775238">[</span><span class="op" id="3775239">]</span><span class="builtintype" id="3775240">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775248">hint</span>&nbsp;<span class="op" id="3775253">:=</span>&nbsp;<span class="ident" id="3775256">r</span><span class="op" id="3775257">.</span><span class="ident" id="3775258">upcomingHeaderNewlines</span><span class="op" id="3775280">(</span><span class="op" id="3775281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775284">if</span>&nbsp;<span class="ident" id="3775287">hint</span>&nbsp;<span class="op" id="3775292">&gt;</span>&nbsp;<span class="num" id="3775294">0</span>&nbsp;<span class="op" id="3775296">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775300">strs</span>&nbsp;<span class="op" id="3775305">=</span>&nbsp;<span class="builtinfunc" id="3775307">make</span><span class="op" id="3775311">(</span><span class="op" id="3775312">[</span><span class="op" id="3775313">]</span><span class="builtintype" id="3775314">string</span><span class="op" id="3775320">,</span>&nbsp;<span class="ident" id="3775322">hint</span><span class="op" id="3775326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775333">m</span>&nbsp;<span class="op" id="3775335">:=</span>&nbsp;<span class="builtinfunc" id="3775338">make</span><span class="op" id="3775342">(</span><span class="ident" id="3775343">MIMEHeader</span><span class="op" id="3775353">,</span>&nbsp;<span class="ident" id="3775355">hint</span><span class="op" id="3775359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775362">for</span>&nbsp;<span class="op" id="3775366">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775370">kv</span><span class="op" id="3775372">,</span>&nbsp;<span class="ident" id="3775374">err</span>&nbsp;<span class="op" id="3775378">:=</span>&nbsp;<span class="ident" id="3775381">r</span><span class="op" id="3775382">.</span><span class="ident" id="3775383">readContinuedLineSlice</span><span class="op" id="3775405">(</span><span class="op" id="3775406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775410">if</span>&nbsp;<span class="builtinfunc" id="3775413">len</span><span class="op" id="3775416">(</span><span class="ident" id="3775417">kv</span><span class="op" id="3775419">)</span>&nbsp;<span class="op" id="3775421">==</span>&nbsp;<span class="num" id="3775424">0</span>&nbsp;<span class="op" id="3775426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775431">return</span>&nbsp;<span class="ident" id="3775438">m</span><span class="op" id="3775439">,</span>&nbsp;<span class="ident" id="3775441">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775452">//&nbsp;Key&nbsp;ends&nbsp;at&nbsp;first&nbsp;colon;&nbsp;should&nbsp;not&nbsp;have&nbsp;spaces&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775509">//&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;wild,&nbsp;violating&nbsp;specs,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775562">//&nbsp;remove&nbsp;them&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775591">i</span>&nbsp;<span class="op" id="3775593">:=</span>&nbsp;<span class="ident" id="3775596">bytes</span><span class="op" id="3775601">.</span><span class="ident" id="3775602">IndexByte</span><span class="op" id="3775611">(</span><span class="ident" id="3775612">kv</span><span class="op" id="3775614">,</span>&nbsp;<span class="string" id="3775616">&#39;:&#39;</span><span class="op" id="3775619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775623">if</span>&nbsp;<span class="ident" id="3775626">i</span>&nbsp;<span class="op" id="3775628">&lt;</span>&nbsp;<span class="num" id="3775630">0</span>&nbsp;<span class="op" id="3775632">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775637">return</span>&nbsp;<span class="ident" id="3775644">m</span><span class="op" id="3775645">,</span>&nbsp;<span class="ident" id="3775647">ProtocolError</span><span class="op" id="3775660">(</span><span class="string" id="3775661">&#34;malformed&nbsp;MIME&nbsp;header&nbsp;line:&nbsp;&#34;</span>&nbsp;<span class="op" id="3775692">+</span>&nbsp;<span class="builtintype" id="3775694">string</span><span class="op" id="3775700">(</span><span class="ident" id="3775701">kv</span><span class="op" id="3775703">)</span><span class="op" id="3775704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775712">endKey</span>&nbsp;<span class="op" id="3775719">:=</span>&nbsp;<span class="ident" id="3775722">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775726">for</span>&nbsp;<span class="ident" id="3775730">endKey</span>&nbsp;<span class="op" id="3775737">&gt;</span>&nbsp;<span class="num" id="3775739">0</span>&nbsp;<span class="op" id="3775741">&amp;&amp;</span>&nbsp;<span class="ident" id="3775744">kv</span><span class="op" id="3775746">[</span><span class="ident" id="3775747">endKey</span><span class="op" id="3775753">-</span><span class="num" id="3775754">1</span><span class="op" id="3775755">]</span>&nbsp;<span class="op" id="3775757">==</span>&nbsp;<span class="string" id="3775760">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3775764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775769">endKey</span><span class="op" id="3775775">--</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775784">key</span>&nbsp;<span class="op" id="3775788">:=</span>&nbsp;<span class="ident" id="3775791">canonicalMIMEHeaderKey</span><span class="op" id="3775813">(</span><span class="ident" id="3775814">kv</span><span class="op" id="3775816">[</span><span class="op" id="3775817">:</span><span class="ident" id="3775818">endKey</span><span class="op" id="3775824">]</span><span class="op" id="3775825">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3775830">//&nbsp;Skip&nbsp;initial&nbsp;spaces&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775865">i</span><span class="op" id="3775866">++</span>&nbsp;<span class="comment" id="3775869">//&nbsp;skip&nbsp;colon</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775885">for</span>&nbsp;<span class="ident" id="3775889">i</span>&nbsp;<span class="op" id="3775891">&lt;</span>&nbsp;<span class="builtinfunc" id="3775893">len</span><span class="op" id="3775896">(</span><span class="ident" id="3775897">kv</span><span class="op" id="3775899">)</span>&nbsp;<span class="op" id="3775901">&amp;&amp;</span>&nbsp;<span class="op" id="3775904">(</span><span class="ident" id="3775905">kv</span><span class="op" id="3775907">[</span><span class="ident" id="3775908">i</span><span class="op" id="3775909">]</span>&nbsp;<span class="op" id="3775911">==</span>&nbsp;<span class="string" id="3775914">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3775918">||</span>&nbsp;<span class="ident" id="3775921">kv</span><span class="op" id="3775923">[</span><span class="ident" id="3775924">i</span><span class="op" id="3775925">]</span>&nbsp;<span class="op" id="3775927">==</span>&nbsp;<span class="string" id="3775930">&#39;\t&#39;</span><span class="op" id="3775934">)</span>&nbsp;<span class="op" id="3775936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775941">i</span><span class="op" id="3775942">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3775947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775951">value</span>&nbsp;<span class="op" id="3775957">:=</span>&nbsp;<span class="builtintype" id="3775960">string</span><span class="op" id="3775966">(</span><span class="ident" id="3775967">kv</span><span class="op" id="3775969">[</span><span class="ident" id="3775970">i</span><span class="op" id="3775971">:</span><span class="op" id="3775972">]</span><span class="op" id="3775973">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3775978">vv</span>&nbsp;<span class="op" id="3775981">:=</span>&nbsp;<span class="ident" id="3775984">m</span><span class="op" id="3775985">[</span><span class="ident" id="3775986">key</span><span class="op" id="3775989">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3775993">if</span>&nbsp;<span class="ident" id="3775996">vv</span>&nbsp;<span class="op" id="3775999">==</span>&nbsp;<span class="ident" id="3776002">nil</span>&nbsp;<span class="op" id="3776006">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3776009">len</span><span class="op" id="3776012">(</span><span class="ident" id="3776013">strs</span><span class="op" id="3776017">)</span>&nbsp;<span class="op" id="3776019">&gt;</span>&nbsp;<span class="num" id="3776021">0</span>&nbsp;<span class="op" id="3776023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776028">//&nbsp;More&nbsp;than&nbsp;likely&nbsp;this&nbsp;will&nbsp;be&nbsp;a&nbsp;single-element&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776086">//&nbsp;Most&nbsp;headers&nbsp;aren&#39;t&nbsp;multi-valued.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776126">//&nbsp;Set&nbsp;the&nbsp;capacity&nbsp;on&nbsp;strs[0]&nbsp;to&nbsp;1,&nbsp;so&nbsp;any&nbsp;future&nbsp;append</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776187">//&nbsp;won&#39;t&nbsp;extend&nbsp;the&nbsp;slice&nbsp;into&nbsp;the&nbsp;other&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776240">vv</span><span class="op" id="3776242">,</span>&nbsp;<span class="ident" id="3776244">strs</span>&nbsp;<span class="op" id="3776249">=</span>&nbsp;<span class="ident" id="3776251">strs</span><span class="op" id="3776255">[</span><span class="op" id="3776256">:</span><span class="num" id="3776257">1</span><span class="op" id="3776258">:</span><span class="num" id="3776259">1</span><span class="op" id="3776260">]</span><span class="op" id="3776261">,</span>&nbsp;<span class="ident" id="3776263">strs</span><span class="op" id="3776267">[</span><span class="num" id="3776268">1</span><span class="op" id="3776269">:</span><span class="op" id="3776270">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776275">vv</span><span class="op" id="3776277">[</span><span class="num" id="3776278">0</span><span class="op" id="3776279">]</span>&nbsp;<span class="op" id="3776281">=</span>&nbsp;<span class="ident" id="3776283">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776292">m</span><span class="op" id="3776293">[</span><span class="ident" id="3776294">key</span><span class="op" id="3776297">]</span>&nbsp;<span class="op" id="3776299">=</span>&nbsp;<span class="ident" id="3776301">vv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776306">}</span>&nbsp;<span class="keyword" id="3776308">else</span>&nbsp;<span class="op" id="3776313">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776318">m</span><span class="op" id="3776319">[</span><span class="ident" id="3776320">key</span><span class="op" id="3776323">]</span>&nbsp;<span class="op" id="3776325">=</span>&nbsp;<span class="builtinfunc" id="3776327">append</span><span class="op" id="3776333">(</span><span class="ident" id="3776334">vv</span><span class="op" id="3776336">,</span>&nbsp;<span class="ident" id="3776338">value</span><span class="op" id="3776343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776352">if</span>&nbsp;<span class="ident" id="3776355">err</span>&nbsp;<span class="op" id="3776359">!=</span>&nbsp;<span class="ident" id="3776362">nil</span>&nbsp;<span class="op" id="3776366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776371">return</span>&nbsp;<span class="ident" id="3776378">m</span><span class="op" id="3776379">,</span>&nbsp;<span class="ident" id="3776381">err</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776390">}</span><br>
<span class="lineno"></span><span class="op" id="3776392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3776395">//&nbsp;upcomingHeaderNewlines&nbsp;returns&nbsp;an&nbsp;approximation&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;newlines</span><br>
<span class="lineno">515</span><span class="comment" id="3776472">//&nbsp;that&nbsp;will&nbsp;be&nbsp;in&nbsp;this&nbsp;header.&nbsp;If&nbsp;it&nbsp;gets&nbsp;confused,&nbsp;it&nbsp;returns&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3776539">func</span>&nbsp;<span class="op" id="3776544">(</span><span class="ident" id="3776545">r</span>&nbsp;<span class="op" id="3776547">*</span><span class="ident" id="3776548">Reader</span><span class="op" id="3776554">)</span>&nbsp;<span class="ident" id="3776556">upcomingHeaderNewlines</span><span class="op" id="3776578">(</span><span class="op" id="3776579">)</span>&nbsp;<span class="op" id="3776581">(</span><span class="ident" id="3776582">n</span>&nbsp;<span class="builtintype" id="3776584">int</span><span class="op" id="3776587">)</span>&nbsp;<span class="op" id="3776589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776592">//&nbsp;Try&nbsp;to&nbsp;determine&nbsp;the&nbsp;&#39;hint&#39;&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776630">r</span><span class="op" id="3776631">.</span><span class="ident" id="3776632">R</span><span class="op" id="3776633">.</span><span class="ident" id="3776634">Peek</span><span class="op" id="3776638">(</span><span class="num" id="3776639">1</span><span class="op" id="3776640">)</span>&nbsp;<span class="comment" id="3776642">//&nbsp;force&nbsp;a&nbsp;buffer&nbsp;load&nbsp;if&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776675">s</span>&nbsp;<span class="op" id="3776677">:=</span>&nbsp;<span class="ident" id="3776680">r</span><span class="op" id="3776681">.</span><span class="ident" id="3776682">R</span><span class="op" id="3776683">.</span><span class="ident" id="3776684">Buffered</span><span class="op" id="3776692">(</span><span class="op" id="3776693">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776696">if</span>&nbsp;<span class="ident" id="3776699">s</span>&nbsp;<span class="op" id="3776701">==</span>&nbsp;<span class="num" id="3776704">0</span>&nbsp;<span class="op" id="3776706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776710">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776721">peek</span><span class="op" id="3776725">,</span>&nbsp;<span class="ident" id="3776727">_</span>&nbsp;<span class="op" id="3776729">:=</span>&nbsp;<span class="ident" id="3776732">r</span><span class="op" id="3776733">.</span><span class="ident" id="3776734">R</span><span class="op" id="3776735">.</span><span class="ident" id="3776736">Peek</span><span class="op" id="3776740">(</span><span class="ident" id="3776741">s</span><span class="op" id="3776742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776745">for</span>&nbsp;<span class="builtinfunc" id="3776749">len</span><span class="op" id="3776752">(</span><span class="ident" id="3776753">peek</span><span class="op" id="3776757">)</span>&nbsp;<span class="op" id="3776759">&gt;</span>&nbsp;<span class="num" id="3776761">0</span>&nbsp;<span class="op" id="3776763">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776767">i</span>&nbsp;<span class="op" id="3776769">:=</span>&nbsp;<span class="ident" id="3776772">bytes</span><span class="op" id="3776777">.</span><span class="ident" id="3776778">IndexByte</span><span class="op" id="3776787">(</span><span class="ident" id="3776788">peek</span><span class="op" id="3776792">,</span>&nbsp;<span class="string" id="3776794">&#39;\n&#39;</span><span class="op" id="3776798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776802">if</span>&nbsp;<span class="ident" id="3776805">i</span>&nbsp;<span class="op" id="3776807">&lt;</span>&nbsp;<span class="num" id="3776809">3</span>&nbsp;<span class="op" id="3776811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776816">//&nbsp;Not&nbsp;present&nbsp;(-1)&nbsp;or&nbsp;found&nbsp;within&nbsp;the&nbsp;next&nbsp;few&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3776875">//&nbsp;implying&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;(&#34;\r\n\r\n&#34;&nbsp;or&nbsp;&#34;\n\n&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776930">return</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776943">n</span><span class="op" id="3776944">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776949">peek</span>&nbsp;<span class="op" id="3776954">=</span>&nbsp;<span class="ident" id="3776956">peek</span><span class="op" id="3776960">[</span><span class="ident" id="3776961">i</span><span class="op" id="3776962">+</span><span class="num" id="3776963">1</span><span class="op" id="3776964">:</span><span class="op" id="3776965">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776971">return</span><br>
<span class="lineno">535</span><span class="op" id="3776978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3776981">//&nbsp;CanonicalMIMEHeaderKey&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;format&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3777043">//&nbsp;MIME&nbsp;header&nbsp;key&nbsp;s.&nbsp;&nbsp;The&nbsp;canonicalization&nbsp;converts&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="3777106">//&nbsp;letter&nbsp;and&nbsp;any&nbsp;letter&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;to&nbsp;upper&nbsp;case;</span><br>
<span class="lineno">540</span><span class="comment" id="3777165">//&nbsp;the&nbsp;rest&nbsp;are&nbsp;converted&nbsp;to&nbsp;lowercase.&nbsp;&nbsp;For&nbsp;example,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3777223">//&nbsp;canonical&nbsp;key&nbsp;for&nbsp;&#34;accept-encoding&#34;&nbsp;is&nbsp;&#34;Accept-Encoding&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3777284">//&nbsp;MIME&nbsp;header&nbsp;keys&nbsp;are&nbsp;assumed&nbsp;to&nbsp;be&nbsp;ASCII&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="3777334">func</span>&nbsp;<span class="ident" id="3777339">CanonicalMIMEHeaderKey</span><span class="op" id="3777361">(</span><span class="ident" id="3777362">s</span>&nbsp;<span class="builtintype" id="3777364">string</span><span class="op" id="3777370">)</span>&nbsp;<span class="builtintype" id="3777372">string</span>&nbsp;<span class="op" id="3777379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777382">//&nbsp;Quick&nbsp;check&nbsp;for&nbsp;canonical&nbsp;encoding.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777422">upper</span>&nbsp;<span class="op" id="3777428">:=</span>&nbsp;<span class="ident" id="3777431">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777437">for</span>&nbsp;<span class="ident" id="3777441">i</span>&nbsp;<span class="op" id="3777443">:=</span>&nbsp;<span class="num" id="3777446">0</span><span class="op" id="3777447">;</span>&nbsp;<span class="ident" id="3777449">i</span>&nbsp;<span class="op" id="3777451">&lt;</span>&nbsp;<span class="builtinfunc" id="3777453">len</span><span class="op" id="3777456">(</span><span class="ident" id="3777457">s</span><span class="op" id="3777458">)</span><span class="op" id="3777459">;</span>&nbsp;<span class="ident" id="3777461">i</span><span class="op" id="3777462">++</span>&nbsp;<span class="op" id="3777465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777469">c</span>&nbsp;<span class="op" id="3777471">:=</span>&nbsp;<span class="ident" id="3777474">s</span><span class="op" id="3777475">[</span><span class="ident" id="3777476">i</span><span class="op" id="3777477">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777481">if</span>&nbsp;<span class="ident" id="3777484">upper</span>&nbsp;<span class="op" id="3777490">&amp;&amp;</span>&nbsp;<span class="string" id="3777493">&#39;a&#39;</span>&nbsp;<span class="op" id="3777497">&lt;=</span>&nbsp;<span class="ident" id="3777500">c</span>&nbsp;<span class="op" id="3777502">&amp;&amp;</span>&nbsp;<span class="ident" id="3777505">c</span>&nbsp;<span class="op" id="3777507">&lt;=</span>&nbsp;<span class="string" id="3777510">&#39;z&#39;</span>&nbsp;<span class="op" id="3777514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777519">return</span>&nbsp;<span class="ident" id="3777526">canonicalMIMEHeaderKey</span><span class="op" id="3777548">(</span><span class="op" id="3777549">[</span><span class="op" id="3777550">]</span><span class="builtintype" id="3777551">byte</span><span class="op" id="3777555">(</span><span class="ident" id="3777556">s</span><span class="op" id="3777557">)</span><span class="op" id="3777558">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777566">if</span>&nbsp;<span class="op" id="3777569">!</span><span class="ident" id="3777570">upper</span>&nbsp;<span class="op" id="3777576">&amp;&amp;</span>&nbsp;<span class="string" id="3777579">&#39;A&#39;</span>&nbsp;<span class="op" id="3777583">&lt;=</span>&nbsp;<span class="ident" id="3777586">c</span>&nbsp;<span class="op" id="3777588">&amp;&amp;</span>&nbsp;<span class="ident" id="3777591">c</span>&nbsp;<span class="op" id="3777593">&lt;=</span>&nbsp;<span class="string" id="3777596">&#39;Z&#39;</span>&nbsp;<span class="op" id="3777600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777605">return</span>&nbsp;<span class="ident" id="3777612">canonicalMIMEHeaderKey</span><span class="op" id="3777634">(</span><span class="op" id="3777635">[</span><span class="op" id="3777636">]</span><span class="builtintype" id="3777637">byte</span><span class="op" id="3777641">(</span><span class="ident" id="3777642">s</span><span class="op" id="3777643">)</span><span class="op" id="3777644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777652">upper</span>&nbsp;<span class="op" id="3777658">=</span>&nbsp;<span class="ident" id="3777660">c</span>&nbsp;<span class="op" id="3777662">==</span>&nbsp;<span class="string" id="3777665">&#39;-&#39;</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777673">return</span>&nbsp;<span class="ident" id="3777680">s</span><br>
<span class="lineno"></span><span class="op" id="3777682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3777685">const</span>&nbsp;<span class="ident" id="3777691">toLower</span>&nbsp;<span class="op" id="3777699">=</span>&nbsp;<span class="string" id="3777701">&#39;a&#39;</span>&nbsp;<span class="op" id="3777705">-</span>&nbsp;<span class="string" id="3777707">&#39;A&#39;</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span><span class="comment" id="3777712">//&nbsp;canonicalMIMEHeaderKey&nbsp;is&nbsp;like&nbsp;CanonicalMIMEHeaderKey&nbsp;but&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3777776">//&nbsp;allowed&nbsp;to&nbsp;mutate&nbsp;the&nbsp;provided&nbsp;byte&nbsp;slice&nbsp;before&nbsp;returning&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3777842">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3777853">func</span>&nbsp;<span class="ident" id="3777858">canonicalMIMEHeaderKey</span><span class="op" id="3777880">(</span><span class="ident" id="3777881">a</span>&nbsp;<span class="op" id="3777883">[</span><span class="op" id="3777884">]</span><span class="builtintype" id="3777885">byte</span><span class="op" id="3777889">)</span>&nbsp;<span class="builtintype" id="3777891">string</span>&nbsp;<span class="op" id="3777898">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777901">upper</span>&nbsp;<span class="op" id="3777907">:=</span>&nbsp;<span class="ident" id="3777910">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777916">for</span>&nbsp;<span class="ident" id="3777920">i</span><span class="op" id="3777921">,</span>&nbsp;<span class="ident" id="3777923">c</span>&nbsp;<span class="op" id="3777925">:=</span>&nbsp;<span class="keyword" id="3777928">range</span>&nbsp;<span class="ident" id="3777934">a</span>&nbsp;<span class="op" id="3777936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777940">//&nbsp;Canonicalize:&nbsp;first&nbsp;letter&nbsp;upper&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777983">//&nbsp;and&nbsp;upper&nbsp;case&nbsp;after&nbsp;each&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778020">//&nbsp;(Host,&nbsp;User-Agent,&nbsp;If-Modified-Since).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778064">//&nbsp;MIME&nbsp;headers&nbsp;are&nbsp;ASCII&nbsp;only,&nbsp;so&nbsp;no&nbsp;Unicode&nbsp;issues.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778120">if</span>&nbsp;<span class="ident" id="3778123">c</span>&nbsp;<span class="op" id="3778125">==</span>&nbsp;<span class="string" id="3778128">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3778132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778137">c</span>&nbsp;<span class="op" id="3778139">=</span>&nbsp;<span class="string" id="3778141">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778147">}</span>&nbsp;<span class="keyword" id="3778149">else</span>&nbsp;<span class="keyword" id="3778154">if</span>&nbsp;<span class="ident" id="3778157">upper</span>&nbsp;<span class="op" id="3778163">&amp;&amp;</span>&nbsp;<span class="string" id="3778166">&#39;a&#39;</span>&nbsp;<span class="op" id="3778170">&lt;=</span>&nbsp;<span class="ident" id="3778173">c</span>&nbsp;<span class="op" id="3778175">&amp;&amp;</span>&nbsp;<span class="ident" id="3778178">c</span>&nbsp;<span class="op" id="3778180">&lt;=</span>&nbsp;<span class="string" id="3778183">&#39;z&#39;</span>&nbsp;<span class="op" id="3778187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778192">c</span>&nbsp;<span class="op" id="3778194">-=</span>&nbsp;<span class="ident" id="3778197">toLower</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778207">}</span>&nbsp;<span class="keyword" id="3778209">else</span>&nbsp;<span class="keyword" id="3778214">if</span>&nbsp;<span class="op" id="3778217">!</span><span class="ident" id="3778218">upper</span>&nbsp;<span class="op" id="3778224">&amp;&amp;</span>&nbsp;<span class="string" id="3778227">&#39;A&#39;</span>&nbsp;<span class="op" id="3778231">&lt;=</span>&nbsp;<span class="ident" id="3778234">c</span>&nbsp;<span class="op" id="3778236">&amp;&amp;</span>&nbsp;<span class="ident" id="3778239">c</span>&nbsp;<span class="op" id="3778241">&lt;=</span>&nbsp;<span class="string" id="3778244">&#39;Z&#39;</span>&nbsp;<span class="op" id="3778248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778253">c</span>&nbsp;<span class="op" id="3778255">+=</span>&nbsp;<span class="ident" id="3778258">toLower</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778272">a</span><span class="op" id="3778273">[</span><span class="ident" id="3778274">i</span><span class="op" id="3778275">]</span>&nbsp;<span class="op" id="3778277">=</span>&nbsp;<span class="ident" id="3778279">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778283">upper</span>&nbsp;<span class="op" id="3778289">=</span>&nbsp;<span class="ident" id="3778291">c</span>&nbsp;<span class="op" id="3778293">==</span>&nbsp;<span class="string" id="3778296">&#39;-&#39;</span>&nbsp;<span class="comment" id="3778300">//&nbsp;for&nbsp;next&nbsp;time</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778321">//&nbsp;The&nbsp;compiler&nbsp;recognizes&nbsp;m[string(byteSlice)]&nbsp;as&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778383">//&nbsp;case,&nbsp;so&nbsp;a&nbsp;copy&nbsp;of&nbsp;a&#39;s&nbsp;bytes&nbsp;into&nbsp;a&nbsp;new&nbsp;string&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778443">//&nbsp;happen&nbsp;in&nbsp;this&nbsp;map&nbsp;lookup:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778474">if</span>&nbsp;<span class="ident" id="3778477">v</span>&nbsp;<span class="op" id="3778479">:=</span>&nbsp;<span class="ident" id="3778482">commonHeader</span><span class="op" id="3778494">[</span><span class="builtintype" id="3778495">string</span><span class="op" id="3778501">(</span><span class="ident" id="3778502">a</span><span class="op" id="3778503">)</span><span class="op" id="3778504">]</span><span class="op" id="3778505">;</span>&nbsp;<span class="ident" id="3778507">v</span>&nbsp;<span class="op" id="3778509">!=</span>&nbsp;<span class="string" id="3778512">&#34;&#34;</span>&nbsp;<span class="op" id="3778515">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778519">return</span>&nbsp;<span class="ident" id="3778526">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778532">return</span>&nbsp;<span class="builtintype" id="3778539">string</span><span class="op" id="3778545">(</span><span class="ident" id="3778546">a</span><span class="op" id="3778547">)</span><br>
<span class="lineno"></span><span class="op" id="3778549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="3778552">//&nbsp;commonHeader&nbsp;interns&nbsp;common&nbsp;header&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="3778599">var</span>&nbsp;<span class="ident" id="3778603">commonHeader</span>&nbsp;<span class="op" id="3778616">=</span>&nbsp;<span class="builtinfunc" id="3778618">make</span><span class="op" id="3778622">(</span><span class="keyword" id="3778623">map</span><span class="op" id="3778626">[</span><span class="builtintype" id="3778627">string</span><span class="op" id="3778633">]</span><span class="builtintype" id="3778634">string</span><span class="op" id="3778640">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3778643">func</span>&nbsp;<span class="ident" id="3778648">init</span><span class="op" id="3778652">(</span><span class="op" id="3778653">)</span>&nbsp;<span class="op" id="3778655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778658">for</span>&nbsp;<span class="ident" id="3778662">_</span><span class="op" id="3778663">,</span>&nbsp;<span class="ident" id="3778665">v</span>&nbsp;<span class="op" id="3778667">:=</span>&nbsp;<span class="keyword" id="3778670">range</span>&nbsp;<span class="op" id="3778676">[</span><span class="op" id="3778677">]</span><span class="builtintype" id="3778678">string</span><span class="op" id="3778684">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778688">&#34;Accept&#34;</span><span class="op" id="3778696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778700">&#34;Accept-Charset&#34;</span><span class="op" id="3778716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778720">&#34;Accept-Encoding&#34;</span><span class="op" id="3778737">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778741">&#34;Accept-Language&#34;</span><span class="op" id="3778758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778762">&#34;Accept-Ranges&#34;</span><span class="op" id="3778777">,</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778781">&#34;Cache-Control&#34;</span><span class="op" id="3778796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778800">&#34;Cc&#34;</span><span class="op" id="3778804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778808">&#34;Connection&#34;</span><span class="op" id="3778820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778824">&#34;Content-Id&#34;</span><span class="op" id="3778836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778840">&#34;Content-Language&#34;</span><span class="op" id="3778858">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778862">&#34;Content-Length&#34;</span><span class="op" id="3778878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778882">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="3778909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778913">&#34;Content-Type&#34;</span><span class="op" id="3778927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778931">&#34;Cookie&#34;</span><span class="op" id="3778939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778943">&#34;Date&#34;</span><span class="op" id="3778949">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778953">&#34;Dkim-Signature&#34;</span><span class="op" id="3778969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778973">&#34;Etag&#34;</span><span class="op" id="3778979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778983">&#34;Expires&#34;</span><span class="op" id="3778992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3778996">&#34;From&#34;</span><span class="op" id="3779002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779006">&#34;Host&#34;</span><span class="op" id="3779012">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779016">&#34;If-Modified-Since&#34;</span><span class="op" id="3779035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779039">&#34;If-None-Match&#34;</span><span class="op" id="3779054">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779058">&#34;In-Reply-To&#34;</span><span class="op" id="3779071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779075">&#34;Last-Modified&#34;</span><span class="op" id="3779090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779094">&#34;Location&#34;</span><span class="op" id="3779104">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779108">&#34;Message-Id&#34;</span><span class="op" id="3779120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779124">&#34;Mime-Version&#34;</span><span class="op" id="3779138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779142">&#34;Pragma&#34;</span><span class="op" id="3779150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779154">&#34;Received&#34;</span><span class="op" id="3779164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779168">&#34;Return-Path&#34;</span><span class="op" id="3779181">,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779185">&#34;Server&#34;</span><span class="op" id="3779193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779197">&#34;Set-Cookie&#34;</span><span class="op" id="3779209">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779213">&#34;Subject&#34;</span><span class="op" id="3779222">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779226">&#34;To&#34;</span><span class="op" id="3779230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779234">&#34;User-Agent&#34;</span><span class="op" id="3779246">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779250">&#34;Via&#34;</span><span class="op" id="3779255">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779259">&#34;X-Forwarded-For&#34;</span><span class="op" id="3779276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779280">&#34;X-Imforwards&#34;</span><span class="op" id="3779294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3779298">&#34;X-Powered-By&#34;</span><span class="op" id="3779312">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779315">}</span>&nbsp;<span class="op" id="3779317">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779321">commonHeader</span><span class="op" id="3779333">[</span><span class="ident" id="3779334">v</span><span class="op" id="3779335">]</span>&nbsp;<span class="op" id="3779337">=</span>&nbsp;<span class="ident" id="3779339">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779342">}</span><br>
<span class="lineno"></span><span class="op" id="3779344">}</span>
</div>
</body>
</html>
