<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4230698">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4230753">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4230807">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4230858">package</span>&nbsp;<span class="ident" id="4230866">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4230871">import</span>&nbsp;<span class="op" id="4230878">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4230881">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4230890">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4230909">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4230919">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4230927">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4230941">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4230946">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4230949">//&nbsp;TODO(adg):&nbsp;support&nbsp;zip&nbsp;file&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="4230989">//&nbsp;TODO(adg):&nbsp;support&nbsp;specifying&nbsp;deflate&nbsp;level</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4231037">//&nbsp;Writer&nbsp;implements&nbsp;a&nbsp;zip&nbsp;file&nbsp;writer.</span><br>
<span class="lineno">20</span><span class="keyword" id="4231077">type</span>&nbsp;<span class="ident" id="4231082">Writer</span>&nbsp;<span class="keyword" id="4231089">struct</span>&nbsp;<span class="op" id="4231096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231099">cw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4231106">*</span><span class="ident" id="4231107">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231120">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4231127">[</span><span class="op" id="4231128">]</span><span class="op" id="4231129">*</span><span class="ident" id="4231130">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231138">last</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4231145">*</span><span class="ident" id="4231146">fileWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231158">closed</span>&nbsp;<span class="builtintype" id="4231165">bool</span><br>
<span class="lineno">25</span><span class="op" id="4231170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4231173">type</span>&nbsp;<span class="ident" id="4231178">header</span>&nbsp;<span class="keyword" id="4231185">struct</span>&nbsp;<span class="op" id="4231192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4231195">*</span><span class="ident" id="4231196">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231208">offset</span>&nbsp;<span class="ident" id="4231215">uint64</span><br>
<span class="lineno">30</span><span class="op" id="4231222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4231225">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;a&nbsp;zip&nbsp;file&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4231284">func</span>&nbsp;<span class="ident" id="4231289">NewWriter</span><span class="op" id="4231298">(</span><span class="ident" id="4231299">w</span>&nbsp;<span class="ident" id="4231301">io</span><span class="op" id="4231303">.</span><span class="ident" id="4231304">Writer</span><span class="op" id="4231310">)</span>&nbsp;<span class="op" id="4231312">*</span><span class="ident" id="4231313">Writer</span>&nbsp;<span class="op" id="4231320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231323">return</span>&nbsp;<span class="op" id="4231330">&amp;</span><span class="ident" id="4231331">Writer</span><span class="op" id="4231337">{</span><span class="ident" id="4231338">cw</span><span class="op" id="4231340">:</span>&nbsp;<span class="op" id="4231342">&amp;</span><span class="ident" id="4231343">countWriter</span><span class="op" id="4231354">{</span><span class="ident" id="4231355">w</span><span class="op" id="4231356">:</span>&nbsp;<span class="ident" id="4231358">bufio</span><span class="op" id="4231363">.</span><span class="ident" id="4231364">NewWriter</span><span class="op" id="4231373">(</span><span class="ident" id="4231374">w</span><span class="op" id="4231375">)</span><span class="op" id="4231376">}</span><span class="op" id="4231377">}</span><br>
<span class="lineno">35</span><span class="op" id="4231379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4231382">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="4231443">//&nbsp;Calling&nbsp;Flush&nbsp;is&nbsp;not&nbsp;normally&nbsp;necessary;&nbsp;calling&nbsp;Close&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="keyword" id="4231516">func</span>&nbsp;<span class="op" id="4231521">(</span><span class="ident" id="4231522">w</span>&nbsp;<span class="op" id="4231524">*</span><span class="ident" id="4231525">Writer</span><span class="op" id="4231531">)</span>&nbsp;<span class="ident" id="4231533">Flush</span><span class="op" id="4231538">(</span><span class="op" id="4231539">)</span>&nbsp;<span class="builtintype" id="4231541">error</span>&nbsp;<span class="op" id="4231547">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231550">return</span>&nbsp;<span class="ident" id="4231557">w</span><span class="op" id="4231558">.</span><span class="ident" id="4231559">cw</span><span class="op" id="4231561">.</span><span class="ident" id="4231562">w</span><span class="op" id="4231563">.</span><span class="op" id="4231564">(</span><span class="op" id="4231565">*</span><span class="ident" id="4231566">bufio</span><span class="op" id="4231571">.</span><span class="ident" id="4231572">Writer</span><span class="op" id="4231578">)</span><span class="op" id="4231579">.</span><span class="ident" id="4231580">Flush</span><span class="op" id="4231585">(</span><span class="op" id="4231586">)</span><br>
<span class="lineno"></span><span class="op" id="4231588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4231591">//&nbsp;Close&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;zip&nbsp;file&nbsp;by&nbsp;writing&nbsp;the&nbsp;central&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="4231664">//&nbsp;It&nbsp;does&nbsp;not&nbsp;(and&nbsp;can&nbsp;not)&nbsp;close&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">45</span><span class="keyword" id="4231722">func</span>&nbsp;<span class="op" id="4231727">(</span><span class="ident" id="4231728">w</span>&nbsp;<span class="op" id="4231730">*</span><span class="ident" id="4231731">Writer</span><span class="op" id="4231737">)</span>&nbsp;<span class="ident" id="4231739">Close</span><span class="op" id="4231744">(</span><span class="op" id="4231745">)</span>&nbsp;<span class="builtintype" id="4231747">error</span>&nbsp;<span class="op" id="4231753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231756">if</span>&nbsp;<span class="ident" id="4231759">w</span><span class="op" id="4231760">.</span><span class="ident" id="4231761">last</span>&nbsp;<span class="op" id="4231766">!=</span>&nbsp;<span class="ident" id="4231769">nil</span>&nbsp;<span class="op" id="4231773">&amp;&amp;</span>&nbsp;<span class="op" id="4231776">!</span><span class="ident" id="4231777">w</span><span class="op" id="4231778">.</span><span class="ident" id="4231779">last</span><span class="op" id="4231783">.</span><span class="ident" id="4231784">closed</span>&nbsp;<span class="op" id="4231791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231795">if</span>&nbsp;<span class="ident" id="4231798">err</span>&nbsp;<span class="op" id="4231802">:=</span>&nbsp;<span class="ident" id="4231805">w</span><span class="op" id="4231806">.</span><span class="ident" id="4231807">last</span><span class="op" id="4231811">.</span><span class="builtinfunc" id="4231812">close</span><span class="op" id="4231817">(</span><span class="op" id="4231818">)</span><span class="op" id="4231819">;</span>&nbsp;<span class="ident" id="4231821">err</span>&nbsp;<span class="op" id="4231825">!=</span>&nbsp;<span class="ident" id="4231828">nil</span>&nbsp;<span class="op" id="4231832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231837">return</span>&nbsp;<span class="ident" id="4231844">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4231850">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231854">w</span><span class="op" id="4231855">.</span><span class="ident" id="4231856">last</span>&nbsp;<span class="op" id="4231861">=</span>&nbsp;<span class="ident" id="4231863">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4231868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231871">if</span>&nbsp;<span class="ident" id="4231874">w</span><span class="op" id="4231875">.</span><span class="ident" id="4231876">closed</span>&nbsp;<span class="op" id="4231883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4231887">return</span>&nbsp;<span class="ident" id="4231894">errors</span><span class="op" id="4231900">.</span><span class="ident" id="4231901">New</span><span class="op" id="4231904">(</span><span class="string" id="4231905">&#34;zip:&nbsp;writer&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="4231931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4231934">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231937">w</span><span class="op" id="4231938">.</span><span class="ident" id="4231939">closed</span>&nbsp;<span class="op" id="4231946">=</span>&nbsp;<span class="builtintype" id="4231948">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4231955">//&nbsp;write&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4231983">start</span>&nbsp;<span class="op" id="4231989">:=</span>&nbsp;<span class="ident" id="4231992">w</span><span class="op" id="4231993">.</span><span class="ident" id="4231994">cw</span><span class="op" id="4231996">.</span><span class="ident" id="4231997">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232004">for</span>&nbsp;<span class="ident" id="4232008">_</span><span class="op" id="4232009">,</span>&nbsp;<span class="ident" id="4232011">h</span>&nbsp;<span class="op" id="4232013">:=</span>&nbsp;<span class="keyword" id="4232016">range</span>&nbsp;<span class="ident" id="4232022">w</span><span class="op" id="4232023">.</span><span class="ident" id="4232024">dir</span>&nbsp;<span class="op" id="4232028">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232032">var</span>&nbsp;<span class="ident" id="4232036">buf</span>&nbsp;<span class="op" id="4232040">[</span><span class="ident" id="4232041">directoryHeaderLen</span><span class="op" id="4232059">]</span><span class="builtintype" id="4232060">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232067">b</span>&nbsp;<span class="op" id="4232069">:=</span>&nbsp;<span class="ident" id="4232072">writeBuf</span><span class="op" id="4232080">(</span><span class="ident" id="4232081">buf</span><span class="op" id="4232084">[</span><span class="op" id="4232085">:</span><span class="op" id="4232086">]</span><span class="op" id="4232087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232091">b</span><span class="op" id="4232092">.</span><span class="builtintype" id="4232093">uint32</span><span class="op" id="4232099">(</span><span class="builtintype" id="4232100">uint32</span><span class="op" id="4232106">(</span><span class="ident" id="4232107">directoryHeaderSignature</span><span class="op" id="4232131">)</span><span class="op" id="4232132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232136">b</span><span class="op" id="4232137">.</span><span class="builtintype" id="4232138">uint16</span><span class="op" id="4232144">(</span><span class="ident" id="4232145">h</span><span class="op" id="4232146">.</span><span class="ident" id="4232147">CreatorVersion</span><span class="op" id="4232161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232165">b</span><span class="op" id="4232166">.</span><span class="builtintype" id="4232167">uint16</span><span class="op" id="4232173">(</span><span class="ident" id="4232174">h</span><span class="op" id="4232175">.</span><span class="ident" id="4232176">ReaderVersion</span><span class="op" id="4232189">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232193">b</span><span class="op" id="4232194">.</span><span class="builtintype" id="4232195">uint16</span><span class="op" id="4232201">(</span><span class="ident" id="4232202">h</span><span class="op" id="4232203">.</span><span class="ident" id="4232204">Flags</span><span class="op" id="4232209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232213">b</span><span class="op" id="4232214">.</span><span class="builtintype" id="4232215">uint16</span><span class="op" id="4232221">(</span><span class="ident" id="4232222">h</span><span class="op" id="4232223">.</span><span class="ident" id="4232224">Method</span><span class="op" id="4232230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232234">b</span><span class="op" id="4232235">.</span><span class="builtintype" id="4232236">uint16</span><span class="op" id="4232242">(</span><span class="ident" id="4232243">h</span><span class="op" id="4232244">.</span><span class="ident" id="4232245">ModifiedTime</span><span class="op" id="4232257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232261">b</span><span class="op" id="4232262">.</span><span class="builtintype" id="4232263">uint16</span><span class="op" id="4232269">(</span><span class="ident" id="4232270">h</span><span class="op" id="4232271">.</span><span class="ident" id="4232272">ModifiedDate</span><span class="op" id="4232284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232288">b</span><span class="op" id="4232289">.</span><span class="builtintype" id="4232290">uint32</span><span class="op" id="4232296">(</span><span class="ident" id="4232297">h</span><span class="op" id="4232298">.</span><span class="ident" id="4232299">CRC32</span><span class="op" id="4232304">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232308">if</span>&nbsp;<span class="ident" id="4232311">h</span><span class="op" id="4232312">.</span><span class="ident" id="4232313">isZip64</span><span class="op" id="4232320">(</span><span class="op" id="4232321">)</span>&nbsp;<span class="op" id="4232323">||</span>&nbsp;<span class="ident" id="4232326">h</span><span class="op" id="4232327">.</span><span class="ident" id="4232328">offset</span>&nbsp;<span class="op" id="4232335">&gt;</span>&nbsp;<span class="ident" id="4232337">uint32max</span>&nbsp;<span class="op" id="4232347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4232352">//&nbsp;the&nbsp;file&nbsp;needs&nbsp;a&nbsp;zip64&nbsp;header.&nbsp;store&nbsp;maxint&nbsp;in&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4232410">//&nbsp;32&nbsp;bit&nbsp;size&nbsp;fields&nbsp;(and&nbsp;offset&nbsp;later)&nbsp;to&nbsp;signal&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4232473">//&nbsp;zip64&nbsp;extra&nbsp;header&nbsp;should&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232514">b</span><span class="op" id="4232515">.</span><span class="builtintype" id="4232516">uint32</span><span class="op" id="4232522">(</span><span class="ident" id="4232523">uint32max</span><span class="op" id="4232532">)</span>&nbsp;<span class="comment" id="4232534">//&nbsp;compressed&nbsp;size</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232556">b</span><span class="op" id="4232557">.</span><span class="builtintype" id="4232558">uint32</span><span class="op" id="4232564">(</span><span class="ident" id="4232565">uint32max</span><span class="op" id="4232574">)</span>&nbsp;<span class="comment" id="4232576">//&nbsp;uncompressed&nbsp;size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4232601">//&nbsp;append&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;block&nbsp;to&nbsp;Extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4232643">var</span>&nbsp;<span class="ident" id="4232647">buf</span>&nbsp;<span class="op" id="4232651">[</span><span class="num" id="4232652">28</span><span class="op" id="4232654">]</span><span class="builtintype" id="4232655">byte</span>&nbsp;<span class="comment" id="4232660">//&nbsp;2x&nbsp;uint16&nbsp;+&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232688">eb</span>&nbsp;<span class="op" id="4232691">:=</span>&nbsp;<span class="ident" id="4232694">writeBuf</span><span class="op" id="4232702">(</span><span class="ident" id="4232703">buf</span><span class="op" id="4232706">[</span><span class="op" id="4232707">:</span><span class="op" id="4232708">]</span><span class="op" id="4232709">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232714">eb</span><span class="op" id="4232716">.</span><span class="builtintype" id="4232717">uint16</span><span class="op" id="4232723">(</span><span class="ident" id="4232724">zip64ExtraId</span><span class="op" id="4232736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232741">eb</span><span class="op" id="4232743">.</span><span class="builtintype" id="4232744">uint16</span><span class="op" id="4232750">(</span><span class="num" id="4232751">24</span><span class="op" id="4232753">)</span>&nbsp;<span class="comment" id="4232755">//&nbsp;size&nbsp;=&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232778">eb</span><span class="op" id="4232780">.</span><span class="ident" id="4232781">uint64</span><span class="op" id="4232787">(</span><span class="ident" id="4232788">h</span><span class="op" id="4232789">.</span><span class="ident" id="4232790">UncompressedSize64</span><span class="op" id="4232808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232813">eb</span><span class="op" id="4232815">.</span><span class="ident" id="4232816">uint64</span><span class="op" id="4232822">(</span><span class="ident" id="4232823">h</span><span class="op" id="4232824">.</span><span class="ident" id="4232825">CompressedSize64</span><span class="op" id="4232841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232846">eb</span><span class="op" id="4232848">.</span><span class="ident" id="4232849">uint64</span><span class="op" id="4232855">(</span><span class="ident" id="4232856">h</span><span class="op" id="4232857">.</span><span class="ident" id="4232858">offset</span><span class="op" id="4232864">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232869">h</span><span class="op" id="4232870">.</span><span class="ident" id="4232871">Extra</span>&nbsp;<span class="op" id="4232877">=</span>&nbsp;<span class="builtinfunc" id="4232879">append</span><span class="op" id="4232885">(</span><span class="ident" id="4232886">h</span><span class="op" id="4232887">.</span><span class="ident" id="4232888">Extra</span><span class="op" id="4232893">,</span>&nbsp;<span class="ident" id="4232895">buf</span><span class="op" id="4232898">[</span><span class="op" id="4232899">:</span><span class="op" id="4232900">]</span><span class="op" id="4232901">...</span><span class="op" id="4232904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4232908">}</span>&nbsp;<span class="keyword" id="4232910">else</span>&nbsp;<span class="op" id="4232915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232920">b</span><span class="op" id="4232921">.</span><span class="builtintype" id="4232922">uint32</span><span class="op" id="4232928">(</span><span class="ident" id="4232929">h</span><span class="op" id="4232930">.</span><span class="ident" id="4232931">CompressedSize</span><span class="op" id="4232945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232950">b</span><span class="op" id="4232951">.</span><span class="builtintype" id="4232952">uint32</span><span class="op" id="4232958">(</span><span class="ident" id="4232959">h</span><span class="op" id="4232960">.</span><span class="ident" id="4232961">UncompressedSize</span><span class="op" id="4232977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4232981">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4232985">b</span><span class="op" id="4232986">.</span><span class="builtintype" id="4232987">uint16</span><span class="op" id="4232993">(</span><span class="builtintype" id="4232994">uint16</span><span class="op" id="4233000">(</span><span class="builtinfunc" id="4233001">len</span><span class="op" id="4233004">(</span><span class="ident" id="4233005">h</span><span class="op" id="4233006">.</span><span class="ident" id="4233007">Name</span><span class="op" id="4233011">)</span><span class="op" id="4233012">)</span><span class="op" id="4233013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233017">b</span><span class="op" id="4233018">.</span><span class="builtintype" id="4233019">uint16</span><span class="op" id="4233025">(</span><span class="builtintype" id="4233026">uint16</span><span class="op" id="4233032">(</span><span class="builtinfunc" id="4233033">len</span><span class="op" id="4233036">(</span><span class="ident" id="4233037">h</span><span class="op" id="4233038">.</span><span class="ident" id="4233039">Extra</span><span class="op" id="4233044">)</span><span class="op" id="4233045">)</span><span class="op" id="4233046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233050">b</span><span class="op" id="4233051">.</span><span class="builtintype" id="4233052">uint16</span><span class="op" id="4233058">(</span><span class="builtintype" id="4233059">uint16</span><span class="op" id="4233065">(</span><span class="builtinfunc" id="4233066">len</span><span class="op" id="4233069">(</span><span class="ident" id="4233070">h</span><span class="op" id="4233071">.</span><span class="ident" id="4233072">Comment</span><span class="op" id="4233079">)</span><span class="op" id="4233080">)</span><span class="op" id="4233081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233085">b</span>&nbsp;<span class="op" id="4233087">=</span>&nbsp;<span class="ident" id="4233089">b</span><span class="op" id="4233090">[</span><span class="num" id="4233091">4</span><span class="op" id="4233092">:</span><span class="op" id="4233093">]</span>&nbsp;<span class="comment" id="4233095">//&nbsp;skip&nbsp;disk&nbsp;number&nbsp;start&nbsp;and&nbsp;internal&nbsp;file&nbsp;attr&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233158">b</span><span class="op" id="4233159">.</span><span class="builtintype" id="4233160">uint32</span><span class="op" id="4233166">(</span><span class="ident" id="4233167">h</span><span class="op" id="4233168">.</span><span class="ident" id="4233169">ExternalAttrs</span><span class="op" id="4233182">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233186">if</span>&nbsp;<span class="ident" id="4233189">h</span><span class="op" id="4233190">.</span><span class="ident" id="4233191">offset</span>&nbsp;<span class="op" id="4233198">&gt;</span>&nbsp;<span class="ident" id="4233200">uint32max</span>&nbsp;<span class="op" id="4233210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233215">b</span><span class="op" id="4233216">.</span><span class="builtintype" id="4233217">uint32</span><span class="op" id="4233223">(</span><span class="ident" id="4233224">uint32max</span><span class="op" id="4233233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4233237">}</span>&nbsp;<span class="keyword" id="4233239">else</span>&nbsp;<span class="op" id="4233244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233249">b</span><span class="op" id="4233250">.</span><span class="builtintype" id="4233251">uint32</span><span class="op" id="4233257">(</span><span class="builtintype" id="4233258">uint32</span><span class="op" id="4233264">(</span><span class="ident" id="4233265">h</span><span class="op" id="4233266">.</span><span class="ident" id="4233267">offset</span><span class="op" id="4233273">)</span><span class="op" id="4233274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4233278">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233282">if</span>&nbsp;<span class="ident" id="4233285">_</span><span class="op" id="4233286">,</span>&nbsp;<span class="ident" id="4233288">err</span>&nbsp;<span class="op" id="4233292">:=</span>&nbsp;<span class="ident" id="4233295">w</span><span class="op" id="4233296">.</span><span class="ident" id="4233297">cw</span><span class="op" id="4233299">.</span><span class="ident" id="4233300">Write</span><span class="op" id="4233305">(</span><span class="ident" id="4233306">buf</span><span class="op" id="4233309">[</span><span class="op" id="4233310">:</span><span class="op" id="4233311">]</span><span class="op" id="4233312">)</span><span class="op" id="4233313">;</span>&nbsp;<span class="ident" id="4233315">err</span>&nbsp;<span class="op" id="4233319">!=</span>&nbsp;<span class="ident" id="4233322">nil</span>&nbsp;<span class="op" id="4233326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233331">return</span>&nbsp;<span class="ident" id="4233338">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4233344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233348">if</span>&nbsp;<span class="ident" id="4233351">_</span><span class="op" id="4233352">,</span>&nbsp;<span class="ident" id="4233354">err</span>&nbsp;<span class="op" id="4233358">:=</span>&nbsp;<span class="ident" id="4233361">io</span><span class="op" id="4233363">.</span><span class="ident" id="4233364">WriteString</span><span class="op" id="4233375">(</span><span class="ident" id="4233376">w</span><span class="op" id="4233377">.</span><span class="ident" id="4233378">cw</span><span class="op" id="4233380">,</span>&nbsp;<span class="ident" id="4233382">h</span><span class="op" id="4233383">.</span><span class="ident" id="4233384">Name</span><span class="op" id="4233388">)</span><span class="op" id="4233389">;</span>&nbsp;<span class="ident" id="4233391">err</span>&nbsp;<span class="op" id="4233395">!=</span>&nbsp;<span class="ident" id="4233398">nil</span>&nbsp;<span class="op" id="4233402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233407">return</span>&nbsp;<span class="ident" id="4233414">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4233420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233424">if</span>&nbsp;<span class="ident" id="4233427">_</span><span class="op" id="4233428">,</span>&nbsp;<span class="ident" id="4233430">err</span>&nbsp;<span class="op" id="4233434">:=</span>&nbsp;<span class="ident" id="4233437">w</span><span class="op" id="4233438">.</span><span class="ident" id="4233439">cw</span><span class="op" id="4233441">.</span><span class="ident" id="4233442">Write</span><span class="op" id="4233447">(</span><span class="ident" id="4233448">h</span><span class="op" id="4233449">.</span><span class="ident" id="4233450">Extra</span><span class="op" id="4233455">)</span><span class="op" id="4233456">;</span>&nbsp;<span class="ident" id="4233458">err</span>&nbsp;<span class="op" id="4233462">!=</span>&nbsp;<span class="ident" id="4233465">nil</span>&nbsp;<span class="op" id="4233469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233474">return</span>&nbsp;<span class="ident" id="4233481">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4233487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233491">if</span>&nbsp;<span class="ident" id="4233494">_</span><span class="op" id="4233495">,</span>&nbsp;<span class="ident" id="4233497">err</span>&nbsp;<span class="op" id="4233501">:=</span>&nbsp;<span class="ident" id="4233504">io</span><span class="op" id="4233506">.</span><span class="ident" id="4233507">WriteString</span><span class="op" id="4233518">(</span><span class="ident" id="4233519">w</span><span class="op" id="4233520">.</span><span class="ident" id="4233521">cw</span><span class="op" id="4233523">,</span>&nbsp;<span class="ident" id="4233525">h</span><span class="op" id="4233526">.</span><span class="ident" id="4233527">Comment</span><span class="op" id="4233534">)</span><span class="op" id="4233535">;</span>&nbsp;<span class="ident" id="4233537">err</span>&nbsp;<span class="op" id="4233541">!=</span>&nbsp;<span class="ident" id="4233544">nil</span>&nbsp;<span class="op" id="4233548">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233553">return</span>&nbsp;<span class="ident" id="4233560">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4233566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4233569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233572">end</span>&nbsp;<span class="op" id="4233576">:=</span>&nbsp;<span class="ident" id="4233579">w</span><span class="op" id="4233580">.</span><span class="ident" id="4233581">cw</span><span class="op" id="4233583">.</span><span class="ident" id="4233584">count</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233592">records</span>&nbsp;<span class="op" id="4233600">:=</span>&nbsp;<span class="ident" id="4233603">uint64</span><span class="op" id="4233609">(</span><span class="builtinfunc" id="4233610">len</span><span class="op" id="4233613">(</span><span class="ident" id="4233614">w</span><span class="op" id="4233615">.</span><span class="ident" id="4233616">dir</span><span class="op" id="4233619">)</span><span class="op" id="4233620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233623">size</span>&nbsp;<span class="op" id="4233628">:=</span>&nbsp;<span class="ident" id="4233631">uint64</span><span class="op" id="4233637">(</span><span class="ident" id="4233638">end</span>&nbsp;<span class="op" id="4233642">-</span>&nbsp;<span class="ident" id="4233644">start</span><span class="op" id="4233649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233652">offset</span>&nbsp;<span class="op" id="4233659">:=</span>&nbsp;<span class="ident" id="4233662">uint64</span><span class="op" id="4233668">(</span><span class="ident" id="4233669">start</span><span class="op" id="4233674">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233678">if</span>&nbsp;<span class="ident" id="4233681">records</span>&nbsp;<span class="op" id="4233689">&gt;</span>&nbsp;<span class="ident" id="4233691">uint16max</span>&nbsp;<span class="op" id="4233701">||</span>&nbsp;<span class="ident" id="4233704">size</span>&nbsp;<span class="op" id="4233709">&gt;</span>&nbsp;<span class="ident" id="4233711">uint32max</span>&nbsp;<span class="op" id="4233721">||</span>&nbsp;<span class="ident" id="4233724">offset</span>&nbsp;<span class="op" id="4233731">&gt;</span>&nbsp;<span class="ident" id="4233733">uint32max</span>&nbsp;<span class="op" id="4233743">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4233747">var</span>&nbsp;<span class="ident" id="4233751">buf</span>&nbsp;<span class="op" id="4233755">[</span><span class="ident" id="4233756">directory64EndLen</span>&nbsp;<span class="op" id="4233774">+</span>&nbsp;<span class="ident" id="4233776">directory64LocLen</span><span class="op" id="4233793">]</span><span class="builtintype" id="4233794">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233801">b</span>&nbsp;<span class="op" id="4233803">:=</span>&nbsp;<span class="ident" id="4233806">writeBuf</span><span class="op" id="4233814">(</span><span class="ident" id="4233815">buf</span><span class="op" id="4233818">[</span><span class="op" id="4233819">:</span><span class="op" id="4233820">]</span><span class="op" id="4233821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4233826">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233869">b</span><span class="op" id="4233870">.</span><span class="builtintype" id="4233871">uint32</span><span class="op" id="4233877">(</span><span class="ident" id="4233878">directory64EndSignature</span><span class="op" id="4233901">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233905">b</span><span class="op" id="4233906">.</span><span class="ident" id="4233907">uint64</span><span class="op" id="4233913">(</span><span class="ident" id="4233914">directory64EndLen</span><span class="op" id="4233931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233935">b</span><span class="op" id="4233936">.</span><span class="builtintype" id="4233937">uint16</span><span class="op" id="4233943">(</span><span class="ident" id="4233944">zipVersion45</span><span class="op" id="4233956">)</span>&nbsp;<span class="comment" id="4233958">//&nbsp;version&nbsp;made&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4233979">b</span><span class="op" id="4233980">.</span><span class="builtintype" id="4233981">uint16</span><span class="op" id="4233987">(</span><span class="ident" id="4233988">zipVersion45</span><span class="op" id="4234000">)</span>&nbsp;<span class="comment" id="4234002">//&nbsp;version&nbsp;needed&nbsp;to&nbsp;extract</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234033">b</span><span class="op" id="4234034">.</span><span class="builtintype" id="4234035">uint32</span><span class="op" id="4234041">(</span><span class="num" id="4234042">0</span><span class="op" id="4234043">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4234056">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234081">b</span><span class="op" id="4234082">.</span><span class="builtintype" id="4234083">uint32</span><span class="op" id="4234089">(</span><span class="num" id="4234090">0</span><span class="op" id="4234091">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4234104">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234168">b</span><span class="op" id="4234169">.</span><span class="ident" id="4234170">uint64</span><span class="op" id="4234176">(</span><span class="ident" id="4234177">records</span><span class="op" id="4234184">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4234191">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234258">b</span><span class="op" id="4234259">.</span><span class="ident" id="4234260">uint64</span><span class="op" id="4234266">(</span><span class="ident" id="4234267">records</span><span class="op" id="4234274">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4234281">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234335">b</span><span class="op" id="4234336">.</span><span class="ident" id="4234337">uint64</span><span class="op" id="4234343">(</span><span class="ident" id="4234344">size</span><span class="op" id="4234348">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4234358">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234393">b</span><span class="op" id="4234394">.</span><span class="ident" id="4234395">uint64</span><span class="op" id="4234401">(</span><span class="ident" id="4234402">offset</span><span class="op" id="4234408">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4234416">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4234500">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;locator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234544">b</span><span class="op" id="4234545">.</span><span class="builtintype" id="4234546">uint32</span><span class="op" id="4234552">(</span><span class="ident" id="4234553">directory64LocSignature</span><span class="op" id="4234576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234580">b</span><span class="op" id="4234581">.</span><span class="builtintype" id="4234582">uint32</span><span class="op" id="4234588">(</span><span class="num" id="4234589">0</span><span class="op" id="4234590">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4234602">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234679">b</span><span class="op" id="4234680">.</span><span class="ident" id="4234681">uint64</span><span class="op" id="4234687">(</span><span class="ident" id="4234688">uint64</span><span class="op" id="4234694">(</span><span class="ident" id="4234695">end</span><span class="op" id="4234698">)</span><span class="op" id="4234699">)</span>&nbsp;<span class="comment" id="4234701">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234767">b</span><span class="op" id="4234768">.</span><span class="builtintype" id="4234769">uint32</span><span class="op" id="4234775">(</span><span class="num" id="4234776">1</span><span class="op" id="4234777">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4234789">//&nbsp;total&nbsp;number&nbsp;of&nbsp;disks</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234817">if</span>&nbsp;<span class="ident" id="4234820">_</span><span class="op" id="4234821">,</span>&nbsp;<span class="ident" id="4234823">err</span>&nbsp;<span class="op" id="4234827">:=</span>&nbsp;<span class="ident" id="4234830">w</span><span class="op" id="4234831">.</span><span class="ident" id="4234832">cw</span><span class="op" id="4234834">.</span><span class="ident" id="4234835">Write</span><span class="op" id="4234840">(</span><span class="ident" id="4234841">buf</span><span class="op" id="4234844">[</span><span class="op" id="4234845">:</span><span class="op" id="4234846">]</span><span class="op" id="4234847">)</span><span class="op" id="4234848">;</span>&nbsp;<span class="ident" id="4234850">err</span>&nbsp;<span class="op" id="4234854">!=</span>&nbsp;<span class="ident" id="4234857">nil</span>&nbsp;<span class="op" id="4234861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4234866">return</span>&nbsp;<span class="ident" id="4234873">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4234879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4234884">//&nbsp;store&nbsp;max&nbsp;values&nbsp;in&nbsp;the&nbsp;regular&nbsp;end&nbsp;record&nbsp;to&nbsp;signal&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4234947">//&nbsp;that&nbsp;the&nbsp;zip64&nbsp;values&nbsp;should&nbsp;be&nbsp;used&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4234997">records</span>&nbsp;<span class="op" id="4235005">=</span>&nbsp;<span class="ident" id="4235007">uint16max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235019">size</span>&nbsp;<span class="op" id="4235024">=</span>&nbsp;<span class="ident" id="4235026">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235038">offset</span>&nbsp;<span class="op" id="4235045">=</span>&nbsp;<span class="ident" id="4235047">uint32max</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4235058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4235062">//&nbsp;write&nbsp;end&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235083">var</span>&nbsp;<span class="ident" id="4235087">buf</span>&nbsp;<span class="op" id="4235091">[</span><span class="ident" id="4235092">directoryEndLen</span><span class="op" id="4235107">]</span><span class="builtintype" id="4235108">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235114">b</span>&nbsp;<span class="op" id="4235116">:=</span>&nbsp;<span class="ident" id="4235119">writeBuf</span><span class="op" id="4235127">(</span><span class="ident" id="4235128">buf</span><span class="op" id="4235131">[</span><span class="op" id="4235132">:</span><span class="op" id="4235133">]</span><span class="op" id="4235134">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235137">b</span><span class="op" id="4235138">.</span><span class="builtintype" id="4235139">uint32</span><span class="op" id="4235145">(</span><span class="builtintype" id="4235146">uint32</span><span class="op" id="4235152">(</span><span class="ident" id="4235153">directoryEndSignature</span><span class="op" id="4235174">)</span><span class="op" id="4235175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235178">b</span>&nbsp;<span class="op" id="4235180">=</span>&nbsp;<span class="ident" id="4235182">b</span><span class="op" id="4235183">[</span><span class="num" id="4235184">4</span><span class="op" id="4235185">:</span><span class="op" id="4235186">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4235204">//&nbsp;skip&nbsp;over&nbsp;disk&nbsp;number&nbsp;and&nbsp;first&nbsp;disk&nbsp;number&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235264">b</span><span class="op" id="4235265">.</span><span class="builtintype" id="4235266">uint16</span><span class="op" id="4235272">(</span><span class="builtintype" id="4235273">uint16</span><span class="op" id="4235279">(</span><span class="ident" id="4235280">records</span><span class="op" id="4235287">)</span><span class="op" id="4235288">)</span>&nbsp;<span class="comment" id="4235290">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235322">b</span><span class="op" id="4235323">.</span><span class="builtintype" id="4235324">uint16</span><span class="op" id="4235330">(</span><span class="builtintype" id="4235331">uint16</span><span class="op" id="4235337">(</span><span class="ident" id="4235338">records</span><span class="op" id="4235345">)</span><span class="op" id="4235346">)</span>&nbsp;<span class="comment" id="4235348">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;total</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235376">b</span><span class="op" id="4235377">.</span><span class="builtintype" id="4235378">uint32</span><span class="op" id="4235384">(</span><span class="builtintype" id="4235385">uint32</span><span class="op" id="4235391">(</span><span class="ident" id="4235392">size</span><span class="op" id="4235396">)</span><span class="op" id="4235397">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4235402">//&nbsp;size&nbsp;of&nbsp;directory</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4235424">b</span><span class="op" id="4235425">.</span><span class="builtintype" id="4235426">uint32</span><span class="op" id="4235432">(</span><span class="builtintype" id="4235433">uint32</span><span class="op" id="4235439">(</span><span class="ident" id="4235440">offset</span><span class="op" id="4235446">)</span><span class="op" id="4235447">)</span>&nbsp;&nbsp;<span class="comment" id="4235450">//&nbsp;start&nbsp;of&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4235473">//&nbsp;skipped&nbsp;size&nbsp;of&nbsp;comment&nbsp;(always&nbsp;zero)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235515">if</span>&nbsp;<span class="ident" id="4235518">_</span><span class="op" id="4235519">,</span>&nbsp;<span class="ident" id="4235521">err</span>&nbsp;<span class="op" id="4235525">:=</span>&nbsp;<span class="ident" id="4235528">w</span><span class="op" id="4235529">.</span><span class="ident" id="4235530">cw</span><span class="op" id="4235532">.</span><span class="ident" id="4235533">Write</span><span class="op" id="4235538">(</span><span class="ident" id="4235539">buf</span><span class="op" id="4235542">[</span><span class="op" id="4235543">:</span><span class="op" id="4235544">]</span><span class="op" id="4235545">)</span><span class="op" id="4235546">;</span>&nbsp;<span class="ident" id="4235548">err</span>&nbsp;<span class="op" id="4235552">!=</span>&nbsp;<span class="ident" id="4235555">nil</span>&nbsp;<span class="op" id="4235559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235563">return</span>&nbsp;<span class="ident" id="4235570">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4235575">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4235579">return</span>&nbsp;<span class="ident" id="4235586">w</span><span class="op" id="4235587">.</span><span class="ident" id="4235588">cw</span><span class="op" id="4235590">.</span><span class="ident" id="4235591">w</span><span class="op" id="4235592">.</span><span class="op" id="4235593">(</span><span class="op" id="4235594">*</span><span class="ident" id="4235595">bufio</span><span class="op" id="4235600">.</span><span class="ident" id="4235601">Writer</span><span class="op" id="4235607">)</span><span class="op" id="4235608">.</span><span class="ident" id="4235609">Flush</span><span class="op" id="4235614">(</span><span class="op" id="4235615">)</span><br>
<span class="lineno"></span><span class="op" id="4235617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4235620">//&nbsp;Create&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno">170</span><span class="comment" id="4235683">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="4235752">//&nbsp;The&nbsp;name&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span><span class="comment" id="4235820">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4235887">//&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="4235899">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno">175</span><span class="comment" id="4235971">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="4236014">func</span>&nbsp;<span class="op" id="4236019">(</span><span class="ident" id="4236020">w</span>&nbsp;<span class="op" id="4236022">*</span><span class="ident" id="4236023">Writer</span><span class="op" id="4236029">)</span>&nbsp;<span class="ident" id="4236031">Create</span><span class="op" id="4236037">(</span><span class="ident" id="4236038">name</span>&nbsp;<span class="builtintype" id="4236043">string</span><span class="op" id="4236049">)</span>&nbsp;<span class="op" id="4236051">(</span><span class="ident" id="4236052">io</span><span class="op" id="4236054">.</span><span class="ident" id="4236055">Writer</span><span class="op" id="4236061">,</span>&nbsp;<span class="builtintype" id="4236063">error</span><span class="op" id="4236068">)</span>&nbsp;<span class="op" id="4236070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236073">header</span>&nbsp;<span class="op" id="4236080">:=</span>&nbsp;<span class="op" id="4236083">&amp;</span><span class="ident" id="4236084">FileHeader</span><span class="op" id="4236094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236098">Name</span><span class="op" id="4236102">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4236106">name</span><span class="op" id="4236110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236114">Method</span><span class="op" id="4236120">:</span>&nbsp;<span class="ident" id="4236122">Deflate</span><span class="op" id="4236129">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4236132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236135">return</span>&nbsp;<span class="ident" id="4236142">w</span><span class="op" id="4236143">.</span><span class="ident" id="4236144">CreateHeader</span><span class="op" id="4236156">(</span><span class="ident" id="4236157">header</span><span class="op" id="4236163">)</span><br>
<span class="lineno"></span><span class="op" id="4236165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4236168">//&nbsp;CreateHeader&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;FileHeader</span><br>
<span class="lineno">185</span><span class="comment" id="4236242">//&nbsp;for&nbsp;the&nbsp;file&nbsp;metadata.</span><br>
<span class="lineno"></span><span class="comment" id="4236268">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="4236337">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="4236409">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="4236452">func</span>&nbsp;<span class="op" id="4236457">(</span><span class="ident" id="4236458">w</span>&nbsp;<span class="op" id="4236460">*</span><span class="ident" id="4236461">Writer</span><span class="op" id="4236467">)</span>&nbsp;<span class="ident" id="4236469">CreateHeader</span><span class="op" id="4236481">(</span><span class="ident" id="4236482">fh</span>&nbsp;<span class="op" id="4236485">*</span><span class="ident" id="4236486">FileHeader</span><span class="op" id="4236496">)</span>&nbsp;<span class="op" id="4236498">(</span><span class="ident" id="4236499">io</span><span class="op" id="4236501">.</span><span class="ident" id="4236502">Writer</span><span class="op" id="4236508">,</span>&nbsp;<span class="builtintype" id="4236510">error</span><span class="op" id="4236515">)</span>&nbsp;<span class="op" id="4236517">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236520">if</span>&nbsp;<span class="ident" id="4236523">w</span><span class="op" id="4236524">.</span><span class="ident" id="4236525">last</span>&nbsp;<span class="op" id="4236530">!=</span>&nbsp;<span class="ident" id="4236533">nil</span>&nbsp;<span class="op" id="4236537">&amp;&amp;</span>&nbsp;<span class="op" id="4236540">!</span><span class="ident" id="4236541">w</span><span class="op" id="4236542">.</span><span class="ident" id="4236543">last</span><span class="op" id="4236547">.</span><span class="ident" id="4236548">closed</span>&nbsp;<span class="op" id="4236555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236559">if</span>&nbsp;<span class="ident" id="4236562">err</span>&nbsp;<span class="op" id="4236566">:=</span>&nbsp;<span class="ident" id="4236569">w</span><span class="op" id="4236570">.</span><span class="ident" id="4236571">last</span><span class="op" id="4236575">.</span><span class="builtinfunc" id="4236576">close</span><span class="op" id="4236581">(</span><span class="op" id="4236582">)</span><span class="op" id="4236583">;</span>&nbsp;<span class="ident" id="4236585">err</span>&nbsp;<span class="op" id="4236589">!=</span>&nbsp;<span class="ident" id="4236592">nil</span>&nbsp;<span class="op" id="4236596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236601">return</span>&nbsp;<span class="ident" id="4236608">nil</span><span class="op" id="4236611">,</span>&nbsp;<span class="ident" id="4236613">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4236619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4236622">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236626">fh</span><span class="op" id="4236628">.</span><span class="ident" id="4236629">Flags</span>&nbsp;<span class="op" id="4236635">|=</span>&nbsp;<span class="num" id="4236638">0x8</span>&nbsp;<span class="comment" id="4236642">//&nbsp;we&nbsp;will&nbsp;write&nbsp;a&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236679">fh</span><span class="op" id="4236681">.</span><span class="ident" id="4236682">CreatorVersion</span>&nbsp;<span class="op" id="4236697">=</span>&nbsp;<span class="ident" id="4236699">fh</span><span class="op" id="4236701">.</span><span class="ident" id="4236702">CreatorVersion</span><span class="op" id="4236716">&amp;</span><span class="num" id="4236717">0xff00</span>&nbsp;<span class="op" id="4236724">|</span>&nbsp;<span class="ident" id="4236726">zipVersion20</span>&nbsp;<span class="comment" id="4236739">//&nbsp;preserve&nbsp;compatibility&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236771">fh</span><span class="op" id="4236773">.</span><span class="ident" id="4236774">ReaderVersion</span>&nbsp;<span class="op" id="4236788">=</span>&nbsp;<span class="ident" id="4236790">zipVersion20</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236805">fw</span>&nbsp;<span class="op" id="4236808">:=</span>&nbsp;<span class="op" id="4236811">&amp;</span><span class="ident" id="4236812">fileWriter</span><span class="op" id="4236822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236826">zipw</span><span class="op" id="4236830">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236837">w</span><span class="op" id="4236838">.</span><span class="ident" id="4236839">cw</span><span class="op" id="4236841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236845">compCount</span><span class="op" id="4236854">:</span>&nbsp;<span class="op" id="4236856">&amp;</span><span class="ident" id="4236857">countWriter</span><span class="op" id="4236868">{</span><span class="ident" id="4236869">w</span><span class="op" id="4236870">:</span>&nbsp;<span class="ident" id="4236872">w</span><span class="op" id="4236873">.</span><span class="ident" id="4236874">cw</span><span class="op" id="4236876">}</span><span class="op" id="4236877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236881">crc32</span><span class="op" id="4236886">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236892">crc32</span><span class="op" id="4236897">.</span><span class="ident" id="4236898">NewIEEE</span><span class="op" id="4236905">(</span><span class="op" id="4236906">)</span><span class="op" id="4236907">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4236910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4236913">comp</span>&nbsp;<span class="op" id="4236918">:=</span>&nbsp;<span class="ident" id="4236921">compressor</span><span class="op" id="4236931">(</span><span class="ident" id="4236932">fh</span><span class="op" id="4236934">.</span><span class="ident" id="4236935">Method</span><span class="op" id="4236941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236944">if</span>&nbsp;<span class="ident" id="4236947">comp</span>&nbsp;<span class="op" id="4236952">==</span>&nbsp;<span class="ident" id="4236955">nil</span>&nbsp;<span class="op" id="4236959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236963">return</span>&nbsp;<span class="ident" id="4236970">nil</span><span class="op" id="4236973">,</span>&nbsp;<span class="ident" id="4236975">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4236989">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4236992">var</span>&nbsp;<span class="ident" id="4236996">err</span>&nbsp;<span class="builtintype" id="4237000">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237007">fw</span><span class="op" id="4237009">.</span><span class="ident" id="4237010">comp</span><span class="op" id="4237014">,</span>&nbsp;<span class="ident" id="4237016">err</span>&nbsp;<span class="op" id="4237020">=</span>&nbsp;<span class="ident" id="4237022">comp</span><span class="op" id="4237026">(</span><span class="ident" id="4237027">fw</span><span class="op" id="4237029">.</span><span class="ident" id="4237030">compCount</span><span class="op" id="4237039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237042">if</span>&nbsp;<span class="ident" id="4237045">err</span>&nbsp;<span class="op" id="4237049">!=</span>&nbsp;<span class="ident" id="4237052">nil</span>&nbsp;<span class="op" id="4237056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237060">return</span>&nbsp;<span class="ident" id="4237067">nil</span><span class="op" id="4237070">,</span>&nbsp;<span class="ident" id="4237072">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4237077">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237080">fw</span><span class="op" id="4237082">.</span><span class="ident" id="4237083">rawCount</span>&nbsp;<span class="op" id="4237092">=</span>&nbsp;<span class="op" id="4237094">&amp;</span><span class="ident" id="4237095">countWriter</span><span class="op" id="4237106">{</span><span class="ident" id="4237107">w</span><span class="op" id="4237108">:</span>&nbsp;<span class="ident" id="4237110">fw</span><span class="op" id="4237112">.</span><span class="ident" id="4237113">comp</span><span class="op" id="4237117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237121">h</span>&nbsp;<span class="op" id="4237123">:=</span>&nbsp;<span class="op" id="4237126">&amp;</span><span class="ident" id="4237127">header</span><span class="op" id="4237133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237137">FileHeader</span><span class="op" id="4237147">:</span>&nbsp;<span class="ident" id="4237149">fh</span><span class="op" id="4237151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237155">offset</span><span class="op" id="4237161">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237167">uint64</span><span class="op" id="4237173">(</span><span class="ident" id="4237174">w</span><span class="op" id="4237175">.</span><span class="ident" id="4237176">cw</span><span class="op" id="4237178">.</span><span class="ident" id="4237179">count</span><span class="op" id="4237184">)</span><span class="op" id="4237185">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4237188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237191">w</span><span class="op" id="4237192">.</span><span class="ident" id="4237193">dir</span>&nbsp;<span class="op" id="4237197">=</span>&nbsp;<span class="builtinfunc" id="4237199">append</span><span class="op" id="4237205">(</span><span class="ident" id="4237206">w</span><span class="op" id="4237207">.</span><span class="ident" id="4237208">dir</span><span class="op" id="4237211">,</span>&nbsp;<span class="ident" id="4237213">h</span><span class="op" id="4237214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237217">fw</span><span class="op" id="4237219">.</span><span class="ident" id="4237220">header</span>&nbsp;<span class="op" id="4237227">=</span>&nbsp;<span class="ident" id="4237229">h</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237233">if</span>&nbsp;<span class="ident" id="4237236">err</span>&nbsp;<span class="op" id="4237240">:=</span>&nbsp;<span class="ident" id="4237243">writeHeader</span><span class="op" id="4237254">(</span><span class="ident" id="4237255">w</span><span class="op" id="4237256">.</span><span class="ident" id="4237257">cw</span><span class="op" id="4237259">,</span>&nbsp;<span class="ident" id="4237261">fh</span><span class="op" id="4237263">)</span><span class="op" id="4237264">;</span>&nbsp;<span class="ident" id="4237266">err</span>&nbsp;<span class="op" id="4237270">!=</span>&nbsp;<span class="ident" id="4237273">nil</span>&nbsp;<span class="op" id="4237277">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237281">return</span>&nbsp;<span class="ident" id="4237288">nil</span><span class="op" id="4237291">,</span>&nbsp;<span class="ident" id="4237293">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4237298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237302">w</span><span class="op" id="4237303">.</span><span class="ident" id="4237304">last</span>&nbsp;<span class="op" id="4237309">=</span>&nbsp;<span class="ident" id="4237311">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237315">return</span>&nbsp;<span class="ident" id="4237322">fw</span><span class="op" id="4237324">,</span>&nbsp;<span class="ident" id="4237326">nil</span><br>
<span class="lineno">230</span><span class="op" id="4237330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4237333">func</span>&nbsp;<span class="ident" id="4237338">writeHeader</span><span class="op" id="4237349">(</span><span class="ident" id="4237350">w</span>&nbsp;<span class="ident" id="4237352">io</span><span class="op" id="4237354">.</span><span class="ident" id="4237355">Writer</span><span class="op" id="4237361">,</span>&nbsp;<span class="ident" id="4237363">h</span>&nbsp;<span class="op" id="4237365">*</span><span class="ident" id="4237366">FileHeader</span><span class="op" id="4237376">)</span>&nbsp;<span class="builtintype" id="4237378">error</span>&nbsp;<span class="op" id="4237384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237387">var</span>&nbsp;<span class="ident" id="4237391">buf</span>&nbsp;<span class="op" id="4237395">[</span><span class="ident" id="4237396">fileHeaderLen</span><span class="op" id="4237409">]</span><span class="builtintype" id="4237410">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237416">b</span>&nbsp;<span class="op" id="4237418">:=</span>&nbsp;<span class="ident" id="4237421">writeBuf</span><span class="op" id="4237429">(</span><span class="ident" id="4237430">buf</span><span class="op" id="4237433">[</span><span class="op" id="4237434">:</span><span class="op" id="4237435">]</span><span class="op" id="4237436">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237439">b</span><span class="op" id="4237440">.</span><span class="builtintype" id="4237441">uint32</span><span class="op" id="4237447">(</span><span class="builtintype" id="4237448">uint32</span><span class="op" id="4237454">(</span><span class="ident" id="4237455">fileHeaderSignature</span><span class="op" id="4237474">)</span><span class="op" id="4237475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237478">b</span><span class="op" id="4237479">.</span><span class="builtintype" id="4237480">uint16</span><span class="op" id="4237486">(</span><span class="ident" id="4237487">h</span><span class="op" id="4237488">.</span><span class="ident" id="4237489">ReaderVersion</span><span class="op" id="4237502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237505">b</span><span class="op" id="4237506">.</span><span class="builtintype" id="4237507">uint16</span><span class="op" id="4237513">(</span><span class="ident" id="4237514">h</span><span class="op" id="4237515">.</span><span class="ident" id="4237516">Flags</span><span class="op" id="4237521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237524">b</span><span class="op" id="4237525">.</span><span class="builtintype" id="4237526">uint16</span><span class="op" id="4237532">(</span><span class="ident" id="4237533">h</span><span class="op" id="4237534">.</span><span class="ident" id="4237535">Method</span><span class="op" id="4237541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237544">b</span><span class="op" id="4237545">.</span><span class="builtintype" id="4237546">uint16</span><span class="op" id="4237552">(</span><span class="ident" id="4237553">h</span><span class="op" id="4237554">.</span><span class="ident" id="4237555">ModifiedTime</span><span class="op" id="4237567">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237570">b</span><span class="op" id="4237571">.</span><span class="builtintype" id="4237572">uint16</span><span class="op" id="4237578">(</span><span class="ident" id="4237579">h</span><span class="op" id="4237580">.</span><span class="ident" id="4237581">ModifiedDate</span><span class="op" id="4237593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237596">b</span><span class="op" id="4237597">.</span><span class="builtintype" id="4237598">uint32</span><span class="op" id="4237604">(</span><span class="num" id="4237605">0</span><span class="op" id="4237606">)</span>&nbsp;<span class="comment" id="4237608">//&nbsp;since&nbsp;we&nbsp;are&nbsp;writing&nbsp;a&nbsp;data&nbsp;descriptor&nbsp;crc32,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237658">b</span><span class="op" id="4237659">.</span><span class="builtintype" id="4237660">uint32</span><span class="op" id="4237666">(</span><span class="num" id="4237667">0</span><span class="op" id="4237668">)</span>&nbsp;<span class="comment" id="4237670">//&nbsp;compressed&nbsp;size,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237691">b</span><span class="op" id="4237692">.</span><span class="builtintype" id="4237693">uint32</span><span class="op" id="4237699">(</span><span class="num" id="4237700">0</span><span class="op" id="4237701">)</span>&nbsp;<span class="comment" id="4237703">//&nbsp;and&nbsp;uncompressed&nbsp;size&nbsp;should&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237744">b</span><span class="op" id="4237745">.</span><span class="builtintype" id="4237746">uint16</span><span class="op" id="4237752">(</span><span class="builtintype" id="4237753">uint16</span><span class="op" id="4237759">(</span><span class="builtinfunc" id="4237760">len</span><span class="op" id="4237763">(</span><span class="ident" id="4237764">h</span><span class="op" id="4237765">.</span><span class="ident" id="4237766">Name</span><span class="op" id="4237770">)</span><span class="op" id="4237771">)</span><span class="op" id="4237772">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237775">b</span><span class="op" id="4237776">.</span><span class="builtintype" id="4237777">uint16</span><span class="op" id="4237783">(</span><span class="builtintype" id="4237784">uint16</span><span class="op" id="4237790">(</span><span class="builtinfunc" id="4237791">len</span><span class="op" id="4237794">(</span><span class="ident" id="4237795">h</span><span class="op" id="4237796">.</span><span class="ident" id="4237797">Extra</span><span class="op" id="4237802">)</span><span class="op" id="4237803">)</span><span class="op" id="4237804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237807">if</span>&nbsp;<span class="ident" id="4237810">_</span><span class="op" id="4237811">,</span>&nbsp;<span class="ident" id="4237813">err</span>&nbsp;<span class="op" id="4237817">:=</span>&nbsp;<span class="ident" id="4237820">w</span><span class="op" id="4237821">.</span><span class="ident" id="4237822">Write</span><span class="op" id="4237827">(</span><span class="ident" id="4237828">buf</span><span class="op" id="4237831">[</span><span class="op" id="4237832">:</span><span class="op" id="4237833">]</span><span class="op" id="4237834">)</span><span class="op" id="4237835">;</span>&nbsp;<span class="ident" id="4237837">err</span>&nbsp;<span class="op" id="4237841">!=</span>&nbsp;<span class="ident" id="4237844">nil</span>&nbsp;<span class="op" id="4237848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237852">return</span>&nbsp;<span class="ident" id="4237859">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4237864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237867">if</span>&nbsp;<span class="ident" id="4237870">_</span><span class="op" id="4237871">,</span>&nbsp;<span class="ident" id="4237873">err</span>&nbsp;<span class="op" id="4237877">:=</span>&nbsp;<span class="ident" id="4237880">io</span><span class="op" id="4237882">.</span><span class="ident" id="4237883">WriteString</span><span class="op" id="4237894">(</span><span class="ident" id="4237895">w</span><span class="op" id="4237896">,</span>&nbsp;<span class="ident" id="4237898">h</span><span class="op" id="4237899">.</span><span class="ident" id="4237900">Name</span><span class="op" id="4237904">)</span><span class="op" id="4237905">;</span>&nbsp;<span class="ident" id="4237907">err</span>&nbsp;<span class="op" id="4237911">!=</span>&nbsp;<span class="ident" id="4237914">nil</span>&nbsp;<span class="op" id="4237918">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237922">return</span>&nbsp;<span class="ident" id="4237929">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4237934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237937">_</span><span class="op" id="4237938">,</span>&nbsp;<span class="ident" id="4237940">err</span>&nbsp;<span class="op" id="4237944">:=</span>&nbsp;<span class="ident" id="4237947">w</span><span class="op" id="4237948">.</span><span class="ident" id="4237949">Write</span><span class="op" id="4237954">(</span><span class="ident" id="4237955">h</span><span class="op" id="4237956">.</span><span class="ident" id="4237957">Extra</span><span class="op" id="4237962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237965">return</span>&nbsp;<span class="ident" id="4237972">err</span><br>
<span class="lineno"></span><span class="op" id="4237976">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="4237979">type</span>&nbsp;<span class="ident" id="4237984">fileWriter</span>&nbsp;<span class="keyword" id="4237995">struct</span>&nbsp;<span class="op" id="4238002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4238005">*</span><span class="ident" id="4238006">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238014">zipw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238024">io</span><span class="op" id="4238026">.</span><span class="ident" id="4238027">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238035">rawCount</span>&nbsp;&nbsp;<span class="op" id="4238045">*</span><span class="ident" id="4238046">countWriter</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238059">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238069">io</span><span class="op" id="4238071">.</span><span class="ident" id="4238072">WriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238085">compCount</span>&nbsp;<span class="op" id="4238095">*</span><span class="ident" id="4238096">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238109">crc32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238119">hash</span><span class="op" id="4238123">.</span><span class="ident" id="4238124">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238132">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4238142">bool</span><br>
<span class="lineno"></span><span class="op" id="4238147">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="4238150">func</span>&nbsp;<span class="op" id="4238155">(</span><span class="ident" id="4238156">w</span>&nbsp;<span class="op" id="4238158">*</span><span class="ident" id="4238159">fileWriter</span><span class="op" id="4238169">)</span>&nbsp;<span class="ident" id="4238171">Write</span><span class="op" id="4238176">(</span><span class="ident" id="4238177">p</span>&nbsp;<span class="op" id="4238179">[</span><span class="op" id="4238180">]</span><span class="builtintype" id="4238181">byte</span><span class="op" id="4238185">)</span>&nbsp;<span class="op" id="4238187">(</span><span class="builtintype" id="4238188">int</span><span class="op" id="4238191">,</span>&nbsp;<span class="builtintype" id="4238193">error</span><span class="op" id="4238198">)</span>&nbsp;<span class="op" id="4238200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238203">if</span>&nbsp;<span class="ident" id="4238206">w</span><span class="op" id="4238207">.</span><span class="ident" id="4238208">closed</span>&nbsp;<span class="op" id="4238215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238219">return</span>&nbsp;<span class="num" id="4238226">0</span><span class="op" id="4238227">,</span>&nbsp;<span class="ident" id="4238229">errors</span><span class="op" id="4238235">.</span><span class="ident" id="4238236">New</span><span class="op" id="4238239">(</span><span class="string" id="4238240">&#34;zip:&nbsp;write&nbsp;to&nbsp;closed&nbsp;file&#34;</span><span class="op" id="4238267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4238270">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238273">w</span><span class="op" id="4238274">.</span><span class="ident" id="4238275">crc32</span><span class="op" id="4238280">.</span><span class="ident" id="4238281">Write</span><span class="op" id="4238286">(</span><span class="ident" id="4238287">p</span><span class="op" id="4238288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238291">return</span>&nbsp;<span class="ident" id="4238298">w</span><span class="op" id="4238299">.</span><span class="ident" id="4238300">rawCount</span><span class="op" id="4238308">.</span><span class="ident" id="4238309">Write</span><span class="op" id="4238314">(</span><span class="ident" id="4238315">p</span><span class="op" id="4238316">)</span><br>
<span class="lineno"></span><span class="op" id="4238318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4238321">func</span>&nbsp;<span class="op" id="4238326">(</span><span class="ident" id="4238327">w</span>&nbsp;<span class="op" id="4238329">*</span><span class="ident" id="4238330">fileWriter</span><span class="op" id="4238340">)</span>&nbsp;<span class="builtinfunc" id="4238342">close</span><span class="op" id="4238347">(</span><span class="op" id="4238348">)</span>&nbsp;<span class="builtintype" id="4238350">error</span>&nbsp;<span class="op" id="4238356">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238359">if</span>&nbsp;<span class="ident" id="4238362">w</span><span class="op" id="4238363">.</span><span class="ident" id="4238364">closed</span>&nbsp;<span class="op" id="4238371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238375">return</span>&nbsp;<span class="ident" id="4238382">errors</span><span class="op" id="4238388">.</span><span class="ident" id="4238389">New</span><span class="op" id="4238392">(</span><span class="string" id="4238393">&#34;zip:&nbsp;file&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="4238417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4238420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238423">w</span><span class="op" id="4238424">.</span><span class="ident" id="4238425">closed</span>&nbsp;<span class="op" id="4238432">=</span>&nbsp;<span class="builtintype" id="4238434">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238440">if</span>&nbsp;<span class="ident" id="4238443">err</span>&nbsp;<span class="op" id="4238447">:=</span>&nbsp;<span class="ident" id="4238450">w</span><span class="op" id="4238451">.</span><span class="ident" id="4238452">comp</span><span class="op" id="4238456">.</span><span class="ident" id="4238457">Close</span><span class="op" id="4238462">(</span><span class="op" id="4238463">)</span><span class="op" id="4238464">;</span>&nbsp;<span class="ident" id="4238466">err</span>&nbsp;<span class="op" id="4238470">!=</span>&nbsp;<span class="ident" id="4238473">nil</span>&nbsp;<span class="op" id="4238477">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238481">return</span>&nbsp;<span class="ident" id="4238488">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4238493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4238497">//&nbsp;update&nbsp;FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238519">fh</span>&nbsp;<span class="op" id="4238522">:=</span>&nbsp;<span class="ident" id="4238525">w</span><span class="op" id="4238526">.</span><span class="ident" id="4238527">header</span><span class="op" id="4238533">.</span><span class="ident" id="4238534">FileHeader</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238546">fh</span><span class="op" id="4238548">.</span><span class="ident" id="4238549">CRC32</span>&nbsp;<span class="op" id="4238555">=</span>&nbsp;<span class="ident" id="4238557">w</span><span class="op" id="4238558">.</span><span class="ident" id="4238559">crc32</span><span class="op" id="4238564">.</span><span class="ident" id="4238565">Sum32</span><span class="op" id="4238570">(</span><span class="op" id="4238571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238574">fh</span><span class="op" id="4238576">.</span><span class="ident" id="4238577">CompressedSize64</span>&nbsp;<span class="op" id="4238594">=</span>&nbsp;<span class="ident" id="4238596">uint64</span><span class="op" id="4238602">(</span><span class="ident" id="4238603">w</span><span class="op" id="4238604">.</span><span class="ident" id="4238605">compCount</span><span class="op" id="4238614">.</span><span class="ident" id="4238615">count</span><span class="op" id="4238620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238623">fh</span><span class="op" id="4238625">.</span><span class="ident" id="4238626">UncompressedSize64</span>&nbsp;<span class="op" id="4238645">=</span>&nbsp;<span class="ident" id="4238647">uint64</span><span class="op" id="4238653">(</span><span class="ident" id="4238654">w</span><span class="op" id="4238655">.</span><span class="ident" id="4238656">rawCount</span><span class="op" id="4238664">.</span><span class="ident" id="4238665">count</span><span class="op" id="4238670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4238674">if</span>&nbsp;<span class="ident" id="4238677">fh</span><span class="op" id="4238679">.</span><span class="ident" id="4238680">isZip64</span><span class="op" id="4238687">(</span><span class="op" id="4238688">)</span>&nbsp;<span class="op" id="4238690">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238694">fh</span><span class="op" id="4238696">.</span><span class="ident" id="4238697">CompressedSize</span>&nbsp;<span class="op" id="4238712">=</span>&nbsp;<span class="ident" id="4238714">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238726">fh</span><span class="op" id="4238728">.</span><span class="ident" id="4238729">UncompressedSize</span>&nbsp;<span class="op" id="4238746">=</span>&nbsp;<span class="ident" id="4238748">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238760">fh</span><span class="op" id="4238762">.</span><span class="ident" id="4238763">ReaderVersion</span>&nbsp;<span class="op" id="4238777">=</span>&nbsp;<span class="ident" id="4238779">zipVersion45</span>&nbsp;<span class="comment" id="4238792">//&nbsp;requires&nbsp;4.5&nbsp;-&nbsp;File&nbsp;uses&nbsp;ZIP64&nbsp;format&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4238845">}</span>&nbsp;<span class="keyword" id="4238847">else</span>&nbsp;<span class="op" id="4238852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238856">fh</span><span class="op" id="4238858">.</span><span class="ident" id="4238859">CompressedSize</span>&nbsp;<span class="op" id="4238874">=</span>&nbsp;<span class="builtintype" id="4238876">uint32</span><span class="op" id="4238882">(</span><span class="ident" id="4238883">fh</span><span class="op" id="4238885">.</span><span class="ident" id="4238886">CompressedSize64</span><span class="op" id="4238902">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238906">fh</span><span class="op" id="4238908">.</span><span class="ident" id="4238909">UncompressedSize</span>&nbsp;<span class="op" id="4238926">=</span>&nbsp;<span class="builtintype" id="4238928">uint32</span><span class="op" id="4238934">(</span><span class="ident" id="4238935">fh</span><span class="op" id="4238937">.</span><span class="ident" id="4238938">UncompressedSize64</span><span class="op" id="4238956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4238959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4238963">//&nbsp;Write&nbsp;data&nbsp;descriptor.&nbsp;This&nbsp;is&nbsp;more&nbsp;complicated&nbsp;than&nbsp;one&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4239030">//&nbsp;think,&nbsp;see&nbsp;e.g.&nbsp;comments&nbsp;in&nbsp;zipfile.c:putextended()&nbsp;and</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4239090">//&nbsp;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7073588.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4239154">//&nbsp;The&nbsp;approach&nbsp;here&nbsp;is&nbsp;to&nbsp;write&nbsp;8&nbsp;byte&nbsp;sizes&nbsp;if&nbsp;needed&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4239219">//&nbsp;adding&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;in&nbsp;the&nbsp;local&nbsp;header&nbsp;(too&nbsp;late&nbsp;anyway).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4239283">var</span>&nbsp;<span class="ident" id="4239287">buf</span>&nbsp;<span class="op" id="4239291">[</span><span class="op" id="4239292">]</span><span class="builtintype" id="4239293">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4239299">if</span>&nbsp;<span class="ident" id="4239302">fh</span><span class="op" id="4239304">.</span><span class="ident" id="4239305">isZip64</span><span class="op" id="4239312">(</span><span class="op" id="4239313">)</span>&nbsp;<span class="op" id="4239315">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239319">buf</span>&nbsp;<span class="op" id="4239323">=</span>&nbsp;<span class="builtinfunc" id="4239325">make</span><span class="op" id="4239329">(</span><span class="op" id="4239330">[</span><span class="op" id="4239331">]</span><span class="builtintype" id="4239332">byte</span><span class="op" id="4239336">,</span>&nbsp;<span class="ident" id="4239338">dataDescriptor64Len</span><span class="op" id="4239357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4239360">}</span>&nbsp;<span class="keyword" id="4239362">else</span>&nbsp;<span class="op" id="4239367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239371">buf</span>&nbsp;<span class="op" id="4239375">=</span>&nbsp;<span class="builtinfunc" id="4239377">make</span><span class="op" id="4239381">(</span><span class="op" id="4239382">[</span><span class="op" id="4239383">]</span><span class="builtintype" id="4239384">byte</span><span class="op" id="4239388">,</span>&nbsp;<span class="ident" id="4239390">dataDescriptorLen</span><span class="op" id="4239407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4239410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239413">b</span>&nbsp;<span class="op" id="4239415">:=</span>&nbsp;<span class="ident" id="4239418">writeBuf</span><span class="op" id="4239426">(</span><span class="ident" id="4239427">buf</span><span class="op" id="4239430">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239433">b</span><span class="op" id="4239434">.</span><span class="builtintype" id="4239435">uint32</span><span class="op" id="4239441">(</span><span class="ident" id="4239442">dataDescriptorSignature</span><span class="op" id="4239465">)</span>&nbsp;<span class="comment" id="4239467">//&nbsp;de-facto&nbsp;standard,&nbsp;required&nbsp;by&nbsp;OS&nbsp;X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239507">b</span><span class="op" id="4239508">.</span><span class="builtintype" id="4239509">uint32</span><span class="op" id="4239515">(</span><span class="ident" id="4239516">fh</span><span class="op" id="4239518">.</span><span class="ident" id="4239519">CRC32</span><span class="op" id="4239524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4239527">if</span>&nbsp;<span class="ident" id="4239530">fh</span><span class="op" id="4239532">.</span><span class="ident" id="4239533">isZip64</span><span class="op" id="4239540">(</span><span class="op" id="4239541">)</span>&nbsp;<span class="op" id="4239543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239547">b</span><span class="op" id="4239548">.</span><span class="ident" id="4239549">uint64</span><span class="op" id="4239555">(</span><span class="ident" id="4239556">fh</span><span class="op" id="4239558">.</span><span class="ident" id="4239559">CompressedSize64</span><span class="op" id="4239575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239579">b</span><span class="op" id="4239580">.</span><span class="ident" id="4239581">uint64</span><span class="op" id="4239587">(</span><span class="ident" id="4239588">fh</span><span class="op" id="4239590">.</span><span class="ident" id="4239591">UncompressedSize64</span><span class="op" id="4239609">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4239612">}</span>&nbsp;<span class="keyword" id="4239614">else</span>&nbsp;<span class="op" id="4239619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239623">b</span><span class="op" id="4239624">.</span><span class="builtintype" id="4239625">uint32</span><span class="op" id="4239631">(</span><span class="ident" id="4239632">fh</span><span class="op" id="4239634">.</span><span class="ident" id="4239635">CompressedSize</span><span class="op" id="4239649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239653">b</span><span class="op" id="4239654">.</span><span class="builtintype" id="4239655">uint32</span><span class="op" id="4239661">(</span><span class="ident" id="4239662">fh</span><span class="op" id="4239664">.</span><span class="ident" id="4239665">UncompressedSize</span><span class="op" id="4239681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4239684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239687">_</span><span class="op" id="4239688">,</span>&nbsp;<span class="ident" id="4239690">err</span>&nbsp;<span class="op" id="4239694">:=</span>&nbsp;<span class="ident" id="4239697">w</span><span class="op" id="4239698">.</span><span class="ident" id="4239699">zipw</span><span class="op" id="4239703">.</span><span class="ident" id="4239704">Write</span><span class="op" id="4239709">(</span><span class="ident" id="4239710">buf</span><span class="op" id="4239713">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4239716">return</span>&nbsp;<span class="ident" id="4239723">err</span><br>
<span class="lineno"></span><span class="op" id="4239727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4239730">type</span>&nbsp;<span class="ident" id="4239735">countWriter</span>&nbsp;<span class="keyword" id="4239747">struct</span>&nbsp;<span class="op" id="4239754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239757">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4239763">io</span><span class="op" id="4239765">.</span><span class="ident" id="4239766">Writer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239774">count</span>&nbsp;<span class="ident" id="4239780">int64</span><br>
<span class="lineno"></span><span class="op" id="4239786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4239789">func</span>&nbsp;<span class="op" id="4239794">(</span><span class="ident" id="4239795">w</span>&nbsp;<span class="op" id="4239797">*</span><span class="ident" id="4239798">countWriter</span><span class="op" id="4239809">)</span>&nbsp;<span class="ident" id="4239811">Write</span><span class="op" id="4239816">(</span><span class="ident" id="4239817">p</span>&nbsp;<span class="op" id="4239819">[</span><span class="op" id="4239820">]</span><span class="builtintype" id="4239821">byte</span><span class="op" id="4239825">)</span>&nbsp;<span class="op" id="4239827">(</span><span class="builtintype" id="4239828">int</span><span class="op" id="4239831">,</span>&nbsp;<span class="builtintype" id="4239833">error</span><span class="op" id="4239838">)</span>&nbsp;<span class="op" id="4239840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239843">n</span><span class="op" id="4239844">,</span>&nbsp;<span class="ident" id="4239846">err</span>&nbsp;<span class="op" id="4239850">:=</span>&nbsp;<span class="ident" id="4239853">w</span><span class="op" id="4239854">.</span><span class="ident" id="4239855">w</span><span class="op" id="4239856">.</span><span class="ident" id="4239857">Write</span><span class="op" id="4239862">(</span><span class="ident" id="4239863">p</span><span class="op" id="4239864">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239867">w</span><span class="op" id="4239868">.</span><span class="ident" id="4239869">count</span>&nbsp;<span class="op" id="4239875">+=</span>&nbsp;<span class="ident" id="4239878">int64</span><span class="op" id="4239883">(</span><span class="ident" id="4239884">n</span><span class="op" id="4239885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4239888">return</span>&nbsp;<span class="ident" id="4239895">n</span><span class="op" id="4239896">,</span>&nbsp;<span class="ident" id="4239898">err</span><br>
<span class="lineno"></span><span class="op" id="4239902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4239905">type</span>&nbsp;<span class="ident" id="4239910">nopCloser</span>&nbsp;<span class="keyword" id="4239920">struct</span>&nbsp;<span class="op" id="4239927">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239930">io</span><span class="op" id="4239932">.</span><span class="ident" id="4239933">Writer</span><br>
<span class="lineno"></span><span class="op" id="4239940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4239943">func</span>&nbsp;<span class="op" id="4239948">(</span><span class="ident" id="4239949">w</span>&nbsp;<span class="ident" id="4239951">nopCloser</span><span class="op" id="4239960">)</span>&nbsp;<span class="ident" id="4239962">Close</span><span class="op" id="4239967">(</span><span class="op" id="4239968">)</span>&nbsp;<span class="builtintype" id="4239970">error</span>&nbsp;<span class="op" id="4239976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4239979">return</span>&nbsp;<span class="ident" id="4239986">nil</span><br>
<span class="lineno">340</span><span class="op" id="4239990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4239993">type</span>&nbsp;<span class="ident" id="4239998">writeBuf</span>&nbsp;<span class="op" id="4240007">[</span><span class="op" id="4240008">]</span><span class="builtintype" id="4240009">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4240015">func</span>&nbsp;<span class="op" id="4240020">(</span><span class="ident" id="4240021">b</span>&nbsp;<span class="op" id="4240023">*</span><span class="ident" id="4240024">writeBuf</span><span class="op" id="4240032">)</span>&nbsp;<span class="builtintype" id="4240034">uint16</span><span class="op" id="4240040">(</span><span class="ident" id="4240041">v</span>&nbsp;<span class="builtintype" id="4240043">uint16</span><span class="op" id="4240049">)</span>&nbsp;<span class="op" id="4240051">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240054">binary</span><span class="op" id="4240060">.</span><span class="ident" id="4240061">LittleEndian</span><span class="op" id="4240073">.</span><span class="ident" id="4240074">PutUint16</span><span class="op" id="4240083">(</span><span class="op" id="4240084">*</span><span class="ident" id="4240085">b</span><span class="op" id="4240086">,</span>&nbsp;<span class="ident" id="4240088">v</span><span class="op" id="4240089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4240092">*</span><span class="ident" id="4240093">b</span>&nbsp;<span class="op" id="4240095">=</span>&nbsp;<span class="op" id="4240097">(</span><span class="op" id="4240098">*</span><span class="ident" id="4240099">b</span><span class="op" id="4240100">)</span><span class="op" id="4240101">[</span><span class="num" id="4240102">2</span><span class="op" id="4240103">:</span><span class="op" id="4240104">]</span><br>
<span class="lineno"></span><span class="op" id="4240106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4240109">func</span>&nbsp;<span class="op" id="4240114">(</span><span class="ident" id="4240115">b</span>&nbsp;<span class="op" id="4240117">*</span><span class="ident" id="4240118">writeBuf</span><span class="op" id="4240126">)</span>&nbsp;<span class="builtintype" id="4240128">uint32</span><span class="op" id="4240134">(</span><span class="ident" id="4240135">v</span>&nbsp;<span class="builtintype" id="4240137">uint32</span><span class="op" id="4240143">)</span>&nbsp;<span class="op" id="4240145">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240148">binary</span><span class="op" id="4240154">.</span><span class="ident" id="4240155">LittleEndian</span><span class="op" id="4240167">.</span><span class="ident" id="4240168">PutUint32</span><span class="op" id="4240177">(</span><span class="op" id="4240178">*</span><span class="ident" id="4240179">b</span><span class="op" id="4240180">,</span>&nbsp;<span class="ident" id="4240182">v</span><span class="op" id="4240183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4240186">*</span><span class="ident" id="4240187">b</span>&nbsp;<span class="op" id="4240189">=</span>&nbsp;<span class="op" id="4240191">(</span><span class="op" id="4240192">*</span><span class="ident" id="4240193">b</span><span class="op" id="4240194">)</span><span class="op" id="4240195">[</span><span class="num" id="4240196">4</span><span class="op" id="4240197">:</span><span class="op" id="4240198">]</span><br>
<span class="lineno"></span><span class="op" id="4240200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4240203">func</span>&nbsp;<span class="op" id="4240208">(</span><span class="ident" id="4240209">b</span>&nbsp;<span class="op" id="4240211">*</span><span class="ident" id="4240212">writeBuf</span><span class="op" id="4240220">)</span>&nbsp;<span class="ident" id="4240222">uint64</span><span class="op" id="4240228">(</span><span class="ident" id="4240229">v</span>&nbsp;<span class="ident" id="4240231">uint64</span><span class="op" id="4240237">)</span>&nbsp;<span class="op" id="4240239">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240242">binary</span><span class="op" id="4240248">.</span><span class="ident" id="4240249">LittleEndian</span><span class="op" id="4240261">.</span><span class="ident" id="4240262">PutUint64</span><span class="op" id="4240271">(</span><span class="op" id="4240272">*</span><span class="ident" id="4240273">b</span><span class="op" id="4240274">,</span>&nbsp;<span class="ident" id="4240276">v</span><span class="op" id="4240277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4240280">*</span><span class="ident" id="4240281">b</span>&nbsp;<span class="op" id="4240283">=</span>&nbsp;<span class="op" id="4240285">(</span><span class="op" id="4240286">*</span><span class="ident" id="4240287">b</span><span class="op" id="4240288">)</span><span class="op" id="4240289">[</span><span class="num" id="4240290">8</span><span class="op" id="4240291">:</span><span class="op" id="4240292">]</span><br>
<span class="lineno"></span><span class="op" id="4240294">}</span>
</div>
</body>
</html>
