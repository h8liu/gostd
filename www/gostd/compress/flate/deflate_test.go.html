<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7732332">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7732387">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7732441">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7732492">package</span>&nbsp;<span class="ident" id="7732500">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7732507">import</span>&nbsp;<span class="op" id="7732514">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7732517">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7732526">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7732533">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7732539">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7732552">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7732563">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7732571">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7732581">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7732584">type</span>&nbsp;<span class="ident" id="7732589">deflateTest</span>&nbsp;<span class="keyword" id="7732601">struct</span>&nbsp;<span class="op" id="7732608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732611">in</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7732617">[</span><span class="op" id="7732618">]</span><span class="builtintype" id="7732619">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732625">level</span>&nbsp;<span class="builtintype" id="7732631">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732636">out</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7732642">[</span><span class="op" id="7732643">]</span><span class="builtintype" id="7732644">byte</span><br>
<span class="lineno"></span><span class="op" id="7732649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7732652">type</span>&nbsp;<span class="ident" id="7732657">deflateInflateTest</span>&nbsp;<span class="keyword" id="7732676">struct</span>&nbsp;<span class="op" id="7732683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732686">in</span>&nbsp;<span class="op" id="7732689">[</span><span class="op" id="7732690">]</span><span class="builtintype" id="7732691">byte</span><br>
<span class="lineno">25</span><span class="op" id="7732696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7732699">type</span>&nbsp;<span class="ident" id="7732704">reverseBitsTest</span>&nbsp;<span class="keyword" id="7732720">struct</span>&nbsp;<span class="op" id="7732727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732730">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7732739">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732747">bitCount</span>&nbsp;<span class="builtintype" id="7732756">uint8</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732763">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7732772">uint16</span><br>
<span class="lineno"></span><span class="op" id="7732779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7732782">var</span>&nbsp;<span class="ident" id="7732786">deflateTests</span>&nbsp;<span class="op" id="7732799">=</span>&nbsp;<span class="op" id="7732801">[</span><span class="op" id="7732802">]</span><span class="op" id="7732803">*</span><span class="ident" id="7732804">deflateTest</span><span class="op" id="7732815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732818">{</span><span class="op" id="7732819">[</span><span class="op" id="7732820">]</span><span class="builtintype" id="7732821">byte</span><span class="op" id="7732825">{</span><span class="op" id="7732826">}</span><span class="op" id="7732827">,</span>&nbsp;<span class="num" id="7732829">0</span><span class="op" id="7732830">,</span>&nbsp;<span class="op" id="7732832">[</span><span class="op" id="7732833">]</span><span class="builtintype" id="7732834">byte</span><span class="op" id="7732838">{</span><span class="num" id="7732839">1</span><span class="op" id="7732840">,</span>&nbsp;<span class="num" id="7732842">0</span><span class="op" id="7732843">,</span>&nbsp;<span class="num" id="7732845">0</span><span class="op" id="7732846">,</span>&nbsp;<span class="num" id="7732848">255</span><span class="op" id="7732851">,</span>&nbsp;<span class="num" id="7732853">255</span><span class="op" id="7732856">}</span><span class="op" id="7732857">}</span><span class="op" id="7732858">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732861">{</span><span class="op" id="7732862">[</span><span class="op" id="7732863">]</span><span class="builtintype" id="7732864">byte</span><span class="op" id="7732868">{</span><span class="num" id="7732869">0x11</span><span class="op" id="7732873">}</span><span class="op" id="7732874">,</span>&nbsp;<span class="op" id="7732876">-</span><span class="num" id="7732877">1</span><span class="op" id="7732878">,</span>&nbsp;<span class="op" id="7732880">[</span><span class="op" id="7732881">]</span><span class="builtintype" id="7732882">byte</span><span class="op" id="7732886">{</span><span class="num" id="7732887">18</span><span class="op" id="7732889">,</span>&nbsp;<span class="num" id="7732891">4</span><span class="op" id="7732892">,</span>&nbsp;<span class="num" id="7732894">4</span><span class="op" id="7732895">,</span>&nbsp;<span class="num" id="7732897">0</span><span class="op" id="7732898">,</span>&nbsp;<span class="num" id="7732900">0</span><span class="op" id="7732901">,</span>&nbsp;<span class="num" id="7732903">255</span><span class="op" id="7732906">,</span>&nbsp;<span class="num" id="7732908">255</span><span class="op" id="7732911">}</span><span class="op" id="7732912">}</span><span class="op" id="7732913">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732916">{</span><span class="op" id="7732917">[</span><span class="op" id="7732918">]</span><span class="builtintype" id="7732919">byte</span><span class="op" id="7732923">{</span><span class="num" id="7732924">0x11</span><span class="op" id="7732928">}</span><span class="op" id="7732929">,</span>&nbsp;<span class="ident" id="7732931">DefaultCompression</span><span class="op" id="7732949">,</span>&nbsp;<span class="op" id="7732951">[</span><span class="op" id="7732952">]</span><span class="builtintype" id="7732953">byte</span><span class="op" id="7732957">{</span><span class="num" id="7732958">18</span><span class="op" id="7732960">,</span>&nbsp;<span class="num" id="7732962">4</span><span class="op" id="7732963">,</span>&nbsp;<span class="num" id="7732965">4</span><span class="op" id="7732966">,</span>&nbsp;<span class="num" id="7732968">0</span><span class="op" id="7732969">,</span>&nbsp;<span class="num" id="7732971">0</span><span class="op" id="7732972">,</span>&nbsp;<span class="num" id="7732974">255</span><span class="op" id="7732977">,</span>&nbsp;<span class="num" id="7732979">255</span><span class="op" id="7732982">}</span><span class="op" id="7732983">}</span><span class="op" id="7732984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732987">{</span><span class="op" id="7732988">[</span><span class="op" id="7732989">]</span><span class="builtintype" id="7732990">byte</span><span class="op" id="7732994">{</span><span class="num" id="7732995">0x11</span><span class="op" id="7732999">}</span><span class="op" id="7733000">,</span>&nbsp;<span class="num" id="7733002">4</span><span class="op" id="7733003">,</span>&nbsp;<span class="op" id="7733005">[</span><span class="op" id="7733006">]</span><span class="builtintype" id="7733007">byte</span><span class="op" id="7733011">{</span><span class="num" id="7733012">18</span><span class="op" id="7733014">,</span>&nbsp;<span class="num" id="7733016">4</span><span class="op" id="7733017">,</span>&nbsp;<span class="num" id="7733019">4</span><span class="op" id="7733020">,</span>&nbsp;<span class="num" id="7733022">0</span><span class="op" id="7733023">,</span>&nbsp;<span class="num" id="7733025">0</span><span class="op" id="7733026">,</span>&nbsp;<span class="num" id="7733028">255</span><span class="op" id="7733031">,</span>&nbsp;<span class="num" id="7733033">255</span><span class="op" id="7733036">}</span><span class="op" id="7733037">}</span><span class="op" id="7733038">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733042">{</span><span class="op" id="7733043">[</span><span class="op" id="7733044">]</span><span class="builtintype" id="7733045">byte</span><span class="op" id="7733049">{</span><span class="num" id="7733050">0x11</span><span class="op" id="7733054">}</span><span class="op" id="7733055">,</span>&nbsp;<span class="num" id="7733057">0</span><span class="op" id="7733058">,</span>&nbsp;<span class="op" id="7733060">[</span><span class="op" id="7733061">]</span><span class="builtintype" id="7733062">byte</span><span class="op" id="7733066">{</span><span class="num" id="7733067">0</span><span class="op" id="7733068">,</span>&nbsp;<span class="num" id="7733070">1</span><span class="op" id="7733071">,</span>&nbsp;<span class="num" id="7733073">0</span><span class="op" id="7733074">,</span>&nbsp;<span class="num" id="7733076">254</span><span class="op" id="7733079">,</span>&nbsp;<span class="num" id="7733081">255</span><span class="op" id="7733084">,</span>&nbsp;<span class="num" id="7733086">17</span><span class="op" id="7733088">,</span>&nbsp;<span class="num" id="7733090">1</span><span class="op" id="7733091">,</span>&nbsp;<span class="num" id="7733093">0</span><span class="op" id="7733094">,</span>&nbsp;<span class="num" id="7733096">0</span><span class="op" id="7733097">,</span>&nbsp;<span class="num" id="7733099">255</span><span class="op" id="7733102">,</span>&nbsp;<span class="num" id="7733104">255</span><span class="op" id="7733107">}</span><span class="op" id="7733108">}</span><span class="op" id="7733109">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733112">{</span><span class="op" id="7733113">[</span><span class="op" id="7733114">]</span><span class="builtintype" id="7733115">byte</span><span class="op" id="7733119">{</span><span class="num" id="7733120">0x11</span><span class="op" id="7733124">,</span>&nbsp;<span class="num" id="7733126">0x12</span><span class="op" id="7733130">}</span><span class="op" id="7733131">,</span>&nbsp;<span class="num" id="7733133">0</span><span class="op" id="7733134">,</span>&nbsp;<span class="op" id="7733136">[</span><span class="op" id="7733137">]</span><span class="builtintype" id="7733138">byte</span><span class="op" id="7733142">{</span><span class="num" id="7733143">0</span><span class="op" id="7733144">,</span>&nbsp;<span class="num" id="7733146">2</span><span class="op" id="7733147">,</span>&nbsp;<span class="num" id="7733149">0</span><span class="op" id="7733150">,</span>&nbsp;<span class="num" id="7733152">253</span><span class="op" id="7733155">,</span>&nbsp;<span class="num" id="7733157">255</span><span class="op" id="7733160">,</span>&nbsp;<span class="num" id="7733162">17</span><span class="op" id="7733164">,</span>&nbsp;<span class="num" id="7733166">18</span><span class="op" id="7733168">,</span>&nbsp;<span class="num" id="7733170">1</span><span class="op" id="7733171">,</span>&nbsp;<span class="num" id="7733173">0</span><span class="op" id="7733174">,</span>&nbsp;<span class="num" id="7733176">0</span><span class="op" id="7733177">,</span>&nbsp;<span class="num" id="7733179">255</span><span class="op" id="7733182">,</span>&nbsp;<span class="num" id="7733184">255</span><span class="op" id="7733187">}</span><span class="op" id="7733188">}</span><span class="op" id="7733189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733192">{</span><span class="op" id="7733193">[</span><span class="op" id="7733194">]</span><span class="builtintype" id="7733195">byte</span><span class="op" id="7733199">{</span><span class="num" id="7733200">0x11</span><span class="op" id="7733204">,</span>&nbsp;<span class="num" id="7733206">0x11</span><span class="op" id="7733210">,</span>&nbsp;<span class="num" id="7733212">0x11</span><span class="op" id="7733216">,</span>&nbsp;<span class="num" id="7733218">0x11</span><span class="op" id="7733222">,</span>&nbsp;<span class="num" id="7733224">0x11</span><span class="op" id="7733228">,</span>&nbsp;<span class="num" id="7733230">0x11</span><span class="op" id="7733234">,</span>&nbsp;<span class="num" id="7733236">0x11</span><span class="op" id="7733240">,</span>&nbsp;<span class="num" id="7733242">0x11</span><span class="op" id="7733246">}</span><span class="op" id="7733247">,</span>&nbsp;<span class="num" id="7733249">0</span><span class="op" id="7733250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733254">[</span><span class="op" id="7733255">]</span><span class="builtintype" id="7733256">byte</span><span class="op" id="7733260">{</span><span class="num" id="7733261">0</span><span class="op" id="7733262">,</span>&nbsp;<span class="num" id="7733264">8</span><span class="op" id="7733265">,</span>&nbsp;<span class="num" id="7733267">0</span><span class="op" id="7733268">,</span>&nbsp;<span class="num" id="7733270">247</span><span class="op" id="7733273">,</span>&nbsp;<span class="num" id="7733275">255</span><span class="op" id="7733278">,</span>&nbsp;<span class="num" id="7733280">17</span><span class="op" id="7733282">,</span>&nbsp;<span class="num" id="7733284">17</span><span class="op" id="7733286">,</span>&nbsp;<span class="num" id="7733288">17</span><span class="op" id="7733290">,</span>&nbsp;<span class="num" id="7733292">17</span><span class="op" id="7733294">,</span>&nbsp;<span class="num" id="7733296">17</span><span class="op" id="7733298">,</span>&nbsp;<span class="num" id="7733300">17</span><span class="op" id="7733302">,</span>&nbsp;<span class="num" id="7733304">17</span><span class="op" id="7733306">,</span>&nbsp;<span class="num" id="7733308">17</span><span class="op" id="7733310">,</span>&nbsp;<span class="num" id="7733312">1</span><span class="op" id="7733313">,</span>&nbsp;<span class="num" id="7733315">0</span><span class="op" id="7733316">,</span>&nbsp;<span class="num" id="7733318">0</span><span class="op" id="7733319">,</span>&nbsp;<span class="num" id="7733321">255</span><span class="op" id="7733324">,</span>&nbsp;<span class="num" id="7733326">255</span><span class="op" id="7733329">}</span><span class="op" id="7733330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733333">}</span><span class="op" id="7733334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733337">{</span><span class="op" id="7733338">[</span><span class="op" id="7733339">]</span><span class="builtintype" id="7733340">byte</span><span class="op" id="7733344">{</span><span class="op" id="7733345">}</span><span class="op" id="7733346">,</span>&nbsp;<span class="num" id="7733348">1</span><span class="op" id="7733349">,</span>&nbsp;<span class="op" id="7733351">[</span><span class="op" id="7733352">]</span><span class="builtintype" id="7733353">byte</span><span class="op" id="7733357">{</span><span class="num" id="7733358">1</span><span class="op" id="7733359">,</span>&nbsp;<span class="num" id="7733361">0</span><span class="op" id="7733362">,</span>&nbsp;<span class="num" id="7733364">0</span><span class="op" id="7733365">,</span>&nbsp;<span class="num" id="7733367">255</span><span class="op" id="7733370">,</span>&nbsp;<span class="num" id="7733372">255</span><span class="op" id="7733375">}</span><span class="op" id="7733376">}</span><span class="op" id="7733377">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733380">{</span><span class="op" id="7733381">[</span><span class="op" id="7733382">]</span><span class="builtintype" id="7733383">byte</span><span class="op" id="7733387">{</span><span class="num" id="7733388">0x11</span><span class="op" id="7733392">}</span><span class="op" id="7733393">,</span>&nbsp;<span class="num" id="7733395">1</span><span class="op" id="7733396">,</span>&nbsp;<span class="op" id="7733398">[</span><span class="op" id="7733399">]</span><span class="builtintype" id="7733400">byte</span><span class="op" id="7733404">{</span><span class="num" id="7733405">18</span><span class="op" id="7733407">,</span>&nbsp;<span class="num" id="7733409">4</span><span class="op" id="7733410">,</span>&nbsp;<span class="num" id="7733412">4</span><span class="op" id="7733413">,</span>&nbsp;<span class="num" id="7733415">0</span><span class="op" id="7733416">,</span>&nbsp;<span class="num" id="7733418">0</span><span class="op" id="7733419">,</span>&nbsp;<span class="num" id="7733421">255</span><span class="op" id="7733424">,</span>&nbsp;<span class="num" id="7733426">255</span><span class="op" id="7733429">}</span><span class="op" id="7733430">}</span><span class="op" id="7733431">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733434">{</span><span class="op" id="7733435">[</span><span class="op" id="7733436">]</span><span class="builtintype" id="7733437">byte</span><span class="op" id="7733441">{</span><span class="num" id="7733442">0x11</span><span class="op" id="7733446">,</span>&nbsp;<span class="num" id="7733448">0x12</span><span class="op" id="7733452">}</span><span class="op" id="7733453">,</span>&nbsp;<span class="num" id="7733455">1</span><span class="op" id="7733456">,</span>&nbsp;<span class="op" id="7733458">[</span><span class="op" id="7733459">]</span><span class="builtintype" id="7733460">byte</span><span class="op" id="7733464">{</span><span class="num" id="7733465">18</span><span class="op" id="7733467">,</span>&nbsp;<span class="num" id="7733469">20</span><span class="op" id="7733471">,</span>&nbsp;<span class="num" id="7733473">2</span><span class="op" id="7733474">,</span>&nbsp;<span class="num" id="7733476">4</span><span class="op" id="7733477">,</span>&nbsp;<span class="num" id="7733479">0</span><span class="op" id="7733480">,</span>&nbsp;<span class="num" id="7733482">0</span><span class="op" id="7733483">,</span>&nbsp;<span class="num" id="7733485">255</span><span class="op" id="7733488">,</span>&nbsp;<span class="num" id="7733490">255</span><span class="op" id="7733493">}</span><span class="op" id="7733494">}</span><span class="op" id="7733495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733498">{</span><span class="op" id="7733499">[</span><span class="op" id="7733500">]</span><span class="builtintype" id="7733501">byte</span><span class="op" id="7733505">{</span><span class="num" id="7733506">0x11</span><span class="op" id="7733510">,</span>&nbsp;<span class="num" id="7733512">0x11</span><span class="op" id="7733516">,</span>&nbsp;<span class="num" id="7733518">0x11</span><span class="op" id="7733522">,</span>&nbsp;<span class="num" id="7733524">0x11</span><span class="op" id="7733528">,</span>&nbsp;<span class="num" id="7733530">0x11</span><span class="op" id="7733534">,</span>&nbsp;<span class="num" id="7733536">0x11</span><span class="op" id="7733540">,</span>&nbsp;<span class="num" id="7733542">0x11</span><span class="op" id="7733546">,</span>&nbsp;<span class="num" id="7733548">0x11</span><span class="op" id="7733552">}</span><span class="op" id="7733553">,</span>&nbsp;<span class="num" id="7733555">1</span><span class="op" id="7733556">,</span>&nbsp;<span class="op" id="7733558">[</span><span class="op" id="7733559">]</span><span class="builtintype" id="7733560">byte</span><span class="op" id="7733564">{</span><span class="num" id="7733565">18</span><span class="op" id="7733567">,</span>&nbsp;<span class="num" id="7733569">132</span><span class="op" id="7733572">,</span>&nbsp;<span class="num" id="7733574">2</span><span class="op" id="7733575">,</span>&nbsp;<span class="num" id="7733577">64</span><span class="op" id="7733579">,</span>&nbsp;<span class="num" id="7733581">0</span><span class="op" id="7733582">,</span>&nbsp;<span class="num" id="7733584">0</span><span class="op" id="7733585">,</span>&nbsp;<span class="num" id="7733587">0</span><span class="op" id="7733588">,</span>&nbsp;<span class="num" id="7733590">255</span><span class="op" id="7733593">,</span>&nbsp;<span class="num" id="7733595">255</span><span class="op" id="7733598">}</span><span class="op" id="7733599">}</span><span class="op" id="7733600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733603">{</span><span class="op" id="7733604">[</span><span class="op" id="7733605">]</span><span class="builtintype" id="7733606">byte</span><span class="op" id="7733610">{</span><span class="op" id="7733611">}</span><span class="op" id="7733612">,</span>&nbsp;<span class="num" id="7733614">9</span><span class="op" id="7733615">,</span>&nbsp;<span class="op" id="7733617">[</span><span class="op" id="7733618">]</span><span class="builtintype" id="7733619">byte</span><span class="op" id="7733623">{</span><span class="num" id="7733624">1</span><span class="op" id="7733625">,</span>&nbsp;<span class="num" id="7733627">0</span><span class="op" id="7733628">,</span>&nbsp;<span class="num" id="7733630">0</span><span class="op" id="7733631">,</span>&nbsp;<span class="num" id="7733633">255</span><span class="op" id="7733636">,</span>&nbsp;<span class="num" id="7733638">255</span><span class="op" id="7733641">}</span><span class="op" id="7733642">}</span><span class="op" id="7733643">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733646">{</span><span class="op" id="7733647">[</span><span class="op" id="7733648">]</span><span class="builtintype" id="7733649">byte</span><span class="op" id="7733653">{</span><span class="num" id="7733654">0x11</span><span class="op" id="7733658">}</span><span class="op" id="7733659">,</span>&nbsp;<span class="num" id="7733661">9</span><span class="op" id="7733662">,</span>&nbsp;<span class="op" id="7733664">[</span><span class="op" id="7733665">]</span><span class="builtintype" id="7733666">byte</span><span class="op" id="7733670">{</span><span class="num" id="7733671">18</span><span class="op" id="7733673">,</span>&nbsp;<span class="num" id="7733675">4</span><span class="op" id="7733676">,</span>&nbsp;<span class="num" id="7733678">4</span><span class="op" id="7733679">,</span>&nbsp;<span class="num" id="7733681">0</span><span class="op" id="7733682">,</span>&nbsp;<span class="num" id="7733684">0</span><span class="op" id="7733685">,</span>&nbsp;<span class="num" id="7733687">255</span><span class="op" id="7733690">,</span>&nbsp;<span class="num" id="7733692">255</span><span class="op" id="7733695">}</span><span class="op" id="7733696">}</span><span class="op" id="7733697">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733700">{</span><span class="op" id="7733701">[</span><span class="op" id="7733702">]</span><span class="builtintype" id="7733703">byte</span><span class="op" id="7733707">{</span><span class="num" id="7733708">0x11</span><span class="op" id="7733712">,</span>&nbsp;<span class="num" id="7733714">0x12</span><span class="op" id="7733718">}</span><span class="op" id="7733719">,</span>&nbsp;<span class="num" id="7733721">9</span><span class="op" id="7733722">,</span>&nbsp;<span class="op" id="7733724">[</span><span class="op" id="7733725">]</span><span class="builtintype" id="7733726">byte</span><span class="op" id="7733730">{</span><span class="num" id="7733731">18</span><span class="op" id="7733733">,</span>&nbsp;<span class="num" id="7733735">20</span><span class="op" id="7733737">,</span>&nbsp;<span class="num" id="7733739">2</span><span class="op" id="7733740">,</span>&nbsp;<span class="num" id="7733742">4</span><span class="op" id="7733743">,</span>&nbsp;<span class="num" id="7733745">0</span><span class="op" id="7733746">,</span>&nbsp;<span class="num" id="7733748">0</span><span class="op" id="7733749">,</span>&nbsp;<span class="num" id="7733751">255</span><span class="op" id="7733754">,</span>&nbsp;<span class="num" id="7733756">255</span><span class="op" id="7733759">}</span><span class="op" id="7733760">}</span><span class="op" id="7733761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733764">{</span><span class="op" id="7733765">[</span><span class="op" id="7733766">]</span><span class="builtintype" id="7733767">byte</span><span class="op" id="7733771">{</span><span class="num" id="7733772">0x11</span><span class="op" id="7733776">,</span>&nbsp;<span class="num" id="7733778">0x11</span><span class="op" id="7733782">,</span>&nbsp;<span class="num" id="7733784">0x11</span><span class="op" id="7733788">,</span>&nbsp;<span class="num" id="7733790">0x11</span><span class="op" id="7733794">,</span>&nbsp;<span class="num" id="7733796">0x11</span><span class="op" id="7733800">,</span>&nbsp;<span class="num" id="7733802">0x11</span><span class="op" id="7733806">,</span>&nbsp;<span class="num" id="7733808">0x11</span><span class="op" id="7733812">,</span>&nbsp;<span class="num" id="7733814">0x11</span><span class="op" id="7733818">}</span><span class="op" id="7733819">,</span>&nbsp;<span class="num" id="7733821">9</span><span class="op" id="7733822">,</span>&nbsp;<span class="op" id="7733824">[</span><span class="op" id="7733825">]</span><span class="builtintype" id="7733826">byte</span><span class="op" id="7733830">{</span><span class="num" id="7733831">18</span><span class="op" id="7733833">,</span>&nbsp;<span class="num" id="7733835">132</span><span class="op" id="7733838">,</span>&nbsp;<span class="num" id="7733840">2</span><span class="op" id="7733841">,</span>&nbsp;<span class="num" id="7733843">64</span><span class="op" id="7733845">,</span>&nbsp;<span class="num" id="7733847">0</span><span class="op" id="7733848">,</span>&nbsp;<span class="num" id="7733850">0</span><span class="op" id="7733851">,</span>&nbsp;<span class="num" id="7733853">0</span><span class="op" id="7733854">,</span>&nbsp;<span class="num" id="7733856">255</span><span class="op" id="7733859">,</span>&nbsp;<span class="num" id="7733861">255</span><span class="op" id="7733864">}</span><span class="op" id="7733865">}</span><span class="op" id="7733866">,</span><br>
<span class="lineno"></span><span class="op" id="7733868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7733871">var</span>&nbsp;<span class="ident" id="7733875">deflateInflateTests</span>&nbsp;<span class="op" id="7733895">=</span>&nbsp;<span class="op" id="7733897">[</span><span class="op" id="7733898">]</span><span class="op" id="7733899">*</span><span class="ident" id="7733900">deflateInflateTest</span><span class="op" id="7733918">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733921">{</span><span class="op" id="7733922">[</span><span class="op" id="7733923">]</span><span class="builtintype" id="7733924">byte</span><span class="op" id="7733928">{</span><span class="op" id="7733929">}</span><span class="op" id="7733930">}</span><span class="op" id="7733931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733934">{</span><span class="op" id="7733935">[</span><span class="op" id="7733936">]</span><span class="builtintype" id="7733937">byte</span><span class="op" id="7733941">{</span><span class="num" id="7733942">0x11</span><span class="op" id="7733946">}</span><span class="op" id="7733947">}</span><span class="op" id="7733948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733951">{</span><span class="op" id="7733952">[</span><span class="op" id="7733953">]</span><span class="builtintype" id="7733954">byte</span><span class="op" id="7733958">{</span><span class="num" id="7733959">0x11</span><span class="op" id="7733963">,</span>&nbsp;<span class="num" id="7733965">0x12</span><span class="op" id="7733969">}</span><span class="op" id="7733970">}</span><span class="op" id="7733971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733974">{</span><span class="op" id="7733975">[</span><span class="op" id="7733976">]</span><span class="builtintype" id="7733977">byte</span><span class="op" id="7733981">{</span><span class="num" id="7733982">0x11</span><span class="op" id="7733986">,</span>&nbsp;<span class="num" id="7733988">0x11</span><span class="op" id="7733992">,</span>&nbsp;<span class="num" id="7733994">0x11</span><span class="op" id="7733998">,</span>&nbsp;<span class="num" id="7734000">0x11</span><span class="op" id="7734004">,</span>&nbsp;<span class="num" id="7734006">0x11</span><span class="op" id="7734010">,</span>&nbsp;<span class="num" id="7734012">0x11</span><span class="op" id="7734016">,</span>&nbsp;<span class="num" id="7734018">0x11</span><span class="op" id="7734022">,</span>&nbsp;<span class="num" id="7734024">0x11</span><span class="op" id="7734028">}</span><span class="op" id="7734029">}</span><span class="op" id="7734030">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734033">{</span><span class="op" id="7734034">[</span><span class="op" id="7734035">]</span><span class="builtintype" id="7734036">byte</span><span class="op" id="7734040">{</span><span class="num" id="7734041">0x11</span><span class="op" id="7734045">,</span>&nbsp;<span class="num" id="7734047">0x10</span><span class="op" id="7734051">,</span>&nbsp;<span class="num" id="7734053">0x13</span><span class="op" id="7734057">,</span>&nbsp;<span class="num" id="7734059">0x41</span><span class="op" id="7734063">,</span>&nbsp;<span class="num" id="7734065">0x21</span><span class="op" id="7734069">,</span>&nbsp;<span class="num" id="7734071">0x21</span><span class="op" id="7734075">,</span>&nbsp;<span class="num" id="7734077">0x41</span><span class="op" id="7734081">,</span>&nbsp;<span class="num" id="7734083">0x13</span><span class="op" id="7734087">,</span>&nbsp;<span class="num" id="7734089">0x87</span><span class="op" id="7734093">,</span>&nbsp;<span class="num" id="7734095">0x78</span><span class="op" id="7734099">,</span>&nbsp;<span class="num" id="7734101">0x13</span><span class="op" id="7734105">}</span><span class="op" id="7734106">}</span><span class="op" id="7734107">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734110">{</span><span class="ident" id="7734111">largeDataChunk</span><span class="op" id="7734125">(</span><span class="op" id="7734126">)</span><span class="op" id="7734127">}</span><span class="op" id="7734128">,</span><br>
<span class="lineno"></span><span class="op" id="7734130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7734133">var</span>&nbsp;<span class="ident" id="7734137">reverseBitsTests</span>&nbsp;<span class="op" id="7734154">=</span>&nbsp;<span class="op" id="7734156">[</span><span class="op" id="7734157">]</span><span class="op" id="7734158">*</span><span class="ident" id="7734159">reverseBitsTest</span><span class="op" id="7734174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734177">{</span><span class="num" id="7734178">1</span><span class="op" id="7734179">,</span>&nbsp;<span class="num" id="7734181">1</span><span class="op" id="7734182">,</span>&nbsp;<span class="num" id="7734184">1</span><span class="op" id="7734185">}</span><span class="op" id="7734186">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734189">{</span><span class="num" id="7734190">1</span><span class="op" id="7734191">,</span>&nbsp;<span class="num" id="7734193">2</span><span class="op" id="7734194">,</span>&nbsp;<span class="num" id="7734196">2</span><span class="op" id="7734197">}</span><span class="op" id="7734198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734201">{</span><span class="num" id="7734202">1</span><span class="op" id="7734203">,</span>&nbsp;<span class="num" id="7734205">3</span><span class="op" id="7734206">,</span>&nbsp;<span class="num" id="7734208">4</span><span class="op" id="7734209">}</span><span class="op" id="7734210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734213">{</span><span class="num" id="7734214">1</span><span class="op" id="7734215">,</span>&nbsp;<span class="num" id="7734217">4</span><span class="op" id="7734218">,</span>&nbsp;<span class="num" id="7734220">8</span><span class="op" id="7734221">}</span><span class="op" id="7734222">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734225">{</span><span class="num" id="7734226">1</span><span class="op" id="7734227">,</span>&nbsp;<span class="num" id="7734229">5</span><span class="op" id="7734230">,</span>&nbsp;<span class="num" id="7734232">16</span><span class="op" id="7734234">}</span><span class="op" id="7734235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734238">{</span><span class="num" id="7734239">17</span><span class="op" id="7734241">,</span>&nbsp;<span class="num" id="7734243">5</span><span class="op" id="7734244">,</span>&nbsp;<span class="num" id="7734246">17</span><span class="op" id="7734248">}</span><span class="op" id="7734249">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734252">{</span><span class="num" id="7734253">257</span><span class="op" id="7734256">,</span>&nbsp;<span class="num" id="7734258">9</span><span class="op" id="7734259">,</span>&nbsp;<span class="num" id="7734261">257</span><span class="op" id="7734264">}</span><span class="op" id="7734265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734268">{</span><span class="num" id="7734269">29</span><span class="op" id="7734271">,</span>&nbsp;<span class="num" id="7734273">5</span><span class="op" id="7734274">,</span>&nbsp;<span class="num" id="7734276">23</span><span class="op" id="7734278">}</span><span class="op" id="7734279">,</span><br>
<span class="lineno"></span><span class="op" id="7734281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7734284">func</span>&nbsp;<span class="ident" id="7734289">largeDataChunk</span><span class="op" id="7734303">(</span><span class="op" id="7734304">)</span>&nbsp;<span class="op" id="7734306">[</span><span class="op" id="7734307">]</span><span class="builtintype" id="7734308">byte</span>&nbsp;<span class="op" id="7734313">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734316">result</span>&nbsp;<span class="op" id="7734323">:=</span>&nbsp;<span class="builtinfunc" id="7734326">make</span><span class="op" id="7734330">(</span><span class="op" id="7734331">[</span><span class="op" id="7734332">]</span><span class="builtintype" id="7734333">byte</span><span class="op" id="7734337">,</span>&nbsp;<span class="num" id="7734339">100000</span><span class="op" id="7734345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734348">for</span>&nbsp;<span class="ident" id="7734352">i</span>&nbsp;<span class="op" id="7734354">:=</span>&nbsp;<span class="keyword" id="7734357">range</span>&nbsp;<span class="ident" id="7734363">result</span>&nbsp;<span class="op" id="7734370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734374">result</span><span class="op" id="7734380">[</span><span class="ident" id="7734381">i</span><span class="op" id="7734382">]</span>&nbsp;<span class="op" id="7734384">=</span>&nbsp;<span class="builtintype" id="7734386">byte</span><span class="op" id="7734390">(</span><span class="ident" id="7734391">i</span>&nbsp;<span class="op" id="7734393">*</span>&nbsp;<span class="ident" id="7734395">i</span>&nbsp;<span class="op" id="7734397">&amp;</span>&nbsp;<span class="num" id="7734399">0xFF</span><span class="op" id="7734403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734409">return</span>&nbsp;<span class="ident" id="7734416">result</span><br>
<span class="lineno">80</span><span class="op" id="7734423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7734426">func</span>&nbsp;<span class="ident" id="7734431">TestDeflate</span><span class="op" id="7734442">(</span><span class="ident" id="7734443">t</span>&nbsp;<span class="op" id="7734445">*</span><span class="ident" id="7734446">testing</span><span class="op" id="7734453">.</span><span class="ident" id="7734454">T</span><span class="op" id="7734455">)</span>&nbsp;<span class="op" id="7734457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734460">for</span>&nbsp;<span class="ident" id="7734464">_</span><span class="op" id="7734465">,</span>&nbsp;<span class="ident" id="7734467">h</span>&nbsp;<span class="op" id="7734469">:=</span>&nbsp;<span class="keyword" id="7734472">range</span>&nbsp;<span class="ident" id="7734478">deflateTests</span>&nbsp;<span class="op" id="7734491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734495">var</span>&nbsp;<span class="ident" id="7734499">buf</span>&nbsp;<span class="ident" id="7734503">bytes</span><span class="op" id="7734508">.</span><span class="ident" id="7734509">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734518">w</span><span class="op" id="7734519">,</span>&nbsp;<span class="ident" id="7734521">err</span>&nbsp;<span class="op" id="7734525">:=</span>&nbsp;<span class="ident" id="7734528">NewWriter</span><span class="op" id="7734537">(</span><span class="op" id="7734538">&amp;</span><span class="ident" id="7734539">buf</span><span class="op" id="7734542">,</span>&nbsp;<span class="ident" id="7734544">h</span><span class="op" id="7734545">.</span><span class="ident" id="7734546">level</span><span class="op" id="7734551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734555">if</span>&nbsp;<span class="ident" id="7734558">err</span>&nbsp;<span class="op" id="7734562">!=</span>&nbsp;<span class="ident" id="7734565">nil</span>&nbsp;<span class="op" id="7734569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734574">t</span><span class="op" id="7734575">.</span><span class="ident" id="7734576">Errorf</span><span class="op" id="7734582">(</span><span class="string" id="7734583">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7734598">,</span>&nbsp;<span class="ident" id="7734600">err</span><span class="op" id="7734603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734608">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734619">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734623">w</span><span class="op" id="7734624">.</span><span class="ident" id="7734625">Write</span><span class="op" id="7734630">(</span><span class="ident" id="7734631">h</span><span class="op" id="7734632">.</span><span class="ident" id="7734633">in</span><span class="op" id="7734635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734639">w</span><span class="op" id="7734640">.</span><span class="ident" id="7734641">Close</span><span class="op" id="7734646">(</span><span class="op" id="7734647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734651">if</span>&nbsp;<span class="op" id="7734654">!</span><span class="ident" id="7734655">bytes</span><span class="op" id="7734660">.</span><span class="ident" id="7734661">Equal</span><span class="op" id="7734666">(</span><span class="ident" id="7734667">buf</span><span class="op" id="7734670">.</span><span class="ident" id="7734671">Bytes</span><span class="op" id="7734676">(</span><span class="op" id="7734677">)</span><span class="op" id="7734678">,</span>&nbsp;<span class="ident" id="7734680">h</span><span class="op" id="7734681">.</span><span class="ident" id="7734682">out</span><span class="op" id="7734685">)</span>&nbsp;<span class="op" id="7734687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734692">t</span><span class="op" id="7734693">.</span><span class="ident" id="7734694">Errorf</span><span class="op" id="7734700">(</span><span class="string" id="7734701">&#34;Deflate(%d,&nbsp;%x)&nbsp;=&nbsp;%x,&nbsp;want&nbsp;%x&#34;</span><span class="op" id="7734732">,</span>&nbsp;<span class="ident" id="7734734">h</span><span class="op" id="7734735">.</span><span class="ident" id="7734736">level</span><span class="op" id="7734741">,</span>&nbsp;<span class="ident" id="7734743">h</span><span class="op" id="7734744">.</span><span class="ident" id="7734745">in</span><span class="op" id="7734747">,</span>&nbsp;<span class="ident" id="7734749">buf</span><span class="op" id="7734752">.</span><span class="ident" id="7734753">Bytes</span><span class="op" id="7734758">(</span><span class="op" id="7734759">)</span><span class="op" id="7734760">,</span>&nbsp;<span class="ident" id="7734762">h</span><span class="op" id="7734763">.</span><span class="ident" id="7734764">out</span><span class="op" id="7734767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734771">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734774">}</span><br>
<span class="lineno"></span><span class="op" id="7734776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7734779">//&nbsp;A&nbsp;sparseReader&nbsp;returns&nbsp;a&nbsp;stream&nbsp;consisting&nbsp;of&nbsp;0s&nbsp;followed&nbsp;by&nbsp;1&lt;&lt;16&nbsp;1s.</span><br>
<span class="lineno"></span><span class="comment" id="7734853">//&nbsp;This&nbsp;tests&nbsp;missing&nbsp;hash&nbsp;references&nbsp;in&nbsp;a&nbsp;very&nbsp;large&nbsp;input.</span><br>
<span class="lineno">100</span><span class="keyword" id="7734914">type</span>&nbsp;<span class="ident" id="7734919">sparseReader</span>&nbsp;<span class="keyword" id="7734932">struct</span>&nbsp;<span class="op" id="7734939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734942">l</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7734946">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734953">cur</span>&nbsp;<span class="ident" id="7734957">int64</span><br>
<span class="lineno"></span><span class="op" id="7734963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7734966">func</span>&nbsp;<span class="op" id="7734971">(</span><span class="ident" id="7734972">r</span>&nbsp;<span class="op" id="7734974">*</span><span class="ident" id="7734975">sparseReader</span><span class="op" id="7734987">)</span>&nbsp;<span class="ident" id="7734989">Read</span><span class="op" id="7734993">(</span><span class="ident" id="7734994">b</span>&nbsp;<span class="op" id="7734996">[</span><span class="op" id="7734997">]</span><span class="builtintype" id="7734998">byte</span><span class="op" id="7735002">)</span>&nbsp;<span class="op" id="7735004">(</span><span class="ident" id="7735005">n</span>&nbsp;<span class="builtintype" id="7735007">int</span><span class="op" id="7735010">,</span>&nbsp;<span class="ident" id="7735012">err</span>&nbsp;<span class="builtintype" id="7735016">error</span><span class="op" id="7735021">)</span>&nbsp;<span class="op" id="7735023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735026">if</span>&nbsp;<span class="ident" id="7735029">r</span><span class="op" id="7735030">.</span><span class="ident" id="7735031">cur</span>&nbsp;<span class="op" id="7735035">&gt;=</span>&nbsp;<span class="ident" id="7735038">r</span><span class="op" id="7735039">.</span><span class="ident" id="7735040">l</span>&nbsp;<span class="op" id="7735042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735046">return</span>&nbsp;<span class="num" id="7735053">0</span><span class="op" id="7735054">,</span>&nbsp;<span class="ident" id="7735056">io</span><span class="op" id="7735058">.</span><span class="ident" id="7735059">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735067">n</span>&nbsp;<span class="op" id="7735069">=</span>&nbsp;<span class="builtinfunc" id="7735071">len</span><span class="op" id="7735074">(</span><span class="ident" id="7735075">b</span><span class="op" id="7735076">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735079">cur</span>&nbsp;<span class="op" id="7735083">:=</span>&nbsp;<span class="ident" id="7735086">r</span><span class="op" id="7735087">.</span><span class="ident" id="7735088">cur</span>&nbsp;<span class="op" id="7735092">+</span>&nbsp;<span class="ident" id="7735094">int64</span><span class="op" id="7735099">(</span><span class="ident" id="7735100">n</span><span class="op" id="7735101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735104">if</span>&nbsp;<span class="ident" id="7735107">cur</span>&nbsp;<span class="op" id="7735111">&gt;</span>&nbsp;<span class="ident" id="7735113">r</span><span class="op" id="7735114">.</span><span class="ident" id="7735115">l</span>&nbsp;<span class="op" id="7735117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735121">n</span>&nbsp;<span class="op" id="7735123">-=</span>&nbsp;<span class="builtintype" id="7735126">int</span><span class="op" id="7735129">(</span><span class="ident" id="7735130">cur</span>&nbsp;<span class="op" id="7735134">-</span>&nbsp;<span class="ident" id="7735136">r</span><span class="op" id="7735137">.</span><span class="ident" id="7735138">l</span><span class="op" id="7735139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735143">cur</span>&nbsp;<span class="op" id="7735147">=</span>&nbsp;<span class="ident" id="7735149">r</span><span class="op" id="7735150">.</span><span class="ident" id="7735151">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735154">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735157">for</span>&nbsp;<span class="ident" id="7735161">i</span>&nbsp;<span class="op" id="7735163">:=</span>&nbsp;<span class="keyword" id="7735166">range</span>&nbsp;<span class="ident" id="7735172">b</span><span class="op" id="7735173">[</span><span class="num" id="7735174">0</span><span class="op" id="7735175">:</span><span class="ident" id="7735176">n</span><span class="op" id="7735177">]</span>&nbsp;<span class="op" id="7735179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735183">if</span>&nbsp;<span class="ident" id="7735186">r</span><span class="op" id="7735187">.</span><span class="ident" id="7735188">cur</span><span class="op" id="7735191">+</span><span class="ident" id="7735192">int64</span><span class="op" id="7735197">(</span><span class="ident" id="7735198">i</span><span class="op" id="7735199">)</span>&nbsp;<span class="op" id="7735201">&gt;=</span>&nbsp;<span class="ident" id="7735204">r</span><span class="op" id="7735205">.</span><span class="ident" id="7735206">l</span><span class="op" id="7735207">-</span><span class="num" id="7735208">1</span><span class="op" id="7735209">&lt;&lt;</span><span class="num" id="7735211">16</span>&nbsp;<span class="op" id="7735214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735219">b</span><span class="op" id="7735220">[</span><span class="ident" id="7735221">i</span><span class="op" id="7735222">]</span>&nbsp;<span class="op" id="7735224">=</span>&nbsp;<span class="num" id="7735226">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735230">}</span>&nbsp;<span class="keyword" id="7735232">else</span>&nbsp;<span class="op" id="7735237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735242">b</span><span class="op" id="7735243">[</span><span class="ident" id="7735244">i</span><span class="op" id="7735245">]</span>&nbsp;<span class="op" id="7735247">=</span>&nbsp;<span class="num" id="7735249">0</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735259">r</span><span class="op" id="7735260">.</span><span class="ident" id="7735261">cur</span>&nbsp;<span class="op" id="7735265">=</span>&nbsp;<span class="ident" id="7735267">cur</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735272">return</span><br>
<span class="lineno"></span><span class="op" id="7735279">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7735282">func</span>&nbsp;<span class="ident" id="7735287">TestVeryLongSparseChunk</span><span class="op" id="7735310">(</span><span class="ident" id="7735311">t</span>&nbsp;<span class="op" id="7735313">*</span><span class="ident" id="7735314">testing</span><span class="op" id="7735321">.</span><span class="ident" id="7735322">T</span><span class="op" id="7735323">)</span>&nbsp;<span class="op" id="7735325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735328">if</span>&nbsp;<span class="ident" id="7735331">testing</span><span class="op" id="7735338">.</span><span class="ident" id="7735339">Short</span><span class="op" id="7735344">(</span><span class="op" id="7735345">)</span>&nbsp;<span class="op" id="7735347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735351">t</span><span class="op" id="7735352">.</span><span class="ident" id="7735353">Skip</span><span class="op" id="7735357">(</span><span class="string" id="7735358">&#34;skipping&nbsp;sparse&nbsp;chunk&nbsp;during&nbsp;short&nbsp;test&#34;</span><span class="op" id="7735399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735402">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735405">w</span><span class="op" id="7735406">,</span>&nbsp;<span class="ident" id="7735408">err</span>&nbsp;<span class="op" id="7735412">:=</span>&nbsp;<span class="ident" id="7735415">NewWriter</span><span class="op" id="7735424">(</span><span class="ident" id="7735425">ioutil</span><span class="op" id="7735431">.</span><span class="ident" id="7735432">Discard</span><span class="op" id="7735439">,</span>&nbsp;<span class="num" id="7735441">1</span><span class="op" id="7735442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735445">if</span>&nbsp;<span class="ident" id="7735448">err</span>&nbsp;<span class="op" id="7735452">!=</span>&nbsp;<span class="ident" id="7735455">nil</span>&nbsp;<span class="op" id="7735459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735463">t</span><span class="op" id="7735464">.</span><span class="ident" id="7735465">Errorf</span><span class="op" id="7735471">(</span><span class="string" id="7735472">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7735487">,</span>&nbsp;<span class="ident" id="7735489">err</span><span class="op" id="7735492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735496">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735504">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735507">if</span>&nbsp;<span class="ident" id="7735510">_</span><span class="op" id="7735511">,</span>&nbsp;<span class="ident" id="7735513">err</span>&nbsp;<span class="op" id="7735517">=</span>&nbsp;<span class="ident" id="7735519">io</span><span class="op" id="7735521">.</span><span class="ident" id="7735522">Copy</span><span class="op" id="7735526">(</span><span class="ident" id="7735527">w</span><span class="op" id="7735528">,</span>&nbsp;<span class="op" id="7735530">&amp;</span><span class="ident" id="7735531">sparseReader</span><span class="op" id="7735543">{</span><span class="ident" id="7735544">l</span><span class="op" id="7735545">:</span>&nbsp;<span class="num" id="7735547">23E8</span><span class="op" id="7735551">}</span><span class="op" id="7735552">)</span><span class="op" id="7735553">;</span>&nbsp;<span class="ident" id="7735555">err</span>&nbsp;<span class="op" id="7735559">!=</span>&nbsp;<span class="ident" id="7735562">nil</span>&nbsp;<span class="op" id="7735566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735570">t</span><span class="op" id="7735571">.</span><span class="ident" id="7735572">Errorf</span><span class="op" id="7735578">(</span><span class="string" id="7735579">&#34;Compress&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7735600">,</span>&nbsp;<span class="ident" id="7735602">err</span><span class="op" id="7735605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735609">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735617">}</span><br>
<span class="lineno"></span><span class="op" id="7735619">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="7735622">type</span>&nbsp;<span class="ident" id="7735627">syncBuffer</span>&nbsp;<span class="keyword" id="7735638">struct</span>&nbsp;<span class="op" id="7735645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735648">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7735655">bytes</span><span class="op" id="7735660">.</span><span class="ident" id="7735661">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735669">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7735676">sync</span><span class="op" id="7735680">.</span><span class="ident" id="7735681">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735690">closed</span>&nbsp;<span class="builtintype" id="7735697">bool</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735703">ready</span>&nbsp;&nbsp;<span class="keyword" id="7735710">chan</span>&nbsp;<span class="builtintype" id="7735715">bool</span><br>
<span class="lineno"></span><span class="op" id="7735720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7735723">func</span>&nbsp;<span class="ident" id="7735728">newSyncBuffer</span><span class="op" id="7735741">(</span><span class="op" id="7735742">)</span>&nbsp;<span class="op" id="7735744">*</span><span class="ident" id="7735745">syncBuffer</span>&nbsp;<span class="op" id="7735756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735759">return</span>&nbsp;<span class="op" id="7735766">&amp;</span><span class="ident" id="7735767">syncBuffer</span><span class="op" id="7735777">{</span><span class="ident" id="7735778">ready</span><span class="op" id="7735783">:</span>&nbsp;<span class="builtinfunc" id="7735785">make</span><span class="op" id="7735789">(</span><span class="keyword" id="7735790">chan</span>&nbsp;<span class="builtintype" id="7735795">bool</span><span class="op" id="7735799">,</span>&nbsp;<span class="num" id="7735801">1</span><span class="op" id="7735802">)</span><span class="op" id="7735803">}</span><br>
<span class="lineno">150</span><span class="op" id="7735805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7735808">func</span>&nbsp;<span class="op" id="7735813">(</span><span class="ident" id="7735814">b</span>&nbsp;<span class="op" id="7735816">*</span><span class="ident" id="7735817">syncBuffer</span><span class="op" id="7735827">)</span>&nbsp;<span class="ident" id="7735829">Read</span><span class="op" id="7735833">(</span><span class="ident" id="7735834">p</span>&nbsp;<span class="op" id="7735836">[</span><span class="op" id="7735837">]</span><span class="builtintype" id="7735838">byte</span><span class="op" id="7735842">)</span>&nbsp;<span class="op" id="7735844">(</span><span class="ident" id="7735845">n</span>&nbsp;<span class="builtintype" id="7735847">int</span><span class="op" id="7735850">,</span>&nbsp;<span class="ident" id="7735852">err</span>&nbsp;<span class="builtintype" id="7735856">error</span><span class="op" id="7735861">)</span>&nbsp;<span class="op" id="7735863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735866">for</span>&nbsp;<span class="op" id="7735870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735874">b</span><span class="op" id="7735875">.</span><span class="ident" id="7735876">mu</span><span class="op" id="7735878">.</span><span class="ident" id="7735879">RLock</span><span class="op" id="7735884">(</span><span class="op" id="7735885">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735889">n</span><span class="op" id="7735890">,</span>&nbsp;<span class="ident" id="7735892">err</span>&nbsp;<span class="op" id="7735896">=</span>&nbsp;<span class="ident" id="7735898">b</span><span class="op" id="7735899">.</span><span class="ident" id="7735900">buf</span><span class="op" id="7735903">.</span><span class="ident" id="7735904">Read</span><span class="op" id="7735908">(</span><span class="ident" id="7735909">p</span><span class="op" id="7735910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735914">b</span><span class="op" id="7735915">.</span><span class="ident" id="7735916">mu</span><span class="op" id="7735918">.</span><span class="ident" id="7735919">RUnlock</span><span class="op" id="7735926">(</span><span class="op" id="7735927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735931">if</span>&nbsp;<span class="ident" id="7735934">n</span>&nbsp;<span class="op" id="7735936">&gt;</span>&nbsp;<span class="num" id="7735938">0</span>&nbsp;<span class="op" id="7735940">||</span>&nbsp;<span class="ident" id="7735943">b</span><span class="op" id="7735944">.</span><span class="ident" id="7735945">closed</span>&nbsp;<span class="op" id="7735952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735957">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735966">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735970">&lt;-</span><span class="ident" id="7735972">b</span><span class="op" id="7735973">.</span><span class="ident" id="7735974">ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735981">}</span><br>
<span class="lineno"></span><span class="op" id="7735983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7735986">func</span>&nbsp;<span class="op" id="7735991">(</span><span class="ident" id="7735992">b</span>&nbsp;<span class="op" id="7735994">*</span><span class="ident" id="7735995">syncBuffer</span><span class="op" id="7736005">)</span>&nbsp;<span class="ident" id="7736007">signal</span><span class="op" id="7736013">(</span><span class="op" id="7736014">)</span>&nbsp;<span class="op" id="7736016">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736019">select</span>&nbsp;<span class="op" id="7736026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736029">case</span>&nbsp;<span class="ident" id="7736034">b</span><span class="op" id="7736035">.</span><span class="ident" id="7736036">ready</span>&nbsp;<span class="op" id="7736042">&lt;-</span>&nbsp;<span class="builtintype" id="7736045">true</span><span class="op" id="7736049">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736052">default</span><span class="op" id="7736059">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736062">}</span><br>
<span class="lineno"></span><span class="op" id="7736064">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="7736067">func</span>&nbsp;<span class="op" id="7736072">(</span><span class="ident" id="7736073">b</span>&nbsp;<span class="op" id="7736075">*</span><span class="ident" id="7736076">syncBuffer</span><span class="op" id="7736086">)</span>&nbsp;<span class="ident" id="7736088">Write</span><span class="op" id="7736093">(</span><span class="ident" id="7736094">p</span>&nbsp;<span class="op" id="7736096">[</span><span class="op" id="7736097">]</span><span class="builtintype" id="7736098">byte</span><span class="op" id="7736102">)</span>&nbsp;<span class="op" id="7736104">(</span><span class="ident" id="7736105">n</span>&nbsp;<span class="builtintype" id="7736107">int</span><span class="op" id="7736110">,</span>&nbsp;<span class="ident" id="7736112">err</span>&nbsp;<span class="builtintype" id="7736116">error</span><span class="op" id="7736121">)</span>&nbsp;<span class="op" id="7736123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736126">n</span><span class="op" id="7736127">,</span>&nbsp;<span class="ident" id="7736129">err</span>&nbsp;<span class="op" id="7736133">=</span>&nbsp;<span class="ident" id="7736135">b</span><span class="op" id="7736136">.</span><span class="ident" id="7736137">buf</span><span class="op" id="7736140">.</span><span class="ident" id="7736141">Write</span><span class="op" id="7736146">(</span><span class="ident" id="7736147">p</span><span class="op" id="7736148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736151">b</span><span class="op" id="7736152">.</span><span class="ident" id="7736153">signal</span><span class="op" id="7736159">(</span><span class="op" id="7736160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736163">return</span><br>
<span class="lineno">175</span><span class="op" id="7736170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7736173">func</span>&nbsp;<span class="op" id="7736178">(</span><span class="ident" id="7736179">b</span>&nbsp;<span class="op" id="7736181">*</span><span class="ident" id="7736182">syncBuffer</span><span class="op" id="7736192">)</span>&nbsp;<span class="ident" id="7736194">WriteMode</span><span class="op" id="7736203">(</span><span class="op" id="7736204">)</span>&nbsp;<span class="op" id="7736206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736209">b</span><span class="op" id="7736210">.</span><span class="ident" id="7736211">mu</span><span class="op" id="7736213">.</span><span class="ident" id="7736214">Lock</span><span class="op" id="7736218">(</span><span class="op" id="7736219">)</span><br>
<span class="lineno"></span><span class="op" id="7736221">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="7736224">func</span>&nbsp;<span class="op" id="7736229">(</span><span class="ident" id="7736230">b</span>&nbsp;<span class="op" id="7736232">*</span><span class="ident" id="7736233">syncBuffer</span><span class="op" id="7736243">)</span>&nbsp;<span class="ident" id="7736245">ReadMode</span><span class="op" id="7736253">(</span><span class="op" id="7736254">)</span>&nbsp;<span class="op" id="7736256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736259">b</span><span class="op" id="7736260">.</span><span class="ident" id="7736261">mu</span><span class="op" id="7736263">.</span><span class="ident" id="7736264">Unlock</span><span class="op" id="7736270">(</span><span class="op" id="7736271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736274">b</span><span class="op" id="7736275">.</span><span class="ident" id="7736276">signal</span><span class="op" id="7736282">(</span><span class="op" id="7736283">)</span><br>
<span class="lineno"></span><span class="op" id="7736285">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="7736288">func</span>&nbsp;<span class="op" id="7736293">(</span><span class="ident" id="7736294">b</span>&nbsp;<span class="op" id="7736296">*</span><span class="ident" id="7736297">syncBuffer</span><span class="op" id="7736307">)</span>&nbsp;<span class="ident" id="7736309">Close</span><span class="op" id="7736314">(</span><span class="op" id="7736315">)</span>&nbsp;<span class="builtintype" id="7736317">error</span>&nbsp;<span class="op" id="7736323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736326">b</span><span class="op" id="7736327">.</span><span class="ident" id="7736328">closed</span>&nbsp;<span class="op" id="7736335">=</span>&nbsp;<span class="builtintype" id="7736337">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736343">b</span><span class="op" id="7736344">.</span><span class="ident" id="7736345">signal</span><span class="op" id="7736351">(</span><span class="op" id="7736352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736355">return</span>&nbsp;<span class="ident" id="7736362">nil</span><br>
<span class="lineno">190</span><span class="op" id="7736366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7736369">func</span>&nbsp;<span class="ident" id="7736374">testSync</span><span class="op" id="7736382">(</span><span class="ident" id="7736383">t</span>&nbsp;<span class="op" id="7736385">*</span><span class="ident" id="7736386">testing</span><span class="op" id="7736393">.</span><span class="ident" id="7736394">T</span><span class="op" id="7736395">,</span>&nbsp;<span class="ident" id="7736397">level</span>&nbsp;<span class="builtintype" id="7736403">int</span><span class="op" id="7736406">,</span>&nbsp;<span class="ident" id="7736408">input</span>&nbsp;<span class="op" id="7736414">[</span><span class="op" id="7736415">]</span><span class="builtintype" id="7736416">byte</span><span class="op" id="7736420">,</span>&nbsp;<span class="ident" id="7736422">name</span>&nbsp;<span class="builtintype" id="7736427">string</span><span class="op" id="7736433">)</span>&nbsp;<span class="op" id="7736435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736438">if</span>&nbsp;<span class="builtinfunc" id="7736441">len</span><span class="op" id="7736444">(</span><span class="ident" id="7736445">input</span><span class="op" id="7736450">)</span>&nbsp;<span class="op" id="7736452">==</span>&nbsp;<span class="num" id="7736455">0</span>&nbsp;<span class="op" id="7736457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736461">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736473">t</span><span class="op" id="7736474">.</span><span class="ident" id="7736475">Logf</span><span class="op" id="7736479">(</span><span class="string" id="7736480">&#34;--testSync&nbsp;%d,&nbsp;%d,&nbsp;%s&#34;</span><span class="op" id="7736503">,</span>&nbsp;<span class="ident" id="7736505">level</span><span class="op" id="7736510">,</span>&nbsp;<span class="builtinfunc" id="7736512">len</span><span class="op" id="7736515">(</span><span class="ident" id="7736516">input</span><span class="op" id="7736521">)</span><span class="op" id="7736522">,</span>&nbsp;<span class="ident" id="7736524">name</span><span class="op" id="7736528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736531">buf</span>&nbsp;<span class="op" id="7736535">:=</span>&nbsp;<span class="ident" id="7736538">newSyncBuffer</span><span class="op" id="7736551">(</span><span class="op" id="7736552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736555">buf1</span>&nbsp;<span class="op" id="7736560">:=</span>&nbsp;<span class="builtinfunc" id="7736563">new</span><span class="op" id="7736566">(</span><span class="ident" id="7736567">bytes</span><span class="op" id="7736572">.</span><span class="ident" id="7736573">Buffer</span><span class="op" id="7736579">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736582">buf</span><span class="op" id="7736585">.</span><span class="ident" id="7736586">WriteMode</span><span class="op" id="7736595">(</span><span class="op" id="7736596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736599">w</span><span class="op" id="7736600">,</span>&nbsp;<span class="ident" id="7736602">err</span>&nbsp;<span class="op" id="7736606">:=</span>&nbsp;<span class="ident" id="7736609">NewWriter</span><span class="op" id="7736618">(</span><span class="ident" id="7736619">io</span><span class="op" id="7736621">.</span><span class="ident" id="7736622">MultiWriter</span><span class="op" id="7736633">(</span><span class="ident" id="7736634">buf</span><span class="op" id="7736637">,</span>&nbsp;<span class="ident" id="7736639">buf1</span><span class="op" id="7736643">)</span><span class="op" id="7736644">,</span>&nbsp;<span class="ident" id="7736646">level</span><span class="op" id="7736651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736654">if</span>&nbsp;<span class="ident" id="7736657">err</span>&nbsp;<span class="op" id="7736661">!=</span>&nbsp;<span class="ident" id="7736664">nil</span>&nbsp;<span class="op" id="7736668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736672">t</span><span class="op" id="7736673">.</span><span class="ident" id="7736674">Errorf</span><span class="op" id="7736680">(</span><span class="string" id="7736681">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7736696">,</span>&nbsp;<span class="ident" id="7736698">err</span><span class="op" id="7736701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736705">return</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736716">r</span>&nbsp;<span class="op" id="7736718">:=</span>&nbsp;<span class="ident" id="7736721">NewReader</span><span class="op" id="7736730">(</span><span class="ident" id="7736731">buf</span><span class="op" id="7736734">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7736738">//&nbsp;Write&nbsp;half&nbsp;the&nbsp;input&nbsp;and&nbsp;read&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736778">for</span>&nbsp;<span class="ident" id="7736782">i</span>&nbsp;<span class="op" id="7736784">:=</span>&nbsp;<span class="num" id="7736787">0</span><span class="op" id="7736788">;</span>&nbsp;<span class="ident" id="7736790">i</span>&nbsp;<span class="op" id="7736792">&lt;</span>&nbsp;<span class="num" id="7736794">2</span><span class="op" id="7736795">;</span>&nbsp;<span class="ident" id="7736797">i</span><span class="op" id="7736798">++</span>&nbsp;<span class="op" id="7736801">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736805">var</span>&nbsp;<span class="ident" id="7736809">lo</span><span class="op" id="7736811">,</span>&nbsp;<span class="ident" id="7736813">hi</span>&nbsp;<span class="builtintype" id="7736816">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736822">if</span>&nbsp;<span class="ident" id="7736825">i</span>&nbsp;<span class="op" id="7736827">==</span>&nbsp;<span class="num" id="7736830">0</span>&nbsp;<span class="op" id="7736832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736837">lo</span><span class="op" id="7736839">,</span>&nbsp;<span class="ident" id="7736841">hi</span>&nbsp;<span class="op" id="7736844">=</span>&nbsp;<span class="num" id="7736846">0</span><span class="op" id="7736847">,</span>&nbsp;<span class="op" id="7736849">(</span><span class="builtinfunc" id="7736850">len</span><span class="op" id="7736853">(</span><span class="ident" id="7736854">input</span><span class="op" id="7736859">)</span><span class="op" id="7736860">+</span><span class="num" id="7736861">1</span><span class="op" id="7736862">)</span><span class="op" id="7736863">/</span><span class="num" id="7736864">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736868">}</span>&nbsp;<span class="keyword" id="7736870">else</span>&nbsp;<span class="op" id="7736875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736880">lo</span><span class="op" id="7736882">,</span>&nbsp;<span class="ident" id="7736884">hi</span>&nbsp;<span class="op" id="7736887">=</span>&nbsp;<span class="op" id="7736889">(</span><span class="builtinfunc" id="7736890">len</span><span class="op" id="7736893">(</span><span class="ident" id="7736894">input</span><span class="op" id="7736899">)</span><span class="op" id="7736900">+</span><span class="num" id="7736901">1</span><span class="op" id="7736902">)</span><span class="op" id="7736903">/</span><span class="num" id="7736904">2</span><span class="op" id="7736905">,</span>&nbsp;<span class="builtinfunc" id="7736907">len</span><span class="op" id="7736910">(</span><span class="ident" id="7736911">input</span><span class="op" id="7736916">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736924">t</span><span class="op" id="7736925">.</span><span class="ident" id="7736926">Logf</span><span class="op" id="7736930">(</span><span class="string" id="7736931">&#34;#%d:&nbsp;write&nbsp;%d-%d&#34;</span><span class="op" id="7736949">,</span>&nbsp;<span class="ident" id="7736951">i</span><span class="op" id="7736952">,</span>&nbsp;<span class="ident" id="7736954">lo</span><span class="op" id="7736956">,</span>&nbsp;<span class="ident" id="7736958">hi</span><span class="op" id="7736960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736964">if</span>&nbsp;<span class="ident" id="7736967">_</span><span class="op" id="7736968">,</span>&nbsp;<span class="ident" id="7736970">err</span>&nbsp;<span class="op" id="7736974">:=</span>&nbsp;<span class="ident" id="7736977">w</span><span class="op" id="7736978">.</span><span class="ident" id="7736979">Write</span><span class="op" id="7736984">(</span><span class="ident" id="7736985">input</span><span class="op" id="7736990">[</span><span class="ident" id="7736991">lo</span><span class="op" id="7736993">:</span><span class="ident" id="7736994">hi</span><span class="op" id="7736996">]</span><span class="op" id="7736997">)</span><span class="op" id="7736998">;</span>&nbsp;<span class="ident" id="7737000">err</span>&nbsp;<span class="op" id="7737004">!=</span>&nbsp;<span class="ident" id="7737007">nil</span>&nbsp;<span class="op" id="7737011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737016">t</span><span class="op" id="7737017">.</span><span class="ident" id="7737018">Errorf</span><span class="op" id="7737024">(</span><span class="string" id="7737025">&#34;testSync:&nbsp;write:&nbsp;%v&#34;</span><span class="op" id="7737046">,</span>&nbsp;<span class="ident" id="7737048">err</span><span class="op" id="7737051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737056">return</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737069">if</span>&nbsp;<span class="ident" id="7737072">i</span>&nbsp;<span class="op" id="7737074">==</span>&nbsp;<span class="num" id="7737077">0</span>&nbsp;<span class="op" id="7737079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737084">if</span>&nbsp;<span class="ident" id="7737087">err</span>&nbsp;<span class="op" id="7737091">:=</span>&nbsp;<span class="ident" id="7737094">w</span><span class="op" id="7737095">.</span><span class="ident" id="7737096">Flush</span><span class="op" id="7737101">(</span><span class="op" id="7737102">)</span><span class="op" id="7737103">;</span>&nbsp;<span class="ident" id="7737105">err</span>&nbsp;<span class="op" id="7737109">!=</span>&nbsp;<span class="ident" id="7737112">nil</span>&nbsp;<span class="op" id="7737116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737122">t</span><span class="op" id="7737123">.</span><span class="ident" id="7737124">Errorf</span><span class="op" id="7737130">(</span><span class="string" id="7737131">&#34;testSync:&nbsp;flush:&nbsp;%v&#34;</span><span class="op" id="7737152">,</span>&nbsp;<span class="ident" id="7737154">err</span><span class="op" id="7737157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737163">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737177">}</span>&nbsp;<span class="keyword" id="7737179">else</span>&nbsp;<span class="op" id="7737184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737189">if</span>&nbsp;<span class="ident" id="7737192">err</span>&nbsp;<span class="op" id="7737196">:=</span>&nbsp;<span class="ident" id="7737199">w</span><span class="op" id="7737200">.</span><span class="ident" id="7737201">Close</span><span class="op" id="7737206">(</span><span class="op" id="7737207">)</span><span class="op" id="7737208">;</span>&nbsp;<span class="ident" id="7737210">err</span>&nbsp;<span class="op" id="7737214">!=</span>&nbsp;<span class="ident" id="7737217">nil</span>&nbsp;<span class="op" id="7737221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737227">t</span><span class="op" id="7737228">.</span><span class="ident" id="7737229">Errorf</span><span class="op" id="7737235">(</span><span class="string" id="7737236">&#34;testSync:&nbsp;close:&nbsp;%v&#34;</span><span class="op" id="7737257">,</span>&nbsp;<span class="ident" id="7737259">err</span><span class="op" id="7737262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737267">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737275">buf</span><span class="op" id="7737278">.</span><span class="ident" id="7737279">ReadMode</span><span class="op" id="7737287">(</span><span class="op" id="7737288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737292">out</span>&nbsp;<span class="op" id="7737296">:=</span>&nbsp;<span class="builtinfunc" id="7737299">make</span><span class="op" id="7737303">(</span><span class="op" id="7737304">[</span><span class="op" id="7737305">]</span><span class="builtintype" id="7737306">byte</span><span class="op" id="7737310">,</span>&nbsp;<span class="ident" id="7737312">hi</span><span class="op" id="7737314">-</span><span class="ident" id="7737315">lo</span><span class="op" id="7737317">+</span><span class="num" id="7737318">1</span><span class="op" id="7737319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737323">m</span><span class="op" id="7737324">,</span>&nbsp;<span class="ident" id="7737326">err</span>&nbsp;<span class="op" id="7737330">:=</span>&nbsp;<span class="ident" id="7737333">io</span><span class="op" id="7737335">.</span><span class="ident" id="7737336">ReadAtLeast</span><span class="op" id="7737347">(</span><span class="ident" id="7737348">r</span><span class="op" id="7737349">,</span>&nbsp;<span class="ident" id="7737351">out</span><span class="op" id="7737354">,</span>&nbsp;<span class="ident" id="7737356">hi</span><span class="op" id="7737358">-</span><span class="ident" id="7737359">lo</span><span class="op" id="7737361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737365">t</span><span class="op" id="7737366">.</span><span class="ident" id="7737367">Logf</span><span class="op" id="7737371">(</span><span class="string" id="7737372">&#34;#%d:&nbsp;read&nbsp;%d&#34;</span><span class="op" id="7737386">,</span>&nbsp;<span class="ident" id="7737388">i</span><span class="op" id="7737389">,</span>&nbsp;<span class="ident" id="7737391">m</span><span class="op" id="7737392">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737396">if</span>&nbsp;<span class="ident" id="7737399">m</span>&nbsp;<span class="op" id="7737401">!=</span>&nbsp;<span class="ident" id="7737404">hi</span><span class="op" id="7737406">-</span><span class="ident" id="7737407">lo</span>&nbsp;<span class="op" id="7737410">||</span>&nbsp;<span class="ident" id="7737413">err</span>&nbsp;<span class="op" id="7737417">!=</span>&nbsp;<span class="ident" id="7737420">nil</span>&nbsp;<span class="op" id="7737424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737429">t</span><span class="op" id="7737430">.</span><span class="ident" id="7737431">Errorf</span><span class="op" id="7737437">(</span><span class="string" id="7737438">&#34;testSync/%d&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;read&nbsp;%d:&nbsp;%d,&nbsp;%v&nbsp;(%d&nbsp;left)&#34;</span><span class="op" id="7737491">,</span>&nbsp;<span class="ident" id="7737493">i</span><span class="op" id="7737494">,</span>&nbsp;<span class="ident" id="7737496">level</span><span class="op" id="7737501">,</span>&nbsp;<span class="builtinfunc" id="7737503">len</span><span class="op" id="7737506">(</span><span class="ident" id="7737507">input</span><span class="op" id="7737512">)</span><span class="op" id="7737513">,</span>&nbsp;<span class="ident" id="7737515">name</span><span class="op" id="7737519">,</span>&nbsp;<span class="ident" id="7737521">hi</span><span class="op" id="7737523">-</span><span class="ident" id="7737524">lo</span><span class="op" id="7737526">,</span>&nbsp;<span class="ident" id="7737528">m</span><span class="op" id="7737529">,</span>&nbsp;<span class="ident" id="7737531">err</span><span class="op" id="7737534">,</span>&nbsp;<span class="ident" id="7737536">buf</span><span class="op" id="7737539">.</span><span class="ident" id="7737540">buf</span><span class="op" id="7737543">.</span><span class="ident" id="7737544">Len</span><span class="op" id="7737547">(</span><span class="op" id="7737548">)</span><span class="op" id="7737549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737554">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737567">if</span>&nbsp;<span class="op" id="7737570">!</span><span class="ident" id="7737571">bytes</span><span class="op" id="7737576">.</span><span class="ident" id="7737577">Equal</span><span class="op" id="7737582">(</span><span class="ident" id="7737583">input</span><span class="op" id="7737588">[</span><span class="ident" id="7737589">lo</span><span class="op" id="7737591">:</span><span class="ident" id="7737592">hi</span><span class="op" id="7737594">]</span><span class="op" id="7737595">,</span>&nbsp;<span class="ident" id="7737597">out</span><span class="op" id="7737600">[</span><span class="op" id="7737601">:</span><span class="ident" id="7737602">hi</span><span class="op" id="7737604">-</span><span class="ident" id="7737605">lo</span><span class="op" id="7737607">]</span><span class="op" id="7737608">)</span>&nbsp;<span class="op" id="7737610">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7737615">t</span><span class="op" id="7737616">.</span><span class="ident" id="7737617">Errorf</span><span class="op" id="7737623">(</span><span class="string" id="7737624">&#34;testSync/%d:&nbsp;read&nbsp;wrong&nbsp;bytes:&nbsp;%x&nbsp;vs&nbsp;%x&#34;</span><span class="op" id="7737665">,</span>&nbsp;<span class="ident" id="7737667">i</span><span class="op" id="7737668">,</span>&nbsp;<span class="ident" id="7737670">input</span><span class="op" id="7737675">[</span><span class="ident" id="7737676">lo</span><span class="op" id="7737678">:</span><span class="ident" id="7737679">hi</span><span class="op" id="7737681">]</span><span class="op" id="7737682">,</span>&nbsp;<span class="ident" id="7737684">out</span><span class="op" id="7737687">[</span><span class="op" id="7737688">:</span><span class="ident" id="7737689">hi</span><span class="op" id="7737691">-</span><span class="ident" id="7737692">lo</span><span class="op" id="7737694">]</span><span class="op" id="7737695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7737700">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7737709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7737713">//&nbsp;This&nbsp;test&nbsp;originally&nbsp;checked&nbsp;that&nbsp;after&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7737766">//&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;input,&nbsp;there&nbsp;was&nbsp;nothing&nbsp;left</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7737823">//&nbsp;in&nbsp;the&nbsp;read&nbsp;buffer&nbsp;(buf.buf.Len()&nbsp;!=&nbsp;0)&nbsp;but&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7737880">//&nbsp;not&nbsp;necessarily&nbsp;the&nbsp;case:&nbsp;the&nbsp;write&nbsp;Flush&nbsp;may&nbsp;emit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7737936">//&nbsp;some&nbsp;extra&nbsp;framing&nbsp;bits&nbsp;that&nbsp;are&nbsp;not&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7737988">//&nbsp;to&nbsp;process&nbsp;to&nbsp;obtain&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;uncompressed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7738049">//&nbsp;data.&nbsp;&nbsp;The&nbsp;test&nbsp;ran&nbsp;correctly&nbsp;most&nbsp;of&nbsp;the&nbsp;time,&nbsp;because</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7738110">//&nbsp;the&nbsp;background&nbsp;goroutine&nbsp;had&nbsp;usually&nbsp;read&nbsp;even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7738162">//&nbsp;those&nbsp;extra&nbsp;bits&nbsp;by&nbsp;now,&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;useful&nbsp;thing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7738223">//&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7738235">buf</span><span class="op" id="7738238">.</span><span class="ident" id="7738239">WriteMode</span><span class="op" id="7738248">(</span><span class="op" id="7738249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7738252">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7738255">buf</span><span class="op" id="7738258">.</span><span class="ident" id="7738259">ReadMode</span><span class="op" id="7738267">(</span><span class="op" id="7738268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7738271">out</span>&nbsp;<span class="op" id="7738275">:=</span>&nbsp;<span class="builtinfunc" id="7738278">make</span><span class="op" id="7738282">(</span><span class="op" id="7738283">[</span><span class="op" id="7738284">]</span><span class="builtintype" id="7738285">byte</span><span class="op" id="7738289">,</span>&nbsp;<span class="num" id="7738291">10</span><span class="op" id="7738293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7738296">if</span>&nbsp;<span class="ident" id="7738299">n</span><span class="op" id="7738300">,</span>&nbsp;<span class="ident" id="7738302">err</span>&nbsp;<span class="op" id="7738306">:=</span>&nbsp;<span class="ident" id="7738309">r</span><span class="op" id="7738310">.</span><span class="ident" id="7738311">Read</span><span class="op" id="7738315">(</span><span class="ident" id="7738316">out</span><span class="op" id="7738319">)</span><span class="op" id="7738320">;</span>&nbsp;<span class="ident" id="7738322">n</span>&nbsp;<span class="op" id="7738324">&gt;</span>&nbsp;<span class="num" id="7738326">0</span>&nbsp;<span class="op" id="7738328">||</span>&nbsp;<span class="ident" id="7738331">err</span>&nbsp;<span class="op" id="7738335">!=</span>&nbsp;<span class="ident" id="7738338">io</span><span class="op" id="7738340">.</span><span class="ident" id="7738341">EOF</span>&nbsp;<span class="op" id="7738345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7738349">t</span><span class="op" id="7738350">.</span><span class="ident" id="7738351">Errorf</span><span class="op" id="7738357">(</span><span class="string" id="7738358">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;final&nbsp;Read:&nbsp;%d,&nbsp;%v&nbsp;(hex:&nbsp;%x)&#34;</span><span class="op" id="7738411">,</span>&nbsp;<span class="ident" id="7738413">level</span><span class="op" id="7738418">,</span>&nbsp;<span class="builtinfunc" id="7738420">len</span><span class="op" id="7738423">(</span><span class="ident" id="7738424">input</span><span class="op" id="7738429">)</span><span class="op" id="7738430">,</span>&nbsp;<span class="ident" id="7738432">name</span><span class="op" id="7738436">,</span>&nbsp;<span class="ident" id="7738438">n</span><span class="op" id="7738439">,</span>&nbsp;<span class="ident" id="7738441">err</span><span class="op" id="7738444">,</span>&nbsp;<span class="ident" id="7738446">out</span><span class="op" id="7738449">[</span><span class="num" id="7738450">0</span><span class="op" id="7738451">:</span><span class="ident" id="7738452">n</span><span class="op" id="7738453">]</span><span class="op" id="7738454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7738457">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7738460">if</span>&nbsp;<span class="ident" id="7738463">buf</span><span class="op" id="7738466">.</span><span class="ident" id="7738467">buf</span><span class="op" id="7738470">.</span><span class="ident" id="7738471">Len</span><span class="op" id="7738474">(</span><span class="op" id="7738475">)</span>&nbsp;<span class="op" id="7738477">!=</span>&nbsp;<span class="num" id="7738480">0</span>&nbsp;<span class="op" id="7738482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7738486">t</span><span class="op" id="7738487">.</span><span class="ident" id="7738488">Errorf</span><span class="op" id="7738494">(</span><span class="string" id="7738495">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;extra&nbsp;data&nbsp;at&nbsp;end&#34;</span><span class="op" id="7738537">,</span>&nbsp;<span class="ident" id="7738539">level</span><span class="op" id="7738544">,</span>&nbsp;<span class="builtinfunc" id="7738546">len</span><span class="op" id="7738549">(</span><span class="ident" id="7738550">input</span><span class="op" id="7738555">)</span><span class="op" id="7738556">,</span>&nbsp;<span class="ident" id="7738558">name</span><span class="op" id="7738562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7738565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7738568">r</span><span class="op" id="7738569">.</span><span class="ident" id="7738570">Close</span><span class="op" id="7738575">(</span><span class="op" id="7738576">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7738580">//&nbsp;stream&nbsp;should&nbsp;work&nbsp;for&nbsp;ordinary&nbsp;reader&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7738627">r</span>&nbsp;<span class="op" id="7738629">=</span>&nbsp;<span class="ident" id="7738631">NewReader</span><span class="op" id="7738640">(</span><span class="ident" id="7738641">buf1</span><span class="op" id="7738645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7738648">out</span><span class="op" id="7738651">,</span>&nbsp;<span class="ident" id="7738653">err</span>&nbsp;<span class="op" id="7738657">=</span>&nbsp;<span class="ident" id="7738659">ioutil</span><span class="op" id="7738665">.</span><span class="ident" id="7738666">ReadAll</span><span class="op" id="7738673">(</span><span class="ident" id="7738674">r</span><span class="op" id="7738675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7738678">if</span>&nbsp;<span class="ident" id="7738681">err</span>&nbsp;<span class="op" id="7738685">!=</span>&nbsp;<span class="ident" id="7738688">nil</span>&nbsp;<span class="op" id="7738692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7738696">t</span><span class="op" id="7738697">.</span><span class="ident" id="7738698">Errorf</span><span class="op" id="7738704">(</span><span class="string" id="7738705">&#34;testSync:&nbsp;read:&nbsp;%s&#34;</span><span class="op" id="7738725">,</span>&nbsp;<span class="ident" id="7738727">err</span><span class="op" id="7738730">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7738734">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7738742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7738745">r</span><span class="op" id="7738746">.</span><span class="ident" id="7738747">Close</span><span class="op" id="7738752">(</span><span class="op" id="7738753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7738756">if</span>&nbsp;<span class="op" id="7738759">!</span><span class="ident" id="7738760">bytes</span><span class="op" id="7738765">.</span><span class="ident" id="7738766">Equal</span><span class="op" id="7738771">(</span><span class="ident" id="7738772">input</span><span class="op" id="7738777">,</span>&nbsp;<span class="ident" id="7738779">out</span><span class="op" id="7738782">)</span>&nbsp;<span class="op" id="7738784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7738788">t</span><span class="op" id="7738789">.</span><span class="ident" id="7738790">Errorf</span><span class="op" id="7738796">(</span><span class="string" id="7738797">&#34;testSync:&nbsp;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="7738862">,</span>&nbsp;<span class="ident" id="7738864">level</span><span class="op" id="7738869">,</span>&nbsp;<span class="ident" id="7738871">name</span><span class="op" id="7738875">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7738878">}</span><br>
<span class="lineno"></span><span class="op" id="7738880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7738883">func</span>&nbsp;<span class="ident" id="7738888">testToFromWithLevelAndLimit</span><span class="op" id="7738915">(</span><span class="ident" id="7738916">t</span>&nbsp;<span class="op" id="7738918">*</span><span class="ident" id="7738919">testing</span><span class="op" id="7738926">.</span><span class="ident" id="7738927">T</span><span class="op" id="7738928">,</span>&nbsp;<span class="ident" id="7738930">level</span>&nbsp;<span class="builtintype" id="7738936">int</span><span class="op" id="7738939">,</span>&nbsp;<span class="ident" id="7738941">input</span>&nbsp;<span class="op" id="7738947">[</span><span class="op" id="7738948">]</span><span class="builtintype" id="7738949">byte</span><span class="op" id="7738953">,</span>&nbsp;<span class="ident" id="7738955">name</span>&nbsp;<span class="builtintype" id="7738960">string</span><span class="op" id="7738966">,</span>&nbsp;<span class="ident" id="7738968">limit</span>&nbsp;<span class="builtintype" id="7738974">int</span><span class="op" id="7738977">)</span>&nbsp;<span class="op" id="7738979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7738982">var</span>&nbsp;<span class="ident" id="7738986">buffer</span>&nbsp;<span class="ident" id="7738993">bytes</span><span class="op" id="7738998">.</span><span class="ident" id="7738999">Buffer</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7739007">w</span><span class="op" id="7739008">,</span>&nbsp;<span class="ident" id="7739010">err</span>&nbsp;<span class="op" id="7739014">:=</span>&nbsp;<span class="ident" id="7739017">NewWriter</span><span class="op" id="7739026">(</span><span class="op" id="7739027">&amp;</span><span class="ident" id="7739028">buffer</span><span class="op" id="7739034">,</span>&nbsp;<span class="ident" id="7739036">level</span><span class="op" id="7739041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7739044">if</span>&nbsp;<span class="ident" id="7739047">err</span>&nbsp;<span class="op" id="7739051">!=</span>&nbsp;<span class="ident" id="7739054">nil</span>&nbsp;<span class="op" id="7739058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7739062">t</span><span class="op" id="7739063">.</span><span class="ident" id="7739064">Errorf</span><span class="op" id="7739070">(</span><span class="string" id="7739071">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7739086">,</span>&nbsp;<span class="ident" id="7739088">err</span><span class="op" id="7739091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7739095">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7739103">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7739106">w</span><span class="op" id="7739107">.</span><span class="ident" id="7739108">Write</span><span class="op" id="7739113">(</span><span class="ident" id="7739114">input</span><span class="op" id="7739119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7739122">w</span><span class="op" id="7739123">.</span><span class="ident" id="7739124">Close</span><span class="op" id="7739129">(</span><span class="op" id="7739130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7739133">if</span>&nbsp;<span class="ident" id="7739136">limit</span>&nbsp;<span class="op" id="7739142">&gt;</span>&nbsp;<span class="num" id="7739144">0</span>&nbsp;<span class="op" id="7739146">&amp;&amp;</span>&nbsp;<span class="ident" id="7739149">buffer</span><span class="op" id="7739155">.</span><span class="ident" id="7739156">Len</span><span class="op" id="7739159">(</span><span class="op" id="7739160">)</span>&nbsp;<span class="op" id="7739162">&gt;</span>&nbsp;<span class="ident" id="7739164">limit</span>&nbsp;<span class="op" id="7739170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7739174">t</span><span class="op" id="7739175">.</span><span class="ident" id="7739176">Errorf</span><span class="op" id="7739182">(</span><span class="string" id="7739183">&#34;level:&nbsp;%d,&nbsp;len(compress(data))&nbsp;=&nbsp;%d&nbsp;&gt;&nbsp;limit&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7739233">,</span>&nbsp;<span class="ident" id="7739235">level</span><span class="op" id="7739240">,</span>&nbsp;<span class="ident" id="7739242">buffer</span><span class="op" id="7739248">.</span><span class="ident" id="7739249">Len</span><span class="op" id="7739252">(</span><span class="op" id="7739253">)</span><span class="op" id="7739254">,</span>&nbsp;<span class="ident" id="7739256">limit</span><span class="op" id="7739261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7739265">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7739273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7739276">r</span>&nbsp;<span class="op" id="7739278">:=</span>&nbsp;<span class="ident" id="7739281">NewReader</span><span class="op" id="7739290">(</span><span class="op" id="7739291">&amp;</span><span class="ident" id="7739292">buffer</span><span class="op" id="7739298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7739301">out</span><span class="op" id="7739304">,</span>&nbsp;<span class="ident" id="7739306">err</span>&nbsp;<span class="op" id="7739310">:=</span>&nbsp;<span class="ident" id="7739313">ioutil</span><span class="op" id="7739319">.</span><span class="ident" id="7739320">ReadAll</span><span class="op" id="7739327">(</span><span class="ident" id="7739328">r</span><span class="op" id="7739329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7739332">if</span>&nbsp;<span class="ident" id="7739335">err</span>&nbsp;<span class="op" id="7739339">!=</span>&nbsp;<span class="ident" id="7739342">nil</span>&nbsp;<span class="op" id="7739346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7739350">t</span><span class="op" id="7739351">.</span><span class="ident" id="7739352">Errorf</span><span class="op" id="7739358">(</span><span class="string" id="7739359">&#34;read:&nbsp;%s&#34;</span><span class="op" id="7739369">,</span>&nbsp;<span class="ident" id="7739371">err</span><span class="op" id="7739374">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7739378">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7739386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7739389">r</span><span class="op" id="7739390">.</span><span class="ident" id="7739391">Close</span><span class="op" id="7739396">(</span><span class="op" id="7739397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7739400">if</span>&nbsp;<span class="op" id="7739403">!</span><span class="ident" id="7739404">bytes</span><span class="op" id="7739409">.</span><span class="ident" id="7739410">Equal</span><span class="op" id="7739415">(</span><span class="ident" id="7739416">input</span><span class="op" id="7739421">,</span>&nbsp;<span class="ident" id="7739423">out</span><span class="op" id="7739426">)</span>&nbsp;<span class="op" id="7739428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7739432">t</span><span class="op" id="7739433">.</span><span class="ident" id="7739434">Errorf</span><span class="op" id="7739440">(</span><span class="string" id="7739441">&#34;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="7739496">,</span>&nbsp;<span class="ident" id="7739498">level</span><span class="op" id="7739503">,</span>&nbsp;<span class="ident" id="7739505">name</span><span class="op" id="7739509">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7739513">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7739521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7739524">testSync</span><span class="op" id="7739532">(</span><span class="ident" id="7739533">t</span><span class="op" id="7739534">,</span>&nbsp;<span class="ident" id="7739536">level</span><span class="op" id="7739541">,</span>&nbsp;<span class="ident" id="7739543">input</span><span class="op" id="7739548">,</span>&nbsp;<span class="ident" id="7739550">name</span><span class="op" id="7739554">)</span><br>
<span class="lineno"></span><span class="op" id="7739556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="7739559">func</span>&nbsp;<span class="ident" id="7739564">testToFromWithLimit</span><span class="op" id="7739583">(</span><span class="ident" id="7739584">t</span>&nbsp;<span class="op" id="7739586">*</span><span class="ident" id="7739587">testing</span><span class="op" id="7739594">.</span><span class="ident" id="7739595">T</span><span class="op" id="7739596">,</span>&nbsp;<span class="ident" id="7739598">input</span>&nbsp;<span class="op" id="7739604">[</span><span class="op" id="7739605">]</span><span class="builtintype" id="7739606">byte</span><span class="op" id="7739610">,</span>&nbsp;<span class="ident" id="7739612">name</span>&nbsp;<span class="builtintype" id="7739617">string</span><span class="op" id="7739623">,</span>&nbsp;<span class="ident" id="7739625">limit</span>&nbsp;<span class="op" id="7739631">[</span><span class="num" id="7739632">10</span><span class="op" id="7739634">]</span><span class="builtintype" id="7739635">int</span><span class="op" id="7739638">)</span>&nbsp;<span class="op" id="7739640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7739643">for</span>&nbsp;<span class="ident" id="7739647">i</span>&nbsp;<span class="op" id="7739649">:=</span>&nbsp;<span class="num" id="7739652">0</span><span class="op" id="7739653">;</span>&nbsp;<span class="ident" id="7739655">i</span>&nbsp;<span class="op" id="7739657">&lt;</span>&nbsp;<span class="num" id="7739659">10</span><span class="op" id="7739661">;</span>&nbsp;<span class="ident" id="7739663">i</span><span class="op" id="7739664">++</span>&nbsp;<span class="op" id="7739667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7739671">testToFromWithLevelAndLimit</span><span class="op" id="7739698">(</span><span class="ident" id="7739699">t</span><span class="op" id="7739700">,</span>&nbsp;<span class="ident" id="7739702">i</span><span class="op" id="7739703">,</span>&nbsp;<span class="ident" id="7739705">input</span><span class="op" id="7739710">,</span>&nbsp;<span class="ident" id="7739712">name</span><span class="op" id="7739716">,</span>&nbsp;<span class="ident" id="7739718">limit</span><span class="op" id="7739723">[</span><span class="ident" id="7739724">i</span><span class="op" id="7739725">]</span><span class="op" id="7739726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7739729">}</span><br>
<span class="lineno"></span><span class="op" id="7739731">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="7739734">func</span>&nbsp;<span class="ident" id="7739739">TestDeflateInflate</span><span class="op" id="7739757">(</span><span class="ident" id="7739758">t</span>&nbsp;<span class="op" id="7739760">*</span><span class="ident" id="7739761">testing</span><span class="op" id="7739768">.</span><span class="ident" id="7739769">T</span><span class="op" id="7739770">)</span>&nbsp;<span class="op" id="7739772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7739775">for</span>&nbsp;<span class="ident" id="7739779">i</span><span class="op" id="7739780">,</span>&nbsp;<span class="ident" id="7739782">h</span>&nbsp;<span class="op" id="7739784">:=</span>&nbsp;<span class="keyword" id="7739787">range</span>&nbsp;<span class="ident" id="7739793">deflateInflateTests</span>&nbsp;<span class="op" id="7739813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7739817">testToFromWithLimit</span><span class="op" id="7739836">(</span><span class="ident" id="7739837">t</span><span class="op" id="7739838">,</span>&nbsp;<span class="ident" id="7739840">h</span><span class="op" id="7739841">.</span><span class="ident" id="7739842">in</span><span class="op" id="7739844">,</span>&nbsp;<span class="ident" id="7739846">fmt</span><span class="op" id="7739849">.</span><span class="ident" id="7739850">Sprintf</span><span class="op" id="7739857">(</span><span class="string" id="7739858">&#34;#%d&#34;</span><span class="op" id="7739863">,</span>&nbsp;<span class="ident" id="7739865">i</span><span class="op" id="7739866">)</span><span class="op" id="7739867">,</span>&nbsp;<span class="op" id="7739869">[</span><span class="num" id="7739870">10</span><span class="op" id="7739872">]</span><span class="builtintype" id="7739873">int</span><span class="op" id="7739876">{</span><span class="op" id="7739877">}</span><span class="op" id="7739878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7739881">}</span><br>
<span class="lineno">315</span><span class="op" id="7739883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7739886">func</span>&nbsp;<span class="ident" id="7739891">TestReverseBits</span><span class="op" id="7739906">(</span><span class="ident" id="7739907">t</span>&nbsp;<span class="op" id="7739909">*</span><span class="ident" id="7739910">testing</span><span class="op" id="7739917">.</span><span class="ident" id="7739918">T</span><span class="op" id="7739919">)</span>&nbsp;<span class="op" id="7739921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7739924">for</span>&nbsp;<span class="ident" id="7739928">_</span><span class="op" id="7739929">,</span>&nbsp;<span class="ident" id="7739931">h</span>&nbsp;<span class="op" id="7739933">:=</span>&nbsp;<span class="keyword" id="7739936">range</span>&nbsp;<span class="ident" id="7739942">reverseBitsTests</span>&nbsp;<span class="op" id="7739959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7739963">if</span>&nbsp;<span class="ident" id="7739966">v</span>&nbsp;<span class="op" id="7739968">:=</span>&nbsp;<span class="ident" id="7739971">reverseBits</span><span class="op" id="7739982">(</span><span class="ident" id="7739983">h</span><span class="op" id="7739984">.</span><span class="ident" id="7739985">in</span><span class="op" id="7739987">,</span>&nbsp;<span class="ident" id="7739989">h</span><span class="op" id="7739990">.</span><span class="ident" id="7739991">bitCount</span><span class="op" id="7739999">)</span><span class="op" id="7740000">;</span>&nbsp;<span class="ident" id="7740002">v</span>&nbsp;<span class="op" id="7740004">!=</span>&nbsp;<span class="ident" id="7740007">h</span><span class="op" id="7740008">.</span><span class="ident" id="7740009">out</span>&nbsp;<span class="op" id="7740013">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7740018">t</span><span class="op" id="7740019">.</span><span class="ident" id="7740020">Errorf</span><span class="op" id="7740026">(</span><span class="string" id="7740027">&#34;reverseBits(%v,%v)&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7740061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7740067">h</span><span class="op" id="7740068">.</span><span class="ident" id="7740069">in</span><span class="op" id="7740071">,</span>&nbsp;<span class="ident" id="7740073">h</span><span class="op" id="7740074">.</span><span class="ident" id="7740075">bitCount</span><span class="op" id="7740083">,</span>&nbsp;<span class="ident" id="7740085">v</span><span class="op" id="7740086">,</span>&nbsp;<span class="ident" id="7740088">h</span><span class="op" id="7740089">.</span><span class="ident" id="7740090">out</span><span class="op" id="7740093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7740097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7740100">}</span><br>
<span class="lineno"></span><span class="op" id="7740102">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="7740105">type</span>&nbsp;<span class="ident" id="7740110">deflateInflateStringTest</span>&nbsp;<span class="keyword" id="7740135">struct</span>&nbsp;<span class="op" id="7740142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7740145">filename</span>&nbsp;<span class="builtintype" id="7740154">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7740162">label</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7740171">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7740179">limit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7740188">[</span><span class="num" id="7740189">10</span><span class="op" id="7740191">]</span><span class="builtintype" id="7740192">int</span><br>
<span class="lineno">330</span><span class="op" id="7740196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7740199">var</span>&nbsp;<span class="ident" id="7740203">deflateInflateStringTests</span>&nbsp;<span class="op" id="7740229">=</span>&nbsp;<span class="op" id="7740231">[</span><span class="op" id="7740232">]</span><span class="ident" id="7740233">deflateInflateStringTest</span><span class="op" id="7740257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7740260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7740264">&#34;../testdata/e.txt&#34;</span><span class="op" id="7740283">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7740287">&#34;2.718281828...&#34;</span><span class="op" id="7740303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7740307">[</span><span class="op" id="7740308">...</span><span class="op" id="7740311">]</span><span class="builtintype" id="7740312">int</span><span class="op" id="7740315">{</span><span class="num" id="7740316">100018</span><span class="op" id="7740322">,</span>&nbsp;<span class="num" id="7740324">50650</span><span class="op" id="7740329">,</span>&nbsp;<span class="num" id="7740331">50960</span><span class="op" id="7740336">,</span>&nbsp;<span class="num" id="7740338">51150</span><span class="op" id="7740343">,</span>&nbsp;<span class="num" id="7740345">50930</span><span class="op" id="7740350">,</span>&nbsp;<span class="num" id="7740352">50790</span><span class="op" id="7740357">,</span>&nbsp;<span class="num" id="7740359">50790</span><span class="op" id="7740364">,</span>&nbsp;<span class="num" id="7740366">50790</span><span class="op" id="7740371">,</span>&nbsp;<span class="num" id="7740373">50790</span><span class="op" id="7740378">,</span>&nbsp;<span class="num" id="7740380">50790</span><span class="op" id="7740385">}</span><span class="op" id="7740386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7740389">}</span><span class="op" id="7740390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7740393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7740397">&#34;../testdata/Mark.Twain-Tom.Sawyer.txt&#34;</span><span class="op" id="7740436">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7740440">&#34;Mark.Twain-Tom.Sawyer&#34;</span><span class="op" id="7740463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7740467">[</span><span class="op" id="7740468">...</span><span class="op" id="7740471">]</span><span class="builtintype" id="7740472">int</span><span class="op" id="7740475">{</span><span class="num" id="7740476">407330</span><span class="op" id="7740482">,</span>&nbsp;<span class="num" id="7740484">187598</span><span class="op" id="7740490">,</span>&nbsp;<span class="num" id="7740492">180361</span><span class="op" id="7740498">,</span>&nbsp;<span class="num" id="7740500">172974</span><span class="op" id="7740506">,</span>&nbsp;<span class="num" id="7740508">169160</span><span class="op" id="7740514">,</span>&nbsp;<span class="num" id="7740516">163476</span><span class="op" id="7740522">,</span>&nbsp;<span class="num" id="7740524">160936</span><span class="op" id="7740530">,</span>&nbsp;<span class="num" id="7740532">160506</span><span class="op" id="7740538">,</span>&nbsp;<span class="num" id="7740540">160295</span><span class="op" id="7740546">,</span>&nbsp;<span class="num" id="7740548">160295</span><span class="op" id="7740554">}</span><span class="op" id="7740555">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7740558">}</span><span class="op" id="7740559">,</span><br>
<span class="lineno"></span><span class="op" id="7740561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="7740564">func</span>&nbsp;<span class="ident" id="7740569">TestDeflateInflateString</span><span class="op" id="7740593">(</span><span class="ident" id="7740594">t</span>&nbsp;<span class="op" id="7740596">*</span><span class="ident" id="7740597">testing</span><span class="op" id="7740604">.</span><span class="ident" id="7740605">T</span><span class="op" id="7740606">)</span>&nbsp;<span class="op" id="7740608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7740611">for</span>&nbsp;<span class="ident" id="7740615">_</span><span class="op" id="7740616">,</span>&nbsp;<span class="ident" id="7740618">test</span>&nbsp;<span class="op" id="7740623">:=</span>&nbsp;<span class="keyword" id="7740626">range</span>&nbsp;<span class="ident" id="7740632">deflateInflateStringTests</span>&nbsp;<span class="op" id="7740658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7740662">gold</span><span class="op" id="7740666">,</span>&nbsp;<span class="ident" id="7740668">err</span>&nbsp;<span class="op" id="7740672">:=</span>&nbsp;<span class="ident" id="7740675">ioutil</span><span class="op" id="7740681">.</span><span class="ident" id="7740682">ReadFile</span><span class="op" id="7740690">(</span><span class="ident" id="7740691">test</span><span class="op" id="7740695">.</span><span class="ident" id="7740696">filename</span><span class="op" id="7740704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7740708">if</span>&nbsp;<span class="ident" id="7740711">err</span>&nbsp;<span class="op" id="7740715">!=</span>&nbsp;<span class="ident" id="7740718">nil</span>&nbsp;<span class="op" id="7740722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7740727">t</span><span class="op" id="7740728">.</span><span class="ident" id="7740729">Error</span><span class="op" id="7740734">(</span><span class="ident" id="7740735">err</span><span class="op" id="7740738">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7740742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7740746">testToFromWithLimit</span><span class="op" id="7740765">(</span><span class="ident" id="7740766">t</span><span class="op" id="7740767">,</span>&nbsp;<span class="ident" id="7740769">gold</span><span class="op" id="7740773">,</span>&nbsp;<span class="ident" id="7740775">test</span><span class="op" id="7740779">.</span><span class="ident" id="7740780">label</span><span class="op" id="7740785">,</span>&nbsp;<span class="ident" id="7740787">test</span><span class="op" id="7740791">.</span><span class="ident" id="7740792">limit</span><span class="op" id="7740797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7740801">if</span>&nbsp;<span class="ident" id="7740804">testing</span><span class="op" id="7740811">.</span><span class="ident" id="7740812">Short</span><span class="op" id="7740817">(</span><span class="op" id="7740818">)</span>&nbsp;<span class="op" id="7740820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7740825">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7740833">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7740836">}</span><br>
<span class="lineno"></span><span class="op" id="7740838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7740841">func</span>&nbsp;<span class="ident" id="7740846">TestReaderDict</span><span class="op" id="7740860">(</span><span class="ident" id="7740861">t</span>&nbsp;<span class="op" id="7740863">*</span><span class="ident" id="7740864">testing</span><span class="op" id="7740871">.</span><span class="ident" id="7740872">T</span><span class="op" id="7740873">)</span>&nbsp;<span class="op" id="7740875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7740878">const</span>&nbsp;<span class="op" id="7740884">(</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7740888">dict</span>&nbsp;<span class="op" id="7740893">=</span>&nbsp;<span class="string" id="7740895">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7740911">text</span>&nbsp;<span class="op" id="7740916">=</span>&nbsp;<span class="string" id="7740918">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7740939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7740942">var</span>&nbsp;<span class="ident" id="7740946">b</span>&nbsp;<span class="ident" id="7740948">bytes</span><span class="op" id="7740953">.</span><span class="ident" id="7740954">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7740962">w</span><span class="op" id="7740963">,</span>&nbsp;<span class="ident" id="7740965">err</span>&nbsp;<span class="op" id="7740969">:=</span>&nbsp;<span class="ident" id="7740972">NewWriter</span><span class="op" id="7740981">(</span><span class="op" id="7740982">&amp;</span><span class="ident" id="7740983">b</span><span class="op" id="7740984">,</span>&nbsp;<span class="num" id="7740986">5</span><span class="op" id="7740987">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7740990">if</span>&nbsp;<span class="ident" id="7740993">err</span>&nbsp;<span class="op" id="7740997">!=</span>&nbsp;<span class="ident" id="7741000">nil</span>&nbsp;<span class="op" id="7741004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741008">t</span><span class="op" id="7741009">.</span><span class="ident" id="7741010">Fatalf</span><span class="op" id="7741016">(</span><span class="string" id="7741017">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7741032">,</span>&nbsp;<span class="ident" id="7741034">err</span><span class="op" id="7741037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7741040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741043">w</span><span class="op" id="7741044">.</span><span class="ident" id="7741045">Write</span><span class="op" id="7741050">(</span><span class="op" id="7741051">[</span><span class="op" id="7741052">]</span><span class="builtintype" id="7741053">byte</span><span class="op" id="7741057">(</span><span class="ident" id="7741058">dict</span><span class="op" id="7741062">)</span><span class="op" id="7741063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741066">w</span><span class="op" id="7741067">.</span><span class="ident" id="7741068">Flush</span><span class="op" id="7741073">(</span><span class="op" id="7741074">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741077">b</span><span class="op" id="7741078">.</span><span class="ident" id="7741079">Reset</span><span class="op" id="7741084">(</span><span class="op" id="7741085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741088">w</span><span class="op" id="7741089">.</span><span class="ident" id="7741090">Write</span><span class="op" id="7741095">(</span><span class="op" id="7741096">[</span><span class="op" id="7741097">]</span><span class="builtintype" id="7741098">byte</span><span class="op" id="7741102">(</span><span class="ident" id="7741103">text</span><span class="op" id="7741107">)</span><span class="op" id="7741108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741111">w</span><span class="op" id="7741112">.</span><span class="ident" id="7741113">Close</span><span class="op" id="7741118">(</span><span class="op" id="7741119">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741123">r</span>&nbsp;<span class="op" id="7741125">:=</span>&nbsp;<span class="ident" id="7741128">NewReaderDict</span><span class="op" id="7741141">(</span><span class="op" id="7741142">&amp;</span><span class="ident" id="7741143">b</span><span class="op" id="7741144">,</span>&nbsp;<span class="op" id="7741146">[</span><span class="op" id="7741147">]</span><span class="builtintype" id="7741148">byte</span><span class="op" id="7741152">(</span><span class="ident" id="7741153">dict</span><span class="op" id="7741157">)</span><span class="op" id="7741158">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741161">data</span><span class="op" id="7741165">,</span>&nbsp;<span class="ident" id="7741167">err</span>&nbsp;<span class="op" id="7741171">:=</span>&nbsp;<span class="ident" id="7741174">ioutil</span><span class="op" id="7741180">.</span><span class="ident" id="7741181">ReadAll</span><span class="op" id="7741188">(</span><span class="ident" id="7741189">r</span><span class="op" id="7741190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7741193">if</span>&nbsp;<span class="ident" id="7741196">err</span>&nbsp;<span class="op" id="7741200">!=</span>&nbsp;<span class="ident" id="7741203">nil</span>&nbsp;<span class="op" id="7741207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741211">t</span><span class="op" id="7741212">.</span><span class="ident" id="7741213">Fatal</span><span class="op" id="7741218">(</span><span class="ident" id="7741219">err</span><span class="op" id="7741222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7741225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7741228">if</span>&nbsp;<span class="builtintype" id="7741231">string</span><span class="op" id="7741237">(</span><span class="ident" id="7741238">data</span><span class="op" id="7741242">)</span>&nbsp;<span class="op" id="7741244">!=</span>&nbsp;<span class="string" id="7741247">&#34;hello&nbsp;again&nbsp;world&#34;</span>&nbsp;<span class="op" id="7741267">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741271">t</span><span class="op" id="7741272">.</span><span class="ident" id="7741273">Fatalf</span><span class="op" id="7741279">(</span><span class="string" id="7741280">&#34;read&nbsp;returned&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7741306">,</span>&nbsp;<span class="builtintype" id="7741308">string</span><span class="op" id="7741314">(</span><span class="ident" id="7741315">data</span><span class="op" id="7741319">)</span><span class="op" id="7741320">,</span>&nbsp;<span class="ident" id="7741322">text</span><span class="op" id="7741326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7741329">}</span><br>
<span class="lineno"></span><span class="op" id="7741331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7741334">func</span>&nbsp;<span class="ident" id="7741339">TestWriterDict</span><span class="op" id="7741353">(</span><span class="ident" id="7741354">t</span>&nbsp;<span class="op" id="7741356">*</span><span class="ident" id="7741357">testing</span><span class="op" id="7741364">.</span><span class="ident" id="7741365">T</span><span class="op" id="7741366">)</span>&nbsp;<span class="op" id="7741368">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7741371">const</span>&nbsp;<span class="op" id="7741377">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741381">dict</span>&nbsp;<span class="op" id="7741386">=</span>&nbsp;<span class="string" id="7741388">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741404">text</span>&nbsp;<span class="op" id="7741409">=</span>&nbsp;<span class="string" id="7741411">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7741432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7741435">var</span>&nbsp;<span class="ident" id="7741439">b</span>&nbsp;<span class="ident" id="7741441">bytes</span><span class="op" id="7741446">.</span><span class="ident" id="7741447">Buffer</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741455">w</span><span class="op" id="7741456">,</span>&nbsp;<span class="ident" id="7741458">err</span>&nbsp;<span class="op" id="7741462">:=</span>&nbsp;<span class="ident" id="7741465">NewWriter</span><span class="op" id="7741474">(</span><span class="op" id="7741475">&amp;</span><span class="ident" id="7741476">b</span><span class="op" id="7741477">,</span>&nbsp;<span class="num" id="7741479">5</span><span class="op" id="7741480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7741483">if</span>&nbsp;<span class="ident" id="7741486">err</span>&nbsp;<span class="op" id="7741490">!=</span>&nbsp;<span class="ident" id="7741493">nil</span>&nbsp;<span class="op" id="7741497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741501">t</span><span class="op" id="7741502">.</span><span class="ident" id="7741503">Fatalf</span><span class="op" id="7741509">(</span><span class="string" id="7741510">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7741525">,</span>&nbsp;<span class="ident" id="7741527">err</span><span class="op" id="7741530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7741533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741536">w</span><span class="op" id="7741537">.</span><span class="ident" id="7741538">Write</span><span class="op" id="7741543">(</span><span class="op" id="7741544">[</span><span class="op" id="7741545">]</span><span class="builtintype" id="7741546">byte</span><span class="op" id="7741550">(</span><span class="ident" id="7741551">dict</span><span class="op" id="7741555">)</span><span class="op" id="7741556">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741559">w</span><span class="op" id="7741560">.</span><span class="ident" id="7741561">Flush</span><span class="op" id="7741566">(</span><span class="op" id="7741567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741570">b</span><span class="op" id="7741571">.</span><span class="ident" id="7741572">Reset</span><span class="op" id="7741577">(</span><span class="op" id="7741578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741581">w</span><span class="op" id="7741582">.</span><span class="ident" id="7741583">Write</span><span class="op" id="7741588">(</span><span class="op" id="7741589">[</span><span class="op" id="7741590">]</span><span class="builtintype" id="7741591">byte</span><span class="op" id="7741595">(</span><span class="ident" id="7741596">text</span><span class="op" id="7741600">)</span><span class="op" id="7741601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741604">w</span><span class="op" id="7741605">.</span><span class="ident" id="7741606">Close</span><span class="op" id="7741611">(</span><span class="op" id="7741612">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7741616">var</span>&nbsp;<span class="ident" id="7741620">b1</span>&nbsp;<span class="ident" id="7741623">bytes</span><span class="op" id="7741628">.</span><span class="ident" id="7741629">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741637">w</span><span class="op" id="7741638">,</span>&nbsp;<span class="ident" id="7741640">_</span>&nbsp;<span class="op" id="7741642">=</span>&nbsp;<span class="ident" id="7741644">NewWriterDict</span><span class="op" id="7741657">(</span><span class="op" id="7741658">&amp;</span><span class="ident" id="7741659">b1</span><span class="op" id="7741661">,</span>&nbsp;<span class="num" id="7741663">5</span><span class="op" id="7741664">,</span>&nbsp;<span class="op" id="7741666">[</span><span class="op" id="7741667">]</span><span class="builtintype" id="7741668">byte</span><span class="op" id="7741672">(</span><span class="ident" id="7741673">dict</span><span class="op" id="7741677">)</span><span class="op" id="7741678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741681">w</span><span class="op" id="7741682">.</span><span class="ident" id="7741683">Write</span><span class="op" id="7741688">(</span><span class="op" id="7741689">[</span><span class="op" id="7741690">]</span><span class="builtintype" id="7741691">byte</span><span class="op" id="7741695">(</span><span class="ident" id="7741696">text</span><span class="op" id="7741700">)</span><span class="op" id="7741701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741704">w</span><span class="op" id="7741705">.</span><span class="ident" id="7741706">Close</span><span class="op" id="7741711">(</span><span class="op" id="7741712">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7741716">if</span>&nbsp;<span class="op" id="7741719">!</span><span class="ident" id="7741720">bytes</span><span class="op" id="7741725">.</span><span class="ident" id="7741726">Equal</span><span class="op" id="7741731">(</span><span class="ident" id="7741732">b1</span><span class="op" id="7741734">.</span><span class="ident" id="7741735">Bytes</span><span class="op" id="7741740">(</span><span class="op" id="7741741">)</span><span class="op" id="7741742">,</span>&nbsp;<span class="ident" id="7741744">b</span><span class="op" id="7741745">.</span><span class="ident" id="7741746">Bytes</span><span class="op" id="7741751">(</span><span class="op" id="7741752">)</span><span class="op" id="7741753">)</span>&nbsp;<span class="op" id="7741755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741759">t</span><span class="op" id="7741760">.</span><span class="ident" id="7741761">Fatalf</span><span class="op" id="7741767">(</span><span class="string" id="7741768">&#34;writer&nbsp;wrote&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7741793">,</span>&nbsp;<span class="ident" id="7741795">b1</span><span class="op" id="7741797">.</span><span class="ident" id="7741798">Bytes</span><span class="op" id="7741803">(</span><span class="op" id="7741804">)</span><span class="op" id="7741805">,</span>&nbsp;<span class="ident" id="7741807">b</span><span class="op" id="7741808">.</span><span class="ident" id="7741809">Bytes</span><span class="op" id="7741814">(</span><span class="op" id="7741815">)</span><span class="op" id="7741816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7741819">}</span><br>
<span class="lineno"></span><span class="op" id="7741821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="7741824">//&nbsp;See&nbsp;http://code.google.com/p/go/issues/detail?id=2508</span><br>
<span class="lineno"></span><span class="keyword" id="7741881">func</span>&nbsp;<span class="ident" id="7741886">TestRegression2508</span><span class="op" id="7741904">(</span><span class="ident" id="7741905">t</span>&nbsp;<span class="op" id="7741907">*</span><span class="ident" id="7741908">testing</span><span class="op" id="7741915">.</span><span class="ident" id="7741916">T</span><span class="op" id="7741917">)</span>&nbsp;<span class="op" id="7741919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7741922">if</span>&nbsp;<span class="ident" id="7741925">testing</span><span class="op" id="7741932">.</span><span class="ident" id="7741933">Short</span><span class="op" id="7741938">(</span><span class="op" id="7741939">)</span>&nbsp;<span class="op" id="7741941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741945">t</span><span class="op" id="7741946">.</span><span class="ident" id="7741947">Logf</span><span class="op" id="7741951">(</span><span class="string" id="7741952">&#34;test&nbsp;disabled&nbsp;with&nbsp;-short&#34;</span><span class="op" id="7741979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7741983">return</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7741991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7741994">w</span><span class="op" id="7741995">,</span>&nbsp;<span class="ident" id="7741997">err</span>&nbsp;<span class="op" id="7742001">:=</span>&nbsp;<span class="ident" id="7742004">NewWriter</span><span class="op" id="7742013">(</span><span class="ident" id="7742014">ioutil</span><span class="op" id="7742020">.</span><span class="ident" id="7742021">Discard</span><span class="op" id="7742028">,</span>&nbsp;<span class="num" id="7742030">1</span><span class="op" id="7742031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7742034">if</span>&nbsp;<span class="ident" id="7742037">err</span>&nbsp;<span class="op" id="7742041">!=</span>&nbsp;<span class="ident" id="7742044">nil</span>&nbsp;<span class="op" id="7742048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742052">t</span><span class="op" id="7742053">.</span><span class="ident" id="7742054">Fatalf</span><span class="op" id="7742060">(</span><span class="string" id="7742061">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7742076">,</span>&nbsp;<span class="ident" id="7742078">err</span><span class="op" id="7742081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7742084">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742087">buf</span>&nbsp;<span class="op" id="7742091">:=</span>&nbsp;<span class="builtinfunc" id="7742094">make</span><span class="op" id="7742098">(</span><span class="op" id="7742099">[</span><span class="op" id="7742100">]</span><span class="builtintype" id="7742101">byte</span><span class="op" id="7742105">,</span>&nbsp;<span class="num" id="7742107">1024</span><span class="op" id="7742111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7742114">for</span>&nbsp;<span class="ident" id="7742118">i</span>&nbsp;<span class="op" id="7742120">:=</span>&nbsp;<span class="num" id="7742123">0</span><span class="op" id="7742124">;</span>&nbsp;<span class="ident" id="7742126">i</span>&nbsp;<span class="op" id="7742128">&lt;</span>&nbsp;<span class="num" id="7742130">131072</span><span class="op" id="7742136">;</span>&nbsp;<span class="ident" id="7742138">i</span><span class="op" id="7742139">++</span>&nbsp;<span class="op" id="7742142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7742146">if</span>&nbsp;<span class="ident" id="7742149">_</span><span class="op" id="7742150">,</span>&nbsp;<span class="ident" id="7742152">err</span>&nbsp;<span class="op" id="7742156">:=</span>&nbsp;<span class="ident" id="7742159">w</span><span class="op" id="7742160">.</span><span class="ident" id="7742161">Write</span><span class="op" id="7742166">(</span><span class="ident" id="7742167">buf</span><span class="op" id="7742170">)</span><span class="op" id="7742171">;</span>&nbsp;<span class="ident" id="7742173">err</span>&nbsp;<span class="op" id="7742177">!=</span>&nbsp;<span class="ident" id="7742180">nil</span>&nbsp;<span class="op" id="7742184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742189">t</span><span class="op" id="7742190">.</span><span class="ident" id="7742191">Fatalf</span><span class="op" id="7742197">(</span><span class="string" id="7742198">&#34;writer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7742217">,</span>&nbsp;<span class="ident" id="7742219">err</span><span class="op" id="7742222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7742226">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7742229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742232">w</span><span class="op" id="7742233">.</span><span class="ident" id="7742234">Close</span><span class="op" id="7742239">(</span><span class="op" id="7742240">)</span><br>
<span class="lineno"></span><span class="op" id="7742242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7742245">func</span>&nbsp;<span class="ident" id="7742250">TestWriterReset</span><span class="op" id="7742265">(</span><span class="ident" id="7742266">t</span>&nbsp;<span class="op" id="7742268">*</span><span class="ident" id="7742269">testing</span><span class="op" id="7742276">.</span><span class="ident" id="7742277">T</span><span class="op" id="7742278">)</span>&nbsp;<span class="op" id="7742280">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7742283">for</span>&nbsp;<span class="ident" id="7742287">level</span>&nbsp;<span class="op" id="7742293">:=</span>&nbsp;<span class="num" id="7742296">0</span><span class="op" id="7742297">;</span>&nbsp;<span class="ident" id="7742299">level</span>&nbsp;<span class="op" id="7742305">&lt;=</span>&nbsp;<span class="num" id="7742308">9</span><span class="op" id="7742309">;</span>&nbsp;<span class="ident" id="7742311">level</span><span class="op" id="7742316">++</span>&nbsp;<span class="op" id="7742319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7742323">if</span>&nbsp;<span class="ident" id="7742326">testing</span><span class="op" id="7742333">.</span><span class="ident" id="7742334">Short</span><span class="op" id="7742339">(</span><span class="op" id="7742340">)</span>&nbsp;<span class="op" id="7742342">&amp;&amp;</span>&nbsp;<span class="ident" id="7742345">level</span>&nbsp;<span class="op" id="7742351">&gt;</span>&nbsp;<span class="num" id="7742353">1</span>&nbsp;<span class="op" id="7742355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7742360">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7742368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742372">w</span><span class="op" id="7742373">,</span>&nbsp;<span class="ident" id="7742375">err</span>&nbsp;<span class="op" id="7742379">:=</span>&nbsp;<span class="ident" id="7742382">NewWriter</span><span class="op" id="7742391">(</span><span class="ident" id="7742392">ioutil</span><span class="op" id="7742398">.</span><span class="ident" id="7742399">Discard</span><span class="op" id="7742406">,</span>&nbsp;<span class="ident" id="7742408">level</span><span class="op" id="7742413">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7742417">if</span>&nbsp;<span class="ident" id="7742420">err</span>&nbsp;<span class="op" id="7742424">!=</span>&nbsp;<span class="ident" id="7742427">nil</span>&nbsp;<span class="op" id="7742431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742436">t</span><span class="op" id="7742437">.</span><span class="ident" id="7742438">Fatalf</span><span class="op" id="7742444">(</span><span class="string" id="7742445">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7742460">,</span>&nbsp;<span class="ident" id="7742462">err</span><span class="op" id="7742465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7742469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742473">buf</span>&nbsp;<span class="op" id="7742477">:=</span>&nbsp;<span class="op" id="7742480">[</span><span class="op" id="7742481">]</span><span class="builtintype" id="7742482">byte</span><span class="op" id="7742486">(</span><span class="string" id="7742487">&#34;hello&nbsp;world&#34;</span><span class="op" id="7742500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7742504">for</span>&nbsp;<span class="ident" id="7742508">i</span>&nbsp;<span class="op" id="7742510">:=</span>&nbsp;<span class="num" id="7742513">0</span><span class="op" id="7742514">;</span>&nbsp;<span class="ident" id="7742516">i</span>&nbsp;<span class="op" id="7742518">&lt;</span>&nbsp;<span class="num" id="7742520">1024</span><span class="op" id="7742524">;</span>&nbsp;<span class="ident" id="7742526">i</span><span class="op" id="7742527">++</span>&nbsp;<span class="op" id="7742530">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742535">w</span><span class="op" id="7742536">.</span><span class="ident" id="7742537">Write</span><span class="op" id="7742542">(</span><span class="ident" id="7742543">buf</span><span class="op" id="7742546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7742550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742554">w</span><span class="op" id="7742555">.</span><span class="ident" id="7742556">Reset</span><span class="op" id="7742561">(</span><span class="ident" id="7742562">ioutil</span><span class="op" id="7742568">.</span><span class="ident" id="7742569">Discard</span><span class="op" id="7742576">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742581">wref</span><span class="op" id="7742585">,</span>&nbsp;<span class="ident" id="7742587">err</span>&nbsp;<span class="op" id="7742591">:=</span>&nbsp;<span class="ident" id="7742594">NewWriter</span><span class="op" id="7742603">(</span><span class="ident" id="7742604">ioutil</span><span class="op" id="7742610">.</span><span class="ident" id="7742611">Discard</span><span class="op" id="7742618">,</span>&nbsp;<span class="ident" id="7742620">level</span><span class="op" id="7742625">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7742629">if</span>&nbsp;<span class="ident" id="7742632">err</span>&nbsp;<span class="op" id="7742636">!=</span>&nbsp;<span class="ident" id="7742639">nil</span>&nbsp;<span class="op" id="7742643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742648">t</span><span class="op" id="7742649">.</span><span class="ident" id="7742650">Fatalf</span><span class="op" id="7742656">(</span><span class="string" id="7742657">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7742672">,</span>&nbsp;<span class="ident" id="7742674">err</span><span class="op" id="7742677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7742681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7742686">//&nbsp;DeepEqual&nbsp;doesn&#39;t&nbsp;compare&nbsp;functions.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742728">w</span><span class="op" id="7742729">.</span><span class="ident" id="7742730">d</span><span class="op" id="7742731">.</span><span class="ident" id="7742732">fill</span><span class="op" id="7742736">,</span>&nbsp;<span class="ident" id="7742738">wref</span><span class="op" id="7742742">.</span><span class="ident" id="7742743">d</span><span class="op" id="7742744">.</span><span class="ident" id="7742745">fill</span>&nbsp;<span class="op" id="7742750">=</span>&nbsp;<span class="ident" id="7742752">nil</span><span class="op" id="7742755">,</span>&nbsp;<span class="ident" id="7742757">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742763">w</span><span class="op" id="7742764">.</span><span class="ident" id="7742765">d</span><span class="op" id="7742766">.</span><span class="ident" id="7742767">step</span><span class="op" id="7742771">,</span>&nbsp;<span class="ident" id="7742773">wref</span><span class="op" id="7742777">.</span><span class="ident" id="7742778">d</span><span class="op" id="7742779">.</span><span class="ident" id="7742780">step</span>&nbsp;<span class="op" id="7742785">=</span>&nbsp;<span class="ident" id="7742787">nil</span><span class="op" id="7742790">,</span>&nbsp;<span class="ident" id="7742792">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7742798">if</span>&nbsp;<span class="op" id="7742801">!</span><span class="ident" id="7742802">reflect</span><span class="op" id="7742809">.</span><span class="ident" id="7742810">DeepEqual</span><span class="op" id="7742819">(</span><span class="ident" id="7742820">w</span><span class="op" id="7742821">,</span>&nbsp;<span class="ident" id="7742823">wref</span><span class="op" id="7742827">)</span>&nbsp;<span class="op" id="7742829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742834">t</span><span class="op" id="7742835">.</span><span class="ident" id="7742836">Errorf</span><span class="op" id="7742842">(</span><span class="string" id="7742843">&#34;level&nbsp;%d&nbsp;Writer&nbsp;not&nbsp;reset&nbsp;after&nbsp;Reset&#34;</span><span class="op" id="7742882">,</span>&nbsp;<span class="ident" id="7742884">level</span><span class="op" id="7742889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7742893">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7742896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742899">testResetOutput</span><span class="op" id="7742914">(</span><span class="ident" id="7742915">t</span><span class="op" id="7742916">,</span>&nbsp;<span class="keyword" id="7742918">func</span><span class="op" id="7742922">(</span><span class="ident" id="7742923">w</span>&nbsp;<span class="ident" id="7742925">io</span><span class="op" id="7742927">.</span><span class="ident" id="7742928">Writer</span><span class="op" id="7742934">)</span>&nbsp;<span class="op" id="7742936">(</span><span class="op" id="7742937">*</span><span class="ident" id="7742938">Writer</span><span class="op" id="7742944">,</span>&nbsp;<span class="builtintype" id="7742946">error</span><span class="op" id="7742951">)</span>&nbsp;<span class="op" id="7742953">{</span>&nbsp;<span class="keyword" id="7742955">return</span>&nbsp;<span class="ident" id="7742962">NewWriter</span><span class="op" id="7742971">(</span><span class="ident" id="7742972">w</span><span class="op" id="7742973">,</span>&nbsp;<span class="ident" id="7742975">NoCompression</span><span class="op" id="7742988">)</span>&nbsp;<span class="op" id="7742990">}</span><span class="op" id="7742991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7742994">testResetOutput</span><span class="op" id="7743009">(</span><span class="ident" id="7743010">t</span><span class="op" id="7743011">,</span>&nbsp;<span class="keyword" id="7743013">func</span><span class="op" id="7743017">(</span><span class="ident" id="7743018">w</span>&nbsp;<span class="ident" id="7743020">io</span><span class="op" id="7743022">.</span><span class="ident" id="7743023">Writer</span><span class="op" id="7743029">)</span>&nbsp;<span class="op" id="7743031">(</span><span class="op" id="7743032">*</span><span class="ident" id="7743033">Writer</span><span class="op" id="7743039">,</span>&nbsp;<span class="builtintype" id="7743041">error</span><span class="op" id="7743046">)</span>&nbsp;<span class="op" id="7743048">{</span>&nbsp;<span class="keyword" id="7743050">return</span>&nbsp;<span class="ident" id="7743057">NewWriter</span><span class="op" id="7743066">(</span><span class="ident" id="7743067">w</span><span class="op" id="7743068">,</span>&nbsp;<span class="ident" id="7743070">DefaultCompression</span><span class="op" id="7743088">)</span>&nbsp;<span class="op" id="7743090">}</span><span class="op" id="7743091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743094">testResetOutput</span><span class="op" id="7743109">(</span><span class="ident" id="7743110">t</span><span class="op" id="7743111">,</span>&nbsp;<span class="keyword" id="7743113">func</span><span class="op" id="7743117">(</span><span class="ident" id="7743118">w</span>&nbsp;<span class="ident" id="7743120">io</span><span class="op" id="7743122">.</span><span class="ident" id="7743123">Writer</span><span class="op" id="7743129">)</span>&nbsp;<span class="op" id="7743131">(</span><span class="op" id="7743132">*</span><span class="ident" id="7743133">Writer</span><span class="op" id="7743139">,</span>&nbsp;<span class="builtintype" id="7743141">error</span><span class="op" id="7743146">)</span>&nbsp;<span class="op" id="7743148">{</span>&nbsp;<span class="keyword" id="7743150">return</span>&nbsp;<span class="ident" id="7743157">NewWriter</span><span class="op" id="7743166">(</span><span class="ident" id="7743167">w</span><span class="op" id="7743168">,</span>&nbsp;<span class="ident" id="7743170">BestCompression</span><span class="op" id="7743185">)</span>&nbsp;<span class="op" id="7743187">}</span><span class="op" id="7743188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743191">dict</span>&nbsp;<span class="op" id="7743196">:=</span>&nbsp;<span class="op" id="7743199">[</span><span class="op" id="7743200">]</span><span class="builtintype" id="7743201">byte</span><span class="op" id="7743205">(</span><span class="string" id="7743206">&#34;we&nbsp;are&nbsp;the&nbsp;world&#34;</span><span class="op" id="7743224">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743227">testResetOutput</span><span class="op" id="7743242">(</span><span class="ident" id="7743243">t</span><span class="op" id="7743244">,</span>&nbsp;<span class="keyword" id="7743246">func</span><span class="op" id="7743250">(</span><span class="ident" id="7743251">w</span>&nbsp;<span class="ident" id="7743253">io</span><span class="op" id="7743255">.</span><span class="ident" id="7743256">Writer</span><span class="op" id="7743262">)</span>&nbsp;<span class="op" id="7743264">(</span><span class="op" id="7743265">*</span><span class="ident" id="7743266">Writer</span><span class="op" id="7743272">,</span>&nbsp;<span class="builtintype" id="7743274">error</span><span class="op" id="7743279">)</span>&nbsp;<span class="op" id="7743281">{</span>&nbsp;<span class="keyword" id="7743283">return</span>&nbsp;<span class="ident" id="7743290">NewWriterDict</span><span class="op" id="7743303">(</span><span class="ident" id="7743304">w</span><span class="op" id="7743305">,</span>&nbsp;<span class="ident" id="7743307">NoCompression</span><span class="op" id="7743320">,</span>&nbsp;<span class="ident" id="7743322">dict</span><span class="op" id="7743326">)</span>&nbsp;<span class="op" id="7743328">}</span><span class="op" id="7743329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743332">testResetOutput</span><span class="op" id="7743347">(</span><span class="ident" id="7743348">t</span><span class="op" id="7743349">,</span>&nbsp;<span class="keyword" id="7743351">func</span><span class="op" id="7743355">(</span><span class="ident" id="7743356">w</span>&nbsp;<span class="ident" id="7743358">io</span><span class="op" id="7743360">.</span><span class="ident" id="7743361">Writer</span><span class="op" id="7743367">)</span>&nbsp;<span class="op" id="7743369">(</span><span class="op" id="7743370">*</span><span class="ident" id="7743371">Writer</span><span class="op" id="7743377">,</span>&nbsp;<span class="builtintype" id="7743379">error</span><span class="op" id="7743384">)</span>&nbsp;<span class="op" id="7743386">{</span>&nbsp;<span class="keyword" id="7743388">return</span>&nbsp;<span class="ident" id="7743395">NewWriterDict</span><span class="op" id="7743408">(</span><span class="ident" id="7743409">w</span><span class="op" id="7743410">,</span>&nbsp;<span class="ident" id="7743412">DefaultCompression</span><span class="op" id="7743430">,</span>&nbsp;<span class="ident" id="7743432">dict</span><span class="op" id="7743436">)</span>&nbsp;<span class="op" id="7743438">}</span><span class="op" id="7743439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743442">testResetOutput</span><span class="op" id="7743457">(</span><span class="ident" id="7743458">t</span><span class="op" id="7743459">,</span>&nbsp;<span class="keyword" id="7743461">func</span><span class="op" id="7743465">(</span><span class="ident" id="7743466">w</span>&nbsp;<span class="ident" id="7743468">io</span><span class="op" id="7743470">.</span><span class="ident" id="7743471">Writer</span><span class="op" id="7743477">)</span>&nbsp;<span class="op" id="7743479">(</span><span class="op" id="7743480">*</span><span class="ident" id="7743481">Writer</span><span class="op" id="7743487">,</span>&nbsp;<span class="builtintype" id="7743489">error</span><span class="op" id="7743494">)</span>&nbsp;<span class="op" id="7743496">{</span>&nbsp;<span class="keyword" id="7743498">return</span>&nbsp;<span class="ident" id="7743505">NewWriterDict</span><span class="op" id="7743518">(</span><span class="ident" id="7743519">w</span><span class="op" id="7743520">,</span>&nbsp;<span class="ident" id="7743522">BestCompression</span><span class="op" id="7743537">,</span>&nbsp;<span class="ident" id="7743539">dict</span><span class="op" id="7743543">)</span>&nbsp;<span class="op" id="7743545">}</span><span class="op" id="7743546">)</span><br>
<span class="lineno"></span><span class="op" id="7743548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="keyword" id="7743551">func</span>&nbsp;<span class="ident" id="7743556">testResetOutput</span><span class="op" id="7743571">(</span><span class="ident" id="7743572">t</span>&nbsp;<span class="op" id="7743574">*</span><span class="ident" id="7743575">testing</span><span class="op" id="7743582">.</span><span class="ident" id="7743583">T</span><span class="op" id="7743584">,</span>&nbsp;<span class="ident" id="7743586">newWriter</span>&nbsp;<span class="keyword" id="7743596">func</span><span class="op" id="7743600">(</span><span class="ident" id="7743601">w</span>&nbsp;<span class="ident" id="7743603">io</span><span class="op" id="7743605">.</span><span class="ident" id="7743606">Writer</span><span class="op" id="7743612">)</span>&nbsp;<span class="op" id="7743614">(</span><span class="op" id="7743615">*</span><span class="ident" id="7743616">Writer</span><span class="op" id="7743622">,</span>&nbsp;<span class="builtintype" id="7743624">error</span><span class="op" id="7743629">)</span><span class="op" id="7743630">)</span>&nbsp;<span class="op" id="7743632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743635">buf</span>&nbsp;<span class="op" id="7743639">:=</span>&nbsp;<span class="builtinfunc" id="7743642">new</span><span class="op" id="7743645">(</span><span class="ident" id="7743646">bytes</span><span class="op" id="7743651">.</span><span class="ident" id="7743652">Buffer</span><span class="op" id="7743658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743661">w</span><span class="op" id="7743662">,</span>&nbsp;<span class="ident" id="7743664">err</span>&nbsp;<span class="op" id="7743668">:=</span>&nbsp;<span class="ident" id="7743671">newWriter</span><span class="op" id="7743680">(</span><span class="ident" id="7743681">buf</span><span class="op" id="7743684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7743687">if</span>&nbsp;<span class="ident" id="7743690">err</span>&nbsp;<span class="op" id="7743694">!=</span>&nbsp;<span class="ident" id="7743697">nil</span>&nbsp;<span class="op" id="7743701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743705">t</span><span class="op" id="7743706">.</span><span class="ident" id="7743707">Fatalf</span><span class="op" id="7743713">(</span><span class="string" id="7743714">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="7743729">,</span>&nbsp;<span class="ident" id="7743731">err</span><span class="op" id="7743734">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7743737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743740">b</span>&nbsp;<span class="op" id="7743742">:=</span>&nbsp;<span class="op" id="7743745">[</span><span class="op" id="7743746">]</span><span class="builtintype" id="7743747">byte</span><span class="op" id="7743751">(</span><span class="string" id="7743752">&#34;hello&nbsp;world&#34;</span><span class="op" id="7743765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7743768">for</span>&nbsp;<span class="ident" id="7743772">i</span>&nbsp;<span class="op" id="7743774">:=</span>&nbsp;<span class="num" id="7743777">0</span><span class="op" id="7743778">;</span>&nbsp;<span class="ident" id="7743780">i</span>&nbsp;<span class="op" id="7743782">&lt;</span>&nbsp;<span class="num" id="7743784">1024</span><span class="op" id="7743788">;</span>&nbsp;<span class="ident" id="7743790">i</span><span class="op" id="7743791">++</span>&nbsp;<span class="op" id="7743794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743798">w</span><span class="op" id="7743799">.</span><span class="ident" id="7743800">Write</span><span class="op" id="7743805">(</span><span class="ident" id="7743806">b</span><span class="op" id="7743807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7743810">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743813">w</span><span class="op" id="7743814">.</span><span class="ident" id="7743815">Close</span><span class="op" id="7743820">(</span><span class="op" id="7743821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743824">out1</span>&nbsp;<span class="op" id="7743829">:=</span>&nbsp;<span class="ident" id="7743832">buf</span><span class="op" id="7743835">.</span><span class="ident" id="7743836">String</span><span class="op" id="7743842">(</span><span class="op" id="7743843">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743847">buf2</span>&nbsp;<span class="op" id="7743852">:=</span>&nbsp;<span class="builtinfunc" id="7743855">new</span><span class="op" id="7743858">(</span><span class="ident" id="7743859">bytes</span><span class="op" id="7743864">.</span><span class="ident" id="7743865">Buffer</span><span class="op" id="7743871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743874">w</span><span class="op" id="7743875">.</span><span class="ident" id="7743876">Reset</span><span class="op" id="7743881">(</span><span class="ident" id="7743882">buf2</span><span class="op" id="7743886">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7743889">for</span>&nbsp;<span class="ident" id="7743893">i</span>&nbsp;<span class="op" id="7743895">:=</span>&nbsp;<span class="num" id="7743898">0</span><span class="op" id="7743899">;</span>&nbsp;<span class="ident" id="7743901">i</span>&nbsp;<span class="op" id="7743903">&lt;</span>&nbsp;<span class="num" id="7743905">1024</span><span class="op" id="7743909">;</span>&nbsp;<span class="ident" id="7743911">i</span><span class="op" id="7743912">++</span>&nbsp;<span class="op" id="7743915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743919">w</span><span class="op" id="7743920">.</span><span class="ident" id="7743921">Write</span><span class="op" id="7743926">(</span><span class="ident" id="7743927">b</span><span class="op" id="7743928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7743931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743934">w</span><span class="op" id="7743935">.</span><span class="ident" id="7743936">Close</span><span class="op" id="7743941">(</span><span class="op" id="7743942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743945">out2</span>&nbsp;<span class="op" id="7743950">:=</span>&nbsp;<span class="ident" id="7743953">buf2</span><span class="op" id="7743957">.</span><span class="ident" id="7743958">String</span><span class="op" id="7743964">(</span><span class="op" id="7743965">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7743969">if</span>&nbsp;<span class="ident" id="7743972">out1</span>&nbsp;<span class="op" id="7743977">!=</span>&nbsp;<span class="ident" id="7743980">out2</span>&nbsp;<span class="op" id="7743985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7743989">t</span><span class="op" id="7743990">.</span><span class="ident" id="7743991">Errorf</span><span class="op" id="7743997">(</span><span class="string" id="7743998">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7744019">,</span>&nbsp;<span class="ident" id="7744021">out2</span><span class="op" id="7744025">,</span>&nbsp;<span class="ident" id="7744027">out1</span><span class="op" id="7744031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7744034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7744037">t</span><span class="op" id="7744038">.</span><span class="ident" id="7744039">Logf</span><span class="op" id="7744043">(</span><span class="string" id="7744044">&#34;got&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="7744058">,</span>&nbsp;<span class="builtinfunc" id="7744060">len</span><span class="op" id="7744063">(</span><span class="ident" id="7744064">out1</span><span class="op" id="7744068">)</span><span class="op" id="7744069">)</span><br>
<span class="lineno">490</span><span class="op" id="7744071">}</span>
</div>
</body>
</html>
