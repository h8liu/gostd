<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html" class="current">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1588625">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1588680">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1588734">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1588785">package</span>&nbsp;<span class="ident" id="1588793">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1588802">import</span>&nbsp;<span class="op" id="1588809">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1588812">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1588821">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1588824">const</span>&nbsp;<span class="op" id="1588830">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588833">debugMalloc</span>&nbsp;<span class="op" id="1588845">=</span>&nbsp;<span class="builtintype" id="1588847">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588855">flagNoScan</span>&nbsp;<span class="op" id="1588866">=</span>&nbsp;<span class="ident" id="1588868"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795089">_FlagNoScan</a></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588881">flagNoZero</span>&nbsp;<span class="op" id="1588892">=</span>&nbsp;<span class="ident" id="1588894"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795111">_FlagNoZero</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588908">maxTinySize</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1588922">=</span>&nbsp;<span class="ident" id="1588924"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791982">_TinySize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588935">tinySizeClass</span>&nbsp;<span class="op" id="1588949">=</span>&nbsp;<span class="ident" id="1588951"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792003">_TinySizeClass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588967">maxSmallSize</span>&nbsp;&nbsp;<span class="op" id="1588981">=</span>&nbsp;<span class="ident" id="1588983"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791954">_MaxSmallSize</a></span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588999">pageShift</span>&nbsp;<span class="op" id="1589009">=</span>&nbsp;<span class="ident" id="1589011"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791859">_PageShift</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1589023">pageSize</span>&nbsp;&nbsp;<span class="op" id="1589033">=</span>&nbsp;<span class="ident" id="1589035"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791881">_PageSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1589046">pageMask</span>&nbsp;&nbsp;<span class="op" id="1589056">=</span>&nbsp;<span class="ident" id="1589058"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791904">_PageMask</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1589070">bitsPerPointer</span>&nbsp;&nbsp;<span class="op" id="1589086">=</span>&nbsp;<span class="ident" id="1589088"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802187">_BitsPerPointer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1589105">bitsMask</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1589121">=</span>&nbsp;<span class="ident" id="1589123"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802213">_BitsMask</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1589134">pointersPerByte</span>&nbsp;<span class="op" id="1589150">=</span>&nbsp;<span class="ident" id="1589152"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802233">_PointersPerByte</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1589170">maxGCMask</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1589186">=</span>&nbsp;<span class="ident" id="1589188"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802392">_MaxGCMask</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1589200">bitsDead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1589216">=</span>&nbsp;<span class="ident" id="1589218"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802260">_BitsDead</a></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1589229">bitsPointer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1589245">=</span>&nbsp;<span class="ident" id="1589247"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802302">_BitsPointer</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1589262">mSpanInUse</span>&nbsp;<span class="op" id="1589273">=</span>&nbsp;<span class="ident" id="1589275"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793940">_MSpanInUse</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1589289">concurrentSweep</span>&nbsp;<span class="op" id="1589305">=</span>&nbsp;<span class="ident" id="1589307"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802548">_ConcurrentSweep</a></span>&nbsp;<span class="op" id="1589324">!=</span>&nbsp;<span class="num" id="1589327">0</span><br>
<span class="lineno">35</span><span class="op" id="1589329">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1589332">//&nbsp;Page&nbsp;number&nbsp;(address&gt;&gt;pageShift)</span><br>
<span class="lineno"></span><span class="keyword" id="1589368">type</span>&nbsp;<span class="ident" id="1589373">pageID</span>&nbsp;<span class="builtintype" id="1589380">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="1589389">//&nbsp;base&nbsp;address&nbsp;for&nbsp;all&nbsp;0-byte&nbsp;allocations</span><br>
<span class="lineno"></span><span class="keyword" id="1589432">var</span>&nbsp;<span class="ident" id="1589436">zerobase</span>&nbsp;<span class="builtintype" id="1589445">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1589454">//&nbsp;Allocate&nbsp;an&nbsp;object&nbsp;of&nbsp;size&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="1589491">//&nbsp;Small&nbsp;objects&nbsp;are&nbsp;allocated&nbsp;from&nbsp;the&nbsp;per-P&nbsp;cache&#39;s&nbsp;free&nbsp;lists.</span><br>
<span class="lineno">45</span><span class="comment" id="1589557">//&nbsp;Large&nbsp;objects&nbsp;(&gt;&nbsp;32&nbsp;kB)&nbsp;are&nbsp;allocated&nbsp;straight&nbsp;from&nbsp;the&nbsp;heap.</span><br>
<span class="lineno"></span><span class="keyword" id="1589622">func</span>&nbsp;<span class="ident" id="1589627">mallocgc</span><span class="op" id="1589635">(</span><span class="ident" id="1589636">size</span>&nbsp;<span class="builtintype" id="1589641">uintptr</span><span class="op" id="1589648">,</span>&nbsp;<span class="ident" id="1589650">typ</span>&nbsp;<span class="op" id="1589654">*</span><span class="ident" id="1589655"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795605">_type</a></span><span class="op" id="1589660">,</span>&nbsp;<span class="ident" id="1589662">flags</span>&nbsp;<span class="builtintype" id="1589668">uint32</span><span class="op" id="1589674">)</span>&nbsp;<span class="ident" id="1589676"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1589682">.</span><span class="ident" id="1589683">Pointer</span>&nbsp;<span class="op" id="1589691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1589694">if</span>&nbsp;<span class="ident" id="1589697"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span>&nbsp;<span class="op" id="1589702">==</span>&nbsp;<span class="num" id="1589705">0</span>&nbsp;<span class="op" id="1589707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1589711">return</span>&nbsp;<span class="ident" id="1589718"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1589724">.</span><span class="ident" id="1589725">Pointer</span><span class="op" id="1589732">(</span><span class="op" id="1589733">&amp;</span><span class="ident" id="1589734"><a href="/gostd/runtime/malloc.go.html#1589436">zerobase</a></span><span class="op" id="1589742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1589745">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1589748">size0</span>&nbsp;<span class="op" id="1589754">:=</span>&nbsp;<span class="ident" id="1589757"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1589764">if</span>&nbsp;<span class="ident" id="1589767"><a href="/gostd/runtime/malloc.go.html#1589662">flags</a></span><span class="op" id="1589772">&amp;</span><span class="ident" id="1589773"><a href="/gostd/runtime/malloc.go.html#1588855">flagNoScan</a></span>&nbsp;<span class="op" id="1589784">==</span>&nbsp;<span class="num" id="1589787">0</span>&nbsp;<span class="op" id="1589789">&amp;&amp;</span>&nbsp;<span class="ident" id="1589792"><a href="/gostd/runtime/malloc.go.html#1589650">typ</a></span>&nbsp;<span class="op" id="1589796">==</span>&nbsp;<span class="builtintype" id="1589799">nil</span>&nbsp;<span class="op" id="1589803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1589807"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1589814">(</span><span class="string" id="1589815">&#34;malloc&nbsp;missing&nbsp;type&#34;</span><span class="op" id="1589836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1589839">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1589843">//&nbsp;This&nbsp;function&nbsp;must&nbsp;be&nbsp;atomic&nbsp;wrt&nbsp;GC,&nbsp;but&nbsp;for&nbsp;performance&nbsp;reasons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1589912">//&nbsp;we&nbsp;don&#39;t&nbsp;acquirem/releasem&nbsp;on&nbsp;fast&nbsp;path.&nbsp;The&nbsp;code&nbsp;below&nbsp;does&nbsp;not&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1589986">//&nbsp;split&nbsp;stack&nbsp;checks,&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;preempted&nbsp;by&nbsp;GC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1590042">//&nbsp;Functions&nbsp;like&nbsp;roundup/add&nbsp;are&nbsp;inlined.&nbsp;And&nbsp;onM/racemalloc&nbsp;are&nbsp;nosplit.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1590118">//&nbsp;If&nbsp;debugMalloc&nbsp;=&nbsp;true,&nbsp;these&nbsp;assumptions&nbsp;are&nbsp;checked&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1590182">if</span>&nbsp;<span class="ident" id="1590185"><a href="/gostd/runtime/malloc.go.html#1588833">debugMalloc</a></span>&nbsp;<span class="op" id="1590197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1590201">mp</span>&nbsp;<span class="op" id="1590204">:=</span>&nbsp;<span class="ident" id="1590207"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1590215">(</span><span class="op" id="1590216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1590220">if</span>&nbsp;<span class="ident" id="1590223"><a href="/gostd/runtime/malloc.go.html#1590201">mp</a></span><span class="op" id="1590225">.</span><span class="ident" id="1590226"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787961">mallocing</a></span>&nbsp;<span class="op" id="1590236">!=</span>&nbsp;<span class="num" id="1590239">0</span>&nbsp;<span class="op" id="1590241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1590246"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1590253">(</span><span class="string" id="1590254">&#34;malloc&nbsp;deadlock&#34;</span><span class="op" id="1590271">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1590275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1590279"><a href="/gostd/runtime/malloc.go.html#1590201">mp</a></span><span class="op" id="1590281">.</span><span class="ident" id="1590282"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787961">mallocing</a></span>&nbsp;<span class="op" id="1590292">=</span>&nbsp;<span class="num" id="1590294">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1590298">if</span>&nbsp;<span class="ident" id="1590301"><a href="/gostd/runtime/malloc.go.html#1590201">mp</a></span><span class="op" id="1590303">.</span><span class="ident" id="1590304"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span>&nbsp;<span class="op" id="1590309">!=</span>&nbsp;<span class="builtintype" id="1590312">nil</span>&nbsp;<span class="op" id="1590316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1590321"><a href="/gostd/runtime/malloc.go.html#1590201">mp</a></span><span class="op" id="1590323">.</span><span class="ident" id="1590324"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span><span class="op" id="1590328">.</span><span class="ident" id="1590329"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787296">stackguard0</a></span>&nbsp;<span class="op" id="1590341">=</span>&nbsp;<span class="op" id="1590343">^</span><span class="builtintype" id="1590344">uintptr</span><span class="op" id="1590351">(</span><span class="num" id="1590352">0xfff</span><span class="op" id="1590357">)</span>&nbsp;<span class="op" id="1590359">|</span>&nbsp;<span class="num" id="1590361">0xbad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1590369">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1590372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1590376">c</span>&nbsp;<span class="op" id="1590378">:=</span>&nbsp;<span class="ident" id="1590381"><a href="/gostd/runtime/stubs.go.html#1738974">gomcache</a></span><span class="op" id="1590389">(</span><span class="op" id="1590390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1590393">var</span>&nbsp;<span class="ident" id="1590397">s</span>&nbsp;<span class="op" id="1590399">*</span><span class="ident" id="1590400"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794050">mspan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1590407">var</span>&nbsp;<span class="ident" id="1590411">x</span>&nbsp;<span class="ident" id="1590413"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1590419">.</span><span class="ident" id="1590420">Pointer</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1590429">if</span>&nbsp;<span class="ident" id="1590432"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span>&nbsp;<span class="op" id="1590437">&lt;=</span>&nbsp;<span class="ident" id="1590440"><a href="/gostd/runtime/malloc.go.html#1588967">maxSmallSize</a></span>&nbsp;<span class="op" id="1590453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1590457">if</span>&nbsp;<span class="ident" id="1590460"><a href="/gostd/runtime/malloc.go.html#1589662">flags</a></span><span class="op" id="1590465">&amp;</span><span class="ident" id="1590466"><a href="/gostd/runtime/malloc.go.html#1588855">flagNoScan</a></span>&nbsp;<span class="op" id="1590477">!=</span>&nbsp;<span class="num" id="1590480">0</span>&nbsp;<span class="op" id="1590482">&amp;&amp;</span>&nbsp;<span class="ident" id="1590485"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span>&nbsp;<span class="op" id="1590490">&lt;</span>&nbsp;<span class="ident" id="1590492"><a href="/gostd/runtime/malloc.go.html#1588908">maxTinySize</a></span>&nbsp;<span class="op" id="1590504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1590509">//&nbsp;Tiny&nbsp;allocator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1590531">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1590537">//&nbsp;Tiny&nbsp;allocator&nbsp;combines&nbsp;several&nbsp;tiny&nbsp;allocation&nbsp;requests</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1590600">//&nbsp;into&nbsp;a&nbsp;single&nbsp;memory&nbsp;block.&nbsp;The&nbsp;resulting&nbsp;memory&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1590661">//&nbsp;is&nbsp;freed&nbsp;when&nbsp;all&nbsp;subobjects&nbsp;are&nbsp;unreachable.&nbsp;The&nbsp;subobjects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1590728">//&nbsp;must&nbsp;be&nbsp;FlagNoScan&nbsp;(don&#39;t&nbsp;have&nbsp;pointers),&nbsp;this&nbsp;ensures&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1590794">//&nbsp;the&nbsp;amount&nbsp;of&nbsp;potentially&nbsp;wasted&nbsp;memory&nbsp;is&nbsp;bounded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1590852">//</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1590858">//&nbsp;Size&nbsp;of&nbsp;the&nbsp;memory&nbsp;block&nbsp;used&nbsp;for&nbsp;combining&nbsp;(maxTinySize)&nbsp;is&nbsp;tunable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1590934">//&nbsp;Current&nbsp;setting&nbsp;is&nbsp;16&nbsp;bytes,&nbsp;which&nbsp;relates&nbsp;to&nbsp;2x&nbsp;worst&nbsp;case&nbsp;memory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591007">//&nbsp;wastage&nbsp;(when&nbsp;all&nbsp;but&nbsp;one&nbsp;subobjects&nbsp;are&nbsp;unreachable).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591068">//&nbsp;8&nbsp;bytes&nbsp;would&nbsp;result&nbsp;in&nbsp;no&nbsp;wastage&nbsp;at&nbsp;all,&nbsp;but&nbsp;provides&nbsp;less</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591135">//&nbsp;opportunities&nbsp;for&nbsp;combining.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591170">//&nbsp;32&nbsp;bytes&nbsp;provides&nbsp;more&nbsp;opportunities&nbsp;for&nbsp;combining,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591228">//&nbsp;but&nbsp;can&nbsp;lead&nbsp;to&nbsp;4x&nbsp;worst&nbsp;case&nbsp;wastage.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591273">//&nbsp;The&nbsp;best&nbsp;case&nbsp;winning&nbsp;is&nbsp;8x&nbsp;regardless&nbsp;of&nbsp;block&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591333">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591339">//&nbsp;Objects&nbsp;obtained&nbsp;from&nbsp;tiny&nbsp;allocator&nbsp;must&nbsp;not&nbsp;be&nbsp;freed&nbsp;explicitly.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591412">//&nbsp;So&nbsp;when&nbsp;an&nbsp;object&nbsp;will&nbsp;be&nbsp;freed&nbsp;explicitly,&nbsp;we&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591477">//&nbsp;its&nbsp;size&nbsp;&gt;=&nbsp;maxTinySize.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591508">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591514">//&nbsp;SetFinalizer&nbsp;has&nbsp;a&nbsp;special&nbsp;case&nbsp;for&nbsp;objects&nbsp;potentially&nbsp;coming</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591583">//&nbsp;from&nbsp;tiny&nbsp;allocator,&nbsp;it&nbsp;such&nbsp;case&nbsp;it&nbsp;allows&nbsp;to&nbsp;set&nbsp;finalizers</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591651">//&nbsp;for&nbsp;an&nbsp;inner&nbsp;byte&nbsp;of&nbsp;a&nbsp;memory&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591694">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591700">//&nbsp;The&nbsp;main&nbsp;targets&nbsp;of&nbsp;tiny&nbsp;allocator&nbsp;are&nbsp;small&nbsp;strings&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591763">//&nbsp;standalone&nbsp;escaping&nbsp;variables.&nbsp;On&nbsp;a&nbsp;json&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591820">//&nbsp;the&nbsp;allocator&nbsp;reduces&nbsp;number&nbsp;of&nbsp;allocations&nbsp;by&nbsp;~12%&nbsp;and</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1591882">//&nbsp;reduces&nbsp;heap&nbsp;size&nbsp;by&nbsp;~20%.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1591915">tinysize</span>&nbsp;<span class="op" id="1591924">:=</span>&nbsp;<span class="builtintype" id="1591927">uintptr</span><span class="op" id="1591934">(</span><span class="ident" id="1591935"><a href="/gostd/runtime/malloc.go.html#1590376">c</a></span><span class="op" id="1591936">.</span><span class="ident" id="1591937"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793400">tinysize</a></span><span class="op" id="1591945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1591950">if</span>&nbsp;<span class="ident" id="1591953"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span>&nbsp;<span class="op" id="1591958">&lt;=</span>&nbsp;<span class="ident" id="1591961"><a href="/gostd/runtime/malloc.go.html#1591915">tinysize</a></span>&nbsp;<span class="op" id="1591970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1591976">tiny</span>&nbsp;<span class="op" id="1591981">:=</span>&nbsp;<span class="ident" id="1591984"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1591990">.</span><span class="ident" id="1591991">Pointer</span><span class="op" id="1591998">(</span><span class="ident" id="1591999"><a href="/gostd/runtime/malloc.go.html#1590376">c</a></span><span class="op" id="1592000">.</span><span class="ident" id="1592001"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793388">tiny</a></span><span class="op" id="1592005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1592011">//&nbsp;Align&nbsp;tiny&nbsp;pointer&nbsp;for&nbsp;required&nbsp;(conservative)&nbsp;alignment.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1592076">if</span>&nbsp;<span class="ident" id="1592079"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1592083">&amp;</span><span class="num" id="1592084">7</span>&nbsp;<span class="op" id="1592086">==</span>&nbsp;<span class="num" id="1592089">0</span>&nbsp;<span class="op" id="1592091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592098"><a href="/gostd/runtime/malloc.go.html#1591976">tiny</a></span>&nbsp;<span class="op" id="1592103">=</span>&nbsp;<span class="ident" id="1592105"><a href="/gostd/runtime/stubs.go.html#1738766">roundup</a></span><span class="op" id="1592112">(</span><span class="ident" id="1592113"><a href="/gostd/runtime/malloc.go.html#1591976">tiny</a></span><span class="op" id="1592117">,</span>&nbsp;<span class="num" id="1592119">8</span><span class="op" id="1592120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1592126">}</span>&nbsp;<span class="keyword" id="1592128">else</span>&nbsp;<span class="keyword" id="1592133">if</span>&nbsp;<span class="ident" id="1592136"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1592140">&amp;</span><span class="num" id="1592141">3</span>&nbsp;<span class="op" id="1592143">==</span>&nbsp;<span class="num" id="1592146">0</span>&nbsp;<span class="op" id="1592148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592155"><a href="/gostd/runtime/malloc.go.html#1591976">tiny</a></span>&nbsp;<span class="op" id="1592160">=</span>&nbsp;<span class="ident" id="1592162"><a href="/gostd/runtime/stubs.go.html#1738766">roundup</a></span><span class="op" id="1592169">(</span><span class="ident" id="1592170"><a href="/gostd/runtime/malloc.go.html#1591976">tiny</a></span><span class="op" id="1592174">,</span>&nbsp;<span class="num" id="1592176">4</span><span class="op" id="1592177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1592183">}</span>&nbsp;<span class="keyword" id="1592185">else</span>&nbsp;<span class="keyword" id="1592190">if</span>&nbsp;<span class="ident" id="1592193"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1592197">&amp;</span><span class="num" id="1592198">1</span>&nbsp;<span class="op" id="1592200">==</span>&nbsp;<span class="num" id="1592203">0</span>&nbsp;<span class="op" id="1592205">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592212"><a href="/gostd/runtime/malloc.go.html#1591976">tiny</a></span>&nbsp;<span class="op" id="1592217">=</span>&nbsp;<span class="ident" id="1592219"><a href="/gostd/runtime/stubs.go.html#1738766">roundup</a></span><span class="op" id="1592226">(</span><span class="ident" id="1592227"><a href="/gostd/runtime/malloc.go.html#1591976">tiny</a></span><span class="op" id="1592231">,</span>&nbsp;<span class="num" id="1592233">2</span><span class="op" id="1592234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1592240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592246">size1</span>&nbsp;<span class="op" id="1592252">:=</span>&nbsp;<span class="ident" id="1592255"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span>&nbsp;<span class="op" id="1592260">+</span>&nbsp;<span class="op" id="1592262">(</span><span class="builtintype" id="1592263">uintptr</span><span class="op" id="1592270">(</span><span class="ident" id="1592271"><a href="/gostd/runtime/malloc.go.html#1591976">tiny</a></span><span class="op" id="1592275">)</span>&nbsp;<span class="op" id="1592277">-</span>&nbsp;<span class="builtintype" id="1592279">uintptr</span><span class="op" id="1592286">(</span><span class="ident" id="1592287"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1592293">.</span><span class="ident" id="1592294">Pointer</span><span class="op" id="1592301">(</span><span class="ident" id="1592302"><a href="/gostd/runtime/malloc.go.html#1590376">c</a></span><span class="op" id="1592303">.</span><span class="ident" id="1592304"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793388">tiny</a></span><span class="op" id="1592308">)</span><span class="op" id="1592309">)</span><span class="op" id="1592310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1592316">if</span>&nbsp;<span class="ident" id="1592319"><a href="/gostd/runtime/malloc.go.html#1592246">size1</a></span>&nbsp;<span class="op" id="1592325">&lt;=</span>&nbsp;<span class="ident" id="1592328"><a href="/gostd/runtime/malloc.go.html#1591915">tinysize</a></span>&nbsp;<span class="op" id="1592337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1592344">//&nbsp;The&nbsp;object&nbsp;fits&nbsp;into&nbsp;existing&nbsp;tiny&nbsp;block.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592394"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span>&nbsp;<span class="op" id="1592396">=</span>&nbsp;<span class="ident" id="1592398"><a href="/gostd/runtime/malloc.go.html#1591976">tiny</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592408"><a href="/gostd/runtime/malloc.go.html#1590376">c</a></span><span class="op" id="1592409">.</span><span class="ident" id="1592410"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793388">tiny</a></span>&nbsp;<span class="op" id="1592415">=</span>&nbsp;<span class="op" id="1592417">(</span><span class="op" id="1592418">*</span><span class="builtintype" id="1592419">byte</span><span class="op" id="1592423">)</span><span class="op" id="1592424">(</span><span class="ident" id="1592425"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1592428">(</span><span class="ident" id="1592429"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span><span class="op" id="1592430">,</span>&nbsp;<span class="ident" id="1592432"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1592436">)</span><span class="op" id="1592437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592444"><a href="/gostd/runtime/malloc.go.html#1590376">c</a></span><span class="op" id="1592445">.</span><span class="ident" id="1592446"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793400">tinysize</a></span>&nbsp;<span class="op" id="1592455">-=</span>&nbsp;<span class="builtintype" id="1592458">uintptr</span><span class="op" id="1592465">(</span><span class="ident" id="1592466"><a href="/gostd/runtime/malloc.go.html#1592246">size1</a></span><span class="op" id="1592471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592478"><a href="/gostd/runtime/malloc.go.html#1590376">c</a></span><span class="op" id="1592479">.</span><span class="ident" id="1592480"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793418">local_tinyallocs</a></span><span class="op" id="1592496">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1592504">if</span>&nbsp;<span class="ident" id="1592507"><a href="/gostd/runtime/malloc.go.html#1588833">debugMalloc</a></span>&nbsp;<span class="op" id="1592519">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592527">mp</span>&nbsp;<span class="op" id="1592530">:=</span>&nbsp;<span class="ident" id="1592533"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1592541">(</span><span class="op" id="1592542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1592550">if</span>&nbsp;<span class="ident" id="1592553"><a href="/gostd/runtime/malloc.go.html#1592527">mp</a></span><span class="op" id="1592555">.</span><span class="ident" id="1592556"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787961">mallocing</a></span>&nbsp;<span class="op" id="1592566">==</span>&nbsp;<span class="num" id="1592569">0</span>&nbsp;<span class="op" id="1592571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592580"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1592587">(</span><span class="string" id="1592588">&#34;bad&nbsp;malloc&#34;</span><span class="op" id="1592600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1592608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592616"><a href="/gostd/runtime/malloc.go.html#1592527">mp</a></span><span class="op" id="1592618">.</span><span class="ident" id="1592619"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787961">mallocing</a></span>&nbsp;<span class="op" id="1592629">=</span>&nbsp;<span class="num" id="1592631">0</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1592639">if</span>&nbsp;<span class="ident" id="1592642"><a href="/gostd/runtime/malloc.go.html#1592527">mp</a></span><span class="op" id="1592644">.</span><span class="ident" id="1592645"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span>&nbsp;<span class="op" id="1592650">!=</span>&nbsp;<span class="builtintype" id="1592653">nil</span>&nbsp;<span class="op" id="1592657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592666"><a href="/gostd/runtime/malloc.go.html#1592527">mp</a></span><span class="op" id="1592668">.</span><span class="ident" id="1592669"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span><span class="op" id="1592673">.</span><span class="ident" id="1592674"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787296">stackguard0</a></span>&nbsp;<span class="op" id="1592686">=</span>&nbsp;<span class="ident" id="1592688"><a href="/gostd/runtime/malloc.go.html#1592527">mp</a></span><span class="op" id="1592690">.</span><span class="ident" id="1592691"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span><span class="op" id="1592695">.</span><span class="ident" id="1592696"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787283">stack</a></span><span class="op" id="1592701">.</span><span class="ident" id="1592702"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787240">lo</a></span>&nbsp;<span class="op" id="1592705">+</span>&nbsp;<span class="ident" id="1592707"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1801790">_StackGuard</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1592725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1592733">//&nbsp;Note:&nbsp;one&nbsp;releasem&nbsp;for&nbsp;the&nbsp;acquirem&nbsp;just&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1592790">//&nbsp;The&nbsp;other&nbsp;for&nbsp;the&nbsp;acquirem&nbsp;at&nbsp;start&nbsp;of&nbsp;malloc.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592846"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1592854">(</span><span class="ident" id="1592855"><a href="/gostd/runtime/malloc.go.html#1592527">mp</a></span><span class="op" id="1592857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592865"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1592873">(</span><span class="ident" id="1592874"><a href="/gostd/runtime/malloc.go.html#1592527">mp</a></span><span class="op" id="1592876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1592883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1592890">return</span>&nbsp;<span class="ident" id="1592897"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1592903">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1592908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1592913">//&nbsp;Allocate&nbsp;a&nbsp;new&nbsp;maxTinySize&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592953"><a href="/gostd/runtime/malloc.go.html#1590397">s</a></span>&nbsp;<span class="op" id="1592955">=</span>&nbsp;<span class="ident" id="1592957"><a href="/gostd/runtime/malloc.go.html#1590376">c</a></span><span class="op" id="1592958">.</span><span class="ident" id="1592959"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793444">alloc</a></span><span class="op" id="1592964">[</span><span class="ident" id="1592965"><a href="/gostd/runtime/malloc.go.html#1588935">tinySizeClass</a></span><span class="op" id="1592978">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1592983">v</span>&nbsp;<span class="op" id="1592985">:=</span>&nbsp;<span class="ident" id="1592988"><a href="/gostd/runtime/malloc.go.html#1590397">s</a></span><span class="op" id="1592989">.</span><span class="ident" id="1592990"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794122">freelist</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1593002">if</span>&nbsp;<span class="ident" id="1593005"><a href="/gostd/runtime/malloc.go.html#1592983">v</a></span>&nbsp;<span class="op" id="1593007">==</span>&nbsp;<span class="builtintype" id="1593010">nil</span>&nbsp;<span class="op" id="1593014">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593020">mp</span>&nbsp;<span class="op" id="1593023">:=</span>&nbsp;<span class="ident" id="1593026"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1593034">(</span><span class="op" id="1593035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593041"><a href="/gostd/runtime/malloc.go.html#1593020">mp</a></span><span class="op" id="1593043">.</span><span class="ident" id="1593044"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788525">scalararg</a></span><span class="op" id="1593053">[</span><span class="num" id="1593054">0</span><span class="op" id="1593055">]</span>&nbsp;<span class="op" id="1593057">=</span>&nbsp;<span class="ident" id="1593059"><a href="/gostd/runtime/malloc.go.html#1588935">tinySizeClass</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593077"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1593080">(</span><span class="ident" id="1593081"><a href="/gostd/runtime/stubs.go.html#1742141">mcacheRefill_m</a></span><span class="op" id="1593095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593101"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1593109">(</span><span class="ident" id="1593110"><a href="/gostd/runtime/malloc.go.html#1593020">mp</a></span><span class="op" id="1593112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593118"><a href="/gostd/runtime/malloc.go.html#1590397">s</a></span>&nbsp;<span class="op" id="1593120">=</span>&nbsp;<span class="ident" id="1593122"><a href="/gostd/runtime/malloc.go.html#1590376">c</a></span><span class="op" id="1593123">.</span><span class="ident" id="1593124"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793444">alloc</a></span><span class="op" id="1593129">[</span><span class="ident" id="1593130"><a href="/gostd/runtime/malloc.go.html#1588935">tinySizeClass</a></span><span class="op" id="1593143">]</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593149"><a href="/gostd/runtime/malloc.go.html#1592983">v</a></span>&nbsp;<span class="op" id="1593151">=</span>&nbsp;<span class="ident" id="1593153"><a href="/gostd/runtime/malloc.go.html#1590397">s</a></span><span class="op" id="1593154">.</span><span class="ident" id="1593155"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794122">freelist</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1593167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593172"><a href="/gostd/runtime/malloc.go.html#1590397">s</a></span><span class="op" id="1593173">.</span><span class="ident" id="1593174"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794122">freelist</a></span>&nbsp;<span class="op" id="1593183">=</span>&nbsp;<span class="ident" id="1593185"><a href="/gostd/runtime/malloc.go.html#1592983">v</a></span><span class="op" id="1593186">.</span><span class="ident" id="1593187"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792234">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593195"><a href="/gostd/runtime/malloc.go.html#1590397">s</a></span><span class="op" id="1593196">.</span><span class="ident" id="1593197"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794156">ref</a></span><span class="op" id="1593200">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1593206">//TODO:&nbsp;prefetch&nbsp;v.next</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593233"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span>&nbsp;<span class="op" id="1593235">=</span>&nbsp;<span class="ident" id="1593237"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1593243">.</span><span class="ident" id="1593244">Pointer</span><span class="op" id="1593251">(</span><span class="ident" id="1593252"><a href="/gostd/runtime/malloc.go.html#1592983">v</a></span><span class="op" id="1593253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1593258">(</span><span class="op" id="1593259">*</span><span class="op" id="1593260">[</span><span class="num" id="1593261">2</span><span class="op" id="1593262">]</span><span class="builtintype" id="1593263">uint64</span><span class="op" id="1593269">)</span><span class="op" id="1593270">(</span><span class="ident" id="1593271"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span><span class="op" id="1593272">)</span><span class="op" id="1593273">[</span><span class="num" id="1593274">0</span><span class="op" id="1593275">]</span>&nbsp;<span class="op" id="1593277">=</span>&nbsp;<span class="num" id="1593279">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1593284">(</span><span class="op" id="1593285">*</span><span class="op" id="1593286">[</span><span class="num" id="1593287">2</span><span class="op" id="1593288">]</span><span class="builtintype" id="1593289">uint64</span><span class="op" id="1593295">)</span><span class="op" id="1593296">(</span><span class="ident" id="1593297"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span><span class="op" id="1593298">)</span><span class="op" id="1593299">[</span><span class="num" id="1593300">1</span><span class="op" id="1593301">]</span>&nbsp;<span class="op" id="1593303">=</span>&nbsp;<span class="num" id="1593305">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1593310">//&nbsp;See&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;replace&nbsp;the&nbsp;existing&nbsp;tiny&nbsp;block&nbsp;with&nbsp;the&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1593383">//&nbsp;based&nbsp;on&nbsp;amount&nbsp;of&nbsp;remaining&nbsp;free&nbsp;space.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1593430">if</span>&nbsp;<span class="ident" id="1593433"><a href="/gostd/runtime/malloc.go.html#1588908">maxTinySize</a></span><span class="op" id="1593444">-</span><span class="ident" id="1593445"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span>&nbsp;<span class="op" id="1593450">&gt;</span>&nbsp;<span class="ident" id="1593452"><a href="/gostd/runtime/malloc.go.html#1591915">tinysize</a></span>&nbsp;<span class="op" id="1593461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593467"><a href="/gostd/runtime/malloc.go.html#1590376">c</a></span><span class="op" id="1593468">.</span><span class="ident" id="1593469"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793388">tiny</a></span>&nbsp;<span class="op" id="1593474">=</span>&nbsp;<span class="op" id="1593476">(</span><span class="op" id="1593477">*</span><span class="builtintype" id="1593478">byte</span><span class="op" id="1593482">)</span><span class="op" id="1593483">(</span><span class="ident" id="1593484"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1593487">(</span><span class="ident" id="1593488"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span><span class="op" id="1593489">,</span>&nbsp;<span class="ident" id="1593491"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1593495">)</span><span class="op" id="1593496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593502"><a href="/gostd/runtime/malloc.go.html#1590376">c</a></span><span class="op" id="1593503">.</span><span class="ident" id="1593504"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793400">tinysize</a></span>&nbsp;<span class="op" id="1593513">=</span>&nbsp;<span class="builtintype" id="1593515">uintptr</span><span class="op" id="1593522">(</span><span class="ident" id="1593523"><a href="/gostd/runtime/malloc.go.html#1588908">maxTinySize</a></span>&nbsp;<span class="op" id="1593535">-</span>&nbsp;<span class="ident" id="1593537"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1593541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1593546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593551"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span>&nbsp;<span class="op" id="1593556">=</span>&nbsp;<span class="ident" id="1593558"><a href="/gostd/runtime/malloc.go.html#1588908">maxTinySize</a></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1593572">}</span>&nbsp;<span class="keyword" id="1593574">else</span>&nbsp;<span class="op" id="1593579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1593584">var</span>&nbsp;<span class="ident" id="1593588">sizeclass</span>&nbsp;<span class="builtintype" id="1593598">int8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1593606">if</span>&nbsp;<span class="ident" id="1593609"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span>&nbsp;<span class="op" id="1593614">&lt;=</span>&nbsp;<span class="num" id="1593617">1024</span><span class="op" id="1593621">-</span><span class="num" id="1593622">8</span>&nbsp;<span class="op" id="1593624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593630"><a href="/gostd/runtime/malloc.go.html#1593588">sizeclass</a></span>&nbsp;<span class="op" id="1593640">=</span>&nbsp;<span class="ident" id="1593642"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793153">size_to_class8</a></span><span class="op" id="1593656">[</span><span class="op" id="1593657">(</span><span class="ident" id="1593658"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1593662">+</span><span class="num" id="1593663">7</span><span class="op" id="1593664">)</span><span class="op" id="1593665">&gt;&gt;</span><span class="num" id="1593667">3</span><span class="op" id="1593668">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1593673">}</span>&nbsp;<span class="keyword" id="1593675">else</span>&nbsp;<span class="op" id="1593680">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593686"><a href="/gostd/runtime/malloc.go.html#1593588">sizeclass</a></span>&nbsp;<span class="op" id="1593696">=</span>&nbsp;<span class="ident" id="1593698"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793182">size_to_class128</a></span><span class="op" id="1593714">[</span><span class="op" id="1593715">(</span><span class="ident" id="1593716"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1593720">-</span><span class="num" id="1593721">1024</span><span class="op" id="1593725">+</span><span class="num" id="1593726">127</span><span class="op" id="1593729">)</span><span class="op" id="1593730">&gt;&gt;</span><span class="num" id="1593732">7</span><span class="op" id="1593733">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1593738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593743"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span>&nbsp;<span class="op" id="1593748">=</span>&nbsp;<span class="builtintype" id="1593750">uintptr</span><span class="op" id="1593757">(</span><span class="ident" id="1593758"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793090">class_to_size</a></span><span class="op" id="1593771">[</span><span class="ident" id="1593772"><a href="/gostd/runtime/malloc.go.html#1593588">sizeclass</a></span><span class="op" id="1593781">]</span><span class="op" id="1593782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593787"><a href="/gostd/runtime/malloc.go.html#1590397">s</a></span>&nbsp;<span class="op" id="1593789">=</span>&nbsp;<span class="ident" id="1593791"><a href="/gostd/runtime/malloc.go.html#1590376">c</a></span><span class="op" id="1593792">.</span><span class="ident" id="1593793"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793444">alloc</a></span><span class="op" id="1593798">[</span><span class="ident" id="1593799"><a href="/gostd/runtime/malloc.go.html#1593588">sizeclass</a></span><span class="op" id="1593808">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593813">v</span>&nbsp;<span class="op" id="1593815">:=</span>&nbsp;<span class="ident" id="1593818"><a href="/gostd/runtime/malloc.go.html#1590397">s</a></span><span class="op" id="1593819">.</span><span class="ident" id="1593820"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794122">freelist</a></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1593832">if</span>&nbsp;<span class="ident" id="1593835"><a href="/gostd/runtime/malloc.go.html#1593813">v</a></span>&nbsp;<span class="op" id="1593837">==</span>&nbsp;<span class="builtintype" id="1593840">nil</span>&nbsp;<span class="op" id="1593844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593850">mp</span>&nbsp;<span class="op" id="1593853">:=</span>&nbsp;<span class="ident" id="1593856"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1593864">(</span><span class="op" id="1593865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593871"><a href="/gostd/runtime/malloc.go.html#1593850">mp</a></span><span class="op" id="1593873">.</span><span class="ident" id="1593874"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788525">scalararg</a></span><span class="op" id="1593883">[</span><span class="num" id="1593884">0</span><span class="op" id="1593885">]</span>&nbsp;<span class="op" id="1593887">=</span>&nbsp;<span class="builtintype" id="1593889">uintptr</span><span class="op" id="1593896">(</span><span class="ident" id="1593897"><a href="/gostd/runtime/malloc.go.html#1593588">sizeclass</a></span><span class="op" id="1593906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593912"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1593915">(</span><span class="ident" id="1593916"><a href="/gostd/runtime/stubs.go.html#1742141">mcacheRefill_m</a></span><span class="op" id="1593930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593936"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1593944">(</span><span class="ident" id="1593945"><a href="/gostd/runtime/malloc.go.html#1593850">mp</a></span><span class="op" id="1593947">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593953"><a href="/gostd/runtime/malloc.go.html#1590397">s</a></span>&nbsp;<span class="op" id="1593955">=</span>&nbsp;<span class="ident" id="1593957"><a href="/gostd/runtime/malloc.go.html#1590376">c</a></span><span class="op" id="1593958">.</span><span class="ident" id="1593959"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793444">alloc</a></span><span class="op" id="1593964">[</span><span class="ident" id="1593965"><a href="/gostd/runtime/malloc.go.html#1593588">sizeclass</a></span><span class="op" id="1593974">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1593980"><a href="/gostd/runtime/malloc.go.html#1593813">v</a></span>&nbsp;<span class="op" id="1593982">=</span>&nbsp;<span class="ident" id="1593984"><a href="/gostd/runtime/malloc.go.html#1590397">s</a></span><span class="op" id="1593985">.</span><span class="ident" id="1593986"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794122">freelist</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1593998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1594003"><a href="/gostd/runtime/malloc.go.html#1590397">s</a></span><span class="op" id="1594004">.</span><span class="ident" id="1594005"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794122">freelist</a></span>&nbsp;<span class="op" id="1594014">=</span>&nbsp;<span class="ident" id="1594016"><a href="/gostd/runtime/malloc.go.html#1593813">v</a></span><span class="op" id="1594017">.</span><span class="ident" id="1594018"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792234">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1594026"><a href="/gostd/runtime/malloc.go.html#1590397">s</a></span><span class="op" id="1594027">.</span><span class="ident" id="1594028"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794156">ref</a></span><span class="op" id="1594031">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1594037">//TODO:&nbsp;prefetch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1594057"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span>&nbsp;<span class="op" id="1594059">=</span>&nbsp;<span class="ident" id="1594061"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1594067">.</span><span class="ident" id="1594068">Pointer</span><span class="op" id="1594075">(</span><span class="ident" id="1594076"><a href="/gostd/runtime/malloc.go.html#1593813">v</a></span><span class="op" id="1594077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1594082">if</span>&nbsp;<span class="ident" id="1594085"><a href="/gostd/runtime/malloc.go.html#1589662">flags</a></span><span class="op" id="1594090">&amp;</span><span class="ident" id="1594091"><a href="/gostd/runtime/malloc.go.html#1588881">flagNoZero</a></span>&nbsp;<span class="op" id="1594102">==</span>&nbsp;<span class="num" id="1594105">0</span>&nbsp;<span class="op" id="1594107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1594113"><a href="/gostd/runtime/malloc.go.html#1593813">v</a></span><span class="op" id="1594114">.</span><span class="ident" id="1594115"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792234">next</a></span>&nbsp;<span class="op" id="1594120">=</span>&nbsp;<span class="builtintype" id="1594122">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1594130">if</span>&nbsp;<span class="ident" id="1594133"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span>&nbsp;<span class="op" id="1594138">&gt;</span>&nbsp;<span class="num" id="1594140">2</span><span class="op" id="1594141">*</span><span class="ident" id="1594142"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span>&nbsp;<span class="op" id="1594150">&amp;&amp;</span>&nbsp;<span class="op" id="1594153">(</span><span class="op" id="1594154">(</span><span class="op" id="1594155">*</span><span class="op" id="1594156">[</span><span class="num" id="1594157">2</span><span class="op" id="1594158">]</span><span class="builtintype" id="1594159">uintptr</span><span class="op" id="1594166">)</span><span class="op" id="1594167">(</span><span class="ident" id="1594168"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span><span class="op" id="1594169">)</span><span class="op" id="1594170">)</span><span class="op" id="1594171">[</span><span class="num" id="1594172">1</span><span class="op" id="1594173">]</span>&nbsp;<span class="op" id="1594175">!=</span>&nbsp;<span class="num" id="1594178">0</span>&nbsp;<span class="op" id="1594180">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1594187"><a href="/gostd/runtime/stubs.go.html#1742585">memclr</a></span><span class="op" id="1594193">(</span><span class="ident" id="1594194"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1594200">.</span><span class="ident" id="1594201">Pointer</span><span class="op" id="1594208">(</span><span class="ident" id="1594209"><a href="/gostd/runtime/malloc.go.html#1593813">v</a></span><span class="op" id="1594210">)</span><span class="op" id="1594211">,</span>&nbsp;<span class="ident" id="1594213"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1594217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1594223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1594228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1594232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1594236"><a href="/gostd/runtime/malloc.go.html#1590376">c</a></span><span class="op" id="1594237">.</span><span class="ident" id="1594238"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793363">local_cachealloc</a></span>&nbsp;<span class="op" id="1594255">+=</span>&nbsp;<span class="ident" id="1594258"><a href="/gostd/runtime/arch_amd64.go.html#1480683">intptr</a></span><span class="op" id="1594264">(</span><span class="ident" id="1594265"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1594269">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1594272">}</span>&nbsp;<span class="keyword" id="1594274">else</span>&nbsp;<span class="op" id="1594279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1594283">mp</span>&nbsp;<span class="op" id="1594286">:=</span>&nbsp;<span class="ident" id="1594289"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1594297">(</span><span class="op" id="1594298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1594302"><a href="/gostd/runtime/malloc.go.html#1594283">mp</a></span><span class="op" id="1594304">.</span><span class="ident" id="1594305"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788525">scalararg</a></span><span class="op" id="1594314">[</span><span class="num" id="1594315">0</span><span class="op" id="1594316">]</span>&nbsp;<span class="op" id="1594318">=</span>&nbsp;<span class="builtintype" id="1594320">uintptr</span><span class="op" id="1594327">(</span><span class="ident" id="1594328"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1594332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1594336"><a href="/gostd/runtime/malloc.go.html#1594283">mp</a></span><span class="op" id="1594338">.</span><span class="ident" id="1594339"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788525">scalararg</a></span><span class="op" id="1594348">[</span><span class="num" id="1594349">1</span><span class="op" id="1594350">]</span>&nbsp;<span class="op" id="1594352">=</span>&nbsp;<span class="builtintype" id="1594354">uintptr</span><span class="op" id="1594361">(</span><span class="ident" id="1594362"><a href="/gostd/runtime/malloc.go.html#1589662">flags</a></span><span class="op" id="1594367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1594371"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1594374">(</span><span class="ident" id="1594375"><a href="/gostd/runtime/stubs.go.html#1742163">largeAlloc_m</a></span><span class="op" id="1594387">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1594391"><a href="/gostd/runtime/malloc.go.html#1590397">s</a></span>&nbsp;<span class="op" id="1594393">=</span>&nbsp;<span class="op" id="1594395">(</span><span class="op" id="1594396">*</span><span class="ident" id="1594397"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794050">mspan</a></span><span class="op" id="1594402">)</span><span class="op" id="1594403">(</span><span class="ident" id="1594404"><a href="/gostd/runtime/malloc.go.html#1594283">mp</a></span><span class="op" id="1594406">.</span><span class="ident" id="1594407"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788547">ptrarg</a></span><span class="op" id="1594413">[</span><span class="num" id="1594414">0</span><span class="op" id="1594415">]</span><span class="op" id="1594416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1594420"><a href="/gostd/runtime/malloc.go.html#1594283">mp</a></span><span class="op" id="1594422">.</span><span class="ident" id="1594423"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788547">ptrarg</a></span><span class="op" id="1594429">[</span><span class="num" id="1594430">0</span><span class="op" id="1594431">]</span>&nbsp;<span class="op" id="1594433">=</span>&nbsp;<span class="builtintype" id="1594435">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1594441"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1594449">(</span><span class="ident" id="1594450"><a href="/gostd/runtime/malloc.go.html#1594283">mp</a></span><span class="op" id="1594452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1594456"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span>&nbsp;<span class="op" id="1594458">=</span>&nbsp;<span class="ident" id="1594460"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1594466">.</span><span class="ident" id="1594467">Pointer</span><span class="op" id="1594474">(</span><span class="builtintype" id="1594475">uintptr</span><span class="op" id="1594482">(</span><span class="ident" id="1594483"><a href="/gostd/runtime/malloc.go.html#1590397">s</a></span><span class="op" id="1594484">.</span><span class="ident" id="1594485"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794092">start</a></span>&nbsp;<span class="op" id="1594491">&lt;&lt;</span>&nbsp;<span class="ident" id="1594494"><a href="/gostd/runtime/malloc.go.html#1588999">pageShift</a></span><span class="op" id="1594503">)</span><span class="op" id="1594504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1594508"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span>&nbsp;<span class="op" id="1594513">=</span>&nbsp;<span class="builtintype" id="1594515">uintptr</span><span class="op" id="1594522">(</span><span class="ident" id="1594523"><a href="/gostd/runtime/malloc.go.html#1590397">s</a></span><span class="op" id="1594524">.</span><span class="ident" id="1594525"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794228">elemsize</a></span><span class="op" id="1594533">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1594536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1594540">if</span>&nbsp;<span class="ident" id="1594543"><a href="/gostd/runtime/malloc.go.html#1589662">flags</a></span><span class="op" id="1594548">&amp;</span><span class="ident" id="1594549"><a href="/gostd/runtime/malloc.go.html#1588855">flagNoScan</a></span>&nbsp;<span class="op" id="1594560">!=</span>&nbsp;<span class="num" id="1594563">0</span>&nbsp;<span class="op" id="1594565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1594569">//&nbsp;All&nbsp;objects&nbsp;are&nbsp;pre-marked&nbsp;as&nbsp;noscan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1594612">goto</span>&nbsp;<span class="ident" id="1594617"><a href="/gostd/runtime/malloc.go.html#1597777">marked</a></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1594625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1594629">//&nbsp;If&nbsp;allocating&nbsp;a&nbsp;defer+arg&nbsp;block,&nbsp;now&nbsp;that&nbsp;we&#39;ve&nbsp;picked&nbsp;a&nbsp;malloc&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1594702">//&nbsp;large&nbsp;enough&nbsp;to&nbsp;hold&nbsp;everything,&nbsp;cut&nbsp;the&nbsp;&#34;asked&nbsp;for&#34;&nbsp;size&nbsp;down&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1594772">//&nbsp;just&nbsp;the&nbsp;defer&nbsp;header,&nbsp;so&nbsp;that&nbsp;the&nbsp;GC&nbsp;bitmap&nbsp;will&nbsp;record&nbsp;the&nbsp;arg&nbsp;block</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1594847">//&nbsp;as&nbsp;containing&nbsp;nothing&nbsp;at&nbsp;all&nbsp;(as&nbsp;if&nbsp;it&nbsp;were&nbsp;unused&nbsp;space&nbsp;at&nbsp;the&nbsp;end&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1594922">//&nbsp;a&nbsp;malloc&nbsp;block&nbsp;caused&nbsp;by&nbsp;size&nbsp;rounding).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1594967">//&nbsp;The&nbsp;defer&nbsp;arg&nbsp;areas&nbsp;are&nbsp;scanned&nbsp;as&nbsp;part&nbsp;of&nbsp;scanstack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1595025">if</span>&nbsp;<span class="ident" id="1595028"><a href="/gostd/runtime/malloc.go.html#1589650">typ</a></span>&nbsp;<span class="op" id="1595032">==</span>&nbsp;<span class="ident" id="1595035"><a href="/gostd/runtime/panic.go.html#1655334">deferType</a></span>&nbsp;<span class="op" id="1595045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1595049"><a href="/gostd/runtime/malloc.go.html#1589748">size0</a></span>&nbsp;<span class="op" id="1595055">=</span>&nbsp;<span class="ident" id="1595057"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1595063">.</span><span class="ident" id="1595064">Sizeof</span><span class="op" id="1595070">(</span><span class="ident" id="1595071"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1790701">_defer</a></span><span class="op" id="1595077">{</span><span class="op" id="1595078">}</span><span class="op" id="1595079">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1595082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1595086">//&nbsp;From&nbsp;here&nbsp;till&nbsp;marked&nbsp;label&nbsp;marking&nbsp;the&nbsp;object&nbsp;as&nbsp;allocated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1595150">//&nbsp;and&nbsp;storing&nbsp;type&nbsp;info&nbsp;in&nbsp;the&nbsp;GC&nbsp;bitmap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1595194">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1595198">arena_start</span>&nbsp;<span class="op" id="1595210">:=</span>&nbsp;<span class="builtintype" id="1595213">uintptr</span><span class="op" id="1595220">(</span><span class="ident" id="1595221"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1595227">.</span><span class="ident" id="1595228">Pointer</span><span class="op" id="1595235">(</span><span class="ident" id="1595236"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795050">mheap_</a></span><span class="op" id="1595242">.</span><span class="ident" id="1595243"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794761">arena_start</a></span><span class="op" id="1595254">)</span><span class="op" id="1595255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1595259">off</span>&nbsp;<span class="op" id="1595263">:=</span>&nbsp;<span class="op" id="1595266">(</span><span class="builtintype" id="1595267">uintptr</span><span class="op" id="1595274">(</span><span class="ident" id="1595275"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span><span class="op" id="1595276">)</span>&nbsp;<span class="op" id="1595278">-</span>&nbsp;<span class="ident" id="1595280"><a href="/gostd/runtime/malloc.go.html#1595198">arena_start</a></span><span class="op" id="1595291">)</span>&nbsp;<span class="op" id="1595293">/</span>&nbsp;<span class="ident" id="1595295"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1595305">xbits</span>&nbsp;<span class="op" id="1595311">:=</span>&nbsp;<span class="op" id="1595314">(</span><span class="op" id="1595315">*</span><span class="builtintype" id="1595316">uint8</span><span class="op" id="1595321">)</span><span class="op" id="1595322">(</span><span class="ident" id="1595323"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1595329">.</span><span class="ident" id="1595330">Pointer</span><span class="op" id="1595337">(</span><span class="ident" id="1595338"><a href="/gostd/runtime/malloc.go.html#1595198">arena_start</a></span>&nbsp;<span class="op" id="1595350">-</span>&nbsp;<span class="ident" id="1595352"><a href="/gostd/runtime/malloc.go.html#1595259">off</a></span><span class="op" id="1595355">/</span><span class="ident" id="1595356"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802082">wordsPerBitmapByte</a></span>&nbsp;<span class="op" id="1595375">-</span>&nbsp;<span class="num" id="1595377">1</span><span class="op" id="1595378">)</span><span class="op" id="1595379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1595383">shift</span>&nbsp;<span class="op" id="1595389">:=</span>&nbsp;<span class="op" id="1595392">(</span><span class="ident" id="1595393"><a href="/gostd/runtime/malloc.go.html#1595259">off</a></span>&nbsp;<span class="op" id="1595397">%</span>&nbsp;<span class="ident" id="1595399"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802082">wordsPerBitmapByte</a></span><span class="op" id="1595417">)</span>&nbsp;<span class="op" id="1595419">*</span>&nbsp;<span class="ident" id="1595421"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802065">gcBits</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1595430">if</span>&nbsp;<span class="ident" id="1595433"><a href="/gostd/runtime/malloc.go.html#1588833">debugMalloc</a></span>&nbsp;<span class="op" id="1595445">&amp;&amp;</span>&nbsp;<span class="op" id="1595448">(</span><span class="op" id="1595449">(</span><span class="op" id="1595450">*</span><span class="ident" id="1595451"><a href="/gostd/runtime/malloc.go.html#1595305">xbits</a></span><span class="op" id="1595456">&gt;&gt;</span><span class="ident" id="1595458"><a href="/gostd/runtime/malloc.go.html#1595383">shift</a></span><span class="op" id="1595463">)</span><span class="op" id="1595464">&amp;</span><span class="op" id="1595465">(</span><span class="ident" id="1595466"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802456">bitMask</a></span><span class="op" id="1595473">|</span><span class="ident" id="1595474"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802474">bitPtrMask</a></span><span class="op" id="1595484">)</span><span class="op" id="1595485">)</span>&nbsp;<span class="op" id="1595487">!=</span>&nbsp;<span class="ident" id="1595490"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802414">bitBoundary</a></span>&nbsp;<span class="op" id="1595502">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1595507">println</span><span class="op" id="1595514">(</span><span class="string" id="1595515">&#34;runtime:&nbsp;bits&nbsp;=&#34;</span><span class="op" id="1595532">,</span>&nbsp;<span class="op" id="1595534">(</span><span class="op" id="1595535">*</span><span class="ident" id="1595536"><a href="/gostd/runtime/malloc.go.html#1595305">xbits</a></span><span class="op" id="1595541">&gt;&gt;</span><span class="ident" id="1595543"><a href="/gostd/runtime/malloc.go.html#1595383">shift</a></span><span class="op" id="1595548">)</span><span class="op" id="1595549">&amp;</span><span class="op" id="1595550">(</span><span class="ident" id="1595551"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802456">bitMask</a></span><span class="op" id="1595558">|</span><span class="ident" id="1595559"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802474">bitPtrMask</a></span><span class="op" id="1595569">)</span><span class="op" id="1595570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1595575"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1595582">(</span><span class="string" id="1595583">&#34;bad&nbsp;bits&nbsp;in&nbsp;markallocated&#34;</span><span class="op" id="1595610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1595614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1595619">var</span>&nbsp;<span class="ident" id="1595623">ti</span><span class="op" id="1595625">,</span>&nbsp;<span class="ident" id="1595627">te</span>&nbsp;<span class="builtintype" id="1595630">uintptr</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1595640">var</span>&nbsp;<span class="ident" id="1595644">ptrmask</span>&nbsp;<span class="op" id="1595652">*</span><span class="builtintype" id="1595653">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1595661">if</span>&nbsp;<span class="ident" id="1595664"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span>&nbsp;<span class="op" id="1595669">==</span>&nbsp;<span class="ident" id="1595672"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span>&nbsp;<span class="op" id="1595680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1595685">//&nbsp;It&#39;s&nbsp;one&nbsp;word&nbsp;and&nbsp;it&nbsp;has&nbsp;pointers,&nbsp;it&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1595748">*</span><span class="ident" id="1595749"><a href="/gostd/runtime/malloc.go.html#1595305">xbits</a></span>&nbsp;<span class="op" id="1595755">|=</span>&nbsp;<span class="op" id="1595758">(</span><span class="ident" id="1595759"><a href="/gostd/runtime/malloc.go.html#1589229">bitsPointer</a></span>&nbsp;<span class="op" id="1595771">&lt;&lt;</span>&nbsp;<span class="num" id="1595774">2</span><span class="op" id="1595775">)</span>&nbsp;<span class="op" id="1595777">&lt;&lt;</span>&nbsp;<span class="ident" id="1595780"><a href="/gostd/runtime/malloc.go.html#1595383">shift</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1595789">goto</span>&nbsp;<span class="ident" id="1595794"><a href="/gostd/runtime/malloc.go.html#1597777">marked</a></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1595803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1595807">if</span>&nbsp;<span class="ident" id="1595810"><a href="/gostd/runtime/malloc.go.html#1589650">typ</a></span><span class="op" id="1595813">.</span><span class="ident" id="1595814"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795694">kind</a></span><span class="op" id="1595818">&amp;</span><span class="ident" id="1595819"><a href="/gostd/runtime/typekind.go.html#1785216">kindGCProg</a></span>&nbsp;<span class="op" id="1595830">!=</span>&nbsp;<span class="num" id="1595833">0</span>&nbsp;<span class="op" id="1595835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1595840">nptr</span>&nbsp;<span class="op" id="1595845">:=</span>&nbsp;<span class="op" id="1595848">(</span><span class="builtintype" id="1595849">uintptr</span><span class="op" id="1595856">(</span><span class="ident" id="1595857"><a href="/gostd/runtime/malloc.go.html#1589650">typ</a></span><span class="op" id="1595860">.</span><span class="ident" id="1595861"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795621">size</a></span><span class="op" id="1595865">)</span>&nbsp;<span class="op" id="1595867">+</span>&nbsp;<span class="ident" id="1595869"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span>&nbsp;<span class="op" id="1595877">-</span>&nbsp;<span class="num" id="1595879">1</span><span class="op" id="1595880">)</span>&nbsp;<span class="op" id="1595882">/</span>&nbsp;<span class="ident" id="1595884"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1595895">masksize</span>&nbsp;<span class="op" id="1595904">:=</span>&nbsp;<span class="ident" id="1595907"><a href="/gostd/runtime/malloc.go.html#1595840">nptr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1595915">if</span>&nbsp;<span class="ident" id="1595918"><a href="/gostd/runtime/malloc.go.html#1595895">masksize</a></span><span class="op" id="1595926">%</span><span class="num" id="1595927">2</span>&nbsp;<span class="op" id="1595929">!=</span>&nbsp;<span class="num" id="1595932">0</span>&nbsp;<span class="op" id="1595934">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1595940"><a href="/gostd/runtime/malloc.go.html#1595895">masksize</a></span>&nbsp;<span class="op" id="1595949">*=</span>&nbsp;<span class="num" id="1595952">2</span>&nbsp;<span class="comment" id="1595954">//&nbsp;repeated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1595969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1595974"><a href="/gostd/runtime/malloc.go.html#1595895">masksize</a></span>&nbsp;<span class="op" id="1595983">=</span>&nbsp;<span class="ident" id="1595985"><a href="/gostd/runtime/malloc.go.html#1595895">masksize</a></span>&nbsp;<span class="op" id="1595994">*</span>&nbsp;<span class="ident" id="1595996"><a href="/gostd/runtime/malloc.go.html#1589134">pointersPerByte</a></span>&nbsp;<span class="op" id="1596012">/</span>&nbsp;<span class="num" id="1596014">8</span>&nbsp;<span class="comment" id="1596016">//&nbsp;4&nbsp;bits&nbsp;per&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596038"><a href="/gostd/runtime/malloc.go.html#1595895">masksize</a></span><span class="op" id="1596046">++</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1596080">//&nbsp;unroll&nbsp;flag&nbsp;in&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1596115">if</span>&nbsp;<span class="ident" id="1596118"><a href="/gostd/runtime/malloc.go.html#1595895">masksize</a></span>&nbsp;<span class="op" id="1596127">&gt;</span>&nbsp;<span class="ident" id="1596129"><a href="/gostd/runtime/malloc.go.html#1589170">maxGCMask</a></span>&nbsp;<span class="op" id="1596139">&amp;&amp;</span>&nbsp;<span class="ident" id="1596142"><a href="/gostd/runtime/malloc.go.html#1589650">typ</a></span><span class="op" id="1596145">.</span><span class="ident" id="1596146"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795726">gc</a></span><span class="op" id="1596148">[</span><span class="num" id="1596149">1</span><span class="op" id="1596150">]</span>&nbsp;<span class="op" id="1596152">!=</span>&nbsp;<span class="num" id="1596155">0</span>&nbsp;<span class="op" id="1596157">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1596163">//&nbsp;If&nbsp;the&nbsp;mask&nbsp;is&nbsp;too&nbsp;large,&nbsp;unroll&nbsp;the&nbsp;program&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1596224">//&nbsp;into&nbsp;the&nbsp;GC&nbsp;bitmap.&nbsp;It&#39;s&nbsp;7&nbsp;times&nbsp;slower&nbsp;than&nbsp;copying</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1596284">//&nbsp;from&nbsp;the&nbsp;pre-unrolled&nbsp;mask,&nbsp;but&nbsp;saves&nbsp;1/16&nbsp;of&nbsp;type&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1596347">//&nbsp;memory&nbsp;for&nbsp;the&nbsp;mask.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596375">mp</span>&nbsp;<span class="op" id="1596378">:=</span>&nbsp;<span class="ident" id="1596381"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1596389">(</span><span class="op" id="1596390">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596396"><a href="/gostd/runtime/malloc.go.html#1596375">mp</a></span><span class="op" id="1596398">.</span><span class="ident" id="1596399"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788547">ptrarg</a></span><span class="op" id="1596405">[</span><span class="num" id="1596406">0</span><span class="op" id="1596407">]</span>&nbsp;<span class="op" id="1596409">=</span>&nbsp;<span class="ident" id="1596411"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596417"><a href="/gostd/runtime/malloc.go.html#1596375">mp</a></span><span class="op" id="1596419">.</span><span class="ident" id="1596420"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788547">ptrarg</a></span><span class="op" id="1596426">[</span><span class="num" id="1596427">1</span><span class="op" id="1596428">]</span>&nbsp;<span class="op" id="1596430">=</span>&nbsp;<span class="ident" id="1596432"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1596438">.</span><span class="ident" id="1596439">Pointer</span><span class="op" id="1596446">(</span><span class="ident" id="1596447"><a href="/gostd/runtime/malloc.go.html#1589650">typ</a></span><span class="op" id="1596450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596456"><a href="/gostd/runtime/malloc.go.html#1596375">mp</a></span><span class="op" id="1596458">.</span><span class="ident" id="1596459"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788525">scalararg</a></span><span class="op" id="1596468">[</span><span class="num" id="1596469">0</span><span class="op" id="1596470">]</span>&nbsp;<span class="op" id="1596472">=</span>&nbsp;<span class="builtintype" id="1596474">uintptr</span><span class="op" id="1596481">(</span><span class="ident" id="1596482"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1596486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596492"><a href="/gostd/runtime/malloc.go.html#1596375">mp</a></span><span class="op" id="1596494">.</span><span class="ident" id="1596495"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788525">scalararg</a></span><span class="op" id="1596504">[</span><span class="num" id="1596505">1</span><span class="op" id="1596506">]</span>&nbsp;<span class="op" id="1596508">=</span>&nbsp;<span class="builtintype" id="1596510">uintptr</span><span class="op" id="1596517">(</span><span class="ident" id="1596518"><a href="/gostd/runtime/malloc.go.html#1589748">size0</a></span><span class="op" id="1596523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596529"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1596532">(</span><span class="ident" id="1596533"><a href="/gostd/runtime/stubs.go.html#1742305">unrollgcproginplace_m</a></span><span class="op" id="1596554">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596560"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1596568">(</span><span class="ident" id="1596569"><a href="/gostd/runtime/malloc.go.html#1596375">mp</a></span><span class="op" id="1596571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1596577">goto</span>&nbsp;<span class="ident" id="1596582"><a href="/gostd/runtime/malloc.go.html#1597777">marked</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1596592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596597"><a href="/gostd/runtime/malloc.go.html#1595644">ptrmask</a></span>&nbsp;<span class="op" id="1596605">=</span>&nbsp;<span class="op" id="1596607">(</span><span class="op" id="1596608">*</span><span class="builtintype" id="1596609">uint8</span><span class="op" id="1596614">)</span><span class="op" id="1596615">(</span><span class="ident" id="1596616"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1596622">.</span><span class="ident" id="1596623">Pointer</span><span class="op" id="1596630">(</span><span class="builtintype" id="1596631">uintptr</span><span class="op" id="1596638">(</span><span class="ident" id="1596639"><a href="/gostd/runtime/malloc.go.html#1589650">typ</a></span><span class="op" id="1596642">.</span><span class="ident" id="1596643"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795726">gc</a></span><span class="op" id="1596645">[</span><span class="num" id="1596646">0</span><span class="op" id="1596647">]</span><span class="op" id="1596648">)</span><span class="op" id="1596649">)</span><span class="op" id="1596650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1596655">//&nbsp;Check&nbsp;whether&nbsp;the&nbsp;program&nbsp;is&nbsp;already&nbsp;unrolled.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1596708">if</span>&nbsp;<span class="builtintype" id="1596711">uintptr</span><span class="op" id="1596718">(</span><span class="ident" id="1596719"><a href="/gostd/runtime/atomic.go.html#1481434">atomicloadp</a></span><span class="op" id="1596730">(</span><span class="ident" id="1596731"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1596737">.</span><span class="ident" id="1596738">Pointer</span><span class="op" id="1596745">(</span><span class="ident" id="1596746"><a href="/gostd/runtime/malloc.go.html#1595644">ptrmask</a></span><span class="op" id="1596753">)</span><span class="op" id="1596754">)</span><span class="op" id="1596755">)</span><span class="op" id="1596756">&amp;</span><span class="num" id="1596757">0xff</span>&nbsp;<span class="op" id="1596762">==</span>&nbsp;<span class="num" id="1596765">0</span>&nbsp;<span class="op" id="1596767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596773">mp</span>&nbsp;<span class="op" id="1596776">:=</span>&nbsp;<span class="ident" id="1596779"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1596787">(</span><span class="op" id="1596788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596794"><a href="/gostd/runtime/malloc.go.html#1596773">mp</a></span><span class="op" id="1596796">.</span><span class="ident" id="1596797"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788547">ptrarg</a></span><span class="op" id="1596803">[</span><span class="num" id="1596804">0</span><span class="op" id="1596805">]</span>&nbsp;<span class="op" id="1596807">=</span>&nbsp;<span class="ident" id="1596809"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1596815">.</span><span class="ident" id="1596816">Pointer</span><span class="op" id="1596823">(</span><span class="ident" id="1596824"><a href="/gostd/runtime/malloc.go.html#1589650">typ</a></span><span class="op" id="1596827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596833"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1596836">(</span><span class="ident" id="1596837"><a href="/gostd/runtime/stubs.go.html#1742283">unrollgcprog_m</a></span><span class="op" id="1596851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596857"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1596865">(</span><span class="ident" id="1596866"><a href="/gostd/runtime/malloc.go.html#1596773">mp</a></span><span class="op" id="1596868">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1596873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596878"><a href="/gostd/runtime/malloc.go.html#1595644">ptrmask</a></span>&nbsp;<span class="op" id="1596886">=</span>&nbsp;<span class="op" id="1596888">(</span><span class="op" id="1596889">*</span><span class="builtintype" id="1596890">uint8</span><span class="op" id="1596895">)</span><span class="op" id="1596896">(</span><span class="ident" id="1596897"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1596900">(</span><span class="ident" id="1596901"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1596907">.</span><span class="ident" id="1596908">Pointer</span><span class="op" id="1596915">(</span><span class="ident" id="1596916"><a href="/gostd/runtime/malloc.go.html#1595644">ptrmask</a></span><span class="op" id="1596923">)</span><span class="op" id="1596924">,</span>&nbsp;<span class="num" id="1596926">1</span><span class="op" id="1596927">)</span><span class="op" id="1596928">)</span>&nbsp;<span class="comment" id="1596930">//&nbsp;skip&nbsp;the&nbsp;unroll&nbsp;flag&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1596961">}</span>&nbsp;<span class="keyword" id="1596963">else</span>&nbsp;<span class="op" id="1596968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1596973"><a href="/gostd/runtime/malloc.go.html#1595644">ptrmask</a></span>&nbsp;<span class="op" id="1596981">=</span>&nbsp;<span class="op" id="1596983">(</span><span class="op" id="1596984">*</span><span class="builtintype" id="1596985">uint8</span><span class="op" id="1596990">)</span><span class="op" id="1596991">(</span><span class="ident" id="1596992"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1596998">.</span><span class="ident" id="1596999">Pointer</span><span class="op" id="1597006">(</span><span class="ident" id="1597007"><a href="/gostd/runtime/malloc.go.html#1589650">typ</a></span><span class="op" id="1597010">.</span><span class="ident" id="1597011"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795726">gc</a></span><span class="op" id="1597013">[</span><span class="num" id="1597014">0</span><span class="op" id="1597015">]</span><span class="op" id="1597016">)</span><span class="op" id="1597017">)</span>&nbsp;<span class="comment" id="1597019">//&nbsp;pointer&nbsp;to&nbsp;unrolled&nbsp;mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597049">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597053">if</span>&nbsp;<span class="ident" id="1597056"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span>&nbsp;<span class="op" id="1597061">==</span>&nbsp;<span class="num" id="1597064">2</span><span class="op" id="1597065">*</span><span class="ident" id="1597066"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span>&nbsp;<span class="op" id="1597074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597079">*</span><span class="ident" id="1597080"><a href="/gostd/runtime/malloc.go.html#1595305">xbits</a></span>&nbsp;<span class="op" id="1597086">=</span>&nbsp;<span class="op" id="1597088">*</span><span class="ident" id="1597089"><a href="/gostd/runtime/malloc.go.html#1595644">ptrmask</a></span>&nbsp;<span class="op" id="1597097">|</span>&nbsp;<span class="ident" id="1597099"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802414">bitBoundary</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597114">goto</span>&nbsp;<span class="ident" id="1597119"><a href="/gostd/runtime/malloc.go.html#1597777">marked</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597132"><a href="/gostd/runtime/malloc.go.html#1595627">te</a></span>&nbsp;<span class="op" id="1597135">=</span>&nbsp;<span class="builtintype" id="1597137">uintptr</span><span class="op" id="1597144">(</span><span class="ident" id="1597145"><a href="/gostd/runtime/malloc.go.html#1589650">typ</a></span><span class="op" id="1597148">.</span><span class="ident" id="1597149"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795621">size</a></span><span class="op" id="1597153">)</span>&nbsp;<span class="op" id="1597155">/</span>&nbsp;<span class="ident" id="1597157"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1597167">//&nbsp;If&nbsp;the&nbsp;type&nbsp;occupies&nbsp;odd&nbsp;number&nbsp;of&nbsp;words,&nbsp;its&nbsp;mask&nbsp;is&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597236">if</span>&nbsp;<span class="ident" id="1597239"><a href="/gostd/runtime/malloc.go.html#1595627">te</a></span><span class="op" id="1597241">%</span><span class="num" id="1597242">2</span>&nbsp;<span class="op" id="1597244">==</span>&nbsp;<span class="num" id="1597247">0</span>&nbsp;<span class="op" id="1597249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597254"><a href="/gostd/runtime/malloc.go.html#1595627">te</a></span>&nbsp;<span class="op" id="1597257">/=</span>&nbsp;<span class="num" id="1597260">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1597268">//&nbsp;Copy&nbsp;pointer&nbsp;bitmask&nbsp;into&nbsp;the&nbsp;bitmap.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597311">for</span>&nbsp;<span class="ident" id="1597315">i</span>&nbsp;<span class="op" id="1597317">:=</span>&nbsp;<span class="builtintype" id="1597320">uintptr</span><span class="op" id="1597327">(</span><span class="num" id="1597328">0</span><span class="op" id="1597329">)</span><span class="op" id="1597330">;</span>&nbsp;<span class="ident" id="1597332"><a href="/gostd/runtime/malloc.go.html#1597315">i</a></span>&nbsp;<span class="op" id="1597334">&lt;</span>&nbsp;<span class="ident" id="1597336"><a href="/gostd/runtime/malloc.go.html#1589748">size0</a></span><span class="op" id="1597341">;</span>&nbsp;<span class="ident" id="1597343"><a href="/gostd/runtime/malloc.go.html#1597315">i</a></span>&nbsp;<span class="op" id="1597345">+=</span>&nbsp;<span class="num" id="1597348">2</span>&nbsp;<span class="op" id="1597350">*</span>&nbsp;<span class="ident" id="1597352"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span>&nbsp;<span class="op" id="1597360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597365">v</span>&nbsp;<span class="op" id="1597367">:=</span>&nbsp;<span class="op" id="1597370">*</span><span class="op" id="1597371">(</span><span class="op" id="1597372">*</span><span class="builtintype" id="1597373">uint8</span><span class="op" id="1597378">)</span><span class="op" id="1597379">(</span><span class="ident" id="1597380"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1597383">(</span><span class="ident" id="1597384"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1597390">.</span><span class="ident" id="1597391">Pointer</span><span class="op" id="1597398">(</span><span class="ident" id="1597399"><a href="/gostd/runtime/malloc.go.html#1595644">ptrmask</a></span><span class="op" id="1597406">)</span><span class="op" id="1597407">,</span>&nbsp;<span class="ident" id="1597409"><a href="/gostd/runtime/malloc.go.html#1595623">ti</a></span><span class="op" id="1597411">)</span><span class="op" id="1597412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597417"><a href="/gostd/runtime/malloc.go.html#1595623">ti</a></span><span class="op" id="1597419">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597425">if</span>&nbsp;<span class="ident" id="1597428"><a href="/gostd/runtime/malloc.go.html#1595623">ti</a></span>&nbsp;<span class="op" id="1597431">==</span>&nbsp;<span class="ident" id="1597434"><a href="/gostd/runtime/malloc.go.html#1595627">te</a></span>&nbsp;<span class="op" id="1597437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597443"><a href="/gostd/runtime/malloc.go.html#1595623">ti</a></span>&nbsp;<span class="op" id="1597446">=</span>&nbsp;<span class="num" id="1597448">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597458">if</span>&nbsp;<span class="ident" id="1597461"><a href="/gostd/runtime/malloc.go.html#1597315">i</a></span>&nbsp;<span class="op" id="1597463">==</span>&nbsp;<span class="num" id="1597466">0</span>&nbsp;<span class="op" id="1597468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597474"><a href="/gostd/runtime/malloc.go.html#1597365">v</a></span>&nbsp;<span class="op" id="1597476">|=</span>&nbsp;<span class="ident" id="1597479"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802414">bitBoundary</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597499">if</span>&nbsp;<span class="ident" id="1597502"><a href="/gostd/runtime/malloc.go.html#1597315">i</a></span><span class="op" id="1597503">+</span><span class="ident" id="1597504"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span>&nbsp;<span class="op" id="1597512">==</span>&nbsp;<span class="ident" id="1597515"><a href="/gostd/runtime/malloc.go.html#1589748">size0</a></span>&nbsp;<span class="op" id="1597521">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597527"><a href="/gostd/runtime/malloc.go.html#1597365">v</a></span>&nbsp;<span class="op" id="1597529">&amp;^=</span>&nbsp;<span class="builtintype" id="1597533">uint8</span><span class="op" id="1597538">(</span><span class="ident" id="1597539"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802474">bitPtrMask</a></span>&nbsp;<span class="op" id="1597550">&lt;&lt;</span>&nbsp;<span class="num" id="1597553">4</span><span class="op" id="1597554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597565">*</span><span class="ident" id="1597566"><a href="/gostd/runtime/malloc.go.html#1595305">xbits</a></span>&nbsp;<span class="op" id="1597572">=</span>&nbsp;<span class="ident" id="1597574"><a href="/gostd/runtime/malloc.go.html#1597365">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597579"><a href="/gostd/runtime/malloc.go.html#1595305">xbits</a></span>&nbsp;<span class="op" id="1597585">=</span>&nbsp;<span class="op" id="1597587">(</span><span class="op" id="1597588">*</span><span class="builtintype" id="1597589">byte</span><span class="op" id="1597593">)</span><span class="op" id="1597594">(</span><span class="ident" id="1597595"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1597598">(</span><span class="ident" id="1597599"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1597605">.</span><span class="ident" id="1597606">Pointer</span><span class="op" id="1597613">(</span><span class="ident" id="1597614"><a href="/gostd/runtime/malloc.go.html#1595305">xbits</a></span><span class="op" id="1597619">)</span><span class="op" id="1597620">,</span>&nbsp;<span class="op" id="1597622">^</span><span class="builtintype" id="1597623">uintptr</span><span class="op" id="1597630">(</span><span class="num" id="1597631">0</span><span class="op" id="1597632">)</span><span class="op" id="1597633">)</span><span class="op" id="1597634">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597642">if</span>&nbsp;<span class="ident" id="1597645"><a href="/gostd/runtime/malloc.go.html#1589748">size0</a></span><span class="op" id="1597650">%</span><span class="op" id="1597651">(</span><span class="num" id="1597652">2</span><span class="op" id="1597653">*</span><span class="ident" id="1597654"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span><span class="op" id="1597661">)</span>&nbsp;<span class="op" id="1597663">==</span>&nbsp;<span class="num" id="1597666">0</span>&nbsp;<span class="op" id="1597668">&amp;&amp;</span>&nbsp;<span class="ident" id="1597671"><a href="/gostd/runtime/malloc.go.html#1589748">size0</a></span>&nbsp;<span class="op" id="1597677">&lt;</span>&nbsp;<span class="ident" id="1597679"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span>&nbsp;<span class="op" id="1597684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1597689">//&nbsp;Mark&nbsp;the&nbsp;word&nbsp;after&nbsp;last&nbsp;object&#39;s&nbsp;word&nbsp;as&nbsp;bitsDead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597747">*</span><span class="ident" id="1597748"><a href="/gostd/runtime/malloc.go.html#1595305">xbits</a></span>&nbsp;<span class="op" id="1597754">=</span>&nbsp;<span class="ident" id="1597756"><a href="/gostd/runtime/malloc.go.html#1589200">bitsDead</a></span>&nbsp;<span class="op" id="1597765">&lt;&lt;</span>&nbsp;<span class="num" id="1597768">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597772">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597775">}</span><br>
<span class="lineno"></span><span class="ident" id="1597777">marked</span><span class="op" id="1597783">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597786">if</span>&nbsp;<span class="ident" id="1597789"><a href="/gostd/runtime/race0.go.html#1676514">raceenabled</a></span>&nbsp;<span class="op" id="1597801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597805"><a href="/gostd/runtime/race0.go.html#1678152">racemalloc</a></span><span class="op" id="1597815">(</span><span class="ident" id="1597816"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span><span class="op" id="1597817">,</span>&nbsp;<span class="ident" id="1597819"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1597823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597826">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597830">if</span>&nbsp;<span class="ident" id="1597833"><a href="/gostd/runtime/malloc.go.html#1588833">debugMalloc</a></span>&nbsp;<span class="op" id="1597845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597849">mp</span>&nbsp;<span class="op" id="1597852">:=</span>&nbsp;<span class="ident" id="1597855"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1597863">(</span><span class="op" id="1597864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597868">if</span>&nbsp;<span class="ident" id="1597871"><a href="/gostd/runtime/malloc.go.html#1597849">mp</a></span><span class="op" id="1597873">.</span><span class="ident" id="1597874"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787961">mallocing</a></span>&nbsp;<span class="op" id="1597884">==</span>&nbsp;<span class="num" id="1597887">0</span>&nbsp;<span class="op" id="1597889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597894"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1597901">(</span><span class="string" id="1597902">&#34;bad&nbsp;malloc&#34;</span><span class="op" id="1597914">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1597918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597922"><a href="/gostd/runtime/malloc.go.html#1597849">mp</a></span><span class="op" id="1597924">.</span><span class="ident" id="1597925"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787961">mallocing</a></span>&nbsp;<span class="op" id="1597935">=</span>&nbsp;<span class="num" id="1597937">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1597941">if</span>&nbsp;<span class="ident" id="1597944"><a href="/gostd/runtime/malloc.go.html#1597849">mp</a></span><span class="op" id="1597946">.</span><span class="ident" id="1597947"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span>&nbsp;<span class="op" id="1597952">!=</span>&nbsp;<span class="builtintype" id="1597955">nil</span>&nbsp;<span class="op" id="1597959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1597964"><a href="/gostd/runtime/malloc.go.html#1597849">mp</a></span><span class="op" id="1597966">.</span><span class="ident" id="1597967"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span><span class="op" id="1597971">.</span><span class="ident" id="1597972"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787296">stackguard0</a></span>&nbsp;<span class="op" id="1597984">=</span>&nbsp;<span class="ident" id="1597986"><a href="/gostd/runtime/malloc.go.html#1597849">mp</a></span><span class="op" id="1597988">.</span><span class="ident" id="1597989"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787912">curg</a></span><span class="op" id="1597993">.</span><span class="ident" id="1597994"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787283">stack</a></span><span class="op" id="1597999">.</span><span class="ident" id="1598000"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787240">lo</a></span>&nbsp;<span class="op" id="1598003">+</span>&nbsp;<span class="ident" id="1598005"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1801790">_StackGuard</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1598019">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1598023">//&nbsp;Note:&nbsp;one&nbsp;releasem&nbsp;for&nbsp;the&nbsp;acquirem&nbsp;just&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1598076">//&nbsp;The&nbsp;other&nbsp;for&nbsp;the&nbsp;acquirem&nbsp;at&nbsp;start&nbsp;of&nbsp;malloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1598128"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1598136">(</span><span class="ident" id="1598137"><a href="/gostd/runtime/malloc.go.html#1597849">mp</a></span><span class="op" id="1598139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1598143"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1598151">(</span><span class="ident" id="1598152"><a href="/gostd/runtime/malloc.go.html#1597849">mp</a></span><span class="op" id="1598154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1598157">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1598161">if</span>&nbsp;<span class="ident" id="1598164"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791471">debug</a></span><span class="op" id="1598169">.</span><span class="ident" id="1598170"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1790269">allocfreetrace</a></span>&nbsp;<span class="op" id="1598185">!=</span>&nbsp;<span class="num" id="1598188">0</span>&nbsp;<span class="op" id="1598190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1598194"><a href="/gostd/runtime/mprof.go.html#1635683">tracealloc</a></span><span class="op" id="1598204">(</span><span class="ident" id="1598205"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span><span class="op" id="1598206">,</span>&nbsp;<span class="ident" id="1598208"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1598212">,</span>&nbsp;<span class="ident" id="1598214"><a href="/gostd/runtime/malloc.go.html#1589650">typ</a></span><span class="op" id="1598217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1598220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1598224">if</span>&nbsp;<span class="ident" id="1598227">rate</span>&nbsp;<span class="op" id="1598232">:=</span>&nbsp;<span class="ident" id="1598235"><a href="/gostd/runtime/mprof.go.html#1628650">MemProfileRate</a></span><span class="op" id="1598249">;</span>&nbsp;<span class="ident" id="1598251"><a href="/gostd/runtime/malloc.go.html#1598227">rate</a></span>&nbsp;<span class="op" id="1598256">&gt;</span>&nbsp;<span class="num" id="1598258">0</span>&nbsp;<span class="op" id="1598260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1598264">if</span>&nbsp;<span class="ident" id="1598267"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span>&nbsp;<span class="op" id="1598272">&lt;</span>&nbsp;<span class="builtintype" id="1598274">uintptr</span><span class="op" id="1598281">(</span><span class="ident" id="1598282"><a href="/gostd/runtime/malloc.go.html#1598227">rate</a></span><span class="op" id="1598286">)</span>&nbsp;<span class="op" id="1598288">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1598291">int32</span><span class="op" id="1598296">(</span><span class="ident" id="1598297"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1598301">)</span>&nbsp;<span class="op" id="1598303">&lt;</span>&nbsp;<span class="ident" id="1598305"><a href="/gostd/runtime/malloc.go.html#1590376">c</a></span><span class="op" id="1598306">.</span><span class="ident" id="1598307"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793344">next_sample</a></span>&nbsp;<span class="op" id="1598319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1598324"><a href="/gostd/runtime/malloc.go.html#1590376">c</a></span><span class="op" id="1598325">.</span><span class="ident" id="1598326"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793344">next_sample</a></span>&nbsp;<span class="op" id="1598338">-=</span>&nbsp;<span class="builtintype" id="1598341">int32</span><span class="op" id="1598346">(</span><span class="ident" id="1598347"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1598351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1598355">}</span>&nbsp;<span class="keyword" id="1598357">else</span>&nbsp;<span class="op" id="1598362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1598367">mp</span>&nbsp;<span class="op" id="1598370">:=</span>&nbsp;<span class="ident" id="1598373"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1598381">(</span><span class="op" id="1598382">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1598387"><a href="/gostd/runtime/malloc.go.html#1599597">profilealloc</a></span><span class="op" id="1598399">(</span><span class="ident" id="1598400"><a href="/gostd/runtime/malloc.go.html#1598367">mp</a></span><span class="op" id="1598402">,</span>&nbsp;<span class="ident" id="1598404"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span><span class="op" id="1598405">,</span>&nbsp;<span class="ident" id="1598407"><a href="/gostd/runtime/malloc.go.html#1589636">size</a></span><span class="op" id="1598411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1598416"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1598424">(</span><span class="ident" id="1598425"><a href="/gostd/runtime/malloc.go.html#1598367">mp</a></span><span class="op" id="1598427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1598431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1598434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1598438">if</span>&nbsp;<span class="ident" id="1598441"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793070">memstats</a></span><span class="op" id="1598449">.</span><span class="ident" id="1598450"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792588">heap_alloc</a></span>&nbsp;<span class="op" id="1598461">&gt;=</span>&nbsp;<span class="ident" id="1598464"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793070">memstats</a></span><span class="op" id="1598472">.</span><span class="ident" id="1598473"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792876">next_gc</a></span>&nbsp;<span class="op" id="1598481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1598485"><a href="/gostd/runtime/malloc.go.html#1600340">gogc</a></span><span class="op" id="1598489">(</span><span class="num" id="1598490">0</span><span class="op" id="1598491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1598494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1598498">return</span>&nbsp;<span class="ident" id="1598505"><a href="/gostd/runtime/malloc.go.html#1590411">x</a></span><br>
<span class="lineno">345</span><span class="op" id="1598507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1598510">//&nbsp;implementation&nbsp;of&nbsp;new&nbsp;builtin</span><br>
<span class="lineno"></span><span class="keyword" id="1598543">func</span>&nbsp;<span class="ident" id="1598548">newobject</span><span class="op" id="1598557">(</span><span class="ident" id="1598558">typ</span>&nbsp;<span class="op" id="1598562">*</span><span class="ident" id="1598563"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795605">_type</a></span><span class="op" id="1598568">)</span>&nbsp;<span class="ident" id="1598570"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1598576">.</span><span class="ident" id="1598577">Pointer</span>&nbsp;<span class="op" id="1598585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1598588">flags</span>&nbsp;<span class="op" id="1598594">:=</span>&nbsp;<span class="builtintype" id="1598597">uint32</span><span class="op" id="1598603">(</span><span class="num" id="1598604">0</span><span class="op" id="1598605">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1598608">if</span>&nbsp;<span class="ident" id="1598611"><a href="/gostd/runtime/malloc.go.html#1598558">typ</a></span><span class="op" id="1598614">.</span><span class="ident" id="1598615"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795694">kind</a></span><span class="op" id="1598619">&amp;</span><span class="ident" id="1598620"><a href="/gostd/runtime/typekind.go.html#1785247">kindNoPointers</a></span>&nbsp;<span class="op" id="1598635">!=</span>&nbsp;<span class="num" id="1598638">0</span>&nbsp;<span class="op" id="1598640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1598644"><a href="/gostd/runtime/malloc.go.html#1598588">flags</a></span>&nbsp;<span class="op" id="1598650">|=</span>&nbsp;<span class="ident" id="1598653"><a href="/gostd/runtime/malloc.go.html#1588855">flagNoScan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1598665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1598668">return</span>&nbsp;<span class="ident" id="1598675"><a href="/gostd/runtime/malloc.go.html#1589627">mallocgc</a></span><span class="op" id="1598683">(</span><span class="builtintype" id="1598684">uintptr</span><span class="op" id="1598691">(</span><span class="ident" id="1598692"><a href="/gostd/runtime/malloc.go.html#1598558">typ</a></span><span class="op" id="1598695">.</span><span class="ident" id="1598696"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795621">size</a></span><span class="op" id="1598700">)</span><span class="op" id="1598701">,</span>&nbsp;<span class="ident" id="1598703"><a href="/gostd/runtime/malloc.go.html#1598558">typ</a></span><span class="op" id="1598706">,</span>&nbsp;<span class="ident" id="1598708"><a href="/gostd/runtime/malloc.go.html#1598588">flags</a></span><span class="op" id="1598713">)</span><br>
<span class="lineno"></span><span class="op" id="1598715">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="1598718">//&nbsp;implementation&nbsp;of&nbsp;make&nbsp;builtin&nbsp;for&nbsp;slices</span><br>
<span class="lineno"></span><span class="keyword" id="1598763">func</span>&nbsp;<span class="ident" id="1598768">newarray</span><span class="op" id="1598776">(</span><span class="ident" id="1598777">typ</span>&nbsp;<span class="op" id="1598781">*</span><span class="ident" id="1598782"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795605">_type</a></span><span class="op" id="1598787">,</span>&nbsp;<span class="ident" id="1598789">n</span>&nbsp;<span class="builtintype" id="1598791">uintptr</span><span class="op" id="1598798">)</span>&nbsp;<span class="ident" id="1598800"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1598806">.</span><span class="ident" id="1598807">Pointer</span>&nbsp;<span class="op" id="1598815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1598818">flags</span>&nbsp;<span class="op" id="1598824">:=</span>&nbsp;<span class="builtintype" id="1598827">uint32</span><span class="op" id="1598833">(</span><span class="num" id="1598834">0</span><span class="op" id="1598835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1598838">if</span>&nbsp;<span class="ident" id="1598841"><a href="/gostd/runtime/malloc.go.html#1598777">typ</a></span><span class="op" id="1598844">.</span><span class="ident" id="1598845"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795694">kind</a></span><span class="op" id="1598849">&amp;</span><span class="ident" id="1598850"><a href="/gostd/runtime/typekind.go.html#1785247">kindNoPointers</a></span>&nbsp;<span class="op" id="1598865">!=</span>&nbsp;<span class="num" id="1598868">0</span>&nbsp;<span class="op" id="1598870">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1598874"><a href="/gostd/runtime/malloc.go.html#1598818">flags</a></span>&nbsp;<span class="op" id="1598880">|=</span>&nbsp;<span class="ident" id="1598883"><a href="/gostd/runtime/malloc.go.html#1588855">flagNoScan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1598895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1598898">if</span>&nbsp;<span class="builtintype" id="1598901">int</span><span class="op" id="1598904">(</span><span class="ident" id="1598905"><a href="/gostd/runtime/malloc.go.html#1598789">n</a></span><span class="op" id="1598906">)</span>&nbsp;<span class="op" id="1598908">&lt;</span>&nbsp;<span class="num" id="1598910">0</span>&nbsp;<span class="op" id="1598912">||</span>&nbsp;<span class="op" id="1598915">(</span><span class="ident" id="1598916"><a href="/gostd/runtime/malloc.go.html#1598777">typ</a></span><span class="op" id="1598919">.</span><span class="ident" id="1598920"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795621">size</a></span>&nbsp;<span class="op" id="1598925">&gt;</span>&nbsp;<span class="num" id="1598927">0</span>&nbsp;<span class="op" id="1598929">&amp;&amp;</span>&nbsp;<span class="ident" id="1598932"><a href="/gostd/runtime/malloc.go.html#1598789">n</a></span>&nbsp;<span class="op" id="1598934">&gt;</span>&nbsp;<span class="ident" id="1598936"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1801888">maxmem</a></span><span class="op" id="1598942">/</span><span class="builtintype" id="1598943">uintptr</span><span class="op" id="1598950">(</span><span class="ident" id="1598951"><a href="/gostd/runtime/malloc.go.html#1598777">typ</a></span><span class="op" id="1598954">.</span><span class="ident" id="1598955"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795621">size</a></span><span class="op" id="1598959">)</span><span class="op" id="1598960">)</span>&nbsp;<span class="op" id="1598962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1598966">panic</span><span class="op" id="1598971">(</span><span class="string" id="1598972">&#34;runtime:&nbsp;allocation&nbsp;size&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1599011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1599014">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1599017">return</span>&nbsp;<span class="ident" id="1599024"><a href="/gostd/runtime/malloc.go.html#1589627">mallocgc</a></span><span class="op" id="1599032">(</span><span class="builtintype" id="1599033">uintptr</span><span class="op" id="1599040">(</span><span class="ident" id="1599041"><a href="/gostd/runtime/malloc.go.html#1598777">typ</a></span><span class="op" id="1599044">.</span><span class="ident" id="1599045"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795621">size</a></span><span class="op" id="1599049">)</span><span class="op" id="1599050">*</span><span class="ident" id="1599051"><a href="/gostd/runtime/malloc.go.html#1598789">n</a></span><span class="op" id="1599052">,</span>&nbsp;<span class="ident" id="1599054"><a href="/gostd/runtime/malloc.go.html#1598777">typ</a></span><span class="op" id="1599057">,</span>&nbsp;<span class="ident" id="1599059"><a href="/gostd/runtime/malloc.go.html#1598818">flags</a></span><span class="op" id="1599064">)</span><br>
<span class="lineno"></span><span class="op" id="1599066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1599069">//&nbsp;rawmem&nbsp;returns&nbsp;a&nbsp;chunk&nbsp;of&nbsp;pointerless&nbsp;memory.&nbsp;&nbsp;It&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1599125">//&nbsp;not&nbsp;zeroed.</span><br>
<span class="lineno">370</span><span class="keyword" id="1599140">func</span>&nbsp;<span class="ident" id="1599145">rawmem</span><span class="op" id="1599151">(</span><span class="ident" id="1599152">size</span>&nbsp;<span class="builtintype" id="1599157">uintptr</span><span class="op" id="1599164">)</span>&nbsp;<span class="ident" id="1599166"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1599172">.</span><span class="ident" id="1599173">Pointer</span>&nbsp;<span class="op" id="1599181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1599184">return</span>&nbsp;<span class="ident" id="1599191"><a href="/gostd/runtime/malloc.go.html#1589627">mallocgc</a></span><span class="op" id="1599199">(</span><span class="ident" id="1599200"><a href="/gostd/runtime/malloc.go.html#1599152">size</a></span><span class="op" id="1599204">,</span>&nbsp;<span class="builtintype" id="1599206">nil</span><span class="op" id="1599209">,</span>&nbsp;<span class="ident" id="1599211"><a href="/gostd/runtime/malloc.go.html#1588855">flagNoScan</a></span><span class="op" id="1599221">|</span><span class="ident" id="1599222"><a href="/gostd/runtime/malloc.go.html#1588881">flagNoZero</a></span><span class="op" id="1599232">)</span><br>
<span class="lineno"></span><span class="op" id="1599234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1599237">//&nbsp;round&nbsp;size&nbsp;up&nbsp;to&nbsp;next&nbsp;size&nbsp;class</span><br>
<span class="lineno">375</span><span class="keyword" id="1599273">func</span>&nbsp;<span class="ident" id="1599278">goroundupsize</span><span class="op" id="1599291">(</span><span class="ident" id="1599292">size</span>&nbsp;<span class="builtintype" id="1599297">uintptr</span><span class="op" id="1599304">)</span>&nbsp;<span class="builtintype" id="1599306">uintptr</span>&nbsp;<span class="op" id="1599314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1599317">if</span>&nbsp;<span class="ident" id="1599320"><a href="/gostd/runtime/malloc.go.html#1599292">size</a></span>&nbsp;<span class="op" id="1599325">&lt;</span>&nbsp;<span class="ident" id="1599327"><a href="/gostd/runtime/malloc.go.html#1588967">maxSmallSize</a></span>&nbsp;<span class="op" id="1599340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1599344">if</span>&nbsp;<span class="ident" id="1599347"><a href="/gostd/runtime/malloc.go.html#1599292">size</a></span>&nbsp;<span class="op" id="1599352">&lt;=</span>&nbsp;<span class="num" id="1599355">1024</span><span class="op" id="1599359">-</span><span class="num" id="1599360">8</span>&nbsp;<span class="op" id="1599362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1599367">return</span>&nbsp;<span class="builtintype" id="1599374">uintptr</span><span class="op" id="1599381">(</span><span class="ident" id="1599382"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793090">class_to_size</a></span><span class="op" id="1599395">[</span><span class="ident" id="1599396"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793153">size_to_class8</a></span><span class="op" id="1599410">[</span><span class="op" id="1599411">(</span><span class="ident" id="1599412"><a href="/gostd/runtime/malloc.go.html#1599292">size</a></span><span class="op" id="1599416">+</span><span class="num" id="1599417">7</span><span class="op" id="1599418">)</span><span class="op" id="1599419">&gt;&gt;</span><span class="num" id="1599421">3</span><span class="op" id="1599422">]</span><span class="op" id="1599423">]</span><span class="op" id="1599424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1599428">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1599432">return</span>&nbsp;<span class="builtintype" id="1599439">uintptr</span><span class="op" id="1599446">(</span><span class="ident" id="1599447"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793090">class_to_size</a></span><span class="op" id="1599460">[</span><span class="ident" id="1599461"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793182">size_to_class128</a></span><span class="op" id="1599477">[</span><span class="op" id="1599478">(</span><span class="ident" id="1599479"><a href="/gostd/runtime/malloc.go.html#1599292">size</a></span><span class="op" id="1599483">-</span><span class="num" id="1599484">1024</span><span class="op" id="1599488">+</span><span class="num" id="1599489">127</span><span class="op" id="1599492">)</span><span class="op" id="1599493">&gt;&gt;</span><span class="num" id="1599495">7</span><span class="op" id="1599496">]</span><span class="op" id="1599497">]</span><span class="op" id="1599498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1599501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1599504">if</span>&nbsp;<span class="ident" id="1599507"><a href="/gostd/runtime/malloc.go.html#1599292">size</a></span><span class="op" id="1599511">+</span><span class="ident" id="1599512"><a href="/gostd/runtime/malloc.go.html#1589023">pageSize</a></span>&nbsp;<span class="op" id="1599521">&lt;</span>&nbsp;<span class="ident" id="1599523"><a href="/gostd/runtime/malloc.go.html#1599292">size</a></span>&nbsp;<span class="op" id="1599528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1599532">return</span>&nbsp;<span class="ident" id="1599539"><a href="/gostd/runtime/malloc.go.html#1599292">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1599545">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1599548">return</span>&nbsp;<span class="op" id="1599555">(</span><span class="ident" id="1599556"><a href="/gostd/runtime/malloc.go.html#1599292">size</a></span>&nbsp;<span class="op" id="1599561">+</span>&nbsp;<span class="ident" id="1599563"><a href="/gostd/runtime/malloc.go.html#1589023">pageSize</a></span>&nbsp;<span class="op" id="1599572">-</span>&nbsp;<span class="num" id="1599574">1</span><span class="op" id="1599575">)</span>&nbsp;<span class="op" id="1599577">&amp;^</span>&nbsp;<span class="ident" id="1599580"><a href="/gostd/runtime/malloc.go.html#1589046">pageMask</a></span><br>
<span class="lineno"></span><span class="op" id="1599589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1599592">func</span>&nbsp;<span class="ident" id="1599597">profilealloc</span><span class="op" id="1599609">(</span><span class="ident" id="1599610">mp</span>&nbsp;<span class="op" id="1599613">*</span><span class="ident" id="1599614"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787810">m</a></span><span class="op" id="1599615">,</span>&nbsp;<span class="ident" id="1599617">x</span>&nbsp;<span class="ident" id="1599619"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1599625">.</span><span class="ident" id="1599626">Pointer</span><span class="op" id="1599633">,</span>&nbsp;<span class="ident" id="1599635">size</span>&nbsp;<span class="builtintype" id="1599640">uintptr</span><span class="op" id="1599647">)</span>&nbsp;<span class="op" id="1599649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1599652">c</span>&nbsp;<span class="op" id="1599654">:=</span>&nbsp;<span class="ident" id="1599657"><a href="/gostd/runtime/malloc.go.html#1599610">mp</a></span><span class="op" id="1599659">.</span><span class="ident" id="1599660"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788226">mcache</a></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1599668">rate</span>&nbsp;<span class="op" id="1599673">:=</span>&nbsp;<span class="ident" id="1599676"><a href="/gostd/runtime/mprof.go.html#1628650">MemProfileRate</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1599692">if</span>&nbsp;<span class="ident" id="1599695"><a href="/gostd/runtime/malloc.go.html#1599635">size</a></span>&nbsp;<span class="op" id="1599700">&lt;</span>&nbsp;<span class="builtintype" id="1599702">uintptr</span><span class="op" id="1599709">(</span><span class="ident" id="1599710"><a href="/gostd/runtime/malloc.go.html#1599668">rate</a></span><span class="op" id="1599714">)</span>&nbsp;<span class="op" id="1599716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1599720">//&nbsp;pick&nbsp;next&nbsp;profile&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1599748">//&nbsp;If&nbsp;you&nbsp;change&nbsp;this,&nbsp;also&nbsp;change&nbsp;allocmcache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1599798">if</span>&nbsp;<span class="ident" id="1599801"><a href="/gostd/runtime/malloc.go.html#1599668">rate</a></span>&nbsp;<span class="op" id="1599806">&gt;</span>&nbsp;<span class="num" id="1599808">0x3fffffff</span>&nbsp;<span class="op" id="1599819">{</span>&nbsp;<span class="comment" id="1599821">//&nbsp;make&nbsp;2*rate&nbsp;not&nbsp;overflow</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1599852"><a href="/gostd/runtime/malloc.go.html#1599668">rate</a></span>&nbsp;<span class="op" id="1599857">=</span>&nbsp;<span class="num" id="1599859">0x3fffffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1599872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1599876">next</span>&nbsp;<span class="op" id="1599881">:=</span>&nbsp;<span class="builtintype" id="1599884">int32</span><span class="op" id="1599889">(</span><span class="ident" id="1599890"><a href="/gostd/runtime/stubs.go.html#1742945">fastrand1</a></span><span class="op" id="1599899">(</span><span class="op" id="1599900">)</span><span class="op" id="1599901">)</span>&nbsp;<span class="op" id="1599903">%</span>&nbsp;<span class="op" id="1599905">(</span><span class="num" id="1599906">2</span>&nbsp;<span class="op" id="1599908">*</span>&nbsp;<span class="builtintype" id="1599910">int32</span><span class="op" id="1599915">(</span><span class="ident" id="1599916"><a href="/gostd/runtime/malloc.go.html#1599668">rate</a></span><span class="op" id="1599920">)</span><span class="op" id="1599921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1599925">//&nbsp;Subtract&nbsp;the&nbsp;&#34;remainder&#34;&nbsp;of&nbsp;the&nbsp;current&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1599982">//&nbsp;Otherwise&nbsp;objects&nbsp;that&nbsp;are&nbsp;close&nbsp;in&nbsp;size&nbsp;to&nbsp;sampling&nbsp;rate</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1600045">//&nbsp;will&nbsp;be&nbsp;under-sampled,&nbsp;because&nbsp;we&nbsp;consistently&nbsp;discard&nbsp;this&nbsp;remainder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1600121"><a href="/gostd/runtime/malloc.go.html#1599876">next</a></span>&nbsp;<span class="op" id="1600126">-=</span>&nbsp;<span class="op" id="1600129">(</span><span class="builtintype" id="1600130">int32</span><span class="op" id="1600135">(</span><span class="ident" id="1600136"><a href="/gostd/runtime/malloc.go.html#1599635">size</a></span><span class="op" id="1600140">)</span>&nbsp;<span class="op" id="1600142">-</span>&nbsp;<span class="ident" id="1600144"><a href="/gostd/runtime/malloc.go.html#1599652">c</a></span><span class="op" id="1600145">.</span><span class="ident" id="1600146"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793344">next_sample</a></span><span class="op" id="1600157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1600161">if</span>&nbsp;<span class="ident" id="1600164"><a href="/gostd/runtime/malloc.go.html#1599876">next</a></span>&nbsp;<span class="op" id="1600169">&lt;</span>&nbsp;<span class="num" id="1600171">0</span>&nbsp;<span class="op" id="1600173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1600178"><a href="/gostd/runtime/malloc.go.html#1599876">next</a></span>&nbsp;<span class="op" id="1600183">=</span>&nbsp;<span class="num" id="1600185">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1600189">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1600193"><a href="/gostd/runtime/malloc.go.html#1599652">c</a></span><span class="op" id="1600194">.</span><span class="ident" id="1600195"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793344">next_sample</a></span>&nbsp;<span class="op" id="1600207">=</span>&nbsp;<span class="ident" id="1600209"><a href="/gostd/runtime/malloc.go.html#1599876">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1600215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1600219"><a href="/gostd/runtime/mprof.go.html#1625198">mProf_Malloc</a></span><span class="op" id="1600231">(</span><span class="ident" id="1600232"><a href="/gostd/runtime/malloc.go.html#1599617">x</a></span><span class="op" id="1600233">,</span>&nbsp;<span class="ident" id="1600235"><a href="/gostd/runtime/malloc.go.html#1599635">size</a></span><span class="op" id="1600239">)</span><br>
<span class="lineno"></span><span class="op" id="1600241">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span><span class="comment" id="1600244">//&nbsp;force&nbsp;=&nbsp;1&nbsp;-&nbsp;do&nbsp;GC&nbsp;regardless&nbsp;of&nbsp;current&nbsp;heap&nbsp;usage</span><br>
<span class="lineno"></span><span class="comment" id="1600298">//&nbsp;force&nbsp;=&nbsp;2&nbsp;-&nbsp;go&nbsp;GC&nbsp;and&nbsp;eager&nbsp;sweep</span><br>
<span class="lineno"></span><span class="keyword" id="1600335">func</span>&nbsp;<span class="ident" id="1600340">gogc</span><span class="op" id="1600344">(</span><span class="ident" id="1600345">force</span>&nbsp;<span class="builtintype" id="1600351">int32</span><span class="op" id="1600356">)</span>&nbsp;<span class="op" id="1600358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1600361">//&nbsp;The&nbsp;gc&nbsp;is&nbsp;turned&nbsp;off&nbsp;(via&nbsp;enablegc)&nbsp;until&nbsp;the&nbsp;bootstrap&nbsp;has&nbsp;completed.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1600436">//&nbsp;Also,&nbsp;malloc&nbsp;gets&nbsp;called&nbsp;in&nbsp;the&nbsp;guts&nbsp;of&nbsp;a&nbsp;number&nbsp;of&nbsp;libraries&nbsp;that&nbsp;might&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1600516">//&nbsp;holding&nbsp;locks.&nbsp;To&nbsp;avoid&nbsp;deadlocks&nbsp;during&nbsp;stoptheworld,&nbsp;don&#39;t&nbsp;bother</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1600588">//&nbsp;trying&nbsp;to&nbsp;run&nbsp;gc&nbsp;while&nbsp;holding&nbsp;a&nbsp;lock.&nbsp;The&nbsp;next&nbsp;mallocgc&nbsp;without&nbsp;a&nbsp;lock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1600664">//&nbsp;will&nbsp;do&nbsp;the&nbsp;gc&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1600692">mp</span>&nbsp;<span class="op" id="1600695">:=</span>&nbsp;<span class="ident" id="1600698"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1600706">(</span><span class="op" id="1600707">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1600710">if</span>&nbsp;<span class="ident" id="1600713">gp</span>&nbsp;<span class="op" id="1600716">:=</span>&nbsp;<span class="ident" id="1600719"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1600723">(</span><span class="op" id="1600724">)</span><span class="op" id="1600725">;</span>&nbsp;<span class="ident" id="1600727"><a href="/gostd/runtime/malloc.go.html#1600713">gp</a></span>&nbsp;<span class="op" id="1600730">==</span>&nbsp;<span class="ident" id="1600733"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span><span class="op" id="1600735">.</span><span class="ident" id="1600736"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787822">g0</a></span>&nbsp;<span class="op" id="1600739">||</span>&nbsp;<span class="ident" id="1600742"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span><span class="op" id="1600744">.</span><span class="ident" id="1600745"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788007">locks</a></span>&nbsp;<span class="op" id="1600751">&gt;</span>&nbsp;<span class="num" id="1600753">1</span>&nbsp;<span class="op" id="1600755">||</span>&nbsp;<span class="op" id="1600758">!</span><span class="ident" id="1600759"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793070">memstats</a></span><span class="op" id="1600767">.</span><span class="ident" id="1600768"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792990">enablegc</a></span>&nbsp;<span class="op" id="1600777">||</span>&nbsp;<span class="ident" id="1600780"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791314">panicking</a></span>&nbsp;<span class="op" id="1600790">!=</span>&nbsp;<span class="num" id="1600793">0</span>&nbsp;<span class="op" id="1600795">||</span>&nbsp;<span class="ident" id="1600798"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795067">gcpercent</a></span>&nbsp;<span class="op" id="1600808">&lt;</span>&nbsp;<span class="num" id="1600810">0</span>&nbsp;<span class="op" id="1600812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1600816"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1600824">(</span><span class="ident" id="1600825"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span><span class="op" id="1600827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1600831">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1600839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1600842"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1600850">(</span><span class="ident" id="1600851"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span><span class="op" id="1600853">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1600856"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span>&nbsp;<span class="op" id="1600859">=</span>&nbsp;<span class="builtintype" id="1600861">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1600867"><a href="/gostd/runtime/sema.go.html#1702898">semacquire</a></span><span class="op" id="1600877">(</span><span class="op" id="1600878">&amp;</span><span class="ident" id="1600879"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791594">worldsema</a></span><span class="op" id="1600888">,</span>&nbsp;<span class="builtintype" id="1600890">false</span><span class="op" id="1600895">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1600899">if</span>&nbsp;<span class="ident" id="1600902"><a href="/gostd/runtime/malloc.go.html#1600345">force</a></span>&nbsp;<span class="op" id="1600908">==</span>&nbsp;<span class="num" id="1600911">0</span>&nbsp;<span class="op" id="1600913">&amp;&amp;</span>&nbsp;<span class="ident" id="1600916"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793070">memstats</a></span><span class="op" id="1600924">.</span><span class="ident" id="1600925"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792588">heap_alloc</a></span>&nbsp;<span class="op" id="1600936">&lt;</span>&nbsp;<span class="ident" id="1600938"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793070">memstats</a></span><span class="op" id="1600946">.</span><span class="ident" id="1600947"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792876">next_gc</a></span>&nbsp;<span class="op" id="1600955">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1600959">//&nbsp;typically&nbsp;threads&nbsp;which&nbsp;lost&nbsp;the&nbsp;race&nbsp;to&nbsp;grab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1601010">//&nbsp;worldsema&nbsp;exit&nbsp;here&nbsp;when&nbsp;gc&nbsp;is&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601052"><a href="/gostd/runtime/sema.go.html#1703982">semrelease</a></span><span class="op" id="1601062">(</span><span class="op" id="1601063">&amp;</span><span class="ident" id="1601064"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791594">worldsema</a></span><span class="op" id="1601073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1601077">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1601085">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1601089">//&nbsp;Ok,&nbsp;we&#39;re&nbsp;doing&nbsp;it!&nbsp;&nbsp;Stop&nbsp;everybody&nbsp;else</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601134">startTime</span>&nbsp;<span class="op" id="1601144">:=</span>&nbsp;<span class="ident" id="1601147"><a href="/gostd/runtime/stubs.go.html#1743936">nanotime</a></span><span class="op" id="1601155">(</span><span class="op" id="1601156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601159"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span>&nbsp;<span class="op" id="1601162">=</span>&nbsp;<span class="ident" id="1601164"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1601172">(</span><span class="op" id="1601173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601176"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span><span class="op" id="1601178">.</span><span class="ident" id="1601179"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787994">gcing</a></span>&nbsp;<span class="op" id="1601185">=</span>&nbsp;<span class="num" id="1601187">1</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601190"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1601198">(</span><span class="ident" id="1601199"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span><span class="op" id="1601201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601204"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1601207">(</span><span class="ident" id="1601208"><a href="/gostd/runtime/stubs.go.html#1742794">stoptheworld</a></span><span class="op" id="1601220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1601223">if</span>&nbsp;<span class="ident" id="1601226"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span>&nbsp;<span class="op" id="1601229">!=</span>&nbsp;<span class="ident" id="1601232"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1601240">(</span><span class="op" id="1601241">)</span>&nbsp;<span class="op" id="1601243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601247"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1601254">(</span><span class="string" id="1601255">&#34;gogc:&nbsp;rescheduled&#34;</span><span class="op" id="1601274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1601277">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601281"><a href="/gostd/runtime/mgc0.go.html#1617024">clearpools</a></span><span class="op" id="1601291">(</span><span class="op" id="1601292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1601296">//&nbsp;Run&nbsp;gc&nbsp;on&nbsp;the&nbsp;g0&nbsp;stack.&nbsp;&nbsp;We&nbsp;do&nbsp;this&nbsp;so&nbsp;that&nbsp;the&nbsp;g&nbsp;stack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1601356">//&nbsp;we&#39;re&nbsp;currently&nbsp;running&nbsp;on&nbsp;will&nbsp;no&nbsp;longer&nbsp;change.&nbsp;&nbsp;Cuts</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1601416">//&nbsp;the&nbsp;root&nbsp;set&nbsp;down&nbsp;a&nbsp;bit&nbsp;(g0&nbsp;stacks&nbsp;are&nbsp;not&nbsp;scanned,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1601476">//&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;scan&nbsp;gc&#39;s&nbsp;internal&nbsp;state).&nbsp;&nbsp;We&nbsp;also</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1601533">//&nbsp;need&nbsp;to&nbsp;switch&nbsp;to&nbsp;g0&nbsp;so&nbsp;we&nbsp;can&nbsp;shrink&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601586">n</span>&nbsp;<span class="op" id="1601588">:=</span>&nbsp;<span class="num" id="1601591">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1601594">if</span>&nbsp;<span class="ident" id="1601597"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791471">debug</a></span><span class="op" id="1601602">.</span><span class="ident" id="1601603"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1790305">gctrace</a></span>&nbsp;<span class="op" id="1601611">&gt;</span>&nbsp;<span class="num" id="1601613">1</span>&nbsp;<span class="op" id="1601615">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601619"><a href="/gostd/runtime/malloc.go.html#1601586">n</a></span>&nbsp;<span class="op" id="1601621">=</span>&nbsp;<span class="num" id="1601623">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1601626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1601629">for</span>&nbsp;<span class="ident" id="1601633">i</span>&nbsp;<span class="op" id="1601635">:=</span>&nbsp;<span class="num" id="1601638">0</span><span class="op" id="1601639">;</span>&nbsp;<span class="ident" id="1601641"><a href="/gostd/runtime/malloc.go.html#1601633">i</a></span>&nbsp;<span class="op" id="1601643">&lt;</span>&nbsp;<span class="ident" id="1601645"><a href="/gostd/runtime/malloc.go.html#1601586">n</a></span><span class="op" id="1601646">;</span>&nbsp;<span class="ident" id="1601648"><a href="/gostd/runtime/malloc.go.html#1601633">i</a></span><span class="op" id="1601649">++</span>&nbsp;<span class="op" id="1601652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1601656">if</span>&nbsp;<span class="ident" id="1601659"><a href="/gostd/runtime/malloc.go.html#1601633">i</a></span>&nbsp;<span class="op" id="1601661">&gt;</span>&nbsp;<span class="num" id="1601663">0</span>&nbsp;<span class="op" id="1601665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601670"><a href="/gostd/runtime/malloc.go.html#1601134">startTime</a></span>&nbsp;<span class="op" id="1601680">=</span>&nbsp;<span class="ident" id="1601682"><a href="/gostd/runtime/stubs.go.html#1743936">nanotime</a></span><span class="op" id="1601690">(</span><span class="op" id="1601691">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1601695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1601699">//&nbsp;switch&nbsp;to&nbsp;g0,&nbsp;call&nbsp;gc,&nbsp;then&nbsp;switch&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601744"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span><span class="op" id="1601746">.</span><span class="ident" id="1601747"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788525">scalararg</a></span><span class="op" id="1601756">[</span><span class="num" id="1601757">0</span><span class="op" id="1601758">]</span>&nbsp;<span class="op" id="1601760">=</span>&nbsp;<span class="builtintype" id="1601762">uintptr</span><span class="op" id="1601769">(</span><span class="builtintype" id="1601770">uint32</span><span class="op" id="1601776">(</span><span class="ident" id="1601777"><a href="/gostd/runtime/malloc.go.html#1601134">startTime</a></span><span class="op" id="1601786">)</span><span class="op" id="1601787">)</span>&nbsp;<span class="comment" id="1601789">//&nbsp;low&nbsp;32&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601806"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span><span class="op" id="1601808">.</span><span class="ident" id="1601809"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788525">scalararg</a></span><span class="op" id="1601818">[</span><span class="num" id="1601819">1</span><span class="op" id="1601820">]</span>&nbsp;<span class="op" id="1601822">=</span>&nbsp;<span class="builtintype" id="1601824">uintptr</span><span class="op" id="1601831">(</span><span class="ident" id="1601832"><a href="/gostd/runtime/malloc.go.html#1601134">startTime</a></span>&nbsp;<span class="op" id="1601842">&gt;&gt;</span>&nbsp;<span class="num" id="1601845">32</span><span class="op" id="1601847">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1601851">//&nbsp;high&nbsp;32&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1601869">if</span>&nbsp;<span class="ident" id="1601872"><a href="/gostd/runtime/malloc.go.html#1600345">force</a></span>&nbsp;<span class="op" id="1601878">&gt;=</span>&nbsp;<span class="num" id="1601881">2</span>&nbsp;<span class="op" id="1601883">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601888"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span><span class="op" id="1601890">.</span><span class="ident" id="1601891"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788525">scalararg</a></span><span class="op" id="1601900">[</span><span class="num" id="1601901">2</span><span class="op" id="1601902">]</span>&nbsp;<span class="op" id="1601904">=</span>&nbsp;<span class="num" id="1601906">1</span>&nbsp;<span class="comment" id="1601908">//&nbsp;eagersweep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1601924">}</span>&nbsp;<span class="keyword" id="1601926">else</span>&nbsp;<span class="op" id="1601931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601936"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span><span class="op" id="1601938">.</span><span class="ident" id="1601939"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788525">scalararg</a></span><span class="op" id="1601948">[</span><span class="num" id="1601949">2</span><span class="op" id="1601950">]</span>&nbsp;<span class="op" id="1601952">=</span>&nbsp;<span class="num" id="1601954">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1601958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601962"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1601965">(</span><span class="ident" id="1601966"><a href="/gostd/runtime/stubs.go.html#1742183">gc_m</a></span><span class="op" id="1601970">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1601973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1601977">//&nbsp;all&nbsp;done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1601990"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span><span class="op" id="1601992">.</span><span class="ident" id="1601993"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787994">gcing</a></span>&nbsp;<span class="op" id="1601999">=</span>&nbsp;<span class="num" id="1602001">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1602004"><a href="/gostd/runtime/sema.go.html#1703982">semrelease</a></span><span class="op" id="1602014">(</span><span class="op" id="1602015">&amp;</span><span class="ident" id="1602016"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791594">worldsema</a></span><span class="op" id="1602025">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1602028"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1602031">(</span><span class="ident" id="1602032"><a href="/gostd/runtime/stubs.go.html#1742773">starttheworld</a></span><span class="op" id="1602045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1602048"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1602056">(</span><span class="ident" id="1602057"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span><span class="op" id="1602059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1602062"><a href="/gostd/runtime/malloc.go.html#1600692">mp</a></span>&nbsp;<span class="op" id="1602065">=</span>&nbsp;<span class="builtintype" id="1602067">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1602073">//&nbsp;now&nbsp;that&nbsp;gc&nbsp;is&nbsp;done,&nbsp;kick&nbsp;off&nbsp;finalizer&nbsp;thread&nbsp;if&nbsp;needed</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1602134">if</span>&nbsp;<span class="op" id="1602137">!</span><span class="ident" id="1602138"><a href="/gostd/runtime/malloc.go.html#1589289">concurrentSweep</a></span>&nbsp;<span class="op" id="1602154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1602158">//&nbsp;give&nbsp;the&nbsp;queued&nbsp;finalizers,&nbsp;if&nbsp;any,&nbsp;a&nbsp;chance&nbsp;to&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1602215"><a href="/gostd/runtime/proc.go.html#1673108">Gosched</a></span><span class="op" id="1602222">(</span><span class="op" id="1602223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1602226">}</span><br>
<span class="lineno"></span><span class="op" id="1602228">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="comment" id="1602231">//&nbsp;GC&nbsp;runs&nbsp;a&nbsp;garbage&nbsp;collection.</span><br>
<span class="lineno"></span><span class="keyword" id="1602264">func</span>&nbsp;<span class="ident" id="1602269">GC</span><span class="op" id="1602271">(</span><span class="op" id="1602272">)</span>&nbsp;<span class="op" id="1602274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1602277"><a href="/gostd/runtime/malloc.go.html#1600340">gogc</a></span><span class="op" id="1602281">(</span><span class="num" id="1602282">2</span><span class="op" id="1602283">)</span><br>
<span class="lineno"></span><span class="op" id="1602285">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="comment" id="1602288">//&nbsp;linker-provided</span><br>
<span class="lineno"></span><span class="keyword" id="1602307">var</span>&nbsp;<span class="ident" id="1602311">noptrdata</span>&nbsp;<span class="keyword" id="1602321">struct</span><span class="op" id="1602327">{</span><span class="op" id="1602328">}</span><br>
<span class="lineno"></span><span class="keyword" id="1602330">var</span>&nbsp;<span class="ident" id="1602334">enoptrdata</span>&nbsp;<span class="keyword" id="1602345">struct</span><span class="op" id="1602351">{</span><span class="op" id="1602352">}</span><br>
<span class="lineno"></span><span class="keyword" id="1602354">var</span>&nbsp;<span class="ident" id="1602358">noptrbss</span>&nbsp;<span class="keyword" id="1602367">struct</span><span class="op" id="1602373">{</span><span class="op" id="1602374">}</span><br>
<span class="lineno">495</span><span class="keyword" id="1602376">var</span>&nbsp;<span class="ident" id="1602380">enoptrbss</span>&nbsp;<span class="keyword" id="1602390">struct</span><span class="op" id="1602396">{</span><span class="op" id="1602397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1602400">//&nbsp;SetFinalizer&nbsp;sets&nbsp;the&nbsp;finalizer&nbsp;associated&nbsp;with&nbsp;x&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="1602459">//&nbsp;When&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;finds&nbsp;an&nbsp;unreachable&nbsp;block</span><br>
<span class="lineno"></span><span class="comment" id="1602516">//&nbsp;with&nbsp;an&nbsp;associated&nbsp;finalizer,&nbsp;it&nbsp;clears&nbsp;the&nbsp;association&nbsp;and&nbsp;runs</span><br>
<span class="lineno">500</span><span class="comment" id="1602584">//&nbsp;f(x)&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.&nbsp;&nbsp;This&nbsp;makes&nbsp;x&nbsp;reachable&nbsp;again,&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="1602652">//&nbsp;now&nbsp;without&nbsp;an&nbsp;associated&nbsp;finalizer.&nbsp;&nbsp;Assuming&nbsp;that&nbsp;SetFinalizer</span><br>
<span class="lineno"></span><span class="comment" id="1602720">//&nbsp;is&nbsp;not&nbsp;called&nbsp;again,&nbsp;the&nbsp;next&nbsp;time&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;sees</span><br>
<span class="lineno"></span><span class="comment" id="1602785">//&nbsp;that&nbsp;x&nbsp;is&nbsp;unreachable,&nbsp;it&nbsp;will&nbsp;free&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1602827">//</span><br>
<span class="lineno">505</span><span class="comment" id="1602830">//&nbsp;SetFinalizer(x,&nbsp;nil)&nbsp;clears&nbsp;any&nbsp;finalizer&nbsp;associated&nbsp;with&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1602894">//</span><br>
<span class="lineno"></span><span class="comment" id="1602897">//&nbsp;The&nbsp;argument&nbsp;x&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer&nbsp;to&nbsp;an&nbsp;object&nbsp;allocated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1602959">//&nbsp;calling&nbsp;new&nbsp;or&nbsp;by&nbsp;taking&nbsp;the&nbsp;address&nbsp;of&nbsp;a&nbsp;composite&nbsp;literal.</span><br>
<span class="lineno"></span><span class="comment" id="1603023">//&nbsp;The&nbsp;argument&nbsp;f&nbsp;must&nbsp;be&nbsp;a&nbsp;function&nbsp;that&nbsp;takes&nbsp;a&nbsp;single&nbsp;argument</span><br>
<span class="lineno">510</span><span class="comment" id="1603089">//&nbsp;to&nbsp;which&nbsp;x&#39;s&nbsp;type&nbsp;can&nbsp;be&nbsp;assigned,&nbsp;and&nbsp;can&nbsp;have&nbsp;arbitrary&nbsp;ignored&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="1603165">//&nbsp;values.&nbsp;If&nbsp;either&nbsp;of&nbsp;these&nbsp;is&nbsp;not&nbsp;true,&nbsp;SetFinalizer&nbsp;aborts&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1603232">//&nbsp;program.</span><br>
<span class="lineno"></span><span class="comment" id="1603244">//</span><br>
<span class="lineno"></span><span class="comment" id="1603247">//&nbsp;Finalizers&nbsp;are&nbsp;run&nbsp;in&nbsp;dependency&nbsp;order:&nbsp;if&nbsp;A&nbsp;points&nbsp;at&nbsp;B,&nbsp;both&nbsp;have</span><br>
<span class="lineno">515</span><span class="comment" id="1603318">//&nbsp;finalizers,&nbsp;and&nbsp;they&nbsp;are&nbsp;otherwise&nbsp;unreachable,&nbsp;only&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="1603388">//&nbsp;for&nbsp;A&nbsp;runs;&nbsp;once&nbsp;A&nbsp;is&nbsp;freed,&nbsp;the&nbsp;finalizer&nbsp;for&nbsp;B&nbsp;can&nbsp;run.</span><br>
<span class="lineno"></span><span class="comment" id="1603449">//&nbsp;If&nbsp;a&nbsp;cyclic&nbsp;structure&nbsp;includes&nbsp;a&nbsp;block&nbsp;with&nbsp;a&nbsp;finalizer,&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="1603514">//&nbsp;cycle&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;garbage&nbsp;collected&nbsp;and&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="1603583">//&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;run,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;ordering&nbsp;that</span><br>
<span class="lineno">520</span><span class="comment" id="1603646">//&nbsp;respects&nbsp;the&nbsp;dependencies.</span><br>
<span class="lineno"></span><span class="comment" id="1603676">//</span><br>
<span class="lineno"></span><span class="comment" id="1603679">//&nbsp;The&nbsp;finalizer&nbsp;for&nbsp;x&nbsp;is&nbsp;scheduled&nbsp;to&nbsp;run&nbsp;at&nbsp;some&nbsp;arbitrary&nbsp;time&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="1603751">//&nbsp;x&nbsp;becomes&nbsp;unreachable.</span><br>
<span class="lineno"></span><span class="comment" id="1603777">//&nbsp;There&nbsp;is&nbsp;no&nbsp;guarantee&nbsp;that&nbsp;finalizers&nbsp;will&nbsp;run&nbsp;before&nbsp;a&nbsp;program&nbsp;exits,</span><br>
<span class="lineno">525</span><span class="comment" id="1603851">//&nbsp;so&nbsp;typically&nbsp;they&nbsp;are&nbsp;useful&nbsp;only&nbsp;for&nbsp;releasing&nbsp;non-memory&nbsp;resources</span><br>
<span class="lineno"></span><span class="comment" id="1603923">//&nbsp;associated&nbsp;with&nbsp;an&nbsp;object&nbsp;during&nbsp;a&nbsp;long-running&nbsp;program.</span><br>
<span class="lineno"></span><span class="comment" id="1603983">//&nbsp;For&nbsp;example,&nbsp;an&nbsp;os.File&nbsp;object&nbsp;could&nbsp;use&nbsp;a&nbsp;finalizer&nbsp;to&nbsp;close&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1604052">//&nbsp;associated&nbsp;operating&nbsp;system&nbsp;file&nbsp;descriptor&nbsp;when&nbsp;a&nbsp;program&nbsp;discards</span><br>
<span class="lineno"></span><span class="comment" id="1604123">//&nbsp;an&nbsp;os.File&nbsp;without&nbsp;calling&nbsp;Close,&nbsp;but&nbsp;it&nbsp;would&nbsp;be&nbsp;a&nbsp;mistake</span><br>
<span class="lineno">530</span><span class="comment" id="1604186">//&nbsp;to&nbsp;depend&nbsp;on&nbsp;a&nbsp;finalizer&nbsp;to&nbsp;flush&nbsp;an&nbsp;in-memory&nbsp;I/O&nbsp;buffer&nbsp;such&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1604257">//&nbsp;bufio.Writer,&nbsp;because&nbsp;the&nbsp;buffer&nbsp;would&nbsp;not&nbsp;be&nbsp;flushed&nbsp;at&nbsp;program&nbsp;exit.</span><br>
<span class="lineno"></span><span class="comment" id="1604331">//</span><br>
<span class="lineno"></span><span class="comment" id="1604334">//&nbsp;It&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;that&nbsp;a&nbsp;finalizer&nbsp;will&nbsp;run&nbsp;if&nbsp;the&nbsp;size&nbsp;of&nbsp;*x&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1604405">//&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno">535</span><span class="comment" id="1604420">//</span><br>
<span class="lineno"></span><span class="comment" id="1604423">//&nbsp;It&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;that&nbsp;a&nbsp;finalizer&nbsp;will&nbsp;run&nbsp;for&nbsp;objects&nbsp;allocated</span><br>
<span class="lineno"></span><span class="comment" id="1604495">//&nbsp;in&nbsp;initializers&nbsp;for&nbsp;package-level&nbsp;variables.&nbsp;Such&nbsp;objects&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1604563">//&nbsp;linker-allocated,&nbsp;not&nbsp;heap-allocated.</span><br>
<span class="lineno"></span><span class="comment" id="1604604">//</span><br>
<span class="lineno">540</span><span class="comment" id="1604607">//&nbsp;A&nbsp;single&nbsp;goroutine&nbsp;runs&nbsp;all&nbsp;finalizers&nbsp;for&nbsp;a&nbsp;program,&nbsp;sequentially.</span><br>
<span class="lineno"></span><span class="comment" id="1604678">//&nbsp;If&nbsp;a&nbsp;finalizer&nbsp;must&nbsp;run&nbsp;for&nbsp;a&nbsp;long&nbsp;time,&nbsp;it&nbsp;should&nbsp;do&nbsp;so&nbsp;by&nbsp;starting</span><br>
<span class="lineno"></span><span class="comment" id="1604750">//&nbsp;a&nbsp;new&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="1604770">func</span>&nbsp;<span class="ident" id="1604775">SetFinalizer</span><span class="op" id="1604787">(</span><span class="ident" id="1604788">obj</span>&nbsp;<span class="keyword" id="1604792">interface</span><span class="op" id="1604801">{</span><span class="op" id="1604802">}</span><span class="op" id="1604803">,</span>&nbsp;<span class="ident" id="1604805">finalizer</span>&nbsp;<span class="keyword" id="1604815">interface</span><span class="op" id="1604824">{</span><span class="op" id="1604825">}</span><span class="op" id="1604826">)</span>&nbsp;<span class="op" id="1604828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1604831">e</span>&nbsp;<span class="op" id="1604833">:=</span>&nbsp;<span class="op" id="1604836">(</span><span class="op" id="1604837">*</span><span class="ident" id="1604838"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786423">eface</a></span><span class="op" id="1604843">)</span><span class="op" id="1604844">(</span><span class="ident" id="1604845"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1604851">.</span><span class="ident" id="1604852">Pointer</span><span class="op" id="1604859">(</span><span class="op" id="1604860">&amp;</span><span class="ident" id="1604861"><a href="/gostd/runtime/malloc.go.html#1604788">obj</a></span><span class="op" id="1604864">)</span><span class="op" id="1604865">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1604868">etyp</span>&nbsp;<span class="op" id="1604873">:=</span>&nbsp;<span class="ident" id="1604876"><a href="/gostd/runtime/malloc.go.html#1604831">e</a></span><span class="op" id="1604877">.</span><span class="ident" id="1604878"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786439">_type</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1604885">if</span>&nbsp;<span class="ident" id="1604888"><a href="/gostd/runtime/malloc.go.html#1604868">etyp</a></span>&nbsp;<span class="op" id="1604893">==</span>&nbsp;<span class="builtintype" id="1604896">nil</span>&nbsp;<span class="op" id="1604900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1604904"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1604911">(</span><span class="string" id="1604912">&#34;runtime.SetFinalizer:&nbsp;first&nbsp;argument&nbsp;is&nbsp;nil&#34;</span><span class="op" id="1604957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1604960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1604963">if</span>&nbsp;<span class="ident" id="1604966"><a href="/gostd/runtime/malloc.go.html#1604868">etyp</a></span><span class="op" id="1604970">.</span><span class="ident" id="1604971"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795694">kind</a></span><span class="op" id="1604975">&amp;</span><span class="ident" id="1604976"><a href="/gostd/runtime/typekind.go.html#1785282">kindMask</a></span>&nbsp;<span class="op" id="1604985">!=</span>&nbsp;<span class="ident" id="1604988"><a href="/gostd/runtime/typekind.go.html#1785011">kindPtr</a></span>&nbsp;<span class="op" id="1604996">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1605000"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1605007">(</span><span class="string" id="1605008">&#34;runtime.SetFinalizer:&nbsp;first&nbsp;argument&nbsp;is&nbsp;&#34;</span>&nbsp;<span class="op" id="1605051">+</span>&nbsp;<span class="op" id="1605053">*</span><span class="ident" id="1605054"><a href="/gostd/runtime/malloc.go.html#1604868">etyp</a></span><span class="op" id="1605058">.</span><span class="ident" id="1605059"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795741">_string</a></span>&nbsp;<span class="op" id="1605067">+</span>&nbsp;<span class="string" id="1605069">&#34;,&nbsp;not&nbsp;pointer&#34;</span><span class="op" id="1605084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1605087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1605090">ot</span>&nbsp;<span class="op" id="1605093">:=</span>&nbsp;<span class="op" id="1605096">(</span><span class="op" id="1605097">*</span><span class="ident" id="1605098"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796522">ptrtype</a></span><span class="op" id="1605105">)</span><span class="op" id="1605106">(</span><span class="ident" id="1605107"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1605113">.</span><span class="ident" id="1605114">Pointer</span><span class="op" id="1605121">(</span><span class="ident" id="1605122"><a href="/gostd/runtime/malloc.go.html#1604868">etyp</a></span><span class="op" id="1605126">)</span><span class="op" id="1605127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1605130">if</span>&nbsp;<span class="ident" id="1605133"><a href="/gostd/runtime/malloc.go.html#1605090">ot</a></span><span class="op" id="1605135">.</span><span class="ident" id="1605136"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796551">elem</a></span>&nbsp;<span class="op" id="1605141">==</span>&nbsp;<span class="builtintype" id="1605144">nil</span>&nbsp;<span class="op" id="1605148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1605152"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1605159">(</span><span class="string" id="1605160">&#34;nil&nbsp;elem&nbsp;type!&#34;</span><span class="op" id="1605176">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1605179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1605183">//&nbsp;find&nbsp;the&nbsp;containing&nbsp;object</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1605214">_</span><span class="op" id="1605215">,</span>&nbsp;<span class="ident" id="1605217">base</span><span class="op" id="1605221">,</span>&nbsp;<span class="ident" id="1605223">_</span>&nbsp;<span class="op" id="1605225">:=</span>&nbsp;<span class="ident" id="1605228"><a href="/gostd/runtime/malloc.go.html#1608768">findObject</a></span><span class="op" id="1605238">(</span><span class="ident" id="1605239"><a href="/gostd/runtime/malloc.go.html#1604831">e</a></span><span class="op" id="1605240">.</span><span class="ident" id="1605241"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786453">data</a></span><span class="op" id="1605245">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1605249">if</span>&nbsp;<span class="ident" id="1605252"><a href="/gostd/runtime/malloc.go.html#1605217">base</a></span>&nbsp;<span class="op" id="1605257">==</span>&nbsp;<span class="builtintype" id="1605260">nil</span>&nbsp;<span class="op" id="1605264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1605268">//&nbsp;0-length&nbsp;objects&nbsp;are&nbsp;okay.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1605300">if</span>&nbsp;<span class="ident" id="1605303"><a href="/gostd/runtime/malloc.go.html#1604831">e</a></span><span class="op" id="1605304">.</span><span class="ident" id="1605305"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786453">data</a></span>&nbsp;<span class="op" id="1605310">==</span>&nbsp;<span class="ident" id="1605313"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1605319">.</span><span class="ident" id="1605320">Pointer</span><span class="op" id="1605327">(</span><span class="op" id="1605328">&amp;</span><span class="ident" id="1605329"><a href="/gostd/runtime/malloc.go.html#1589436">zerobase</a></span><span class="op" id="1605337">)</span>&nbsp;<span class="op" id="1605339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1605344">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1605353">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1605358">//&nbsp;Global&nbsp;initializers&nbsp;might&nbsp;be&nbsp;linker-allocated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1605410">//&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;Foo&nbsp;=&nbsp;&amp;Object{}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1605435">//&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;main()&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1605454">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runtime.SetFinalizer(Foo,&nbsp;nil)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1605491">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1605498">//&nbsp;The&nbsp;relevant&nbsp;segments&nbsp;are:&nbsp;noptrdata,&nbsp;data,&nbsp;bss,&nbsp;noptrbss.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1605562">//&nbsp;We&nbsp;cannot&nbsp;assume&nbsp;they&nbsp;are&nbsp;in&nbsp;any&nbsp;order&nbsp;or&nbsp;even&nbsp;contiguous,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1605626">//&nbsp;due&nbsp;to&nbsp;external&nbsp;linking.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1605656">if</span>&nbsp;<span class="builtintype" id="1605659">uintptr</span><span class="op" id="1605666">(</span><span class="ident" id="1605667"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1605673">.</span><span class="ident" id="1605674">Pointer</span><span class="op" id="1605681">(</span><span class="op" id="1605682">&amp;</span><span class="ident" id="1605683"><a href="/gostd/runtime/malloc.go.html#1602311">noptrdata</a></span><span class="op" id="1605692">)</span><span class="op" id="1605693">)</span>&nbsp;<span class="op" id="1605695">&lt;=</span>&nbsp;<span class="builtintype" id="1605698">uintptr</span><span class="op" id="1605705">(</span><span class="ident" id="1605706"><a href="/gostd/runtime/malloc.go.html#1604831">e</a></span><span class="op" id="1605707">.</span><span class="ident" id="1605708"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786453">data</a></span><span class="op" id="1605712">)</span>&nbsp;<span class="op" id="1605714">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1605717">uintptr</span><span class="op" id="1605724">(</span><span class="ident" id="1605725"><a href="/gostd/runtime/malloc.go.html#1604831">e</a></span><span class="op" id="1605726">.</span><span class="ident" id="1605727"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786453">data</a></span><span class="op" id="1605731">)</span>&nbsp;<span class="op" id="1605733">&lt;</span>&nbsp;<span class="builtintype" id="1605735">uintptr</span><span class="op" id="1605742">(</span><span class="ident" id="1605743"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1605749">.</span><span class="ident" id="1605750">Pointer</span><span class="op" id="1605757">(</span><span class="op" id="1605758">&amp;</span><span class="ident" id="1605759"><a href="/gostd/runtime/malloc.go.html#1602334">enoptrdata</a></span><span class="op" id="1605769">)</span><span class="op" id="1605770">)</span>&nbsp;<span class="op" id="1605772">||</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1605778">uintptr</span><span class="op" id="1605785">(</span><span class="ident" id="1605786"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1605792">.</span><span class="ident" id="1605793">Pointer</span><span class="op" id="1605800">(</span><span class="op" id="1605801">&amp;</span><span class="ident" id="1605802"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802847">data</a></span><span class="op" id="1605806">)</span><span class="op" id="1605807">)</span>&nbsp;<span class="op" id="1605809">&lt;=</span>&nbsp;<span class="builtintype" id="1605812">uintptr</span><span class="op" id="1605819">(</span><span class="ident" id="1605820"><a href="/gostd/runtime/malloc.go.html#1604831">e</a></span><span class="op" id="1605821">.</span><span class="ident" id="1605822"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786453">data</a></span><span class="op" id="1605826">)</span>&nbsp;<span class="op" id="1605828">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1605831">uintptr</span><span class="op" id="1605838">(</span><span class="ident" id="1605839"><a href="/gostd/runtime/malloc.go.html#1604831">e</a></span><span class="op" id="1605840">.</span><span class="ident" id="1605841"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786453">data</a></span><span class="op" id="1605845">)</span>&nbsp;<span class="op" id="1605847">&lt;</span>&nbsp;<span class="builtintype" id="1605849">uintptr</span><span class="op" id="1605856">(</span><span class="ident" id="1605857"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1605863">.</span><span class="ident" id="1605864">Pointer</span><span class="op" id="1605871">(</span><span class="op" id="1605872">&amp;</span><span class="ident" id="1605873"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802864">edata</a></span><span class="op" id="1605878">)</span><span class="op" id="1605879">)</span>&nbsp;<span class="op" id="1605881">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1605887">uintptr</span><span class="op" id="1605894">(</span><span class="ident" id="1605895"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1605901">.</span><span class="ident" id="1605902">Pointer</span><span class="op" id="1605909">(</span><span class="op" id="1605910">&amp;</span><span class="ident" id="1605911"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802882">bss</a></span><span class="op" id="1605914">)</span><span class="op" id="1605915">)</span>&nbsp;<span class="op" id="1605917">&lt;=</span>&nbsp;<span class="builtintype" id="1605920">uintptr</span><span class="op" id="1605927">(</span><span class="ident" id="1605928"><a href="/gostd/runtime/malloc.go.html#1604831">e</a></span><span class="op" id="1605929">.</span><span class="ident" id="1605930"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786453">data</a></span><span class="op" id="1605934">)</span>&nbsp;<span class="op" id="1605936">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1605939">uintptr</span><span class="op" id="1605946">(</span><span class="ident" id="1605947"><a href="/gostd/runtime/malloc.go.html#1604831">e</a></span><span class="op" id="1605948">.</span><span class="ident" id="1605949"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786453">data</a></span><span class="op" id="1605953">)</span>&nbsp;<span class="op" id="1605955">&lt;</span>&nbsp;<span class="builtintype" id="1605957">uintptr</span><span class="op" id="1605964">(</span><span class="ident" id="1605965"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1605971">.</span><span class="ident" id="1605972">Pointer</span><span class="op" id="1605979">(</span><span class="op" id="1605980">&amp;</span><span class="ident" id="1605981"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1802898">ebss</a></span><span class="op" id="1605985">)</span><span class="op" id="1605986">)</span>&nbsp;<span class="op" id="1605988">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1605994">uintptr</span><span class="op" id="1606001">(</span><span class="ident" id="1606002"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1606008">.</span><span class="ident" id="1606009">Pointer</span><span class="op" id="1606016">(</span><span class="op" id="1606017">&amp;</span><span class="ident" id="1606018"><a href="/gostd/runtime/malloc.go.html#1602358">noptrbss</a></span><span class="op" id="1606026">)</span><span class="op" id="1606027">)</span>&nbsp;<span class="op" id="1606029">&lt;=</span>&nbsp;<span class="builtintype" id="1606032">uintptr</span><span class="op" id="1606039">(</span><span class="ident" id="1606040"><a href="/gostd/runtime/malloc.go.html#1604831">e</a></span><span class="op" id="1606041">.</span><span class="ident" id="1606042"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786453">data</a></span><span class="op" id="1606046">)</span>&nbsp;<span class="op" id="1606048">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1606051">uintptr</span><span class="op" id="1606058">(</span><span class="ident" id="1606059"><a href="/gostd/runtime/malloc.go.html#1604831">e</a></span><span class="op" id="1606060">.</span><span class="ident" id="1606061"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786453">data</a></span><span class="op" id="1606065">)</span>&nbsp;<span class="op" id="1606067">&lt;</span>&nbsp;<span class="builtintype" id="1606069">uintptr</span><span class="op" id="1606076">(</span><span class="ident" id="1606077"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1606083">.</span><span class="ident" id="1606084">Pointer</span><span class="op" id="1606091">(</span><span class="op" id="1606092">&amp;</span><span class="ident" id="1606093"><a href="/gostd/runtime/malloc.go.html#1602380">enoptrbss</a></span><span class="op" id="1606102">)</span><span class="op" id="1606103">)</span>&nbsp;<span class="op" id="1606105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1606110">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1606119">}</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1606123"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1606130">(</span><span class="string" id="1606131">&#34;runtime.SetFinalizer:&nbsp;pointer&nbsp;not&nbsp;in&nbsp;allocated&nbsp;block&#34;</span><span class="op" id="1606185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1606188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1606192">if</span>&nbsp;<span class="ident" id="1606195"><a href="/gostd/runtime/malloc.go.html#1604831">e</a></span><span class="op" id="1606196">.</span><span class="ident" id="1606197"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786453">data</a></span>&nbsp;<span class="op" id="1606202">!=</span>&nbsp;<span class="ident" id="1606205"><a href="/gostd/runtime/malloc.go.html#1605217">base</a></span>&nbsp;<span class="op" id="1606210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1606214">//&nbsp;As&nbsp;an&nbsp;implementation&nbsp;detail&nbsp;we&nbsp;allow&nbsp;to&nbsp;set&nbsp;finalizers&nbsp;for&nbsp;an&nbsp;inner&nbsp;byte</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1606292">//&nbsp;of&nbsp;an&nbsp;object&nbsp;if&nbsp;it&nbsp;could&nbsp;come&nbsp;from&nbsp;tiny&nbsp;alloc&nbsp;(see&nbsp;mallocgc&nbsp;for&nbsp;details).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1606371">if</span>&nbsp;<span class="ident" id="1606374"><a href="/gostd/runtime/malloc.go.html#1605090">ot</a></span><span class="op" id="1606376">.</span><span class="ident" id="1606377"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796551">elem</a></span>&nbsp;<span class="op" id="1606382">==</span>&nbsp;<span class="builtintype" id="1606385">nil</span>&nbsp;<span class="op" id="1606389">||</span>&nbsp;<span class="ident" id="1606392"><a href="/gostd/runtime/malloc.go.html#1605090">ot</a></span><span class="op" id="1606394">.</span><span class="ident" id="1606395"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796551">elem</a></span><span class="op" id="1606399">.</span><span class="ident" id="1606400"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795694">kind</a></span><span class="op" id="1606404">&amp;</span><span class="ident" id="1606405"><a href="/gostd/runtime/typekind.go.html#1785247">kindNoPointers</a></span>&nbsp;<span class="op" id="1606420">==</span>&nbsp;<span class="num" id="1606423">0</span>&nbsp;<span class="op" id="1606425">||</span>&nbsp;<span class="ident" id="1606428"><a href="/gostd/runtime/malloc.go.html#1605090">ot</a></span><span class="op" id="1606430">.</span><span class="ident" id="1606431"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796551">elem</a></span><span class="op" id="1606435">.</span><span class="ident" id="1606436"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795621">size</a></span>&nbsp;<span class="op" id="1606441">&gt;=</span>&nbsp;<span class="ident" id="1606444"><a href="/gostd/runtime/malloc.go.html#1588908">maxTinySize</a></span>&nbsp;<span class="op" id="1606456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1606461"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1606468">(</span><span class="string" id="1606469">&#34;runtime.SetFinalizer:&nbsp;pointer&nbsp;not&nbsp;at&nbsp;beginning&nbsp;of&nbsp;allocated&nbsp;block&#34;</span><span class="op" id="1606536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1606540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1606543">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1606547">f</span>&nbsp;<span class="op" id="1606549">:=</span>&nbsp;<span class="op" id="1606552">(</span><span class="op" id="1606553">*</span><span class="ident" id="1606554"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786423">eface</a></span><span class="op" id="1606559">)</span><span class="op" id="1606560">(</span><span class="ident" id="1606561"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1606567">.</span><span class="ident" id="1606568">Pointer</span><span class="op" id="1606575">(</span><span class="op" id="1606576">&amp;</span><span class="ident" id="1606577"><a href="/gostd/runtime/malloc.go.html#1604805">finalizer</a></span><span class="op" id="1606586">)</span><span class="op" id="1606587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1606590">ftyp</span>&nbsp;<span class="op" id="1606595">:=</span>&nbsp;<span class="ident" id="1606598"><a href="/gostd/runtime/malloc.go.html#1606547">f</a></span><span class="op" id="1606599">.</span><span class="ident" id="1606600"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786439">_type</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1606607">if</span>&nbsp;<span class="ident" id="1606610"><a href="/gostd/runtime/malloc.go.html#1606590">ftyp</a></span>&nbsp;<span class="op" id="1606615">==</span>&nbsp;<span class="builtintype" id="1606618">nil</span>&nbsp;<span class="op" id="1606622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1606626">//&nbsp;switch&nbsp;to&nbsp;M&nbsp;stack&nbsp;and&nbsp;remove&nbsp;finalizer</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1606670">mp</span>&nbsp;<span class="op" id="1606673">:=</span>&nbsp;<span class="ident" id="1606676"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1606684">(</span><span class="op" id="1606685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1606689"><a href="/gostd/runtime/malloc.go.html#1606670">mp</a></span><span class="op" id="1606691">.</span><span class="ident" id="1606692"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788547">ptrarg</a></span><span class="op" id="1606698">[</span><span class="num" id="1606699">0</span><span class="op" id="1606700">]</span>&nbsp;<span class="op" id="1606702">=</span>&nbsp;<span class="ident" id="1606704"><a href="/gostd/runtime/malloc.go.html#1604831">e</a></span><span class="op" id="1606705">.</span><span class="ident" id="1606706"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786453">data</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1606713"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1606716">(</span><span class="ident" id="1606717"><a href="/gostd/runtime/stubs.go.html#1742235">removeFinalizer_m</a></span><span class="op" id="1606734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1606738"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1606746">(</span><span class="ident" id="1606747"><a href="/gostd/runtime/malloc.go.html#1606670">mp</a></span><span class="op" id="1606749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1606753">return</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1606761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1606765">if</span>&nbsp;<span class="ident" id="1606768"><a href="/gostd/runtime/malloc.go.html#1606590">ftyp</a></span><span class="op" id="1606772">.</span><span class="ident" id="1606773"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795694">kind</a></span><span class="op" id="1606777">&amp;</span><span class="ident" id="1606778"><a href="/gostd/runtime/typekind.go.html#1785282">kindMask</a></span>&nbsp;<span class="op" id="1606787">!=</span>&nbsp;<span class="ident" id="1606790"><a href="/gostd/runtime/typekind.go.html#1784914">kindFunc</a></span>&nbsp;<span class="op" id="1606799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1606803"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1606810">(</span><span class="string" id="1606811">&#34;runtime.SetFinalizer:&nbsp;second&nbsp;argument&nbsp;is&nbsp;&#34;</span>&nbsp;<span class="op" id="1606855">+</span>&nbsp;<span class="op" id="1606857">*</span><span class="ident" id="1606858"><a href="/gostd/runtime/malloc.go.html#1606590">ftyp</a></span><span class="op" id="1606862">.</span><span class="ident" id="1606863"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795741">_string</a></span>&nbsp;<span class="op" id="1606871">+</span>&nbsp;<span class="string" id="1606873">&#34;,&nbsp;not&nbsp;a&nbsp;function&#34;</span><span class="op" id="1606891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1606894">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1606897">ft</span>&nbsp;<span class="op" id="1606900">:=</span>&nbsp;<span class="op" id="1606903">(</span><span class="op" id="1606904">*</span><span class="ident" id="1606905"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796446">functype</a></span><span class="op" id="1606913">)</span><span class="op" id="1606914">(</span><span class="ident" id="1606915"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1606921">.</span><span class="ident" id="1606922">Pointer</span><span class="op" id="1606929">(</span><span class="ident" id="1606930"><a href="/gostd/runtime/malloc.go.html#1606590">ftyp</a></span><span class="op" id="1606934">)</span><span class="op" id="1606935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1606938">ins</span>&nbsp;<span class="op" id="1606942">:=</span>&nbsp;<span class="op" id="1606945">*</span><span class="op" id="1606946">(</span><span class="op" id="1606947">*</span><span class="op" id="1606948">[</span><span class="op" id="1606949">]</span><span class="op" id="1606950">*</span><span class="ident" id="1606951"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795605">_type</a></span><span class="op" id="1606956">)</span><span class="op" id="1606957">(</span><span class="ident" id="1606958"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1606964">.</span><span class="ident" id="1606965">Pointer</span><span class="op" id="1606972">(</span><span class="op" id="1606973">&amp;</span><span class="ident" id="1606974"><a href="/gostd/runtime/malloc.go.html#1606897">ft</a></span><span class="op" id="1606976">.</span><span class="ident" id="1606977"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796492">in</a></span><span class="op" id="1606979">)</span><span class="op" id="1606980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1606983">if</span>&nbsp;<span class="ident" id="1606986"><a href="/gostd/runtime/malloc.go.html#1606897">ft</a></span><span class="op" id="1606988">.</span><span class="ident" id="1606989"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796476">dotdotdot</a></span>&nbsp;<span class="op" id="1606999">||</span>&nbsp;<span class="builtinfunc" id="1607002">len</span><span class="op" id="1607005">(</span><span class="ident" id="1607006"><a href="/gostd/runtime/malloc.go.html#1606938">ins</a></span><span class="op" id="1607009">)</span>&nbsp;<span class="op" id="1607011">!=</span>&nbsp;<span class="num" id="1607014">1</span>&nbsp;<span class="op" id="1607016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1607020"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1607027">(</span><span class="string" id="1607028">&#34;runtime.SetFinalizer:&nbsp;cannot&nbsp;pass&nbsp;&#34;</span>&nbsp;<span class="op" id="1607065">+</span>&nbsp;<span class="op" id="1607067">*</span><span class="ident" id="1607068"><a href="/gostd/runtime/malloc.go.html#1604868">etyp</a></span><span class="op" id="1607072">.</span><span class="ident" id="1607073"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795741">_string</a></span>&nbsp;<span class="op" id="1607081">+</span>&nbsp;<span class="string" id="1607083">&#34;&nbsp;to&nbsp;finalizer&nbsp;&#34;</span>&nbsp;<span class="op" id="1607100">+</span>&nbsp;<span class="op" id="1607102">*</span><span class="ident" id="1607103"><a href="/gostd/runtime/malloc.go.html#1606590">ftyp</a></span><span class="op" id="1607107">.</span><span class="ident" id="1607108"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795741">_string</a></span><span class="op" id="1607115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1607118">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1607121">fint</span>&nbsp;<span class="op" id="1607126">:=</span>&nbsp;<span class="ident" id="1607129"><a href="/gostd/runtime/malloc.go.html#1606938">ins</a></span><span class="op" id="1607132">[</span><span class="num" id="1607133">0</span><span class="op" id="1607134">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1607137">switch</span>&nbsp;<span class="op" id="1607144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1607147">case</span>&nbsp;<span class="ident" id="1607152"><a href="/gostd/runtime/malloc.go.html#1607121">fint</a></span>&nbsp;<span class="op" id="1607157">==</span>&nbsp;<span class="ident" id="1607160"><a href="/gostd/runtime/malloc.go.html#1604868">etyp</a></span><span class="op" id="1607164">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1607168">//&nbsp;ok&nbsp;-&nbsp;same&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1607188">goto</span>&nbsp;<span class="ident" id="1607193"><a href="/gostd/runtime/malloc.go.html#1607843">okarg</a></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1607200">case</span>&nbsp;<span class="ident" id="1607205"><a href="/gostd/runtime/malloc.go.html#1607121">fint</a></span><span class="op" id="1607209">.</span><span class="ident" id="1607210"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795694">kind</a></span><span class="op" id="1607214">&amp;</span><span class="ident" id="1607215"><a href="/gostd/runtime/typekind.go.html#1785282">kindMask</a></span>&nbsp;<span class="op" id="1607224">==</span>&nbsp;<span class="ident" id="1607227"><a href="/gostd/runtime/typekind.go.html#1785011">kindPtr</a></span><span class="op" id="1607234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1607238">if</span>&nbsp;<span class="op" id="1607241">(</span><span class="ident" id="1607242"><a href="/gostd/runtime/malloc.go.html#1607121">fint</a></span><span class="op" id="1607246">.</span><span class="ident" id="1607247"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795758">x</a></span>&nbsp;<span class="op" id="1607249">==</span>&nbsp;<span class="builtintype" id="1607252">nil</span>&nbsp;<span class="op" id="1607256">||</span>&nbsp;<span class="ident" id="1607259"><a href="/gostd/runtime/malloc.go.html#1607121">fint</a></span><span class="op" id="1607263">.</span><span class="ident" id="1607264"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795758">x</a></span><span class="op" id="1607265">.</span><span class="ident" id="1607266"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795951">name</a></span>&nbsp;<span class="op" id="1607271">==</span>&nbsp;<span class="builtintype" id="1607274">nil</span>&nbsp;<span class="op" id="1607278">||</span>&nbsp;<span class="ident" id="1607281"><a href="/gostd/runtime/malloc.go.html#1604868">etyp</a></span><span class="op" id="1607285">.</span><span class="ident" id="1607286"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795758">x</a></span>&nbsp;<span class="op" id="1607288">==</span>&nbsp;<span class="builtintype" id="1607291">nil</span>&nbsp;<span class="op" id="1607295">||</span>&nbsp;<span class="ident" id="1607298"><a href="/gostd/runtime/malloc.go.html#1604868">etyp</a></span><span class="op" id="1607302">.</span><span class="ident" id="1607303"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795758">x</a></span><span class="op" id="1607304">.</span><span class="ident" id="1607305"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795951">name</a></span>&nbsp;<span class="op" id="1607310">==</span>&nbsp;<span class="builtintype" id="1607313">nil</span><span class="op" id="1607316">)</span>&nbsp;<span class="op" id="1607318">&amp;&amp;</span>&nbsp;<span class="op" id="1607321">(</span><span class="op" id="1607322">*</span><span class="ident" id="1607323"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796522">ptrtype</a></span><span class="op" id="1607330">)</span><span class="op" id="1607331">(</span><span class="ident" id="1607332"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1607338">.</span><span class="ident" id="1607339">Pointer</span><span class="op" id="1607346">(</span><span class="ident" id="1607347"><a href="/gostd/runtime/malloc.go.html#1607121">fint</a></span><span class="op" id="1607351">)</span><span class="op" id="1607352">)</span><span class="op" id="1607353">.</span><span class="ident" id="1607354"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796551">elem</a></span>&nbsp;<span class="op" id="1607359">==</span>&nbsp;<span class="ident" id="1607362"><a href="/gostd/runtime/malloc.go.html#1605090">ot</a></span><span class="op" id="1607364">.</span><span class="ident" id="1607365"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796551">elem</a></span>&nbsp;<span class="op" id="1607370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1607375">//&nbsp;ok&nbsp;-&nbsp;not&nbsp;same&nbsp;type,&nbsp;but&nbsp;both&nbsp;pointers,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1607420">//&nbsp;one&nbsp;or&nbsp;the&nbsp;other&nbsp;is&nbsp;unnamed,&nbsp;and&nbsp;same&nbsp;element&nbsp;type,&nbsp;so&nbsp;assignable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1607493">goto</span>&nbsp;<span class="ident" id="1607498"><a href="/gostd/runtime/malloc.go.html#1607843">okarg</a></span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1607506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1607509">case</span>&nbsp;<span class="ident" id="1607514"><a href="/gostd/runtime/malloc.go.html#1607121">fint</a></span><span class="op" id="1607518">.</span><span class="ident" id="1607519"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795694">kind</a></span><span class="op" id="1607523">&amp;</span><span class="ident" id="1607524"><a href="/gostd/runtime/typekind.go.html#1785282">kindMask</a></span>&nbsp;<span class="op" id="1607533">==</span>&nbsp;<span class="ident" id="1607536"><a href="/gostd/runtime/typekind.go.html#1784945">kindInterface</a></span><span class="op" id="1607549">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1607553">ityp</span>&nbsp;<span class="op" id="1607558">:=</span>&nbsp;<span class="op" id="1607561">(</span><span class="op" id="1607562">*</span><span class="ident" id="1607563"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796085">interfacetype</a></span><span class="op" id="1607576">)</span><span class="op" id="1607577">(</span><span class="ident" id="1607578"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1607584">.</span><span class="ident" id="1607585">Pointer</span><span class="op" id="1607592">(</span><span class="ident" id="1607593"><a href="/gostd/runtime/malloc.go.html#1607121">fint</a></span><span class="op" id="1607597">)</span><span class="op" id="1607598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1607602">if</span>&nbsp;<span class="builtinfunc" id="1607605">len</span><span class="op" id="1607608">(</span><span class="ident" id="1607609"><a href="/gostd/runtime/malloc.go.html#1607553">ityp</a></span><span class="op" id="1607613">.</span><span class="ident" id="1607614"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796120">mhdr</a></span><span class="op" id="1607618">)</span>&nbsp;<span class="op" id="1607620">==</span>&nbsp;<span class="num" id="1607623">0</span>&nbsp;<span class="op" id="1607625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1607630">//&nbsp;ok&nbsp;-&nbsp;satisfies&nbsp;empty&nbsp;interface</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1607667">goto</span>&nbsp;<span class="ident" id="1607672"><a href="/gostd/runtime/malloc.go.html#1607843">okarg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1607680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1607684">if</span>&nbsp;<span class="ident" id="1607687">_</span><span class="op" id="1607688">,</span>&nbsp;<span class="ident" id="1607690">ok</span>&nbsp;<span class="op" id="1607693">:=</span>&nbsp;<span class="ident" id="1607696"><a href="/gostd/runtime/iface.go.html#1582726">assertE2I2</a></span><span class="op" id="1607706">(</span><span class="ident" id="1607707"><a href="/gostd/runtime/malloc.go.html#1607553">ityp</a></span><span class="op" id="1607711">,</span>&nbsp;<span class="ident" id="1607713"><a href="/gostd/runtime/malloc.go.html#1604788">obj</a></span><span class="op" id="1607716">)</span><span class="op" id="1607717">;</span>&nbsp;<span class="ident" id="1607719"><a href="/gostd/runtime/malloc.go.html#1607690">ok</a></span>&nbsp;<span class="op" id="1607722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1607727">goto</span>&nbsp;<span class="ident" id="1607732"><a href="/gostd/runtime/malloc.go.html#1607843">okarg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1607740">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1607743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1607746"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1607753">(</span><span class="string" id="1607754">&#34;runtime.SetFinalizer:&nbsp;cannot&nbsp;pass&nbsp;&#34;</span>&nbsp;<span class="op" id="1607791">+</span>&nbsp;<span class="op" id="1607793">*</span><span class="ident" id="1607794"><a href="/gostd/runtime/malloc.go.html#1604868">etyp</a></span><span class="op" id="1607798">.</span><span class="ident" id="1607799"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795741">_string</a></span>&nbsp;<span class="op" id="1607807">+</span>&nbsp;<span class="string" id="1607809">&#34;&nbsp;to&nbsp;finalizer&nbsp;&#34;</span>&nbsp;<span class="op" id="1607826">+</span>&nbsp;<span class="op" id="1607828">*</span><span class="ident" id="1607829"><a href="/gostd/runtime/malloc.go.html#1606590">ftyp</a></span><span class="op" id="1607833">.</span><span class="ident" id="1607834"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795741">_string</a></span><span class="op" id="1607841">)</span><br>
<span class="lineno"></span><span class="ident" id="1607843">okarg</span><span class="op" id="1607848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1607851">//&nbsp;compute&nbsp;size&nbsp;needed&nbsp;for&nbsp;return&nbsp;parameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1607897">nret</span>&nbsp;<span class="op" id="1607902">:=</span>&nbsp;<span class="builtintype" id="1607905">uintptr</span><span class="op" id="1607912">(</span><span class="num" id="1607913">0</span><span class="op" id="1607914">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1607917">for</span>&nbsp;<span class="ident" id="1607921">_</span><span class="op" id="1607922">,</span>&nbsp;<span class="ident" id="1607924">t</span>&nbsp;<span class="op" id="1607926">:=</span>&nbsp;<span class="keyword" id="1607929">range</span>&nbsp;<span class="op" id="1607935">*</span><span class="op" id="1607936">(</span><span class="op" id="1607937">*</span><span class="op" id="1607938">[</span><span class="op" id="1607939">]</span><span class="op" id="1607940">*</span><span class="ident" id="1607941"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795605">_type</a></span><span class="op" id="1607946">)</span><span class="op" id="1607947">(</span><span class="ident" id="1607948"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1607954">.</span><span class="ident" id="1607955">Pointer</span><span class="op" id="1607962">(</span><span class="op" id="1607963">&amp;</span><span class="ident" id="1607964"><a href="/gostd/runtime/malloc.go.html#1606897">ft</a></span><span class="op" id="1607966">.</span><span class="ident" id="1607967"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796503">out</a></span><span class="op" id="1607970">)</span><span class="op" id="1607971">)</span>&nbsp;<span class="op" id="1607973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1607977"><a href="/gostd/runtime/malloc.go.html#1607897">nret</a></span>&nbsp;<span class="op" id="1607982">=</span>&nbsp;<span class="ident" id="1607984"><a href="/gostd/runtime/malloc.go.html#1608519">round</a></span><span class="op" id="1607989">(</span><span class="ident" id="1607990"><a href="/gostd/runtime/malloc.go.html#1607897">nret</a></span><span class="op" id="1607994">,</span>&nbsp;<span class="builtintype" id="1607996">uintptr</span><span class="op" id="1608003">(</span><span class="ident" id="1608004"><a href="/gostd/runtime/malloc.go.html#1607924">t</a></span><span class="op" id="1608005">.</span><span class="ident" id="1608006"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795663">align</a></span><span class="op" id="1608011">)</span><span class="op" id="1608012">)</span>&nbsp;<span class="op" id="1608014">+</span>&nbsp;<span class="builtintype" id="1608016">uintptr</span><span class="op" id="1608023">(</span><span class="ident" id="1608024"><a href="/gostd/runtime/malloc.go.html#1607924">t</a></span><span class="op" id="1608025">.</span><span class="ident" id="1608026"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795621">size</a></span><span class="op" id="1608030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1608033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608036"><a href="/gostd/runtime/malloc.go.html#1607897">nret</a></span>&nbsp;<span class="op" id="1608041">=</span>&nbsp;<span class="ident" id="1608043"><a href="/gostd/runtime/malloc.go.html#1608519">round</a></span><span class="op" id="1608048">(</span><span class="ident" id="1608049"><a href="/gostd/runtime/malloc.go.html#1607897">nret</a></span><span class="op" id="1608053">,</span>&nbsp;<span class="ident" id="1608055"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span><span class="op" id="1608062">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1608066">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;have&nbsp;a&nbsp;finalizer&nbsp;goroutine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608110"><a href="/gostd/runtime/malloc.go.html#1609712">createfing</a></span><span class="op" id="1608120">(</span><span class="op" id="1608121">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1608125">//&nbsp;switch&nbsp;to&nbsp;M&nbsp;stack&nbsp;to&nbsp;add&nbsp;finalizer&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608171">mp</span>&nbsp;<span class="op" id="1608174">:=</span>&nbsp;<span class="ident" id="1608177"><a href="/gostd/runtime/stubs.go.html#1738934">acquirem</a></span><span class="op" id="1608185">(</span><span class="op" id="1608186">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608189"><a href="/gostd/runtime/malloc.go.html#1608171">mp</a></span><span class="op" id="1608191">.</span><span class="ident" id="1608192"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788547">ptrarg</a></span><span class="op" id="1608198">[</span><span class="num" id="1608199">0</span><span class="op" id="1608200">]</span>&nbsp;<span class="op" id="1608202">=</span>&nbsp;<span class="ident" id="1608204"><a href="/gostd/runtime/malloc.go.html#1606547">f</a></span><span class="op" id="1608205">.</span><span class="ident" id="1608206"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786453">data</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608212"><a href="/gostd/runtime/malloc.go.html#1608171">mp</a></span><span class="op" id="1608214">.</span><span class="ident" id="1608215"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788547">ptrarg</a></span><span class="op" id="1608221">[</span><span class="num" id="1608222">1</span><span class="op" id="1608223">]</span>&nbsp;<span class="op" id="1608225">=</span>&nbsp;<span class="ident" id="1608227"><a href="/gostd/runtime/malloc.go.html#1604831">e</a></span><span class="op" id="1608228">.</span><span class="ident" id="1608229"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786453">data</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608235"><a href="/gostd/runtime/malloc.go.html#1608171">mp</a></span><span class="op" id="1608237">.</span><span class="ident" id="1608238"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788525">scalararg</a></span><span class="op" id="1608247">[</span><span class="num" id="1608248">0</span><span class="op" id="1608249">]</span>&nbsp;<span class="op" id="1608251">=</span>&nbsp;<span class="ident" id="1608253"><a href="/gostd/runtime/malloc.go.html#1607897">nret</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608259"><a href="/gostd/runtime/malloc.go.html#1608171">mp</a></span><span class="op" id="1608261">.</span><span class="ident" id="1608262"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788547">ptrarg</a></span><span class="op" id="1608268">[</span><span class="num" id="1608269">2</span><span class="op" id="1608270">]</span>&nbsp;<span class="op" id="1608272">=</span>&nbsp;<span class="ident" id="1608274"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1608280">.</span><span class="ident" id="1608281">Pointer</span><span class="op" id="1608288">(</span><span class="ident" id="1608289"><a href="/gostd/runtime/malloc.go.html#1607121">fint</a></span><span class="op" id="1608293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608296"><a href="/gostd/runtime/malloc.go.html#1608171">mp</a></span><span class="op" id="1608298">.</span><span class="ident" id="1608299"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788547">ptrarg</a></span><span class="op" id="1608305">[</span><span class="num" id="1608306">3</span><span class="op" id="1608307">]</span>&nbsp;<span class="op" id="1608309">=</span>&nbsp;<span class="ident" id="1608311"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1608317">.</span><span class="ident" id="1608318">Pointer</span><span class="op" id="1608325">(</span><span class="ident" id="1608326"><a href="/gostd/runtime/malloc.go.html#1605090">ot</a></span><span class="op" id="1608328">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608331"><a href="/gostd/runtime/stubs.go.html#1741035">onM</a></span><span class="op" id="1608334">(</span><span class="ident" id="1608335"><a href="/gostd/runtime/stubs.go.html#1742213">setFinalizer_m</a></span><span class="op" id="1608349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1608352">if</span>&nbsp;<span class="ident" id="1608355"><a href="/gostd/runtime/malloc.go.html#1608171">mp</a></span><span class="op" id="1608357">.</span><span class="ident" id="1608358"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1788525">scalararg</a></span><span class="op" id="1608367">[</span><span class="num" id="1608368">0</span><span class="op" id="1608369">]</span>&nbsp;<span class="op" id="1608371">!=</span>&nbsp;<span class="num" id="1608374">1</span>&nbsp;<span class="op" id="1608376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608380"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1608387">(</span><span class="string" id="1608388">&#34;runtime.SetFinalizer:&nbsp;finalizer&nbsp;already&nbsp;set&#34;</span><span class="op" id="1608433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1608436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608439"><a href="/gostd/runtime/stubs.go.html#1738953">releasem</a></span><span class="op" id="1608447">(</span><span class="ident" id="1608448"><a href="/gostd/runtime/malloc.go.html#1608171">mp</a></span><span class="op" id="1608450">)</span><br>
<span class="lineno">655</span><span class="op" id="1608452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1608455">//&nbsp;round&nbsp;n&nbsp;up&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;a.&nbsp;&nbsp;a&nbsp;must&nbsp;be&nbsp;a&nbsp;power&nbsp;of&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="1608514">func</span>&nbsp;<span class="ident" id="1608519">round</span><span class="op" id="1608524">(</span><span class="ident" id="1608525">n</span><span class="op" id="1608526">,</span>&nbsp;<span class="ident" id="1608528">a</span>&nbsp;<span class="builtintype" id="1608530">uintptr</span><span class="op" id="1608537">)</span>&nbsp;<span class="builtintype" id="1608539">uintptr</span>&nbsp;<span class="op" id="1608547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1608550">return</span>&nbsp;<span class="op" id="1608557">(</span><span class="ident" id="1608558"><a href="/gostd/runtime/malloc.go.html#1608525">n</a></span>&nbsp;<span class="op" id="1608560">+</span>&nbsp;<span class="ident" id="1608562"><a href="/gostd/runtime/malloc.go.html#1608528">a</a></span>&nbsp;<span class="op" id="1608564">-</span>&nbsp;<span class="num" id="1608566">1</span><span class="op" id="1608567">)</span>&nbsp;<span class="op" id="1608569">&amp;^</span>&nbsp;<span class="op" id="1608572">(</span><span class="ident" id="1608573"><a href="/gostd/runtime/malloc.go.html#1608528">a</a></span>&nbsp;<span class="op" id="1608575">-</span>&nbsp;<span class="num" id="1608577">1</span><span class="op" id="1608578">)</span><br>
<span class="lineno">660</span><span class="op" id="1608580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1608583">//&nbsp;Look&nbsp;up&nbsp;pointer&nbsp;v&nbsp;in&nbsp;heap.&nbsp;&nbsp;Return&nbsp;the&nbsp;span&nbsp;containing&nbsp;the&nbsp;object,</span><br>
<span class="lineno"></span><span class="comment" id="1608653">//&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;object,&nbsp;and&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;object.&nbsp;&nbsp;If&nbsp;the&nbsp;object</span><br>
<span class="lineno"></span><span class="comment" id="1608724">//&nbsp;does&nbsp;not&nbsp;exist,&nbsp;return&nbsp;nil,&nbsp;nil,&nbsp;0.</span><br>
<span class="lineno">665</span><span class="keyword" id="1608763">func</span>&nbsp;<span class="ident" id="1608768">findObject</span><span class="op" id="1608778">(</span><span class="ident" id="1608779">v</span>&nbsp;<span class="ident" id="1608781"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1608787">.</span><span class="ident" id="1608788">Pointer</span><span class="op" id="1608795">)</span>&nbsp;<span class="op" id="1608797">(</span><span class="ident" id="1608798">s</span>&nbsp;<span class="op" id="1608800">*</span><span class="ident" id="1608801"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794050">mspan</a></span><span class="op" id="1608806">,</span>&nbsp;<span class="ident" id="1608808">x</span>&nbsp;<span class="ident" id="1608810"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1608816">.</span><span class="ident" id="1608817">Pointer</span><span class="op" id="1608824">,</span>&nbsp;<span class="ident" id="1608826">n</span>&nbsp;<span class="builtintype" id="1608828">uintptr</span><span class="op" id="1608835">)</span>&nbsp;<span class="op" id="1608837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608840">c</span>&nbsp;<span class="op" id="1608842">:=</span>&nbsp;<span class="ident" id="1608845"><a href="/gostd/runtime/stubs.go.html#1738974">gomcache</a></span><span class="op" id="1608853">(</span><span class="op" id="1608854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608857"><a href="/gostd/runtime/malloc.go.html#1608840">c</a></span><span class="op" id="1608858">.</span><span class="ident" id="1608859"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793536">local_nlookup</a></span><span class="op" id="1608872">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1608876">if</span>&nbsp;<span class="ident" id="1608879"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span>&nbsp;<span class="op" id="1608887">==</span>&nbsp;<span class="num" id="1608890">4</span>&nbsp;<span class="op" id="1608892">&amp;&amp;</span>&nbsp;<span class="ident" id="1608895"><a href="/gostd/runtime/malloc.go.html#1608840">c</a></span><span class="op" id="1608896">.</span><span class="ident" id="1608897"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793536">local_nlookup</a></span>&nbsp;<span class="op" id="1608911">&gt;=</span>&nbsp;<span class="num" id="1608914">1</span><span class="op" id="1608915">&lt;&lt;</span><span class="num" id="1608917">30</span>&nbsp;<span class="op" id="1608920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1608924">//&nbsp;purge&nbsp;cache&nbsp;stats&nbsp;to&nbsp;prevent&nbsp;overflow</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608967"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1608971">(</span><span class="op" id="1608972">&amp;</span><span class="ident" id="1608973"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795050">mheap_</a></span><span class="op" id="1608979">.</span><span class="ident" id="1608980"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794506">lock</a></span><span class="op" id="1608984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1608988"><a href="/gostd/runtime/stubs.go.html#1744575">purgecachedstats</a></span><span class="op" id="1609004">(</span><span class="ident" id="1609005"><a href="/gostd/runtime/malloc.go.html#1608840">c</a></span><span class="op" id="1609006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609010"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1609016">(</span><span class="op" id="1609017">&amp;</span><span class="ident" id="1609018"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795050">mheap_</a></span><span class="op" id="1609024">.</span><span class="ident" id="1609025"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794506">lock</a></span><span class="op" id="1609029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1609032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1609036">//&nbsp;find&nbsp;span</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609050">arena_start</span>&nbsp;<span class="op" id="1609062">:=</span>&nbsp;<span class="builtintype" id="1609065">uintptr</span><span class="op" id="1609072">(</span><span class="ident" id="1609073"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1609079">.</span><span class="ident" id="1609080">Pointer</span><span class="op" id="1609087">(</span><span class="ident" id="1609088"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795050">mheap_</a></span><span class="op" id="1609094">.</span><span class="ident" id="1609095"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794761">arena_start</a></span><span class="op" id="1609106">)</span><span class="op" id="1609107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609110">arena_used</span>&nbsp;<span class="op" id="1609121">:=</span>&nbsp;<span class="builtintype" id="1609124">uintptr</span><span class="op" id="1609131">(</span><span class="ident" id="1609132"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1609138">.</span><span class="ident" id="1609139">Pointer</span><span class="op" id="1609146">(</span><span class="ident" id="1609147"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795050">mheap_</a></span><span class="op" id="1609153">.</span><span class="ident" id="1609154"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794780">arena_used</a></span><span class="op" id="1609164">)</span><span class="op" id="1609165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609168">if</span>&nbsp;<span class="builtintype" id="1609171">uintptr</span><span class="op" id="1609178">(</span><span class="ident" id="1609179"><a href="/gostd/runtime/malloc.go.html#1608779">v</a></span><span class="op" id="1609180">)</span>&nbsp;<span class="op" id="1609182">&lt;</span>&nbsp;<span class="ident" id="1609184"><a href="/gostd/runtime/malloc.go.html#1609050">arena_start</a></span>&nbsp;<span class="op" id="1609196">||</span>&nbsp;<span class="builtintype" id="1609199">uintptr</span><span class="op" id="1609206">(</span><span class="ident" id="1609207"><a href="/gostd/runtime/malloc.go.html#1608779">v</a></span><span class="op" id="1609208">)</span>&nbsp;<span class="op" id="1609210">&gt;=</span>&nbsp;<span class="ident" id="1609213"><a href="/gostd/runtime/malloc.go.html#1609110">arena_used</a></span>&nbsp;<span class="op" id="1609224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609228">return</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1609236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609239">p</span>&nbsp;<span class="op" id="1609241">:=</span>&nbsp;<span class="builtintype" id="1609244">uintptr</span><span class="op" id="1609251">(</span><span class="ident" id="1609252"><a href="/gostd/runtime/malloc.go.html#1608779">v</a></span><span class="op" id="1609253">)</span>&nbsp;<span class="op" id="1609255">&gt;&gt;</span>&nbsp;<span class="ident" id="1609258"><a href="/gostd/runtime/malloc.go.html#1588999">pageShift</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609269">q</span>&nbsp;<span class="op" id="1609271">:=</span>&nbsp;<span class="ident" id="1609274"><a href="/gostd/runtime/malloc.go.html#1609239">p</a></span>&nbsp;<span class="op" id="1609276">-</span>&nbsp;<span class="ident" id="1609278"><a href="/gostd/runtime/malloc.go.html#1609050">arena_start</a></span><span class="op" id="1609289">&gt;&gt;</span><span class="ident" id="1609291"><a href="/gostd/runtime/malloc.go.html#1588999">pageShift</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609302"><a href="/gostd/runtime/malloc.go.html#1608798">s</a></span>&nbsp;<span class="op" id="1609304">=</span>&nbsp;<span class="op" id="1609306">*</span><span class="op" id="1609307">(</span><span class="op" id="1609308">*</span><span class="op" id="1609309">*</span><span class="ident" id="1609310"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794050">mspan</a></span><span class="op" id="1609315">)</span><span class="op" id="1609316">(</span><span class="ident" id="1609317"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1609320">(</span><span class="ident" id="1609321"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1609327">.</span><span class="ident" id="1609328">Pointer</span><span class="op" id="1609335">(</span><span class="ident" id="1609336"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795050">mheap_</a></span><span class="op" id="1609342">.</span><span class="ident" id="1609343"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794687">spans</a></span><span class="op" id="1609348">)</span><span class="op" id="1609349">,</span>&nbsp;<span class="ident" id="1609351"><a href="/gostd/runtime/malloc.go.html#1609269">q</a></span><span class="op" id="1609352">*</span><span class="ident" id="1609353"><a href="/gostd/runtime/stubs.go.html#1738408">ptrSize</a></span><span class="op" id="1609360">)</span><span class="op" id="1609361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609364">if</span>&nbsp;<span class="ident" id="1609367"><a href="/gostd/runtime/malloc.go.html#1608798">s</a></span>&nbsp;<span class="op" id="1609369">==</span>&nbsp;<span class="builtintype" id="1609372">nil</span>&nbsp;<span class="op" id="1609376">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609380">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1609388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609391"><a href="/gostd/runtime/malloc.go.html#1608808">x</a></span>&nbsp;<span class="op" id="1609393">=</span>&nbsp;<span class="ident" id="1609395"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1609401">.</span><span class="ident" id="1609402">Pointer</span><span class="op" id="1609409">(</span><span class="builtintype" id="1609410">uintptr</span><span class="op" id="1609417">(</span><span class="ident" id="1609418"><a href="/gostd/runtime/malloc.go.html#1608798">s</a></span><span class="op" id="1609419">.</span><span class="ident" id="1609420"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794092">start</a></span><span class="op" id="1609425">)</span>&nbsp;<span class="op" id="1609427">&lt;&lt;</span>&nbsp;<span class="ident" id="1609430"><a href="/gostd/runtime/malloc.go.html#1588999">pageShift</a></span><span class="op" id="1609439">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609443">if</span>&nbsp;<span class="builtintype" id="1609446">uintptr</span><span class="op" id="1609453">(</span><span class="ident" id="1609454"><a href="/gostd/runtime/malloc.go.html#1608779">v</a></span><span class="op" id="1609455">)</span>&nbsp;<span class="op" id="1609457">&lt;</span>&nbsp;<span class="builtintype" id="1609459">uintptr</span><span class="op" id="1609466">(</span><span class="ident" id="1609467"><a href="/gostd/runtime/malloc.go.html#1608808">x</a></span><span class="op" id="1609468">)</span>&nbsp;<span class="op" id="1609470">||</span>&nbsp;<span class="builtintype" id="1609473">uintptr</span><span class="op" id="1609480">(</span><span class="ident" id="1609481"><a href="/gostd/runtime/malloc.go.html#1608779">v</a></span><span class="op" id="1609482">)</span>&nbsp;<span class="op" id="1609484">&gt;=</span>&nbsp;<span class="builtintype" id="1609487">uintptr</span><span class="op" id="1609494">(</span><span class="ident" id="1609495"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1609501">.</span><span class="ident" id="1609502">Pointer</span><span class="op" id="1609509">(</span><span class="ident" id="1609510"><a href="/gostd/runtime/malloc.go.html#1608798">s</a></span><span class="op" id="1609511">.</span><span class="ident" id="1609512"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794285">limit</a></span><span class="op" id="1609517">)</span><span class="op" id="1609518">)</span>&nbsp;<span class="op" id="1609520">||</span>&nbsp;<span class="ident" id="1609523"><a href="/gostd/runtime/malloc.go.html#1608798">s</a></span><span class="op" id="1609524">.</span><span class="ident" id="1609525"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794199">state</a></span>&nbsp;<span class="op" id="1609531">!=</span>&nbsp;<span class="ident" id="1609534"><a href="/gostd/runtime/malloc.go.html#1589262">mSpanInUse</a></span>&nbsp;<span class="op" id="1609545">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609549"><a href="/gostd/runtime/malloc.go.html#1608798">s</a></span>&nbsp;<span class="op" id="1609551">=</span>&nbsp;<span class="builtintype" id="1609553">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609559"><a href="/gostd/runtime/malloc.go.html#1608808">x</a></span>&nbsp;<span class="op" id="1609561">=</span>&nbsp;<span class="builtintype" id="1609563">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609569">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1609577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609581"><a href="/gostd/runtime/malloc.go.html#1608826">n</a></span>&nbsp;<span class="op" id="1609583">=</span>&nbsp;<span class="builtintype" id="1609585">uintptr</span><span class="op" id="1609592">(</span><span class="ident" id="1609593"><a href="/gostd/runtime/malloc.go.html#1608798">s</a></span><span class="op" id="1609594">.</span><span class="ident" id="1609595"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794228">elemsize</a></span><span class="op" id="1609603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609606">if</span>&nbsp;<span class="ident" id="1609609"><a href="/gostd/runtime/malloc.go.html#1608798">s</a></span><span class="op" id="1609610">.</span><span class="ident" id="1609611"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1794168">sizeclass</a></span>&nbsp;<span class="op" id="1609621">!=</span>&nbsp;<span class="num" id="1609624">0</span>&nbsp;<span class="op" id="1609626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609630"><a href="/gostd/runtime/malloc.go.html#1608808">x</a></span>&nbsp;<span class="op" id="1609632">=</span>&nbsp;<span class="ident" id="1609634"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1609637">(</span><span class="ident" id="1609638"><a href="/gostd/runtime/malloc.go.html#1608808">x</a></span><span class="op" id="1609639">,</span>&nbsp;<span class="op" id="1609641">(</span><span class="builtintype" id="1609642">uintptr</span><span class="op" id="1609649">(</span><span class="ident" id="1609650"><a href="/gostd/runtime/malloc.go.html#1608779">v</a></span><span class="op" id="1609651">)</span><span class="op" id="1609652">-</span><span class="builtintype" id="1609653">uintptr</span><span class="op" id="1609660">(</span><span class="ident" id="1609661"><a href="/gostd/runtime/malloc.go.html#1608808">x</a></span><span class="op" id="1609662">)</span><span class="op" id="1609663">)</span><span class="op" id="1609664">/</span><span class="ident" id="1609665"><a href="/gostd/runtime/malloc.go.html#1608826">n</a></span><span class="op" id="1609666">*</span><span class="ident" id="1609667"><a href="/gostd/runtime/malloc.go.html#1608826">n</a></span><span class="op" id="1609668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1609671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609674">return</span><br>
<span class="lineno">700</span><span class="op" id="1609681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1609684">var</span>&nbsp;<span class="ident" id="1609688">fingCreate</span>&nbsp;<span class="builtintype" id="1609699">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1609707">func</span>&nbsp;<span class="ident" id="1609712">createfing</span><span class="op" id="1609722">(</span><span class="op" id="1609723">)</span>&nbsp;<span class="op" id="1609725">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1609728">//&nbsp;start&nbsp;the&nbsp;finalizer&nbsp;goroutine&nbsp;exactly&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609775">if</span>&nbsp;<span class="ident" id="1609778"><a href="/gostd/runtime/malloc.go.html#1609688">fingCreate</a></span>&nbsp;<span class="op" id="1609789">==</span>&nbsp;<span class="num" id="1609792">0</span>&nbsp;<span class="op" id="1609794">&amp;&amp;</span>&nbsp;<span class="ident" id="1609797"><a href="/gostd/runtime/stubs.go.html#1744744">cas</a></span><span class="op" id="1609800">(</span><span class="op" id="1609801">&amp;</span><span class="ident" id="1609802"><a href="/gostd/runtime/malloc.go.html#1609688">fingCreate</a></span><span class="op" id="1609812">,</span>&nbsp;<span class="num" id="1609814">0</span><span class="op" id="1609815">,</span>&nbsp;<span class="num" id="1609817">1</span><span class="op" id="1609818">)</span>&nbsp;<span class="op" id="1609820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609824">go</span>&nbsp;<span class="ident" id="1609827"><a href="/gostd/runtime/malloc.go.html#1609905">runfinq</a></span><span class="op" id="1609834">(</span><span class="op" id="1609835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1609838">}</span><br>
<span class="lineno"></span><span class="op" id="1609840">}</span><br>
<span class="lineno">710</span><br>
<span class="lineno"></span><span class="comment" id="1609843">//&nbsp;This&nbsp;is&nbsp;the&nbsp;goroutine&nbsp;that&nbsp;runs&nbsp;all&nbsp;of&nbsp;the&nbsp;finalizers</span><br>
<span class="lineno"></span><span class="keyword" id="1609900">func</span>&nbsp;<span class="ident" id="1609905">runfinq</span><span class="op" id="1609912">(</span><span class="op" id="1609913">)</span>&nbsp;<span class="op" id="1609915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609918">var</span>&nbsp;<span class="op" id="1609922">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609926">frame</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609935"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1609941">.</span><span class="ident" id="1609942">Pointer</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609952">framecap</span>&nbsp;<span class="builtintype" id="1609961">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1609970">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1609974">for</span>&nbsp;<span class="op" id="1609978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609982"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1609986">(</span><span class="op" id="1609987">&amp;</span><span class="ident" id="1609988"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795332">finlock</a></span><span class="op" id="1609995">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1609999">fb</span>&nbsp;<span class="op" id="1610002">:=</span>&nbsp;<span class="ident" id="1610005"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795398">finq</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1610012"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795398">finq</a></span>&nbsp;<span class="op" id="1610017">=</span>&nbsp;<span class="builtintype" id="1610019">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1610025">if</span>&nbsp;<span class="ident" id="1610028"><a href="/gostd/runtime/malloc.go.html#1609999">fb</a></span>&nbsp;<span class="op" id="1610031">==</span>&nbsp;<span class="builtintype" id="1610034">nil</span>&nbsp;<span class="op" id="1610038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1610043">gp</span>&nbsp;<span class="op" id="1610046">:=</span>&nbsp;<span class="ident" id="1610049"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1610053">(</span><span class="op" id="1610054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1610059"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795350">fing</a></span>&nbsp;<span class="op" id="1610064">=</span>&nbsp;<span class="ident" id="1610066"><a href="/gostd/runtime/malloc.go.html#1610043">gp</a></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1610072"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795362">fingwait</a></span>&nbsp;<span class="op" id="1610081">=</span>&nbsp;<span class="builtintype" id="1610083">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1610091"><a href="/gostd/runtime/malloc.go.html#1610043">gp</a></span><span class="op" id="1610093">.</span><span class="ident" id="1610094"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787526">issystem</a></span>&nbsp;<span class="op" id="1610103">=</span>&nbsp;<span class="builtintype" id="1610105">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1610113"><a href="/gostd/runtime/proc.go.html#1673799">goparkunlock</a></span><span class="op" id="1610125">(</span><span class="op" id="1610126">&amp;</span><span class="ident" id="1610127"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795332">finlock</a></span><span class="op" id="1610134">,</span>&nbsp;<span class="string" id="1610136">&#34;finalizer&nbsp;wait&#34;</span><span class="op" id="1610152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1610157"><a href="/gostd/runtime/malloc.go.html#1610043">gp</a></span><span class="op" id="1610159">.</span><span class="ident" id="1610160"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787526">issystem</a></span>&nbsp;<span class="op" id="1610169">=</span>&nbsp;<span class="builtintype" id="1610171">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1610180">continue</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1610191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1610195"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1610201">(</span><span class="op" id="1610202">&amp;</span><span class="ident" id="1610203"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795332">finlock</a></span><span class="op" id="1610210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1610214">if</span>&nbsp;<span class="ident" id="1610217"><a href="/gostd/runtime/race0.go.html#1676514">raceenabled</a></span>&nbsp;<span class="op" id="1610229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1610234"><a href="/gostd/runtime/race0.go.html#1678056">racefingo</a></span><span class="op" id="1610243">(</span><span class="op" id="1610244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1610248">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1610252">for</span>&nbsp;<span class="ident" id="1610256"><a href="/gostd/runtime/malloc.go.html#1609999">fb</a></span>&nbsp;<span class="op" id="1610259">!=</span>&nbsp;<span class="builtintype" id="1610262">nil</span>&nbsp;<span class="op" id="1610266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1610271">for</span>&nbsp;<span class="ident" id="1610275">i</span>&nbsp;<span class="op" id="1610277">:=</span>&nbsp;<span class="builtintype" id="1610280">int32</span><span class="op" id="1610285">(</span><span class="num" id="1610286">0</span><span class="op" id="1610287">)</span><span class="op" id="1610288">;</span>&nbsp;<span class="ident" id="1610290"><a href="/gostd/runtime/malloc.go.html#1610275">i</a></span>&nbsp;<span class="op" id="1610292">&lt;</span>&nbsp;<span class="ident" id="1610294"><a href="/gostd/runtime/malloc.go.html#1609999">fb</a></span><span class="op" id="1610296">.</span><span class="ident" id="1610297"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795286">cnt</a></span><span class="op" id="1610300">;</span>&nbsp;<span class="ident" id="1610302"><a href="/gostd/runtime/malloc.go.html#1610275">i</a></span><span class="op" id="1610303">++</span>&nbsp;<span class="op" id="1610306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1610312">f</span>&nbsp;<span class="op" id="1610314">:=</span>&nbsp;<span class="op" id="1610317">(</span><span class="op" id="1610318">*</span><span class="ident" id="1610319"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795132">finalizer</a></span><span class="op" id="1610328">)</span><span class="op" id="1610329">(</span><span class="ident" id="1610330"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1610333">(</span><span class="ident" id="1610334"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1610340">.</span><span class="ident" id="1610341">Pointer</span><span class="op" id="1610348">(</span><span class="op" id="1610349">&amp;</span><span class="ident" id="1610350"><a href="/gostd/runtime/malloc.go.html#1609999">fb</a></span><span class="op" id="1610352">.</span><span class="ident" id="1610353"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795308">fin</a></span><span class="op" id="1610356">)</span><span class="op" id="1610357">,</span>&nbsp;<span class="builtintype" id="1610359">uintptr</span><span class="op" id="1610366">(</span><span class="ident" id="1610367"><a href="/gostd/runtime/malloc.go.html#1610275">i</a></span><span class="op" id="1610368">)</span><span class="op" id="1610369">*</span><span class="ident" id="1610370"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1610376">.</span><span class="ident" id="1610377">Sizeof</span><span class="op" id="1610383">(</span><span class="ident" id="1610384"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795132">finalizer</a></span><span class="op" id="1610393">{</span><span class="op" id="1610394">}</span><span class="op" id="1610395">)</span><span class="op" id="1610396">)</span><span class="op" id="1610397">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1610404">framesz</span>&nbsp;<span class="op" id="1610412">:=</span>&nbsp;<span class="ident" id="1610415"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1610421">.</span><span class="ident" id="1610422">Sizeof</span><span class="op" id="1610428">(</span><span class="op" id="1610429">(</span><span class="keyword" id="1610430">interface</span><span class="op" id="1610439">{</span><span class="op" id="1610440">}</span><span class="op" id="1610441">)</span><span class="op" id="1610442">(</span><span class="builtintype" id="1610443">nil</span><span class="op" id="1610446">)</span><span class="op" id="1610447">)</span>&nbsp;<span class="op" id="1610449">+</span>&nbsp;<span class="builtintype" id="1610451">uintptr</span><span class="op" id="1610458">(</span><span class="ident" id="1610459"><a href="/gostd/runtime/malloc.go.html#1610312">f</a></span><span class="op" id="1610460">.</span><span class="ident" id="1610461"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795185">nret</a></span><span class="op" id="1610465">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1610471">if</span>&nbsp;<span class="ident" id="1610474"><a href="/gostd/runtime/malloc.go.html#1609952">framecap</a></span>&nbsp;<span class="op" id="1610483">&lt;</span>&nbsp;<span class="ident" id="1610485"><a href="/gostd/runtime/malloc.go.html#1610404">framesz</a></span>&nbsp;<span class="op" id="1610493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1610500">//&nbsp;The&nbsp;frame&nbsp;does&nbsp;not&nbsp;contain&nbsp;pointers&nbsp;interesting&nbsp;for&nbsp;GC,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1610564">//&nbsp;all&nbsp;not&nbsp;yet&nbsp;finalized&nbsp;objects&nbsp;are&nbsp;stored&nbsp;in&nbsp;finq.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1610622">//&nbsp;If&nbsp;we&nbsp;do&nbsp;not&nbsp;mark&nbsp;it&nbsp;as&nbsp;FlagNoScan,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1610666">//&nbsp;the&nbsp;last&nbsp;finalized&nbsp;object&nbsp;is&nbsp;not&nbsp;collected.</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1610718"><a href="/gostd/runtime/malloc.go.html#1609926">frame</a></span>&nbsp;<span class="op" id="1610724">=</span>&nbsp;<span class="ident" id="1610726"><a href="/gostd/runtime/malloc.go.html#1589627">mallocgc</a></span><span class="op" id="1610734">(</span><span class="ident" id="1610735"><a href="/gostd/runtime/malloc.go.html#1610404">framesz</a></span><span class="op" id="1610742">,</span>&nbsp;<span class="builtintype" id="1610744">nil</span><span class="op" id="1610747">,</span>&nbsp;<span class="ident" id="1610749"><a href="/gostd/runtime/malloc.go.html#1588855">flagNoScan</a></span><span class="op" id="1610759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1610766"><a href="/gostd/runtime/malloc.go.html#1609952">framecap</a></span>&nbsp;<span class="op" id="1610775">=</span>&nbsp;<span class="ident" id="1610777"><a href="/gostd/runtime/malloc.go.html#1610404">framesz</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1610789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1610796">if</span>&nbsp;<span class="ident" id="1610799"><a href="/gostd/runtime/malloc.go.html#1610312">f</a></span><span class="op" id="1610800">.</span><span class="ident" id="1610801"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795199">fint</a></span>&nbsp;<span class="op" id="1610806">==</span>&nbsp;<span class="builtintype" id="1610809">nil</span>&nbsp;<span class="op" id="1610813">{</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1610820"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1610827">(</span><span class="string" id="1610828">&#34;missing&nbsp;type&nbsp;in&nbsp;runfinq&#34;</span><span class="op" id="1610853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1610859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1610865">switch</span>&nbsp;<span class="ident" id="1610872"><a href="/gostd/runtime/malloc.go.html#1610312">f</a></span><span class="op" id="1610873">.</span><span class="ident" id="1610874"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795199">fint</a></span><span class="op" id="1610878">.</span><span class="ident" id="1610879"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795694">kind</a></span>&nbsp;<span class="op" id="1610884">&amp;</span>&nbsp;<span class="ident" id="1610886"><a href="/gostd/runtime/typekind.go.html#1785282">kindMask</a></span>&nbsp;<span class="op" id="1610895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1610901">case</span>&nbsp;<span class="ident" id="1610906"><a href="/gostd/runtime/typekind.go.html#1785011">kindPtr</a></span><span class="op" id="1610913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1610920">//&nbsp;direct&nbsp;use&nbsp;of&nbsp;pointer</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1610950">*</span><span class="op" id="1610951">(</span><span class="op" id="1610952">*</span><span class="ident" id="1610953"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1610959">.</span><span class="ident" id="1610960">Pointer</span><span class="op" id="1610967">)</span><span class="op" id="1610968">(</span><span class="ident" id="1610969"><a href="/gostd/runtime/malloc.go.html#1609926">frame</a></span><span class="op" id="1610974">)</span>&nbsp;<span class="op" id="1610976">=</span>&nbsp;<span class="ident" id="1610978"><a href="/gostd/runtime/malloc.go.html#1610312">f</a></span><span class="op" id="1610979">.</span><span class="ident" id="1610980"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795165">arg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1610988">case</span>&nbsp;<span class="ident" id="1610993"><a href="/gostd/runtime/typekind.go.html#1784945">kindInterface</a></span><span class="op" id="1611006">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611013">ityp</span>&nbsp;<span class="op" id="1611018">:=</span>&nbsp;<span class="op" id="1611021">(</span><span class="op" id="1611022">*</span><span class="ident" id="1611023"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796085">interfacetype</a></span><span class="op" id="1611036">)</span><span class="op" id="1611037">(</span><span class="ident" id="1611038"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1611044">.</span><span class="ident" id="1611045">Pointer</span><span class="op" id="1611052">(</span><span class="ident" id="1611053"><a href="/gostd/runtime/malloc.go.html#1610312">f</a></span><span class="op" id="1611054">.</span><span class="ident" id="1611055"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795199">fint</a></span><span class="op" id="1611059">)</span><span class="op" id="1611060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1611067">//&nbsp;set&nbsp;up&nbsp;with&nbsp;empty&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1611103">(</span><span class="op" id="1611104">*</span><span class="ident" id="1611105"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786423">eface</a></span><span class="op" id="1611110">)</span><span class="op" id="1611111">(</span><span class="ident" id="1611112"><a href="/gostd/runtime/malloc.go.html#1609926">frame</a></span><span class="op" id="1611117">)</span><span class="op" id="1611118">.</span><span class="ident" id="1611119"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786439">_type</a></span>&nbsp;<span class="op" id="1611125">=</span>&nbsp;<span class="op" id="1611127">&amp;</span><span class="ident" id="1611128"><a href="/gostd/runtime/malloc.go.html#1610312">f</a></span><span class="op" id="1611129">.</span><span class="ident" id="1611130"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795212">ot</a></span><span class="op" id="1611132">.</span><span class="ident" id="1611133"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796540">typ</a></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1611142">(</span><span class="op" id="1611143">*</span><span class="ident" id="1611144"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786423">eface</a></span><span class="op" id="1611149">)</span><span class="op" id="1611150">(</span><span class="ident" id="1611151"><a href="/gostd/runtime/malloc.go.html#1609926">frame</a></span><span class="op" id="1611156">)</span><span class="op" id="1611157">.</span><span class="ident" id="1611158"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786453">data</a></span>&nbsp;<span class="op" id="1611163">=</span>&nbsp;<span class="ident" id="1611165"><a href="/gostd/runtime/malloc.go.html#1610312">f</a></span><span class="op" id="1611166">.</span><span class="ident" id="1611167"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795165">arg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1611176">if</span>&nbsp;<span class="builtinfunc" id="1611179">len</span><span class="op" id="1611182">(</span><span class="ident" id="1611183"><a href="/gostd/runtime/malloc.go.html#1611013">ityp</a></span><span class="op" id="1611187">.</span><span class="ident" id="1611188"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796120">mhdr</a></span><span class="op" id="1611192">)</span>&nbsp;<span class="op" id="1611194">!=</span>&nbsp;<span class="num" id="1611197">0</span>&nbsp;<span class="op" id="1611199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1611207">//&nbsp;convert&nbsp;to&nbsp;interface&nbsp;with&nbsp;methods</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1611250">//&nbsp;this&nbsp;conversion&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;succeed&nbsp;-&nbsp;we&nbsp;checked&nbsp;in&nbsp;SetFinalizer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1611329">*</span><span class="op" id="1611330">(</span><span class="op" id="1611331">*</span><span class="ident" id="1611332"><a href="/gostd/runtime/iface.go.html#1574295">fInterface</a></span><span class="op" id="1611342">)</span><span class="op" id="1611343">(</span><span class="ident" id="1611344"><a href="/gostd/runtime/malloc.go.html#1609926">frame</a></span><span class="op" id="1611349">)</span>&nbsp;<span class="op" id="1611351">=</span>&nbsp;<span class="ident" id="1611353"><a href="/gostd/runtime/iface.go.html#1582367">assertE2I</a></span><span class="op" id="1611362">(</span><span class="ident" id="1611363"><a href="/gostd/runtime/malloc.go.html#1611013">ityp</a></span><span class="op" id="1611367">,</span>&nbsp;<span class="op" id="1611369">*</span><span class="op" id="1611370">(</span><span class="op" id="1611371">*</span><span class="keyword" id="1611372">interface</span><span class="op" id="1611381">{</span><span class="op" id="1611382">}</span><span class="op" id="1611383">)</span><span class="op" id="1611384">(</span><span class="ident" id="1611385"><a href="/gostd/runtime/malloc.go.html#1609926">frame</a></span><span class="op" id="1611390">)</span><span class="op" id="1611391">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1611398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1611404">default</span><span class="op" id="1611411">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611418"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1611425">(</span><span class="string" id="1611426">&#34;bad&nbsp;kind&nbsp;in&nbsp;runfinq&#34;</span><span class="op" id="1611447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1611453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611459"><a href="/gostd/runtime/stubs.go.html#1744361">reflectcall</a></span><span class="op" id="1611470">(</span><span class="ident" id="1611471"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1611477">.</span><span class="ident" id="1611478">Pointer</span><span class="op" id="1611485">(</span><span class="ident" id="1611486"><a href="/gostd/runtime/malloc.go.html#1610312">f</a></span><span class="op" id="1611487">.</span><span class="ident" id="1611488"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795152">fn</a></span><span class="op" id="1611490">)</span><span class="op" id="1611491">,</span>&nbsp;<span class="ident" id="1611493"><a href="/gostd/runtime/malloc.go.html#1609926">frame</a></span><span class="op" id="1611498">,</span>&nbsp;<span class="builtintype" id="1611500">uint32</span><span class="op" id="1611506">(</span><span class="ident" id="1611507"><a href="/gostd/runtime/malloc.go.html#1610404">framesz</a></span><span class="op" id="1611514">)</span><span class="op" id="1611515">,</span>&nbsp;<span class="builtintype" id="1611517">uint32</span><span class="op" id="1611523">(</span><span class="ident" id="1611524"><a href="/gostd/runtime/malloc.go.html#1610404">framesz</a></span><span class="op" id="1611531">)</span><span class="op" id="1611532">)</span><br>
<span class="lineno">770</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1611539">//&nbsp;drop&nbsp;finalizer&nbsp;queue&nbsp;references&nbsp;to&nbsp;finalized&nbsp;object</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611598"><a href="/gostd/runtime/malloc.go.html#1610312">f</a></span><span class="op" id="1611599">.</span><span class="ident" id="1611600"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795152">fn</a></span>&nbsp;<span class="op" id="1611603">=</span>&nbsp;<span class="builtintype" id="1611605">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611613"><a href="/gostd/runtime/malloc.go.html#1610312">f</a></span><span class="op" id="1611614">.</span><span class="ident" id="1611615"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795165">arg</a></span>&nbsp;<span class="op" id="1611619">=</span>&nbsp;<span class="builtintype" id="1611621">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611629"><a href="/gostd/runtime/malloc.go.html#1610312">f</a></span><span class="op" id="1611630">.</span><span class="ident" id="1611631"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795212">ot</a></span>&nbsp;<span class="op" id="1611634">=</span>&nbsp;<span class="builtintype" id="1611636">nil</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1611643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611648"><a href="/gostd/runtime/malloc.go.html#1609999">fb</a></span><span class="op" id="1611650">.</span><span class="ident" id="1611651"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795286">cnt</a></span>&nbsp;<span class="op" id="1611655">=</span>&nbsp;<span class="num" id="1611657">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611662">next</span>&nbsp;<span class="op" id="1611667">:=</span>&nbsp;<span class="ident" id="1611670"><a href="/gostd/runtime/malloc.go.html#1609999">fb</a></span><span class="op" id="1611672">.</span><span class="ident" id="1611673"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795270">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611681"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1611685">(</span><span class="op" id="1611686">&amp;</span><span class="ident" id="1611687"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795332">finlock</a></span><span class="op" id="1611694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611699"><a href="/gostd/runtime/malloc.go.html#1609999">fb</a></span><span class="op" id="1611701">.</span><span class="ident" id="1611702"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795270">next</a></span>&nbsp;<span class="op" id="1611707">=</span>&nbsp;<span class="ident" id="1611709"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795417">finc</a></span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611717"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795417">finc</a></span>&nbsp;<span class="op" id="1611722">=</span>&nbsp;<span class="ident" id="1611724"><a href="/gostd/runtime/malloc.go.html#1609999">fb</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611730"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1611736">(</span><span class="op" id="1611737">&amp;</span><span class="ident" id="1611738"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795332">finlock</a></span><span class="op" id="1611745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611750"><a href="/gostd/runtime/malloc.go.html#1609999">fb</a></span>&nbsp;<span class="op" id="1611753">=</span>&nbsp;<span class="ident" id="1611755"><a href="/gostd/runtime/malloc.go.html#1611662">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1611762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1611765">}</span><br>
<span class="lineno">785</span><span class="op" id="1611767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1611770">var</span>&nbsp;<span class="ident" id="1611774">persistent</span>&nbsp;<span class="keyword" id="1611785">struct</span>&nbsp;<span class="op" id="1611792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611795">lock</span>&nbsp;<span class="ident" id="1611800"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786208">mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611807">pos</span>&nbsp;&nbsp;<span class="ident" id="1611812"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1611818">.</span><span class="ident" id="1611819">Pointer</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611828">end</span>&nbsp;&nbsp;<span class="ident" id="1611833"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1611839">.</span><span class="ident" id="1611840">Pointer</span><br>
<span class="lineno"></span><span class="op" id="1611848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1611851">//&nbsp;Wrapper&nbsp;around&nbsp;sysAlloc&nbsp;that&nbsp;can&nbsp;allocate&nbsp;small&nbsp;chunks.</span><br>
<span class="lineno"></span><span class="comment" id="1611910">//&nbsp;There&nbsp;is&nbsp;no&nbsp;associated&nbsp;free&nbsp;operation.</span><br>
<span class="lineno">795</span><span class="comment" id="1611952">//&nbsp;Intended&nbsp;for&nbsp;things&nbsp;like&nbsp;function/type/debug-related&nbsp;persistent&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="1612025">//&nbsp;If&nbsp;align&nbsp;is&nbsp;0,&nbsp;uses&nbsp;default&nbsp;align&nbsp;(currently&nbsp;8).</span><br>
<span class="lineno"></span><span class="keyword" id="1612077">func</span>&nbsp;<span class="ident" id="1612082">persistentalloc</span><span class="op" id="1612097">(</span><span class="ident" id="1612098">size</span><span class="op" id="1612102">,</span>&nbsp;<span class="ident" id="1612104">align</span>&nbsp;<span class="builtintype" id="1612110">uintptr</span><span class="op" id="1612117">,</span>&nbsp;<span class="ident" id="1612119">stat</span>&nbsp;<span class="op" id="1612124">*</span><span class="builtintype" id="1612125">uint64</span><span class="op" id="1612131">)</span>&nbsp;<span class="ident" id="1612133"><a href="/gostd/runtime/malloc.go.html#1588812">unsafe</a></span><span class="op" id="1612139">.</span><span class="ident" id="1612140">Pointer</span>&nbsp;<span class="op" id="1612148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1612151">const</span>&nbsp;<span class="op" id="1612157">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612161">chunk</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1612170">=</span>&nbsp;<span class="num" id="1612172">256</span>&nbsp;<span class="op" id="1612176">&lt;&lt;</span>&nbsp;<span class="num" id="1612179">10</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612184">maxBlock</span>&nbsp;<span class="op" id="1612193">=</span>&nbsp;<span class="num" id="1612195">64</span>&nbsp;<span class="op" id="1612198">&lt;&lt;</span>&nbsp;<span class="num" id="1612201">10</span>&nbsp;<span class="comment" id="1612204">//&nbsp;VM&nbsp;reservation&nbsp;granularity&nbsp;is&nbsp;64K&nbsp;on&nbsp;windows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1612253">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1612257">if</span>&nbsp;<span class="ident" id="1612260"><a href="/gostd/runtime/malloc.go.html#1612104">align</a></span>&nbsp;<span class="op" id="1612266">!=</span>&nbsp;<span class="num" id="1612269">0</span>&nbsp;<span class="op" id="1612271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1612275">if</span>&nbsp;<span class="ident" id="1612278"><a href="/gostd/runtime/malloc.go.html#1612104">align</a></span><span class="op" id="1612283">&amp;</span><span class="op" id="1612284">(</span><span class="ident" id="1612285"><a href="/gostd/runtime/malloc.go.html#1612104">align</a></span><span class="op" id="1612290">-</span><span class="num" id="1612291">1</span><span class="op" id="1612292">)</span>&nbsp;<span class="op" id="1612294">!=</span>&nbsp;<span class="num" id="1612297">0</span>&nbsp;<span class="op" id="1612299">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612304"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1612311">(</span><span class="string" id="1612312">&#34;persistentalloc:&nbsp;align&nbsp;is&nbsp;not&nbsp;a&nbsp;power&nbsp;of&nbsp;2&#34;</span><span class="op" id="1612356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1612360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1612364">if</span>&nbsp;<span class="ident" id="1612367"><a href="/gostd/runtime/malloc.go.html#1612104">align</a></span>&nbsp;<span class="op" id="1612373">&gt;</span>&nbsp;<span class="ident" id="1612375"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1791881">_PageSize</a></span>&nbsp;<span class="op" id="1612385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612390"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1612397">(</span><span class="string" id="1612398">&#34;persistentalloc:&nbsp;align&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="1612435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1612439">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1612442">}</span>&nbsp;<span class="keyword" id="1612444">else</span>&nbsp;<span class="op" id="1612449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612453"><a href="/gostd/runtime/malloc.go.html#1612104">align</a></span>&nbsp;<span class="op" id="1612459">=</span>&nbsp;<span class="num" id="1612461">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1612464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1612468">if</span>&nbsp;<span class="ident" id="1612471"><a href="/gostd/runtime/malloc.go.html#1612098">size</a></span>&nbsp;<span class="op" id="1612476">&gt;=</span>&nbsp;<span class="ident" id="1612479"><a href="/gostd/runtime/malloc.go.html#1612184">maxBlock</a></span>&nbsp;<span class="op" id="1612488">{</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1612492">return</span>&nbsp;<span class="ident" id="1612499"><a href="/gostd/runtime/mprof.go.html#1624308">sysAlloc</a></span><span class="op" id="1612507">(</span><span class="ident" id="1612508"><a href="/gostd/runtime/malloc.go.html#1612098">size</a></span><span class="op" id="1612512">,</span>&nbsp;<span class="ident" id="1612514"><a href="/gostd/runtime/malloc.go.html#1612119">stat</a></span><span class="op" id="1612518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1612521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612525"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1612529">(</span><span class="op" id="1612530">&amp;</span><span class="ident" id="1612531"><a href="/gostd/runtime/malloc.go.html#1611774">persistent</a></span><span class="op" id="1612541">.</span><span class="ident" id="1612542"><a href="/gostd/runtime/malloc.go.html#1611795">lock</a></span><span class="op" id="1612546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612549"><a href="/gostd/runtime/malloc.go.html#1611774">persistent</a></span><span class="op" id="1612559">.</span><span class="ident" id="1612560"><a href="/gostd/runtime/malloc.go.html#1611807">pos</a></span>&nbsp;<span class="op" id="1612564">=</span>&nbsp;<span class="ident" id="1612566"><a href="/gostd/runtime/stubs.go.html#1738766">roundup</a></span><span class="op" id="1612573">(</span><span class="ident" id="1612574"><a href="/gostd/runtime/malloc.go.html#1611774">persistent</a></span><span class="op" id="1612584">.</span><span class="ident" id="1612585"><a href="/gostd/runtime/malloc.go.html#1611807">pos</a></span><span class="op" id="1612588">,</span>&nbsp;<span class="ident" id="1612590"><a href="/gostd/runtime/malloc.go.html#1612104">align</a></span><span class="op" id="1612595">)</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1612598">if</span>&nbsp;<span class="builtintype" id="1612601">uintptr</span><span class="op" id="1612608">(</span><span class="ident" id="1612609"><a href="/gostd/runtime/malloc.go.html#1611774">persistent</a></span><span class="op" id="1612619">.</span><span class="ident" id="1612620"><a href="/gostd/runtime/malloc.go.html#1611807">pos</a></span><span class="op" id="1612623">)</span><span class="op" id="1612624">+</span><span class="ident" id="1612625"><a href="/gostd/runtime/malloc.go.html#1612098">size</a></span>&nbsp;<span class="op" id="1612630">&gt;</span>&nbsp;<span class="builtintype" id="1612632">uintptr</span><span class="op" id="1612639">(</span><span class="ident" id="1612640"><a href="/gostd/runtime/malloc.go.html#1611774">persistent</a></span><span class="op" id="1612650">.</span><span class="ident" id="1612651"><a href="/gostd/runtime/malloc.go.html#1611828">end</a></span><span class="op" id="1612654">)</span>&nbsp;<span class="op" id="1612656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612660"><a href="/gostd/runtime/malloc.go.html#1611774">persistent</a></span><span class="op" id="1612670">.</span><span class="ident" id="1612671"><a href="/gostd/runtime/malloc.go.html#1611807">pos</a></span>&nbsp;<span class="op" id="1612675">=</span>&nbsp;<span class="ident" id="1612677"><a href="/gostd/runtime/mprof.go.html#1624308">sysAlloc</a></span><span class="op" id="1612685">(</span><span class="ident" id="1612686"><a href="/gostd/runtime/malloc.go.html#1612161">chunk</a></span><span class="op" id="1612691">,</span>&nbsp;<span class="op" id="1612693">&amp;</span><span class="ident" id="1612694"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793070">memstats</a></span><span class="op" id="1612702">.</span><span class="ident" id="1612703"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792858">other_sys</a></span><span class="op" id="1612712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1612716">if</span>&nbsp;<span class="ident" id="1612719"><a href="/gostd/runtime/malloc.go.html#1611774">persistent</a></span><span class="op" id="1612729">.</span><span class="ident" id="1612730"><a href="/gostd/runtime/malloc.go.html#1611807">pos</a></span>&nbsp;<span class="op" id="1612734">==</span>&nbsp;<span class="builtintype" id="1612737">nil</span>&nbsp;<span class="op" id="1612741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612746"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1612752">(</span><span class="op" id="1612753">&amp;</span><span class="ident" id="1612754"><a href="/gostd/runtime/malloc.go.html#1611774">persistent</a></span><span class="op" id="1612764">.</span><span class="ident" id="1612765"><a href="/gostd/runtime/malloc.go.html#1611795">lock</a></span><span class="op" id="1612769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612774"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1612781">(</span><span class="string" id="1612782">&#34;runtime:&nbsp;cannot&nbsp;allocate&nbsp;memory&#34;</span><span class="op" id="1612815">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1612819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612823"><a href="/gostd/runtime/malloc.go.html#1611774">persistent</a></span><span class="op" id="1612833">.</span><span class="ident" id="1612834"><a href="/gostd/runtime/malloc.go.html#1611828">end</a></span>&nbsp;<span class="op" id="1612838">=</span>&nbsp;<span class="ident" id="1612840"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1612843">(</span><span class="ident" id="1612844"><a href="/gostd/runtime/malloc.go.html#1611774">persistent</a></span><span class="op" id="1612854">.</span><span class="ident" id="1612855"><a href="/gostd/runtime/malloc.go.html#1611807">pos</a></span><span class="op" id="1612858">,</span>&nbsp;<span class="ident" id="1612860"><a href="/gostd/runtime/malloc.go.html#1612161">chunk</a></span><span class="op" id="1612865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1612868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612871">p</span>&nbsp;<span class="op" id="1612873">:=</span>&nbsp;<span class="ident" id="1612876"><a href="/gostd/runtime/malloc.go.html#1611774">persistent</a></span><span class="op" id="1612886">.</span><span class="ident" id="1612887"><a href="/gostd/runtime/malloc.go.html#1611807">pos</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612892"><a href="/gostd/runtime/malloc.go.html#1611774">persistent</a></span><span class="op" id="1612902">.</span><span class="ident" id="1612903"><a href="/gostd/runtime/malloc.go.html#1611807">pos</a></span>&nbsp;<span class="op" id="1612907">=</span>&nbsp;<span class="ident" id="1612909"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1612912">(</span><span class="ident" id="1612913"><a href="/gostd/runtime/malloc.go.html#1611774">persistent</a></span><span class="op" id="1612923">.</span><span class="ident" id="1612924"><a href="/gostd/runtime/malloc.go.html#1611807">pos</a></span><span class="op" id="1612927">,</span>&nbsp;<span class="ident" id="1612929"><a href="/gostd/runtime/malloc.go.html#1612098">size</a></span><span class="op" id="1612933">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612936"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1612942">(</span><span class="op" id="1612943">&amp;</span><span class="ident" id="1612944"><a href="/gostd/runtime/malloc.go.html#1611774">persistent</a></span><span class="op" id="1612954">.</span><span class="ident" id="1612955"><a href="/gostd/runtime/malloc.go.html#1611795">lock</a></span><span class="op" id="1612959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1612963">if</span>&nbsp;<span class="ident" id="1612966"><a href="/gostd/runtime/malloc.go.html#1612119">stat</a></span>&nbsp;<span class="op" id="1612971">!=</span>&nbsp;<span class="op" id="1612974">&amp;</span><span class="ident" id="1612975"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793070">memstats</a></span><span class="op" id="1612983">.</span><span class="ident" id="1612984"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792858">other_sys</a></span>&nbsp;<span class="op" id="1612994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612998"><a href="/gostd/runtime/atomic.go.html#1481006">xadd64</a></span><span class="op" id="1613004">(</span><span class="ident" id="1613005"><a href="/gostd/runtime/malloc.go.html#1612119">stat</a></span><span class="op" id="1613009">,</span>&nbsp;<span class="builtintype" id="1613011">int64</span><span class="op" id="1613016">(</span><span class="ident" id="1613017"><a href="/gostd/runtime/malloc.go.html#1612098">size</a></span><span class="op" id="1613021">)</span><span class="op" id="1613022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1613026"><a href="/gostd/runtime/atomic.go.html#1481006">xadd64</a></span><span class="op" id="1613032">(</span><span class="op" id="1613033">&amp;</span><span class="ident" id="1613034"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1793070">memstats</a></span><span class="op" id="1613042">.</span><span class="ident" id="1613043"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1792858">other_sys</a></span><span class="op" id="1613052">,</span>&nbsp;<span class="op" id="1613054">-</span><span class="builtintype" id="1613055">int64</span><span class="op" id="1613060">(</span><span class="ident" id="1613061"><a href="/gostd/runtime/malloc.go.html#1612098">size</a></span><span class="op" id="1613065">)</span><span class="op" id="1613066">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1613069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1613072">return</span>&nbsp;<span class="ident" id="1613079"><a href="/gostd/runtime/malloc.go.html#1612871">p</a></span><br>
<span class="lineno"></span><span class="op" id="1613081">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
