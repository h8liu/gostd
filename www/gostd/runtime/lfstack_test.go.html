<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="902645">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="902700">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="902754">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="902805">package</span>&nbsp;<span class="ident" id="902813">runtime_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="902827">import</span>&nbsp;<span class="op" id="902834">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="902837">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="902850">.</span>&nbsp;<span class="string" id="902852">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="902863">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="902874">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="902883">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="902886">type</span>&nbsp;<span class="ident" id="902891">MyNode</span>&nbsp;<span class="keyword" id="902898">struct</span>&nbsp;<span class="op" id="902905">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="902908">LFNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="902916">data</span>&nbsp;<span class="builtintype" id="902921">int</span><br>
<span class="lineno"></span><span class="op" id="902925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="902928">func</span>&nbsp;<span class="ident" id="902933">fromMyNode</span><span class="op" id="902943">(</span><span class="ident" id="902944">node</span>&nbsp;<span class="op" id="902949">*</span><span class="ident" id="902950">MyNode</span><span class="op" id="902956">)</span>&nbsp;<span class="op" id="902958">*</span><span class="ident" id="902959">LFNode</span>&nbsp;<span class="op" id="902966">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="902969">return</span>&nbsp;<span class="op" id="902976">(</span><span class="op" id="902977">*</span><span class="ident" id="902978">LFNode</span><span class="op" id="902984">)</span><span class="op" id="902985">(</span><span class="ident" id="902986">unsafe</span><span class="op" id="902992">.</span><span class="ident" id="902993">Pointer</span><span class="op" id="903000">(</span><span class="ident" id="903001">node</span><span class="op" id="903005">)</span><span class="op" id="903006">)</span><br>
<span class="lineno"></span><span class="op" id="903008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="903011">func</span>&nbsp;<span class="ident" id="903016">toMyNode</span><span class="op" id="903024">(</span><span class="ident" id="903025">node</span>&nbsp;<span class="op" id="903030">*</span><span class="ident" id="903031">LFNode</span><span class="op" id="903037">)</span>&nbsp;<span class="op" id="903039">*</span><span class="ident" id="903040">MyNode</span>&nbsp;<span class="op" id="903047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="903050">return</span>&nbsp;<span class="op" id="903057">(</span><span class="op" id="903058">*</span><span class="ident" id="903059">MyNode</span><span class="op" id="903065">)</span><span class="op" id="903066">(</span><span class="ident" id="903067">unsafe</span><span class="op" id="903073">.</span><span class="ident" id="903074">Pointer</span><span class="op" id="903081">(</span><span class="ident" id="903082">node</span><span class="op" id="903086">)</span><span class="op" id="903087">)</span><br>
<span class="lineno">25</span><span class="op" id="903089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="903092">func</span>&nbsp;<span class="ident" id="903097">TestLFStack</span><span class="op" id="903108">(</span><span class="ident" id="903109">t</span>&nbsp;<span class="op" id="903111">*</span><span class="ident" id="903112">testing</span><span class="op" id="903119">.</span><span class="ident" id="903120">T</span><span class="op" id="903121">)</span>&nbsp;<span class="op" id="903123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="903126">stack</span>&nbsp;<span class="op" id="903132">:=</span>&nbsp;<span class="builtinfunc" id="903135">new</span><span class="op" id="903138">(</span><span class="ident" id="903139">uint64</span><span class="op" id="903145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="903148">//&nbsp;Need&nbsp;to&nbsp;keep&nbsp;additional&nbsp;referenfces&nbsp;to&nbsp;nodes,&nbsp;the&nbsp;stack&nbsp;is&nbsp;not&nbsp;all&nbsp;that&nbsp;type-safe.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="903235">var</span>&nbsp;<span class="ident" id="903239">nodes</span>&nbsp;<span class="op" id="903245">[</span><span class="op" id="903246">]</span><span class="op" id="903247">*</span><span class="ident" id="903248">MyNode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="903257">//&nbsp;Check&nbsp;the&nbsp;stack&nbsp;is&nbsp;initially&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="903297">if</span>&nbsp;<span class="ident" id="903300">LFStackPop</span><span class="op" id="903310">(</span><span class="ident" id="903311">stack</span><span class="op" id="903316">)</span>&nbsp;<span class="op" id="903318">!=</span>&nbsp;<span class="ident" id="903321">nil</span>&nbsp;<span class="op" id="903325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="903329">t</span><span class="op" id="903330">.</span><span class="ident" id="903331">Fatalf</span><span class="op" id="903337">(</span><span class="string" id="903338">&#34;stack&nbsp;is&nbsp;not&nbsp;empty&#34;</span><span class="op" id="903358">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="903361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="903365">//&nbsp;Push&nbsp;one&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="903387">node</span>&nbsp;<span class="op" id="903392">:=</span>&nbsp;<span class="op" id="903395">&amp;</span><span class="ident" id="903396">MyNode</span><span class="op" id="903402">{</span><span class="ident" id="903403">data</span><span class="op" id="903407">:</span>&nbsp;<span class="num" id="903409">42</span><span class="op" id="903411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="903414">nodes</span>&nbsp;<span class="op" id="903420">=</span>&nbsp;<span class="builtinfunc" id="903422">append</span><span class="op" id="903428">(</span><span class="ident" id="903429">nodes</span><span class="op" id="903434">,</span>&nbsp;<span class="ident" id="903436">node</span><span class="op" id="903440">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="903443">LFStackPush</span><span class="op" id="903454">(</span><span class="ident" id="903455">stack</span><span class="op" id="903460">,</span>&nbsp;<span class="ident" id="903462">fromMyNode</span><span class="op" id="903472">(</span><span class="ident" id="903473">node</span><span class="op" id="903477">)</span><span class="op" id="903478">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="903482">//&nbsp;Push&nbsp;another.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="903500">node</span>&nbsp;<span class="op" id="903505">=</span>&nbsp;<span class="op" id="903507">&amp;</span><span class="ident" id="903508">MyNode</span><span class="op" id="903514">{</span><span class="ident" id="903515">data</span><span class="op" id="903519">:</span>&nbsp;<span class="num" id="903521">43</span><span class="op" id="903523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="903526">nodes</span>&nbsp;<span class="op" id="903532">=</span>&nbsp;<span class="builtinfunc" id="903534">append</span><span class="op" id="903540">(</span><span class="ident" id="903541">nodes</span><span class="op" id="903546">,</span>&nbsp;<span class="ident" id="903548">node</span><span class="op" id="903552">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="903555">LFStackPush</span><span class="op" id="903566">(</span><span class="ident" id="903567">stack</span><span class="op" id="903572">,</span>&nbsp;<span class="ident" id="903574">fromMyNode</span><span class="op" id="903584">(</span><span class="ident" id="903585">node</span><span class="op" id="903589">)</span><span class="op" id="903590">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="903594">//&nbsp;Pop&nbsp;one&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="903615">node</span>&nbsp;<span class="op" id="903620">=</span>&nbsp;<span class="ident" id="903622">toMyNode</span><span class="op" id="903630">(</span><span class="ident" id="903631">LFStackPop</span><span class="op" id="903641">(</span><span class="ident" id="903642">stack</span><span class="op" id="903647">)</span><span class="op" id="903648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="903651">if</span>&nbsp;<span class="ident" id="903654">node</span>&nbsp;<span class="op" id="903659">==</span>&nbsp;<span class="ident" id="903662">nil</span>&nbsp;<span class="op" id="903666">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="903670">t</span><span class="op" id="903671">.</span><span class="ident" id="903672">Fatalf</span><span class="op" id="903678">(</span><span class="string" id="903679">&#34;stack&nbsp;is&nbsp;empty&#34;</span><span class="op" id="903695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="903698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="903701">if</span>&nbsp;<span class="ident" id="903704">node</span><span class="op" id="903708">.</span><span class="ident" id="903709">data</span>&nbsp;<span class="op" id="903714">!=</span>&nbsp;<span class="num" id="903717">43</span>&nbsp;<span class="op" id="903720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="903724">t</span><span class="op" id="903725">.</span><span class="ident" id="903726">Fatalf</span><span class="op" id="903732">(</span><span class="string" id="903733">&#34;no&nbsp;lifo&#34;</span><span class="op" id="903742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="903745">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="903749">//&nbsp;Pop&nbsp;another.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="903766">node</span>&nbsp;<span class="op" id="903771">=</span>&nbsp;<span class="ident" id="903773">toMyNode</span><span class="op" id="903781">(</span><span class="ident" id="903782">LFStackPop</span><span class="op" id="903792">(</span><span class="ident" id="903793">stack</span><span class="op" id="903798">)</span><span class="op" id="903799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="903802">if</span>&nbsp;<span class="ident" id="903805">node</span>&nbsp;<span class="op" id="903810">==</span>&nbsp;<span class="ident" id="903813">nil</span>&nbsp;<span class="op" id="903817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="903821">t</span><span class="op" id="903822">.</span><span class="ident" id="903823">Fatalf</span><span class="op" id="903829">(</span><span class="string" id="903830">&#34;stack&nbsp;is&nbsp;empty&#34;</span><span class="op" id="903846">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="903849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="903852">if</span>&nbsp;<span class="ident" id="903855">node</span><span class="op" id="903859">.</span><span class="ident" id="903860">data</span>&nbsp;<span class="op" id="903865">!=</span>&nbsp;<span class="num" id="903868">42</span>&nbsp;<span class="op" id="903871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="903875">t</span><span class="op" id="903876">.</span><span class="ident" id="903877">Fatalf</span><span class="op" id="903883">(</span><span class="string" id="903884">&#34;no&nbsp;lifo&#34;</span><span class="op" id="903893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="903896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="903900">//&nbsp;Check&nbsp;the&nbsp;stack&nbsp;is&nbsp;empty&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="903936">if</span>&nbsp;<span class="ident" id="903939">LFStackPop</span><span class="op" id="903949">(</span><span class="ident" id="903950">stack</span><span class="op" id="903955">)</span>&nbsp;<span class="op" id="903957">!=</span>&nbsp;<span class="ident" id="903960">nil</span>&nbsp;<span class="op" id="903964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="903968">t</span><span class="op" id="903969">.</span><span class="ident" id="903970">Fatalf</span><span class="op" id="903976">(</span><span class="string" id="903977">&#34;stack&nbsp;is&nbsp;not&nbsp;empty&#34;</span><span class="op" id="903997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="904000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="904003">if</span>&nbsp;<span class="op" id="904006">*</span><span class="ident" id="904007">stack</span>&nbsp;<span class="op" id="904013">!=</span>&nbsp;<span class="num" id="904016">0</span>&nbsp;<span class="op" id="904018">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904022">t</span><span class="op" id="904023">.</span><span class="ident" id="904024">Fatalf</span><span class="op" id="904030">(</span><span class="string" id="904031">&#34;stack&nbsp;is&nbsp;not&nbsp;empty&#34;</span><span class="op" id="904051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="904054">}</span><br>
<span class="lineno"></span><span class="op" id="904056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="904059">var</span>&nbsp;<span class="ident" id="904063">stress</span>&nbsp;<span class="op" id="904070">[</span><span class="op" id="904071">]</span><span class="op" id="904072">*</span><span class="ident" id="904073">MyNode</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="904081">func</span>&nbsp;<span class="ident" id="904086">TestLFStackStress</span><span class="op" id="904103">(</span><span class="ident" id="904104">t</span>&nbsp;<span class="op" id="904106">*</span><span class="ident" id="904107">testing</span><span class="op" id="904114">.</span><span class="ident" id="904115">T</span><span class="op" id="904116">)</span>&nbsp;<span class="op" id="904118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="904121">const</span>&nbsp;<span class="ident" id="904127">K</span>&nbsp;<span class="op" id="904129">=</span>&nbsp;<span class="num" id="904131">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904136">P</span>&nbsp;<span class="op" id="904138">:=</span>&nbsp;<span class="num" id="904141">4</span>&nbsp;<span class="op" id="904143">*</span>&nbsp;<span class="ident" id="904145">GOMAXPROCS</span><span class="op" id="904155">(</span><span class="op" id="904156">-</span><span class="num" id="904157">1</span><span class="op" id="904158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904161">N</span>&nbsp;<span class="op" id="904163">:=</span>&nbsp;<span class="num" id="904166">100000</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="904174">if</span>&nbsp;<span class="ident" id="904177">testing</span><span class="op" id="904184">.</span><span class="ident" id="904185">Short</span><span class="op" id="904190">(</span><span class="op" id="904191">)</span>&nbsp;<span class="op" id="904193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904197">N</span>&nbsp;<span class="op" id="904199">/=</span>&nbsp;<span class="num" id="904202">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="904206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="904209">//&nbsp;Create&nbsp;2&nbsp;stacks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904230">stacks</span>&nbsp;<span class="op" id="904237">:=</span>&nbsp;<span class="op" id="904240">[</span><span class="num" id="904241">2</span><span class="op" id="904242">]</span><span class="op" id="904243">*</span><span class="ident" id="904244">uint64</span><span class="op" id="904250">{</span><span class="builtinfunc" id="904251">new</span><span class="op" id="904254">(</span><span class="ident" id="904255">uint64</span><span class="op" id="904261">)</span><span class="op" id="904262">,</span>&nbsp;<span class="builtinfunc" id="904264">new</span><span class="op" id="904267">(</span><span class="ident" id="904268">uint64</span><span class="op" id="904274">)</span><span class="op" id="904275">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="904278">//&nbsp;Need&nbsp;to&nbsp;keep&nbsp;additional&nbsp;references&nbsp;to&nbsp;nodes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="904327">//&nbsp;the&nbsp;lock-free&nbsp;stack&nbsp;is&nbsp;not&nbsp;type-safe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904369">stress</span>&nbsp;<span class="op" id="904376">=</span>&nbsp;<span class="ident" id="904378">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="904383">//&nbsp;Push&nbsp;K&nbsp;elements&nbsp;randomly&nbsp;onto&nbsp;the&nbsp;stacks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904429">sum</span>&nbsp;<span class="op" id="904433">:=</span>&nbsp;<span class="num" id="904436">0</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="904439">for</span>&nbsp;<span class="ident" id="904443">i</span>&nbsp;<span class="op" id="904445">:=</span>&nbsp;<span class="num" id="904448">0</span><span class="op" id="904449">;</span>&nbsp;<span class="ident" id="904451">i</span>&nbsp;<span class="op" id="904453">&lt;</span>&nbsp;<span class="ident" id="904455">K</span><span class="op" id="904456">;</span>&nbsp;<span class="ident" id="904458">i</span><span class="op" id="904459">++</span>&nbsp;<span class="op" id="904462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904466">sum</span>&nbsp;<span class="op" id="904470">+=</span>&nbsp;<span class="ident" id="904473">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904477">node</span>&nbsp;<span class="op" id="904482">:=</span>&nbsp;<span class="op" id="904485">&amp;</span><span class="ident" id="904486">MyNode</span><span class="op" id="904492">{</span><span class="ident" id="904493">data</span><span class="op" id="904497">:</span>&nbsp;<span class="ident" id="904499">i</span><span class="op" id="904500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904504">stress</span>&nbsp;<span class="op" id="904511">=</span>&nbsp;<span class="builtinfunc" id="904513">append</span><span class="op" id="904519">(</span><span class="ident" id="904520">stress</span><span class="op" id="904526">,</span>&nbsp;<span class="ident" id="904528">node</span><span class="op" id="904532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904536">LFStackPush</span><span class="op" id="904547">(</span><span class="ident" id="904548">stacks</span><span class="op" id="904554">[</span><span class="ident" id="904555">i</span><span class="op" id="904556">%</span><span class="num" id="904557">2</span><span class="op" id="904558">]</span><span class="op" id="904559">,</span>&nbsp;<span class="ident" id="904561">fromMyNode</span><span class="op" id="904571">(</span><span class="ident" id="904572">node</span><span class="op" id="904576">)</span><span class="op" id="904577">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="904580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904583">c</span>&nbsp;<span class="op" id="904585">:=</span>&nbsp;<span class="builtinfunc" id="904588">make</span><span class="op" id="904592">(</span><span class="keyword" id="904593">chan</span>&nbsp;<span class="builtintype" id="904598">bool</span><span class="op" id="904602">,</span>&nbsp;<span class="ident" id="904604">P</span><span class="op" id="904605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="904608">for</span>&nbsp;<span class="ident" id="904612">p</span>&nbsp;<span class="op" id="904614">:=</span>&nbsp;<span class="num" id="904617">0</span><span class="op" id="904618">;</span>&nbsp;<span class="ident" id="904620">p</span>&nbsp;<span class="op" id="904622">&lt;</span>&nbsp;<span class="ident" id="904624">P</span><span class="op" id="904625">;</span>&nbsp;<span class="ident" id="904627">p</span><span class="op" id="904628">++</span>&nbsp;<span class="op" id="904631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="904635">go</span>&nbsp;<span class="keyword" id="904638">func</span><span class="op" id="904642">(</span><span class="op" id="904643">)</span>&nbsp;<span class="op" id="904645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904650">r</span>&nbsp;<span class="op" id="904652">:=</span>&nbsp;<span class="ident" id="904655">rand</span><span class="op" id="904659">.</span><span class="ident" id="904660">New</span><span class="op" id="904663">(</span><span class="ident" id="904664">rand</span><span class="op" id="904668">.</span><span class="ident" id="904669">NewSource</span><span class="op" id="904678">(</span><span class="ident" id="904679">rand</span><span class="op" id="904683">.</span><span class="ident" id="904684">Int63</span><span class="op" id="904689">(</span><span class="op" id="904690">)</span><span class="op" id="904691">)</span><span class="op" id="904692">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="904697">//&nbsp;Pop&nbsp;a&nbsp;node&nbsp;from&nbsp;a&nbsp;random&nbsp;stack,&nbsp;then&nbsp;push&nbsp;it&nbsp;onto&nbsp;a&nbsp;random&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="904769">for</span>&nbsp;<span class="ident" id="904773">i</span>&nbsp;<span class="op" id="904775">:=</span>&nbsp;<span class="num" id="904778">0</span><span class="op" id="904779">;</span>&nbsp;<span class="ident" id="904781">i</span>&nbsp;<span class="op" id="904783">&lt;</span>&nbsp;<span class="ident" id="904785">N</span><span class="op" id="904786">;</span>&nbsp;<span class="ident" id="904788">i</span><span class="op" id="904789">++</span>&nbsp;<span class="op" id="904792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904798">node</span>&nbsp;<span class="op" id="904803">:=</span>&nbsp;<span class="ident" id="904806">toMyNode</span><span class="op" id="904814">(</span><span class="ident" id="904815">LFStackPop</span><span class="op" id="904825">(</span><span class="ident" id="904826">stacks</span><span class="op" id="904832">[</span><span class="ident" id="904833">r</span><span class="op" id="904834">.</span><span class="ident" id="904835">Intn</span><span class="op" id="904839">(</span><span class="num" id="904840">2</span><span class="op" id="904841">)</span><span class="op" id="904842">]</span><span class="op" id="904843">)</span><span class="op" id="904844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="904850">if</span>&nbsp;<span class="ident" id="904853">node</span>&nbsp;<span class="op" id="904858">!=</span>&nbsp;<span class="ident" id="904861">nil</span>&nbsp;<span class="op" id="904865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904872">LFStackPush</span><span class="op" id="904883">(</span><span class="ident" id="904884">stacks</span><span class="op" id="904890">[</span><span class="ident" id="904891">r</span><span class="op" id="904892">.</span><span class="ident" id="904893">Intn</span><span class="op" id="904897">(</span><span class="num" id="904898">2</span><span class="op" id="904899">)</span><span class="op" id="904900">]</span><span class="op" id="904901">,</span>&nbsp;<span class="ident" id="904903">fromMyNode</span><span class="op" id="904913">(</span><span class="ident" id="904914">node</span><span class="op" id="904918">)</span><span class="op" id="904919">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="904925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="904930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="904935">c</span>&nbsp;<span class="op" id="904937">&lt;-</span>&nbsp;<span class="builtintype" id="904940">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="904947">}</span><span class="op" id="904948">(</span><span class="op" id="904949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="904952">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="904955">for</span>&nbsp;<span class="ident" id="904959">i</span>&nbsp;<span class="op" id="904961">:=</span>&nbsp;<span class="num" id="904964">0</span><span class="op" id="904965">;</span>&nbsp;<span class="ident" id="904967">i</span>&nbsp;<span class="op" id="904969">&lt;</span>&nbsp;<span class="ident" id="904971">P</span><span class="op" id="904972">;</span>&nbsp;<span class="ident" id="904974">i</span><span class="op" id="904975">++</span>&nbsp;<span class="op" id="904978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="904982">&lt;-</span><span class="ident" id="904984">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="904987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="904990">//&nbsp;Pop&nbsp;all&nbsp;elements&nbsp;from&nbsp;both&nbsp;stacks,&nbsp;and&nbsp;verify&nbsp;that&nbsp;nothing&nbsp;lost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="905059">sum2</span>&nbsp;<span class="op" id="905064">:=</span>&nbsp;<span class="num" id="905067">0</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="905070">cnt</span>&nbsp;<span class="op" id="905074">:=</span>&nbsp;<span class="num" id="905077">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="905080">for</span>&nbsp;<span class="ident" id="905084">i</span>&nbsp;<span class="op" id="905086">:=</span>&nbsp;<span class="num" id="905089">0</span><span class="op" id="905090">;</span>&nbsp;<span class="ident" id="905092">i</span>&nbsp;<span class="op" id="905094">&lt;</span>&nbsp;<span class="num" id="905096">2</span><span class="op" id="905097">;</span>&nbsp;<span class="ident" id="905099">i</span><span class="op" id="905100">++</span>&nbsp;<span class="op" id="905103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="905107">for</span>&nbsp;<span class="op" id="905111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="905116">node</span>&nbsp;<span class="op" id="905121">:=</span>&nbsp;<span class="ident" id="905124">toMyNode</span><span class="op" id="905132">(</span><span class="ident" id="905133">LFStackPop</span><span class="op" id="905143">(</span><span class="ident" id="905144">stacks</span><span class="op" id="905150">[</span><span class="ident" id="905151">i</span><span class="op" id="905152">]</span><span class="op" id="905153">)</span><span class="op" id="905154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="905159">if</span>&nbsp;<span class="ident" id="905162">node</span>&nbsp;<span class="op" id="905167">==</span>&nbsp;<span class="ident" id="905170">nil</span>&nbsp;<span class="op" id="905174">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="905180">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="905189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="905194">cnt</span><span class="op" id="905197">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="905203">sum2</span>&nbsp;<span class="op" id="905208">+=</span>&nbsp;<span class="ident" id="905211">node</span><span class="op" id="905215">.</span><span class="ident" id="905216">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="905224">node</span><span class="op" id="905228">.</span><span class="ident" id="905229">Next</span>&nbsp;<span class="op" id="905234">=</span>&nbsp;<span class="ident" id="905236">nil</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="905242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="905245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="905248">if</span>&nbsp;<span class="ident" id="905251">cnt</span>&nbsp;<span class="op" id="905255">!=</span>&nbsp;<span class="ident" id="905258">K</span>&nbsp;<span class="op" id="905260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="905264">t</span><span class="op" id="905265">.</span><span class="ident" id="905266">Fatalf</span><span class="op" id="905272">(</span><span class="string" id="905273">&#34;Wrong&nbsp;number&nbsp;of&nbsp;nodes&nbsp;%d/%d&#34;</span><span class="op" id="905302">,</span>&nbsp;<span class="ident" id="905304">cnt</span><span class="op" id="905307">,</span>&nbsp;<span class="ident" id="905309">K</span><span class="op" id="905310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="905313">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="905316">if</span>&nbsp;<span class="ident" id="905319">sum2</span>&nbsp;<span class="op" id="905324">!=</span>&nbsp;<span class="ident" id="905327">sum</span>&nbsp;<span class="op" id="905331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="905335">t</span><span class="op" id="905336">.</span><span class="ident" id="905337">Fatalf</span><span class="op" id="905343">(</span><span class="string" id="905344">&#34;Wrong&nbsp;sum&nbsp;%d/%d&#34;</span><span class="op" id="905361">,</span>&nbsp;<span class="ident" id="905363">sum2</span><span class="op" id="905367">,</span>&nbsp;<span class="ident" id="905369">sum</span><span class="op" id="905372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="905375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="905379">//&nbsp;Let&nbsp;nodes&nbsp;be&nbsp;collected&nbsp;now.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="905411">stress</span>&nbsp;<span class="op" id="905418">=</span>&nbsp;<span class="ident" id="905420">nil</span><br>
<span class="lineno"></span><span class="op" id="905424">}</span>
</div>
</body>
</html>
