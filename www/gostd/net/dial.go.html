<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3224000">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3224056">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3224110">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3224161">package</span>&nbsp;<span class="ident" id="3224169">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3224174">import</span>&nbsp;<span class="op" id="3224181">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3224184">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3224194">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3224201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3224204">//&nbsp;A&nbsp;Dialer&nbsp;contains&nbsp;options&nbsp;for&nbsp;connecting&nbsp;to&nbsp;an&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3224263">//</span><br>
<span class="lineno"></span><span class="comment" id="3224266">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;each&nbsp;field&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;dialing</span><br>
<span class="lineno">15</span><span class="comment" id="3224324">//&nbsp;without&nbsp;that&nbsp;option.&nbsp;Dialing&nbsp;with&nbsp;the&nbsp;zero&nbsp;value&nbsp;of&nbsp;Dialer</span><br>
<span class="lineno"></span><span class="comment" id="3224386">//&nbsp;is&nbsp;therefore&nbsp;equivalent&nbsp;to&nbsp;just&nbsp;calling&nbsp;the&nbsp;Dial&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3224448">type</span>&nbsp;<span class="ident" id="3224453">Dialer</span>&nbsp;<span class="keyword" id="3224460">struct</span>&nbsp;<span class="op" id="3224467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3224470">//&nbsp;Timeout&nbsp;is&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;a&nbsp;dial&nbsp;will&nbsp;wait&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3224533">//&nbsp;a&nbsp;connect&nbsp;to&nbsp;complete.&nbsp;If&nbsp;Deadline&nbsp;is&nbsp;also&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3224597">//&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3224610">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3224614">//&nbsp;The&nbsp;default&nbsp;is&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3224645">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3224649">//&nbsp;With&nbsp;or&nbsp;without&nbsp;a&nbsp;timeout,&nbsp;the&nbsp;operating&nbsp;system&nbsp;may&nbsp;impose</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3224712">//&nbsp;its&nbsp;own&nbsp;earlier&nbsp;timeout.&nbsp;For&nbsp;instance,&nbsp;TCP&nbsp;timeouts&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3224772">//&nbsp;often&nbsp;around&nbsp;3&nbsp;minutes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3224800">Timeout</span>&nbsp;<span class="ident" id="3224808">time</span><span class="op" id="3224812">.</span><span class="ident" id="3224813">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3224824">//&nbsp;Deadline&nbsp;is&nbsp;the&nbsp;absolute&nbsp;point&nbsp;in&nbsp;time&nbsp;after&nbsp;which&nbsp;dials</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3224885">//&nbsp;will&nbsp;fail.&nbsp;If&nbsp;Timeout&nbsp;is&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3224940">//&nbsp;Zero&nbsp;means&nbsp;no&nbsp;deadline,&nbsp;or&nbsp;dependent&nbsp;on&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3225005">//&nbsp;as&nbsp;with&nbsp;the&nbsp;Timeout&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3225037">Deadline</span>&nbsp;<span class="ident" id="3225046">time</span><span class="op" id="3225050">.</span><span class="ident" id="3225051">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3225058">//&nbsp;LocalAddr&nbsp;is&nbsp;the&nbsp;local&nbsp;address&nbsp;to&nbsp;use&nbsp;when&nbsp;dialing&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3225116">//&nbsp;address.&nbsp;The&nbsp;address&nbsp;must&nbsp;be&nbsp;of&nbsp;a&nbsp;compatible&nbsp;type&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3225178">//&nbsp;network&nbsp;being&nbsp;dialed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3225204">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;local&nbsp;address&nbsp;is&nbsp;automatically&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3225257">LocalAddr</span>&nbsp;<span class="ident" id="3225267">Addr</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3225274">//&nbsp;DualStack&nbsp;allows&nbsp;a&nbsp;single&nbsp;dial&nbsp;to&nbsp;attempt&nbsp;to&nbsp;establish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3225333">//&nbsp;multiple&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections&nbsp;and&nbsp;to&nbsp;return&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3225396">//&nbsp;established&nbsp;connection&nbsp;when&nbsp;the&nbsp;network&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3225457">//&nbsp;destination&nbsp;is&nbsp;a&nbsp;host&nbsp;name&nbsp;that&nbsp;has&nbsp;multiple&nbsp;address&nbsp;family</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3225521">//&nbsp;DNS&nbsp;records.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3225538">DualStack</span>&nbsp;<span class="builtintype" id="3225548">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3225555">//&nbsp;KeepAlive&nbsp;specifies&nbsp;the&nbsp;keep-alive&nbsp;period&nbsp;for&nbsp;an&nbsp;active</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3225615">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3225639">//&nbsp;If&nbsp;zero,&nbsp;keep-alives&nbsp;are&nbsp;not&nbsp;enabled.&nbsp;Network&nbsp;protocols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3225699">//&nbsp;that&nbsp;do&nbsp;not&nbsp;support&nbsp;keep-alives&nbsp;ignore&nbsp;this&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3225754">KeepAlive</span>&nbsp;<span class="ident" id="3225764">time</span><span class="op" id="3225768">.</span><span class="ident" id="3225769">Duration</span><br>
<span class="lineno"></span><span class="op" id="3225778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3225781">//&nbsp;Return&nbsp;either&nbsp;now+Timeout&nbsp;or&nbsp;Deadline,&nbsp;whichever&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="3225846">//&nbsp;Or&nbsp;zero,&nbsp;if&nbsp;neither&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3225877">func</span>&nbsp;<span class="op" id="3225882">(</span><span class="ident" id="3225883">d</span>&nbsp;<span class="op" id="3225885">*</span><span class="ident" id="3225886">Dialer</span><span class="op" id="3225892">)</span>&nbsp;<span class="ident" id="3225894">deadline</span><span class="op" id="3225902">(</span><span class="op" id="3225903">)</span>&nbsp;<span class="ident" id="3225905">time</span><span class="op" id="3225909">.</span><span class="ident" id="3225910">Time</span>&nbsp;<span class="op" id="3225915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225918">if</span>&nbsp;<span class="ident" id="3225921">d</span><span class="op" id="3225922">.</span><span class="ident" id="3225923">Timeout</span>&nbsp;<span class="op" id="3225931">==</span>&nbsp;<span class="num" id="3225934">0</span>&nbsp;<span class="op" id="3225936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225940">return</span>&nbsp;<span class="ident" id="3225947">d</span><span class="op" id="3225948">.</span><span class="ident" id="3225949">Deadline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3225959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3225962">timeoutDeadline</span>&nbsp;<span class="op" id="3225978">:=</span>&nbsp;<span class="ident" id="3225981">time</span><span class="op" id="3225985">.</span><span class="ident" id="3225986">Now</span><span class="op" id="3225989">(</span><span class="op" id="3225990">)</span><span class="op" id="3225991">.</span><span class="ident" id="3225992">Add</span><span class="op" id="3225995">(</span><span class="ident" id="3225996">d</span><span class="op" id="3225997">.</span><span class="ident" id="3225998">Timeout</span><span class="op" id="3226005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226008">if</span>&nbsp;<span class="ident" id="3226011">d</span><span class="op" id="3226012">.</span><span class="ident" id="3226013">Deadline</span><span class="op" id="3226021">.</span><span class="ident" id="3226022">IsZero</span><span class="op" id="3226028">(</span><span class="op" id="3226029">)</span>&nbsp;<span class="op" id="3226031">||</span>&nbsp;<span class="ident" id="3226034">timeoutDeadline</span><span class="op" id="3226049">.</span><span class="ident" id="3226050">Before</span><span class="op" id="3226056">(</span><span class="ident" id="3226057">d</span><span class="op" id="3226058">.</span><span class="ident" id="3226059">Deadline</span><span class="op" id="3226067">)</span>&nbsp;<span class="op" id="3226069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226073">return</span>&nbsp;<span class="ident" id="3226080">timeoutDeadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3226097">}</span>&nbsp;<span class="keyword" id="3226099">else</span>&nbsp;<span class="op" id="3226104">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226108">return</span>&nbsp;<span class="ident" id="3226115">d</span><span class="op" id="3226116">.</span><span class="ident" id="3226117">Deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3226127">}</span><br>
<span class="lineno"></span><span class="op" id="3226129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3226132">func</span>&nbsp;<span class="ident" id="3226137">parseNetwork</span><span class="op" id="3226149">(</span><span class="ident" id="3226150">net</span>&nbsp;<span class="builtintype" id="3226154">string</span><span class="op" id="3226160">)</span>&nbsp;<span class="op" id="3226162">(</span><span class="ident" id="3226163">afnet</span>&nbsp;<span class="builtintype" id="3226169">string</span><span class="op" id="3226175">,</span>&nbsp;<span class="ident" id="3226177">proto</span>&nbsp;<span class="builtintype" id="3226183">int</span><span class="op" id="3226186">,</span>&nbsp;<span class="ident" id="3226188">err</span>&nbsp;<span class="builtintype" id="3226192">error</span><span class="op" id="3226197">)</span>&nbsp;<span class="op" id="3226199">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226202">i</span>&nbsp;<span class="op" id="3226204">:=</span>&nbsp;<span class="ident" id="3226207">last</span><span class="op" id="3226211">(</span><span class="ident" id="3226212">net</span><span class="op" id="3226215">,</span>&nbsp;<span class="string" id="3226217">&#39;:&#39;</span><span class="op" id="3226220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226223">if</span>&nbsp;<span class="ident" id="3226226">i</span>&nbsp;<span class="op" id="3226228">&lt;</span>&nbsp;<span class="num" id="3226230">0</span>&nbsp;<span class="op" id="3226232">{</span>&nbsp;<span class="comment" id="3226234">//&nbsp;no&nbsp;colon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226248">switch</span>&nbsp;<span class="ident" id="3226255">net</span>&nbsp;<span class="op" id="3226259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226263">case</span>&nbsp;<span class="string" id="3226268">&#34;tcp&#34;</span><span class="op" id="3226273">,</span>&nbsp;<span class="string" id="3226275">&#34;tcp4&#34;</span><span class="op" id="3226281">,</span>&nbsp;<span class="string" id="3226283">&#34;tcp6&#34;</span><span class="op" id="3226289">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226293">case</span>&nbsp;<span class="string" id="3226298">&#34;udp&#34;</span><span class="op" id="3226303">,</span>&nbsp;<span class="string" id="3226305">&#34;udp4&#34;</span><span class="op" id="3226311">,</span>&nbsp;<span class="string" id="3226313">&#34;udp6&#34;</span><span class="op" id="3226319">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226323">case</span>&nbsp;<span class="string" id="3226328">&#34;ip&#34;</span><span class="op" id="3226332">,</span>&nbsp;<span class="string" id="3226334">&#34;ip4&#34;</span><span class="op" id="3226339">,</span>&nbsp;<span class="string" id="3226341">&#34;ip6&#34;</span><span class="op" id="3226346">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226350">case</span>&nbsp;<span class="string" id="3226355">&#34;unix&#34;</span><span class="op" id="3226361">,</span>&nbsp;<span class="string" id="3226363">&#34;unixgram&#34;</span><span class="op" id="3226373">,</span>&nbsp;<span class="string" id="3226375">&#34;unixpacket&#34;</span><span class="op" id="3226387">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226391">default</span><span class="op" id="3226398">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226403">return</span>&nbsp;<span class="string" id="3226410">&#34;&#34;</span><span class="op" id="3226412">,</span>&nbsp;<span class="num" id="3226414">0</span><span class="op" id="3226415">,</span>&nbsp;<span class="ident" id="3226417">UnknownNetworkError</span><span class="op" id="3226436">(</span><span class="ident" id="3226437">net</span><span class="op" id="3226440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3226444">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226448">return</span>&nbsp;<span class="ident" id="3226455">net</span><span class="op" id="3226458">,</span>&nbsp;<span class="num" id="3226460">0</span><span class="op" id="3226461">,</span>&nbsp;<span class="ident" id="3226463">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3226468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226471">afnet</span>&nbsp;<span class="op" id="3226477">=</span>&nbsp;<span class="ident" id="3226479">net</span><span class="op" id="3226482">[</span><span class="op" id="3226483">:</span><span class="ident" id="3226484">i</span><span class="op" id="3226485">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226488">switch</span>&nbsp;<span class="ident" id="3226495">afnet</span>&nbsp;<span class="op" id="3226501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226504">case</span>&nbsp;<span class="string" id="3226509">&#34;ip&#34;</span><span class="op" id="3226513">,</span>&nbsp;<span class="string" id="3226515">&#34;ip4&#34;</span><span class="op" id="3226520">,</span>&nbsp;<span class="string" id="3226522">&#34;ip6&#34;</span><span class="op" id="3226527">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226531">protostr</span>&nbsp;<span class="op" id="3226540">:=</span>&nbsp;<span class="ident" id="3226543">net</span><span class="op" id="3226546">[</span><span class="ident" id="3226547">i</span><span class="op" id="3226548">+</span><span class="num" id="3226549">1</span><span class="op" id="3226550">:</span><span class="op" id="3226551">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226555">proto</span><span class="op" id="3226560">,</span>&nbsp;<span class="ident" id="3226562">i</span><span class="op" id="3226563">,</span>&nbsp;<span class="ident" id="3226565">ok</span>&nbsp;<span class="op" id="3226568">:=</span>&nbsp;<span class="ident" id="3226571">dtoi</span><span class="op" id="3226575">(</span><span class="ident" id="3226576">protostr</span><span class="op" id="3226584">,</span>&nbsp;<span class="num" id="3226586">0</span><span class="op" id="3226587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226591">if</span>&nbsp;<span class="op" id="3226594">!</span><span class="ident" id="3226595">ok</span>&nbsp;<span class="op" id="3226598">||</span>&nbsp;<span class="ident" id="3226601">i</span>&nbsp;<span class="op" id="3226603">!=</span>&nbsp;<span class="builtinfunc" id="3226606">len</span><span class="op" id="3226609">(</span><span class="ident" id="3226610">protostr</span><span class="op" id="3226618">)</span>&nbsp;<span class="op" id="3226620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226625">proto</span><span class="op" id="3226630">,</span>&nbsp;<span class="ident" id="3226632">err</span>&nbsp;<span class="op" id="3226636">=</span>&nbsp;<span class="ident" id="3226638">lookupProtocol</span><span class="op" id="3226652">(</span><span class="ident" id="3226653">protostr</span><span class="op" id="3226661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226666">if</span>&nbsp;<span class="ident" id="3226669">err</span>&nbsp;<span class="op" id="3226673">!=</span>&nbsp;<span class="ident" id="3226676">nil</span>&nbsp;<span class="op" id="3226680">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226686">return</span>&nbsp;<span class="string" id="3226693">&#34;&#34;</span><span class="op" id="3226695">,</span>&nbsp;<span class="num" id="3226697">0</span><span class="op" id="3226698">,</span>&nbsp;<span class="ident" id="3226700">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3226707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3226711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226715">return</span>&nbsp;<span class="ident" id="3226722">afnet</span><span class="op" id="3226727">,</span>&nbsp;<span class="ident" id="3226729">proto</span><span class="op" id="3226734">,</span>&nbsp;<span class="ident" id="3226736">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3226741">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226744">return</span>&nbsp;<span class="string" id="3226751">&#34;&#34;</span><span class="op" id="3226753">,</span>&nbsp;<span class="num" id="3226755">0</span><span class="op" id="3226756">,</span>&nbsp;<span class="ident" id="3226758">UnknownNetworkError</span><span class="op" id="3226777">(</span><span class="ident" id="3226778">net</span><span class="op" id="3226781">)</span><br>
<span class="lineno"></span><span class="op" id="3226783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3226786">func</span>&nbsp;<span class="ident" id="3226791">resolveAddr</span><span class="op" id="3226802">(</span><span class="ident" id="3226803">op</span><span class="op" id="3226805">,</span>&nbsp;<span class="ident" id="3226807">net</span><span class="op" id="3226810">,</span>&nbsp;<span class="ident" id="3226812">addr</span>&nbsp;<span class="builtintype" id="3226817">string</span><span class="op" id="3226823">,</span>&nbsp;<span class="ident" id="3226825">deadline</span>&nbsp;<span class="ident" id="3226834">time</span><span class="op" id="3226838">.</span><span class="ident" id="3226839">Time</span><span class="op" id="3226843">)</span>&nbsp;<span class="op" id="3226845">(</span><span class="ident" id="3226846">netaddr</span><span class="op" id="3226853">,</span>&nbsp;<span class="builtintype" id="3226855">error</span><span class="op" id="3226860">)</span>&nbsp;<span class="op" id="3226862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3226865">afnet</span><span class="op" id="3226870">,</span>&nbsp;<span class="ident" id="3226872">_</span><span class="op" id="3226873">,</span>&nbsp;<span class="ident" id="3226875">err</span>&nbsp;<span class="op" id="3226879">:=</span>&nbsp;<span class="ident" id="3226882">parseNetwork</span><span class="op" id="3226894">(</span><span class="ident" id="3226895">net</span><span class="op" id="3226898">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226901">if</span>&nbsp;<span class="ident" id="3226904">err</span>&nbsp;<span class="op" id="3226908">!=</span>&nbsp;<span class="ident" id="3226911">nil</span>&nbsp;<span class="op" id="3226915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226919">return</span>&nbsp;<span class="ident" id="3226926">nil</span><span class="op" id="3226929">,</span>&nbsp;<span class="ident" id="3226931">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3226936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226939">if</span>&nbsp;<span class="ident" id="3226942">op</span>&nbsp;<span class="op" id="3226945">==</span>&nbsp;<span class="string" id="3226948">&#34;dial&#34;</span>&nbsp;<span class="op" id="3226955">&amp;&amp;</span>&nbsp;<span class="ident" id="3226958">addr</span>&nbsp;<span class="op" id="3226963">==</span>&nbsp;<span class="string" id="3226966">&#34;&#34;</span>&nbsp;<span class="op" id="3226969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3226973">return</span>&nbsp;<span class="ident" id="3226980">nil</span><span class="op" id="3226983">,</span>&nbsp;<span class="ident" id="3226985">errMissingAddress</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227007">switch</span>&nbsp;<span class="ident" id="3227014">afnet</span>&nbsp;<span class="op" id="3227020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227023">case</span>&nbsp;<span class="string" id="3227028">&#34;unix&#34;</span><span class="op" id="3227034">,</span>&nbsp;<span class="string" id="3227036">&#34;unixgram&#34;</span><span class="op" id="3227046">,</span>&nbsp;<span class="string" id="3227048">&#34;unixpacket&#34;</span><span class="op" id="3227060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227064">return</span>&nbsp;<span class="ident" id="3227071">ResolveUnixAddr</span><span class="op" id="3227086">(</span><span class="ident" id="3227087">afnet</span><span class="op" id="3227092">,</span>&nbsp;<span class="ident" id="3227094">addr</span><span class="op" id="3227098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3227101">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3227104">return</span>&nbsp;<span class="ident" id="3227111">resolveInternetAddr</span><span class="op" id="3227130">(</span><span class="ident" id="3227131">afnet</span><span class="op" id="3227136">,</span>&nbsp;<span class="ident" id="3227138">addr</span><span class="op" id="3227142">,</span>&nbsp;<span class="ident" id="3227144">deadline</span><span class="op" id="3227152">)</span><br>
<span class="lineno"></span><span class="op" id="3227154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3227157">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3227211">//</span><br>
<span class="lineno">115</span><span class="comment" id="3227214">//&nbsp;Known&nbsp;networks&nbsp;are&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;tcp6&#34;&nbsp;(IPv6-only),</span><br>
<span class="lineno"></span><span class="comment" id="3227283">//&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;udp6&#34;&nbsp;(IPv6-only),&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3227345">//&nbsp;(IPv4-only),&nbsp;&#34;ip6&#34;&nbsp;(IPv6-only),&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3227403">//&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3227420">//</span><br>
<span class="lineno">120</span><span class="comment" id="3227423">//&nbsp;For&nbsp;TCP&nbsp;and&nbsp;UDP&nbsp;networks,&nbsp;addresses&nbsp;have&nbsp;the&nbsp;form&nbsp;host:port.</span><br>
<span class="lineno"></span><span class="comment" id="3227487">//&nbsp;If&nbsp;host&nbsp;is&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;it&nbsp;must&nbsp;be&nbsp;enclosed</span><br>
<span class="lineno"></span><span class="comment" id="3227544">//&nbsp;in&nbsp;square&nbsp;brackets&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3227609">//&nbsp;The&nbsp;functions&nbsp;JoinHostPort&nbsp;and&nbsp;SplitHostPort&nbsp;manipulate&nbsp;addresses</span><br>
<span class="lineno"></span><span class="comment" id="3227678">//&nbsp;in&nbsp;this&nbsp;form.</span><br>
<span class="lineno">125</span><span class="comment" id="3227695">//</span><br>
<span class="lineno"></span><span class="comment" id="3227698">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3227711">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;12.34.56.78:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3227744">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;google.com:http&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3227778">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[2001:db8::1]:http&#34;)</span><br>
<span class="lineno">130</span><span class="comment" id="3227815">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[fe80::1%lo0]:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3227850">//</span><br>
<span class="lineno"></span><span class="comment" id="3227853">//&nbsp;For&nbsp;IP&nbsp;networks,&nbsp;the&nbsp;network&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="3227923">//&nbsp;by&nbsp;a&nbsp;colon&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name&nbsp;and&nbsp;the&nbsp;addr&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3227990">//&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="3228013">//</span><br>
<span class="lineno"></span><span class="comment" id="3228016">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3228029">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip4:1&#34;,&nbsp;&#34;127.0.0.1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3228059">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip6:ospf&#34;,&nbsp;&#34;::1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3228086">//</span><br>
<span class="lineno">140</span><span class="comment" id="3228089">//&nbsp;For&nbsp;Unix&nbsp;networks,&nbsp;the&nbsp;address&nbsp;must&nbsp;be&nbsp;a&nbsp;file&nbsp;system&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="3228151">func</span>&nbsp;<span class="ident" id="3228156">Dial</span><span class="op" id="3228160">(</span><span class="ident" id="3228161">network</span><span class="op" id="3228168">,</span>&nbsp;<span class="ident" id="3228170">address</span>&nbsp;<span class="builtintype" id="3228178">string</span><span class="op" id="3228184">)</span>&nbsp;<span class="op" id="3228186">(</span><span class="ident" id="3228187">Conn</span><span class="op" id="3228191">,</span>&nbsp;<span class="builtintype" id="3228193">error</span><span class="op" id="3228198">)</span>&nbsp;<span class="op" id="3228200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228203">var</span>&nbsp;<span class="ident" id="3228207">d</span>&nbsp;<span class="ident" id="3228209">Dialer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228217">return</span>&nbsp;<span class="ident" id="3228224">d</span><span class="op" id="3228225">.</span><span class="ident" id="3228226">Dial</span><span class="op" id="3228230">(</span><span class="ident" id="3228231">network</span><span class="op" id="3228238">,</span>&nbsp;<span class="ident" id="3228240">address</span><span class="op" id="3228247">)</span><br>
<span class="lineno"></span><span class="op" id="3228249">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="3228252">//&nbsp;DialTimeout&nbsp;acts&nbsp;like&nbsp;Dial&nbsp;but&nbsp;takes&nbsp;a&nbsp;timeout.</span><br>
<span class="lineno"></span><span class="comment" id="3228303">//&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;name&nbsp;resolution,&nbsp;if&nbsp;required.</span><br>
<span class="lineno"></span><span class="keyword" id="3228357">func</span>&nbsp;<span class="ident" id="3228362">DialTimeout</span><span class="op" id="3228373">(</span><span class="ident" id="3228374">network</span><span class="op" id="3228381">,</span>&nbsp;<span class="ident" id="3228383">address</span>&nbsp;<span class="builtintype" id="3228391">string</span><span class="op" id="3228397">,</span>&nbsp;<span class="ident" id="3228399">timeout</span>&nbsp;<span class="ident" id="3228407">time</span><span class="op" id="3228411">.</span><span class="ident" id="3228412">Duration</span><span class="op" id="3228420">)</span>&nbsp;<span class="op" id="3228422">(</span><span class="ident" id="3228423">Conn</span><span class="op" id="3228427">,</span>&nbsp;<span class="builtintype" id="3228429">error</span><span class="op" id="3228434">)</span>&nbsp;<span class="op" id="3228436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3228439">d</span>&nbsp;<span class="op" id="3228441">:=</span>&nbsp;<span class="ident" id="3228444">Dialer</span><span class="op" id="3228450">{</span><span class="ident" id="3228451">Timeout</span><span class="op" id="3228458">:</span>&nbsp;<span class="ident" id="3228460">timeout</span><span class="op" id="3228467">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228470">return</span>&nbsp;<span class="ident" id="3228477">d</span><span class="op" id="3228478">.</span><span class="ident" id="3228479">Dial</span><span class="op" id="3228483">(</span><span class="ident" id="3228484">network</span><span class="op" id="3228491">,</span>&nbsp;<span class="ident" id="3228493">address</span><span class="op" id="3228500">)</span><br>
<span class="lineno"></span><span class="op" id="3228502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3228505">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3228559">//</span><br>
<span class="lineno">155</span><span class="comment" id="3228562">//&nbsp;See&nbsp;func&nbsp;Dial&nbsp;for&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;network&nbsp;and&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3228624">//&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="3228639">func</span>&nbsp;<span class="op" id="3228644">(</span><span class="ident" id="3228645">d</span>&nbsp;<span class="op" id="3228647">*</span><span class="ident" id="3228648">Dialer</span><span class="op" id="3228654">)</span>&nbsp;<span class="ident" id="3228656">Dial</span><span class="op" id="3228660">(</span><span class="ident" id="3228661">network</span><span class="op" id="3228668">,</span>&nbsp;<span class="ident" id="3228670">address</span>&nbsp;<span class="builtintype" id="3228678">string</span><span class="op" id="3228684">)</span>&nbsp;<span class="op" id="3228686">(</span><span class="ident" id="3228687">Conn</span><span class="op" id="3228691">,</span>&nbsp;<span class="builtintype" id="3228693">error</span><span class="op" id="3228698">)</span>&nbsp;<span class="op" id="3228700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3228703">ra</span><span class="op" id="3228705">,</span>&nbsp;<span class="ident" id="3228707">err</span>&nbsp;<span class="op" id="3228711">:=</span>&nbsp;<span class="ident" id="3228714">resolveAddr</span><span class="op" id="3228725">(</span><span class="string" id="3228726">&#34;dial&#34;</span><span class="op" id="3228732">,</span>&nbsp;<span class="ident" id="3228734">network</span><span class="op" id="3228741">,</span>&nbsp;<span class="ident" id="3228743">address</span><span class="op" id="3228750">,</span>&nbsp;<span class="ident" id="3228752">d</span><span class="op" id="3228753">.</span><span class="ident" id="3228754">deadline</span><span class="op" id="3228762">(</span><span class="op" id="3228763">)</span><span class="op" id="3228764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228767">if</span>&nbsp;<span class="ident" id="3228770">err</span>&nbsp;<span class="op" id="3228774">!=</span>&nbsp;<span class="ident" id="3228777">nil</span>&nbsp;<span class="op" id="3228781">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228785">return</span>&nbsp;<span class="ident" id="3228792">nil</span><span class="op" id="3228795">,</span>&nbsp;<span class="op" id="3228797">&amp;</span><span class="ident" id="3228798">OpError</span><span class="op" id="3228805">{</span><span class="ident" id="3228806">Op</span><span class="op" id="3228808">:</span>&nbsp;<span class="string" id="3228810">&#34;dial&#34;</span><span class="op" id="3228816">,</span>&nbsp;<span class="ident" id="3228818">Net</span><span class="op" id="3228821">:</span>&nbsp;<span class="ident" id="3228823">network</span><span class="op" id="3228830">,</span>&nbsp;<span class="ident" id="3228832">Addr</span><span class="op" id="3228836">:</span>&nbsp;<span class="ident" id="3228838">nil</span><span class="op" id="3228841">,</span>&nbsp;<span class="ident" id="3228843">Err</span><span class="op" id="3228846">:</span>&nbsp;<span class="ident" id="3228848">err</span><span class="op" id="3228851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3228854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3228857">dialer</span>&nbsp;<span class="op" id="3228864">:=</span>&nbsp;<span class="keyword" id="3228867">func</span><span class="op" id="3228871">(</span><span class="ident" id="3228872">deadline</span>&nbsp;<span class="ident" id="3228881">time</span><span class="op" id="3228885">.</span><span class="ident" id="3228886">Time</span><span class="op" id="3228890">)</span>&nbsp;<span class="op" id="3228892">(</span><span class="ident" id="3228893">Conn</span><span class="op" id="3228897">,</span>&nbsp;<span class="builtintype" id="3228899">error</span><span class="op" id="3228904">)</span>&nbsp;<span class="op" id="3228906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228910">return</span>&nbsp;<span class="ident" id="3228917">dialSingle</span><span class="op" id="3228927">(</span><span class="ident" id="3228928">network</span><span class="op" id="3228935">,</span>&nbsp;<span class="ident" id="3228937">address</span><span class="op" id="3228944">,</span>&nbsp;<span class="ident" id="3228946">d</span><span class="op" id="3228947">.</span><span class="ident" id="3228948">LocalAddr</span><span class="op" id="3228957">,</span>&nbsp;<span class="ident" id="3228959">ra</span><span class="op" id="3228961">.</span><span class="ident" id="3228962">toAddr</span><span class="op" id="3228968">(</span><span class="op" id="3228969">)</span><span class="op" id="3228970">,</span>&nbsp;<span class="ident" id="3228972">deadline</span><span class="op" id="3228980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3228983">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3228986">if</span>&nbsp;<span class="ident" id="3228989">ras</span><span class="op" id="3228992">,</span>&nbsp;<span class="ident" id="3228994">ok</span>&nbsp;<span class="op" id="3228997">:=</span>&nbsp;<span class="ident" id="3229000">ra</span><span class="op" id="3229002">.</span><span class="op" id="3229003">(</span><span class="ident" id="3229004">addrList</span><span class="op" id="3229012">)</span><span class="op" id="3229013">;</span>&nbsp;<span class="ident" id="3229015">ok</span>&nbsp;<span class="op" id="3229018">&amp;&amp;</span>&nbsp;<span class="ident" id="3229021">d</span><span class="op" id="3229022">.</span><span class="ident" id="3229023">DualStack</span>&nbsp;<span class="op" id="3229033">&amp;&amp;</span>&nbsp;<span class="ident" id="3229036">network</span>&nbsp;<span class="op" id="3229044">==</span>&nbsp;<span class="string" id="3229047">&#34;tcp&#34;</span>&nbsp;<span class="op" id="3229053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3229057">dialer</span>&nbsp;<span class="op" id="3229064">=</span>&nbsp;<span class="keyword" id="3229066">func</span><span class="op" id="3229070">(</span><span class="ident" id="3229071">deadline</span>&nbsp;<span class="ident" id="3229080">time</span><span class="op" id="3229084">.</span><span class="ident" id="3229085">Time</span><span class="op" id="3229089">)</span>&nbsp;<span class="op" id="3229091">(</span><span class="ident" id="3229092">Conn</span><span class="op" id="3229096">,</span>&nbsp;<span class="builtintype" id="3229098">error</span><span class="op" id="3229103">)</span>&nbsp;<span class="op" id="3229105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229110">return</span>&nbsp;<span class="ident" id="3229117">dialMulti</span><span class="op" id="3229126">(</span><span class="ident" id="3229127">network</span><span class="op" id="3229134">,</span>&nbsp;<span class="ident" id="3229136">address</span><span class="op" id="3229143">,</span>&nbsp;<span class="ident" id="3229145">d</span><span class="op" id="3229146">.</span><span class="ident" id="3229147">LocalAddr</span><span class="op" id="3229156">,</span>&nbsp;<span class="ident" id="3229158">ras</span><span class="op" id="3229161">,</span>&nbsp;<span class="ident" id="3229163">deadline</span><span class="op" id="3229171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229178">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3229181">c</span><span class="op" id="3229182">,</span>&nbsp;<span class="ident" id="3229184">err</span>&nbsp;<span class="op" id="3229188">:=</span>&nbsp;<span class="ident" id="3229191">dial</span><span class="op" id="3229195">(</span><span class="ident" id="3229196">network</span><span class="op" id="3229203">,</span>&nbsp;<span class="ident" id="3229205">ra</span><span class="op" id="3229207">.</span><span class="ident" id="3229208">toAddr</span><span class="op" id="3229214">(</span><span class="op" id="3229215">)</span><span class="op" id="3229216">,</span>&nbsp;<span class="ident" id="3229218">dialer</span><span class="op" id="3229224">,</span>&nbsp;<span class="ident" id="3229226">d</span><span class="op" id="3229227">.</span><span class="ident" id="3229228">deadline</span><span class="op" id="3229236">(</span><span class="op" id="3229237">)</span><span class="op" id="3229238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229241">if</span>&nbsp;<span class="ident" id="3229244">d</span><span class="op" id="3229245">.</span><span class="ident" id="3229246">KeepAlive</span>&nbsp;<span class="op" id="3229256">&gt;</span>&nbsp;<span class="num" id="3229258">0</span>&nbsp;<span class="op" id="3229260">&amp;&amp;</span>&nbsp;<span class="ident" id="3229263">err</span>&nbsp;<span class="op" id="3229267">==</span>&nbsp;<span class="ident" id="3229270">nil</span>&nbsp;<span class="op" id="3229274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229278">if</span>&nbsp;<span class="ident" id="3229281">tc</span><span class="op" id="3229283">,</span>&nbsp;<span class="ident" id="3229285">ok</span>&nbsp;<span class="op" id="3229288">:=</span>&nbsp;<span class="ident" id="3229291">c</span><span class="op" id="3229292">.</span><span class="op" id="3229293">(</span><span class="op" id="3229294">*</span><span class="ident" id="3229295">TCPConn</span><span class="op" id="3229302">)</span><span class="op" id="3229303">;</span>&nbsp;<span class="ident" id="3229305">ok</span>&nbsp;<span class="op" id="3229308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3229313">tc</span><span class="op" id="3229315">.</span><span class="ident" id="3229316">SetKeepAlive</span><span class="op" id="3229328">(</span><span class="builtintype" id="3229329">true</span><span class="op" id="3229333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3229338">tc</span><span class="op" id="3229340">.</span><span class="ident" id="3229341">SetKeepAlivePeriod</span><span class="op" id="3229359">(</span><span class="ident" id="3229360">d</span><span class="op" id="3229361">.</span><span class="ident" id="3229362">KeepAlive</span><span class="op" id="3229371">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3229376">testHookSetKeepAlive</span><span class="op" id="3229396">(</span><span class="op" id="3229397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229407">return</span>&nbsp;<span class="ident" id="3229414">c</span><span class="op" id="3229415">,</span>&nbsp;<span class="ident" id="3229417">err</span><br>
<span class="lineno"></span><span class="op" id="3229421">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="3229424">var</span>&nbsp;<span class="ident" id="3229428">testHookSetKeepAlive</span>&nbsp;<span class="op" id="3229449">=</span>&nbsp;<span class="keyword" id="3229451">func</span><span class="op" id="3229455">(</span><span class="op" id="3229456">)</span>&nbsp;<span class="op" id="3229458">{</span><span class="op" id="3229459">}</span>&nbsp;<span class="comment" id="3229461">//&nbsp;changed&nbsp;by&nbsp;dial_test.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3229489">//&nbsp;dialMulti&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;connections&nbsp;to&nbsp;each&nbsp;destination&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3229559">//&nbsp;the&nbsp;list&nbsp;of&nbsp;addresses.&nbsp;It&nbsp;will&nbsp;return&nbsp;the&nbsp;first&nbsp;established</span><br>
<span class="lineno">185</span><span class="comment" id="3229622">//&nbsp;connection&nbsp;and&nbsp;close&nbsp;the&nbsp;other&nbsp;connections.&nbsp;Otherwise&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3229690">//&nbsp;error&nbsp;on&nbsp;the&nbsp;last&nbsp;attempt.</span><br>
<span class="lineno"></span><span class="keyword" id="3229720">func</span>&nbsp;<span class="ident" id="3229725">dialMulti</span><span class="op" id="3229734">(</span><span class="ident" id="3229735">net</span><span class="op" id="3229738">,</span>&nbsp;<span class="ident" id="3229740">addr</span>&nbsp;<span class="builtintype" id="3229745">string</span><span class="op" id="3229751">,</span>&nbsp;<span class="ident" id="3229753">la</span>&nbsp;<span class="ident" id="3229756">Addr</span><span class="op" id="3229760">,</span>&nbsp;<span class="ident" id="3229762">ras</span>&nbsp;<span class="ident" id="3229766">addrList</span><span class="op" id="3229774">,</span>&nbsp;<span class="ident" id="3229776">deadline</span>&nbsp;<span class="ident" id="3229785">time</span><span class="op" id="3229789">.</span><span class="ident" id="3229790">Time</span><span class="op" id="3229794">)</span>&nbsp;<span class="op" id="3229796">(</span><span class="ident" id="3229797">Conn</span><span class="op" id="3229801">,</span>&nbsp;<span class="builtintype" id="3229803">error</span><span class="op" id="3229808">)</span>&nbsp;<span class="op" id="3229810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3229813">type</span>&nbsp;<span class="ident" id="3229818">racer</span>&nbsp;<span class="keyword" id="3229824">struct</span>&nbsp;<span class="op" id="3229831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3229835">Conn</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3229842">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3229849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3229852">//&nbsp;Sig&nbsp;controls&nbsp;the&nbsp;flow&nbsp;of&nbsp;dial&nbsp;results&nbsp;on&nbsp;lane.&nbsp;It&nbsp;passes&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3229915">//&nbsp;token&nbsp;to&nbsp;the&nbsp;next&nbsp;racer&nbsp;and&nbsp;also&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;flow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3229978">//&nbsp;by&nbsp;using&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230007">sig</span>&nbsp;<span class="op" id="3230011">:=</span>&nbsp;<span class="builtinfunc" id="3230014">make</span><span class="op" id="3230018">(</span><span class="keyword" id="3230019">chan</span>&nbsp;<span class="builtintype" id="3230024">bool</span><span class="op" id="3230028">,</span>&nbsp;<span class="num" id="3230030">1</span><span class="op" id="3230031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230034">lane</span>&nbsp;<span class="op" id="3230039">:=</span>&nbsp;<span class="builtinfunc" id="3230042">make</span><span class="op" id="3230046">(</span><span class="keyword" id="3230047">chan</span>&nbsp;<span class="ident" id="3230052">racer</span><span class="op" id="3230057">,</span>&nbsp;<span class="num" id="3230059">1</span><span class="op" id="3230060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230063">for</span>&nbsp;<span class="ident" id="3230067">_</span><span class="op" id="3230068">,</span>&nbsp;<span class="ident" id="3230070">ra</span>&nbsp;<span class="op" id="3230073">:=</span>&nbsp;<span class="keyword" id="3230076">range</span>&nbsp;<span class="ident" id="3230082">ras</span>&nbsp;<span class="op" id="3230086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230090">go</span>&nbsp;<span class="keyword" id="3230093">func</span><span class="op" id="3230097">(</span><span class="ident" id="3230098">ra</span>&nbsp;<span class="ident" id="3230101">Addr</span><span class="op" id="3230105">)</span>&nbsp;<span class="op" id="3230107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230112">c</span><span class="op" id="3230113">,</span>&nbsp;<span class="ident" id="3230115">err</span>&nbsp;<span class="op" id="3230119">:=</span>&nbsp;<span class="ident" id="3230122">dialSingle</span><span class="op" id="3230132">(</span><span class="ident" id="3230133">net</span><span class="op" id="3230136">,</span>&nbsp;<span class="ident" id="3230138">addr</span><span class="op" id="3230142">,</span>&nbsp;<span class="ident" id="3230144">la</span><span class="op" id="3230146">,</span>&nbsp;<span class="ident" id="3230148">ra</span><span class="op" id="3230150">,</span>&nbsp;<span class="ident" id="3230152">deadline</span><span class="op" id="3230160">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230165">if</span>&nbsp;<span class="ident" id="3230168">_</span><span class="op" id="3230169">,</span>&nbsp;<span class="ident" id="3230171">ok</span>&nbsp;<span class="op" id="3230174">:=</span>&nbsp;<span class="op" id="3230177">&lt;-</span><span class="ident" id="3230179">sig</span><span class="op" id="3230182">;</span>&nbsp;<span class="ident" id="3230184">ok</span>&nbsp;<span class="op" id="3230187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230193">lane</span>&nbsp;<span class="op" id="3230198">&lt;-</span>&nbsp;<span class="ident" id="3230201">racer</span><span class="op" id="3230206">{</span><span class="ident" id="3230207">c</span><span class="op" id="3230208">,</span>&nbsp;<span class="ident" id="3230210">err</span><span class="op" id="3230213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230218">}</span>&nbsp;<span class="keyword" id="3230220">else</span>&nbsp;<span class="keyword" id="3230225">if</span>&nbsp;<span class="ident" id="3230228">err</span>&nbsp;<span class="op" id="3230232">==</span>&nbsp;<span class="ident" id="3230235">nil</span>&nbsp;<span class="op" id="3230239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3230245">//&nbsp;We&nbsp;have&nbsp;to&nbsp;return&nbsp;the&nbsp;resources</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3230284">//&nbsp;that&nbsp;belong&nbsp;to&nbsp;the&nbsp;other</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3230316">//&nbsp;connections&nbsp;here&nbsp;for&nbsp;avoiding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3230353">//&nbsp;unnecessary&nbsp;resource&nbsp;starvation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230393">c</span><span class="op" id="3230394">.</span><span class="ident" id="3230395">Close</span><span class="op" id="3230400">(</span><span class="op" id="3230401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230410">}</span><span class="op" id="3230411">(</span><span class="ident" id="3230412">ra</span><span class="op" id="3230414">.</span><span class="ident" id="3230415">toAddr</span><span class="op" id="3230421">(</span><span class="op" id="3230422">)</span><span class="op" id="3230423">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230429">defer</span>&nbsp;<span class="builtinfunc" id="3230435">close</span><span class="op" id="3230440">(</span><span class="ident" id="3230441">sig</span><span class="op" id="3230444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230447">lastErr</span>&nbsp;<span class="op" id="3230455">:=</span>&nbsp;<span class="ident" id="3230458">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230470">nracers</span>&nbsp;<span class="op" id="3230478">:=</span>&nbsp;<span class="builtinfunc" id="3230481">len</span><span class="op" id="3230484">(</span><span class="ident" id="3230485">ras</span><span class="op" id="3230488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230491">for</span>&nbsp;<span class="ident" id="3230495">nracers</span>&nbsp;<span class="op" id="3230503">&gt;</span>&nbsp;<span class="num" id="3230505">0</span>&nbsp;<span class="op" id="3230507">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230511">sig</span>&nbsp;<span class="op" id="3230515">&lt;-</span>&nbsp;<span class="builtintype" id="3230518">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230525">racer</span>&nbsp;<span class="op" id="3230531">:=</span>&nbsp;<span class="op" id="3230534">&lt;-</span><span class="ident" id="3230536">lane</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230543">if</span>&nbsp;<span class="ident" id="3230546">racer</span><span class="op" id="3230551">.</span><span class="builtintype" id="3230552">error</span>&nbsp;<span class="op" id="3230558">==</span>&nbsp;<span class="ident" id="3230561">nil</span>&nbsp;<span class="op" id="3230565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230570">return</span>&nbsp;<span class="ident" id="3230577">racer</span><span class="op" id="3230582">.</span><span class="ident" id="3230583">Conn</span><span class="op" id="3230587">,</span>&nbsp;<span class="ident" id="3230589">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230595">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230599">lastErr</span>&nbsp;<span class="op" id="3230607">=</span>&nbsp;<span class="ident" id="3230609">racer</span><span class="op" id="3230614">.</span><span class="builtintype" id="3230615">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3230623">nracers</span><span class="op" id="3230630">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3230634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230637">return</span>&nbsp;<span class="ident" id="3230644">nil</span><span class="op" id="3230647">,</span>&nbsp;<span class="ident" id="3230649">lastErr</span><br>
<span class="lineno"></span><span class="op" id="3230657">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3230660">//&nbsp;dialSingle&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;connection&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3230731">//&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3230759">func</span>&nbsp;<span class="ident" id="3230764">dialSingle</span><span class="op" id="3230774">(</span><span class="ident" id="3230775">net</span><span class="op" id="3230778">,</span>&nbsp;<span class="ident" id="3230780">addr</span>&nbsp;<span class="builtintype" id="3230785">string</span><span class="op" id="3230791">,</span>&nbsp;<span class="ident" id="3230793">la</span><span class="op" id="3230795">,</span>&nbsp;<span class="ident" id="3230797">ra</span>&nbsp;<span class="ident" id="3230800">Addr</span><span class="op" id="3230804">,</span>&nbsp;<span class="ident" id="3230806">deadline</span>&nbsp;<span class="ident" id="3230815">time</span><span class="op" id="3230819">.</span><span class="ident" id="3230820">Time</span><span class="op" id="3230824">)</span>&nbsp;<span class="op" id="3230826">(</span><span class="ident" id="3230827">c</span>&nbsp;<span class="ident" id="3230829">Conn</span><span class="op" id="3230833">,</span>&nbsp;<span class="ident" id="3230835">err</span>&nbsp;<span class="builtintype" id="3230839">error</span><span class="op" id="3230844">)</span>&nbsp;<span class="op" id="3230846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230849">if</span>&nbsp;<span class="ident" id="3230852">la</span>&nbsp;<span class="op" id="3230855">!=</span>&nbsp;<span class="ident" id="3230858">nil</span>&nbsp;<span class="op" id="3230862">&amp;&amp;</span>&nbsp;<span class="ident" id="3230865">la</span><span class="op" id="3230867">.</span><span class="ident" id="3230868">Network</span><span class="op" id="3230875">(</span><span class="op" id="3230876">)</span>&nbsp;<span class="op" id="3230878">!=</span>&nbsp;<span class="ident" id="3230881">ra</span><span class="op" id="3230883">.</span><span class="ident" id="3230884">Network</span><span class="op" id="3230891">(</span><span class="op" id="3230892">)</span>&nbsp;<span class="op" id="3230894">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3230898">return</span>&nbsp;<span class="ident" id="3230905">nil</span><span class="op" id="3230908">,</span>&nbsp;<span class="op" id="3230910">&amp;</span><span class="ident" id="3230911">OpError</span><span class="op" id="3230918">{</span><span class="ident" id="3230919">Op</span><span class="op" id="3230921">:</span>&nbsp;<span class="string" id="3230923">&#34;dial&#34;</span><span class="op" id="3230929">,</span>&nbsp;<span class="ident" id="3230931">Net</span><span class="op" id="3230934">:</span>&nbsp;<span class="ident" id="3230936">net</span><span class="op" id="3230939">,</span>&nbsp;<span class="ident" id="3230941">Addr</span><span class="op" id="3230945">:</span>&nbsp;<span class="ident" id="3230947">ra</span><span class="op" id="3230949">,</span>&nbsp;<span class="ident" id="3230951">Err</span><span class="op" id="3230954">:</span>&nbsp;<span class="ident" id="3230956">errors</span><span class="op" id="3230962">.</span><span class="ident" id="3230963">New</span><span class="op" id="3230966">(</span><span class="string" id="3230967">&#34;mismatched&nbsp;local&nbsp;address&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3231000">+</span>&nbsp;<span class="ident" id="3231002">la</span><span class="op" id="3231004">.</span><span class="ident" id="3231005">Network</span><span class="op" id="3231012">(</span><span class="op" id="3231013">)</span><span class="op" id="3231014">)</span><span class="op" id="3231015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3231018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231021">switch</span>&nbsp;<span class="ident" id="3231028">ra</span>&nbsp;<span class="op" id="3231031">:=</span>&nbsp;<span class="ident" id="3231034">ra</span><span class="op" id="3231036">.</span><span class="op" id="3231037">(</span><span class="keyword" id="3231038">type</span><span class="op" id="3231042">)</span>&nbsp;<span class="op" id="3231044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231047">case</span>&nbsp;<span class="op" id="3231052">*</span><span class="ident" id="3231053">TCPAddr</span><span class="op" id="3231060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231064">la</span><span class="op" id="3231066">,</span>&nbsp;<span class="ident" id="3231068">_</span>&nbsp;<span class="op" id="3231070">:=</span>&nbsp;<span class="ident" id="3231073">la</span><span class="op" id="3231075">.</span><span class="op" id="3231076">(</span><span class="op" id="3231077">*</span><span class="ident" id="3231078">TCPAddr</span><span class="op" id="3231085">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231089">c</span><span class="op" id="3231090">,</span>&nbsp;<span class="ident" id="3231092">err</span>&nbsp;<span class="op" id="3231096">=</span>&nbsp;<span class="ident" id="3231098">dialTCP</span><span class="op" id="3231105">(</span><span class="ident" id="3231106">net</span><span class="op" id="3231109">,</span>&nbsp;<span class="ident" id="3231111">la</span><span class="op" id="3231113">,</span>&nbsp;<span class="ident" id="3231115">ra</span><span class="op" id="3231117">,</span>&nbsp;<span class="ident" id="3231119">deadline</span><span class="op" id="3231127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231130">case</span>&nbsp;<span class="op" id="3231135">*</span><span class="ident" id="3231136">UDPAddr</span><span class="op" id="3231143">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231147">la</span><span class="op" id="3231149">,</span>&nbsp;<span class="ident" id="3231151">_</span>&nbsp;<span class="op" id="3231153">:=</span>&nbsp;<span class="ident" id="3231156">la</span><span class="op" id="3231158">.</span><span class="op" id="3231159">(</span><span class="op" id="3231160">*</span><span class="ident" id="3231161">UDPAddr</span><span class="op" id="3231168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231172">c</span><span class="op" id="3231173">,</span>&nbsp;<span class="ident" id="3231175">err</span>&nbsp;<span class="op" id="3231179">=</span>&nbsp;<span class="ident" id="3231181">dialUDP</span><span class="op" id="3231188">(</span><span class="ident" id="3231189">net</span><span class="op" id="3231192">,</span>&nbsp;<span class="ident" id="3231194">la</span><span class="op" id="3231196">,</span>&nbsp;<span class="ident" id="3231198">ra</span><span class="op" id="3231200">,</span>&nbsp;<span class="ident" id="3231202">deadline</span><span class="op" id="3231210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231213">case</span>&nbsp;<span class="op" id="3231218">*</span><span class="ident" id="3231219">IPAddr</span><span class="op" id="3231225">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231229">la</span><span class="op" id="3231231">,</span>&nbsp;<span class="ident" id="3231233">_</span>&nbsp;<span class="op" id="3231235">:=</span>&nbsp;<span class="ident" id="3231238">la</span><span class="op" id="3231240">.</span><span class="op" id="3231241">(</span><span class="op" id="3231242">*</span><span class="ident" id="3231243">IPAddr</span><span class="op" id="3231249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231253">c</span><span class="op" id="3231254">,</span>&nbsp;<span class="ident" id="3231256">err</span>&nbsp;<span class="op" id="3231260">=</span>&nbsp;<span class="ident" id="3231262">dialIP</span><span class="op" id="3231268">(</span><span class="ident" id="3231269">net</span><span class="op" id="3231272">,</span>&nbsp;<span class="ident" id="3231274">la</span><span class="op" id="3231276">,</span>&nbsp;<span class="ident" id="3231278">ra</span><span class="op" id="3231280">,</span>&nbsp;<span class="ident" id="3231282">deadline</span><span class="op" id="3231290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231293">case</span>&nbsp;<span class="op" id="3231298">*</span><span class="ident" id="3231299">UnixAddr</span><span class="op" id="3231307">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231311">la</span><span class="op" id="3231313">,</span>&nbsp;<span class="ident" id="3231315">_</span>&nbsp;<span class="op" id="3231317">:=</span>&nbsp;<span class="ident" id="3231320">la</span><span class="op" id="3231322">.</span><span class="op" id="3231323">(</span><span class="op" id="3231324">*</span><span class="ident" id="3231325">UnixAddr</span><span class="op" id="3231333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231337">c</span><span class="op" id="3231338">,</span>&nbsp;<span class="ident" id="3231340">err</span>&nbsp;<span class="op" id="3231344">=</span>&nbsp;<span class="ident" id="3231346">dialUnix</span><span class="op" id="3231354">(</span><span class="ident" id="3231355">net</span><span class="op" id="3231358">,</span>&nbsp;<span class="ident" id="3231360">la</span><span class="op" id="3231362">,</span>&nbsp;<span class="ident" id="3231364">ra</span><span class="op" id="3231366">,</span>&nbsp;<span class="ident" id="3231368">deadline</span><span class="op" id="3231376">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231379">default</span><span class="op" id="3231386">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231390">return</span>&nbsp;<span class="ident" id="3231397">nil</span><span class="op" id="3231400">,</span>&nbsp;<span class="op" id="3231402">&amp;</span><span class="ident" id="3231403">OpError</span><span class="op" id="3231410">{</span><span class="ident" id="3231411">Op</span><span class="op" id="3231413">:</span>&nbsp;<span class="string" id="3231415">&#34;dial&#34;</span><span class="op" id="3231421">,</span>&nbsp;<span class="ident" id="3231423">Net</span><span class="op" id="3231426">:</span>&nbsp;<span class="ident" id="3231428">net</span><span class="op" id="3231431">,</span>&nbsp;<span class="ident" id="3231433">Addr</span><span class="op" id="3231437">:</span>&nbsp;<span class="ident" id="3231439">ra</span><span class="op" id="3231441">,</span>&nbsp;<span class="ident" id="3231443">Err</span><span class="op" id="3231446">:</span>&nbsp;<span class="op" id="3231448">&amp;</span><span class="ident" id="3231449">AddrError</span><span class="op" id="3231458">{</span><span class="ident" id="3231459">Err</span><span class="op" id="3231462">:</span>&nbsp;<span class="string" id="3231464">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3231489">,</span>&nbsp;<span class="ident" id="3231491">Addr</span><span class="op" id="3231495">:</span>&nbsp;<span class="ident" id="3231497">addr</span><span class="op" id="3231501">}</span><span class="op" id="3231502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3231505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231508">if</span>&nbsp;<span class="ident" id="3231511">err</span>&nbsp;<span class="op" id="3231515">!=</span>&nbsp;<span class="ident" id="3231518">nil</span>&nbsp;<span class="op" id="3231522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231526">return</span>&nbsp;<span class="ident" id="3231533">nil</span><span class="op" id="3231536">,</span>&nbsp;<span class="ident" id="3231538">err</span>&nbsp;<span class="comment" id="3231542">//&nbsp;c&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3231592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231595">return</span>&nbsp;<span class="ident" id="3231602">c</span><span class="op" id="3231603">,</span>&nbsp;<span class="ident" id="3231605">nil</span><br>
<span class="lineno"></span><span class="op" id="3231609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3231612">//&nbsp;Listen&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno">255</span><span class="comment" id="3231668">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;stream-oriented&nbsp;network:&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3231737">//&nbsp;&#34;tcp6&#34;,&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3231772">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3231809">func</span>&nbsp;<span class="ident" id="3231814">Listen</span><span class="op" id="3231820">(</span><span class="ident" id="3231821">net</span><span class="op" id="3231824">,</span>&nbsp;<span class="ident" id="3231826">laddr</span>&nbsp;<span class="builtintype" id="3231832">string</span><span class="op" id="3231838">)</span>&nbsp;<span class="op" id="3231840">(</span><span class="ident" id="3231841">Listener</span><span class="op" id="3231849">,</span>&nbsp;<span class="builtintype" id="3231851">error</span><span class="op" id="3231856">)</span>&nbsp;<span class="op" id="3231858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3231861">la</span><span class="op" id="3231863">,</span>&nbsp;<span class="ident" id="3231865">err</span>&nbsp;<span class="op" id="3231869">:=</span>&nbsp;<span class="ident" id="3231872">resolveAddr</span><span class="op" id="3231883">(</span><span class="string" id="3231884">&#34;listen&#34;</span><span class="op" id="3231892">,</span>&nbsp;<span class="ident" id="3231894">net</span><span class="op" id="3231897">,</span>&nbsp;<span class="ident" id="3231899">laddr</span><span class="op" id="3231904">,</span>&nbsp;<span class="ident" id="3231906">noDeadline</span><span class="op" id="3231916">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231919">if</span>&nbsp;<span class="ident" id="3231922">err</span>&nbsp;<span class="op" id="3231926">!=</span>&nbsp;<span class="ident" id="3231929">nil</span>&nbsp;<span class="op" id="3231933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3231937">return</span>&nbsp;<span class="ident" id="3231944">nil</span><span class="op" id="3231947">,</span>&nbsp;<span class="op" id="3231949">&amp;</span><span class="ident" id="3231950">OpError</span><span class="op" id="3231957">{</span><span class="ident" id="3231958">Op</span><span class="op" id="3231960">:</span>&nbsp;<span class="string" id="3231962">&#34;listen&#34;</span><span class="op" id="3231970">,</span>&nbsp;<span class="ident" id="3231972">Net</span><span class="op" id="3231975">:</span>&nbsp;<span class="ident" id="3231977">net</span><span class="op" id="3231980">,</span>&nbsp;<span class="ident" id="3231982">Addr</span><span class="op" id="3231986">:</span>&nbsp;<span class="ident" id="3231988">nil</span><span class="op" id="3231991">,</span>&nbsp;<span class="ident" id="3231993">Err</span><span class="op" id="3231996">:</span>&nbsp;<span class="ident" id="3231998">err</span><span class="op" id="3232001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3232004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232007">var</span>&nbsp;<span class="ident" id="3232011">l</span>&nbsp;<span class="ident" id="3232013">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232023">switch</span>&nbsp;<span class="ident" id="3232030">la</span>&nbsp;<span class="op" id="3232033">:=</span>&nbsp;<span class="ident" id="3232036">la</span><span class="op" id="3232038">.</span><span class="ident" id="3232039">toAddr</span><span class="op" id="3232045">(</span><span class="op" id="3232046">)</span><span class="op" id="3232047">.</span><span class="op" id="3232048">(</span><span class="keyword" id="3232049">type</span><span class="op" id="3232053">)</span>&nbsp;<span class="op" id="3232055">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232058">case</span>&nbsp;<span class="op" id="3232063">*</span><span class="ident" id="3232064">TCPAddr</span><span class="op" id="3232071">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3232075">l</span><span class="op" id="3232076">,</span>&nbsp;<span class="ident" id="3232078">err</span>&nbsp;<span class="op" id="3232082">=</span>&nbsp;<span class="ident" id="3232084">ListenTCP</span><span class="op" id="3232093">(</span><span class="ident" id="3232094">net</span><span class="op" id="3232097">,</span>&nbsp;<span class="ident" id="3232099">la</span><span class="op" id="3232101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232104">case</span>&nbsp;<span class="op" id="3232109">*</span><span class="ident" id="3232110">UnixAddr</span><span class="op" id="3232118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3232122">l</span><span class="op" id="3232123">,</span>&nbsp;<span class="ident" id="3232125">err</span>&nbsp;<span class="op" id="3232129">=</span>&nbsp;<span class="ident" id="3232131">ListenUnix</span><span class="op" id="3232141">(</span><span class="ident" id="3232142">net</span><span class="op" id="3232145">,</span>&nbsp;<span class="ident" id="3232147">la</span><span class="op" id="3232149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232152">default</span><span class="op" id="3232159">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232163">return</span>&nbsp;<span class="ident" id="3232170">nil</span><span class="op" id="3232173">,</span>&nbsp;<span class="op" id="3232175">&amp;</span><span class="ident" id="3232176">OpError</span><span class="op" id="3232183">{</span><span class="ident" id="3232184">Op</span><span class="op" id="3232186">:</span>&nbsp;<span class="string" id="3232188">&#34;listen&#34;</span><span class="op" id="3232196">,</span>&nbsp;<span class="ident" id="3232198">Net</span><span class="op" id="3232201">:</span>&nbsp;<span class="ident" id="3232203">net</span><span class="op" id="3232206">,</span>&nbsp;<span class="ident" id="3232208">Addr</span><span class="op" id="3232212">:</span>&nbsp;<span class="ident" id="3232214">la</span><span class="op" id="3232216">,</span>&nbsp;<span class="ident" id="3232218">Err</span><span class="op" id="3232221">:</span>&nbsp;<span class="op" id="3232223">&amp;</span><span class="ident" id="3232224">AddrError</span><span class="op" id="3232233">{</span><span class="ident" id="3232234">Err</span><span class="op" id="3232237">:</span>&nbsp;<span class="string" id="3232239">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3232264">,</span>&nbsp;<span class="ident" id="3232266">Addr</span><span class="op" id="3232270">:</span>&nbsp;<span class="ident" id="3232272">laddr</span><span class="op" id="3232277">}</span><span class="op" id="3232278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3232281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232284">if</span>&nbsp;<span class="ident" id="3232287">err</span>&nbsp;<span class="op" id="3232291">!=</span>&nbsp;<span class="ident" id="3232294">nil</span>&nbsp;<span class="op" id="3232298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232302">return</span>&nbsp;<span class="ident" id="3232309">nil</span><span class="op" id="3232312">,</span>&nbsp;<span class="ident" id="3232314">err</span>&nbsp;<span class="comment" id="3232318">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3232368">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232371">return</span>&nbsp;<span class="ident" id="3232378">l</span><span class="op" id="3232379">,</span>&nbsp;<span class="ident" id="3232381">nil</span><br>
<span class="lineno"></span><span class="op" id="3232385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3232388">//&nbsp;ListenPacket&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="comment" id="3232450">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;packet-oriented&nbsp;network:&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,</span><br>
<span class="lineno">280</span><span class="comment" id="3232519">//&nbsp;&#34;udp6&#34;,&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;&#34;ip6&#34;&nbsp;or&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3232564">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3232601">func</span>&nbsp;<span class="ident" id="3232606">ListenPacket</span><span class="op" id="3232618">(</span><span class="ident" id="3232619">net</span><span class="op" id="3232622">,</span>&nbsp;<span class="ident" id="3232624">laddr</span>&nbsp;<span class="builtintype" id="3232630">string</span><span class="op" id="3232636">)</span>&nbsp;<span class="op" id="3232638">(</span><span class="ident" id="3232639">PacketConn</span><span class="op" id="3232649">,</span>&nbsp;<span class="builtintype" id="3232651">error</span><span class="op" id="3232656">)</span>&nbsp;<span class="op" id="3232658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3232661">la</span><span class="op" id="3232663">,</span>&nbsp;<span class="ident" id="3232665">err</span>&nbsp;<span class="op" id="3232669">:=</span>&nbsp;<span class="ident" id="3232672">resolveAddr</span><span class="op" id="3232683">(</span><span class="string" id="3232684">&#34;listen&#34;</span><span class="op" id="3232692">,</span>&nbsp;<span class="ident" id="3232694">net</span><span class="op" id="3232697">,</span>&nbsp;<span class="ident" id="3232699">laddr</span><span class="op" id="3232704">,</span>&nbsp;<span class="ident" id="3232706">noDeadline</span><span class="op" id="3232716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232719">if</span>&nbsp;<span class="ident" id="3232722">err</span>&nbsp;<span class="op" id="3232726">!=</span>&nbsp;<span class="ident" id="3232729">nil</span>&nbsp;<span class="op" id="3232733">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232737">return</span>&nbsp;<span class="ident" id="3232744">nil</span><span class="op" id="3232747">,</span>&nbsp;<span class="op" id="3232749">&amp;</span><span class="ident" id="3232750">OpError</span><span class="op" id="3232757">{</span><span class="ident" id="3232758">Op</span><span class="op" id="3232760">:</span>&nbsp;<span class="string" id="3232762">&#34;listen&#34;</span><span class="op" id="3232770">,</span>&nbsp;<span class="ident" id="3232772">Net</span><span class="op" id="3232775">:</span>&nbsp;<span class="ident" id="3232777">net</span><span class="op" id="3232780">,</span>&nbsp;<span class="ident" id="3232782">Addr</span><span class="op" id="3232786">:</span>&nbsp;<span class="ident" id="3232788">nil</span><span class="op" id="3232791">,</span>&nbsp;<span class="ident" id="3232793">Err</span><span class="op" id="3232796">:</span>&nbsp;<span class="ident" id="3232798">err</span><span class="op" id="3232801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3232804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232807">var</span>&nbsp;<span class="ident" id="3232811">l</span>&nbsp;<span class="ident" id="3232813">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232825">switch</span>&nbsp;<span class="ident" id="3232832">la</span>&nbsp;<span class="op" id="3232835">:=</span>&nbsp;<span class="ident" id="3232838">la</span><span class="op" id="3232840">.</span><span class="ident" id="3232841">toAddr</span><span class="op" id="3232847">(</span><span class="op" id="3232848">)</span><span class="op" id="3232849">.</span><span class="op" id="3232850">(</span><span class="keyword" id="3232851">type</span><span class="op" id="3232855">)</span>&nbsp;<span class="op" id="3232857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232860">case</span>&nbsp;<span class="op" id="3232865">*</span><span class="ident" id="3232866">UDPAddr</span><span class="op" id="3232873">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3232877">l</span><span class="op" id="3232878">,</span>&nbsp;<span class="ident" id="3232880">err</span>&nbsp;<span class="op" id="3232884">=</span>&nbsp;<span class="ident" id="3232886">ListenUDP</span><span class="op" id="3232895">(</span><span class="ident" id="3232896">net</span><span class="op" id="3232899">,</span>&nbsp;<span class="ident" id="3232901">la</span><span class="op" id="3232903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232906">case</span>&nbsp;<span class="op" id="3232911">*</span><span class="ident" id="3232912">IPAddr</span><span class="op" id="3232918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3232922">l</span><span class="op" id="3232923">,</span>&nbsp;<span class="ident" id="3232925">err</span>&nbsp;<span class="op" id="3232929">=</span>&nbsp;<span class="ident" id="3232931">ListenIP</span><span class="op" id="3232939">(</span><span class="ident" id="3232940">net</span><span class="op" id="3232943">,</span>&nbsp;<span class="ident" id="3232945">la</span><span class="op" id="3232947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3232950">case</span>&nbsp;<span class="op" id="3232955">*</span><span class="ident" id="3232956">UnixAddr</span><span class="op" id="3232964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3232968">l</span><span class="op" id="3232969">,</span>&nbsp;<span class="ident" id="3232971">err</span>&nbsp;<span class="op" id="3232975">=</span>&nbsp;<span class="ident" id="3232977">ListenUnixgram</span><span class="op" id="3232991">(</span><span class="ident" id="3232992">net</span><span class="op" id="3232995">,</span>&nbsp;<span class="ident" id="3232997">la</span><span class="op" id="3232999">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233002">default</span><span class="op" id="3233009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233013">return</span>&nbsp;<span class="ident" id="3233020">nil</span><span class="op" id="3233023">,</span>&nbsp;<span class="op" id="3233025">&amp;</span><span class="ident" id="3233026">OpError</span><span class="op" id="3233033">{</span><span class="ident" id="3233034">Op</span><span class="op" id="3233036">:</span>&nbsp;<span class="string" id="3233038">&#34;listen&#34;</span><span class="op" id="3233046">,</span>&nbsp;<span class="ident" id="3233048">Net</span><span class="op" id="3233051">:</span>&nbsp;<span class="ident" id="3233053">net</span><span class="op" id="3233056">,</span>&nbsp;<span class="ident" id="3233058">Addr</span><span class="op" id="3233062">:</span>&nbsp;<span class="ident" id="3233064">la</span><span class="op" id="3233066">,</span>&nbsp;<span class="ident" id="3233068">Err</span><span class="op" id="3233071">:</span>&nbsp;<span class="op" id="3233073">&amp;</span><span class="ident" id="3233074">AddrError</span><span class="op" id="3233083">{</span><span class="ident" id="3233084">Err</span><span class="op" id="3233087">:</span>&nbsp;<span class="string" id="3233089">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3233114">,</span>&nbsp;<span class="ident" id="3233116">Addr</span><span class="op" id="3233120">:</span>&nbsp;<span class="ident" id="3233122">laddr</span><span class="op" id="3233127">}</span><span class="op" id="3233128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233134">if</span>&nbsp;<span class="ident" id="3233137">err</span>&nbsp;<span class="op" id="3233141">!=</span>&nbsp;<span class="ident" id="3233144">nil</span>&nbsp;<span class="op" id="3233148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233152">return</span>&nbsp;<span class="ident" id="3233159">nil</span><span class="op" id="3233162">,</span>&nbsp;<span class="ident" id="3233164">err</span>&nbsp;<span class="comment" id="3233168">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3233218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3233221">return</span>&nbsp;<span class="ident" id="3233228">l</span><span class="op" id="3233229">,</span>&nbsp;<span class="ident" id="3233231">nil</span><br>
<span class="lineno"></span><span class="op" id="3233235">}</span>
</div>
</body>
</html>
