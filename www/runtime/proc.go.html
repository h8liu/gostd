<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1900624">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1900679">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1900733">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1900784">package</span>&nbsp;<span class="ident" id="1900792">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1900801">import</span>&nbsp;<span class="string" id="1900808">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1900818">func</span>&nbsp;<span class="ident" id="1900823">newsysmon</span><span class="op" id="1900832">(</span><span class="op" id="1900833">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1900836">func</span>&nbsp;<span class="ident" id="1900841">runtime_init</span><span class="op" id="1900853">(</span><span class="op" id="1900854">)</span><br>
<span class="lineno"></span><span class="keyword" id="1900856">func</span>&nbsp;<span class="ident" id="1900861">main_init</span><span class="op" id="1900870">(</span><span class="op" id="1900871">)</span><br>
<span class="lineno"></span><span class="keyword" id="1900873">func</span>&nbsp;<span class="ident" id="1900878">main_main</span><span class="op" id="1900887">(</span><span class="op" id="1900888">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1900891">//&nbsp;The&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="1900914">func</span>&nbsp;<span class="ident" id="1900919">main</span><span class="op" id="1900923">(</span><span class="op" id="1900924">)</span>&nbsp;<span class="op" id="1900926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1900929">g</span>&nbsp;<span class="op" id="1900931">:=</span>&nbsp;<span class="ident" id="1900934"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1900938">(</span><span class="op" id="1900939">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1900943">//&nbsp;Racectx&nbsp;of&nbsp;m0-&gt;g0&nbsp;is&nbsp;used&nbsp;only&nbsp;as&nbsp;the&nbsp;parent&nbsp;of&nbsp;the&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901015">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;used&nbsp;for&nbsp;anything&nbsp;else.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1901058"><a href="/runtime/proc.go.html#1900929">g</a></span><span class="op" id="1901059">.</span><span class="ident" id="1901060">m</span><span class="op" id="1901061">.</span><span class="ident" id="1901062">g0</span><span class="op" id="1901064">.</span><span class="ident" id="1901065">racectx</span>&nbsp;<span class="op" id="1901073">=</span>&nbsp;<span class="num" id="1901075">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901079">//&nbsp;Max&nbsp;stack&nbsp;size&nbsp;is&nbsp;1&nbsp;GB&nbsp;on&nbsp;64-bit,&nbsp;250&nbsp;MB&nbsp;on&nbsp;32-bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901135">//&nbsp;Using&nbsp;decimal&nbsp;instead&nbsp;of&nbsp;binary&nbsp;GB&nbsp;and&nbsp;MB&nbsp;because</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901189">//&nbsp;they&nbsp;look&nbsp;nicer&nbsp;in&nbsp;the&nbsp;stack&nbsp;overflow&nbsp;failure&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901248">if</span>&nbsp;<span class="ident" id="1901251"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span>&nbsp;<span class="op" id="1901259">==</span>&nbsp;<span class="num" id="1901262">8</span>&nbsp;<span class="op" id="1901264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1901268"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021458">maxstacksize</a></span>&nbsp;<span class="op" id="1901281">=</span>&nbsp;<span class="num" id="1901283">1000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1901295">}</span>&nbsp;<span class="keyword" id="1901297">else</span>&nbsp;<span class="op" id="1901302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1901306"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021458">maxstacksize</a></span>&nbsp;<span class="op" id="1901319">=</span>&nbsp;<span class="num" id="1901321">250000000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1901332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1901336"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1901339">(</span><span class="ident" id="1901340"><a href="/runtime/proc.go.html#1900823">newsysmon</a></span><span class="op" id="1901349">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901353">//&nbsp;Lock&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;onto&nbsp;this,&nbsp;the&nbsp;main&nbsp;OS&nbsp;thread,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901412">//&nbsp;during&nbsp;initialization.&nbsp;&nbsp;Most&nbsp;programs&nbsp;won&#39;t&nbsp;care,&nbsp;but&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901476">//&nbsp;do&nbsp;require&nbsp;certain&nbsp;calls&nbsp;to&nbsp;be&nbsp;made&nbsp;by&nbsp;the&nbsp;main&nbsp;thread.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901536">//&nbsp;Those&nbsp;can&nbsp;arrange&nbsp;for&nbsp;main.main&nbsp;to&nbsp;run&nbsp;in&nbsp;the&nbsp;main&nbsp;thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901598">//&nbsp;by&nbsp;calling&nbsp;runtime.LockOSThread&nbsp;during&nbsp;initialization</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901656">//&nbsp;to&nbsp;preserve&nbsp;the&nbsp;lock.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1901682"><a href="/runtime/stubs.go.html#1972798">lockOSThread</a></span><span class="op" id="1901694">(</span><span class="op" id="1901695">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901699">if</span>&nbsp;<span class="ident" id="1901702"><a href="/runtime/proc.go.html#1900929">g</a></span><span class="op" id="1901703">.</span><span class="ident" id="1901704">m</span>&nbsp;<span class="op" id="1901706">!=</span>&nbsp;<span class="op" id="1901709">&amp;</span><span class="ident" id="1901710"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2033564">m0</a></span>&nbsp;<span class="op" id="1901713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1901717"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1901724">(</span><span class="string" id="1901725">&#34;runtime.main&nbsp;not&nbsp;on&nbsp;m0&#34;</span><span class="op" id="1901749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1901752">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1901756"><a href="/runtime/proc.go.html#1900841">runtime_init</a></span><span class="op" id="1901768">(</span><span class="op" id="1901769">)</span>&nbsp;<span class="comment" id="1901771">//&nbsp;must&nbsp;be&nbsp;before&nbsp;defer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1901797">//&nbsp;Defer&nbsp;unlock&nbsp;so&nbsp;that&nbsp;runtime.Goexit&nbsp;during&nbsp;init&nbsp;does&nbsp;the&nbsp;unlock&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1901870">needUnlock</span>&nbsp;<span class="op" id="1901881">:=</span>&nbsp;<span class="ident" id="1901884">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901890">defer</span>&nbsp;<span class="keyword" id="1901896">func</span><span class="op" id="1901900">(</span><span class="op" id="1901901">)</span>&nbsp;<span class="op" id="1901903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1901907">if</span>&nbsp;<span class="ident" id="1901910"><a href="/runtime/proc.go.html#1901870">needUnlock</a></span>&nbsp;<span class="op" id="1901921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1901926"><a href="/runtime/stubs.go.html#1972818">unlockOSThread</a></span><span class="op" id="1901940">(</span><span class="op" id="1901941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1901945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1901948">}</span><span class="op" id="1901949">(</span><span class="op" id="1901950">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1901954"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2023037">memstats</a></span><span class="op" id="1901962">.</span><span class="ident" id="1901963">enablegc</span>&nbsp;<span class="op" id="1901972">=</span>&nbsp;<span class="ident" id="1901974">true</span>&nbsp;<span class="comment" id="1901979">//&nbsp;now&nbsp;that&nbsp;runtime&nbsp;is&nbsp;initialized,&nbsp;GC&nbsp;is&nbsp;okay</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902028"><a href="/runtime/proc.go.html#1900861">main_init</a></span><span class="op" id="1902037">(</span><span class="op" id="1902038">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902042"><a href="/runtime/proc.go.html#1901870">needUnlock</a></span>&nbsp;<span class="op" id="1902053">=</span>&nbsp;<span class="ident" id="1902055">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902062"><a href="/runtime/stubs.go.html#1972818">unlockOSThread</a></span><span class="op" id="1902076">(</span><span class="op" id="1902077">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902081"><a href="/runtime/proc.go.html#1900878">main_main</a></span><span class="op" id="1902090">(</span><span class="op" id="1902091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902094">if</span>&nbsp;<span class="ident" id="1902097"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1902109">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902113"><a href="/runtime/race0.go.html#1906871">racefini</a></span><span class="op" id="1902121">(</span><span class="op" id="1902122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1902129">//&nbsp;Make&nbsp;racy&nbsp;client&nbsp;program&nbsp;work:&nbsp;if&nbsp;panicking&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1902180">//&nbsp;another&nbsp;goroutine&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;as&nbsp;main&nbsp;returns,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1902236">//&nbsp;let&nbsp;the&nbsp;other&nbsp;goroutine&nbsp;finish&nbsp;printing&nbsp;the&nbsp;panic&nbsp;trace.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1902297">//&nbsp;Once&nbsp;it&nbsp;does,&nbsp;it&nbsp;will&nbsp;exit.&nbsp;See&nbsp;issue&nbsp;3934.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902345">if</span>&nbsp;<span class="ident" id="1902348"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021281">panicking</a></span>&nbsp;<span class="op" id="1902358">!=</span>&nbsp;<span class="num" id="1902361">0</span>&nbsp;<span class="op" id="1902363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902367"><a href="/runtime/proc.go.html#1903238">gopark</a></span><span class="op" id="1902373">(</span><span class="ident" id="1902374">nil</span><span class="op" id="1902377">,</span>&nbsp;<span class="ident" id="1902379">nil</span><span class="op" id="1902382">,</span>&nbsp;<span class="string" id="1902384">&#34;panicwait&#34;</span><span class="op" id="1902395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902398">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902402"><a href="/runtime/stubs.go.html#1973863">exit</a></span><span class="op" id="1902406">(</span><span class="num" id="1902407">0</span><span class="op" id="1902408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902411">for</span>&nbsp;<span class="op" id="1902415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902419">var</span>&nbsp;<span class="ident" id="1902423">x</span>&nbsp;<span class="op" id="1902425">*</span><span class="builtintype" id="1902426">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902434">*</span><span class="ident" id="1902435"><a href="/runtime/proc.go.html#1902423">x</a></span>&nbsp;<span class="op" id="1902437">=</span>&nbsp;<span class="num" id="1902439">0</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902442">}</span><br>
<span class="lineno"></span><span class="op" id="1902444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1902447">var</span>&nbsp;<span class="ident" id="1902451">parkunlock_c</span>&nbsp;<span class="builtintype" id="1902464">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1902470">//&nbsp;start&nbsp;forcegc&nbsp;helper&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="keyword" id="1902504">func</span>&nbsp;<span class="ident" id="1902509">init</span><span class="op" id="1902513">(</span><span class="op" id="1902514">)</span>&nbsp;<span class="op" id="1902516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902519">go</span>&nbsp;<span class="ident" id="1902522"><a href="/runtime/proc.go.html#1902546">forcegchelper</a></span><span class="op" id="1902535">(</span><span class="op" id="1902536">)</span><br>
<span class="lineno"></span><span class="op" id="1902538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="1902541">func</span>&nbsp;<span class="ident" id="1902546">forcegchelper</span><span class="op" id="1902559">(</span><span class="op" id="1902560">)</span>&nbsp;<span class="op" id="1902562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902565"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021500">forcegc</a></span><span class="op" id="1902572">.</span><span class="ident" id="1902573">g</span>&nbsp;<span class="op" id="1902575">=</span>&nbsp;<span class="ident" id="1902577"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1902581">(</span><span class="op" id="1902582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902585"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021500">forcegc</a></span><span class="op" id="1902592">.</span><span class="ident" id="1902593">g</span><span class="op" id="1902594">.</span><span class="ident" id="1902595">issystem</span>&nbsp;<span class="op" id="1902604">=</span>&nbsp;<span class="ident" id="1902606">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902612">for</span>&nbsp;<span class="op" id="1902616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902620"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1902624">(</span><span class="op" id="1902625">&amp;</span><span class="ident" id="1902626"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021500">forcegc</a></span><span class="op" id="1902633">.</span><span class="ident" id="1902634">lock</span><span class="op" id="1902638">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902642">if</span>&nbsp;<span class="ident" id="1902645"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021500">forcegc</a></span><span class="op" id="1902652">.</span><span class="ident" id="1902653">idle</span>&nbsp;<span class="op" id="1902658">!=</span>&nbsp;<span class="num" id="1902661">0</span>&nbsp;<span class="op" id="1902663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902668"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1902675">(</span><span class="string" id="1902676">&#34;forcegc:&nbsp;phase&nbsp;error&#34;</span><span class="op" id="1902698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902706"><a href="/runtime/atomic.go.html#1711582">atomicstore</a></span><span class="op" id="1902717">(</span><span class="op" id="1902718">&amp;</span><span class="ident" id="1902719"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021500">forcegc</a></span><span class="op" id="1902726">.</span><span class="ident" id="1902727">idle</span><span class="op" id="1902731">,</span>&nbsp;<span class="num" id="1902733">1</span><span class="op" id="1902734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902738"><a href="/runtime/proc.go.html#1903766">goparkunlock</a></span><span class="op" id="1902750">(</span><span class="op" id="1902751">&amp;</span><span class="ident" id="1902752"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021500">forcegc</a></span><span class="op" id="1902759">.</span><span class="ident" id="1902760">lock</span><span class="op" id="1902764">,</span>&nbsp;<span class="string" id="1902766">&#34;force&nbsp;gc&nbsp;(idle)&#34;</span><span class="op" id="1902783">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1902787">//&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;explicitly&nbsp;resumed&nbsp;by&nbsp;sysmon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1902839">if</span>&nbsp;<span class="ident" id="1902842"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021438">debug</a></span><span class="op" id="1902847">.</span><span class="ident" id="1902848">gctrace</span>&nbsp;<span class="op" id="1902856">&gt;</span>&nbsp;<span class="num" id="1902858">0</span>&nbsp;<span class="op" id="1902860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1902865">println</span><span class="op" id="1902872">(</span><span class="string" id="1902873">&#34;GC&nbsp;forced&#34;</span><span class="op" id="1902884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1902892"><a href="/runtime/malloc.go.html#1830307">gogc</a></span><span class="op" id="1902896">(</span><span class="num" id="1902897">1</span><span class="op" id="1902898">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1902901">}</span><br>
<span class="lineno"></span><span class="op" id="1902903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1902906">//go:nosplit</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1902920">//&nbsp;Gosched&nbsp;yields&nbsp;the&nbsp;processor,&nbsp;allowing&nbsp;other&nbsp;goroutines&nbsp;to&nbsp;run.&nbsp;&nbsp;It&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="1903000">//&nbsp;suspend&nbsp;the&nbsp;current&nbsp;goroutine,&nbsp;so&nbsp;execution&nbsp;resumes&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="keyword" id="1903070">func</span>&nbsp;<span class="ident" id="1903075">Gosched</span><span class="op" id="1903082">(</span><span class="op" id="1903083">)</span>&nbsp;<span class="op" id="1903085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903088"><a href="/runtime/stubs.go.html#1969611">mcall</a></span><span class="op" id="1903093">(</span><span class="ident" id="1903094"><a href="/runtime/stubs.go.html#1971988">gosched_m</a></span><span class="op" id="1903103">)</span><br>
<span class="lineno"></span><span class="op" id="1903105">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1903108">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;calls&nbsp;unlockf.</span><br>
<span class="lineno"></span><span class="comment" id="1903178">//&nbsp;If&nbsp;unlockf&nbsp;returns&nbsp;false,&nbsp;the&nbsp;goroutine&nbsp;is&nbsp;resumed.</span><br>
<span class="lineno"></span><span class="keyword" id="1903233">func</span>&nbsp;<span class="ident" id="1903238">gopark</span><span class="op" id="1903244">(</span><span class="ident" id="1903245">unlockf</span>&nbsp;<span class="ident" id="1903253"><a href="/runtime/proc.go.html#1900808">unsafe</a></span><span class="op" id="1903259">.</span><span class="ident" id="1903260">Pointer</span><span class="op" id="1903267">,</span>&nbsp;<span class="ident" id="1903269">lock</span>&nbsp;<span class="ident" id="1903274"><a href="/runtime/proc.go.html#1900808">unsafe</a></span><span class="op" id="1903280">.</span><span class="ident" id="1903281">Pointer</span><span class="op" id="1903288">,</span>&nbsp;<span class="ident" id="1903290">reason</span>&nbsp;<span class="builtintype" id="1903297">string</span><span class="op" id="1903303">)</span>&nbsp;<span class="op" id="1903305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903308">mp</span>&nbsp;<span class="op" id="1903311">:=</span>&nbsp;<span class="ident" id="1903314"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1903322">(</span><span class="op" id="1903323">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903326">gp</span>&nbsp;<span class="op" id="1903329">:=</span>&nbsp;<span class="ident" id="1903332"><a href="/runtime/proc.go.html#1903308">mp</a></span><span class="op" id="1903334">.</span><span class="ident" id="1903335">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903341">status</span>&nbsp;<span class="op" id="1903348">:=</span>&nbsp;<span class="ident" id="1903351"><a href="/runtime/stubs.go.html#1968965">readgstatus</a></span><span class="op" id="1903362">(</span><span class="ident" id="1903363"><a href="/runtime/proc.go.html#1903326">gp</a></span><span class="op" id="1903365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1903368">if</span>&nbsp;<span class="ident" id="1903371"><a href="/runtime/proc.go.html#1903341">status</a></span>&nbsp;<span class="op" id="1903378">!=</span>&nbsp;<span class="ident" id="1903381"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2015761">_Grunning</a></span>&nbsp;<span class="op" id="1903391">&amp;&amp;</span>&nbsp;<span class="ident" id="1903394"><a href="/runtime/proc.go.html#1903341">status</a></span>&nbsp;<span class="op" id="1903401">!=</span>&nbsp;<span class="ident" id="1903404"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2015956">_Gscanrunning</a></span>&nbsp;<span class="op" id="1903418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903422"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1903429">(</span><span class="string" id="1903430">&#34;gopark:&nbsp;bad&nbsp;g&nbsp;status&#34;</span><span class="op" id="1903452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1903455">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903458"><a href="/runtime/proc.go.html#1903308">mp</a></span><span class="op" id="1903460">.</span><span class="ident" id="1903461">waitlock</span>&nbsp;<span class="op" id="1903470">=</span>&nbsp;<span class="ident" id="1903472"><a href="/runtime/proc.go.html#1903269">lock</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903478"><a href="/runtime/proc.go.html#1903308">mp</a></span><span class="op" id="1903480">.</span><span class="ident" id="1903481">waitunlockf</span>&nbsp;<span class="op" id="1903493">=</span>&nbsp;<span class="ident" id="1903495"><a href="/runtime/proc.go.html#1903245">unlockf</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903504"><a href="/runtime/proc.go.html#1903326">gp</a></span><span class="op" id="1903506">.</span><span class="ident" id="1903507">waitreason</span>&nbsp;<span class="op" id="1903518">=</span>&nbsp;<span class="ident" id="1903520"><a href="/runtime/proc.go.html#1903290">reason</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903528"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1903536">(</span><span class="ident" id="1903537"><a href="/runtime/proc.go.html#1903308">mp</a></span><span class="op" id="1903539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1903542">//&nbsp;can&#39;t&nbsp;do&nbsp;anything&nbsp;that&nbsp;might&nbsp;move&nbsp;the&nbsp;G&nbsp;between&nbsp;Ms&nbsp;here.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903603"><a href="/runtime/stubs.go.html#1969611">mcall</a></span><span class="op" id="1903608">(</span><span class="ident" id="1903609"><a href="/runtime/stubs.go.html#1972007">park_m</a></span><span class="op" id="1903615">)</span><br>
<span class="lineno"></span><span class="op" id="1903617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1903620">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;unlocks&nbsp;the&nbsp;lock.</span><br>
<span class="lineno"></span><span class="comment" id="1903693">//&nbsp;The&nbsp;goroutine&nbsp;can&nbsp;be&nbsp;made&nbsp;runnable&nbsp;again&nbsp;by&nbsp;calling&nbsp;goready(gp).</span><br>
<span class="lineno">135</span><span class="keyword" id="1903761">func</span>&nbsp;<span class="ident" id="1903766">goparkunlock</span><span class="op" id="1903778">(</span><span class="ident" id="1903779">lock</span>&nbsp;<span class="op" id="1903784">*</span><span class="ident" id="1903785"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016175">mutex</a></span><span class="op" id="1903790">,</span>&nbsp;<span class="ident" id="1903792">reason</span>&nbsp;<span class="builtintype" id="1903799">string</span><span class="op" id="1903805">)</span>&nbsp;<span class="op" id="1903807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903810"><a href="/runtime/proc.go.html#1903238">gopark</a></span><span class="op" id="1903816">(</span><span class="ident" id="1903817"><a href="/runtime/proc.go.html#1900808">unsafe</a></span><span class="op" id="1903823">.</span><span class="ident" id="1903824">Pointer</span><span class="op" id="1903831">(</span><span class="op" id="1903832">&amp;</span><span class="ident" id="1903833"><a href="/runtime/proc.go.html#1902451">parkunlock_c</a></span><span class="op" id="1903845">)</span><span class="op" id="1903846">,</span>&nbsp;<span class="ident" id="1903848"><a href="/runtime/proc.go.html#1900808">unsafe</a></span><span class="op" id="1903854">.</span><span class="ident" id="1903855">Pointer</span><span class="op" id="1903862">(</span><span class="ident" id="1903863"><a href="/runtime/proc.go.html#1903779">lock</a></span><span class="op" id="1903867">)</span><span class="op" id="1903868">,</span>&nbsp;<span class="ident" id="1903870"><a href="/runtime/proc.go.html#1903792">reason</a></span><span class="op" id="1903876">)</span><br>
<span class="lineno"></span><span class="op" id="1903878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1903881">func</span>&nbsp;<span class="ident" id="1903886">goready</span><span class="op" id="1903893">(</span><span class="ident" id="1903894">gp</span>&nbsp;<span class="op" id="1903897">*</span><span class="ident" id="1903898"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><span class="op" id="1903899">)</span>&nbsp;<span class="op" id="1903901">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903904">mp</span>&nbsp;<span class="op" id="1903907">:=</span>&nbsp;<span class="ident" id="1903910"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1903918">(</span><span class="op" id="1903919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903922"><a href="/runtime/proc.go.html#1903904">mp</a></span><span class="op" id="1903924">.</span><span class="ident" id="1903925">ptrarg</span><span class="op" id="1903931">[</span><span class="num" id="1903932">0</span><span class="op" id="1903933">]</span>&nbsp;<span class="op" id="1903935">=</span>&nbsp;<span class="ident" id="1903937"><a href="/runtime/proc.go.html#1900808">unsafe</a></span><span class="op" id="1903943">.</span><span class="ident" id="1903944">Pointer</span><span class="op" id="1903951">(</span><span class="ident" id="1903952"><a href="/runtime/proc.go.html#1903894">gp</a></span><span class="op" id="1903954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903957"><a href="/runtime/stubs.go.html#1971002">onM</a></span><span class="op" id="1903960">(</span><span class="ident" id="1903961"><a href="/runtime/stubs.go.html#1972346">ready_m</a></span><span class="op" id="1903968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1903971"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1903979">(</span><span class="ident" id="1903980"><a href="/runtime/proc.go.html#1903904">mp</a></span><span class="op" id="1903982">)</span><br>
<span class="lineno"></span><span class="op" id="1903984">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1903987">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1904000">func</span>&nbsp;<span class="ident" id="1904005">acquireSudog</span><span class="op" id="1904017">(</span><span class="op" id="1904018">)</span>&nbsp;<span class="op" id="1904020">*</span><span class="ident" id="1904021"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016716">sudog</a></span>&nbsp;<span class="op" id="1904027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1904030">c</span>&nbsp;<span class="op" id="1904032">:=</span>&nbsp;<span class="ident" id="1904035"><a href="/runtime/stubs.go.html#1968941">gomcache</a></span><span class="op" id="1904043">(</span><span class="op" id="1904044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1904047">s</span>&nbsp;<span class="op" id="1904049">:=</span>&nbsp;<span class="ident" id="1904052"><a href="/runtime/proc.go.html#1904030">c</a></span><span class="op" id="1904053">.</span><span class="ident" id="1904054">sudogcache</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904066">if</span>&nbsp;<span class="ident" id="1904069"><a href="/runtime/proc.go.html#1904047">s</a></span>&nbsp;<span class="op" id="1904071">!=</span>&nbsp;<span class="ident" id="1904074">nil</span>&nbsp;<span class="op" id="1904078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904082">if</span>&nbsp;<span class="ident" id="1904085"><a href="/runtime/proc.go.html#1904047">s</a></span><span class="op" id="1904086">.</span><span class="ident" id="1904087">elem</span>&nbsp;<span class="op" id="1904092">!=</span>&nbsp;<span class="ident" id="1904095">nil</span>&nbsp;<span class="op" id="1904099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1904104"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1904111">(</span><span class="string" id="1904112">&#34;acquireSudog:&nbsp;found&nbsp;s.elem&nbsp;!=&nbsp;nil&nbsp;in&nbsp;cache&#34;</span><span class="op" id="1904156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1904160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1904164"><a href="/runtime/proc.go.html#1904030">c</a></span><span class="op" id="1904165">.</span><span class="ident" id="1904166">sudogcache</span>&nbsp;<span class="op" id="1904177">=</span>&nbsp;<span class="ident" id="1904179"><a href="/runtime/proc.go.html#1904047">s</a></span><span class="op" id="1904180">.</span><span class="ident" id="1904181">next</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1904188"><a href="/runtime/proc.go.html#1904047">s</a></span><span class="op" id="1904189">.</span><span class="ident" id="1904190">next</span>&nbsp;<span class="op" id="1904195">=</span>&nbsp;<span class="ident" id="1904197">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904203">return</span>&nbsp;<span class="ident" id="1904210"><a href="/runtime/proc.go.html#1904047">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1904213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1904217">//&nbsp;Delicate&nbsp;dance:&nbsp;the&nbsp;semaphore&nbsp;implementation&nbsp;calls</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1904272">//&nbsp;acquireSudog,&nbsp;acquireSudog&nbsp;calls&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1904321">//&nbsp;new&nbsp;calls&nbsp;malloc,&nbsp;malloc&nbsp;can&nbsp;call&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1904382">//&nbsp;and&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;calls&nbsp;the&nbsp;semaphore&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1904447">//&nbsp;in&nbsp;stoptheworld.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1904468">//&nbsp;Break&nbsp;the&nbsp;cycle&nbsp;by&nbsp;doing&nbsp;acquirem/releasem&nbsp;around&nbsp;new(sudog).</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1904534">//&nbsp;The&nbsp;acquirem/releasem&nbsp;increments&nbsp;m.locks&nbsp;during&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1904598">//&nbsp;which&nbsp;keeps&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;from&nbsp;being&nbsp;invoked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1904656">mp</span>&nbsp;<span class="op" id="1904659">:=</span>&nbsp;<span class="ident" id="1904662"><a href="/runtime/stubs.go.html#1968901">acquirem</a></span><span class="op" id="1904670">(</span><span class="op" id="1904671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1904674">p</span>&nbsp;<span class="op" id="1904676">:=</span>&nbsp;<span class="builtinfunc" id="1904679">new</span><span class="op" id="1904682">(</span><span class="ident" id="1904683"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016716">sudog</a></span><span class="op" id="1904688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1904691"><a href="/runtime/stubs.go.html#1968920">releasem</a></span><span class="op" id="1904699">(</span><span class="ident" id="1904700"><a href="/runtime/proc.go.html#1904656">mp</a></span><span class="op" id="1904702">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904705">return</span>&nbsp;<span class="ident" id="1904712"><a href="/runtime/proc.go.html#1904674">p</a></span><br>
<span class="lineno"></span><span class="op" id="1904714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1904717">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1904730">func</span>&nbsp;<span class="ident" id="1904735">releaseSudog</span><span class="op" id="1904747">(</span><span class="ident" id="1904748">s</span>&nbsp;<span class="op" id="1904750">*</span><span class="ident" id="1904751"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016716">sudog</a></span><span class="op" id="1904756">)</span>&nbsp;<span class="op" id="1904758">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904761">if</span>&nbsp;<span class="ident" id="1904764"><a href="/runtime/proc.go.html#1904748">s</a></span><span class="op" id="1904765">.</span><span class="ident" id="1904766">elem</span>&nbsp;<span class="op" id="1904771">!=</span>&nbsp;<span class="ident" id="1904774">nil</span>&nbsp;<span class="op" id="1904778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1904782"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1904789">(</span><span class="string" id="1904790">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;elem&#34;</span><span class="op" id="1904824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1904827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904830">if</span>&nbsp;<span class="ident" id="1904833"><a href="/runtime/proc.go.html#1904748">s</a></span><span class="op" id="1904834">.</span><span class="ident" id="1904835">selectdone</span>&nbsp;<span class="op" id="1904846">!=</span>&nbsp;<span class="ident" id="1904849">nil</span>&nbsp;<span class="op" id="1904853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1904857"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1904864">(</span><span class="string" id="1904865">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;selectdone&#34;</span><span class="op" id="1904905">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1904908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904911">if</span>&nbsp;<span class="ident" id="1904914"><a href="/runtime/proc.go.html#1904748">s</a></span><span class="op" id="1904915">.</span><span class="ident" id="1904916">next</span>&nbsp;<span class="op" id="1904921">!=</span>&nbsp;<span class="ident" id="1904924">nil</span>&nbsp;<span class="op" id="1904928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1904932"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1904939">(</span><span class="string" id="1904940">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;next&#34;</span><span class="op" id="1904974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1904977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1904980">if</span>&nbsp;<span class="ident" id="1904983"><a href="/runtime/proc.go.html#1904748">s</a></span><span class="op" id="1904984">.</span><span class="ident" id="1904985">prev</span>&nbsp;<span class="op" id="1904990">!=</span>&nbsp;<span class="ident" id="1904993">nil</span>&nbsp;<span class="op" id="1904997">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905001"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1905008">(</span><span class="string" id="1905009">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;prev&#34;</span><span class="op" id="1905043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1905046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905049">if</span>&nbsp;<span class="ident" id="1905052"><a href="/runtime/proc.go.html#1904748">s</a></span><span class="op" id="1905053">.</span><span class="ident" id="1905054">waitlink</span>&nbsp;<span class="op" id="1905063">!=</span>&nbsp;<span class="ident" id="1905066">nil</span>&nbsp;<span class="op" id="1905070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905074"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1905081">(</span><span class="string" id="1905082">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;waitlink&#34;</span><span class="op" id="1905120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1905123">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905126">gp</span>&nbsp;<span class="op" id="1905129">:=</span>&nbsp;<span class="ident" id="1905132"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1905136">(</span><span class="op" id="1905137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905140">if</span>&nbsp;<span class="ident" id="1905143"><a href="/runtime/proc.go.html#1905126">gp</a></span><span class="op" id="1905145">.</span><span class="ident" id="1905146">param</span>&nbsp;<span class="op" id="1905152">!=</span>&nbsp;<span class="ident" id="1905155">nil</span>&nbsp;<span class="op" id="1905159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905163"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1905170">(</span><span class="string" id="1905171">&#34;runtime:&nbsp;releaseSudog&nbsp;with&nbsp;non-nil&nbsp;gp.param&#34;</span><span class="op" id="1905216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1905219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905222">c</span>&nbsp;<span class="op" id="1905224">:=</span>&nbsp;<span class="ident" id="1905227"><a href="/runtime/stubs.go.html#1968941">gomcache</a></span><span class="op" id="1905235">(</span><span class="op" id="1905236">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905239"><a href="/runtime/proc.go.html#1904748">s</a></span><span class="op" id="1905240">.</span><span class="ident" id="1905241">next</span>&nbsp;<span class="op" id="1905246">=</span>&nbsp;<span class="ident" id="1905248"><a href="/runtime/proc.go.html#1905222">c</a></span><span class="op" id="1905249">.</span><span class="ident" id="1905250">sudogcache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905262"><a href="/runtime/proc.go.html#1905222">c</a></span><span class="op" id="1905263">.</span><span class="ident" id="1905264">sudogcache</span>&nbsp;<span class="op" id="1905275">=</span>&nbsp;<span class="ident" id="1905277"><a href="/runtime/proc.go.html#1904748">s</a></span><br>
<span class="lineno"></span><span class="op" id="1905279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1905282">//&nbsp;funcPC&nbsp;returns&nbsp;the&nbsp;entry&nbsp;PC&nbsp;of&nbsp;the&nbsp;function&nbsp;f.</span><br>
<span class="lineno">200</span><span class="comment" id="1905332">//&nbsp;It&nbsp;assumes&nbsp;that&nbsp;f&nbsp;is&nbsp;a&nbsp;func&nbsp;value.&nbsp;Otherwise&nbsp;the&nbsp;behavior&nbsp;is&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="comment" id="1905407">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1905420">func</span>&nbsp;<span class="ident" id="1905425">funcPC</span><span class="op" id="1905431">(</span><span class="ident" id="1905432">f</span>&nbsp;<span class="keyword" id="1905434">interface</span><span class="op" id="1905443">{</span><span class="op" id="1905444">}</span><span class="op" id="1905445">)</span>&nbsp;<span class="builtintype" id="1905447">uintptr</span>&nbsp;<span class="op" id="1905455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905458">return</span>&nbsp;<span class="op" id="1905465">*</span><span class="op" id="1905466">*</span><span class="op" id="1905467">(</span><span class="op" id="1905468">*</span><span class="op" id="1905469">*</span><span class="builtintype" id="1905470">uintptr</span><span class="op" id="1905477">)</span><span class="op" id="1905478">(</span><span class="ident" id="1905479"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1905482">(</span><span class="ident" id="1905483"><a href="/runtime/proc.go.html#1900808">unsafe</a></span><span class="op" id="1905489">.</span><span class="ident" id="1905490">Pointer</span><span class="op" id="1905497">(</span><span class="op" id="1905498">&amp;</span><span class="ident" id="1905499"><a href="/runtime/proc.go.html#1905432">f</a></span><span class="op" id="1905500">)</span><span class="op" id="1905501">,</span>&nbsp;<span class="ident" id="1905503"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span><span class="op" id="1905510">)</span><span class="op" id="1905511">)</span><br>
<span class="lineno"></span><span class="op" id="1905513">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="1905516">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno"></span><span class="keyword" id="1905540">func</span>&nbsp;<span class="ident" id="1905545">badmcall</span><span class="op" id="1905553">(</span><span class="ident" id="1905554">fn</span>&nbsp;<span class="keyword" id="1905557">func</span><span class="op" id="1905561">(</span><span class="op" id="1905562">*</span><span class="ident" id="1905563"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><span class="op" id="1905564">)</span><span class="op" id="1905565">)</span>&nbsp;<span class="op" id="1905567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905570"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1905577">(</span><span class="string" id="1905578">&#34;runtime:&nbsp;mcall&nbsp;called&nbsp;on&nbsp;m-&gt;g0&nbsp;stack&#34;</span><span class="op" id="1905616">)</span><br>
<span class="lineno"></span><span class="op" id="1905618">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="1905621">func</span>&nbsp;<span class="ident" id="1905626">badmcall2</span><span class="op" id="1905635">(</span><span class="ident" id="1905636">fn</span>&nbsp;<span class="keyword" id="1905639">func</span><span class="op" id="1905643">(</span><span class="op" id="1905644">*</span><span class="ident" id="1905645"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><span class="op" id="1905646">)</span><span class="op" id="1905647">)</span>&nbsp;<span class="op" id="1905649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905652"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1905659">(</span><span class="string" id="1905660">&#34;runtime:&nbsp;mcall&nbsp;function&nbsp;returned&#34;</span><span class="op" id="1905694">)</span><br>
<span class="lineno"></span><span class="op" id="1905696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1905699">func</span>&nbsp;<span class="ident" id="1905704">badreflectcall</span><span class="op" id="1905718">(</span><span class="op" id="1905719">)</span>&nbsp;<span class="op" id="1905721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1905724">panic</span><span class="op" id="1905729">(</span><span class="string" id="1905730">&#34;runtime:&nbsp;arg&nbsp;size&nbsp;to&nbsp;reflect.call&nbsp;more&nbsp;than&nbsp;1GB&#34;</span><span class="op" id="1905779">)</span><br>
<span class="lineno"></span><span class="op" id="1905781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1905784">func</span>&nbsp;<span class="ident" id="1905789">lockedOSThread</span><span class="op" id="1905803">(</span><span class="op" id="1905804">)</span>&nbsp;<span class="builtintype" id="1905806">bool</span>&nbsp;<span class="op" id="1905811">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1905814">gp</span>&nbsp;<span class="op" id="1905817">:=</span>&nbsp;<span class="ident" id="1905820"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1905824">(</span><span class="op" id="1905825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905828">return</span>&nbsp;<span class="ident" id="1905835"><a href="/runtime/proc.go.html#1905814">gp</a></span><span class="op" id="1905837">.</span><span class="ident" id="1905838">lockedm</span>&nbsp;<span class="op" id="1905846">!=</span>&nbsp;<span class="ident" id="1905849">nil</span>&nbsp;<span class="op" id="1905853">&amp;&amp;</span>&nbsp;<span class="ident" id="1905856"><a href="/runtime/proc.go.html#1905814">gp</a></span><span class="op" id="1905858">.</span><span class="ident" id="1905859">m</span><span class="op" id="1905860">.</span><span class="ident" id="1905861">lockedg</span>&nbsp;<span class="op" id="1905869">!=</span>&nbsp;<span class="ident" id="1905872">nil</span><br>
<span class="lineno"></span><span class="op" id="1905876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1905879">func</span>&nbsp;<span class="ident" id="1905884">newP</span><span class="op" id="1905888">(</span><span class="op" id="1905889">)</span>&nbsp;<span class="op" id="1905891">*</span><span class="ident" id="1905892"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2018563">p</a></span>&nbsp;<span class="op" id="1905894">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905897">return</span>&nbsp;<span class="builtinfunc" id="1905904">new</span><span class="op" id="1905907">(</span><span class="ident" id="1905908"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2018563">p</a></span><span class="op" id="1905909">)</span><br>
<span class="lineno"></span><span class="op" id="1905911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1905914">func</span>&nbsp;<span class="ident" id="1905919">newM</span><span class="op" id="1905923">(</span><span class="op" id="1905924">)</span>&nbsp;<span class="op" id="1905926">*</span><span class="ident" id="1905927"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017777">m</a></span>&nbsp;<span class="op" id="1905929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905932">return</span>&nbsp;<span class="builtinfunc" id="1905939">new</span><span class="op" id="1905942">(</span><span class="ident" id="1905943"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017777">m</a></span><span class="op" id="1905944">)</span><br>
<span class="lineno">230</span><span class="op" id="1905946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1905949">func</span>&nbsp;<span class="ident" id="1905954">newG</span><span class="op" id="1905958">(</span><span class="op" id="1905959">)</span>&nbsp;<span class="op" id="1905961">*</span><span class="ident" id="1905962"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span>&nbsp;<span class="op" id="1905964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1905967">return</span>&nbsp;<span class="builtinfunc" id="1905974">new</span><span class="op" id="1905977">(</span><span class="ident" id="1905978"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><span class="op" id="1905979">)</span><br>
<span class="lineno"></span><span class="op" id="1905981">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="1905984">func</span>&nbsp;<span class="ident" id="1905989">allgadd</span><span class="op" id="1905996">(</span><span class="ident" id="1905997">gp</span>&nbsp;<span class="op" id="1906000">*</span><span class="ident" id="1906001"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2017238">g</a></span><span class="op" id="1906002">)</span>&nbsp;<span class="op" id="1906004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1906007">if</span>&nbsp;<span class="ident" id="1906010"><a href="/runtime/stubs.go.html#1968965">readgstatus</a></span><span class="op" id="1906021">(</span><span class="ident" id="1906022"><a href="/runtime/proc.go.html#1905997">gp</a></span><span class="op" id="1906024">)</span>&nbsp;<span class="op" id="1906026">==</span>&nbsp;<span class="ident" id="1906029"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2015723">_Gidle</a></span>&nbsp;<span class="op" id="1906036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1906040"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1906047">(</span><span class="string" id="1906048">&#34;allgadd:&nbsp;bad&nbsp;status&nbsp;Gidle&#34;</span><span class="op" id="1906075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1906078">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1906082"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1906086">(</span><span class="op" id="1906087">&amp;</span><span class="ident" id="1906088"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2033596">allglock</a></span><span class="op" id="1906096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1906099"><a href="/runtime/mprof.go.html#1863497">allgs</a></span>&nbsp;<span class="op" id="1906105">=</span>&nbsp;<span class="builtinfunc" id="1906107">append</span><span class="op" id="1906113">(</span><span class="ident" id="1906114"><a href="/runtime/mprof.go.html#1863497">allgs</a></span><span class="op" id="1906119">,</span>&nbsp;<span class="ident" id="1906121"><a href="/runtime/proc.go.html#1905997">gp</a></span><span class="op" id="1906123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1906126"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021163">allg</a></span>&nbsp;<span class="op" id="1906131">=</span>&nbsp;<span class="op" id="1906133">&amp;</span><span class="ident" id="1906134"><a href="/runtime/mprof.go.html#1863497">allgs</a></span><span class="op" id="1906139">[</span><span class="num" id="1906140">0</span><span class="op" id="1906141">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1906144"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2021176">allglen</a></span>&nbsp;<span class="op" id="1906152">=</span>&nbsp;<span class="builtintype" id="1906154">uintptr</span><span class="op" id="1906161">(</span><span class="builtinfunc" id="1906162">len</span><span class="op" id="1906165">(</span><span class="ident" id="1906166"><a href="/runtime/mprof.go.html#1863497">allgs</a></span><span class="op" id="1906171">)</span><span class="op" id="1906172">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1906175"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1906181">(</span><span class="op" id="1906182">&amp;</span><span class="ident" id="1906183"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2033596">allglock</a></span><span class="op" id="1906191">)</span><br>
<span class="lineno"></span><span class="op" id="1906193">}</span>
</div>
</body>
</html>
