<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7093570">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7093625">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7093679">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7093730">package</span>&nbsp;<span class="ident" id="7093738">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7093744">import</span>&nbsp;<span class="op" id="7093751">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7093754">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7093763">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7093772">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7093785">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7093796">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7093803">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="7093806">//&nbsp;TestEmpty&nbsp;tests&nbsp;that&nbsp;an&nbsp;empty&nbsp;payload&nbsp;still&nbsp;forms&nbsp;a&nbsp;valid&nbsp;GZIP&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="7093880">func</span>&nbsp;<span class="ident" id="7093885">TestEmpty</span><span class="op" id="7093894">(</span><span class="ident" id="7093895">t</span>&nbsp;<span class="op" id="7093897">*</span><span class="ident" id="7093898">testing</span><span class="op" id="7093905">.</span><span class="ident" id="7093906">T</span><span class="op" id="7093907">)</span>&nbsp;<span class="op" id="7093909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093912">buf</span>&nbsp;<span class="op" id="7093916">:=</span>&nbsp;<span class="builtinfunc" id="7093919">new</span><span class="op" id="7093922">(</span><span class="ident" id="7093923">bytes</span><span class="op" id="7093928">.</span><span class="ident" id="7093929">Buffer</span><span class="op" id="7093935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093939">if</span>&nbsp;<span class="ident" id="7093942">err</span>&nbsp;<span class="op" id="7093946">:=</span>&nbsp;<span class="ident" id="7093949">NewWriter</span><span class="op" id="7093958">(</span><span class="ident" id="7093959">buf</span><span class="op" id="7093962">)</span><span class="op" id="7093963">.</span><span class="ident" id="7093964">Close</span><span class="op" id="7093969">(</span><span class="op" id="7093970">)</span><span class="op" id="7093971">;</span>&nbsp;<span class="ident" id="7093973">err</span>&nbsp;<span class="op" id="7093977">!=</span>&nbsp;<span class="ident" id="7093980">nil</span>&nbsp;<span class="op" id="7093984">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093988">t</span><span class="op" id="7093989">.</span><span class="ident" id="7093990">Fatalf</span><span class="op" id="7093996">(</span><span class="string" id="7093997">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7094015">,</span>&nbsp;<span class="ident" id="7094017">err</span><span class="op" id="7094020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094027">r</span><span class="op" id="7094028">,</span>&nbsp;<span class="ident" id="7094030">err</span>&nbsp;<span class="op" id="7094034">:=</span>&nbsp;<span class="ident" id="7094037">NewReader</span><span class="op" id="7094046">(</span><span class="ident" id="7094047">buf</span><span class="op" id="7094050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094053">if</span>&nbsp;<span class="ident" id="7094056">err</span>&nbsp;<span class="op" id="7094060">!=</span>&nbsp;<span class="ident" id="7094063">nil</span>&nbsp;<span class="op" id="7094067">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094071">t</span><span class="op" id="7094072">.</span><span class="ident" id="7094073">Fatalf</span><span class="op" id="7094079">(</span><span class="string" id="7094080">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7094095">,</span>&nbsp;<span class="ident" id="7094097">err</span><span class="op" id="7094100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094106">b</span><span class="op" id="7094107">,</span>&nbsp;<span class="ident" id="7094109">err</span>&nbsp;<span class="op" id="7094113">:=</span>&nbsp;<span class="ident" id="7094116">ioutil</span><span class="op" id="7094122">.</span><span class="ident" id="7094123">ReadAll</span><span class="op" id="7094130">(</span><span class="ident" id="7094131">r</span><span class="op" id="7094132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094135">if</span>&nbsp;<span class="ident" id="7094138">err</span>&nbsp;<span class="op" id="7094142">!=</span>&nbsp;<span class="ident" id="7094145">nil</span>&nbsp;<span class="op" id="7094149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094153">t</span><span class="op" id="7094154">.</span><span class="ident" id="7094155">Fatalf</span><span class="op" id="7094161">(</span><span class="string" id="7094162">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7094175">,</span>&nbsp;<span class="ident" id="7094177">err</span><span class="op" id="7094180">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094186">if</span>&nbsp;<span class="builtinfunc" id="7094189">len</span><span class="op" id="7094192">(</span><span class="ident" id="7094193">b</span><span class="op" id="7094194">)</span>&nbsp;<span class="op" id="7094196">!=</span>&nbsp;<span class="num" id="7094199">0</span>&nbsp;<span class="op" id="7094201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094205">t</span><span class="op" id="7094206">.</span><span class="ident" id="7094207">Fatalf</span><span class="op" id="7094213">(</span><span class="string" id="7094214">&#34;got&nbsp;%d&nbsp;bytes,&nbsp;want&nbsp;0&#34;</span><span class="op" id="7094236">,</span>&nbsp;<span class="builtinfunc" id="7094238">len</span><span class="op" id="7094241">(</span><span class="ident" id="7094242">b</span><span class="op" id="7094243">)</span><span class="op" id="7094244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094250">if</span>&nbsp;<span class="ident" id="7094253">err</span>&nbsp;<span class="op" id="7094257">:=</span>&nbsp;<span class="ident" id="7094260">r</span><span class="op" id="7094261">.</span><span class="ident" id="7094262">Close</span><span class="op" id="7094267">(</span><span class="op" id="7094268">)</span><span class="op" id="7094269">;</span>&nbsp;<span class="ident" id="7094271">err</span>&nbsp;<span class="op" id="7094275">!=</span>&nbsp;<span class="ident" id="7094278">nil</span>&nbsp;<span class="op" id="7094282">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094286">t</span><span class="op" id="7094287">.</span><span class="ident" id="7094288">Fatalf</span><span class="op" id="7094294">(</span><span class="string" id="7094295">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="7094313">,</span>&nbsp;<span class="ident" id="7094315">err</span><span class="op" id="7094318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094321">}</span><br>
<span class="lineno"></span><span class="op" id="7094323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7094326">//&nbsp;TestRoundTrip&nbsp;tests&nbsp;that&nbsp;gzipping&nbsp;and&nbsp;then&nbsp;gunzipping&nbsp;is&nbsp;the&nbsp;identity</span><br>
<span class="lineno">40</span><span class="comment" id="7094399">//&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="7094412">func</span>&nbsp;<span class="ident" id="7094417">TestRoundTrip</span><span class="op" id="7094430">(</span><span class="ident" id="7094431">t</span>&nbsp;<span class="op" id="7094433">*</span><span class="ident" id="7094434">testing</span><span class="op" id="7094441">.</span><span class="ident" id="7094442">T</span><span class="op" id="7094443">)</span>&nbsp;<span class="op" id="7094445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094448">buf</span>&nbsp;<span class="op" id="7094452">:=</span>&nbsp;<span class="builtinfunc" id="7094455">new</span><span class="op" id="7094458">(</span><span class="ident" id="7094459">bytes</span><span class="op" id="7094464">.</span><span class="ident" id="7094465">Buffer</span><span class="op" id="7094471">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094475">w</span>&nbsp;<span class="op" id="7094477">:=</span>&nbsp;<span class="ident" id="7094480">NewWriter</span><span class="op" id="7094489">(</span><span class="ident" id="7094490">buf</span><span class="op" id="7094493">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094496">w</span><span class="op" id="7094497">.</span><span class="ident" id="7094498">Comment</span>&nbsp;<span class="op" id="7094506">=</span>&nbsp;<span class="string" id="7094508">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094519">w</span><span class="op" id="7094520">.</span><span class="ident" id="7094521">Extra</span>&nbsp;<span class="op" id="7094527">=</span>&nbsp;<span class="op" id="7094529">[</span><span class="op" id="7094530">]</span><span class="builtintype" id="7094531">byte</span><span class="op" id="7094535">(</span><span class="string" id="7094536">&#34;extra&#34;</span><span class="op" id="7094543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094546">w</span><span class="op" id="7094547">.</span><span class="ident" id="7094548">ModTime</span>&nbsp;<span class="op" id="7094556">=</span>&nbsp;<span class="ident" id="7094558">time</span><span class="op" id="7094562">.</span><span class="ident" id="7094563">Unix</span><span class="op" id="7094567">(</span><span class="num" id="7094568">1e8</span><span class="op" id="7094571">,</span>&nbsp;<span class="num" id="7094573">0</span><span class="op" id="7094574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094577">w</span><span class="op" id="7094578">.</span><span class="ident" id="7094579">Name</span>&nbsp;<span class="op" id="7094584">=</span>&nbsp;<span class="string" id="7094586">&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094594">if</span>&nbsp;<span class="ident" id="7094597">_</span><span class="op" id="7094598">,</span>&nbsp;<span class="ident" id="7094600">err</span>&nbsp;<span class="op" id="7094604">:=</span>&nbsp;<span class="ident" id="7094607">w</span><span class="op" id="7094608">.</span><span class="ident" id="7094609">Write</span><span class="op" id="7094614">(</span><span class="op" id="7094615">[</span><span class="op" id="7094616">]</span><span class="builtintype" id="7094617">byte</span><span class="op" id="7094621">(</span><span class="string" id="7094622">&#34;payload&#34;</span><span class="op" id="7094631">)</span><span class="op" id="7094632">)</span><span class="op" id="7094633">;</span>&nbsp;<span class="ident" id="7094635">err</span>&nbsp;<span class="op" id="7094639">!=</span>&nbsp;<span class="ident" id="7094642">nil</span>&nbsp;<span class="op" id="7094646">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094650">t</span><span class="op" id="7094651">.</span><span class="ident" id="7094652">Fatalf</span><span class="op" id="7094658">(</span><span class="string" id="7094659">&#34;Write:&nbsp;%v&#34;</span><span class="op" id="7094670">,</span>&nbsp;<span class="ident" id="7094672">err</span><span class="op" id="7094675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094681">if</span>&nbsp;<span class="ident" id="7094684">err</span>&nbsp;<span class="op" id="7094688">:=</span>&nbsp;<span class="ident" id="7094691">w</span><span class="op" id="7094692">.</span><span class="ident" id="7094693">Close</span><span class="op" id="7094698">(</span><span class="op" id="7094699">)</span><span class="op" id="7094700">;</span>&nbsp;<span class="ident" id="7094702">err</span>&nbsp;<span class="op" id="7094706">!=</span>&nbsp;<span class="ident" id="7094709">nil</span>&nbsp;<span class="op" id="7094713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094717">t</span><span class="op" id="7094718">.</span><span class="ident" id="7094719">Fatalf</span><span class="op" id="7094725">(</span><span class="string" id="7094726">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7094744">,</span>&nbsp;<span class="ident" id="7094746">err</span><span class="op" id="7094749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094752">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094756">r</span><span class="op" id="7094757">,</span>&nbsp;<span class="ident" id="7094759">err</span>&nbsp;<span class="op" id="7094763">:=</span>&nbsp;<span class="ident" id="7094766">NewReader</span><span class="op" id="7094775">(</span><span class="ident" id="7094776">buf</span><span class="op" id="7094779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094782">if</span>&nbsp;<span class="ident" id="7094785">err</span>&nbsp;<span class="op" id="7094789">!=</span>&nbsp;<span class="ident" id="7094792">nil</span>&nbsp;<span class="op" id="7094796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094800">t</span><span class="op" id="7094801">.</span><span class="ident" id="7094802">Fatalf</span><span class="op" id="7094808">(</span><span class="string" id="7094809">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7094824">,</span>&nbsp;<span class="ident" id="7094826">err</span><span class="op" id="7094829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094832">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094835">b</span><span class="op" id="7094836">,</span>&nbsp;<span class="ident" id="7094838">err</span>&nbsp;<span class="op" id="7094842">:=</span>&nbsp;<span class="ident" id="7094845">ioutil</span><span class="op" id="7094851">.</span><span class="ident" id="7094852">ReadAll</span><span class="op" id="7094859">(</span><span class="ident" id="7094860">r</span><span class="op" id="7094861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094864">if</span>&nbsp;<span class="ident" id="7094867">err</span>&nbsp;<span class="op" id="7094871">!=</span>&nbsp;<span class="ident" id="7094874">nil</span>&nbsp;<span class="op" id="7094878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094882">t</span><span class="op" id="7094883">.</span><span class="ident" id="7094884">Fatalf</span><span class="op" id="7094890">(</span><span class="string" id="7094891">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7094904">,</span>&nbsp;<span class="ident" id="7094906">err</span><span class="op" id="7094909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094915">if</span>&nbsp;<span class="builtintype" id="7094918">string</span><span class="op" id="7094924">(</span><span class="ident" id="7094925">b</span><span class="op" id="7094926">)</span>&nbsp;<span class="op" id="7094928">!=</span>&nbsp;<span class="string" id="7094931">&#34;payload&#34;</span>&nbsp;<span class="op" id="7094941">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094945">t</span><span class="op" id="7094946">.</span><span class="ident" id="7094947">Fatalf</span><span class="op" id="7094953">(</span><span class="string" id="7094954">&#34;payload&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7094978">,</span>&nbsp;<span class="builtintype" id="7094980">string</span><span class="op" id="7094986">(</span><span class="ident" id="7094987">b</span><span class="op" id="7094988">)</span><span class="op" id="7094989">,</span>&nbsp;<span class="string" id="7094991">&#34;payload&#34;</span><span class="op" id="7095000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095006">if</span>&nbsp;<span class="ident" id="7095009">r</span><span class="op" id="7095010">.</span><span class="ident" id="7095011">Comment</span>&nbsp;<span class="op" id="7095019">!=</span>&nbsp;<span class="string" id="7095022">&#34;comment&#34;</span>&nbsp;<span class="op" id="7095032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095036">t</span><span class="op" id="7095037">.</span><span class="ident" id="7095038">Fatalf</span><span class="op" id="7095044">(</span><span class="string" id="7095045">&#34;comment&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7095069">,</span>&nbsp;<span class="ident" id="7095071">r</span><span class="op" id="7095072">.</span><span class="ident" id="7095073">Comment</span><span class="op" id="7095080">,</span>&nbsp;<span class="string" id="7095082">&#34;comment&#34;</span><span class="op" id="7095091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095094">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095097">if</span>&nbsp;<span class="builtintype" id="7095100">string</span><span class="op" id="7095106">(</span><span class="ident" id="7095107">r</span><span class="op" id="7095108">.</span><span class="ident" id="7095109">Extra</span><span class="op" id="7095114">)</span>&nbsp;<span class="op" id="7095116">!=</span>&nbsp;<span class="string" id="7095119">&#34;extra&#34;</span>&nbsp;<span class="op" id="7095127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095131">t</span><span class="op" id="7095132">.</span><span class="ident" id="7095133">Fatalf</span><span class="op" id="7095139">(</span><span class="string" id="7095140">&#34;extra&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7095162">,</span>&nbsp;<span class="ident" id="7095164">r</span><span class="op" id="7095165">.</span><span class="ident" id="7095166">Extra</span><span class="op" id="7095171">,</span>&nbsp;<span class="string" id="7095173">&#34;extra&#34;</span><span class="op" id="7095180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095186">if</span>&nbsp;<span class="ident" id="7095189">r</span><span class="op" id="7095190">.</span><span class="ident" id="7095191">ModTime</span><span class="op" id="7095198">.</span><span class="ident" id="7095199">Unix</span><span class="op" id="7095203">(</span><span class="op" id="7095204">)</span>&nbsp;<span class="op" id="7095206">!=</span>&nbsp;<span class="num" id="7095209">1e8</span>&nbsp;<span class="op" id="7095213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095217">t</span><span class="op" id="7095218">.</span><span class="ident" id="7095219">Fatalf</span><span class="op" id="7095225">(</span><span class="string" id="7095226">&#34;mtime&nbsp;is&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7095248">,</span>&nbsp;<span class="ident" id="7095250">r</span><span class="op" id="7095251">.</span><span class="ident" id="7095252">ModTime</span><span class="op" id="7095259">.</span><span class="ident" id="7095260">Unix</span><span class="op" id="7095264">(</span><span class="op" id="7095265">)</span><span class="op" id="7095266">,</span>&nbsp;<span class="builtintype" id="7095268">uint32</span><span class="op" id="7095274">(</span><span class="num" id="7095275">1e8</span><span class="op" id="7095278">)</span><span class="op" id="7095279">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095285">if</span>&nbsp;<span class="ident" id="7095288">r</span><span class="op" id="7095289">.</span><span class="ident" id="7095290">Name</span>&nbsp;<span class="op" id="7095295">!=</span>&nbsp;<span class="string" id="7095298">&#34;name&#34;</span>&nbsp;<span class="op" id="7095305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095309">t</span><span class="op" id="7095310">.</span><span class="ident" id="7095311">Fatalf</span><span class="op" id="7095317">(</span><span class="string" id="7095318">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7095339">,</span>&nbsp;<span class="ident" id="7095341">r</span><span class="op" id="7095342">.</span><span class="ident" id="7095343">Name</span><span class="op" id="7095347">,</span>&nbsp;<span class="string" id="7095349">&#34;name&#34;</span><span class="op" id="7095355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095361">if</span>&nbsp;<span class="ident" id="7095364">err</span>&nbsp;<span class="op" id="7095368">:=</span>&nbsp;<span class="ident" id="7095371">r</span><span class="op" id="7095372">.</span><span class="ident" id="7095373">Close</span><span class="op" id="7095378">(</span><span class="op" id="7095379">)</span><span class="op" id="7095380">;</span>&nbsp;<span class="ident" id="7095382">err</span>&nbsp;<span class="op" id="7095386">!=</span>&nbsp;<span class="ident" id="7095389">nil</span>&nbsp;<span class="op" id="7095393">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095397">t</span><span class="op" id="7095398">.</span><span class="ident" id="7095399">Fatalf</span><span class="op" id="7095405">(</span><span class="string" id="7095406">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="7095424">,</span>&nbsp;<span class="ident" id="7095426">err</span><span class="op" id="7095429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095432">}</span><br>
<span class="lineno"></span><span class="op" id="7095434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7095437">//&nbsp;TestLatin1&nbsp;tests&nbsp;the&nbsp;internal&nbsp;functions&nbsp;for&nbsp;converting&nbsp;to&nbsp;and&nbsp;from&nbsp;Latin-1.</span><br>
<span class="lineno">85</span><span class="keyword" id="7095516">func</span>&nbsp;<span class="ident" id="7095521">TestLatin1</span><span class="op" id="7095531">(</span><span class="ident" id="7095532">t</span>&nbsp;<span class="op" id="7095534">*</span><span class="ident" id="7095535">testing</span><span class="op" id="7095542">.</span><span class="ident" id="7095543">T</span><span class="op" id="7095544">)</span>&nbsp;<span class="op" id="7095546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095549">latin1</span>&nbsp;<span class="op" id="7095556">:=</span>&nbsp;<span class="op" id="7095559">[</span><span class="op" id="7095560">]</span><span class="builtintype" id="7095561">byte</span><span class="op" id="7095565">{</span><span class="num" id="7095566">0xc4</span><span class="op" id="7095570">,</span>&nbsp;<span class="string" id="7095572">&#39;u&#39;</span><span class="op" id="7095575">,</span>&nbsp;<span class="num" id="7095577">0xdf</span><span class="op" id="7095581">,</span>&nbsp;<span class="string" id="7095583">&#39;e&#39;</span><span class="op" id="7095586">,</span>&nbsp;<span class="string" id="7095588">&#39;r&#39;</span><span class="op" id="7095591">,</span>&nbsp;<span class="string" id="7095593">&#39;u&#39;</span><span class="op" id="7095596">,</span>&nbsp;<span class="string" id="7095598">&#39;n&#39;</span><span class="op" id="7095601">,</span>&nbsp;<span class="string" id="7095603">&#39;g&#39;</span><span class="op" id="7095606">,</span>&nbsp;<span class="num" id="7095608">0</span><span class="op" id="7095609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095612">utf8</span>&nbsp;<span class="op" id="7095617">:=</span>&nbsp;<span class="string" id="7095620">&#34;Äußerung&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095634">z</span>&nbsp;<span class="op" id="7095636">:=</span>&nbsp;<span class="ident" id="7095639">Reader</span><span class="op" id="7095645">{</span><span class="ident" id="7095646">r</span><span class="op" id="7095647">:</span>&nbsp;<span class="ident" id="7095649">bufio</span><span class="op" id="7095654">.</span><span class="ident" id="7095655">NewReader</span><span class="op" id="7095664">(</span><span class="ident" id="7095665">bytes</span><span class="op" id="7095670">.</span><span class="ident" id="7095671">NewReader</span><span class="op" id="7095680">(</span><span class="ident" id="7095681">latin1</span><span class="op" id="7095687">)</span><span class="op" id="7095688">)</span><span class="op" id="7095689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095692">s</span><span class="op" id="7095693">,</span>&nbsp;<span class="ident" id="7095695">err</span>&nbsp;<span class="op" id="7095699">:=</span>&nbsp;<span class="ident" id="7095702">z</span><span class="op" id="7095703">.</span><span class="ident" id="7095704">readString</span><span class="op" id="7095714">(</span><span class="op" id="7095715">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095718">if</span>&nbsp;<span class="ident" id="7095721">err</span>&nbsp;<span class="op" id="7095725">!=</span>&nbsp;<span class="ident" id="7095728">nil</span>&nbsp;<span class="op" id="7095732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095736">t</span><span class="op" id="7095737">.</span><span class="ident" id="7095738">Fatalf</span><span class="op" id="7095744">(</span><span class="string" id="7095745">&#34;readString:&nbsp;%v&#34;</span><span class="op" id="7095761">,</span>&nbsp;<span class="ident" id="7095763">err</span><span class="op" id="7095766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095772">if</span>&nbsp;<span class="ident" id="7095775">s</span>&nbsp;<span class="op" id="7095777">!=</span>&nbsp;<span class="ident" id="7095780">utf8</span>&nbsp;<span class="op" id="7095785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095789">t</span><span class="op" id="7095790">.</span><span class="ident" id="7095791">Fatalf</span><span class="op" id="7095797">(</span><span class="string" id="7095798">&#34;read&nbsp;latin-1:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7095829">,</span>&nbsp;<span class="ident" id="7095831">s</span><span class="op" id="7095832">,</span>&nbsp;<span class="ident" id="7095834">utf8</span><span class="op" id="7095838">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095845">buf</span>&nbsp;<span class="op" id="7095849">:=</span>&nbsp;<span class="ident" id="7095852">bytes</span><span class="op" id="7095857">.</span><span class="ident" id="7095858">NewBuffer</span><span class="op" id="7095867">(</span><span class="builtinfunc" id="7095868">make</span><span class="op" id="7095872">(</span><span class="op" id="7095873">[</span><span class="op" id="7095874">]</span><span class="builtintype" id="7095875">byte</span><span class="op" id="7095879">,</span>&nbsp;<span class="num" id="7095881">0</span><span class="op" id="7095882">,</span>&nbsp;<span class="builtinfunc" id="7095884">len</span><span class="op" id="7095887">(</span><span class="ident" id="7095888">latin1</span><span class="op" id="7095894">)</span><span class="op" id="7095895">)</span><span class="op" id="7095896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095899">c</span>&nbsp;<span class="op" id="7095901">:=</span>&nbsp;<span class="ident" id="7095904">Writer</span><span class="op" id="7095910">{</span><span class="ident" id="7095911">w</span><span class="op" id="7095912">:</span>&nbsp;<span class="ident" id="7095914">buf</span><span class="op" id="7095917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095920">if</span>&nbsp;<span class="ident" id="7095923">err</span>&nbsp;<span class="op" id="7095927">=</span>&nbsp;<span class="ident" id="7095929">c</span><span class="op" id="7095930">.</span><span class="ident" id="7095931">writeString</span><span class="op" id="7095942">(</span><span class="ident" id="7095943">utf8</span><span class="op" id="7095947">)</span><span class="op" id="7095948">;</span>&nbsp;<span class="ident" id="7095950">err</span>&nbsp;<span class="op" id="7095954">!=</span>&nbsp;<span class="ident" id="7095957">nil</span>&nbsp;<span class="op" id="7095961">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095965">t</span><span class="op" id="7095966">.</span><span class="ident" id="7095967">Fatalf</span><span class="op" id="7095973">(</span><span class="string" id="7095974">&#34;writeString:&nbsp;%v&#34;</span><span class="op" id="7095991">,</span>&nbsp;<span class="ident" id="7095993">err</span><span class="op" id="7095996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096002">s</span>&nbsp;<span class="op" id="7096004">=</span>&nbsp;<span class="ident" id="7096006">buf</span><span class="op" id="7096009">.</span><span class="ident" id="7096010">String</span><span class="op" id="7096016">(</span><span class="op" id="7096017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096020">if</span>&nbsp;<span class="ident" id="7096023">s</span>&nbsp;<span class="op" id="7096025">!=</span>&nbsp;<span class="builtintype" id="7096028">string</span><span class="op" id="7096034">(</span><span class="ident" id="7096035">latin1</span><span class="op" id="7096041">)</span>&nbsp;<span class="op" id="7096043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096047">t</span><span class="op" id="7096048">.</span><span class="ident" id="7096049">Fatalf</span><span class="op" id="7096055">(</span><span class="string" id="7096056">&#34;write&nbsp;utf-8:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7096086">,</span>&nbsp;<span class="ident" id="7096088">s</span><span class="op" id="7096089">,</span>&nbsp;<span class="builtintype" id="7096091">string</span><span class="op" id="7096097">(</span><span class="ident" id="7096098">latin1</span><span class="op" id="7096104">)</span><span class="op" id="7096105">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096108">}</span><br>
<span class="lineno"></span><span class="op" id="7096110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7096113">//&nbsp;TestLatin1RoundTrip&nbsp;tests&nbsp;that&nbsp;metadata&nbsp;that&nbsp;is&nbsp;representable&nbsp;in&nbsp;Latin-1</span><br>
<span class="lineno"></span><span class="comment" id="7096189">//&nbsp;survives&nbsp;a&nbsp;round&nbsp;trip.</span><br>
<span class="lineno">110</span><span class="keyword" id="7096215">func</span>&nbsp;<span class="ident" id="7096220">TestLatin1RoundTrip</span><span class="op" id="7096239">(</span><span class="ident" id="7096240">t</span>&nbsp;<span class="op" id="7096242">*</span><span class="ident" id="7096243">testing</span><span class="op" id="7096250">.</span><span class="ident" id="7096251">T</span><span class="op" id="7096252">)</span>&nbsp;<span class="op" id="7096254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096257">testCases</span>&nbsp;<span class="op" id="7096267">:=</span>&nbsp;<span class="op" id="7096270">[</span><span class="op" id="7096271">]</span><span class="keyword" id="7096272">struct</span>&nbsp;<span class="op" id="7096279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096283">name</span>&nbsp;<span class="builtintype" id="7096288">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096297">ok</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7096302">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096308">}</span><span class="op" id="7096309">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096313">{</span><span class="string" id="7096314">&#34;&#34;</span><span class="op" id="7096316">,</span>&nbsp;<span class="builtintype" id="7096318">true</span><span class="op" id="7096322">}</span><span class="op" id="7096323">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096327">{</span><span class="string" id="7096328">&#34;ASCII&nbsp;is&nbsp;OK&#34;</span><span class="op" id="7096341">,</span>&nbsp;<span class="builtintype" id="7096343">true</span><span class="op" id="7096347">}</span><span class="op" id="7096348">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096352">{</span><span class="string" id="7096353">&#34;unless&nbsp;it&nbsp;contains&nbsp;a&nbsp;NUL\x00&#34;</span><span class="op" id="7096383">,</span>&nbsp;<span class="builtintype" id="7096385">false</span><span class="op" id="7096390">}</span><span class="op" id="7096391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096395">{</span><span class="string" id="7096396">&#34;no&nbsp;matter&nbsp;where&nbsp;\x00&nbsp;occurs&#34;</span><span class="op" id="7096425">,</span>&nbsp;<span class="builtintype" id="7096427">false</span><span class="op" id="7096432">}</span><span class="op" id="7096433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096437">{</span><span class="string" id="7096438">&#34;\x00\x00\x00&#34;</span><span class="op" id="7096452">,</span>&nbsp;<span class="builtintype" id="7096454">false</span><span class="op" id="7096459">}</span><span class="op" id="7096460">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096464">{</span><span class="string" id="7096465">&#34;Látin-1&nbsp;also&nbsp;passes&nbsp;(U+00E1)&#34;</span><span class="op" id="7096496">,</span>&nbsp;<span class="builtintype" id="7096498">true</span><span class="op" id="7096502">}</span><span class="op" id="7096503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096507">{</span><span class="string" id="7096508">&#34;but&nbsp;LĀtin&nbsp;Extended-A&nbsp;(U+0100)&nbsp;does&nbsp;not&#34;</span><span class="op" id="7096549">,</span>&nbsp;<span class="builtintype" id="7096551">false</span><span class="op" id="7096556">}</span><span class="op" id="7096557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096561">{</span><span class="string" id="7096562">&#34;neither&nbsp;does&nbsp;日本語&#34;</span><span class="op" id="7096586">,</span>&nbsp;<span class="builtintype" id="7096588">false</span><span class="op" id="7096593">}</span><span class="op" id="7096594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096598">{</span><span class="string" id="7096599">&#34;invalid&nbsp;UTF-8&nbsp;also&nbsp;\xffails&#34;</span><span class="op" id="7096628">,</span>&nbsp;<span class="builtintype" id="7096630">false</span><span class="op" id="7096635">}</span><span class="op" id="7096636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096640">{</span><span class="string" id="7096641">&#34;\x00&nbsp;as&nbsp;does&nbsp;Látin-1&nbsp;with&nbsp;NUL&#34;</span><span class="op" id="7096673">,</span>&nbsp;<span class="builtintype" id="7096675">false</span><span class="op" id="7096680">}</span><span class="op" id="7096681">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096687">for</span>&nbsp;<span class="ident" id="7096691">_</span><span class="op" id="7096692">,</span>&nbsp;<span class="ident" id="7096694">tc</span>&nbsp;<span class="op" id="7096697">:=</span>&nbsp;<span class="keyword" id="7096700">range</span>&nbsp;<span class="ident" id="7096706">testCases</span>&nbsp;<span class="op" id="7096716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096720">buf</span>&nbsp;<span class="op" id="7096724">:=</span>&nbsp;<span class="builtinfunc" id="7096727">new</span><span class="op" id="7096730">(</span><span class="ident" id="7096731">bytes</span><span class="op" id="7096736">.</span><span class="ident" id="7096737">Buffer</span><span class="op" id="7096743">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096748">w</span>&nbsp;<span class="op" id="7096750">:=</span>&nbsp;<span class="ident" id="7096753">NewWriter</span><span class="op" id="7096762">(</span><span class="ident" id="7096763">buf</span><span class="op" id="7096766">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096770">w</span><span class="op" id="7096771">.</span><span class="ident" id="7096772">Name</span>&nbsp;<span class="op" id="7096777">=</span>&nbsp;<span class="ident" id="7096779">tc</span><span class="op" id="7096781">.</span><span class="ident" id="7096782">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096789">err</span>&nbsp;<span class="op" id="7096793">:=</span>&nbsp;<span class="ident" id="7096796">w</span><span class="op" id="7096797">.</span><span class="ident" id="7096798">Close</span><span class="op" id="7096803">(</span><span class="op" id="7096804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096808">if</span>&nbsp;<span class="op" id="7096811">(</span><span class="ident" id="7096812">err</span>&nbsp;<span class="op" id="7096816">==</span>&nbsp;<span class="ident" id="7096819">nil</span><span class="op" id="7096822">)</span>&nbsp;<span class="op" id="7096824">!=</span>&nbsp;<span class="ident" id="7096827">tc</span><span class="op" id="7096829">.</span><span class="ident" id="7096830">ok</span>&nbsp;<span class="op" id="7096833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096838">t</span><span class="op" id="7096839">.</span><span class="ident" id="7096840">Errorf</span><span class="op" id="7096846">(</span><span class="string" id="7096847">&#34;Writer.Close:&nbsp;name&nbsp;=&nbsp;%q,&nbsp;err&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7096882">,</span>&nbsp;<span class="ident" id="7096884">tc</span><span class="op" id="7096886">.</span><span class="ident" id="7096887">name</span><span class="op" id="7096891">,</span>&nbsp;<span class="ident" id="7096893">err</span><span class="op" id="7096896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096901">continue</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096916">if</span>&nbsp;<span class="op" id="7096919">!</span><span class="ident" id="7096920">tc</span><span class="op" id="7096922">.</span><span class="ident" id="7096923">ok</span>&nbsp;<span class="op" id="7096926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096931">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096947">r</span><span class="op" id="7096948">,</span>&nbsp;<span class="ident" id="7096950">err</span>&nbsp;<span class="op" id="7096954">:=</span>&nbsp;<span class="ident" id="7096957">NewReader</span><span class="op" id="7096966">(</span><span class="ident" id="7096967">buf</span><span class="op" id="7096970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096974">if</span>&nbsp;<span class="ident" id="7096977">err</span>&nbsp;<span class="op" id="7096981">!=</span>&nbsp;<span class="ident" id="7096984">nil</span>&nbsp;<span class="op" id="7096988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096993">t</span><span class="op" id="7096994">.</span><span class="ident" id="7096995">Errorf</span><span class="op" id="7097001">(</span><span class="string" id="7097002">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7097017">,</span>&nbsp;<span class="ident" id="7097019">err</span><span class="op" id="7097022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097027">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097038">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097042">_</span><span class="op" id="7097043">,</span>&nbsp;<span class="ident" id="7097045">err</span>&nbsp;<span class="op" id="7097049">=</span>&nbsp;<span class="ident" id="7097051">ioutil</span><span class="op" id="7097057">.</span><span class="ident" id="7097058">ReadAll</span><span class="op" id="7097065">(</span><span class="ident" id="7097066">r</span><span class="op" id="7097067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097071">if</span>&nbsp;<span class="ident" id="7097074">err</span>&nbsp;<span class="op" id="7097078">!=</span>&nbsp;<span class="ident" id="7097081">nil</span>&nbsp;<span class="op" id="7097085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097090">t</span><span class="op" id="7097091">.</span><span class="ident" id="7097092">Errorf</span><span class="op" id="7097098">(</span><span class="string" id="7097099">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="7097112">,</span>&nbsp;<span class="ident" id="7097114">err</span><span class="op" id="7097117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097122">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097133">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097137">if</span>&nbsp;<span class="ident" id="7097140">r</span><span class="op" id="7097141">.</span><span class="ident" id="7097142">Name</span>&nbsp;<span class="op" id="7097147">!=</span>&nbsp;<span class="ident" id="7097150">tc</span><span class="op" id="7097152">.</span><span class="ident" id="7097153">name</span>&nbsp;<span class="op" id="7097158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097163">t</span><span class="op" id="7097164">.</span><span class="ident" id="7097165">Errorf</span><span class="op" id="7097171">(</span><span class="string" id="7097172">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7097193">,</span>&nbsp;<span class="ident" id="7097195">r</span><span class="op" id="7097196">.</span><span class="ident" id="7097197">Name</span><span class="op" id="7097201">,</span>&nbsp;<span class="ident" id="7097203">tc</span><span class="op" id="7097205">.</span><span class="ident" id="7097206">name</span><span class="op" id="7097210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097215">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097230">if</span>&nbsp;<span class="ident" id="7097233">err</span>&nbsp;<span class="op" id="7097237">:=</span>&nbsp;<span class="ident" id="7097240">r</span><span class="op" id="7097241">.</span><span class="ident" id="7097242">Close</span><span class="op" id="7097247">(</span><span class="op" id="7097248">)</span><span class="op" id="7097249">;</span>&nbsp;<span class="ident" id="7097251">err</span>&nbsp;<span class="op" id="7097255">!=</span>&nbsp;<span class="ident" id="7097258">nil</span>&nbsp;<span class="op" id="7097262">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097267">t</span><span class="op" id="7097268">.</span><span class="ident" id="7097269">Errorf</span><span class="op" id="7097275">(</span><span class="string" id="7097276">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="7097294">,</span>&nbsp;<span class="ident" id="7097296">err</span><span class="op" id="7097299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097304">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097318">}</span><br>
<span class="lineno"></span><span class="op" id="7097320">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="7097323">func</span>&nbsp;<span class="ident" id="7097328">TestWriterFlush</span><span class="op" id="7097343">(</span><span class="ident" id="7097344">t</span>&nbsp;<span class="op" id="7097346">*</span><span class="ident" id="7097347">testing</span><span class="op" id="7097354">.</span><span class="ident" id="7097355">T</span><span class="op" id="7097356">)</span>&nbsp;<span class="op" id="7097358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097361">buf</span>&nbsp;<span class="op" id="7097365">:=</span>&nbsp;<span class="builtinfunc" id="7097368">new</span><span class="op" id="7097371">(</span><span class="ident" id="7097372">bytes</span><span class="op" id="7097377">.</span><span class="ident" id="7097378">Buffer</span><span class="op" id="7097384">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097388">w</span>&nbsp;<span class="op" id="7097390">:=</span>&nbsp;<span class="ident" id="7097393">NewWriter</span><span class="op" id="7097402">(</span><span class="ident" id="7097403">buf</span><span class="op" id="7097406">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097409">w</span><span class="op" id="7097410">.</span><span class="ident" id="7097411">Comment</span>&nbsp;<span class="op" id="7097419">=</span>&nbsp;<span class="string" id="7097421">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097432">w</span><span class="op" id="7097433">.</span><span class="ident" id="7097434">Extra</span>&nbsp;<span class="op" id="7097440">=</span>&nbsp;<span class="op" id="7097442">[</span><span class="op" id="7097443">]</span><span class="builtintype" id="7097444">byte</span><span class="op" id="7097448">(</span><span class="string" id="7097449">&#34;extra&#34;</span><span class="op" id="7097456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097459">w</span><span class="op" id="7097460">.</span><span class="ident" id="7097461">ModTime</span>&nbsp;<span class="op" id="7097469">=</span>&nbsp;<span class="ident" id="7097471">time</span><span class="op" id="7097475">.</span><span class="ident" id="7097476">Unix</span><span class="op" id="7097480">(</span><span class="num" id="7097481">1e8</span><span class="op" id="7097484">,</span>&nbsp;<span class="num" id="7097486">0</span><span class="op" id="7097487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097490">w</span><span class="op" id="7097491">.</span><span class="ident" id="7097492">Name</span>&nbsp;<span class="op" id="7097497">=</span>&nbsp;<span class="string" id="7097499">&#34;name&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097508">n0</span>&nbsp;<span class="op" id="7097511">:=</span>&nbsp;<span class="ident" id="7097514">buf</span><span class="op" id="7097517">.</span><span class="ident" id="7097518">Len</span><span class="op" id="7097521">(</span><span class="op" id="7097522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097525">if</span>&nbsp;<span class="ident" id="7097528">n0</span>&nbsp;<span class="op" id="7097531">!=</span>&nbsp;<span class="num" id="7097534">0</span>&nbsp;<span class="op" id="7097536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097540">t</span><span class="op" id="7097541">.</span><span class="ident" id="7097542">Fatalf</span><span class="op" id="7097548">(</span><span class="string" id="7097549">&#34;buffer&nbsp;size&nbsp;=&nbsp;%d&nbsp;before&nbsp;writes;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7097589">,</span>&nbsp;<span class="ident" id="7097591">n0</span><span class="op" id="7097593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097600">if</span>&nbsp;<span class="ident" id="7097603">err</span>&nbsp;<span class="op" id="7097607">:=</span>&nbsp;<span class="ident" id="7097610">w</span><span class="op" id="7097611">.</span><span class="ident" id="7097612">Flush</span><span class="op" id="7097617">(</span><span class="op" id="7097618">)</span><span class="op" id="7097619">;</span>&nbsp;<span class="ident" id="7097621">err</span>&nbsp;<span class="op" id="7097625">!=</span>&nbsp;<span class="ident" id="7097628">nil</span>&nbsp;<span class="op" id="7097632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097636">t</span><span class="op" id="7097637">.</span><span class="ident" id="7097638">Fatal</span><span class="op" id="7097643">(</span><span class="ident" id="7097644">err</span><span class="op" id="7097647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097654">n1</span>&nbsp;<span class="op" id="7097657">:=</span>&nbsp;<span class="ident" id="7097660">buf</span><span class="op" id="7097663">.</span><span class="ident" id="7097664">Len</span><span class="op" id="7097667">(</span><span class="op" id="7097668">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097671">if</span>&nbsp;<span class="ident" id="7097674">n1</span>&nbsp;<span class="op" id="7097677">==</span>&nbsp;<span class="num" id="7097680">0</span>&nbsp;<span class="op" id="7097682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097686">t</span><span class="op" id="7097687">.</span><span class="ident" id="7097688">Fatal</span><span class="op" id="7097693">(</span><span class="string" id="7097694">&#34;no&nbsp;data&nbsp;after&nbsp;first&nbsp;flush&#34;</span><span class="op" id="7097721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097728">w</span><span class="op" id="7097729">.</span><span class="ident" id="7097730">Write</span><span class="op" id="7097735">(</span><span class="op" id="7097736">[</span><span class="op" id="7097737">]</span><span class="builtintype" id="7097738">byte</span><span class="op" id="7097742">(</span><span class="string" id="7097743">&#34;x&#34;</span><span class="op" id="7097746">)</span><span class="op" id="7097747">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097751">n2</span>&nbsp;<span class="op" id="7097754">:=</span>&nbsp;<span class="ident" id="7097757">buf</span><span class="op" id="7097760">.</span><span class="ident" id="7097761">Len</span><span class="op" id="7097764">(</span><span class="op" id="7097765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097768">if</span>&nbsp;<span class="ident" id="7097771">n1</span>&nbsp;<span class="op" id="7097774">!=</span>&nbsp;<span class="ident" id="7097777">n2</span>&nbsp;<span class="op" id="7097780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097784">t</span><span class="op" id="7097785">.</span><span class="ident" id="7097786">Fatalf</span><span class="op" id="7097792">(</span><span class="string" id="7097793">&#34;after&nbsp;writing&nbsp;a&nbsp;single&nbsp;byte,&nbsp;size&nbsp;changed&nbsp;from&nbsp;%d&nbsp;to&nbsp;%d;&nbsp;want&nbsp;no&nbsp;change&#34;</span><span class="op" id="7097866">,</span>&nbsp;<span class="ident" id="7097868">n1</span><span class="op" id="7097870">,</span>&nbsp;<span class="ident" id="7097872">n2</span><span class="op" id="7097874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097877">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097881">if</span>&nbsp;<span class="ident" id="7097884">err</span>&nbsp;<span class="op" id="7097888">:=</span>&nbsp;<span class="ident" id="7097891">w</span><span class="op" id="7097892">.</span><span class="ident" id="7097893">Flush</span><span class="op" id="7097898">(</span><span class="op" id="7097899">)</span><span class="op" id="7097900">;</span>&nbsp;<span class="ident" id="7097902">err</span>&nbsp;<span class="op" id="7097906">!=</span>&nbsp;<span class="ident" id="7097909">nil</span>&nbsp;<span class="op" id="7097913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097917">t</span><span class="op" id="7097918">.</span><span class="ident" id="7097919">Fatal</span><span class="op" id="7097924">(</span><span class="ident" id="7097925">err</span><span class="op" id="7097928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097935">n3</span>&nbsp;<span class="op" id="7097938">:=</span>&nbsp;<span class="ident" id="7097941">buf</span><span class="op" id="7097944">.</span><span class="ident" id="7097945">Len</span><span class="op" id="7097948">(</span><span class="op" id="7097949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097952">if</span>&nbsp;<span class="ident" id="7097955">n2</span>&nbsp;<span class="op" id="7097958">==</span>&nbsp;<span class="ident" id="7097961">n3</span>&nbsp;<span class="op" id="7097964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097968">t</span><span class="op" id="7097969">.</span><span class="ident" id="7097970">Fatal</span><span class="op" id="7097975">(</span><span class="string" id="7097976">&#34;Flush&nbsp;didn&#39;t&nbsp;flush&nbsp;any&nbsp;data&#34;</span><span class="op" id="7098005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098008">}</span><br>
<span class="lineno"></span><span class="op" id="7098010">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="7098013">//&nbsp;Multiple&nbsp;gzip&nbsp;files&nbsp;concatenated&nbsp;form&nbsp;a&nbsp;valid&nbsp;gzip&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="7098073">func</span>&nbsp;<span class="ident" id="7098078">TestConcat</span><span class="op" id="7098088">(</span><span class="ident" id="7098089">t</span>&nbsp;<span class="op" id="7098091">*</span><span class="ident" id="7098092">testing</span><span class="op" id="7098099">.</span><span class="ident" id="7098100">T</span><span class="op" id="7098101">)</span>&nbsp;<span class="op" id="7098103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7098106">var</span>&nbsp;<span class="ident" id="7098110">buf</span>&nbsp;<span class="ident" id="7098114">bytes</span><span class="op" id="7098119">.</span><span class="ident" id="7098120">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098128">w</span>&nbsp;<span class="op" id="7098130">:=</span>&nbsp;<span class="ident" id="7098133">NewWriter</span><span class="op" id="7098142">(</span><span class="op" id="7098143">&amp;</span><span class="ident" id="7098144">buf</span><span class="op" id="7098147">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098150">w</span><span class="op" id="7098151">.</span><span class="ident" id="7098152">Write</span><span class="op" id="7098157">(</span><span class="op" id="7098158">[</span><span class="op" id="7098159">]</span><span class="builtintype" id="7098160">byte</span><span class="op" id="7098164">(</span><span class="string" id="7098165">&#34;hello&nbsp;&#34;</span><span class="op" id="7098173">)</span><span class="op" id="7098174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098177">w</span><span class="op" id="7098178">.</span><span class="ident" id="7098179">Close</span><span class="op" id="7098184">(</span><span class="op" id="7098185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098188">w</span>&nbsp;<span class="op" id="7098190">=</span>&nbsp;<span class="ident" id="7098192">NewWriter</span><span class="op" id="7098201">(</span><span class="op" id="7098202">&amp;</span><span class="ident" id="7098203">buf</span><span class="op" id="7098206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098209">w</span><span class="op" id="7098210">.</span><span class="ident" id="7098211">Write</span><span class="op" id="7098216">(</span><span class="op" id="7098217">[</span><span class="op" id="7098218">]</span><span class="builtintype" id="7098219">byte</span><span class="op" id="7098223">(</span><span class="string" id="7098224">&#34;world\n&#34;</span><span class="op" id="7098233">)</span><span class="op" id="7098234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098237">w</span><span class="op" id="7098238">.</span><span class="ident" id="7098239">Close</span><span class="op" id="7098244">(</span><span class="op" id="7098245">)</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098249">r</span><span class="op" id="7098250">,</span>&nbsp;<span class="ident" id="7098252">err</span>&nbsp;<span class="op" id="7098256">:=</span>&nbsp;<span class="ident" id="7098259">NewReader</span><span class="op" id="7098268">(</span><span class="op" id="7098269">&amp;</span><span class="ident" id="7098270">buf</span><span class="op" id="7098273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098276">data</span><span class="op" id="7098280">,</span>&nbsp;<span class="ident" id="7098282">err</span>&nbsp;<span class="op" id="7098286">:=</span>&nbsp;<span class="ident" id="7098289">ioutil</span><span class="op" id="7098295">.</span><span class="ident" id="7098296">ReadAll</span><span class="op" id="7098303">(</span><span class="ident" id="7098304">r</span><span class="op" id="7098305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7098308">if</span>&nbsp;<span class="builtintype" id="7098311">string</span><span class="op" id="7098317">(</span><span class="ident" id="7098318">data</span><span class="op" id="7098322">)</span>&nbsp;<span class="op" id="7098324">!=</span>&nbsp;<span class="string" id="7098327">&#34;hello&nbsp;world\n&#34;</span>&nbsp;<span class="op" id="7098343">||</span>&nbsp;<span class="ident" id="7098346">err</span>&nbsp;<span class="op" id="7098350">!=</span>&nbsp;<span class="ident" id="7098353">nil</span>&nbsp;<span class="op" id="7098357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098361">t</span><span class="op" id="7098362">.</span><span class="ident" id="7098363">Fatalf</span><span class="op" id="7098369">(</span><span class="string" id="7098370">&#34;ReadAll&nbsp;=&nbsp;%q,&nbsp;%v,&nbsp;want&nbsp;%q,&nbsp;nil&#34;</span><span class="op" id="7098402">,</span>&nbsp;<span class="ident" id="7098404">data</span><span class="op" id="7098408">,</span>&nbsp;<span class="ident" id="7098410">err</span><span class="op" id="7098413">,</span>&nbsp;<span class="string" id="7098415">&#34;hello&nbsp;world&#34;</span><span class="op" id="7098428">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098431">}</span><br>
<span class="lineno"></span><span class="op" id="7098433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7098436">func</span>&nbsp;<span class="ident" id="7098441">TestWriterReset</span><span class="op" id="7098456">(</span><span class="ident" id="7098457">t</span>&nbsp;<span class="op" id="7098459">*</span><span class="ident" id="7098460">testing</span><span class="op" id="7098467">.</span><span class="ident" id="7098468">T</span><span class="op" id="7098469">)</span>&nbsp;<span class="op" id="7098471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098474">buf</span>&nbsp;<span class="op" id="7098478">:=</span>&nbsp;<span class="builtinfunc" id="7098481">new</span><span class="op" id="7098484">(</span><span class="ident" id="7098485">bytes</span><span class="op" id="7098490">.</span><span class="ident" id="7098491">Buffer</span><span class="op" id="7098497">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098500">buf2</span>&nbsp;<span class="op" id="7098505">:=</span>&nbsp;<span class="builtinfunc" id="7098508">new</span><span class="op" id="7098511">(</span><span class="ident" id="7098512">bytes</span><span class="op" id="7098517">.</span><span class="ident" id="7098518">Buffer</span><span class="op" id="7098524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098527">z</span>&nbsp;<span class="op" id="7098529">:=</span>&nbsp;<span class="ident" id="7098532">NewWriter</span><span class="op" id="7098541">(</span><span class="ident" id="7098542">buf</span><span class="op" id="7098545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098548">msg</span>&nbsp;<span class="op" id="7098552">:=</span>&nbsp;<span class="op" id="7098555">[</span><span class="op" id="7098556">]</span><span class="builtintype" id="7098557">byte</span><span class="op" id="7098561">(</span><span class="string" id="7098562">&#34;hello&nbsp;world&#34;</span><span class="op" id="7098575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098578">z</span><span class="op" id="7098579">.</span><span class="ident" id="7098580">Write</span><span class="op" id="7098585">(</span><span class="ident" id="7098586">msg</span><span class="op" id="7098589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098592">z</span><span class="op" id="7098593">.</span><span class="ident" id="7098594">Close</span><span class="op" id="7098599">(</span><span class="op" id="7098600">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098603">z</span><span class="op" id="7098604">.</span><span class="ident" id="7098605">Reset</span><span class="op" id="7098610">(</span><span class="ident" id="7098611">buf2</span><span class="op" id="7098615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098618">z</span><span class="op" id="7098619">.</span><span class="ident" id="7098620">Write</span><span class="op" id="7098625">(</span><span class="ident" id="7098626">msg</span><span class="op" id="7098629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098632">z</span><span class="op" id="7098633">.</span><span class="ident" id="7098634">Close</span><span class="op" id="7098639">(</span><span class="op" id="7098640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7098643">if</span>&nbsp;<span class="ident" id="7098646">buf</span><span class="op" id="7098649">.</span><span class="ident" id="7098650">String</span><span class="op" id="7098656">(</span><span class="op" id="7098657">)</span>&nbsp;<span class="op" id="7098659">!=</span>&nbsp;<span class="ident" id="7098662">buf2</span><span class="op" id="7098666">.</span><span class="ident" id="7098667">String</span><span class="op" id="7098673">(</span><span class="op" id="7098674">)</span>&nbsp;<span class="op" id="7098676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098680">t</span><span class="op" id="7098681">.</span><span class="ident" id="7098682">Errorf</span><span class="op" id="7098688">(</span><span class="string" id="7098689">&#34;buf2&nbsp;%q&nbsp;!=&nbsp;original&nbsp;buf&nbsp;of&nbsp;%q&#34;</span><span class="op" id="7098720">,</span>&nbsp;<span class="ident" id="7098722">buf2</span><span class="op" id="7098726">.</span><span class="ident" id="7098727">String</span><span class="op" id="7098733">(</span><span class="op" id="7098734">)</span><span class="op" id="7098735">,</span>&nbsp;<span class="ident" id="7098737">buf</span><span class="op" id="7098740">.</span><span class="ident" id="7098741">String</span><span class="op" id="7098747">(</span><span class="op" id="7098748">)</span><span class="op" id="7098749">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098752">}</span><br>
<span class="lineno"></span><span class="op" id="7098754">}</span>
</div>
</body>
</html>
