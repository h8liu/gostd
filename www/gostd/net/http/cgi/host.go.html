<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5513759">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5513814">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5513868">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5513919">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;host&nbsp;side&nbsp;of&nbsp;CGI&nbsp;(being&nbsp;the&nbsp;webserver</span><br>
<span class="lineno"></span><span class="comment" id="5513985">//&nbsp;parent&nbsp;process).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5514006">//&nbsp;Package&nbsp;cgi&nbsp;implements&nbsp;CGI&nbsp;(Common&nbsp;Gateway&nbsp;Interface)&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="5514076">//&nbsp;in&nbsp;RFC&nbsp;3875.</span><br>
<span class="lineno">10</span><span class="comment" id="5514092">//</span><br>
<span class="lineno"></span><span class="comment" id="5514095">//&nbsp;Note&nbsp;that&nbsp;using&nbsp;CGI&nbsp;means&nbsp;starting&nbsp;a&nbsp;new&nbsp;process&nbsp;to&nbsp;handle&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="5514162">//&nbsp;request,&nbsp;which&nbsp;is&nbsp;typically&nbsp;less&nbsp;efficient&nbsp;than&nbsp;using&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5514221">//&nbsp;long-running&nbsp;server.&nbsp;&nbsp;This&nbsp;package&nbsp;is&nbsp;intended&nbsp;primarily&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5514285">//&nbsp;compatibility&nbsp;with&nbsp;existing&nbsp;systems.</span><br>
<span class="lineno">15</span><span class="keyword" id="5514325">package</span>&nbsp;<span class="ident" id="5514333">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5514338">import</span>&nbsp;<span class="op" id="5514345">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514348">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514357">&#34;fmt&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514364">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514370">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514377">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514389">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514395">&#34;os/exec&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514406">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514423">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514433">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514444">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514455">&#34;strings&#34;</span><br>
<span class="lineno">30</span><span class="op" id="5514465">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5514468">var</span>&nbsp;<span class="ident" id="5514472">trailingPort</span>&nbsp;<span class="op" id="5514485">=</span>&nbsp;<span class="ident" id="5514487">regexp</span><span class="op" id="5514493">.</span><span class="ident" id="5514494">MustCompile</span><span class="op" id="5514505">(</span><span class="string" id="5514506">`:([0-9]+)$`</span><span class="op" id="5514518">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5514521">var</span>&nbsp;<span class="ident" id="5514525">osDefaultInheritEnv</span>&nbsp;<span class="op" id="5514545">=</span>&nbsp;<span class="keyword" id="5514547">map</span><span class="op" id="5514550">[</span><span class="builtintype" id="5514551">string</span><span class="op" id="5514557">]</span><span class="op" id="5514558">[</span><span class="op" id="5514559">]</span><span class="builtintype" id="5514560">string</span><span class="op" id="5514566">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514569">&#34;darwin&#34;</span><span class="op" id="5514577">:</span>&nbsp;&nbsp;<span class="op" id="5514580">{</span><span class="string" id="5514581">&#34;DYLD_LIBRARY_PATH&#34;</span><span class="op" id="5514600">}</span><span class="op" id="5514601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514604">&#34;freebsd&#34;</span><span class="op" id="5514613">:</span>&nbsp;<span class="op" id="5514615">{</span><span class="string" id="5514616">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5514633">}</span><span class="op" id="5514634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514637">&#34;hpux&#34;</span><span class="op" id="5514643">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514648">{</span><span class="string" id="5514649">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5514666">,</span>&nbsp;<span class="string" id="5514668">&#34;SHLIB_PATH&#34;</span><span class="op" id="5514680">}</span><span class="op" id="5514681">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514684">&#34;irix&#34;</span><span class="op" id="5514690">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514695">{</span><span class="string" id="5514696">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5514713">,</span>&nbsp;<span class="string" id="5514715">&#34;LD_LIBRARYN32_PATH&#34;</span><span class="op" id="5514735">,</span>&nbsp;<span class="string" id="5514737">&#34;LD_LIBRARY64_PATH&#34;</span><span class="op" id="5514756">}</span><span class="op" id="5514757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514760">&#34;linux&#34;</span><span class="op" id="5514767">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5514771">{</span><span class="string" id="5514772">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5514789">}</span><span class="op" id="5514790">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514793">&#34;openbsd&#34;</span><span class="op" id="5514802">:</span>&nbsp;<span class="op" id="5514804">{</span><span class="string" id="5514805">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5514822">}</span><span class="op" id="5514823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514826">&#34;solaris&#34;</span><span class="op" id="5514835">:</span>&nbsp;<span class="op" id="5514837">{</span><span class="string" id="5514838">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5514855">,</span>&nbsp;<span class="string" id="5514857">&#34;LD_LIBRARY_PATH_32&#34;</span><span class="op" id="5514877">,</span>&nbsp;<span class="string" id="5514879">&#34;LD_LIBRARY_PATH_64&#34;</span><span class="op" id="5514899">}</span><span class="op" id="5514900">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5514903">&#34;windows&#34;</span><span class="op" id="5514912">:</span>&nbsp;<span class="op" id="5514914">{</span><span class="string" id="5514915">&#34;SystemRoot&#34;</span><span class="op" id="5514927">,</span>&nbsp;<span class="string" id="5514929">&#34;COMSPEC&#34;</span><span class="op" id="5514938">,</span>&nbsp;<span class="string" id="5514940">&#34;PATHEXT&#34;</span><span class="op" id="5514949">,</span>&nbsp;<span class="string" id="5514951">&#34;WINDIR&#34;</span><span class="op" id="5514959">}</span><span class="op" id="5514960">,</span><br>
<span class="lineno"></span><span class="op" id="5514962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5514965">//&nbsp;Handler&nbsp;runs&nbsp;an&nbsp;executable&nbsp;in&nbsp;a&nbsp;subprocess&nbsp;with&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="keyword" id="5515035">type</span>&nbsp;<span class="ident" id="5515040">Handler</span>&nbsp;<span class="keyword" id="5515048">struct</span>&nbsp;<span class="op" id="5515055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515058">Path</span>&nbsp;<span class="builtintype" id="5515063">string</span>&nbsp;<span class="comment" id="5515070">//&nbsp;path&nbsp;to&nbsp;the&nbsp;CGI&nbsp;executable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515101">Root</span>&nbsp;<span class="builtintype" id="5515106">string</span>&nbsp;<span class="comment" id="5515113">//&nbsp;root&nbsp;URI&nbsp;prefix&nbsp;of&nbsp;handler&nbsp;or&nbsp;empty&nbsp;for&nbsp;&#34;/&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515162">//&nbsp;Dir&nbsp;specifies&nbsp;the&nbsp;CGI&nbsp;executable&#39;s&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515220">//&nbsp;If&nbsp;Dir&nbsp;is&nbsp;empty,&nbsp;the&nbsp;base&nbsp;directory&nbsp;of&nbsp;Path&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515277">//&nbsp;If&nbsp;Path&nbsp;has&nbsp;no&nbsp;base&nbsp;directory,&nbsp;the&nbsp;current&nbsp;working</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515332">//&nbsp;directory&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515355">Dir</span>&nbsp;<span class="builtintype" id="5515359">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515368">Env</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515379">[</span><span class="op" id="5515380">]</span><span class="builtintype" id="5515381">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515391">//&nbsp;extra&nbsp;environment&nbsp;variables&nbsp;to&nbsp;set,&nbsp;if&nbsp;any,&nbsp;as&nbsp;&#34;key=value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515454">InheritEnv</span>&nbsp;<span class="op" id="5515465">[</span><span class="op" id="5515466">]</span><span class="builtintype" id="5515467">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515477">//&nbsp;environment&nbsp;variables&nbsp;to&nbsp;inherit&nbsp;from&nbsp;host,&nbsp;as&nbsp;&#34;key&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515534">Logger</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515545">*</span><span class="ident" id="5515546">log</span><span class="op" id="5515549">.</span><span class="ident" id="5515550">Logger</span>&nbsp;<span class="comment" id="5515557">//&nbsp;optional&nbsp;log&nbsp;for&nbsp;errors&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;log.Print</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515609">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515620">[</span><span class="op" id="5515621">]</span><span class="builtintype" id="5515622">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515632">//&nbsp;optional&nbsp;arguments&nbsp;to&nbsp;pass&nbsp;to&nbsp;child&nbsp;process</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515681">//&nbsp;PathLocationHandler&nbsp;specifies&nbsp;the&nbsp;root&nbsp;http&nbsp;Handler&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515742">//&nbsp;should&nbsp;handle&nbsp;internal&nbsp;redirects&nbsp;when&nbsp;the&nbsp;CGI&nbsp;process</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515800">//&nbsp;returns&nbsp;a&nbsp;Location&nbsp;header&nbsp;value&nbsp;starting&nbsp;with&nbsp;a&nbsp;&#34;/&#34;,&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515860">//&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;3875&nbsp;ยง&nbsp;6.3.2.&nbsp;This&nbsp;will&nbsp;likely&nbsp;be</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515916">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515942">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515946">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;CGI&nbsp;response&nbsp;with&nbsp;a&nbsp;local&nbsp;URI&nbsp;path&nbsp;is&nbsp;instead&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5516011">//&nbsp;back&nbsp;to&nbsp;the&nbsp;client&nbsp;and&nbsp;not&nbsp;redirected&nbsp;internally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516065">PathLocationHandler</span>&nbsp;<span class="ident" id="5516085">http</span><span class="op" id="5516089">.</span><span class="ident" id="5516090">Handler</span><br>
<span class="lineno">70</span><span class="op" id="5516098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5516101">//&nbsp;removeLeadingDuplicates&nbsp;remove&nbsp;leading&nbsp;duplicate&nbsp;in&nbsp;environments.</span><br>
<span class="lineno"></span><span class="comment" id="5516170">//&nbsp;It&#39;s&nbsp;possible&nbsp;to&nbsp;override&nbsp;environment&nbsp;like&nbsp;following.</span><br>
<span class="lineno"></span><span class="comment" id="5516227">//&nbsp;&nbsp;&nbsp;&nbsp;cgi.Handler{</span><br>
<span class="lineno">75</span><span class="comment" id="5516246">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5516258">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Env:&nbsp;[]string{&#34;SCRIPT_FILENAME=foo.php&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="5516308">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="5516316">func</span>&nbsp;<span class="ident" id="5516321">removeLeadingDuplicates</span><span class="op" id="5516344">(</span><span class="ident" id="5516345">env</span>&nbsp;<span class="op" id="5516349">[</span><span class="op" id="5516350">]</span><span class="builtintype" id="5516351">string</span><span class="op" id="5516357">)</span>&nbsp;<span class="op" id="5516359">(</span><span class="ident" id="5516360">ret</span>&nbsp;<span class="op" id="5516364">[</span><span class="op" id="5516365">]</span><span class="builtintype" id="5516366">string</span><span class="op" id="5516372">)</span>&nbsp;<span class="op" id="5516374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516377">n</span>&nbsp;<span class="op" id="5516379">:=</span>&nbsp;<span class="builtinfunc" id="5516382">len</span><span class="op" id="5516385">(</span><span class="ident" id="5516386">env</span><span class="op" id="5516389">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516392">for</span>&nbsp;<span class="ident" id="5516396">i</span>&nbsp;<span class="op" id="5516398">:=</span>&nbsp;<span class="num" id="5516401">0</span><span class="op" id="5516402">;</span>&nbsp;<span class="ident" id="5516404">i</span>&nbsp;<span class="op" id="5516406">&lt;</span>&nbsp;<span class="ident" id="5516408">n</span><span class="op" id="5516409">;</span>&nbsp;<span class="ident" id="5516411">i</span><span class="op" id="5516412">++</span>&nbsp;<span class="op" id="5516415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516419">e</span>&nbsp;<span class="op" id="5516421">:=</span>&nbsp;<span class="ident" id="5516424">env</span><span class="op" id="5516427">[</span><span class="ident" id="5516428">i</span><span class="op" id="5516429">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516433">s</span>&nbsp;<span class="op" id="5516435">:=</span>&nbsp;<span class="ident" id="5516438">strings</span><span class="op" id="5516445">.</span><span class="ident" id="5516446">SplitN</span><span class="op" id="5516452">(</span><span class="ident" id="5516453">e</span><span class="op" id="5516454">,</span>&nbsp;<span class="string" id="5516456">&#34;=&#34;</span><span class="op" id="5516459">,</span>&nbsp;<span class="num" id="5516461">2</span><span class="op" id="5516462">)</span><span class="op" id="5516463">[</span><span class="num" id="5516464">0</span><span class="op" id="5516465">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516469">found</span>&nbsp;<span class="op" id="5516475">:=</span>&nbsp;<span class="builtintype" id="5516478">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516486">for</span>&nbsp;<span class="ident" id="5516490">j</span>&nbsp;<span class="op" id="5516492">:=</span>&nbsp;<span class="ident" id="5516495">i</span>&nbsp;<span class="op" id="5516497">+</span>&nbsp;<span class="num" id="5516499">1</span><span class="op" id="5516500">;</span>&nbsp;<span class="ident" id="5516502">j</span>&nbsp;<span class="op" id="5516504">&lt;</span>&nbsp;<span class="ident" id="5516506">n</span><span class="op" id="5516507">;</span>&nbsp;<span class="ident" id="5516509">j</span><span class="op" id="5516510">++</span>&nbsp;<span class="op" id="5516513">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516518">if</span>&nbsp;<span class="ident" id="5516521">s</span>&nbsp;<span class="op" id="5516523">==</span>&nbsp;<span class="ident" id="5516526">strings</span><span class="op" id="5516533">.</span><span class="ident" id="5516534">SplitN</span><span class="op" id="5516540">(</span><span class="ident" id="5516541">env</span><span class="op" id="5516544">[</span><span class="ident" id="5516545">j</span><span class="op" id="5516546">]</span><span class="op" id="5516547">,</span>&nbsp;<span class="string" id="5516549">&#34;=&#34;</span><span class="op" id="5516552">,</span>&nbsp;<span class="num" id="5516554">2</span><span class="op" id="5516555">)</span><span class="op" id="5516556">[</span><span class="num" id="5516557">0</span><span class="op" id="5516558">]</span>&nbsp;<span class="op" id="5516560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516566">found</span>&nbsp;<span class="op" id="5516572">=</span>&nbsp;<span class="builtintype" id="5516574">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516583">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516596">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516600">if</span>&nbsp;<span class="op" id="5516603">!</span><span class="ident" id="5516604">found</span>&nbsp;<span class="op" id="5516610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516615">ret</span>&nbsp;<span class="op" id="5516619">=</span>&nbsp;<span class="builtinfunc" id="5516621">append</span><span class="op" id="5516627">(</span><span class="ident" id="5516628">ret</span><span class="op" id="5516631">,</span>&nbsp;<span class="ident" id="5516633">e</span><span class="op" id="5516634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516644">return</span><br>
<span class="lineno">95</span><span class="op" id="5516651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5516654">func</span>&nbsp;<span class="op" id="5516659">(</span><span class="ident" id="5516660">h</span>&nbsp;<span class="op" id="5516662">*</span><span class="ident" id="5516663">Handler</span><span class="op" id="5516670">)</span>&nbsp;<span class="ident" id="5516672">ServeHTTP</span><span class="op" id="5516681">(</span><span class="ident" id="5516682">rw</span>&nbsp;<span class="ident" id="5516685">http</span><span class="op" id="5516689">.</span><span class="ident" id="5516690">ResponseWriter</span><span class="op" id="5516704">,</span>&nbsp;<span class="ident" id="5516706">req</span>&nbsp;<span class="op" id="5516710">*</span><span class="ident" id="5516711">http</span><span class="op" id="5516715">.</span><span class="ident" id="5516716">Request</span><span class="op" id="5516723">)</span>&nbsp;<span class="op" id="5516725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516728">root</span>&nbsp;<span class="op" id="5516733">:=</span>&nbsp;<span class="ident" id="5516736">h</span><span class="op" id="5516737">.</span><span class="ident" id="5516738">Root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516744">if</span>&nbsp;<span class="ident" id="5516747">root</span>&nbsp;<span class="op" id="5516752">==</span>&nbsp;<span class="string" id="5516755">&#34;&#34;</span>&nbsp;<span class="op" id="5516758">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516762">root</span>&nbsp;<span class="op" id="5516767">=</span>&nbsp;<span class="string" id="5516769">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516778">if</span>&nbsp;<span class="builtinfunc" id="5516781">len</span><span class="op" id="5516784">(</span><span class="ident" id="5516785">req</span><span class="op" id="5516788">.</span><span class="ident" id="5516789">TransferEncoding</span><span class="op" id="5516805">)</span>&nbsp;<span class="op" id="5516807">&gt;</span>&nbsp;<span class="num" id="5516809">0</span>&nbsp;<span class="op" id="5516811">&amp;&amp;</span>&nbsp;<span class="ident" id="5516814">req</span><span class="op" id="5516817">.</span><span class="ident" id="5516818">TransferEncoding</span><span class="op" id="5516834">[</span><span class="num" id="5516835">0</span><span class="op" id="5516836">]</span>&nbsp;<span class="op" id="5516838">==</span>&nbsp;<span class="string" id="5516841">&#34;chunked&#34;</span>&nbsp;<span class="op" id="5516851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516855">rw</span><span class="op" id="5516857">.</span><span class="ident" id="5516858">WriteHeader</span><span class="op" id="5516869">(</span><span class="ident" id="5516870">http</span><span class="op" id="5516874">.</span><span class="ident" id="5516875">StatusBadRequest</span><span class="op" id="5516891">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516895">rw</span><span class="op" id="5516897">.</span><span class="ident" id="5516898">Write</span><span class="op" id="5516903">(</span><span class="op" id="5516904">[</span><span class="op" id="5516905">]</span><span class="builtintype" id="5516906">byte</span><span class="op" id="5516910">(</span><span class="string" id="5516911">&#34;Chunked&nbsp;request&nbsp;bodies&nbsp;are&nbsp;not&nbsp;supported&nbsp;by&nbsp;CGI.&#34;</span><span class="op" id="5516961">)</span><span class="op" id="5516962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516966">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516978">pathInfo</span>&nbsp;<span class="op" id="5516987">:=</span>&nbsp;<span class="ident" id="5516990">req</span><span class="op" id="5516993">.</span><span class="ident" id="5516994">URL</span><span class="op" id="5516997">.</span><span class="ident" id="5516998">Path</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517004">if</span>&nbsp;<span class="ident" id="5517007">root</span>&nbsp;<span class="op" id="5517012">!=</span>&nbsp;<span class="string" id="5517015">&#34;/&#34;</span>&nbsp;<span class="op" id="5517019">&amp;&amp;</span>&nbsp;<span class="ident" id="5517022">strings</span><span class="op" id="5517029">.</span><span class="ident" id="5517030">HasPrefix</span><span class="op" id="5517039">(</span><span class="ident" id="5517040">pathInfo</span><span class="op" id="5517048">,</span>&nbsp;<span class="ident" id="5517050">root</span><span class="op" id="5517054">)</span>&nbsp;<span class="op" id="5517056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517060">pathInfo</span>&nbsp;<span class="op" id="5517069">=</span>&nbsp;<span class="ident" id="5517071">pathInfo</span><span class="op" id="5517079">[</span><span class="builtinfunc" id="5517080">len</span><span class="op" id="5517083">(</span><span class="ident" id="5517084">root</span><span class="op" id="5517088">)</span><span class="op" id="5517089">:</span><span class="op" id="5517090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517097">port</span>&nbsp;<span class="op" id="5517102">:=</span>&nbsp;<span class="string" id="5517105">&#34;80&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517111">if</span>&nbsp;<span class="ident" id="5517114">matches</span>&nbsp;<span class="op" id="5517122">:=</span>&nbsp;<span class="ident" id="5517125">trailingPort</span><span class="op" id="5517137">.</span><span class="ident" id="5517138">FindStringSubmatch</span><span class="op" id="5517156">(</span><span class="ident" id="5517157">req</span><span class="op" id="5517160">.</span><span class="ident" id="5517161">Host</span><span class="op" id="5517165">)</span><span class="op" id="5517166">;</span>&nbsp;<span class="builtinfunc" id="5517168">len</span><span class="op" id="5517171">(</span><span class="ident" id="5517172">matches</span><span class="op" id="5517179">)</span>&nbsp;<span class="op" id="5517181">!=</span>&nbsp;<span class="num" id="5517184">0</span>&nbsp;<span class="op" id="5517186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517190">port</span>&nbsp;<span class="op" id="5517195">=</span>&nbsp;<span class="ident" id="5517197">matches</span><span class="op" id="5517204">[</span><span class="num" id="5517205">1</span><span class="op" id="5517206">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517213">env</span>&nbsp;<span class="op" id="5517217">:=</span>&nbsp;<span class="op" id="5517220">[</span><span class="op" id="5517221">]</span><span class="builtintype" id="5517222">string</span><span class="op" id="5517228">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517232">&#34;SERVER_SOFTWARE=go&#34;</span><span class="op" id="5517252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517256">&#34;SERVER_NAME=&#34;</span>&nbsp;<span class="op" id="5517271">+</span>&nbsp;<span class="ident" id="5517273">req</span><span class="op" id="5517276">.</span><span class="ident" id="5517277">Host</span><span class="op" id="5517281">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517285">&#34;SERVER_PROTOCOL=HTTP/1.1&#34;</span><span class="op" id="5517311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517315">&#34;HTTP_HOST=&#34;</span>&nbsp;<span class="op" id="5517328">+</span>&nbsp;<span class="ident" id="5517330">req</span><span class="op" id="5517333">.</span><span class="ident" id="5517334">Host</span><span class="op" id="5517338">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517342">&#34;GATEWAY_INTERFACE=CGI/1.1&#34;</span><span class="op" id="5517369">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517373">&#34;REQUEST_METHOD=&#34;</span>&nbsp;<span class="op" id="5517391">+</span>&nbsp;<span class="ident" id="5517393">req</span><span class="op" id="5517396">.</span><span class="ident" id="5517397">Method</span><span class="op" id="5517403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517407">&#34;QUERY_STRING=&#34;</span>&nbsp;<span class="op" id="5517423">+</span>&nbsp;<span class="ident" id="5517425">req</span><span class="op" id="5517428">.</span><span class="ident" id="5517429">URL</span><span class="op" id="5517432">.</span><span class="ident" id="5517433">RawQuery</span><span class="op" id="5517441">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517445">&#34;REQUEST_URI=&#34;</span>&nbsp;<span class="op" id="5517460">+</span>&nbsp;<span class="ident" id="5517462">req</span><span class="op" id="5517465">.</span><span class="ident" id="5517466">URL</span><span class="op" id="5517469">.</span><span class="ident" id="5517470">RequestURI</span><span class="op" id="5517480">(</span><span class="op" id="5517481">)</span><span class="op" id="5517482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517486">&#34;PATH_INFO=&#34;</span>&nbsp;<span class="op" id="5517499">+</span>&nbsp;<span class="ident" id="5517501">pathInfo</span><span class="op" id="5517509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517513">&#34;SCRIPT_NAME=&#34;</span>&nbsp;<span class="op" id="5517528">+</span>&nbsp;<span class="ident" id="5517530">root</span><span class="op" id="5517534">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517538">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="5517557">+</span>&nbsp;<span class="ident" id="5517559">h</span><span class="op" id="5517560">.</span><span class="ident" id="5517561">Path</span><span class="op" id="5517565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517569">&#34;REMOTE_ADDR=&#34;</span>&nbsp;<span class="op" id="5517584">+</span>&nbsp;<span class="ident" id="5517586">req</span><span class="op" id="5517589">.</span><span class="ident" id="5517590">RemoteAddr</span><span class="op" id="5517600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517604">&#34;REMOTE_HOST=&#34;</span>&nbsp;<span class="op" id="5517619">+</span>&nbsp;<span class="ident" id="5517621">req</span><span class="op" id="5517624">.</span><span class="ident" id="5517625">RemoteAddr</span><span class="op" id="5517635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5517639">&#34;SERVER_PORT=&#34;</span>&nbsp;<span class="op" id="5517654">+</span>&nbsp;<span class="ident" id="5517656">port</span><span class="op" id="5517660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517663">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517667">if</span>&nbsp;<span class="ident" id="5517670">req</span><span class="op" id="5517673">.</span><span class="ident" id="5517674">TLS</span>&nbsp;<span class="op" id="5517678">!=</span>&nbsp;<span class="ident" id="5517681">nil</span>&nbsp;<span class="op" id="5517685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517689">env</span>&nbsp;<span class="op" id="5517693">=</span>&nbsp;<span class="builtinfunc" id="5517695">append</span><span class="op" id="5517701">(</span><span class="ident" id="5517702">env</span><span class="op" id="5517705">,</span>&nbsp;<span class="string" id="5517707">&#34;HTTPS=on&#34;</span><span class="op" id="5517717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517724">for</span>&nbsp;<span class="ident" id="5517728">k</span><span class="op" id="5517729">,</span>&nbsp;<span class="ident" id="5517731">v</span>&nbsp;<span class="op" id="5517733">:=</span>&nbsp;<span class="keyword" id="5517736">range</span>&nbsp;<span class="ident" id="5517742">req</span><span class="op" id="5517745">.</span><span class="ident" id="5517746">Header</span>&nbsp;<span class="op" id="5517753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517757">k</span>&nbsp;<span class="op" id="5517759">=</span>&nbsp;<span class="ident" id="5517761">strings</span><span class="op" id="5517768">.</span><span class="ident" id="5517769">Map</span><span class="op" id="5517772">(</span><span class="ident" id="5517773">upperCaseAndUnderscore</span><span class="op" id="5517795">,</span>&nbsp;<span class="ident" id="5517797">k</span><span class="op" id="5517798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517802">joinStr</span>&nbsp;<span class="op" id="5517810">:=</span>&nbsp;<span class="string" id="5517813">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517820">if</span>&nbsp;<span class="ident" id="5517823">k</span>&nbsp;<span class="op" id="5517825">==</span>&nbsp;<span class="string" id="5517828">&#34;COOKIE&#34;</span>&nbsp;<span class="op" id="5517837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517842">joinStr</span>&nbsp;<span class="op" id="5517850">=</span>&nbsp;<span class="string" id="5517852">&#34;;&nbsp;&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517863">env</span>&nbsp;<span class="op" id="5517867">=</span>&nbsp;<span class="builtinfunc" id="5517869">append</span><span class="op" id="5517875">(</span><span class="ident" id="5517876">env</span><span class="op" id="5517879">,</span>&nbsp;<span class="string" id="5517881">&#34;HTTP_&#34;</span><span class="op" id="5517888">+</span><span class="ident" id="5517889">k</span><span class="op" id="5517890">+</span><span class="string" id="5517891">&#34;=&#34;</span><span class="op" id="5517894">+</span><span class="ident" id="5517895">strings</span><span class="op" id="5517902">.</span><span class="ident" id="5517903">Join</span><span class="op" id="5517907">(</span><span class="ident" id="5517908">v</span><span class="op" id="5517909">,</span>&nbsp;<span class="ident" id="5517911">joinStr</span><span class="op" id="5517918">)</span><span class="op" id="5517919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517926">if</span>&nbsp;<span class="ident" id="5517929">req</span><span class="op" id="5517932">.</span><span class="ident" id="5517933">ContentLength</span>&nbsp;<span class="op" id="5517947">&gt;</span>&nbsp;<span class="num" id="5517949">0</span>&nbsp;<span class="op" id="5517951">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517955">env</span>&nbsp;<span class="op" id="5517959">=</span>&nbsp;<span class="builtinfunc" id="5517961">append</span><span class="op" id="5517967">(</span><span class="ident" id="5517968">env</span><span class="op" id="5517971">,</span>&nbsp;<span class="ident" id="5517973">fmt</span><span class="op" id="5517976">.</span><span class="ident" id="5517977">Sprintf</span><span class="op" id="5517984">(</span><span class="string" id="5517985">&#34;CONTENT_LENGTH=%d&#34;</span><span class="op" id="5518004">,</span>&nbsp;<span class="ident" id="5518006">req</span><span class="op" id="5518009">.</span><span class="ident" id="5518010">ContentLength</span><span class="op" id="5518023">)</span><span class="op" id="5518024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518030">if</span>&nbsp;<span class="ident" id="5518033">ctype</span>&nbsp;<span class="op" id="5518039">:=</span>&nbsp;<span class="ident" id="5518042">req</span><span class="op" id="5518045">.</span><span class="ident" id="5518046">Header</span><span class="op" id="5518052">.</span><span class="ident" id="5518053">Get</span><span class="op" id="5518056">(</span><span class="string" id="5518057">&#34;Content-Type&#34;</span><span class="op" id="5518071">)</span><span class="op" id="5518072">;</span>&nbsp;<span class="ident" id="5518074">ctype</span>&nbsp;<span class="op" id="5518080">!=</span>&nbsp;<span class="string" id="5518083">&#34;&#34;</span>&nbsp;<span class="op" id="5518086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518090">env</span>&nbsp;<span class="op" id="5518094">=</span>&nbsp;<span class="builtinfunc" id="5518096">append</span><span class="op" id="5518102">(</span><span class="ident" id="5518103">env</span><span class="op" id="5518106">,</span>&nbsp;<span class="string" id="5518108">&#34;CONTENT_TYPE=&#34;</span><span class="op" id="5518123">+</span><span class="ident" id="5518124">ctype</span><span class="op" id="5518129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518132">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518136">if</span>&nbsp;<span class="ident" id="5518139">h</span><span class="op" id="5518140">.</span><span class="ident" id="5518141">Env</span>&nbsp;<span class="op" id="5518145">!=</span>&nbsp;<span class="ident" id="5518148">nil</span>&nbsp;<span class="op" id="5518152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518156">env</span>&nbsp;<span class="op" id="5518160">=</span>&nbsp;<span class="builtinfunc" id="5518162">append</span><span class="op" id="5518168">(</span><span class="ident" id="5518169">env</span><span class="op" id="5518172">,</span>&nbsp;<span class="ident" id="5518174">h</span><span class="op" id="5518175">.</span><span class="ident" id="5518176">Env</span><span class="op" id="5518179">...</span><span class="op" id="5518182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518189">envPath</span>&nbsp;<span class="op" id="5518197">:=</span>&nbsp;<span class="ident" id="5518200">os</span><span class="op" id="5518202">.</span><span class="ident" id="5518203">Getenv</span><span class="op" id="5518209">(</span><span class="string" id="5518210">&#34;PATH&#34;</span><span class="op" id="5518216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518219">if</span>&nbsp;<span class="ident" id="5518222">envPath</span>&nbsp;<span class="op" id="5518230">==</span>&nbsp;<span class="string" id="5518233">&#34;&#34;</span>&nbsp;<span class="op" id="5518236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518240">envPath</span>&nbsp;<span class="op" id="5518248">=</span>&nbsp;<span class="string" id="5518250">&#34;/bin:/usr/bin:/usr/ucb:/usr/bsd:/usr/local/bin&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518303">env</span>&nbsp;<span class="op" id="5518307">=</span>&nbsp;<span class="builtinfunc" id="5518309">append</span><span class="op" id="5518315">(</span><span class="ident" id="5518316">env</span><span class="op" id="5518319">,</span>&nbsp;<span class="string" id="5518321">&#34;PATH=&#34;</span><span class="op" id="5518328">+</span><span class="ident" id="5518329">envPath</span><span class="op" id="5518336">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518340">for</span>&nbsp;<span class="ident" id="5518344">_</span><span class="op" id="5518345">,</span>&nbsp;<span class="ident" id="5518347">e</span>&nbsp;<span class="op" id="5518349">:=</span>&nbsp;<span class="keyword" id="5518352">range</span>&nbsp;<span class="ident" id="5518358">h</span><span class="op" id="5518359">.</span><span class="ident" id="5518360">InheritEnv</span>&nbsp;<span class="op" id="5518371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518375">if</span>&nbsp;<span class="ident" id="5518378">v</span>&nbsp;<span class="op" id="5518380">:=</span>&nbsp;<span class="ident" id="5518383">os</span><span class="op" id="5518385">.</span><span class="ident" id="5518386">Getenv</span><span class="op" id="5518392">(</span><span class="ident" id="5518393">e</span><span class="op" id="5518394">)</span><span class="op" id="5518395">;</span>&nbsp;<span class="ident" id="5518397">v</span>&nbsp;<span class="op" id="5518399">!=</span>&nbsp;<span class="string" id="5518402">&#34;&#34;</span>&nbsp;<span class="op" id="5518405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518410">env</span>&nbsp;<span class="op" id="5518414">=</span>&nbsp;<span class="builtinfunc" id="5518416">append</span><span class="op" id="5518422">(</span><span class="ident" id="5518423">env</span><span class="op" id="5518426">,</span>&nbsp;<span class="ident" id="5518428">e</span><span class="op" id="5518429">+</span><span class="string" id="5518430">&#34;=&#34;</span><span class="op" id="5518433">+</span><span class="ident" id="5518434">v</span><span class="op" id="5518435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518439">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518446">for</span>&nbsp;<span class="ident" id="5518450">_</span><span class="op" id="5518451">,</span>&nbsp;<span class="ident" id="5518453">e</span>&nbsp;<span class="op" id="5518455">:=</span>&nbsp;<span class="keyword" id="5518458">range</span>&nbsp;<span class="ident" id="5518464">osDefaultInheritEnv</span><span class="op" id="5518483">[</span><span class="ident" id="5518484">runtime</span><span class="op" id="5518491">.</span><span class="ident" id="5518492">GOOS</span><span class="op" id="5518496">]</span>&nbsp;<span class="op" id="5518498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518502">if</span>&nbsp;<span class="ident" id="5518505">v</span>&nbsp;<span class="op" id="5518507">:=</span>&nbsp;<span class="ident" id="5518510">os</span><span class="op" id="5518512">.</span><span class="ident" id="5518513">Getenv</span><span class="op" id="5518519">(</span><span class="ident" id="5518520">e</span><span class="op" id="5518521">)</span><span class="op" id="5518522">;</span>&nbsp;<span class="ident" id="5518524">v</span>&nbsp;<span class="op" id="5518526">!=</span>&nbsp;<span class="string" id="5518529">&#34;&#34;</span>&nbsp;<span class="op" id="5518532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518537">env</span>&nbsp;<span class="op" id="5518541">=</span>&nbsp;<span class="builtinfunc" id="5518543">append</span><span class="op" id="5518549">(</span><span class="ident" id="5518550">env</span><span class="op" id="5518553">,</span>&nbsp;<span class="ident" id="5518555">e</span><span class="op" id="5518556">+</span><span class="string" id="5518557">&#34;=&#34;</span><span class="op" id="5518560">+</span><span class="ident" id="5518561">v</span><span class="op" id="5518562">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518573">env</span>&nbsp;<span class="op" id="5518577">=</span>&nbsp;<span class="ident" id="5518579">removeLeadingDuplicates</span><span class="op" id="5518602">(</span><span class="ident" id="5518603">env</span><span class="op" id="5518606">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518610">var</span>&nbsp;<span class="ident" id="5518614">cwd</span><span class="op" id="5518617">,</span>&nbsp;<span class="ident" id="5518619">path</span>&nbsp;<span class="builtintype" id="5518624">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518632">if</span>&nbsp;<span class="ident" id="5518635">h</span><span class="op" id="5518636">.</span><span class="ident" id="5518637">Dir</span>&nbsp;<span class="op" id="5518641">!=</span>&nbsp;<span class="string" id="5518644">&#34;&#34;</span>&nbsp;<span class="op" id="5518647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518651">path</span>&nbsp;<span class="op" id="5518656">=</span>&nbsp;<span class="ident" id="5518658">h</span><span class="op" id="5518659">.</span><span class="ident" id="5518660">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518667">cwd</span>&nbsp;<span class="op" id="5518671">=</span>&nbsp;<span class="ident" id="5518673">h</span><span class="op" id="5518674">.</span><span class="ident" id="5518675">Dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518680">}</span>&nbsp;<span class="keyword" id="5518682">else</span>&nbsp;<span class="op" id="5518687">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518691">cwd</span><span class="op" id="5518694">,</span>&nbsp;<span class="ident" id="5518696">path</span>&nbsp;<span class="op" id="5518701">=</span>&nbsp;<span class="ident" id="5518703">filepath</span><span class="op" id="5518711">.</span><span class="ident" id="5518712">Split</span><span class="op" id="5518717">(</span><span class="ident" id="5518718">h</span><span class="op" id="5518719">.</span><span class="ident" id="5518720">Path</span><span class="op" id="5518724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518730">if</span>&nbsp;<span class="ident" id="5518733">cwd</span>&nbsp;<span class="op" id="5518737">==</span>&nbsp;<span class="string" id="5518740">&#34;&#34;</span>&nbsp;<span class="op" id="5518743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518747">cwd</span>&nbsp;<span class="op" id="5518751">=</span>&nbsp;<span class="string" id="5518753">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518758">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518762">internalError</span>&nbsp;<span class="op" id="5518776">:=</span>&nbsp;<span class="keyword" id="5518779">func</span><span class="op" id="5518783">(</span><span class="ident" id="5518784">err</span>&nbsp;<span class="builtintype" id="5518788">error</span><span class="op" id="5518793">)</span>&nbsp;<span class="op" id="5518795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518799">rw</span><span class="op" id="5518801">.</span><span class="ident" id="5518802">WriteHeader</span><span class="op" id="5518813">(</span><span class="ident" id="5518814">http</span><span class="op" id="5518818">.</span><span class="ident" id="5518819">StatusInternalServerError</span><span class="op" id="5518844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518848">h</span><span class="op" id="5518849">.</span><span class="ident" id="5518850">printf</span><span class="op" id="5518856">(</span><span class="string" id="5518857">&#34;CGI&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="5518872">,</span>&nbsp;<span class="ident" id="5518874">err</span><span class="op" id="5518877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518880">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518884">cmd</span>&nbsp;<span class="op" id="5518888">:=</span>&nbsp;<span class="op" id="5518891">&amp;</span><span class="ident" id="5518892">exec</span><span class="op" id="5518896">.</span><span class="ident" id="5518897">Cmd</span><span class="op" id="5518900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518904">Path</span><span class="op" id="5518908">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5518912">path</span><span class="op" id="5518916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518920">Args</span><span class="op" id="5518924">:</span>&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5518928">append</span><span class="op" id="5518934">(</span><span class="op" id="5518935">[</span><span class="op" id="5518936">]</span><span class="builtintype" id="5518937">string</span><span class="op" id="5518943">{</span><span class="ident" id="5518944">h</span><span class="op" id="5518945">.</span><span class="ident" id="5518946">Path</span><span class="op" id="5518950">}</span><span class="op" id="5518951">,</span>&nbsp;<span class="ident" id="5518953">h</span><span class="op" id="5518954">.</span><span class="ident" id="5518955">Args</span><span class="op" id="5518959">...</span><span class="op" id="5518962">)</span><span class="op" id="5518963">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518967">Dir</span><span class="op" id="5518970">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518975">cwd</span><span class="op" id="5518978">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518982">Env</span><span class="op" id="5518985">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518990">env</span><span class="op" id="5518993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518997">Stderr</span><span class="op" id="5519003">:</span>&nbsp;<span class="ident" id="5519005">os</span><span class="op" id="5519007">.</span><span class="ident" id="5519008">Stderr</span><span class="op" id="5519014">,</span>&nbsp;<span class="comment" id="5519016">//&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519031">if</span>&nbsp;<span class="ident" id="5519034">req</span><span class="op" id="5519037">.</span><span class="ident" id="5519038">ContentLength</span>&nbsp;<span class="op" id="5519052">!=</span>&nbsp;<span class="num" id="5519055">0</span>&nbsp;<span class="op" id="5519057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519061">cmd</span><span class="op" id="5519064">.</span><span class="ident" id="5519065">Stdin</span>&nbsp;<span class="op" id="5519071">=</span>&nbsp;<span class="ident" id="5519073">req</span><span class="op" id="5519076">.</span><span class="ident" id="5519077">Body</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519086">stdoutRead</span><span class="op" id="5519096">,</span>&nbsp;<span class="ident" id="5519098">err</span>&nbsp;<span class="op" id="5519102">:=</span>&nbsp;<span class="ident" id="5519105">cmd</span><span class="op" id="5519108">.</span><span class="ident" id="5519109">StdoutPipe</span><span class="op" id="5519119">(</span><span class="op" id="5519120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519123">if</span>&nbsp;<span class="ident" id="5519126">err</span>&nbsp;<span class="op" id="5519130">!=</span>&nbsp;<span class="ident" id="5519133">nil</span>&nbsp;<span class="op" id="5519137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519141">internalError</span><span class="op" id="5519154">(</span><span class="ident" id="5519155">err</span><span class="op" id="5519158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519162">return</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519174">err</span>&nbsp;<span class="op" id="5519178">=</span>&nbsp;<span class="ident" id="5519180">cmd</span><span class="op" id="5519183">.</span><span class="ident" id="5519184">Start</span><span class="op" id="5519189">(</span><span class="op" id="5519190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519193">if</span>&nbsp;<span class="ident" id="5519196">err</span>&nbsp;<span class="op" id="5519200">!=</span>&nbsp;<span class="ident" id="5519203">nil</span>&nbsp;<span class="op" id="5519207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519211">internalError</span><span class="op" id="5519224">(</span><span class="ident" id="5519225">err</span><span class="op" id="5519228">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519232">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519243">if</span>&nbsp;<span class="ident" id="5519246">hook</span>&nbsp;<span class="op" id="5519251">:=</span>&nbsp;<span class="ident" id="5519254">testHookStartProcess</span><span class="op" id="5519274">;</span>&nbsp;<span class="ident" id="5519276">hook</span>&nbsp;<span class="op" id="5519281">!=</span>&nbsp;<span class="ident" id="5519284">nil</span>&nbsp;<span class="op" id="5519288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519292">hook</span><span class="op" id="5519296">(</span><span class="ident" id="5519297">cmd</span><span class="op" id="5519300">.</span><span class="ident" id="5519301">Process</span><span class="op" id="5519308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519311">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519314">defer</span>&nbsp;<span class="ident" id="5519320">cmd</span><span class="op" id="5519323">.</span><span class="ident" id="5519324">Wait</span><span class="op" id="5519328">(</span><span class="op" id="5519329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519332">defer</span>&nbsp;<span class="ident" id="5519338">stdoutRead</span><span class="op" id="5519348">.</span><span class="ident" id="5519349">Close</span><span class="op" id="5519354">(</span><span class="op" id="5519355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519359">linebody</span>&nbsp;<span class="op" id="5519368">:=</span>&nbsp;<span class="ident" id="5519371">bufio</span><span class="op" id="5519376">.</span><span class="ident" id="5519377">NewReaderSize</span><span class="op" id="5519390">(</span><span class="ident" id="5519391">stdoutRead</span><span class="op" id="5519401">,</span>&nbsp;<span class="num" id="5519403">1024</span><span class="op" id="5519407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519410">headers</span>&nbsp;<span class="op" id="5519418">:=</span>&nbsp;<span class="builtinfunc" id="5519421">make</span><span class="op" id="5519425">(</span><span class="ident" id="5519426">http</span><span class="op" id="5519430">.</span><span class="ident" id="5519431">Header</span><span class="op" id="5519437">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519440">statusCode</span>&nbsp;<span class="op" id="5519451">:=</span>&nbsp;<span class="num" id="5519454">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519457">headerLines</span>&nbsp;<span class="op" id="5519469">:=</span>&nbsp;<span class="num" id="5519472">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519475">sawBlankLine</span>&nbsp;<span class="op" id="5519488">:=</span>&nbsp;<span class="builtintype" id="5519491">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519498">for</span>&nbsp;<span class="op" id="5519502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519506">line</span><span class="op" id="5519510">,</span>&nbsp;<span class="ident" id="5519512">isPrefix</span><span class="op" id="5519520">,</span>&nbsp;<span class="ident" id="5519522">err</span>&nbsp;<span class="op" id="5519526">:=</span>&nbsp;<span class="ident" id="5519529">linebody</span><span class="op" id="5519537">.</span><span class="ident" id="5519538">ReadLine</span><span class="op" id="5519546">(</span><span class="op" id="5519547">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519551">if</span>&nbsp;<span class="ident" id="5519554">isPrefix</span>&nbsp;<span class="op" id="5519563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519568">rw</span><span class="op" id="5519570">.</span><span class="ident" id="5519571">WriteHeader</span><span class="op" id="5519582">(</span><span class="ident" id="5519583">http</span><span class="op" id="5519587">.</span><span class="ident" id="5519588">StatusInternalServerError</span><span class="op" id="5519613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519618">h</span><span class="op" id="5519619">.</span><span class="ident" id="5519620">printf</span><span class="op" id="5519626">(</span><span class="string" id="5519627">&#34;cgi:&nbsp;long&nbsp;header&nbsp;line&nbsp;from&nbsp;subprocess.&#34;</span><span class="op" id="5519667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519672">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519681">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519685">if</span>&nbsp;<span class="ident" id="5519688">err</span>&nbsp;<span class="op" id="5519692">==</span>&nbsp;<span class="ident" id="5519695">io</span><span class="op" id="5519697">.</span><span class="ident" id="5519698">EOF</span>&nbsp;<span class="op" id="5519702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519707">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519719">if</span>&nbsp;<span class="ident" id="5519722">err</span>&nbsp;<span class="op" id="5519726">!=</span>&nbsp;<span class="ident" id="5519729">nil</span>&nbsp;<span class="op" id="5519733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519738">rw</span><span class="op" id="5519740">.</span><span class="ident" id="5519741">WriteHeader</span><span class="op" id="5519752">(</span><span class="ident" id="5519753">http</span><span class="op" id="5519757">.</span><span class="ident" id="5519758">StatusInternalServerError</span><span class="op" id="5519783">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519788">h</span><span class="op" id="5519789">.</span><span class="ident" id="5519790">printf</span><span class="op" id="5519796">(</span><span class="string" id="5519797">&#34;cgi:&nbsp;error&nbsp;reading&nbsp;headers:&nbsp;%v&#34;</span><span class="op" id="5519829">,</span>&nbsp;<span class="ident" id="5519831">err</span><span class="op" id="5519834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519839">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519852">if</span>&nbsp;<span class="builtinfunc" id="5519855">len</span><span class="op" id="5519858">(</span><span class="ident" id="5519859">line</span><span class="op" id="5519863">)</span>&nbsp;<span class="op" id="5519865">==</span>&nbsp;<span class="num" id="5519868">0</span>&nbsp;<span class="op" id="5519870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519875">sawBlankLine</span>&nbsp;<span class="op" id="5519888">=</span>&nbsp;<span class="builtintype" id="5519890">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519898">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519910">headerLines</span><span class="op" id="5519921">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519926">parts</span>&nbsp;<span class="op" id="5519932">:=</span>&nbsp;<span class="ident" id="5519935">strings</span><span class="op" id="5519942">.</span><span class="ident" id="5519943">SplitN</span><span class="op" id="5519949">(</span><span class="builtintype" id="5519950">string</span><span class="op" id="5519956">(</span><span class="ident" id="5519957">line</span><span class="op" id="5519961">)</span><span class="op" id="5519962">,</span>&nbsp;<span class="string" id="5519964">&#34;:&#34;</span><span class="op" id="5519967">,</span>&nbsp;<span class="num" id="5519969">2</span><span class="op" id="5519970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519974">if</span>&nbsp;<span class="builtinfunc" id="5519977">len</span><span class="op" id="5519980">(</span><span class="ident" id="5519981">parts</span><span class="op" id="5519986">)</span>&nbsp;<span class="op" id="5519988">&lt;</span>&nbsp;<span class="num" id="5519990">2</span>&nbsp;<span class="op" id="5519992">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519997">h</span><span class="op" id="5519998">.</span><span class="ident" id="5519999">printf</span><span class="op" id="5520005">(</span><span class="string" id="5520006">&#34;cgi:&nbsp;bogus&nbsp;header&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="5520034">,</span>&nbsp;<span class="builtintype" id="5520036">string</span><span class="op" id="5520042">(</span><span class="ident" id="5520043">line</span><span class="op" id="5520047">)</span><span class="op" id="5520048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520053">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520068">header</span><span class="op" id="5520074">,</span>&nbsp;<span class="ident" id="5520076">val</span>&nbsp;<span class="op" id="5520080">:=</span>&nbsp;<span class="ident" id="5520083">parts</span><span class="op" id="5520088">[</span><span class="num" id="5520089">0</span><span class="op" id="5520090">]</span><span class="op" id="5520091">,</span>&nbsp;<span class="ident" id="5520093">parts</span><span class="op" id="5520098">[</span><span class="num" id="5520099">1</span><span class="op" id="5520100">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520104">header</span>&nbsp;<span class="op" id="5520111">=</span>&nbsp;<span class="ident" id="5520113">strings</span><span class="op" id="5520120">.</span><span class="ident" id="5520121">TrimSpace</span><span class="op" id="5520130">(</span><span class="ident" id="5520131">header</span><span class="op" id="5520137">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520141">val</span>&nbsp;<span class="op" id="5520145">=</span>&nbsp;<span class="ident" id="5520147">strings</span><span class="op" id="5520154">.</span><span class="ident" id="5520155">TrimSpace</span><span class="op" id="5520164">(</span><span class="ident" id="5520165">val</span><span class="op" id="5520168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520172">switch</span>&nbsp;<span class="op" id="5520179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520183">case</span>&nbsp;<span class="ident" id="5520188">header</span>&nbsp;<span class="op" id="5520195">==</span>&nbsp;<span class="string" id="5520198">&#34;Status&#34;</span><span class="op" id="5520206">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520211">if</span>&nbsp;<span class="builtinfunc" id="5520214">len</span><span class="op" id="5520217">(</span><span class="ident" id="5520218">val</span><span class="op" id="5520221">)</span>&nbsp;<span class="op" id="5520223">&lt;</span>&nbsp;<span class="num" id="5520225">3</span>&nbsp;<span class="op" id="5520227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520233">h</span><span class="op" id="5520234">.</span><span class="ident" id="5520235">printf</span><span class="op" id="5520241">(</span><span class="string" id="5520242">&#34;cgi:&nbsp;bogus&nbsp;status&nbsp;(short):&nbsp;%q&#34;</span><span class="op" id="5520273">,</span>&nbsp;<span class="ident" id="5520275">val</span><span class="op" id="5520278">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520284">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520299">code</span><span class="op" id="5520303">,</span>&nbsp;<span class="ident" id="5520305">err</span>&nbsp;<span class="op" id="5520309">:=</span>&nbsp;<span class="ident" id="5520312">strconv</span><span class="op" id="5520319">.</span><span class="ident" id="5520320">Atoi</span><span class="op" id="5520324">(</span><span class="ident" id="5520325">val</span><span class="op" id="5520328">[</span><span class="num" id="5520329">0</span><span class="op" id="5520330">:</span><span class="num" id="5520331">3</span><span class="op" id="5520332">]</span><span class="op" id="5520333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520338">if</span>&nbsp;<span class="ident" id="5520341">err</span>&nbsp;<span class="op" id="5520345">!=</span>&nbsp;<span class="ident" id="5520348">nil</span>&nbsp;<span class="op" id="5520352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520358">h</span><span class="op" id="5520359">.</span><span class="ident" id="5520360">printf</span><span class="op" id="5520366">(</span><span class="string" id="5520367">&#34;cgi:&nbsp;bogus&nbsp;status:&nbsp;%q&#34;</span><span class="op" id="5520390">,</span>&nbsp;<span class="ident" id="5520392">val</span><span class="op" id="5520395">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520401">h</span><span class="op" id="5520402">.</span><span class="ident" id="5520403">printf</span><span class="op" id="5520409">(</span><span class="string" id="5520410">&#34;cgi:&nbsp;line&nbsp;was&nbsp;%q&#34;</span><span class="op" id="5520428">,</span>&nbsp;<span class="ident" id="5520430">line</span><span class="op" id="5520434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520440">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520455">statusCode</span>&nbsp;<span class="op" id="5520466">=</span>&nbsp;<span class="ident" id="5520468">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520475">default</span><span class="op" id="5520482">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520487">headers</span><span class="op" id="5520494">.</span><span class="ident" id="5520495">Add</span><span class="op" id="5520498">(</span><span class="ident" id="5520499">header</span><span class="op" id="5520505">,</span>&nbsp;<span class="ident" id="5520507">val</span><span class="op" id="5520510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520520">if</span>&nbsp;<span class="ident" id="5520523">headerLines</span>&nbsp;<span class="op" id="5520535">==</span>&nbsp;<span class="num" id="5520538">0</span>&nbsp;<span class="op" id="5520540">||</span>&nbsp;<span class="op" id="5520543">!</span><span class="ident" id="5520544">sawBlankLine</span>&nbsp;<span class="op" id="5520557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520561">rw</span><span class="op" id="5520563">.</span><span class="ident" id="5520564">WriteHeader</span><span class="op" id="5520575">(</span><span class="ident" id="5520576">http</span><span class="op" id="5520580">.</span><span class="ident" id="5520581">StatusInternalServerError</span><span class="op" id="5520606">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520610">h</span><span class="op" id="5520611">.</span><span class="ident" id="5520612">printf</span><span class="op" id="5520618">(</span><span class="string" id="5520619">&#34;cgi:&nbsp;no&nbsp;headers&#34;</span><span class="op" id="5520636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520640">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520652">if</span>&nbsp;<span class="ident" id="5520655">loc</span>&nbsp;<span class="op" id="5520659">:=</span>&nbsp;<span class="ident" id="5520662">headers</span><span class="op" id="5520669">.</span><span class="ident" id="5520670">Get</span><span class="op" id="5520673">(</span><span class="string" id="5520674">&#34;Location&#34;</span><span class="op" id="5520684">)</span><span class="op" id="5520685">;</span>&nbsp;<span class="ident" id="5520687">loc</span>&nbsp;<span class="op" id="5520691">!=</span>&nbsp;<span class="string" id="5520694">&#34;&#34;</span>&nbsp;<span class="op" id="5520697">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520701">if</span>&nbsp;<span class="ident" id="5520704">strings</span><span class="op" id="5520711">.</span><span class="ident" id="5520712">HasPrefix</span><span class="op" id="5520721">(</span><span class="ident" id="5520722">loc</span><span class="op" id="5520725">,</span>&nbsp;<span class="string" id="5520727">&#34;/&#34;</span><span class="op" id="5520730">)</span>&nbsp;<span class="op" id="5520732">&amp;&amp;</span>&nbsp;<span class="ident" id="5520735">h</span><span class="op" id="5520736">.</span><span class="ident" id="5520737">PathLocationHandler</span>&nbsp;<span class="op" id="5520757">!=</span>&nbsp;<span class="ident" id="5520760">nil</span>&nbsp;<span class="op" id="5520764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520769">h</span><span class="op" id="5520770">.</span><span class="ident" id="5520771">handleInternalRedirect</span><span class="op" id="5520793">(</span><span class="ident" id="5520794">rw</span><span class="op" id="5520796">,</span>&nbsp;<span class="ident" id="5520798">req</span><span class="op" id="5520801">,</span>&nbsp;<span class="ident" id="5520803">loc</span><span class="op" id="5520806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520811">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520824">if</span>&nbsp;<span class="ident" id="5520827">statusCode</span>&nbsp;<span class="op" id="5520838">==</span>&nbsp;<span class="num" id="5520841">0</span>&nbsp;<span class="op" id="5520843">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520848">statusCode</span>&nbsp;<span class="op" id="5520859">=</span>&nbsp;<span class="ident" id="5520861">http</span><span class="op" id="5520865">.</span><span class="ident" id="5520866">StatusFound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520887">if</span>&nbsp;<span class="ident" id="5520890">statusCode</span>&nbsp;<span class="op" id="5520901">==</span>&nbsp;<span class="num" id="5520904">0</span>&nbsp;<span class="op" id="5520906">&amp;&amp;</span>&nbsp;<span class="ident" id="5520909">headers</span><span class="op" id="5520916">.</span><span class="ident" id="5520917">Get</span><span class="op" id="5520920">(</span><span class="string" id="5520921">&#34;Content-Type&#34;</span><span class="op" id="5520935">)</span>&nbsp;<span class="op" id="5520937">==</span>&nbsp;<span class="string" id="5520940">&#34;&#34;</span>&nbsp;<span class="op" id="5520943">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520947">rw</span><span class="op" id="5520949">.</span><span class="ident" id="5520950">WriteHeader</span><span class="op" id="5520961">(</span><span class="ident" id="5520962">http</span><span class="op" id="5520966">.</span><span class="ident" id="5520967">StatusInternalServerError</span><span class="op" id="5520992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520996">h</span><span class="op" id="5520997">.</span><span class="ident" id="5520998">printf</span><span class="op" id="5521004">(</span><span class="string" id="5521005">&#34;cgi:&nbsp;missing&nbsp;required&nbsp;Content-Type&nbsp;in&nbsp;headers&#34;</span><span class="op" id="5521052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521056">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521068">if</span>&nbsp;<span class="ident" id="5521071">statusCode</span>&nbsp;<span class="op" id="5521082">==</span>&nbsp;<span class="num" id="5521085">0</span>&nbsp;<span class="op" id="5521087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521091">statusCode</span>&nbsp;<span class="op" id="5521102">=</span>&nbsp;<span class="ident" id="5521104">http</span><span class="op" id="5521108">.</span><span class="ident" id="5521109">StatusOK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521123">//&nbsp;Copy&nbsp;headers&nbsp;to&nbsp;rw&#39;s&nbsp;headers,&nbsp;after&nbsp;we&#39;ve&nbsp;decided&nbsp;not&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521184">//&nbsp;go&nbsp;into&nbsp;handleInternalRedirect,&nbsp;which&nbsp;won&#39;t&nbsp;want&nbsp;its&nbsp;rw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521244">//&nbsp;headers&nbsp;to&nbsp;have&nbsp;been&nbsp;touched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521278">for</span>&nbsp;<span class="ident" id="5521282">k</span><span class="op" id="5521283">,</span>&nbsp;<span class="ident" id="5521285">vv</span>&nbsp;<span class="op" id="5521288">:=</span>&nbsp;<span class="keyword" id="5521291">range</span>&nbsp;<span class="ident" id="5521297">headers</span>&nbsp;<span class="op" id="5521305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521309">for</span>&nbsp;<span class="ident" id="5521313">_</span><span class="op" id="5521314">,</span>&nbsp;<span class="ident" id="5521316">v</span>&nbsp;<span class="op" id="5521318">:=</span>&nbsp;<span class="keyword" id="5521321">range</span>&nbsp;<span class="ident" id="5521327">vv</span>&nbsp;<span class="op" id="5521330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521335">rw</span><span class="op" id="5521337">.</span><span class="ident" id="5521338">Header</span><span class="op" id="5521344">(</span><span class="op" id="5521345">)</span><span class="op" id="5521346">.</span><span class="ident" id="5521347">Add</span><span class="op" id="5521350">(</span><span class="ident" id="5521351">k</span><span class="op" id="5521352">,</span>&nbsp;<span class="ident" id="5521354">v</span><span class="op" id="5521355">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521366">rw</span><span class="op" id="5521368">.</span><span class="ident" id="5521369">WriteHeader</span><span class="op" id="5521380">(</span><span class="ident" id="5521381">statusCode</span><span class="op" id="5521391">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521395">_</span><span class="op" id="5521396">,</span>&nbsp;<span class="ident" id="5521398">err</span>&nbsp;<span class="op" id="5521402">=</span>&nbsp;<span class="ident" id="5521404">io</span><span class="op" id="5521406">.</span><span class="ident" id="5521407">Copy</span><span class="op" id="5521411">(</span><span class="ident" id="5521412">rw</span><span class="op" id="5521414">,</span>&nbsp;<span class="ident" id="5521416">linebody</span><span class="op" id="5521424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521427">if</span>&nbsp;<span class="ident" id="5521430">err</span>&nbsp;<span class="op" id="5521434">!=</span>&nbsp;<span class="ident" id="5521437">nil</span>&nbsp;<span class="op" id="5521441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521445">h</span><span class="op" id="5521446">.</span><span class="ident" id="5521447">printf</span><span class="op" id="5521453">(</span><span class="string" id="5521454">&#34;cgi:&nbsp;copy&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="5521475">,</span>&nbsp;<span class="ident" id="5521477">err</span><span class="op" id="5521480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521484">//&nbsp;And&nbsp;kill&nbsp;the&nbsp;child&nbsp;CGI&nbsp;process&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;hang&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521540">//&nbsp;the&nbsp;deferred&nbsp;cmd.Wait&nbsp;above&nbsp;if&nbsp;the&nbsp;error&nbsp;was&nbsp;just</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521595">//&nbsp;the&nbsp;client&nbsp;(rw)&nbsp;going&nbsp;away.&nbsp;If&nbsp;it&nbsp;was&nbsp;a&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521651">//&nbsp;(because&nbsp;the&nbsp;child&nbsp;died&nbsp;itself),&nbsp;then&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521704">//&nbsp;kill&nbsp;of&nbsp;an&nbsp;already-dead&nbsp;process&nbsp;is&nbsp;harmless&nbsp;(the&nbsp;PID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521762">//&nbsp;won&#39;t&nbsp;be&nbsp;reused&nbsp;until&nbsp;the&nbsp;Wait&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521806">cmd</span><span class="op" id="5521809">.</span><span class="ident" id="5521810">Process</span><span class="op" id="5521817">.</span><span class="ident" id="5521818">Kill</span><span class="op" id="5521822">(</span><span class="op" id="5521823">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521826">}</span><br>
<span class="lineno"></span><span class="op" id="5521828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5521831">func</span>&nbsp;<span class="op" id="5521836">(</span><span class="ident" id="5521837">h</span>&nbsp;<span class="op" id="5521839">*</span><span class="ident" id="5521840">Handler</span><span class="op" id="5521847">)</span>&nbsp;<span class="ident" id="5521849">printf</span><span class="op" id="5521855">(</span><span class="ident" id="5521856">format</span>&nbsp;<span class="builtintype" id="5521863">string</span><span class="op" id="5521869">,</span>&nbsp;<span class="ident" id="5521871">v</span>&nbsp;<span class="op" id="5521873">...</span><span class="keyword" id="5521876">interface</span><span class="op" id="5521885">{</span><span class="op" id="5521886">}</span><span class="op" id="5521887">)</span>&nbsp;<span class="op" id="5521889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521892">if</span>&nbsp;<span class="ident" id="5521895">h</span><span class="op" id="5521896">.</span><span class="ident" id="5521897">Logger</span>&nbsp;<span class="op" id="5521904">!=</span>&nbsp;<span class="ident" id="5521907">nil</span>&nbsp;<span class="op" id="5521911">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521915">h</span><span class="op" id="5521916">.</span><span class="ident" id="5521917">Logger</span><span class="op" id="5521923">.</span><span class="ident" id="5521924">Printf</span><span class="op" id="5521930">(</span><span class="ident" id="5521931">format</span><span class="op" id="5521937">,</span>&nbsp;<span class="ident" id="5521939">v</span><span class="op" id="5521940">...</span><span class="op" id="5521943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521946">}</span>&nbsp;<span class="keyword" id="5521948">else</span>&nbsp;<span class="op" id="5521953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521957">log</span><span class="op" id="5521960">.</span><span class="ident" id="5521961">Printf</span><span class="op" id="5521967">(</span><span class="ident" id="5521968">format</span><span class="op" id="5521974">,</span>&nbsp;<span class="ident" id="5521976">v</span><span class="op" id="5521977">...</span><span class="op" id="5521980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521983">}</span><br>
<span class="lineno"></span><span class="op" id="5521985">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="5521988">func</span>&nbsp;<span class="op" id="5521993">(</span><span class="ident" id="5521994">h</span>&nbsp;<span class="op" id="5521996">*</span><span class="ident" id="5521997">Handler</span><span class="op" id="5522004">)</span>&nbsp;<span class="ident" id="5522006">handleInternalRedirect</span><span class="op" id="5522028">(</span><span class="ident" id="5522029">rw</span>&nbsp;<span class="ident" id="5522032">http</span><span class="op" id="5522036">.</span><span class="ident" id="5522037">ResponseWriter</span><span class="op" id="5522051">,</span>&nbsp;<span class="ident" id="5522053">req</span>&nbsp;<span class="op" id="5522057">*</span><span class="ident" id="5522058">http</span><span class="op" id="5522062">.</span><span class="ident" id="5522063">Request</span><span class="op" id="5522070">,</span>&nbsp;<span class="ident" id="5522072">path</span>&nbsp;<span class="builtintype" id="5522077">string</span><span class="op" id="5522083">)</span>&nbsp;<span class="op" id="5522085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522088">url</span><span class="op" id="5522091">,</span>&nbsp;<span class="ident" id="5522093">err</span>&nbsp;<span class="op" id="5522097">:=</span>&nbsp;<span class="ident" id="5522100">req</span><span class="op" id="5522103">.</span><span class="ident" id="5522104">URL</span><span class="op" id="5522107">.</span><span class="ident" id="5522108">Parse</span><span class="op" id="5522113">(</span><span class="ident" id="5522114">path</span><span class="op" id="5522118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522121">if</span>&nbsp;<span class="ident" id="5522124">err</span>&nbsp;<span class="op" id="5522128">!=</span>&nbsp;<span class="ident" id="5522131">nil</span>&nbsp;<span class="op" id="5522135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522139">rw</span><span class="op" id="5522141">.</span><span class="ident" id="5522142">WriteHeader</span><span class="op" id="5522153">(</span><span class="ident" id="5522154">http</span><span class="op" id="5522158">.</span><span class="ident" id="5522159">StatusInternalServerError</span><span class="op" id="5522184">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522188">h</span><span class="op" id="5522189">.</span><span class="ident" id="5522190">printf</span><span class="op" id="5522196">(</span><span class="string" id="5522197">&#34;cgi:&nbsp;error&nbsp;resolving&nbsp;local&nbsp;URI&nbsp;path&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="5522241">,</span>&nbsp;<span class="ident" id="5522243">path</span><span class="op" id="5522247">,</span>&nbsp;<span class="ident" id="5522249">err</span><span class="op" id="5522252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522256">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522267">//&nbsp;TODO:&nbsp;RFC&nbsp;3875&nbsp;isn&#39;t&nbsp;clear&nbsp;if&nbsp;only&nbsp;GET&nbsp;is&nbsp;supported,&nbsp;but&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522331">//&nbsp;suggests&nbsp;so:&nbsp;&#34;Note&nbsp;that&nbsp;any&nbsp;message-body&nbsp;attached&nbsp;to&nbsp;the</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522392">//&nbsp;request&nbsp;(such&nbsp;as&nbsp;for&nbsp;a&nbsp;POST&nbsp;request)&nbsp;may&nbsp;not&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522454">//&nbsp;to&nbsp;the&nbsp;resource&nbsp;that&nbsp;is&nbsp;the&nbsp;target&nbsp;of&nbsp;the&nbsp;redirect.&#34;&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522515">//&nbsp;should&nbsp;do&nbsp;some&nbsp;tests&nbsp;against&nbsp;Apache&nbsp;to&nbsp;see&nbsp;how&nbsp;it&nbsp;handles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522577">//&nbsp;POST,&nbsp;HEAD,&nbsp;etc.&nbsp;Does&nbsp;the&nbsp;internal&nbsp;redirect&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522638">//&nbsp;method&nbsp;or&nbsp;just&nbsp;GET?&nbsp;What&nbsp;about&nbsp;incoming&nbsp;headers?</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522691">//&nbsp;(e.g.&nbsp;Cookies)&nbsp;Which&nbsp;headers,&nbsp;if&nbsp;any,&nbsp;are&nbsp;copied&nbsp;into&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522753">//&nbsp;second&nbsp;request?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522773">newReq</span>&nbsp;<span class="op" id="5522780">:=</span>&nbsp;<span class="op" id="5522783">&amp;</span><span class="ident" id="5522784">http</span><span class="op" id="5522788">.</span><span class="ident" id="5522789">Request</span><span class="op" id="5522796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522800">Method</span><span class="op" id="5522806">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5522812">&#34;GET&#34;</span><span class="op" id="5522817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522821">URL</span><span class="op" id="5522824">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522833">url</span><span class="op" id="5522836">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522840">Proto</span><span class="op" id="5522845">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5522852">&#34;HTTP/1.1&#34;</span><span class="op" id="5522862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522866">ProtoMajor</span><span class="op" id="5522876">:</span>&nbsp;<span class="num" id="5522878">1</span><span class="op" id="5522879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522883">ProtoMinor</span><span class="op" id="5522893">:</span>&nbsp;<span class="num" id="5522895">1</span><span class="op" id="5522896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522900">Header</span><span class="op" id="5522906">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5522912">make</span><span class="op" id="5522916">(</span><span class="ident" id="5522917">http</span><span class="op" id="5522921">.</span><span class="ident" id="5522922">Header</span><span class="op" id="5522928">)</span><span class="op" id="5522929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522933">Host</span><span class="op" id="5522937">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522945">url</span><span class="op" id="5522948">.</span><span class="ident" id="5522949">Host</span><span class="op" id="5522953">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522957">RemoteAddr</span><span class="op" id="5522967">:</span>&nbsp;<span class="ident" id="5522969">req</span><span class="op" id="5522972">.</span><span class="ident" id="5522973">RemoteAddr</span><span class="op" id="5522983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522987">TLS</span><span class="op" id="5522990">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522999">req</span><span class="op" id="5523002">.</span><span class="ident" id="5523003">TLS</span><span class="op" id="5523006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523012">h</span><span class="op" id="5523013">.</span><span class="ident" id="5523014">PathLocationHandler</span><span class="op" id="5523033">.</span><span class="ident" id="5523034">ServeHTTP</span><span class="op" id="5523043">(</span><span class="ident" id="5523044">rw</span><span class="op" id="5523046">,</span>&nbsp;<span class="ident" id="5523048">newReq</span><span class="op" id="5523054">)</span><br>
<span class="lineno"></span><span class="op" id="5523056">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="5523059">func</span>&nbsp;<span class="ident" id="5523064">upperCaseAndUnderscore</span><span class="op" id="5523086">(</span><span class="ident" id="5523087">r</span>&nbsp;<span class="builtintype" id="5523089">rune</span><span class="op" id="5523093">)</span>&nbsp;<span class="builtintype" id="5523095">rune</span>&nbsp;<span class="op" id="5523100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523103">switch</span>&nbsp;<span class="op" id="5523110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523113">case</span>&nbsp;<span class="ident" id="5523118">r</span>&nbsp;<span class="op" id="5523120">&gt;=</span>&nbsp;<span class="string" id="5523123">&#39;a&#39;</span>&nbsp;<span class="op" id="5523127">&amp;&amp;</span>&nbsp;<span class="ident" id="5523130">r</span>&nbsp;<span class="op" id="5523132">&lt;=</span>&nbsp;<span class="string" id="5523135">&#39;z&#39;</span><span class="op" id="5523138">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523142">return</span>&nbsp;<span class="ident" id="5523149">r</span>&nbsp;<span class="op" id="5523151">-</span>&nbsp;<span class="op" id="5523153">(</span><span class="string" id="5523154">&#39;a&#39;</span>&nbsp;<span class="op" id="5523158">-</span>&nbsp;<span class="string" id="5523160">&#39;A&#39;</span><span class="op" id="5523163">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523166">case</span>&nbsp;<span class="ident" id="5523171">r</span>&nbsp;<span class="op" id="5523173">==</span>&nbsp;<span class="string" id="5523176">&#39;-&#39;</span><span class="op" id="5523179">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523183">return</span>&nbsp;<span class="string" id="5523190">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523195">case</span>&nbsp;<span class="ident" id="5523200">r</span>&nbsp;<span class="op" id="5523202">==</span>&nbsp;<span class="string" id="5523205">&#39;=&#39;</span><span class="op" id="5523208">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5523212">//&nbsp;Maybe&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;CGI&nbsp;&#39;spec&#39;&nbsp;but&nbsp;would&nbsp;mess&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5523268">//&nbsp;the&nbsp;environment&nbsp;in&nbsp;any&nbsp;case,&nbsp;as&nbsp;Go&nbsp;represents&nbsp;the</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5523323">//&nbsp;environment&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;&#34;key=value&#34;&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523375">return</span>&nbsp;<span class="string" id="5523382">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5523390">//&nbsp;TODO:&nbsp;other&nbsp;transformations&nbsp;in&nbsp;spec&nbsp;or&nbsp;practice?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523443">return</span>&nbsp;<span class="ident" id="5523450">r</span><br>
<span class="lineno">375</span><span class="op" id="5523452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5523455">var</span>&nbsp;<span class="ident" id="5523459">testHookStartProcess</span>&nbsp;<span class="keyword" id="5523480">func</span><span class="op" id="5523484">(</span><span class="op" id="5523485">*</span><span class="ident" id="5523486">os</span><span class="op" id="5523488">.</span><span class="ident" id="5523489">Process</span><span class="op" id="5523496">)</span>&nbsp;<span class="comment" id="5523498">//&nbsp;nil&nbsp;except&nbsp;for&nbsp;some&nbsp;tests</span>
</div>
</body>
</html>
