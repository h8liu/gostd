<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rc4</h2>
<ul>
<li><a href="/gostd/crypto/rc4/rc4.go.html" class="current">rc4.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_asm.go.html">rc4_asm.go</a></li>
<li><a href="/gostd/crypto/rc4/rc4_test.go.html">rc4_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4335981">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4336036">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4336090">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4336141">//&nbsp;Package&nbsp;rc4&nbsp;implements&nbsp;RC4&nbsp;encryption,&nbsp;as&nbsp;defined&nbsp;in&nbsp;Bruce&nbsp;Schneier&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4336214">//&nbsp;Applied&nbsp;Cryptography.</span><br>
<span class="lineno"></span><span class="keyword" id="4336239">package</span>&nbsp;<span class="ident" id="4336247">rc4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4336252">//&nbsp;BUG(agl):&nbsp;RC4&nbsp;is&nbsp;in&nbsp;common&nbsp;use&nbsp;but&nbsp;has&nbsp;design&nbsp;weaknesses&nbsp;that&nbsp;make</span><br>
<span class="lineno">10</span><span class="comment" id="4336322">//&nbsp;it&nbsp;a&nbsp;poor&nbsp;choice&nbsp;for&nbsp;new&nbsp;protocols.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4336362">import</span>&nbsp;<span class="string" id="4336369">&#34;strconv&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4336380">//&nbsp;A&nbsp;Cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;RC4&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno">15</span><span class="keyword" id="4336438">type</span>&nbsp;<span class="ident" id="4336443">Cipher</span>&nbsp;<span class="keyword" id="4336450">struct</span>&nbsp;<span class="op" id="4336457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336460">s</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4336465">[</span><span class="num" id="4336466">256</span><span class="op" id="4336469">]</span><span class="builtintype" id="4336470">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336478">i</span><span class="op" id="4336479">,</span>&nbsp;<span class="ident" id="4336481">j</span>&nbsp;<span class="builtintype" id="4336483">uint8</span><br>
<span class="lineno"></span><span class="op" id="4336489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4336492">type</span>&nbsp;<span class="ident" id="4336497">KeySizeError</span>&nbsp;<span class="builtintype" id="4336510">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4336515">func</span>&nbsp;<span class="op" id="4336520">(</span><span class="ident" id="4336521">k</span>&nbsp;<span class="ident" id="4336523">KeySizeError</span><span class="op" id="4336535">)</span>&nbsp;<span class="ident" id="4336537">Error</span><span class="op" id="4336542">(</span><span class="op" id="4336543">)</span>&nbsp;<span class="builtintype" id="4336545">string</span>&nbsp;<span class="op" id="4336552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4336555">return</span>&nbsp;<span class="string" id="4336562">&#34;crypto/rc4:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="4336594">+</span>&nbsp;<span class="ident" id="4336596">strconv</span><span class="op" id="4336603">.</span><span class="ident" id="4336604">Itoa</span><span class="op" id="4336608">(</span><span class="builtintype" id="4336609">int</span><span class="op" id="4336612">(</span><span class="ident" id="4336613">k</span><span class="op" id="4336614">)</span><span class="op" id="4336615">)</span><br>
<span class="lineno"></span><span class="op" id="4336617">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4336620">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;Cipher.&nbsp;&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4336699">//&nbsp;RC4&nbsp;key,&nbsp;at&nbsp;least&nbsp;1&nbsp;byte&nbsp;and&nbsp;at&nbsp;most&nbsp;256&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4336750">func</span>&nbsp;<span class="ident" id="4336755">NewCipher</span><span class="op" id="4336764">(</span><span class="ident" id="4336765">key</span>&nbsp;<span class="op" id="4336769">[</span><span class="op" id="4336770">]</span><span class="builtintype" id="4336771">byte</span><span class="op" id="4336775">)</span>&nbsp;<span class="op" id="4336777">(</span><span class="op" id="4336778">*</span><span class="ident" id="4336779">Cipher</span><span class="op" id="4336785">,</span>&nbsp;<span class="builtintype" id="4336787">error</span><span class="op" id="4336792">)</span>&nbsp;<span class="op" id="4336794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336797">k</span>&nbsp;<span class="op" id="4336799">:=</span>&nbsp;<span class="builtinfunc" id="4336802">len</span><span class="op" id="4336805">(</span><span class="ident" id="4336806">key</span><span class="op" id="4336809">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4336812">if</span>&nbsp;<span class="ident" id="4336815">k</span>&nbsp;<span class="op" id="4336817">&lt;</span>&nbsp;<span class="num" id="4336819">1</span>&nbsp;<span class="op" id="4336821">||</span>&nbsp;<span class="ident" id="4336824">k</span>&nbsp;<span class="op" id="4336826">&gt;</span>&nbsp;<span class="num" id="4336828">256</span>&nbsp;<span class="op" id="4336832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4336836">return</span>&nbsp;<span class="builtintype" id="4336843">nil</span><span class="op" id="4336846">,</span>&nbsp;<span class="ident" id="4336848">KeySizeError</span><span class="op" id="4336860">(</span><span class="ident" id="4336861">k</span><span class="op" id="4336862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4336865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4336868">var</span>&nbsp;<span class="ident" id="4336872">c</span>&nbsp;<span class="ident" id="4336874">Cipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4336882">for</span>&nbsp;<span class="ident" id="4336886">i</span>&nbsp;<span class="op" id="4336888">:=</span>&nbsp;<span class="num" id="4336891">0</span><span class="op" id="4336892">;</span>&nbsp;<span class="ident" id="4336894">i</span>&nbsp;<span class="op" id="4336896">&lt;</span>&nbsp;<span class="num" id="4336898">256</span><span class="op" id="4336901">;</span>&nbsp;<span class="ident" id="4336903">i</span><span class="op" id="4336904">++</span>&nbsp;<span class="op" id="4336907">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336911">c</span><span class="op" id="4336912">.</span><span class="ident" id="4336913">s</span><span class="op" id="4336914">[</span><span class="ident" id="4336915">i</span><span class="op" id="4336916">]</span>&nbsp;<span class="op" id="4336918">=</span>&nbsp;<span class="builtintype" id="4336920">uint32</span><span class="op" id="4336926">(</span><span class="ident" id="4336927">i</span><span class="op" id="4336928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4336931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4336934">var</span>&nbsp;<span class="ident" id="4336938">j</span>&nbsp;<span class="builtintype" id="4336940">uint8</span>&nbsp;<span class="op" id="4336946">=</span>&nbsp;<span class="num" id="4336948">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4336951">for</span>&nbsp;<span class="ident" id="4336955">i</span>&nbsp;<span class="op" id="4336957">:=</span>&nbsp;<span class="num" id="4336960">0</span><span class="op" id="4336961">;</span>&nbsp;<span class="ident" id="4336963">i</span>&nbsp;<span class="op" id="4336965">&lt;</span>&nbsp;<span class="num" id="4336967">256</span><span class="op" id="4336970">;</span>&nbsp;<span class="ident" id="4336972">i</span><span class="op" id="4336973">++</span>&nbsp;<span class="op" id="4336976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336980">j</span>&nbsp;<span class="op" id="4336982">+=</span>&nbsp;<span class="builtintype" id="4336985">uint8</span><span class="op" id="4336990">(</span><span class="ident" id="4336991">c</span><span class="op" id="4336992">.</span><span class="ident" id="4336993">s</span><span class="op" id="4336994">[</span><span class="ident" id="4336995">i</span><span class="op" id="4336996">]</span><span class="op" id="4336997">)</span>&nbsp;<span class="op" id="4336999">+</span>&nbsp;<span class="ident" id="4337001">key</span><span class="op" id="4337004">[</span><span class="ident" id="4337005">i</span><span class="op" id="4337006">%</span><span class="ident" id="4337007">k</span><span class="op" id="4337008">]</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337012">c</span><span class="op" id="4337013">.</span><span class="ident" id="4337014">s</span><span class="op" id="4337015">[</span><span class="ident" id="4337016">i</span><span class="op" id="4337017">]</span><span class="op" id="4337018">,</span>&nbsp;<span class="ident" id="4337020">c</span><span class="op" id="4337021">.</span><span class="ident" id="4337022">s</span><span class="op" id="4337023">[</span><span class="ident" id="4337024">j</span><span class="op" id="4337025">]</span>&nbsp;<span class="op" id="4337027">=</span>&nbsp;<span class="ident" id="4337029">c</span><span class="op" id="4337030">.</span><span class="ident" id="4337031">s</span><span class="op" id="4337032">[</span><span class="ident" id="4337033">j</span><span class="op" id="4337034">]</span><span class="op" id="4337035">,</span>&nbsp;<span class="ident" id="4337037">c</span><span class="op" id="4337038">.</span><span class="ident" id="4337039">s</span><span class="op" id="4337040">[</span><span class="ident" id="4337041">i</span><span class="op" id="4337042">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4337045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4337048">return</span>&nbsp;<span class="op" id="4337055">&amp;</span><span class="ident" id="4337056">c</span><span class="op" id="4337057">,</span>&nbsp;<span class="builtintype" id="4337059">nil</span><br>
<span class="lineno"></span><span class="op" id="4337063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="4337066">//&nbsp;Reset&nbsp;zeros&nbsp;the&nbsp;key&nbsp;data&nbsp;so&nbsp;that&nbsp;it&nbsp;will&nbsp;no&nbsp;longer&nbsp;appear&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4337134">//&nbsp;process&#39;s&nbsp;memory.</span><br>
<span class="lineno"></span><span class="keyword" id="4337155">func</span>&nbsp;<span class="op" id="4337160">(</span><span class="ident" id="4337161">c</span>&nbsp;<span class="op" id="4337163">*</span><span class="ident" id="4337164">Cipher</span><span class="op" id="4337170">)</span>&nbsp;<span class="ident" id="4337172">Reset</span><span class="op" id="4337177">(</span><span class="op" id="4337178">)</span>&nbsp;<span class="op" id="4337180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4337183">for</span>&nbsp;<span class="ident" id="4337187">i</span>&nbsp;<span class="op" id="4337189">:=</span>&nbsp;<span class="keyword" id="4337192">range</span>&nbsp;<span class="ident" id="4337198">c</span><span class="op" id="4337199">.</span><span class="ident" id="4337200">s</span>&nbsp;<span class="op" id="4337202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337206">c</span><span class="op" id="4337207">.</span><span class="ident" id="4337208">s</span><span class="op" id="4337209">[</span><span class="ident" id="4337210">i</span><span class="op" id="4337211">]</span>&nbsp;<span class="op" id="4337213">=</span>&nbsp;<span class="num" id="4337215">0</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4337218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337221">c</span><span class="op" id="4337222">.</span><span class="ident" id="4337223">i</span><span class="op" id="4337224">,</span>&nbsp;<span class="ident" id="4337226">c</span><span class="op" id="4337227">.</span><span class="ident" id="4337228">j</span>&nbsp;<span class="op" id="4337230">=</span>&nbsp;<span class="num" id="4337232">0</span><span class="op" id="4337233">,</span>&nbsp;<span class="num" id="4337235">0</span><br>
<span class="lineno"></span><span class="op" id="4337237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4337240">//&nbsp;xorKeyStreamGeneric&nbsp;sets&nbsp;dst&nbsp;to&nbsp;the&nbsp;result&nbsp;of&nbsp;XORing&nbsp;src&nbsp;with&nbsp;the</span><br>
<span class="lineno">55</span><span class="comment" id="4337309">//&nbsp;key&nbsp;stream.&nbsp;&nbsp;Dst&nbsp;and&nbsp;src&nbsp;may&nbsp;be&nbsp;the&nbsp;same&nbsp;slice&nbsp;but&nbsp;otherwise&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="4337380">//&nbsp;not&nbsp;overlap.</span><br>
<span class="lineno"></span><span class="comment" id="4337396">//</span><br>
<span class="lineno"></span><span class="comment" id="4337399">//&nbsp;This&nbsp;is&nbsp;the&nbsp;pure&nbsp;Go&nbsp;version.&nbsp;rc4_{amd64,386,arm}*&nbsp;contain&nbsp;assembly</span><br>
<span class="lineno"></span><span class="comment" id="4337469">//&nbsp;implementations.&nbsp;This&nbsp;is&nbsp;here&nbsp;for&nbsp;tests&nbsp;and&nbsp;to&nbsp;prevent&nbsp;bitrot.</span><br>
<span class="lineno">60</span><span class="keyword" id="4337535">func</span>&nbsp;<span class="op" id="4337540">(</span><span class="ident" id="4337541">c</span>&nbsp;<span class="op" id="4337543">*</span><span class="ident" id="4337544">Cipher</span><span class="op" id="4337550">)</span>&nbsp;<span class="ident" id="4337552">xorKeyStreamGeneric</span><span class="op" id="4337571">(</span><span class="ident" id="4337572">dst</span><span class="op" id="4337575">,</span>&nbsp;<span class="ident" id="4337577">src</span>&nbsp;<span class="op" id="4337581">[</span><span class="op" id="4337582">]</span><span class="builtintype" id="4337583">byte</span><span class="op" id="4337587">)</span>&nbsp;<span class="op" id="4337589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337592">i</span><span class="op" id="4337593">,</span>&nbsp;<span class="ident" id="4337595">j</span>&nbsp;<span class="op" id="4337597">:=</span>&nbsp;<span class="ident" id="4337600">c</span><span class="op" id="4337601">.</span><span class="ident" id="4337602">i</span><span class="op" id="4337603">,</span>&nbsp;<span class="ident" id="4337605">c</span><span class="op" id="4337606">.</span><span class="ident" id="4337607">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4337610">for</span>&nbsp;<span class="ident" id="4337614">k</span><span class="op" id="4337615">,</span>&nbsp;<span class="ident" id="4337617">v</span>&nbsp;<span class="op" id="4337619">:=</span>&nbsp;<span class="keyword" id="4337622">range</span>&nbsp;<span class="ident" id="4337628">src</span>&nbsp;<span class="op" id="4337632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337636">i</span>&nbsp;<span class="op" id="4337638">+=</span>&nbsp;<span class="num" id="4337641">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337645">j</span>&nbsp;<span class="op" id="4337647">+=</span>&nbsp;<span class="builtintype" id="4337650">uint8</span><span class="op" id="4337655">(</span><span class="ident" id="4337656">c</span><span class="op" id="4337657">.</span><span class="ident" id="4337658">s</span><span class="op" id="4337659">[</span><span class="ident" id="4337660">i</span><span class="op" id="4337661">]</span><span class="op" id="4337662">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337666">c</span><span class="op" id="4337667">.</span><span class="ident" id="4337668">s</span><span class="op" id="4337669">[</span><span class="ident" id="4337670">i</span><span class="op" id="4337671">]</span><span class="op" id="4337672">,</span>&nbsp;<span class="ident" id="4337674">c</span><span class="op" id="4337675">.</span><span class="ident" id="4337676">s</span><span class="op" id="4337677">[</span><span class="ident" id="4337678">j</span><span class="op" id="4337679">]</span>&nbsp;<span class="op" id="4337681">=</span>&nbsp;<span class="ident" id="4337683">c</span><span class="op" id="4337684">.</span><span class="ident" id="4337685">s</span><span class="op" id="4337686">[</span><span class="ident" id="4337687">j</span><span class="op" id="4337688">]</span><span class="op" id="4337689">,</span>&nbsp;<span class="ident" id="4337691">c</span><span class="op" id="4337692">.</span><span class="ident" id="4337693">s</span><span class="op" id="4337694">[</span><span class="ident" id="4337695">i</span><span class="op" id="4337696">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337700">dst</span><span class="op" id="4337703">[</span><span class="ident" id="4337704">k</span><span class="op" id="4337705">]</span>&nbsp;<span class="op" id="4337707">=</span>&nbsp;<span class="ident" id="4337709">v</span>&nbsp;<span class="op" id="4337711">^</span>&nbsp;<span class="builtintype" id="4337713">uint8</span><span class="op" id="4337718">(</span><span class="ident" id="4337719">c</span><span class="op" id="4337720">.</span><span class="ident" id="4337721">s</span><span class="op" id="4337722">[</span><span class="builtintype" id="4337723">uint8</span><span class="op" id="4337728">(</span><span class="ident" id="4337729">c</span><span class="op" id="4337730">.</span><span class="ident" id="4337731">s</span><span class="op" id="4337732">[</span><span class="ident" id="4337733">i</span><span class="op" id="4337734">]</span><span class="op" id="4337735">+</span><span class="ident" id="4337736">c</span><span class="op" id="4337737">.</span><span class="ident" id="4337738">s</span><span class="op" id="4337739">[</span><span class="ident" id="4337740">j</span><span class="op" id="4337741">]</span><span class="op" id="4337742">)</span><span class="op" id="4337743">]</span><span class="op" id="4337744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4337747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337750">c</span><span class="op" id="4337751">.</span><span class="ident" id="4337752">i</span><span class="op" id="4337753">,</span>&nbsp;<span class="ident" id="4337755">c</span><span class="op" id="4337756">.</span><span class="ident" id="4337757">j</span>&nbsp;<span class="op" id="4337759">=</span>&nbsp;<span class="ident" id="4337761">i</span><span class="op" id="4337762">,</span>&nbsp;<span class="ident" id="4337764">j</span><br>
<span class="lineno"></span><span class="op" id="4337766">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
