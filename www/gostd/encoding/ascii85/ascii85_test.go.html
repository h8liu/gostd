<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6925670">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6925725">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6925779">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6925830">package</span>&nbsp;<span class="ident" id="6925838">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6925847">import</span>&nbsp;<span class="op" id="6925854">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6925857">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6925866">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6925872">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6925885">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6925896">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6925906">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6925909">type</span>&nbsp;<span class="ident" id="6925914">testpair</span>&nbsp;<span class="keyword" id="6925923">struct</span>&nbsp;<span class="op" id="6925930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925933">decoded</span><span class="op" id="6925940">,</span>&nbsp;<span class="ident" id="6925942">encoded</span>&nbsp;<span class="builtintype" id="6925950">string</span><br>
<span class="lineno"></span><span class="op" id="6925957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6925960">var</span>&nbsp;<span class="ident" id="6925964">pairs</span>&nbsp;<span class="op" id="6925970">=</span>&nbsp;<span class="op" id="6925972">[</span><span class="op" id="6925973">]</span><span class="ident" id="6925974">testpair</span><span class="op" id="6925982">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6925985">//&nbsp;Encode&nbsp;returns&nbsp;0&nbsp;when&nbsp;len(src)&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6926029">&#34;&#34;</span><span class="op" id="6926031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6926035">&#34;&#34;</span><span class="op" id="6926037">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926040">}</span><span class="op" id="6926041">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6926044">//&nbsp;Wikipedia&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6926070">&#34;Man&nbsp;is&nbsp;distinguished,&nbsp;not&nbsp;only&nbsp;by&nbsp;his&nbsp;reason,&nbsp;but&nbsp;by&nbsp;this&nbsp;singular&nbsp;passion&nbsp;from&nbsp;&#34;</span>&nbsp;<span class="op" id="6926153">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6926158">&#34;other&nbsp;animals,&nbsp;which&nbsp;is&nbsp;a&nbsp;lust&nbsp;of&nbsp;the&nbsp;mind,&nbsp;that&nbsp;by&nbsp;a&nbsp;perseverance&nbsp;of&nbsp;delight&nbsp;in&nbsp;&#34;</span>&nbsp;<span class="op" id="6926242">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6926247">&#34;the&nbsp;continued&nbsp;and&nbsp;indefatigable&nbsp;generation&nbsp;of&nbsp;knowledge,&nbsp;exceeds&nbsp;the&nbsp;short&nbsp;&#34;</span>&nbsp;<span class="op" id="6926325">+</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6926330">&#34;vehemence&nbsp;of&nbsp;any&nbsp;carnal&nbsp;pleasure.&#34;</span><span class="op" id="6926365">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6926369">&#34;9jqo^BlbD-BleB1DJ+*+F(f,q/0JhKF&lt;GL&gt;Cj@.4Gp$d7F!,L7@&lt;6@)/0JDEF&lt;G%&lt;+EV:2F!,\n&#34;</span>&nbsp;<span class="op" id="6926447">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6926452">&#34;O&lt;DJ+*.@&lt;*K0@&lt;6L(Df-\\0Ec5e;DffZ(EZee.Bl.9pF\&#34;AGXBPCsi+DGm&gt;@3BB/F*&amp;OCAfu2/AKY\n&#34;</span>&nbsp;<span class="op" id="6926534">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6926539">&#34;i(DIb:@FD,*)+C]U=@3BN#EcYf8ATD3s@q?d$AftVqCh[NqF&lt;G:8+EV:.+Cf&gt;-FD5W8ARlolDIa\n&#34;</span>&nbsp;<span class="op" id="6926619">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6926624">&#34;l(DId&lt;j@&lt;?3r@:F%a+D58&#39;ATD4$Bl@l3De:,-DJs`8ARoFb/0JMK@qB4^F!,R&lt;AKZ&amp;-DfTqBG%G\n&#34;</span>&nbsp;<span class="op" id="6926704">+</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6926709">&#34;&gt;uD.RTpAKYo&#39;+CT/5+Cei#DII?(E,9)oF*2M7/c\n&#34;</span><span class="op" id="6926752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926755">}</span><span class="op" id="6926756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6926759">//&nbsp;Special&nbsp;case&nbsp;when&nbsp;shortening&nbsp;!!!!!&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6926808">&#34;\000\000\000\000&#34;</span><span class="op" id="6926826">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6926830">&#34;z&#34;</span><span class="op" id="6926833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926836">}</span><span class="op" id="6926837">,</span><br>
<span class="lineno"></span><span class="op" id="6926839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6926842">var</span>&nbsp;<span class="ident" id="6926846">bigtest</span>&nbsp;<span class="op" id="6926854">=</span>&nbsp;<span class="ident" id="6926856">pairs</span><span class="op" id="6926861">[</span><span class="builtinfunc" id="6926862">len</span><span class="op" id="6926865">(</span><span class="ident" id="6926866">pairs</span><span class="op" id="6926871">)</span><span class="op" id="6926872">-</span><span class="num" id="6926873">1</span><span class="op" id="6926874">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6926877">func</span>&nbsp;<span class="ident" id="6926882">testEqual</span><span class="op" id="6926891">(</span><span class="ident" id="6926892">t</span>&nbsp;<span class="op" id="6926894">*</span><span class="ident" id="6926895">testing</span><span class="op" id="6926902">.</span><span class="ident" id="6926903">T</span><span class="op" id="6926904">,</span>&nbsp;<span class="ident" id="6926906">msg</span>&nbsp;<span class="builtintype" id="6926910">string</span><span class="op" id="6926916">,</span>&nbsp;<span class="ident" id="6926918">args</span>&nbsp;<span class="op" id="6926923">...</span><span class="keyword" id="6926926">interface</span><span class="op" id="6926935">{</span><span class="op" id="6926936">}</span><span class="op" id="6926937">)</span>&nbsp;<span class="builtintype" id="6926939">bool</span>&nbsp;<span class="op" id="6926944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6926947">if</span>&nbsp;<span class="ident" id="6926950">args</span><span class="op" id="6926954">[</span><span class="builtinfunc" id="6926955">len</span><span class="op" id="6926958">(</span><span class="ident" id="6926959">args</span><span class="op" id="6926963">)</span><span class="op" id="6926964">-</span><span class="num" id="6926965">2</span><span class="op" id="6926966">]</span>&nbsp;<span class="op" id="6926968">!=</span>&nbsp;<span class="ident" id="6926971">args</span><span class="op" id="6926975">[</span><span class="builtinfunc" id="6926976">len</span><span class="op" id="6926979">(</span><span class="ident" id="6926980">args</span><span class="op" id="6926984">)</span><span class="op" id="6926985">-</span><span class="num" id="6926986">1</span><span class="op" id="6926987">]</span>&nbsp;<span class="op" id="6926989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926993">t</span><span class="op" id="6926994">.</span><span class="ident" id="6926995">Errorf</span><span class="op" id="6927001">(</span><span class="ident" id="6927002">msg</span><span class="op" id="6927005">,</span>&nbsp;<span class="ident" id="6927007">args</span><span class="op" id="6927011">...</span><span class="op" id="6927014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6927018">return</span>&nbsp;<span class="builtintype" id="6927025">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6927032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6927035">return</span>&nbsp;<span class="builtintype" id="6927042">true</span><br>
<span class="lineno"></span><span class="op" id="6927047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6927050">func</span>&nbsp;<span class="ident" id="6927055">strip85</span><span class="op" id="6927062">(</span><span class="ident" id="6927063">s</span>&nbsp;<span class="builtintype" id="6927065">string</span><span class="op" id="6927071">)</span>&nbsp;<span class="builtintype" id="6927073">string</span>&nbsp;<span class="op" id="6927080">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927083">t</span>&nbsp;<span class="op" id="6927085">:=</span>&nbsp;<span class="builtinfunc" id="6927088">make</span><span class="op" id="6927092">(</span><span class="op" id="6927093">[</span><span class="op" id="6927094">]</span><span class="builtintype" id="6927095">byte</span><span class="op" id="6927099">,</span>&nbsp;<span class="builtinfunc" id="6927101">len</span><span class="op" id="6927104">(</span><span class="ident" id="6927105">s</span><span class="op" id="6927106">)</span><span class="op" id="6927107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927110">w</span>&nbsp;<span class="op" id="6927112">:=</span>&nbsp;<span class="num" id="6927115">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6927118">for</span>&nbsp;<span class="ident" id="6927122">r</span>&nbsp;<span class="op" id="6927124">:=</span>&nbsp;<span class="num" id="6927127">0</span><span class="op" id="6927128">;</span>&nbsp;<span class="ident" id="6927130">r</span>&nbsp;<span class="op" id="6927132">&lt;</span>&nbsp;<span class="builtinfunc" id="6927134">len</span><span class="op" id="6927137">(</span><span class="ident" id="6927138">s</span><span class="op" id="6927139">)</span><span class="op" id="6927140">;</span>&nbsp;<span class="ident" id="6927142">r</span><span class="op" id="6927143">++</span>&nbsp;<span class="op" id="6927146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927150">c</span>&nbsp;<span class="op" id="6927152">:=</span>&nbsp;<span class="ident" id="6927155">s</span><span class="op" id="6927156">[</span><span class="ident" id="6927157">r</span><span class="op" id="6927158">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6927162">if</span>&nbsp;<span class="ident" id="6927165">c</span>&nbsp;<span class="op" id="6927167">&gt;</span>&nbsp;<span class="string" id="6927169">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6927173">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927178">t</span><span class="op" id="6927179">[</span><span class="ident" id="6927180">w</span><span class="op" id="6927181">]</span>&nbsp;<span class="op" id="6927183">=</span>&nbsp;<span class="ident" id="6927185">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927190">w</span><span class="op" id="6927191">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6927196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6927199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6927202">return</span>&nbsp;<span class="builtintype" id="6927209">string</span><span class="op" id="6927215">(</span><span class="ident" id="6927216">t</span><span class="op" id="6927217">[</span><span class="num" id="6927218">0</span><span class="op" id="6927219">:</span><span class="ident" id="6927220">w</span><span class="op" id="6927221">]</span><span class="op" id="6927222">)</span><br>
<span class="lineno">65</span><span class="op" id="6927224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6927227">func</span>&nbsp;<span class="ident" id="6927232">TestEncode</span><span class="op" id="6927242">(</span><span class="ident" id="6927243">t</span>&nbsp;<span class="op" id="6927245">*</span><span class="ident" id="6927246">testing</span><span class="op" id="6927253">.</span><span class="ident" id="6927254">T</span><span class="op" id="6927255">)</span>&nbsp;<span class="op" id="6927257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6927260">for</span>&nbsp;<span class="ident" id="6927264">_</span><span class="op" id="6927265">,</span>&nbsp;<span class="ident" id="6927267">p</span>&nbsp;<span class="op" id="6927269">:=</span>&nbsp;<span class="keyword" id="6927272">range</span>&nbsp;<span class="ident" id="6927278">pairs</span>&nbsp;<span class="op" id="6927284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927288">buf</span>&nbsp;<span class="op" id="6927292">:=</span>&nbsp;<span class="builtinfunc" id="6927295">make</span><span class="op" id="6927299">(</span><span class="op" id="6927300">[</span><span class="op" id="6927301">]</span><span class="builtintype" id="6927302">byte</span><span class="op" id="6927306">,</span>&nbsp;<span class="ident" id="6927308">MaxEncodedLen</span><span class="op" id="6927321">(</span><span class="builtinfunc" id="6927322">len</span><span class="op" id="6927325">(</span><span class="ident" id="6927326">p</span><span class="op" id="6927327">.</span><span class="ident" id="6927328">decoded</span><span class="op" id="6927335">)</span><span class="op" id="6927336">)</span><span class="op" id="6927337">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927341">n</span>&nbsp;<span class="op" id="6927343">:=</span>&nbsp;<span class="ident" id="6927346">Encode</span><span class="op" id="6927352">(</span><span class="ident" id="6927353">buf</span><span class="op" id="6927356">,</span>&nbsp;<span class="op" id="6927358">[</span><span class="op" id="6927359">]</span><span class="builtintype" id="6927360">byte</span><span class="op" id="6927364">(</span><span class="ident" id="6927365">p</span><span class="op" id="6927366">.</span><span class="ident" id="6927367">decoded</span><span class="op" id="6927374">)</span><span class="op" id="6927375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927379">buf</span>&nbsp;<span class="op" id="6927383">=</span>&nbsp;<span class="ident" id="6927385">buf</span><span class="op" id="6927388">[</span><span class="num" id="6927389">0</span><span class="op" id="6927390">:</span><span class="ident" id="6927391">n</span><span class="op" id="6927392">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927396">testEqual</span><span class="op" id="6927405">(</span><span class="ident" id="6927406">t</span><span class="op" id="6927407">,</span>&nbsp;<span class="string" id="6927409">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6927435">,</span>&nbsp;<span class="ident" id="6927437">p</span><span class="op" id="6927438">.</span><span class="ident" id="6927439">decoded</span><span class="op" id="6927446">,</span>&nbsp;<span class="ident" id="6927448">strip85</span><span class="op" id="6927455">(</span><span class="builtintype" id="6927456">string</span><span class="op" id="6927462">(</span><span class="ident" id="6927463">buf</span><span class="op" id="6927466">)</span><span class="op" id="6927467">)</span><span class="op" id="6927468">,</span>&nbsp;<span class="ident" id="6927470">strip85</span><span class="op" id="6927477">(</span><span class="ident" id="6927478">p</span><span class="op" id="6927479">.</span><span class="ident" id="6927480">encoded</span><span class="op" id="6927487">)</span><span class="op" id="6927488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6927491">}</span><br>
<span class="lineno"></span><span class="op" id="6927493">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="6927496">func</span>&nbsp;<span class="ident" id="6927501">TestEncoder</span><span class="op" id="6927512">(</span><span class="ident" id="6927513">t</span>&nbsp;<span class="op" id="6927515">*</span><span class="ident" id="6927516">testing</span><span class="op" id="6927523">.</span><span class="ident" id="6927524">T</span><span class="op" id="6927525">)</span>&nbsp;<span class="op" id="6927527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6927530">for</span>&nbsp;<span class="ident" id="6927534">_</span><span class="op" id="6927535">,</span>&nbsp;<span class="ident" id="6927537">p</span>&nbsp;<span class="op" id="6927539">:=</span>&nbsp;<span class="keyword" id="6927542">range</span>&nbsp;<span class="ident" id="6927548">pairs</span>&nbsp;<span class="op" id="6927554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927558">bb</span>&nbsp;<span class="op" id="6927561">:=</span>&nbsp;<span class="op" id="6927564">&amp;</span><span class="ident" id="6927565">bytes</span><span class="op" id="6927570">.</span><span class="ident" id="6927571">Buffer</span><span class="op" id="6927577">{</span><span class="op" id="6927578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927582">encoder</span>&nbsp;<span class="op" id="6927590">:=</span>&nbsp;<span class="ident" id="6927593">NewEncoder</span><span class="op" id="6927603">(</span><span class="ident" id="6927604">bb</span><span class="op" id="6927606">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927610">encoder</span><span class="op" id="6927617">.</span><span class="ident" id="6927618">Write</span><span class="op" id="6927623">(</span><span class="op" id="6927624">[</span><span class="op" id="6927625">]</span><span class="builtintype" id="6927626">byte</span><span class="op" id="6927630">(</span><span class="ident" id="6927631">p</span><span class="op" id="6927632">.</span><span class="ident" id="6927633">decoded</span><span class="op" id="6927640">)</span><span class="op" id="6927641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927645">encoder</span><span class="op" id="6927652">.</span><span class="ident" id="6927653">Close</span><span class="op" id="6927658">(</span><span class="op" id="6927659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927663">testEqual</span><span class="op" id="6927672">(</span><span class="ident" id="6927673">t</span><span class="op" id="6927674">,</span>&nbsp;<span class="string" id="6927676">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6927702">,</span>&nbsp;<span class="ident" id="6927704">p</span><span class="op" id="6927705">.</span><span class="ident" id="6927706">decoded</span><span class="op" id="6927713">,</span>&nbsp;<span class="ident" id="6927715">strip85</span><span class="op" id="6927722">(</span><span class="ident" id="6927723">bb</span><span class="op" id="6927725">.</span><span class="ident" id="6927726">String</span><span class="op" id="6927732">(</span><span class="op" id="6927733">)</span><span class="op" id="6927734">)</span><span class="op" id="6927735">,</span>&nbsp;<span class="ident" id="6927737">strip85</span><span class="op" id="6927744">(</span><span class="ident" id="6927745">p</span><span class="op" id="6927746">.</span><span class="ident" id="6927747">encoded</span><span class="op" id="6927754">)</span><span class="op" id="6927755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6927758">}</span><br>
<span class="lineno"></span><span class="op" id="6927760">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="6927763">func</span>&nbsp;<span class="ident" id="6927768">TestEncoderBuffering</span><span class="op" id="6927788">(</span><span class="ident" id="6927789">t</span>&nbsp;<span class="op" id="6927791">*</span><span class="ident" id="6927792">testing</span><span class="op" id="6927799">.</span><span class="ident" id="6927800">T</span><span class="op" id="6927801">)</span>&nbsp;<span class="op" id="6927803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927806">input</span>&nbsp;<span class="op" id="6927812">:=</span>&nbsp;<span class="op" id="6927815">[</span><span class="op" id="6927816">]</span><span class="builtintype" id="6927817">byte</span><span class="op" id="6927821">(</span><span class="ident" id="6927822">bigtest</span><span class="op" id="6927829">.</span><span class="ident" id="6927830">decoded</span><span class="op" id="6927837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6927840">for</span>&nbsp;<span class="ident" id="6927844">bs</span>&nbsp;<span class="op" id="6927847">:=</span>&nbsp;<span class="num" id="6927850">1</span><span class="op" id="6927851">;</span>&nbsp;<span class="ident" id="6927853">bs</span>&nbsp;<span class="op" id="6927856">&lt;=</span>&nbsp;<span class="num" id="6927859">12</span><span class="op" id="6927861">;</span>&nbsp;<span class="ident" id="6927863">bs</span><span class="op" id="6927865">++</span>&nbsp;<span class="op" id="6927868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927872">bb</span>&nbsp;<span class="op" id="6927875">:=</span>&nbsp;<span class="op" id="6927878">&amp;</span><span class="ident" id="6927879">bytes</span><span class="op" id="6927884">.</span><span class="ident" id="6927885">Buffer</span><span class="op" id="6927891">{</span><span class="op" id="6927892">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927896">encoder</span>&nbsp;<span class="op" id="6927904">:=</span>&nbsp;<span class="ident" id="6927907">NewEncoder</span><span class="op" id="6927917">(</span><span class="ident" id="6927918">bb</span><span class="op" id="6927920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6927924">for</span>&nbsp;<span class="ident" id="6927928">pos</span>&nbsp;<span class="op" id="6927932">:=</span>&nbsp;<span class="num" id="6927935">0</span><span class="op" id="6927936">;</span>&nbsp;<span class="ident" id="6927938">pos</span>&nbsp;<span class="op" id="6927942">&lt;</span>&nbsp;<span class="builtinfunc" id="6927944">len</span><span class="op" id="6927947">(</span><span class="ident" id="6927948">input</span><span class="op" id="6927953">)</span><span class="op" id="6927954">;</span>&nbsp;<span class="ident" id="6927956">pos</span>&nbsp;<span class="op" id="6927960">+=</span>&nbsp;<span class="ident" id="6927963">bs</span>&nbsp;<span class="op" id="6927966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927971">end</span>&nbsp;<span class="op" id="6927975">:=</span>&nbsp;<span class="ident" id="6927978">pos</span>&nbsp;<span class="op" id="6927982">+</span>&nbsp;<span class="ident" id="6927984">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6927990">if</span>&nbsp;<span class="ident" id="6927993">end</span>&nbsp;<span class="op" id="6927997">&gt;</span>&nbsp;<span class="builtinfunc" id="6927999">len</span><span class="op" id="6928002">(</span><span class="ident" id="6928003">input</span><span class="op" id="6928008">)</span>&nbsp;<span class="op" id="6928010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928016">end</span>&nbsp;<span class="op" id="6928020">=</span>&nbsp;<span class="builtinfunc" id="6928022">len</span><span class="op" id="6928025">(</span><span class="ident" id="6928026">input</span><span class="op" id="6928031">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928041">n</span><span class="op" id="6928042">,</span>&nbsp;<span class="ident" id="6928044">err</span>&nbsp;<span class="op" id="6928048">:=</span>&nbsp;<span class="ident" id="6928051">encoder</span><span class="op" id="6928058">.</span><span class="ident" id="6928059">Write</span><span class="op" id="6928064">(</span><span class="ident" id="6928065">input</span><span class="op" id="6928070">[</span><span class="ident" id="6928071">pos</span><span class="op" id="6928074">:</span><span class="ident" id="6928075">end</span><span class="op" id="6928078">]</span><span class="op" id="6928079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928084">testEqual</span><span class="op" id="6928093">(</span><span class="ident" id="6928094">t</span><span class="op" id="6928095">,</span>&nbsp;<span class="string" id="6928097">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6928131">,</span>&nbsp;<span class="ident" id="6928133">input</span><span class="op" id="6928138">[</span><span class="ident" id="6928139">pos</span><span class="op" id="6928142">:</span><span class="ident" id="6928143">end</span><span class="op" id="6928146">]</span><span class="op" id="6928147">,</span>&nbsp;<span class="ident" id="6928149">err</span><span class="op" id="6928152">,</span>&nbsp;<span class="builtintype" id="6928154">error</span><span class="op" id="6928159">(</span><span class="ident" id="6928160">nil</span><span class="op" id="6928163">)</span><span class="op" id="6928164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928169">testEqual</span><span class="op" id="6928178">(</span><span class="ident" id="6928179">t</span><span class="op" id="6928180">,</span>&nbsp;<span class="string" id="6928182">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6928217">,</span>&nbsp;<span class="ident" id="6928219">input</span><span class="op" id="6928224">[</span><span class="ident" id="6928225">pos</span><span class="op" id="6928228">:</span><span class="ident" id="6928229">end</span><span class="op" id="6928232">]</span><span class="op" id="6928233">,</span>&nbsp;<span class="ident" id="6928235">n</span><span class="op" id="6928236">,</span>&nbsp;<span class="ident" id="6928238">end</span><span class="op" id="6928241">-</span><span class="ident" id="6928242">pos</span><span class="op" id="6928245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928249">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928253">err</span>&nbsp;<span class="op" id="6928257">:=</span>&nbsp;<span class="ident" id="6928260">encoder</span><span class="op" id="6928267">.</span><span class="ident" id="6928268">Close</span><span class="op" id="6928273">(</span><span class="op" id="6928274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928278">testEqual</span><span class="op" id="6928287">(</span><span class="ident" id="6928288">t</span><span class="op" id="6928289">,</span>&nbsp;<span class="string" id="6928291">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6928321">,</span>&nbsp;<span class="ident" id="6928323">err</span><span class="op" id="6928326">,</span>&nbsp;<span class="builtintype" id="6928328">error</span><span class="op" id="6928333">(</span><span class="ident" id="6928334">nil</span><span class="op" id="6928337">)</span><span class="op" id="6928338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928342">testEqual</span><span class="op" id="6928351">(</span><span class="ident" id="6928352">t</span><span class="op" id="6928353">,</span>&nbsp;<span class="string" id="6928355">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6928388">,</span>&nbsp;<span class="ident" id="6928390">bs</span><span class="op" id="6928392">,</span>&nbsp;<span class="ident" id="6928394">bigtest</span><span class="op" id="6928401">.</span><span class="ident" id="6928402">decoded</span><span class="op" id="6928409">,</span>&nbsp;<span class="ident" id="6928411">strip85</span><span class="op" id="6928418">(</span><span class="ident" id="6928419">bb</span><span class="op" id="6928421">.</span><span class="ident" id="6928422">String</span><span class="op" id="6928428">(</span><span class="op" id="6928429">)</span><span class="op" id="6928430">)</span><span class="op" id="6928431">,</span>&nbsp;<span class="ident" id="6928433">strip85</span><span class="op" id="6928440">(</span><span class="ident" id="6928441">bigtest</span><span class="op" id="6928448">.</span><span class="ident" id="6928449">encoded</span><span class="op" id="6928456">)</span><span class="op" id="6928457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928460">}</span><br>
<span class="lineno"></span><span class="op" id="6928462">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6928465">func</span>&nbsp;<span class="ident" id="6928470">TestDecode</span><span class="op" id="6928480">(</span><span class="ident" id="6928481">t</span>&nbsp;<span class="op" id="6928483">*</span><span class="ident" id="6928484">testing</span><span class="op" id="6928491">.</span><span class="ident" id="6928492">T</span><span class="op" id="6928493">)</span>&nbsp;<span class="op" id="6928495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6928498">for</span>&nbsp;<span class="ident" id="6928502">_</span><span class="op" id="6928503">,</span>&nbsp;<span class="ident" id="6928505">p</span>&nbsp;<span class="op" id="6928507">:=</span>&nbsp;<span class="keyword" id="6928510">range</span>&nbsp;<span class="ident" id="6928516">pairs</span>&nbsp;<span class="op" id="6928522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928526">dbuf</span>&nbsp;<span class="op" id="6928531">:=</span>&nbsp;<span class="builtinfunc" id="6928534">make</span><span class="op" id="6928538">(</span><span class="op" id="6928539">[</span><span class="op" id="6928540">]</span><span class="builtintype" id="6928541">byte</span><span class="op" id="6928545">,</span>&nbsp;<span class="num" id="6928547">4</span><span class="op" id="6928548">*</span><span class="builtinfunc" id="6928549">len</span><span class="op" id="6928552">(</span><span class="ident" id="6928553">p</span><span class="op" id="6928554">.</span><span class="ident" id="6928555">encoded</span><span class="op" id="6928562">)</span><span class="op" id="6928563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928567">ndst</span><span class="op" id="6928571">,</span>&nbsp;<span class="ident" id="6928573">nsrc</span><span class="op" id="6928577">,</span>&nbsp;<span class="ident" id="6928579">err</span>&nbsp;<span class="op" id="6928583">:=</span>&nbsp;<span class="ident" id="6928586">Decode</span><span class="op" id="6928592">(</span><span class="ident" id="6928593">dbuf</span><span class="op" id="6928597">,</span>&nbsp;<span class="op" id="6928599">[</span><span class="op" id="6928600">]</span><span class="builtintype" id="6928601">byte</span><span class="op" id="6928605">(</span><span class="ident" id="6928606">p</span><span class="op" id="6928607">.</span><span class="ident" id="6928608">encoded</span><span class="op" id="6928615">)</span><span class="op" id="6928616">,</span>&nbsp;<span class="builtintype" id="6928618">true</span><span class="op" id="6928622">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928626">testEqual</span><span class="op" id="6928635">(</span><span class="ident" id="6928636">t</span><span class="op" id="6928637">,</span>&nbsp;<span class="string" id="6928639">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6928671">,</span>&nbsp;<span class="ident" id="6928673">p</span><span class="op" id="6928674">.</span><span class="ident" id="6928675">encoded</span><span class="op" id="6928682">,</span>&nbsp;<span class="ident" id="6928684">err</span><span class="op" id="6928687">,</span>&nbsp;<span class="builtintype" id="6928689">error</span><span class="op" id="6928694">(</span><span class="ident" id="6928695">nil</span><span class="op" id="6928698">)</span><span class="op" id="6928699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928703">testEqual</span><span class="op" id="6928712">(</span><span class="ident" id="6928713">t</span><span class="op" id="6928714">,</span>&nbsp;<span class="string" id="6928716">&#34;Decode(%q)&nbsp;=&nbsp;nsrc&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6928747">,</span>&nbsp;<span class="ident" id="6928749">p</span><span class="op" id="6928750">.</span><span class="ident" id="6928751">encoded</span><span class="op" id="6928758">,</span>&nbsp;<span class="ident" id="6928760">nsrc</span><span class="op" id="6928764">,</span>&nbsp;<span class="builtinfunc" id="6928766">len</span><span class="op" id="6928769">(</span><span class="ident" id="6928770">p</span><span class="op" id="6928771">.</span><span class="ident" id="6928772">encoded</span><span class="op" id="6928779">)</span><span class="op" id="6928780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928784">testEqual</span><span class="op" id="6928793">(</span><span class="ident" id="6928794">t</span><span class="op" id="6928795">,</span>&nbsp;<span class="string" id="6928797">&#34;Decode(%q)&nbsp;=&nbsp;ndst&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6928828">,</span>&nbsp;<span class="ident" id="6928830">p</span><span class="op" id="6928831">.</span><span class="ident" id="6928832">encoded</span><span class="op" id="6928839">,</span>&nbsp;<span class="ident" id="6928841">ndst</span><span class="op" id="6928845">,</span>&nbsp;<span class="builtinfunc" id="6928847">len</span><span class="op" id="6928850">(</span><span class="ident" id="6928851">p</span><span class="op" id="6928852">.</span><span class="ident" id="6928853">decoded</span><span class="op" id="6928860">)</span><span class="op" id="6928861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928865">testEqual</span><span class="op" id="6928874">(</span><span class="ident" id="6928875">t</span><span class="op" id="6928876">,</span>&nbsp;<span class="string" id="6928878">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6928904">,</span>&nbsp;<span class="ident" id="6928906">p</span><span class="op" id="6928907">.</span><span class="ident" id="6928908">encoded</span><span class="op" id="6928915">,</span>&nbsp;<span class="builtintype" id="6928917">string</span><span class="op" id="6928923">(</span><span class="ident" id="6928924">dbuf</span><span class="op" id="6928928">[</span><span class="num" id="6928929">0</span><span class="op" id="6928930">:</span><span class="ident" id="6928931">ndst</span><span class="op" id="6928935">]</span><span class="op" id="6928936">)</span><span class="op" id="6928937">,</span>&nbsp;<span class="ident" id="6928939">p</span><span class="op" id="6928940">.</span><span class="ident" id="6928941">decoded</span><span class="op" id="6928948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928951">}</span><br>
<span class="lineno">115</span><span class="op" id="6928953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6928956">func</span>&nbsp;<span class="ident" id="6928961">TestDecoder</span><span class="op" id="6928972">(</span><span class="ident" id="6928973">t</span>&nbsp;<span class="op" id="6928975">*</span><span class="ident" id="6928976">testing</span><span class="op" id="6928983">.</span><span class="ident" id="6928984">T</span><span class="op" id="6928985">)</span>&nbsp;<span class="op" id="6928987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6928990">for</span>&nbsp;<span class="ident" id="6928994">_</span><span class="op" id="6928995">,</span>&nbsp;<span class="ident" id="6928997">p</span>&nbsp;<span class="op" id="6928999">:=</span>&nbsp;<span class="keyword" id="6929002">range</span>&nbsp;<span class="ident" id="6929008">pairs</span>&nbsp;<span class="op" id="6929014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929018">decoder</span>&nbsp;<span class="op" id="6929026">:=</span>&nbsp;<span class="ident" id="6929029">NewDecoder</span><span class="op" id="6929039">(</span><span class="ident" id="6929040">strings</span><span class="op" id="6929047">.</span><span class="ident" id="6929048">NewReader</span><span class="op" id="6929057">(</span><span class="ident" id="6929058">p</span><span class="op" id="6929059">.</span><span class="ident" id="6929060">encoded</span><span class="op" id="6929067">)</span><span class="op" id="6929068">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929072">dbuf</span><span class="op" id="6929076">,</span>&nbsp;<span class="ident" id="6929078">err</span>&nbsp;<span class="op" id="6929082">:=</span>&nbsp;<span class="ident" id="6929085">ioutil</span><span class="op" id="6929091">.</span><span class="ident" id="6929092">ReadAll</span><span class="op" id="6929099">(</span><span class="ident" id="6929100">decoder</span><span class="op" id="6929107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6929111">if</span>&nbsp;<span class="ident" id="6929114">err</span>&nbsp;<span class="op" id="6929118">!=</span>&nbsp;<span class="ident" id="6929121">nil</span>&nbsp;<span class="op" id="6929125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929130">t</span><span class="op" id="6929131">.</span><span class="ident" id="6929132">Fatal</span><span class="op" id="6929137">(</span><span class="string" id="6929138">&#34;Read&nbsp;failed&#34;</span><span class="op" id="6929151">,</span>&nbsp;<span class="ident" id="6929153">err</span><span class="op" id="6929156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6929160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929164">testEqual</span><span class="op" id="6929173">(</span><span class="ident" id="6929174">t</span><span class="op" id="6929175">,</span>&nbsp;<span class="string" id="6929177">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6929212">,</span>&nbsp;<span class="ident" id="6929214">p</span><span class="op" id="6929215">.</span><span class="ident" id="6929216">encoded</span><span class="op" id="6929223">,</span>&nbsp;<span class="builtinfunc" id="6929225">len</span><span class="op" id="6929228">(</span><span class="ident" id="6929229">dbuf</span><span class="op" id="6929233">)</span><span class="op" id="6929234">,</span>&nbsp;<span class="builtinfunc" id="6929236">len</span><span class="op" id="6929239">(</span><span class="ident" id="6929240">p</span><span class="op" id="6929241">.</span><span class="ident" id="6929242">decoded</span><span class="op" id="6929249">)</span><span class="op" id="6929250">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929254">testEqual</span><span class="op" id="6929263">(</span><span class="ident" id="6929264">t</span><span class="op" id="6929265">,</span>&nbsp;<span class="string" id="6929267">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6929297">,</span>&nbsp;<span class="ident" id="6929299">p</span><span class="op" id="6929300">.</span><span class="ident" id="6929301">encoded</span><span class="op" id="6929308">,</span>&nbsp;<span class="builtintype" id="6929310">string</span><span class="op" id="6929316">(</span><span class="ident" id="6929317">dbuf</span><span class="op" id="6929321">)</span><span class="op" id="6929322">,</span>&nbsp;<span class="ident" id="6929324">p</span><span class="op" id="6929325">.</span><span class="ident" id="6929326">decoded</span><span class="op" id="6929333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6929337">if</span>&nbsp;<span class="ident" id="6929340">err</span>&nbsp;<span class="op" id="6929344">!=</span>&nbsp;<span class="ident" id="6929347">nil</span>&nbsp;<span class="op" id="6929351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929356">testEqual</span><span class="op" id="6929365">(</span><span class="ident" id="6929366">t</span><span class="op" id="6929367">,</span>&nbsp;<span class="string" id="6929369">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6929397">,</span>&nbsp;<span class="ident" id="6929399">p</span><span class="op" id="6929400">.</span><span class="ident" id="6929401">encoded</span><span class="op" id="6929408">,</span>&nbsp;<span class="ident" id="6929410">err</span><span class="op" id="6929413">,</span>&nbsp;<span class="ident" id="6929415">io</span><span class="op" id="6929417">.</span><span class="ident" id="6929418">EOF</span><span class="op" id="6929421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6929425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6929428">}</span><br>
<span class="lineno">130</span><span class="op" id="6929430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6929433">func</span>&nbsp;<span class="ident" id="6929438">TestDecoderBuffering</span><span class="op" id="6929458">(</span><span class="ident" id="6929459">t</span>&nbsp;<span class="op" id="6929461">*</span><span class="ident" id="6929462">testing</span><span class="op" id="6929469">.</span><span class="ident" id="6929470">T</span><span class="op" id="6929471">)</span>&nbsp;<span class="op" id="6929473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6929476">for</span>&nbsp;<span class="ident" id="6929480">bs</span>&nbsp;<span class="op" id="6929483">:=</span>&nbsp;<span class="num" id="6929486">1</span><span class="op" id="6929487">;</span>&nbsp;<span class="ident" id="6929489">bs</span>&nbsp;<span class="op" id="6929492">&lt;=</span>&nbsp;<span class="num" id="6929495">12</span><span class="op" id="6929497">;</span>&nbsp;<span class="ident" id="6929499">bs</span><span class="op" id="6929501">++</span>&nbsp;<span class="op" id="6929504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929508">decoder</span>&nbsp;<span class="op" id="6929516">:=</span>&nbsp;<span class="ident" id="6929519">NewDecoder</span><span class="op" id="6929529">(</span><span class="ident" id="6929530">strings</span><span class="op" id="6929537">.</span><span class="ident" id="6929538">NewReader</span><span class="op" id="6929547">(</span><span class="ident" id="6929548">bigtest</span><span class="op" id="6929555">.</span><span class="ident" id="6929556">encoded</span><span class="op" id="6929563">)</span><span class="op" id="6929564">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929568">buf</span>&nbsp;<span class="op" id="6929572">:=</span>&nbsp;<span class="builtinfunc" id="6929575">make</span><span class="op" id="6929579">(</span><span class="op" id="6929580">[</span><span class="op" id="6929581">]</span><span class="builtintype" id="6929582">byte</span><span class="op" id="6929586">,</span>&nbsp;<span class="builtinfunc" id="6929588">len</span><span class="op" id="6929591">(</span><span class="ident" id="6929592">bigtest</span><span class="op" id="6929599">.</span><span class="ident" id="6929600">decoded</span><span class="op" id="6929607">)</span><span class="op" id="6929608">+</span><span class="num" id="6929609">12</span><span class="op" id="6929611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6929615">var</span>&nbsp;<span class="ident" id="6929619">total</span>&nbsp;<span class="builtintype" id="6929625">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6929631">for</span>&nbsp;<span class="ident" id="6929635">total</span>&nbsp;<span class="op" id="6929641">=</span>&nbsp;<span class="num" id="6929643">0</span><span class="op" id="6929644">;</span>&nbsp;<span class="ident" id="6929646">total</span>&nbsp;<span class="op" id="6929652">&lt;</span>&nbsp;<span class="builtinfunc" id="6929654">len</span><span class="op" id="6929657">(</span><span class="ident" id="6929658">bigtest</span><span class="op" id="6929665">.</span><span class="ident" id="6929666">decoded</span><span class="op" id="6929673">)</span><span class="op" id="6929674">;</span>&nbsp;<span class="op" id="6929676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929681">n</span><span class="op" id="6929682">,</span>&nbsp;<span class="ident" id="6929684">err</span>&nbsp;<span class="op" id="6929688">:=</span>&nbsp;<span class="ident" id="6929691">decoder</span><span class="op" id="6929698">.</span><span class="ident" id="6929699">Read</span><span class="op" id="6929703">(</span><span class="ident" id="6929704">buf</span><span class="op" id="6929707">[</span><span class="ident" id="6929708">total</span>&nbsp;<span class="op" id="6929714">:</span>&nbsp;<span class="ident" id="6929716">total</span><span class="op" id="6929721">+</span><span class="ident" id="6929722">bs</span><span class="op" id="6929724">]</span><span class="op" id="6929725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929730">testEqual</span><span class="op" id="6929739">(</span><span class="ident" id="6929740">t</span><span class="op" id="6929741">,</span>&nbsp;<span class="string" id="6929743">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="6929788">,</span>&nbsp;<span class="ident" id="6929790">bigtest</span><span class="op" id="6929797">.</span><span class="ident" id="6929798">encoded</span><span class="op" id="6929805">,</span>&nbsp;<span class="ident" id="6929807">total</span><span class="op" id="6929812">,</span>&nbsp;<span class="ident" id="6929814">n</span><span class="op" id="6929815">,</span>&nbsp;<span class="ident" id="6929817">err</span><span class="op" id="6929820">,</span>&nbsp;<span class="builtintype" id="6929822">error</span><span class="op" id="6929827">(</span><span class="ident" id="6929828">nil</span><span class="op" id="6929831">)</span><span class="op" id="6929832">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929837">total</span>&nbsp;<span class="op" id="6929843">+=</span>&nbsp;<span class="ident" id="6929846">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6929850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929854">testEqual</span><span class="op" id="6929863">(</span><span class="ident" id="6929864">t</span><span class="op" id="6929865">,</span>&nbsp;<span class="string" id="6929867">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6929900">,</span>&nbsp;<span class="ident" id="6929902">bs</span><span class="op" id="6929904">,</span>&nbsp;<span class="ident" id="6929906">bigtest</span><span class="op" id="6929913">.</span><span class="ident" id="6929914">encoded</span><span class="op" id="6929921">,</span>&nbsp;<span class="builtintype" id="6929923">string</span><span class="op" id="6929929">(</span><span class="ident" id="6929930">buf</span><span class="op" id="6929933">[</span><span class="num" id="6929934">0</span><span class="op" id="6929935">:</span><span class="ident" id="6929936">total</span><span class="op" id="6929941">]</span><span class="op" id="6929942">)</span><span class="op" id="6929943">,</span>&nbsp;<span class="ident" id="6929945">bigtest</span><span class="op" id="6929952">.</span><span class="ident" id="6929953">decoded</span><span class="op" id="6929960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6929963">}</span><br>
<span class="lineno"></span><span class="op" id="6929965">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="6929968">func</span>&nbsp;<span class="ident" id="6929973">TestDecodeCorrupt</span><span class="op" id="6929990">(</span><span class="ident" id="6929991">t</span>&nbsp;<span class="op" id="6929993">*</span><span class="ident" id="6929994">testing</span><span class="op" id="6930001">.</span><span class="ident" id="6930002">T</span><span class="op" id="6930003">)</span>&nbsp;<span class="op" id="6930005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6930008">type</span>&nbsp;<span class="ident" id="6930013">corrupt</span>&nbsp;<span class="keyword" id="6930021">struct</span>&nbsp;<span class="op" id="6930028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930032">e</span>&nbsp;<span class="builtintype" id="6930034">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930043">p</span>&nbsp;<span class="builtintype" id="6930045">int</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930053">examples</span>&nbsp;<span class="op" id="6930062">:=</span>&nbsp;<span class="op" id="6930065">[</span><span class="op" id="6930066">]</span><span class="ident" id="6930067">corrupt</span><span class="op" id="6930074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930078">{</span><span class="string" id="6930079">&#34;v&#34;</span><span class="op" id="6930082">,</span>&nbsp;<span class="num" id="6930084">0</span><span class="op" id="6930085">}</span><span class="op" id="6930086">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930090">{</span><span class="string" id="6930091">&#34;!z!!!!!!!!!&#34;</span><span class="op" id="6930104">,</span>&nbsp;<span class="num" id="6930106">1</span><span class="op" id="6930107">}</span><span class="op" id="6930108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930111">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6930115">for</span>&nbsp;<span class="ident" id="6930119">_</span><span class="op" id="6930120">,</span>&nbsp;<span class="ident" id="6930122">e</span>&nbsp;<span class="op" id="6930124">:=</span>&nbsp;<span class="keyword" id="6930127">range</span>&nbsp;<span class="ident" id="6930133">examples</span>&nbsp;<span class="op" id="6930142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930146">dbuf</span>&nbsp;<span class="op" id="6930151">:=</span>&nbsp;<span class="builtinfunc" id="6930154">make</span><span class="op" id="6930158">(</span><span class="op" id="6930159">[</span><span class="op" id="6930160">]</span><span class="builtintype" id="6930161">byte</span><span class="op" id="6930165">,</span>&nbsp;<span class="num" id="6930167">4</span><span class="op" id="6930168">*</span><span class="builtinfunc" id="6930169">len</span><span class="op" id="6930172">(</span><span class="ident" id="6930173">e</span><span class="op" id="6930174">.</span><span class="ident" id="6930175">e</span><span class="op" id="6930176">)</span><span class="op" id="6930177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930181">_</span><span class="op" id="6930182">,</span>&nbsp;<span class="ident" id="6930184">_</span><span class="op" id="6930185">,</span>&nbsp;<span class="ident" id="6930187">err</span>&nbsp;<span class="op" id="6930191">:=</span>&nbsp;<span class="ident" id="6930194">Decode</span><span class="op" id="6930200">(</span><span class="ident" id="6930201">dbuf</span><span class="op" id="6930205">,</span>&nbsp;<span class="op" id="6930207">[</span><span class="op" id="6930208">]</span><span class="builtintype" id="6930209">byte</span><span class="op" id="6930213">(</span><span class="ident" id="6930214">e</span><span class="op" id="6930215">.</span><span class="ident" id="6930216">e</span><span class="op" id="6930217">)</span><span class="op" id="6930218">,</span>&nbsp;<span class="builtintype" id="6930220">true</span><span class="op" id="6930224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6930228">switch</span>&nbsp;<span class="ident" id="6930235">err</span>&nbsp;<span class="op" id="6930239">:=</span>&nbsp;<span class="ident" id="6930242">err</span><span class="op" id="6930245">.</span><span class="op" id="6930246">(</span><span class="keyword" id="6930247">type</span><span class="op" id="6930251">)</span>&nbsp;<span class="op" id="6930253">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6930257">case</span>&nbsp;<span class="ident" id="6930262">CorruptInputError</span><span class="op" id="6930279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930284">testEqual</span><span class="op" id="6930293">(</span><span class="ident" id="6930294">t</span><span class="op" id="6930295">,</span>&nbsp;<span class="string" id="6930297">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6930337">,</span>&nbsp;<span class="ident" id="6930339">e</span><span class="op" id="6930340">.</span><span class="ident" id="6930341">e</span><span class="op" id="6930342">,</span>&nbsp;<span class="builtintype" id="6930344">int</span><span class="op" id="6930347">(</span><span class="ident" id="6930348">err</span><span class="op" id="6930351">)</span><span class="op" id="6930352">,</span>&nbsp;<span class="ident" id="6930354">e</span><span class="op" id="6930355">.</span><span class="ident" id="6930356">p</span><span class="op" id="6930357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6930361">default</span><span class="op" id="6930368">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930373">t</span><span class="op" id="6930374">.</span><span class="ident" id="6930375">Error</span><span class="op" id="6930380">(</span><span class="string" id="6930381">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="6930421">,</span>&nbsp;<span class="ident" id="6930423">e</span><span class="op" id="6930424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930428">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930431">}</span><br>
<span class="lineno"></span><span class="op" id="6930433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6930436">func</span>&nbsp;<span class="ident" id="6930441">TestBig</span><span class="op" id="6930448">(</span><span class="ident" id="6930449">t</span>&nbsp;<span class="op" id="6930451">*</span><span class="ident" id="6930452">testing</span><span class="op" id="6930459">.</span><span class="ident" id="6930460">T</span><span class="op" id="6930461">)</span>&nbsp;<span class="op" id="6930463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930466">n</span>&nbsp;<span class="op" id="6930468">:=</span>&nbsp;<span class="num" id="6930471">3</span><span class="op" id="6930472">*</span><span class="num" id="6930473">1000</span>&nbsp;<span class="op" id="6930478">+</span>&nbsp;<span class="num" id="6930480">1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930483">raw</span>&nbsp;<span class="op" id="6930487">:=</span>&nbsp;<span class="builtinfunc" id="6930490">make</span><span class="op" id="6930494">(</span><span class="op" id="6930495">[</span><span class="op" id="6930496">]</span><span class="builtintype" id="6930497">byte</span><span class="op" id="6930501">,</span>&nbsp;<span class="ident" id="6930503">n</span><span class="op" id="6930504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6930507">const</span>&nbsp;<span class="ident" id="6930513">alpha</span>&nbsp;<span class="op" id="6930519">=</span>&nbsp;<span class="string" id="6930521">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6930587">for</span>&nbsp;<span class="ident" id="6930591">i</span>&nbsp;<span class="op" id="6930593">:=</span>&nbsp;<span class="num" id="6930596">0</span><span class="op" id="6930597">;</span>&nbsp;<span class="ident" id="6930599">i</span>&nbsp;<span class="op" id="6930601">&lt;</span>&nbsp;<span class="ident" id="6930603">n</span><span class="op" id="6930604">;</span>&nbsp;<span class="ident" id="6930606">i</span><span class="op" id="6930607">++</span>&nbsp;<span class="op" id="6930610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930614">raw</span><span class="op" id="6930617">[</span><span class="ident" id="6930618">i</span><span class="op" id="6930619">]</span>&nbsp;<span class="op" id="6930621">=</span>&nbsp;<span class="ident" id="6930623">alpha</span><span class="op" id="6930628">[</span><span class="ident" id="6930629">i</span><span class="op" id="6930630">%</span><span class="builtinfunc" id="6930631">len</span><span class="op" id="6930634">(</span><span class="ident" id="6930635">alpha</span><span class="op" id="6930640">)</span><span class="op" id="6930641">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930644">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930647">encoded</span>&nbsp;<span class="op" id="6930655">:=</span>&nbsp;<span class="builtinfunc" id="6930658">new</span><span class="op" id="6930661">(</span><span class="ident" id="6930662">bytes</span><span class="op" id="6930667">.</span><span class="ident" id="6930668">Buffer</span><span class="op" id="6930674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930677">w</span>&nbsp;<span class="op" id="6930679">:=</span>&nbsp;<span class="ident" id="6930682">NewEncoder</span><span class="op" id="6930692">(</span><span class="ident" id="6930693">encoded</span><span class="op" id="6930700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930703">nn</span><span class="op" id="6930705">,</span>&nbsp;<span class="ident" id="6930707">err</span>&nbsp;<span class="op" id="6930711">:=</span>&nbsp;<span class="ident" id="6930714">w</span><span class="op" id="6930715">.</span><span class="ident" id="6930716">Write</span><span class="op" id="6930721">(</span><span class="ident" id="6930722">raw</span><span class="op" id="6930725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6930728">if</span>&nbsp;<span class="ident" id="6930731">nn</span>&nbsp;<span class="op" id="6930734">!=</span>&nbsp;<span class="ident" id="6930737">n</span>&nbsp;<span class="op" id="6930739">||</span>&nbsp;<span class="ident" id="6930742">err</span>&nbsp;<span class="op" id="6930746">!=</span>&nbsp;<span class="ident" id="6930749">nil</span>&nbsp;<span class="op" id="6930753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930757">t</span><span class="op" id="6930758">.</span><span class="ident" id="6930759">Fatalf</span><span class="op" id="6930765">(</span><span class="string" id="6930766">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="6930808">,</span>&nbsp;<span class="ident" id="6930810">nn</span><span class="op" id="6930812">,</span>&nbsp;<span class="ident" id="6930814">err</span><span class="op" id="6930817">,</span>&nbsp;<span class="ident" id="6930819">n</span><span class="op" id="6930820">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930826">err</span>&nbsp;<span class="op" id="6930830">=</span>&nbsp;<span class="ident" id="6930832">w</span><span class="op" id="6930833">.</span><span class="ident" id="6930834">Close</span><span class="op" id="6930839">(</span><span class="op" id="6930840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6930843">if</span>&nbsp;<span class="ident" id="6930846">err</span>&nbsp;<span class="op" id="6930850">!=</span>&nbsp;<span class="ident" id="6930853">nil</span>&nbsp;<span class="op" id="6930857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930861">t</span><span class="op" id="6930862">.</span><span class="ident" id="6930863">Fatalf</span><span class="op" id="6930869">(</span><span class="string" id="6930870">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="6930901">,</span>&nbsp;<span class="ident" id="6930903">err</span><span class="op" id="6930906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930909">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930912">decoded</span><span class="op" id="6930919">,</span>&nbsp;<span class="ident" id="6930921">err</span>&nbsp;<span class="op" id="6930925">:=</span>&nbsp;<span class="ident" id="6930928">ioutil</span><span class="op" id="6930934">.</span><span class="ident" id="6930935">ReadAll</span><span class="op" id="6930942">(</span><span class="ident" id="6930943">NewDecoder</span><span class="op" id="6930953">(</span><span class="ident" id="6930954">encoded</span><span class="op" id="6930961">)</span><span class="op" id="6930962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6930965">if</span>&nbsp;<span class="ident" id="6930968">err</span>&nbsp;<span class="op" id="6930972">!=</span>&nbsp;<span class="ident" id="6930975">nil</span>&nbsp;<span class="op" id="6930979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930983">t</span><span class="op" id="6930984">.</span><span class="ident" id="6930985">Fatalf</span><span class="op" id="6930991">(</span><span class="string" id="6930992">&#34;io.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="6931025">,</span>&nbsp;<span class="ident" id="6931027">err</span><span class="op" id="6931030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6931037">if</span>&nbsp;<span class="op" id="6931040">!</span><span class="ident" id="6931041">bytes</span><span class="op" id="6931046">.</span><span class="ident" id="6931047">Equal</span><span class="op" id="6931052">(</span><span class="ident" id="6931053">raw</span><span class="op" id="6931056">,</span>&nbsp;<span class="ident" id="6931058">decoded</span><span class="op" id="6931065">)</span>&nbsp;<span class="op" id="6931067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6931071">var</span>&nbsp;<span class="ident" id="6931075">i</span>&nbsp;<span class="builtintype" id="6931077">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6931083">for</span>&nbsp;<span class="ident" id="6931087">i</span>&nbsp;<span class="op" id="6931089">=</span>&nbsp;<span class="num" id="6931091">0</span><span class="op" id="6931092">;</span>&nbsp;<span class="ident" id="6931094">i</span>&nbsp;<span class="op" id="6931096">&lt;</span>&nbsp;<span class="builtinfunc" id="6931098">len</span><span class="op" id="6931101">(</span><span class="ident" id="6931102">decoded</span><span class="op" id="6931109">)</span>&nbsp;<span class="op" id="6931111">&amp;&amp;</span>&nbsp;<span class="ident" id="6931114">i</span>&nbsp;<span class="op" id="6931116">&lt;</span>&nbsp;<span class="builtinfunc" id="6931118">len</span><span class="op" id="6931121">(</span><span class="ident" id="6931122">raw</span><span class="op" id="6931125">)</span><span class="op" id="6931126">;</span>&nbsp;<span class="ident" id="6931128">i</span><span class="op" id="6931129">++</span>&nbsp;<span class="op" id="6931132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6931137">if</span>&nbsp;<span class="ident" id="6931140">decoded</span><span class="op" id="6931147">[</span><span class="ident" id="6931148">i</span><span class="op" id="6931149">]</span>&nbsp;<span class="op" id="6931151">!=</span>&nbsp;<span class="ident" id="6931154">raw</span><span class="op" id="6931157">[</span><span class="ident" id="6931158">i</span><span class="op" id="6931159">]</span>&nbsp;<span class="op" id="6931161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6931167">break</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6931184">t</span><span class="op" id="6931185">.</span><span class="ident" id="6931186">Errorf</span><span class="op" id="6931192">(</span><span class="string" id="6931193">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="6931245">,</span>&nbsp;<span class="ident" id="6931247">n</span><span class="op" id="6931248">,</span>&nbsp;<span class="ident" id="6931250">i</span><span class="op" id="6931251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931254">}</span><br>
<span class="lineno"></span><span class="op" id="6931256">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="6931259">func</span>&nbsp;<span class="ident" id="6931264">TestDecoderInternalWhitespace</span><span class="op" id="6931293">(</span><span class="ident" id="6931294">t</span>&nbsp;<span class="op" id="6931296">*</span><span class="ident" id="6931297">testing</span><span class="op" id="6931304">.</span><span class="ident" id="6931305">T</span><span class="op" id="6931306">)</span>&nbsp;<span class="op" id="6931308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6931311">s</span>&nbsp;<span class="op" id="6931313">:=</span>&nbsp;<span class="ident" id="6931316">strings</span><span class="op" id="6931323">.</span><span class="ident" id="6931324">Repeat</span><span class="op" id="6931330">(</span><span class="string" id="6931331">&#34;&nbsp;&#34;</span><span class="op" id="6931334">,</span>&nbsp;<span class="num" id="6931336">2048</span><span class="op" id="6931340">)</span>&nbsp;<span class="op" id="6931342">+</span>&nbsp;<span class="string" id="6931344">&#34;z&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6931349">decoded</span><span class="op" id="6931356">,</span>&nbsp;<span class="ident" id="6931358">err</span>&nbsp;<span class="op" id="6931362">:=</span>&nbsp;<span class="ident" id="6931365">ioutil</span><span class="op" id="6931371">.</span><span class="ident" id="6931372">ReadAll</span><span class="op" id="6931379">(</span><span class="ident" id="6931380">NewDecoder</span><span class="op" id="6931390">(</span><span class="ident" id="6931391">strings</span><span class="op" id="6931398">.</span><span class="ident" id="6931399">NewReader</span><span class="op" id="6931408">(</span><span class="ident" id="6931409">s</span><span class="op" id="6931410">)</span><span class="op" id="6931411">)</span><span class="op" id="6931412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6931415">if</span>&nbsp;<span class="ident" id="6931418">err</span>&nbsp;<span class="op" id="6931422">!=</span>&nbsp;<span class="ident" id="6931425">nil</span>&nbsp;<span class="op" id="6931429">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6931433">t</span><span class="op" id="6931434">.</span><span class="ident" id="6931435">Errorf</span><span class="op" id="6931441">(</span><span class="string" id="6931442">&#34;Decode&nbsp;gave&nbsp;error&nbsp;%v&#34;</span><span class="op" id="6931464">,</span>&nbsp;<span class="ident" id="6931466">err</span><span class="op" id="6931469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6931475">if</span>&nbsp;<span class="ident" id="6931478">want</span>&nbsp;<span class="op" id="6931483">:=</span>&nbsp;<span class="op" id="6931486">[</span><span class="op" id="6931487">]</span><span class="builtintype" id="6931488">byte</span><span class="op" id="6931492">(</span><span class="string" id="6931493">&#34;\000\000\000\000&#34;</span><span class="op" id="6931511">)</span><span class="op" id="6931512">;</span>&nbsp;<span class="op" id="6931514">!</span><span class="ident" id="6931515">bytes</span><span class="op" id="6931520">.</span><span class="ident" id="6931521">Equal</span><span class="op" id="6931526">(</span><span class="ident" id="6931527">want</span><span class="op" id="6931531">,</span>&nbsp;<span class="ident" id="6931533">decoded</span><span class="op" id="6931540">)</span>&nbsp;<span class="op" id="6931542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6931546">t</span><span class="op" id="6931547">.</span><span class="ident" id="6931548">Errorf</span><span class="op" id="6931554">(</span><span class="string" id="6931555">&#34;Decode&nbsp;failed:&nbsp;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6931587">,</span>&nbsp;<span class="ident" id="6931589">decoded</span><span class="op" id="6931596">,</span>&nbsp;<span class="ident" id="6931598">want</span><span class="op" id="6931602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931605">}</span><br>
<span class="lineno">210</span><span class="op" id="6931607">}</span>
</div>
</body>
</html>
