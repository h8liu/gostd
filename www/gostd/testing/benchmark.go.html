<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html" class="current">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5660645">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5660700">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5660754">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5660805">package</span>&nbsp;<span class="ident" id="5660813">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5660822">import</span>&nbsp;<span class="op" id="5660829">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5660832">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5660840">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5660847">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5660853">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5660864">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5660872">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5660887">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5660894">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5660897">var</span>&nbsp;<span class="ident" id="5660901">matchBenchmarks</span>&nbsp;<span class="op" id="5660917">=</span>&nbsp;<span class="ident" id="5660919">flag</span><span class="op" id="5660923">.</span><span class="ident" id="5660924">String</span><span class="op" id="5660930">(</span><span class="string" id="5660931">&#34;test.bench&#34;</span><span class="op" id="5660943">,</span>&nbsp;<span class="string" id="5660945">&#34;&#34;</span><span class="op" id="5660947">,</span>&nbsp;<span class="string" id="5660949">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="5660997">)</span><br>
<span class="lineno"></span><span class="keyword" id="5660999">var</span>&nbsp;<span class="ident" id="5661003">benchTime</span>&nbsp;<span class="op" id="5661013">=</span>&nbsp;<span class="ident" id="5661015">flag</span><span class="op" id="5661019">.</span><span class="ident" id="5661020">Duration</span><span class="op" id="5661028">(</span><span class="string" id="5661029">&#34;test.benchtime&#34;</span><span class="op" id="5661045">,</span>&nbsp;<span class="num" id="5661047">1</span><span class="op" id="5661048">*</span><span class="ident" id="5661049">time</span><span class="op" id="5661053">.</span><span class="ident" id="5661054">Second</span><span class="op" id="5661060">,</span>&nbsp;<span class="string" id="5661062">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="5661103">)</span><br>
<span class="lineno"></span><span class="keyword" id="5661105">var</span>&nbsp;<span class="ident" id="5661109">benchmarkMemory</span>&nbsp;<span class="op" id="5661125">=</span>&nbsp;<span class="ident" id="5661127">flag</span><span class="op" id="5661131">.</span><span class="ident" id="5661132">Bool</span><span class="op" id="5661136">(</span><span class="string" id="5661137">&#34;test.benchmem&#34;</span><span class="op" id="5661152">,</span>&nbsp;<span class="builtintype" id="5661154">false</span><span class="op" id="5661159">,</span>&nbsp;<span class="string" id="5661161">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="5661202">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5661205">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="5661265">var</span>&nbsp;<span class="ident" id="5661269">benchmarkLock</span>&nbsp;<span class="ident" id="5661283">sync</span><span class="op" id="5661287">.</span><span class="ident" id="5661288">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5661295">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="5661345">var</span>&nbsp;<span class="ident" id="5661349">memStats</span>&nbsp;<span class="ident" id="5661358">runtime</span><span class="op" id="5661365">.</span><span class="ident" id="5661366">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5661376">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5661465">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5661494">type</span>&nbsp;<span class="ident" id="5661499">InternalBenchmark</span>&nbsp;<span class="keyword" id="5661517">struct</span>&nbsp;<span class="op" id="5661524">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661527">Name</span>&nbsp;<span class="builtintype" id="5661532">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661540">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5661545">func</span><span class="op" id="5661549">(</span><span class="ident" id="5661550">b</span>&nbsp;<span class="op" id="5661552">*</span><span class="ident" id="5661553">B</span><span class="op" id="5661554">)</span><br>
<span class="lineno"></span><span class="op" id="5661556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5661559">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="5661624">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="5661682">type</span>&nbsp;<span class="ident" id="5661687">B</span>&nbsp;<span class="keyword" id="5661689">struct</span>&nbsp;<span class="op" id="5661696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661699">common</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661707">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5661724">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661729">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5661746">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5661760">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661805">previousDuration</span>&nbsp;<span class="ident" id="5661822">time</span><span class="op" id="5661826">.</span><span class="ident" id="5661827">Duration</span>&nbsp;<span class="comment" id="5661836">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661875">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661892">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661911">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661928">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661935">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5661952">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661958">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="5661975">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661981">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5661998">BenchmarkResult</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662015">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5662032">int</span>&nbsp;<span class="comment" id="5662036">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5662094">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662162">startAllocs</span>&nbsp;<span class="ident" id="5662174">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662182">startBytes</span>&nbsp;&nbsp;<span class="ident" id="5662194">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5662202">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662250">netAllocs</span>&nbsp;<span class="ident" id="5662260">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662268">netBytes</span>&nbsp;&nbsp;<span class="ident" id="5662278">uint64</span><br>
<span class="lineno"></span><span class="op" id="5662285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="5662288">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="5662363">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="5662437">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="5662461">func</span>&nbsp;<span class="op" id="5662466">(</span><span class="ident" id="5662467">b</span>&nbsp;<span class="op" id="5662469">*</span><span class="ident" id="5662470">B</span><span class="op" id="5662471">)</span>&nbsp;<span class="ident" id="5662473">StartTimer</span><span class="op" id="5662483">(</span><span class="op" id="5662484">)</span>&nbsp;<span class="op" id="5662486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5662489">if</span>&nbsp;<span class="op" id="5662492">!</span><span class="ident" id="5662493">b</span><span class="op" id="5662494">.</span><span class="ident" id="5662495">timerOn</span>&nbsp;<span class="op" id="5662503">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662507">runtime</span><span class="op" id="5662514">.</span><span class="ident" id="5662515">ReadMemStats</span><span class="op" id="5662527">(</span><span class="op" id="5662528">&amp;</span><span class="ident" id="5662529">memStats</span><span class="op" id="5662537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662541">b</span><span class="op" id="5662542">.</span><span class="ident" id="5662543">startAllocs</span>&nbsp;<span class="op" id="5662555">=</span>&nbsp;<span class="ident" id="5662557">memStats</span><span class="op" id="5662565">.</span><span class="ident" id="5662566">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662576">b</span><span class="op" id="5662577">.</span><span class="ident" id="5662578">startBytes</span>&nbsp;<span class="op" id="5662589">=</span>&nbsp;<span class="ident" id="5662591">memStats</span><span class="op" id="5662599">.</span><span class="ident" id="5662600">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662613">b</span><span class="op" id="5662614">.</span><span class="ident" id="5662615">start</span>&nbsp;<span class="op" id="5662621">=</span>&nbsp;<span class="ident" id="5662623">time</span><span class="op" id="5662627">.</span><span class="ident" id="5662628">Now</span><span class="op" id="5662631">(</span><span class="op" id="5662632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662636">b</span><span class="op" id="5662637">.</span><span class="ident" id="5662638">timerOn</span>&nbsp;<span class="op" id="5662646">=</span>&nbsp;<span class="builtintype" id="5662648">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5662654">}</span><br>
<span class="lineno"></span><span class="op" id="5662656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5662659">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="5662730">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="5662788">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="5662808">func</span>&nbsp;<span class="op" id="5662813">(</span><span class="ident" id="5662814">b</span>&nbsp;<span class="op" id="5662816">*</span><span class="ident" id="5662817">B</span><span class="op" id="5662818">)</span>&nbsp;<span class="ident" id="5662820">StopTimer</span><span class="op" id="5662829">(</span><span class="op" id="5662830">)</span>&nbsp;<span class="op" id="5662832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5662835">if</span>&nbsp;<span class="ident" id="5662838">b</span><span class="op" id="5662839">.</span><span class="ident" id="5662840">timerOn</span>&nbsp;<span class="op" id="5662848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662852">b</span><span class="op" id="5662853">.</span><span class="ident" id="5662854">duration</span>&nbsp;<span class="op" id="5662863">+=</span>&nbsp;<span class="ident" id="5662866">time</span><span class="op" id="5662870">.</span><span class="ident" id="5662871">Now</span><span class="op" id="5662874">(</span><span class="op" id="5662875">)</span><span class="op" id="5662876">.</span><span class="ident" id="5662877">Sub</span><span class="op" id="5662880">(</span><span class="ident" id="5662881">b</span><span class="op" id="5662882">.</span><span class="ident" id="5662883">start</span><span class="op" id="5662888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662892">runtime</span><span class="op" id="5662899">.</span><span class="ident" id="5662900">ReadMemStats</span><span class="op" id="5662912">(</span><span class="op" id="5662913">&amp;</span><span class="ident" id="5662914">memStats</span><span class="op" id="5662922">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662926">b</span><span class="op" id="5662927">.</span><span class="ident" id="5662928">netAllocs</span>&nbsp;<span class="op" id="5662938">+=</span>&nbsp;<span class="ident" id="5662941">memStats</span><span class="op" id="5662949">.</span><span class="ident" id="5662950">Mallocs</span>&nbsp;<span class="op" id="5662958">-</span>&nbsp;<span class="ident" id="5662960">b</span><span class="op" id="5662961">.</span><span class="ident" id="5662962">startAllocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5662976">b</span><span class="op" id="5662977">.</span><span class="ident" id="5662978">netBytes</span>&nbsp;<span class="op" id="5662987">+=</span>&nbsp;<span class="ident" id="5662990">memStats</span><span class="op" id="5662998">.</span><span class="ident" id="5662999">TotalAlloc</span>&nbsp;<span class="op" id="5663010">-</span>&nbsp;<span class="ident" id="5663012">b</span><span class="op" id="5663013">.</span><span class="ident" id="5663014">startBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663027">b</span><span class="op" id="5663028">.</span><span class="ident" id="5663029">timerOn</span>&nbsp;<span class="op" id="5663037">=</span>&nbsp;<span class="builtintype" id="5663039">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5663046">}</span><br>
<span class="lineno"></span><span class="op" id="5663048">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="5663051">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="5663130">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="5663182">func</span>&nbsp;<span class="op" id="5663187">(</span><span class="ident" id="5663188">b</span>&nbsp;<span class="op" id="5663190">*</span><span class="ident" id="5663191">B</span><span class="op" id="5663192">)</span>&nbsp;<span class="ident" id="5663194">ResetTimer</span><span class="op" id="5663204">(</span><span class="op" id="5663205">)</span>&nbsp;<span class="op" id="5663207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5663210">if</span>&nbsp;<span class="ident" id="5663213">b</span><span class="op" id="5663214">.</span><span class="ident" id="5663215">timerOn</span>&nbsp;<span class="op" id="5663223">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663227">runtime</span><span class="op" id="5663234">.</span><span class="ident" id="5663235">ReadMemStats</span><span class="op" id="5663247">(</span><span class="op" id="5663248">&amp;</span><span class="ident" id="5663249">memStats</span><span class="op" id="5663257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663261">b</span><span class="op" id="5663262">.</span><span class="ident" id="5663263">startAllocs</span>&nbsp;<span class="op" id="5663275">=</span>&nbsp;<span class="ident" id="5663277">memStats</span><span class="op" id="5663285">.</span><span class="ident" id="5663286">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663296">b</span><span class="op" id="5663297">.</span><span class="ident" id="5663298">startBytes</span>&nbsp;<span class="op" id="5663309">=</span>&nbsp;<span class="ident" id="5663311">memStats</span><span class="op" id="5663319">.</span><span class="ident" id="5663320">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663333">b</span><span class="op" id="5663334">.</span><span class="ident" id="5663335">start</span>&nbsp;<span class="op" id="5663341">=</span>&nbsp;<span class="ident" id="5663343">time</span><span class="op" id="5663347">.</span><span class="ident" id="5663348">Now</span><span class="op" id="5663351">(</span><span class="op" id="5663352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5663355">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663358">b</span><span class="op" id="5663359">.</span><span class="ident" id="5663360">duration</span>&nbsp;<span class="op" id="5663369">=</span>&nbsp;<span class="num" id="5663371">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663374">b</span><span class="op" id="5663375">.</span><span class="ident" id="5663376">netAllocs</span>&nbsp;<span class="op" id="5663386">=</span>&nbsp;<span class="num" id="5663388">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663391">b</span><span class="op" id="5663392">.</span><span class="ident" id="5663393">netBytes</span>&nbsp;<span class="op" id="5663402">=</span>&nbsp;<span class="num" id="5663404">0</span><br>
<span class="lineno"></span><span class="op" id="5663406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5663409">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="5663482">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="5663546">func</span>&nbsp;<span class="op" id="5663551">(</span><span class="ident" id="5663552">b</span>&nbsp;<span class="op" id="5663554">*</span><span class="ident" id="5663555">B</span><span class="op" id="5663556">)</span>&nbsp;<span class="ident" id="5663558">SetBytes</span><span class="op" id="5663566">(</span><span class="ident" id="5663567">n</span>&nbsp;<span class="ident" id="5663569">int64</span><span class="op" id="5663574">)</span>&nbsp;<span class="op" id="5663576">{</span>&nbsp;<span class="ident" id="5663578">b</span><span class="op" id="5663579">.</span><span class="ident" id="5663580">bytes</span>&nbsp;<span class="op" id="5663586">=</span>&nbsp;<span class="ident" id="5663588">n</span>&nbsp;<span class="op" id="5663590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5663593">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="5663655">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5663726">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="5663773">func</span>&nbsp;<span class="op" id="5663778">(</span><span class="ident" id="5663779">b</span>&nbsp;<span class="op" id="5663781">*</span><span class="ident" id="5663782">B</span><span class="op" id="5663783">)</span>&nbsp;<span class="ident" id="5663785">ReportAllocs</span><span class="op" id="5663797">(</span><span class="op" id="5663798">)</span>&nbsp;<span class="op" id="5663800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5663803">b</span><span class="op" id="5663804">.</span><span class="ident" id="5663805">showAllocResult</span>&nbsp;<span class="op" id="5663821">=</span>&nbsp;<span class="builtintype" id="5663823">true</span><br>
<span class="lineno"></span><span class="op" id="5663828">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5663831">func</span>&nbsp;<span class="op" id="5663836">(</span><span class="ident" id="5663837">b</span>&nbsp;<span class="op" id="5663839">*</span><span class="ident" id="5663840">B</span><span class="op" id="5663841">)</span>&nbsp;<span class="ident" id="5663843">nsPerOp</span><span class="op" id="5663850">(</span><span class="op" id="5663851">)</span>&nbsp;<span class="ident" id="5663853">int64</span>&nbsp;<span class="op" id="5663859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5663862">if</span>&nbsp;<span class="ident" id="5663865">b</span><span class="op" id="5663866">.</span><span class="ident" id="5663867">N</span>&nbsp;<span class="op" id="5663869">&lt;=</span>&nbsp;<span class="num" id="5663872">0</span>&nbsp;<span class="op" id="5663874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5663878">return</span>&nbsp;<span class="num" id="5663885">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5663888">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5663891">return</span>&nbsp;<span class="ident" id="5663898">b</span><span class="op" id="5663899">.</span><span class="ident" id="5663900">duration</span><span class="op" id="5663908">.</span><span class="ident" id="5663909">Nanoseconds</span><span class="op" id="5663920">(</span><span class="op" id="5663921">)</span>&nbsp;<span class="op" id="5663923">/</span>&nbsp;<span class="ident" id="5663925">int64</span><span class="op" id="5663930">(</span><span class="ident" id="5663931">b</span><span class="op" id="5663932">.</span><span class="ident" id="5663933">N</span><span class="op" id="5663934">)</span><br>
<span class="lineno"></span><span class="op" id="5663936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5663939">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="5664011">func</span>&nbsp;<span class="op" id="5664016">(</span><span class="ident" id="5664017">b</span>&nbsp;<span class="op" id="5664019">*</span><span class="ident" id="5664020">B</span><span class="op" id="5664021">)</span>&nbsp;<span class="ident" id="5664023">runN</span><span class="op" id="5664027">(</span><span class="ident" id="5664028">n</span>&nbsp;<span class="builtintype" id="5664030">int</span><span class="op" id="5664033">)</span>&nbsp;<span class="op" id="5664035">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664038">benchmarkLock</span><span class="op" id="5664051">.</span><span class="ident" id="5664052">Lock</span><span class="op" id="5664056">(</span><span class="op" id="5664057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664060">defer</span>&nbsp;<span class="ident" id="5664066">benchmarkLock</span><span class="op" id="5664079">.</span><span class="ident" id="5664080">Unlock</span><span class="op" id="5664086">(</span><span class="op" id="5664087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5664090">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5664143">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664187">runtime</span><span class="op" id="5664194">.</span><span class="ident" id="5664195">GC</span><span class="op" id="5664197">(</span><span class="op" id="5664198">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664201">b</span><span class="op" id="5664202">.</span><span class="ident" id="5664203">N</span>&nbsp;<span class="op" id="5664205">=</span>&nbsp;<span class="ident" id="5664207">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664210">b</span><span class="op" id="5664211">.</span><span class="ident" id="5664212">parallelism</span>&nbsp;<span class="op" id="5664224">=</span>&nbsp;<span class="num" id="5664226">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664229">b</span><span class="op" id="5664230">.</span><span class="ident" id="5664231">ResetTimer</span><span class="op" id="5664241">(</span><span class="op" id="5664242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664245">b</span><span class="op" id="5664246">.</span><span class="ident" id="5664247">StartTimer</span><span class="op" id="5664257">(</span><span class="op" id="5664258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664261">b</span><span class="op" id="5664262">.</span><span class="ident" id="5664263">benchmark</span><span class="op" id="5664272">.</span><span class="ident" id="5664273">F</span><span class="op" id="5664274">(</span><span class="ident" id="5664275">b</span><span class="op" id="5664276">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664279">b</span><span class="op" id="5664280">.</span><span class="ident" id="5664281">StopTimer</span><span class="op" id="5664290">(</span><span class="op" id="5664291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664294">b</span><span class="op" id="5664295">.</span><span class="ident" id="5664296">previousN</span>&nbsp;<span class="op" id="5664306">=</span>&nbsp;<span class="ident" id="5664308">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664311">b</span><span class="op" id="5664312">.</span><span class="ident" id="5664313">previousDuration</span>&nbsp;<span class="op" id="5664330">=</span>&nbsp;<span class="ident" id="5664332">b</span><span class="op" id="5664333">.</span><span class="ident" id="5664334">duration</span><br>
<span class="lineno"></span><span class="op" id="5664343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5664346">func</span>&nbsp;<span class="ident" id="5664351">min</span><span class="op" id="5664354">(</span><span class="ident" id="5664355">x</span><span class="op" id="5664356">,</span>&nbsp;<span class="ident" id="5664358">y</span>&nbsp;<span class="builtintype" id="5664360">int</span><span class="op" id="5664363">)</span>&nbsp;<span class="builtintype" id="5664365">int</span>&nbsp;<span class="op" id="5664369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664372">if</span>&nbsp;<span class="ident" id="5664375">x</span>&nbsp;<span class="op" id="5664377">&gt;</span>&nbsp;<span class="ident" id="5664379">y</span>&nbsp;<span class="op" id="5664381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664385">return</span>&nbsp;<span class="ident" id="5664392">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5664395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664398">return</span>&nbsp;<span class="ident" id="5664405">x</span><br>
<span class="lineno">135</span><span class="op" id="5664407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5664410">func</span>&nbsp;<span class="ident" id="5664415">max</span><span class="op" id="5664418">(</span><span class="ident" id="5664419">x</span><span class="op" id="5664420">,</span>&nbsp;<span class="ident" id="5664422">y</span>&nbsp;<span class="builtintype" id="5664424">int</span><span class="op" id="5664427">)</span>&nbsp;<span class="builtintype" id="5664429">int</span>&nbsp;<span class="op" id="5664433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664436">if</span>&nbsp;<span class="ident" id="5664439">x</span>&nbsp;<span class="op" id="5664441">&lt;</span>&nbsp;<span class="ident" id="5664443">y</span>&nbsp;<span class="op" id="5664445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664449">return</span>&nbsp;<span class="ident" id="5664456">y</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5664459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664462">return</span>&nbsp;<span class="ident" id="5664469">x</span><br>
<span class="lineno"></span><span class="op" id="5664471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5664474">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="5664538">func</span>&nbsp;<span class="ident" id="5664543">roundDown10</span><span class="op" id="5664554">(</span><span class="ident" id="5664555">n</span>&nbsp;<span class="builtintype" id="5664557">int</span><span class="op" id="5664560">)</span>&nbsp;<span class="builtintype" id="5664562">int</span>&nbsp;<span class="op" id="5664566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664569">var</span>&nbsp;<span class="ident" id="5664573">tens</span>&nbsp;<span class="op" id="5664578">=</span>&nbsp;<span class="num" id="5664580">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5664583">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664611">for</span>&nbsp;<span class="ident" id="5664615">n</span>&nbsp;<span class="op" id="5664617">&gt;=</span>&nbsp;<span class="num" id="5664620">10</span>&nbsp;<span class="op" id="5664623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664627">n</span>&nbsp;<span class="op" id="5664629">=</span>&nbsp;<span class="ident" id="5664631">n</span>&nbsp;<span class="op" id="5664633">/</span>&nbsp;<span class="num" id="5664635">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664640">tens</span><span class="op" id="5664644">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5664648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5664651">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664672">result</span>&nbsp;<span class="op" id="5664679">:=</span>&nbsp;<span class="num" id="5664682">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664685">for</span>&nbsp;<span class="ident" id="5664689">i</span>&nbsp;<span class="op" id="5664691">:=</span>&nbsp;<span class="num" id="5664694">0</span><span class="op" id="5664695">;</span>&nbsp;<span class="ident" id="5664697">i</span>&nbsp;<span class="op" id="5664699">&lt;</span>&nbsp;<span class="ident" id="5664701">tens</span><span class="op" id="5664705">;</span>&nbsp;<span class="ident" id="5664707">i</span><span class="op" id="5664708">++</span>&nbsp;<span class="op" id="5664711">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664715">result</span>&nbsp;<span class="op" id="5664722">*=</span>&nbsp;<span class="num" id="5664725">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5664729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664732">return</span>&nbsp;<span class="ident" id="5664739">result</span><br>
<span class="lineno"></span><span class="op" id="5664746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5664749">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="5664818">func</span>&nbsp;<span class="ident" id="5664823">roundUp</span><span class="op" id="5664830">(</span><span class="ident" id="5664831">n</span>&nbsp;<span class="builtintype" id="5664833">int</span><span class="op" id="5664836">)</span>&nbsp;<span class="builtintype" id="5664838">int</span>&nbsp;<span class="op" id="5664842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5664845">base</span>&nbsp;<span class="op" id="5664850">:=</span>&nbsp;<span class="ident" id="5664853">roundDown10</span><span class="op" id="5664864">(</span><span class="ident" id="5664865">n</span><span class="op" id="5664866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664869">switch</span>&nbsp;<span class="op" id="5664876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664879">case</span>&nbsp;<span class="ident" id="5664884">n</span>&nbsp;<span class="op" id="5664886">&lt;=</span>&nbsp;<span class="ident" id="5664889">base</span><span class="op" id="5664893">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664897">return</span>&nbsp;<span class="ident" id="5664904">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664910">case</span>&nbsp;<span class="ident" id="5664915">n</span>&nbsp;<span class="op" id="5664917">&lt;=</span>&nbsp;<span class="op" id="5664920">(</span><span class="num" id="5664921">2</span>&nbsp;<span class="op" id="5664923">*</span>&nbsp;<span class="ident" id="5664925">base</span><span class="op" id="5664929">)</span><span class="op" id="5664930">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664934">return</span>&nbsp;<span class="num" id="5664941">2</span>&nbsp;<span class="op" id="5664943">*</span>&nbsp;<span class="ident" id="5664945">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664951">case</span>&nbsp;<span class="ident" id="5664956">n</span>&nbsp;<span class="op" id="5664958">&lt;=</span>&nbsp;<span class="op" id="5664961">(</span><span class="num" id="5664962">3</span>&nbsp;<span class="op" id="5664964">*</span>&nbsp;<span class="ident" id="5664966">base</span><span class="op" id="5664970">)</span><span class="op" id="5664971">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664975">return</span>&nbsp;<span class="num" id="5664982">3</span>&nbsp;<span class="op" id="5664984">*</span>&nbsp;<span class="ident" id="5664986">base</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5664992">case</span>&nbsp;<span class="ident" id="5664997">n</span>&nbsp;<span class="op" id="5664999">&lt;=</span>&nbsp;<span class="op" id="5665002">(</span><span class="num" id="5665003">5</span>&nbsp;<span class="op" id="5665005">*</span>&nbsp;<span class="ident" id="5665007">base</span><span class="op" id="5665011">)</span><span class="op" id="5665012">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5665016">return</span>&nbsp;<span class="num" id="5665023">5</span>&nbsp;<span class="op" id="5665025">*</span>&nbsp;<span class="ident" id="5665027">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5665033">default</span><span class="op" id="5665040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5665044">return</span>&nbsp;<span class="num" id="5665051">10</span>&nbsp;<span class="op" id="5665054">*</span>&nbsp;<span class="ident" id="5665056">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5665062">}</span><br>
<span class="lineno">175</span><span class="op" id="5665064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5665067">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="5665128">func</span>&nbsp;<span class="op" id="5665133">(</span><span class="ident" id="5665134">b</span>&nbsp;<span class="op" id="5665136">*</span><span class="ident" id="5665137">B</span><span class="op" id="5665138">)</span>&nbsp;<span class="ident" id="5665140">run</span><span class="op" id="5665143">(</span><span class="op" id="5665144">)</span>&nbsp;<span class="ident" id="5665146">BenchmarkResult</span>&nbsp;<span class="op" id="5665162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5665165">go</span>&nbsp;<span class="ident" id="5665168">b</span><span class="op" id="5665169">.</span><span class="ident" id="5665170">launch</span><span class="op" id="5665176">(</span><span class="op" id="5665177">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5665180">&lt;-</span><span class="ident" id="5665182">b</span><span class="op" id="5665183">.</span><span class="ident" id="5665184">signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5665192">return</span>&nbsp;<span class="ident" id="5665199">b</span><span class="op" id="5665200">.</span><span class="ident" id="5665201">result</span><br>
<span class="lineno"></span><span class="op" id="5665208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5665211">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="5665289">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="5665370">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5665415">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testing.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp;100000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="5665459">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="5665521">func</span>&nbsp;<span class="op" id="5665526">(</span><span class="ident" id="5665527">b</span>&nbsp;<span class="op" id="5665529">*</span><span class="ident" id="5665530">B</span><span class="op" id="5665531">)</span>&nbsp;<span class="ident" id="5665533">launch</span><span class="op" id="5665539">(</span><span class="op" id="5665540">)</span>&nbsp;<span class="op" id="5665542">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5665545">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5665614">n</span>&nbsp;<span class="op" id="5665616">:=</span>&nbsp;<span class="num" id="5665619">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5665623">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5665677">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5665713">defer</span>&nbsp;<span class="keyword" id="5665719">func</span><span class="op" id="5665723">(</span><span class="op" id="5665724">)</span>&nbsp;<span class="op" id="5665726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5665730">b</span><span class="op" id="5665731">.</span><span class="ident" id="5665732">signal</span>&nbsp;<span class="op" id="5665739">&lt;-</span>&nbsp;<span class="ident" id="5665742">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5665745">}</span><span class="op" id="5665746">(</span><span class="op" id="5665747">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5665751">b</span><span class="op" id="5665752">.</span><span class="ident" id="5665753">runN</span><span class="op" id="5665757">(</span><span class="ident" id="5665758">n</span><span class="op" id="5665759">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5665762">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5665827">d</span>&nbsp;<span class="op" id="5665829">:=</span>&nbsp;<span class="op" id="5665832">*</span><span class="ident" id="5665833">benchTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5665844">for</span>&nbsp;<span class="op" id="5665848">!</span><span class="ident" id="5665849">b</span><span class="op" id="5665850">.</span><span class="ident" id="5665851">failed</span>&nbsp;<span class="op" id="5665858">&amp;&amp;</span>&nbsp;<span class="ident" id="5665861">b</span><span class="op" id="5665862">.</span><span class="ident" id="5665863">duration</span>&nbsp;<span class="op" id="5665872">&lt;</span>&nbsp;<span class="ident" id="5665874">d</span>&nbsp;<span class="op" id="5665876">&amp;&amp;</span>&nbsp;<span class="ident" id="5665879">n</span>&nbsp;<span class="op" id="5665881">&lt;</span>&nbsp;<span class="num" id="5665883">1e9</span>&nbsp;<span class="op" id="5665887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5665891">last</span>&nbsp;<span class="op" id="5665896">:=</span>&nbsp;<span class="ident" id="5665899">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5665903">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5665937">if</span>&nbsp;<span class="ident" id="5665940">b</span><span class="op" id="5665941">.</span><span class="ident" id="5665942">nsPerOp</span><span class="op" id="5665949">(</span><span class="op" id="5665950">)</span>&nbsp;<span class="op" id="5665952">==</span>&nbsp;<span class="num" id="5665955">0</span>&nbsp;<span class="op" id="5665957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5665962">n</span>&nbsp;<span class="op" id="5665964">=</span>&nbsp;<span class="num" id="5665966">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5665972">}</span>&nbsp;<span class="keyword" id="5665974">else</span>&nbsp;<span class="op" id="5665979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5665984">n</span>&nbsp;<span class="op" id="5665986">=</span>&nbsp;<span class="builtintype" id="5665988">int</span><span class="op" id="5665991">(</span><span class="ident" id="5665992">d</span><span class="op" id="5665993">.</span><span class="ident" id="5665994">Nanoseconds</span><span class="op" id="5666005">(</span><span class="op" id="5666006">)</span>&nbsp;<span class="op" id="5666008">/</span>&nbsp;<span class="ident" id="5666010">b</span><span class="op" id="5666011">.</span><span class="ident" id="5666012">nsPerOp</span><span class="op" id="5666019">(</span><span class="op" id="5666020">)</span><span class="op" id="5666021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5666025">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5666029">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5666087">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5666153">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666207">n</span>&nbsp;<span class="op" id="5666209">=</span>&nbsp;<span class="ident" id="5666211">max</span><span class="op" id="5666214">(</span><span class="ident" id="5666215">min</span><span class="op" id="5666218">(</span><span class="ident" id="5666219">n</span><span class="op" id="5666220">+</span><span class="ident" id="5666221">n</span><span class="op" id="5666222">/</span><span class="num" id="5666223">5</span><span class="op" id="5666224">,</span>&nbsp;<span class="num" id="5666226">100</span><span class="op" id="5666229">*</span><span class="ident" id="5666230">last</span><span class="op" id="5666234">)</span><span class="op" id="5666235">,</span>&nbsp;<span class="ident" id="5666237">last</span><span class="op" id="5666241">+</span><span class="num" id="5666242">1</span><span class="op" id="5666243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5666247">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666288">n</span>&nbsp;<span class="op" id="5666290">=</span>&nbsp;<span class="ident" id="5666292">roundUp</span><span class="op" id="5666299">(</span><span class="ident" id="5666300">n</span><span class="op" id="5666301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666305">b</span><span class="op" id="5666306">.</span><span class="ident" id="5666307">runN</span><span class="op" id="5666311">(</span><span class="ident" id="5666312">n</span><span class="op" id="5666313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5666316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666319">b</span><span class="op" id="5666320">.</span><span class="ident" id="5666321">result</span>&nbsp;<span class="op" id="5666328">=</span>&nbsp;<span class="ident" id="5666330">BenchmarkResult</span><span class="op" id="5666345">{</span><span class="ident" id="5666346">b</span><span class="op" id="5666347">.</span><span class="ident" id="5666348">N</span><span class="op" id="5666349">,</span>&nbsp;<span class="ident" id="5666351">b</span><span class="op" id="5666352">.</span><span class="ident" id="5666353">duration</span><span class="op" id="5666361">,</span>&nbsp;<span class="ident" id="5666363">b</span><span class="op" id="5666364">.</span><span class="ident" id="5666365">bytes</span><span class="op" id="5666370">,</span>&nbsp;<span class="ident" id="5666372">b</span><span class="op" id="5666373">.</span><span class="ident" id="5666374">netAllocs</span><span class="op" id="5666383">,</span>&nbsp;<span class="ident" id="5666385">b</span><span class="op" id="5666386">.</span><span class="ident" id="5666387">netBytes</span><span class="op" id="5666395">}</span><br>
<span class="lineno"></span><span class="op" id="5666397">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5666400">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="5666435">type</span>&nbsp;<span class="ident" id="5666440">BenchmarkResult</span>&nbsp;<span class="keyword" id="5666456">struct</span>&nbsp;<span class="op" id="5666463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666466">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5666476">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5666490">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666520">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666530">time</span><span class="op" id="5666534">.</span><span class="ident" id="5666535">Duration</span>&nbsp;<span class="comment" id="5666544">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666570">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666580">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5666594">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666632">MemAllocs</span>&nbsp;<span class="ident" id="5666642">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5666656">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5666700">MemBytes</span>&nbsp;&nbsp;<span class="ident" id="5666710">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5666724">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="5666764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="5666767">func</span>&nbsp;<span class="op" id="5666772">(</span><span class="ident" id="5666773">r</span>&nbsp;<span class="ident" id="5666775">BenchmarkResult</span><span class="op" id="5666790">)</span>&nbsp;<span class="ident" id="5666792">NsPerOp</span><span class="op" id="5666799">(</span><span class="op" id="5666800">)</span>&nbsp;<span class="ident" id="5666802">int64</span>&nbsp;<span class="op" id="5666808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5666811">if</span>&nbsp;<span class="ident" id="5666814">r</span><span class="op" id="5666815">.</span><span class="ident" id="5666816">N</span>&nbsp;<span class="op" id="5666818">&lt;=</span>&nbsp;<span class="num" id="5666821">0</span>&nbsp;<span class="op" id="5666823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5666827">return</span>&nbsp;<span class="num" id="5666834">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5666837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5666840">return</span>&nbsp;<span class="ident" id="5666847">r</span><span class="op" id="5666848">.</span><span class="ident" id="5666849">T</span><span class="op" id="5666850">.</span><span class="ident" id="5666851">Nanoseconds</span><span class="op" id="5666862">(</span><span class="op" id="5666863">)</span>&nbsp;<span class="op" id="5666865">/</span>&nbsp;<span class="ident" id="5666867">int64</span><span class="op" id="5666872">(</span><span class="ident" id="5666873">r</span><span class="op" id="5666874">.</span><span class="ident" id="5666875">N</span><span class="op" id="5666876">)</span><br>
<span class="lineno">235</span><span class="op" id="5666878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5666881">func</span>&nbsp;<span class="op" id="5666886">(</span><span class="ident" id="5666887">r</span>&nbsp;<span class="ident" id="5666889">BenchmarkResult</span><span class="op" id="5666904">)</span>&nbsp;<span class="ident" id="5666906">mbPerSec</span><span class="op" id="5666914">(</span><span class="op" id="5666915">)</span>&nbsp;<span class="builtintype" id="5666917">float64</span>&nbsp;<span class="op" id="5666925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5666928">if</span>&nbsp;<span class="ident" id="5666931">r</span><span class="op" id="5666932">.</span><span class="ident" id="5666933">Bytes</span>&nbsp;<span class="op" id="5666939">&lt;=</span>&nbsp;<span class="num" id="5666942">0</span>&nbsp;<span class="op" id="5666944">||</span>&nbsp;<span class="ident" id="5666947">r</span><span class="op" id="5666948">.</span><span class="ident" id="5666949">T</span>&nbsp;<span class="op" id="5666951">&lt;=</span>&nbsp;<span class="num" id="5666954">0</span>&nbsp;<span class="op" id="5666956">||</span>&nbsp;<span class="ident" id="5666959">r</span><span class="op" id="5666960">.</span><span class="ident" id="5666961">N</span>&nbsp;<span class="op" id="5666963">&lt;=</span>&nbsp;<span class="num" id="5666966">0</span>&nbsp;<span class="op" id="5666968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5666972">return</span>&nbsp;<span class="num" id="5666979">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5666982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5666985">return</span>&nbsp;<span class="op" id="5666992">(</span><span class="builtintype" id="5666993">float64</span><span class="op" id="5667000">(</span><span class="ident" id="5667001">r</span><span class="op" id="5667002">.</span><span class="ident" id="5667003">Bytes</span><span class="op" id="5667008">)</span>&nbsp;<span class="op" id="5667010">*</span>&nbsp;<span class="builtintype" id="5667012">float64</span><span class="op" id="5667019">(</span><span class="ident" id="5667020">r</span><span class="op" id="5667021">.</span><span class="ident" id="5667022">N</span><span class="op" id="5667023">)</span>&nbsp;<span class="op" id="5667025">/</span>&nbsp;<span class="num" id="5667027">1e6</span><span class="op" id="5667030">)</span>&nbsp;<span class="op" id="5667032">/</span>&nbsp;<span class="ident" id="5667034">r</span><span class="op" id="5667035">.</span><span class="ident" id="5667036">T</span><span class="op" id="5667037">.</span><span class="ident" id="5667038">Seconds</span><span class="op" id="5667045">(</span><span class="op" id="5667046">)</span><br>
<span class="lineno"></span><span class="op" id="5667048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5667051">func</span>&nbsp;<span class="op" id="5667056">(</span><span class="ident" id="5667057">r</span>&nbsp;<span class="ident" id="5667059">BenchmarkResult</span><span class="op" id="5667074">)</span>&nbsp;<span class="ident" id="5667076">AllocsPerOp</span><span class="op" id="5667087">(</span><span class="op" id="5667088">)</span>&nbsp;<span class="ident" id="5667090">int64</span>&nbsp;<span class="op" id="5667096">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667099">if</span>&nbsp;<span class="ident" id="5667102">r</span><span class="op" id="5667103">.</span><span class="ident" id="5667104">N</span>&nbsp;<span class="op" id="5667106">&lt;=</span>&nbsp;<span class="num" id="5667109">0</span>&nbsp;<span class="op" id="5667111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667115">return</span>&nbsp;<span class="num" id="5667122">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5667125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667128">return</span>&nbsp;<span class="ident" id="5667135">int64</span><span class="op" id="5667140">(</span><span class="ident" id="5667141">r</span><span class="op" id="5667142">.</span><span class="ident" id="5667143">MemAllocs</span><span class="op" id="5667152">)</span>&nbsp;<span class="op" id="5667154">/</span>&nbsp;<span class="ident" id="5667156">int64</span><span class="op" id="5667161">(</span><span class="ident" id="5667162">r</span><span class="op" id="5667163">.</span><span class="ident" id="5667164">N</span><span class="op" id="5667165">)</span><br>
<span class="lineno"></span><span class="op" id="5667167">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="5667170">func</span>&nbsp;<span class="op" id="5667175">(</span><span class="ident" id="5667176">r</span>&nbsp;<span class="ident" id="5667178">BenchmarkResult</span><span class="op" id="5667193">)</span>&nbsp;<span class="ident" id="5667195">AllocedBytesPerOp</span><span class="op" id="5667212">(</span><span class="op" id="5667213">)</span>&nbsp;<span class="ident" id="5667215">int64</span>&nbsp;<span class="op" id="5667221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667224">if</span>&nbsp;<span class="ident" id="5667227">r</span><span class="op" id="5667228">.</span><span class="ident" id="5667229">N</span>&nbsp;<span class="op" id="5667231">&lt;=</span>&nbsp;<span class="num" id="5667234">0</span>&nbsp;<span class="op" id="5667236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667240">return</span>&nbsp;<span class="num" id="5667247">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5667250">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667253">return</span>&nbsp;<span class="ident" id="5667260">int64</span><span class="op" id="5667265">(</span><span class="ident" id="5667266">r</span><span class="op" id="5667267">.</span><span class="ident" id="5667268">MemBytes</span><span class="op" id="5667276">)</span>&nbsp;<span class="op" id="5667278">/</span>&nbsp;<span class="ident" id="5667280">int64</span><span class="op" id="5667285">(</span><span class="ident" id="5667286">r</span><span class="op" id="5667287">.</span><span class="ident" id="5667288">N</span><span class="op" id="5667289">)</span><br>
<span class="lineno"></span><span class="op" id="5667291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5667294">func</span>&nbsp;<span class="op" id="5667299">(</span><span class="ident" id="5667300">r</span>&nbsp;<span class="ident" id="5667302">BenchmarkResult</span><span class="op" id="5667317">)</span>&nbsp;<span class="ident" id="5667319">String</span><span class="op" id="5667325">(</span><span class="op" id="5667326">)</span>&nbsp;<span class="builtintype" id="5667328">string</span>&nbsp;<span class="op" id="5667335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667338">mbs</span>&nbsp;<span class="op" id="5667342">:=</span>&nbsp;<span class="ident" id="5667345">r</span><span class="op" id="5667346">.</span><span class="ident" id="5667347">mbPerSec</span><span class="op" id="5667355">(</span><span class="op" id="5667356">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667359">mb</span>&nbsp;<span class="op" id="5667362">:=</span>&nbsp;<span class="string" id="5667365">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667369">if</span>&nbsp;<span class="ident" id="5667372">mbs</span>&nbsp;<span class="op" id="5667376">!=</span>&nbsp;<span class="num" id="5667379">0</span>&nbsp;<span class="op" id="5667381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667385">mb</span>&nbsp;<span class="op" id="5667388">=</span>&nbsp;<span class="ident" id="5667390">fmt</span><span class="op" id="5667393">.</span><span class="ident" id="5667394">Sprintf</span><span class="op" id="5667401">(</span><span class="string" id="5667402">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="5667416">,</span>&nbsp;<span class="ident" id="5667418">mbs</span><span class="op" id="5667421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5667424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667427">nsop</span>&nbsp;<span class="op" id="5667432">:=</span>&nbsp;<span class="ident" id="5667435">r</span><span class="op" id="5667436">.</span><span class="ident" id="5667437">NsPerOp</span><span class="op" id="5667444">(</span><span class="op" id="5667445">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667448">ns</span>&nbsp;<span class="op" id="5667451">:=</span>&nbsp;<span class="ident" id="5667454">fmt</span><span class="op" id="5667457">.</span><span class="ident" id="5667458">Sprintf</span><span class="op" id="5667465">(</span><span class="string" id="5667466">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="5667478">,</span>&nbsp;<span class="ident" id="5667480">nsop</span><span class="op" id="5667484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667487">if</span>&nbsp;<span class="ident" id="5667490">r</span><span class="op" id="5667491">.</span><span class="ident" id="5667492">N</span>&nbsp;<span class="op" id="5667494">&gt;</span>&nbsp;<span class="num" id="5667496">0</span>&nbsp;<span class="op" id="5667498">&amp;&amp;</span>&nbsp;<span class="ident" id="5667501">nsop</span>&nbsp;<span class="op" id="5667506">&lt;</span>&nbsp;<span class="num" id="5667508">100</span>&nbsp;<span class="op" id="5667512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5667516">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5667563">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667624">if</span>&nbsp;<span class="ident" id="5667627">nsop</span>&nbsp;<span class="op" id="5667632">&lt;</span>&nbsp;<span class="num" id="5667634">10</span>&nbsp;<span class="op" id="5667637">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667642">ns</span>&nbsp;<span class="op" id="5667645">=</span>&nbsp;<span class="ident" id="5667647">fmt</span><span class="op" id="5667650">.</span><span class="ident" id="5667651">Sprintf</span><span class="op" id="5667658">(</span><span class="string" id="5667659">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="5667673">,</span>&nbsp;<span class="builtintype" id="5667675">float64</span><span class="op" id="5667682">(</span><span class="ident" id="5667683">r</span><span class="op" id="5667684">.</span><span class="ident" id="5667685">T</span><span class="op" id="5667686">.</span><span class="ident" id="5667687">Nanoseconds</span><span class="op" id="5667698">(</span><span class="op" id="5667699">)</span><span class="op" id="5667700">)</span><span class="op" id="5667701">/</span><span class="builtintype" id="5667702">float64</span><span class="op" id="5667709">(</span><span class="ident" id="5667710">r</span><span class="op" id="5667711">.</span><span class="ident" id="5667712">N</span><span class="op" id="5667713">)</span><span class="op" id="5667714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5667718">}</span>&nbsp;<span class="keyword" id="5667720">else</span>&nbsp;<span class="op" id="5667725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667730">ns</span>&nbsp;<span class="op" id="5667733">=</span>&nbsp;<span class="ident" id="5667735">fmt</span><span class="op" id="5667738">.</span><span class="ident" id="5667739">Sprintf</span><span class="op" id="5667746">(</span><span class="string" id="5667747">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="5667761">,</span>&nbsp;<span class="builtintype" id="5667763">float64</span><span class="op" id="5667770">(</span><span class="ident" id="5667771">r</span><span class="op" id="5667772">.</span><span class="ident" id="5667773">T</span><span class="op" id="5667774">.</span><span class="ident" id="5667775">Nanoseconds</span><span class="op" id="5667786">(</span><span class="op" id="5667787">)</span><span class="op" id="5667788">)</span><span class="op" id="5667789">/</span><span class="builtintype" id="5667790">float64</span><span class="op" id="5667797">(</span><span class="ident" id="5667798">r</span><span class="op" id="5667799">.</span><span class="ident" id="5667800">N</span><span class="op" id="5667801">)</span><span class="op" id="5667802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5667806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5667809">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667812">return</span>&nbsp;<span class="ident" id="5667819">fmt</span><span class="op" id="5667822">.</span><span class="ident" id="5667823">Sprintf</span><span class="op" id="5667830">(</span><span class="string" id="5667831">&#34;%8d\t%s%s&#34;</span><span class="op" id="5667842">,</span>&nbsp;<span class="ident" id="5667844">r</span><span class="op" id="5667845">.</span><span class="ident" id="5667846">N</span><span class="op" id="5667847">,</span>&nbsp;<span class="ident" id="5667849">ns</span><span class="op" id="5667851">,</span>&nbsp;<span class="ident" id="5667853">mb</span><span class="op" id="5667855">)</span><br>
<span class="lineno"></span><span class="op" id="5667857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5667860">func</span>&nbsp;<span class="op" id="5667865">(</span><span class="ident" id="5667866">r</span>&nbsp;<span class="ident" id="5667868">BenchmarkResult</span><span class="op" id="5667883">)</span>&nbsp;<span class="ident" id="5667885">MemString</span><span class="op" id="5667894">(</span><span class="op" id="5667895">)</span>&nbsp;<span class="builtintype" id="5667897">string</span>&nbsp;<span class="op" id="5667904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5667907">return</span>&nbsp;<span class="ident" id="5667914">fmt</span><span class="op" id="5667917">.</span><span class="ident" id="5667918">Sprintf</span><span class="op" id="5667925">(</span><span class="string" id="5667926">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="5667951">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5667955">r</span><span class="op" id="5667956">.</span><span class="ident" id="5667957">AllocedBytesPerOp</span><span class="op" id="5667974">(</span><span class="op" id="5667975">)</span><span class="op" id="5667976">,</span>&nbsp;<span class="ident" id="5667978">r</span><span class="op" id="5667979">.</span><span class="ident" id="5667980">AllocsPerOp</span><span class="op" id="5667991">(</span><span class="op" id="5667992">)</span><span class="op" id="5667993">)</span><br>
<span class="lineno"></span><span class="op" id="5667995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5667998">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5668091">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="5668120">func</span>&nbsp;<span class="ident" id="5668125">RunBenchmarks</span><span class="op" id="5668138">(</span><span class="ident" id="5668139">matchString</span>&nbsp;<span class="keyword" id="5668151">func</span><span class="op" id="5668155">(</span><span class="ident" id="5668156">pat</span><span class="op" id="5668159">,</span>&nbsp;<span class="ident" id="5668161">str</span>&nbsp;<span class="builtintype" id="5668165">string</span><span class="op" id="5668171">)</span>&nbsp;<span class="op" id="5668173">(</span><span class="builtintype" id="5668174">bool</span><span class="op" id="5668178">,</span>&nbsp;<span class="builtintype" id="5668180">error</span><span class="op" id="5668185">)</span><span class="op" id="5668186">,</span>&nbsp;<span class="ident" id="5668188">benchmarks</span>&nbsp;<span class="op" id="5668199">[</span><span class="op" id="5668200">]</span><span class="ident" id="5668201">InternalBenchmark</span><span class="op" id="5668218">)</span>&nbsp;<span class="op" id="5668220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5668223">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668275">if</span>&nbsp;<span class="builtinfunc" id="5668278">len</span><span class="op" id="5668281">(</span><span class="op" id="5668282">*</span><span class="ident" id="5668283">matchBenchmarks</span><span class="op" id="5668298">)</span>&nbsp;<span class="op" id="5668300">==</span>&nbsp;<span class="num" id="5668303">0</span>&nbsp;<span class="op" id="5668305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668309">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5668317">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668320">for</span>&nbsp;<span class="ident" id="5668324">_</span><span class="op" id="5668325">,</span>&nbsp;<span class="ident" id="5668327">Benchmark</span>&nbsp;<span class="op" id="5668337">:=</span>&nbsp;<span class="keyword" id="5668340">range</span>&nbsp;<span class="ident" id="5668346">benchmarks</span>&nbsp;<span class="op" id="5668357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668361">matched</span><span class="op" id="5668368">,</span>&nbsp;<span class="ident" id="5668370">err</span>&nbsp;<span class="op" id="5668374">:=</span>&nbsp;<span class="ident" id="5668377">matchString</span><span class="op" id="5668388">(</span><span class="op" id="5668389">*</span><span class="ident" id="5668390">matchBenchmarks</span><span class="op" id="5668405">,</span>&nbsp;<span class="ident" id="5668407">Benchmark</span><span class="op" id="5668416">.</span><span class="ident" id="5668417">Name</span><span class="op" id="5668421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668425">if</span>&nbsp;<span class="ident" id="5668428">err</span>&nbsp;<span class="op" id="5668432">!=</span>&nbsp;<span class="ident" id="5668435">nil</span>&nbsp;<span class="op" id="5668439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668444">fmt</span><span class="op" id="5668447">.</span><span class="ident" id="5668448">Fprintf</span><span class="op" id="5668455">(</span><span class="ident" id="5668456">os</span><span class="op" id="5668458">.</span><span class="ident" id="5668459">Stderr</span><span class="op" id="5668465">,</span>&nbsp;<span class="string" id="5668467">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="5668514">,</span>&nbsp;<span class="ident" id="5668516">err</span><span class="op" id="5668519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668524">os</span><span class="op" id="5668526">.</span><span class="ident" id="5668527">Exit</span><span class="op" id="5668531">(</span><span class="num" id="5668532">1</span><span class="op" id="5668533">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5668537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668541">if</span>&nbsp;<span class="op" id="5668544">!</span><span class="ident" id="5668545">matched</span>&nbsp;<span class="op" id="5668553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668558">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5668569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668573">for</span>&nbsp;<span class="ident" id="5668577">_</span><span class="op" id="5668578">,</span>&nbsp;<span class="ident" id="5668580">procs</span>&nbsp;<span class="op" id="5668586">:=</span>&nbsp;<span class="keyword" id="5668589">range</span>&nbsp;<span class="ident" id="5668595">cpuList</span>&nbsp;<span class="op" id="5668603">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668608">runtime</span><span class="op" id="5668615">.</span><span class="ident" id="5668616">GOMAXPROCS</span><span class="op" id="5668626">(</span><span class="ident" id="5668627">procs</span><span class="op" id="5668632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668637">b</span>&nbsp;<span class="op" id="5668639">:=</span>&nbsp;<span class="op" id="5668642">&amp;</span><span class="ident" id="5668643">B</span><span class="op" id="5668644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668650">common</span><span class="op" id="5668656">:</span>&nbsp;<span class="ident" id="5668658">common</span><span class="op" id="5668664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668671">signal</span><span class="op" id="5668677">:</span>&nbsp;<span class="builtinfunc" id="5668679">make</span><span class="op" id="5668683">(</span><span class="keyword" id="5668684">chan</span>&nbsp;<span class="keyword" id="5668689">interface</span><span class="op" id="5668698">{</span><span class="op" id="5668699">}</span><span class="op" id="5668700">)</span><span class="op" id="5668701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5668707">}</span><span class="op" id="5668708">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668714">benchmark</span><span class="op" id="5668723">:</span>&nbsp;<span class="ident" id="5668725">Benchmark</span><span class="op" id="5668734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5668739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668744">benchName</span>&nbsp;<span class="op" id="5668754">:=</span>&nbsp;<span class="ident" id="5668757">Benchmark</span><span class="op" id="5668766">.</span><span class="ident" id="5668767">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668775">if</span>&nbsp;<span class="ident" id="5668778">procs</span>&nbsp;<span class="op" id="5668784">!=</span>&nbsp;<span class="num" id="5668787">1</span>&nbsp;<span class="op" id="5668789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668795">benchName</span>&nbsp;<span class="op" id="5668805">=</span>&nbsp;<span class="ident" id="5668807">fmt</span><span class="op" id="5668810">.</span><span class="ident" id="5668811">Sprintf</span><span class="op" id="5668818">(</span><span class="string" id="5668819">&#34;%s-%d&#34;</span><span class="op" id="5668826">,</span>&nbsp;<span class="ident" id="5668828">Benchmark</span><span class="op" id="5668837">.</span><span class="ident" id="5668838">Name</span><span class="op" id="5668842">,</span>&nbsp;<span class="ident" id="5668844">procs</span><span class="op" id="5668849">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5668854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668859">fmt</span><span class="op" id="5668862">.</span><span class="ident" id="5668863">Printf</span><span class="op" id="5668869">(</span><span class="string" id="5668870">&#34;%s\t&#34;</span><span class="op" id="5668876">,</span>&nbsp;<span class="ident" id="5668878">benchName</span><span class="op" id="5668887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5668892">r</span>&nbsp;<span class="op" id="5668894">:=</span>&nbsp;<span class="ident" id="5668897">b</span><span class="op" id="5668898">.</span><span class="ident" id="5668899">run</span><span class="op" id="5668902">(</span><span class="op" id="5668903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5668908">if</span>&nbsp;<span class="ident" id="5668911">b</span><span class="op" id="5668912">.</span><span class="ident" id="5668913">failed</span>&nbsp;<span class="op" id="5668920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5668926">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5668989">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5669066">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5669095">fmt</span><span class="op" id="5669098">.</span><span class="ident" id="5669099">Printf</span><span class="op" id="5669105">(</span><span class="string" id="5669106">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="5669124">,</span>&nbsp;<span class="ident" id="5669126">benchName</span><span class="op" id="5669135">,</span>&nbsp;<span class="ident" id="5669137">b</span><span class="op" id="5669138">.</span><span class="ident" id="5669139">output</span><span class="op" id="5669145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5669151">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5669163">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5669168">results</span>&nbsp;<span class="op" id="5669176">:=</span>&nbsp;<span class="ident" id="5669179">r</span><span class="op" id="5669180">.</span><span class="ident" id="5669181">String</span><span class="op" id="5669187">(</span><span class="op" id="5669188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5669193">if</span>&nbsp;<span class="op" id="5669196">*</span><span class="ident" id="5669197">benchmarkMemory</span>&nbsp;<span class="op" id="5669213">||</span>&nbsp;<span class="ident" id="5669216">b</span><span class="op" id="5669217">.</span><span class="ident" id="5669218">showAllocResult</span>&nbsp;<span class="op" id="5669234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5669240">results</span>&nbsp;<span class="op" id="5669248">+=</span>&nbsp;<span class="string" id="5669251">&#34;\t&#34;</span>&nbsp;<span class="op" id="5669256">+</span>&nbsp;<span class="ident" id="5669258">r</span><span class="op" id="5669259">.</span><span class="ident" id="5669260">MemString</span><span class="op" id="5669269">(</span><span class="op" id="5669270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5669275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5669280">fmt</span><span class="op" id="5669283">.</span><span class="ident" id="5669284">Println</span><span class="op" id="5669291">(</span><span class="ident" id="5669292">results</span><span class="op" id="5669299">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5669304">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5669384">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5669457">if</span>&nbsp;<span class="builtinfunc" id="5669460">len</span><span class="op" id="5669463">(</span><span class="ident" id="5669464">b</span><span class="op" id="5669465">.</span><span class="ident" id="5669466">output</span><span class="op" id="5669472">)</span>&nbsp;<span class="op" id="5669474">&gt;</span>&nbsp;<span class="num" id="5669476">0</span>&nbsp;<span class="op" id="5669478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5669484">b</span><span class="op" id="5669485">.</span><span class="ident" id="5669486">trimOutput</span><span class="op" id="5669496">(</span><span class="op" id="5669497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5669503">fmt</span><span class="op" id="5669506">.</span><span class="ident" id="5669507">Printf</span><span class="op" id="5669513">(</span><span class="string" id="5669514">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="5669533">,</span>&nbsp;<span class="ident" id="5669535">benchName</span><span class="op" id="5669544">,</span>&nbsp;<span class="ident" id="5669546">b</span><span class="op" id="5669547">.</span><span class="ident" id="5669548">output</span><span class="op" id="5669554">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5669559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5669564">if</span>&nbsp;<span class="ident" id="5669567">p</span>&nbsp;<span class="op" id="5669569">:=</span>&nbsp;<span class="ident" id="5669572">runtime</span><span class="op" id="5669579">.</span><span class="ident" id="5669580">GOMAXPROCS</span><span class="op" id="5669590">(</span><span class="op" id="5669591">-</span><span class="num" id="5669592">1</span><span class="op" id="5669593">)</span><span class="op" id="5669594">;</span>&nbsp;<span class="ident" id="5669596">p</span>&nbsp;<span class="op" id="5669598">!=</span>&nbsp;<span class="ident" id="5669601">procs</span>&nbsp;<span class="op" id="5669607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5669613">fmt</span><span class="op" id="5669616">.</span><span class="ident" id="5669617">Fprintf</span><span class="op" id="5669624">(</span><span class="ident" id="5669625">os</span><span class="op" id="5669627">.</span><span class="ident" id="5669628">Stderr</span><span class="op" id="5669634">,</span>&nbsp;<span class="string" id="5669636">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="5669677">,</span>&nbsp;<span class="ident" id="5669679">benchName</span><span class="op" id="5669688">,</span>&nbsp;<span class="ident" id="5669690">p</span><span class="op" id="5669691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5669696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5669700">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5669703">}</span><br>
<span class="lineno"></span><span class="op" id="5669705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5669708">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="5669784">func</span>&nbsp;<span class="op" id="5669789">(</span><span class="ident" id="5669790">b</span>&nbsp;<span class="op" id="5669792">*</span><span class="ident" id="5669793">B</span><span class="op" id="5669794">)</span>&nbsp;<span class="ident" id="5669796">trimOutput</span><span class="op" id="5669806">(</span><span class="op" id="5669807">)</span>&nbsp;<span class="op" id="5669809">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5669812">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5669884">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5669964">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670048">const</span>&nbsp;<span class="ident" id="5670054">maxNewlines</span>&nbsp;<span class="op" id="5670066">=</span>&nbsp;<span class="num" id="5670068">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670072">for</span>&nbsp;<span class="ident" id="5670076">nlCount</span><span class="op" id="5670083">,</span>&nbsp;<span class="ident" id="5670085">j</span>&nbsp;<span class="op" id="5670087">:=</span>&nbsp;<span class="num" id="5670090">0</span><span class="op" id="5670091">,</span>&nbsp;<span class="num" id="5670093">0</span><span class="op" id="5670094">;</span>&nbsp;<span class="ident" id="5670096">j</span>&nbsp;<span class="op" id="5670098">&lt;</span>&nbsp;<span class="builtinfunc" id="5670100">len</span><span class="op" id="5670103">(</span><span class="ident" id="5670104">b</span><span class="op" id="5670105">.</span><span class="ident" id="5670106">output</span><span class="op" id="5670112">)</span><span class="op" id="5670113">;</span>&nbsp;<span class="ident" id="5670115">j</span><span class="op" id="5670116">++</span>&nbsp;<span class="op" id="5670119">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670123">if</span>&nbsp;<span class="ident" id="5670126">b</span><span class="op" id="5670127">.</span><span class="ident" id="5670128">output</span><span class="op" id="5670134">[</span><span class="ident" id="5670135">j</span><span class="op" id="5670136">]</span>&nbsp;<span class="op" id="5670138">==</span>&nbsp;<span class="string" id="5670141">&#39;\n&#39;</span>&nbsp;<span class="op" id="5670146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5670151">nlCount</span><span class="op" id="5670158">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670164">if</span>&nbsp;<span class="ident" id="5670167">nlCount</span>&nbsp;<span class="op" id="5670175">&gt;=</span>&nbsp;<span class="ident" id="5670178">maxNewlines</span>&nbsp;<span class="op" id="5670190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5670196">b</span><span class="op" id="5670197">.</span><span class="ident" id="5670198">output</span>&nbsp;<span class="op" id="5670205">=</span>&nbsp;<span class="builtinfunc" id="5670207">append</span><span class="op" id="5670213">(</span><span class="ident" id="5670214">b</span><span class="op" id="5670215">.</span><span class="ident" id="5670216">output</span><span class="op" id="5670222">[</span><span class="op" id="5670223">:</span><span class="ident" id="5670224">j</span><span class="op" id="5670225">]</span><span class="op" id="5670226">,</span>&nbsp;<span class="string" id="5670228">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="5670258">...</span><span class="op" id="5670261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670267">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5670276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5670280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5670283">}</span><br>
<span class="lineno"></span><span class="op" id="5670285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="5670288">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="5670352">type</span>&nbsp;<span class="ident" id="5670357">PB</span>&nbsp;<span class="keyword" id="5670360">struct</span>&nbsp;<span class="op" id="5670367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5670370">globalN</span>&nbsp;<span class="op" id="5670378">*</span><span class="ident" id="5670379">uint64</span>&nbsp;<span class="comment" id="5670386">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5670445">grain</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5670453">uint64</span>&nbsp;&nbsp;<span class="comment" id="5670461">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5670515">cache</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5670523">uint64</span>&nbsp;&nbsp;<span class="comment" id="5670531">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5670570">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5670578">uint64</span>&nbsp;&nbsp;<span class="comment" id="5670586">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="5670633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5670636">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="5670698">func</span>&nbsp;<span class="op" id="5670703">(</span><span class="ident" id="5670704">pb</span>&nbsp;<span class="op" id="5670707">*</span><span class="ident" id="5670708">PB</span><span class="op" id="5670710">)</span>&nbsp;<span class="ident" id="5670712">Next</span><span class="op" id="5670716">(</span><span class="op" id="5670717">)</span>&nbsp;<span class="builtintype" id="5670719">bool</span>&nbsp;<span class="op" id="5670724">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670727">if</span>&nbsp;<span class="ident" id="5670730">pb</span><span class="op" id="5670732">.</span><span class="ident" id="5670733">cache</span>&nbsp;<span class="op" id="5670739">==</span>&nbsp;<span class="num" id="5670742">0</span>&nbsp;<span class="op" id="5670744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5670748">n</span>&nbsp;<span class="op" id="5670750">:=</span>&nbsp;<span class="ident" id="5670753">atomic</span><span class="op" id="5670759">.</span><span class="ident" id="5670760">AddUint64</span><span class="op" id="5670769">(</span><span class="ident" id="5670770">pb</span><span class="op" id="5670772">.</span><span class="ident" id="5670773">globalN</span><span class="op" id="5670780">,</span>&nbsp;<span class="ident" id="5670782">pb</span><span class="op" id="5670784">.</span><span class="ident" id="5670785">grain</span><span class="op" id="5670790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670794">if</span>&nbsp;<span class="ident" id="5670797">n</span>&nbsp;<span class="op" id="5670799">&lt;=</span>&nbsp;<span class="ident" id="5670802">pb</span><span class="op" id="5670804">.</span><span class="ident" id="5670805">bN</span>&nbsp;<span class="op" id="5670808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5670813">pb</span><span class="op" id="5670815">.</span><span class="ident" id="5670816">cache</span>&nbsp;<span class="op" id="5670822">=</span>&nbsp;<span class="ident" id="5670824">pb</span><span class="op" id="5670826">.</span><span class="ident" id="5670827">grain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5670835">}</span>&nbsp;<span class="keyword" id="5670837">else</span>&nbsp;<span class="keyword" id="5670842">if</span>&nbsp;<span class="ident" id="5670845">n</span>&nbsp;<span class="op" id="5670847">&lt;</span>&nbsp;<span class="ident" id="5670849">pb</span><span class="op" id="5670851">.</span><span class="ident" id="5670852">bN</span><span class="op" id="5670854">+</span><span class="ident" id="5670855">pb</span><span class="op" id="5670857">.</span><span class="ident" id="5670858">grain</span>&nbsp;<span class="op" id="5670864">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5670869">pb</span><span class="op" id="5670871">.</span><span class="ident" id="5670872">cache</span>&nbsp;<span class="op" id="5670878">=</span>&nbsp;<span class="ident" id="5670880">pb</span><span class="op" id="5670882">.</span><span class="ident" id="5670883">bN</span>&nbsp;<span class="op" id="5670886">+</span>&nbsp;<span class="ident" id="5670888">pb</span><span class="op" id="5670890">.</span><span class="ident" id="5670891">grain</span>&nbsp;<span class="op" id="5670897">-</span>&nbsp;<span class="ident" id="5670899">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5670903">}</span>&nbsp;<span class="keyword" id="5670905">else</span>&nbsp;<span class="op" id="5670910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670915">return</span>&nbsp;<span class="builtintype" id="5670922">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5670930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5670933">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5670936">pb</span><span class="op" id="5670938">.</span><span class="ident" id="5670939">cache</span><span class="op" id="5670944">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5670948">return</span>&nbsp;<span class="builtintype" id="5670955">true</span><br>
<span class="lineno"></span><span class="op" id="5670960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5670963">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="5671008">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="5671085">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5671165">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="5671234">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="5671293">//</span><br>
<span class="lineno">385</span><span class="comment" id="5671296">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5671369">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5671440">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="5671513">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="5671549">func</span>&nbsp;<span class="op" id="5671554">(</span><span class="ident" id="5671555">b</span>&nbsp;<span class="op" id="5671557">*</span><span class="ident" id="5671558">B</span><span class="op" id="5671559">)</span>&nbsp;<span class="ident" id="5671561">RunParallel</span><span class="op" id="5671572">(</span><span class="ident" id="5671573">body</span>&nbsp;<span class="keyword" id="5671578">func</span><span class="op" id="5671582">(</span><span class="op" id="5671583">*</span><span class="ident" id="5671584">PB</span><span class="op" id="5671586">)</span><span class="op" id="5671587">)</span>&nbsp;<span class="op" id="5671589">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5671592">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100µs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5671660">//&nbsp;100µs&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5671729">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5671757">grain</span>&nbsp;<span class="op" id="5671763">:=</span>&nbsp;<span class="ident" id="5671766">uint64</span><span class="op" id="5671772">(</span><span class="num" id="5671773">0</span><span class="op" id="5671774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5671777">if</span>&nbsp;<span class="ident" id="5671780">b</span><span class="op" id="5671781">.</span><span class="ident" id="5671782">previousN</span>&nbsp;<span class="op" id="5671792">&gt;</span>&nbsp;<span class="num" id="5671794">0</span>&nbsp;<span class="op" id="5671796">&amp;&amp;</span>&nbsp;<span class="ident" id="5671799">b</span><span class="op" id="5671800">.</span><span class="ident" id="5671801">previousDuration</span>&nbsp;<span class="op" id="5671818">&gt;</span>&nbsp;<span class="num" id="5671820">0</span>&nbsp;<span class="op" id="5671822">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5671826">grain</span>&nbsp;<span class="op" id="5671832">=</span>&nbsp;<span class="num" id="5671834">1e5</span>&nbsp;<span class="op" id="5671838">*</span>&nbsp;<span class="ident" id="5671840">uint64</span><span class="op" id="5671846">(</span><span class="ident" id="5671847">b</span><span class="op" id="5671848">.</span><span class="ident" id="5671849">previousN</span><span class="op" id="5671858">)</span>&nbsp;<span class="op" id="5671860">/</span>&nbsp;<span class="ident" id="5671862">uint64</span><span class="op" id="5671868">(</span><span class="ident" id="5671869">b</span><span class="op" id="5671870">.</span><span class="ident" id="5671871">previousDuration</span><span class="op" id="5671887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5671890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5671893">if</span>&nbsp;<span class="ident" id="5671896">grain</span>&nbsp;<span class="op" id="5671902">&lt;</span>&nbsp;<span class="num" id="5671904">1</span>&nbsp;<span class="op" id="5671906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5671910">grain</span>&nbsp;<span class="op" id="5671916">=</span>&nbsp;<span class="num" id="5671918">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5671921">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5671924">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5671994">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100µs/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672049">if</span>&nbsp;<span class="ident" id="5672052">grain</span>&nbsp;<span class="op" id="5672058">&gt;</span>&nbsp;<span class="num" id="5672060">1e4</span>&nbsp;<span class="op" id="5672064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672068">grain</span>&nbsp;<span class="op" id="5672074">=</span>&nbsp;<span class="num" id="5672076">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5672081">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672085">n</span>&nbsp;<span class="op" id="5672087">:=</span>&nbsp;<span class="ident" id="5672090">uint64</span><span class="op" id="5672096">(</span><span class="num" id="5672097">0</span><span class="op" id="5672098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672101">numProcs</span>&nbsp;<span class="op" id="5672110">:=</span>&nbsp;<span class="ident" id="5672113">b</span><span class="op" id="5672114">.</span><span class="ident" id="5672115">parallelism</span>&nbsp;<span class="op" id="5672127">*</span>&nbsp;<span class="ident" id="5672129">runtime</span><span class="op" id="5672136">.</span><span class="ident" id="5672137">GOMAXPROCS</span><span class="op" id="5672147">(</span><span class="num" id="5672148">0</span><span class="op" id="5672149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672152">var</span>&nbsp;<span class="ident" id="5672156">wg</span>&nbsp;<span class="ident" id="5672159">sync</span><span class="op" id="5672163">.</span><span class="ident" id="5672164">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672175">wg</span><span class="op" id="5672177">.</span><span class="ident" id="5672178">Add</span><span class="op" id="5672181">(</span><span class="ident" id="5672182">numProcs</span><span class="op" id="5672190">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672193">for</span>&nbsp;<span class="ident" id="5672197">p</span>&nbsp;<span class="op" id="5672199">:=</span>&nbsp;<span class="num" id="5672202">0</span><span class="op" id="5672203">;</span>&nbsp;<span class="ident" id="5672205">p</span>&nbsp;<span class="op" id="5672207">&lt;</span>&nbsp;<span class="ident" id="5672209">numProcs</span><span class="op" id="5672217">;</span>&nbsp;<span class="ident" id="5672219">p</span><span class="op" id="5672220">++</span>&nbsp;<span class="op" id="5672223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672227">go</span>&nbsp;<span class="keyword" id="5672230">func</span><span class="op" id="5672234">(</span><span class="op" id="5672235">)</span>&nbsp;<span class="op" id="5672237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672242">defer</span>&nbsp;<span class="ident" id="5672248">wg</span><span class="op" id="5672250">.</span><span class="ident" id="5672251">Done</span><span class="op" id="5672255">(</span><span class="op" id="5672256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672261">pb</span>&nbsp;<span class="op" id="5672264">:=</span>&nbsp;<span class="op" id="5672267">&amp;</span><span class="ident" id="5672268">PB</span><span class="op" id="5672270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672276">globalN</span><span class="op" id="5672283">:</span>&nbsp;<span class="op" id="5672285">&amp;</span><span class="ident" id="5672286">n</span><span class="op" id="5672287">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672293">grain</span><span class="op" id="5672298">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5672302">grain</span><span class="op" id="5672307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672313">bN</span><span class="op" id="5672315">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672322">uint64</span><span class="op" id="5672328">(</span><span class="ident" id="5672329">b</span><span class="op" id="5672330">.</span><span class="ident" id="5672331">N</span><span class="op" id="5672332">)</span><span class="op" id="5672333">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5672338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672343">body</span><span class="op" id="5672347">(</span><span class="ident" id="5672348">pb</span><span class="op" id="5672350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5672354">}</span><span class="op" id="5672355">(</span><span class="op" id="5672356">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5672359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672362">wg</span><span class="op" id="5672364">.</span><span class="ident" id="5672365">Wait</span><span class="op" id="5672369">(</span><span class="op" id="5672370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672373">if</span>&nbsp;<span class="ident" id="5672376">n</span>&nbsp;<span class="op" id="5672378">&lt;=</span>&nbsp;<span class="ident" id="5672381">uint64</span><span class="op" id="5672387">(</span><span class="ident" id="5672388">b</span><span class="op" id="5672389">.</span><span class="ident" id="5672390">N</span><span class="op" id="5672391">)</span>&nbsp;<span class="op" id="5672393">&amp;&amp;</span>&nbsp;<span class="op" id="5672396">!</span><span class="ident" id="5672397">b</span><span class="op" id="5672398">.</span><span class="ident" id="5672399">Failed</span><span class="op" id="5672405">(</span><span class="op" id="5672406">)</span>&nbsp;<span class="op" id="5672408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672412">b</span><span class="op" id="5672413">.</span><span class="ident" id="5672414">Fatal</span><span class="op" id="5672419">(</span><span class="string" id="5672420">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="5672473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5672476">}</span><br>
<span class="lineno">425</span><span class="op" id="5672478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5672481">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="5672566">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="5672643">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="5672698">func</span>&nbsp;<span class="op" id="5672703">(</span><span class="ident" id="5672704">b</span>&nbsp;<span class="op" id="5672706">*</span><span class="ident" id="5672707">B</span><span class="op" id="5672708">)</span>&nbsp;<span class="ident" id="5672710">SetParallelism</span><span class="op" id="5672724">(</span><span class="ident" id="5672725">p</span>&nbsp;<span class="builtintype" id="5672727">int</span><span class="op" id="5672730">)</span>&nbsp;<span class="op" id="5672732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5672735">if</span>&nbsp;<span class="ident" id="5672738">p</span>&nbsp;<span class="op" id="5672740">&gt;=</span>&nbsp;<span class="num" id="5672743">1</span>&nbsp;<span class="op" id="5672745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672749">b</span><span class="op" id="5672750">.</span><span class="ident" id="5672751">parallelism</span>&nbsp;<span class="op" id="5672763">=</span>&nbsp;<span class="ident" id="5672765">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5672768">}</span><br>
<span class="lineno"></span><span class="op" id="5672770">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="5672773">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="5672836">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5672896">func</span>&nbsp;<span class="ident" id="5672901">Benchmark</span><span class="op" id="5672910">(</span><span class="ident" id="5672911">f</span>&nbsp;<span class="keyword" id="5672913">func</span><span class="op" id="5672917">(</span><span class="ident" id="5672918">b</span>&nbsp;<span class="op" id="5672920">*</span><span class="ident" id="5672921">B</span><span class="op" id="5672922">)</span><span class="op" id="5672923">)</span>&nbsp;<span class="ident" id="5672925">BenchmarkResult</span>&nbsp;<span class="op" id="5672941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672944">b</span>&nbsp;<span class="op" id="5672946">:=</span>&nbsp;<span class="op" id="5672949">&amp;</span><span class="ident" id="5672950">B</span><span class="op" id="5672951">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672955">common</span><span class="op" id="5672961">:</span>&nbsp;<span class="ident" id="5672963">common</span><span class="op" id="5672969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5672974">signal</span><span class="op" id="5672980">:</span>&nbsp;<span class="builtinfunc" id="5672982">make</span><span class="op" id="5672986">(</span><span class="keyword" id="5672987">chan</span>&nbsp;<span class="keyword" id="5672992">interface</span><span class="op" id="5673001">{</span><span class="op" id="5673002">}</span><span class="op" id="5673003">)</span><span class="op" id="5673004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5673008">}</span><span class="op" id="5673009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5673013">benchmark</span><span class="op" id="5673022">:</span>&nbsp;<span class="ident" id="5673024">InternalBenchmark</span><span class="op" id="5673041">{</span><span class="string" id="5673042">&#34;&#34;</span><span class="op" id="5673044">,</span>&nbsp;<span class="ident" id="5673046">f</span><span class="op" id="5673047">}</span><span class="op" id="5673048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5673051">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5673054">return</span>&nbsp;<span class="ident" id="5673061">b</span><span class="op" id="5673062">.</span><span class="ident" id="5673063">run</span><span class="op" id="5673066">(</span><span class="op" id="5673067">)</span><br>
<span class="lineno"></span><span class="op" id="5673069">}</span>
</div>
</body>
</html>
