<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html" class="current">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6814595">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6814651">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6814705">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6814756">//&nbsp;+build&nbsp;!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6814774">package</span>&nbsp;<span class="ident" id="6814782">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6814787">import</span>&nbsp;<span class="op" id="6814794">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6814797">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6814808">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6814819">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6814829">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6814832">var</span>&nbsp;<span class="ident" id="6814836">listenerTests</span>&nbsp;<span class="op" id="6814850">=</span>&nbsp;<span class="op" id="6814852">[</span><span class="op" id="6814853">]</span><span class="keyword" id="6814854">struct</span>&nbsp;<span class="op" id="6814861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6814864">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6814873">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6814881">laddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6814890">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6814898">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6814907">bool</span>&nbsp;<span class="comment" id="6814912">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6814953">wildcard</span>&nbsp;<span class="builtintype" id="6814962">bool</span>&nbsp;<span class="comment" id="6814967">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">20</span><span class="op" id="6814997">}</span><span class="op" id="6814998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815001">{</span><span class="ident" id="6815002">net</span><span class="op" id="6815005">:</span>&nbsp;<span class="string" id="6815007">&#34;tcp&#34;</span><span class="op" id="6815012">,</span>&nbsp;<span class="ident" id="6815014">laddr</span><span class="op" id="6815019">:</span>&nbsp;<span class="string" id="6815021">&#34;&#34;</span><span class="op" id="6815023">,</span>&nbsp;<span class="ident" id="6815025">wildcard</span><span class="op" id="6815033">:</span>&nbsp;<span class="builtintype" id="6815035">true</span><span class="op" id="6815039">}</span><span class="op" id="6815040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815043">{</span><span class="ident" id="6815044">net</span><span class="op" id="6815047">:</span>&nbsp;<span class="string" id="6815049">&#34;tcp&#34;</span><span class="op" id="6815054">,</span>&nbsp;<span class="ident" id="6815056">laddr</span><span class="op" id="6815061">:</span>&nbsp;<span class="string" id="6815063">&#34;0.0.0.0&#34;</span><span class="op" id="6815072">,</span>&nbsp;<span class="ident" id="6815074">wildcard</span><span class="op" id="6815082">:</span>&nbsp;<span class="builtintype" id="6815084">true</span><span class="op" id="6815088">}</span><span class="op" id="6815089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815092">{</span><span class="ident" id="6815093">net</span><span class="op" id="6815096">:</span>&nbsp;<span class="string" id="6815098">&#34;tcp&#34;</span><span class="op" id="6815103">,</span>&nbsp;<span class="ident" id="6815105">laddr</span><span class="op" id="6815110">:</span>&nbsp;<span class="string" id="6815112">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6815130">,</span>&nbsp;<span class="ident" id="6815132">wildcard</span><span class="op" id="6815140">:</span>&nbsp;<span class="builtintype" id="6815142">true</span><span class="op" id="6815146">}</span><span class="op" id="6815147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815150">{</span><span class="ident" id="6815151">net</span><span class="op" id="6815154">:</span>&nbsp;<span class="string" id="6815156">&#34;tcp&#34;</span><span class="op" id="6815161">,</span>&nbsp;<span class="ident" id="6815163">laddr</span><span class="op" id="6815168">:</span>&nbsp;<span class="string" id="6815170">&#34;[::]&#34;</span><span class="op" id="6815176">,</span>&nbsp;<span class="ident" id="6815178">ipv6</span><span class="op" id="6815182">:</span>&nbsp;<span class="builtintype" id="6815184">true</span><span class="op" id="6815188">,</span>&nbsp;<span class="ident" id="6815190">wildcard</span><span class="op" id="6815198">:</span>&nbsp;<span class="builtintype" id="6815200">true</span><span class="op" id="6815204">}</span><span class="op" id="6815205">,</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815209">{</span><span class="ident" id="6815210">net</span><span class="op" id="6815213">:</span>&nbsp;<span class="string" id="6815215">&#34;tcp&#34;</span><span class="op" id="6815220">,</span>&nbsp;<span class="ident" id="6815222">laddr</span><span class="op" id="6815227">:</span>&nbsp;<span class="string" id="6815229">&#34;127.0.0.1&#34;</span><span class="op" id="6815240">}</span><span class="op" id="6815241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815244">{</span><span class="ident" id="6815245">net</span><span class="op" id="6815248">:</span>&nbsp;<span class="string" id="6815250">&#34;tcp&#34;</span><span class="op" id="6815255">,</span>&nbsp;<span class="ident" id="6815257">laddr</span><span class="op" id="6815262">:</span>&nbsp;<span class="string" id="6815264">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6815284">}</span><span class="op" id="6815285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815288">{</span><span class="ident" id="6815289">net</span><span class="op" id="6815292">:</span>&nbsp;<span class="string" id="6815294">&#34;tcp&#34;</span><span class="op" id="6815299">,</span>&nbsp;<span class="ident" id="6815301">laddr</span><span class="op" id="6815306">:</span>&nbsp;<span class="string" id="6815308">&#34;[::1]&#34;</span><span class="op" id="6815315">,</span>&nbsp;<span class="ident" id="6815317">ipv6</span><span class="op" id="6815321">:</span>&nbsp;<span class="builtintype" id="6815323">true</span><span class="op" id="6815327">}</span><span class="op" id="6815328">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815332">{</span><span class="ident" id="6815333">net</span><span class="op" id="6815336">:</span>&nbsp;<span class="string" id="6815338">&#34;tcp4&#34;</span><span class="op" id="6815344">,</span>&nbsp;<span class="ident" id="6815346">laddr</span><span class="op" id="6815351">:</span>&nbsp;<span class="string" id="6815353">&#34;&#34;</span><span class="op" id="6815355">,</span>&nbsp;<span class="ident" id="6815357">wildcard</span><span class="op" id="6815365">:</span>&nbsp;<span class="builtintype" id="6815367">true</span><span class="op" id="6815371">}</span><span class="op" id="6815372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815375">{</span><span class="ident" id="6815376">net</span><span class="op" id="6815379">:</span>&nbsp;<span class="string" id="6815381">&#34;tcp4&#34;</span><span class="op" id="6815387">,</span>&nbsp;<span class="ident" id="6815389">laddr</span><span class="op" id="6815394">:</span>&nbsp;<span class="string" id="6815396">&#34;0.0.0.0&#34;</span><span class="op" id="6815405">,</span>&nbsp;<span class="ident" id="6815407">wildcard</span><span class="op" id="6815415">:</span>&nbsp;<span class="builtintype" id="6815417">true</span><span class="op" id="6815421">}</span><span class="op" id="6815422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815425">{</span><span class="ident" id="6815426">net</span><span class="op" id="6815429">:</span>&nbsp;<span class="string" id="6815431">&#34;tcp4&#34;</span><span class="op" id="6815437">,</span>&nbsp;<span class="ident" id="6815439">laddr</span><span class="op" id="6815444">:</span>&nbsp;<span class="string" id="6815446">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6815464">,</span>&nbsp;<span class="ident" id="6815466">wildcard</span><span class="op" id="6815474">:</span>&nbsp;<span class="builtintype" id="6815476">true</span><span class="op" id="6815480">}</span><span class="op" id="6815481">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815485">{</span><span class="ident" id="6815486">net</span><span class="op" id="6815489">:</span>&nbsp;<span class="string" id="6815491">&#34;tcp4&#34;</span><span class="op" id="6815497">,</span>&nbsp;<span class="ident" id="6815499">laddr</span><span class="op" id="6815504">:</span>&nbsp;<span class="string" id="6815506">&#34;127.0.0.1&#34;</span><span class="op" id="6815517">}</span><span class="op" id="6815518">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815521">{</span><span class="ident" id="6815522">net</span><span class="op" id="6815525">:</span>&nbsp;<span class="string" id="6815527">&#34;tcp4&#34;</span><span class="op" id="6815533">,</span>&nbsp;<span class="ident" id="6815535">laddr</span><span class="op" id="6815540">:</span>&nbsp;<span class="string" id="6815542">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6815562">}</span><span class="op" id="6815563">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815567">{</span><span class="ident" id="6815568">net</span><span class="op" id="6815571">:</span>&nbsp;<span class="string" id="6815573">&#34;tcp6&#34;</span><span class="op" id="6815579">,</span>&nbsp;<span class="ident" id="6815581">laddr</span><span class="op" id="6815586">:</span>&nbsp;<span class="string" id="6815588">&#34;&#34;</span><span class="op" id="6815590">,</span>&nbsp;<span class="ident" id="6815592">ipv6</span><span class="op" id="6815596">:</span>&nbsp;<span class="builtintype" id="6815598">true</span><span class="op" id="6815602">,</span>&nbsp;<span class="ident" id="6815604">wildcard</span><span class="op" id="6815612">:</span>&nbsp;<span class="builtintype" id="6815614">true</span><span class="op" id="6815618">}</span><span class="op" id="6815619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815622">{</span><span class="ident" id="6815623">net</span><span class="op" id="6815626">:</span>&nbsp;<span class="string" id="6815628">&#34;tcp6&#34;</span><span class="op" id="6815634">,</span>&nbsp;<span class="ident" id="6815636">laddr</span><span class="op" id="6815641">:</span>&nbsp;<span class="string" id="6815643">&#34;[::]&#34;</span><span class="op" id="6815649">,</span>&nbsp;<span class="ident" id="6815651">ipv6</span><span class="op" id="6815655">:</span>&nbsp;<span class="builtintype" id="6815657">true</span><span class="op" id="6815661">,</span>&nbsp;<span class="ident" id="6815663">wildcard</span><span class="op" id="6815671">:</span>&nbsp;<span class="builtintype" id="6815673">true</span><span class="op" id="6815677">}</span><span class="op" id="6815678">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815682">{</span><span class="ident" id="6815683">net</span><span class="op" id="6815686">:</span>&nbsp;<span class="string" id="6815688">&#34;tcp6&#34;</span><span class="op" id="6815694">,</span>&nbsp;<span class="ident" id="6815696">laddr</span><span class="op" id="6815701">:</span>&nbsp;<span class="string" id="6815703">&#34;[::1]&#34;</span><span class="op" id="6815710">,</span>&nbsp;<span class="ident" id="6815712">ipv6</span><span class="op" id="6815716">:</span>&nbsp;<span class="builtintype" id="6815718">true</span><span class="op" id="6815722">}</span><span class="op" id="6815723">,</span><br>
<span class="lineno"></span><span class="op" id="6815725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6815728">//&nbsp;TestTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="6815793">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno">45</span><span class="comment" id="6815858">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="6815872">func</span>&nbsp;<span class="ident" id="6815877">TestTCPListener</span><span class="op" id="6815892">(</span><span class="ident" id="6815893">t</span>&nbsp;<span class="op" id="6815895">*</span><span class="ident" id="6815896">testing</span><span class="op" id="6815903">.</span><span class="ident" id="6815904">T</span><span class="op" id="6815905">)</span>&nbsp;<span class="op" id="6815907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6815910">switch</span>&nbsp;<span class="ident" id="6815917">runtime</span><span class="op" id="6815924">.</span><span class="ident" id="6815925">GOOS</span>&nbsp;<span class="op" id="6815930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6815933">case</span>&nbsp;<span class="string" id="6815938">&#34;plan9&#34;</span><span class="op" id="6815945">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6815949">t</span><span class="op" id="6815950">.</span><span class="ident" id="6815951">Skipf</span><span class="op" id="6815956">(</span><span class="string" id="6815957">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6815978">,</span>&nbsp;<span class="ident" id="6815980">runtime</span><span class="op" id="6815987">.</span><span class="ident" id="6815988">GOOS</span><span class="op" id="6815992">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6815995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6815999">for</span>&nbsp;<span class="ident" id="6816003">_</span><span class="op" id="6816004">,</span>&nbsp;<span class="ident" id="6816006">tt</span>&nbsp;<span class="op" id="6816009">:=</span>&nbsp;<span class="keyword" id="6816012">range</span>&nbsp;<span class="ident" id="6816018">listenerTests</span>&nbsp;<span class="op" id="6816032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816036">if</span>&nbsp;<span class="ident" id="6816039">tt</span><span class="op" id="6816041">.</span><span class="ident" id="6816042">wildcard</span>&nbsp;<span class="op" id="6816051">&amp;&amp;</span>&nbsp;<span class="op" id="6816054">(</span><span class="ident" id="6816055">testing</span><span class="op" id="6816062">.</span><span class="ident" id="6816063">Short</span><span class="op" id="6816068">(</span><span class="op" id="6816069">)</span>&nbsp;<span class="op" id="6816071">||</span>&nbsp;<span class="op" id="6816074">!</span><span class="op" id="6816075">*</span><span class="ident" id="6816076">testExternal</span><span class="op" id="6816088">)</span>&nbsp;<span class="op" id="6816090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816095">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816110">if</span>&nbsp;<span class="ident" id="6816113">tt</span><span class="op" id="6816115">.</span><span class="ident" id="6816116">ipv6</span>&nbsp;<span class="op" id="6816121">&amp;&amp;</span>&nbsp;<span class="op" id="6816124">!</span><span class="ident" id="6816125">supportsIPv6</span>&nbsp;<span class="op" id="6816138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816143">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816158">l1</span><span class="op" id="6816160">,</span>&nbsp;<span class="ident" id="6816162">port</span>&nbsp;<span class="op" id="6816167">:=</span>&nbsp;<span class="ident" id="6816170">usableListenPort</span><span class="op" id="6816186">(</span><span class="ident" id="6816187">t</span><span class="op" id="6816188">,</span>&nbsp;<span class="ident" id="6816190">tt</span><span class="op" id="6816192">.</span><span class="ident" id="6816193">net</span><span class="op" id="6816196">,</span>&nbsp;<span class="ident" id="6816198">tt</span><span class="op" id="6816200">.</span><span class="ident" id="6816201">laddr</span><span class="op" id="6816206">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816210">checkFirstListener</span><span class="op" id="6816228">(</span><span class="ident" id="6816229">t</span><span class="op" id="6816230">,</span>&nbsp;<span class="ident" id="6816232">tt</span><span class="op" id="6816234">.</span><span class="ident" id="6816235">net</span><span class="op" id="6816238">,</span>&nbsp;<span class="ident" id="6816240">tt</span><span class="op" id="6816242">.</span><span class="ident" id="6816243">laddr</span><span class="op" id="6816248">+</span><span class="string" id="6816249">&#34;:&#34;</span><span class="op" id="6816252">+</span><span class="ident" id="6816253">port</span><span class="op" id="6816257">,</span>&nbsp;<span class="ident" id="6816259">l1</span><span class="op" id="6816261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816265">l2</span><span class="op" id="6816267">,</span>&nbsp;<span class="ident" id="6816269">err</span>&nbsp;<span class="op" id="6816273">:=</span>&nbsp;<span class="ident" id="6816276">Listen</span><span class="op" id="6816282">(</span><span class="ident" id="6816283">tt</span><span class="op" id="6816285">.</span><span class="ident" id="6816286">net</span><span class="op" id="6816289">,</span>&nbsp;<span class="ident" id="6816291">tt</span><span class="op" id="6816293">.</span><span class="ident" id="6816294">laddr</span><span class="op" id="6816299">+</span><span class="string" id="6816300">&#34;:&#34;</span><span class="op" id="6816303">+</span><span class="ident" id="6816304">port</span><span class="op" id="6816308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816312">checkSecondListener</span><span class="op" id="6816331">(</span><span class="ident" id="6816332">t</span><span class="op" id="6816333">,</span>&nbsp;<span class="ident" id="6816335">tt</span><span class="op" id="6816337">.</span><span class="ident" id="6816338">net</span><span class="op" id="6816341">,</span>&nbsp;<span class="ident" id="6816343">tt</span><span class="op" id="6816345">.</span><span class="ident" id="6816346">laddr</span><span class="op" id="6816351">+</span><span class="string" id="6816352">&#34;:&#34;</span><span class="op" id="6816355">+</span><span class="ident" id="6816356">port</span><span class="op" id="6816360">,</span>&nbsp;<span class="ident" id="6816362">err</span><span class="op" id="6816365">,</span>&nbsp;<span class="ident" id="6816367">l2</span><span class="op" id="6816369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816373">l1</span><span class="op" id="6816375">.</span><span class="ident" id="6816376">Close</span><span class="op" id="6816381">(</span><span class="op" id="6816382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816385">}</span><br>
<span class="lineno">65</span><span class="op" id="6816387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6816390">//&nbsp;TestUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="6816455">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6816520">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno">70</span><span class="keyword" id="6816534">func</span>&nbsp;<span class="ident" id="6816539">TestUDPListener</span><span class="op" id="6816554">(</span><span class="ident" id="6816555">t</span>&nbsp;<span class="op" id="6816557">*</span><span class="ident" id="6816558">testing</span><span class="op" id="6816565">.</span><span class="ident" id="6816566">T</span><span class="op" id="6816567">)</span>&nbsp;<span class="op" id="6816569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816572">switch</span>&nbsp;<span class="ident" id="6816579">runtime</span><span class="op" id="6816586">.</span><span class="ident" id="6816587">GOOS</span>&nbsp;<span class="op" id="6816592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816595">case</span>&nbsp;<span class="string" id="6816600">&#34;plan9&#34;</span><span class="op" id="6816607">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816611">t</span><span class="op" id="6816612">.</span><span class="ident" id="6816613">Skipf</span><span class="op" id="6816618">(</span><span class="string" id="6816619">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6816640">,</span>&nbsp;<span class="ident" id="6816642">runtime</span><span class="op" id="6816649">.</span><span class="ident" id="6816650">GOOS</span><span class="op" id="6816654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816657">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816661">toudpnet</span>&nbsp;<span class="op" id="6816670">:=</span>&nbsp;<span class="keyword" id="6816673">func</span><span class="op" id="6816677">(</span><span class="ident" id="6816678">net</span>&nbsp;<span class="builtintype" id="6816682">string</span><span class="op" id="6816688">)</span>&nbsp;<span class="builtintype" id="6816690">string</span>&nbsp;<span class="op" id="6816697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816701">switch</span>&nbsp;<span class="ident" id="6816708">net</span>&nbsp;<span class="op" id="6816712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816716">case</span>&nbsp;<span class="string" id="6816721">&#34;tcp&#34;</span><span class="op" id="6816726">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816731">return</span>&nbsp;<span class="string" id="6816738">&#34;udp&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816746">case</span>&nbsp;<span class="string" id="6816751">&#34;tcp4&#34;</span><span class="op" id="6816757">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816762">return</span>&nbsp;<span class="string" id="6816769">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816778">case</span>&nbsp;<span class="string" id="6816783">&#34;tcp6&#34;</span><span class="op" id="6816789">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816794">return</span>&nbsp;<span class="string" id="6816801">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816810">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816814">return</span>&nbsp;<span class="string" id="6816821">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816834">for</span>&nbsp;<span class="ident" id="6816838">_</span><span class="op" id="6816839">,</span>&nbsp;<span class="ident" id="6816841">tt</span>&nbsp;<span class="op" id="6816844">:=</span>&nbsp;<span class="keyword" id="6816847">range</span>&nbsp;<span class="ident" id="6816853">listenerTests</span>&nbsp;<span class="op" id="6816867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816871">if</span>&nbsp;<span class="ident" id="6816874">tt</span><span class="op" id="6816876">.</span><span class="ident" id="6816877">wildcard</span>&nbsp;<span class="op" id="6816886">&amp;&amp;</span>&nbsp;<span class="op" id="6816889">(</span><span class="ident" id="6816890">testing</span><span class="op" id="6816897">.</span><span class="ident" id="6816898">Short</span><span class="op" id="6816903">(</span><span class="op" id="6816904">)</span>&nbsp;<span class="op" id="6816906">||</span>&nbsp;<span class="op" id="6816909">!</span><span class="op" id="6816910">*</span><span class="ident" id="6816911">testExternal</span><span class="op" id="6816923">)</span>&nbsp;<span class="op" id="6816925">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816930">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816945">if</span>&nbsp;<span class="ident" id="6816948">tt</span><span class="op" id="6816950">.</span><span class="ident" id="6816951">ipv6</span>&nbsp;<span class="op" id="6816956">&amp;&amp;</span>&nbsp;<span class="op" id="6816959">!</span><span class="ident" id="6816960">supportsIPv6</span>&nbsp;<span class="op" id="6816973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6816978">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6816989">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6816993">tt</span><span class="op" id="6816995">.</span><span class="ident" id="6816996">net</span>&nbsp;<span class="op" id="6817000">=</span>&nbsp;<span class="ident" id="6817002">toudpnet</span><span class="op" id="6817010">(</span><span class="ident" id="6817011">tt</span><span class="op" id="6817013">.</span><span class="ident" id="6817014">net</span><span class="op" id="6817017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817021">l1</span><span class="op" id="6817023">,</span>&nbsp;<span class="ident" id="6817025">port</span>&nbsp;<span class="op" id="6817030">:=</span>&nbsp;<span class="ident" id="6817033">usableListenPacketPort</span><span class="op" id="6817055">(</span><span class="ident" id="6817056">t</span><span class="op" id="6817057">,</span>&nbsp;<span class="ident" id="6817059">tt</span><span class="op" id="6817061">.</span><span class="ident" id="6817062">net</span><span class="op" id="6817065">,</span>&nbsp;<span class="ident" id="6817067">tt</span><span class="op" id="6817069">.</span><span class="ident" id="6817070">laddr</span><span class="op" id="6817075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817079">checkFirstListener</span><span class="op" id="6817097">(</span><span class="ident" id="6817098">t</span><span class="op" id="6817099">,</span>&nbsp;<span class="ident" id="6817101">tt</span><span class="op" id="6817103">.</span><span class="ident" id="6817104">net</span><span class="op" id="6817107">,</span>&nbsp;<span class="ident" id="6817109">tt</span><span class="op" id="6817111">.</span><span class="ident" id="6817112">laddr</span><span class="op" id="6817117">+</span><span class="string" id="6817118">&#34;:&#34;</span><span class="op" id="6817121">+</span><span class="ident" id="6817122">port</span><span class="op" id="6817126">,</span>&nbsp;<span class="ident" id="6817128">l1</span><span class="op" id="6817130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817134">l2</span><span class="op" id="6817136">,</span>&nbsp;<span class="ident" id="6817138">err</span>&nbsp;<span class="op" id="6817142">:=</span>&nbsp;<span class="ident" id="6817145">ListenPacket</span><span class="op" id="6817157">(</span><span class="ident" id="6817158">tt</span><span class="op" id="6817160">.</span><span class="ident" id="6817161">net</span><span class="op" id="6817164">,</span>&nbsp;<span class="ident" id="6817166">tt</span><span class="op" id="6817168">.</span><span class="ident" id="6817169">laddr</span><span class="op" id="6817174">+</span><span class="string" id="6817175">&#34;:&#34;</span><span class="op" id="6817178">+</span><span class="ident" id="6817179">port</span><span class="op" id="6817183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817187">checkSecondListener</span><span class="op" id="6817206">(</span><span class="ident" id="6817207">t</span><span class="op" id="6817208">,</span>&nbsp;<span class="ident" id="6817210">tt</span><span class="op" id="6817212">.</span><span class="ident" id="6817213">net</span><span class="op" id="6817216">,</span>&nbsp;<span class="ident" id="6817218">tt</span><span class="op" id="6817220">.</span><span class="ident" id="6817221">laddr</span><span class="op" id="6817226">+</span><span class="string" id="6817227">&#34;:&#34;</span><span class="op" id="6817230">+</span><span class="ident" id="6817231">port</span><span class="op" id="6817235">,</span>&nbsp;<span class="ident" id="6817237">err</span><span class="op" id="6817240">,</span>&nbsp;<span class="ident" id="6817242">l2</span><span class="op" id="6817244">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817248">l1</span><span class="op" id="6817250">.</span><span class="ident" id="6817251">Close</span><span class="op" id="6817256">(</span><span class="op" id="6817257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6817260">}</span><br>
<span class="lineno"></span><span class="op" id="6817262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6817265">var</span>&nbsp;<span class="ident" id="6817269">dualStackListenerTests</span>&nbsp;<span class="op" id="6817292">=</span>&nbsp;<span class="op" id="6817294">[</span><span class="op" id="6817295">]</span><span class="keyword" id="6817296">struct</span>&nbsp;<span class="op" id="6817303">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817306">net1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6817315">string</span>&nbsp;<span class="comment" id="6817322">//&nbsp;first&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817341">laddr1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6817350">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817358">net2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6817367">string</span>&nbsp;<span class="comment" id="6817374">//&nbsp;second&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817394">laddr2</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6817403">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817411">wildcard</span>&nbsp;<span class="builtintype" id="6817420">bool</span>&nbsp;&nbsp;<span class="comment" id="6817426">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6817457">xerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6817466">error</span>&nbsp;<span class="comment" id="6817472">//&nbsp;expected&nbsp;error&nbsp;value,&nbsp;nil&nbsp;or&nbsp;other</span><br>
<span class="lineno"></span><span class="op" id="6817510">}</span><span class="op" id="6817511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6817514">//&nbsp;Test&nbsp;cases&nbsp;and&nbsp;expected&nbsp;results&nbsp;for&nbsp;the&nbsp;attemping&nbsp;2nd&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6817596">//&nbsp;1st&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2nd&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;darwin&nbsp;&nbsp;freebsd&nbsp;&nbsp;linux&nbsp;&nbsp;openbsd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6817685">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6817774">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6817860">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6817946">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6818032">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6818121">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6818208">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6818295">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6818382">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6818469">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6818556">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6818643">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6818732">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6818819">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6818906">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6818993">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6819080">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6819169">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6819256">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6819343">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6819430">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6819517">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6819521">//&nbsp;Platform&nbsp;default&nbsp;configurations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6819558">//&nbsp;darwin,&nbsp;kernel&nbsp;version&nbsp;11.3.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6819592">//&nbsp;&nbsp;&nbsp;&nbsp;net.inet6.ip6.v6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6819665">//&nbsp;freebsd,&nbsp;kernel&nbsp;version&nbsp;8.2</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6819697">//&nbsp;&nbsp;&nbsp;&nbsp;net.inet6.ip6.v6only=1&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6819770">//&nbsp;linux,&nbsp;kernel&nbsp;version&nbsp;3.0.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6819802">//&nbsp;&nbsp;&nbsp;&nbsp;net.ipv6.bindv6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6819874">//&nbsp;openbsd,&nbsp;kernel&nbsp;version&nbsp;5.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6819906">//&nbsp;&nbsp;&nbsp;&nbsp;net.inet6.ip6.v6only=1&nbsp;(overriding&nbsp;is&nbsp;prohibited)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6819961">{</span><span class="ident" id="6819962">net1</span><span class="op" id="6819966">:</span>&nbsp;<span class="string" id="6819968">&#34;tcp&#34;</span><span class="op" id="6819973">,</span>&nbsp;<span class="ident" id="6819975">laddr1</span><span class="op" id="6819981">:</span>&nbsp;<span class="string" id="6819983">&#34;&#34;</span><span class="op" id="6819985">,</span>&nbsp;<span class="ident" id="6819987">net2</span><span class="op" id="6819991">:</span>&nbsp;<span class="string" id="6819993">&#34;tcp&#34;</span><span class="op" id="6819998">,</span>&nbsp;<span class="ident" id="6820000">laddr2</span><span class="op" id="6820006">:</span>&nbsp;<span class="string" id="6820008">&#34;&#34;</span><span class="op" id="6820010">,</span>&nbsp;<span class="ident" id="6820012">wildcard</span><span class="op" id="6820020">:</span>&nbsp;<span class="builtintype" id="6820022">true</span><span class="op" id="6820026">,</span>&nbsp;<span class="ident" id="6820028">xerr</span><span class="op" id="6820032">:</span>&nbsp;<span class="ident" id="6820034">syscall</span><span class="op" id="6820041">.</span><span class="ident" id="6820042">EADDRINUSE</span><span class="op" id="6820052">}</span><span class="op" id="6820053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820056">{</span><span class="ident" id="6820057">net1</span><span class="op" id="6820061">:</span>&nbsp;<span class="string" id="6820063">&#34;tcp&#34;</span><span class="op" id="6820068">,</span>&nbsp;<span class="ident" id="6820070">laddr1</span><span class="op" id="6820076">:</span>&nbsp;<span class="string" id="6820078">&#34;&#34;</span><span class="op" id="6820080">,</span>&nbsp;<span class="ident" id="6820082">net2</span><span class="op" id="6820086">:</span>&nbsp;<span class="string" id="6820088">&#34;tcp&#34;</span><span class="op" id="6820093">,</span>&nbsp;<span class="ident" id="6820095">laddr2</span><span class="op" id="6820101">:</span>&nbsp;<span class="string" id="6820103">&#34;0.0.0.0&#34;</span><span class="op" id="6820112">,</span>&nbsp;<span class="ident" id="6820114">wildcard</span><span class="op" id="6820122">:</span>&nbsp;<span class="builtintype" id="6820124">true</span><span class="op" id="6820128">,</span>&nbsp;<span class="ident" id="6820130">xerr</span><span class="op" id="6820134">:</span>&nbsp;<span class="ident" id="6820136">syscall</span><span class="op" id="6820143">.</span><span class="ident" id="6820144">EADDRINUSE</span><span class="op" id="6820154">}</span><span class="op" id="6820155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820158">{</span><span class="ident" id="6820159">net1</span><span class="op" id="6820163">:</span>&nbsp;<span class="string" id="6820165">&#34;tcp&#34;</span><span class="op" id="6820170">,</span>&nbsp;<span class="ident" id="6820172">laddr1</span><span class="op" id="6820178">:</span>&nbsp;<span class="string" id="6820180">&#34;0.0.0.0&#34;</span><span class="op" id="6820189">,</span>&nbsp;<span class="ident" id="6820191">net2</span><span class="op" id="6820195">:</span>&nbsp;<span class="string" id="6820197">&#34;tcp&#34;</span><span class="op" id="6820202">,</span>&nbsp;<span class="ident" id="6820204">laddr2</span><span class="op" id="6820210">:</span>&nbsp;<span class="string" id="6820212">&#34;&#34;</span><span class="op" id="6820214">,</span>&nbsp;<span class="ident" id="6820216">wildcard</span><span class="op" id="6820224">:</span>&nbsp;<span class="builtintype" id="6820226">true</span><span class="op" id="6820230">,</span>&nbsp;<span class="ident" id="6820232">xerr</span><span class="op" id="6820236">:</span>&nbsp;<span class="ident" id="6820238">syscall</span><span class="op" id="6820245">.</span><span class="ident" id="6820246">EADDRINUSE</span><span class="op" id="6820256">}</span><span class="op" id="6820257">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820261">{</span><span class="ident" id="6820262">net1</span><span class="op" id="6820266">:</span>&nbsp;<span class="string" id="6820268">&#34;tcp&#34;</span><span class="op" id="6820273">,</span>&nbsp;<span class="ident" id="6820275">laddr1</span><span class="op" id="6820281">:</span>&nbsp;<span class="string" id="6820283">&#34;&#34;</span><span class="op" id="6820285">,</span>&nbsp;<span class="ident" id="6820287">net2</span><span class="op" id="6820291">:</span>&nbsp;<span class="string" id="6820293">&#34;tcp&#34;</span><span class="op" id="6820298">,</span>&nbsp;<span class="ident" id="6820300">laddr2</span><span class="op" id="6820306">:</span>&nbsp;<span class="string" id="6820308">&#34;[::]&#34;</span><span class="op" id="6820314">,</span>&nbsp;<span class="ident" id="6820316">wildcard</span><span class="op" id="6820324">:</span>&nbsp;<span class="builtintype" id="6820326">true</span><span class="op" id="6820330">,</span>&nbsp;<span class="ident" id="6820332">xerr</span><span class="op" id="6820336">:</span>&nbsp;<span class="ident" id="6820338">syscall</span><span class="op" id="6820345">.</span><span class="ident" id="6820346">EADDRINUSE</span><span class="op" id="6820356">}</span><span class="op" id="6820357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820360">{</span><span class="ident" id="6820361">net1</span><span class="op" id="6820365">:</span>&nbsp;<span class="string" id="6820367">&#34;tcp&#34;</span><span class="op" id="6820372">,</span>&nbsp;<span class="ident" id="6820374">laddr1</span><span class="op" id="6820380">:</span>&nbsp;<span class="string" id="6820382">&#34;[::]&#34;</span><span class="op" id="6820388">,</span>&nbsp;<span class="ident" id="6820390">net2</span><span class="op" id="6820394">:</span>&nbsp;<span class="string" id="6820396">&#34;tcp&#34;</span><span class="op" id="6820401">,</span>&nbsp;<span class="ident" id="6820403">laddr2</span><span class="op" id="6820409">:</span>&nbsp;<span class="string" id="6820411">&#34;&#34;</span><span class="op" id="6820413">,</span>&nbsp;<span class="ident" id="6820415">wildcard</span><span class="op" id="6820423">:</span>&nbsp;<span class="builtintype" id="6820425">true</span><span class="op" id="6820429">,</span>&nbsp;<span class="ident" id="6820431">xerr</span><span class="op" id="6820435">:</span>&nbsp;<span class="ident" id="6820437">syscall</span><span class="op" id="6820444">.</span><span class="ident" id="6820445">EADDRINUSE</span><span class="op" id="6820455">}</span><span class="op" id="6820456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820459">{</span><span class="ident" id="6820460">net1</span><span class="op" id="6820464">:</span>&nbsp;<span class="string" id="6820466">&#34;tcp&#34;</span><span class="op" id="6820471">,</span>&nbsp;<span class="ident" id="6820473">laddr1</span><span class="op" id="6820479">:</span>&nbsp;<span class="string" id="6820481">&#34;0.0.0.0&#34;</span><span class="op" id="6820490">,</span>&nbsp;<span class="ident" id="6820492">net2</span><span class="op" id="6820496">:</span>&nbsp;<span class="string" id="6820498">&#34;tcp&#34;</span><span class="op" id="6820503">,</span>&nbsp;<span class="ident" id="6820505">laddr2</span><span class="op" id="6820511">:</span>&nbsp;<span class="string" id="6820513">&#34;[::]&#34;</span><span class="op" id="6820519">,</span>&nbsp;<span class="ident" id="6820521">wildcard</span><span class="op" id="6820529">:</span>&nbsp;<span class="builtintype" id="6820531">true</span><span class="op" id="6820535">,</span>&nbsp;<span class="ident" id="6820537">xerr</span><span class="op" id="6820541">:</span>&nbsp;<span class="ident" id="6820543">syscall</span><span class="op" id="6820550">.</span><span class="ident" id="6820551">EADDRINUSE</span><span class="op" id="6820561">}</span><span class="op" id="6820562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820565">{</span><span class="ident" id="6820566">net1</span><span class="op" id="6820570">:</span>&nbsp;<span class="string" id="6820572">&#34;tcp&#34;</span><span class="op" id="6820577">,</span>&nbsp;<span class="ident" id="6820579">laddr1</span><span class="op" id="6820585">:</span>&nbsp;<span class="string" id="6820587">&#34;[::]&#34;</span><span class="op" id="6820593">,</span>&nbsp;<span class="ident" id="6820595">net2</span><span class="op" id="6820599">:</span>&nbsp;<span class="string" id="6820601">&#34;tcp&#34;</span><span class="op" id="6820606">,</span>&nbsp;<span class="ident" id="6820608">laddr2</span><span class="op" id="6820614">:</span>&nbsp;<span class="string" id="6820616">&#34;0.0.0.0&#34;</span><span class="op" id="6820625">,</span>&nbsp;<span class="ident" id="6820627">wildcard</span><span class="op" id="6820635">:</span>&nbsp;<span class="builtintype" id="6820637">true</span><span class="op" id="6820641">,</span>&nbsp;<span class="ident" id="6820643">xerr</span><span class="op" id="6820647">:</span>&nbsp;<span class="ident" id="6820649">syscall</span><span class="op" id="6820656">.</span><span class="ident" id="6820657">EADDRINUSE</span><span class="op" id="6820667">}</span><span class="op" id="6820668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820671">{</span><span class="ident" id="6820672">net1</span><span class="op" id="6820676">:</span>&nbsp;<span class="string" id="6820678">&#34;tcp&#34;</span><span class="op" id="6820683">,</span>&nbsp;<span class="ident" id="6820685">laddr1</span><span class="op" id="6820691">:</span>&nbsp;<span class="string" id="6820693">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6820711">,</span>&nbsp;<span class="ident" id="6820713">net2</span><span class="op" id="6820717">:</span>&nbsp;<span class="string" id="6820719">&#34;tcp&#34;</span><span class="op" id="6820724">,</span>&nbsp;<span class="ident" id="6820726">laddr2</span><span class="op" id="6820732">:</span>&nbsp;<span class="string" id="6820734">&#34;[::]&#34;</span><span class="op" id="6820740">,</span>&nbsp;<span class="ident" id="6820742">wildcard</span><span class="op" id="6820750">:</span>&nbsp;<span class="builtintype" id="6820752">true</span><span class="op" id="6820756">,</span>&nbsp;<span class="ident" id="6820758">xerr</span><span class="op" id="6820762">:</span>&nbsp;<span class="ident" id="6820764">syscall</span><span class="op" id="6820771">.</span><span class="ident" id="6820772">EADDRINUSE</span><span class="op" id="6820782">}</span><span class="op" id="6820783">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820786">{</span><span class="ident" id="6820787">net1</span><span class="op" id="6820791">:</span>&nbsp;<span class="string" id="6820793">&#34;tcp&#34;</span><span class="op" id="6820798">,</span>&nbsp;<span class="ident" id="6820800">laddr1</span><span class="op" id="6820806">:</span>&nbsp;<span class="string" id="6820808">&#34;[::]&#34;</span><span class="op" id="6820814">,</span>&nbsp;<span class="ident" id="6820816">net2</span><span class="op" id="6820820">:</span>&nbsp;<span class="string" id="6820822">&#34;tcp&#34;</span><span class="op" id="6820827">,</span>&nbsp;<span class="ident" id="6820829">laddr2</span><span class="op" id="6820835">:</span>&nbsp;<span class="string" id="6820837">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6820855">,</span>&nbsp;<span class="ident" id="6820857">wildcard</span><span class="op" id="6820865">:</span>&nbsp;<span class="builtintype" id="6820867">true</span><span class="op" id="6820871">,</span>&nbsp;<span class="ident" id="6820873">xerr</span><span class="op" id="6820877">:</span>&nbsp;<span class="ident" id="6820879">syscall</span><span class="op" id="6820886">.</span><span class="ident" id="6820887">EADDRINUSE</span><span class="op" id="6820897">}</span><span class="op" id="6820898">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820902">{</span><span class="ident" id="6820903">net1</span><span class="op" id="6820907">:</span>&nbsp;<span class="string" id="6820909">&#34;tcp4&#34;</span><span class="op" id="6820915">,</span>&nbsp;<span class="ident" id="6820917">laddr1</span><span class="op" id="6820923">:</span>&nbsp;<span class="string" id="6820925">&#34;&#34;</span><span class="op" id="6820927">,</span>&nbsp;<span class="ident" id="6820929">net2</span><span class="op" id="6820933">:</span>&nbsp;<span class="string" id="6820935">&#34;tcp6&#34;</span><span class="op" id="6820941">,</span>&nbsp;<span class="ident" id="6820943">laddr2</span><span class="op" id="6820949">:</span>&nbsp;<span class="string" id="6820951">&#34;&#34;</span><span class="op" id="6820953">,</span>&nbsp;<span class="ident" id="6820955">wildcard</span><span class="op" id="6820963">:</span>&nbsp;<span class="builtintype" id="6820965">true</span><span class="op" id="6820969">}</span><span class="op" id="6820970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6820973">{</span><span class="ident" id="6820974">net1</span><span class="op" id="6820978">:</span>&nbsp;<span class="string" id="6820980">&#34;tcp6&#34;</span><span class="op" id="6820986">,</span>&nbsp;<span class="ident" id="6820988">laddr1</span><span class="op" id="6820994">:</span>&nbsp;<span class="string" id="6820996">&#34;&#34;</span><span class="op" id="6820998">,</span>&nbsp;<span class="ident" id="6821000">net2</span><span class="op" id="6821004">:</span>&nbsp;<span class="string" id="6821006">&#34;tcp4&#34;</span><span class="op" id="6821012">,</span>&nbsp;<span class="ident" id="6821014">laddr2</span><span class="op" id="6821020">:</span>&nbsp;<span class="string" id="6821022">&#34;&#34;</span><span class="op" id="6821024">,</span>&nbsp;<span class="ident" id="6821026">wildcard</span><span class="op" id="6821034">:</span>&nbsp;<span class="builtintype" id="6821036">true</span><span class="op" id="6821040">}</span><span class="op" id="6821041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821044">{</span><span class="ident" id="6821045">net1</span><span class="op" id="6821049">:</span>&nbsp;<span class="string" id="6821051">&#34;tcp4&#34;</span><span class="op" id="6821057">,</span>&nbsp;<span class="ident" id="6821059">laddr1</span><span class="op" id="6821065">:</span>&nbsp;<span class="string" id="6821067">&#34;0.0.0.0&#34;</span><span class="op" id="6821076">,</span>&nbsp;<span class="ident" id="6821078">net2</span><span class="op" id="6821082">:</span>&nbsp;<span class="string" id="6821084">&#34;tcp6&#34;</span><span class="op" id="6821090">,</span>&nbsp;<span class="ident" id="6821092">laddr2</span><span class="op" id="6821098">:</span>&nbsp;<span class="string" id="6821100">&#34;[::]&#34;</span><span class="op" id="6821106">,</span>&nbsp;<span class="ident" id="6821108">wildcard</span><span class="op" id="6821116">:</span>&nbsp;<span class="builtintype" id="6821118">true</span><span class="op" id="6821122">}</span><span class="op" id="6821123">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821126">{</span><span class="ident" id="6821127">net1</span><span class="op" id="6821131">:</span>&nbsp;<span class="string" id="6821133">&#34;tcp6&#34;</span><span class="op" id="6821139">,</span>&nbsp;<span class="ident" id="6821141">laddr1</span><span class="op" id="6821147">:</span>&nbsp;<span class="string" id="6821149">&#34;[::]&#34;</span><span class="op" id="6821155">,</span>&nbsp;<span class="ident" id="6821157">net2</span><span class="op" id="6821161">:</span>&nbsp;<span class="string" id="6821163">&#34;tcp4&#34;</span><span class="op" id="6821169">,</span>&nbsp;<span class="ident" id="6821171">laddr2</span><span class="op" id="6821177">:</span>&nbsp;<span class="string" id="6821179">&#34;0.0.0.0&#34;</span><span class="op" id="6821188">,</span>&nbsp;<span class="ident" id="6821190">wildcard</span><span class="op" id="6821198">:</span>&nbsp;<span class="builtintype" id="6821200">true</span><span class="op" id="6821204">}</span><span class="op" id="6821205">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821209">{</span><span class="ident" id="6821210">net1</span><span class="op" id="6821214">:</span>&nbsp;<span class="string" id="6821216">&#34;tcp&#34;</span><span class="op" id="6821221">,</span>&nbsp;<span class="ident" id="6821223">laddr1</span><span class="op" id="6821229">:</span>&nbsp;<span class="string" id="6821231">&#34;127.0.0.1&#34;</span><span class="op" id="6821242">,</span>&nbsp;<span class="ident" id="6821244">net2</span><span class="op" id="6821248">:</span>&nbsp;<span class="string" id="6821250">&#34;tcp&#34;</span><span class="op" id="6821255">,</span>&nbsp;<span class="ident" id="6821257">laddr2</span><span class="op" id="6821263">:</span>&nbsp;<span class="string" id="6821265">&#34;[::1]&#34;</span><span class="op" id="6821272">}</span><span class="op" id="6821273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821276">{</span><span class="ident" id="6821277">net1</span><span class="op" id="6821281">:</span>&nbsp;<span class="string" id="6821283">&#34;tcp&#34;</span><span class="op" id="6821288">,</span>&nbsp;<span class="ident" id="6821290">laddr1</span><span class="op" id="6821296">:</span>&nbsp;<span class="string" id="6821298">&#34;[::1]&#34;</span><span class="op" id="6821305">,</span>&nbsp;<span class="ident" id="6821307">net2</span><span class="op" id="6821311">:</span>&nbsp;<span class="string" id="6821313">&#34;tcp&#34;</span><span class="op" id="6821318">,</span>&nbsp;<span class="ident" id="6821320">laddr2</span><span class="op" id="6821326">:</span>&nbsp;<span class="string" id="6821328">&#34;127.0.0.1&#34;</span><span class="op" id="6821339">}</span><span class="op" id="6821340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821343">{</span><span class="ident" id="6821344">net1</span><span class="op" id="6821348">:</span>&nbsp;<span class="string" id="6821350">&#34;tcp4&#34;</span><span class="op" id="6821356">,</span>&nbsp;<span class="ident" id="6821358">laddr1</span><span class="op" id="6821364">:</span>&nbsp;<span class="string" id="6821366">&#34;127.0.0.1&#34;</span><span class="op" id="6821377">,</span>&nbsp;<span class="ident" id="6821379">net2</span><span class="op" id="6821383">:</span>&nbsp;<span class="string" id="6821385">&#34;tcp6&#34;</span><span class="op" id="6821391">,</span>&nbsp;<span class="ident" id="6821393">laddr2</span><span class="op" id="6821399">:</span>&nbsp;<span class="string" id="6821401">&#34;[::1]&#34;</span><span class="op" id="6821408">}</span><span class="op" id="6821409">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821412">{</span><span class="ident" id="6821413">net1</span><span class="op" id="6821417">:</span>&nbsp;<span class="string" id="6821419">&#34;tcp6&#34;</span><span class="op" id="6821425">,</span>&nbsp;<span class="ident" id="6821427">laddr1</span><span class="op" id="6821433">:</span>&nbsp;<span class="string" id="6821435">&#34;[::1]&#34;</span><span class="op" id="6821442">,</span>&nbsp;<span class="ident" id="6821444">net2</span><span class="op" id="6821448">:</span>&nbsp;<span class="string" id="6821450">&#34;tcp4&#34;</span><span class="op" id="6821456">,</span>&nbsp;<span class="ident" id="6821458">laddr2</span><span class="op" id="6821464">:</span>&nbsp;<span class="string" id="6821466">&#34;127.0.0.1&#34;</span><span class="op" id="6821477">}</span><span class="op" id="6821478">,</span><br>
<span class="lineno"></span><span class="op" id="6821480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6821483">//&nbsp;TestDualStackTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="6821547">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;different</span><br>
<span class="lineno">170</span><span class="comment" id="6821610">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="6821646">func</span>&nbsp;<span class="ident" id="6821651">TestDualStackTCPListener</span><span class="op" id="6821675">(</span><span class="ident" id="6821676">t</span>&nbsp;<span class="op" id="6821678">*</span><span class="ident" id="6821679">testing</span><span class="op" id="6821686">.</span><span class="ident" id="6821687">T</span><span class="op" id="6821688">)</span>&nbsp;<span class="op" id="6821690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821693">if</span>&nbsp;<span class="ident" id="6821696">testing</span><span class="op" id="6821703">.</span><span class="ident" id="6821704">Short</span><span class="op" id="6821709">(</span><span class="op" id="6821710">)</span>&nbsp;<span class="op" id="6821712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821716">t</span><span class="op" id="6821717">.</span><span class="ident" id="6821718">Skip</span><span class="op" id="6821722">(</span><span class="string" id="6821723">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="6821764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821767">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821770">switch</span>&nbsp;<span class="ident" id="6821777">runtime</span><span class="op" id="6821784">.</span><span class="ident" id="6821785">GOOS</span>&nbsp;<span class="op" id="6821790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821793">case</span>&nbsp;<span class="string" id="6821798">&#34;plan9&#34;</span><span class="op" id="6821805">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821809">t</span><span class="op" id="6821810">.</span><span class="ident" id="6821811">Skipf</span><span class="op" id="6821816">(</span><span class="string" id="6821817">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6821838">,</span>&nbsp;<span class="ident" id="6821840">runtime</span><span class="op" id="6821847">.</span><span class="ident" id="6821848">GOOS</span><span class="op" id="6821852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821858">if</span>&nbsp;<span class="op" id="6821861">!</span><span class="ident" id="6821862">supportsIPv6</span>&nbsp;<span class="op" id="6821875">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6821879">t</span><span class="op" id="6821880">.</span><span class="ident" id="6821881">Skip</span><span class="op" id="6821885">(</span><span class="string" id="6821886">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6821909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6821912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821916">for</span>&nbsp;<span class="ident" id="6821920">_</span><span class="op" id="6821921">,</span>&nbsp;<span class="ident" id="6821923">tt</span>&nbsp;<span class="op" id="6821926">:=</span>&nbsp;<span class="keyword" id="6821929">range</span>&nbsp;<span class="ident" id="6821935">dualStackListenerTests</span>&nbsp;<span class="op" id="6821958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6821962">if</span>&nbsp;<span class="ident" id="6821965">tt</span><span class="op" id="6821967">.</span><span class="ident" id="6821968">wildcard</span>&nbsp;<span class="op" id="6821977">&amp;&amp;</span>&nbsp;<span class="op" id="6821980">!</span><span class="op" id="6821981">*</span><span class="ident" id="6821982">testExternal</span>&nbsp;<span class="op" id="6821995">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822000">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822015">switch</span>&nbsp;<span class="ident" id="6822022">runtime</span><span class="op" id="6822029">.</span><span class="ident" id="6822030">GOOS</span>&nbsp;<span class="op" id="6822035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822039">case</span>&nbsp;<span class="string" id="6822044">&#34;openbsd&#34;</span><span class="op" id="6822053">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822058">if</span>&nbsp;<span class="ident" id="6822061">tt</span><span class="op" id="6822063">.</span><span class="ident" id="6822064">wildcard</span>&nbsp;<span class="op" id="6822073">&amp;&amp;</span>&nbsp;<span class="ident" id="6822076">differentWildcardAddr</span><span class="op" id="6822097">(</span><span class="ident" id="6822098">tt</span><span class="op" id="6822100">.</span><span class="ident" id="6822101">laddr1</span><span class="op" id="6822107">,</span>&nbsp;<span class="ident" id="6822109">tt</span><span class="op" id="6822111">.</span><span class="ident" id="6822112">laddr2</span><span class="op" id="6822118">)</span>&nbsp;<span class="op" id="6822120">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822126">tt</span><span class="op" id="6822128">.</span><span class="ident" id="6822129">xerr</span>&nbsp;<span class="op" id="6822134">=</span>&nbsp;<span class="builtintype" id="6822136">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822151">l1</span><span class="op" id="6822153">,</span>&nbsp;<span class="ident" id="6822155">port</span>&nbsp;<span class="op" id="6822160">:=</span>&nbsp;<span class="ident" id="6822163">usableListenPort</span><span class="op" id="6822179">(</span><span class="ident" id="6822180">t</span><span class="op" id="6822181">,</span>&nbsp;<span class="ident" id="6822183">tt</span><span class="op" id="6822185">.</span><span class="ident" id="6822186">net1</span><span class="op" id="6822190">,</span>&nbsp;<span class="ident" id="6822192">tt</span><span class="op" id="6822194">.</span><span class="ident" id="6822195">laddr1</span><span class="op" id="6822201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822205">laddr</span>&nbsp;<span class="op" id="6822211">:=</span>&nbsp;<span class="ident" id="6822214">tt</span><span class="op" id="6822216">.</span><span class="ident" id="6822217">laddr1</span>&nbsp;<span class="op" id="6822224">+</span>&nbsp;<span class="string" id="6822226">&#34;:&#34;</span>&nbsp;<span class="op" id="6822230">+</span>&nbsp;<span class="ident" id="6822232">port</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822239">checkFirstListener</span><span class="op" id="6822257">(</span><span class="ident" id="6822258">t</span><span class="op" id="6822259">,</span>&nbsp;<span class="ident" id="6822261">tt</span><span class="op" id="6822263">.</span><span class="ident" id="6822264">net1</span><span class="op" id="6822268">,</span>&nbsp;<span class="ident" id="6822270">laddr</span><span class="op" id="6822275">,</span>&nbsp;<span class="ident" id="6822277">l1</span><span class="op" id="6822279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822283">laddr</span>&nbsp;<span class="op" id="6822289">=</span>&nbsp;<span class="ident" id="6822291">tt</span><span class="op" id="6822293">.</span><span class="ident" id="6822294">laddr2</span>&nbsp;<span class="op" id="6822301">+</span>&nbsp;<span class="string" id="6822303">&#34;:&#34;</span>&nbsp;<span class="op" id="6822307">+</span>&nbsp;<span class="ident" id="6822309">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822316">l2</span><span class="op" id="6822318">,</span>&nbsp;<span class="ident" id="6822320">err</span>&nbsp;<span class="op" id="6822324">:=</span>&nbsp;<span class="ident" id="6822327">Listen</span><span class="op" id="6822333">(</span><span class="ident" id="6822334">tt</span><span class="op" id="6822336">.</span><span class="ident" id="6822337">net2</span><span class="op" id="6822341">,</span>&nbsp;<span class="ident" id="6822343">laddr</span><span class="op" id="6822348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822352">checkDualStackSecondListener</span><span class="op" id="6822380">(</span><span class="ident" id="6822381">t</span><span class="op" id="6822382">,</span>&nbsp;<span class="ident" id="6822384">tt</span><span class="op" id="6822386">.</span><span class="ident" id="6822387">net2</span><span class="op" id="6822391">,</span>&nbsp;<span class="ident" id="6822393">laddr</span><span class="op" id="6822398">,</span>&nbsp;<span class="ident" id="6822400">tt</span><span class="op" id="6822402">.</span><span class="ident" id="6822403">xerr</span><span class="op" id="6822407">,</span>&nbsp;<span class="ident" id="6822409">err</span><span class="op" id="6822412">,</span>&nbsp;<span class="ident" id="6822414">l2</span><span class="op" id="6822416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822420">l1</span><span class="op" id="6822422">.</span><span class="ident" id="6822423">Close</span><span class="op" id="6822428">(</span><span class="op" id="6822429">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822432">}</span><br>
<span class="lineno"></span><span class="op" id="6822434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6822437">//&nbsp;TestDualStackUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="6822501">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;differnet</span><br>
<span class="lineno">205</span><span class="comment" id="6822564">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="6822600">func</span>&nbsp;<span class="ident" id="6822605">TestDualStackUDPListener</span><span class="op" id="6822629">(</span><span class="ident" id="6822630">t</span>&nbsp;<span class="op" id="6822632">*</span><span class="ident" id="6822633">testing</span><span class="op" id="6822640">.</span><span class="ident" id="6822641">T</span><span class="op" id="6822642">)</span>&nbsp;<span class="op" id="6822644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822647">if</span>&nbsp;<span class="ident" id="6822650">testing</span><span class="op" id="6822657">.</span><span class="ident" id="6822658">Short</span><span class="op" id="6822663">(</span><span class="op" id="6822664">)</span>&nbsp;<span class="op" id="6822666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822670">t</span><span class="op" id="6822671">.</span><span class="ident" id="6822672">Skip</span><span class="op" id="6822676">(</span><span class="string" id="6822677">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="6822718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822721">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822724">switch</span>&nbsp;<span class="ident" id="6822731">runtime</span><span class="op" id="6822738">.</span><span class="ident" id="6822739">GOOS</span>&nbsp;<span class="op" id="6822744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822747">case</span>&nbsp;<span class="string" id="6822752">&#34;plan9&#34;</span><span class="op" id="6822759">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822763">t</span><span class="op" id="6822764">.</span><span class="ident" id="6822765">Skipf</span><span class="op" id="6822770">(</span><span class="string" id="6822771">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6822792">,</span>&nbsp;<span class="ident" id="6822794">runtime</span><span class="op" id="6822801">.</span><span class="ident" id="6822802">GOOS</span><span class="op" id="6822806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822812">if</span>&nbsp;<span class="op" id="6822815">!</span><span class="ident" id="6822816">supportsIPv6</span>&nbsp;<span class="op" id="6822829">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822833">t</span><span class="op" id="6822834">.</span><span class="ident" id="6822835">Skip</span><span class="op" id="6822839">(</span><span class="string" id="6822840">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="6822863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6822866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6822870">toudpnet</span>&nbsp;<span class="op" id="6822879">:=</span>&nbsp;<span class="keyword" id="6822882">func</span><span class="op" id="6822886">(</span><span class="ident" id="6822887">net</span>&nbsp;<span class="builtintype" id="6822891">string</span><span class="op" id="6822897">)</span>&nbsp;<span class="builtintype" id="6822899">string</span>&nbsp;<span class="op" id="6822906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822910">switch</span>&nbsp;<span class="ident" id="6822917">net</span>&nbsp;<span class="op" id="6822921">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822925">case</span>&nbsp;<span class="string" id="6822930">&#34;tcp&#34;</span><span class="op" id="6822935">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822940">return</span>&nbsp;<span class="string" id="6822947">&#34;udp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822955">case</span>&nbsp;<span class="string" id="6822960">&#34;tcp4&#34;</span><span class="op" id="6822966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822971">return</span>&nbsp;<span class="string" id="6822978">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6822987">case</span>&nbsp;<span class="string" id="6822992">&#34;tcp6&#34;</span><span class="op" id="6822998">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823003">return</span>&nbsp;<span class="string" id="6823010">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823023">return</span>&nbsp;<span class="string" id="6823030">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823043">for</span>&nbsp;<span class="ident" id="6823047">_</span><span class="op" id="6823048">,</span>&nbsp;<span class="ident" id="6823050">tt</span>&nbsp;<span class="op" id="6823053">:=</span>&nbsp;<span class="keyword" id="6823056">range</span>&nbsp;<span class="ident" id="6823062">dualStackListenerTests</span>&nbsp;<span class="op" id="6823085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823089">if</span>&nbsp;<span class="ident" id="6823092">tt</span><span class="op" id="6823094">.</span><span class="ident" id="6823095">wildcard</span>&nbsp;<span class="op" id="6823104">&amp;&amp;</span>&nbsp;<span class="op" id="6823107">(</span><span class="ident" id="6823108">testing</span><span class="op" id="6823115">.</span><span class="ident" id="6823116">Short</span><span class="op" id="6823121">(</span><span class="op" id="6823122">)</span>&nbsp;<span class="op" id="6823124">||</span>&nbsp;<span class="op" id="6823127">!</span><span class="op" id="6823128">*</span><span class="ident" id="6823129">testExternal</span><span class="op" id="6823141">)</span>&nbsp;<span class="op" id="6823143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823148">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823163">tt</span><span class="op" id="6823165">.</span><span class="ident" id="6823166">net1</span>&nbsp;<span class="op" id="6823171">=</span>&nbsp;<span class="ident" id="6823173">toudpnet</span><span class="op" id="6823181">(</span><span class="ident" id="6823182">tt</span><span class="op" id="6823184">.</span><span class="ident" id="6823185">net1</span><span class="op" id="6823189">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823193">tt</span><span class="op" id="6823195">.</span><span class="ident" id="6823196">net2</span>&nbsp;<span class="op" id="6823201">=</span>&nbsp;<span class="ident" id="6823203">toudpnet</span><span class="op" id="6823211">(</span><span class="ident" id="6823212">tt</span><span class="op" id="6823214">.</span><span class="ident" id="6823215">net2</span><span class="op" id="6823219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823223">switch</span>&nbsp;<span class="ident" id="6823230">runtime</span><span class="op" id="6823237">.</span><span class="ident" id="6823238">GOOS</span>&nbsp;<span class="op" id="6823243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823247">case</span>&nbsp;<span class="string" id="6823252">&#34;openbsd&#34;</span><span class="op" id="6823261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823266">if</span>&nbsp;<span class="ident" id="6823269">tt</span><span class="op" id="6823271">.</span><span class="ident" id="6823272">wildcard</span>&nbsp;<span class="op" id="6823281">&amp;&amp;</span>&nbsp;<span class="ident" id="6823284">differentWildcardAddr</span><span class="op" id="6823305">(</span><span class="ident" id="6823306">tt</span><span class="op" id="6823308">.</span><span class="ident" id="6823309">laddr1</span><span class="op" id="6823315">,</span>&nbsp;<span class="ident" id="6823317">tt</span><span class="op" id="6823319">.</span><span class="ident" id="6823320">laddr2</span><span class="op" id="6823326">)</span>&nbsp;<span class="op" id="6823328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823334">tt</span><span class="op" id="6823336">.</span><span class="ident" id="6823337">xerr</span>&nbsp;<span class="op" id="6823342">=</span>&nbsp;<span class="builtintype" id="6823344">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823359">l1</span><span class="op" id="6823361">,</span>&nbsp;<span class="ident" id="6823363">port</span>&nbsp;<span class="op" id="6823368">:=</span>&nbsp;<span class="ident" id="6823371">usableListenPacketPort</span><span class="op" id="6823393">(</span><span class="ident" id="6823394">t</span><span class="op" id="6823395">,</span>&nbsp;<span class="ident" id="6823397">tt</span><span class="op" id="6823399">.</span><span class="ident" id="6823400">net1</span><span class="op" id="6823404">,</span>&nbsp;<span class="ident" id="6823406">tt</span><span class="op" id="6823408">.</span><span class="ident" id="6823409">laddr1</span><span class="op" id="6823415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823419">laddr</span>&nbsp;<span class="op" id="6823425">:=</span>&nbsp;<span class="ident" id="6823428">tt</span><span class="op" id="6823430">.</span><span class="ident" id="6823431">laddr1</span>&nbsp;<span class="op" id="6823438">+</span>&nbsp;<span class="string" id="6823440">&#34;:&#34;</span>&nbsp;<span class="op" id="6823444">+</span>&nbsp;<span class="ident" id="6823446">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823453">checkFirstListener</span><span class="op" id="6823471">(</span><span class="ident" id="6823472">t</span><span class="op" id="6823473">,</span>&nbsp;<span class="ident" id="6823475">tt</span><span class="op" id="6823477">.</span><span class="ident" id="6823478">net1</span><span class="op" id="6823482">,</span>&nbsp;<span class="ident" id="6823484">laddr</span><span class="op" id="6823489">,</span>&nbsp;<span class="ident" id="6823491">l1</span><span class="op" id="6823493">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823497">laddr</span>&nbsp;<span class="op" id="6823503">=</span>&nbsp;<span class="ident" id="6823505">tt</span><span class="op" id="6823507">.</span><span class="ident" id="6823508">laddr2</span>&nbsp;<span class="op" id="6823515">+</span>&nbsp;<span class="string" id="6823517">&#34;:&#34;</span>&nbsp;<span class="op" id="6823521">+</span>&nbsp;<span class="ident" id="6823523">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823530">l2</span><span class="op" id="6823532">,</span>&nbsp;<span class="ident" id="6823534">err</span>&nbsp;<span class="op" id="6823538">:=</span>&nbsp;<span class="ident" id="6823541">ListenPacket</span><span class="op" id="6823553">(</span><span class="ident" id="6823554">tt</span><span class="op" id="6823556">.</span><span class="ident" id="6823557">net2</span><span class="op" id="6823561">,</span>&nbsp;<span class="ident" id="6823563">laddr</span><span class="op" id="6823568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823572">checkDualStackSecondListener</span><span class="op" id="6823600">(</span><span class="ident" id="6823601">t</span><span class="op" id="6823602">,</span>&nbsp;<span class="ident" id="6823604">tt</span><span class="op" id="6823606">.</span><span class="ident" id="6823607">net2</span><span class="op" id="6823611">,</span>&nbsp;<span class="ident" id="6823613">laddr</span><span class="op" id="6823618">,</span>&nbsp;<span class="ident" id="6823620">tt</span><span class="op" id="6823622">.</span><span class="ident" id="6823623">xerr</span><span class="op" id="6823627">,</span>&nbsp;<span class="ident" id="6823629">err</span><span class="op" id="6823632">,</span>&nbsp;<span class="ident" id="6823634">l2</span><span class="op" id="6823636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823640">l1</span><span class="op" id="6823642">.</span><span class="ident" id="6823643">Close</span><span class="op" id="6823648">(</span><span class="op" id="6823649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823652">}</span><br>
<span class="lineno">250</span><span class="op" id="6823654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6823657">func</span>&nbsp;<span class="ident" id="6823662">usableListenPort</span><span class="op" id="6823678">(</span><span class="ident" id="6823679">t</span>&nbsp;<span class="op" id="6823681">*</span><span class="ident" id="6823682">testing</span><span class="op" id="6823689">.</span><span class="ident" id="6823690">T</span><span class="op" id="6823691">,</span>&nbsp;<span class="ident" id="6823693">net</span><span class="op" id="6823696">,</span>&nbsp;<span class="ident" id="6823698">laddr</span>&nbsp;<span class="builtintype" id="6823704">string</span><span class="op" id="6823710">)</span>&nbsp;<span class="op" id="6823712">(</span><span class="ident" id="6823713">l</span>&nbsp;<span class="ident" id="6823715">Listener</span><span class="op" id="6823723">,</span>&nbsp;<span class="ident" id="6823725">port</span>&nbsp;<span class="builtintype" id="6823730">string</span><span class="op" id="6823736">)</span>&nbsp;<span class="op" id="6823738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823741">var</span>&nbsp;<span class="ident" id="6823745">nladdr</span>&nbsp;<span class="builtintype" id="6823752">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823760">var</span>&nbsp;<span class="ident" id="6823764">err</span>&nbsp;<span class="builtintype" id="6823768">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823775">switch</span>&nbsp;<span class="ident" id="6823782">net</span>&nbsp;<span class="op" id="6823786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823789">default</span><span class="op" id="6823796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6823800">panic</span><span class="op" id="6823805">(</span><span class="string" id="6823806">&#34;usableListenPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="6823830">+</span>&nbsp;<span class="ident" id="6823832">net</span><span class="op" id="6823835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823838">case</span>&nbsp;<span class="string" id="6823843">&#34;tcp&#34;</span><span class="op" id="6823848">,</span>&nbsp;<span class="string" id="6823850">&#34;tcp4&#34;</span><span class="op" id="6823856">,</span>&nbsp;<span class="string" id="6823858">&#34;tcp6&#34;</span><span class="op" id="6823864">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823868">l</span><span class="op" id="6823869">,</span>&nbsp;<span class="ident" id="6823871">err</span>&nbsp;<span class="op" id="6823875">=</span>&nbsp;<span class="ident" id="6823877">Listen</span><span class="op" id="6823883">(</span><span class="ident" id="6823884">net</span><span class="op" id="6823887">,</span>&nbsp;<span class="ident" id="6823889">laddr</span><span class="op" id="6823894">+</span><span class="string" id="6823895">&#34;:0&#34;</span><span class="op" id="6823899">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6823903">if</span>&nbsp;<span class="ident" id="6823906">err</span>&nbsp;<span class="op" id="6823910">!=</span>&nbsp;<span class="builtintype" id="6823913">nil</span>&nbsp;<span class="op" id="6823917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823922">t</span><span class="op" id="6823923">.</span><span class="ident" id="6823924">Fatalf</span><span class="op" id="6823930">(</span><span class="string" id="6823931">&#34;Probe&nbsp;Listen(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6823964">,</span>&nbsp;<span class="ident" id="6823966">net</span><span class="op" id="6823969">,</span>&nbsp;<span class="ident" id="6823971">laddr</span><span class="op" id="6823976">,</span>&nbsp;<span class="ident" id="6823978">err</span><span class="op" id="6823981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6823985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6823989">nladdr</span>&nbsp;<span class="op" id="6823996">=</span>&nbsp;<span class="ident" id="6823998">l</span><span class="op" id="6823999">.</span><span class="op" id="6824000">(</span><span class="op" id="6824001">*</span><span class="ident" id="6824002">TCPListener</span><span class="op" id="6824013">)</span><span class="op" id="6824014">.</span><span class="ident" id="6824015">Addr</span><span class="op" id="6824019">(</span><span class="op" id="6824020">)</span><span class="op" id="6824021">.</span><span class="ident" id="6824022">String</span><span class="op" id="6824028">(</span><span class="op" id="6824029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6824032">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6824035">_</span><span class="op" id="6824036">,</span>&nbsp;<span class="ident" id="6824038">port</span><span class="op" id="6824042">,</span>&nbsp;<span class="ident" id="6824044">err</span>&nbsp;<span class="op" id="6824048">=</span>&nbsp;<span class="ident" id="6824050">SplitHostPort</span><span class="op" id="6824063">(</span><span class="ident" id="6824064">nladdr</span><span class="op" id="6824070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6824073">if</span>&nbsp;<span class="ident" id="6824076">err</span>&nbsp;<span class="op" id="6824080">!=</span>&nbsp;<span class="builtintype" id="6824083">nil</span>&nbsp;<span class="op" id="6824087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6824091">t</span><span class="op" id="6824092">.</span><span class="ident" id="6824093">Fatalf</span><span class="op" id="6824099">(</span><span class="string" id="6824100">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6824126">,</span>&nbsp;<span class="ident" id="6824128">err</span><span class="op" id="6824131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6824134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6824137">return</span>&nbsp;<span class="ident" id="6824144">l</span><span class="op" id="6824145">,</span>&nbsp;<span class="ident" id="6824147">port</span><br>
<span class="lineno">270</span><span class="op" id="6824152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6824155">func</span>&nbsp;<span class="ident" id="6824160">usableListenPacketPort</span><span class="op" id="6824182">(</span><span class="ident" id="6824183">t</span>&nbsp;<span class="op" id="6824185">*</span><span class="ident" id="6824186">testing</span><span class="op" id="6824193">.</span><span class="ident" id="6824194">T</span><span class="op" id="6824195">,</span>&nbsp;<span class="ident" id="6824197">net</span><span class="op" id="6824200">,</span>&nbsp;<span class="ident" id="6824202">laddr</span>&nbsp;<span class="builtintype" id="6824208">string</span><span class="op" id="6824214">)</span>&nbsp;<span class="op" id="6824216">(</span><span class="ident" id="6824217">l</span>&nbsp;<span class="ident" id="6824219">PacketConn</span><span class="op" id="6824229">,</span>&nbsp;<span class="ident" id="6824231">port</span>&nbsp;<span class="builtintype" id="6824236">string</span><span class="op" id="6824242">)</span>&nbsp;<span class="op" id="6824244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6824247">var</span>&nbsp;<span class="ident" id="6824251">nladdr</span>&nbsp;<span class="builtintype" id="6824258">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6824266">var</span>&nbsp;<span class="ident" id="6824270">err</span>&nbsp;<span class="builtintype" id="6824274">error</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6824281">switch</span>&nbsp;<span class="ident" id="6824288">net</span>&nbsp;<span class="op" id="6824292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6824295">default</span><span class="op" id="6824302">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6824306">panic</span><span class="op" id="6824311">(</span><span class="string" id="6824312">&#34;usableListenPacketPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="6824342">+</span>&nbsp;<span class="ident" id="6824344">net</span><span class="op" id="6824347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6824350">case</span>&nbsp;<span class="string" id="6824355">&#34;udp&#34;</span><span class="op" id="6824360">,</span>&nbsp;<span class="string" id="6824362">&#34;udp4&#34;</span><span class="op" id="6824368">,</span>&nbsp;<span class="string" id="6824370">&#34;udp6&#34;</span><span class="op" id="6824376">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6824380">l</span><span class="op" id="6824381">,</span>&nbsp;<span class="ident" id="6824383">err</span>&nbsp;<span class="op" id="6824387">=</span>&nbsp;<span class="ident" id="6824389">ListenPacket</span><span class="op" id="6824401">(</span><span class="ident" id="6824402">net</span><span class="op" id="6824405">,</span>&nbsp;<span class="ident" id="6824407">laddr</span><span class="op" id="6824412">+</span><span class="string" id="6824413">&#34;:0&#34;</span><span class="op" id="6824417">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6824421">if</span>&nbsp;<span class="ident" id="6824424">err</span>&nbsp;<span class="op" id="6824428">!=</span>&nbsp;<span class="builtintype" id="6824431">nil</span>&nbsp;<span class="op" id="6824435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6824440">t</span><span class="op" id="6824441">.</span><span class="ident" id="6824442">Fatalf</span><span class="op" id="6824448">(</span><span class="string" id="6824449">&#34;Probe&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6824488">,</span>&nbsp;<span class="ident" id="6824490">net</span><span class="op" id="6824493">,</span>&nbsp;<span class="ident" id="6824495">laddr</span><span class="op" id="6824500">,</span>&nbsp;<span class="ident" id="6824502">err</span><span class="op" id="6824505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6824509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6824513">nladdr</span>&nbsp;<span class="op" id="6824520">=</span>&nbsp;<span class="ident" id="6824522">l</span><span class="op" id="6824523">.</span><span class="op" id="6824524">(</span><span class="op" id="6824525">*</span><span class="ident" id="6824526">UDPConn</span><span class="op" id="6824533">)</span><span class="op" id="6824534">.</span><span class="ident" id="6824535">LocalAddr</span><span class="op" id="6824544">(</span><span class="op" id="6824545">)</span><span class="op" id="6824546">.</span><span class="ident" id="6824547">String</span><span class="op" id="6824553">(</span><span class="op" id="6824554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6824557">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6824560">_</span><span class="op" id="6824561">,</span>&nbsp;<span class="ident" id="6824563">port</span><span class="op" id="6824567">,</span>&nbsp;<span class="ident" id="6824569">err</span>&nbsp;<span class="op" id="6824573">=</span>&nbsp;<span class="ident" id="6824575">SplitHostPort</span><span class="op" id="6824588">(</span><span class="ident" id="6824589">nladdr</span><span class="op" id="6824595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6824598">if</span>&nbsp;<span class="ident" id="6824601">err</span>&nbsp;<span class="op" id="6824605">!=</span>&nbsp;<span class="builtintype" id="6824608">nil</span>&nbsp;<span class="op" id="6824612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6824616">t</span><span class="op" id="6824617">.</span><span class="ident" id="6824618">Fatalf</span><span class="op" id="6824624">(</span><span class="string" id="6824625">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6824651">,</span>&nbsp;<span class="ident" id="6824653">err</span><span class="op" id="6824656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6824659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6824662">return</span>&nbsp;<span class="ident" id="6824669">l</span><span class="op" id="6824670">,</span>&nbsp;<span class="ident" id="6824672">port</span><br>
<span class="lineno">290</span><span class="op" id="6824677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6824680">func</span>&nbsp;<span class="ident" id="6824685">differentWildcardAddr</span><span class="op" id="6824706">(</span><span class="ident" id="6824707">i</span><span class="op" id="6824708">,</span>&nbsp;<span class="ident" id="6824710">j</span>&nbsp;<span class="builtintype" id="6824712">string</span><span class="op" id="6824718">)</span>&nbsp;<span class="builtintype" id="6824720">bool</span>&nbsp;<span class="op" id="6824725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6824728">if</span>&nbsp;<span class="op" id="6824731">(</span><span class="ident" id="6824732">i</span>&nbsp;<span class="op" id="6824734">==</span>&nbsp;<span class="string" id="6824737">&#34;&#34;</span>&nbsp;<span class="op" id="6824740">||</span>&nbsp;<span class="ident" id="6824743">i</span>&nbsp;<span class="op" id="6824745">==</span>&nbsp;<span class="string" id="6824748">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="6824758">||</span>&nbsp;<span class="ident" id="6824761">i</span>&nbsp;<span class="op" id="6824763">==</span>&nbsp;<span class="string" id="6824766">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="6824782">)</span>&nbsp;<span class="op" id="6824784">&amp;&amp;</span>&nbsp;<span class="op" id="6824787">(</span><span class="ident" id="6824788">j</span>&nbsp;<span class="op" id="6824790">==</span>&nbsp;<span class="string" id="6824793">&#34;&#34;</span>&nbsp;<span class="op" id="6824796">||</span>&nbsp;<span class="ident" id="6824799">j</span>&nbsp;<span class="op" id="6824801">==</span>&nbsp;<span class="string" id="6824804">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="6824814">||</span>&nbsp;<span class="ident" id="6824817">j</span>&nbsp;<span class="op" id="6824819">==</span>&nbsp;<span class="string" id="6824822">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="6824838">)</span>&nbsp;<span class="op" id="6824840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6824844">return</span>&nbsp;<span class="builtintype" id="6824851">false</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6824858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6824861">if</span>&nbsp;<span class="ident" id="6824864">i</span>&nbsp;<span class="op" id="6824866">==</span>&nbsp;<span class="string" id="6824869">&#34;[::]&#34;</span>&nbsp;<span class="op" id="6824876">&amp;&amp;</span>&nbsp;<span class="ident" id="6824879">j</span>&nbsp;<span class="op" id="6824881">==</span>&nbsp;<span class="string" id="6824884">&#34;[::]&#34;</span>&nbsp;<span class="op" id="6824891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6824895">return</span>&nbsp;<span class="builtintype" id="6824902">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6824909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6824912">return</span>&nbsp;<span class="builtintype" id="6824919">true</span><br>
<span class="lineno">300</span><span class="op" id="6824924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6824927">func</span>&nbsp;<span class="ident" id="6824932">checkFirstListener</span><span class="op" id="6824950">(</span><span class="ident" id="6824951">t</span>&nbsp;<span class="op" id="6824953">*</span><span class="ident" id="6824954">testing</span><span class="op" id="6824961">.</span><span class="ident" id="6824962">T</span><span class="op" id="6824963">,</span>&nbsp;<span class="ident" id="6824965">net</span><span class="op" id="6824968">,</span>&nbsp;<span class="ident" id="6824970">laddr</span>&nbsp;<span class="builtintype" id="6824976">string</span><span class="op" id="6824982">,</span>&nbsp;<span class="ident" id="6824984">l</span>&nbsp;<span class="keyword" id="6824986">interface</span><span class="op" id="6824995">{</span><span class="op" id="6824996">}</span><span class="op" id="6824997">)</span>&nbsp;<span class="op" id="6824999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6825002">switch</span>&nbsp;<span class="ident" id="6825009">net</span>&nbsp;<span class="op" id="6825013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6825016">case</span>&nbsp;<span class="string" id="6825021">&#34;tcp&#34;</span><span class="op" id="6825026">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6825030">fd</span>&nbsp;<span class="op" id="6825033">:=</span>&nbsp;<span class="ident" id="6825036">l</span><span class="op" id="6825037">.</span><span class="op" id="6825038">(</span><span class="op" id="6825039">*</span><span class="ident" id="6825040">TCPListener</span><span class="op" id="6825051">)</span><span class="op" id="6825052">.</span><span class="ident" id="6825053">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6825058">checkDualStackAddrFamily</span><span class="op" id="6825082">(</span><span class="ident" id="6825083">t</span><span class="op" id="6825084">,</span>&nbsp;<span class="ident" id="6825086">net</span><span class="op" id="6825089">,</span>&nbsp;<span class="ident" id="6825091">laddr</span><span class="op" id="6825096">,</span>&nbsp;<span class="ident" id="6825098">fd</span><span class="op" id="6825100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6825103">case</span>&nbsp;<span class="string" id="6825108">&#34;tcp4&#34;</span><span class="op" id="6825114">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6825118">fd</span>&nbsp;<span class="op" id="6825121">:=</span>&nbsp;<span class="ident" id="6825124">l</span><span class="op" id="6825125">.</span><span class="op" id="6825126">(</span><span class="op" id="6825127">*</span><span class="ident" id="6825128">TCPListener</span><span class="op" id="6825139">)</span><span class="op" id="6825140">.</span><span class="ident" id="6825141">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6825146">if</span>&nbsp;<span class="ident" id="6825149">fd</span><span class="op" id="6825151">.</span><span class="ident" id="6825152">family</span>&nbsp;<span class="op" id="6825159">!=</span>&nbsp;<span class="ident" id="6825162">syscall</span><span class="op" id="6825169">.</span><span class="ident" id="6825170">AF_INET</span>&nbsp;<span class="op" id="6825178">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6825183">t</span><span class="op" id="6825184">.</span><span class="ident" id="6825185">Fatalf</span><span class="op" id="6825191">(</span><span class="string" id="6825192">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6825253">,</span>&nbsp;<span class="ident" id="6825255">net</span><span class="op" id="6825258">,</span>&nbsp;<span class="ident" id="6825260">laddr</span><span class="op" id="6825265">,</span>&nbsp;<span class="ident" id="6825267">fd</span><span class="op" id="6825269">.</span><span class="ident" id="6825270">family</span><span class="op" id="6825276">,</span>&nbsp;<span class="ident" id="6825278">syscall</span><span class="op" id="6825285">.</span><span class="ident" id="6825286">AF_INET</span><span class="op" id="6825293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6825297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6825300">case</span>&nbsp;<span class="string" id="6825305">&#34;tcp6&#34;</span><span class="op" id="6825311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6825315">fd</span>&nbsp;<span class="op" id="6825318">:=</span>&nbsp;<span class="ident" id="6825321">l</span><span class="op" id="6825322">.</span><span class="op" id="6825323">(</span><span class="op" id="6825324">*</span><span class="ident" id="6825325">TCPListener</span><span class="op" id="6825336">)</span><span class="op" id="6825337">.</span><span class="ident" id="6825338">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6825343">if</span>&nbsp;<span class="ident" id="6825346">fd</span><span class="op" id="6825348">.</span><span class="ident" id="6825349">family</span>&nbsp;<span class="op" id="6825356">!=</span>&nbsp;<span class="ident" id="6825359">syscall</span><span class="op" id="6825366">.</span><span class="ident" id="6825367">AF_INET6</span>&nbsp;<span class="op" id="6825376">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6825381">t</span><span class="op" id="6825382">.</span><span class="ident" id="6825383">Fatalf</span><span class="op" id="6825389">(</span><span class="string" id="6825390">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6825451">,</span>&nbsp;<span class="ident" id="6825453">net</span><span class="op" id="6825456">,</span>&nbsp;<span class="ident" id="6825458">laddr</span><span class="op" id="6825463">,</span>&nbsp;<span class="ident" id="6825465">fd</span><span class="op" id="6825467">.</span><span class="ident" id="6825468">family</span><span class="op" id="6825474">,</span>&nbsp;<span class="ident" id="6825476">syscall</span><span class="op" id="6825483">.</span><span class="ident" id="6825484">AF_INET6</span><span class="op" id="6825492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6825496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6825499">case</span>&nbsp;<span class="string" id="6825504">&#34;udp&#34;</span><span class="op" id="6825509">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6825513">fd</span>&nbsp;<span class="op" id="6825516">:=</span>&nbsp;<span class="ident" id="6825519">l</span><span class="op" id="6825520">.</span><span class="op" id="6825521">(</span><span class="op" id="6825522">*</span><span class="ident" id="6825523">UDPConn</span><span class="op" id="6825530">)</span><span class="op" id="6825531">.</span><span class="ident" id="6825532">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6825537">checkDualStackAddrFamily</span><span class="op" id="6825561">(</span><span class="ident" id="6825562">t</span><span class="op" id="6825563">,</span>&nbsp;<span class="ident" id="6825565">net</span><span class="op" id="6825568">,</span>&nbsp;<span class="ident" id="6825570">laddr</span><span class="op" id="6825575">,</span>&nbsp;<span class="ident" id="6825577">fd</span><span class="op" id="6825579">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6825582">case</span>&nbsp;<span class="string" id="6825587">&#34;udp4&#34;</span><span class="op" id="6825593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6825597">fd</span>&nbsp;<span class="op" id="6825600">:=</span>&nbsp;<span class="ident" id="6825603">l</span><span class="op" id="6825604">.</span><span class="op" id="6825605">(</span><span class="op" id="6825606">*</span><span class="ident" id="6825607">UDPConn</span><span class="op" id="6825614">)</span><span class="op" id="6825615">.</span><span class="ident" id="6825616">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6825621">if</span>&nbsp;<span class="ident" id="6825624">fd</span><span class="op" id="6825626">.</span><span class="ident" id="6825627">family</span>&nbsp;<span class="op" id="6825634">!=</span>&nbsp;<span class="ident" id="6825637">syscall</span><span class="op" id="6825644">.</span><span class="ident" id="6825645">AF_INET</span>&nbsp;<span class="op" id="6825653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6825658">t</span><span class="op" id="6825659">.</span><span class="ident" id="6825660">Fatalf</span><span class="op" id="6825666">(</span><span class="string" id="6825667">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6825734">,</span>&nbsp;<span class="ident" id="6825736">net</span><span class="op" id="6825739">,</span>&nbsp;<span class="ident" id="6825741">laddr</span><span class="op" id="6825746">,</span>&nbsp;<span class="ident" id="6825748">fd</span><span class="op" id="6825750">.</span><span class="ident" id="6825751">family</span><span class="op" id="6825757">,</span>&nbsp;<span class="ident" id="6825759">syscall</span><span class="op" id="6825766">.</span><span class="ident" id="6825767">AF_INET</span><span class="op" id="6825774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6825778">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6825781">case</span>&nbsp;<span class="string" id="6825786">&#34;udp6&#34;</span><span class="op" id="6825792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6825796">fd</span>&nbsp;<span class="op" id="6825799">:=</span>&nbsp;<span class="ident" id="6825802">l</span><span class="op" id="6825803">.</span><span class="op" id="6825804">(</span><span class="op" id="6825805">*</span><span class="ident" id="6825806">UDPConn</span><span class="op" id="6825813">)</span><span class="op" id="6825814">.</span><span class="ident" id="6825815">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6825820">if</span>&nbsp;<span class="ident" id="6825823">fd</span><span class="op" id="6825825">.</span><span class="ident" id="6825826">family</span>&nbsp;<span class="op" id="6825833">!=</span>&nbsp;<span class="ident" id="6825836">syscall</span><span class="op" id="6825843">.</span><span class="ident" id="6825844">AF_INET6</span>&nbsp;<span class="op" id="6825853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6825858">t</span><span class="op" id="6825859">.</span><span class="ident" id="6825860">Fatalf</span><span class="op" id="6825866">(</span><span class="string" id="6825867">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6825934">,</span>&nbsp;<span class="ident" id="6825936">net</span><span class="op" id="6825939">,</span>&nbsp;<span class="ident" id="6825941">laddr</span><span class="op" id="6825946">,</span>&nbsp;<span class="ident" id="6825948">fd</span><span class="op" id="6825950">.</span><span class="ident" id="6825951">family</span><span class="op" id="6825957">,</span>&nbsp;<span class="ident" id="6825959">syscall</span><span class="op" id="6825966">.</span><span class="ident" id="6825967">AF_INET6</span><span class="op" id="6825975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6825979">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6825982">default</span><span class="op" id="6825989">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6825993">t</span><span class="op" id="6825994">.</span><span class="ident" id="6825995">Fatalf</span><span class="op" id="6826001">(</span><span class="string" id="6826002">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="6826026">,</span>&nbsp;<span class="ident" id="6826028">net</span><span class="op" id="6826031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6826034">}</span><br>
<span class="lineno"></span><span class="op" id="6826036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="6826039">func</span>&nbsp;<span class="ident" id="6826044">checkSecondListener</span><span class="op" id="6826063">(</span><span class="ident" id="6826064">t</span>&nbsp;<span class="op" id="6826066">*</span><span class="ident" id="6826067">testing</span><span class="op" id="6826074">.</span><span class="ident" id="6826075">T</span><span class="op" id="6826076">,</span>&nbsp;<span class="ident" id="6826078">net</span><span class="op" id="6826081">,</span>&nbsp;<span class="ident" id="6826083">laddr</span>&nbsp;<span class="builtintype" id="6826089">string</span><span class="op" id="6826095">,</span>&nbsp;<span class="ident" id="6826097">err</span>&nbsp;<span class="builtintype" id="6826101">error</span><span class="op" id="6826106">,</span>&nbsp;<span class="ident" id="6826108">l</span>&nbsp;<span class="keyword" id="6826110">interface</span><span class="op" id="6826119">{</span><span class="op" id="6826120">}</span><span class="op" id="6826121">)</span>&nbsp;<span class="op" id="6826123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6826126">switch</span>&nbsp;<span class="ident" id="6826133">net</span>&nbsp;<span class="op" id="6826137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6826140">case</span>&nbsp;<span class="string" id="6826145">&#34;tcp&#34;</span><span class="op" id="6826150">,</span>&nbsp;<span class="string" id="6826152">&#34;tcp4&#34;</span><span class="op" id="6826158">,</span>&nbsp;<span class="string" id="6826160">&#34;tcp6&#34;</span><span class="op" id="6826166">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6826170">if</span>&nbsp;<span class="ident" id="6826173">err</span>&nbsp;<span class="op" id="6826177">==</span>&nbsp;<span class="builtintype" id="6826180">nil</span>&nbsp;<span class="op" id="6826184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6826189">l</span><span class="op" id="6826190">.</span><span class="op" id="6826191">(</span><span class="op" id="6826192">*</span><span class="ident" id="6826193">TCPListener</span><span class="op" id="6826204">)</span><span class="op" id="6826205">.</span><span class="ident" id="6826206">Close</span><span class="op" id="6826211">(</span><span class="op" id="6826212">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6826217">t</span><span class="op" id="6826218">.</span><span class="ident" id="6826219">Fatalf</span><span class="op" id="6826225">(</span><span class="string" id="6826226">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6826261">,</span>&nbsp;<span class="ident" id="6826263">net</span><span class="op" id="6826266">,</span>&nbsp;<span class="ident" id="6826268">laddr</span><span class="op" id="6826273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6826277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6826280">case</span>&nbsp;<span class="string" id="6826285">&#34;udp&#34;</span><span class="op" id="6826290">,</span>&nbsp;<span class="string" id="6826292">&#34;udp4&#34;</span><span class="op" id="6826298">,</span>&nbsp;<span class="string" id="6826300">&#34;udp6&#34;</span><span class="op" id="6826306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6826310">if</span>&nbsp;<span class="ident" id="6826313">err</span>&nbsp;<span class="op" id="6826317">==</span>&nbsp;<span class="builtintype" id="6826320">nil</span>&nbsp;<span class="op" id="6826324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6826329">l</span><span class="op" id="6826330">.</span><span class="op" id="6826331">(</span><span class="op" id="6826332">*</span><span class="ident" id="6826333">UDPConn</span><span class="op" id="6826340">)</span><span class="op" id="6826341">.</span><span class="ident" id="6826342">Close</span><span class="op" id="6826347">(</span><span class="op" id="6826348">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6826353">t</span><span class="op" id="6826354">.</span><span class="ident" id="6826355">Fatalf</span><span class="op" id="6826361">(</span><span class="string" id="6826362">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6826403">,</span>&nbsp;<span class="ident" id="6826405">net</span><span class="op" id="6826408">,</span>&nbsp;<span class="ident" id="6826410">laddr</span><span class="op" id="6826415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6826419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6826422">default</span><span class="op" id="6826429">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6826433">t</span><span class="op" id="6826434">.</span><span class="ident" id="6826435">Fatalf</span><span class="op" id="6826441">(</span><span class="string" id="6826442">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="6826466">,</span>&nbsp;<span class="ident" id="6826468">net</span><span class="op" id="6826471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6826474">}</span><br>
<span class="lineno">350</span><span class="op" id="6826476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6826479">func</span>&nbsp;<span class="ident" id="6826484">checkDualStackSecondListener</span><span class="op" id="6826512">(</span><span class="ident" id="6826513">t</span>&nbsp;<span class="op" id="6826515">*</span><span class="ident" id="6826516">testing</span><span class="op" id="6826523">.</span><span class="ident" id="6826524">T</span><span class="op" id="6826525">,</span>&nbsp;<span class="ident" id="6826527">net</span><span class="op" id="6826530">,</span>&nbsp;<span class="ident" id="6826532">laddr</span>&nbsp;<span class="builtintype" id="6826538">string</span><span class="op" id="6826544">,</span>&nbsp;<span class="ident" id="6826546">xerr</span><span class="op" id="6826550">,</span>&nbsp;<span class="ident" id="6826552">err</span>&nbsp;<span class="builtintype" id="6826556">error</span><span class="op" id="6826561">,</span>&nbsp;<span class="ident" id="6826563">l</span>&nbsp;<span class="keyword" id="6826565">interface</span><span class="op" id="6826574">{</span><span class="op" id="6826575">}</span><span class="op" id="6826576">)</span>&nbsp;<span class="op" id="6826578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6826581">switch</span>&nbsp;<span class="ident" id="6826588">net</span>&nbsp;<span class="op" id="6826592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6826595">case</span>&nbsp;<span class="string" id="6826600">&#34;tcp&#34;</span><span class="op" id="6826605">,</span>&nbsp;<span class="string" id="6826607">&#34;tcp4&#34;</span><span class="op" id="6826613">,</span>&nbsp;<span class="string" id="6826615">&#34;tcp6&#34;</span><span class="op" id="6826621">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6826625">if</span>&nbsp;<span class="ident" id="6826628">xerr</span>&nbsp;<span class="op" id="6826633">==</span>&nbsp;<span class="builtintype" id="6826636">nil</span>&nbsp;<span class="op" id="6826640">&amp;&amp;</span>&nbsp;<span class="ident" id="6826643">err</span>&nbsp;<span class="op" id="6826647">!=</span>&nbsp;<span class="builtintype" id="6826650">nil</span>&nbsp;<span class="op" id="6826654">||</span>&nbsp;<span class="ident" id="6826657">xerr</span>&nbsp;<span class="op" id="6826662">!=</span>&nbsp;<span class="builtintype" id="6826665">nil</span>&nbsp;<span class="op" id="6826669">&amp;&amp;</span>&nbsp;<span class="ident" id="6826672">err</span>&nbsp;<span class="op" id="6826676">==</span>&nbsp;<span class="builtintype" id="6826679">nil</span>&nbsp;<span class="op" id="6826683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6826688">t</span><span class="op" id="6826689">.</span><span class="ident" id="6826690">Fatalf</span><span class="op" id="6826696">(</span><span class="string" id="6826697">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6826744">,</span>&nbsp;<span class="ident" id="6826746">net</span><span class="op" id="6826749">,</span>&nbsp;<span class="ident" id="6826751">laddr</span><span class="op" id="6826756">,</span>&nbsp;<span class="ident" id="6826758">err</span><span class="op" id="6826761">,</span>&nbsp;<span class="ident" id="6826763">xerr</span><span class="op" id="6826767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6826771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6826775">if</span>&nbsp;<span class="ident" id="6826778">err</span>&nbsp;<span class="op" id="6826782">==</span>&nbsp;<span class="builtintype" id="6826785">nil</span>&nbsp;<span class="op" id="6826789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6826794">l</span><span class="op" id="6826795">.</span><span class="op" id="6826796">(</span><span class="op" id="6826797">*</span><span class="ident" id="6826798">TCPListener</span><span class="op" id="6826809">)</span><span class="op" id="6826810">.</span><span class="ident" id="6826811">Close</span><span class="op" id="6826816">(</span><span class="op" id="6826817">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6826821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6826824">case</span>&nbsp;<span class="string" id="6826829">&#34;udp&#34;</span><span class="op" id="6826834">,</span>&nbsp;<span class="string" id="6826836">&#34;udp4&#34;</span><span class="op" id="6826842">,</span>&nbsp;<span class="string" id="6826844">&#34;udp6&#34;</span><span class="op" id="6826850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6826854">if</span>&nbsp;<span class="ident" id="6826857">xerr</span>&nbsp;<span class="op" id="6826862">==</span>&nbsp;<span class="builtintype" id="6826865">nil</span>&nbsp;<span class="op" id="6826869">&amp;&amp;</span>&nbsp;<span class="ident" id="6826872">err</span>&nbsp;<span class="op" id="6826876">!=</span>&nbsp;<span class="builtintype" id="6826879">nil</span>&nbsp;<span class="op" id="6826883">||</span>&nbsp;<span class="ident" id="6826886">xerr</span>&nbsp;<span class="op" id="6826891">!=</span>&nbsp;<span class="builtintype" id="6826894">nil</span>&nbsp;<span class="op" id="6826898">&amp;&amp;</span>&nbsp;<span class="ident" id="6826901">err</span>&nbsp;<span class="op" id="6826905">==</span>&nbsp;<span class="builtintype" id="6826908">nil</span>&nbsp;<span class="op" id="6826912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6826917">t</span><span class="op" id="6826918">.</span><span class="ident" id="6826919">Fatalf</span><span class="op" id="6826925">(</span><span class="string" id="6826926">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6826979">,</span>&nbsp;<span class="ident" id="6826981">net</span><span class="op" id="6826984">,</span>&nbsp;<span class="ident" id="6826986">laddr</span><span class="op" id="6826991">,</span>&nbsp;<span class="ident" id="6826993">err</span><span class="op" id="6826996">,</span>&nbsp;<span class="ident" id="6826998">xerr</span><span class="op" id="6827002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6827006">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6827010">if</span>&nbsp;<span class="ident" id="6827013">err</span>&nbsp;<span class="op" id="6827017">==</span>&nbsp;<span class="builtintype" id="6827020">nil</span>&nbsp;<span class="op" id="6827024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6827029">l</span><span class="op" id="6827030">.</span><span class="op" id="6827031">(</span><span class="op" id="6827032">*</span><span class="ident" id="6827033">UDPConn</span><span class="op" id="6827040">)</span><span class="op" id="6827041">.</span><span class="ident" id="6827042">Close</span><span class="op" id="6827047">(</span><span class="op" id="6827048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6827052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6827055">default</span><span class="op" id="6827062">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6827066">t</span><span class="op" id="6827067">.</span><span class="ident" id="6827068">Fatalf</span><span class="op" id="6827074">(</span><span class="string" id="6827075">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="6827099">,</span>&nbsp;<span class="ident" id="6827101">net</span><span class="op" id="6827104">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6827107">}</span><br>
<span class="lineno"></span><span class="op" id="6827109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6827112">func</span>&nbsp;<span class="ident" id="6827117">checkDualStackAddrFamily</span><span class="op" id="6827141">(</span><span class="ident" id="6827142">t</span>&nbsp;<span class="op" id="6827144">*</span><span class="ident" id="6827145">testing</span><span class="op" id="6827152">.</span><span class="ident" id="6827153">T</span><span class="op" id="6827154">,</span>&nbsp;<span class="ident" id="6827156">net</span><span class="op" id="6827159">,</span>&nbsp;<span class="ident" id="6827161">laddr</span>&nbsp;<span class="builtintype" id="6827167">string</span><span class="op" id="6827173">,</span>&nbsp;<span class="ident" id="6827175">fd</span>&nbsp;<span class="op" id="6827178">*</span><span class="ident" id="6827179">netFD</span><span class="op" id="6827184">)</span>&nbsp;<span class="op" id="6827186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6827189">switch</span>&nbsp;<span class="ident" id="6827196">a</span>&nbsp;<span class="op" id="6827198">:=</span>&nbsp;<span class="ident" id="6827201">fd</span><span class="op" id="6827203">.</span><span class="ident" id="6827204">laddr</span><span class="op" id="6827209">.</span><span class="op" id="6827210">(</span><span class="keyword" id="6827211">type</span><span class="op" id="6827215">)</span>&nbsp;<span class="op" id="6827217">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6827220">case</span>&nbsp;<span class="op" id="6827225">*</span><span class="ident" id="6827226">TCPAddr</span><span class="op" id="6827233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6827237">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6827293">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6827346">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6827403">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6827425">if</span>&nbsp;<span class="ident" id="6827428">supportsIPv4map</span>&nbsp;<span class="op" id="6827444">&amp;&amp;</span>&nbsp;<span class="ident" id="6827447">fd</span><span class="op" id="6827449">.</span><span class="ident" id="6827450">laddr</span><span class="op" id="6827455">.</span><span class="op" id="6827456">(</span><span class="op" id="6827457">*</span><span class="ident" id="6827458">TCPAddr</span><span class="op" id="6827465">)</span><span class="op" id="6827466">.</span><span class="ident" id="6827467">isWildcard</span><span class="op" id="6827477">(</span><span class="op" id="6827478">)</span>&nbsp;<span class="op" id="6827480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6827485">if</span>&nbsp;<span class="ident" id="6827488">fd</span><span class="op" id="6827490">.</span><span class="ident" id="6827491">family</span>&nbsp;<span class="op" id="6827498">!=</span>&nbsp;<span class="ident" id="6827501">syscall</span><span class="op" id="6827508">.</span><span class="ident" id="6827509">AF_INET6</span>&nbsp;<span class="op" id="6827518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6827524">t</span><span class="op" id="6827525">.</span><span class="ident" id="6827526">Fatalf</span><span class="op" id="6827532">(</span><span class="string" id="6827533">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6827588">,</span>&nbsp;<span class="ident" id="6827590">net</span><span class="op" id="6827593">,</span>&nbsp;<span class="ident" id="6827595">laddr</span><span class="op" id="6827600">,</span>&nbsp;<span class="ident" id="6827602">fd</span><span class="op" id="6827604">.</span><span class="ident" id="6827605">family</span><span class="op" id="6827611">,</span>&nbsp;<span class="ident" id="6827613">syscall</span><span class="op" id="6827620">.</span><span class="ident" id="6827621">AF_INET6</span><span class="op" id="6827629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6827634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6827638">}</span>&nbsp;<span class="keyword" id="6827640">else</span>&nbsp;<span class="op" id="6827645">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6827650">if</span>&nbsp;<span class="ident" id="6827653">fd</span><span class="op" id="6827655">.</span><span class="ident" id="6827656">family</span>&nbsp;<span class="op" id="6827663">!=</span>&nbsp;<span class="ident" id="6827666">a</span><span class="op" id="6827667">.</span><span class="ident" id="6827668">family</span><span class="op" id="6827674">(</span><span class="op" id="6827675">)</span>&nbsp;<span class="op" id="6827677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6827683">t</span><span class="op" id="6827684">.</span><span class="ident" id="6827685">Fatalf</span><span class="op" id="6827691">(</span><span class="string" id="6827692">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6827747">,</span>&nbsp;<span class="ident" id="6827749">net</span><span class="op" id="6827752">,</span>&nbsp;<span class="ident" id="6827754">laddr</span><span class="op" id="6827759">,</span>&nbsp;<span class="ident" id="6827761">fd</span><span class="op" id="6827763">.</span><span class="ident" id="6827764">family</span><span class="op" id="6827770">,</span>&nbsp;<span class="ident" id="6827772">a</span><span class="op" id="6827773">.</span><span class="ident" id="6827774">family</span><span class="op" id="6827780">(</span><span class="op" id="6827781">)</span><span class="op" id="6827782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6827787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6827791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6827794">case</span>&nbsp;<span class="op" id="6827799">*</span><span class="ident" id="6827800">UDPAddr</span><span class="op" id="6827807">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6827811">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6827867">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6827920">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6827977">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6827999">if</span>&nbsp;<span class="ident" id="6828002">supportsIPv4map</span>&nbsp;<span class="op" id="6828018">&amp;&amp;</span>&nbsp;<span class="ident" id="6828021">fd</span><span class="op" id="6828023">.</span><span class="ident" id="6828024">laddr</span><span class="op" id="6828029">.</span><span class="op" id="6828030">(</span><span class="op" id="6828031">*</span><span class="ident" id="6828032">UDPAddr</span><span class="op" id="6828039">)</span><span class="op" id="6828040">.</span><span class="ident" id="6828041">isWildcard</span><span class="op" id="6828051">(</span><span class="op" id="6828052">)</span>&nbsp;<span class="op" id="6828054">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6828059">if</span>&nbsp;<span class="ident" id="6828062">fd</span><span class="op" id="6828064">.</span><span class="ident" id="6828065">family</span>&nbsp;<span class="op" id="6828072">!=</span>&nbsp;<span class="ident" id="6828075">syscall</span><span class="op" id="6828082">.</span><span class="ident" id="6828083">AF_INET6</span>&nbsp;<span class="op" id="6828092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6828098">t</span><span class="op" id="6828099">.</span><span class="ident" id="6828100">Fatalf</span><span class="op" id="6828106">(</span><span class="string" id="6828107">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6828168">,</span>&nbsp;<span class="ident" id="6828170">net</span><span class="op" id="6828173">,</span>&nbsp;<span class="ident" id="6828175">laddr</span><span class="op" id="6828180">,</span>&nbsp;<span class="ident" id="6828182">fd</span><span class="op" id="6828184">.</span><span class="ident" id="6828185">family</span><span class="op" id="6828191">,</span>&nbsp;<span class="ident" id="6828193">syscall</span><span class="op" id="6828200">.</span><span class="ident" id="6828201">AF_INET6</span><span class="op" id="6828209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6828214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6828218">}</span>&nbsp;<span class="keyword" id="6828220">else</span>&nbsp;<span class="op" id="6828225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6828230">if</span>&nbsp;<span class="ident" id="6828233">fd</span><span class="op" id="6828235">.</span><span class="ident" id="6828236">family</span>&nbsp;<span class="op" id="6828243">!=</span>&nbsp;<span class="ident" id="6828246">a</span><span class="op" id="6828247">.</span><span class="ident" id="6828248">family</span><span class="op" id="6828254">(</span><span class="op" id="6828255">)</span>&nbsp;<span class="op" id="6828257">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6828263">t</span><span class="op" id="6828264">.</span><span class="ident" id="6828265">Fatalf</span><span class="op" id="6828271">(</span><span class="string" id="6828272">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="6828333">,</span>&nbsp;<span class="ident" id="6828335">net</span><span class="op" id="6828338">,</span>&nbsp;<span class="ident" id="6828340">laddr</span><span class="op" id="6828345">,</span>&nbsp;<span class="ident" id="6828347">fd</span><span class="op" id="6828349">.</span><span class="ident" id="6828350">family</span><span class="op" id="6828356">,</span>&nbsp;<span class="ident" id="6828358">a</span><span class="op" id="6828359">.</span><span class="ident" id="6828360">family</span><span class="op" id="6828366">(</span><span class="op" id="6828367">)</span><span class="op" id="6828368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6828373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6828377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6828380">default</span><span class="op" id="6828387">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6828391">t</span><span class="op" id="6828392">.</span><span class="ident" id="6828393">Fatalf</span><span class="op" id="6828399">(</span><span class="string" id="6828400">&#34;Unexpected&nbsp;protocol&nbsp;address&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="6828438">,</span>&nbsp;<span class="ident" id="6828440">a</span><span class="op" id="6828441">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6828444">}</span><br>
<span class="lineno"></span><span class="op" id="6828446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6828449">var</span>&nbsp;<span class="ident" id="6828453">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="6828480">=</span>&nbsp;<span class="op" id="6828482">[</span><span class="op" id="6828483">]</span><span class="keyword" id="6828484">struct</span>&nbsp;<span class="op" id="6828491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6828494">net</span>&nbsp;&nbsp;<span class="builtintype" id="6828499">string</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6828507">addr</span>&nbsp;<span class="builtintype" id="6828512">string</span><br>
<span class="lineno"></span><span class="op" id="6828519">}</span><span class="op" id="6828520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6828523">{</span><span class="string" id="6828524">&#34;tcp6&#34;</span><span class="op" id="6828530">,</span>&nbsp;<span class="string" id="6828532">&#34;127.0.0.1&#34;</span><span class="op" id="6828543">}</span><span class="op" id="6828544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6828547">{</span><span class="string" id="6828548">&#34;tcp6&#34;</span><span class="op" id="6828554">,</span>&nbsp;<span class="string" id="6828556">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6828576">}</span><span class="op" id="6828577">,</span><br>
<span class="lineno"></span><span class="op" id="6828579">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="6828582">func</span>&nbsp;<span class="ident" id="6828587">TestProhibitionaryDialArgs</span><span class="op" id="6828613">(</span><span class="ident" id="6828614">t</span>&nbsp;<span class="op" id="6828616">*</span><span class="ident" id="6828617">testing</span><span class="op" id="6828624">.</span><span class="ident" id="6828625">T</span><span class="op" id="6828626">)</span>&nbsp;<span class="op" id="6828628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6828631">switch</span>&nbsp;<span class="ident" id="6828638">runtime</span><span class="op" id="6828645">.</span><span class="ident" id="6828646">GOOS</span>&nbsp;<span class="op" id="6828651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6828654">case</span>&nbsp;<span class="string" id="6828659">&#34;plan9&#34;</span><span class="op" id="6828666">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6828670">t</span><span class="op" id="6828671">.</span><span class="ident" id="6828672">Skipf</span><span class="op" id="6828677">(</span><span class="string" id="6828678">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6828699">,</span>&nbsp;<span class="ident" id="6828701">runtime</span><span class="op" id="6828708">.</span><span class="ident" id="6828709">GOOS</span><span class="op" id="6828713">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6828716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6828719">//&nbsp;This&nbsp;test&nbsp;requires&nbsp;both&nbsp;IPv6&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6828789">if</span>&nbsp;<span class="op" id="6828792">!</span><span class="ident" id="6828793">supportsIPv4map</span>&nbsp;<span class="op" id="6828809">||</span>&nbsp;<span class="ident" id="6828812">testing</span><span class="op" id="6828819">.</span><span class="ident" id="6828820">Short</span><span class="op" id="6828825">(</span><span class="op" id="6828826">)</span>&nbsp;<span class="op" id="6828828">||</span>&nbsp;<span class="op" id="6828831">!</span><span class="op" id="6828832">*</span><span class="ident" id="6828833">testExternal</span>&nbsp;<span class="op" id="6828846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6828850">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6828858">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6828862">l</span><span class="op" id="6828863">,</span>&nbsp;<span class="ident" id="6828865">port</span>&nbsp;<span class="op" id="6828870">:=</span>&nbsp;<span class="ident" id="6828873">usableListenPort</span><span class="op" id="6828889">(</span><span class="ident" id="6828890">t</span><span class="op" id="6828891">,</span>&nbsp;<span class="string" id="6828893">&#34;tcp&#34;</span><span class="op" id="6828898">,</span>&nbsp;<span class="string" id="6828900">&#34;[::]&#34;</span><span class="op" id="6828906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6828909">defer</span>&nbsp;<span class="ident" id="6828915">l</span><span class="op" id="6828916">.</span><span class="ident" id="6828917">Close</span><span class="op" id="6828922">(</span><span class="op" id="6828923">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6828927">for</span>&nbsp;<span class="ident" id="6828931">_</span><span class="op" id="6828932">,</span>&nbsp;<span class="ident" id="6828934">tt</span>&nbsp;<span class="op" id="6828937">:=</span>&nbsp;<span class="keyword" id="6828940">range</span>&nbsp;<span class="ident" id="6828946">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="6828973">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6828977">c</span><span class="op" id="6828978">,</span>&nbsp;<span class="ident" id="6828980">err</span>&nbsp;<span class="op" id="6828984">:=</span>&nbsp;<span class="ident" id="6828987">Dial</span><span class="op" id="6828991">(</span><span class="ident" id="6828992">tt</span><span class="op" id="6828994">.</span><span class="ident" id="6828995">net</span><span class="op" id="6828998">,</span>&nbsp;<span class="ident" id="6829000">tt</span><span class="op" id="6829002">.</span><span class="ident" id="6829003">addr</span><span class="op" id="6829007">+</span><span class="string" id="6829008">&#34;:&#34;</span><span class="op" id="6829011">+</span><span class="ident" id="6829012">port</span><span class="op" id="6829016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6829020">if</span>&nbsp;<span class="ident" id="6829023">err</span>&nbsp;<span class="op" id="6829027">==</span>&nbsp;<span class="builtintype" id="6829030">nil</span>&nbsp;<span class="op" id="6829034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6829039">c</span><span class="op" id="6829040">.</span><span class="ident" id="6829041">Close</span><span class="op" id="6829046">(</span><span class="op" id="6829047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6829052">t</span><span class="op" id="6829053">.</span><span class="ident" id="6829054">Fatalf</span><span class="op" id="6829060">(</span><span class="string" id="6829061">&#34;Dial(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="6829087">,</span>&nbsp;<span class="ident" id="6829089">tt</span><span class="op" id="6829091">.</span><span class="ident" id="6829092">net</span><span class="op" id="6829095">,</span>&nbsp;<span class="ident" id="6829097">tt</span><span class="op" id="6829099">.</span><span class="ident" id="6829100">addr</span><span class="op" id="6829104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6829108">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6829111">}</span><br>
<span class="lineno"></span><span class="op" id="6829113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6829116">func</span>&nbsp;<span class="ident" id="6829121">TestWildWildcardListener</span><span class="op" id="6829145">(</span><span class="ident" id="6829146">t</span>&nbsp;<span class="op" id="6829148">*</span><span class="ident" id="6829149">testing</span><span class="op" id="6829156">.</span><span class="ident" id="6829157">T</span><span class="op" id="6829158">)</span>&nbsp;<span class="op" id="6829160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6829163">switch</span>&nbsp;<span class="ident" id="6829170">runtime</span><span class="op" id="6829177">.</span><span class="ident" id="6829178">GOOS</span>&nbsp;<span class="op" id="6829183">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6829186">case</span>&nbsp;<span class="string" id="6829191">&#34;plan9&#34;</span><span class="op" id="6829198">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6829202">t</span><span class="op" id="6829203">.</span><span class="ident" id="6829204">Skipf</span><span class="op" id="6829209">(</span><span class="string" id="6829210">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6829231">,</span>&nbsp;<span class="ident" id="6829233">runtime</span><span class="op" id="6829240">.</span><span class="ident" id="6829241">GOOS</span><span class="op" id="6829245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6829248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6829252">if</span>&nbsp;<span class="ident" id="6829255">testing</span><span class="op" id="6829262">.</span><span class="ident" id="6829263">Short</span><span class="op" id="6829268">(</span><span class="op" id="6829269">)</span>&nbsp;<span class="op" id="6829271">||</span>&nbsp;<span class="op" id="6829274">!</span><span class="op" id="6829275">*</span><span class="ident" id="6829276">testExternal</span>&nbsp;<span class="op" id="6829289">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6829293">t</span><span class="op" id="6829294">.</span><span class="ident" id="6829295">Skip</span><span class="op" id="6829299">(</span><span class="string" id="6829300">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6829341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6829344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6829348">defer</span>&nbsp;<span class="keyword" id="6829354">func</span><span class="op" id="6829358">(</span><span class="op" id="6829359">)</span>&nbsp;<span class="op" id="6829361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6829365">if</span>&nbsp;<span class="ident" id="6829368">p</span>&nbsp;<span class="op" id="6829370">:=</span>&nbsp;<span class="builtinfunc" id="6829373">recover</span><span class="op" id="6829380">(</span><span class="op" id="6829381">)</span><span class="op" id="6829382">;</span>&nbsp;<span class="ident" id="6829384">p</span>&nbsp;<span class="op" id="6829386">!=</span>&nbsp;<span class="builtintype" id="6829389">nil</span>&nbsp;<span class="op" id="6829393">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6829398">t</span><span class="op" id="6829399">.</span><span class="ident" id="6829400">Fatalf</span><span class="op" id="6829406">(</span><span class="string" id="6829407">&#34;Listen,&nbsp;ListenPacket&nbsp;or&nbsp;protocol-specific&nbsp;Listen&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="6829470">,</span>&nbsp;<span class="ident" id="6829472">p</span><span class="op" id="6829473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6829477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6829480">}</span><span class="op" id="6829481">(</span><span class="op" id="6829482">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6829486">if</span>&nbsp;<span class="ident" id="6829489">ln</span><span class="op" id="6829491">,</span>&nbsp;<span class="ident" id="6829493">err</span>&nbsp;<span class="op" id="6829497">:=</span>&nbsp;<span class="ident" id="6829500">Listen</span><span class="op" id="6829506">(</span><span class="string" id="6829507">&#34;tcp&#34;</span><span class="op" id="6829512">,</span>&nbsp;<span class="string" id="6829514">&#34;&#34;</span><span class="op" id="6829516">)</span><span class="op" id="6829517">;</span>&nbsp;<span class="ident" id="6829519">err</span>&nbsp;<span class="op" id="6829523">==</span>&nbsp;<span class="builtintype" id="6829526">nil</span>&nbsp;<span class="op" id="6829530">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6829534">ln</span><span class="op" id="6829536">.</span><span class="ident" id="6829537">Close</span><span class="op" id="6829542">(</span><span class="op" id="6829543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6829546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6829549">if</span>&nbsp;<span class="ident" id="6829552">ln</span><span class="op" id="6829554">,</span>&nbsp;<span class="ident" id="6829556">err</span>&nbsp;<span class="op" id="6829560">:=</span>&nbsp;<span class="ident" id="6829563">ListenPacket</span><span class="op" id="6829575">(</span><span class="string" id="6829576">&#34;udp&#34;</span><span class="op" id="6829581">,</span>&nbsp;<span class="string" id="6829583">&#34;&#34;</span><span class="op" id="6829585">)</span><span class="op" id="6829586">;</span>&nbsp;<span class="ident" id="6829588">err</span>&nbsp;<span class="op" id="6829592">==</span>&nbsp;<span class="builtintype" id="6829595">nil</span>&nbsp;<span class="op" id="6829599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6829603">ln</span><span class="op" id="6829605">.</span><span class="ident" id="6829606">Close</span><span class="op" id="6829611">(</span><span class="op" id="6829612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6829615">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6829618">if</span>&nbsp;<span class="ident" id="6829621">ln</span><span class="op" id="6829623">,</span>&nbsp;<span class="ident" id="6829625">err</span>&nbsp;<span class="op" id="6829629">:=</span>&nbsp;<span class="ident" id="6829632">ListenTCP</span><span class="op" id="6829641">(</span><span class="string" id="6829642">&#34;tcp&#34;</span><span class="op" id="6829647">,</span>&nbsp;<span class="builtintype" id="6829649">nil</span><span class="op" id="6829652">)</span><span class="op" id="6829653">;</span>&nbsp;<span class="ident" id="6829655">err</span>&nbsp;<span class="op" id="6829659">==</span>&nbsp;<span class="builtintype" id="6829662">nil</span>&nbsp;<span class="op" id="6829666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6829670">ln</span><span class="op" id="6829672">.</span><span class="ident" id="6829673">Close</span><span class="op" id="6829678">(</span><span class="op" id="6829679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6829682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6829685">if</span>&nbsp;<span class="ident" id="6829688">ln</span><span class="op" id="6829690">,</span>&nbsp;<span class="ident" id="6829692">err</span>&nbsp;<span class="op" id="6829696">:=</span>&nbsp;<span class="ident" id="6829699">ListenUDP</span><span class="op" id="6829708">(</span><span class="string" id="6829709">&#34;udp&#34;</span><span class="op" id="6829714">,</span>&nbsp;<span class="builtintype" id="6829716">nil</span><span class="op" id="6829719">)</span><span class="op" id="6829720">;</span>&nbsp;<span class="ident" id="6829722">err</span>&nbsp;<span class="op" id="6829726">==</span>&nbsp;<span class="builtintype" id="6829729">nil</span>&nbsp;<span class="op" id="6829733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6829737">ln</span><span class="op" id="6829739">.</span><span class="ident" id="6829740">Close</span><span class="op" id="6829745">(</span><span class="op" id="6829746">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6829749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6829752">if</span>&nbsp;<span class="ident" id="6829755">ln</span><span class="op" id="6829757">,</span>&nbsp;<span class="ident" id="6829759">err</span>&nbsp;<span class="op" id="6829763">:=</span>&nbsp;<span class="ident" id="6829766">ListenIP</span><span class="op" id="6829774">(</span><span class="string" id="6829775">&#34;ip:icmp&#34;</span><span class="op" id="6829784">,</span>&nbsp;<span class="builtintype" id="6829786">nil</span><span class="op" id="6829789">)</span><span class="op" id="6829790">;</span>&nbsp;<span class="ident" id="6829792">err</span>&nbsp;<span class="op" id="6829796">==</span>&nbsp;<span class="builtintype" id="6829799">nil</span>&nbsp;<span class="op" id="6829803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6829807">ln</span><span class="op" id="6829809">.</span><span class="ident" id="6829810">Close</span><span class="op" id="6829815">(</span><span class="op" id="6829816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6829819">}</span><br>
<span class="lineno"></span><span class="op" id="6829821">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
