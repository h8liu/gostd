<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/exec</h2>
<ul>
<li><a href="/gostd/os/exec/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/exec/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/os/exec/lp_test.go.html">lp_test.go</a></li>
<li><a href="/gostd/os/exec/lp_unix.go.html">lp_unix.go</a></li>
<li><a href="/gostd/os/exec/lp_unix_test.go.html" class="current">lp_unix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6667485">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6667541">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6667595">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6667646">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6667711">package</span>&nbsp;<span class="ident" id="6667719">exec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6667725">import</span>&nbsp;<span class="op" id="6667732">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6667735">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6667748">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6667754">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6667764">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6667767">func</span>&nbsp;<span class="ident" id="6667772">TestLookPathUnixEmptyPath</span><span class="op" id="6667797">(</span><span class="ident" id="6667798">t</span>&nbsp;<span class="op" id="6667800">*</span><span class="ident" id="6667801">testing</span><span class="op" id="6667808">.</span><span class="ident" id="6667809">T</span><span class="op" id="6667810">)</span>&nbsp;<span class="op" id="6667812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667815">tmp</span><span class="op" id="6667818">,</span>&nbsp;<span class="ident" id="6667820">err</span>&nbsp;<span class="op" id="6667824">:=</span>&nbsp;<span class="ident" id="6667827">ioutil</span><span class="op" id="6667833">.</span><span class="ident" id="6667834">TempDir</span><span class="op" id="6667841">(</span><span class="string" id="6667842">&#34;&#34;</span><span class="op" id="6667844">,</span>&nbsp;<span class="string" id="6667846">&#34;TestLookPathUnixEmptyPath&#34;</span><span class="op" id="6667873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667876">if</span>&nbsp;<span class="ident" id="6667879">err</span>&nbsp;<span class="op" id="6667883">!=</span>&nbsp;<span class="ident" id="6667886">nil</span>&nbsp;<span class="op" id="6667890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667894">t</span><span class="op" id="6667895">.</span><span class="ident" id="6667896">Fatal</span><span class="op" id="6667901">(</span><span class="string" id="6667902">&#34;TempDir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6667920">,</span>&nbsp;<span class="ident" id="6667922">err</span><span class="op" id="6667925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6667928">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667931">defer</span>&nbsp;<span class="ident" id="6667937">os</span><span class="op" id="6667939">.</span><span class="ident" id="6667940">RemoveAll</span><span class="op" id="6667949">(</span><span class="ident" id="6667950">tmp</span><span class="op" id="6667953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667956">wd</span><span class="op" id="6667958">,</span>&nbsp;<span class="ident" id="6667960">err</span>&nbsp;<span class="op" id="6667964">:=</span>&nbsp;<span class="ident" id="6667967">os</span><span class="op" id="6667969">.</span><span class="ident" id="6667970">Getwd</span><span class="op" id="6667975">(</span><span class="op" id="6667976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6667979">if</span>&nbsp;<span class="ident" id="6667982">err</span>&nbsp;<span class="op" id="6667986">!=</span>&nbsp;<span class="ident" id="6667989">nil</span>&nbsp;<span class="op" id="6667993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6667997">t</span><span class="op" id="6667998">.</span><span class="ident" id="6667999">Fatal</span><span class="op" id="6668004">(</span><span class="string" id="6668005">&#34;Getwd&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6668021">,</span>&nbsp;<span class="ident" id="6668023">err</span><span class="op" id="6668026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668029">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668032">err</span>&nbsp;<span class="op" id="6668036">=</span>&nbsp;<span class="ident" id="6668038">os</span><span class="op" id="6668040">.</span><span class="ident" id="6668041">Chdir</span><span class="op" id="6668046">(</span><span class="ident" id="6668047">tmp</span><span class="op" id="6668050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668053">if</span>&nbsp;<span class="ident" id="6668056">err</span>&nbsp;<span class="op" id="6668060">!=</span>&nbsp;<span class="ident" id="6668063">nil</span>&nbsp;<span class="op" id="6668067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668071">t</span><span class="op" id="6668072">.</span><span class="ident" id="6668073">Fatal</span><span class="op" id="6668078">(</span><span class="string" id="6668079">&#34;Chdir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6668095">,</span>&nbsp;<span class="ident" id="6668097">err</span><span class="op" id="6668100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668106">defer</span>&nbsp;<span class="ident" id="6668112">os</span><span class="op" id="6668114">.</span><span class="ident" id="6668115">Chdir</span><span class="op" id="6668120">(</span><span class="ident" id="6668121">wd</span><span class="op" id="6668123">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668127">f</span><span class="op" id="6668128">,</span>&nbsp;<span class="ident" id="6668130">err</span>&nbsp;<span class="op" id="6668134">:=</span>&nbsp;<span class="ident" id="6668137">os</span><span class="op" id="6668139">.</span><span class="ident" id="6668140">OpenFile</span><span class="op" id="6668148">(</span><span class="string" id="6668149">&#34;exec_me&#34;</span><span class="op" id="6668158">,</span>&nbsp;<span class="ident" id="6668160">os</span><span class="op" id="6668162">.</span><span class="ident" id="6668163">O_CREATE</span><span class="op" id="6668171">|</span><span class="ident" id="6668172">os</span><span class="op" id="6668174">.</span><span class="ident" id="6668175">O_EXCL</span><span class="op" id="6668181">,</span>&nbsp;<span class="num" id="6668183">0700</span><span class="op" id="6668187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668190">if</span>&nbsp;<span class="ident" id="6668193">err</span>&nbsp;<span class="op" id="6668197">!=</span>&nbsp;<span class="ident" id="6668200">nil</span>&nbsp;<span class="op" id="6668204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668208">t</span><span class="op" id="6668209">.</span><span class="ident" id="6668210">Fatal</span><span class="op" id="6668215">(</span><span class="string" id="6668216">&#34;OpenFile&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6668235">,</span>&nbsp;<span class="ident" id="6668237">err</span><span class="op" id="6668240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668243">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668246">err</span>&nbsp;<span class="op" id="6668250">=</span>&nbsp;<span class="ident" id="6668252">f</span><span class="op" id="6668253">.</span><span class="ident" id="6668254">Close</span><span class="op" id="6668259">(</span><span class="op" id="6668260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668263">if</span>&nbsp;<span class="ident" id="6668266">err</span>&nbsp;<span class="op" id="6668270">!=</span>&nbsp;<span class="ident" id="6668273">nil</span>&nbsp;<span class="op" id="6668277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668281">t</span><span class="op" id="6668282">.</span><span class="ident" id="6668283">Fatal</span><span class="op" id="6668288">(</span><span class="string" id="6668289">&#34;Close&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6668305">,</span>&nbsp;<span class="ident" id="6668307">err</span><span class="op" id="6668310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668317">pathenv</span>&nbsp;<span class="op" id="6668325">:=</span>&nbsp;<span class="ident" id="6668328">os</span><span class="op" id="6668330">.</span><span class="ident" id="6668331">Getenv</span><span class="op" id="6668337">(</span><span class="string" id="6668338">&#34;PATH&#34;</span><span class="op" id="6668344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668347">defer</span>&nbsp;<span class="ident" id="6668353">os</span><span class="op" id="6668355">.</span><span class="ident" id="6668356">Setenv</span><span class="op" id="6668362">(</span><span class="string" id="6668363">&#34;PATH&#34;</span><span class="op" id="6668369">,</span>&nbsp;<span class="ident" id="6668371">pathenv</span><span class="op" id="6668378">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668382">err</span>&nbsp;<span class="op" id="6668386">=</span>&nbsp;<span class="ident" id="6668388">os</span><span class="op" id="6668390">.</span><span class="ident" id="6668391">Setenv</span><span class="op" id="6668397">(</span><span class="string" id="6668398">&#34;PATH&#34;</span><span class="op" id="6668404">,</span>&nbsp;<span class="string" id="6668406">&#34;&#34;</span><span class="op" id="6668408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668411">if</span>&nbsp;<span class="ident" id="6668414">err</span>&nbsp;<span class="op" id="6668418">!=</span>&nbsp;<span class="ident" id="6668421">nil</span>&nbsp;<span class="op" id="6668425">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668429">t</span><span class="op" id="6668430">.</span><span class="ident" id="6668431">Fatal</span><span class="op" id="6668436">(</span><span class="string" id="6668437">&#34;Setenv&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6668454">,</span>&nbsp;<span class="ident" id="6668456">err</span><span class="op" id="6668459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668466">path</span><span class="op" id="6668470">,</span>&nbsp;<span class="ident" id="6668472">err</span>&nbsp;<span class="op" id="6668476">:=</span>&nbsp;<span class="ident" id="6668479">LookPath</span><span class="op" id="6668487">(</span><span class="string" id="6668488">&#34;exec_me&#34;</span><span class="op" id="6668497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668500">if</span>&nbsp;<span class="ident" id="6668503">err</span>&nbsp;<span class="op" id="6668507">==</span>&nbsp;<span class="ident" id="6668510">nil</span>&nbsp;<span class="op" id="6668514">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668518">t</span><span class="op" id="6668519">.</span><span class="ident" id="6668520">Fatal</span><span class="op" id="6668525">(</span><span class="string" id="6668526">&#34;LookPath&nbsp;found&nbsp;exec_me&nbsp;in&nbsp;empty&nbsp;$PATH&#34;</span><span class="op" id="6668565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6668571">if</span>&nbsp;<span class="ident" id="6668574">path</span>&nbsp;<span class="op" id="6668579">!=</span>&nbsp;<span class="string" id="6668582">&#34;&#34;</span>&nbsp;<span class="op" id="6668585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6668589">t</span><span class="op" id="6668590">.</span><span class="ident" id="6668591">Fatalf</span><span class="op" id="6668597">(</span><span class="string" id="6668598">&#34;LookPath&nbsp;path&nbsp;==&nbsp;%q&nbsp;when&nbsp;err&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="6668635">,</span>&nbsp;<span class="ident" id="6668637">path</span><span class="op" id="6668641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6668644">}</span><br>
<span class="lineno">55</span><span class="op" id="6668646">}</span>
</div>
</body>
</html>
