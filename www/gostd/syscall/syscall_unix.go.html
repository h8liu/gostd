<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2426301">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2426356">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2426410">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2426461">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2426526">package</span>&nbsp;<span class="ident" id="2426534">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2426543">import</span>&nbsp;<span class="op" id="2426550">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2426553">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2426564">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2426572">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2426581">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="2426584">var</span>&nbsp;<span class="op" id="2426588">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2426591">Stdin</span>&nbsp;&nbsp;<span class="op" id="2426598">=</span>&nbsp;<span class="num" id="2426600">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2426603">Stdout</span>&nbsp;<span class="op" id="2426610">=</span>&nbsp;<span class="num" id="2426612">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2426615">Stderr</span>&nbsp;<span class="op" id="2426622">=</span>&nbsp;<span class="num" id="2426624">2</span><br>
<span class="lineno"></span><span class="op" id="2426626">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2426629">const</span>&nbsp;<span class="op" id="2426635">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2426638">darwin64Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2426653">=</span>&nbsp;<span class="ident" id="2426655">runtime</span><span class="op" id="2426662">.</span><span class="ident" id="2426663">GOOS</span>&nbsp;<span class="op" id="2426668">==</span>&nbsp;<span class="string" id="2426671">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2426680">&amp;&amp;</span>&nbsp;<span class="ident" id="2426683">sizeofPtr</span>&nbsp;<span class="op" id="2426693">==</span>&nbsp;<span class="num" id="2426696">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2426699">dragonfly64Bit</span>&nbsp;<span class="op" id="2426714">=</span>&nbsp;<span class="ident" id="2426716">runtime</span><span class="op" id="2426723">.</span><span class="ident" id="2426724">GOOS</span>&nbsp;<span class="op" id="2426729">==</span>&nbsp;<span class="string" id="2426732">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="2426744">&amp;&amp;</span>&nbsp;<span class="ident" id="2426747">sizeofPtr</span>&nbsp;<span class="op" id="2426757">==</span>&nbsp;<span class="num" id="2426760">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2426763">netbsd32Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2426778">=</span>&nbsp;<span class="ident" id="2426780">runtime</span><span class="op" id="2426787">.</span><span class="ident" id="2426788">GOOS</span>&nbsp;<span class="op" id="2426793">==</span>&nbsp;<span class="string" id="2426796">&#34;netbsd&#34;</span>&nbsp;<span class="op" id="2426805">&amp;&amp;</span>&nbsp;<span class="ident" id="2426808">sizeofPtr</span>&nbsp;<span class="op" id="2426818">==</span>&nbsp;<span class="num" id="2426821">4</span><br>
<span class="lineno">25</span><span class="op" id="2426823">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2426826">func</span>&nbsp;<span class="ident" id="2426831">Syscall</span><span class="op" id="2426838">(</span><span class="ident" id="2426839">trap</span><span class="op" id="2426843">,</span>&nbsp;<span class="ident" id="2426845">a1</span><span class="op" id="2426847">,</span>&nbsp;<span class="ident" id="2426849">a2</span><span class="op" id="2426851">,</span>&nbsp;<span class="ident" id="2426853">a3</span>&nbsp;<span class="builtintype" id="2426856">uintptr</span><span class="op" id="2426863">)</span>&nbsp;<span class="op" id="2426865">(</span><span class="ident" id="2426866">r1</span><span class="op" id="2426868">,</span>&nbsp;<span class="ident" id="2426870">r2</span>&nbsp;<span class="builtintype" id="2426873">uintptr</span><span class="op" id="2426880">,</span>&nbsp;<span class="ident" id="2426882">err</span>&nbsp;<span class="ident" id="2426886">Errno</span><span class="op" id="2426891">)</span><br>
<span class="lineno"></span><span class="keyword" id="2426893">func</span>&nbsp;<span class="ident" id="2426898">Syscall6</span><span class="op" id="2426906">(</span><span class="ident" id="2426907">trap</span><span class="op" id="2426911">,</span>&nbsp;<span class="ident" id="2426913">a1</span><span class="op" id="2426915">,</span>&nbsp;<span class="ident" id="2426917">a2</span><span class="op" id="2426919">,</span>&nbsp;<span class="ident" id="2426921">a3</span><span class="op" id="2426923">,</span>&nbsp;<span class="ident" id="2426925">a4</span><span class="op" id="2426927">,</span>&nbsp;<span class="ident" id="2426929">a5</span><span class="op" id="2426931">,</span>&nbsp;<span class="ident" id="2426933">a6</span>&nbsp;<span class="builtintype" id="2426936">uintptr</span><span class="op" id="2426943">)</span>&nbsp;<span class="op" id="2426945">(</span><span class="ident" id="2426946">r1</span><span class="op" id="2426948">,</span>&nbsp;<span class="ident" id="2426950">r2</span>&nbsp;<span class="builtintype" id="2426953">uintptr</span><span class="op" id="2426960">,</span>&nbsp;<span class="ident" id="2426962">err</span>&nbsp;<span class="ident" id="2426966">Errno</span><span class="op" id="2426971">)</span><br>
<span class="lineno"></span><span class="keyword" id="2426973">func</span>&nbsp;<span class="ident" id="2426978">RawSyscall</span><span class="op" id="2426988">(</span><span class="ident" id="2426989">trap</span><span class="op" id="2426993">,</span>&nbsp;<span class="ident" id="2426995">a1</span><span class="op" id="2426997">,</span>&nbsp;<span class="ident" id="2426999">a2</span><span class="op" id="2427001">,</span>&nbsp;<span class="ident" id="2427003">a3</span>&nbsp;<span class="builtintype" id="2427006">uintptr</span><span class="op" id="2427013">)</span>&nbsp;<span class="op" id="2427015">(</span><span class="ident" id="2427016">r1</span><span class="op" id="2427018">,</span>&nbsp;<span class="ident" id="2427020">r2</span>&nbsp;<span class="builtintype" id="2427023">uintptr</span><span class="op" id="2427030">,</span>&nbsp;<span class="ident" id="2427032">err</span>&nbsp;<span class="ident" id="2427036">Errno</span><span class="op" id="2427041">)</span><br>
<span class="lineno">30</span><span class="keyword" id="2427043">func</span>&nbsp;<span class="ident" id="2427048">RawSyscall6</span><span class="op" id="2427059">(</span><span class="ident" id="2427060">trap</span><span class="op" id="2427064">,</span>&nbsp;<span class="ident" id="2427066">a1</span><span class="op" id="2427068">,</span>&nbsp;<span class="ident" id="2427070">a2</span><span class="op" id="2427072">,</span>&nbsp;<span class="ident" id="2427074">a3</span><span class="op" id="2427076">,</span>&nbsp;<span class="ident" id="2427078">a4</span><span class="op" id="2427080">,</span>&nbsp;<span class="ident" id="2427082">a5</span><span class="op" id="2427084">,</span>&nbsp;<span class="ident" id="2427086">a6</span>&nbsp;<span class="builtintype" id="2427089">uintptr</span><span class="op" id="2427096">)</span>&nbsp;<span class="op" id="2427098">(</span><span class="ident" id="2427099">r1</span><span class="op" id="2427101">,</span>&nbsp;<span class="ident" id="2427103">r2</span>&nbsp;<span class="builtintype" id="2427106">uintptr</span><span class="op" id="2427113">,</span>&nbsp;<span class="ident" id="2427115">err</span>&nbsp;<span class="ident" id="2427119">Errno</span><span class="op" id="2427124">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2427127">//&nbsp;Mmap&nbsp;manager,&nbsp;for&nbsp;use&nbsp;by&nbsp;operating&nbsp;system-specific&nbsp;implementations.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2427199">type</span>&nbsp;<span class="ident" id="2427204">mmapper</span>&nbsp;<span class="keyword" id="2427212">struct</span>&nbsp;<span class="op" id="2427219">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2427222">sync</span><span class="op" id="2427226">.</span><span class="ident" id="2427227">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2427234">active</span>&nbsp;<span class="keyword" id="2427241">map</span><span class="op" id="2427244">[</span><span class="op" id="2427245">*</span><span class="builtintype" id="2427246">byte</span><span class="op" id="2427250">]</span><span class="op" id="2427251">[</span><span class="op" id="2427252">]</span><span class="builtintype" id="2427253">byte</span>&nbsp;<span class="comment" id="2427258">//&nbsp;active&nbsp;mappings;&nbsp;key&nbsp;is&nbsp;last&nbsp;byte&nbsp;in&nbsp;mapping</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2427307">mmap</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="2427314">func</span><span class="op" id="2427318">(</span><span class="ident" id="2427319">addr</span><span class="op" id="2427323">,</span>&nbsp;<span class="ident" id="2427325">length</span>&nbsp;<span class="builtintype" id="2427332">uintptr</span><span class="op" id="2427339">,</span>&nbsp;<span class="ident" id="2427341">prot</span><span class="op" id="2427345">,</span>&nbsp;<span class="ident" id="2427347">flags</span><span class="op" id="2427352">,</span>&nbsp;<span class="ident" id="2427354">fd</span>&nbsp;<span class="builtintype" id="2427357">int</span><span class="op" id="2427360">,</span>&nbsp;<span class="ident" id="2427362">offset</span>&nbsp;<span class="ident" id="2427369">int64</span><span class="op" id="2427374">)</span>&nbsp;<span class="op" id="2427376">(</span><span class="builtintype" id="2427377">uintptr</span><span class="op" id="2427384">,</span>&nbsp;<span class="builtintype" id="2427386">error</span><span class="op" id="2427391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2427394">munmap</span>&nbsp;<span class="keyword" id="2427401">func</span><span class="op" id="2427405">(</span><span class="ident" id="2427406">addr</span>&nbsp;<span class="builtintype" id="2427411">uintptr</span><span class="op" id="2427418">,</span>&nbsp;<span class="ident" id="2427420">length</span>&nbsp;<span class="builtintype" id="2427427">uintptr</span><span class="op" id="2427434">)</span>&nbsp;<span class="builtintype" id="2427436">error</span><br>
<span class="lineno"></span><span class="op" id="2427442">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2427445">func</span>&nbsp;<span class="op" id="2427450">(</span><span class="ident" id="2427451">m</span>&nbsp;<span class="op" id="2427453">*</span><span class="ident" id="2427454">mmapper</span><span class="op" id="2427461">)</span>&nbsp;<span class="ident" id="2427463">Mmap</span><span class="op" id="2427467">(</span><span class="ident" id="2427468">fd</span>&nbsp;<span class="builtintype" id="2427471">int</span><span class="op" id="2427474">,</span>&nbsp;<span class="ident" id="2427476">offset</span>&nbsp;<span class="ident" id="2427483">int64</span><span class="op" id="2427488">,</span>&nbsp;<span class="ident" id="2427490">length</span>&nbsp;<span class="builtintype" id="2427497">int</span><span class="op" id="2427500">,</span>&nbsp;<span class="ident" id="2427502">prot</span>&nbsp;<span class="builtintype" id="2427507">int</span><span class="op" id="2427510">,</span>&nbsp;<span class="ident" id="2427512">flags</span>&nbsp;<span class="builtintype" id="2427518">int</span><span class="op" id="2427521">)</span>&nbsp;<span class="op" id="2427523">(</span><span class="ident" id="2427524">data</span>&nbsp;<span class="op" id="2427529">[</span><span class="op" id="2427530">]</span><span class="builtintype" id="2427531">byte</span><span class="op" id="2427535">,</span>&nbsp;<span class="ident" id="2427537">err</span>&nbsp;<span class="builtintype" id="2427541">error</span><span class="op" id="2427546">)</span>&nbsp;<span class="op" id="2427548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2427551">if</span>&nbsp;<span class="ident" id="2427554">length</span>&nbsp;<span class="op" id="2427561">&lt;=</span>&nbsp;<span class="num" id="2427564">0</span>&nbsp;<span class="op" id="2427566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2427570">return</span>&nbsp;<span class="ident" id="2427577">nil</span><span class="op" id="2427580">,</span>&nbsp;<span class="ident" id="2427582">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2427590">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2427594">//&nbsp;Map&nbsp;the&nbsp;requested&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2427624">addr</span><span class="op" id="2427628">,</span>&nbsp;<span class="ident" id="2427630">errno</span>&nbsp;<span class="op" id="2427636">:=</span>&nbsp;<span class="ident" id="2427639">m</span><span class="op" id="2427640">.</span><span class="ident" id="2427641">mmap</span><span class="op" id="2427645">(</span><span class="num" id="2427646">0</span><span class="op" id="2427647">,</span>&nbsp;<span class="builtintype" id="2427649">uintptr</span><span class="op" id="2427656">(</span><span class="ident" id="2427657">length</span><span class="op" id="2427663">)</span><span class="op" id="2427664">,</span>&nbsp;<span class="ident" id="2427666">prot</span><span class="op" id="2427670">,</span>&nbsp;<span class="ident" id="2427672">flags</span><span class="op" id="2427677">,</span>&nbsp;<span class="ident" id="2427679">fd</span><span class="op" id="2427681">,</span>&nbsp;<span class="ident" id="2427683">offset</span><span class="op" id="2427689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2427692">if</span>&nbsp;<span class="ident" id="2427695">errno</span>&nbsp;<span class="op" id="2427701">!=</span>&nbsp;<span class="ident" id="2427704">nil</span>&nbsp;<span class="op" id="2427708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2427712">return</span>&nbsp;<span class="ident" id="2427719">nil</span><span class="op" id="2427722">,</span>&nbsp;<span class="ident" id="2427724">errno</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2427731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2427735">//&nbsp;Slice&nbsp;memory&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2427759">var</span>&nbsp;<span class="ident" id="2427763">sl</span>&nbsp;<span class="op" id="2427766">=</span>&nbsp;<span class="keyword" id="2427768">struct</span>&nbsp;<span class="op" id="2427775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2427779">addr</span>&nbsp;<span class="builtintype" id="2427784">uintptr</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2427794">len</span>&nbsp;&nbsp;<span class="builtintype" id="2427799">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2427805">cap</span>&nbsp;&nbsp;<span class="builtintype" id="2427810">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2427815">}</span><span class="op" id="2427816">{</span><span class="ident" id="2427817">addr</span><span class="op" id="2427821">,</span>&nbsp;<span class="ident" id="2427823">length</span><span class="op" id="2427829">,</span>&nbsp;<span class="ident" id="2427831">length</span><span class="op" id="2427837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2427841">//&nbsp;Use&nbsp;unsafe&nbsp;to&nbsp;turn&nbsp;sl&nbsp;into&nbsp;a&nbsp;[]byte.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2427882">b</span>&nbsp;<span class="op" id="2427884">:=</span>&nbsp;<span class="op" id="2427887">*</span><span class="op" id="2427888">(</span><span class="op" id="2427889">*</span><span class="op" id="2427890">[</span><span class="op" id="2427891">]</span><span class="builtintype" id="2427892">byte</span><span class="op" id="2427896">)</span><span class="op" id="2427897">(</span><span class="ident" id="2427898">unsafe</span><span class="op" id="2427904">.</span><span class="ident" id="2427905">Pointer</span><span class="op" id="2427912">(</span><span class="op" id="2427913">&amp;</span><span class="ident" id="2427914">sl</span><span class="op" id="2427916">)</span><span class="op" id="2427917">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2427921">//&nbsp;Register&nbsp;mapping&nbsp;in&nbsp;m&nbsp;and&nbsp;return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2427962">p</span>&nbsp;<span class="op" id="2427964">:=</span>&nbsp;<span class="op" id="2427967">&amp;</span><span class="ident" id="2427968">b</span><span class="op" id="2427969">[</span><span class="builtinfunc" id="2427970">cap</span><span class="op" id="2427973">(</span><span class="ident" id="2427974">b</span><span class="op" id="2427975">)</span><span class="op" id="2427976">-</span><span class="num" id="2427977">1</span><span class="op" id="2427978">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2427981">m</span><span class="op" id="2427982">.</span><span class="ident" id="2427983">Lock</span><span class="op" id="2427987">(</span><span class="op" id="2427988">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2427991">defer</span>&nbsp;<span class="ident" id="2427997">m</span><span class="op" id="2427998">.</span><span class="ident" id="2427999">Unlock</span><span class="op" id="2428005">(</span><span class="op" id="2428006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428009">m</span><span class="op" id="2428010">.</span><span class="ident" id="2428011">active</span><span class="op" id="2428017">[</span><span class="ident" id="2428018">p</span><span class="op" id="2428019">]</span>&nbsp;<span class="op" id="2428021">=</span>&nbsp;<span class="ident" id="2428023">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428026">return</span>&nbsp;<span class="ident" id="2428033">b</span><span class="op" id="2428034">,</span>&nbsp;<span class="ident" id="2428036">nil</span><br>
<span class="lineno"></span><span class="op" id="2428040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="2428043">func</span>&nbsp;<span class="op" id="2428048">(</span><span class="ident" id="2428049">m</span>&nbsp;<span class="op" id="2428051">*</span><span class="ident" id="2428052">mmapper</span><span class="op" id="2428059">)</span>&nbsp;<span class="ident" id="2428061">Munmap</span><span class="op" id="2428067">(</span><span class="ident" id="2428068">data</span>&nbsp;<span class="op" id="2428073">[</span><span class="op" id="2428074">]</span><span class="builtintype" id="2428075">byte</span><span class="op" id="2428079">)</span>&nbsp;<span class="op" id="2428081">(</span><span class="ident" id="2428082">err</span>&nbsp;<span class="builtintype" id="2428086">error</span><span class="op" id="2428091">)</span>&nbsp;<span class="op" id="2428093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428096">if</span>&nbsp;<span class="builtinfunc" id="2428099">len</span><span class="op" id="2428102">(</span><span class="ident" id="2428103">data</span><span class="op" id="2428107">)</span>&nbsp;<span class="op" id="2428109">==</span>&nbsp;<span class="num" id="2428112">0</span>&nbsp;<span class="op" id="2428114">||</span>&nbsp;<span class="builtinfunc" id="2428117">len</span><span class="op" id="2428120">(</span><span class="ident" id="2428121">data</span><span class="op" id="2428125">)</span>&nbsp;<span class="op" id="2428127">!=</span>&nbsp;<span class="builtinfunc" id="2428130">cap</span><span class="op" id="2428133">(</span><span class="ident" id="2428134">data</span><span class="op" id="2428138">)</span>&nbsp;<span class="op" id="2428140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428144">return</span>&nbsp;<span class="ident" id="2428151">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2428163">//&nbsp;Find&nbsp;the&nbsp;base&nbsp;of&nbsp;the&nbsp;mapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428197">p</span>&nbsp;<span class="op" id="2428199">:=</span>&nbsp;<span class="op" id="2428202">&amp;</span><span class="ident" id="2428203">data</span><span class="op" id="2428207">[</span><span class="builtinfunc" id="2428208">cap</span><span class="op" id="2428211">(</span><span class="ident" id="2428212">data</span><span class="op" id="2428216">)</span><span class="op" id="2428217">-</span><span class="num" id="2428218">1</span><span class="op" id="2428219">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428222">m</span><span class="op" id="2428223">.</span><span class="ident" id="2428224">Lock</span><span class="op" id="2428228">(</span><span class="op" id="2428229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428232">defer</span>&nbsp;<span class="ident" id="2428238">m</span><span class="op" id="2428239">.</span><span class="ident" id="2428240">Unlock</span><span class="op" id="2428246">(</span><span class="op" id="2428247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428250">b</span>&nbsp;<span class="op" id="2428252">:=</span>&nbsp;<span class="ident" id="2428255">m</span><span class="op" id="2428256">.</span><span class="ident" id="2428257">active</span><span class="op" id="2428263">[</span><span class="ident" id="2428264">p</span><span class="op" id="2428265">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428268">if</span>&nbsp;<span class="ident" id="2428271">b</span>&nbsp;<span class="op" id="2428273">==</span>&nbsp;<span class="ident" id="2428276">nil</span>&nbsp;<span class="op" id="2428280">||</span>&nbsp;<span class="op" id="2428283">&amp;</span><span class="ident" id="2428284">b</span><span class="op" id="2428285">[</span><span class="num" id="2428286">0</span><span class="op" id="2428287">]</span>&nbsp;<span class="op" id="2428289">!=</span>&nbsp;<span class="op" id="2428292">&amp;</span><span class="ident" id="2428293">data</span><span class="op" id="2428297">[</span><span class="num" id="2428298">0</span><span class="op" id="2428299">]</span>&nbsp;<span class="op" id="2428301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428305">return</span>&nbsp;<span class="ident" id="2428312">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2428324">//&nbsp;Unmap&nbsp;the&nbsp;memory&nbsp;and&nbsp;update&nbsp;m.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428359">if</span>&nbsp;<span class="ident" id="2428362">errno</span>&nbsp;<span class="op" id="2428368">:=</span>&nbsp;<span class="ident" id="2428371">m</span><span class="op" id="2428372">.</span><span class="ident" id="2428373">munmap</span><span class="op" id="2428379">(</span><span class="builtintype" id="2428380">uintptr</span><span class="op" id="2428387">(</span><span class="ident" id="2428388">unsafe</span><span class="op" id="2428394">.</span><span class="ident" id="2428395">Pointer</span><span class="op" id="2428402">(</span><span class="op" id="2428403">&amp;</span><span class="ident" id="2428404">b</span><span class="op" id="2428405">[</span><span class="num" id="2428406">0</span><span class="op" id="2428407">]</span><span class="op" id="2428408">)</span><span class="op" id="2428409">)</span><span class="op" id="2428410">,</span>&nbsp;<span class="builtintype" id="2428412">uintptr</span><span class="op" id="2428419">(</span><span class="builtinfunc" id="2428420">len</span><span class="op" id="2428423">(</span><span class="ident" id="2428424">b</span><span class="op" id="2428425">)</span><span class="op" id="2428426">)</span><span class="op" id="2428427">)</span><span class="op" id="2428428">;</span>&nbsp;<span class="ident" id="2428430">errno</span>&nbsp;<span class="op" id="2428436">!=</span>&nbsp;<span class="ident" id="2428439">nil</span>&nbsp;<span class="op" id="2428443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428447">return</span>&nbsp;<span class="ident" id="2428454">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2428464">delete</span><span class="op" id="2428470">(</span><span class="ident" id="2428471">m</span><span class="op" id="2428472">.</span><span class="ident" id="2428473">active</span><span class="op" id="2428479">,</span>&nbsp;<span class="ident" id="2428481">p</span><span class="op" id="2428482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428485">return</span>&nbsp;<span class="ident" id="2428492">nil</span><br>
<span class="lineno">90</span><span class="op" id="2428496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2428499">//&nbsp;An&nbsp;Errno&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;number&nbsp;describing&nbsp;an&nbsp;error&nbsp;condition.</span><br>
<span class="lineno"></span><span class="comment" id="2428564">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;error&nbsp;interface.&nbsp;&nbsp;The&nbsp;zero&nbsp;Errno&nbsp;is&nbsp;by&nbsp;convention</span><br>
<span class="lineno"></span><span class="comment" id="2428635">//&nbsp;a&nbsp;non-error,&nbsp;so&nbsp;code&nbsp;to&nbsp;convert&nbsp;from&nbsp;Errno&nbsp;to&nbsp;error&nbsp;should&nbsp;use:</span><br>
<span class="lineno">95</span><span class="comment" id="2428702">//&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span><span class="comment" id="2428715">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;errno&nbsp;!=&nbsp;0&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="2428734">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;errno</span><br>
<span class="lineno"></span><span class="comment" id="2428750">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="keyword" id="2428755">type</span>&nbsp;<span class="ident" id="2428760">Errno</span>&nbsp;<span class="builtintype" id="2428766">uintptr</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2428775">func</span>&nbsp;<span class="op" id="2428780">(</span><span class="ident" id="2428781">e</span>&nbsp;<span class="ident" id="2428783">Errno</span><span class="op" id="2428788">)</span>&nbsp;<span class="ident" id="2428790">Error</span><span class="op" id="2428795">(</span><span class="op" id="2428796">)</span>&nbsp;<span class="builtintype" id="2428798">string</span>&nbsp;<span class="op" id="2428805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428808">if</span>&nbsp;<span class="num" id="2428811">0</span>&nbsp;<span class="op" id="2428813">&lt;=</span>&nbsp;<span class="builtintype" id="2428816">int</span><span class="op" id="2428819">(</span><span class="ident" id="2428820">e</span><span class="op" id="2428821">)</span>&nbsp;<span class="op" id="2428823">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2428826">int</span><span class="op" id="2428829">(</span><span class="ident" id="2428830">e</span><span class="op" id="2428831">)</span>&nbsp;<span class="op" id="2428833">&lt;</span>&nbsp;<span class="builtinfunc" id="2428835">len</span><span class="op" id="2428838">(</span><span class="ident" id="2428839">errors</span><span class="op" id="2428845">)</span>&nbsp;<span class="op" id="2428847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2428851">s</span>&nbsp;<span class="op" id="2428853">:=</span>&nbsp;<span class="ident" id="2428856">errors</span><span class="op" id="2428862">[</span><span class="ident" id="2428863">e</span><span class="op" id="2428864">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428868">if</span>&nbsp;<span class="ident" id="2428871">s</span>&nbsp;<span class="op" id="2428873">!=</span>&nbsp;<span class="string" id="2428876">&#34;&#34;</span>&nbsp;<span class="op" id="2428879">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428884">return</span>&nbsp;<span class="ident" id="2428891">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2428898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428901">return</span>&nbsp;<span class="string" id="2428908">&#34;errno&nbsp;&#34;</span>&nbsp;<span class="op" id="2428917">+</span>&nbsp;<span class="ident" id="2428919">itoa</span><span class="op" id="2428923">(</span><span class="builtintype" id="2428924">int</span><span class="op" id="2428927">(</span><span class="ident" id="2428928">e</span><span class="op" id="2428929">)</span><span class="op" id="2428930">)</span><br>
<span class="lineno"></span><span class="op" id="2428932">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="2428935">func</span>&nbsp;<span class="op" id="2428940">(</span><span class="ident" id="2428941">e</span>&nbsp;<span class="ident" id="2428943">Errno</span><span class="op" id="2428948">)</span>&nbsp;<span class="ident" id="2428950">Temporary</span><span class="op" id="2428959">(</span><span class="op" id="2428960">)</span>&nbsp;<span class="builtintype" id="2428962">bool</span>&nbsp;<span class="op" id="2428967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2428970">return</span>&nbsp;<span class="ident" id="2428977">e</span>&nbsp;<span class="op" id="2428979">==</span>&nbsp;<span class="ident" id="2428982">EINTR</span>&nbsp;<span class="op" id="2428988">||</span>&nbsp;<span class="ident" id="2428991">e</span>&nbsp;<span class="op" id="2428993">==</span>&nbsp;<span class="ident" id="2428996">EMFILE</span>&nbsp;<span class="op" id="2429003">||</span>&nbsp;<span class="ident" id="2429006">e</span>&nbsp;<span class="op" id="2429008">==</span>&nbsp;<span class="ident" id="2429011">ECONNRESET</span>&nbsp;<span class="op" id="2429022">||</span>&nbsp;<span class="ident" id="2429025">e</span>&nbsp;<span class="op" id="2429027">==</span>&nbsp;<span class="ident" id="2429030">ECONNABORTED</span>&nbsp;<span class="op" id="2429043">||</span>&nbsp;<span class="ident" id="2429046">e</span><span class="op" id="2429047">.</span><span class="ident" id="2429048">Timeout</span><span class="op" id="2429055">(</span><span class="op" id="2429056">)</span><br>
<span class="lineno"></span><span class="op" id="2429058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="2429061">func</span>&nbsp;<span class="op" id="2429066">(</span><span class="ident" id="2429067">e</span>&nbsp;<span class="ident" id="2429069">Errno</span><span class="op" id="2429074">)</span>&nbsp;<span class="ident" id="2429076">Timeout</span><span class="op" id="2429083">(</span><span class="op" id="2429084">)</span>&nbsp;<span class="builtintype" id="2429086">bool</span>&nbsp;<span class="op" id="2429091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429094">return</span>&nbsp;<span class="ident" id="2429101">e</span>&nbsp;<span class="op" id="2429103">==</span>&nbsp;<span class="ident" id="2429106">EAGAIN</span>&nbsp;<span class="op" id="2429113">||</span>&nbsp;<span class="ident" id="2429116">e</span>&nbsp;<span class="op" id="2429118">==</span>&nbsp;<span class="ident" id="2429121">EWOULDBLOCK</span>&nbsp;<span class="op" id="2429133">||</span>&nbsp;<span class="ident" id="2429136">e</span>&nbsp;<span class="op" id="2429138">==</span>&nbsp;<span class="ident" id="2429141">ETIMEDOUT</span><br>
<span class="lineno"></span><span class="op" id="2429151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2429154">//&nbsp;A&nbsp;Signal&nbsp;is&nbsp;a&nbsp;number&nbsp;describing&nbsp;a&nbsp;process&nbsp;signal.</span><br>
<span class="lineno">120</span><span class="comment" id="2429207">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;os.Signal&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="2429249">type</span>&nbsp;<span class="ident" id="2429254">Signal</span>&nbsp;<span class="builtintype" id="2429261">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2429266">func</span>&nbsp;<span class="op" id="2429271">(</span><span class="ident" id="2429272">s</span>&nbsp;<span class="ident" id="2429274">Signal</span><span class="op" id="2429280">)</span>&nbsp;<span class="ident" id="2429282">Signal</span><span class="op" id="2429288">(</span><span class="op" id="2429289">)</span>&nbsp;<span class="op" id="2429291">{</span><span class="op" id="2429292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2429295">func</span>&nbsp;<span class="op" id="2429300">(</span><span class="ident" id="2429301">s</span>&nbsp;<span class="ident" id="2429303">Signal</span><span class="op" id="2429309">)</span>&nbsp;<span class="ident" id="2429311">String</span><span class="op" id="2429317">(</span><span class="op" id="2429318">)</span>&nbsp;<span class="builtintype" id="2429320">string</span>&nbsp;<span class="op" id="2429327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429330">if</span>&nbsp;<span class="num" id="2429333">0</span>&nbsp;<span class="op" id="2429335">&lt;=</span>&nbsp;<span class="ident" id="2429338">s</span>&nbsp;<span class="op" id="2429340">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2429343">int</span><span class="op" id="2429346">(</span><span class="ident" id="2429347">s</span><span class="op" id="2429348">)</span>&nbsp;<span class="op" id="2429350">&lt;</span>&nbsp;<span class="builtinfunc" id="2429352">len</span><span class="op" id="2429355">(</span><span class="ident" id="2429356">signals</span><span class="op" id="2429363">)</span>&nbsp;<span class="op" id="2429365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429369">str</span>&nbsp;<span class="op" id="2429373">:=</span>&nbsp;<span class="ident" id="2429376">signals</span><span class="op" id="2429383">[</span><span class="ident" id="2429384">s</span><span class="op" id="2429385">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429389">if</span>&nbsp;<span class="ident" id="2429392">str</span>&nbsp;<span class="op" id="2429396">!=</span>&nbsp;<span class="string" id="2429399">&#34;&#34;</span>&nbsp;<span class="op" id="2429402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429407">return</span>&nbsp;<span class="ident" id="2429414">str</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2429420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2429423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429426">return</span>&nbsp;<span class="string" id="2429433">&#34;signal&nbsp;&#34;</span>&nbsp;<span class="op" id="2429443">+</span>&nbsp;<span class="ident" id="2429445">itoa</span><span class="op" id="2429449">(</span><span class="builtintype" id="2429450">int</span><span class="op" id="2429453">(</span><span class="ident" id="2429454">s</span><span class="op" id="2429455">)</span><span class="op" id="2429456">)</span><br>
<span class="lineno"></span><span class="op" id="2429458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="2429461">func</span>&nbsp;<span class="ident" id="2429466">Read</span><span class="op" id="2429470">(</span><span class="ident" id="2429471">fd</span>&nbsp;<span class="builtintype" id="2429474">int</span><span class="op" id="2429477">,</span>&nbsp;<span class="ident" id="2429479">p</span>&nbsp;<span class="op" id="2429481">[</span><span class="op" id="2429482">]</span><span class="builtintype" id="2429483">byte</span><span class="op" id="2429487">)</span>&nbsp;<span class="op" id="2429489">(</span><span class="ident" id="2429490">n</span>&nbsp;<span class="builtintype" id="2429492">int</span><span class="op" id="2429495">,</span>&nbsp;<span class="ident" id="2429497">err</span>&nbsp;<span class="builtintype" id="2429501">error</span><span class="op" id="2429506">)</span>&nbsp;<span class="op" id="2429508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429511">n</span><span class="op" id="2429512">,</span>&nbsp;<span class="ident" id="2429514">err</span>&nbsp;<span class="op" id="2429518">=</span>&nbsp;<span class="ident" id="2429520">read</span><span class="op" id="2429524">(</span><span class="ident" id="2429525">fd</span><span class="op" id="2429527">,</span>&nbsp;<span class="ident" id="2429529">p</span><span class="op" id="2429530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429533">if</span>&nbsp;<span class="ident" id="2429536">raceenabled</span>&nbsp;<span class="op" id="2429548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429552">if</span>&nbsp;<span class="ident" id="2429555">n</span>&nbsp;<span class="op" id="2429557">&gt;</span>&nbsp;<span class="num" id="2429559">0</span>&nbsp;<span class="op" id="2429561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429566">raceWriteRange</span><span class="op" id="2429580">(</span><span class="ident" id="2429581">unsafe</span><span class="op" id="2429587">.</span><span class="ident" id="2429588">Pointer</span><span class="op" id="2429595">(</span><span class="op" id="2429596">&amp;</span><span class="ident" id="2429597">p</span><span class="op" id="2429598">[</span><span class="num" id="2429599">0</span><span class="op" id="2429600">]</span><span class="op" id="2429601">)</span><span class="op" id="2429602">,</span>&nbsp;<span class="ident" id="2429604">n</span><span class="op" id="2429605">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2429609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429613">if</span>&nbsp;<span class="ident" id="2429616">err</span>&nbsp;<span class="op" id="2429620">==</span>&nbsp;<span class="ident" id="2429623">nil</span>&nbsp;<span class="op" id="2429627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429632">raceAcquire</span><span class="op" id="2429643">(</span><span class="ident" id="2429644">unsafe</span><span class="op" id="2429650">.</span><span class="ident" id="2429651">Pointer</span><span class="op" id="2429658">(</span><span class="op" id="2429659">&amp;</span><span class="ident" id="2429660">ioSync</span><span class="op" id="2429666">)</span><span class="op" id="2429667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2429671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2429674">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429677">return</span><br>
<span class="lineno"></span><span class="op" id="2429684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2429687">func</span>&nbsp;<span class="ident" id="2429692">Write</span><span class="op" id="2429697">(</span><span class="ident" id="2429698">fd</span>&nbsp;<span class="builtintype" id="2429701">int</span><span class="op" id="2429704">,</span>&nbsp;<span class="ident" id="2429706">p</span>&nbsp;<span class="op" id="2429708">[</span><span class="op" id="2429709">]</span><span class="builtintype" id="2429710">byte</span><span class="op" id="2429714">)</span>&nbsp;<span class="op" id="2429716">(</span><span class="ident" id="2429717">n</span>&nbsp;<span class="builtintype" id="2429719">int</span><span class="op" id="2429722">,</span>&nbsp;<span class="ident" id="2429724">err</span>&nbsp;<span class="builtintype" id="2429728">error</span><span class="op" id="2429733">)</span>&nbsp;<span class="op" id="2429735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429738">if</span>&nbsp;<span class="ident" id="2429741">raceenabled</span>&nbsp;<span class="op" id="2429753">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429757">raceReleaseMerge</span><span class="op" id="2429773">(</span><span class="ident" id="2429774">unsafe</span><span class="op" id="2429780">.</span><span class="ident" id="2429781">Pointer</span><span class="op" id="2429788">(</span><span class="op" id="2429789">&amp;</span><span class="ident" id="2429790">ioSync</span><span class="op" id="2429796">)</span><span class="op" id="2429797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2429800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429803">n</span><span class="op" id="2429804">,</span>&nbsp;<span class="ident" id="2429806">err</span>&nbsp;<span class="op" id="2429810">=</span>&nbsp;<span class="ident" id="2429812">write</span><span class="op" id="2429817">(</span><span class="ident" id="2429818">fd</span><span class="op" id="2429820">,</span>&nbsp;<span class="ident" id="2429822">p</span><span class="op" id="2429823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429826">if</span>&nbsp;<span class="ident" id="2429829">raceenabled</span>&nbsp;<span class="op" id="2429841">&amp;&amp;</span>&nbsp;<span class="ident" id="2429844">n</span>&nbsp;<span class="op" id="2429846">&gt;</span>&nbsp;<span class="num" id="2429848">0</span>&nbsp;<span class="op" id="2429850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2429854">raceReadRange</span><span class="op" id="2429867">(</span><span class="ident" id="2429868">unsafe</span><span class="op" id="2429874">.</span><span class="ident" id="2429875">Pointer</span><span class="op" id="2429882">(</span><span class="op" id="2429883">&amp;</span><span class="ident" id="2429884">p</span><span class="op" id="2429885">[</span><span class="num" id="2429886">0</span><span class="op" id="2429887">]</span><span class="op" id="2429888">)</span><span class="op" id="2429889">,</span>&nbsp;<span class="ident" id="2429891">n</span><span class="op" id="2429892">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2429895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2429898">return</span><br>
<span class="lineno"></span><span class="op" id="2429905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2429908">//&nbsp;For&nbsp;testing:&nbsp;clients&nbsp;can&nbsp;set&nbsp;this&nbsp;flag&nbsp;to&nbsp;force</span><br>
<span class="lineno">160</span><span class="comment" id="2429959">//&nbsp;creation&nbsp;of&nbsp;IPv6&nbsp;sockets&nbsp;to&nbsp;return&nbsp;EAFNOSUPPORT.</span><br>
<span class="lineno"></span><span class="keyword" id="2430011">var</span>&nbsp;<span class="ident" id="2430015">SocketDisableIPv6</span>&nbsp;<span class="builtintype" id="2430033">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2430039">type</span>&nbsp;<span class="ident" id="2430044">Sockaddr</span>&nbsp;<span class="keyword" id="2430053">interface</span>&nbsp;<span class="op" id="2430063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430066">sockaddr</span><span class="op" id="2430074">(</span><span class="op" id="2430075">)</span>&nbsp;<span class="op" id="2430077">(</span><span class="ident" id="2430078">ptr</span>&nbsp;<span class="ident" id="2430082">unsafe</span><span class="op" id="2430088">.</span><span class="ident" id="2430089">Pointer</span><span class="op" id="2430096">,</span>&nbsp;<span class="builtinfunc" id="2430098">len</span>&nbsp;<span class="ident" id="2430102">_Socklen</span><span class="op" id="2430110">,</span>&nbsp;<span class="ident" id="2430112">err</span>&nbsp;<span class="builtintype" id="2430116">error</span><span class="op" id="2430121">)</span>&nbsp;<span class="comment" id="2430123">//&nbsp;lowercase;&nbsp;only&nbsp;we&nbsp;can&nbsp;define&nbsp;Sockaddrs</span><br>
<span class="lineno">165</span><span class="op" id="2430166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2430169">type</span>&nbsp;<span class="ident" id="2430174">SockaddrInet4</span>&nbsp;<span class="keyword" id="2430188">struct</span>&nbsp;<span class="op" id="2430195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430198">Port</span>&nbsp;<span class="builtintype" id="2430203">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430208">Addr</span>&nbsp;<span class="op" id="2430213">[</span><span class="num" id="2430214">4</span><span class="op" id="2430215">]</span><span class="builtintype" id="2430216">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430222">raw</span>&nbsp;&nbsp;<span class="ident" id="2430227">RawSockaddrInet4</span><br>
<span class="lineno"></span><span class="op" id="2430244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2430247">type</span>&nbsp;<span class="ident" id="2430252">SockaddrInet6</span>&nbsp;<span class="keyword" id="2430266">struct</span>&nbsp;<span class="op" id="2430273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430276">Port</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2430283">int</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430288">ZoneId</span>&nbsp;<span class="builtintype" id="2430295">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430303">Addr</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2430310">[</span><span class="num" id="2430311">16</span><span class="op" id="2430313">]</span><span class="builtintype" id="2430314">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430320">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2430327">RawSockaddrInet6</span><br>
<span class="lineno"></span><span class="op" id="2430344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="2430347">type</span>&nbsp;<span class="ident" id="2430352">SockaddrUnix</span>&nbsp;<span class="keyword" id="2430365">struct</span>&nbsp;<span class="op" id="2430372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430375">Name</span>&nbsp;<span class="builtintype" id="2430380">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430388">raw</span>&nbsp;&nbsp;<span class="ident" id="2430393">RawSockaddrUnix</span><br>
<span class="lineno"></span><span class="op" id="2430409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="2430412">func</span>&nbsp;<span class="ident" id="2430417">Bind</span><span class="op" id="2430421">(</span><span class="ident" id="2430422">fd</span>&nbsp;<span class="builtintype" id="2430425">int</span><span class="op" id="2430428">,</span>&nbsp;<span class="ident" id="2430430">sa</span>&nbsp;<span class="ident" id="2430433">Sockaddr</span><span class="op" id="2430441">)</span>&nbsp;<span class="op" id="2430443">(</span><span class="ident" id="2430444">err</span>&nbsp;<span class="builtintype" id="2430448">error</span><span class="op" id="2430453">)</span>&nbsp;<span class="op" id="2430455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430458">ptr</span><span class="op" id="2430461">,</span>&nbsp;<span class="ident" id="2430463">n</span><span class="op" id="2430464">,</span>&nbsp;<span class="ident" id="2430466">err</span>&nbsp;<span class="op" id="2430470">:=</span>&nbsp;<span class="ident" id="2430473">sa</span><span class="op" id="2430475">.</span><span class="ident" id="2430476">sockaddr</span><span class="op" id="2430484">(</span><span class="op" id="2430485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430488">if</span>&nbsp;<span class="ident" id="2430491">err</span>&nbsp;<span class="op" id="2430495">!=</span>&nbsp;<span class="ident" id="2430498">nil</span>&nbsp;<span class="op" id="2430502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430506">return</span>&nbsp;<span class="ident" id="2430513">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2430518">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430521">return</span>&nbsp;<span class="ident" id="2430528">bind</span><span class="op" id="2430532">(</span><span class="ident" id="2430533">fd</span><span class="op" id="2430535">,</span>&nbsp;<span class="ident" id="2430537">ptr</span><span class="op" id="2430540">,</span>&nbsp;<span class="ident" id="2430542">n</span><span class="op" id="2430543">)</span><br>
<span class="lineno"></span><span class="op" id="2430545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2430548">func</span>&nbsp;<span class="ident" id="2430553">Connect</span><span class="op" id="2430560">(</span><span class="ident" id="2430561">fd</span>&nbsp;<span class="builtintype" id="2430564">int</span><span class="op" id="2430567">,</span>&nbsp;<span class="ident" id="2430569">sa</span>&nbsp;<span class="ident" id="2430572">Sockaddr</span><span class="op" id="2430580">)</span>&nbsp;<span class="op" id="2430582">(</span><span class="ident" id="2430583">err</span>&nbsp;<span class="builtintype" id="2430587">error</span><span class="op" id="2430592">)</span>&nbsp;<span class="op" id="2430594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430597">ptr</span><span class="op" id="2430600">,</span>&nbsp;<span class="ident" id="2430602">n</span><span class="op" id="2430603">,</span>&nbsp;<span class="ident" id="2430605">err</span>&nbsp;<span class="op" id="2430609">:=</span>&nbsp;<span class="ident" id="2430612">sa</span><span class="op" id="2430614">.</span><span class="ident" id="2430615">sockaddr</span><span class="op" id="2430623">(</span><span class="op" id="2430624">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430627">if</span>&nbsp;<span class="ident" id="2430630">err</span>&nbsp;<span class="op" id="2430634">!=</span>&nbsp;<span class="ident" id="2430637">nil</span>&nbsp;<span class="op" id="2430641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430645">return</span>&nbsp;<span class="ident" id="2430652">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2430657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430660">return</span>&nbsp;<span class="ident" id="2430667">connect</span><span class="op" id="2430674">(</span><span class="ident" id="2430675">fd</span><span class="op" id="2430677">,</span>&nbsp;<span class="ident" id="2430679">ptr</span><span class="op" id="2430682">,</span>&nbsp;<span class="ident" id="2430684">n</span><span class="op" id="2430685">)</span><br>
<span class="lineno"></span><span class="op" id="2430687">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="2430690">func</span>&nbsp;<span class="ident" id="2430695">Getpeername</span><span class="op" id="2430706">(</span><span class="ident" id="2430707">fd</span>&nbsp;<span class="builtintype" id="2430710">int</span><span class="op" id="2430713">)</span>&nbsp;<span class="op" id="2430715">(</span><span class="ident" id="2430716">sa</span>&nbsp;<span class="ident" id="2430719">Sockaddr</span><span class="op" id="2430727">,</span>&nbsp;<span class="ident" id="2430729">err</span>&nbsp;<span class="builtintype" id="2430733">error</span><span class="op" id="2430738">)</span>&nbsp;<span class="op" id="2430740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430743">var</span>&nbsp;<span class="ident" id="2430747">rsa</span>&nbsp;<span class="ident" id="2430751">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430767">var</span>&nbsp;<span class="builtinfunc" id="2430771">len</span>&nbsp;<span class="ident" id="2430775">_Socklen</span>&nbsp;<span class="op" id="2430784">=</span>&nbsp;<span class="ident" id="2430786">SizeofSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430805">if</span>&nbsp;<span class="ident" id="2430808">err</span>&nbsp;<span class="op" id="2430812">=</span>&nbsp;<span class="ident" id="2430814">getpeername</span><span class="op" id="2430825">(</span><span class="ident" id="2430826">fd</span><span class="op" id="2430828">,</span>&nbsp;<span class="op" id="2430830">&amp;</span><span class="ident" id="2430831">rsa</span><span class="op" id="2430834">,</span>&nbsp;<span class="op" id="2430836">&amp;</span><span class="builtinfunc" id="2430837">len</span><span class="op" id="2430840">)</span><span class="op" id="2430841">;</span>&nbsp;<span class="ident" id="2430843">err</span>&nbsp;<span class="op" id="2430847">!=</span>&nbsp;<span class="ident" id="2430850">nil</span>&nbsp;<span class="op" id="2430854">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430858">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2430866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430869">return</span>&nbsp;<span class="ident" id="2430876">anyToSockaddr</span><span class="op" id="2430889">(</span><span class="op" id="2430890">&amp;</span><span class="ident" id="2430891">rsa</span><span class="op" id="2430894">)</span><br>
<span class="lineno"></span><span class="op" id="2430896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2430899">func</span>&nbsp;<span class="ident" id="2430904">GetsockoptInt</span><span class="op" id="2430917">(</span><span class="ident" id="2430918">fd</span><span class="op" id="2430920">,</span>&nbsp;<span class="ident" id="2430922">level</span><span class="op" id="2430927">,</span>&nbsp;<span class="ident" id="2430929">opt</span>&nbsp;<span class="builtintype" id="2430933">int</span><span class="op" id="2430936">)</span>&nbsp;<span class="op" id="2430938">(</span><span class="ident" id="2430939">value</span>&nbsp;<span class="builtintype" id="2430945">int</span><span class="op" id="2430948">,</span>&nbsp;<span class="ident" id="2430950">err</span>&nbsp;<span class="builtintype" id="2430954">error</span><span class="op" id="2430959">)</span>&nbsp;<span class="op" id="2430961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2430964">var</span>&nbsp;<span class="ident" id="2430968">n</span>&nbsp;<span class="builtintype" id="2430970">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2430977">vallen</span>&nbsp;<span class="op" id="2430984">:=</span>&nbsp;<span class="ident" id="2430987">_Socklen</span><span class="op" id="2430995">(</span><span class="num" id="2430996">4</span><span class="op" id="2430997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2431000">err</span>&nbsp;<span class="op" id="2431004">=</span>&nbsp;<span class="ident" id="2431006">getsockopt</span><span class="op" id="2431016">(</span><span class="ident" id="2431017">fd</span><span class="op" id="2431019">,</span>&nbsp;<span class="ident" id="2431021">level</span><span class="op" id="2431026">,</span>&nbsp;<span class="ident" id="2431028">opt</span><span class="op" id="2431031">,</span>&nbsp;<span class="ident" id="2431033">unsafe</span><span class="op" id="2431039">.</span><span class="ident" id="2431040">Pointer</span><span class="op" id="2431047">(</span><span class="op" id="2431048">&amp;</span><span class="ident" id="2431049">n</span><span class="op" id="2431050">)</span><span class="op" id="2431051">,</span>&nbsp;<span class="op" id="2431053">&amp;</span><span class="ident" id="2431054">vallen</span><span class="op" id="2431060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431063">return</span>&nbsp;<span class="builtintype" id="2431070">int</span><span class="op" id="2431073">(</span><span class="ident" id="2431074">n</span><span class="op" id="2431075">)</span><span class="op" id="2431076">,</span>&nbsp;<span class="ident" id="2431078">err</span><br>
<span class="lineno">215</span><span class="op" id="2431082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2431085">func</span>&nbsp;<span class="ident" id="2431090">Recvfrom</span><span class="op" id="2431098">(</span><span class="ident" id="2431099">fd</span>&nbsp;<span class="builtintype" id="2431102">int</span><span class="op" id="2431105">,</span>&nbsp;<span class="ident" id="2431107">p</span>&nbsp;<span class="op" id="2431109">[</span><span class="op" id="2431110">]</span><span class="builtintype" id="2431111">byte</span><span class="op" id="2431115">,</span>&nbsp;<span class="ident" id="2431117">flags</span>&nbsp;<span class="builtintype" id="2431123">int</span><span class="op" id="2431126">)</span>&nbsp;<span class="op" id="2431128">(</span><span class="ident" id="2431129">n</span>&nbsp;<span class="builtintype" id="2431131">int</span><span class="op" id="2431134">,</span>&nbsp;<span class="ident" id="2431136">from</span>&nbsp;<span class="ident" id="2431141">Sockaddr</span><span class="op" id="2431149">,</span>&nbsp;<span class="ident" id="2431151">err</span>&nbsp;<span class="builtintype" id="2431155">error</span><span class="op" id="2431160">)</span>&nbsp;<span class="op" id="2431162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431165">var</span>&nbsp;<span class="ident" id="2431169">rsa</span>&nbsp;<span class="ident" id="2431173">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431189">var</span>&nbsp;<span class="builtinfunc" id="2431193">len</span>&nbsp;<span class="ident" id="2431197">_Socklen</span>&nbsp;<span class="op" id="2431206">=</span>&nbsp;<span class="ident" id="2431208">SizeofSockaddrAny</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431227">if</span>&nbsp;<span class="ident" id="2431230">n</span><span class="op" id="2431231">,</span>&nbsp;<span class="ident" id="2431233">err</span>&nbsp;<span class="op" id="2431237">=</span>&nbsp;<span class="ident" id="2431239">recvfrom</span><span class="op" id="2431247">(</span><span class="ident" id="2431248">fd</span><span class="op" id="2431250">,</span>&nbsp;<span class="ident" id="2431252">p</span><span class="op" id="2431253">,</span>&nbsp;<span class="ident" id="2431255">flags</span><span class="op" id="2431260">,</span>&nbsp;<span class="op" id="2431262">&amp;</span><span class="ident" id="2431263">rsa</span><span class="op" id="2431266">,</span>&nbsp;<span class="op" id="2431268">&amp;</span><span class="builtinfunc" id="2431269">len</span><span class="op" id="2431272">)</span><span class="op" id="2431273">;</span>&nbsp;<span class="ident" id="2431275">err</span>&nbsp;<span class="op" id="2431279">!=</span>&nbsp;<span class="ident" id="2431282">nil</span>&nbsp;<span class="op" id="2431286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431290">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2431298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431301">if</span>&nbsp;<span class="ident" id="2431304">rsa</span><span class="op" id="2431307">.</span><span class="ident" id="2431308">Addr</span><span class="op" id="2431312">.</span><span class="ident" id="2431313">Family</span>&nbsp;<span class="op" id="2431320">!=</span>&nbsp;<span class="ident" id="2431323">AF_UNSPEC</span>&nbsp;<span class="op" id="2431333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2431337">from</span><span class="op" id="2431341">,</span>&nbsp;<span class="ident" id="2431343">err</span>&nbsp;<span class="op" id="2431347">=</span>&nbsp;<span class="ident" id="2431349">anyToSockaddr</span><span class="op" id="2431362">(</span><span class="op" id="2431363">&amp;</span><span class="ident" id="2431364">rsa</span><span class="op" id="2431367">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2431370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431373">return</span><br>
<span class="lineno"></span><span class="op" id="2431380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2431383">func</span>&nbsp;<span class="ident" id="2431388">Sendto</span><span class="op" id="2431394">(</span><span class="ident" id="2431395">fd</span>&nbsp;<span class="builtintype" id="2431398">int</span><span class="op" id="2431401">,</span>&nbsp;<span class="ident" id="2431403">p</span>&nbsp;<span class="op" id="2431405">[</span><span class="op" id="2431406">]</span><span class="builtintype" id="2431407">byte</span><span class="op" id="2431411">,</span>&nbsp;<span class="ident" id="2431413">flags</span>&nbsp;<span class="builtintype" id="2431419">int</span><span class="op" id="2431422">,</span>&nbsp;<span class="ident" id="2431424">to</span>&nbsp;<span class="ident" id="2431427">Sockaddr</span><span class="op" id="2431435">)</span>&nbsp;<span class="op" id="2431437">(</span><span class="ident" id="2431438">err</span>&nbsp;<span class="builtintype" id="2431442">error</span><span class="op" id="2431447">)</span>&nbsp;<span class="op" id="2431449">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2431452">ptr</span><span class="op" id="2431455">,</span>&nbsp;<span class="ident" id="2431457">n</span><span class="op" id="2431458">,</span>&nbsp;<span class="ident" id="2431460">err</span>&nbsp;<span class="op" id="2431464">:=</span>&nbsp;<span class="ident" id="2431467">to</span><span class="op" id="2431469">.</span><span class="ident" id="2431470">sockaddr</span><span class="op" id="2431478">(</span><span class="op" id="2431479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431482">if</span>&nbsp;<span class="ident" id="2431485">err</span>&nbsp;<span class="op" id="2431489">!=</span>&nbsp;<span class="ident" id="2431492">nil</span>&nbsp;<span class="op" id="2431496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431500">return</span>&nbsp;<span class="ident" id="2431507">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2431512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431515">return</span>&nbsp;<span class="ident" id="2431522">sendto</span><span class="op" id="2431528">(</span><span class="ident" id="2431529">fd</span><span class="op" id="2431531">,</span>&nbsp;<span class="ident" id="2431533">p</span><span class="op" id="2431534">,</span>&nbsp;<span class="ident" id="2431536">flags</span><span class="op" id="2431541">,</span>&nbsp;<span class="ident" id="2431543">ptr</span><span class="op" id="2431546">,</span>&nbsp;<span class="ident" id="2431548">n</span><span class="op" id="2431549">)</span><br>
<span class="lineno">235</span><span class="op" id="2431551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2431554">func</span>&nbsp;<span class="ident" id="2431559">SetsockoptByte</span><span class="op" id="2431573">(</span><span class="ident" id="2431574">fd</span><span class="op" id="2431576">,</span>&nbsp;<span class="ident" id="2431578">level</span><span class="op" id="2431583">,</span>&nbsp;<span class="ident" id="2431585">opt</span>&nbsp;<span class="builtintype" id="2431589">int</span><span class="op" id="2431592">,</span>&nbsp;<span class="ident" id="2431594">value</span>&nbsp;<span class="builtintype" id="2431600">byte</span><span class="op" id="2431604">)</span>&nbsp;<span class="op" id="2431606">(</span><span class="ident" id="2431607">err</span>&nbsp;<span class="builtintype" id="2431611">error</span><span class="op" id="2431616">)</span>&nbsp;<span class="op" id="2431618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431621">return</span>&nbsp;<span class="ident" id="2431628">setsockopt</span><span class="op" id="2431638">(</span><span class="ident" id="2431639">fd</span><span class="op" id="2431641">,</span>&nbsp;<span class="ident" id="2431643">level</span><span class="op" id="2431648">,</span>&nbsp;<span class="ident" id="2431650">opt</span><span class="op" id="2431653">,</span>&nbsp;<span class="ident" id="2431655">unsafe</span><span class="op" id="2431661">.</span><span class="ident" id="2431662">Pointer</span><span class="op" id="2431669">(</span><span class="op" id="2431670">&amp;</span><span class="ident" id="2431671">value</span><span class="op" id="2431676">)</span><span class="op" id="2431677">,</span>&nbsp;<span class="num" id="2431679">1</span><span class="op" id="2431680">)</span><br>
<span class="lineno"></span><span class="op" id="2431682">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="2431685">func</span>&nbsp;<span class="ident" id="2431690">SetsockoptInt</span><span class="op" id="2431703">(</span><span class="ident" id="2431704">fd</span><span class="op" id="2431706">,</span>&nbsp;<span class="ident" id="2431708">level</span><span class="op" id="2431713">,</span>&nbsp;<span class="ident" id="2431715">opt</span>&nbsp;<span class="builtintype" id="2431719">int</span><span class="op" id="2431722">,</span>&nbsp;<span class="ident" id="2431724">value</span>&nbsp;<span class="builtintype" id="2431730">int</span><span class="op" id="2431733">)</span>&nbsp;<span class="op" id="2431735">(</span><span class="ident" id="2431736">err</span>&nbsp;<span class="builtintype" id="2431740">error</span><span class="op" id="2431745">)</span>&nbsp;<span class="op" id="2431747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431750">var</span>&nbsp;<span class="ident" id="2431754">n</span>&nbsp;<span class="op" id="2431756">=</span>&nbsp;<span class="builtintype" id="2431758">int32</span><span class="op" id="2431763">(</span><span class="ident" id="2431764">value</span><span class="op" id="2431769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431772">return</span>&nbsp;<span class="ident" id="2431779">setsockopt</span><span class="op" id="2431789">(</span><span class="ident" id="2431790">fd</span><span class="op" id="2431792">,</span>&nbsp;<span class="ident" id="2431794">level</span><span class="op" id="2431799">,</span>&nbsp;<span class="ident" id="2431801">opt</span><span class="op" id="2431804">,</span>&nbsp;<span class="ident" id="2431806">unsafe</span><span class="op" id="2431812">.</span><span class="ident" id="2431813">Pointer</span><span class="op" id="2431820">(</span><span class="op" id="2431821">&amp;</span><span class="ident" id="2431822">n</span><span class="op" id="2431823">)</span><span class="op" id="2431824">,</span>&nbsp;<span class="num" id="2431826">4</span><span class="op" id="2431827">)</span><br>
<span class="lineno"></span><span class="op" id="2431829">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="2431832">func</span>&nbsp;<span class="ident" id="2431837">SetsockoptInet4Addr</span><span class="op" id="2431856">(</span><span class="ident" id="2431857">fd</span><span class="op" id="2431859">,</span>&nbsp;<span class="ident" id="2431861">level</span><span class="op" id="2431866">,</span>&nbsp;<span class="ident" id="2431868">opt</span>&nbsp;<span class="builtintype" id="2431872">int</span><span class="op" id="2431875">,</span>&nbsp;<span class="ident" id="2431877">value</span>&nbsp;<span class="op" id="2431883">[</span><span class="num" id="2431884">4</span><span class="op" id="2431885">]</span><span class="builtintype" id="2431886">byte</span><span class="op" id="2431890">)</span>&nbsp;<span class="op" id="2431892">(</span><span class="ident" id="2431893">err</span>&nbsp;<span class="builtintype" id="2431897">error</span><span class="op" id="2431902">)</span>&nbsp;<span class="op" id="2431904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2431907">return</span>&nbsp;<span class="ident" id="2431914">setsockopt</span><span class="op" id="2431924">(</span><span class="ident" id="2431925">fd</span><span class="op" id="2431927">,</span>&nbsp;<span class="ident" id="2431929">level</span><span class="op" id="2431934">,</span>&nbsp;<span class="ident" id="2431936">opt</span><span class="op" id="2431939">,</span>&nbsp;<span class="ident" id="2431941">unsafe</span><span class="op" id="2431947">.</span><span class="ident" id="2431948">Pointer</span><span class="op" id="2431955">(</span><span class="op" id="2431956">&amp;</span><span class="ident" id="2431957">value</span><span class="op" id="2431962">[</span><span class="num" id="2431963">0</span><span class="op" id="2431964">]</span><span class="op" id="2431965">)</span><span class="op" id="2431966">,</span>&nbsp;<span class="num" id="2431968">4</span><span class="op" id="2431969">)</span><br>
<span class="lineno"></span><span class="op" id="2431971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="2431974">func</span>&nbsp;<span class="ident" id="2431979">SetsockoptIPMreq</span><span class="op" id="2431995">(</span><span class="ident" id="2431996">fd</span><span class="op" id="2431998">,</span>&nbsp;<span class="ident" id="2432000">level</span><span class="op" id="2432005">,</span>&nbsp;<span class="ident" id="2432007">opt</span>&nbsp;<span class="builtintype" id="2432011">int</span><span class="op" id="2432014">,</span>&nbsp;<span class="ident" id="2432016">mreq</span>&nbsp;<span class="op" id="2432021">*</span><span class="ident" id="2432022">IPMreq</span><span class="op" id="2432028">)</span>&nbsp;<span class="op" id="2432030">(</span><span class="ident" id="2432031">err</span>&nbsp;<span class="builtintype" id="2432035">error</span><span class="op" id="2432040">)</span>&nbsp;<span class="op" id="2432042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432045">return</span>&nbsp;<span class="ident" id="2432052">setsockopt</span><span class="op" id="2432062">(</span><span class="ident" id="2432063">fd</span><span class="op" id="2432065">,</span>&nbsp;<span class="ident" id="2432067">level</span><span class="op" id="2432072">,</span>&nbsp;<span class="ident" id="2432074">opt</span><span class="op" id="2432077">,</span>&nbsp;<span class="ident" id="2432079">unsafe</span><span class="op" id="2432085">.</span><span class="ident" id="2432086">Pointer</span><span class="op" id="2432093">(</span><span class="ident" id="2432094">mreq</span><span class="op" id="2432098">)</span><span class="op" id="2432099">,</span>&nbsp;<span class="ident" id="2432101">SizeofIPMreq</span><span class="op" id="2432113">)</span><br>
<span class="lineno"></span><span class="op" id="2432115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2432118">func</span>&nbsp;<span class="ident" id="2432123">SetsockoptIPv6Mreq</span><span class="op" id="2432141">(</span><span class="ident" id="2432142">fd</span><span class="op" id="2432144">,</span>&nbsp;<span class="ident" id="2432146">level</span><span class="op" id="2432151">,</span>&nbsp;<span class="ident" id="2432153">opt</span>&nbsp;<span class="builtintype" id="2432157">int</span><span class="op" id="2432160">,</span>&nbsp;<span class="ident" id="2432162">mreq</span>&nbsp;<span class="op" id="2432167">*</span><span class="ident" id="2432168">IPv6Mreq</span><span class="op" id="2432176">)</span>&nbsp;<span class="op" id="2432178">(</span><span class="ident" id="2432179">err</span>&nbsp;<span class="builtintype" id="2432183">error</span><span class="op" id="2432188">)</span>&nbsp;<span class="op" id="2432190">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432193">return</span>&nbsp;<span class="ident" id="2432200">setsockopt</span><span class="op" id="2432210">(</span><span class="ident" id="2432211">fd</span><span class="op" id="2432213">,</span>&nbsp;<span class="ident" id="2432215">level</span><span class="op" id="2432220">,</span>&nbsp;<span class="ident" id="2432222">opt</span><span class="op" id="2432225">,</span>&nbsp;<span class="ident" id="2432227">unsafe</span><span class="op" id="2432233">.</span><span class="ident" id="2432234">Pointer</span><span class="op" id="2432241">(</span><span class="ident" id="2432242">mreq</span><span class="op" id="2432246">)</span><span class="op" id="2432247">,</span>&nbsp;<span class="ident" id="2432249">SizeofIPv6Mreq</span><span class="op" id="2432263">)</span><br>
<span class="lineno"></span><span class="op" id="2432265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2432268">func</span>&nbsp;<span class="ident" id="2432273">SetsockoptICMPv6Filter</span><span class="op" id="2432295">(</span><span class="ident" id="2432296">fd</span><span class="op" id="2432298">,</span>&nbsp;<span class="ident" id="2432300">level</span><span class="op" id="2432305">,</span>&nbsp;<span class="ident" id="2432307">opt</span>&nbsp;<span class="builtintype" id="2432311">int</span><span class="op" id="2432314">,</span>&nbsp;<span class="ident" id="2432316">filter</span>&nbsp;<span class="op" id="2432323">*</span><span class="ident" id="2432324">ICMPv6Filter</span><span class="op" id="2432336">)</span>&nbsp;<span class="builtintype" id="2432338">error</span>&nbsp;<span class="op" id="2432344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432347">return</span>&nbsp;<span class="ident" id="2432354">setsockopt</span><span class="op" id="2432364">(</span><span class="ident" id="2432365">fd</span><span class="op" id="2432367">,</span>&nbsp;<span class="ident" id="2432369">level</span><span class="op" id="2432374">,</span>&nbsp;<span class="ident" id="2432376">opt</span><span class="op" id="2432379">,</span>&nbsp;<span class="ident" id="2432381">unsafe</span><span class="op" id="2432387">.</span><span class="ident" id="2432388">Pointer</span><span class="op" id="2432395">(</span><span class="ident" id="2432396">filter</span><span class="op" id="2432402">)</span><span class="op" id="2432403">,</span>&nbsp;<span class="ident" id="2432405">SizeofICMPv6Filter</span><span class="op" id="2432423">)</span><br>
<span class="lineno">260</span><span class="op" id="2432425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2432428">func</span>&nbsp;<span class="ident" id="2432433">SetsockoptLinger</span><span class="op" id="2432449">(</span><span class="ident" id="2432450">fd</span><span class="op" id="2432452">,</span>&nbsp;<span class="ident" id="2432454">level</span><span class="op" id="2432459">,</span>&nbsp;<span class="ident" id="2432461">opt</span>&nbsp;<span class="builtintype" id="2432465">int</span><span class="op" id="2432468">,</span>&nbsp;<span class="ident" id="2432470">l</span>&nbsp;<span class="op" id="2432472">*</span><span class="ident" id="2432473">Linger</span><span class="op" id="2432479">)</span>&nbsp;<span class="op" id="2432481">(</span><span class="ident" id="2432482">err</span>&nbsp;<span class="builtintype" id="2432486">error</span><span class="op" id="2432491">)</span>&nbsp;<span class="op" id="2432493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432496">return</span>&nbsp;<span class="ident" id="2432503">setsockopt</span><span class="op" id="2432513">(</span><span class="ident" id="2432514">fd</span><span class="op" id="2432516">,</span>&nbsp;<span class="ident" id="2432518">level</span><span class="op" id="2432523">,</span>&nbsp;<span class="ident" id="2432525">opt</span><span class="op" id="2432528">,</span>&nbsp;<span class="ident" id="2432530">unsafe</span><span class="op" id="2432536">.</span><span class="ident" id="2432537">Pointer</span><span class="op" id="2432544">(</span><span class="ident" id="2432545">l</span><span class="op" id="2432546">)</span><span class="op" id="2432547">,</span>&nbsp;<span class="ident" id="2432549">SizeofLinger</span><span class="op" id="2432561">)</span><br>
<span class="lineno"></span><span class="op" id="2432563">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="2432566">func</span>&nbsp;<span class="ident" id="2432571">SetsockoptString</span><span class="op" id="2432587">(</span><span class="ident" id="2432588">fd</span><span class="op" id="2432590">,</span>&nbsp;<span class="ident" id="2432592">level</span><span class="op" id="2432597">,</span>&nbsp;<span class="ident" id="2432599">opt</span>&nbsp;<span class="builtintype" id="2432603">int</span><span class="op" id="2432606">,</span>&nbsp;<span class="ident" id="2432608">s</span>&nbsp;<span class="builtintype" id="2432610">string</span><span class="op" id="2432616">)</span>&nbsp;<span class="op" id="2432618">(</span><span class="ident" id="2432619">err</span>&nbsp;<span class="builtintype" id="2432623">error</span><span class="op" id="2432628">)</span>&nbsp;<span class="op" id="2432630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432633">return</span>&nbsp;<span class="ident" id="2432640">setsockopt</span><span class="op" id="2432650">(</span><span class="ident" id="2432651">fd</span><span class="op" id="2432653">,</span>&nbsp;<span class="ident" id="2432655">level</span><span class="op" id="2432660">,</span>&nbsp;<span class="ident" id="2432662">opt</span><span class="op" id="2432665">,</span>&nbsp;<span class="ident" id="2432667">unsafe</span><span class="op" id="2432673">.</span><span class="ident" id="2432674">Pointer</span><span class="op" id="2432681">(</span><span class="op" id="2432682">&amp;</span><span class="op" id="2432683">[</span><span class="op" id="2432684">]</span><span class="builtintype" id="2432685">byte</span><span class="op" id="2432689">(</span><span class="ident" id="2432690">s</span><span class="op" id="2432691">)</span><span class="op" id="2432692">[</span><span class="num" id="2432693">0</span><span class="op" id="2432694">]</span><span class="op" id="2432695">)</span><span class="op" id="2432696">,</span>&nbsp;<span class="builtintype" id="2432698">uintptr</span><span class="op" id="2432705">(</span><span class="builtinfunc" id="2432706">len</span><span class="op" id="2432709">(</span><span class="ident" id="2432710">s</span><span class="op" id="2432711">)</span><span class="op" id="2432712">)</span><span class="op" id="2432713">)</span><br>
<span class="lineno"></span><span class="op" id="2432715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="2432718">func</span>&nbsp;<span class="ident" id="2432723">SetsockoptTimeval</span><span class="op" id="2432740">(</span><span class="ident" id="2432741">fd</span><span class="op" id="2432743">,</span>&nbsp;<span class="ident" id="2432745">level</span><span class="op" id="2432750">,</span>&nbsp;<span class="ident" id="2432752">opt</span>&nbsp;<span class="builtintype" id="2432756">int</span><span class="op" id="2432759">,</span>&nbsp;<span class="ident" id="2432761">tv</span>&nbsp;<span class="op" id="2432764">*</span><span class="ident" id="2432765">Timeval</span><span class="op" id="2432772">)</span>&nbsp;<span class="op" id="2432774">(</span><span class="ident" id="2432775">err</span>&nbsp;<span class="builtintype" id="2432779">error</span><span class="op" id="2432784">)</span>&nbsp;<span class="op" id="2432786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432789">return</span>&nbsp;<span class="ident" id="2432796">setsockopt</span><span class="op" id="2432806">(</span><span class="ident" id="2432807">fd</span><span class="op" id="2432809">,</span>&nbsp;<span class="ident" id="2432811">level</span><span class="op" id="2432816">,</span>&nbsp;<span class="ident" id="2432818">opt</span><span class="op" id="2432821">,</span>&nbsp;<span class="ident" id="2432823">unsafe</span><span class="op" id="2432829">.</span><span class="ident" id="2432830">Pointer</span><span class="op" id="2432837">(</span><span class="ident" id="2432838">tv</span><span class="op" id="2432840">)</span><span class="op" id="2432841">,</span>&nbsp;<span class="ident" id="2432843">unsafe</span><span class="op" id="2432849">.</span><span class="ident" id="2432850">Sizeof</span><span class="op" id="2432856">(</span><span class="op" id="2432857">*</span><span class="ident" id="2432858">tv</span><span class="op" id="2432860">)</span><span class="op" id="2432861">)</span><br>
<span class="lineno"></span><span class="op" id="2432863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2432866">func</span>&nbsp;<span class="ident" id="2432871">Socket</span><span class="op" id="2432877">(</span><span class="ident" id="2432878">domain</span><span class="op" id="2432884">,</span>&nbsp;<span class="ident" id="2432886">typ</span><span class="op" id="2432889">,</span>&nbsp;<span class="ident" id="2432891">proto</span>&nbsp;<span class="builtintype" id="2432897">int</span><span class="op" id="2432900">)</span>&nbsp;<span class="op" id="2432902">(</span><span class="ident" id="2432903">fd</span>&nbsp;<span class="builtintype" id="2432906">int</span><span class="op" id="2432909">,</span>&nbsp;<span class="ident" id="2432911">err</span>&nbsp;<span class="builtintype" id="2432915">error</span><span class="op" id="2432920">)</span>&nbsp;<span class="op" id="2432922">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432925">if</span>&nbsp;<span class="ident" id="2432928">domain</span>&nbsp;<span class="op" id="2432935">==</span>&nbsp;<span class="ident" id="2432938">AF_INET6</span>&nbsp;<span class="op" id="2432947">&amp;&amp;</span>&nbsp;<span class="ident" id="2432950">SocketDisableIPv6</span>&nbsp;<span class="op" id="2432968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2432972">return</span>&nbsp;<span class="op" id="2432979">-</span><span class="num" id="2432980">1</span><span class="op" id="2432981">,</span>&nbsp;<span class="ident" id="2432983">EAFNOSUPPORT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2432997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433000">fd</span><span class="op" id="2433002">,</span>&nbsp;<span class="ident" id="2433004">err</span>&nbsp;<span class="op" id="2433008">=</span>&nbsp;<span class="ident" id="2433010">socket</span><span class="op" id="2433016">(</span><span class="ident" id="2433017">domain</span><span class="op" id="2433023">,</span>&nbsp;<span class="ident" id="2433025">typ</span><span class="op" id="2433028">,</span>&nbsp;<span class="ident" id="2433030">proto</span><span class="op" id="2433035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433038">return</span><br>
<span class="lineno">280</span><span class="op" id="2433045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2433048">func</span>&nbsp;<span class="ident" id="2433053">Socketpair</span><span class="op" id="2433063">(</span><span class="ident" id="2433064">domain</span><span class="op" id="2433070">,</span>&nbsp;<span class="ident" id="2433072">typ</span><span class="op" id="2433075">,</span>&nbsp;<span class="ident" id="2433077">proto</span>&nbsp;<span class="builtintype" id="2433083">int</span><span class="op" id="2433086">)</span>&nbsp;<span class="op" id="2433088">(</span><span class="ident" id="2433089">fd</span>&nbsp;<span class="op" id="2433092">[</span><span class="num" id="2433093">2</span><span class="op" id="2433094">]</span><span class="builtintype" id="2433095">int</span><span class="op" id="2433098">,</span>&nbsp;<span class="ident" id="2433100">err</span>&nbsp;<span class="builtintype" id="2433104">error</span><span class="op" id="2433109">)</span>&nbsp;<span class="op" id="2433111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433114">var</span>&nbsp;<span class="ident" id="2433118">fdx</span>&nbsp;<span class="op" id="2433122">[</span><span class="num" id="2433123">2</span><span class="op" id="2433124">]</span><span class="builtintype" id="2433125">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433132">err</span>&nbsp;<span class="op" id="2433136">=</span>&nbsp;<span class="ident" id="2433138">socketpair</span><span class="op" id="2433148">(</span><span class="ident" id="2433149">domain</span><span class="op" id="2433155">,</span>&nbsp;<span class="ident" id="2433157">typ</span><span class="op" id="2433160">,</span>&nbsp;<span class="ident" id="2433162">proto</span><span class="op" id="2433167">,</span>&nbsp;<span class="op" id="2433169">&amp;</span><span class="ident" id="2433170">fdx</span><span class="op" id="2433173">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433176">if</span>&nbsp;<span class="ident" id="2433179">err</span>&nbsp;<span class="op" id="2433183">==</span>&nbsp;<span class="ident" id="2433186">nil</span>&nbsp;<span class="op" id="2433190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433194">fd</span><span class="op" id="2433196">[</span><span class="num" id="2433197">0</span><span class="op" id="2433198">]</span>&nbsp;<span class="op" id="2433200">=</span>&nbsp;<span class="builtintype" id="2433202">int</span><span class="op" id="2433205">(</span><span class="ident" id="2433206">fdx</span><span class="op" id="2433209">[</span><span class="num" id="2433210">0</span><span class="op" id="2433211">]</span><span class="op" id="2433212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433216">fd</span><span class="op" id="2433218">[</span><span class="num" id="2433219">1</span><span class="op" id="2433220">]</span>&nbsp;<span class="op" id="2433222">=</span>&nbsp;<span class="builtintype" id="2433224">int</span><span class="op" id="2433227">(</span><span class="ident" id="2433228">fdx</span><span class="op" id="2433231">[</span><span class="num" id="2433232">1</span><span class="op" id="2433233">]</span><span class="op" id="2433234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2433237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433240">return</span><br>
<span class="lineno">290</span><span class="op" id="2433247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2433250">func</span>&nbsp;<span class="ident" id="2433255">Sendfile</span><span class="op" id="2433263">(</span><span class="ident" id="2433264">outfd</span>&nbsp;<span class="builtintype" id="2433270">int</span><span class="op" id="2433273">,</span>&nbsp;<span class="ident" id="2433275">infd</span>&nbsp;<span class="builtintype" id="2433280">int</span><span class="op" id="2433283">,</span>&nbsp;<span class="ident" id="2433285">offset</span>&nbsp;<span class="op" id="2433292">*</span><span class="ident" id="2433293">int64</span><span class="op" id="2433298">,</span>&nbsp;<span class="ident" id="2433300">count</span>&nbsp;<span class="builtintype" id="2433306">int</span><span class="op" id="2433309">)</span>&nbsp;<span class="op" id="2433311">(</span><span class="ident" id="2433312">written</span>&nbsp;<span class="builtintype" id="2433320">int</span><span class="op" id="2433323">,</span>&nbsp;<span class="ident" id="2433325">err</span>&nbsp;<span class="builtintype" id="2433329">error</span><span class="op" id="2433334">)</span>&nbsp;<span class="op" id="2433336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433339">if</span>&nbsp;<span class="ident" id="2433342">raceenabled</span>&nbsp;<span class="op" id="2433354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433358">raceReleaseMerge</span><span class="op" id="2433374">(</span><span class="ident" id="2433375">unsafe</span><span class="op" id="2433381">.</span><span class="ident" id="2433382">Pointer</span><span class="op" id="2433389">(</span><span class="op" id="2433390">&amp;</span><span class="ident" id="2433391">ioSync</span><span class="op" id="2433397">)</span><span class="op" id="2433398">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2433401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2433404">return</span>&nbsp;<span class="ident" id="2433411">sendfile</span><span class="op" id="2433419">(</span><span class="ident" id="2433420">outfd</span><span class="op" id="2433425">,</span>&nbsp;<span class="ident" id="2433427">infd</span><span class="op" id="2433431">,</span>&nbsp;<span class="ident" id="2433433">offset</span><span class="op" id="2433439">,</span>&nbsp;<span class="ident" id="2433441">count</span><span class="op" id="2433446">)</span><br>
<span class="lineno"></span><span class="op" id="2433448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2433451">var</span>&nbsp;<span class="ident" id="2433455">ioSync</span>&nbsp;<span class="ident" id="2433462">int64</span>
</div>
</body>
</html>
