<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html" class="current">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2433238">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2433293">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2433347">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2433398">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2433463">package</span>&nbsp;<span class="ident" id="2433471">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2433480">import</span>&nbsp;<span class="op" id="2433487">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2433490">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2433501">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2433509">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2433518">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="2433521">var</span>&nbsp;<span class="op" id="2433525">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433528">Stdin</span>&nbsp;&nbsp;<span class="op" id="2433535">=</span>&nbsp;<span class="num" id="2433537">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433540">Stdout</span>&nbsp;<span class="op" id="2433547">=</span>&nbsp;<span class="num" id="2433549">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433552">Stderr</span>&nbsp;<span class="op" id="2433559">=</span>&nbsp;<span class="num" id="2433561">2</span><br>
<span class="lineno"></span><span class="op" id="2433563">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2433566">const</span>&nbsp;<span class="op" id="2433572">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433575">darwin64Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2433590">=</span>&nbsp;<span class="ident" id="2433592">runtime</span><span class="op" id="2433599">.</span><span class="ident" id="2433600">GOOS</span>&nbsp;<span class="op" id="2433605">==</span>&nbsp;<span class="string" id="2433608">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2433617">&amp;&amp;</span>&nbsp;<span class="ident" id="2433620">sizeofPtr</span>&nbsp;<span class="op" id="2433630">==</span>&nbsp;<span class="num" id="2433633">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433636">dragonfly64Bit</span>&nbsp;<span class="op" id="2433651">=</span>&nbsp;<span class="ident" id="2433653">runtime</span><span class="op" id="2433660">.</span><span class="ident" id="2433661">GOOS</span>&nbsp;<span class="op" id="2433666">==</span>&nbsp;<span class="string" id="2433669">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="2433681">&amp;&amp;</span>&nbsp;<span class="ident" id="2433684">sizeofPtr</span>&nbsp;<span class="op" id="2433694">==</span>&nbsp;<span class="num" id="2433697">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2433700">netbsd32Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2433715">=</span>&nbsp;<span class="ident" id="2433717">runtime</span><span class="op" id="2433724">.</span><span class="ident" id="2433725">GOOS</span>&nbsp;<span class="op" id="2433730">==</span>&nbsp;<span class="string" id="2433733">&#34;netbsd&#34;</span>&nbsp;<span class="op" id="2433742">&amp;&amp;</span>&nbsp;<span class="ident" id="2433745">sizeofPtr</span>&nbsp;<span class="op" id="2433755">==</span>&nbsp;<span class="num" id="2433758">4</span><br>
<span class="lineno">25</span><span class="op" id="2433760">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2433763">func</span>&nbsp;<span class="ident" id="2433768">Syscall</span><span class="op" id="2433775">(</span><span class="ident" id="2433776">trap</span><span class="op" id="2433780">,</span>&nbsp;<span class="ident" id="2433782">a1</span><span class="op" id="2433784">,</span>&nbsp;<span class="ident" id="2433786">a2</span><span class="op" id="2433788">,</span>&nbsp;<span class="ident" id="2433790">a3</span>&nbsp;<span class="builtintype" id="2433793">uintptr</span><span class="op" id="2433800">)</span>&nbsp;<span class="op" id="2433802">(</span><span class="ident" id="2433803">r1</span><span class="op" id="2433805">,</span>&nbsp;<span class="ident" id="2433807">r2</span>&nbsp;<span class="builtintype" id="2433810">uintptr</span><span class="op" id="2433817">,</span>&nbsp;<span class="ident" id="2433819">err</span>&nbsp;<span class="ident" id="2433823">Errno</span><span class="op" id="2433828">)</span><br>
<span class="lineno"></span><span class="keyword" id="2433830">func</span>&nbsp;<span class="ident" id="2433835">Syscall6</span><span class="op" id="2433843">(</span><span class="ident" id="2433844">trap</span><span class="op" id="2433848">,</span>&nbsp;<span class="ident" id="2433850">a1</span><span class="op" id="2433852">,</span>&nbsp;<span class="ident" id="2433854">a2</span><span class="op" id="2433856">,</span>&nbsp;<span class="ident" id="2433858">a3</span><span class="op" id="2433860">,</span>&nbsp;<span class="ident" id="2433862">a4</span><span class="op" id="2433864">,</span>&nbsp;<span class="ident" id="2433866">a5</span><span class="op" id="2433868">,</span>&nbsp;<span class="ident" id="2433870">a6</span>&nbsp;<span class="builtintype" id="2433873">uintptr</span><span class="op" id="2433880">)</span>&nbsp;<span class="op" id="2433882">(</span><span class="ident" id="2433883">r1</span><span class="op" id="2433885">,</span>&nbsp;<span class="ident" id="2433887">r2</span>&nbsp;<span class="builtintype" id="2433890">uintptr</span><span class="op" id="2433897">,</span>&nbsp;<span class="ident" id="2433899">err</span>&nbsp;<span class="ident" id="2433903">Errno</span><span class="op" id="2433908">)</span><br>
<span class="lineno"></span><span class="keyword" id="2433910">func</span>&nbsp;<span class="ident" id="2433915">RawSyscall</span><span class="op" id="2433925">(</span><span class="ident" id="2433926">trap</span><span class="op" id="2433930">,</span>&nbsp;<span class="ident" id="2433932">a1</span><span class="op" id="2433934">,</span>&nbsp;<span class="ident" id="2433936">a2</span><span class="op" id="2433938">,</span>&nbsp;<span class="ident" id="2433940">a3</span>&nbsp;<span class="builtintype" id="2433943">uintptr</span><span class="op" id="2433950">)</span>&nbsp;<span class="op" id="2433952">(</span><span class="ident" id="2433953">r1</span><span class="op" id="2433955">,</span>&nbsp;<span class="ident" id="2433957">r2</span>&nbsp;<span class="builtintype" id="2433960">uintptr</span><span class="op" id="2433967">,</span>&nbsp;<span class="ident" id="2433969">err</span>&nbsp;<span class="ident" id="2433973">Errno</span><span class="op" id="2433978">)</span><br>
<span class="lineno">30</span><span class="keyword" id="2433980">func</span>&nbsp;<span class="ident" id="2433985">RawSyscall6</span><span class="op" id="2433996">(</span><span class="ident" id="2433997">trap</span><span class="op" id="2434001">,</span>&nbsp;<span class="ident" id="2434003">a1</span><span class="op" id="2434005">,</span>&nbsp;<span class="ident" id="2434007">a2</span><span class="op" id="2434009">,</span>&nbsp;<span class="ident" id="2434011">a3</span><span class="op" id="2434013">,</span>&nbsp;<span class="ident" id="2434015">a4</span><span class="op" id="2434017">,</span>&nbsp;<span class="ident" id="2434019">a5</span><span class="op" id="2434021">,</span>&nbsp;<span class="ident" id="2434023">a6</span>&nbsp;<span class="builtintype" id="2434026">uintptr</span><span class="op" id="2434033">)</span>&nbsp;<span class="op" id="2434035">(</span><span class="ident" id="2434036">r1</span><span class="op" id="2434038">,</span>&nbsp;<span class="ident" id="2434040">r2</span>&nbsp;<span class="builtintype" id="2434043">uintptr</span><span class="op" id="2434050">,</span>&nbsp;<span class="ident" id="2434052">err</span>&nbsp;<span class="ident" id="2434056">Errno</span><span class="op" id="2434061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2434064">//&nbsp;Mmap&nbsp;manager,&nbsp;for&nbsp;use&nbsp;by&nbsp;operating&nbsp;system-specific&nbsp;implementations.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2434136">type</span>&nbsp;<span class="ident" id="2434141">mmapper</span>&nbsp;<span class="keyword" id="2434149">struct</span>&nbsp;<span class="op" id="2434156">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434159">sync</span><span class="op" id="2434163">.</span><span class="ident" id="2434164">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434171">active</span>&nbsp;<span class="keyword" id="2434178">map</span><span class="op" id="2434181">[</span><span class="op" id="2434182">*</span><span class="builtintype" id="2434183">byte</span><span class="op" id="2434187">]</span><span class="op" id="2434188">[</span><span class="op" id="2434189">]</span><span class="builtintype" id="2434190">byte</span>&nbsp;<span class="comment" id="2434195">//&nbsp;active&nbsp;mappings;&nbsp;key&nbsp;is&nbsp;last&nbsp;byte&nbsp;in&nbsp;mapping</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434244">mmap</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="2434251">func</span><span class="op" id="2434255">(</span><span class="ident" id="2434256">addr</span><span class="op" id="2434260">,</span>&nbsp;<span class="ident" id="2434262">length</span>&nbsp;<span class="builtintype" id="2434269">uintptr</span><span class="op" id="2434276">,</span>&nbsp;<span class="ident" id="2434278">prot</span><span class="op" id="2434282">,</span>&nbsp;<span class="ident" id="2434284">flags</span><span class="op" id="2434289">,</span>&nbsp;<span class="ident" id="2434291">fd</span>&nbsp;<span class="builtintype" id="2434294">int</span><span class="op" id="2434297">,</span>&nbsp;<span class="ident" id="2434299">offset</span>&nbsp;<span class="ident" id="2434306">int64</span><span class="op" id="2434311">)</span>&nbsp;<span class="op" id="2434313">(</span><span class="builtintype" id="2434314">uintptr</span><span class="op" id="2434321">,</span>&nbsp;<span class="builtintype" id="2434323">error</span><span class="op" id="2434328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434331">munmap</span>&nbsp;<span class="keyword" id="2434338">func</span><span class="op" id="2434342">(</span><span class="ident" id="2434343">addr</span>&nbsp;<span class="builtintype" id="2434348">uintptr</span><span class="op" id="2434355">,</span>&nbsp;<span class="ident" id="2434357">length</span>&nbsp;<span class="builtintype" id="2434364">uintptr</span><span class="op" id="2434371">)</span>&nbsp;<span class="builtintype" id="2434373">error</span><br>
<span class="lineno"></span><span class="op" id="2434379">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2434382">func</span>&nbsp;<span class="op" id="2434387">(</span><span class="ident" id="2434388">m</span>&nbsp;<span class="op" id="2434390">*</span><span class="ident" id="2434391">mmapper</span><span class="op" id="2434398">)</span>&nbsp;<span class="ident" id="2434400">Mmap</span><span class="op" id="2434404">(</span><span class="ident" id="2434405">fd</span>&nbsp;<span class="builtintype" id="2434408">int</span><span class="op" id="2434411">,</span>&nbsp;<span class="ident" id="2434413">offset</span>&nbsp;<span class="ident" id="2434420">int64</span><span class="op" id="2434425">,</span>&nbsp;<span class="ident" id="2434427">length</span>&nbsp;<span class="builtintype" id="2434434">int</span><span class="op" id="2434437">,</span>&nbsp;<span class="ident" id="2434439">prot</span>&nbsp;<span class="builtintype" id="2434444">int</span><span class="op" id="2434447">,</span>&nbsp;<span class="ident" id="2434449">flags</span>&nbsp;<span class="builtintype" id="2434455">int</span><span class="op" id="2434458">)</span>&nbsp;<span class="op" id="2434460">(</span><span class="ident" id="2434461">data</span>&nbsp;<span class="op" id="2434466">[</span><span class="op" id="2434467">]</span><span class="builtintype" id="2434468">byte</span><span class="op" id="2434472">,</span>&nbsp;<span class="ident" id="2434474">err</span>&nbsp;<span class="builtintype" id="2434478">error</span><span class="op" id="2434483">)</span>&nbsp;<span class="op" id="2434485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434488">if</span>&nbsp;<span class="ident" id="2434491">length</span>&nbsp;<span class="op" id="2434498">&lt;=</span>&nbsp;<span class="num" id="2434501">0</span>&nbsp;<span class="op" id="2434503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434507">return</span>&nbsp;<span class="ident" id="2434514">nil</span><span class="op" id="2434517">,</span>&nbsp;<span class="ident" id="2434519">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434527">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2434531">//&nbsp;Map&nbsp;the&nbsp;requested&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434561">addr</span><span class="op" id="2434565">,</span>&nbsp;<span class="ident" id="2434567">errno</span>&nbsp;<span class="op" id="2434573">:=</span>&nbsp;<span class="ident" id="2434576">m</span><span class="op" id="2434577">.</span><span class="ident" id="2434578">mmap</span><span class="op" id="2434582">(</span><span class="num" id="2434583">0</span><span class="op" id="2434584">,</span>&nbsp;<span class="builtintype" id="2434586">uintptr</span><span class="op" id="2434593">(</span><span class="ident" id="2434594">length</span><span class="op" id="2434600">)</span><span class="op" id="2434601">,</span>&nbsp;<span class="ident" id="2434603">prot</span><span class="op" id="2434607">,</span>&nbsp;<span class="ident" id="2434609">flags</span><span class="op" id="2434614">,</span>&nbsp;<span class="ident" id="2434616">fd</span><span class="op" id="2434618">,</span>&nbsp;<span class="ident" id="2434620">offset</span><span class="op" id="2434626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434629">if</span>&nbsp;<span class="ident" id="2434632">errno</span>&nbsp;<span class="op" id="2434638">!=</span>&nbsp;<span class="ident" id="2434641">nil</span>&nbsp;<span class="op" id="2434645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434649">return</span>&nbsp;<span class="ident" id="2434656">nil</span><span class="op" id="2434659">,</span>&nbsp;<span class="ident" id="2434661">errno</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2434672">//&nbsp;Slice&nbsp;memory&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434696">var</span>&nbsp;<span class="ident" id="2434700">sl</span>&nbsp;<span class="op" id="2434703">=</span>&nbsp;<span class="keyword" id="2434705">struct</span>&nbsp;<span class="op" id="2434712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434716">addr</span>&nbsp;<span class="builtintype" id="2434721">uintptr</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2434731">len</span>&nbsp;&nbsp;<span class="builtintype" id="2434736">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2434742">cap</span>&nbsp;&nbsp;<span class="builtintype" id="2434747">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2434752">}</span><span class="op" id="2434753">{</span><span class="ident" id="2434754">addr</span><span class="op" id="2434758">,</span>&nbsp;<span class="ident" id="2434760">length</span><span class="op" id="2434766">,</span>&nbsp;<span class="ident" id="2434768">length</span><span class="op" id="2434774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2434778">//&nbsp;Use&nbsp;unsafe&nbsp;to&nbsp;turn&nbsp;sl&nbsp;into&nbsp;a&nbsp;[]byte.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434819">b</span>&nbsp;<span class="op" id="2434821">:=</span>&nbsp;<span class="op" id="2434824">*</span><span class="op" id="2434825">(</span><span class="op" id="2434826">*</span><span class="op" id="2434827">[</span><span class="op" id="2434828">]</span><span class="builtintype" id="2434829">byte</span><span class="op" id="2434833">)</span><span class="op" id="2434834">(</span><span class="ident" id="2434835">unsafe</span><span class="op" id="2434841">.</span><span class="ident" id="2434842">Pointer</span><span class="op" id="2434849">(</span><span class="op" id="2434850">&amp;</span><span class="ident" id="2434851">sl</span><span class="op" id="2434853">)</span><span class="op" id="2434854">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2434858">//&nbsp;Register&nbsp;mapping&nbsp;in&nbsp;m&nbsp;and&nbsp;return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434899">p</span>&nbsp;<span class="op" id="2434901">:=</span>&nbsp;<span class="op" id="2434904">&amp;</span><span class="ident" id="2434905">b</span><span class="op" id="2434906">[</span><span class="builtinfunc" id="2434907">cap</span><span class="op" id="2434910">(</span><span class="ident" id="2434911">b</span><span class="op" id="2434912">)</span><span class="op" id="2434913">-</span><span class="num" id="2434914">1</span><span class="op" id="2434915">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434918">m</span><span class="op" id="2434919">.</span><span class="ident" id="2434920">Lock</span><span class="op" id="2434924">(</span><span class="op" id="2434925">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434928">defer</span>&nbsp;<span class="ident" id="2434934">m</span><span class="op" id="2434935">.</span><span class="ident" id="2434936">Unlock</span><span class="op" id="2434942">(</span><span class="op" id="2434943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2434946">m</span><span class="op" id="2434947">.</span><span class="ident" id="2434948">active</span><span class="op" id="2434954">[</span><span class="ident" id="2434955">p</span><span class="op" id="2434956">]</span>&nbsp;<span class="op" id="2434958">=</span>&nbsp;<span class="ident" id="2434960">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2434963">return</span>&nbsp;<span class="ident" id="2434970">b</span><span class="op" id="2434971">,</span>&nbsp;<span class="ident" id="2434973">nil</span><br>
<span class="lineno"></span><span class="op" id="2434977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="2434980">func</span>&nbsp;<span class="op" id="2434985">(</span><span class="ident" id="2434986">m</span>&nbsp;<span class="op" id="2434988">*</span><span class="ident" id="2434989">mmapper</span><span class="op" id="2434996">)</span>&nbsp;<span class="ident" id="2434998">Munmap</span><span class="op" id="2435004">(</span><span class="ident" id="2435005">data</span>&nbsp;<span class="op" id="2435010">[</span><span class="op" id="2435011">]</span><span class="builtintype" id="2435012">byte</span><span class="op" id="2435016">)</span>&nbsp;<span class="op" id="2435018">(</span><span class="ident" id="2435019">err</span>&nbsp;<span class="builtintype" id="2435023">error</span><span class="op" id="2435028">)</span>&nbsp;<span class="op" id="2435030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435033">if</span>&nbsp;<span class="builtinfunc" id="2435036">len</span><span class="op" id="2435039">(</span><span class="ident" id="2435040">data</span><span class="op" id="2435044">)</span>&nbsp;<span class="op" id="2435046">==</span>&nbsp;<span class="num" id="2435049">0</span>&nbsp;<span class="op" id="2435051">||</span>&nbsp;<span class="builtinfunc" id="2435054">len</span><span class="op" id="2435057">(</span><span class="ident" id="2435058">data</span><span class="op" id="2435062">)</span>&nbsp;<span class="op" id="2435064">!=</span>&nbsp;<span class="builtinfunc" id="2435067">cap</span><span class="op" id="2435070">(</span><span class="ident" id="2435071">data</span><span class="op" id="2435075">)</span>&nbsp;<span class="op" id="2435077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435081">return</span>&nbsp;<span class="ident" id="2435088">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2435096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2435100">//&nbsp;Find&nbsp;the&nbsp;base&nbsp;of&nbsp;the&nbsp;mapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435134">p</span>&nbsp;<span class="op" id="2435136">:=</span>&nbsp;<span class="op" id="2435139">&amp;</span><span class="ident" id="2435140">data</span><span class="op" id="2435144">[</span><span class="builtinfunc" id="2435145">cap</span><span class="op" id="2435148">(</span><span class="ident" id="2435149">data</span><span class="op" id="2435153">)</span><span class="op" id="2435154">-</span><span class="num" id="2435155">1</span><span class="op" id="2435156">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435159">m</span><span class="op" id="2435160">.</span><span class="ident" id="2435161">Lock</span><span class="op" id="2435165">(</span><span class="op" id="2435166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435169">defer</span>&nbsp;<span class="ident" id="2435175">m</span><span class="op" id="2435176">.</span><span class="ident" id="2435177">Unlock</span><span class="op" id="2435183">(</span><span class="op" id="2435184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435187">b</span>&nbsp;<span class="op" id="2435189">:=</span>&nbsp;<span class="ident" id="2435192">m</span><span class="op" id="2435193">.</span><span class="ident" id="2435194">active</span><span class="op" id="2435200">[</span><span class="ident" id="2435201">p</span><span class="op" id="2435202">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435205">if</span>&nbsp;<span class="ident" id="2435208">b</span>&nbsp;<span class="op" id="2435210">==</span>&nbsp;<span class="ident" id="2435213">nil</span>&nbsp;<span class="op" id="2435217">||</span>&nbsp;<span class="op" id="2435220">&amp;</span><span class="ident" id="2435221">b</span><span class="op" id="2435222">[</span><span class="num" id="2435223">0</span><span class="op" id="2435224">]</span>&nbsp;<span class="op" id="2435226">!=</span>&nbsp;<span class="op" id="2435229">&amp;</span><span class="ident" id="2435230">data</span><span class="op" id="2435234">[</span><span class="num" id="2435235">0</span><span class="op" id="2435236">]</span>&nbsp;<span class="op" id="2435238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435242">return</span>&nbsp;<span class="ident" id="2435249">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2435257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2435261">//&nbsp;Unmap&nbsp;the&nbsp;memory&nbsp;and&nbsp;update&nbsp;m.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435296">if</span>&nbsp;<span class="ident" id="2435299">errno</span>&nbsp;<span class="op" id="2435305">:=</span>&nbsp;<span class="ident" id="2435308">m</span><span class="op" id="2435309">.</span><span class="ident" id="2435310">munmap</span><span class="op" id="2435316">(</span><span class="builtintype" id="2435317">uintptr</span><span class="op" id="2435324">(</span><span class="ident" id="2435325">unsafe</span><span class="op" id="2435331">.</span><span class="ident" id="2435332">Pointer</span><span class="op" id="2435339">(</span><span class="op" id="2435340">&amp;</span><span class="ident" id="2435341">b</span><span class="op" id="2435342">[</span><span class="num" id="2435343">0</span><span class="op" id="2435344">]</span><span class="op" id="2435345">)</span><span class="op" id="2435346">)</span><span class="op" id="2435347">,</span>&nbsp;<span class="builtintype" id="2435349">uintptr</span><span class="op" id="2435356">(</span><span class="builtinfunc" id="2435357">len</span><span class="op" id="2435360">(</span><span class="ident" id="2435361">b</span><span class="op" id="2435362">)</span><span class="op" id="2435363">)</span><span class="op" id="2435364">)</span><span class="op" id="2435365">;</span>&nbsp;<span class="ident" id="2435367">errno</span>&nbsp;<span class="op" id="2435373">!=</span>&nbsp;<span class="ident" id="2435376">nil</span>&nbsp;<span class="op" id="2435380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435384">return</span>&nbsp;<span class="ident" id="2435391">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2435398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2435401">delete</span><span class="op" id="2435407">(</span><span class="ident" id="2435408">m</span><span class="op" id="2435409">.</span><span class="ident" id="2435410">active</span><span class="op" id="2435416">,</span>&nbsp;<span class="ident" id="2435418">p</span><span class="op" id="2435419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435422">return</span>&nbsp;<span class="ident" id="2435429">nil</span><br>
<span class="lineno">90</span><span class="op" id="2435433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2435436">//&nbsp;An&nbsp;Errno&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;number&nbsp;describing&nbsp;an&nbsp;error&nbsp;condition.</span><br>
<span class="lineno"></span><span class="comment" id="2435501">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;error&nbsp;interface.&nbsp;&nbsp;The&nbsp;zero&nbsp;Errno&nbsp;is&nbsp;by&nbsp;convention</span><br>
<span class="lineno"></span><span class="comment" id="2435572">//&nbsp;a&nbsp;non-error,&nbsp;so&nbsp;code&nbsp;to&nbsp;convert&nbsp;from&nbsp;Errno&nbsp;to&nbsp;error&nbsp;should&nbsp;use:</span><br>
<span class="lineno">95</span><span class="comment" id="2435639">//&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span><span class="comment" id="2435652">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;errno&nbsp;!=&nbsp;0&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="2435671">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsperr&nbsp;=&nbsp;errno</span><br>
<span class="lineno"></span><span class="comment" id="2435687">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="keyword" id="2435692">type</span>&nbsp;<span class="ident" id="2435697">Errno</span>&nbsp;<span class="builtintype" id="2435703">uintptr</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2435712">func</span>&nbsp;<span class="op" id="2435717">(</span><span class="ident" id="2435718">e</span>&nbsp;<span class="ident" id="2435720">Errno</span><span class="op" id="2435725">)</span>&nbsp;<span class="ident" id="2435727">Error</span><span class="op" id="2435732">(</span><span class="op" id="2435733">)</span>&nbsp;<span class="builtintype" id="2435735">string</span>&nbsp;<span class="op" id="2435742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435745">if</span>&nbsp;<span class="num" id="2435748">0</span>&nbsp;<span class="op" id="2435750">&lt;=</span>&nbsp;<span class="builtintype" id="2435753">int</span><span class="op" id="2435756">(</span><span class="ident" id="2435757">e</span><span class="op" id="2435758">)</span>&nbsp;<span class="op" id="2435760">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2435763">int</span><span class="op" id="2435766">(</span><span class="ident" id="2435767">e</span><span class="op" id="2435768">)</span>&nbsp;<span class="op" id="2435770">&lt;</span>&nbsp;<span class="builtinfunc" id="2435772">len</span><span class="op" id="2435775">(</span><span class="ident" id="2435776">errors</span><span class="op" id="2435782">)</span>&nbsp;<span class="op" id="2435784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435788">s</span>&nbsp;<span class="op" id="2435790">:=</span>&nbsp;<span class="ident" id="2435793">errors</span><span class="op" id="2435799">[</span><span class="ident" id="2435800">e</span><span class="op" id="2435801">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435805">if</span>&nbsp;<span class="ident" id="2435808">s</span>&nbsp;<span class="op" id="2435810">!=</span>&nbsp;<span class="string" id="2435813">&#34;&#34;</span>&nbsp;<span class="op" id="2435816">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435821">return</span>&nbsp;<span class="ident" id="2435828">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2435832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2435835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435838">return</span>&nbsp;<span class="string" id="2435845">&#34;errno&nbsp;&#34;</span>&nbsp;<span class="op" id="2435854">+</span>&nbsp;<span class="ident" id="2435856">itoa</span><span class="op" id="2435860">(</span><span class="builtintype" id="2435861">int</span><span class="op" id="2435864">(</span><span class="ident" id="2435865">e</span><span class="op" id="2435866">)</span><span class="op" id="2435867">)</span><br>
<span class="lineno"></span><span class="op" id="2435869">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="2435872">func</span>&nbsp;<span class="op" id="2435877">(</span><span class="ident" id="2435878">e</span>&nbsp;<span class="ident" id="2435880">Errno</span><span class="op" id="2435885">)</span>&nbsp;<span class="ident" id="2435887">Temporary</span><span class="op" id="2435896">(</span><span class="op" id="2435897">)</span>&nbsp;<span class="builtintype" id="2435899">bool</span>&nbsp;<span class="op" id="2435904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435907">return</span>&nbsp;<span class="ident" id="2435914">e</span>&nbsp;<span class="op" id="2435916">==</span>&nbsp;<span class="ident" id="2435919">EINTR</span>&nbsp;<span class="op" id="2435925">||</span>&nbsp;<span class="ident" id="2435928">e</span>&nbsp;<span class="op" id="2435930">==</span>&nbsp;<span class="ident" id="2435933">EMFILE</span>&nbsp;<span class="op" id="2435940">||</span>&nbsp;<span class="ident" id="2435943">e</span>&nbsp;<span class="op" id="2435945">==</span>&nbsp;<span class="ident" id="2435948">ECONNRESET</span>&nbsp;<span class="op" id="2435959">||</span>&nbsp;<span class="ident" id="2435962">e</span>&nbsp;<span class="op" id="2435964">==</span>&nbsp;<span class="ident" id="2435967">ECONNABORTED</span>&nbsp;<span class="op" id="2435980">||</span>&nbsp;<span class="ident" id="2435983">e</span><span class="op" id="2435984">.</span><span class="ident" id="2435985">Timeout</span><span class="op" id="2435992">(</span><span class="op" id="2435993">)</span><br>
<span class="lineno"></span><span class="op" id="2435995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="2435998">func</span>&nbsp;<span class="op" id="2436003">(</span><span class="ident" id="2436004">e</span>&nbsp;<span class="ident" id="2436006">Errno</span><span class="op" id="2436011">)</span>&nbsp;<span class="ident" id="2436013">Timeout</span><span class="op" id="2436020">(</span><span class="op" id="2436021">)</span>&nbsp;<span class="builtintype" id="2436023">bool</span>&nbsp;<span class="op" id="2436028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436031">return</span>&nbsp;<span class="ident" id="2436038">e</span>&nbsp;<span class="op" id="2436040">==</span>&nbsp;<span class="ident" id="2436043">EAGAIN</span>&nbsp;<span class="op" id="2436050">||</span>&nbsp;<span class="ident" id="2436053">e</span>&nbsp;<span class="op" id="2436055">==</span>&nbsp;<span class="ident" id="2436058">EWOULDBLOCK</span>&nbsp;<span class="op" id="2436070">||</span>&nbsp;<span class="ident" id="2436073">e</span>&nbsp;<span class="op" id="2436075">==</span>&nbsp;<span class="ident" id="2436078">ETIMEDOUT</span><br>
<span class="lineno"></span><span class="op" id="2436088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2436091">//&nbsp;A&nbsp;Signal&nbsp;is&nbsp;a&nbsp;number&nbsp;describing&nbsp;a&nbsp;process&nbsp;signal.</span><br>
<span class="lineno">120</span><span class="comment" id="2436144">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;os.Signal&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="2436186">type</span>&nbsp;<span class="ident" id="2436191">Signal</span>&nbsp;<span class="builtintype" id="2436198">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2436203">func</span>&nbsp;<span class="op" id="2436208">(</span><span class="ident" id="2436209">s</span>&nbsp;<span class="ident" id="2436211">Signal</span><span class="op" id="2436217">)</span>&nbsp;<span class="ident" id="2436219">Signal</span><span class="op" id="2436225">(</span><span class="op" id="2436226">)</span>&nbsp;<span class="op" id="2436228">{</span><span class="op" id="2436229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2436232">func</span>&nbsp;<span class="op" id="2436237">(</span><span class="ident" id="2436238">s</span>&nbsp;<span class="ident" id="2436240">Signal</span><span class="op" id="2436246">)</span>&nbsp;<span class="ident" id="2436248">String</span><span class="op" id="2436254">(</span><span class="op" id="2436255">)</span>&nbsp;<span class="builtintype" id="2436257">string</span>&nbsp;<span class="op" id="2436264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436267">if</span>&nbsp;<span class="num" id="2436270">0</span>&nbsp;<span class="op" id="2436272">&lt;=</span>&nbsp;<span class="ident" id="2436275">s</span>&nbsp;<span class="op" id="2436277">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2436280">int</span><span class="op" id="2436283">(</span><span class="ident" id="2436284">s</span><span class="op" id="2436285">)</span>&nbsp;<span class="op" id="2436287">&lt;</span>&nbsp;<span class="builtinfunc" id="2436289">len</span><span class="op" id="2436292">(</span><span class="ident" id="2436293">signals</span><span class="op" id="2436300">)</span>&nbsp;<span class="op" id="2436302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2436306">str</span>&nbsp;<span class="op" id="2436310">:=</span>&nbsp;<span class="ident" id="2436313">signals</span><span class="op" id="2436320">[</span><span class="ident" id="2436321">s</span><span class="op" id="2436322">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436326">if</span>&nbsp;<span class="ident" id="2436329">str</span>&nbsp;<span class="op" id="2436333">!=</span>&nbsp;<span class="string" id="2436336">&#34;&#34;</span>&nbsp;<span class="op" id="2436339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436344">return</span>&nbsp;<span class="ident" id="2436351">str</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2436357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2436360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436363">return</span>&nbsp;<span class="string" id="2436370">&#34;signal&nbsp;&#34;</span>&nbsp;<span class="op" id="2436380">+</span>&nbsp;<span class="ident" id="2436382">itoa</span><span class="op" id="2436386">(</span><span class="builtintype" id="2436387">int</span><span class="op" id="2436390">(</span><span class="ident" id="2436391">s</span><span class="op" id="2436392">)</span><span class="op" id="2436393">)</span><br>
<span class="lineno"></span><span class="op" id="2436395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="2436398">func</span>&nbsp;<span class="ident" id="2436403">Read</span><span class="op" id="2436407">(</span><span class="ident" id="2436408">fd</span>&nbsp;<span class="builtintype" id="2436411">int</span><span class="op" id="2436414">,</span>&nbsp;<span class="ident" id="2436416">p</span>&nbsp;<span class="op" id="2436418">[</span><span class="op" id="2436419">]</span><span class="builtintype" id="2436420">byte</span><span class="op" id="2436424">)</span>&nbsp;<span class="op" id="2436426">(</span><span class="ident" id="2436427">n</span>&nbsp;<span class="builtintype" id="2436429">int</span><span class="op" id="2436432">,</span>&nbsp;<span class="ident" id="2436434">err</span>&nbsp;<span class="builtintype" id="2436438">error</span><span class="op" id="2436443">)</span>&nbsp;<span class="op" id="2436445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2436448">n</span><span class="op" id="2436449">,</span>&nbsp;<span class="ident" id="2436451">err</span>&nbsp;<span class="op" id="2436455">=</span>&nbsp;<span class="ident" id="2436457">read</span><span class="op" id="2436461">(</span><span class="ident" id="2436462">fd</span><span class="op" id="2436464">,</span>&nbsp;<span class="ident" id="2436466">p</span><span class="op" id="2436467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436470">if</span>&nbsp;<span class="ident" id="2436473">raceenabled</span>&nbsp;<span class="op" id="2436485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436489">if</span>&nbsp;<span class="ident" id="2436492">n</span>&nbsp;<span class="op" id="2436494">&gt;</span>&nbsp;<span class="num" id="2436496">0</span>&nbsp;<span class="op" id="2436498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2436503">raceWriteRange</span><span class="op" id="2436517">(</span><span class="ident" id="2436518">unsafe</span><span class="op" id="2436524">.</span><span class="ident" id="2436525">Pointer</span><span class="op" id="2436532">(</span><span class="op" id="2436533">&amp;</span><span class="ident" id="2436534">p</span><span class="op" id="2436535">[</span><span class="num" id="2436536">0</span><span class="op" id="2436537">]</span><span class="op" id="2436538">)</span><span class="op" id="2436539">,</span>&nbsp;<span class="ident" id="2436541">n</span><span class="op" id="2436542">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2436546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436550">if</span>&nbsp;<span class="ident" id="2436553">err</span>&nbsp;<span class="op" id="2436557">==</span>&nbsp;<span class="ident" id="2436560">nil</span>&nbsp;<span class="op" id="2436564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2436569">raceAcquire</span><span class="op" id="2436580">(</span><span class="ident" id="2436581">unsafe</span><span class="op" id="2436587">.</span><span class="ident" id="2436588">Pointer</span><span class="op" id="2436595">(</span><span class="op" id="2436596">&amp;</span><span class="ident" id="2436597">ioSync</span><span class="op" id="2436603">)</span><span class="op" id="2436604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2436608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2436611">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436614">return</span><br>
<span class="lineno"></span><span class="op" id="2436621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2436624">func</span>&nbsp;<span class="ident" id="2436629">Write</span><span class="op" id="2436634">(</span><span class="ident" id="2436635">fd</span>&nbsp;<span class="builtintype" id="2436638">int</span><span class="op" id="2436641">,</span>&nbsp;<span class="ident" id="2436643">p</span>&nbsp;<span class="op" id="2436645">[</span><span class="op" id="2436646">]</span><span class="builtintype" id="2436647">byte</span><span class="op" id="2436651">)</span>&nbsp;<span class="op" id="2436653">(</span><span class="ident" id="2436654">n</span>&nbsp;<span class="builtintype" id="2436656">int</span><span class="op" id="2436659">,</span>&nbsp;<span class="ident" id="2436661">err</span>&nbsp;<span class="builtintype" id="2436665">error</span><span class="op" id="2436670">)</span>&nbsp;<span class="op" id="2436672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436675">if</span>&nbsp;<span class="ident" id="2436678">raceenabled</span>&nbsp;<span class="op" id="2436690">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2436694">raceReleaseMerge</span><span class="op" id="2436710">(</span><span class="ident" id="2436711">unsafe</span><span class="op" id="2436717">.</span><span class="ident" id="2436718">Pointer</span><span class="op" id="2436725">(</span><span class="op" id="2436726">&amp;</span><span class="ident" id="2436727">ioSync</span><span class="op" id="2436733">)</span><span class="op" id="2436734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2436737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2436740">n</span><span class="op" id="2436741">,</span>&nbsp;<span class="ident" id="2436743">err</span>&nbsp;<span class="op" id="2436747">=</span>&nbsp;<span class="ident" id="2436749">write</span><span class="op" id="2436754">(</span><span class="ident" id="2436755">fd</span><span class="op" id="2436757">,</span>&nbsp;<span class="ident" id="2436759">p</span><span class="op" id="2436760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436763">if</span>&nbsp;<span class="ident" id="2436766">raceenabled</span>&nbsp;<span class="op" id="2436778">&amp;&amp;</span>&nbsp;<span class="ident" id="2436781">n</span>&nbsp;<span class="op" id="2436783">&gt;</span>&nbsp;<span class="num" id="2436785">0</span>&nbsp;<span class="op" id="2436787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2436791">raceReadRange</span><span class="op" id="2436804">(</span><span class="ident" id="2436805">unsafe</span><span class="op" id="2436811">.</span><span class="ident" id="2436812">Pointer</span><span class="op" id="2436819">(</span><span class="op" id="2436820">&amp;</span><span class="ident" id="2436821">p</span><span class="op" id="2436822">[</span><span class="num" id="2436823">0</span><span class="op" id="2436824">]</span><span class="op" id="2436825">)</span><span class="op" id="2436826">,</span>&nbsp;<span class="ident" id="2436828">n</span><span class="op" id="2436829">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2436832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436835">return</span><br>
<span class="lineno"></span><span class="op" id="2436842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2436845">//&nbsp;For&nbsp;testing:&nbsp;clients&nbsp;can&nbsp;set&nbsp;this&nbsp;flag&nbsp;to&nbsp;force</span><br>
<span class="lineno">160</span><span class="comment" id="2436896">//&nbsp;creation&nbsp;of&nbsp;IPv6&nbsp;sockets&nbsp;to&nbsp;return&nbsp;EAFNOSUPPORT.</span><br>
<span class="lineno"></span><span class="keyword" id="2436948">var</span>&nbsp;<span class="ident" id="2436952">SocketDisableIPv6</span>&nbsp;<span class="builtintype" id="2436970">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2436976">type</span>&nbsp;<span class="ident" id="2436981">Sockaddr</span>&nbsp;<span class="keyword" id="2436990">interface</span>&nbsp;<span class="op" id="2437000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437003">sockaddr</span><span class="op" id="2437011">(</span><span class="op" id="2437012">)</span>&nbsp;<span class="op" id="2437014">(</span><span class="ident" id="2437015">ptr</span>&nbsp;<span class="ident" id="2437019">unsafe</span><span class="op" id="2437025">.</span><span class="ident" id="2437026">Pointer</span><span class="op" id="2437033">,</span>&nbsp;<span class="builtinfunc" id="2437035">len</span>&nbsp;<span class="ident" id="2437039">_Socklen</span><span class="op" id="2437047">,</span>&nbsp;<span class="ident" id="2437049">err</span>&nbsp;<span class="builtintype" id="2437053">error</span><span class="op" id="2437058">)</span>&nbsp;<span class="comment" id="2437060">//&nbsp;lowercase;&nbsp;only&nbsp;we&nbsp;can&nbsp;define&nbsp;Sockaddrs</span><br>
<span class="lineno">165</span><span class="op" id="2437103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2437106">type</span>&nbsp;<span class="ident" id="2437111">SockaddrInet4</span>&nbsp;<span class="keyword" id="2437125">struct</span>&nbsp;<span class="op" id="2437132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437135">Port</span>&nbsp;<span class="builtintype" id="2437140">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437145">Addr</span>&nbsp;<span class="op" id="2437150">[</span><span class="num" id="2437151">4</span><span class="op" id="2437152">]</span><span class="builtintype" id="2437153">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437159">raw</span>&nbsp;&nbsp;<span class="ident" id="2437164">RawSockaddrInet4</span><br>
<span class="lineno"></span><span class="op" id="2437181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2437184">type</span>&nbsp;<span class="ident" id="2437189">SockaddrInet6</span>&nbsp;<span class="keyword" id="2437203">struct</span>&nbsp;<span class="op" id="2437210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437213">Port</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2437220">int</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437225">ZoneId</span>&nbsp;<span class="builtintype" id="2437232">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437240">Addr</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2437247">[</span><span class="num" id="2437248">16</span><span class="op" id="2437250">]</span><span class="builtintype" id="2437251">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437257">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2437264">RawSockaddrInet6</span><br>
<span class="lineno"></span><span class="op" id="2437281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="2437284">type</span>&nbsp;<span class="ident" id="2437289">SockaddrUnix</span>&nbsp;<span class="keyword" id="2437302">struct</span>&nbsp;<span class="op" id="2437309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437312">Name</span>&nbsp;<span class="builtintype" id="2437317">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437325">raw</span>&nbsp;&nbsp;<span class="ident" id="2437330">RawSockaddrUnix</span><br>
<span class="lineno"></span><span class="op" id="2437346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="2437349">func</span>&nbsp;<span class="ident" id="2437354">Bind</span><span class="op" id="2437358">(</span><span class="ident" id="2437359">fd</span>&nbsp;<span class="builtintype" id="2437362">int</span><span class="op" id="2437365">,</span>&nbsp;<span class="ident" id="2437367">sa</span>&nbsp;<span class="ident" id="2437370">Sockaddr</span><span class="op" id="2437378">)</span>&nbsp;<span class="op" id="2437380">(</span><span class="ident" id="2437381">err</span>&nbsp;<span class="builtintype" id="2437385">error</span><span class="op" id="2437390">)</span>&nbsp;<span class="op" id="2437392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437395">ptr</span><span class="op" id="2437398">,</span>&nbsp;<span class="ident" id="2437400">n</span><span class="op" id="2437401">,</span>&nbsp;<span class="ident" id="2437403">err</span>&nbsp;<span class="op" id="2437407">:=</span>&nbsp;<span class="ident" id="2437410">sa</span><span class="op" id="2437412">.</span><span class="ident" id="2437413">sockaddr</span><span class="op" id="2437421">(</span><span class="op" id="2437422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437425">if</span>&nbsp;<span class="ident" id="2437428">err</span>&nbsp;<span class="op" id="2437432">!=</span>&nbsp;<span class="ident" id="2437435">nil</span>&nbsp;<span class="op" id="2437439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437443">return</span>&nbsp;<span class="ident" id="2437450">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2437455">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437458">return</span>&nbsp;<span class="ident" id="2437465">bind</span><span class="op" id="2437469">(</span><span class="ident" id="2437470">fd</span><span class="op" id="2437472">,</span>&nbsp;<span class="ident" id="2437474">ptr</span><span class="op" id="2437477">,</span>&nbsp;<span class="ident" id="2437479">n</span><span class="op" id="2437480">)</span><br>
<span class="lineno"></span><span class="op" id="2437482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2437485">func</span>&nbsp;<span class="ident" id="2437490">Connect</span><span class="op" id="2437497">(</span><span class="ident" id="2437498">fd</span>&nbsp;<span class="builtintype" id="2437501">int</span><span class="op" id="2437504">,</span>&nbsp;<span class="ident" id="2437506">sa</span>&nbsp;<span class="ident" id="2437509">Sockaddr</span><span class="op" id="2437517">)</span>&nbsp;<span class="op" id="2437519">(</span><span class="ident" id="2437520">err</span>&nbsp;<span class="builtintype" id="2437524">error</span><span class="op" id="2437529">)</span>&nbsp;<span class="op" id="2437531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437534">ptr</span><span class="op" id="2437537">,</span>&nbsp;<span class="ident" id="2437539">n</span><span class="op" id="2437540">,</span>&nbsp;<span class="ident" id="2437542">err</span>&nbsp;<span class="op" id="2437546">:=</span>&nbsp;<span class="ident" id="2437549">sa</span><span class="op" id="2437551">.</span><span class="ident" id="2437552">sockaddr</span><span class="op" id="2437560">(</span><span class="op" id="2437561">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437564">if</span>&nbsp;<span class="ident" id="2437567">err</span>&nbsp;<span class="op" id="2437571">!=</span>&nbsp;<span class="ident" id="2437574">nil</span>&nbsp;<span class="op" id="2437578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437582">return</span>&nbsp;<span class="ident" id="2437589">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2437594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437597">return</span>&nbsp;<span class="ident" id="2437604">connect</span><span class="op" id="2437611">(</span><span class="ident" id="2437612">fd</span><span class="op" id="2437614">,</span>&nbsp;<span class="ident" id="2437616">ptr</span><span class="op" id="2437619">,</span>&nbsp;<span class="ident" id="2437621">n</span><span class="op" id="2437622">)</span><br>
<span class="lineno"></span><span class="op" id="2437624">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="2437627">func</span>&nbsp;<span class="ident" id="2437632">Getpeername</span><span class="op" id="2437643">(</span><span class="ident" id="2437644">fd</span>&nbsp;<span class="builtintype" id="2437647">int</span><span class="op" id="2437650">)</span>&nbsp;<span class="op" id="2437652">(</span><span class="ident" id="2437653">sa</span>&nbsp;<span class="ident" id="2437656">Sockaddr</span><span class="op" id="2437664">,</span>&nbsp;<span class="ident" id="2437666">err</span>&nbsp;<span class="builtintype" id="2437670">error</span><span class="op" id="2437675">)</span>&nbsp;<span class="op" id="2437677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437680">var</span>&nbsp;<span class="ident" id="2437684">rsa</span>&nbsp;<span class="ident" id="2437688">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437704">var</span>&nbsp;<span class="builtinfunc" id="2437708">len</span>&nbsp;<span class="ident" id="2437712">_Socklen</span>&nbsp;<span class="op" id="2437721">=</span>&nbsp;<span class="ident" id="2437723">SizeofSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437742">if</span>&nbsp;<span class="ident" id="2437745">err</span>&nbsp;<span class="op" id="2437749">=</span>&nbsp;<span class="ident" id="2437751">getpeername</span><span class="op" id="2437762">(</span><span class="ident" id="2437763">fd</span><span class="op" id="2437765">,</span>&nbsp;<span class="op" id="2437767">&amp;</span><span class="ident" id="2437768">rsa</span><span class="op" id="2437771">,</span>&nbsp;<span class="op" id="2437773">&amp;</span><span class="builtinfunc" id="2437774">len</span><span class="op" id="2437777">)</span><span class="op" id="2437778">;</span>&nbsp;<span class="ident" id="2437780">err</span>&nbsp;<span class="op" id="2437784">!=</span>&nbsp;<span class="ident" id="2437787">nil</span>&nbsp;<span class="op" id="2437791">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437795">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2437803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437806">return</span>&nbsp;<span class="ident" id="2437813">anyToSockaddr</span><span class="op" id="2437826">(</span><span class="op" id="2437827">&amp;</span><span class="ident" id="2437828">rsa</span><span class="op" id="2437831">)</span><br>
<span class="lineno"></span><span class="op" id="2437833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2437836">func</span>&nbsp;<span class="ident" id="2437841">GetsockoptInt</span><span class="op" id="2437854">(</span><span class="ident" id="2437855">fd</span><span class="op" id="2437857">,</span>&nbsp;<span class="ident" id="2437859">level</span><span class="op" id="2437864">,</span>&nbsp;<span class="ident" id="2437866">opt</span>&nbsp;<span class="builtintype" id="2437870">int</span><span class="op" id="2437873">)</span>&nbsp;<span class="op" id="2437875">(</span><span class="ident" id="2437876">value</span>&nbsp;<span class="builtintype" id="2437882">int</span><span class="op" id="2437885">,</span>&nbsp;<span class="ident" id="2437887">err</span>&nbsp;<span class="builtintype" id="2437891">error</span><span class="op" id="2437896">)</span>&nbsp;<span class="op" id="2437898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2437901">var</span>&nbsp;<span class="ident" id="2437905">n</span>&nbsp;<span class="builtintype" id="2437907">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437914">vallen</span>&nbsp;<span class="op" id="2437921">:=</span>&nbsp;<span class="ident" id="2437924">_Socklen</span><span class="op" id="2437932">(</span><span class="num" id="2437933">4</span><span class="op" id="2437934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2437937">err</span>&nbsp;<span class="op" id="2437941">=</span>&nbsp;<span class="ident" id="2437943">getsockopt</span><span class="op" id="2437953">(</span><span class="ident" id="2437954">fd</span><span class="op" id="2437956">,</span>&nbsp;<span class="ident" id="2437958">level</span><span class="op" id="2437963">,</span>&nbsp;<span class="ident" id="2437965">opt</span><span class="op" id="2437968">,</span>&nbsp;<span class="ident" id="2437970">unsafe</span><span class="op" id="2437976">.</span><span class="ident" id="2437977">Pointer</span><span class="op" id="2437984">(</span><span class="op" id="2437985">&amp;</span><span class="ident" id="2437986">n</span><span class="op" id="2437987">)</span><span class="op" id="2437988">,</span>&nbsp;<span class="op" id="2437990">&amp;</span><span class="ident" id="2437991">vallen</span><span class="op" id="2437997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438000">return</span>&nbsp;<span class="builtintype" id="2438007">int</span><span class="op" id="2438010">(</span><span class="ident" id="2438011">n</span><span class="op" id="2438012">)</span><span class="op" id="2438013">,</span>&nbsp;<span class="ident" id="2438015">err</span><br>
<span class="lineno">215</span><span class="op" id="2438019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2438022">func</span>&nbsp;<span class="ident" id="2438027">Recvfrom</span><span class="op" id="2438035">(</span><span class="ident" id="2438036">fd</span>&nbsp;<span class="builtintype" id="2438039">int</span><span class="op" id="2438042">,</span>&nbsp;<span class="ident" id="2438044">p</span>&nbsp;<span class="op" id="2438046">[</span><span class="op" id="2438047">]</span><span class="builtintype" id="2438048">byte</span><span class="op" id="2438052">,</span>&nbsp;<span class="ident" id="2438054">flags</span>&nbsp;<span class="builtintype" id="2438060">int</span><span class="op" id="2438063">)</span>&nbsp;<span class="op" id="2438065">(</span><span class="ident" id="2438066">n</span>&nbsp;<span class="builtintype" id="2438068">int</span><span class="op" id="2438071">,</span>&nbsp;<span class="ident" id="2438073">from</span>&nbsp;<span class="ident" id="2438078">Sockaddr</span><span class="op" id="2438086">,</span>&nbsp;<span class="ident" id="2438088">err</span>&nbsp;<span class="builtintype" id="2438092">error</span><span class="op" id="2438097">)</span>&nbsp;<span class="op" id="2438099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438102">var</span>&nbsp;<span class="ident" id="2438106">rsa</span>&nbsp;<span class="ident" id="2438110">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438126">var</span>&nbsp;<span class="builtinfunc" id="2438130">len</span>&nbsp;<span class="ident" id="2438134">_Socklen</span>&nbsp;<span class="op" id="2438143">=</span>&nbsp;<span class="ident" id="2438145">SizeofSockaddrAny</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438164">if</span>&nbsp;<span class="ident" id="2438167">n</span><span class="op" id="2438168">,</span>&nbsp;<span class="ident" id="2438170">err</span>&nbsp;<span class="op" id="2438174">=</span>&nbsp;<span class="ident" id="2438176">recvfrom</span><span class="op" id="2438184">(</span><span class="ident" id="2438185">fd</span><span class="op" id="2438187">,</span>&nbsp;<span class="ident" id="2438189">p</span><span class="op" id="2438190">,</span>&nbsp;<span class="ident" id="2438192">flags</span><span class="op" id="2438197">,</span>&nbsp;<span class="op" id="2438199">&amp;</span><span class="ident" id="2438200">rsa</span><span class="op" id="2438203">,</span>&nbsp;<span class="op" id="2438205">&amp;</span><span class="builtinfunc" id="2438206">len</span><span class="op" id="2438209">)</span><span class="op" id="2438210">;</span>&nbsp;<span class="ident" id="2438212">err</span>&nbsp;<span class="op" id="2438216">!=</span>&nbsp;<span class="ident" id="2438219">nil</span>&nbsp;<span class="op" id="2438223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438227">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2438235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438238">if</span>&nbsp;<span class="ident" id="2438241">rsa</span><span class="op" id="2438244">.</span><span class="ident" id="2438245">Addr</span><span class="op" id="2438249">.</span><span class="ident" id="2438250">Family</span>&nbsp;<span class="op" id="2438257">!=</span>&nbsp;<span class="ident" id="2438260">AF_UNSPEC</span>&nbsp;<span class="op" id="2438270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2438274">from</span><span class="op" id="2438278">,</span>&nbsp;<span class="ident" id="2438280">err</span>&nbsp;<span class="op" id="2438284">=</span>&nbsp;<span class="ident" id="2438286">anyToSockaddr</span><span class="op" id="2438299">(</span><span class="op" id="2438300">&amp;</span><span class="ident" id="2438301">rsa</span><span class="op" id="2438304">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2438307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438310">return</span><br>
<span class="lineno"></span><span class="op" id="2438317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2438320">func</span>&nbsp;<span class="ident" id="2438325">Sendto</span><span class="op" id="2438331">(</span><span class="ident" id="2438332">fd</span>&nbsp;<span class="builtintype" id="2438335">int</span><span class="op" id="2438338">,</span>&nbsp;<span class="ident" id="2438340">p</span>&nbsp;<span class="op" id="2438342">[</span><span class="op" id="2438343">]</span><span class="builtintype" id="2438344">byte</span><span class="op" id="2438348">,</span>&nbsp;<span class="ident" id="2438350">flags</span>&nbsp;<span class="builtintype" id="2438356">int</span><span class="op" id="2438359">,</span>&nbsp;<span class="ident" id="2438361">to</span>&nbsp;<span class="ident" id="2438364">Sockaddr</span><span class="op" id="2438372">)</span>&nbsp;<span class="op" id="2438374">(</span><span class="ident" id="2438375">err</span>&nbsp;<span class="builtintype" id="2438379">error</span><span class="op" id="2438384">)</span>&nbsp;<span class="op" id="2438386">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2438389">ptr</span><span class="op" id="2438392">,</span>&nbsp;<span class="ident" id="2438394">n</span><span class="op" id="2438395">,</span>&nbsp;<span class="ident" id="2438397">err</span>&nbsp;<span class="op" id="2438401">:=</span>&nbsp;<span class="ident" id="2438404">to</span><span class="op" id="2438406">.</span><span class="ident" id="2438407">sockaddr</span><span class="op" id="2438415">(</span><span class="op" id="2438416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438419">if</span>&nbsp;<span class="ident" id="2438422">err</span>&nbsp;<span class="op" id="2438426">!=</span>&nbsp;<span class="ident" id="2438429">nil</span>&nbsp;<span class="op" id="2438433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438437">return</span>&nbsp;<span class="ident" id="2438444">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2438449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438452">return</span>&nbsp;<span class="ident" id="2438459">sendto</span><span class="op" id="2438465">(</span><span class="ident" id="2438466">fd</span><span class="op" id="2438468">,</span>&nbsp;<span class="ident" id="2438470">p</span><span class="op" id="2438471">,</span>&nbsp;<span class="ident" id="2438473">flags</span><span class="op" id="2438478">,</span>&nbsp;<span class="ident" id="2438480">ptr</span><span class="op" id="2438483">,</span>&nbsp;<span class="ident" id="2438485">n</span><span class="op" id="2438486">)</span><br>
<span class="lineno">235</span><span class="op" id="2438488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2438491">func</span>&nbsp;<span class="ident" id="2438496">SetsockoptByte</span><span class="op" id="2438510">(</span><span class="ident" id="2438511">fd</span><span class="op" id="2438513">,</span>&nbsp;<span class="ident" id="2438515">level</span><span class="op" id="2438520">,</span>&nbsp;<span class="ident" id="2438522">opt</span>&nbsp;<span class="builtintype" id="2438526">int</span><span class="op" id="2438529">,</span>&nbsp;<span class="ident" id="2438531">value</span>&nbsp;<span class="builtintype" id="2438537">byte</span><span class="op" id="2438541">)</span>&nbsp;<span class="op" id="2438543">(</span><span class="ident" id="2438544">err</span>&nbsp;<span class="builtintype" id="2438548">error</span><span class="op" id="2438553">)</span>&nbsp;<span class="op" id="2438555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438558">return</span>&nbsp;<span class="ident" id="2438565">setsockopt</span><span class="op" id="2438575">(</span><span class="ident" id="2438576">fd</span><span class="op" id="2438578">,</span>&nbsp;<span class="ident" id="2438580">level</span><span class="op" id="2438585">,</span>&nbsp;<span class="ident" id="2438587">opt</span><span class="op" id="2438590">,</span>&nbsp;<span class="ident" id="2438592">unsafe</span><span class="op" id="2438598">.</span><span class="ident" id="2438599">Pointer</span><span class="op" id="2438606">(</span><span class="op" id="2438607">&amp;</span><span class="ident" id="2438608">value</span><span class="op" id="2438613">)</span><span class="op" id="2438614">,</span>&nbsp;<span class="num" id="2438616">1</span><span class="op" id="2438617">)</span><br>
<span class="lineno"></span><span class="op" id="2438619">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="2438622">func</span>&nbsp;<span class="ident" id="2438627">SetsockoptInt</span><span class="op" id="2438640">(</span><span class="ident" id="2438641">fd</span><span class="op" id="2438643">,</span>&nbsp;<span class="ident" id="2438645">level</span><span class="op" id="2438650">,</span>&nbsp;<span class="ident" id="2438652">opt</span>&nbsp;<span class="builtintype" id="2438656">int</span><span class="op" id="2438659">,</span>&nbsp;<span class="ident" id="2438661">value</span>&nbsp;<span class="builtintype" id="2438667">int</span><span class="op" id="2438670">)</span>&nbsp;<span class="op" id="2438672">(</span><span class="ident" id="2438673">err</span>&nbsp;<span class="builtintype" id="2438677">error</span><span class="op" id="2438682">)</span>&nbsp;<span class="op" id="2438684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438687">var</span>&nbsp;<span class="ident" id="2438691">n</span>&nbsp;<span class="op" id="2438693">=</span>&nbsp;<span class="builtintype" id="2438695">int32</span><span class="op" id="2438700">(</span><span class="ident" id="2438701">value</span><span class="op" id="2438706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438709">return</span>&nbsp;<span class="ident" id="2438716">setsockopt</span><span class="op" id="2438726">(</span><span class="ident" id="2438727">fd</span><span class="op" id="2438729">,</span>&nbsp;<span class="ident" id="2438731">level</span><span class="op" id="2438736">,</span>&nbsp;<span class="ident" id="2438738">opt</span><span class="op" id="2438741">,</span>&nbsp;<span class="ident" id="2438743">unsafe</span><span class="op" id="2438749">.</span><span class="ident" id="2438750">Pointer</span><span class="op" id="2438757">(</span><span class="op" id="2438758">&amp;</span><span class="ident" id="2438759">n</span><span class="op" id="2438760">)</span><span class="op" id="2438761">,</span>&nbsp;<span class="num" id="2438763">4</span><span class="op" id="2438764">)</span><br>
<span class="lineno"></span><span class="op" id="2438766">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="2438769">func</span>&nbsp;<span class="ident" id="2438774">SetsockoptInet4Addr</span><span class="op" id="2438793">(</span><span class="ident" id="2438794">fd</span><span class="op" id="2438796">,</span>&nbsp;<span class="ident" id="2438798">level</span><span class="op" id="2438803">,</span>&nbsp;<span class="ident" id="2438805">opt</span>&nbsp;<span class="builtintype" id="2438809">int</span><span class="op" id="2438812">,</span>&nbsp;<span class="ident" id="2438814">value</span>&nbsp;<span class="op" id="2438820">[</span><span class="num" id="2438821">4</span><span class="op" id="2438822">]</span><span class="builtintype" id="2438823">byte</span><span class="op" id="2438827">)</span>&nbsp;<span class="op" id="2438829">(</span><span class="ident" id="2438830">err</span>&nbsp;<span class="builtintype" id="2438834">error</span><span class="op" id="2438839">)</span>&nbsp;<span class="op" id="2438841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438844">return</span>&nbsp;<span class="ident" id="2438851">setsockopt</span><span class="op" id="2438861">(</span><span class="ident" id="2438862">fd</span><span class="op" id="2438864">,</span>&nbsp;<span class="ident" id="2438866">level</span><span class="op" id="2438871">,</span>&nbsp;<span class="ident" id="2438873">opt</span><span class="op" id="2438876">,</span>&nbsp;<span class="ident" id="2438878">unsafe</span><span class="op" id="2438884">.</span><span class="ident" id="2438885">Pointer</span><span class="op" id="2438892">(</span><span class="op" id="2438893">&amp;</span><span class="ident" id="2438894">value</span><span class="op" id="2438899">[</span><span class="num" id="2438900">0</span><span class="op" id="2438901">]</span><span class="op" id="2438902">)</span><span class="op" id="2438903">,</span>&nbsp;<span class="num" id="2438905">4</span><span class="op" id="2438906">)</span><br>
<span class="lineno"></span><span class="op" id="2438908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="2438911">func</span>&nbsp;<span class="ident" id="2438916">SetsockoptIPMreq</span><span class="op" id="2438932">(</span><span class="ident" id="2438933">fd</span><span class="op" id="2438935">,</span>&nbsp;<span class="ident" id="2438937">level</span><span class="op" id="2438942">,</span>&nbsp;<span class="ident" id="2438944">opt</span>&nbsp;<span class="builtintype" id="2438948">int</span><span class="op" id="2438951">,</span>&nbsp;<span class="ident" id="2438953">mreq</span>&nbsp;<span class="op" id="2438958">*</span><span class="ident" id="2438959">IPMreq</span><span class="op" id="2438965">)</span>&nbsp;<span class="op" id="2438967">(</span><span class="ident" id="2438968">err</span>&nbsp;<span class="builtintype" id="2438972">error</span><span class="op" id="2438977">)</span>&nbsp;<span class="op" id="2438979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2438982">return</span>&nbsp;<span class="ident" id="2438989">setsockopt</span><span class="op" id="2438999">(</span><span class="ident" id="2439000">fd</span><span class="op" id="2439002">,</span>&nbsp;<span class="ident" id="2439004">level</span><span class="op" id="2439009">,</span>&nbsp;<span class="ident" id="2439011">opt</span><span class="op" id="2439014">,</span>&nbsp;<span class="ident" id="2439016">unsafe</span><span class="op" id="2439022">.</span><span class="ident" id="2439023">Pointer</span><span class="op" id="2439030">(</span><span class="ident" id="2439031">mreq</span><span class="op" id="2439035">)</span><span class="op" id="2439036">,</span>&nbsp;<span class="ident" id="2439038">SizeofIPMreq</span><span class="op" id="2439050">)</span><br>
<span class="lineno"></span><span class="op" id="2439052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2439055">func</span>&nbsp;<span class="ident" id="2439060">SetsockoptIPv6Mreq</span><span class="op" id="2439078">(</span><span class="ident" id="2439079">fd</span><span class="op" id="2439081">,</span>&nbsp;<span class="ident" id="2439083">level</span><span class="op" id="2439088">,</span>&nbsp;<span class="ident" id="2439090">opt</span>&nbsp;<span class="builtintype" id="2439094">int</span><span class="op" id="2439097">,</span>&nbsp;<span class="ident" id="2439099">mreq</span>&nbsp;<span class="op" id="2439104">*</span><span class="ident" id="2439105">IPv6Mreq</span><span class="op" id="2439113">)</span>&nbsp;<span class="op" id="2439115">(</span><span class="ident" id="2439116">err</span>&nbsp;<span class="builtintype" id="2439120">error</span><span class="op" id="2439125">)</span>&nbsp;<span class="op" id="2439127">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2439130">return</span>&nbsp;<span class="ident" id="2439137">setsockopt</span><span class="op" id="2439147">(</span><span class="ident" id="2439148">fd</span><span class="op" id="2439150">,</span>&nbsp;<span class="ident" id="2439152">level</span><span class="op" id="2439157">,</span>&nbsp;<span class="ident" id="2439159">opt</span><span class="op" id="2439162">,</span>&nbsp;<span class="ident" id="2439164">unsafe</span><span class="op" id="2439170">.</span><span class="ident" id="2439171">Pointer</span><span class="op" id="2439178">(</span><span class="ident" id="2439179">mreq</span><span class="op" id="2439183">)</span><span class="op" id="2439184">,</span>&nbsp;<span class="ident" id="2439186">SizeofIPv6Mreq</span><span class="op" id="2439200">)</span><br>
<span class="lineno"></span><span class="op" id="2439202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2439205">func</span>&nbsp;<span class="ident" id="2439210">SetsockoptICMPv6Filter</span><span class="op" id="2439232">(</span><span class="ident" id="2439233">fd</span><span class="op" id="2439235">,</span>&nbsp;<span class="ident" id="2439237">level</span><span class="op" id="2439242">,</span>&nbsp;<span class="ident" id="2439244">opt</span>&nbsp;<span class="builtintype" id="2439248">int</span><span class="op" id="2439251">,</span>&nbsp;<span class="ident" id="2439253">filter</span>&nbsp;<span class="op" id="2439260">*</span><span class="ident" id="2439261">ICMPv6Filter</span><span class="op" id="2439273">)</span>&nbsp;<span class="builtintype" id="2439275">error</span>&nbsp;<span class="op" id="2439281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2439284">return</span>&nbsp;<span class="ident" id="2439291">setsockopt</span><span class="op" id="2439301">(</span><span class="ident" id="2439302">fd</span><span class="op" id="2439304">,</span>&nbsp;<span class="ident" id="2439306">level</span><span class="op" id="2439311">,</span>&nbsp;<span class="ident" id="2439313">opt</span><span class="op" id="2439316">,</span>&nbsp;<span class="ident" id="2439318">unsafe</span><span class="op" id="2439324">.</span><span class="ident" id="2439325">Pointer</span><span class="op" id="2439332">(</span><span class="ident" id="2439333">filter</span><span class="op" id="2439339">)</span><span class="op" id="2439340">,</span>&nbsp;<span class="ident" id="2439342">SizeofICMPv6Filter</span><span class="op" id="2439360">)</span><br>
<span class="lineno">260</span><span class="op" id="2439362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2439365">func</span>&nbsp;<span class="ident" id="2439370">SetsockoptLinger</span><span class="op" id="2439386">(</span><span class="ident" id="2439387">fd</span><span class="op" id="2439389">,</span>&nbsp;<span class="ident" id="2439391">level</span><span class="op" id="2439396">,</span>&nbsp;<span class="ident" id="2439398">opt</span>&nbsp;<span class="builtintype" id="2439402">int</span><span class="op" id="2439405">,</span>&nbsp;<span class="ident" id="2439407">l</span>&nbsp;<span class="op" id="2439409">*</span><span class="ident" id="2439410">Linger</span><span class="op" id="2439416">)</span>&nbsp;<span class="op" id="2439418">(</span><span class="ident" id="2439419">err</span>&nbsp;<span class="builtintype" id="2439423">error</span><span class="op" id="2439428">)</span>&nbsp;<span class="op" id="2439430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2439433">return</span>&nbsp;<span class="ident" id="2439440">setsockopt</span><span class="op" id="2439450">(</span><span class="ident" id="2439451">fd</span><span class="op" id="2439453">,</span>&nbsp;<span class="ident" id="2439455">level</span><span class="op" id="2439460">,</span>&nbsp;<span class="ident" id="2439462">opt</span><span class="op" id="2439465">,</span>&nbsp;<span class="ident" id="2439467">unsafe</span><span class="op" id="2439473">.</span><span class="ident" id="2439474">Pointer</span><span class="op" id="2439481">(</span><span class="ident" id="2439482">l</span><span class="op" id="2439483">)</span><span class="op" id="2439484">,</span>&nbsp;<span class="ident" id="2439486">SizeofLinger</span><span class="op" id="2439498">)</span><br>
<span class="lineno"></span><span class="op" id="2439500">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="2439503">func</span>&nbsp;<span class="ident" id="2439508">SetsockoptString</span><span class="op" id="2439524">(</span><span class="ident" id="2439525">fd</span><span class="op" id="2439527">,</span>&nbsp;<span class="ident" id="2439529">level</span><span class="op" id="2439534">,</span>&nbsp;<span class="ident" id="2439536">opt</span>&nbsp;<span class="builtintype" id="2439540">int</span><span class="op" id="2439543">,</span>&nbsp;<span class="ident" id="2439545">s</span>&nbsp;<span class="builtintype" id="2439547">string</span><span class="op" id="2439553">)</span>&nbsp;<span class="op" id="2439555">(</span><span class="ident" id="2439556">err</span>&nbsp;<span class="builtintype" id="2439560">error</span><span class="op" id="2439565">)</span>&nbsp;<span class="op" id="2439567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2439570">return</span>&nbsp;<span class="ident" id="2439577">setsockopt</span><span class="op" id="2439587">(</span><span class="ident" id="2439588">fd</span><span class="op" id="2439590">,</span>&nbsp;<span class="ident" id="2439592">level</span><span class="op" id="2439597">,</span>&nbsp;<span class="ident" id="2439599">opt</span><span class="op" id="2439602">,</span>&nbsp;<span class="ident" id="2439604">unsafe</span><span class="op" id="2439610">.</span><span class="ident" id="2439611">Pointer</span><span class="op" id="2439618">(</span><span class="op" id="2439619">&amp;</span><span class="op" id="2439620">[</span><span class="op" id="2439621">]</span><span class="builtintype" id="2439622">byte</span><span class="op" id="2439626">(</span><span class="ident" id="2439627">s</span><span class="op" id="2439628">)</span><span class="op" id="2439629">[</span><span class="num" id="2439630">0</span><span class="op" id="2439631">]</span><span class="op" id="2439632">)</span><span class="op" id="2439633">,</span>&nbsp;<span class="builtintype" id="2439635">uintptr</span><span class="op" id="2439642">(</span><span class="builtinfunc" id="2439643">len</span><span class="op" id="2439646">(</span><span class="ident" id="2439647">s</span><span class="op" id="2439648">)</span><span class="op" id="2439649">)</span><span class="op" id="2439650">)</span><br>
<span class="lineno"></span><span class="op" id="2439652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="2439655">func</span>&nbsp;<span class="ident" id="2439660">SetsockoptTimeval</span><span class="op" id="2439677">(</span><span class="ident" id="2439678">fd</span><span class="op" id="2439680">,</span>&nbsp;<span class="ident" id="2439682">level</span><span class="op" id="2439687">,</span>&nbsp;<span class="ident" id="2439689">opt</span>&nbsp;<span class="builtintype" id="2439693">int</span><span class="op" id="2439696">,</span>&nbsp;<span class="ident" id="2439698">tv</span>&nbsp;<span class="op" id="2439701">*</span><span class="ident" id="2439702">Timeval</span><span class="op" id="2439709">)</span>&nbsp;<span class="op" id="2439711">(</span><span class="ident" id="2439712">err</span>&nbsp;<span class="builtintype" id="2439716">error</span><span class="op" id="2439721">)</span>&nbsp;<span class="op" id="2439723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2439726">return</span>&nbsp;<span class="ident" id="2439733">setsockopt</span><span class="op" id="2439743">(</span><span class="ident" id="2439744">fd</span><span class="op" id="2439746">,</span>&nbsp;<span class="ident" id="2439748">level</span><span class="op" id="2439753">,</span>&nbsp;<span class="ident" id="2439755">opt</span><span class="op" id="2439758">,</span>&nbsp;<span class="ident" id="2439760">unsafe</span><span class="op" id="2439766">.</span><span class="ident" id="2439767">Pointer</span><span class="op" id="2439774">(</span><span class="ident" id="2439775">tv</span><span class="op" id="2439777">)</span><span class="op" id="2439778">,</span>&nbsp;<span class="ident" id="2439780">unsafe</span><span class="op" id="2439786">.</span><span class="ident" id="2439787">Sizeof</span><span class="op" id="2439793">(</span><span class="op" id="2439794">*</span><span class="ident" id="2439795">tv</span><span class="op" id="2439797">)</span><span class="op" id="2439798">)</span><br>
<span class="lineno"></span><span class="op" id="2439800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2439803">func</span>&nbsp;<span class="ident" id="2439808">Socket</span><span class="op" id="2439814">(</span><span class="ident" id="2439815">domain</span><span class="op" id="2439821">,</span>&nbsp;<span class="ident" id="2439823">typ</span><span class="op" id="2439826">,</span>&nbsp;<span class="ident" id="2439828">proto</span>&nbsp;<span class="builtintype" id="2439834">int</span><span class="op" id="2439837">)</span>&nbsp;<span class="op" id="2439839">(</span><span class="ident" id="2439840">fd</span>&nbsp;<span class="builtintype" id="2439843">int</span><span class="op" id="2439846">,</span>&nbsp;<span class="ident" id="2439848">err</span>&nbsp;<span class="builtintype" id="2439852">error</span><span class="op" id="2439857">)</span>&nbsp;<span class="op" id="2439859">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2439862">if</span>&nbsp;<span class="ident" id="2439865">domain</span>&nbsp;<span class="op" id="2439872">==</span>&nbsp;<span class="ident" id="2439875">AF_INET6</span>&nbsp;<span class="op" id="2439884">&amp;&amp;</span>&nbsp;<span class="ident" id="2439887">SocketDisableIPv6</span>&nbsp;<span class="op" id="2439905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2439909">return</span>&nbsp;<span class="op" id="2439916">-</span><span class="num" id="2439917">1</span><span class="op" id="2439918">,</span>&nbsp;<span class="ident" id="2439920">EAFNOSUPPORT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2439934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2439937">fd</span><span class="op" id="2439939">,</span>&nbsp;<span class="ident" id="2439941">err</span>&nbsp;<span class="op" id="2439945">=</span>&nbsp;<span class="ident" id="2439947">socket</span><span class="op" id="2439953">(</span><span class="ident" id="2439954">domain</span><span class="op" id="2439960">,</span>&nbsp;<span class="ident" id="2439962">typ</span><span class="op" id="2439965">,</span>&nbsp;<span class="ident" id="2439967">proto</span><span class="op" id="2439972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2439975">return</span><br>
<span class="lineno">280</span><span class="op" id="2439982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2439985">func</span>&nbsp;<span class="ident" id="2439990">Socketpair</span><span class="op" id="2440000">(</span><span class="ident" id="2440001">domain</span><span class="op" id="2440007">,</span>&nbsp;<span class="ident" id="2440009">typ</span><span class="op" id="2440012">,</span>&nbsp;<span class="ident" id="2440014">proto</span>&nbsp;<span class="builtintype" id="2440020">int</span><span class="op" id="2440023">)</span>&nbsp;<span class="op" id="2440025">(</span><span class="ident" id="2440026">fd</span>&nbsp;<span class="op" id="2440029">[</span><span class="num" id="2440030">2</span><span class="op" id="2440031">]</span><span class="builtintype" id="2440032">int</span><span class="op" id="2440035">,</span>&nbsp;<span class="ident" id="2440037">err</span>&nbsp;<span class="builtintype" id="2440041">error</span><span class="op" id="2440046">)</span>&nbsp;<span class="op" id="2440048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2440051">var</span>&nbsp;<span class="ident" id="2440055">fdx</span>&nbsp;<span class="op" id="2440059">[</span><span class="num" id="2440060">2</span><span class="op" id="2440061">]</span><span class="builtintype" id="2440062">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2440069">err</span>&nbsp;<span class="op" id="2440073">=</span>&nbsp;<span class="ident" id="2440075">socketpair</span><span class="op" id="2440085">(</span><span class="ident" id="2440086">domain</span><span class="op" id="2440092">,</span>&nbsp;<span class="ident" id="2440094">typ</span><span class="op" id="2440097">,</span>&nbsp;<span class="ident" id="2440099">proto</span><span class="op" id="2440104">,</span>&nbsp;<span class="op" id="2440106">&amp;</span><span class="ident" id="2440107">fdx</span><span class="op" id="2440110">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2440113">if</span>&nbsp;<span class="ident" id="2440116">err</span>&nbsp;<span class="op" id="2440120">==</span>&nbsp;<span class="ident" id="2440123">nil</span>&nbsp;<span class="op" id="2440127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2440131">fd</span><span class="op" id="2440133">[</span><span class="num" id="2440134">0</span><span class="op" id="2440135">]</span>&nbsp;<span class="op" id="2440137">=</span>&nbsp;<span class="builtintype" id="2440139">int</span><span class="op" id="2440142">(</span><span class="ident" id="2440143">fdx</span><span class="op" id="2440146">[</span><span class="num" id="2440147">0</span><span class="op" id="2440148">]</span><span class="op" id="2440149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2440153">fd</span><span class="op" id="2440155">[</span><span class="num" id="2440156">1</span><span class="op" id="2440157">]</span>&nbsp;<span class="op" id="2440159">=</span>&nbsp;<span class="builtintype" id="2440161">int</span><span class="op" id="2440164">(</span><span class="ident" id="2440165">fdx</span><span class="op" id="2440168">[</span><span class="num" id="2440169">1</span><span class="op" id="2440170">]</span><span class="op" id="2440171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2440174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2440177">return</span><br>
<span class="lineno">290</span><span class="op" id="2440184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2440187">func</span>&nbsp;<span class="ident" id="2440192">Sendfile</span><span class="op" id="2440200">(</span><span class="ident" id="2440201">outfd</span>&nbsp;<span class="builtintype" id="2440207">int</span><span class="op" id="2440210">,</span>&nbsp;<span class="ident" id="2440212">infd</span>&nbsp;<span class="builtintype" id="2440217">int</span><span class="op" id="2440220">,</span>&nbsp;<span class="ident" id="2440222">offset</span>&nbsp;<span class="op" id="2440229">*</span><span class="ident" id="2440230">int64</span><span class="op" id="2440235">,</span>&nbsp;<span class="ident" id="2440237">count</span>&nbsp;<span class="builtintype" id="2440243">int</span><span class="op" id="2440246">)</span>&nbsp;<span class="op" id="2440248">(</span><span class="ident" id="2440249">written</span>&nbsp;<span class="builtintype" id="2440257">int</span><span class="op" id="2440260">,</span>&nbsp;<span class="ident" id="2440262">err</span>&nbsp;<span class="builtintype" id="2440266">error</span><span class="op" id="2440271">)</span>&nbsp;<span class="op" id="2440273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2440276">if</span>&nbsp;<span class="ident" id="2440279">raceenabled</span>&nbsp;<span class="op" id="2440291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2440295">raceReleaseMerge</span><span class="op" id="2440311">(</span><span class="ident" id="2440312">unsafe</span><span class="op" id="2440318">.</span><span class="ident" id="2440319">Pointer</span><span class="op" id="2440326">(</span><span class="op" id="2440327">&amp;</span><span class="ident" id="2440328">ioSync</span><span class="op" id="2440334">)</span><span class="op" id="2440335">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2440338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2440341">return</span>&nbsp;<span class="ident" id="2440348">sendfile</span><span class="op" id="2440356">(</span><span class="ident" id="2440357">outfd</span><span class="op" id="2440362">,</span>&nbsp;<span class="ident" id="2440364">infd</span><span class="op" id="2440368">,</span>&nbsp;<span class="ident" id="2440370">offset</span><span class="op" id="2440376">,</span>&nbsp;<span class="ident" id="2440378">count</span><span class="op" id="2440383">)</span><br>
<span class="lineno"></span><span class="op" id="2440385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2440388">var</span>&nbsp;<span class="ident" id="2440392">ioSync</span>&nbsp;<span class="ident" id="2440399">int64</span>
</div>
</body>
</html>
