<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime</h2>
<ul>
<li><a href="/gostd/mime/grammar.go.html">grammar.go</a></li>
<li><a href="/gostd/mime/mediatype.go.html">mediatype.go</a></li>
<li><a href="/gostd/mime/mediatype_test.go.html">mediatype_test.go</a></li>
<li><a href="/gostd/mime/type.go.html">type.go</a></li>
<li><a href="/gostd/mime/type_test.go.html">type_test.go</a></li>
<li><a href="/gostd/mime/type_unix.go.html">type_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4095243">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4095298">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4095352">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4095403">package</span>&nbsp;<span class="ident" id="4095411">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4095417">import</span>&nbsp;<span class="op" id="4095424">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4095427">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4095436">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4095446">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4095453">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4095461">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4095472">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="4095482">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4095485">//&nbsp;FormatMediaType&nbsp;serializes&nbsp;mediatype&nbsp;t&nbsp;and&nbsp;the&nbsp;parameters</span><br>
<span class="lineno"></span><span class="comment" id="4095546">//&nbsp;param&nbsp;as&nbsp;a&nbsp;media&nbsp;type&nbsp;conforming&nbsp;to&nbsp;RFC&nbsp;2045&nbsp;and&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="4095608">//&nbsp;The&nbsp;type&nbsp;and&nbsp;parameter&nbsp;names&nbsp;are&nbsp;written&nbsp;in&nbsp;lower-case.</span><br>
<span class="lineno"></span><span class="comment" id="4095667">//&nbsp;When&nbsp;any&nbsp;of&nbsp;the&nbsp;arguments&nbsp;result&nbsp;in&nbsp;a&nbsp;standard&nbsp;violation&nbsp;then</span><br>
<span class="lineno">20</span><span class="comment" id="4095732">//&nbsp;FormatMediaType&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4095777">func</span>&nbsp;<span class="ident" id="4095782">FormatMediaType</span><span class="op" id="4095797">(</span><span class="ident" id="4095798">t</span>&nbsp;<span class="builtintype" id="4095800">string</span><span class="op" id="4095806">,</span>&nbsp;<span class="ident" id="4095808">param</span>&nbsp;<span class="keyword" id="4095814">map</span><span class="op" id="4095817">[</span><span class="builtintype" id="4095818">string</span><span class="op" id="4095824">]</span><span class="builtintype" id="4095825">string</span><span class="op" id="4095831">)</span>&nbsp;<span class="builtintype" id="4095833">string</span>&nbsp;<span class="op" id="4095840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4095843">slash</span>&nbsp;<span class="op" id="4095849">:=</span>&nbsp;<span class="ident" id="4095852">strings</span><span class="op" id="4095859">.</span><span class="ident" id="4095860">Index</span><span class="op" id="4095865">(</span><span class="ident" id="4095866">t</span><span class="op" id="4095867">,</span>&nbsp;<span class="string" id="4095869">&#34;/&#34;</span><span class="op" id="4095872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4095875">if</span>&nbsp;<span class="ident" id="4095878">slash</span>&nbsp;<span class="op" id="4095884">==</span>&nbsp;<span class="op" id="4095887">-</span><span class="num" id="4095888">1</span>&nbsp;<span class="op" id="4095890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4095894">return</span>&nbsp;<span class="string" id="4095901">&#34;&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4095905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4095908">major</span><span class="op" id="4095913">,</span>&nbsp;<span class="ident" id="4095915">sub</span>&nbsp;<span class="op" id="4095919">:=</span>&nbsp;<span class="ident" id="4095922">t</span><span class="op" id="4095923">[</span><span class="op" id="4095924">:</span><span class="ident" id="4095925">slash</span><span class="op" id="4095930">]</span><span class="op" id="4095931">,</span>&nbsp;<span class="ident" id="4095933">t</span><span class="op" id="4095934">[</span><span class="ident" id="4095935">slash</span><span class="op" id="4095940">+</span><span class="num" id="4095941">1</span><span class="op" id="4095942">:</span><span class="op" id="4095943">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4095946">if</span>&nbsp;<span class="op" id="4095949">!</span><span class="ident" id="4095950">isToken</span><span class="op" id="4095957">(</span><span class="ident" id="4095958">major</span><span class="op" id="4095963">)</span>&nbsp;<span class="op" id="4095965">||</span>&nbsp;<span class="op" id="4095968">!</span><span class="ident" id="4095969">isToken</span><span class="op" id="4095976">(</span><span class="ident" id="4095977">sub</span><span class="op" id="4095980">)</span>&nbsp;<span class="op" id="4095982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4095986">return</span>&nbsp;<span class="string" id="4095993">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4095997">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096000">var</span>&nbsp;<span class="ident" id="4096004">b</span>&nbsp;<span class="ident" id="4096006">bytes</span><span class="op" id="4096011">.</span><span class="ident" id="4096012">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096020">b</span><span class="op" id="4096021">.</span><span class="ident" id="4096022">WriteString</span><span class="op" id="4096033">(</span><span class="ident" id="4096034">strings</span><span class="op" id="4096041">.</span><span class="ident" id="4096042">ToLower</span><span class="op" id="4096049">(</span><span class="ident" id="4096050">major</span><span class="op" id="4096055">)</span><span class="op" id="4096056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096059">b</span><span class="op" id="4096060">.</span><span class="ident" id="4096061">WriteByte</span><span class="op" id="4096070">(</span><span class="string" id="4096071">&#39;/&#39;</span><span class="op" id="4096074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096077">b</span><span class="op" id="4096078">.</span><span class="ident" id="4096079">WriteString</span><span class="op" id="4096090">(</span><span class="ident" id="4096091">strings</span><span class="op" id="4096098">.</span><span class="ident" id="4096099">ToLower</span><span class="op" id="4096106">(</span><span class="ident" id="4096107">sub</span><span class="op" id="4096110">)</span><span class="op" id="4096111">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096115">attrs</span>&nbsp;<span class="op" id="4096121">:=</span>&nbsp;<span class="builtinfunc" id="4096124">make</span><span class="op" id="4096128">(</span><span class="op" id="4096129">[</span><span class="op" id="4096130">]</span><span class="builtintype" id="4096131">string</span><span class="op" id="4096137">,</span>&nbsp;<span class="num" id="4096139">0</span><span class="op" id="4096140">,</span>&nbsp;<span class="builtinfunc" id="4096142">len</span><span class="op" id="4096145">(</span><span class="ident" id="4096146">param</span><span class="op" id="4096151">)</span><span class="op" id="4096152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096155">for</span>&nbsp;<span class="ident" id="4096159">a</span>&nbsp;<span class="op" id="4096161">:=</span>&nbsp;<span class="keyword" id="4096164">range</span>&nbsp;<span class="ident" id="4096170">param</span>&nbsp;<span class="op" id="4096176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096180">attrs</span>&nbsp;<span class="op" id="4096186">=</span>&nbsp;<span class="builtinfunc" id="4096188">append</span><span class="op" id="4096194">(</span><span class="ident" id="4096195">attrs</span><span class="op" id="4096200">,</span>&nbsp;<span class="ident" id="4096202">a</span><span class="op" id="4096203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4096206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096209">sort</span><span class="op" id="4096213">.</span><span class="ident" id="4096214">Strings</span><span class="op" id="4096221">(</span><span class="ident" id="4096222">attrs</span><span class="op" id="4096227">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096231">for</span>&nbsp;<span class="ident" id="4096235">_</span><span class="op" id="4096236">,</span>&nbsp;<span class="ident" id="4096238">attribute</span>&nbsp;<span class="op" id="4096248">:=</span>&nbsp;<span class="keyword" id="4096251">range</span>&nbsp;<span class="ident" id="4096257">attrs</span>&nbsp;<span class="op" id="4096263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096267">value</span>&nbsp;<span class="op" id="4096273">:=</span>&nbsp;<span class="ident" id="4096276">param</span><span class="op" id="4096281">[</span><span class="ident" id="4096282">attribute</span><span class="op" id="4096291">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096295">b</span><span class="op" id="4096296">.</span><span class="ident" id="4096297">WriteByte</span><span class="op" id="4096306">(</span><span class="string" id="4096307">&#39;;&#39;</span><span class="op" id="4096310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096314">b</span><span class="op" id="4096315">.</span><span class="ident" id="4096316">WriteByte</span><span class="op" id="4096325">(</span><span class="string" id="4096326">&#39;&nbsp;&#39;</span><span class="op" id="4096329">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096333">if</span>&nbsp;<span class="op" id="4096336">!</span><span class="ident" id="4096337">isToken</span><span class="op" id="4096344">(</span><span class="ident" id="4096345">attribute</span><span class="op" id="4096354">)</span>&nbsp;<span class="op" id="4096356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096361">return</span>&nbsp;<span class="string" id="4096368">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4096373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096377">b</span><span class="op" id="4096378">.</span><span class="ident" id="4096379">WriteString</span><span class="op" id="4096390">(</span><span class="ident" id="4096391">strings</span><span class="op" id="4096398">.</span><span class="ident" id="4096399">ToLower</span><span class="op" id="4096406">(</span><span class="ident" id="4096407">attribute</span><span class="op" id="4096416">)</span><span class="op" id="4096417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096421">b</span><span class="op" id="4096422">.</span><span class="ident" id="4096423">WriteByte</span><span class="op" id="4096432">(</span><span class="string" id="4096433">&#39;=&#39;</span><span class="op" id="4096436">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096440">if</span>&nbsp;<span class="ident" id="4096443">isToken</span><span class="op" id="4096450">(</span><span class="ident" id="4096451">value</span><span class="op" id="4096456">)</span>&nbsp;<span class="op" id="4096458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096463">b</span><span class="op" id="4096464">.</span><span class="ident" id="4096465">WriteString</span><span class="op" id="4096476">(</span><span class="ident" id="4096477">value</span><span class="op" id="4096482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096487">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4096498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096503">b</span><span class="op" id="4096504">.</span><span class="ident" id="4096505">WriteByte</span><span class="op" id="4096514">(</span><span class="string" id="4096515">&#39;&#34;&#39;</span><span class="op" id="4096518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096522">offset</span>&nbsp;<span class="op" id="4096529">:=</span>&nbsp;<span class="num" id="4096532">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096536">for</span>&nbsp;<span class="ident" id="4096540">index</span><span class="op" id="4096545">,</span>&nbsp;<span class="ident" id="4096547">character</span>&nbsp;<span class="op" id="4096557">:=</span>&nbsp;<span class="keyword" id="4096560">range</span>&nbsp;<span class="ident" id="4096566">value</span>&nbsp;<span class="op" id="4096572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096577">if</span>&nbsp;<span class="ident" id="4096580">character</span>&nbsp;<span class="op" id="4096590">==</span>&nbsp;<span class="string" id="4096593">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="4096597">||</span>&nbsp;<span class="ident" id="4096600">character</span>&nbsp;<span class="op" id="4096610">==</span>&nbsp;<span class="string" id="4096613">&#39;\\&#39;</span>&nbsp;<span class="op" id="4096618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096624">b</span><span class="op" id="4096625">.</span><span class="ident" id="4096626">WriteString</span><span class="op" id="4096637">(</span><span class="ident" id="4096638">value</span><span class="op" id="4096643">[</span><span class="ident" id="4096644">offset</span><span class="op" id="4096650">:</span><span class="ident" id="4096651">index</span><span class="op" id="4096656">]</span><span class="op" id="4096657">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096663">offset</span>&nbsp;<span class="op" id="4096670">=</span>&nbsp;<span class="ident" id="4096672">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096682">b</span><span class="op" id="4096683">.</span><span class="ident" id="4096684">WriteByte</span><span class="op" id="4096693">(</span><span class="string" id="4096694">&#39;\\&#39;</span><span class="op" id="4096698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4096703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096708">if</span>&nbsp;<span class="ident" id="4096711">character</span><span class="op" id="4096720">&amp;</span><span class="num" id="4096721">0x80</span>&nbsp;<span class="op" id="4096726">!=</span>&nbsp;<span class="num" id="4096729">0</span>&nbsp;<span class="op" id="4096731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096737">return</span>&nbsp;<span class="string" id="4096744">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4096750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4096754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096758">b</span><span class="op" id="4096759">.</span><span class="ident" id="4096760">WriteString</span><span class="op" id="4096771">(</span><span class="ident" id="4096772">value</span><span class="op" id="4096777">[</span><span class="ident" id="4096778">offset</span><span class="op" id="4096784">:</span><span class="op" id="4096785">]</span><span class="op" id="4096786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096790">b</span><span class="op" id="4096791">.</span><span class="ident" id="4096792">WriteByte</span><span class="op" id="4096801">(</span><span class="string" id="4096802">&#39;&#34;&#39;</span><span class="op" id="4096805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4096808">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096811">return</span>&nbsp;<span class="ident" id="4096818">b</span><span class="op" id="4096819">.</span><span class="ident" id="4096820">String</span><span class="op" id="4096826">(</span><span class="op" id="4096827">)</span><br>
<span class="lineno"></span><span class="op" id="4096829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4096832">func</span>&nbsp;<span class="ident" id="4096837">checkMediaTypeDisposition</span><span class="op" id="4096862">(</span><span class="ident" id="4096863">s</span>&nbsp;<span class="builtintype" id="4096865">string</span><span class="op" id="4096871">)</span>&nbsp;<span class="builtintype" id="4096873">error</span>&nbsp;<span class="op" id="4096879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4096882">typ</span><span class="op" id="4096885">,</span>&nbsp;<span class="ident" id="4096887">rest</span>&nbsp;<span class="op" id="4096892">:=</span>&nbsp;<span class="ident" id="4096895">consumeToken</span><span class="op" id="4096907">(</span><span class="ident" id="4096908">s</span><span class="op" id="4096909">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096912">if</span>&nbsp;<span class="ident" id="4096915">typ</span>&nbsp;<span class="op" id="4096919">==</span>&nbsp;<span class="string" id="4096922">&#34;&#34;</span>&nbsp;<span class="op" id="4096925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096929">return</span>&nbsp;<span class="ident" id="4096936">errors</span><span class="op" id="4096942">.</span><span class="ident" id="4096943">New</span><span class="op" id="4096946">(</span><span class="string" id="4096947">&#34;mime:&nbsp;no&nbsp;media&nbsp;type&#34;</span><span class="op" id="4096968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4096971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096974">if</span>&nbsp;<span class="ident" id="4096977">rest</span>&nbsp;<span class="op" id="4096982">==</span>&nbsp;<span class="string" id="4096985">&#34;&#34;</span>&nbsp;<span class="op" id="4096988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4096992">return</span>&nbsp;<span class="ident" id="4096999">nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4097004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4097007">if</span>&nbsp;<span class="op" id="4097010">!</span><span class="ident" id="4097011">strings</span><span class="op" id="4097018">.</span><span class="ident" id="4097019">HasPrefix</span><span class="op" id="4097028">(</span><span class="ident" id="4097029">rest</span><span class="op" id="4097033">,</span>&nbsp;<span class="string" id="4097035">&#34;/&#34;</span><span class="op" id="4097038">)</span>&nbsp;<span class="op" id="4097040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4097044">return</span>&nbsp;<span class="ident" id="4097051">errors</span><span class="op" id="4097057">.</span><span class="ident" id="4097058">New</span><span class="op" id="4097061">(</span><span class="string" id="4097062">&#34;mime:&nbsp;expected&nbsp;slash&nbsp;after&nbsp;first&nbsp;token&#34;</span><span class="op" id="4097102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4097105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097108">subtype</span><span class="op" id="4097115">,</span>&nbsp;<span class="ident" id="4097117">rest</span>&nbsp;<span class="op" id="4097122">:=</span>&nbsp;<span class="ident" id="4097125">consumeToken</span><span class="op" id="4097137">(</span><span class="ident" id="4097138">rest</span><span class="op" id="4097142">[</span><span class="num" id="4097143">1</span><span class="op" id="4097144">:</span><span class="op" id="4097145">]</span><span class="op" id="4097146">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4097149">if</span>&nbsp;<span class="ident" id="4097152">subtype</span>&nbsp;<span class="op" id="4097160">==</span>&nbsp;<span class="string" id="4097163">&#34;&#34;</span>&nbsp;<span class="op" id="4097166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4097170">return</span>&nbsp;<span class="ident" id="4097177">errors</span><span class="op" id="4097183">.</span><span class="ident" id="4097184">New</span><span class="op" id="4097187">(</span><span class="string" id="4097188">&#34;mime:&nbsp;expected&nbsp;token&nbsp;after&nbsp;slash&#34;</span><span class="op" id="4097222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4097225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4097228">if</span>&nbsp;<span class="ident" id="4097231">rest</span>&nbsp;<span class="op" id="4097236">!=</span>&nbsp;<span class="string" id="4097239">&#34;&#34;</span>&nbsp;<span class="op" id="4097242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4097246">return</span>&nbsp;<span class="ident" id="4097253">errors</span><span class="op" id="4097259">.</span><span class="ident" id="4097260">New</span><span class="op" id="4097263">(</span><span class="string" id="4097264">&#34;mime:&nbsp;unexpected&nbsp;content&nbsp;after&nbsp;media&nbsp;subtype&#34;</span><span class="op" id="4097310">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4097313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4097316">return</span>&nbsp;<span class="ident" id="4097323">nil</span><br>
<span class="lineno"></span><span class="op" id="4097327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4097330">//&nbsp;ParseMediaType&nbsp;parses&nbsp;a&nbsp;media&nbsp;type&nbsp;value&nbsp;and&nbsp;any&nbsp;optional</span><br>
<span class="lineno">95</span><span class="comment" id="4097391">//&nbsp;parameters,&nbsp;per&nbsp;RFC&nbsp;1521.&nbsp;&nbsp;Media&nbsp;types&nbsp;are&nbsp;the&nbsp;values&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4097451">//&nbsp;Content-Type&nbsp;and&nbsp;Content-Disposition&nbsp;headers&nbsp;(RFC&nbsp;2183).</span><br>
<span class="lineno"></span><span class="comment" id="4097511">//&nbsp;On&nbsp;success,&nbsp;ParseMediaType&nbsp;returns&nbsp;the&nbsp;media&nbsp;type&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="4097574">//&nbsp;to&nbsp;lowercase&nbsp;and&nbsp;trimmed&nbsp;of&nbsp;white&nbsp;space&nbsp;and&nbsp;a&nbsp;non-nil&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="4097636">//&nbsp;The&nbsp;returned&nbsp;map,&nbsp;params,&nbsp;maps&nbsp;from&nbsp;the&nbsp;lowercase</span><br>
<span class="lineno">100</span><span class="comment" id="4097689">//&nbsp;attribute&nbsp;to&nbsp;the&nbsp;attribute&nbsp;value&nbsp;with&nbsp;its&nbsp;case&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="keyword" id="4097750">func</span>&nbsp;<span class="ident" id="4097755">ParseMediaType</span><span class="op" id="4097769">(</span><span class="ident" id="4097770">v</span>&nbsp;<span class="builtintype" id="4097772">string</span><span class="op" id="4097778">)</span>&nbsp;<span class="op" id="4097780">(</span><span class="ident" id="4097781">mediatype</span>&nbsp;<span class="builtintype" id="4097791">string</span><span class="op" id="4097797">,</span>&nbsp;<span class="ident" id="4097799">params</span>&nbsp;<span class="keyword" id="4097806">map</span><span class="op" id="4097809">[</span><span class="builtintype" id="4097810">string</span><span class="op" id="4097816">]</span><span class="builtintype" id="4097817">string</span><span class="op" id="4097823">,</span>&nbsp;<span class="ident" id="4097825">err</span>&nbsp;<span class="builtintype" id="4097829">error</span><span class="op" id="4097834">)</span>&nbsp;<span class="op" id="4097836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097839">i</span>&nbsp;<span class="op" id="4097841">:=</span>&nbsp;<span class="ident" id="4097844">strings</span><span class="op" id="4097851">.</span><span class="ident" id="4097852">Index</span><span class="op" id="4097857">(</span><span class="ident" id="4097858">v</span><span class="op" id="4097859">,</span>&nbsp;<span class="string" id="4097861">&#34;;&#34;</span><span class="op" id="4097864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4097867">if</span>&nbsp;<span class="ident" id="4097870">i</span>&nbsp;<span class="op" id="4097872">==</span>&nbsp;<span class="op" id="4097875">-</span><span class="num" id="4097876">1</span>&nbsp;<span class="op" id="4097878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097882">i</span>&nbsp;<span class="op" id="4097884">=</span>&nbsp;<span class="builtinfunc" id="4097886">len</span><span class="op" id="4097889">(</span><span class="ident" id="4097890">v</span><span class="op" id="4097891">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4097894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097897">mediatype</span>&nbsp;<span class="op" id="4097907">=</span>&nbsp;<span class="ident" id="4097909">strings</span><span class="op" id="4097916">.</span><span class="ident" id="4097917">TrimSpace</span><span class="op" id="4097926">(</span><span class="ident" id="4097927">strings</span><span class="op" id="4097934">.</span><span class="ident" id="4097935">ToLower</span><span class="op" id="4097942">(</span><span class="ident" id="4097943">v</span><span class="op" id="4097944">[</span><span class="num" id="4097945">0</span><span class="op" id="4097946">:</span><span class="ident" id="4097947">i</span><span class="op" id="4097948">]</span><span class="op" id="4097949">)</span><span class="op" id="4097950">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4097954">err</span>&nbsp;<span class="op" id="4097958">=</span>&nbsp;<span class="ident" id="4097960">checkMediaTypeDisposition</span><span class="op" id="4097985">(</span><span class="ident" id="4097986">mediatype</span><span class="op" id="4097995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4097998">if</span>&nbsp;<span class="ident" id="4098001">err</span>&nbsp;<span class="op" id="4098005">!=</span>&nbsp;<span class="ident" id="4098008">nil</span>&nbsp;<span class="op" id="4098012">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098016">return</span>&nbsp;<span class="string" id="4098023">&#34;&#34;</span><span class="op" id="4098025">,</span>&nbsp;<span class="ident" id="4098027">nil</span><span class="op" id="4098030">,</span>&nbsp;<span class="ident" id="4098032">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4098037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4098041">params</span>&nbsp;<span class="op" id="4098048">=</span>&nbsp;<span class="builtinfunc" id="4098050">make</span><span class="op" id="4098054">(</span><span class="keyword" id="4098055">map</span><span class="op" id="4098058">[</span><span class="builtintype" id="4098059">string</span><span class="op" id="4098065">]</span><span class="builtintype" id="4098066">string</span><span class="op" id="4098072">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4098076">//&nbsp;Map&nbsp;of&nbsp;base&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4098134">//&nbsp;for&nbsp;parameters&nbsp;containing&nbsp;a&nbsp;&#39;*&#39;&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4098181">//&nbsp;Lazily&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098205">var</span>&nbsp;<span class="ident" id="4098209">continuation</span>&nbsp;<span class="keyword" id="4098222">map</span><span class="op" id="4098225">[</span><span class="builtintype" id="4098226">string</span><span class="op" id="4098232">]</span><span class="keyword" id="4098233">map</span><span class="op" id="4098236">[</span><span class="builtintype" id="4098237">string</span><span class="op" id="4098243">]</span><span class="builtintype" id="4098244">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4098253">v</span>&nbsp;<span class="op" id="4098255">=</span>&nbsp;<span class="ident" id="4098257">v</span><span class="op" id="4098258">[</span><span class="ident" id="4098259">i</span><span class="op" id="4098260">:</span><span class="op" id="4098261">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098264">for</span>&nbsp;<span class="builtinfunc" id="4098268">len</span><span class="op" id="4098271">(</span><span class="ident" id="4098272">v</span><span class="op" id="4098273">)</span>&nbsp;<span class="op" id="4098275">&gt;</span>&nbsp;<span class="num" id="4098277">0</span>&nbsp;<span class="op" id="4098279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4098283">v</span>&nbsp;<span class="op" id="4098285">=</span>&nbsp;<span class="ident" id="4098287">strings</span><span class="op" id="4098294">.</span><span class="ident" id="4098295">TrimLeftFunc</span><span class="op" id="4098307">(</span><span class="ident" id="4098308">v</span><span class="op" id="4098309">,</span>&nbsp;<span class="ident" id="4098311">unicode</span><span class="op" id="4098318">.</span><span class="ident" id="4098319">IsSpace</span><span class="op" id="4098326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098330">if</span>&nbsp;<span class="builtinfunc" id="4098333">len</span><span class="op" id="4098336">(</span><span class="ident" id="4098337">v</span><span class="op" id="4098338">)</span>&nbsp;<span class="op" id="4098340">==</span>&nbsp;<span class="num" id="4098343">0</span>&nbsp;<span class="op" id="4098345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098350">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4098358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4098362">key</span><span class="op" id="4098365">,</span>&nbsp;<span class="ident" id="4098367">value</span><span class="op" id="4098372">,</span>&nbsp;<span class="ident" id="4098374">rest</span>&nbsp;<span class="op" id="4098379">:=</span>&nbsp;<span class="ident" id="4098382">consumeMediaParam</span><span class="op" id="4098399">(</span><span class="ident" id="4098400">v</span><span class="op" id="4098401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098405">if</span>&nbsp;<span class="ident" id="4098408">key</span>&nbsp;<span class="op" id="4098412">==</span>&nbsp;<span class="string" id="4098415">&#34;&#34;</span>&nbsp;<span class="op" id="4098418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098423">if</span>&nbsp;<span class="ident" id="4098426">strings</span><span class="op" id="4098433">.</span><span class="ident" id="4098434">TrimSpace</span><span class="op" id="4098443">(</span><span class="ident" id="4098444">rest</span><span class="op" id="4098448">)</span>&nbsp;<span class="op" id="4098450">==</span>&nbsp;<span class="string" id="4098453">&#34;;&#34;</span>&nbsp;<span class="op" id="4098457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4098463">//&nbsp;Ignore&nbsp;trailing&nbsp;semicolons.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4098498">//&nbsp;Not&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098519">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4098529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4098534">//&nbsp;Parse&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098553">return</span>&nbsp;<span class="string" id="4098560">&#34;&#34;</span><span class="op" id="4098562">,</span>&nbsp;<span class="ident" id="4098564">nil</span><span class="op" id="4098567">,</span>&nbsp;<span class="ident" id="4098569">errors</span><span class="op" id="4098575">.</span><span class="ident" id="4098576">New</span><span class="op" id="4098579">(</span><span class="string" id="4098580">&#34;mime:&nbsp;invalid&nbsp;media&nbsp;parameter&#34;</span><span class="op" id="4098611">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4098615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4098620">pmap</span>&nbsp;<span class="op" id="4098625">:=</span>&nbsp;<span class="ident" id="4098628">params</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098637">if</span>&nbsp;<span class="ident" id="4098640">idx</span>&nbsp;<span class="op" id="4098644">:=</span>&nbsp;<span class="ident" id="4098647">strings</span><span class="op" id="4098654">.</span><span class="ident" id="4098655">Index</span><span class="op" id="4098660">(</span><span class="ident" id="4098661">key</span><span class="op" id="4098664">,</span>&nbsp;<span class="string" id="4098666">&#34;*&#34;</span><span class="op" id="4098669">)</span><span class="op" id="4098670">;</span>&nbsp;<span class="ident" id="4098672">idx</span>&nbsp;<span class="op" id="4098676">!=</span>&nbsp;<span class="op" id="4098679">-</span><span class="num" id="4098680">1</span>&nbsp;<span class="op" id="4098682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4098687">baseName</span>&nbsp;<span class="op" id="4098696">:=</span>&nbsp;<span class="ident" id="4098699">key</span><span class="op" id="4098702">[</span><span class="op" id="4098703">:</span><span class="ident" id="4098704">idx</span><span class="op" id="4098707">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098712">if</span>&nbsp;<span class="ident" id="4098715">continuation</span>&nbsp;<span class="op" id="4098728">==</span>&nbsp;<span class="ident" id="4098731">nil</span>&nbsp;<span class="op" id="4098735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4098741">continuation</span>&nbsp;<span class="op" id="4098754">=</span>&nbsp;<span class="builtinfunc" id="4098756">make</span><span class="op" id="4098760">(</span><span class="keyword" id="4098761">map</span><span class="op" id="4098764">[</span><span class="builtintype" id="4098765">string</span><span class="op" id="4098771">]</span><span class="keyword" id="4098772">map</span><span class="op" id="4098775">[</span><span class="builtintype" id="4098776">string</span><span class="op" id="4098782">]</span><span class="builtintype" id="4098783">string</span><span class="op" id="4098789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4098794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098799">var</span>&nbsp;<span class="ident" id="4098803">ok</span>&nbsp;<span class="builtintype" id="4098806">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098814">if</span>&nbsp;<span class="ident" id="4098817">pmap</span><span class="op" id="4098821">,</span>&nbsp;<span class="ident" id="4098823">ok</span>&nbsp;<span class="op" id="4098826">=</span>&nbsp;<span class="ident" id="4098828">continuation</span><span class="op" id="4098840">[</span><span class="ident" id="4098841">baseName</span><span class="op" id="4098849">]</span><span class="op" id="4098850">;</span>&nbsp;<span class="op" id="4098852">!</span><span class="ident" id="4098853">ok</span>&nbsp;<span class="op" id="4098856">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4098862">continuation</span><span class="op" id="4098874">[</span><span class="ident" id="4098875">baseName</span><span class="op" id="4098883">]</span>&nbsp;<span class="op" id="4098885">=</span>&nbsp;<span class="builtinfunc" id="4098887">make</span><span class="op" id="4098891">(</span><span class="keyword" id="4098892">map</span><span class="op" id="4098895">[</span><span class="builtintype" id="4098896">string</span><span class="op" id="4098902">]</span><span class="builtintype" id="4098903">string</span><span class="op" id="4098909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4098915">pmap</span>&nbsp;<span class="op" id="4098920">=</span>&nbsp;<span class="ident" id="4098922">continuation</span><span class="op" id="4098934">[</span><span class="ident" id="4098935">baseName</span><span class="op" id="4098943">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4098948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4098952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4098956">if</span>&nbsp;<span class="ident" id="4098959">_</span><span class="op" id="4098960">,</span>&nbsp;<span class="ident" id="4098962">exists</span>&nbsp;<span class="op" id="4098969">:=</span>&nbsp;<span class="ident" id="4098972">pmap</span><span class="op" id="4098976">[</span><span class="ident" id="4098977">key</span><span class="op" id="4098980">]</span><span class="op" id="4098981">;</span>&nbsp;<span class="ident" id="4098983">exists</span>&nbsp;<span class="op" id="4098990">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4098995">//&nbsp;Duplicate&nbsp;parameter&nbsp;name&nbsp;is&nbsp;bogus.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099036">return</span>&nbsp;<span class="string" id="4099043">&#34;&#34;</span><span class="op" id="4099045">,</span>&nbsp;<span class="ident" id="4099047">nil</span><span class="op" id="4099050">,</span>&nbsp;<span class="ident" id="4099052">errors</span><span class="op" id="4099058">.</span><span class="ident" id="4099059">New</span><span class="op" id="4099062">(</span><span class="string" id="4099063">&#34;mime:&nbsp;duplicate&nbsp;parameter&nbsp;name&#34;</span><span class="op" id="4099095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4099099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099103">pmap</span><span class="op" id="4099107">[</span><span class="ident" id="4099108">key</span><span class="op" id="4099111">]</span>&nbsp;<span class="op" id="4099113">=</span>&nbsp;<span class="ident" id="4099115">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099123">v</span>&nbsp;<span class="op" id="4099125">=</span>&nbsp;<span class="ident" id="4099127">rest</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4099133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4099137">//&nbsp;Stitch&nbsp;together&nbsp;any&nbsp;continuations&nbsp;or&nbsp;things&nbsp;with&nbsp;stars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4099196">//&nbsp;(i.e.&nbsp;RFC&nbsp;2231&nbsp;things&nbsp;with&nbsp;stars:&nbsp;&#34;foo*0&#34;&nbsp;or&nbsp;&#34;foo*&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099253">var</span>&nbsp;<span class="ident" id="4099257">buf</span>&nbsp;<span class="ident" id="4099261">bytes</span><span class="op" id="4099266">.</span><span class="ident" id="4099267">Buffer</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099275">for</span>&nbsp;<span class="ident" id="4099279">key</span><span class="op" id="4099282">,</span>&nbsp;<span class="ident" id="4099284">pieceMap</span>&nbsp;<span class="op" id="4099293">:=</span>&nbsp;<span class="keyword" id="4099296">range</span>&nbsp;<span class="ident" id="4099302">continuation</span>&nbsp;<span class="op" id="4099315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099319">singlePartKey</span>&nbsp;<span class="op" id="4099333">:=</span>&nbsp;<span class="ident" id="4099336">key</span>&nbsp;<span class="op" id="4099340">+</span>&nbsp;<span class="string" id="4099342">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099348">if</span>&nbsp;<span class="ident" id="4099351">v</span><span class="op" id="4099352">,</span>&nbsp;<span class="ident" id="4099354">ok</span>&nbsp;<span class="op" id="4099357">:=</span>&nbsp;<span class="ident" id="4099360">pieceMap</span><span class="op" id="4099368">[</span><span class="ident" id="4099369">singlePartKey</span><span class="op" id="4099382">]</span><span class="op" id="4099383">;</span>&nbsp;<span class="ident" id="4099385">ok</span>&nbsp;<span class="op" id="4099388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099393">decv</span>&nbsp;<span class="op" id="4099398">:=</span>&nbsp;<span class="ident" id="4099401">decode2231Enc</span><span class="op" id="4099414">(</span><span class="ident" id="4099415">v</span><span class="op" id="4099416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099421">params</span><span class="op" id="4099427">[</span><span class="ident" id="4099428">key</span><span class="op" id="4099431">]</span>&nbsp;<span class="op" id="4099433">=</span>&nbsp;<span class="ident" id="4099435">decv</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099443">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4099454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099459">buf</span><span class="op" id="4099462">.</span><span class="ident" id="4099463">Reset</span><span class="op" id="4099468">(</span><span class="op" id="4099469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099473">valid</span>&nbsp;<span class="op" id="4099479">:=</span>&nbsp;<span class="builtintype" id="4099482">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099490">for</span>&nbsp;<span class="ident" id="4099494">n</span>&nbsp;<span class="op" id="4099496">:=</span>&nbsp;<span class="num" id="4099499">0</span><span class="op" id="4099500">;</span>&nbsp;<span class="op" id="4099502">;</span>&nbsp;<span class="ident" id="4099504">n</span><span class="op" id="4099505">++</span>&nbsp;<span class="op" id="4099508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099513">simplePart</span>&nbsp;<span class="op" id="4099524">:=</span>&nbsp;<span class="ident" id="4099527">fmt</span><span class="op" id="4099530">.</span><span class="ident" id="4099531">Sprintf</span><span class="op" id="4099538">(</span><span class="string" id="4099539">&#34;%s*%d&#34;</span><span class="op" id="4099546">,</span>&nbsp;<span class="ident" id="4099548">key</span><span class="op" id="4099551">,</span>&nbsp;<span class="ident" id="4099553">n</span><span class="op" id="4099554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099559">if</span>&nbsp;<span class="ident" id="4099562">v</span><span class="op" id="4099563">,</span>&nbsp;<span class="ident" id="4099565">ok</span>&nbsp;<span class="op" id="4099568">:=</span>&nbsp;<span class="ident" id="4099571">pieceMap</span><span class="op" id="4099579">[</span><span class="ident" id="4099580">simplePart</span><span class="op" id="4099590">]</span><span class="op" id="4099591">;</span>&nbsp;<span class="ident" id="4099593">ok</span>&nbsp;<span class="op" id="4099596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099602">valid</span>&nbsp;<span class="op" id="4099608">=</span>&nbsp;<span class="builtintype" id="4099610">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099619">buf</span><span class="op" id="4099622">.</span><span class="ident" id="4099623">WriteString</span><span class="op" id="4099634">(</span><span class="ident" id="4099635">v</span><span class="op" id="4099636">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099642">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4099654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099659">encodedPart</span>&nbsp;<span class="op" id="4099671">:=</span>&nbsp;<span class="ident" id="4099674">simplePart</span>&nbsp;<span class="op" id="4099685">+</span>&nbsp;<span class="string" id="4099687">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099694">if</span>&nbsp;<span class="ident" id="4099697">v</span><span class="op" id="4099698">,</span>&nbsp;<span class="ident" id="4099700">ok</span>&nbsp;<span class="op" id="4099703">:=</span>&nbsp;<span class="ident" id="4099706">pieceMap</span><span class="op" id="4099714">[</span><span class="ident" id="4099715">encodedPart</span><span class="op" id="4099726">]</span><span class="op" id="4099727">;</span>&nbsp;<span class="ident" id="4099729">ok</span>&nbsp;<span class="op" id="4099732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099738">valid</span>&nbsp;<span class="op" id="4099744">=</span>&nbsp;<span class="builtintype" id="4099746">true</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099755">if</span>&nbsp;<span class="ident" id="4099758">n</span>&nbsp;<span class="op" id="4099760">==</span>&nbsp;<span class="num" id="4099763">0</span>&nbsp;<span class="op" id="4099765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099772">buf</span><span class="op" id="4099775">.</span><span class="ident" id="4099776">WriteString</span><span class="op" id="4099787">(</span><span class="ident" id="4099788">decode2231Enc</span><span class="op" id="4099801">(</span><span class="ident" id="4099802">v</span><span class="op" id="4099803">)</span><span class="op" id="4099804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4099810">}</span>&nbsp;<span class="keyword" id="4099812">else</span>&nbsp;<span class="op" id="4099817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099824">decv</span><span class="op" id="4099828">,</span>&nbsp;<span class="ident" id="4099830">_</span>&nbsp;<span class="op" id="4099832">:=</span>&nbsp;<span class="ident" id="4099835">percentHexUnescape</span><span class="op" id="4099853">(</span><span class="ident" id="4099854">v</span><span class="op" id="4099855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099862">buf</span><span class="op" id="4099865">.</span><span class="ident" id="4099866">WriteString</span><span class="op" id="4099877">(</span><span class="ident" id="4099878">decv</span><span class="op" id="4099882">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4099888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4099893">}</span>&nbsp;<span class="keyword" id="4099895">else</span>&nbsp;<span class="op" id="4099900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099906">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4099915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4099919">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099923">if</span>&nbsp;<span class="ident" id="4099926">valid</span>&nbsp;<span class="op" id="4099932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4099937">params</span><span class="op" id="4099943">[</span><span class="ident" id="4099944">key</span><span class="op" id="4099947">]</span>&nbsp;<span class="op" id="4099949">=</span>&nbsp;<span class="ident" id="4099951">buf</span><span class="op" id="4099954">.</span><span class="ident" id="4099955">String</span><span class="op" id="4099961">(</span><span class="op" id="4099962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4099966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4099969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4099973">return</span><br>
<span class="lineno"></span><span class="op" id="4099980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4099983">func</span>&nbsp;<span class="ident" id="4099988">decode2231Enc</span><span class="op" id="4100001">(</span><span class="ident" id="4100002">v</span>&nbsp;<span class="builtintype" id="4100004">string</span><span class="op" id="4100010">)</span>&nbsp;<span class="builtintype" id="4100012">string</span>&nbsp;<span class="op" id="4100019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4100022">sv</span>&nbsp;<span class="op" id="4100025">:=</span>&nbsp;<span class="ident" id="4100028">strings</span><span class="op" id="4100035">.</span><span class="ident" id="4100036">SplitN</span><span class="op" id="4100042">(</span><span class="ident" id="4100043">v</span><span class="op" id="4100044">,</span>&nbsp;<span class="string" id="4100046">&#34;&#39;&#34;</span><span class="op" id="4100049">,</span>&nbsp;<span class="num" id="4100051">3</span><span class="op" id="4100052">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100055">if</span>&nbsp;<span class="builtinfunc" id="4100058">len</span><span class="op" id="4100061">(</span><span class="ident" id="4100062">sv</span><span class="op" id="4100064">)</span>&nbsp;<span class="op" id="4100066">!=</span>&nbsp;<span class="num" id="4100069">3</span>&nbsp;<span class="op" id="4100071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100075">return</span>&nbsp;<span class="string" id="4100082">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4100086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4100089">//&nbsp;TODO:&nbsp;ignoring&nbsp;lang&nbsp;in&nbsp;sv[1]&nbsp;for&nbsp;now.&nbsp;If&nbsp;anybody&nbsp;needs&nbsp;it&nbsp;we&#39;ll</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4100157">//&nbsp;need&nbsp;to&nbsp;decide&nbsp;how&nbsp;to&nbsp;expose&nbsp;it&nbsp;in&nbsp;the&nbsp;API.&nbsp;But&nbsp;I&#39;m&nbsp;not&nbsp;sure</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4100222">//&nbsp;anybody&nbsp;uses&nbsp;it&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4100255">charset</span>&nbsp;<span class="op" id="4100263">:=</span>&nbsp;<span class="ident" id="4100266">strings</span><span class="op" id="4100273">.</span><span class="ident" id="4100274">ToLower</span><span class="op" id="4100281">(</span><span class="ident" id="4100282">sv</span><span class="op" id="4100284">[</span><span class="num" id="4100285">0</span><span class="op" id="4100286">]</span><span class="op" id="4100287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100290">if</span>&nbsp;<span class="ident" id="4100293">charset</span>&nbsp;<span class="op" id="4100301">!=</span>&nbsp;<span class="string" id="4100304">&#34;us-ascii&#34;</span>&nbsp;<span class="op" id="4100315">&amp;&amp;</span>&nbsp;<span class="ident" id="4100318">charset</span>&nbsp;<span class="op" id="4100326">!=</span>&nbsp;<span class="string" id="4100329">&#34;utf-8&#34;</span>&nbsp;<span class="op" id="4100337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4100341">//&nbsp;TODO:&nbsp;unsupported&nbsp;encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100373">return</span>&nbsp;<span class="string" id="4100380">&#34;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4100384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4100387">encv</span><span class="op" id="4100391">,</span>&nbsp;<span class="ident" id="4100393">_</span>&nbsp;<span class="op" id="4100395">:=</span>&nbsp;<span class="ident" id="4100398">percentHexUnescape</span><span class="op" id="4100416">(</span><span class="ident" id="4100417">sv</span><span class="op" id="4100419">[</span><span class="num" id="4100420">2</span><span class="op" id="4100421">]</span><span class="op" id="4100422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100425">return</span>&nbsp;<span class="ident" id="4100432">encv</span><br>
<span class="lineno"></span><span class="op" id="4100437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="4100440">func</span>&nbsp;<span class="ident" id="4100445">isNotTokenChar</span><span class="op" id="4100459">(</span><span class="ident" id="4100460">r</span>&nbsp;<span class="builtintype" id="4100462">rune</span><span class="op" id="4100466">)</span>&nbsp;<span class="builtintype" id="4100468">bool</span>&nbsp;<span class="op" id="4100473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100476">return</span>&nbsp;<span class="op" id="4100483">!</span><span class="ident" id="4100484">isTokenChar</span><span class="op" id="4100495">(</span><span class="ident" id="4100496">r</span><span class="op" id="4100497">)</span><br>
<span class="lineno"></span><span class="op" id="4100499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4100502">//&nbsp;consumeToken&nbsp;consumes&nbsp;a&nbsp;token&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;provided</span><br>
<span class="lineno">220</span><span class="comment" id="4100566">//&nbsp;string,&nbsp;per&nbsp;RFC&nbsp;2045&nbsp;section&nbsp;5.1&nbsp;(referenced&nbsp;from&nbsp;2183),&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4100637">//&nbsp;the&nbsp;token&nbsp;consumed&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;Returns&nbsp;(&#34;&#34;,&nbsp;v)&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="4100707">//&nbsp;failure&nbsp;to&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="4100753">func</span>&nbsp;<span class="ident" id="4100758">consumeToken</span><span class="op" id="4100770">(</span><span class="ident" id="4100771">v</span>&nbsp;<span class="builtintype" id="4100773">string</span><span class="op" id="4100779">)</span>&nbsp;<span class="op" id="4100781">(</span><span class="ident" id="4100782">token</span><span class="op" id="4100787">,</span>&nbsp;<span class="ident" id="4100789">rest</span>&nbsp;<span class="builtintype" id="4100794">string</span><span class="op" id="4100800">)</span>&nbsp;<span class="op" id="4100802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4100805">notPos</span>&nbsp;<span class="op" id="4100812">:=</span>&nbsp;<span class="ident" id="4100815">strings</span><span class="op" id="4100822">.</span><span class="ident" id="4100823">IndexFunc</span><span class="op" id="4100832">(</span><span class="ident" id="4100833">v</span><span class="op" id="4100834">,</span>&nbsp;<span class="ident" id="4100836">isNotTokenChar</span><span class="op" id="4100850">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100853">if</span>&nbsp;<span class="ident" id="4100856">notPos</span>&nbsp;<span class="op" id="4100863">==</span>&nbsp;<span class="op" id="4100866">-</span><span class="num" id="4100867">1</span>&nbsp;<span class="op" id="4100869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100873">return</span>&nbsp;<span class="ident" id="4100880">v</span><span class="op" id="4100881">,</span>&nbsp;<span class="string" id="4100883">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4100887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100890">if</span>&nbsp;<span class="ident" id="4100893">notPos</span>&nbsp;<span class="op" id="4100900">==</span>&nbsp;<span class="num" id="4100903">0</span>&nbsp;<span class="op" id="4100905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100909">return</span>&nbsp;<span class="string" id="4100916">&#34;&#34;</span><span class="op" id="4100918">,</span>&nbsp;<span class="ident" id="4100920">v</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4100923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4100926">return</span>&nbsp;<span class="ident" id="4100933">v</span><span class="op" id="4100934">[</span><span class="num" id="4100935">0</span><span class="op" id="4100936">:</span><span class="ident" id="4100937">notPos</span><span class="op" id="4100943">]</span><span class="op" id="4100944">,</span>&nbsp;<span class="ident" id="4100946">v</span><span class="op" id="4100947">[</span><span class="ident" id="4100948">notPos</span><span class="op" id="4100954">:</span><span class="op" id="4100955">]</span><br>
<span class="lineno"></span><span class="op" id="4100957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4100960">//&nbsp;consumeValue&nbsp;consumes&nbsp;a&nbsp;&#34;value&#34;&nbsp;per&nbsp;RFC&nbsp;2045,&nbsp;where&nbsp;a&nbsp;value&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="4101026">//&nbsp;either&nbsp;a&nbsp;&#39;token&#39;&nbsp;or&nbsp;a&nbsp;&#39;quoted-string&#39;.&nbsp;&nbsp;On&nbsp;success,&nbsp;consumeValue</span><br>
<span class="lineno"></span><span class="comment" id="4101094">//&nbsp;returns&nbsp;the&nbsp;value&nbsp;consumed&nbsp;(and&nbsp;de-quoted/escaped,&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4101153">//&nbsp;quoted-string)&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;On&nbsp;failure,&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4101220">//&nbsp;(&#34;&#34;,&nbsp;v).</span><br>
<span class="lineno"></span><span class="keyword" id="4101232">func</span>&nbsp;<span class="ident" id="4101237">consumeValue</span><span class="op" id="4101249">(</span><span class="ident" id="4101250">v</span>&nbsp;<span class="builtintype" id="4101252">string</span><span class="op" id="4101258">)</span>&nbsp;<span class="op" id="4101260">(</span><span class="ident" id="4101261">value</span><span class="op" id="4101266">,</span>&nbsp;<span class="ident" id="4101268">rest</span>&nbsp;<span class="builtintype" id="4101273">string</span><span class="op" id="4101279">)</span>&nbsp;<span class="op" id="4101281">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101284">if</span>&nbsp;<span class="op" id="4101287">!</span><span class="ident" id="4101288">strings</span><span class="op" id="4101295">.</span><span class="ident" id="4101296">HasPrefix</span><span class="op" id="4101305">(</span><span class="ident" id="4101306">v</span><span class="op" id="4101307">,</span>&nbsp;<span class="string" id="4101309">`&#34;`</span><span class="op" id="4101312">)</span>&nbsp;<span class="op" id="4101314">&amp;&amp;</span>&nbsp;<span class="op" id="4101317">!</span><span class="ident" id="4101318">strings</span><span class="op" id="4101325">.</span><span class="ident" id="4101326">HasPrefix</span><span class="op" id="4101335">(</span><span class="ident" id="4101336">v</span><span class="op" id="4101337">,</span>&nbsp;<span class="string" id="4101339">`&#39;`</span><span class="op" id="4101342">)</span>&nbsp;<span class="op" id="4101344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101348">return</span>&nbsp;<span class="ident" id="4101355">consumeToken</span><span class="op" id="4101367">(</span><span class="ident" id="4101368">v</span><span class="op" id="4101369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101376">leadQuote</span>&nbsp;<span class="op" id="4101386">:=</span>&nbsp;<span class="builtintype" id="4101389">rune</span><span class="op" id="4101393">(</span><span class="ident" id="4101394">v</span><span class="op" id="4101395">[</span><span class="num" id="4101396">0</span><span class="op" id="4101397">]</span><span class="op" id="4101398">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4101402">//&nbsp;parse&nbsp;a&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101428">rest</span>&nbsp;<span class="op" id="4101433">=</span>&nbsp;<span class="ident" id="4101435">v</span><span class="op" id="4101436">[</span><span class="num" id="4101437">1</span><span class="op" id="4101438">:</span><span class="op" id="4101439">]</span>&nbsp;<span class="comment" id="4101441">//&nbsp;consume&nbsp;the&nbsp;leading&nbsp;quote</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101471">buffer</span>&nbsp;<span class="op" id="4101478">:=</span>&nbsp;<span class="builtinfunc" id="4101481">new</span><span class="op" id="4101484">(</span><span class="ident" id="4101485">bytes</span><span class="op" id="4101490">.</span><span class="ident" id="4101491">Buffer</span><span class="op" id="4101497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101500">var</span>&nbsp;<span class="ident" id="4101504">idx</span>&nbsp;<span class="builtintype" id="4101508">int</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101513">var</span>&nbsp;<span class="ident" id="4101517">r</span>&nbsp;<span class="builtintype" id="4101519">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101525">var</span>&nbsp;<span class="ident" id="4101529">nextIsLiteral</span>&nbsp;<span class="builtintype" id="4101543">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101549">for</span>&nbsp;<span class="ident" id="4101553">idx</span><span class="op" id="4101556">,</span>&nbsp;<span class="ident" id="4101558">r</span>&nbsp;<span class="op" id="4101560">=</span>&nbsp;<span class="keyword" id="4101562">range</span>&nbsp;<span class="ident" id="4101568">rest</span>&nbsp;<span class="op" id="4101573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101577">switch</span>&nbsp;<span class="op" id="4101584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101588">case</span>&nbsp;<span class="ident" id="4101593">nextIsLiteral</span><span class="op" id="4101606">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101611">buffer</span><span class="op" id="4101617">.</span><span class="ident" id="4101618">WriteRune</span><span class="op" id="4101627">(</span><span class="ident" id="4101628">r</span><span class="op" id="4101629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101634">nextIsLiteral</span>&nbsp;<span class="op" id="4101648">=</span>&nbsp;<span class="builtintype" id="4101650">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101658">case</span>&nbsp;<span class="ident" id="4101663">r</span>&nbsp;<span class="op" id="4101665">==</span>&nbsp;<span class="ident" id="4101668">leadQuote</span><span class="op" id="4101677">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101682">return</span>&nbsp;<span class="ident" id="4101689">buffer</span><span class="op" id="4101695">.</span><span class="ident" id="4101696">String</span><span class="op" id="4101702">(</span><span class="op" id="4101703">)</span><span class="op" id="4101704">,</span>&nbsp;<span class="ident" id="4101706">rest</span><span class="op" id="4101710">[</span><span class="ident" id="4101711">idx</span><span class="op" id="4101714">+</span><span class="num" id="4101715">1</span><span class="op" id="4101716">:</span><span class="op" id="4101717">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101721">case</span>&nbsp;<span class="ident" id="4101726">r</span>&nbsp;<span class="op" id="4101728">==</span>&nbsp;<span class="string" id="4101731">&#39;\\&#39;</span><span class="op" id="4101735">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101740">nextIsLiteral</span>&nbsp;<span class="op" id="4101754">=</span>&nbsp;<span class="builtintype" id="4101756">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101763">case</span>&nbsp;<span class="ident" id="4101768">r</span>&nbsp;<span class="op" id="4101770">!=</span>&nbsp;<span class="string" id="4101773">&#39;\r&#39;</span>&nbsp;<span class="op" id="4101778">&amp;&amp;</span>&nbsp;<span class="ident" id="4101781">r</span>&nbsp;<span class="op" id="4101783">!=</span>&nbsp;<span class="string" id="4101786">&#39;\n&#39;</span><span class="op" id="4101790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101795">buffer</span><span class="op" id="4101801">.</span><span class="ident" id="4101802">WriteRune</span><span class="op" id="4101811">(</span><span class="ident" id="4101812">r</span><span class="op" id="4101813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101817">default</span><span class="op" id="4101824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101829">return</span>&nbsp;<span class="string" id="4101836">&#34;&#34;</span><span class="op" id="4101838">,</span>&nbsp;<span class="ident" id="4101840">v</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4101847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101850">return</span>&nbsp;<span class="string" id="4101857">&#34;&#34;</span><span class="op" id="4101859">,</span>&nbsp;<span class="ident" id="4101861">v</span><br>
<span class="lineno"></span><span class="op" id="4101863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="4101866">func</span>&nbsp;<span class="ident" id="4101871">consumeMediaParam</span><span class="op" id="4101888">(</span><span class="ident" id="4101889">v</span>&nbsp;<span class="builtintype" id="4101891">string</span><span class="op" id="4101897">)</span>&nbsp;<span class="op" id="4101899">(</span><span class="ident" id="4101900">param</span><span class="op" id="4101905">,</span>&nbsp;<span class="ident" id="4101907">value</span><span class="op" id="4101912">,</span>&nbsp;<span class="ident" id="4101914">rest</span>&nbsp;<span class="builtintype" id="4101919">string</span><span class="op" id="4101925">)</span>&nbsp;<span class="op" id="4101927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4101930">rest</span>&nbsp;<span class="op" id="4101935">=</span>&nbsp;<span class="ident" id="4101937">strings</span><span class="op" id="4101944">.</span><span class="ident" id="4101945">TrimLeftFunc</span><span class="op" id="4101957">(</span><span class="ident" id="4101958">v</span><span class="op" id="4101959">,</span>&nbsp;<span class="ident" id="4101961">unicode</span><span class="op" id="4101968">.</span><span class="ident" id="4101969">IsSpace</span><span class="op" id="4101976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4101979">if</span>&nbsp;<span class="op" id="4101982">!</span><span class="ident" id="4101983">strings</span><span class="op" id="4101990">.</span><span class="ident" id="4101991">HasPrefix</span><span class="op" id="4102000">(</span><span class="ident" id="4102001">rest</span><span class="op" id="4102005">,</span>&nbsp;<span class="string" id="4102007">&#34;;&#34;</span><span class="op" id="4102010">)</span>&nbsp;<span class="op" id="4102012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102016">return</span>&nbsp;<span class="string" id="4102023">&#34;&#34;</span><span class="op" id="4102025">,</span>&nbsp;<span class="string" id="4102027">&#34;&#34;</span><span class="op" id="4102029">,</span>&nbsp;<span class="ident" id="4102031">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102034">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102038">rest</span>&nbsp;<span class="op" id="4102043">=</span>&nbsp;<span class="ident" id="4102045">rest</span><span class="op" id="4102049">[</span><span class="num" id="4102050">1</span><span class="op" id="4102051">:</span><span class="op" id="4102052">]</span>&nbsp;<span class="comment" id="4102054">//&nbsp;consume&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102076">rest</span>&nbsp;<span class="op" id="4102081">=</span>&nbsp;<span class="ident" id="4102083">strings</span><span class="op" id="4102090">.</span><span class="ident" id="4102091">TrimLeftFunc</span><span class="op" id="4102103">(</span><span class="ident" id="4102104">rest</span><span class="op" id="4102108">,</span>&nbsp;<span class="ident" id="4102110">unicode</span><span class="op" id="4102117">.</span><span class="ident" id="4102118">IsSpace</span><span class="op" id="4102125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102128">param</span><span class="op" id="4102133">,</span>&nbsp;<span class="ident" id="4102135">rest</span>&nbsp;<span class="op" id="4102140">=</span>&nbsp;<span class="ident" id="4102142">consumeToken</span><span class="op" id="4102154">(</span><span class="ident" id="4102155">rest</span><span class="op" id="4102159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102162">param</span>&nbsp;<span class="op" id="4102168">=</span>&nbsp;<span class="ident" id="4102170">strings</span><span class="op" id="4102177">.</span><span class="ident" id="4102178">ToLower</span><span class="op" id="4102185">(</span><span class="ident" id="4102186">param</span><span class="op" id="4102191">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102194">if</span>&nbsp;<span class="ident" id="4102197">param</span>&nbsp;<span class="op" id="4102203">==</span>&nbsp;<span class="string" id="4102206">&#34;&#34;</span>&nbsp;<span class="op" id="4102209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102213">return</span>&nbsp;<span class="string" id="4102220">&#34;&#34;</span><span class="op" id="4102222">,</span>&nbsp;<span class="string" id="4102224">&#34;&#34;</span><span class="op" id="4102226">,</span>&nbsp;<span class="ident" id="4102228">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102235">rest</span>&nbsp;<span class="op" id="4102240">=</span>&nbsp;<span class="ident" id="4102242">strings</span><span class="op" id="4102249">.</span><span class="ident" id="4102250">TrimLeftFunc</span><span class="op" id="4102262">(</span><span class="ident" id="4102263">rest</span><span class="op" id="4102267">,</span>&nbsp;<span class="ident" id="4102269">unicode</span><span class="op" id="4102276">.</span><span class="ident" id="4102277">IsSpace</span><span class="op" id="4102284">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102287">if</span>&nbsp;<span class="op" id="4102290">!</span><span class="ident" id="4102291">strings</span><span class="op" id="4102298">.</span><span class="ident" id="4102299">HasPrefix</span><span class="op" id="4102308">(</span><span class="ident" id="4102309">rest</span><span class="op" id="4102313">,</span>&nbsp;<span class="string" id="4102315">&#34;=&#34;</span><span class="op" id="4102318">)</span>&nbsp;<span class="op" id="4102320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102324">return</span>&nbsp;<span class="string" id="4102331">&#34;&#34;</span><span class="op" id="4102333">,</span>&nbsp;<span class="string" id="4102335">&#34;&#34;</span><span class="op" id="4102337">,</span>&nbsp;<span class="ident" id="4102339">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102345">rest</span>&nbsp;<span class="op" id="4102350">=</span>&nbsp;<span class="ident" id="4102352">rest</span><span class="op" id="4102356">[</span><span class="num" id="4102357">1</span><span class="op" id="4102358">:</span><span class="op" id="4102359">]</span>&nbsp;<span class="comment" id="4102361">//&nbsp;consume&nbsp;equals&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102385">rest</span>&nbsp;<span class="op" id="4102390">=</span>&nbsp;<span class="ident" id="4102392">strings</span><span class="op" id="4102399">.</span><span class="ident" id="4102400">TrimLeftFunc</span><span class="op" id="4102412">(</span><span class="ident" id="4102413">rest</span><span class="op" id="4102417">,</span>&nbsp;<span class="ident" id="4102419">unicode</span><span class="op" id="4102426">.</span><span class="ident" id="4102427">IsSpace</span><span class="op" id="4102434">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102437">value</span><span class="op" id="4102442">,</span>&nbsp;<span class="ident" id="4102444">rest</span>&nbsp;<span class="op" id="4102449">=</span>&nbsp;<span class="ident" id="4102451">consumeValue</span><span class="op" id="4102463">(</span><span class="ident" id="4102464">rest</span><span class="op" id="4102468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102471">if</span>&nbsp;<span class="ident" id="4102474">value</span>&nbsp;<span class="op" id="4102480">==</span>&nbsp;<span class="string" id="4102483">&#34;&#34;</span>&nbsp;<span class="op" id="4102486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102490">return</span>&nbsp;<span class="string" id="4102497">&#34;&#34;</span><span class="op" id="4102499">,</span>&nbsp;<span class="string" id="4102501">&#34;&#34;</span><span class="op" id="4102503">,</span>&nbsp;<span class="ident" id="4102505">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102511">return</span>&nbsp;<span class="ident" id="4102518">param</span><span class="op" id="4102523">,</span>&nbsp;<span class="ident" id="4102525">value</span><span class="op" id="4102530">,</span>&nbsp;<span class="ident" id="4102532">rest</span><br>
<span class="lineno">295</span><span class="op" id="4102537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4102540">func</span>&nbsp;<span class="ident" id="4102545">percentHexUnescape</span><span class="op" id="4102563">(</span><span class="ident" id="4102564">s</span>&nbsp;<span class="builtintype" id="4102566">string</span><span class="op" id="4102572">)</span>&nbsp;<span class="op" id="4102574">(</span><span class="builtintype" id="4102575">string</span><span class="op" id="4102581">,</span>&nbsp;<span class="builtintype" id="4102583">error</span><span class="op" id="4102588">)</span>&nbsp;<span class="op" id="4102590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4102593">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102638">percents</span>&nbsp;<span class="op" id="4102647">:=</span>&nbsp;<span class="num" id="4102650">0</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102653">for</span>&nbsp;<span class="ident" id="4102657">i</span>&nbsp;<span class="op" id="4102659">:=</span>&nbsp;<span class="num" id="4102662">0</span><span class="op" id="4102663">;</span>&nbsp;<span class="ident" id="4102665">i</span>&nbsp;<span class="op" id="4102667">&lt;</span>&nbsp;<span class="builtinfunc" id="4102669">len</span><span class="op" id="4102672">(</span><span class="ident" id="4102673">s</span><span class="op" id="4102674">)</span><span class="op" id="4102675">;</span>&nbsp;<span class="op" id="4102677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102681">if</span>&nbsp;<span class="ident" id="4102684">s</span><span class="op" id="4102685">[</span><span class="ident" id="4102686">i</span><span class="op" id="4102687">]</span>&nbsp;<span class="op" id="4102689">!=</span>&nbsp;<span class="string" id="4102692">&#39;%&#39;</span>&nbsp;<span class="op" id="4102696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102701">i</span><span class="op" id="4102702">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102708">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102719">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102723">percents</span><span class="op" id="4102731">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102736">if</span>&nbsp;<span class="ident" id="4102739">i</span><span class="op" id="4102740">+</span><span class="num" id="4102741">2</span>&nbsp;<span class="op" id="4102743">&gt;=</span>&nbsp;<span class="builtinfunc" id="4102746">len</span><span class="op" id="4102749">(</span><span class="ident" id="4102750">s</span><span class="op" id="4102751">)</span>&nbsp;<span class="op" id="4102753">||</span>&nbsp;<span class="op" id="4102756">!</span><span class="ident" id="4102757">ishex</span><span class="op" id="4102762">(</span><span class="ident" id="4102763">s</span><span class="op" id="4102764">[</span><span class="ident" id="4102765">i</span><span class="op" id="4102766">+</span><span class="num" id="4102767">1</span><span class="op" id="4102768">]</span><span class="op" id="4102769">)</span>&nbsp;<span class="op" id="4102771">||</span>&nbsp;<span class="op" id="4102774">!</span><span class="ident" id="4102775">ishex</span><span class="op" id="4102780">(</span><span class="ident" id="4102781">s</span><span class="op" id="4102782">[</span><span class="ident" id="4102783">i</span><span class="op" id="4102784">+</span><span class="num" id="4102785">2</span><span class="op" id="4102786">]</span><span class="op" id="4102787">)</span>&nbsp;<span class="op" id="4102789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102794">s</span>&nbsp;<span class="op" id="4102796">=</span>&nbsp;<span class="ident" id="4102798">s</span><span class="op" id="4102799">[</span><span class="ident" id="4102800">i</span><span class="op" id="4102801">:</span><span class="op" id="4102802">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102807">if</span>&nbsp;<span class="builtinfunc" id="4102810">len</span><span class="op" id="4102813">(</span><span class="ident" id="4102814">s</span><span class="op" id="4102815">)</span>&nbsp;<span class="op" id="4102817">&gt;</span>&nbsp;<span class="num" id="4102819">3</span>&nbsp;<span class="op" id="4102821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102827">s</span>&nbsp;<span class="op" id="4102829">=</span>&nbsp;<span class="ident" id="4102831">s</span><span class="op" id="4102832">[</span><span class="num" id="4102833">0</span><span class="op" id="4102834">:</span><span class="num" id="4102835">3</span><span class="op" id="4102836">]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102846">return</span>&nbsp;<span class="string" id="4102853">&#34;&#34;</span><span class="op" id="4102855">,</span>&nbsp;<span class="ident" id="4102857">fmt</span><span class="op" id="4102860">.</span><span class="ident" id="4102861">Errorf</span><span class="op" id="4102867">(</span><span class="string" id="4102868">&#34;mime:&nbsp;bogus&nbsp;characters&nbsp;after&nbsp;%%:&nbsp;%q&#34;</span><span class="op" id="4102905">,</span>&nbsp;<span class="ident" id="4102907">s</span><span class="op" id="4102908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102916">i</span>&nbsp;<span class="op" id="4102918">+=</span>&nbsp;<span class="num" id="4102921">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102924">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102927">if</span>&nbsp;<span class="ident" id="4102930">percents</span>&nbsp;<span class="op" id="4102939">==</span>&nbsp;<span class="num" id="4102942">0</span>&nbsp;<span class="op" id="4102944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4102948">return</span>&nbsp;<span class="ident" id="4102955">s</span><span class="op" id="4102956">,</span>&nbsp;<span class="ident" id="4102958">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4102963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4102967">t</span>&nbsp;<span class="op" id="4102969">:=</span>&nbsp;<span class="builtinfunc" id="4102972">make</span><span class="op" id="4102976">(</span><span class="op" id="4102977">[</span><span class="op" id="4102978">]</span><span class="builtintype" id="4102979">byte</span><span class="op" id="4102983">,</span>&nbsp;<span class="builtinfunc" id="4102985">len</span><span class="op" id="4102988">(</span><span class="ident" id="4102989">s</span><span class="op" id="4102990">)</span><span class="op" id="4102991">-</span><span class="num" id="4102992">2</span><span class="op" id="4102993">*</span><span class="ident" id="4102994">percents</span><span class="op" id="4103002">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103005">j</span>&nbsp;<span class="op" id="4103007">:=</span>&nbsp;<span class="num" id="4103010">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103013">for</span>&nbsp;<span class="ident" id="4103017">i</span>&nbsp;<span class="op" id="4103019">:=</span>&nbsp;<span class="num" id="4103022">0</span><span class="op" id="4103023">;</span>&nbsp;<span class="ident" id="4103025">i</span>&nbsp;<span class="op" id="4103027">&lt;</span>&nbsp;<span class="builtinfunc" id="4103029">len</span><span class="op" id="4103032">(</span><span class="ident" id="4103033">s</span><span class="op" id="4103034">)</span><span class="op" id="4103035">;</span>&nbsp;<span class="op" id="4103037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103041">switch</span>&nbsp;<span class="ident" id="4103048">s</span><span class="op" id="4103049">[</span><span class="ident" id="4103050">i</span><span class="op" id="4103051">]</span>&nbsp;<span class="op" id="4103053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103057">case</span>&nbsp;<span class="string" id="4103062">&#39;%&#39;</span><span class="op" id="4103065">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103070">t</span><span class="op" id="4103071">[</span><span class="ident" id="4103072">j</span><span class="op" id="4103073">]</span>&nbsp;<span class="op" id="4103075">=</span>&nbsp;<span class="ident" id="4103077">unhex</span><span class="op" id="4103082">(</span><span class="ident" id="4103083">s</span><span class="op" id="4103084">[</span><span class="ident" id="4103085">i</span><span class="op" id="4103086">+</span><span class="num" id="4103087">1</span><span class="op" id="4103088">]</span><span class="op" id="4103089">)</span><span class="op" id="4103090">&lt;&lt;</span><span class="num" id="4103092">4</span>&nbsp;<span class="op" id="4103094">|</span>&nbsp;<span class="ident" id="4103096">unhex</span><span class="op" id="4103101">(</span><span class="ident" id="4103102">s</span><span class="op" id="4103103">[</span><span class="ident" id="4103104">i</span><span class="op" id="4103105">+</span><span class="num" id="4103106">2</span><span class="op" id="4103107">]</span><span class="op" id="4103108">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103113">j</span><span class="op" id="4103114">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103120">i</span>&nbsp;<span class="op" id="4103122">+=</span>&nbsp;<span class="num" id="4103125">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103129">default</span><span class="op" id="4103136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103141">t</span><span class="op" id="4103142">[</span><span class="ident" id="4103143">j</span><span class="op" id="4103144">]</span>&nbsp;<span class="op" id="4103146">=</span>&nbsp;<span class="ident" id="4103148">s</span><span class="op" id="4103149">[</span><span class="ident" id="4103150">i</span><span class="op" id="4103151">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103156">j</span><span class="op" id="4103157">++</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4103163">i</span><span class="op" id="4103164">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4103169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4103172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103175">return</span>&nbsp;<span class="builtintype" id="4103182">string</span><span class="op" id="4103188">(</span><span class="ident" id="4103189">t</span><span class="op" id="4103190">)</span><span class="op" id="4103191">,</span>&nbsp;<span class="ident" id="4103193">nil</span><br>
<span class="lineno"></span><span class="op" id="4103197">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="keyword" id="4103200">func</span>&nbsp;<span class="ident" id="4103205">ishex</span><span class="op" id="4103210">(</span><span class="ident" id="4103211">c</span>&nbsp;<span class="builtintype" id="4103213">byte</span><span class="op" id="4103217">)</span>&nbsp;<span class="builtintype" id="4103219">bool</span>&nbsp;<span class="op" id="4103224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103227">switch</span>&nbsp;<span class="op" id="4103234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103237">case</span>&nbsp;<span class="string" id="4103242">&#39;0&#39;</span>&nbsp;<span class="op" id="4103246">&lt;=</span>&nbsp;<span class="ident" id="4103249">c</span>&nbsp;<span class="op" id="4103251">&amp;&amp;</span>&nbsp;<span class="ident" id="4103254">c</span>&nbsp;<span class="op" id="4103256">&lt;=</span>&nbsp;<span class="string" id="4103259">&#39;9&#39;</span><span class="op" id="4103262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103266">return</span>&nbsp;<span class="builtintype" id="4103273">true</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103279">case</span>&nbsp;<span class="string" id="4103284">&#39;a&#39;</span>&nbsp;<span class="op" id="4103288">&lt;=</span>&nbsp;<span class="ident" id="4103291">c</span>&nbsp;<span class="op" id="4103293">&amp;&amp;</span>&nbsp;<span class="ident" id="4103296">c</span>&nbsp;<span class="op" id="4103298">&lt;=</span>&nbsp;<span class="string" id="4103301">&#39;f&#39;</span><span class="op" id="4103304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103308">return</span>&nbsp;<span class="builtintype" id="4103315">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103321">case</span>&nbsp;<span class="string" id="4103326">&#39;A&#39;</span>&nbsp;<span class="op" id="4103330">&lt;=</span>&nbsp;<span class="ident" id="4103333">c</span>&nbsp;<span class="op" id="4103335">&amp;&amp;</span>&nbsp;<span class="ident" id="4103338">c</span>&nbsp;<span class="op" id="4103340">&lt;=</span>&nbsp;<span class="string" id="4103343">&#39;F&#39;</span><span class="op" id="4103346">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103350">return</span>&nbsp;<span class="builtintype" id="4103357">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4103363">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103366">return</span>&nbsp;<span class="builtintype" id="4103373">false</span><br>
<span class="lineno"></span><span class="op" id="4103379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4103382">func</span>&nbsp;<span class="ident" id="4103387">unhex</span><span class="op" id="4103392">(</span><span class="ident" id="4103393">c</span>&nbsp;<span class="builtintype" id="4103395">byte</span><span class="op" id="4103399">)</span>&nbsp;<span class="builtintype" id="4103401">byte</span>&nbsp;<span class="op" id="4103406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103409">switch</span>&nbsp;<span class="op" id="4103416">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103419">case</span>&nbsp;<span class="string" id="4103424">&#39;0&#39;</span>&nbsp;<span class="op" id="4103428">&lt;=</span>&nbsp;<span class="ident" id="4103431">c</span>&nbsp;<span class="op" id="4103433">&amp;&amp;</span>&nbsp;<span class="ident" id="4103436">c</span>&nbsp;<span class="op" id="4103438">&lt;=</span>&nbsp;<span class="string" id="4103441">&#39;9&#39;</span><span class="op" id="4103444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103448">return</span>&nbsp;<span class="ident" id="4103455">c</span>&nbsp;<span class="op" id="4103457">-</span>&nbsp;<span class="string" id="4103459">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103464">case</span>&nbsp;<span class="string" id="4103469">&#39;a&#39;</span>&nbsp;<span class="op" id="4103473">&lt;=</span>&nbsp;<span class="ident" id="4103476">c</span>&nbsp;<span class="op" id="4103478">&amp;&amp;</span>&nbsp;<span class="ident" id="4103481">c</span>&nbsp;<span class="op" id="4103483">&lt;=</span>&nbsp;<span class="string" id="4103486">&#39;f&#39;</span><span class="op" id="4103489">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103493">return</span>&nbsp;<span class="ident" id="4103500">c</span>&nbsp;<span class="op" id="4103502">-</span>&nbsp;<span class="string" id="4103504">&#39;a&#39;</span>&nbsp;<span class="op" id="4103508">+</span>&nbsp;<span class="num" id="4103510">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103514">case</span>&nbsp;<span class="string" id="4103519">&#39;A&#39;</span>&nbsp;<span class="op" id="4103523">&lt;=</span>&nbsp;<span class="ident" id="4103526">c</span>&nbsp;<span class="op" id="4103528">&amp;&amp;</span>&nbsp;<span class="ident" id="4103531">c</span>&nbsp;<span class="op" id="4103533">&lt;=</span>&nbsp;<span class="string" id="4103536">&#39;F&#39;</span><span class="op" id="4103539">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103543">return</span>&nbsp;<span class="ident" id="4103550">c</span>&nbsp;<span class="op" id="4103552">-</span>&nbsp;<span class="string" id="4103554">&#39;A&#39;</span>&nbsp;<span class="op" id="4103558">+</span>&nbsp;<span class="num" id="4103560">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4103564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4103567">return</span>&nbsp;<span class="num" id="4103574">0</span><br>
<span class="lineno"></span><span class="op" id="4103576">}</span>
</div>
</body>
</html>
