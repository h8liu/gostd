<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5312113">package</span>&nbsp;<span class="ident" id="5312121">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5312128">import</span>&nbsp;<span class="op" id="5312135">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5312138">&#34;bytes&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5312147">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5312153">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5312160">&#34;os&#34;</span><br>
<span class="lineno"></span><span class="op" id="5312165">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="5312168">//&nbsp;Serial&nbsp;is&nbsp;a&nbsp;serial&nbsp;console&nbsp;device</span><br>
<span class="lineno"></span><span class="comment" id="5312205">//&nbsp;It&nbsp;is&nbsp;basically&nbsp;two&nbsp;DMA&nbsp;pipes&nbsp;of&nbsp;ring&nbsp;buffered&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="5312262">//&nbsp;one&nbsp;pipe&nbsp;for&nbsp;input,&nbsp;one&nbsp;pipe&nbsp;for&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="5312306">type</span>&nbsp;<span class="ident" id="5312311">serial</span>&nbsp;<span class="keyword" id="5312318">struct</span>&nbsp;<span class="op" id="5312325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312328">intBus</span>&nbsp;<span class="ident" id="5312335"><a href="/lonnie.io/e8vm/arch8/int_bus.go.html#5297167">intBus</a></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312343">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5312350">*</span><span class="ident" id="5312351"><a href="/lonnie.io/e8vm/arch8/page.go.html#5304696">page</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312358">Core</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5312365">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312371">IntIn</span>&nbsp;&nbsp;<span class="builtintype" id="5312378">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312384">IntOut</span>&nbsp;<span class="builtintype" id="5312391">byte</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312398">Output</span>&nbsp;<span class="ident" id="5312405"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312147">io</a></span><span class="op" id="5312407">.</span><span class="ident" id="5312408">Writer</span><br>
<span class="lineno"></span><span class="op" id="5312415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5312418">var</span>&nbsp;<span class="ident" id="5312422">_</span>&nbsp;<span class="ident" id="5312424"><a href="/lonnie.io/e8vm/arch8/device.go.html#5290204">device</a></span>&nbsp;<span class="op" id="5312431">=</span>&nbsp;<span class="builtinfunc" id="5312433">new</span><span class="op" id="5312436">(</span><span class="ident" id="5312437"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312311">serial</a></span><span class="op" id="5312443">)</span>&nbsp;<span class="comment" id="5312445">//&nbsp;Serial&nbsp;is&nbsp;a&nbsp;device</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5312468">const</span>&nbsp;<span class="op" id="5312474">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312477">serialBase</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5312492">=</span>&nbsp;<span class="num" id="5312494">128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312499">serialInHead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5312514">=</span>&nbsp;<span class="ident" id="5312516"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312477">serialBase</a></span>&nbsp;<span class="op" id="5312527">+</span>&nbsp;<span class="num" id="5312529">0</span>&nbsp;&nbsp;<span class="comment" id="5312532">//&nbsp;updated&nbsp;by&nbsp;hardware</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312556">serialInTail</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5312571">=</span>&nbsp;<span class="ident" id="5312573"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312477">serialBase</a></span>&nbsp;<span class="op" id="5312584">+</span>&nbsp;<span class="num" id="5312586">4</span>&nbsp;&nbsp;<span class="comment" id="5312589">//&nbsp;updated&nbsp;by&nbsp;cpu</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312608">serialInWait</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5312623">=</span>&nbsp;<span class="ident" id="5312625"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312477">serialBase</a></span>&nbsp;<span class="op" id="5312636">+</span>&nbsp;<span class="num" id="5312638">8</span>&nbsp;&nbsp;<span class="comment" id="5312641">//&nbsp;cycles&nbsp;to&nbsp;wait&nbsp;to&nbsp;raise&nbsp;an&nbsp;interrupt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312682">serialInThresh</span>&nbsp;<span class="op" id="5312697">=</span>&nbsp;<span class="ident" id="5312699"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312477">serialBase</a></span>&nbsp;<span class="op" id="5312710">+</span>&nbsp;<span class="num" id="5312712">12</span>&nbsp;<span class="comment" id="5312715">//&nbsp;threashold&nbsp;to&nbsp;raise&nbsp;an&nbsp;input&nbsp;interrupt</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312759">serialOutHead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5312775">=</span>&nbsp;<span class="ident" id="5312777"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312477">serialBase</a></span>&nbsp;<span class="op" id="5312788">+</span>&nbsp;<span class="num" id="5312790">16</span>&nbsp;<span class="comment" id="5312793">//&nbsp;updated&nbsp;by&nbsp;cpu</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312812">serialOutTail</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5312828">=</span>&nbsp;<span class="ident" id="5312830"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312477">serialBase</a></span>&nbsp;<span class="op" id="5312841">+</span>&nbsp;<span class="num" id="5312843">20</span>&nbsp;<span class="comment" id="5312846">//&nbsp;updated&nbsp;by&nbsp;hardware</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312870">serialOutWait</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5312886">=</span>&nbsp;<span class="ident" id="5312888"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312477">serialBase</a></span>&nbsp;<span class="op" id="5312899">+</span>&nbsp;<span class="num" id="5312901">24</span>&nbsp;<span class="comment" id="5312904">//&nbsp;cycles&nbsp;to&nbsp;wait&nbsp;to&nbsp;raise&nbsp;an&nbsp;interrupt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312945">serialOutThresh</span>&nbsp;<span class="op" id="5312961">=</span>&nbsp;<span class="ident" id="5312963"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312477">serialBase</a></span>&nbsp;<span class="op" id="5312974">+</span>&nbsp;<span class="num" id="5312976">28</span>&nbsp;<span class="comment" id="5312979">//&nbsp;threashold&nbsp;to&nbsp;raise&nbsp;an&nbsp;output&nbsp;interrupt</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313024">serialInBuf</span>&nbsp;&nbsp;<span class="op" id="5313037">=</span>&nbsp;<span class="ident" id="5313039"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312477">serialBase</a></span>&nbsp;<span class="op" id="5313050">+</span>&nbsp;<span class="num" id="5313052">64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313056">serialOutBuf</span>&nbsp;<span class="op" id="5313069">=</span>&nbsp;<span class="ident" id="5313071"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312477">serialBase</a></span>&nbsp;<span class="op" id="5313082">+</span>&nbsp;<span class="num" id="5313084">96</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313089">serialCap</span>&nbsp;<span class="op" id="5313099">=</span>&nbsp;<span class="num" id="5313101">30</span>&nbsp;<span class="comment" id="5313104">//&nbsp;30&nbsp;bytes&nbsp;maximum&nbsp;in&nbsp;each&nbsp;pipe</span><br>
<span class="lineno"></span><span class="op" id="5313137">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5313140">//&nbsp;NewSerial&nbsp;creates&nbsp;a&nbsp;new&nbsp;serial&nbsp;controller.</span><br>
<span class="lineno">45</span><span class="keyword" id="5313186">func</span>&nbsp;<span class="ident" id="5313191">newSerial</span><span class="op" id="5313200">(</span><span class="ident" id="5313201">p</span>&nbsp;<span class="op" id="5313203">*</span><span class="ident" id="5313204"><a href="/lonnie.io/e8vm/arch8/page.go.html#5304696">page</a></span><span class="op" id="5313208">,</span>&nbsp;<span class="ident" id="5313210">i</span>&nbsp;<span class="ident" id="5313212"><a href="/lonnie.io/e8vm/arch8/int_bus.go.html#5297167">intBus</a></span><span class="op" id="5313218">)</span>&nbsp;<span class="op" id="5313220">*</span><span class="ident" id="5313221"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312311">serial</a></span>&nbsp;<span class="op" id="5313228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313231">ret</span>&nbsp;<span class="op" id="5313235">:=</span>&nbsp;<span class="builtinfunc" id="5313238">new</span><span class="op" id="5313241">(</span><span class="ident" id="5313242"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312311">serial</a></span><span class="op" id="5313248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313251"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313231">ret</a></span><span class="op" id="5313254">.</span><span class="ident" id="5313255">intBus</span>&nbsp;<span class="op" id="5313262">=</span>&nbsp;<span class="ident" id="5313264"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313210">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313267"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313231">ret</a></span><span class="op" id="5313270">.</span><span class="ident" id="5313271">p</span>&nbsp;<span class="op" id="5313273">=</span>&nbsp;<span class="ident" id="5313275"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313201">p</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5313279">//&nbsp;default&nbsp;interrupts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313302"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313231">ret</a></span><span class="op" id="5313305">.</span><span class="ident" id="5313306">Core</span>&nbsp;<span class="op" id="5313311">=</span>&nbsp;<span class="num" id="5313313">0</span>&nbsp;<span class="comment" id="5313315">//&nbsp;to&nbsp;core&nbsp;0&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313334"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313231">ret</a></span><span class="op" id="5313337">.</span><span class="ident" id="5313338">IntIn</span>&nbsp;<span class="op" id="5313344">=</span>&nbsp;<span class="num" id="5313346">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313349"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313231">ret</a></span><span class="op" id="5313352">.</span><span class="ident" id="5313353">IntOut</span>&nbsp;<span class="op" id="5313360">=</span>&nbsp;<span class="num" id="5313362">9</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313366"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313231">ret</a></span><span class="op" id="5313369">.</span><span class="ident" id="5313370">Output</span>&nbsp;<span class="op" id="5313377">=</span>&nbsp;<span class="ident" id="5313379"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312160">os</a></span><span class="op" id="5313381">.</span><span class="ident" id="5313382">Stdout</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313391">return</span>&nbsp;<span class="ident" id="5313398"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313231">ret</a></span><br>
<span class="lineno"></span><span class="op" id="5313402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="5313405">func</span>&nbsp;<span class="op" id="5313410">(</span><span class="ident" id="5313411">s</span>&nbsp;<span class="op" id="5313413">*</span><span class="ident" id="5313414"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312311">serial</a></span><span class="op" id="5313420">)</span>&nbsp;<span class="ident" id="5313422">interrupt</span><span class="op" id="5313431">(</span><span class="ident" id="5313432">code</span>&nbsp;<span class="builtintype" id="5313437">byte</span><span class="op" id="5313441">)</span>&nbsp;<span class="op" id="5313443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313446"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313411">s</a></span><span class="op" id="5313447">.</span><span class="ident" id="5313448">intBus</span><span class="op" id="5313454">.</span><span class="ident" id="5313455">Interrupt</span><span class="op" id="5313464">(</span><span class="ident" id="5313465"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313432">code</a></span><span class="op" id="5313469">,</span>&nbsp;<span class="ident" id="5313471"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313411">s</a></span><span class="op" id="5313472">.</span><span class="ident" id="5313473">Core</span><span class="op" id="5313477">)</span><br>
<span class="lineno"></span><span class="op" id="5313479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5313482">//&nbsp;WriteByte&nbsp;appends&nbsp;a&nbsp;byte&nbsp;into&nbsp;the&nbsp;input&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno">65</span><span class="keyword" id="5313538">func</span>&nbsp;<span class="op" id="5313543">(</span><span class="ident" id="5313544">s</span>&nbsp;<span class="op" id="5313546">*</span><span class="ident" id="5313547"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312311">serial</a></span><span class="op" id="5313553">)</span>&nbsp;<span class="ident" id="5313555">WriteByte</span><span class="op" id="5313564">(</span><span class="ident" id="5313565">b</span>&nbsp;<span class="builtintype" id="5313567">byte</span><span class="op" id="5313571">)</span>&nbsp;<span class="builtintype" id="5313573">bool</span>&nbsp;<span class="op" id="5313578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313581">head</span>&nbsp;<span class="op" id="5313586">:=</span>&nbsp;<span class="ident" id="5313589"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313544">s</a></span><span class="op" id="5313590">.</span><span class="ident" id="5313591">p</span><span class="op" id="5313592">.</span><span class="ident" id="5313593">ReadWord</span><span class="op" id="5313601">(</span><span class="ident" id="5313602"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312499">serialInHead</a></span><span class="op" id="5313614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313617">tail</span>&nbsp;<span class="op" id="5313622">:=</span>&nbsp;<span class="ident" id="5313625"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313544">s</a></span><span class="op" id="5313626">.</span><span class="ident" id="5313627">p</span><span class="op" id="5313628">.</span><span class="ident" id="5313629">ReadWord</span><span class="op" id="5313637">(</span><span class="ident" id="5313638"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312556">serialInTail</a></span><span class="op" id="5313650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313653">n</span>&nbsp;<span class="op" id="5313655">:=</span>&nbsp;<span class="ident" id="5313658"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313581">head</a></span>&nbsp;<span class="op" id="5313663">-</span>&nbsp;<span class="ident" id="5313665"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313617">tail</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313671">if</span>&nbsp;<span class="ident" id="5313674"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313653">n</a></span>&nbsp;<span class="op" id="5313676">&gt;=</span>&nbsp;<span class="ident" id="5313679"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313089">serialCap</a></span>&nbsp;<span class="op" id="5313689">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313693">return</span>&nbsp;<span class="ident" id="5313700">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313711"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313544">s</a></span><span class="op" id="5313712">.</span><span class="ident" id="5313713">p</span><span class="op" id="5313714">.</span><span class="ident" id="5313715">WriteByte</span><span class="op" id="5313724">(</span><span class="ident" id="5313725"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313024">serialInBuf</a></span><span class="op" id="5313736">+</span><span class="ident" id="5313737"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313581">head</a></span><span class="op" id="5313741">%</span><span class="num" id="5313742">32</span><span class="op" id="5313744">,</span>&nbsp;<span class="ident" id="5313746"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313565">b</a></span><span class="op" id="5313747">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313751"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313581">head</a></span><span class="op" id="5313755">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313759"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313544">s</a></span><span class="op" id="5313760">.</span><span class="ident" id="5313761">p</span><span class="op" id="5313762">.</span><span class="ident" id="5313763">WriteWord</span><span class="op" id="5313772">(</span><span class="ident" id="5313773"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312556">serialInTail</a></span><span class="op" id="5313785">,</span>&nbsp;<span class="ident" id="5313787"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313581">head</a></span><span class="op" id="5313791">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313795"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313653">n</a></span><span class="op" id="5313796">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313800">thresh</span>&nbsp;<span class="op" id="5313807">:=</span>&nbsp;<span class="ident" id="5313810"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313544">s</a></span><span class="op" id="5313811">.</span><span class="ident" id="5313812">p</span><span class="op" id="5313813">.</span><span class="ident" id="5313814">ReadWord</span><span class="op" id="5313822">(</span><span class="ident" id="5313823"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312682">serialInThresh</a></span><span class="op" id="5313837">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313840">if</span>&nbsp;<span class="ident" id="5313843"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313653">n</a></span>&nbsp;<span class="op" id="5313845">&gt;=</span>&nbsp;<span class="ident" id="5313848"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313800">thresh</a></span>&nbsp;<span class="op" id="5313855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313859"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313544">s</a></span><span class="op" id="5313860">.</span><span class="ident" id="5313861">interrupt</span><span class="op" id="5313870">(</span><span class="ident" id="5313871"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313544">s</a></span><span class="op" id="5313872">.</span><span class="ident" id="5313873">IntIn</span><span class="op" id="5313878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313885">return</span>&nbsp;<span class="ident" id="5313892">true</span><br>
<span class="lineno">85</span><span class="op" id="5313897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5313900">//&nbsp;OutLen&nbsp;returns&nbsp;the&nbsp;current&nbsp;buffer&nbsp;length&nbsp;of&nbsp;the&nbsp;output&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="5313971">func</span>&nbsp;<span class="op" id="5313976">(</span><span class="ident" id="5313977">s</span>&nbsp;<span class="op" id="5313979">*</span><span class="ident" id="5313980"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312311">serial</a></span><span class="op" id="5313986">)</span>&nbsp;<span class="ident" id="5313988">OutLen</span><span class="op" id="5313994">(</span><span class="op" id="5313995">)</span>&nbsp;<span class="builtintype" id="5313997">uint32</span>&nbsp;<span class="op" id="5314004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314007">head</span>&nbsp;<span class="op" id="5314012">:=</span>&nbsp;<span class="ident" id="5314015"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313977">s</a></span><span class="op" id="5314016">.</span><span class="ident" id="5314017">p</span><span class="op" id="5314018">.</span><span class="ident" id="5314019">ReadWord</span><span class="op" id="5314027">(</span><span class="ident" id="5314028"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312759">serialOutHead</a></span><span class="op" id="5314041">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314044">tail</span>&nbsp;<span class="op" id="5314049">:=</span>&nbsp;<span class="ident" id="5314052"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313977">s</a></span><span class="op" id="5314053">.</span><span class="ident" id="5314054">p</span><span class="op" id="5314055">.</span><span class="ident" id="5314056">ReadWord</span><span class="op" id="5314064">(</span><span class="ident" id="5314065"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312812">serialOutTail</a></span><span class="op" id="5314078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314081">ret</span>&nbsp;<span class="op" id="5314085">:=</span>&nbsp;<span class="ident" id="5314088"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314007">head</a></span>&nbsp;<span class="op" id="5314093">-</span>&nbsp;<span class="ident" id="5314095"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314044">tail</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314101">if</span>&nbsp;<span class="ident" id="5314104"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314081">ret</a></span>&nbsp;<span class="op" id="5314108">&gt;</span>&nbsp;<span class="ident" id="5314110"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313089">serialCap</a></span>&nbsp;<span class="op" id="5314120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314124"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312153">log</a></span><span class="op" id="5314127">.</span><span class="ident" id="5314128">Printf</span><span class="op" id="5314134">(</span><span class="string" id="5314135">&#34;error&nbsp;output&nbsp;buffer&nbsp;length&#34;</span><span class="op" id="5314163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5314167">//&nbsp;on&nbsp;error&nbsp;set&nbsp;the&nbsp;length&nbsp;to&nbsp;full</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5314204">//&nbsp;to&nbsp;avoid&nbsp;trigger&nbsp;interrupt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314236"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314081">ret</a></span>&nbsp;<span class="op" id="5314240">=</span>&nbsp;<span class="ident" id="5314242"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313089">serialCap</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314256">return</span>&nbsp;<span class="ident" id="5314263"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314081">ret</a></span><br>
<span class="lineno"></span><span class="op" id="5314267">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="5314270">//&nbsp;InLen&nbsp;returns&nbsp;the&nbsp;current&nbsp;buffer&nbsp;length&nbsp;of&nbsp;the&nbsp;input&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="5314339">func</span>&nbsp;<span class="op" id="5314344">(</span><span class="ident" id="5314345">s</span>&nbsp;<span class="op" id="5314347">*</span><span class="ident" id="5314348"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312311">serial</a></span><span class="op" id="5314354">)</span>&nbsp;<span class="ident" id="5314356">InLen</span><span class="op" id="5314361">(</span><span class="op" id="5314362">)</span>&nbsp;<span class="builtintype" id="5314364">uint32</span>&nbsp;<span class="op" id="5314371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314374">head</span>&nbsp;<span class="op" id="5314379">:=</span>&nbsp;<span class="ident" id="5314382"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314345">s</a></span><span class="op" id="5314383">.</span><span class="ident" id="5314384">p</span><span class="op" id="5314385">.</span><span class="ident" id="5314386">ReadWord</span><span class="op" id="5314394">(</span><span class="ident" id="5314395"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312499">serialInHead</a></span><span class="op" id="5314407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314410">tail</span>&nbsp;<span class="op" id="5314415">:=</span>&nbsp;<span class="ident" id="5314418"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314345">s</a></span><span class="op" id="5314419">.</span><span class="ident" id="5314420">p</span><span class="op" id="5314421">.</span><span class="ident" id="5314422">ReadWord</span><span class="op" id="5314430">(</span><span class="ident" id="5314431"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312556">serialInTail</a></span><span class="op" id="5314443">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314446">ret</span>&nbsp;<span class="op" id="5314450">:=</span>&nbsp;<span class="ident" id="5314453"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314374">head</a></span>&nbsp;<span class="op" id="5314458">-</span>&nbsp;<span class="ident" id="5314460"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314410">tail</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314466">if</span>&nbsp;<span class="ident" id="5314469"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314446">ret</a></span>&nbsp;<span class="op" id="5314473">&gt;</span>&nbsp;<span class="ident" id="5314475"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313089">serialCap</a></span>&nbsp;<span class="op" id="5314485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314489"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312153">log</a></span><span class="op" id="5314492">.</span><span class="ident" id="5314493">Printf</span><span class="op" id="5314499">(</span><span class="string" id="5314500">&#34;error&nbsp;input&nbsp;buffer&nbsp;length&#34;</span><span class="op" id="5314527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5314531">//&nbsp;on&nbsp;error,&nbsp;set&nbsp;the&nbsp;length&nbsp;to&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5314570">//&nbsp;to&nbsp;avoid&nbsp;trigger&nbsp;interrupt</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314602"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314446">ret</a></span>&nbsp;<span class="op" id="5314606">=</span>&nbsp;<span class="num" id="5314608">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314614">return</span>&nbsp;<span class="ident" id="5314621"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314446">ret</a></span><br>
<span class="lineno"></span><span class="op" id="5314625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5314628">//&nbsp;ReadByte&nbsp;reads&nbsp;a&nbsp;byte&nbsp;out&nbsp;of&nbsp;serial&nbsp;output&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="5314687">func</span>&nbsp;<span class="op" id="5314692">(</span><span class="ident" id="5314693">s</span>&nbsp;<span class="op" id="5314695">*</span><span class="ident" id="5314696"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312311">serial</a></span><span class="op" id="5314702">)</span>&nbsp;<span class="ident" id="5314704">ReadByte</span><span class="op" id="5314712">(</span><span class="op" id="5314713">)</span>&nbsp;<span class="op" id="5314715">(</span><span class="builtintype" id="5314716">byte</span><span class="op" id="5314720">,</span>&nbsp;<span class="builtintype" id="5314722">bool</span><span class="op" id="5314726">)</span>&nbsp;<span class="op" id="5314728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314731">head</span>&nbsp;<span class="op" id="5314736">:=</span>&nbsp;<span class="ident" id="5314739"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314693">s</a></span><span class="op" id="5314740">.</span><span class="ident" id="5314741">p</span><span class="op" id="5314742">.</span><span class="ident" id="5314743">ReadWord</span><span class="op" id="5314751">(</span><span class="ident" id="5314752"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312759">serialOutHead</a></span><span class="op" id="5314765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314768">tail</span>&nbsp;<span class="op" id="5314773">:=</span>&nbsp;<span class="ident" id="5314776"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314693">s</a></span><span class="op" id="5314777">.</span><span class="ident" id="5314778">p</span><span class="op" id="5314779">.</span><span class="ident" id="5314780">ReadWord</span><span class="op" id="5314788">(</span><span class="ident" id="5314789"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312812">serialOutTail</a></span><span class="op" id="5314802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314805">n</span>&nbsp;<span class="op" id="5314807">:=</span>&nbsp;<span class="ident" id="5314810"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314731">head</a></span>&nbsp;<span class="op" id="5314815">-</span>&nbsp;<span class="ident" id="5314817"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314768">tail</a></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314823">if</span>&nbsp;<span class="ident" id="5314826"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314805">n</a></span>&nbsp;<span class="op" id="5314828">==</span>&nbsp;<span class="num" id="5314831">0</span>&nbsp;<span class="op" id="5314833">||</span>&nbsp;<span class="ident" id="5314836"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314805">n</a></span>&nbsp;<span class="op" id="5314838">&gt;</span>&nbsp;<span class="ident" id="5314840"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313089">serialCap</a></span>&nbsp;<span class="op" id="5314850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5314854">return</span>&nbsp;<span class="num" id="5314861">0</span><span class="op" id="5314862">,</span>&nbsp;<span class="ident" id="5314864">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5314871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314875">b</span>&nbsp;<span class="op" id="5314877">:=</span>&nbsp;<span class="ident" id="5314880"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314693">s</a></span><span class="op" id="5314881">.</span><span class="ident" id="5314882">p</span><span class="op" id="5314883">.</span><span class="ident" id="5314884">ReadByte</span><span class="op" id="5314892">(</span><span class="ident" id="5314893"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313056">serialOutBuf</a></span>&nbsp;<span class="op" id="5314906">+</span>&nbsp;<span class="ident" id="5314908"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314768">tail</a></span><span class="op" id="5314912">%</span><span class="num" id="5314913">32</span><span class="op" id="5314915">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314918"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314768">tail</a></span><span class="op" id="5314922">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314926"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314693">s</a></span><span class="op" id="5314927">.</span><span class="ident" id="5314928">p</span><span class="op" id="5314929">.</span><span class="ident" id="5314930">WriteWord</span><span class="op" id="5314939">(</span><span class="ident" id="5314940"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312812">serialOutTail</a></span><span class="op" id="5314953">,</span>&nbsp;<span class="ident" id="5314955"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314768">tail</a></span><span class="op" id="5314959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314963"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314805">n</a></span><span class="op" id="5314964">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5314968">thresh</span>&nbsp;<span class="op" id="5314975">:=</span>&nbsp;<span class="ident" id="5314978"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314693">s</a></span><span class="op" id="5314979">.</span><span class="ident" id="5314980">p</span><span class="op" id="5314981">.</span><span class="ident" id="5314982">ReadWord</span><span class="op" id="5314990">(</span><span class="ident" id="5314991"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312945">serialOutThresh</a></span><span class="op" id="5315006">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315009">if</span>&nbsp;<span class="ident" id="5315012"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314805">n</a></span>&nbsp;<span class="op" id="5315014">&lt;=</span>&nbsp;<span class="ident" id="5315017"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314968">thresh</a></span>&nbsp;<span class="op" id="5315024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315028"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314693">s</a></span><span class="op" id="5315029">.</span><span class="ident" id="5315030">interrupt</span><span class="op" id="5315039">(</span><span class="ident" id="5315040"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314693">s</a></span><span class="op" id="5315041">.</span><span class="ident" id="5315042">IntOut</span><span class="op" id="5315048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315055">return</span>&nbsp;<span class="ident" id="5315062"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5314875">b</a></span><span class="op" id="5315063">,</span>&nbsp;<span class="ident" id="5315065">true</span><br>
<span class="lineno">135</span><span class="op" id="5315070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5315073">func</span>&nbsp;<span class="op" id="5315078">(</span><span class="ident" id="5315079">s</span>&nbsp;<span class="op" id="5315081">*</span><span class="ident" id="5315082"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312311">serial</a></span><span class="op" id="5315088">)</span>&nbsp;<span class="ident" id="5315090">countDown</span><span class="op" id="5315099">(</span><span class="op" id="5315100">)</span>&nbsp;<span class="op" id="5315102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315105">inWait</span>&nbsp;<span class="op" id="5315112">:=</span>&nbsp;<span class="ident" id="5315115"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315079">s</a></span><span class="op" id="5315116">.</span><span class="ident" id="5315117">p</span><span class="op" id="5315118">.</span><span class="ident" id="5315119">ReadWord</span><span class="op" id="5315127">(</span><span class="ident" id="5315128"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312608">serialInWait</a></span><span class="op" id="5315140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315143">outWait</span>&nbsp;<span class="op" id="5315151">:=</span>&nbsp;<span class="ident" id="5315154"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315079">s</a></span><span class="op" id="5315155">.</span><span class="ident" id="5315156">p</span><span class="op" id="5315157">.</span><span class="ident" id="5315158">ReadWord</span><span class="op" id="5315166">(</span><span class="ident" id="5315167"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312870">serialOutWait</a></span><span class="op" id="5315180">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315184">if</span>&nbsp;<span class="ident" id="5315187"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315105">inWait</a></span>&nbsp;<span class="op" id="5315194">&gt;</span>&nbsp;<span class="num" id="5315196">0</span>&nbsp;<span class="op" id="5315198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315202"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315105">inWait</a></span><span class="op" id="5315208">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315215">if</span>&nbsp;<span class="ident" id="5315218"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315143">outWait</a></span>&nbsp;<span class="op" id="5315226">&gt;</span>&nbsp;<span class="num" id="5315228">0</span>&nbsp;<span class="op" id="5315230">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315234"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315143">outWait</a></span><span class="op" id="5315241">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315249">if</span>&nbsp;<span class="ident" id="5315252"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315105">inWait</a></span>&nbsp;<span class="op" id="5315259">==</span>&nbsp;<span class="num" id="5315262">0</span>&nbsp;<span class="op" id="5315264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315268">if</span>&nbsp;<span class="ident" id="5315271"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315079">s</a></span><span class="op" id="5315272">.</span><span class="ident" id="5315273">InLen</span><span class="op" id="5315278">(</span><span class="op" id="5315279">)</span>&nbsp;<span class="op" id="5315281">&gt;</span>&nbsp;<span class="num" id="5315283">0</span>&nbsp;<span class="op" id="5315285">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315290"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315079">s</a></span><span class="op" id="5315291">.</span><span class="ident" id="5315292">interrupt</span><span class="op" id="5315301">(</span><span class="ident" id="5315302"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315079">s</a></span><span class="op" id="5315303">.</span><span class="ident" id="5315304">IntIn</span><span class="op" id="5315309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315320">if</span>&nbsp;<span class="ident" id="5315323"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315143">outWait</a></span>&nbsp;<span class="op" id="5315331">==</span>&nbsp;<span class="num" id="5315334">0</span>&nbsp;<span class="op" id="5315336">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315340">if</span>&nbsp;<span class="ident" id="5315343"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315079">s</a></span><span class="op" id="5315344">.</span><span class="ident" id="5315345">OutLen</span><span class="op" id="5315351">(</span><span class="op" id="5315352">)</span>&nbsp;<span class="op" id="5315354">&lt;</span>&nbsp;<span class="ident" id="5315356"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5313089">serialCap</a></span>&nbsp;<span class="op" id="5315366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315371"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315079">s</a></span><span class="op" id="5315372">.</span><span class="ident" id="5315373">interrupt</span><span class="op" id="5315382">(</span><span class="ident" id="5315383"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315079">s</a></span><span class="op" id="5315384">.</span><span class="ident" id="5315385">IntOut</span><span class="op" id="5315391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315402"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315079">s</a></span><span class="op" id="5315403">.</span><span class="ident" id="5315404">p</span><span class="op" id="5315405">.</span><span class="ident" id="5315406">WriteWord</span><span class="op" id="5315415">(</span><span class="ident" id="5315416"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312608">serialInWait</a></span><span class="op" id="5315428">,</span>&nbsp;<span class="ident" id="5315430"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315105">inWait</a></span><span class="op" id="5315436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315439"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315079">s</a></span><span class="op" id="5315440">.</span><span class="ident" id="5315441">p</span><span class="op" id="5315442">.</span><span class="ident" id="5315443">WriteWord</span><span class="op" id="5315452">(</span><span class="ident" id="5315453"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312870">serialOutWait</a></span><span class="op" id="5315466">,</span>&nbsp;<span class="ident" id="5315468"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315143">outWait</a></span><span class="op" id="5315475">)</span><br>
<span class="lineno"></span><span class="op" id="5315477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5315480">func</span>&nbsp;<span class="op" id="5315485">(</span><span class="ident" id="5315486">s</span>&nbsp;<span class="op" id="5315488">*</span><span class="ident" id="5315489"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312311">serial</a></span><span class="op" id="5315495">)</span>&nbsp;<span class="ident" id="5315497">flush</span><span class="op" id="5315502">(</span><span class="op" id="5315503">)</span>&nbsp;<span class="op" id="5315505">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315508">buf</span>&nbsp;<span class="op" id="5315512">:=</span>&nbsp;<span class="builtinfunc" id="5315515">new</span><span class="op" id="5315518">(</span><span class="ident" id="5315519"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312138">bytes</a></span><span class="op" id="5315524">.</span><span class="ident" id="5315525">Buffer</span><span class="op" id="5315531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315534">for</span>&nbsp;<span class="op" id="5315538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315542">b</span><span class="op" id="5315543">,</span>&nbsp;<span class="ident" id="5315545">valid</span>&nbsp;<span class="op" id="5315551">:=</span>&nbsp;<span class="ident" id="5315554"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315486">s</a></span><span class="op" id="5315555">.</span><span class="ident" id="5315556">ReadByte</span><span class="op" id="5315564">(</span><span class="op" id="5315565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315569">if</span>&nbsp;<span class="ident" id="5315572"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315545">valid</a></span>&nbsp;<span class="op" id="5315578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315583"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315508">buf</a></span><span class="op" id="5315586">.</span><span class="ident" id="5315587">WriteByte</span><span class="op" id="5315596">(</span><span class="ident" id="5315597"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315542">b</a></span><span class="op" id="5315598">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315602">}</span>&nbsp;<span class="keyword" id="5315604">else</span>&nbsp;<span class="op" id="5315609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315614">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315629">if</span>&nbsp;<span class="ident" id="5315632"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315486">s</a></span><span class="op" id="5315633">.</span><span class="ident" id="5315634">Output</span>&nbsp;<span class="op" id="5315641">!=</span>&nbsp;<span class="ident" id="5315644">nil</span>&nbsp;<span class="op" id="5315648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315652">_</span><span class="op" id="5315653">,</span>&nbsp;<span class="ident" id="5315655">e</span>&nbsp;<span class="op" id="5315657">:=</span>&nbsp;<span class="ident" id="5315660"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315486">s</a></span><span class="op" id="5315661">.</span><span class="ident" id="5315662">Output</span><span class="op" id="5315668">.</span><span class="ident" id="5315669">Write</span><span class="op" id="5315674">(</span><span class="ident" id="5315675"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315508">buf</a></span><span class="op" id="5315678">.</span><span class="ident" id="5315679">Bytes</span><span class="op" id="5315684">(</span><span class="op" id="5315685">)</span><span class="op" id="5315686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5315690">if</span>&nbsp;<span class="ident" id="5315693"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315655">e</a></span>&nbsp;<span class="op" id="5315695">!=</span>&nbsp;<span class="ident" id="5315698">nil</span>&nbsp;<span class="op" id="5315702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315707"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312153">log</a></span><span class="op" id="5315710">.</span><span class="ident" id="5315711">Print</span><span class="op" id="5315716">(</span><span class="ident" id="5315717"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315655">e</a></span><span class="op" id="5315718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315722">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5315725">}</span><br>
<span class="lineno"></span><span class="op" id="5315727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5315730">//&nbsp;Tick&nbsp;counts&nbsp;down&nbsp;the&nbsp;waiting&nbsp;counters&nbsp;and&nbsp;triggers</span><br>
<span class="lineno"></span><span class="comment" id="5315784">//&nbsp;interrupt&nbsp;when&nbsp;the&nbsp;count&nbsp;down&nbsp;reaches&nbsp;zero.</span><br>
<span class="lineno">185</span><span class="keyword" id="5315831">func</span>&nbsp;<span class="op" id="5315836">(</span><span class="ident" id="5315837">s</span>&nbsp;<span class="op" id="5315839">*</span><span class="ident" id="5315840"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5312311">serial</a></span><span class="op" id="5315846">)</span>&nbsp;<span class="ident" id="5315848">Tick</span><span class="op" id="5315852">(</span><span class="op" id="5315853">)</span>&nbsp;<span class="op" id="5315855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315858"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315837">s</a></span><span class="op" id="5315859">.</span><span class="ident" id="5315860">flush</span><span class="op" id="5315865">(</span><span class="op" id="5315866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5315869"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5315837">s</a></span><span class="op" id="5315870">.</span><span class="ident" id="5315871">countDown</span><span class="op" id="5315880">(</span><span class="op" id="5315881">)</span><br>
<span class="lineno"></span><span class="op" id="5315883">}</span>
</div>
</body>
</html>
