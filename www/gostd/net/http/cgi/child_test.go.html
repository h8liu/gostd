<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html" class="current">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7320251">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7320306">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7320360">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7320411">//&nbsp;Tests&nbsp;for&nbsp;CGI&nbsp;(the&nbsp;child&nbsp;process&nbsp;perspective)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7320461">package</span>&nbsp;<span class="ident" id="7320469">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7320474">import</span>&nbsp;<span class="op" id="7320481">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320484">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7320494">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7320497">func</span>&nbsp;<span class="ident" id="7320502">TestRequest</span><span class="op" id="7320513">(</span><span class="ident" id="7320514">t</span>&nbsp;<span class="op" id="7320516">*</span><span class="ident" id="7320517">testing</span><span class="op" id="7320524">.</span><span class="ident" id="7320525">T</span><span class="op" id="7320526">)</span>&nbsp;<span class="op" id="7320528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7320531">env</span>&nbsp;<span class="op" id="7320535">:=</span>&nbsp;<span class="keyword" id="7320538">map</span><span class="op" id="7320541">[</span><span class="builtintype" id="7320542">string</span><span class="op" id="7320548">]</span><span class="builtintype" id="7320549">string</span><span class="op" id="7320555">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320559">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7320576">:</span>&nbsp;<span class="string" id="7320578">&#34;HTTP/1.1&#34;</span><span class="op" id="7320588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320592">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7320608">:</span>&nbsp;&nbsp;<span class="string" id="7320611">&#34;GET&#34;</span><span class="op" id="7320616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320620">&#34;HTTP_HOST&#34;</span><span class="op" id="7320631">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320639">&#34;example.com&#34;</span><span class="op" id="7320652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320656">&#34;HTTP_REFERER&#34;</span><span class="op" id="7320670">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320675">&#34;elsewhere&#34;</span><span class="op" id="7320686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320690">&#34;HTTP_USER_AGENT&#34;</span><span class="op" id="7320707">:</span>&nbsp;<span class="string" id="7320709">&#34;goclient&#34;</span><span class="op" id="7320719">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320723">&#34;HTTP_FOO_BAR&#34;</span><span class="op" id="7320737">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320742">&#34;baz&#34;</span><span class="op" id="7320747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320751">&#34;REQUEST_URI&#34;</span><span class="op" id="7320764">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320770">&#34;/path?a=b&#34;</span><span class="op" id="7320781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320785">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="7320801">:</span>&nbsp;&nbsp;<span class="string" id="7320804">&#34;123&#34;</span><span class="op" id="7320809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320813">&#34;CONTENT_TYPE&#34;</span><span class="op" id="7320827">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320832">&#34;text/xml&#34;</span><span class="op" id="7320842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320846">&#34;REMOTE_ADDR&#34;</span><span class="op" id="7320859">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7320865">&#34;5.6.7.8&#34;</span><span class="op" id="7320874">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7320877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7320880">req</span><span class="op" id="7320883">,</span>&nbsp;<span class="ident" id="7320885">err</span>&nbsp;<span class="op" id="7320889">:=</span>&nbsp;<span class="ident" id="7320892">RequestFromMap</span><span class="op" id="7320906">(</span><span class="ident" id="7320907">env</span><span class="op" id="7320910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7320913">if</span>&nbsp;<span class="ident" id="7320916">err</span>&nbsp;<span class="op" id="7320920">!=</span>&nbsp;<span class="builtintype" id="7320923">nil</span>&nbsp;<span class="op" id="7320927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7320931">t</span><span class="op" id="7320932">.</span><span class="ident" id="7320933">Fatalf</span><span class="op" id="7320939">(</span><span class="string" id="7320940">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7320960">,</span>&nbsp;<span class="ident" id="7320962">err</span><span class="op" id="7320965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7320968">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7320971">if</span>&nbsp;<span class="ident" id="7320974">g</span><span class="op" id="7320975">,</span>&nbsp;<span class="ident" id="7320977">e</span>&nbsp;<span class="op" id="7320979">:=</span>&nbsp;<span class="ident" id="7320982">req</span><span class="op" id="7320985">.</span><span class="ident" id="7320986">UserAgent</span><span class="op" id="7320995">(</span><span class="op" id="7320996">)</span><span class="op" id="7320997">,</span>&nbsp;<span class="string" id="7320999">&#34;goclient&#34;</span><span class="op" id="7321009">;</span>&nbsp;<span class="ident" id="7321011">e</span>&nbsp;<span class="op" id="7321013">!=</span>&nbsp;<span class="ident" id="7321016">g</span>&nbsp;<span class="op" id="7321018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7321022">t</span><span class="op" id="7321023">.</span><span class="ident" id="7321024">Errorf</span><span class="op" id="7321030">(</span><span class="string" id="7321031">&#34;expected&nbsp;UserAgent&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7321062">,</span>&nbsp;<span class="ident" id="7321064">e</span><span class="op" id="7321065">,</span>&nbsp;<span class="ident" id="7321067">g</span><span class="op" id="7321068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7321071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7321074">if</span>&nbsp;<span class="ident" id="7321077">g</span><span class="op" id="7321078">,</span>&nbsp;<span class="ident" id="7321080">e</span>&nbsp;<span class="op" id="7321082">:=</span>&nbsp;<span class="ident" id="7321085">req</span><span class="op" id="7321088">.</span><span class="ident" id="7321089">Method</span><span class="op" id="7321095">,</span>&nbsp;<span class="string" id="7321097">&#34;GET&#34;</span><span class="op" id="7321102">;</span>&nbsp;<span class="ident" id="7321104">e</span>&nbsp;<span class="op" id="7321106">!=</span>&nbsp;<span class="ident" id="7321109">g</span>&nbsp;<span class="op" id="7321111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7321115">t</span><span class="op" id="7321116">.</span><span class="ident" id="7321117">Errorf</span><span class="op" id="7321123">(</span><span class="string" id="7321124">&#34;expected&nbsp;Method&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7321152">,</span>&nbsp;<span class="ident" id="7321154">e</span><span class="op" id="7321155">,</span>&nbsp;<span class="ident" id="7321157">g</span><span class="op" id="7321158">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7321161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7321164">if</span>&nbsp;<span class="ident" id="7321167">g</span><span class="op" id="7321168">,</span>&nbsp;<span class="ident" id="7321170">e</span>&nbsp;<span class="op" id="7321172">:=</span>&nbsp;<span class="ident" id="7321175">req</span><span class="op" id="7321178">.</span><span class="ident" id="7321179">Header</span><span class="op" id="7321185">.</span><span class="ident" id="7321186">Get</span><span class="op" id="7321189">(</span><span class="string" id="7321190">&#34;Content-Type&#34;</span><span class="op" id="7321204">)</span><span class="op" id="7321205">,</span>&nbsp;<span class="string" id="7321207">&#34;text/xml&#34;</span><span class="op" id="7321217">;</span>&nbsp;<span class="ident" id="7321219">e</span>&nbsp;<span class="op" id="7321221">!=</span>&nbsp;<span class="ident" id="7321224">g</span>&nbsp;<span class="op" id="7321226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7321230">t</span><span class="op" id="7321231">.</span><span class="ident" id="7321232">Errorf</span><span class="op" id="7321238">(</span><span class="string" id="7321239">&#34;expected&nbsp;Content-Type&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7321273">,</span>&nbsp;<span class="ident" id="7321275">e</span><span class="op" id="7321276">,</span>&nbsp;<span class="ident" id="7321278">g</span><span class="op" id="7321279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7321282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7321285">if</span>&nbsp;<span class="ident" id="7321288">g</span><span class="op" id="7321289">,</span>&nbsp;<span class="ident" id="7321291">e</span>&nbsp;<span class="op" id="7321293">:=</span>&nbsp;<span class="ident" id="7321296">req</span><span class="op" id="7321299">.</span><span class="ident" id="7321300">ContentLength</span><span class="op" id="7321313">,</span>&nbsp;<span class="builtintype" id="7321315">int64</span><span class="op" id="7321320">(</span><span class="num" id="7321321">123</span><span class="op" id="7321324">)</span><span class="op" id="7321325">;</span>&nbsp;<span class="ident" id="7321327">e</span>&nbsp;<span class="op" id="7321329">!=</span>&nbsp;<span class="ident" id="7321332">g</span>&nbsp;<span class="op" id="7321334">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7321338">t</span><span class="op" id="7321339">.</span><span class="ident" id="7321340">Errorf</span><span class="op" id="7321346">(</span><span class="string" id="7321347">&#34;expected&nbsp;ContentLength&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7321382">,</span>&nbsp;<span class="ident" id="7321384">e</span><span class="op" id="7321385">,</span>&nbsp;<span class="ident" id="7321387">g</span><span class="op" id="7321388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7321391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7321394">if</span>&nbsp;<span class="ident" id="7321397">g</span><span class="op" id="7321398">,</span>&nbsp;<span class="ident" id="7321400">e</span>&nbsp;<span class="op" id="7321402">:=</span>&nbsp;<span class="ident" id="7321405">req</span><span class="op" id="7321408">.</span><span class="ident" id="7321409">Referer</span><span class="op" id="7321416">(</span><span class="op" id="7321417">)</span><span class="op" id="7321418">,</span>&nbsp;<span class="string" id="7321420">&#34;elsewhere&#34;</span><span class="op" id="7321431">;</span>&nbsp;<span class="ident" id="7321433">e</span>&nbsp;<span class="op" id="7321435">!=</span>&nbsp;<span class="ident" id="7321438">g</span>&nbsp;<span class="op" id="7321440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7321444">t</span><span class="op" id="7321445">.</span><span class="ident" id="7321446">Errorf</span><span class="op" id="7321452">(</span><span class="string" id="7321453">&#34;expected&nbsp;Referer&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7321482">,</span>&nbsp;<span class="ident" id="7321484">e</span><span class="op" id="7321485">,</span>&nbsp;<span class="ident" id="7321487">g</span><span class="op" id="7321488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7321491">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7321494">if</span>&nbsp;<span class="ident" id="7321497">req</span><span class="op" id="7321500">.</span><span class="ident" id="7321501">Header</span>&nbsp;<span class="op" id="7321508">==</span>&nbsp;<span class="builtintype" id="7321511">nil</span>&nbsp;<span class="op" id="7321515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7321519">t</span><span class="op" id="7321520">.</span><span class="ident" id="7321521">Fatalf</span><span class="op" id="7321527">(</span><span class="string" id="7321528">&#34;unexpected&nbsp;nil&nbsp;Header&#34;</span><span class="op" id="7321551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7321554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7321557">if</span>&nbsp;<span class="ident" id="7321560">g</span><span class="op" id="7321561">,</span>&nbsp;<span class="ident" id="7321563">e</span>&nbsp;<span class="op" id="7321565">:=</span>&nbsp;<span class="ident" id="7321568">req</span><span class="op" id="7321571">.</span><span class="ident" id="7321572">Header</span><span class="op" id="7321578">.</span><span class="ident" id="7321579">Get</span><span class="op" id="7321582">(</span><span class="string" id="7321583">&#34;Foo-Bar&#34;</span><span class="op" id="7321592">)</span><span class="op" id="7321593">,</span>&nbsp;<span class="string" id="7321595">&#34;baz&#34;</span><span class="op" id="7321600">;</span>&nbsp;<span class="ident" id="7321602">e</span>&nbsp;<span class="op" id="7321604">!=</span>&nbsp;<span class="ident" id="7321607">g</span>&nbsp;<span class="op" id="7321609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7321613">t</span><span class="op" id="7321614">.</span><span class="ident" id="7321615">Errorf</span><span class="op" id="7321621">(</span><span class="string" id="7321622">&#34;expected&nbsp;Foo-Bar&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7321651">,</span>&nbsp;<span class="ident" id="7321653">e</span><span class="op" id="7321654">,</span>&nbsp;<span class="ident" id="7321656">g</span><span class="op" id="7321657">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7321660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7321663">if</span>&nbsp;<span class="ident" id="7321666">g</span><span class="op" id="7321667">,</span>&nbsp;<span class="ident" id="7321669">e</span>&nbsp;<span class="op" id="7321671">:=</span>&nbsp;<span class="ident" id="7321674">req</span><span class="op" id="7321677">.</span><span class="ident" id="7321678">URL</span><span class="op" id="7321681">.</span><span class="ident" id="7321682">String</span><span class="op" id="7321688">(</span><span class="op" id="7321689">)</span><span class="op" id="7321690">,</span>&nbsp;<span class="string" id="7321692">&#34;http://example.com/path?a=b&#34;</span><span class="op" id="7321721">;</span>&nbsp;<span class="ident" id="7321723">e</span>&nbsp;<span class="op" id="7321725">!=</span>&nbsp;<span class="ident" id="7321728">g</span>&nbsp;<span class="op" id="7321730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7321734">t</span><span class="op" id="7321735">.</span><span class="ident" id="7321736">Errorf</span><span class="op" id="7321742">(</span><span class="string" id="7321743">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7321768">,</span>&nbsp;<span class="ident" id="7321770">e</span><span class="op" id="7321771">,</span>&nbsp;<span class="ident" id="7321773">g</span><span class="op" id="7321774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7321777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7321780">if</span>&nbsp;<span class="ident" id="7321783">g</span><span class="op" id="7321784">,</span>&nbsp;<span class="ident" id="7321786">e</span>&nbsp;<span class="op" id="7321788">:=</span>&nbsp;<span class="ident" id="7321791">req</span><span class="op" id="7321794">.</span><span class="ident" id="7321795">FormValue</span><span class="op" id="7321804">(</span><span class="string" id="7321805">&#34;a&#34;</span><span class="op" id="7321808">)</span><span class="op" id="7321809">,</span>&nbsp;<span class="string" id="7321811">&#34;b&#34;</span><span class="op" id="7321814">;</span>&nbsp;<span class="ident" id="7321816">e</span>&nbsp;<span class="op" id="7321818">!=</span>&nbsp;<span class="ident" id="7321821">g</span>&nbsp;<span class="op" id="7321823">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7321827">t</span><span class="op" id="7321828">.</span><span class="ident" id="7321829">Errorf</span><span class="op" id="7321835">(</span><span class="string" id="7321836">&#34;expected&nbsp;FormValue(a)&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7321870">,</span>&nbsp;<span class="ident" id="7321872">e</span><span class="op" id="7321873">,</span>&nbsp;<span class="ident" id="7321875">g</span><span class="op" id="7321876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7321879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7321882">if</span>&nbsp;<span class="ident" id="7321885">req</span><span class="op" id="7321888">.</span><span class="ident" id="7321889">Trailer</span>&nbsp;<span class="op" id="7321897">==</span>&nbsp;<span class="builtintype" id="7321900">nil</span>&nbsp;<span class="op" id="7321904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7321908">t</span><span class="op" id="7321909">.</span><span class="ident" id="7321910">Errorf</span><span class="op" id="7321916">(</span><span class="string" id="7321917">&#34;unexpected&nbsp;nil&nbsp;Trailer&#34;</span><span class="op" id="7321941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7321944">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7321947">if</span>&nbsp;<span class="ident" id="7321950">req</span><span class="op" id="7321953">.</span><span class="ident" id="7321954">TLS</span>&nbsp;<span class="op" id="7321958">!=</span>&nbsp;<span class="builtintype" id="7321961">nil</span>&nbsp;<span class="op" id="7321965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7321969">t</span><span class="op" id="7321970">.</span><span class="ident" id="7321971">Errorf</span><span class="op" id="7321977">(</span><span class="string" id="7321978">&#34;expected&nbsp;nil&nbsp;TLS&#34;</span><span class="op" id="7321996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7321999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7322002">if</span>&nbsp;<span class="ident" id="7322005">e</span><span class="op" id="7322006">,</span>&nbsp;<span class="ident" id="7322008">g</span>&nbsp;<span class="op" id="7322010">:=</span>&nbsp;<span class="string" id="7322013">&#34;5.6.7.8:0&#34;</span><span class="op" id="7322024">,</span>&nbsp;<span class="ident" id="7322026">req</span><span class="op" id="7322029">.</span><span class="ident" id="7322030">RemoteAddr</span><span class="op" id="7322040">;</span>&nbsp;<span class="ident" id="7322042">e</span>&nbsp;<span class="op" id="7322044">!=</span>&nbsp;<span class="ident" id="7322047">g</span>&nbsp;<span class="op" id="7322049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7322053">t</span><span class="op" id="7322054">.</span><span class="ident" id="7322055">Errorf</span><span class="op" id="7322061">(</span><span class="string" id="7322062">&#34;RemoteAddr:&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7322091">,</span>&nbsp;<span class="ident" id="7322093">g</span><span class="op" id="7322094">,</span>&nbsp;<span class="ident" id="7322096">e</span><span class="op" id="7322097">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7322100">}</span><br>
<span class="lineno"></span><span class="op" id="7322102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7322105">func</span>&nbsp;<span class="ident" id="7322110">TestRequestWithTLS</span><span class="op" id="7322128">(</span><span class="ident" id="7322129">t</span>&nbsp;<span class="op" id="7322131">*</span><span class="ident" id="7322132">testing</span><span class="op" id="7322139">.</span><span class="ident" id="7322140">T</span><span class="op" id="7322141">)</span>&nbsp;<span class="op" id="7322143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7322146">env</span>&nbsp;<span class="op" id="7322150">:=</span>&nbsp;<span class="keyword" id="7322153">map</span><span class="op" id="7322156">[</span><span class="builtintype" id="7322157">string</span><span class="op" id="7322163">]</span><span class="builtintype" id="7322164">string</span><span class="op" id="7322170">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322174">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7322191">:</span>&nbsp;<span class="string" id="7322193">&#34;HTTP/1.1&#34;</span><span class="op" id="7322203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322207">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7322223">:</span>&nbsp;&nbsp;<span class="string" id="7322226">&#34;GET&#34;</span><span class="op" id="7322231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322235">&#34;HTTP_HOST&#34;</span><span class="op" id="7322246">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322254">&#34;example.com&#34;</span><span class="op" id="7322267">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322271">&#34;HTTP_REFERER&#34;</span><span class="op" id="7322285">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322290">&#34;elsewhere&#34;</span><span class="op" id="7322301">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322305">&#34;REQUEST_URI&#34;</span><span class="op" id="7322318">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322324">&#34;/path?a=b&#34;</span><span class="op" id="7322335">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322339">&#34;CONTENT_TYPE&#34;</span><span class="op" id="7322353">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322358">&#34;text/xml&#34;</span><span class="op" id="7322368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322372">&#34;HTTPS&#34;</span><span class="op" id="7322379">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322391">&#34;1&#34;</span><span class="op" id="7322394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322398">&#34;REMOTE_ADDR&#34;</span><span class="op" id="7322411">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322417">&#34;5.6.7.8&#34;</span><span class="op" id="7322426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7322429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7322432">req</span><span class="op" id="7322435">,</span>&nbsp;<span class="ident" id="7322437">err</span>&nbsp;<span class="op" id="7322441">:=</span>&nbsp;<span class="ident" id="7322444">RequestFromMap</span><span class="op" id="7322458">(</span><span class="ident" id="7322459">env</span><span class="op" id="7322462">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7322465">if</span>&nbsp;<span class="ident" id="7322468">err</span>&nbsp;<span class="op" id="7322472">!=</span>&nbsp;<span class="builtintype" id="7322475">nil</span>&nbsp;<span class="op" id="7322479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7322483">t</span><span class="op" id="7322484">.</span><span class="ident" id="7322485">Fatalf</span><span class="op" id="7322491">(</span><span class="string" id="7322492">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7322512">,</span>&nbsp;<span class="ident" id="7322514">err</span><span class="op" id="7322517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7322520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7322523">if</span>&nbsp;<span class="ident" id="7322526">g</span><span class="op" id="7322527">,</span>&nbsp;<span class="ident" id="7322529">e</span>&nbsp;<span class="op" id="7322531">:=</span>&nbsp;<span class="ident" id="7322534">req</span><span class="op" id="7322537">.</span><span class="ident" id="7322538">URL</span><span class="op" id="7322541">.</span><span class="ident" id="7322542">String</span><span class="op" id="7322548">(</span><span class="op" id="7322549">)</span><span class="op" id="7322550">,</span>&nbsp;<span class="string" id="7322552">&#34;https://example.com/path?a=b&#34;</span><span class="op" id="7322582">;</span>&nbsp;<span class="ident" id="7322584">e</span>&nbsp;<span class="op" id="7322586">!=</span>&nbsp;<span class="ident" id="7322589">g</span>&nbsp;<span class="op" id="7322591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7322595">t</span><span class="op" id="7322596">.</span><span class="ident" id="7322597">Errorf</span><span class="op" id="7322603">(</span><span class="string" id="7322604">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7322629">,</span>&nbsp;<span class="ident" id="7322631">e</span><span class="op" id="7322632">,</span>&nbsp;<span class="ident" id="7322634">g</span><span class="op" id="7322635">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7322638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7322641">if</span>&nbsp;<span class="ident" id="7322644">req</span><span class="op" id="7322647">.</span><span class="ident" id="7322648">TLS</span>&nbsp;<span class="op" id="7322652">==</span>&nbsp;<span class="builtintype" id="7322655">nil</span>&nbsp;<span class="op" id="7322659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7322663">t</span><span class="op" id="7322664">.</span><span class="ident" id="7322665">Errorf</span><span class="op" id="7322671">(</span><span class="string" id="7322672">&#34;expected&nbsp;non-nil&nbsp;TLS&#34;</span><span class="op" id="7322694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7322697">}</span><br>
<span class="lineno"></span><span class="op" id="7322699">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="7322702">func</span>&nbsp;<span class="ident" id="7322707">TestRequestWithoutHost</span><span class="op" id="7322729">(</span><span class="ident" id="7322730">t</span>&nbsp;<span class="op" id="7322732">*</span><span class="ident" id="7322733">testing</span><span class="op" id="7322740">.</span><span class="ident" id="7322741">T</span><span class="op" id="7322742">)</span>&nbsp;<span class="op" id="7322744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7322747">env</span>&nbsp;<span class="op" id="7322751">:=</span>&nbsp;<span class="keyword" id="7322754">map</span><span class="op" id="7322757">[</span><span class="builtintype" id="7322758">string</span><span class="op" id="7322764">]</span><span class="builtintype" id="7322765">string</span><span class="op" id="7322771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322775">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7322792">:</span>&nbsp;<span class="string" id="7322794">&#34;HTTP/1.1&#34;</span><span class="op" id="7322804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322808">&#34;HTTP_HOST&#34;</span><span class="op" id="7322819">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322827">&#34;&#34;</span><span class="op" id="7322829">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322833">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7322849">:</span>&nbsp;&nbsp;<span class="string" id="7322852">&#34;GET&#34;</span><span class="op" id="7322857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322861">&#34;REQUEST_URI&#34;</span><span class="op" id="7322874">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322880">&#34;/path?a=b&#34;</span><span class="op" id="7322891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7322895">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="7322911">:</span>&nbsp;&nbsp;<span class="string" id="7322914">&#34;123&#34;</span><span class="op" id="7322919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7322922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7322925">req</span><span class="op" id="7322928">,</span>&nbsp;<span class="ident" id="7322930">err</span>&nbsp;<span class="op" id="7322934">:=</span>&nbsp;<span class="ident" id="7322937">RequestFromMap</span><span class="op" id="7322951">(</span><span class="ident" id="7322952">env</span><span class="op" id="7322955">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7322958">if</span>&nbsp;<span class="ident" id="7322961">err</span>&nbsp;<span class="op" id="7322965">!=</span>&nbsp;<span class="builtintype" id="7322968">nil</span>&nbsp;<span class="op" id="7322972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7322976">t</span><span class="op" id="7322977">.</span><span class="ident" id="7322978">Fatalf</span><span class="op" id="7322984">(</span><span class="string" id="7322985">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7323005">,</span>&nbsp;<span class="ident" id="7323007">err</span><span class="op" id="7323010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7323013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7323016">if</span>&nbsp;<span class="ident" id="7323019">req</span><span class="op" id="7323022">.</span><span class="ident" id="7323023">URL</span>&nbsp;<span class="op" id="7323027">==</span>&nbsp;<span class="builtintype" id="7323030">nil</span>&nbsp;<span class="op" id="7323034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7323038">t</span><span class="op" id="7323039">.</span><span class="ident" id="7323040">Fatalf</span><span class="op" id="7323046">(</span><span class="string" id="7323047">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="7323067">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7323070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7323073">if</span>&nbsp;<span class="ident" id="7323076">g</span><span class="op" id="7323077">,</span>&nbsp;<span class="ident" id="7323079">e</span>&nbsp;<span class="op" id="7323081">:=</span>&nbsp;<span class="ident" id="7323084">req</span><span class="op" id="7323087">.</span><span class="ident" id="7323088">URL</span><span class="op" id="7323091">.</span><span class="ident" id="7323092">String</span><span class="op" id="7323098">(</span><span class="op" id="7323099">)</span><span class="op" id="7323100">,</span>&nbsp;<span class="string" id="7323102">&#34;/path?a=b&#34;</span><span class="op" id="7323113">;</span>&nbsp;<span class="ident" id="7323115">e</span>&nbsp;<span class="op" id="7323117">!=</span>&nbsp;<span class="ident" id="7323120">g</span>&nbsp;<span class="op" id="7323122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7323126">t</span><span class="op" id="7323127">.</span><span class="ident" id="7323128">Errorf</span><span class="op" id="7323134">(</span><span class="string" id="7323135">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7323154">,</span>&nbsp;<span class="ident" id="7323156">g</span><span class="op" id="7323157">,</span>&nbsp;<span class="ident" id="7323159">e</span><span class="op" id="7323160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7323163">}</span><br>
<span class="lineno"></span><span class="op" id="7323165">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="7323168">func</span>&nbsp;<span class="ident" id="7323173">TestRequestWithoutRequestURI</span><span class="op" id="7323201">(</span><span class="ident" id="7323202">t</span>&nbsp;<span class="op" id="7323204">*</span><span class="ident" id="7323205">testing</span><span class="op" id="7323212">.</span><span class="ident" id="7323213">T</span><span class="op" id="7323214">)</span>&nbsp;<span class="op" id="7323216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7323219">env</span>&nbsp;<span class="op" id="7323223">:=</span>&nbsp;<span class="keyword" id="7323226">map</span><span class="op" id="7323229">[</span><span class="builtintype" id="7323230">string</span><span class="op" id="7323236">]</span><span class="builtintype" id="7323237">string</span><span class="op" id="7323243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7323247">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="7323264">:</span>&nbsp;<span class="string" id="7323266">&#34;HTTP/1.1&#34;</span><span class="op" id="7323276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7323280">&#34;HTTP_HOST&#34;</span><span class="op" id="7323291">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7323299">&#34;example.com&#34;</span><span class="op" id="7323312">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7323316">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7323332">:</span>&nbsp;&nbsp;<span class="string" id="7323335">&#34;GET&#34;</span><span class="op" id="7323340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7323344">&#34;SCRIPT_NAME&#34;</span><span class="op" id="7323357">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7323363">&#34;/dir/scriptname&#34;</span><span class="op" id="7323380">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7323384">&#34;PATH_INFO&#34;</span><span class="op" id="7323395">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7323403">&#34;/p1/p2&#34;</span><span class="op" id="7323411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7323415">&#34;QUERY_STRING&#34;</span><span class="op" id="7323429">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7323434">&#34;a=1&amp;b=2&#34;</span><span class="op" id="7323443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7323447">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="7323463">:</span>&nbsp;&nbsp;<span class="string" id="7323466">&#34;123&#34;</span><span class="op" id="7323471">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7323474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7323477">req</span><span class="op" id="7323480">,</span>&nbsp;<span class="ident" id="7323482">err</span>&nbsp;<span class="op" id="7323486">:=</span>&nbsp;<span class="ident" id="7323489">RequestFromMap</span><span class="op" id="7323503">(</span><span class="ident" id="7323504">env</span><span class="op" id="7323507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7323510">if</span>&nbsp;<span class="ident" id="7323513">err</span>&nbsp;<span class="op" id="7323517">!=</span>&nbsp;<span class="builtintype" id="7323520">nil</span>&nbsp;<span class="op" id="7323524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7323528">t</span><span class="op" id="7323529">.</span><span class="ident" id="7323530">Fatalf</span><span class="op" id="7323536">(</span><span class="string" id="7323537">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="7323557">,</span>&nbsp;<span class="ident" id="7323559">err</span><span class="op" id="7323562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7323565">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7323568">if</span>&nbsp;<span class="ident" id="7323571">req</span><span class="op" id="7323574">.</span><span class="ident" id="7323575">URL</span>&nbsp;<span class="op" id="7323579">==</span>&nbsp;<span class="builtintype" id="7323582">nil</span>&nbsp;<span class="op" id="7323586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7323590">t</span><span class="op" id="7323591">.</span><span class="ident" id="7323592">Fatalf</span><span class="op" id="7323598">(</span><span class="string" id="7323599">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="7323619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7323622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7323625">if</span>&nbsp;<span class="ident" id="7323628">g</span><span class="op" id="7323629">,</span>&nbsp;<span class="ident" id="7323631">e</span>&nbsp;<span class="op" id="7323633">:=</span>&nbsp;<span class="ident" id="7323636">req</span><span class="op" id="7323639">.</span><span class="ident" id="7323640">URL</span><span class="op" id="7323643">.</span><span class="ident" id="7323644">String</span><span class="op" id="7323650">(</span><span class="op" id="7323651">)</span><span class="op" id="7323652">,</span>&nbsp;<span class="string" id="7323654">&#34;http://example.com/dir/scriptname/p1/p2?a=1&amp;b=2&#34;</span><span class="op" id="7323703">;</span>&nbsp;<span class="ident" id="7323705">e</span>&nbsp;<span class="op" id="7323707">!=</span>&nbsp;<span class="ident" id="7323710">g</span>&nbsp;<span class="op" id="7323712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7323716">t</span><span class="op" id="7323717">.</span><span class="ident" id="7323718">Errorf</span><span class="op" id="7323724">(</span><span class="string" id="7323725">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7323744">,</span>&nbsp;<span class="ident" id="7323746">g</span><span class="op" id="7323747">,</span>&nbsp;<span class="ident" id="7323749">e</span><span class="op" id="7323750">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7323753">}</span><br>
<span class="lineno"></span><span class="op" id="7323755">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
