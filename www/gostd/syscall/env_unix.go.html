<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2359720">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2359776">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2359830">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2359881">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2359951">//&nbsp;Unix&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2359983">package</span>&nbsp;<span class="ident" id="2359991">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2360000">import</span>&nbsp;<span class="string" id="2360007">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2360015">var</span>&nbsp;<span class="op" id="2360019">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2360022">//&nbsp;envOnce&nbsp;guards&nbsp;initialization&nbsp;by&nbsp;copyenv,&nbsp;which&nbsp;populates&nbsp;env.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360089">envOnce</span>&nbsp;<span class="ident" id="2360097">sync</span><span class="op" id="2360101">.</span><span class="ident" id="2360102">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2360109">//&nbsp;envLock&nbsp;guards&nbsp;env&nbsp;and&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360142">envLock</span>&nbsp;<span class="ident" id="2360150">sync</span><span class="op" id="2360154">.</span><span class="ident" id="2360155">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2360165">//&nbsp;env&nbsp;maps&nbsp;from&nbsp;an&nbsp;environment&nbsp;variable&nbsp;to&nbsp;its&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360240">env</span>&nbsp;<span class="keyword" id="2360244">map</span><span class="op" id="2360247">[</span><span class="builtintype" id="2360248">string</span><span class="op" id="2360254">]</span><span class="builtintype" id="2360255">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2360261">//&nbsp;envs&nbsp;is&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime.&nbsp;elements&nbsp;are&nbsp;expected&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2360323">//&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;key=value&#34;.&nbsp;An&nbsp;empty&nbsp;string&nbsp;means&nbsp;deleted</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2360385">//&nbsp;(or&nbsp;a&nbsp;duplicate&nbsp;to&nbsp;be&nbsp;ignored).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360421">envs</span>&nbsp;<span class="op" id="2360426">[</span><span class="op" id="2360427">]</span><span class="builtintype" id="2360428">string</span>&nbsp;<span class="op" id="2360435">=</span>&nbsp;<span class="ident" id="2360437">runtime_envs</span><span class="op" id="2360449">(</span><span class="op" id="2360450">)</span><br>
<span class="lineno"></span><span class="op" id="2360452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2360455">func</span>&nbsp;<span class="ident" id="2360460">runtime_envs</span><span class="op" id="2360472">(</span><span class="op" id="2360473">)</span>&nbsp;<span class="op" id="2360475">[</span><span class="op" id="2360476">]</span><span class="builtintype" id="2360477">string</span>&nbsp;<span class="comment" id="2360484">//&nbsp;in&nbsp;package&nbsp;runtime</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2360507">//&nbsp;setenv_c&nbsp;and&nbsp;unsetenv_c&nbsp;are&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime&nbsp;but&nbsp;are&nbsp;no-ops</span><br>
<span class="lineno"></span><span class="comment" id="2360577">//&nbsp;if&nbsp;cgo&nbsp;isn&#39;t&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="keyword" id="2360601">func</span>&nbsp;<span class="ident" id="2360606">setenv_c</span><span class="op" id="2360614">(</span><span class="ident" id="2360615">k</span><span class="op" id="2360616">,</span>&nbsp;<span class="ident" id="2360618">v</span>&nbsp;<span class="builtintype" id="2360620">string</span><span class="op" id="2360626">)</span><br>
<span class="lineno"></span><span class="keyword" id="2360628">func</span>&nbsp;<span class="ident" id="2360633">unsetenv_c</span><span class="op" id="2360643">(</span><span class="ident" id="2360644">k</span>&nbsp;<span class="builtintype" id="2360646">string</span><span class="op" id="2360652">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2360655">func</span>&nbsp;<span class="ident" id="2360660">copyenv</span><span class="op" id="2360667">(</span><span class="op" id="2360668">)</span>&nbsp;<span class="op" id="2360670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360673">env</span>&nbsp;<span class="op" id="2360677">=</span>&nbsp;<span class="builtinfunc" id="2360679">make</span><span class="op" id="2360683">(</span><span class="keyword" id="2360684">map</span><span class="op" id="2360687">[</span><span class="builtintype" id="2360688">string</span><span class="op" id="2360694">]</span><span class="builtintype" id="2360695">int</span><span class="op" id="2360698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2360701">for</span>&nbsp;<span class="ident" id="2360705">i</span><span class="op" id="2360706">,</span>&nbsp;<span class="ident" id="2360708">s</span>&nbsp;<span class="op" id="2360710">:=</span>&nbsp;<span class="keyword" id="2360713">range</span>&nbsp;<span class="ident" id="2360719">envs</span>&nbsp;<span class="op" id="2360724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2360728">for</span>&nbsp;<span class="ident" id="2360732">j</span>&nbsp;<span class="op" id="2360734">:=</span>&nbsp;<span class="num" id="2360737">0</span><span class="op" id="2360738">;</span>&nbsp;<span class="ident" id="2360740">j</span>&nbsp;<span class="op" id="2360742">&lt;</span>&nbsp;<span class="builtinfunc" id="2360744">len</span><span class="op" id="2360747">(</span><span class="ident" id="2360748">s</span><span class="op" id="2360749">)</span><span class="op" id="2360750">;</span>&nbsp;<span class="ident" id="2360752">j</span><span class="op" id="2360753">++</span>&nbsp;<span class="op" id="2360756">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2360761">if</span>&nbsp;<span class="ident" id="2360764">s</span><span class="op" id="2360765">[</span><span class="ident" id="2360766">j</span><span class="op" id="2360767">]</span>&nbsp;<span class="op" id="2360769">==</span>&nbsp;<span class="string" id="2360772">&#39;=&#39;</span>&nbsp;<span class="op" id="2360776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360782">key</span>&nbsp;<span class="op" id="2360786">:=</span>&nbsp;<span class="ident" id="2360789">s</span><span class="op" id="2360790">[</span><span class="op" id="2360791">:</span><span class="ident" id="2360792">j</span><span class="op" id="2360793">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2360799">if</span>&nbsp;<span class="ident" id="2360802">_</span><span class="op" id="2360803">,</span>&nbsp;<span class="ident" id="2360805">ok</span>&nbsp;<span class="op" id="2360808">:=</span>&nbsp;<span class="ident" id="2360811">env</span><span class="op" id="2360814">[</span><span class="ident" id="2360815">key</span><span class="op" id="2360818">]</span><span class="op" id="2360819">;</span>&nbsp;<span class="op" id="2360821">!</span><span class="ident" id="2360822">ok</span>&nbsp;<span class="op" id="2360825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360832">env</span><span class="op" id="2360835">[</span><span class="ident" id="2360836">key</span><span class="op" id="2360839">]</span>&nbsp;<span class="op" id="2360841">=</span>&nbsp;<span class="ident" id="2360843">i</span>&nbsp;<span class="comment" id="2360845">//&nbsp;first&nbsp;mention&nbsp;of&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2360873">}</span>&nbsp;<span class="keyword" id="2360875">else</span>&nbsp;<span class="op" id="2360880">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2360887">//&nbsp;Clear&nbsp;duplicate&nbsp;keys.&nbsp;This&nbsp;permits&nbsp;Unsetenv&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2360942">//&nbsp;safely&nbsp;delete&nbsp;only&nbsp;the&nbsp;first&nbsp;item&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2360992">//&nbsp;worrying&nbsp;about&nbsp;unshadowing&nbsp;a&nbsp;later&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2361040">//&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;security&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361083">envs</span><span class="op" id="2361087">[</span><span class="ident" id="2361088">i</span><span class="op" id="2361089">]</span>&nbsp;<span class="op" id="2361091">=</span>&nbsp;<span class="string" id="2361093">&#34;&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361106">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361122">}</span><br>
<span class="lineno">55</span><span class="op" id="2361124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2361127">func</span>&nbsp;<span class="ident" id="2361132">Unsetenv</span><span class="op" id="2361140">(</span><span class="ident" id="2361141">key</span>&nbsp;<span class="builtintype" id="2361145">string</span><span class="op" id="2361151">)</span>&nbsp;<span class="builtintype" id="2361153">error</span>&nbsp;<span class="op" id="2361159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361162">envOnce</span><span class="op" id="2361169">.</span><span class="ident" id="2361170">Do</span><span class="op" id="2361172">(</span><span class="ident" id="2361173">copyenv</span><span class="op" id="2361180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361184">envLock</span><span class="op" id="2361191">.</span><span class="ident" id="2361192">Lock</span><span class="op" id="2361196">(</span><span class="op" id="2361197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361200">defer</span>&nbsp;<span class="ident" id="2361206">envLock</span><span class="op" id="2361213">.</span><span class="ident" id="2361214">Unlock</span><span class="op" id="2361220">(</span><span class="op" id="2361221">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361225">if</span>&nbsp;<span class="ident" id="2361228">i</span><span class="op" id="2361229">,</span>&nbsp;<span class="ident" id="2361231">ok</span>&nbsp;<span class="op" id="2361234">:=</span>&nbsp;<span class="ident" id="2361237">env</span><span class="op" id="2361240">[</span><span class="ident" id="2361241">key</span><span class="op" id="2361244">]</span><span class="op" id="2361245">;</span>&nbsp;<span class="ident" id="2361247">ok</span>&nbsp;<span class="op" id="2361250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361254">envs</span><span class="op" id="2361258">[</span><span class="ident" id="2361259">i</span><span class="op" id="2361260">]</span>&nbsp;<span class="op" id="2361262">=</span>&nbsp;<span class="string" id="2361264">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2361269">delete</span><span class="op" id="2361275">(</span><span class="ident" id="2361276">env</span><span class="op" id="2361279">,</span>&nbsp;<span class="ident" id="2361281">key</span><span class="op" id="2361284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361290">unsetenv_c</span><span class="op" id="2361300">(</span><span class="ident" id="2361301">key</span><span class="op" id="2361304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361307">return</span>&nbsp;<span class="ident" id="2361314">nil</span><br>
<span class="lineno"></span><span class="op" id="2361318">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2361321">func</span>&nbsp;<span class="ident" id="2361326">Getenv</span><span class="op" id="2361332">(</span><span class="ident" id="2361333">key</span>&nbsp;<span class="builtintype" id="2361337">string</span><span class="op" id="2361343">)</span>&nbsp;<span class="op" id="2361345">(</span><span class="ident" id="2361346">value</span>&nbsp;<span class="builtintype" id="2361352">string</span><span class="op" id="2361358">,</span>&nbsp;<span class="ident" id="2361360">found</span>&nbsp;<span class="builtintype" id="2361366">bool</span><span class="op" id="2361370">)</span>&nbsp;<span class="op" id="2361372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361375">envOnce</span><span class="op" id="2361382">.</span><span class="ident" id="2361383">Do</span><span class="op" id="2361385">(</span><span class="ident" id="2361386">copyenv</span><span class="op" id="2361393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361396">if</span>&nbsp;<span class="builtinfunc" id="2361399">len</span><span class="op" id="2361402">(</span><span class="ident" id="2361403">key</span><span class="op" id="2361406">)</span>&nbsp;<span class="op" id="2361408">==</span>&nbsp;<span class="num" id="2361411">0</span>&nbsp;<span class="op" id="2361413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361417">return</span>&nbsp;<span class="string" id="2361424">&#34;&#34;</span><span class="op" id="2361426">,</span>&nbsp;<span class="builtintype" id="2361428">false</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361439">envLock</span><span class="op" id="2361446">.</span><span class="ident" id="2361447">RLock</span><span class="op" id="2361452">(</span><span class="op" id="2361453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361456">defer</span>&nbsp;<span class="ident" id="2361462">envLock</span><span class="op" id="2361469">.</span><span class="ident" id="2361470">RUnlock</span><span class="op" id="2361477">(</span><span class="op" id="2361478">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361482">i</span><span class="op" id="2361483">,</span>&nbsp;<span class="ident" id="2361485">ok</span>&nbsp;<span class="op" id="2361488">:=</span>&nbsp;<span class="ident" id="2361491">env</span><span class="op" id="2361494">[</span><span class="ident" id="2361495">key</span><span class="op" id="2361498">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361501">if</span>&nbsp;<span class="op" id="2361504">!</span><span class="ident" id="2361505">ok</span>&nbsp;<span class="op" id="2361508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361512">return</span>&nbsp;<span class="string" id="2361519">&#34;&#34;</span><span class="op" id="2361521">,</span>&nbsp;<span class="builtintype" id="2361523">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361533">s</span>&nbsp;<span class="op" id="2361535">:=</span>&nbsp;<span class="ident" id="2361538">envs</span><span class="op" id="2361542">[</span><span class="ident" id="2361543">i</span><span class="op" id="2361544">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361547">for</span>&nbsp;<span class="ident" id="2361551">i</span>&nbsp;<span class="op" id="2361553">:=</span>&nbsp;<span class="num" id="2361556">0</span><span class="op" id="2361557">;</span>&nbsp;<span class="ident" id="2361559">i</span>&nbsp;<span class="op" id="2361561">&lt;</span>&nbsp;<span class="builtinfunc" id="2361563">len</span><span class="op" id="2361566">(</span><span class="ident" id="2361567">s</span><span class="op" id="2361568">)</span><span class="op" id="2361569">;</span>&nbsp;<span class="ident" id="2361571">i</span><span class="op" id="2361572">++</span>&nbsp;<span class="op" id="2361575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361579">if</span>&nbsp;<span class="ident" id="2361582">s</span><span class="op" id="2361583">[</span><span class="ident" id="2361584">i</span><span class="op" id="2361585">]</span>&nbsp;<span class="op" id="2361587">==</span>&nbsp;<span class="string" id="2361590">&#39;=&#39;</span>&nbsp;<span class="op" id="2361594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361599">return</span>&nbsp;<span class="ident" id="2361606">s</span><span class="op" id="2361607">[</span><span class="ident" id="2361608">i</span><span class="op" id="2361609">+</span><span class="num" id="2361610">1</span><span class="op" id="2361611">:</span><span class="op" id="2361612">]</span><span class="op" id="2361613">,</span>&nbsp;<span class="builtintype" id="2361615">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361625">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361628">return</span>&nbsp;<span class="string" id="2361635">&#34;&#34;</span><span class="op" id="2361637">,</span>&nbsp;<span class="builtintype" id="2361639">false</span><br>
<span class="lineno"></span><span class="op" id="2361645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2361648">func</span>&nbsp;<span class="ident" id="2361653">Setenv</span><span class="op" id="2361659">(</span><span class="ident" id="2361660">key</span><span class="op" id="2361663">,</span>&nbsp;<span class="ident" id="2361665">value</span>&nbsp;<span class="builtintype" id="2361671">string</span><span class="op" id="2361677">)</span>&nbsp;<span class="builtintype" id="2361679">error</span>&nbsp;<span class="op" id="2361685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361688">envOnce</span><span class="op" id="2361695">.</span><span class="ident" id="2361696">Do</span><span class="op" id="2361698">(</span><span class="ident" id="2361699">copyenv</span><span class="op" id="2361706">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361709">if</span>&nbsp;<span class="builtinfunc" id="2361712">len</span><span class="op" id="2361715">(</span><span class="ident" id="2361716">key</span><span class="op" id="2361719">)</span>&nbsp;<span class="op" id="2361721">==</span>&nbsp;<span class="num" id="2361724">0</span>&nbsp;<span class="op" id="2361726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361730">return</span>&nbsp;<span class="ident" id="2361737">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361748">for</span>&nbsp;<span class="ident" id="2361752">i</span>&nbsp;<span class="op" id="2361754">:=</span>&nbsp;<span class="num" id="2361757">0</span><span class="op" id="2361758">;</span>&nbsp;<span class="ident" id="2361760">i</span>&nbsp;<span class="op" id="2361762">&lt;</span>&nbsp;<span class="builtinfunc" id="2361764">len</span><span class="op" id="2361767">(</span><span class="ident" id="2361768">key</span><span class="op" id="2361771">)</span><span class="op" id="2361772">;</span>&nbsp;<span class="ident" id="2361774">i</span><span class="op" id="2361775">++</span>&nbsp;<span class="op" id="2361778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361782">if</span>&nbsp;<span class="ident" id="2361785">key</span><span class="op" id="2361788">[</span><span class="ident" id="2361789">i</span><span class="op" id="2361790">]</span>&nbsp;<span class="op" id="2361792">==</span>&nbsp;<span class="string" id="2361795">&#39;=&#39;</span>&nbsp;<span class="op" id="2361799">||</span>&nbsp;<span class="ident" id="2361802">key</span><span class="op" id="2361805">[</span><span class="ident" id="2361806">i</span><span class="op" id="2361807">]</span>&nbsp;<span class="op" id="2361809">==</span>&nbsp;<span class="num" id="2361812">0</span>&nbsp;<span class="op" id="2361814">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361819">return</span>&nbsp;<span class="ident" id="2361826">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361841">for</span>&nbsp;<span class="ident" id="2361845">i</span>&nbsp;<span class="op" id="2361847">:=</span>&nbsp;<span class="num" id="2361850">0</span><span class="op" id="2361851">;</span>&nbsp;<span class="ident" id="2361853">i</span>&nbsp;<span class="op" id="2361855">&lt;</span>&nbsp;<span class="builtinfunc" id="2361857">len</span><span class="op" id="2361860">(</span><span class="ident" id="2361861">value</span><span class="op" id="2361866">)</span><span class="op" id="2361867">;</span>&nbsp;<span class="ident" id="2361869">i</span><span class="op" id="2361870">++</span>&nbsp;<span class="op" id="2361873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361877">if</span>&nbsp;<span class="ident" id="2361880">value</span><span class="op" id="2361885">[</span><span class="ident" id="2361886">i</span><span class="op" id="2361887">]</span>&nbsp;<span class="op" id="2361889">==</span>&nbsp;<span class="num" id="2361892">0</span>&nbsp;<span class="op" id="2361894">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361899">return</span>&nbsp;<span class="ident" id="2361906">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361922">envLock</span><span class="op" id="2361929">.</span><span class="ident" id="2361930">Lock</span><span class="op" id="2361934">(</span><span class="op" id="2361935">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361938">defer</span>&nbsp;<span class="ident" id="2361944">envLock</span><span class="op" id="2361951">.</span><span class="ident" id="2361952">Unlock</span><span class="op" id="2361958">(</span><span class="op" id="2361959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361963">i</span><span class="op" id="2361964">,</span>&nbsp;<span class="ident" id="2361966">ok</span>&nbsp;<span class="op" id="2361969">:=</span>&nbsp;<span class="ident" id="2361972">env</span><span class="op" id="2361975">[</span><span class="ident" id="2361976">key</span><span class="op" id="2361979">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361982">kv</span>&nbsp;<span class="op" id="2361985">:=</span>&nbsp;<span class="ident" id="2361988">key</span>&nbsp;<span class="op" id="2361992">+</span>&nbsp;<span class="string" id="2361994">&#34;=&#34;</span>&nbsp;<span class="op" id="2361998">+</span>&nbsp;<span class="ident" id="2362000">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2362007">if</span>&nbsp;<span class="ident" id="2362010">ok</span>&nbsp;<span class="op" id="2362013">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362017">envs</span><span class="op" id="2362021">[</span><span class="ident" id="2362022">i</span><span class="op" id="2362023">]</span>&nbsp;<span class="op" id="2362025">=</span>&nbsp;<span class="ident" id="2362027">kv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2362031">}</span>&nbsp;<span class="keyword" id="2362033">else</span>&nbsp;<span class="op" id="2362038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362042">i</span>&nbsp;<span class="op" id="2362044">=</span>&nbsp;<span class="builtinfunc" id="2362046">len</span><span class="op" id="2362049">(</span><span class="ident" id="2362050">envs</span><span class="op" id="2362054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362058">envs</span>&nbsp;<span class="op" id="2362063">=</span>&nbsp;<span class="builtinfunc" id="2362065">append</span><span class="op" id="2362071">(</span><span class="ident" id="2362072">envs</span><span class="op" id="2362076">,</span>&nbsp;<span class="ident" id="2362078">kv</span><span class="op" id="2362080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2362083">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362086">env</span><span class="op" id="2362089">[</span><span class="ident" id="2362090">key</span><span class="op" id="2362093">]</span>&nbsp;<span class="op" id="2362095">=</span>&nbsp;<span class="ident" id="2362097">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362100">setenv_c</span><span class="op" id="2362108">(</span><span class="ident" id="2362109">key</span><span class="op" id="2362112">,</span>&nbsp;<span class="ident" id="2362114">value</span><span class="op" id="2362119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2362122">return</span>&nbsp;<span class="ident" id="2362129">nil</span><br>
<span class="lineno"></span><span class="op" id="2362133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2362136">func</span>&nbsp;<span class="ident" id="2362141">Clearenv</span><span class="op" id="2362149">(</span><span class="op" id="2362150">)</span>&nbsp;<span class="op" id="2362152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362155">envOnce</span><span class="op" id="2362162">.</span><span class="ident" id="2362163">Do</span><span class="op" id="2362165">(</span><span class="ident" id="2362166">copyenv</span><span class="op" id="2362173">)</span>&nbsp;<span class="comment" id="2362175">//&nbsp;prevent&nbsp;copyenv&nbsp;in&nbsp;Getenv/Setenv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362213">envLock</span><span class="op" id="2362220">.</span><span class="ident" id="2362221">Lock</span><span class="op" id="2362225">(</span><span class="op" id="2362226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2362229">defer</span>&nbsp;<span class="ident" id="2362235">envLock</span><span class="op" id="2362242">.</span><span class="ident" id="2362243">Unlock</span><span class="op" id="2362249">(</span><span class="op" id="2362250">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2362254">for</span>&nbsp;<span class="ident" id="2362258">k</span>&nbsp;<span class="op" id="2362260">:=</span>&nbsp;<span class="keyword" id="2362263">range</span>&nbsp;<span class="ident" id="2362269">env</span>&nbsp;<span class="op" id="2362273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362277">unsetenv_c</span><span class="op" id="2362287">(</span><span class="ident" id="2362288">k</span><span class="op" id="2362289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2362292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362295">env</span>&nbsp;<span class="op" id="2362299">=</span>&nbsp;<span class="builtinfunc" id="2362301">make</span><span class="op" id="2362305">(</span><span class="keyword" id="2362306">map</span><span class="op" id="2362309">[</span><span class="builtintype" id="2362310">string</span><span class="op" id="2362316">]</span><span class="builtintype" id="2362317">int</span><span class="op" id="2362320">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362323">envs</span>&nbsp;<span class="op" id="2362328">=</span>&nbsp;<span class="op" id="2362330">[</span><span class="op" id="2362331">]</span><span class="builtintype" id="2362332">string</span><span class="op" id="2362338">{</span><span class="op" id="2362339">}</span><br>
<span class="lineno"></span><span class="op" id="2362341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2362344">func</span>&nbsp;<span class="ident" id="2362349">Environ</span><span class="op" id="2362356">(</span><span class="op" id="2362357">)</span>&nbsp;<span class="op" id="2362359">[</span><span class="op" id="2362360">]</span><span class="builtintype" id="2362361">string</span>&nbsp;<span class="op" id="2362368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362371">envOnce</span><span class="op" id="2362378">.</span><span class="ident" id="2362379">Do</span><span class="op" id="2362381">(</span><span class="ident" id="2362382">copyenv</span><span class="op" id="2362389">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362392">envLock</span><span class="op" id="2362399">.</span><span class="ident" id="2362400">RLock</span><span class="op" id="2362405">(</span><span class="op" id="2362406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2362409">defer</span>&nbsp;<span class="ident" id="2362415">envLock</span><span class="op" id="2362422">.</span><span class="ident" id="2362423">RUnlock</span><span class="op" id="2362430">(</span><span class="op" id="2362431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362434">a</span>&nbsp;<span class="op" id="2362436">:=</span>&nbsp;<span class="builtinfunc" id="2362439">make</span><span class="op" id="2362443">(</span><span class="op" id="2362444">[</span><span class="op" id="2362445">]</span><span class="builtintype" id="2362446">string</span><span class="op" id="2362452">,</span>&nbsp;<span class="num" id="2362454">0</span><span class="op" id="2362455">,</span>&nbsp;<span class="builtinfunc" id="2362457">len</span><span class="op" id="2362460">(</span><span class="ident" id="2362461">envs</span><span class="op" id="2362465">)</span><span class="op" id="2362466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2362469">for</span>&nbsp;<span class="ident" id="2362473">_</span><span class="op" id="2362474">,</span>&nbsp;<span class="ident" id="2362476">env</span>&nbsp;<span class="op" id="2362480">:=</span>&nbsp;<span class="keyword" id="2362483">range</span>&nbsp;<span class="ident" id="2362489">envs</span>&nbsp;<span class="op" id="2362494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2362498">if</span>&nbsp;<span class="ident" id="2362501">env</span>&nbsp;<span class="op" id="2362505">!=</span>&nbsp;<span class="string" id="2362508">&#34;&#34;</span>&nbsp;<span class="op" id="2362511">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2362516">a</span>&nbsp;<span class="op" id="2362518">=</span>&nbsp;<span class="builtinfunc" id="2362520">append</span><span class="op" id="2362526">(</span><span class="ident" id="2362527">a</span><span class="op" id="2362528">,</span>&nbsp;<span class="ident" id="2362530">env</span><span class="op" id="2362533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2362537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2362540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2362543">return</span>&nbsp;<span class="ident" id="2362550">a</span><br>
<span class="lineno"></span><span class="op" id="2362552">}</span>
</div>
</body>
</html>
