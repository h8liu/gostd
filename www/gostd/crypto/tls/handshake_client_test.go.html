<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html" class="current">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8112178">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8112233">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8112287">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8112338">package</span>&nbsp;<span class="ident" id="8112346">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8112351">import</span>&nbsp;<span class="op" id="8112358">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8112361">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8112370">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8112386">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8112400">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8112415">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8112431">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8112438">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8112444">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8112451">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8112457">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8112468">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8112485">&#34;strconv&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8112496">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8112507">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8112514">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8112517">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno">25</span><span class="comment" id="8112592">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8112608">//&nbsp;blockingSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;blocks&nbsp;a&nbsp;Read&nbsp;call&nbsp;until&nbsp;it&#39;s&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="8112685">type</span>&nbsp;<span class="ident" id="8112690">blockingSource</span>&nbsp;<span class="keyword" id="8112705">chan</span>&nbsp;<span class="builtintype" id="8112710">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8112716">func</span>&nbsp;<span class="op" id="8112721">(</span><span class="ident" id="8112722">b</span>&nbsp;<span class="ident" id="8112724"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112690">blockingSource</a></span><span class="op" id="8112738">)</span>&nbsp;<span class="ident" id="8112740">Read</span><span class="op" id="8112744">(</span><span class="op" id="8112745">[</span><span class="op" id="8112746">]</span><span class="builtintype" id="8112747">byte</span><span class="op" id="8112751">)</span>&nbsp;<span class="op" id="8112753">(</span><span class="ident" id="8112754">n</span>&nbsp;<span class="builtintype" id="8112756">int</span><span class="op" id="8112759">,</span>&nbsp;<span class="ident" id="8112761">err</span>&nbsp;<span class="builtintype" id="8112765">error</span><span class="op" id="8112770">)</span>&nbsp;<span class="op" id="8112772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8112775">&lt;-</span><span class="ident" id="8112777"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112722">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8112780">return</span>&nbsp;<span class="num" id="8112787">0</span><span class="op" id="8112788">,</span>&nbsp;<span class="ident" id="8112790"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112438">io</a></span><span class="op" id="8112792">.</span><span class="ident" id="8112793"><a href="/gostd/io/io.go.html#1419950">EOF</a></span><br>
<span class="lineno"></span><span class="op" id="8112797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="8112800">//&nbsp;clientTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;client&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="8112880">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="8112899">type</span>&nbsp;<span class="ident" id="8112904">clientTest</span>&nbsp;<span class="keyword" id="8112915">struct</span>&nbsp;<span class="op" id="8112922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8112925">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8112998">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113039">name</span>&nbsp;<span class="builtintype" id="8113044">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8113052">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8113118">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113163">command</span>&nbsp;<span class="op" id="8113171">[</span><span class="op" id="8113172">]</span><span class="builtintype" id="8113173">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8113181">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113252">config</span>&nbsp;<span class="op" id="8113259">*</span><span class="ident" id="8113260"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8113268">//&nbsp;cert,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;DER-encoded&nbsp;certificate&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8113335">//&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113357">cert</span>&nbsp;<span class="op" id="8113362">[</span><span class="op" id="8113363">]</span><span class="builtintype" id="8113364">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8113370">//&nbsp;key,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;either&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8113428">//&nbsp;*ecdsa.PrivateKey&nbsp;which&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113501">key</span>&nbsp;<span class="keyword" id="8113505">interface</span><span class="op" id="8113514">{</span><span class="op" id="8113515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8113518">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8113587">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;a&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8113657">//&nbsp;error&nbsp;if&nbsp;the&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113707">validate</span>&nbsp;<span class="keyword" id="8113716">func</span><span class="op" id="8113720">(</span><span class="ident" id="8113721"><a href="/gostd/crypto/tls/common.go.html#4446494">ConnectionState</a></span><span class="op" id="8113736">)</span>&nbsp;<span class="builtintype" id="8113738">error</span><br>
<span class="lineno"></span><span class="op" id="8113744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8113747">var</span>&nbsp;<span class="ident" id="8113751">defaultServerCommand</span>&nbsp;<span class="op" id="8113772">=</span>&nbsp;<span class="op" id="8113774">[</span><span class="op" id="8113775">]</span><span class="builtintype" id="8113776">string</span><span class="op" id="8113782">{</span><span class="string" id="8113783">&#34;openssl&#34;</span><span class="op" id="8113792">,</span>&nbsp;<span class="string" id="8113794">&#34;s_server&#34;</span><span class="op" id="8113804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="8113807">//&nbsp;connFromCommand&nbsp;starts&nbsp;the&nbsp;reference&nbsp;server&nbsp;process,&nbsp;connects&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="8113882">//&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;for&nbsp;the&nbsp;connection.&nbsp;The&nbsp;stdin&nbsp;return&nbsp;value&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="8113957">//&nbsp;blockingSource&nbsp;for&nbsp;the&nbsp;stdin&nbsp;of&nbsp;the&nbsp;child&nbsp;process.&nbsp;It&nbsp;must&nbsp;be&nbsp;closed&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="8114036">//&nbsp;Waiting&nbsp;for&nbsp;child.</span><br>
<span class="lineno"></span><span class="keyword" id="8114058">func</span>&nbsp;<span class="op" id="8114063">(</span><span class="ident" id="8114064">test</span>&nbsp;<span class="op" id="8114069">*</span><span class="ident" id="8114070"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8114080">)</span>&nbsp;<span class="ident" id="8114082">connFromCommand</span><span class="op" id="8114097">(</span><span class="op" id="8114098">)</span>&nbsp;<span class="op" id="8114100">(</span><span class="ident" id="8114101">conn</span>&nbsp;<span class="op" id="8114106">*</span><span class="ident" id="8114107"><a href="/gostd/crypto/tls/handshake_test.go.html#8164802">recordingConn</a></span><span class="op" id="8114120">,</span>&nbsp;<span class="ident" id="8114122">child</span>&nbsp;<span class="op" id="8114128">*</span><span class="ident" id="8114129"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112457">exec</a></span><span class="op" id="8114133">.</span><span class="ident" id="8114134"><a href="/gostd/os/exec/exec.go.html#5578012">Cmd</a></span><span class="op" id="8114137">,</span>&nbsp;<span class="ident" id="8114139">stdin</span>&nbsp;<span class="ident" id="8114145"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112690">blockingSource</a></span><span class="op" id="8114159">,</span>&nbsp;<span class="ident" id="8114161">err</span>&nbsp;<span class="builtintype" id="8114165">error</span><span class="op" id="8114170">)</span>&nbsp;<span class="op" id="8114172">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114175">cert</span>&nbsp;<span class="op" id="8114180">:=</span>&nbsp;<span class="ident" id="8114183"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8158000">testRSACertificate</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114203">if</span>&nbsp;<span class="builtinfunc" id="8114206">len</span><span class="op" id="8114209">(</span><span class="ident" id="8114210"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114064">test</a></span><span class="op" id="8114214">.</span><span class="ident" id="8114215"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113357">cert</a></span><span class="op" id="8114219">)</span>&nbsp;<span class="op" id="8114221">&gt;</span>&nbsp;<span class="num" id="8114223">0</span>&nbsp;<span class="op" id="8114225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114229"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114175">cert</a></span>&nbsp;<span class="op" id="8114234">=</span>&nbsp;<span class="ident" id="8114236"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114064">test</a></span><span class="op" id="8114240">.</span><span class="ident" id="8114241"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113357">cert</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8114247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114250">certPath</span>&nbsp;<span class="op" id="8114259">:=</span>&nbsp;<span class="ident" id="8114262"><a href="/gostd/crypto/tls/handshake_test.go.html#8167413">tempFile</a></span><span class="op" id="8114270">(</span><span class="builtintype" id="8114271">string</span><span class="op" id="8114277">(</span><span class="ident" id="8114278"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114175">cert</a></span><span class="op" id="8114282">)</span><span class="op" id="8114283">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114286">defer</span>&nbsp;<span class="ident" id="8114292"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112451">os</a></span><span class="op" id="8114294">.</span><span class="ident" id="8114295"><a href="/gostd/os/file_unix.go.html#2459394">Remove</a></span><span class="op" id="8114301">(</span><span class="ident" id="8114302"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114250">certPath</a></span><span class="op" id="8114310">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114314">var</span>&nbsp;<span class="ident" id="8114318">key</span>&nbsp;<span class="keyword" id="8114322">interface</span><span class="op" id="8114331">{</span><span class="op" id="8114332">}</span>&nbsp;<span class="op" id="8114334">=</span>&nbsp;<span class="ident" id="8114336"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8161536">testRSAPrivateKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114355">if</span>&nbsp;<span class="ident" id="8114358"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114064">test</a></span><span class="op" id="8114362">.</span><span class="ident" id="8114363"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113501">key</a></span>&nbsp;<span class="op" id="8114367">!=</span>&nbsp;<span class="builtintype" id="8114370">nil</span>&nbsp;<span class="op" id="8114374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114378"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114318">key</a></span>&nbsp;<span class="op" id="8114382">=</span>&nbsp;<span class="ident" id="8114384"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114064">test</a></span><span class="op" id="8114388">.</span><span class="ident" id="8114389"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113501">key</a></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8114394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114397">var</span>&nbsp;<span class="ident" id="8114401">pemType</span>&nbsp;<span class="builtintype" id="8114409">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114417">var</span>&nbsp;<span class="ident" id="8114421">derBytes</span>&nbsp;<span class="op" id="8114430">[</span><span class="op" id="8114431">]</span><span class="builtintype" id="8114432">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114438">switch</span>&nbsp;<span class="ident" id="8114445">key</span>&nbsp;<span class="op" id="8114449">:=</span>&nbsp;<span class="ident" id="8114452"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114318">key</a></span><span class="op" id="8114455">.</span><span class="op" id="8114456">(</span><span class="keyword" id="8114457">type</span><span class="op" id="8114461">)</span>&nbsp;<span class="op" id="8114463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114466">case</span>&nbsp;<span class="op" id="8114471">*</span><span class="ident" id="8114472"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112386">rsa</a></span><span class="op" id="8114475">.</span><span class="ident" id="8114476"><a href="/gostd/crypto/rsa/rsa.go.html#4743774">PrivateKey</a></span><span class="op" id="8114486">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114490"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114401">pemType</a></span>&nbsp;<span class="op" id="8114498">=</span>&nbsp;<span class="string" id="8114500">&#34;RSA&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114508"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114421">derBytes</a></span>&nbsp;<span class="op" id="8114517">=</span>&nbsp;<span class="ident" id="8114519"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112400">x509</a></span><span class="op" id="8114523">.</span><span class="ident" id="8114524"><a href="/gostd/crypto/x509/pkcs1.go.html#4624407">MarshalPKCS1PrivateKey</a></span><span class="op" id="8114546">(</span><span class="ident" id="8114547"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114445">key</a></span><span class="op" id="8114550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114553">case</span>&nbsp;<span class="op" id="8114558">*</span><span class="ident" id="8114559"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112370">ecdsa</a></span><span class="op" id="8114564">.</span><span class="ident" id="8114565"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005513">PrivateKey</a></span><span class="op" id="8114575">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114579"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114401">pemType</a></span>&nbsp;<span class="op" id="8114587">=</span>&nbsp;<span class="string" id="8114589">&#34;EC&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114596">var</span>&nbsp;<span class="ident" id="8114600">err</span>&nbsp;<span class="builtintype" id="8114604">error</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114612"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114421">derBytes</a></span><span class="op" id="8114620">,</span>&nbsp;<span class="ident" id="8114622"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114600">err</a></span>&nbsp;<span class="op" id="8114626">=</span>&nbsp;<span class="ident" id="8114628"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112400">x509</a></span><span class="op" id="8114632">.</span><span class="ident" id="8114633"><a href="/gostd/crypto/x509/sec1.go.html#4630026">MarshalECPrivateKey</a></span><span class="op" id="8114652">(</span><span class="ident" id="8114653"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114445">key</a></span><span class="op" id="8114656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114660">if</span>&nbsp;<span class="ident" id="8114663"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114600">err</a></span>&nbsp;<span class="op" id="8114667">!=</span>&nbsp;<span class="builtintype" id="8114670">nil</span>&nbsp;<span class="op" id="8114674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8114679">panic</span><span class="op" id="8114684">(</span><span class="ident" id="8114685"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114600">err</a></span><span class="op" id="8114688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8114692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114695">default</span><span class="op" id="8114702">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8114706">panic</span><span class="op" id="8114711">(</span><span class="string" id="8114712">&#34;unknown&nbsp;key&nbsp;type&#34;</span><span class="op" id="8114730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8114733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114737">var</span>&nbsp;<span class="ident" id="8114741">pemOut</span>&nbsp;<span class="ident" id="8114748"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112361">bytes</a></span><span class="op" id="8114753">.</span><span class="ident" id="8114754"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114762"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112415">pem</a></span><span class="op" id="8114765">.</span><span class="ident" id="8114766"><a href="/gostd/encoding/pem/pem.go.html#4708587">Encode</a></span><span class="op" id="8114772">(</span><span class="op" id="8114773">&amp;</span><span class="ident" id="8114774"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114741">pemOut</a></span><span class="op" id="8114780">,</span>&nbsp;<span class="op" id="8114782">&amp;</span><span class="ident" id="8114783"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112415">pem</a></span><span class="op" id="8114786">.</span><span class="ident" id="8114787"><a href="/gostd/encoding/pem/pem.go.html#4703705">Block</a></span><span class="op" id="8114792">{</span><span class="ident" id="8114793"><a href="/gostd/encoding/pem/pem.go.html#4703721">Type</a></span><span class="op" id="8114797">:</span>&nbsp;<span class="ident" id="8114799"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114401">pemType</a></span>&nbsp;<span class="op" id="8114807">+</span>&nbsp;<span class="string" id="8114809">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="8114823">,</span>&nbsp;<span class="ident" id="8114825"><a href="/gostd/encoding/pem/pem.go.html#4703859">Bytes</a></span><span class="op" id="8114830">:</span>&nbsp;<span class="ident" id="8114832"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114421">derBytes</a></span><span class="op" id="8114840">}</span><span class="op" id="8114841">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114845">keyPath</span>&nbsp;<span class="op" id="8114853">:=</span>&nbsp;<span class="ident" id="8114856"><a href="/gostd/crypto/tls/handshake_test.go.html#8167413">tempFile</a></span><span class="op" id="8114864">(</span><span class="builtintype" id="8114865">string</span><span class="op" id="8114871">(</span><span class="ident" id="8114872"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114741">pemOut</a></span><span class="op" id="8114878">.</span><span class="ident" id="8114879"><a href="/gostd/bytes/buffer.go.html#1384454">Bytes</a></span><span class="op" id="8114884">(</span><span class="op" id="8114885">)</span><span class="op" id="8114886">)</span><span class="op" id="8114887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114890">defer</span>&nbsp;<span class="ident" id="8114896"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112451">os</a></span><span class="op" id="8114898">.</span><span class="ident" id="8114899"><a href="/gostd/os/file_unix.go.html#2459394">Remove</a></span><span class="op" id="8114905">(</span><span class="ident" id="8114906"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114845">keyPath</a></span><span class="op" id="8114913">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114917">var</span>&nbsp;<span class="ident" id="8114921">command</span>&nbsp;<span class="op" id="8114929">[</span><span class="op" id="8114930">]</span><span class="builtintype" id="8114931">string</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114939">if</span>&nbsp;<span class="builtinfunc" id="8114942">len</span><span class="op" id="8114945">(</span><span class="ident" id="8114946"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114064">test</a></span><span class="op" id="8114950">.</span><span class="ident" id="8114951"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span><span class="op" id="8114958">)</span>&nbsp;<span class="op" id="8114960">&gt;</span>&nbsp;<span class="num" id="8114962">0</span>&nbsp;<span class="op" id="8114964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114968"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114921">command</a></span>&nbsp;<span class="op" id="8114976">=</span>&nbsp;<span class="builtinfunc" id="8114978">append</span><span class="op" id="8114984">(</span><span class="ident" id="8114985"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114921">command</a></span><span class="op" id="8114992">,</span>&nbsp;<span class="ident" id="8114994"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114064">test</a></span><span class="op" id="8114998">.</span><span class="ident" id="8114999"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span><span class="op" id="8115006">...</span><span class="op" id="8115009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8115012">}</span>&nbsp;<span class="keyword" id="8115014">else</span>&nbsp;<span class="op" id="8115019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115023"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114921">command</a></span>&nbsp;<span class="op" id="8115031">=</span>&nbsp;<span class="builtinfunc" id="8115033">append</span><span class="op" id="8115039">(</span><span class="ident" id="8115040"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114921">command</a></span><span class="op" id="8115047">,</span>&nbsp;<span class="ident" id="8115049"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113751">defaultServerCommand</a></span><span class="op" id="8115069">...</span><span class="op" id="8115072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8115075">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115078"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114921">command</a></span>&nbsp;<span class="op" id="8115086">=</span>&nbsp;<span class="builtinfunc" id="8115088">append</span><span class="op" id="8115094">(</span><span class="ident" id="8115095"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114921">command</a></span><span class="op" id="8115102">,</span>&nbsp;<span class="string" id="8115104">&#34;-cert&#34;</span><span class="op" id="8115111">,</span>&nbsp;<span class="ident" id="8115113"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114250">certPath</a></span><span class="op" id="8115121">,</span>&nbsp;<span class="string" id="8115123">&#34;-certform&#34;</span><span class="op" id="8115134">,</span>&nbsp;<span class="string" id="8115136">&#34;DER&#34;</span><span class="op" id="8115141">,</span>&nbsp;<span class="string" id="8115143">&#34;-key&#34;</span><span class="op" id="8115149">,</span>&nbsp;<span class="ident" id="8115151"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114845">keyPath</a></span><span class="op" id="8115158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8115161">//&nbsp;serverPort&nbsp;contains&nbsp;the&nbsp;port&nbsp;that&nbsp;OpenSSL&nbsp;will&nbsp;listen&nbsp;on.&nbsp;OpenSSL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8115231">//&nbsp;can&#39;t&nbsp;take&nbsp;&#34;0&#34;&nbsp;as&nbsp;an&nbsp;argument&nbsp;here&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;pick&nbsp;a&nbsp;number&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8115302">//&nbsp;hope&nbsp;that&nbsp;it&#39;s&nbsp;not&nbsp;in&nbsp;use&nbsp;on&nbsp;the&nbsp;machine.&nbsp;Since&nbsp;this&nbsp;only&nbsp;occurs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8115371">//&nbsp;when&nbsp;-update&nbsp;is&nbsp;given&nbsp;and&nbsp;thus&nbsp;when&nbsp;there&#39;s&nbsp;a&nbsp;human&nbsp;watching&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8115440">//&nbsp;test,&nbsp;this&nbsp;isn&#39;t&nbsp;too&nbsp;bad.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8115470">const</span>&nbsp;<span class="ident" id="8115476">serverPort</span>&nbsp;<span class="op" id="8115487">=</span>&nbsp;<span class="num" id="8115489">24323</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115496"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114921">command</a></span>&nbsp;<span class="op" id="8115504">=</span>&nbsp;<span class="builtinfunc" id="8115506">append</span><span class="op" id="8115512">(</span><span class="ident" id="8115513"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114921">command</a></span><span class="op" id="8115520">,</span>&nbsp;<span class="string" id="8115522">&#34;-accept&#34;</span><span class="op" id="8115531">,</span>&nbsp;<span class="ident" id="8115533"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112485">strconv</a></span><span class="op" id="8115540">.</span><span class="ident" id="8115541"><a href="/gostd/strconv/itoa.go.html#2407288">Itoa</a></span><span class="op" id="8115545">(</span><span class="ident" id="8115546"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8115476">serverPort</a></span><span class="op" id="8115556">)</span><span class="op" id="8115557">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115561">cmd</span>&nbsp;<span class="op" id="8115565">:=</span>&nbsp;<span class="ident" id="8115568"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112457">exec</a></span><span class="op" id="8115572">.</span><span class="ident" id="8115573"><a href="/gostd/os/exec/exec.go.html#5581161">Command</a></span><span class="op" id="8115580">(</span><span class="ident" id="8115581"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114921">command</a></span><span class="op" id="8115588">[</span><span class="num" id="8115589">0</span><span class="op" id="8115590">]</span><span class="op" id="8115591">,</span>&nbsp;<span class="ident" id="8115593"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114921">command</a></span><span class="op" id="8115600">[</span><span class="num" id="8115601">1</span><span class="op" id="8115602">:</span><span class="op" id="8115603">]</span><span class="op" id="8115604">...</span><span class="op" id="8115607">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115610"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114139">stdin</a></span>&nbsp;<span class="op" id="8115616">=</span>&nbsp;<span class="ident" id="8115618"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112690">blockingSource</a></span><span class="op" id="8115632">(</span><span class="builtinfunc" id="8115633">make</span><span class="op" id="8115637">(</span><span class="keyword" id="8115638">chan</span>&nbsp;<span class="builtintype" id="8115643">bool</span><span class="op" id="8115647">)</span><span class="op" id="8115648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115651"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8115561">cmd</a></span><span class="op" id="8115654">.</span><span class="ident" id="8115655"><a href="/gostd/os/exec/exec.go.html#5579298">Stdin</a></span>&nbsp;<span class="op" id="8115661">=</span>&nbsp;<span class="ident" id="8115663"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114139">stdin</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8115670">var</span>&nbsp;<span class="ident" id="8115674">out</span>&nbsp;<span class="ident" id="8115678"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112361">bytes</a></span><span class="op" id="8115683">.</span><span class="ident" id="8115684"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115692"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8115561">cmd</a></span><span class="op" id="8115695">.</span><span class="ident" id="8115696"><a href="/gostd/os/exec/exec.go.html#5579600">Stdout</a></span>&nbsp;<span class="op" id="8115703">=</span>&nbsp;<span class="op" id="8115705">&amp;</span><span class="ident" id="8115706"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8115674">out</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115711"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8115561">cmd</a></span><span class="op" id="8115714">.</span><span class="ident" id="8115715"><a href="/gostd/os/exec/exec.go.html#5579618">Stderr</a></span>&nbsp;<span class="op" id="8115722">=</span>&nbsp;<span class="op" id="8115724">&amp;</span><span class="ident" id="8115725"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8115674">out</a></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8115730">if</span>&nbsp;<span class="ident" id="8115733">err</span>&nbsp;<span class="op" id="8115737">:=</span>&nbsp;<span class="ident" id="8115740"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8115561">cmd</a></span><span class="op" id="8115743">.</span><span class="ident" id="8115744"><a href="/gostd/os/exec/exec.go.html#5584773">Start</a></span><span class="op" id="8115749">(</span><span class="op" id="8115750">)</span><span class="op" id="8115751">;</span>&nbsp;<span class="ident" id="8115753"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8115733">err</a></span>&nbsp;<span class="op" id="8115757">!=</span>&nbsp;<span class="builtintype" id="8115760">nil</span>&nbsp;<span class="op" id="8115764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8115768">return</span>&nbsp;<span class="builtintype" id="8115775">nil</span><span class="op" id="8115778">,</span>&nbsp;<span class="builtintype" id="8115780">nil</span><span class="op" id="8115783">,</span>&nbsp;<span class="builtintype" id="8115785">nil</span><span class="op" id="8115788">,</span>&nbsp;<span class="ident" id="8115790"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8115733">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8115795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8115799">//&nbsp;OpenSSL&nbsp;does&nbsp;print&nbsp;an&nbsp;&#34;ACCEPT&#34;&nbsp;banner,&nbsp;but&nbsp;it&nbsp;does&nbsp;so&nbsp;*before*</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8115866">//&nbsp;opening&nbsp;the&nbsp;listening&nbsp;socket,&nbsp;so&nbsp;we&nbsp;can&#39;t&nbsp;use&nbsp;that&nbsp;to&nbsp;wait&nbsp;until&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8115938">//&nbsp;has&nbsp;started&nbsp;listening.&nbsp;Thus&nbsp;we&nbsp;are&nbsp;forced&nbsp;to&nbsp;poll&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8116007">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116023">var</span>&nbsp;<span class="ident" id="8116027">tcpConn</span>&nbsp;<span class="ident" id="8116035"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112444">net</a></span><span class="op" id="8116038">.</span><span class="ident" id="8116039"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116045">for</span>&nbsp;<span class="ident" id="8116049">i</span>&nbsp;<span class="op" id="8116051">:=</span>&nbsp;<span class="builtintype" id="8116054">uint</span><span class="op" id="8116058">(</span><span class="num" id="8116059">0</span><span class="op" id="8116060">)</span><span class="op" id="8116061">;</span>&nbsp;<span class="ident" id="8116063"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116049">i</a></span>&nbsp;<span class="op" id="8116065">&lt;</span>&nbsp;<span class="num" id="8116067">5</span><span class="op" id="8116068">;</span>&nbsp;<span class="ident" id="8116070"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116049">i</a></span><span class="op" id="8116071">++</span>&nbsp;<span class="op" id="8116074">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116078">var</span>&nbsp;<span class="ident" id="8116082">err</span>&nbsp;<span class="builtintype" id="8116086">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116094"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116027">tcpConn</a></span><span class="op" id="8116101">,</span>&nbsp;<span class="ident" id="8116103"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116082">err</a></span>&nbsp;<span class="op" id="8116107">=</span>&nbsp;<span class="ident" id="8116109"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112444">net</a></span><span class="op" id="8116112">.</span><span class="ident" id="8116113"><a href="/gostd/net/tcpsock_posix.go.html#3378472">DialTCP</a></span><span class="op" id="8116120">(</span><span class="string" id="8116121">&#34;tcp&#34;</span><span class="op" id="8116126">,</span>&nbsp;<span class="builtintype" id="8116128">nil</span><span class="op" id="8116131">,</span>&nbsp;<span class="op" id="8116133">&amp;</span><span class="ident" id="8116134"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112444">net</a></span><span class="op" id="8116137">.</span><span class="ident" id="8116138"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="8116145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116150"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="8116152">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8116156"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112444">net</a></span><span class="op" id="8116159">.</span><span class="ident" id="8116160"><a href="/gostd/net/ip.go.html#3286541">IPv4</a></span><span class="op" id="8116164">(</span><span class="num" id="8116165">127</span><span class="op" id="8116168">,</span>&nbsp;<span class="num" id="8116170">0</span><span class="op" id="8116171">,</span>&nbsp;<span class="num" id="8116173">0</span><span class="op" id="8116174">,</span>&nbsp;<span class="num" id="8116176">1</span><span class="op" id="8116177">)</span><span class="op" id="8116178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116183"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="8116187">:</span>&nbsp;<span class="ident" id="8116189"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8115476">serverPort</a></span><span class="op" id="8116199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8116203">}</span><span class="op" id="8116204">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116208">if</span>&nbsp;<span class="ident" id="8116211"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116082">err</a></span>&nbsp;<span class="op" id="8116215">==</span>&nbsp;<span class="builtintype" id="8116218">nil</span>&nbsp;<span class="op" id="8116222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116227">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8116235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116239"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112507">time</a></span><span class="op" id="8116243">.</span><span class="ident" id="8116244"><a href="/gostd/time/sleep.go.html#2713940">Sleep</a></span><span class="op" id="8116249">(</span><span class="op" id="8116250">(</span><span class="num" id="8116251">1</span>&nbsp;<span class="op" id="8116253">&lt;&lt;</span>&nbsp;<span class="ident" id="8116256"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116049">i</a></span><span class="op" id="8116257">)</span>&nbsp;<span class="op" id="8116259">*</span>&nbsp;<span class="num" id="8116261">5</span>&nbsp;<span class="op" id="8116263">*</span>&nbsp;<span class="ident" id="8116265"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112507">time</a></span><span class="op" id="8116269">.</span><span class="ident" id="8116270"><a href="/gostd/time/time.go.html#2734819">Millisecond</a></span><span class="op" id="8116281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8116284">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116287">if</span>&nbsp;<span class="ident" id="8116290"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116027">tcpConn</a></span>&nbsp;<span class="op" id="8116298">==</span>&nbsp;<span class="builtintype" id="8116301">nil</span>&nbsp;<span class="op" id="8116305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8116309">close</span><span class="op" id="8116314">(</span><span class="ident" id="8116315"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114139">stdin</a></span><span class="op" id="8116320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116324"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8115674">out</a></span><span class="op" id="8116327">.</span><span class="ident" id="8116328"><a href="/gostd/bytes/buffer.go.html#1389373">WriteTo</a></span><span class="op" id="8116335">(</span><span class="ident" id="8116336"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112451">os</a></span><span class="op" id="8116338">.</span><span class="ident" id="8116339"><a href="/gostd/os/file.go.html#2441814">Stdout</a></span><span class="op" id="8116345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116349"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8115561">cmd</a></span><span class="op" id="8116352">.</span><span class="ident" id="8116353"><a href="/gostd/os/exec/exec.go.html#5580212">Process</a></span><span class="op" id="8116360">.</span><span class="ident" id="8116361"><a href="/gostd/os/doc.go.html#2423746">Kill</a></span><span class="op" id="8116365">(</span><span class="op" id="8116366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116370">return</span>&nbsp;<span class="builtintype" id="8116377">nil</span><span class="op" id="8116380">,</span>&nbsp;<span class="builtintype" id="8116382">nil</span><span class="op" id="8116385">,</span>&nbsp;<span class="builtintype" id="8116387">nil</span><span class="op" id="8116390">,</span>&nbsp;<span class="ident" id="8116392"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8115561">cmd</a></span><span class="op" id="8116395">.</span><span class="ident" id="8116396"><a href="/gostd/os/exec/exec.go.html#5586661">Wait</a></span><span class="op" id="8116400">(</span><span class="op" id="8116401">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8116404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116408">record</span>&nbsp;<span class="op" id="8116415">:=</span>&nbsp;<span class="op" id="8116418">&amp;</span><span class="ident" id="8116419"><a href="/gostd/crypto/tls/handshake_test.go.html#8164802">recordingConn</a></span><span class="op" id="8116432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116436"><a href="/gostd/crypto/tls/handshake_test.go.html#8164826">Conn</a></span><span class="op" id="8116440">:</span>&nbsp;<span class="ident" id="8116442"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116027">tcpConn</a></span><span class="op" id="8116449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8116452">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116456">return</span>&nbsp;<span class="ident" id="8116463"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116408">record</a></span><span class="op" id="8116469">,</span>&nbsp;<span class="ident" id="8116471"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8115561">cmd</a></span><span class="op" id="8116474">,</span>&nbsp;<span class="ident" id="8116476"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114139">stdin</a></span><span class="op" id="8116481">,</span>&nbsp;<span class="builtintype" id="8116483">nil</span><br>
<span class="lineno"></span><span class="op" id="8116487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8116490">func</span>&nbsp;<span class="op" id="8116495">(</span><span class="ident" id="8116496">test</span>&nbsp;<span class="op" id="8116501">*</span><span class="ident" id="8116502"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8116512">)</span>&nbsp;<span class="ident" id="8116514">dataPath</span><span class="op" id="8116522">(</span><span class="op" id="8116523">)</span>&nbsp;<span class="builtintype" id="8116525">string</span>&nbsp;<span class="op" id="8116532">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116535">return</span>&nbsp;<span class="ident" id="8116542"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112468">filepath</a></span><span class="op" id="8116550">.</span><span class="ident" id="8116551"><a href="/gostd/path/filepath/path.go.html#3783597">Join</a></span><span class="op" id="8116555">(</span><span class="string" id="8116556">&#34;testdata&#34;</span><span class="op" id="8116566">,</span>&nbsp;<span class="string" id="8116568">&#34;Client-&#34;</span><span class="op" id="8116577">+</span><span class="ident" id="8116578"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116496">test</a></span><span class="op" id="8116582">.</span><span class="ident" id="8116583"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span><span class="op" id="8116587">)</span><br>
<span class="lineno"></span><span class="op" id="8116589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8116592">func</span>&nbsp;<span class="op" id="8116597">(</span><span class="ident" id="8116598">test</span>&nbsp;<span class="op" id="8116603">*</span><span class="ident" id="8116604"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8116614">)</span>&nbsp;<span class="ident" id="8116616">loadData</span><span class="op" id="8116624">(</span><span class="op" id="8116625">)</span>&nbsp;<span class="op" id="8116627">(</span><span class="ident" id="8116628">flows</span>&nbsp;<span class="op" id="8116634">[</span><span class="op" id="8116635">]</span><span class="op" id="8116636">[</span><span class="op" id="8116637">]</span><span class="builtintype" id="8116638">byte</span><span class="op" id="8116642">,</span>&nbsp;<span class="ident" id="8116644">err</span>&nbsp;<span class="builtintype" id="8116648">error</span><span class="op" id="8116653">)</span>&nbsp;<span class="op" id="8116655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116658">in</span><span class="op" id="8116660">,</span>&nbsp;<span class="ident" id="8116662"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116644">err</a></span>&nbsp;<span class="op" id="8116666">:=</span>&nbsp;<span class="ident" id="8116669"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112451">os</a></span><span class="op" id="8116671">.</span><span class="ident" id="8116672"><a href="/gostd/os/file.go.html#2446863">Open</a></span><span class="op" id="8116676">(</span><span class="ident" id="8116677"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116598">test</a></span><span class="op" id="8116681">.</span><span class="ident" id="8116682"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116514">dataPath</a></span><span class="op" id="8116690">(</span><span class="op" id="8116691">)</span><span class="op" id="8116692">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116695">if</span>&nbsp;<span class="ident" id="8116698"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116644">err</a></span>&nbsp;<span class="op" id="8116702">!=</span>&nbsp;<span class="builtintype" id="8116705">nil</span>&nbsp;<span class="op" id="8116709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116713">return</span>&nbsp;<span class="builtintype" id="8116720">nil</span><span class="op" id="8116723">,</span>&nbsp;<span class="ident" id="8116725"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116644">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8116730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116733">defer</span>&nbsp;<span class="ident" id="8116739"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116658">in</a></span><span class="op" id="8116741">.</span><span class="ident" id="8116742"><a href="/gostd/os/file_unix.go.html#2454611">Close</a></span><span class="op" id="8116747">(</span><span class="op" id="8116748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116751">return</span>&nbsp;<span class="ident" id="8116758"><a href="/gostd/crypto/tls/handshake_test.go.html#8166113">parseTestData</a></span><span class="op" id="8116771">(</span><span class="ident" id="8116772"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116658">in</a></span><span class="op" id="8116774">)</span><br>
<span class="lineno">165</span><span class="op" id="8116776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8116779">func</span>&nbsp;<span class="op" id="8116784">(</span><span class="ident" id="8116785">test</span>&nbsp;<span class="op" id="8116790">*</span><span class="ident" id="8116791"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8116801">)</span>&nbsp;<span class="ident" id="8116803">run</span><span class="op" id="8116806">(</span><span class="ident" id="8116807">t</span>&nbsp;<span class="op" id="8116809">*</span><span class="ident" id="8116810"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112496">testing</a></span><span class="op" id="8116817">.</span><span class="ident" id="8116818"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8116819">,</span>&nbsp;<span class="ident" id="8116821">write</span>&nbsp;<span class="builtintype" id="8116827">bool</span><span class="op" id="8116831">)</span>&nbsp;<span class="op" id="8116833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116836">var</span>&nbsp;<span class="ident" id="8116840">clientConn</span><span class="op" id="8116850">,</span>&nbsp;<span class="ident" id="8116852">serverConn</span>&nbsp;<span class="ident" id="8116863"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112444">net</a></span><span class="op" id="8116866">.</span><span class="ident" id="8116867"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116873">var</span>&nbsp;<span class="ident" id="8116877">recordingConn</span>&nbsp;<span class="op" id="8116891">*</span><span class="ident" id="8116892"><a href="/gostd/crypto/tls/handshake_test.go.html#8164802">recordingConn</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116907">var</span>&nbsp;<span class="ident" id="8116911">childProcess</span>&nbsp;<span class="op" id="8116924">*</span><span class="ident" id="8116925"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112457">exec</a></span><span class="op" id="8116929">.</span><span class="ident" id="8116930"><a href="/gostd/os/exec/exec.go.html#5578012">Cmd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116935">var</span>&nbsp;<span class="ident" id="8116939">stdin</span>&nbsp;<span class="ident" id="8116945"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112690">blockingSource</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116962">if</span>&nbsp;<span class="ident" id="8116965"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116821">write</a></span>&nbsp;<span class="op" id="8116971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116975">var</span>&nbsp;<span class="ident" id="8116979">err</span>&nbsp;<span class="builtintype" id="8116983">error</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116991"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116877">recordingConn</a></span><span class="op" id="8117004">,</span>&nbsp;<span class="ident" id="8117006"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116911">childProcess</a></span><span class="op" id="8117018">,</span>&nbsp;<span class="ident" id="8117020"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116939">stdin</a></span><span class="op" id="8117025">,</span>&nbsp;<span class="ident" id="8117027"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116979">err</a></span>&nbsp;<span class="op" id="8117031">=</span>&nbsp;<span class="ident" id="8117033"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116785">test</a></span><span class="op" id="8117037">.</span><span class="ident" id="8117038"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8114082">connFromCommand</a></span><span class="op" id="8117053">(</span><span class="op" id="8117054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8117058">if</span>&nbsp;<span class="ident" id="8117061"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116979">err</a></span>&nbsp;<span class="op" id="8117065">!=</span>&nbsp;<span class="builtintype" id="8117068">nil</span>&nbsp;<span class="op" id="8117072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117077"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116807">t</a></span><span class="op" id="8117078">.</span><span class="ident" id="8117079"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8117085">(</span><span class="string" id="8117086">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="8117118">,</span>&nbsp;<span class="ident" id="8117120"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116979">err</a></span><span class="op" id="8117123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8117127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117131"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116840">clientConn</a></span>&nbsp;<span class="op" id="8117142">=</span>&nbsp;<span class="ident" id="8117144"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116877">recordingConn</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8117159">}</span>&nbsp;<span class="keyword" id="8117161">else</span>&nbsp;<span class="op" id="8117166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117170"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116840">clientConn</a></span><span class="op" id="8117180">,</span>&nbsp;<span class="ident" id="8117182"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116852">serverConn</a></span>&nbsp;<span class="op" id="8117193">=</span>&nbsp;<span class="ident" id="8117195"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112444">net</a></span><span class="op" id="8117198">.</span><span class="ident" id="8117199"><a href="/gostd/net/pipe.go.html#3349719">Pipe</a></span><span class="op" id="8117203">(</span><span class="op" id="8117204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8117207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117211">config</span>&nbsp;<span class="op" id="8117218">:=</span>&nbsp;<span class="ident" id="8117221"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116785">test</a></span><span class="op" id="8117225">.</span><span class="ident" id="8117226"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113252">config</a></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8117234">if</span>&nbsp;<span class="ident" id="8117237"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117211">config</a></span>&nbsp;<span class="op" id="8117244">==</span>&nbsp;<span class="builtintype" id="8117247">nil</span>&nbsp;<span class="op" id="8117251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117255"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117211">config</a></span>&nbsp;<span class="op" id="8117262">=</span>&nbsp;<span class="ident" id="8117264"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8117276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117279">client</span>&nbsp;<span class="op" id="8117286">:=</span>&nbsp;<span class="ident" id="8117289"><a href="/gostd/crypto/tls/tls.go.html#4584036">Client</a></span><span class="op" id="8117295">(</span><span class="ident" id="8117296"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116840">clientConn</a></span><span class="op" id="8117306">,</span>&nbsp;<span class="ident" id="8117308"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117211">config</a></span><span class="op" id="8117314">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117318">doneChan</span>&nbsp;<span class="op" id="8117327">:=</span>&nbsp;<span class="builtinfunc" id="8117330">make</span><span class="op" id="8117334">(</span><span class="keyword" id="8117335">chan</span>&nbsp;<span class="builtintype" id="8117340">bool</span><span class="op" id="8117344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8117347">go</span>&nbsp;<span class="keyword" id="8117350">func</span><span class="op" id="8117354">(</span><span class="op" id="8117355">)</span>&nbsp;<span class="op" id="8117357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8117361">if</span>&nbsp;<span class="ident" id="8117364">_</span><span class="op" id="8117365">,</span>&nbsp;<span class="ident" id="8117367">err</span>&nbsp;<span class="op" id="8117371">:=</span>&nbsp;<span class="ident" id="8117374"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117279">client</a></span><span class="op" id="8117380">.</span><span class="ident" id="8117381"><a href="/gostd/crypto/tls/conn.go.html#4484996">Write</a></span><span class="op" id="8117386">(</span><span class="op" id="8117387">[</span><span class="op" id="8117388">]</span><span class="builtintype" id="8117389">byte</span><span class="op" id="8117393">(</span><span class="string" id="8117394">&#34;hello\n&#34;</span><span class="op" id="8117403">)</span><span class="op" id="8117404">)</span><span class="op" id="8117405">;</span>&nbsp;<span class="ident" id="8117407"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117367">err</a></span>&nbsp;<span class="op" id="8117411">!=</span>&nbsp;<span class="builtintype" id="8117414">nil</span>&nbsp;<span class="op" id="8117418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117423"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116807">t</a></span><span class="op" id="8117424">.</span><span class="ident" id="8117425"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="8117429">(</span><span class="string" id="8117430">&#34;Client.Write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8117455">,</span>&nbsp;<span class="ident" id="8117457"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117367">err</a></span><span class="op" id="8117460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8117464">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8117468">if</span>&nbsp;<span class="ident" id="8117471"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116785">test</a></span><span class="op" id="8117475">.</span><span class="ident" id="8117476"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113707">validate</a></span>&nbsp;<span class="op" id="8117485">!=</span>&nbsp;<span class="builtintype" id="8117488">nil</span>&nbsp;<span class="op" id="8117492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8117497">if</span>&nbsp;<span class="ident" id="8117500">err</span>&nbsp;<span class="op" id="8117504">:=</span>&nbsp;<span class="ident" id="8117507"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116785">test</a></span><span class="op" id="8117511">.</span><span class="ident" id="8117512"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113707">validate</a></span><span class="op" id="8117520">(</span><span class="ident" id="8117521"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117279">client</a></span><span class="op" id="8117527">.</span><span class="ident" id="8117528"><a href="/gostd/crypto/tls/conn.go.html#4488867">ConnectionState</a></span><span class="op" id="8117543">(</span><span class="op" id="8117544">)</span><span class="op" id="8117545">)</span><span class="op" id="8117546">;</span>&nbsp;<span class="ident" id="8117548"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117500">err</a></span>&nbsp;<span class="op" id="8117552">!=</span>&nbsp;<span class="builtintype" id="8117555">nil</span>&nbsp;<span class="op" id="8117559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117565"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116807">t</a></span><span class="op" id="8117566">.</span><span class="ident" id="8117567"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="8117571">(</span><span class="string" id="8117572">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8117610">,</span>&nbsp;<span class="ident" id="8117612"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117500">err</a></span><span class="op" id="8117615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8117620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8117624">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117628"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117279">client</a></span><span class="op" id="8117634">.</span><span class="ident" id="8117635"><a href="/gostd/crypto/tls/conn.go.html#4488006">Close</a></span><span class="op" id="8117640">(</span><span class="op" id="8117641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117645"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116840">clientConn</a></span><span class="op" id="8117655">.</span><span class="ident" id="8117656"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8117661">(</span><span class="op" id="8117662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117666"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117318">doneChan</a></span>&nbsp;<span class="op" id="8117675">&lt;-</span>&nbsp;<span class="builtintype" id="8117678">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8117684">}</span><span class="op" id="8117685">(</span><span class="op" id="8117686">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8117690">if</span>&nbsp;<span class="op" id="8117693">!</span><span class="ident" id="8117694"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116821">write</a></span>&nbsp;<span class="op" id="8117700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117704">flows</span><span class="op" id="8117709">,</span>&nbsp;<span class="ident" id="8117711">err</span>&nbsp;<span class="op" id="8117715">:=</span>&nbsp;<span class="ident" id="8117718"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116785">test</a></span><span class="op" id="8117722">.</span><span class="ident" id="8117723"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116616">loadData</a></span><span class="op" id="8117731">(</span><span class="op" id="8117732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8117736">if</span>&nbsp;<span class="ident" id="8117739"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117711">err</a></span>&nbsp;<span class="op" id="8117743">!=</span>&nbsp;<span class="builtintype" id="8117746">nil</span>&nbsp;<span class="op" id="8117750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117755"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116807">t</a></span><span class="op" id="8117756">.</span><span class="ident" id="8117757"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8117763">(</span><span class="string" id="8117764">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="8117801">,</span>&nbsp;<span class="ident" id="8117803"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116785">test</a></span><span class="op" id="8117807">.</span><span class="ident" id="8117808"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span><span class="op" id="8117812">,</span>&nbsp;<span class="ident" id="8117814"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116785">test</a></span><span class="op" id="8117818">.</span><span class="ident" id="8117819"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116514">dataPath</a></span><span class="op" id="8117827">(</span><span class="op" id="8117828">)</span><span class="op" id="8117829">,</span>&nbsp;<span class="ident" id="8117831"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117711">err</a></span><span class="op" id="8117834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8117838">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8117842">for</span>&nbsp;<span class="ident" id="8117846">i</span><span class="op" id="8117847">,</span>&nbsp;<span class="ident" id="8117849">b</span>&nbsp;<span class="op" id="8117851">:=</span>&nbsp;<span class="keyword" id="8117854">range</span>&nbsp;<span class="ident" id="8117860"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117704">flows</a></span>&nbsp;<span class="op" id="8117866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8117871">if</span>&nbsp;<span class="ident" id="8117874"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117846">i</a></span><span class="op" id="8117875">%</span><span class="num" id="8117876">2</span>&nbsp;<span class="op" id="8117878">==</span>&nbsp;<span class="num" id="8117881">1</span>&nbsp;<span class="op" id="8117883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117889"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116852">serverConn</a></span><span class="op" id="8117899">.</span><span class="ident" id="8117900"><a href="/gostd/net/net.go.html#3334839">Write</a></span><span class="op" id="8117905">(</span><span class="ident" id="8117906"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117849">b</a></span><span class="op" id="8117907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8117913">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8117925">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117930">bb</span>&nbsp;<span class="op" id="8117933">:=</span>&nbsp;<span class="builtinfunc" id="8117936">make</span><span class="op" id="8117940">(</span><span class="op" id="8117941">[</span><span class="op" id="8117942">]</span><span class="builtintype" id="8117943">byte</span><span class="op" id="8117947">,</span>&nbsp;<span class="builtinfunc" id="8117949">len</span><span class="op" id="8117952">(</span><span class="ident" id="8117953"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117849">b</a></span><span class="op" id="8117954">)</span><span class="op" id="8117955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8117960">_</span><span class="op" id="8117961">,</span>&nbsp;<span class="ident" id="8117963">err</span>&nbsp;<span class="op" id="8117967">:=</span>&nbsp;<span class="ident" id="8117970"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112438">io</a></span><span class="op" id="8117972">.</span><span class="ident" id="8117973"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="8117981">(</span><span class="ident" id="8117982"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116852">serverConn</a></span><span class="op" id="8117992">,</span>&nbsp;<span class="ident" id="8117994"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117930">bb</a></span><span class="op" id="8117996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8118001">if</span>&nbsp;<span class="ident" id="8118004"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117963">err</a></span>&nbsp;<span class="op" id="8118008">!=</span>&nbsp;<span class="builtintype" id="8118011">nil</span>&nbsp;<span class="op" id="8118015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118021"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116807">t</a></span><span class="op" id="8118022">.</span><span class="ident" id="8118023"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8118029">(</span><span class="string" id="8118030">&#34;%s&nbsp;#%d:&nbsp;%s&#34;</span><span class="op" id="8118042">,</span>&nbsp;<span class="ident" id="8118044"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116785">test</a></span><span class="op" id="8118048">.</span><span class="ident" id="8118049"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span><span class="op" id="8118053">,</span>&nbsp;<span class="ident" id="8118055"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117846">i</a></span><span class="op" id="8118056">,</span>&nbsp;<span class="ident" id="8118058"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117963">err</a></span><span class="op" id="8118061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8118066">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8118071">if</span>&nbsp;<span class="op" id="8118074">!</span><span class="ident" id="8118075"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112361">bytes</a></span><span class="op" id="8118080">.</span><span class="ident" id="8118081"><a href="/gostd/bytes/bytes_decl.go.html#1414806">Equal</a></span><span class="op" id="8118086">(</span><span class="ident" id="8118087"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117849">b</a></span><span class="op" id="8118088">,</span>&nbsp;<span class="ident" id="8118090"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117930">bb</a></span><span class="op" id="8118092">)</span>&nbsp;<span class="op" id="8118094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118100"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116807">t</a></span><span class="op" id="8118101">.</span><span class="ident" id="8118102"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8118108">(</span><span class="string" id="8118109">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="8118151">,</span>&nbsp;<span class="ident" id="8118153"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116785">test</a></span><span class="op" id="8118157">.</span><span class="ident" id="8118158"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span><span class="op" id="8118162">,</span>&nbsp;<span class="ident" id="8118164"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117846">i</a></span><span class="op" id="8118165">,</span>&nbsp;<span class="ident" id="8118167"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117930">bb</a></span><span class="op" id="8118169">,</span>&nbsp;<span class="ident" id="8118171"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117849">b</a></span><span class="op" id="8118172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8118177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8118181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118185"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116852">serverConn</a></span><span class="op" id="8118195">.</span><span class="ident" id="8118196"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8118201">(</span><span class="op" id="8118202">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8118205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8118209">&lt;-</span><span class="ident" id="8118211"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8117318">doneChan</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8118222">if</span>&nbsp;<span class="ident" id="8118225"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116821">write</a></span>&nbsp;<span class="op" id="8118231">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118235">path</span>&nbsp;<span class="op" id="8118240">:=</span>&nbsp;<span class="ident" id="8118243"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116785">test</a></span><span class="op" id="8118247">.</span><span class="ident" id="8118248"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116514">dataPath</a></span><span class="op" id="8118256">(</span><span class="op" id="8118257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118261">out</span><span class="op" id="8118264">,</span>&nbsp;<span class="ident" id="8118266">err</span>&nbsp;<span class="op" id="8118270">:=</span>&nbsp;<span class="ident" id="8118273"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112451">os</a></span><span class="op" id="8118275">.</span><span class="ident" id="8118276"><a href="/gostd/os/file_unix.go.html#2454095">OpenFile</a></span><span class="op" id="8118284">(</span><span class="ident" id="8118285"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118235">path</a></span><span class="op" id="8118289">,</span>&nbsp;<span class="ident" id="8118291"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112451">os</a></span><span class="op" id="8118293">.</span><span class="ident" id="8118294"><a href="/gostd/os/file.go.html#2442115">O_WRONLY</a></span><span class="op" id="8118302">|</span><span class="ident" id="8118303"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112451">os</a></span><span class="op" id="8118305">.</span><span class="ident" id="8118306"><a href="/gostd/os/file.go.html#2442313">O_CREATE</a></span><span class="op" id="8118314">|</span><span class="ident" id="8118315"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112451">os</a></span><span class="op" id="8118317">.</span><span class="ident" id="8118318"><a href="/gostd/os/file.go.html#2442521">O_TRUNC</a></span><span class="op" id="8118325">,</span>&nbsp;<span class="num" id="8118327">0644</span><span class="op" id="8118331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8118335">if</span>&nbsp;<span class="ident" id="8118338"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118266">err</a></span>&nbsp;<span class="op" id="8118342">!=</span>&nbsp;<span class="builtintype" id="8118345">nil</span>&nbsp;<span class="op" id="8118349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118354"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116807">t</a></span><span class="op" id="8118355">.</span><span class="ident" id="8118356"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8118362">(</span><span class="string" id="8118363">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="8118397">,</span>&nbsp;<span class="ident" id="8118399"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118266">err</a></span><span class="op" id="8118402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8118406">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8118410">defer</span>&nbsp;<span class="ident" id="8118416"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118261">out</a></span><span class="op" id="8118419">.</span><span class="ident" id="8118420"><a href="/gostd/os/file_unix.go.html#2454611">Close</a></span><span class="op" id="8118425">(</span><span class="op" id="8118426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118430"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116877">recordingConn</a></span><span class="op" id="8118443">.</span><span class="ident" id="8118444"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8118449">(</span><span class="op" id="8118450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8118454">close</span><span class="op" id="8118459">(</span><span class="ident" id="8118460"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116939">stdin</a></span><span class="op" id="8118465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118469"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116911">childProcess</a></span><span class="op" id="8118481">.</span><span class="ident" id="8118482"><a href="/gostd/os/exec/exec.go.html#5580212">Process</a></span><span class="op" id="8118489">.</span><span class="ident" id="8118490"><a href="/gostd/os/doc.go.html#2423746">Kill</a></span><span class="op" id="8118494">(</span><span class="op" id="8118495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118499"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116911">childProcess</a></span><span class="op" id="8118511">.</span><span class="ident" id="8118512"><a href="/gostd/os/exec/exec.go.html#5586661">Wait</a></span><span class="op" id="8118516">(</span><span class="op" id="8118517">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8118521">if</span>&nbsp;<span class="builtinfunc" id="8118524">len</span><span class="op" id="8118527">(</span><span class="ident" id="8118528"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116877">recordingConn</a></span><span class="op" id="8118541">.</span><span class="ident" id="8118542"><a href="/gostd/crypto/tls/handshake_test.go.html#8164848">flows</a></span><span class="op" id="8118547">)</span>&nbsp;<span class="op" id="8118549">&lt;</span>&nbsp;<span class="num" id="8118551">3</span>&nbsp;<span class="op" id="8118553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118558"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116911">childProcess</a></span><span class="op" id="8118570">.</span><span class="ident" id="8118571"><a href="/gostd/os/exec/exec.go.html#5579600">Stdout</a></span><span class="op" id="8118577">.</span><span class="op" id="8118578">(</span><span class="op" id="8118579">*</span><span class="ident" id="8118580"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112361">bytes</a></span><span class="op" id="8118585">.</span><span class="ident" id="8118586"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><span class="op" id="8118592">)</span><span class="op" id="8118593">.</span><span class="ident" id="8118594"><a href="/gostd/bytes/buffer.go.html#1389373">WriteTo</a></span><span class="op" id="8118601">(</span><span class="ident" id="8118602"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112451">os</a></span><span class="op" id="8118604">.</span><span class="ident" id="8118605"><a href="/gostd/os/file.go.html#2441814">Stdout</a></span><span class="op" id="8118611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118616"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116807">t</a></span><span class="op" id="8118617">.</span><span class="ident" id="8118618"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8118624">(</span><span class="string" id="8118625">&#34;Client&nbsp;connection&nbsp;didn&#39;t&nbsp;work&#34;</span><span class="op" id="8118656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8118660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118664"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116877">recordingConn</a></span><span class="op" id="8118677">.</span><span class="ident" id="8118678"><a href="/gostd/crypto/tls/handshake_test.go.html#8165712">WriteTo</a></span><span class="op" id="8118685">(</span><span class="ident" id="8118686"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118261">out</a></span><span class="op" id="8118689">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118693"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112431">fmt</a></span><span class="op" id="8118696">.</span><span class="ident" id="8118697"><a href="/gostd/fmt/print.go.html#2143442">Printf</a></span><span class="op" id="8118703">(</span><span class="string" id="8118704">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="8118716">,</span>&nbsp;<span class="ident" id="8118718"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118235">path</a></span><span class="op" id="8118722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8118725">}</span><br>
<span class="lineno"></span><span class="op" id="8118727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8118730">func</span>&nbsp;<span class="ident" id="8118735">runClientTestForVersion</span><span class="op" id="8118758">(</span><span class="ident" id="8118759">t</span>&nbsp;<span class="op" id="8118761">*</span><span class="ident" id="8118762"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112496">testing</a></span><span class="op" id="8118769">.</span><span class="ident" id="8118770"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8118771">,</span>&nbsp;<span class="ident" id="8118773">template</span>&nbsp;<span class="op" id="8118782">*</span><span class="ident" id="8118783"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8118793">,</span>&nbsp;<span class="ident" id="8118795">prefix</span><span class="op" id="8118801">,</span>&nbsp;<span class="ident" id="8118803">option</span>&nbsp;<span class="builtintype" id="8118810">string</span><span class="op" id="8118816">)</span>&nbsp;<span class="op" id="8118818">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118821">test</span>&nbsp;<span class="op" id="8118826">:=</span>&nbsp;<span class="op" id="8118829">*</span><span class="ident" id="8118830"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118773">template</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118840"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118821">test</a></span><span class="op" id="8118844">.</span><span class="ident" id="8118845"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span>&nbsp;<span class="op" id="8118850">=</span>&nbsp;<span class="ident" id="8118852"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118795">prefix</a></span>&nbsp;<span class="op" id="8118859">+</span>&nbsp;<span class="ident" id="8118861"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118821">test</a></span><span class="op" id="8118865">.</span><span class="ident" id="8118866"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8118872">if</span>&nbsp;<span class="builtinfunc" id="8118875">len</span><span class="op" id="8118878">(</span><span class="ident" id="8118879"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118821">test</a></span><span class="op" id="8118883">.</span><span class="ident" id="8118884"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span><span class="op" id="8118891">)</span>&nbsp;<span class="op" id="8118893">==</span>&nbsp;<span class="num" id="8118896">0</span>&nbsp;<span class="op" id="8118898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118902"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118821">test</a></span><span class="op" id="8118906">.</span><span class="ident" id="8118907"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span>&nbsp;<span class="op" id="8118915">=</span>&nbsp;<span class="ident" id="8118917"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140079">defaultClientCommand</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8118939">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118942"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118821">test</a></span><span class="op" id="8118946">.</span><span class="ident" id="8118947"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span>&nbsp;<span class="op" id="8118955">=</span>&nbsp;<span class="builtinfunc" id="8118957">append</span><span class="op" id="8118963">(</span><span class="op" id="8118964">[</span><span class="op" id="8118965">]</span><span class="builtintype" id="8118966">string</span><span class="op" id="8118972">(</span><span class="builtintype" id="8118973">nil</span><span class="op" id="8118976">)</span><span class="op" id="8118977">,</span>&nbsp;<span class="ident" id="8118979"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118821">test</a></span><span class="op" id="8118983">.</span><span class="ident" id="8118984"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span><span class="op" id="8118991">...</span><span class="op" id="8118994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8118997"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118821">test</a></span><span class="op" id="8119001">.</span><span class="ident" id="8119002"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span>&nbsp;<span class="op" id="8119010">=</span>&nbsp;<span class="builtinfunc" id="8119012">append</span><span class="op" id="8119018">(</span><span class="ident" id="8119019"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118821">test</a></span><span class="op" id="8119023">.</span><span class="ident" id="8119024"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span><span class="op" id="8119031">,</span>&nbsp;<span class="ident" id="8119033"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118803">option</a></span><span class="op" id="8119039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119042"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118821">test</a></span><span class="op" id="8119046">.</span><span class="ident" id="8119047"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8116803">run</a></span><span class="op" id="8119050">(</span><span class="ident" id="8119051"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118759">t</a></span><span class="op" id="8119052">,</span>&nbsp;<span class="op" id="8119054">*</span><span class="ident" id="8119055"><a href="/gostd/crypto/tls/handshake_test.go.html#8164557">update</a></span><span class="op" id="8119061">)</span><br>
<span class="lineno"></span><span class="op" id="8119063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="8119066">func</span>&nbsp;<span class="ident" id="8119071">runClientTestTLS10</span><span class="op" id="8119089">(</span><span class="ident" id="8119090">t</span>&nbsp;<span class="op" id="8119092">*</span><span class="ident" id="8119093"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112496">testing</a></span><span class="op" id="8119100">.</span><span class="ident" id="8119101"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8119102">,</span>&nbsp;<span class="ident" id="8119104">template</span>&nbsp;<span class="op" id="8119113">*</span><span class="ident" id="8119114"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8119124">)</span>&nbsp;<span class="op" id="8119126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119129"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118735">runClientTestForVersion</a></span><span class="op" id="8119152">(</span><span class="ident" id="8119153"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119090">t</a></span><span class="op" id="8119154">,</span>&nbsp;<span class="ident" id="8119156"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119104">template</a></span><span class="op" id="8119164">,</span>&nbsp;<span class="string" id="8119166">&#34;TLSv10-&#34;</span><span class="op" id="8119175">,</span>&nbsp;<span class="string" id="8119177">&#34;-tls1&#34;</span><span class="op" id="8119184">)</span><br>
<span class="lineno"></span><span class="op" id="8119186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8119189">func</span>&nbsp;<span class="ident" id="8119194">runClientTestTLS11</span><span class="op" id="8119212">(</span><span class="ident" id="8119213">t</span>&nbsp;<span class="op" id="8119215">*</span><span class="ident" id="8119216"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112496">testing</a></span><span class="op" id="8119223">.</span><span class="ident" id="8119224"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8119225">,</span>&nbsp;<span class="ident" id="8119227">template</span>&nbsp;<span class="op" id="8119236">*</span><span class="ident" id="8119237"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8119247">)</span>&nbsp;<span class="op" id="8119249">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119252"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118735">runClientTestForVersion</a></span><span class="op" id="8119275">(</span><span class="ident" id="8119276"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119213">t</a></span><span class="op" id="8119277">,</span>&nbsp;<span class="ident" id="8119279"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119227">template</a></span><span class="op" id="8119287">,</span>&nbsp;<span class="string" id="8119289">&#34;TLSv11-&#34;</span><span class="op" id="8119298">,</span>&nbsp;<span class="string" id="8119300">&#34;-tls1_1&#34;</span><span class="op" id="8119309">)</span><br>
<span class="lineno"></span><span class="op" id="8119311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8119314">func</span>&nbsp;<span class="ident" id="8119319">runClientTestTLS12</span><span class="op" id="8119337">(</span><span class="ident" id="8119338">t</span>&nbsp;<span class="op" id="8119340">*</span><span class="ident" id="8119341"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112496">testing</a></span><span class="op" id="8119348">.</span><span class="ident" id="8119349"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8119350">,</span>&nbsp;<span class="ident" id="8119352">template</span>&nbsp;<span class="op" id="8119361">*</span><span class="ident" id="8119362"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8119372">)</span>&nbsp;<span class="op" id="8119374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119377"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8118735">runClientTestForVersion</a></span><span class="op" id="8119400">(</span><span class="ident" id="8119401"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119338">t</a></span><span class="op" id="8119402">,</span>&nbsp;<span class="ident" id="8119404"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119352">template</a></span><span class="op" id="8119412">,</span>&nbsp;<span class="string" id="8119414">&#34;TLSv12-&#34;</span><span class="op" id="8119423">,</span>&nbsp;<span class="string" id="8119425">&#34;-tls1_2&#34;</span><span class="op" id="8119434">)</span><br>
<span class="lineno">270</span><span class="op" id="8119436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8119439">func</span>&nbsp;<span class="ident" id="8119444">TestHandshakeClientRSARC4</span><span class="op" id="8119469">(</span><span class="ident" id="8119470">t</span>&nbsp;<span class="op" id="8119472">*</span><span class="ident" id="8119473"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112496">testing</a></span><span class="op" id="8119480">.</span><span class="ident" id="8119481"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8119482">)</span>&nbsp;<span class="op" id="8119484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119487">test</span>&nbsp;<span class="op" id="8119492">:=</span>&nbsp;<span class="op" id="8119495">&amp;</span><span class="ident" id="8119496"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8119506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119510"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span><span class="op" id="8119514">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8119519">&#34;RSA-RC4&#34;</span><span class="op" id="8119528">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119532"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span><span class="op" id="8119539">:</span>&nbsp;<span class="op" id="8119541">[</span><span class="op" id="8119542">]</span><span class="builtintype" id="8119543">string</span><span class="op" id="8119549">{</span><span class="string" id="8119550">&#34;openssl&#34;</span><span class="op" id="8119559">,</span>&nbsp;<span class="string" id="8119561">&#34;s_server&#34;</span><span class="op" id="8119571">,</span>&nbsp;<span class="string" id="8119573">&#34;-cipher&#34;</span><span class="op" id="8119582">,</span>&nbsp;<span class="string" id="8119584">&#34;RC4-SHA&#34;</span><span class="op" id="8119593">}</span><span class="op" id="8119594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8119597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119600"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119071">runClientTestTLS10</a></span><span class="op" id="8119618">(</span><span class="ident" id="8119619"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119470">t</a></span><span class="op" id="8119620">,</span>&nbsp;<span class="ident" id="8119622"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119487">test</a></span><span class="op" id="8119626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119629"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119194">runClientTestTLS11</a></span><span class="op" id="8119647">(</span><span class="ident" id="8119648"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119470">t</a></span><span class="op" id="8119649">,</span>&nbsp;<span class="ident" id="8119651"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119487">test</a></span><span class="op" id="8119655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119658"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119319">runClientTestTLS12</a></span><span class="op" id="8119676">(</span><span class="ident" id="8119677"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119470">t</a></span><span class="op" id="8119678">,</span>&nbsp;<span class="ident" id="8119680"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119487">test</a></span><span class="op" id="8119684">)</span><br>
<span class="lineno">280</span><span class="op" id="8119686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8119689">func</span>&nbsp;<span class="ident" id="8119694">TestHandshakeClientECDHERSAAES</span><span class="op" id="8119724">(</span><span class="ident" id="8119725">t</span>&nbsp;<span class="op" id="8119727">*</span><span class="ident" id="8119728"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112496">testing</a></span><span class="op" id="8119735">.</span><span class="ident" id="8119736"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8119737">)</span>&nbsp;<span class="op" id="8119739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119742">test</span>&nbsp;<span class="op" id="8119747">:=</span>&nbsp;<span class="op" id="8119750">&amp;</span><span class="ident" id="8119751"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8119761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119765"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span><span class="op" id="8119769">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8119774">&#34;ECDHE-RSA-AES&#34;</span><span class="op" id="8119789">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119793"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span><span class="op" id="8119800">:</span>&nbsp;<span class="op" id="8119802">[</span><span class="op" id="8119803">]</span><span class="builtintype" id="8119804">string</span><span class="op" id="8119810">{</span><span class="string" id="8119811">&#34;openssl&#34;</span><span class="op" id="8119820">,</span>&nbsp;<span class="string" id="8119822">&#34;s_server&#34;</span><span class="op" id="8119832">,</span>&nbsp;<span class="string" id="8119834">&#34;-cipher&#34;</span><span class="op" id="8119843">,</span>&nbsp;<span class="string" id="8119845">&#34;ECDHE-RSA-AES128-SHA&#34;</span><span class="op" id="8119867">}</span><span class="op" id="8119868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8119871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119874"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119071">runClientTestTLS10</a></span><span class="op" id="8119892">(</span><span class="ident" id="8119893"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119725">t</a></span><span class="op" id="8119894">,</span>&nbsp;<span class="ident" id="8119896"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119742">test</a></span><span class="op" id="8119900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119903"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119194">runClientTestTLS11</a></span><span class="op" id="8119921">(</span><span class="ident" id="8119922"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119725">t</a></span><span class="op" id="8119923">,</span>&nbsp;<span class="ident" id="8119925"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119742">test</a></span><span class="op" id="8119929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8119932"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119319">runClientTestTLS12</a></span><span class="op" id="8119950">(</span><span class="ident" id="8119951"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119725">t</a></span><span class="op" id="8119952">,</span>&nbsp;<span class="ident" id="8119954"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119742">test</a></span><span class="op" id="8119958">)</span><br>
<span class="lineno">290</span><span class="op" id="8119960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8119963">func</span>&nbsp;<span class="ident" id="8119968">TestHandshakeClientECDHEECDSAAES</span><span class="op" id="8120000">(</span><span class="ident" id="8120001">t</span>&nbsp;<span class="op" id="8120003">*</span><span class="ident" id="8120004"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112496">testing</a></span><span class="op" id="8120011">.</span><span class="ident" id="8120012"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8120013">)</span>&nbsp;<span class="op" id="8120015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120018">test</span>&nbsp;<span class="op" id="8120023">:=</span>&nbsp;<span class="op" id="8120026">&amp;</span><span class="ident" id="8120027"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8120037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120041"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span><span class="op" id="8120045">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8120050">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="8120067">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120071"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span><span class="op" id="8120078">:</span>&nbsp;<span class="op" id="8120080">[</span><span class="op" id="8120081">]</span><span class="builtintype" id="8120082">string</span><span class="op" id="8120088">{</span><span class="string" id="8120089">&#34;openssl&#34;</span><span class="op" id="8120098">,</span>&nbsp;<span class="string" id="8120100">&#34;s_server&#34;</span><span class="op" id="8120110">,</span>&nbsp;<span class="string" id="8120112">&#34;-cipher&#34;</span><span class="op" id="8120121">,</span>&nbsp;<span class="string" id="8120123">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="8120147">}</span><span class="op" id="8120148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120152"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113357">cert</a></span><span class="op" id="8120156">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120161"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8159422">testECDSACertificate</a></span><span class="op" id="8120181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120185"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113501">key</a></span><span class="op" id="8120188">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120194"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8162664">testECDSAPrivateKey</a></span><span class="op" id="8120213">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8120216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120219"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119071">runClientTestTLS10</a></span><span class="op" id="8120237">(</span><span class="ident" id="8120238"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120001">t</a></span><span class="op" id="8120239">,</span>&nbsp;<span class="ident" id="8120241"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120018">test</a></span><span class="op" id="8120245">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120248"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119194">runClientTestTLS11</a></span><span class="op" id="8120266">(</span><span class="ident" id="8120267"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120001">t</a></span><span class="op" id="8120268">,</span>&nbsp;<span class="ident" id="8120270"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120018">test</a></span><span class="op" id="8120274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120277"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119319">runClientTestTLS12</a></span><span class="op" id="8120295">(</span><span class="ident" id="8120296"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120001">t</a></span><span class="op" id="8120297">,</span>&nbsp;<span class="ident" id="8120299"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120018">test</a></span><span class="op" id="8120303">)</span><br>
<span class="lineno"></span><span class="op" id="8120305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8120308">func</span>&nbsp;<span class="ident" id="8120313">TestHandshakeClientECDHEECDSAAESGCM</span><span class="op" id="8120348">(</span><span class="ident" id="8120349">t</span>&nbsp;<span class="op" id="8120351">*</span><span class="ident" id="8120352"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112496">testing</a></span><span class="op" id="8120359">.</span><span class="ident" id="8120360"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8120361">)</span>&nbsp;<span class="op" id="8120363">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120366">test</span>&nbsp;<span class="op" id="8120371">:=</span>&nbsp;<span class="op" id="8120374">&amp;</span><span class="ident" id="8120375"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8120385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120389"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span><span class="op" id="8120393">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8120398">&#34;ECDHE-ECDSA-AES-GCM&#34;</span><span class="op" id="8120419">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120423"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span><span class="op" id="8120430">:</span>&nbsp;<span class="op" id="8120432">[</span><span class="op" id="8120433">]</span><span class="builtintype" id="8120434">string</span><span class="op" id="8120440">{</span><span class="string" id="8120441">&#34;openssl&#34;</span><span class="op" id="8120450">,</span>&nbsp;<span class="string" id="8120452">&#34;s_server&#34;</span><span class="op" id="8120462">,</span>&nbsp;<span class="string" id="8120464">&#34;-cipher&#34;</span><span class="op" id="8120473">,</span>&nbsp;<span class="string" id="8120475">&#34;ECDHE-ECDSA-AES128-GCM-SHA256&#34;</span><span class="op" id="8120506">}</span><span class="op" id="8120507">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120511"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113357">cert</a></span><span class="op" id="8120515">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120520"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8159422">testECDSACertificate</a></span><span class="op" id="8120540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120544"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113501">key</a></span><span class="op" id="8120547">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120553"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8162664">testECDSAPrivateKey</a></span><span class="op" id="8120572">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8120575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120578"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119319">runClientTestTLS12</a></span><span class="op" id="8120596">(</span><span class="ident" id="8120597"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120349">t</a></span><span class="op" id="8120598">,</span>&nbsp;<span class="ident" id="8120600"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120366">test</a></span><span class="op" id="8120604">)</span><br>
<span class="lineno"></span><span class="op" id="8120606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8120609">func</span>&nbsp;<span class="ident" id="8120614">TestHandshakeClientCertRSA</span><span class="op" id="8120640">(</span><span class="ident" id="8120641">t</span>&nbsp;<span class="op" id="8120643">*</span><span class="ident" id="8120644"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112496">testing</a></span><span class="op" id="8120651">.</span><span class="ident" id="8120652"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8120653">)</span>&nbsp;<span class="op" id="8120655">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120658">config</span>&nbsp;<span class="op" id="8120665">:=</span>&nbsp;<span class="op" id="8120668">*</span><span class="ident" id="8120669"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120681">cert</span><span class="op" id="8120685">,</span>&nbsp;<span class="ident" id="8120687">_</span>&nbsp;<span class="op" id="8120689">:=</span>&nbsp;<span class="ident" id="8120692"><a href="/gostd/crypto/tls/tls.go.html#4588297">X509KeyPair</a></span><span class="op" id="8120703">(</span><span class="op" id="8120704">[</span><span class="op" id="8120705">]</span><span class="builtintype" id="8120706">byte</span><span class="op" id="8120710">(</span><span class="ident" id="8120711"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8153583">clientCertificatePEM</a></span><span class="op" id="8120731">)</span><span class="op" id="8120732">,</span>&nbsp;<span class="op" id="8120734">[</span><span class="op" id="8120735">]</span><span class="builtintype" id="8120736">byte</span><span class="op" id="8120740">(</span><span class="ident" id="8120741"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8154345">clientKeyPEM</a></span><span class="op" id="8120753">)</span><span class="op" id="8120754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120757"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120658">config</a></span><span class="op" id="8120763">.</span><span class="ident" id="8120764"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span>&nbsp;<span class="op" id="8120777">=</span>&nbsp;<span class="op" id="8120779">[</span><span class="op" id="8120780">]</span><span class="ident" id="8120781"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="8120792">{</span><span class="ident" id="8120793"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120681">cert</a></span><span class="op" id="8120797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120801">test</span>&nbsp;<span class="op" id="8120806">:=</span>&nbsp;<span class="op" id="8120809">&amp;</span><span class="ident" id="8120810"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8120820">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120824"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span><span class="op" id="8120828">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8120833">&#34;ClientCert-RSA-RSA&#34;</span><span class="op" id="8120853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120857"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span><span class="op" id="8120864">:</span>&nbsp;<span class="op" id="8120866">[</span><span class="op" id="8120867">]</span><span class="builtintype" id="8120868">string</span><span class="op" id="8120874">{</span><span class="string" id="8120875">&#34;openssl&#34;</span><span class="op" id="8120884">,</span>&nbsp;<span class="string" id="8120886">&#34;s_server&#34;</span><span class="op" id="8120896">,</span>&nbsp;<span class="string" id="8120898">&#34;-cipher&#34;</span><span class="op" id="8120907">,</span>&nbsp;<span class="string" id="8120909">&#34;RC4-SHA&#34;</span><span class="op" id="8120918">,</span>&nbsp;<span class="string" id="8120920">&#34;-verify&#34;</span><span class="op" id="8120929">,</span>&nbsp;<span class="string" id="8120931">&#34;1&#34;</span><span class="op" id="8120934">}</span><span class="op" id="8120935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120939"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113252">config</a></span><span class="op" id="8120945">:</span>&nbsp;&nbsp;<span class="op" id="8120948">&amp;</span><span class="ident" id="8120949"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120658">config</a></span><span class="op" id="8120955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8120958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120962"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119071">runClientTestTLS10</a></span><span class="op" id="8120980">(</span><span class="ident" id="8120981"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120641">t</a></span><span class="op" id="8120982">,</span>&nbsp;<span class="ident" id="8120984"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120801">test</a></span><span class="op" id="8120988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8120991"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119319">runClientTestTLS12</a></span><span class="op" id="8121009">(</span><span class="ident" id="8121010"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120641">t</a></span><span class="op" id="8121011">,</span>&nbsp;<span class="ident" id="8121013"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120801">test</a></span><span class="op" id="8121017">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121021"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120801">test</a></span>&nbsp;<span class="op" id="8121026">=</span>&nbsp;<span class="op" id="8121028">&amp;</span><span class="ident" id="8121029"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8121039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121043"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span><span class="op" id="8121047">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8121052">&#34;ClientCert-RSA-ECDSA&#34;</span><span class="op" id="8121074">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121078"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span><span class="op" id="8121085">:</span>&nbsp;<span class="op" id="8121087">[</span><span class="op" id="8121088">]</span><span class="builtintype" id="8121089">string</span><span class="op" id="8121095">{</span><span class="string" id="8121096">&#34;openssl&#34;</span><span class="op" id="8121105">,</span>&nbsp;<span class="string" id="8121107">&#34;s_server&#34;</span><span class="op" id="8121117">,</span>&nbsp;<span class="string" id="8121119">&#34;-cipher&#34;</span><span class="op" id="8121128">,</span>&nbsp;<span class="string" id="8121130">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="8121154">,</span>&nbsp;<span class="string" id="8121156">&#34;-verify&#34;</span><span class="op" id="8121165">,</span>&nbsp;<span class="string" id="8121167">&#34;1&#34;</span><span class="op" id="8121170">}</span><span class="op" id="8121171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121175"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113252">config</a></span><span class="op" id="8121181">:</span>&nbsp;&nbsp;<span class="op" id="8121184">&amp;</span><span class="ident" id="8121185"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120658">config</a></span><span class="op" id="8121191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121195"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113357">cert</a></span><span class="op" id="8121199">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121204"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8159422">testECDSACertificate</a></span><span class="op" id="8121224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121228"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113501">key</a></span><span class="op" id="8121231">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121237"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8162664">testECDSAPrivateKey</a></span><span class="op" id="8121256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8121259">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121263"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119071">runClientTestTLS10</a></span><span class="op" id="8121281">(</span><span class="ident" id="8121282"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120641">t</a></span><span class="op" id="8121283">,</span>&nbsp;<span class="ident" id="8121285"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120801">test</a></span><span class="op" id="8121289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121292"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119319">runClientTestTLS12</a></span><span class="op" id="8121310">(</span><span class="ident" id="8121311"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120641">t</a></span><span class="op" id="8121312">,</span>&nbsp;<span class="ident" id="8121314"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8120801">test</a></span><span class="op" id="8121318">)</span><br>
<span class="lineno"></span><span class="op" id="8121320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="8121323">func</span>&nbsp;<span class="ident" id="8121328">TestHandshakeClientCertECDSA</span><span class="op" id="8121356">(</span><span class="ident" id="8121357">t</span>&nbsp;<span class="op" id="8121359">*</span><span class="ident" id="8121360"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112496">testing</a></span><span class="op" id="8121367">.</span><span class="ident" id="8121368"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8121369">)</span>&nbsp;<span class="op" id="8121371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121374">config</span>&nbsp;<span class="op" id="8121381">:=</span>&nbsp;<span class="op" id="8121384">*</span><span class="ident" id="8121385"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121397">cert</span><span class="op" id="8121401">,</span>&nbsp;<span class="ident" id="8121403">_</span>&nbsp;<span class="op" id="8121405">:=</span>&nbsp;<span class="ident" id="8121408"><a href="/gostd/crypto/tls/tls.go.html#4588297">X509KeyPair</a></span><span class="op" id="8121419">(</span><span class="op" id="8121420">[</span><span class="op" id="8121421">]</span><span class="builtintype" id="8121422">byte</span><span class="op" id="8121426">(</span><span class="ident" id="8121427"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8155253">clientECDSACertificatePEM</a></span><span class="op" id="8121452">)</span><span class="op" id="8121453">,</span>&nbsp;<span class="op" id="8121455">[</span><span class="op" id="8121456">]</span><span class="builtintype" id="8121457">byte</span><span class="op" id="8121461">(</span><span class="ident" id="8121462"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156040">clientECDSAKeyPEM</a></span><span class="op" id="8121479">)</span><span class="op" id="8121480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121483"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8121374">config</a></span><span class="op" id="8121489">.</span><span class="ident" id="8121490"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span>&nbsp;<span class="op" id="8121503">=</span>&nbsp;<span class="op" id="8121505">[</span><span class="op" id="8121506">]</span><span class="ident" id="8121507"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="8121518">{</span><span class="ident" id="8121519"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8121397">cert</a></span><span class="op" id="8121523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121527">test</span>&nbsp;<span class="op" id="8121532">:=</span>&nbsp;<span class="op" id="8121535">&amp;</span><span class="ident" id="8121536"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8121546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121550"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span><span class="op" id="8121554">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8121559">&#34;ClientCert-ECDSA-RSA&#34;</span><span class="op" id="8121581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121585"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span><span class="op" id="8121592">:</span>&nbsp;<span class="op" id="8121594">[</span><span class="op" id="8121595">]</span><span class="builtintype" id="8121596">string</span><span class="op" id="8121602">{</span><span class="string" id="8121603">&#34;openssl&#34;</span><span class="op" id="8121612">,</span>&nbsp;<span class="string" id="8121614">&#34;s_server&#34;</span><span class="op" id="8121624">,</span>&nbsp;<span class="string" id="8121626">&#34;-cipher&#34;</span><span class="op" id="8121635">,</span>&nbsp;<span class="string" id="8121637">&#34;RC4-SHA&#34;</span><span class="op" id="8121646">,</span>&nbsp;<span class="string" id="8121648">&#34;-verify&#34;</span><span class="op" id="8121657">,</span>&nbsp;<span class="string" id="8121659">&#34;1&#34;</span><span class="op" id="8121662">}</span><span class="op" id="8121663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121667"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113252">config</a></span><span class="op" id="8121673">:</span>&nbsp;&nbsp;<span class="op" id="8121676">&amp;</span><span class="ident" id="8121677"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8121374">config</a></span><span class="op" id="8121683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8121686">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121690"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119071">runClientTestTLS10</a></span><span class="op" id="8121708">(</span><span class="ident" id="8121709"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8121357">t</a></span><span class="op" id="8121710">,</span>&nbsp;<span class="ident" id="8121712"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8121527">test</a></span><span class="op" id="8121716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121719"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119319">runClientTestTLS12</a></span><span class="op" id="8121737">(</span><span class="ident" id="8121738"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8121357">t</a></span><span class="op" id="8121739">,</span>&nbsp;<span class="ident" id="8121741"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8121527">test</a></span><span class="op" id="8121745">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121749"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8121527">test</a></span>&nbsp;<span class="op" id="8121754">=</span>&nbsp;<span class="op" id="8121756">&amp;</span><span class="ident" id="8121757"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8121767">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121771"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span><span class="op" id="8121775">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8121780">&#34;ClientCert-ECDSA-ECDSA&#34;</span><span class="op" id="8121804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121808"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span><span class="op" id="8121815">:</span>&nbsp;<span class="op" id="8121817">[</span><span class="op" id="8121818">]</span><span class="builtintype" id="8121819">string</span><span class="op" id="8121825">{</span><span class="string" id="8121826">&#34;openssl&#34;</span><span class="op" id="8121835">,</span>&nbsp;<span class="string" id="8121837">&#34;s_server&#34;</span><span class="op" id="8121847">,</span>&nbsp;<span class="string" id="8121849">&#34;-cipher&#34;</span><span class="op" id="8121858">,</span>&nbsp;<span class="string" id="8121860">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="8121884">,</span>&nbsp;<span class="string" id="8121886">&#34;-verify&#34;</span><span class="op" id="8121895">,</span>&nbsp;<span class="string" id="8121897">&#34;1&#34;</span><span class="op" id="8121900">}</span><span class="op" id="8121901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121905"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113252">config</a></span><span class="op" id="8121911">:</span>&nbsp;&nbsp;<span class="op" id="8121914">&amp;</span><span class="ident" id="8121915"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8121374">config</a></span><span class="op" id="8121921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121925"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113357">cert</a></span><span class="op" id="8121929">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121934"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8159422">testECDSACertificate</a></span><span class="op" id="8121954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121958"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113501">key</a></span><span class="op" id="8121961">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121967"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8162664">testECDSAPrivateKey</a></span><span class="op" id="8121986">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8121989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8121993"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119071">runClientTestTLS10</a></span><span class="op" id="8122011">(</span><span class="ident" id="8122012"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8121357">t</a></span><span class="op" id="8122013">,</span>&nbsp;<span class="ident" id="8122015"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8121527">test</a></span><span class="op" id="8122019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122022"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119319">runClientTestTLS12</a></span><span class="op" id="8122040">(</span><span class="ident" id="8122041"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8121357">t</a></span><span class="op" id="8122042">,</span>&nbsp;<span class="ident" id="8122044"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8121527">test</a></span><span class="op" id="8122048">)</span><br>
<span class="lineno"></span><span class="op" id="8122050">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="8122053">func</span>&nbsp;<span class="ident" id="8122058">TestClientResumption</span><span class="op" id="8122078">(</span><span class="ident" id="8122079">t</span>&nbsp;<span class="op" id="8122081">*</span><span class="ident" id="8122082"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112496">testing</a></span><span class="op" id="8122089">.</span><span class="ident" id="8122090"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8122091">)</span>&nbsp;<span class="op" id="8122093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122096">serverConfig</span>&nbsp;<span class="op" id="8122109">:=</span>&nbsp;<span class="op" id="8122112">&amp;</span><span class="ident" id="8122113"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="8122119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122123"><a href="/gostd/crypto/tls/common.go.html#4453138">CipherSuites</a></span><span class="op" id="8122135">:</span>&nbsp;<span class="op" id="8122137">[</span><span class="op" id="8122138">]</span><span class="builtintype" id="8122139">uint16</span><span class="op" id="8122145">{</span><span class="ident" id="8122146"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441171">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="8122170">,</span>&nbsp;<span class="ident" id="8122172"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441570">TLS_ECDHE_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="8122202">}</span><span class="op" id="8122203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122207"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="8122219">:</span>&nbsp;<span class="ident" id="8122221"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><span class="op" id="8122231">.</span><span class="ident" id="8122232"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="8122244">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8122247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122250">clientConfig</span>&nbsp;<span class="op" id="8122263">:=</span>&nbsp;<span class="op" id="8122266">&amp;</span><span class="ident" id="8122267"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="8122273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122277"><a href="/gostd/crypto/tls/common.go.html#4453138">CipherSuites</a></span><span class="op" id="8122289">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8122297">[</span><span class="op" id="8122298">]</span><span class="builtintype" id="8122299">uint16</span><span class="op" id="8122305">{</span><span class="ident" id="8122306"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441171">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="8122330">}</span><span class="op" id="8122331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122335"><a href="/gostd/crypto/tls/common.go.html#4452970">InsecureSkipVerify</a></span><span class="op" id="8122353">:</span>&nbsp;<span class="builtintype" id="8122355">true</span><span class="op" id="8122359">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122363"><a href="/gostd/crypto/tls/common.go.html#4454124">ClientSessionCache</a></span><span class="op" id="8122381">:</span>&nbsp;<span class="ident" id="8122383"><a href="/gostd/crypto/tls/common.go.html#4459426">NewLRUClientSessionCache</a></span><span class="op" id="8122407">(</span><span class="num" id="8122408">32</span><span class="op" id="8122410">)</span><span class="op" id="8122411">,</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8122414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122418">testResumeState</span>&nbsp;<span class="op" id="8122434">:=</span>&nbsp;<span class="keyword" id="8122437">func</span><span class="op" id="8122441">(</span><span class="ident" id="8122442">test</span>&nbsp;<span class="builtintype" id="8122447">string</span><span class="op" id="8122453">,</span>&nbsp;<span class="ident" id="8122455">didResume</span>&nbsp;<span class="builtintype" id="8122465">bool</span><span class="op" id="8122469">)</span>&nbsp;<span class="op" id="8122471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122475">hs</span><span class="op" id="8122477">,</span>&nbsp;<span class="ident" id="8122479">err</span>&nbsp;<span class="op" id="8122483">:=</span>&nbsp;<span class="ident" id="8122486"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137047">testHandshake</a></span><span class="op" id="8122499">(</span><span class="ident" id="8122500"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122250">clientConfig</a></span><span class="op" id="8122512">,</span>&nbsp;<span class="ident" id="8122514"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122096">serverConfig</a></span><span class="op" id="8122526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8122530">if</span>&nbsp;<span class="ident" id="8122533"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122479">err</a></span>&nbsp;<span class="op" id="8122537">!=</span>&nbsp;<span class="builtintype" id="8122540">nil</span>&nbsp;<span class="op" id="8122544">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122549"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122079">t</a></span><span class="op" id="8122550">.</span><span class="ident" id="8122551"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8122557">(</span><span class="string" id="8122558">&#34;%s:&nbsp;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8122584">,</span>&nbsp;<span class="ident" id="8122586"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122442">test</a></span><span class="op" id="8122590">,</span>&nbsp;<span class="ident" id="8122592"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122479">err</a></span><span class="op" id="8122595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8122599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8122603">if</span>&nbsp;<span class="ident" id="8122606"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122475">hs</a></span><span class="op" id="8122608">.</span><span class="ident" id="8122609"><a href="/gostd/crypto/tls/common.go.html#4446707">DidResume</a></span>&nbsp;<span class="op" id="8122619">!=</span>&nbsp;<span class="ident" id="8122622"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122455">didResume</a></span>&nbsp;<span class="op" id="8122632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122637"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122079">t</a></span><span class="op" id="8122638">.</span><span class="ident" id="8122639"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8122645">(</span><span class="string" id="8122646">&#34;%s&nbsp;resumed:&nbsp;%v,&nbsp;expected:&nbsp;%v&#34;</span><span class="op" id="8122676">,</span>&nbsp;<span class="ident" id="8122678"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122442">test</a></span><span class="op" id="8122682">,</span>&nbsp;<span class="ident" id="8122684"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122475">hs</a></span><span class="op" id="8122686">.</span><span class="ident" id="8122687"><a href="/gostd/crypto/tls/common.go.html#4446707">DidResume</a></span><span class="op" id="8122696">,</span>&nbsp;<span class="ident" id="8122698"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122455">didResume</a></span><span class="op" id="8122707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8122711">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8122714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122718"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122418">testResumeState</a></span><span class="op" id="8122733">(</span><span class="string" id="8122734">&#34;Handshake&#34;</span><span class="op" id="8122745">,</span>&nbsp;<span class="builtintype" id="8122747">false</span><span class="op" id="8122752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122755"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122418">testResumeState</a></span><span class="op" id="8122770">(</span><span class="string" id="8122771">&#34;Resume&#34;</span><span class="op" id="8122779">,</span>&nbsp;<span class="builtintype" id="8122781">true</span><span class="op" id="8122785">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8122789">if</span>&nbsp;<span class="ident" id="8122792">_</span><span class="op" id="8122793">,</span>&nbsp;<span class="ident" id="8122795">err</span>&nbsp;<span class="op" id="8122799">:=</span>&nbsp;<span class="ident" id="8122802"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112438">io</a></span><span class="op" id="8122804">.</span><span class="ident" id="8122805"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="8122813">(</span><span class="ident" id="8122814"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122096">serverConfig</a></span><span class="op" id="8122826">.</span><span class="ident" id="8122827"><a href="/gostd/crypto/tls/common.go.html#4455096">rand</a></span><span class="op" id="8122831">(</span><span class="op" id="8122832">)</span><span class="op" id="8122833">,</span>&nbsp;<span class="ident" id="8122835"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122096">serverConfig</a></span><span class="op" id="8122847">.</span><span class="ident" id="8122848"><a href="/gostd/crypto/tls/common.go.html#4454006">SessionTicketKey</a></span><span class="op" id="8122864">[</span><span class="op" id="8122865">:</span><span class="op" id="8122866">]</span><span class="op" id="8122867">)</span><span class="op" id="8122868">;</span>&nbsp;<span class="ident" id="8122870"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122795">err</a></span>&nbsp;<span class="op" id="8122874">!=</span>&nbsp;<span class="builtintype" id="8122877">nil</span>&nbsp;<span class="op" id="8122881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122885"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122079">t</a></span><span class="op" id="8122886">.</span><span class="ident" id="8122887"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8122893">(</span><span class="string" id="8122894">&#34;Failed&nbsp;to&nbsp;invalidate&nbsp;SessionTicketKey&#34;</span><span class="op" id="8122933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8122936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122939"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122418">testResumeState</a></span><span class="op" id="8122954">(</span><span class="string" id="8122955">&#34;InvalidSessionTicketKey&#34;</span><span class="op" id="8122980">,</span>&nbsp;<span class="builtintype" id="8122982">false</span><span class="op" id="8122987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8122990"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122418">testResumeState</a></span><span class="op" id="8123005">(</span><span class="string" id="8123006">&#34;ResumeAfterInvalidSessionTicketKey&#34;</span><span class="op" id="8123042">,</span>&nbsp;<span class="builtintype" id="8123044">true</span><span class="op" id="8123048">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123052"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122250">clientConfig</a></span><span class="op" id="8123064">.</span><span class="ident" id="8123065"><a href="/gostd/crypto/tls/common.go.html#4453138">CipherSuites</a></span>&nbsp;<span class="op" id="8123078">=</span>&nbsp;<span class="op" id="8123080">[</span><span class="op" id="8123081">]</span><span class="builtintype" id="8123082">uint16</span><span class="op" id="8123088">{</span><span class="ident" id="8123089"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441570">TLS_ECDHE_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="8123119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123122"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122418">testResumeState</a></span><span class="op" id="8123137">(</span><span class="string" id="8123138">&#34;DifferentCipherSuite&#34;</span><span class="op" id="8123160">,</span>&nbsp;<span class="builtintype" id="8123162">false</span><span class="op" id="8123167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123170"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122418">testResumeState</a></span><span class="op" id="8123185">(</span><span class="string" id="8123186">&#34;DifferentCipherSuiteRecovers&#34;</span><span class="op" id="8123216">,</span>&nbsp;<span class="builtintype" id="8123218">true</span><span class="op" id="8123222">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123226"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122250">clientConfig</a></span><span class="op" id="8123238">.</span><span class="ident" id="8123239"><a href="/gostd/crypto/tls/common.go.html#4454124">ClientSessionCache</a></span>&nbsp;<span class="op" id="8123258">=</span>&nbsp;<span class="builtintype" id="8123260">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123265"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8122418">testResumeState</a></span><span class="op" id="8123280">(</span><span class="string" id="8123281">&#34;WithoutSessionCache&#34;</span><span class="op" id="8123302">,</span>&nbsp;<span class="builtintype" id="8123304">false</span><span class="op" id="8123309">)</span><br>
<span class="lineno"></span><span class="op" id="8123311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8123314">func</span>&nbsp;<span class="ident" id="8123319">TestLRUClientSessionCache</span><span class="op" id="8123344">(</span><span class="ident" id="8123345">t</span>&nbsp;<span class="op" id="8123347">*</span><span class="ident" id="8123348"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112496">testing</a></span><span class="op" id="8123355">.</span><span class="ident" id="8123356"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8123357">)</span>&nbsp;<span class="op" id="8123359">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8123362">//&nbsp;Initialize&nbsp;cache&nbsp;of&nbsp;capacity&nbsp;4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123398">cache</span>&nbsp;<span class="op" id="8123404">:=</span>&nbsp;<span class="ident" id="8123407"><a href="/gostd/crypto/tls/common.go.html#4459426">NewLRUClientSessionCache</a></span><span class="op" id="8123431">(</span><span class="num" id="8123432">4</span><span class="op" id="8123433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123436">cs</span>&nbsp;<span class="op" id="8123439">:=</span>&nbsp;<span class="builtinfunc" id="8123442">make</span><span class="op" id="8123446">(</span><span class="op" id="8123447">[</span><span class="op" id="8123448">]</span><span class="ident" id="8123449"><a href="/gostd/crypto/tls/common.go.html#4448159">ClientSessionState</a></span><span class="op" id="8123467">,</span>&nbsp;<span class="num" id="8123469">6</span><span class="op" id="8123470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123473">keys</span>&nbsp;<span class="op" id="8123478">:=</span>&nbsp;<span class="op" id="8123481">[</span><span class="op" id="8123482">]</span><span class="builtintype" id="8123483">string</span><span class="op" id="8123489">{</span><span class="string" id="8123490">&#34;0&#34;</span><span class="op" id="8123493">,</span>&nbsp;<span class="string" id="8123495">&#34;1&#34;</span><span class="op" id="8123498">,</span>&nbsp;<span class="string" id="8123500">&#34;2&#34;</span><span class="op" id="8123503">,</span>&nbsp;<span class="string" id="8123505">&#34;3&#34;</span><span class="op" id="8123508">,</span>&nbsp;<span class="string" id="8123510">&#34;4&#34;</span><span class="op" id="8123513">,</span>&nbsp;<span class="string" id="8123515">&#34;5&#34;</span><span class="op" id="8123518">,</span>&nbsp;<span class="string" id="8123520">&#34;6&#34;</span><span class="op" id="8123523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8123527">//&nbsp;Add&nbsp;4&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache&nbsp;and&nbsp;look&nbsp;them&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123576">for</span>&nbsp;<span class="ident" id="8123580">i</span>&nbsp;<span class="op" id="8123582">:=</span>&nbsp;<span class="num" id="8123585">0</span><span class="op" id="8123586">;</span>&nbsp;<span class="ident" id="8123588"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123580">i</a></span>&nbsp;<span class="op" id="8123590">&lt;</span>&nbsp;<span class="num" id="8123592">4</span><span class="op" id="8123593">;</span>&nbsp;<span class="ident" id="8123595"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123580">i</a></span><span class="op" id="8123596">++</span>&nbsp;<span class="op" id="8123599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123603"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123398">cache</a></span><span class="op" id="8123608">.</span><span class="ident" id="8123609"><a href="/gostd/crypto/tls/common.go.html#4449174">Put</a></span><span class="op" id="8123612">(</span><span class="ident" id="8123613"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123473">keys</a></span><span class="op" id="8123617">[</span><span class="ident" id="8123618"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123580">i</a></span><span class="op" id="8123619">]</span><span class="op" id="8123620">,</span>&nbsp;<span class="op" id="8123622">&amp;</span><span class="ident" id="8123623"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123436">cs</a></span><span class="op" id="8123625">[</span><span class="ident" id="8123626"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123580">i</a></span><span class="op" id="8123627">]</span><span class="op" id="8123628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8123631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123634">for</span>&nbsp;<span class="ident" id="8123638">i</span>&nbsp;<span class="op" id="8123640">:=</span>&nbsp;<span class="num" id="8123643">0</span><span class="op" id="8123644">;</span>&nbsp;<span class="ident" id="8123646"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123638">i</a></span>&nbsp;<span class="op" id="8123648">&lt;</span>&nbsp;<span class="num" id="8123650">4</span><span class="op" id="8123651">;</span>&nbsp;<span class="ident" id="8123653"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123638">i</a></span><span class="op" id="8123654">++</span>&nbsp;<span class="op" id="8123657">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123661">if</span>&nbsp;<span class="ident" id="8123664">s</span><span class="op" id="8123665">,</span>&nbsp;<span class="ident" id="8123667">ok</span>&nbsp;<span class="op" id="8123670">:=</span>&nbsp;<span class="ident" id="8123673"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123398">cache</a></span><span class="op" id="8123678">.</span><span class="ident" id="8123679"><a href="/gostd/crypto/tls/common.go.html#4449041">Get</a></span><span class="op" id="8123682">(</span><span class="ident" id="8123683"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123473">keys</a></span><span class="op" id="8123687">[</span><span class="ident" id="8123688"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123638">i</a></span><span class="op" id="8123689">]</span><span class="op" id="8123690">)</span><span class="op" id="8123691">;</span>&nbsp;<span class="op" id="8123693">!</span><span class="ident" id="8123694"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123667">ok</a></span>&nbsp;<span class="op" id="8123697">||</span>&nbsp;<span class="ident" id="8123700"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123664">s</a></span>&nbsp;<span class="op" id="8123702">!=</span>&nbsp;<span class="op" id="8123705">&amp;</span><span class="ident" id="8123706"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123436">cs</a></span><span class="op" id="8123708">[</span><span class="ident" id="8123709"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123638">i</a></span><span class="op" id="8123710">]</span>&nbsp;<span class="op" id="8123712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123717"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123345">t</a></span><span class="op" id="8123718">.</span><span class="ident" id="8123719"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8123725">(</span><span class="string" id="8123726">&#34;session&nbsp;cache&nbsp;failed&nbsp;lookup&nbsp;for&nbsp;added&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="8123773">,</span>&nbsp;<span class="ident" id="8123775"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123473">keys</a></span><span class="op" id="8123779">[</span><span class="ident" id="8123780"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123638">i</a></span><span class="op" id="8123781">]</span><span class="op" id="8123782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8123786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8123789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8123793">//&nbsp;Add&nbsp;2&nbsp;more&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache.&nbsp;First&nbsp;2&nbsp;should&nbsp;be&nbsp;evicted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123857">for</span>&nbsp;<span class="ident" id="8123861">i</span>&nbsp;<span class="op" id="8123863">:=</span>&nbsp;<span class="num" id="8123866">4</span><span class="op" id="8123867">;</span>&nbsp;<span class="ident" id="8123869"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123861">i</a></span>&nbsp;<span class="op" id="8123871">&lt;</span>&nbsp;<span class="num" id="8123873">6</span><span class="op" id="8123874">;</span>&nbsp;<span class="ident" id="8123876"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123861">i</a></span><span class="op" id="8123877">++</span>&nbsp;<span class="op" id="8123880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123884"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123398">cache</a></span><span class="op" id="8123889">.</span><span class="ident" id="8123890"><a href="/gostd/crypto/tls/common.go.html#4449174">Put</a></span><span class="op" id="8123893">(</span><span class="ident" id="8123894"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123473">keys</a></span><span class="op" id="8123898">[</span><span class="ident" id="8123899"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123861">i</a></span><span class="op" id="8123900">]</span><span class="op" id="8123901">,</span>&nbsp;<span class="op" id="8123903">&amp;</span><span class="ident" id="8123904"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123436">cs</a></span><span class="op" id="8123906">[</span><span class="ident" id="8123907"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123861">i</a></span><span class="op" id="8123908">]</span><span class="op" id="8123909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8123912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123915">for</span>&nbsp;<span class="ident" id="8123919">i</span>&nbsp;<span class="op" id="8123921">:=</span>&nbsp;<span class="num" id="8123924">0</span><span class="op" id="8123925">;</span>&nbsp;<span class="ident" id="8123927"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123919">i</a></span>&nbsp;<span class="op" id="8123929">&lt;</span>&nbsp;<span class="num" id="8123931">2</span><span class="op" id="8123932">;</span>&nbsp;<span class="ident" id="8123934"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123919">i</a></span><span class="op" id="8123935">++</span>&nbsp;<span class="op" id="8123938">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8123942">if</span>&nbsp;<span class="ident" id="8123945">s</span><span class="op" id="8123946">,</span>&nbsp;<span class="ident" id="8123948">ok</span>&nbsp;<span class="op" id="8123951">:=</span>&nbsp;<span class="ident" id="8123954"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123398">cache</a></span><span class="op" id="8123959">.</span><span class="ident" id="8123960"><a href="/gostd/crypto/tls/common.go.html#4449041">Get</a></span><span class="op" id="8123963">(</span><span class="ident" id="8123964"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123473">keys</a></span><span class="op" id="8123968">[</span><span class="ident" id="8123969"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123919">i</a></span><span class="op" id="8123970">]</span><span class="op" id="8123971">)</span><span class="op" id="8123972">;</span>&nbsp;<span class="ident" id="8123974"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123948">ok</a></span>&nbsp;<span class="op" id="8123977">||</span>&nbsp;<span class="ident" id="8123980"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123945">s</a></span>&nbsp;<span class="op" id="8123982">!=</span>&nbsp;<span class="builtintype" id="8123985">nil</span>&nbsp;<span class="op" id="8123989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8123994"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123345">t</a></span><span class="op" id="8123995">.</span><span class="ident" id="8123996"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8124002">(</span><span class="string" id="8124003">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="8124046">,</span>&nbsp;<span class="ident" id="8124048"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123473">keys</a></span><span class="op" id="8124052">[</span><span class="ident" id="8124053"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123919">i</a></span><span class="op" id="8124054">]</span><span class="op" id="8124055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8124059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8124062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8124066">//&nbsp;Touch&nbsp;entry&nbsp;2.&nbsp;LRU&nbsp;should&nbsp;evict&nbsp;3&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124110"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123398">cache</a></span><span class="op" id="8124115">.</span><span class="ident" id="8124116"><a href="/gostd/crypto/tls/common.go.html#4449041">Get</a></span><span class="op" id="8124119">(</span><span class="ident" id="8124120"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123473">keys</a></span><span class="op" id="8124124">[</span><span class="num" id="8124125">2</span><span class="op" id="8124126">]</span><span class="op" id="8124127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124130"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123398">cache</a></span><span class="op" id="8124135">.</span><span class="ident" id="8124136"><a href="/gostd/crypto/tls/common.go.html#4449174">Put</a></span><span class="op" id="8124139">(</span><span class="ident" id="8124140"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123473">keys</a></span><span class="op" id="8124144">[</span><span class="num" id="8124145">0</span><span class="op" id="8124146">]</span><span class="op" id="8124147">,</span>&nbsp;<span class="op" id="8124149">&amp;</span><span class="ident" id="8124150"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123436">cs</a></span><span class="op" id="8124152">[</span><span class="num" id="8124153">0</span><span class="op" id="8124154">]</span><span class="op" id="8124155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124158">if</span>&nbsp;<span class="ident" id="8124161">s</span><span class="op" id="8124162">,</span>&nbsp;<span class="ident" id="8124164">ok</span>&nbsp;<span class="op" id="8124167">:=</span>&nbsp;<span class="ident" id="8124170"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123398">cache</a></span><span class="op" id="8124175">.</span><span class="ident" id="8124176"><a href="/gostd/crypto/tls/common.go.html#4449041">Get</a></span><span class="op" id="8124179">(</span><span class="ident" id="8124180"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123473">keys</a></span><span class="op" id="8124184">[</span><span class="num" id="8124185">3</span><span class="op" id="8124186">]</span><span class="op" id="8124187">)</span><span class="op" id="8124188">;</span>&nbsp;<span class="ident" id="8124190"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8124164">ok</a></span>&nbsp;<span class="op" id="8124193">||</span>&nbsp;<span class="ident" id="8124196"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8124161">s</a></span>&nbsp;<span class="op" id="8124198">!=</span>&nbsp;<span class="builtintype" id="8124201">nil</span>&nbsp;<span class="op" id="8124205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124209"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123345">t</a></span><span class="op" id="8124210">.</span><span class="ident" id="8124211"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8124217">(</span><span class="string" id="8124218">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key&nbsp;3&#34;</span><span class="op" id="8124259">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8124262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8124266">//&nbsp;Update&nbsp;entry&nbsp;0&nbsp;in&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124295"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123398">cache</a></span><span class="op" id="8124300">.</span><span class="ident" id="8124301"><a href="/gostd/crypto/tls/common.go.html#4449174">Put</a></span><span class="op" id="8124304">(</span><span class="ident" id="8124305"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123473">keys</a></span><span class="op" id="8124309">[</span><span class="num" id="8124310">0</span><span class="op" id="8124311">]</span><span class="op" id="8124312">,</span>&nbsp;<span class="op" id="8124314">&amp;</span><span class="ident" id="8124315"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123436">cs</a></span><span class="op" id="8124317">[</span><span class="num" id="8124318">3</span><span class="op" id="8124319">]</span><span class="op" id="8124320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124323">if</span>&nbsp;<span class="ident" id="8124326">s</span><span class="op" id="8124327">,</span>&nbsp;<span class="ident" id="8124329">ok</span>&nbsp;<span class="op" id="8124332">:=</span>&nbsp;<span class="ident" id="8124335"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123398">cache</a></span><span class="op" id="8124340">.</span><span class="ident" id="8124341"><a href="/gostd/crypto/tls/common.go.html#4449041">Get</a></span><span class="op" id="8124344">(</span><span class="ident" id="8124345"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123473">keys</a></span><span class="op" id="8124349">[</span><span class="num" id="8124350">0</span><span class="op" id="8124351">]</span><span class="op" id="8124352">)</span><span class="op" id="8124353">;</span>&nbsp;<span class="op" id="8124355">!</span><span class="ident" id="8124356"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8124329">ok</a></span>&nbsp;<span class="op" id="8124359">||</span>&nbsp;<span class="ident" id="8124362"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8124326">s</a></span>&nbsp;<span class="op" id="8124364">!=</span>&nbsp;<span class="op" id="8124367">&amp;</span><span class="ident" id="8124368"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123436">cs</a></span><span class="op" id="8124370">[</span><span class="num" id="8124371">3</span><span class="op" id="8124372">]</span>&nbsp;<span class="op" id="8124374">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124378"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123345">t</a></span><span class="op" id="8124379">.</span><span class="ident" id="8124380"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8124386">(</span><span class="string" id="8124387">&#34;session&nbsp;cache&nbsp;failed&nbsp;update&nbsp;for&nbsp;key&nbsp;0&#34;</span><span class="op" id="8124426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8124429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8124433">//&nbsp;Adding&nbsp;a&nbsp;nil&nbsp;entry&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124466"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123398">cache</a></span><span class="op" id="8124471">.</span><span class="ident" id="8124472"><a href="/gostd/crypto/tls/common.go.html#4449174">Put</a></span><span class="op" id="8124475">(</span><span class="ident" id="8124476"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123473">keys</a></span><span class="op" id="8124480">[</span><span class="num" id="8124481">0</span><span class="op" id="8124482">]</span><span class="op" id="8124483">,</span>&nbsp;<span class="builtintype" id="8124485">nil</span><span class="op" id="8124488">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8124491">if</span>&nbsp;<span class="ident" id="8124494">s</span><span class="op" id="8124495">,</span>&nbsp;<span class="ident" id="8124497">ok</span>&nbsp;<span class="op" id="8124500">:=</span>&nbsp;<span class="ident" id="8124503"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123398">cache</a></span><span class="op" id="8124508">.</span><span class="ident" id="8124509"><a href="/gostd/crypto/tls/common.go.html#4449041">Get</a></span><span class="op" id="8124512">(</span><span class="ident" id="8124513"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123473">keys</a></span><span class="op" id="8124517">[</span><span class="num" id="8124518">0</span><span class="op" id="8124519">]</span><span class="op" id="8124520">)</span><span class="op" id="8124521">;</span>&nbsp;<span class="op" id="8124523">!</span><span class="ident" id="8124524"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8124497">ok</a></span>&nbsp;<span class="op" id="8124527">||</span>&nbsp;<span class="ident" id="8124530"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8124494">s</a></span>&nbsp;<span class="op" id="8124532">!=</span>&nbsp;<span class="builtintype" id="8124535">nil</span>&nbsp;<span class="op" id="8124539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124543"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8123345">t</a></span><span class="op" id="8124544">.</span><span class="ident" id="8124545"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8124551">(</span><span class="string" id="8124552">&#34;failed&nbsp;to&nbsp;add&nbsp;nil&nbsp;entry&nbsp;to&nbsp;cache&#34;</span><span class="op" id="8124586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8124589">}</span><br>
<span class="lineno"></span><span class="op" id="8124591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="8124594">func</span>&nbsp;<span class="ident" id="8124599">TestHandshakeClientALPNMatch</span><span class="op" id="8124627">(</span><span class="ident" id="8124628">t</span>&nbsp;<span class="op" id="8124630">*</span><span class="ident" id="8124631"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112496">testing</a></span><span class="op" id="8124638">.</span><span class="ident" id="8124639"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8124640">)</span>&nbsp;<span class="op" id="8124642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124645">config</span>&nbsp;<span class="op" id="8124652">:=</span>&nbsp;<span class="op" id="8124655">*</span><span class="ident" id="8124656"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124668"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8124645">config</a></span><span class="op" id="8124674">.</span><span class="ident" id="8124675"><a href="/gostd/crypto/tls/common.go.html#4452064">NextProtos</a></span>&nbsp;<span class="op" id="8124686">=</span>&nbsp;<span class="op" id="8124688">[</span><span class="op" id="8124689">]</span><span class="builtintype" id="8124690">string</span><span class="op" id="8124696">{</span><span class="string" id="8124697">&#34;proto2&#34;</span><span class="op" id="8124705">,</span>&nbsp;<span class="string" id="8124707">&#34;proto1&#34;</span><span class="op" id="8124715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124719">test</span>&nbsp;<span class="op" id="8124724">:=</span>&nbsp;<span class="op" id="8124727">&amp;</span><span class="ident" id="8124728"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8124738">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124742"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span><span class="op" id="8124746">:</span>&nbsp;<span class="string" id="8124748">&#34;ALPN&#34;</span><span class="op" id="8124754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8124758">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8124824">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124867"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span><span class="op" id="8124874">:</span>&nbsp;<span class="op" id="8124876">[</span><span class="op" id="8124877">]</span><span class="builtintype" id="8124878">string</span><span class="op" id="8124884">{</span><span class="string" id="8124885">&#34;openssl&#34;</span><span class="op" id="8124894">,</span>&nbsp;<span class="string" id="8124896">&#34;s_server&#34;</span><span class="op" id="8124906">,</span>&nbsp;<span class="string" id="8124908">&#34;-alpn&#34;</span><span class="op" id="8124915">,</span>&nbsp;<span class="string" id="8124917">&#34;proto1,proto2&#34;</span><span class="op" id="8124932">}</span><span class="op" id="8124933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124937"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113252">config</a></span><span class="op" id="8124943">:</span>&nbsp;&nbsp;<span class="op" id="8124946">&amp;</span><span class="ident" id="8124947"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8124645">config</a></span><span class="op" id="8124953">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8124957"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113707">validate</a></span><span class="op" id="8124965">:</span>&nbsp;<span class="keyword" id="8124967">func</span><span class="op" id="8124971">(</span><span class="ident" id="8124972">state</span>&nbsp;<span class="ident" id="8124978"><a href="/gostd/crypto/tls/common.go.html#4446494">ConnectionState</a></span><span class="op" id="8124993">)</span>&nbsp;<span class="builtintype" id="8124995">error</span>&nbsp;<span class="op" id="8125001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8125006">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125065">if</span>&nbsp;<span class="ident" id="8125068"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8124972">state</a></span><span class="op" id="8125073">.</span><span class="ident" id="8125074"><a href="/gostd/crypto/tls/common.go.html#4446910">NegotiatedProtocol</a></span>&nbsp;<span class="op" id="8125093">!=</span>&nbsp;<span class="string" id="8125096">&#34;proto1&#34;</span>&nbsp;<span class="op" id="8125105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125111">return</span>&nbsp;<span class="ident" id="8125118"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112431">fmt</a></span><span class="op" id="8125121">.</span><span class="ident" id="8125122"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="8125128">(</span><span class="string" id="8125129">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="8125161">,</span>&nbsp;<span class="ident" id="8125163"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8124972">state</a></span><span class="op" id="8125168">.</span><span class="ident" id="8125169"><a href="/gostd/crypto/tls/common.go.html#4446910">NegotiatedProtocol</a></span><span class="op" id="8125187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8125192">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125197">return</span>&nbsp;<span class="builtintype" id="8125204">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8125210">}</span><span class="op" id="8125211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8125214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125217"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119319">runClientTestTLS12</a></span><span class="op" id="8125235">(</span><span class="ident" id="8125236"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8124628">t</a></span><span class="op" id="8125237">,</span>&nbsp;<span class="ident" id="8125239"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8124719">test</a></span><span class="op" id="8125243">)</span><br>
<span class="lineno"></span><span class="op" id="8125245">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="8125248">func</span>&nbsp;<span class="ident" id="8125253">TestHandshakeClientALPNNoMatch</span><span class="op" id="8125283">(</span><span class="ident" id="8125284">t</span>&nbsp;<span class="op" id="8125286">*</span><span class="ident" id="8125287"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112496">testing</a></span><span class="op" id="8125294">.</span><span class="ident" id="8125295"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8125296">)</span>&nbsp;<span class="op" id="8125298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125301">config</span>&nbsp;<span class="op" id="8125308">:=</span>&nbsp;<span class="op" id="8125311">*</span><span class="ident" id="8125312"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125324"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8125301">config</a></span><span class="op" id="8125330">.</span><span class="ident" id="8125331"><a href="/gostd/crypto/tls/common.go.html#4452064">NextProtos</a></span>&nbsp;<span class="op" id="8125342">=</span>&nbsp;<span class="op" id="8125344">[</span><span class="op" id="8125345">]</span><span class="builtintype" id="8125346">string</span><span class="op" id="8125352">{</span><span class="string" id="8125353">&#34;proto3&#34;</span><span class="op" id="8125361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125365">test</span>&nbsp;<span class="op" id="8125370">:=</span>&nbsp;<span class="op" id="8125373">&amp;</span><span class="ident" id="8125374"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112904">clientTest</a></span><span class="op" id="8125384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125388"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113039">name</a></span><span class="op" id="8125392">:</span>&nbsp;<span class="string" id="8125394">&#34;ALPN-NoMatch&#34;</span><span class="op" id="8125408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8125412">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8125478">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125521"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113163">command</a></span><span class="op" id="8125528">:</span>&nbsp;<span class="op" id="8125530">[</span><span class="op" id="8125531">]</span><span class="builtintype" id="8125532">string</span><span class="op" id="8125538">{</span><span class="string" id="8125539">&#34;openssl&#34;</span><span class="op" id="8125548">,</span>&nbsp;<span class="string" id="8125550">&#34;s_server&#34;</span><span class="op" id="8125560">,</span>&nbsp;<span class="string" id="8125562">&#34;-alpn&#34;</span><span class="op" id="8125569">,</span>&nbsp;<span class="string" id="8125571">&#34;proto1,proto2&#34;</span><span class="op" id="8125586">}</span><span class="op" id="8125587">,</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125591"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113252">config</a></span><span class="op" id="8125597">:</span>&nbsp;&nbsp;<span class="op" id="8125600">&amp;</span><span class="ident" id="8125601"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8125301">config</a></span><span class="op" id="8125607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125611"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8113707">validate</a></span><span class="op" id="8125619">:</span>&nbsp;<span class="keyword" id="8125621">func</span><span class="op" id="8125625">(</span><span class="ident" id="8125626">state</span>&nbsp;<span class="ident" id="8125632"><a href="/gostd/crypto/tls/common.go.html#4446494">ConnectionState</a></span><span class="op" id="8125647">)</span>&nbsp;<span class="builtintype" id="8125649">error</span>&nbsp;<span class="op" id="8125655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8125660">//&nbsp;There&#39;s&nbsp;no&nbsp;overlap&nbsp;so&nbsp;OpenSSL&nbsp;will&nbsp;not&nbsp;select&nbsp;a&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125724">if</span>&nbsp;<span class="ident" id="8125727"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8125626">state</a></span><span class="op" id="8125732">.</span><span class="ident" id="8125733"><a href="/gostd/crypto/tls/common.go.html#4446910">NegotiatedProtocol</a></span>&nbsp;<span class="op" id="8125752">!=</span>&nbsp;<span class="string" id="8125755">&#34;&#34;</span>&nbsp;<span class="op" id="8125758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125764">return</span>&nbsp;<span class="ident" id="8125771"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8112431">fmt</a></span><span class="op" id="8125774">.</span><span class="ident" id="8125775"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="8125781">(</span><span class="string" id="8125782">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="8125810">,</span>&nbsp;<span class="ident" id="8125812"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8125626">state</a></span><span class="op" id="8125817">.</span><span class="ident" id="8125818"><a href="/gostd/crypto/tls/common.go.html#4446910">NegotiatedProtocol</a></span><span class="op" id="8125836">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8125841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8125846">return</span>&nbsp;<span class="builtintype" id="8125853">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8125859">}</span><span class="op" id="8125860">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8125863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8125866"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8119319">runClientTestTLS12</a></span><span class="op" id="8125884">(</span><span class="ident" id="8125885"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8125284">t</a></span><span class="op" id="8125886">,</span>&nbsp;<span class="ident" id="8125888"><a href="/gostd/crypto/tls/handshake_client_test.go.html#8125365">test</a></span><span class="op" id="8125892">)</span><br>
<span class="lineno">490</span><span class="op" id="8125894">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
