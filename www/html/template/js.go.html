<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4442801">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4442856">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4442910">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4442961">package</span>&nbsp;<span class="ident" id="4442969">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4442979">import</span>&nbsp;<span class="op" id="4442986">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4442989">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4442998">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4443015">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4443022">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4443033">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4443044">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4443059">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4443062">//&nbsp;nextJSCtx&nbsp;returns&nbsp;the&nbsp;context&nbsp;that&nbsp;determines&nbsp;whether&nbsp;a&nbsp;slash&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4443137">//&nbsp;given&nbsp;run&nbsp;of&nbsp;tokens&nbsp;starts&nbsp;a&nbsp;regular&nbsp;expression&nbsp;instead&nbsp;of&nbsp;a&nbsp;division</span><br>
<span class="lineno"></span><span class="comment" id="4443210">//&nbsp;operator:&nbsp;/&nbsp;or&nbsp;/=.</span><br>
<span class="lineno"></span><span class="comment" id="4443232">//</span><br>
<span class="lineno">20</span><span class="comment" id="4443235">//&nbsp;This&nbsp;assumes&nbsp;that&nbsp;the&nbsp;token&nbsp;run&nbsp;does&nbsp;not&nbsp;include&nbsp;any&nbsp;string&nbsp;tokens,&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="4443314">//&nbsp;tokens,&nbsp;regular&nbsp;expression&nbsp;literal&nbsp;tokens,&nbsp;or&nbsp;division&nbsp;operators.</span><br>
<span class="lineno"></span><span class="comment" id="4443383">//</span><br>
<span class="lineno"></span><span class="comment" id="4443386">//&nbsp;This&nbsp;fails&nbsp;on&nbsp;some&nbsp;valid&nbsp;but&nbsp;nonsensical&nbsp;JavaScript&nbsp;programs&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="4443455">//&nbsp;&#34;x&nbsp;=&nbsp;++/foo/i&#34;&nbsp;which&nbsp;is&nbsp;quite&nbsp;different&nbsp;than&nbsp;&#34;x++/foo/i&#34;,&nbsp;but&nbsp;is&nbsp;not&nbsp;known&nbsp;to</span><br>
<span class="lineno">25</span><span class="comment" id="4443536">//&nbsp;fail&nbsp;on&nbsp;any&nbsp;known&nbsp;useful&nbsp;programs.&nbsp;It&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;draft</span><br>
<span class="lineno"></span><span class="comment" id="4443599">//&nbsp;JavaScript&nbsp;2.0&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;requires&nbsp;one&nbsp;token&nbsp;of&nbsp;lookbehind:</span><br>
<span class="lineno"></span><span class="comment" id="4443671">//&nbsp;http://www.mozilla.org/js/language/js20-2000-07/rationale/syntax.html</span><br>
<span class="lineno"></span><span class="keyword" id="4443744">func</span>&nbsp;<span class="ident" id="4443749">nextJSCtx</span><span class="op" id="4443758">(</span><span class="ident" id="4443759">s</span>&nbsp;<span class="op" id="4443761">[</span><span class="op" id="4443762">]</span><span class="builtintype" id="4443763">byte</span><span class="op" id="4443767">,</span>&nbsp;<span class="ident" id="4443769">preceding</span>&nbsp;<span class="ident" id="4443779">jsCtx</span><span class="op" id="4443784">)</span>&nbsp;<span class="ident" id="4443786">jsCtx</span>&nbsp;<span class="op" id="4443792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4443795">s</span>&nbsp;<span class="op" id="4443797">=</span>&nbsp;<span class="ident" id="4443799">bytes</span><span class="op" id="4443804">.</span><span class="ident" id="4443805">TrimRight</span><span class="op" id="4443814">(</span><span class="ident" id="4443815">s</span><span class="op" id="4443816">,</span>&nbsp;<span class="string" id="4443818">&#34;\t\n\f\r&nbsp;\u2028\u2029&#34;</span><span class="op" id="4443841">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443844">if</span>&nbsp;<span class="builtinfunc" id="4443847">len</span><span class="op" id="4443850">(</span><span class="ident" id="4443851">s</span><span class="op" id="4443852">)</span>&nbsp;<span class="op" id="4443854">==</span>&nbsp;<span class="num" id="4443857">0</span>&nbsp;<span class="op" id="4443859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443863">return</span>&nbsp;<span class="ident" id="4443870">preceding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4443881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4443885">//&nbsp;All&nbsp;cases&nbsp;below&nbsp;are&nbsp;in&nbsp;the&nbsp;single-byte&nbsp;UTF-8&nbsp;group.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443941">switch</span>&nbsp;<span class="ident" id="4443948">c</span><span class="op" id="4443949">,</span>&nbsp;<span class="ident" id="4443951">n</span>&nbsp;<span class="op" id="4443953">:=</span>&nbsp;<span class="ident" id="4443956">s</span><span class="op" id="4443957">[</span><span class="builtinfunc" id="4443958">len</span><span class="op" id="4443961">(</span><span class="ident" id="4443962">s</span><span class="op" id="4443963">)</span><span class="op" id="4443964">-</span><span class="num" id="4443965">1</span><span class="op" id="4443966">]</span><span class="op" id="4443967">,</span>&nbsp;<span class="builtinfunc" id="4443969">len</span><span class="op" id="4443972">(</span><span class="ident" id="4443973">s</span><span class="op" id="4443974">)</span><span class="op" id="4443975">;</span>&nbsp;<span class="ident" id="4443977">c</span>&nbsp;<span class="op" id="4443979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4443982">case</span>&nbsp;<span class="string" id="4443987">&#39;+&#39;</span><span class="op" id="4443990">,</span>&nbsp;<span class="string" id="4443992">&#39;-&#39;</span><span class="op" id="4443995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4443999">//&nbsp;++&nbsp;and&nbsp;--&nbsp;are&nbsp;not&nbsp;regexp&nbsp;preceders,&nbsp;but&nbsp;+&nbsp;and&nbsp;-&nbsp;are&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444064">//&nbsp;they&nbsp;are&nbsp;used&nbsp;as&nbsp;infix&nbsp;or&nbsp;prefix&nbsp;operators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444113">start</span>&nbsp;<span class="op" id="4444119">:=</span>&nbsp;<span class="ident" id="4444122">n</span>&nbsp;<span class="op" id="4444124">-</span>&nbsp;<span class="num" id="4444126">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444130">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;adjacent&nbsp;dashes&nbsp;or&nbsp;pluses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444182">for</span>&nbsp;<span class="ident" id="4444186">start</span>&nbsp;<span class="op" id="4444192">&gt;</span>&nbsp;<span class="num" id="4444194">0</span>&nbsp;<span class="op" id="4444196">&amp;&amp;</span>&nbsp;<span class="ident" id="4444199">s</span><span class="op" id="4444200">[</span><span class="ident" id="4444201">start</span><span class="op" id="4444206">-</span><span class="num" id="4444207">1</span><span class="op" id="4444208">]</span>&nbsp;<span class="op" id="4444210">==</span>&nbsp;<span class="ident" id="4444213">c</span>&nbsp;<span class="op" id="4444215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4444220">start</span><span class="op" id="4444225">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4444230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444234">if</span>&nbsp;<span class="op" id="4444237">(</span><span class="ident" id="4444238">n</span><span class="op" id="4444239">-</span><span class="ident" id="4444240">start</span><span class="op" id="4444245">)</span><span class="op" id="4444246">&amp;</span><span class="num" id="4444247">1</span>&nbsp;<span class="op" id="4444249">==</span>&nbsp;<span class="num" id="4444252">1</span>&nbsp;<span class="op" id="4444254">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444259">//&nbsp;Reached&nbsp;for&nbsp;trailing&nbsp;minus&nbsp;signs&nbsp;since&nbsp;&#34;---&#34;&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444317">//&nbsp;same&nbsp;as&nbsp;&#34;--&nbsp;-&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444339">return</span>&nbsp;<span class="ident" id="4444346">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4444360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444364">return</span>&nbsp;<span class="ident" id="4444371">jsCtxDivOp</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444383">case</span>&nbsp;<span class="string" id="4444388">&#39;.&#39;</span><span class="op" id="4444391">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444395">//&nbsp;Handle&nbsp;&#34;42.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444413">if</span>&nbsp;<span class="ident" id="4444416">n</span>&nbsp;<span class="op" id="4444418">!=</span>&nbsp;<span class="num" id="4444421">1</span>&nbsp;<span class="op" id="4444423">&amp;&amp;</span>&nbsp;<span class="string" id="4444426">&#39;0&#39;</span>&nbsp;<span class="op" id="4444430">&lt;=</span>&nbsp;<span class="ident" id="4444433">s</span><span class="op" id="4444434">[</span><span class="ident" id="4444435">n</span><span class="op" id="4444436">-</span><span class="num" id="4444437">2</span><span class="op" id="4444438">]</span>&nbsp;<span class="op" id="4444440">&amp;&amp;</span>&nbsp;<span class="ident" id="4444443">s</span><span class="op" id="4444444">[</span><span class="ident" id="4444445">n</span><span class="op" id="4444446">-</span><span class="num" id="4444447">2</span><span class="op" id="4444448">]</span>&nbsp;<span class="op" id="4444450">&lt;=</span>&nbsp;<span class="string" id="4444453">&#39;9&#39;</span>&nbsp;<span class="op" id="4444457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444462">return</span>&nbsp;<span class="ident" id="4444469">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4444482">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444486">return</span>&nbsp;<span class="ident" id="4444493">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444506">//&nbsp;Suffixes&nbsp;for&nbsp;all&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444577">//&nbsp;that&nbsp;only&nbsp;end&nbsp;binary&nbsp;operators&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444631">case</span>&nbsp;<span class="string" id="4444636">&#39;,&#39;</span><span class="op" id="4444639">,</span>&nbsp;<span class="string" id="4444641">&#39;&lt;&#39;</span><span class="op" id="4444644">,</span>&nbsp;<span class="string" id="4444646">&#39;&gt;&#39;</span><span class="op" id="4444649">,</span>&nbsp;<span class="string" id="4444651">&#39;=&#39;</span><span class="op" id="4444654">,</span>&nbsp;<span class="string" id="4444656">&#39;*&#39;</span><span class="op" id="4444659">,</span>&nbsp;<span class="string" id="4444661">&#39;%&#39;</span><span class="op" id="4444664">,</span>&nbsp;<span class="string" id="4444666">&#39;&amp;&#39;</span><span class="op" id="4444669">,</span>&nbsp;<span class="string" id="4444671">&#39;|&#39;</span><span class="op" id="4444674">,</span>&nbsp;<span class="string" id="4444676">&#39;^&#39;</span><span class="op" id="4444679">,</span>&nbsp;<span class="string" id="4444681">&#39;?&#39;</span><span class="op" id="4444684">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444688">return</span>&nbsp;<span class="ident" id="4444695">jsCtxRegexp</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444708">//&nbsp;Suffixes&nbsp;for&nbsp;all&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444779">//&nbsp;that&nbsp;are&nbsp;prefix&nbsp;operators&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444828">case</span>&nbsp;<span class="string" id="4444833">&#39;!&#39;</span><span class="op" id="4444836">,</span>&nbsp;<span class="string" id="4444838">&#39;~&#39;</span><span class="op" id="4444841">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444845">return</span>&nbsp;<span class="ident" id="4444852">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444865">//&nbsp;Matches&nbsp;all&nbsp;the&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4444935">//&nbsp;that&nbsp;are&nbsp;open&nbsp;brackets&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444981">case</span>&nbsp;<span class="string" id="4444986">&#39;(&#39;</span><span class="op" id="4444989">,</span>&nbsp;<span class="string" id="4444991">&#39;[&#39;</span><span class="op" id="4444994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4444998">return</span>&nbsp;<span class="ident" id="4445005">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445018">//&nbsp;Matches&nbsp;all&nbsp;the&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445088">//&nbsp;that&nbsp;precede&nbsp;expression&nbsp;starts.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445124">case</span>&nbsp;<span class="string" id="4445129">&#39;:&#39;</span><span class="op" id="4445132">,</span>&nbsp;<span class="string" id="4445134">&#39;;&#39;</span><span class="op" id="4445137">,</span>&nbsp;<span class="string" id="4445139">&#39;{&#39;</span><span class="op" id="4445142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445146">return</span>&nbsp;<span class="ident" id="4445153">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445166">//&nbsp;CAVEAT:&nbsp;the&nbsp;close&nbsp;punctuators&nbsp;(&#39;}&#39;,&nbsp;&#39;]&#39;,&nbsp;&#39;)&#39;)&nbsp;precede&nbsp;div&nbsp;ops&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445236">//&nbsp;are&nbsp;handled&nbsp;in&nbsp;the&nbsp;default&nbsp;except&nbsp;for&nbsp;&#39;}&#39;&nbsp;which&nbsp;can&nbsp;precede&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445302">//&nbsp;division&nbsp;op&nbsp;as&nbsp;in</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445324">//&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;valueOf:&nbsp;function&nbsp;()&nbsp;{&nbsp;return&nbsp;42&nbsp;}&nbsp;}&nbsp;/&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445375">//&nbsp;which&nbsp;is&nbsp;valid,&nbsp;but,&nbsp;in&nbsp;practice,&nbsp;developers&nbsp;don&#39;t&nbsp;divide&nbsp;object</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445444">//&nbsp;literals,&nbsp;so&nbsp;our&nbsp;heuristic&nbsp;works&nbsp;well&nbsp;for&nbsp;code&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445500">//&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;()&nbsp;{&nbsp;...&nbsp;}&nbsp;&nbsp;/foo/.test(x)&nbsp;&amp;&amp;&nbsp;sideEffect();</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445559">//&nbsp;The&nbsp;&#39;)&#39;&nbsp;punctuator&nbsp;can&nbsp;precede&nbsp;a&nbsp;regular&nbsp;expression&nbsp;as&nbsp;in</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445621">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(b)&nbsp;/foo/.test(x)&nbsp;&amp;&amp;&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445657">//&nbsp;but&nbsp;this&nbsp;is&nbsp;much&nbsp;less&nbsp;likely&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445695">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(a&nbsp;+&nbsp;b)&nbsp;/&nbsp;c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445715">case</span>&nbsp;<span class="string" id="4445720">&#39;}&#39;</span><span class="op" id="4445723">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445727">return</span>&nbsp;<span class="ident" id="4445734">jsCtxRegexp</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445747">default</span><span class="op" id="4445754">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445758">//&nbsp;Look&nbsp;for&nbsp;an&nbsp;IdentifierName&nbsp;and&nbsp;see&nbsp;if&nbsp;it&nbsp;is&nbsp;a&nbsp;keyword&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445822">//&nbsp;can&nbsp;precede&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445861">j</span>&nbsp;<span class="op" id="4445863">:=</span>&nbsp;<span class="ident" id="4445866">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445870">for</span>&nbsp;<span class="ident" id="4445874">j</span>&nbsp;<span class="op" id="4445876">&gt;</span>&nbsp;<span class="num" id="4445878">0</span>&nbsp;<span class="op" id="4445880">&amp;&amp;</span>&nbsp;<span class="ident" id="4445883">isJSIdentPart</span><span class="op" id="4445896">(</span><span class="builtintype" id="4445897">rune</span><span class="op" id="4445901">(</span><span class="ident" id="4445902">s</span><span class="op" id="4445903">[</span><span class="ident" id="4445904">j</span><span class="op" id="4445905">-</span><span class="num" id="4445906">1</span><span class="op" id="4445907">]</span><span class="op" id="4445908">)</span><span class="op" id="4445909">)</span>&nbsp;<span class="op" id="4445911">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4445916">j</span><span class="op" id="4445917">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445926">if</span>&nbsp;<span class="ident" id="4445929">regexpPrecederKeywords</span><span class="op" id="4445951">[</span><span class="builtintype" id="4445952">string</span><span class="op" id="4445958">(</span><span class="ident" id="4445959">s</span><span class="op" id="4445960">[</span><span class="ident" id="4445961">j</span><span class="op" id="4445962">:</span><span class="op" id="4445963">]</span><span class="op" id="4445964">)</span><span class="op" id="4445965">]</span>&nbsp;<span class="op" id="4445967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4445972">return</span>&nbsp;<span class="ident" id="4445979">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445993">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4445996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4445999">//&nbsp;Otherwise&nbsp;is&nbsp;a&nbsp;punctuator&nbsp;not&nbsp;listed&nbsp;above,&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4446050">//&nbsp;a&nbsp;string&nbsp;which&nbsp;precedes&nbsp;a&nbsp;div&nbsp;op,&nbsp;or&nbsp;an&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4446105">//&nbsp;which&nbsp;precedes&nbsp;a&nbsp;div&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446134">return</span>&nbsp;<span class="ident" id="4446141">jsCtxDivOp</span><br>
<span class="lineno">100</span><span class="op" id="4446152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4446155">//&nbsp;regexpPrecederKeywords&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;reserved&nbsp;JS&nbsp;keywords&nbsp;that&nbsp;can&nbsp;precede&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4446233">//&nbsp;regular&nbsp;expression&nbsp;in&nbsp;JS&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4446269">var</span>&nbsp;<span class="ident" id="4446273">regexpPrecederKeywords</span>&nbsp;<span class="op" id="4446296">=</span>&nbsp;<span class="keyword" id="4446298">map</span><span class="op" id="4446301">[</span><span class="builtintype" id="4446302">string</span><span class="op" id="4446308">]</span><span class="builtintype" id="4446309">bool</span><span class="op" id="4446313">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4446316">&#34;break&#34;</span><span class="op" id="4446323">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446330">true</span><span class="op" id="4446334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4446337">&#34;case&#34;</span><span class="op" id="4446343">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446351">true</span><span class="op" id="4446355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4446358">&#34;continue&#34;</span><span class="op" id="4446368">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4446372">true</span><span class="op" id="4446376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4446379">&#34;delete&#34;</span><span class="op" id="4446387">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446393">true</span><span class="op" id="4446397">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4446400">&#34;do&#34;</span><span class="op" id="4446404">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446414">true</span><span class="op" id="4446418">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4446421">&#34;else&#34;</span><span class="op" id="4446427">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446435">true</span><span class="op" id="4446439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4446442">&#34;finally&#34;</span><span class="op" id="4446451">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446456">true</span><span class="op" id="4446460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4446463">&#34;in&#34;</span><span class="op" id="4446467">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446477">true</span><span class="op" id="4446481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4446484">&#34;instanceof&#34;</span><span class="op" id="4446496">:</span>&nbsp;<span class="ident" id="4446498">true</span><span class="op" id="4446502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4446505">&#34;return&#34;</span><span class="op" id="4446513">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446519">true</span><span class="op" id="4446523">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4446526">&#34;throw&#34;</span><span class="op" id="4446533">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446540">true</span><span class="op" id="4446544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4446547">&#34;try&#34;</span><span class="op" id="4446552">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446561">true</span><span class="op" id="4446565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4446568">&#34;typeof&#34;</span><span class="op" id="4446576">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446582">true</span><span class="op" id="4446586">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4446589">&#34;void&#34;</span><span class="op" id="4446595">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446603">true</span><span class="op" id="4446607">,</span><br>
<span class="lineno"></span><span class="op" id="4446609">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="4446612">var</span>&nbsp;<span class="ident" id="4446616">jsonMarshalType</span>&nbsp;<span class="op" id="4446632">=</span>&nbsp;<span class="ident" id="4446634">reflect</span><span class="op" id="4446641">.</span><span class="ident" id="4446642">TypeOf</span><span class="op" id="4446648">(</span><span class="op" id="4446649">(</span><span class="op" id="4446650">*</span><span class="ident" id="4446651">json</span><span class="op" id="4446655">.</span><span class="ident" id="4446656">Marshaler</span><span class="op" id="4446665">)</span><span class="op" id="4446666">(</span><span class="ident" id="4446667">nil</span><span class="op" id="4446670">)</span><span class="op" id="4446671">)</span><span class="op" id="4446672">.</span><span class="ident" id="4446673">Elem</span><span class="op" id="4446677">(</span><span class="op" id="4446678">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4446681">//&nbsp;indirectToJSONMarshaler&nbsp;returns&nbsp;the&nbsp;value,&nbsp;after&nbsp;dereferencing&nbsp;as&nbsp;many&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="4446761">//&nbsp;as&nbsp;necessary&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type&nbsp;(or&nbsp;nil)&nbsp;or&nbsp;an&nbsp;implementation&nbsp;of&nbsp;json.Marshal.</span><br>
<span class="lineno">125</span><span class="keyword" id="4446847">func</span>&nbsp;<span class="ident" id="4446852">indirectToJSONMarshaler</span><span class="op" id="4446875">(</span><span class="ident" id="4446876">a</span>&nbsp;<span class="keyword" id="4446878">interface</span><span class="op" id="4446887">{</span><span class="op" id="4446888">}</span><span class="op" id="4446889">)</span>&nbsp;<span class="keyword" id="4446891">interface</span><span class="op" id="4446900">{</span><span class="op" id="4446901">}</span>&nbsp;<span class="op" id="4446903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4446906">v</span>&nbsp;<span class="op" id="4446908">:=</span>&nbsp;<span class="ident" id="4446911">reflect</span><span class="op" id="4446918">.</span><span class="ident" id="4446919">ValueOf</span><span class="op" id="4446926">(</span><span class="ident" id="4446927">a</span><span class="op" id="4446928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4446931">for</span>&nbsp;<span class="op" id="4446935">!</span><span class="ident" id="4446936">v</span><span class="op" id="4446937">.</span><span class="ident" id="4446938">Type</span><span class="op" id="4446942">(</span><span class="op" id="4446943">)</span><span class="op" id="4446944">.</span><span class="ident" id="4446945">Implements</span><span class="op" id="4446955">(</span><span class="ident" id="4446956">jsonMarshalType</span><span class="op" id="4446971">)</span>&nbsp;<span class="op" id="4446973">&amp;&amp;</span>&nbsp;<span class="ident" id="4446976">v</span><span class="op" id="4446977">.</span><span class="ident" id="4446978">Kind</span><span class="op" id="4446982">(</span><span class="op" id="4446983">)</span>&nbsp;<span class="op" id="4446985">==</span>&nbsp;<span class="ident" id="4446988">reflect</span><span class="op" id="4446995">.</span><span class="ident" id="4446996">Ptr</span>&nbsp;<span class="op" id="4447000">&amp;&amp;</span>&nbsp;<span class="op" id="4447003">!</span><span class="ident" id="4447004">v</span><span class="op" id="4447005">.</span><span class="ident" id="4447006">IsNil</span><span class="op" id="4447011">(</span><span class="op" id="4447012">)</span>&nbsp;<span class="op" id="4447014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447018">v</span>&nbsp;<span class="op" id="4447020">=</span>&nbsp;<span class="ident" id="4447022">v</span><span class="op" id="4447023">.</span><span class="ident" id="4447024">Elem</span><span class="op" id="4447028">(</span><span class="op" id="4447029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447032">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447035">return</span>&nbsp;<span class="ident" id="4447042">v</span><span class="op" id="4447043">.</span><span class="ident" id="4447044">Interface</span><span class="op" id="4447053">(</span><span class="op" id="4447054">)</span><br>
<span class="lineno"></span><span class="op" id="4447056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4447059">//&nbsp;jsValEscaper&nbsp;escapes&nbsp;its&nbsp;inputs&nbsp;to&nbsp;a&nbsp;JS&nbsp;Expression&nbsp;(section&nbsp;11.14)&nbsp;that&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="4447138">//&nbsp;neither&nbsp;side-effects&nbsp;nor&nbsp;free&nbsp;variables&nbsp;outside&nbsp;(NaN,&nbsp;Infinity).</span><br>
<span class="lineno">135</span><span class="keyword" id="4447206">func</span>&nbsp;<span class="ident" id="4447211">jsValEscaper</span><span class="op" id="4447223">(</span><span class="ident" id="4447224">args</span>&nbsp;<span class="op" id="4447229">...</span><span class="keyword" id="4447232">interface</span><span class="op" id="4447241">{</span><span class="op" id="4447242">}</span><span class="op" id="4447243">)</span>&nbsp;<span class="builtintype" id="4447245">string</span>&nbsp;<span class="op" id="4447252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447255">var</span>&nbsp;<span class="ident" id="4447259">a</span>&nbsp;<span class="keyword" id="4447261">interface</span><span class="op" id="4447270">{</span><span class="op" id="4447271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447274">if</span>&nbsp;<span class="builtinfunc" id="4447277">len</span><span class="op" id="4447280">(</span><span class="ident" id="4447281">args</span><span class="op" id="4447285">)</span>&nbsp;<span class="op" id="4447287">==</span>&nbsp;<span class="num" id="4447290">1</span>&nbsp;<span class="op" id="4447292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447296">a</span>&nbsp;<span class="op" id="4447298">=</span>&nbsp;<span class="ident" id="4447300">indirectToJSONMarshaler</span><span class="op" id="4447323">(</span><span class="ident" id="4447324">args</span><span class="op" id="4447328">[</span><span class="num" id="4447329">0</span><span class="op" id="4447330">]</span><span class="op" id="4447331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447335">switch</span>&nbsp;<span class="ident" id="4447342">t</span>&nbsp;<span class="op" id="4447344">:=</span>&nbsp;<span class="ident" id="4447347">a</span><span class="op" id="4447348">.</span><span class="op" id="4447349">(</span><span class="keyword" id="4447350">type</span><span class="op" id="4447354">)</span>&nbsp;<span class="op" id="4447356">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447360">case</span>&nbsp;<span class="ident" id="4447365">JS</span><span class="op" id="4447367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447372">return</span>&nbsp;<span class="builtintype" id="4447379">string</span><span class="op" id="4447385">(</span><span class="ident" id="4447386">t</span><span class="op" id="4447387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447391">case</span>&nbsp;<span class="ident" id="4447396">JSStr</span><span class="op" id="4447401">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447406">//&nbsp;TODO:&nbsp;normalize&nbsp;quotes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447436">return</span>&nbsp;<span class="string" id="4447443">`&#34;`</span>&nbsp;<span class="op" id="4447447">+</span>&nbsp;<span class="builtintype" id="4447449">string</span><span class="op" id="4447455">(</span><span class="ident" id="4447456">t</span><span class="op" id="4447457">)</span>&nbsp;<span class="op" id="4447459">+</span>&nbsp;<span class="string" id="4447461">`&#34;`</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447467">case</span>&nbsp;<span class="ident" id="4447472">json</span><span class="op" id="4447476">.</span><span class="ident" id="4447477">Marshaler</span><span class="op" id="4447486">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447491">//&nbsp;Do&nbsp;not&nbsp;treat&nbsp;as&nbsp;a&nbsp;Stringer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447524">case</span>&nbsp;<span class="ident" id="4447529">fmt</span><span class="op" id="4447532">.</span><span class="ident" id="4447533">Stringer</span><span class="op" id="4447541">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447546">a</span>&nbsp;<span class="op" id="4447548">=</span>&nbsp;<span class="ident" id="4447550">t</span><span class="op" id="4447551">.</span><span class="ident" id="4447552">String</span><span class="op" id="4447558">(</span><span class="op" id="4447559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447563">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447566">}</span>&nbsp;<span class="keyword" id="4447568">else</span>&nbsp;<span class="op" id="4447573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447577">for</span>&nbsp;<span class="ident" id="4447581">i</span><span class="op" id="4447582">,</span>&nbsp;<span class="ident" id="4447584">arg</span>&nbsp;<span class="op" id="4447588">:=</span>&nbsp;<span class="keyword" id="4447591">range</span>&nbsp;<span class="ident" id="4447597">args</span>&nbsp;<span class="op" id="4447602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447607">args</span><span class="op" id="4447611">[</span><span class="ident" id="4447612">i</span><span class="op" id="4447613">]</span>&nbsp;<span class="op" id="4447615">=</span>&nbsp;<span class="ident" id="4447617">indirectToJSONMarshaler</span><span class="op" id="4447640">(</span><span class="ident" id="4447641">arg</span><span class="op" id="4447644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447652">a</span>&nbsp;<span class="op" id="4447654">=</span>&nbsp;<span class="ident" id="4447656">fmt</span><span class="op" id="4447659">.</span><span class="ident" id="4447660">Sprint</span><span class="op" id="4447666">(</span><span class="ident" id="4447667">args</span><span class="op" id="4447671">...</span><span class="op" id="4447674">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4447677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447680">//&nbsp;TODO:&nbsp;detect&nbsp;cycles&nbsp;before&nbsp;calling&nbsp;Marshal&nbsp;which&nbsp;loops&nbsp;infinitely&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447753">//&nbsp;cyclic&nbsp;data.&nbsp;This&nbsp;may&nbsp;be&nbsp;an&nbsp;unacceptable&nbsp;DoS&nbsp;risk.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4447809">b</span><span class="op" id="4447810">,</span>&nbsp;<span class="ident" id="4447812">err</span>&nbsp;<span class="op" id="4447816">:=</span>&nbsp;<span class="ident" id="4447819">json</span><span class="op" id="4447823">.</span><span class="ident" id="4447824">Marshal</span><span class="op" id="4447831">(</span><span class="ident" id="4447832">a</span><span class="op" id="4447833">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4447836">if</span>&nbsp;<span class="ident" id="4447839">err</span>&nbsp;<span class="op" id="4447843">!=</span>&nbsp;<span class="ident" id="4447846">nil</span>&nbsp;<span class="op" id="4447850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447854">//&nbsp;Put&nbsp;a&nbsp;space&nbsp;before&nbsp;comment&nbsp;so&nbsp;that&nbsp;if&nbsp;it&nbsp;is&nbsp;flush&nbsp;against</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447917">//&nbsp;a&nbsp;division&nbsp;operator&nbsp;it&nbsp;is&nbsp;not&nbsp;turned&nbsp;into&nbsp;a&nbsp;line&nbsp;comment:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447980">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x/{{y}}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4447997">//&nbsp;turning&nbsp;into</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448015">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x//*&nbsp;error&nbsp;marshalling&nbsp;y:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448050">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;second&nbsp;line&nbsp;of&nbsp;error&nbsp;message&nbsp;*/null</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448100">return</span>&nbsp;<span class="ident" id="4448107">fmt</span><span class="op" id="4448110">.</span><span class="ident" id="4448111">Sprintf</span><span class="op" id="4448118">(</span><span class="string" id="4448119">&#34;&nbsp;/*&nbsp;%s&nbsp;*/null&nbsp;&#34;</span><span class="op" id="4448135">,</span>&nbsp;<span class="ident" id="4448137">strings</span><span class="op" id="4448144">.</span><span class="ident" id="4448145">Replace</span><span class="op" id="4448152">(</span><span class="ident" id="4448153">err</span><span class="op" id="4448156">.</span><span class="ident" id="4448157">Error</span><span class="op" id="4448162">(</span><span class="op" id="4448163">)</span><span class="op" id="4448164">,</span>&nbsp;<span class="string" id="4448166">&#34;*/&#34;</span><span class="op" id="4448170">,</span>&nbsp;<span class="string" id="4448172">&#34;*&nbsp;/&#34;</span><span class="op" id="4448177">,</span>&nbsp;<span class="op" id="4448179">-</span><span class="num" id="4448180">1</span><span class="op" id="4448181">)</span><span class="op" id="4448182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4448185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448189">//&nbsp;TODO:&nbsp;maybe&nbsp;post-process&nbsp;output&nbsp;to&nbsp;prevent&nbsp;it&nbsp;from&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448255">//&nbsp;&#34;&lt;!--&#34;,&nbsp;&#34;--&gt;&#34;,&nbsp;&#34;&lt;![CDATA[&#34;,&nbsp;&#34;]]&gt;&#34;,&nbsp;or&nbsp;&#34;&lt;/script&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448308">//&nbsp;in&nbsp;case&nbsp;custom&nbsp;marshallers&nbsp;produce&nbsp;output&nbsp;containing&nbsp;those.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448373">//&nbsp;TODO:&nbsp;Maybe&nbsp;abbreviate&nbsp;\u00ab&nbsp;to&nbsp;\xab&nbsp;to&nbsp;produce&nbsp;more&nbsp;compact&nbsp;output.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448447">if</span>&nbsp;<span class="builtinfunc" id="4448450">len</span><span class="op" id="4448453">(</span><span class="ident" id="4448454">b</span><span class="op" id="4448455">)</span>&nbsp;<span class="op" id="4448457">==</span>&nbsp;<span class="num" id="4448460">0</span>&nbsp;<span class="op" id="4448462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448466">//&nbsp;In,&nbsp;`x=y/{{.}}*z`&nbsp;a&nbsp;json.Marshaler&nbsp;that&nbsp;produces&nbsp;&#34;&#34;&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448530">//&nbsp;not&nbsp;cause&nbsp;the&nbsp;output&nbsp;`x=y/*z`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448566">return</span>&nbsp;<span class="string" id="4448573">&#34;&nbsp;null&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4448583">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448586">first</span><span class="op" id="4448591">,</span>&nbsp;<span class="ident" id="4448593">_</span>&nbsp;<span class="op" id="4448595">:=</span>&nbsp;<span class="ident" id="4448598">utf8</span><span class="op" id="4448602">.</span><span class="ident" id="4448603">DecodeRune</span><span class="op" id="4448613">(</span><span class="ident" id="4448614">b</span><span class="op" id="4448615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448618">last</span><span class="op" id="4448622">,</span>&nbsp;<span class="ident" id="4448624">_</span>&nbsp;<span class="op" id="4448626">:=</span>&nbsp;<span class="ident" id="4448629">utf8</span><span class="op" id="4448633">.</span><span class="ident" id="4448634">DecodeLastRune</span><span class="op" id="4448648">(</span><span class="ident" id="4448649">b</span><span class="op" id="4448650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448653">var</span>&nbsp;<span class="ident" id="4448657">buf</span>&nbsp;<span class="ident" id="4448661">bytes</span><span class="op" id="4448666">.</span><span class="ident" id="4448667">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448675">//&nbsp;Prevent&nbsp;IdentifierNames&nbsp;and&nbsp;NumericLiterals&nbsp;from&nbsp;running&nbsp;into</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448741">//&nbsp;keywords:&nbsp;in,&nbsp;instanceof,&nbsp;typeof,&nbsp;void</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448784">pad</span>&nbsp;<span class="op" id="4448788">:=</span>&nbsp;<span class="ident" id="4448791">isJSIdentPart</span><span class="op" id="4448804">(</span><span class="ident" id="4448805">first</span><span class="op" id="4448810">)</span>&nbsp;<span class="op" id="4448812">||</span>&nbsp;<span class="ident" id="4448815">isJSIdentPart</span><span class="op" id="4448828">(</span><span class="ident" id="4448829">last</span><span class="op" id="4448833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4448836">if</span>&nbsp;<span class="ident" id="4448839">pad</span>&nbsp;<span class="op" id="4448843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448847">buf</span><span class="op" id="4448850">.</span><span class="ident" id="4448851">WriteByte</span><span class="op" id="4448860">(</span><span class="string" id="4448861">&#39;&nbsp;&#39;</span><span class="op" id="4448864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4448867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4448870">written</span>&nbsp;<span class="op" id="4448878">:=</span>&nbsp;<span class="num" id="4448881">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448884">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;json.Marshal&nbsp;escapes&nbsp;codepoints&nbsp;U+2028&nbsp;&amp;&nbsp;U+2029</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4448951">//&nbsp;so&nbsp;it&nbsp;falls&nbsp;within&nbsp;the&nbsp;subset&nbsp;of&nbsp;JSON&nbsp;which&nbsp;is&nbsp;valid&nbsp;JS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449012">for</span>&nbsp;<span class="ident" id="4449016">i</span>&nbsp;<span class="op" id="4449018">:=</span>&nbsp;<span class="num" id="4449021">0</span><span class="op" id="4449022">;</span>&nbsp;<span class="ident" id="4449024">i</span>&nbsp;<span class="op" id="4449026">&lt;</span>&nbsp;<span class="builtinfunc" id="4449028">len</span><span class="op" id="4449031">(</span><span class="ident" id="4449032">b</span><span class="op" id="4449033">)</span><span class="op" id="4449034">;</span>&nbsp;<span class="op" id="4449036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4449040">rune</span><span class="op" id="4449044">,</span>&nbsp;<span class="ident" id="4449046">n</span>&nbsp;<span class="op" id="4449048">:=</span>&nbsp;<span class="ident" id="4449051">utf8</span><span class="op" id="4449055">.</span><span class="ident" id="4449056">DecodeRune</span><span class="op" id="4449066">(</span><span class="ident" id="4449067">b</span><span class="op" id="4449068">[</span><span class="ident" id="4449069">i</span><span class="op" id="4449070">:</span><span class="op" id="4449071">]</span><span class="op" id="4449072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449076">repl</span>&nbsp;<span class="op" id="4449081">:=</span>&nbsp;<span class="string" id="4449084">&#34;&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449089">if</span>&nbsp;<span class="builtintype" id="4449092">rune</span>&nbsp;<span class="op" id="4449097">==</span>&nbsp;<span class="num" id="4449100">0x2028</span>&nbsp;<span class="op" id="4449107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449112">repl</span>&nbsp;<span class="op" id="4449117">=</span>&nbsp;<span class="string" id="4449119">`\u2028`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449130">}</span>&nbsp;<span class="keyword" id="4449132">else</span>&nbsp;<span class="keyword" id="4449137">if</span>&nbsp;<span class="builtintype" id="4449140">rune</span>&nbsp;<span class="op" id="4449145">==</span>&nbsp;<span class="num" id="4449148">0x2029</span>&nbsp;<span class="op" id="4449155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449160">repl</span>&nbsp;<span class="op" id="4449165">=</span>&nbsp;<span class="string" id="4449167">`\u2029`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449178">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449182">if</span>&nbsp;<span class="ident" id="4449185">repl</span>&nbsp;<span class="op" id="4449190">!=</span>&nbsp;<span class="string" id="4449193">&#34;&#34;</span>&nbsp;<span class="op" id="4449196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449201">buf</span><span class="op" id="4449204">.</span><span class="ident" id="4449205">Write</span><span class="op" id="4449210">(</span><span class="ident" id="4449211">b</span><span class="op" id="4449212">[</span><span class="ident" id="4449213">written</span><span class="op" id="4449220">:</span><span class="ident" id="4449221">i</span><span class="op" id="4449222">]</span><span class="op" id="4449223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449228">buf</span><span class="op" id="4449231">.</span><span class="ident" id="4449232">WriteString</span><span class="op" id="4449243">(</span><span class="ident" id="4449244">repl</span><span class="op" id="4449248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449253">written</span>&nbsp;<span class="op" id="4449261">=</span>&nbsp;<span class="ident" id="4449263">i</span>&nbsp;<span class="op" id="4449265">+</span>&nbsp;<span class="ident" id="4449267">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449271">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449275">i</span>&nbsp;<span class="op" id="4449277">+=</span>&nbsp;<span class="ident" id="4449280">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449286">if</span>&nbsp;<span class="ident" id="4449289">buf</span><span class="op" id="4449292">.</span><span class="ident" id="4449293">Len</span><span class="op" id="4449296">(</span><span class="op" id="4449297">)</span>&nbsp;<span class="op" id="4449299">!=</span>&nbsp;<span class="num" id="4449302">0</span>&nbsp;<span class="op" id="4449304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449308">buf</span><span class="op" id="4449311">.</span><span class="ident" id="4449312">Write</span><span class="op" id="4449317">(</span><span class="ident" id="4449318">b</span><span class="op" id="4449319">[</span><span class="ident" id="4449320">written</span><span class="op" id="4449327">:</span><span class="op" id="4449328">]</span><span class="op" id="4449329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449333">if</span>&nbsp;<span class="ident" id="4449336">pad</span>&nbsp;<span class="op" id="4449340">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449345">buf</span><span class="op" id="4449348">.</span><span class="ident" id="4449349">WriteByte</span><span class="op" id="4449358">(</span><span class="string" id="4449359">&#39;&nbsp;&#39;</span><span class="op" id="4449362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449370">b</span>&nbsp;<span class="op" id="4449372">=</span>&nbsp;<span class="ident" id="4449374">buf</span><span class="op" id="4449377">.</span><span class="ident" id="4449378">Bytes</span><span class="op" id="4449383">(</span><span class="op" id="4449384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449390">return</span>&nbsp;<span class="builtintype" id="4449397">string</span><span class="op" id="4449403">(</span><span class="ident" id="4449404">b</span><span class="op" id="4449405">)</span><br>
<span class="lineno">215</span><span class="op" id="4449407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4449410">//&nbsp;jsStrEscaper&nbsp;produces&nbsp;a&nbsp;string&nbsp;that&nbsp;can&nbsp;be&nbsp;included&nbsp;between&nbsp;quotes&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4449483">//&nbsp;JavaScript&nbsp;source,&nbsp;in&nbsp;JavaScript&nbsp;embedded&nbsp;in&nbsp;an&nbsp;HTML5&nbsp;&lt;script&gt;&nbsp;element,</span><br>
<span class="lineno"></span><span class="comment" id="4449558">//&nbsp;or&nbsp;in&nbsp;an&nbsp;HTML5&nbsp;event&nbsp;handler&nbsp;attribute&nbsp;such&nbsp;as&nbsp;onclick.</span><br>
<span class="lineno">220</span><span class="keyword" id="4449617">func</span>&nbsp;<span class="ident" id="4449622">jsStrEscaper</span><span class="op" id="4449634">(</span><span class="ident" id="4449635">args</span>&nbsp;<span class="op" id="4449640">...</span><span class="keyword" id="4449643">interface</span><span class="op" id="4449652">{</span><span class="op" id="4449653">}</span><span class="op" id="4449654">)</span>&nbsp;<span class="builtintype" id="4449656">string</span>&nbsp;<span class="op" id="4449663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4449666">s</span><span class="op" id="4449667">,</span>&nbsp;<span class="ident" id="4449669">t</span>&nbsp;<span class="op" id="4449671">:=</span>&nbsp;<span class="ident" id="4449674">stringify</span><span class="op" id="4449683">(</span><span class="ident" id="4449684">args</span><span class="op" id="4449688">...</span><span class="op" id="4449691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449694">if</span>&nbsp;<span class="ident" id="4449697">t</span>&nbsp;<span class="op" id="4449699">==</span>&nbsp;<span class="ident" id="4449702">contentTypeJSStr</span>&nbsp;<span class="op" id="4449719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449723">return</span>&nbsp;<span class="ident" id="4449730">replace</span><span class="op" id="4449737">(</span><span class="ident" id="4449738">s</span><span class="op" id="4449739">,</span>&nbsp;<span class="ident" id="4449741">jsStrNormReplacementTable</span><span class="op" id="4449766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4449769">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4449772">return</span>&nbsp;<span class="ident" id="4449779">replace</span><span class="op" id="4449786">(</span><span class="ident" id="4449787">s</span><span class="op" id="4449788">,</span>&nbsp;<span class="ident" id="4449790">jsStrReplacementTable</span><span class="op" id="4449811">)</span><br>
<span class="lineno"></span><span class="op" id="4449813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4449816">//&nbsp;jsRegexpEscaper&nbsp;behaves&nbsp;like&nbsp;jsStrEscaper&nbsp;but&nbsp;escapes&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="4449892">//&nbsp;specials&nbsp;so&nbsp;the&nbsp;result&nbsp;is&nbsp;treated&nbsp;literally&nbsp;when&nbsp;included&nbsp;in&nbsp;a&nbsp;regular</span><br>
<span class="lineno">230</span><span class="comment" id="4449966">//&nbsp;expression&nbsp;literal.&nbsp;/foo{{.X}}bar/&nbsp;matches&nbsp;the&nbsp;string&nbsp;&#34;foo&#34;&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4450041">//&nbsp;the&nbsp;literal&nbsp;text&nbsp;of&nbsp;{{.X}}&nbsp;followed&nbsp;by&nbsp;the&nbsp;string&nbsp;&#34;bar&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4450101">func</span>&nbsp;<span class="ident" id="4450106">jsRegexpEscaper</span><span class="op" id="4450121">(</span><span class="ident" id="4450122">args</span>&nbsp;<span class="op" id="4450127">...</span><span class="keyword" id="4450130">interface</span><span class="op" id="4450139">{</span><span class="op" id="4450140">}</span><span class="op" id="4450141">)</span>&nbsp;<span class="builtintype" id="4450143">string</span>&nbsp;<span class="op" id="4450150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450153">s</span><span class="op" id="4450154">,</span>&nbsp;<span class="ident" id="4450156">_</span>&nbsp;<span class="op" id="4450158">:=</span>&nbsp;<span class="ident" id="4450161">stringify</span><span class="op" id="4450170">(</span><span class="ident" id="4450171">args</span><span class="op" id="4450175">...</span><span class="op" id="4450178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450181">s</span>&nbsp;<span class="op" id="4450183">=</span>&nbsp;<span class="ident" id="4450185">replace</span><span class="op" id="4450192">(</span><span class="ident" id="4450193">s</span><span class="op" id="4450194">,</span>&nbsp;<span class="ident" id="4450196">jsRegexpReplacementTable</span><span class="op" id="4450220">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450223">if</span>&nbsp;<span class="ident" id="4450226">s</span>&nbsp;<span class="op" id="4450228">==</span>&nbsp;<span class="string" id="4450231">&#34;&#34;</span>&nbsp;<span class="op" id="4450234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4450238">//&nbsp;/{{.X}}/&nbsp;should&nbsp;not&nbsp;produce&nbsp;a&nbsp;line&nbsp;comment&nbsp;when&nbsp;.X&nbsp;==&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450301">return</span>&nbsp;<span class="string" id="4450308">&#34;(?:)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4450316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450319">return</span>&nbsp;<span class="ident" id="4450326">s</span><br>
<span class="lineno">240</span><span class="op" id="4450328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4450331">//&nbsp;replace&nbsp;replaces&nbsp;each&nbsp;rune&nbsp;r&nbsp;of&nbsp;s&nbsp;with&nbsp;replacementTable[r],&nbsp;provided&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4450408">//&nbsp;r&nbsp;&lt;&nbsp;len(replacementTable).&nbsp;If&nbsp;replacementTable[r]&nbsp;is&nbsp;the&nbsp;empty&nbsp;string&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="4450486">//&nbsp;no&nbsp;replacement&nbsp;is&nbsp;made.</span><br>
<span class="lineno">245</span><span class="comment" id="4450513">//&nbsp;It&nbsp;also&nbsp;replaces&nbsp;runes&nbsp;U+2028&nbsp;and&nbsp;U+2029&nbsp;with&nbsp;the&nbsp;raw&nbsp;strings&nbsp;`\u2028`&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4450591">//&nbsp;`\u2029`.</span><br>
<span class="lineno"></span><span class="keyword" id="4450604">func</span>&nbsp;<span class="ident" id="4450609">replace</span><span class="op" id="4450616">(</span><span class="ident" id="4450617">s</span>&nbsp;<span class="builtintype" id="4450619">string</span><span class="op" id="4450625">,</span>&nbsp;<span class="ident" id="4450627">replacementTable</span>&nbsp;<span class="op" id="4450644">[</span><span class="op" id="4450645">]</span><span class="builtintype" id="4450646">string</span><span class="op" id="4450652">)</span>&nbsp;<span class="builtintype" id="4450654">string</span>&nbsp;<span class="op" id="4450661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450664">var</span>&nbsp;<span class="ident" id="4450668">b</span>&nbsp;<span class="ident" id="4450670">bytes</span><span class="op" id="4450675">.</span><span class="ident" id="4450676">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450684">written</span>&nbsp;<span class="op" id="4450692">:=</span>&nbsp;<span class="num" id="4450695">0</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450698">for</span>&nbsp;<span class="ident" id="4450702">i</span><span class="op" id="4450703">,</span>&nbsp;<span class="ident" id="4450705">r</span>&nbsp;<span class="op" id="4450707">:=</span>&nbsp;<span class="keyword" id="4450710">range</span>&nbsp;<span class="ident" id="4450716">s</span>&nbsp;<span class="op" id="4450718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450722">var</span>&nbsp;<span class="ident" id="4450726">repl</span>&nbsp;<span class="builtintype" id="4450731">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450740">switch</span>&nbsp;<span class="op" id="4450747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450751">case</span>&nbsp;<span class="builtintype" id="4450756">int</span><span class="op" id="4450759">(</span><span class="ident" id="4450760">r</span><span class="op" id="4450761">)</span>&nbsp;<span class="op" id="4450763">&lt;</span>&nbsp;<span class="builtinfunc" id="4450765">len</span><span class="op" id="4450768">(</span><span class="ident" id="4450769">replacementTable</span><span class="op" id="4450785">)</span>&nbsp;<span class="op" id="4450787">&amp;&amp;</span>&nbsp;<span class="ident" id="4450790">replacementTable</span><span class="op" id="4450806">[</span><span class="ident" id="4450807">r</span><span class="op" id="4450808">]</span>&nbsp;<span class="op" id="4450810">!=</span>&nbsp;<span class="string" id="4450813">&#34;&#34;</span><span class="op" id="4450815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450820">repl</span>&nbsp;<span class="op" id="4450825">=</span>&nbsp;<span class="ident" id="4450827">replacementTable</span><span class="op" id="4450843">[</span><span class="ident" id="4450844">r</span><span class="op" id="4450845">]</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450849">case</span>&nbsp;<span class="ident" id="4450854">r</span>&nbsp;<span class="op" id="4450856">==</span>&nbsp;<span class="string" id="4450859">&#39;\u2028&#39;</span><span class="op" id="4450867">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450872">repl</span>&nbsp;<span class="op" id="4450877">=</span>&nbsp;<span class="string" id="4450879">`\u2028`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450890">case</span>&nbsp;<span class="ident" id="4450895">r</span>&nbsp;<span class="op" id="4450897">==</span>&nbsp;<span class="string" id="4450900">&#39;\u2029&#39;</span><span class="op" id="4450908">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450913">repl</span>&nbsp;<span class="op" id="4450918">=</span>&nbsp;<span class="string" id="4450920">`\u2029`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450931">default</span><span class="op" id="4450938">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4450943">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4450954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450958">b</span><span class="op" id="4450959">.</span><span class="ident" id="4450960">WriteString</span><span class="op" id="4450971">(</span><span class="ident" id="4450972">s</span><span class="op" id="4450973">[</span><span class="ident" id="4450974">written</span><span class="op" id="4450981">:</span><span class="ident" id="4450982">i</span><span class="op" id="4450983">]</span><span class="op" id="4450984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4450988">b</span><span class="op" id="4450989">.</span><span class="ident" id="4450990">WriteString</span><span class="op" id="4451001">(</span><span class="ident" id="4451002">repl</span><span class="op" id="4451006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451010">written</span>&nbsp;<span class="op" id="4451018">=</span>&nbsp;<span class="ident" id="4451020">i</span>&nbsp;<span class="op" id="4451022">+</span>&nbsp;<span class="ident" id="4451024">utf8</span><span class="op" id="4451028">.</span><span class="ident" id="4451029">RuneLen</span><span class="op" id="4451036">(</span><span class="ident" id="4451037">r</span><span class="op" id="4451038">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4451041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451044">if</span>&nbsp;<span class="ident" id="4451047">written</span>&nbsp;<span class="op" id="4451055">==</span>&nbsp;<span class="num" id="4451058">0</span>&nbsp;<span class="op" id="4451060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451064">return</span>&nbsp;<span class="ident" id="4451071">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4451074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4451077">b</span><span class="op" id="4451078">.</span><span class="ident" id="4451079">WriteString</span><span class="op" id="4451090">(</span><span class="ident" id="4451091">s</span><span class="op" id="4451092">[</span><span class="ident" id="4451093">written</span><span class="op" id="4451100">:</span><span class="op" id="4451101">]</span><span class="op" id="4451102">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4451105">return</span>&nbsp;<span class="ident" id="4451112">b</span><span class="op" id="4451113">.</span><span class="ident" id="4451114">String</span><span class="op" id="4451120">(</span><span class="op" id="4451121">)</span><br>
<span class="lineno"></span><span class="op" id="4451123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4451126">var</span>&nbsp;<span class="ident" id="4451130">jsStrReplacementTable</span>&nbsp;<span class="op" id="4451152">=</span>&nbsp;<span class="op" id="4451154">[</span><span class="op" id="4451155">]</span><span class="builtintype" id="4451156">string</span><span class="op" id="4451162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4451165">0</span><span class="op" id="4451166">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4451171">`\0`</span><span class="op" id="4451175">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451178">&#39;\t&#39;</span><span class="op" id="4451182">:</span>&nbsp;<span class="string" id="4451184">`\t`</span><span class="op" id="4451188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451191">&#39;\n&#39;</span><span class="op" id="4451195">:</span>&nbsp;<span class="string" id="4451197">`\n`</span><span class="op" id="4451201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451204">&#39;\v&#39;</span><span class="op" id="4451208">:</span>&nbsp;<span class="string" id="4451210">`\x0b`</span><span class="op" id="4451216">,</span>&nbsp;<span class="comment" id="4451218">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451243">&#39;\f&#39;</span><span class="op" id="4451247">:</span>&nbsp;<span class="string" id="4451249">`\f`</span><span class="op" id="4451253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451256">&#39;\r&#39;</span><span class="op" id="4451260">:</span>&nbsp;<span class="string" id="4451262">`\r`</span><span class="op" id="4451266">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4451269">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4451331">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451380">&#39;&#34;&#39;</span><span class="op" id="4451383">:</span>&nbsp;&nbsp;<span class="string" id="4451386">`\x22`</span><span class="op" id="4451392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451395">&#39;&amp;&#39;</span><span class="op" id="4451398">:</span>&nbsp;&nbsp;<span class="string" id="4451401">`\x26`</span><span class="op" id="4451407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451410">&#39;\&#39;&#39;</span><span class="op" id="4451414">:</span>&nbsp;<span class="string" id="4451416">`\x27`</span><span class="op" id="4451422">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451425">&#39;+&#39;</span><span class="op" id="4451428">:</span>&nbsp;&nbsp;<span class="string" id="4451431">`\x2b`</span><span class="op" id="4451437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451440">&#39;/&#39;</span><span class="op" id="4451443">:</span>&nbsp;&nbsp;<span class="string" id="4451446">`\/`</span><span class="op" id="4451450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451453">&#39;&lt;&#39;</span><span class="op" id="4451456">:</span>&nbsp;&nbsp;<span class="string" id="4451459">`\x3c`</span><span class="op" id="4451465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451468">&#39;&gt;&#39;</span><span class="op" id="4451471">:</span>&nbsp;&nbsp;<span class="string" id="4451474">`\x3e`</span><span class="op" id="4451480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451483">&#39;\\&#39;</span><span class="op" id="4451487">:</span>&nbsp;<span class="string" id="4451489">`\\`</span><span class="op" id="4451493">,</span><br>
<span class="lineno">290</span><span class="op" id="4451495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4451498">//&nbsp;jsStrNormReplacementTable&nbsp;is&nbsp;like&nbsp;jsStrReplacementTable&nbsp;but&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4451570">//&nbsp;overencode&nbsp;existing&nbsp;escapes&nbsp;since&nbsp;this&nbsp;table&nbsp;has&nbsp;no&nbsp;entry&nbsp;for&nbsp;`\`.</span><br>
<span class="lineno"></span><span class="keyword" id="4451640">var</span>&nbsp;<span class="ident" id="4451644">jsStrNormReplacementTable</span>&nbsp;<span class="op" id="4451670">=</span>&nbsp;<span class="op" id="4451672">[</span><span class="op" id="4451673">]</span><span class="builtintype" id="4451674">string</span><span class="op" id="4451680">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4451683">0</span><span class="op" id="4451684">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4451689">`\0`</span><span class="op" id="4451693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451696">&#39;\t&#39;</span><span class="op" id="4451700">:</span>&nbsp;<span class="string" id="4451702">`\t`</span><span class="op" id="4451706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451709">&#39;\n&#39;</span><span class="op" id="4451713">:</span>&nbsp;<span class="string" id="4451715">`\n`</span><span class="op" id="4451719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451722">&#39;\v&#39;</span><span class="op" id="4451726">:</span>&nbsp;<span class="string" id="4451728">`\x0b`</span><span class="op" id="4451734">,</span>&nbsp;<span class="comment" id="4451736">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451761">&#39;\f&#39;</span><span class="op" id="4451765">:</span>&nbsp;<span class="string" id="4451767">`\f`</span><span class="op" id="4451771">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451774">&#39;\r&#39;</span><span class="op" id="4451778">:</span>&nbsp;<span class="string" id="4451780">`\r`</span><span class="op" id="4451784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4451787">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4451849">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451898">&#39;&#34;&#39;</span><span class="op" id="4451901">:</span>&nbsp;&nbsp;<span class="string" id="4451904">`\x22`</span><span class="op" id="4451910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451913">&#39;&amp;&#39;</span><span class="op" id="4451916">:</span>&nbsp;&nbsp;<span class="string" id="4451919">`\x26`</span><span class="op" id="4451925">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451928">&#39;\&#39;&#39;</span><span class="op" id="4451932">:</span>&nbsp;<span class="string" id="4451934">`\x27`</span><span class="op" id="4451940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451943">&#39;+&#39;</span><span class="op" id="4451946">:</span>&nbsp;&nbsp;<span class="string" id="4451949">`\x2b`</span><span class="op" id="4451955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451958">&#39;/&#39;</span><span class="op" id="4451961">:</span>&nbsp;&nbsp;<span class="string" id="4451964">`\/`</span><span class="op" id="4451968">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451971">&#39;&lt;&#39;</span><span class="op" id="4451974">:</span>&nbsp;&nbsp;<span class="string" id="4451977">`\x3c`</span><span class="op" id="4451983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4451986">&#39;&gt;&#39;</span><span class="op" id="4451989">:</span>&nbsp;&nbsp;<span class="string" id="4451992">`\x3e`</span><span class="op" id="4451998">,</span><br>
<span class="lineno">310</span><span class="op" id="4452000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4452003">var</span>&nbsp;<span class="ident" id="4452007">jsRegexpReplacementTable</span>&nbsp;<span class="op" id="4452032">=</span>&nbsp;<span class="op" id="4452034">[</span><span class="op" id="4452035">]</span><span class="builtintype" id="4452036">string</span><span class="op" id="4452042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4452045">0</span><span class="op" id="4452046">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4452051">`\0`</span><span class="op" id="4452055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452058">&#39;\t&#39;</span><span class="op" id="4452062">:</span>&nbsp;<span class="string" id="4452064">`\t`</span><span class="op" id="4452068">,</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452071">&#39;\n&#39;</span><span class="op" id="4452075">:</span>&nbsp;<span class="string" id="4452077">`\n`</span><span class="op" id="4452081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452084">&#39;\v&#39;</span><span class="op" id="4452088">:</span>&nbsp;<span class="string" id="4452090">`\x0b`</span><span class="op" id="4452096">,</span>&nbsp;<span class="comment" id="4452098">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452123">&#39;\f&#39;</span><span class="op" id="4452127">:</span>&nbsp;<span class="string" id="4452129">`\f`</span><span class="op" id="4452133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452136">&#39;\r&#39;</span><span class="op" id="4452140">:</span>&nbsp;<span class="string" id="4452142">`\r`</span><span class="op" id="4452146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4452149">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4452211">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452260">&#39;&#34;&#39;</span><span class="op" id="4452263">:</span>&nbsp;&nbsp;<span class="string" id="4452266">`\x22`</span><span class="op" id="4452272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452275">&#39;$&#39;</span><span class="op" id="4452278">:</span>&nbsp;&nbsp;<span class="string" id="4452281">`\$`</span><span class="op" id="4452285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452288">&#39;&amp;&#39;</span><span class="op" id="4452291">:</span>&nbsp;&nbsp;<span class="string" id="4452294">`\x26`</span><span class="op" id="4452300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452303">&#39;\&#39;&#39;</span><span class="op" id="4452307">:</span>&nbsp;<span class="string" id="4452309">`\x27`</span><span class="op" id="4452315">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452318">&#39;(&#39;</span><span class="op" id="4452321">:</span>&nbsp;&nbsp;<span class="string" id="4452324">`\(`</span><span class="op" id="4452328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452331">&#39;)&#39;</span><span class="op" id="4452334">:</span>&nbsp;&nbsp;<span class="string" id="4452337">`\)`</span><span class="op" id="4452341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452344">&#39;*&#39;</span><span class="op" id="4452347">:</span>&nbsp;&nbsp;<span class="string" id="4452350">`\*`</span><span class="op" id="4452354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452357">&#39;+&#39;</span><span class="op" id="4452360">:</span>&nbsp;&nbsp;<span class="string" id="4452363">`\x2b`</span><span class="op" id="4452369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452372">&#39;-&#39;</span><span class="op" id="4452375">:</span>&nbsp;&nbsp;<span class="string" id="4452378">`\-`</span><span class="op" id="4452382">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452385">&#39;.&#39;</span><span class="op" id="4452388">:</span>&nbsp;&nbsp;<span class="string" id="4452391">`\.`</span><span class="op" id="4452395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452398">&#39;/&#39;</span><span class="op" id="4452401">:</span>&nbsp;&nbsp;<span class="string" id="4452404">`\/`</span><span class="op" id="4452408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452411">&#39;&lt;&#39;</span><span class="op" id="4452414">:</span>&nbsp;&nbsp;<span class="string" id="4452417">`\x3c`</span><span class="op" id="4452423">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452426">&#39;&gt;&#39;</span><span class="op" id="4452429">:</span>&nbsp;&nbsp;<span class="string" id="4452432">`\x3e`</span><span class="op" id="4452438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452441">&#39;?&#39;</span><span class="op" id="4452444">:</span>&nbsp;&nbsp;<span class="string" id="4452447">`\?`</span><span class="op" id="4452451">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452454">&#39;[&#39;</span><span class="op" id="4452457">:</span>&nbsp;&nbsp;<span class="string" id="4452460">`\[`</span><span class="op" id="4452464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452467">&#39;\\&#39;</span><span class="op" id="4452471">:</span>&nbsp;<span class="string" id="4452473">`\\`</span><span class="op" id="4452477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452480">&#39;]&#39;</span><span class="op" id="4452483">:</span>&nbsp;&nbsp;<span class="string" id="4452486">`\]`</span><span class="op" id="4452490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452493">&#39;^&#39;</span><span class="op" id="4452496">:</span>&nbsp;&nbsp;<span class="string" id="4452499">`\^`</span><span class="op" id="4452503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452506">&#39;{&#39;</span><span class="op" id="4452509">:</span>&nbsp;&nbsp;<span class="string" id="4452512">`\{`</span><span class="op" id="4452516">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452519">&#39;|&#39;</span><span class="op" id="4452522">:</span>&nbsp;&nbsp;<span class="string" id="4452525">`\|`</span><span class="op" id="4452529">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4452532">&#39;}&#39;</span><span class="op" id="4452535">:</span>&nbsp;&nbsp;<span class="string" id="4452538">`\}`</span><span class="op" id="4452542">,</span><br>
<span class="lineno"></span><span class="op" id="4452544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4452547">//&nbsp;isJSIdentPart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;given&nbsp;rune&nbsp;is&nbsp;a&nbsp;JS&nbsp;identifier&nbsp;part.</span><br>
<span class="lineno">345</span><span class="comment" id="4452620">//&nbsp;It&nbsp;does&nbsp;not&nbsp;handle&nbsp;all&nbsp;the&nbsp;non-Latin&nbsp;letters,&nbsp;joiners,&nbsp;and&nbsp;combining&nbsp;marks,</span><br>
<span class="lineno"></span><span class="comment" id="4452699">//&nbsp;but&nbsp;it&nbsp;does&nbsp;handle&nbsp;every&nbsp;codepoint&nbsp;that&nbsp;can&nbsp;occur&nbsp;in&nbsp;a&nbsp;numeric&nbsp;literal&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4452776">//&nbsp;a&nbsp;keyword.</span><br>
<span class="lineno"></span><span class="keyword" id="4452790">func</span>&nbsp;<span class="ident" id="4452795">isJSIdentPart</span><span class="op" id="4452808">(</span><span class="ident" id="4452809">r</span>&nbsp;<span class="builtintype" id="4452811">rune</span><span class="op" id="4452815">)</span>&nbsp;<span class="builtintype" id="4452817">bool</span>&nbsp;<span class="op" id="4452822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452825">switch</span>&nbsp;<span class="op" id="4452832">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452835">case</span>&nbsp;<span class="ident" id="4452840">r</span>&nbsp;<span class="op" id="4452842">==</span>&nbsp;<span class="string" id="4452845">&#39;$&#39;</span><span class="op" id="4452848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452852">return</span>&nbsp;<span class="ident" id="4452859">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452865">case</span>&nbsp;<span class="string" id="4452870">&#39;0&#39;</span>&nbsp;<span class="op" id="4452874">&lt;=</span>&nbsp;<span class="ident" id="4452877">r</span>&nbsp;<span class="op" id="4452879">&amp;&amp;</span>&nbsp;<span class="ident" id="4452882">r</span>&nbsp;<span class="op" id="4452884">&lt;=</span>&nbsp;<span class="string" id="4452887">&#39;9&#39;</span><span class="op" id="4452890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452894">return</span>&nbsp;<span class="ident" id="4452901">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452907">case</span>&nbsp;<span class="string" id="4452912">&#39;A&#39;</span>&nbsp;<span class="op" id="4452916">&lt;=</span>&nbsp;<span class="ident" id="4452919">r</span>&nbsp;<span class="op" id="4452921">&amp;&amp;</span>&nbsp;<span class="ident" id="4452924">r</span>&nbsp;<span class="op" id="4452926">&lt;=</span>&nbsp;<span class="string" id="4452929">&#39;Z&#39;</span><span class="op" id="4452932">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452936">return</span>&nbsp;<span class="ident" id="4452943">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452949">case</span>&nbsp;<span class="ident" id="4452954">r</span>&nbsp;<span class="op" id="4452956">==</span>&nbsp;<span class="string" id="4452959">&#39;_&#39;</span><span class="op" id="4452962">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452966">return</span>&nbsp;<span class="ident" id="4452973">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4452979">case</span>&nbsp;<span class="string" id="4452984">&#39;a&#39;</span>&nbsp;<span class="op" id="4452988">&lt;=</span>&nbsp;<span class="ident" id="4452991">r</span>&nbsp;<span class="op" id="4452993">&amp;&amp;</span>&nbsp;<span class="ident" id="4452996">r</span>&nbsp;<span class="op" id="4452998">&lt;=</span>&nbsp;<span class="string" id="4453001">&#39;z&#39;</span><span class="op" id="4453004">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453008">return</span>&nbsp;<span class="ident" id="4453015">true</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4453021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453024">return</span>&nbsp;<span class="ident" id="4453031">false</span><br>
<span class="lineno"></span><span class="op" id="4453037">}</span>
</div>
</body>
</html>
