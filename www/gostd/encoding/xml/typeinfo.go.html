<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html" class="current">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5718165">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5718221">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5718275">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5718326">package</span>&nbsp;<span class="ident" id="5718334">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5718339">import</span>&nbsp;<span class="op" id="5718346">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5718349">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5718356">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5718367">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5718378">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5718385">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5718388">//&nbsp;typeInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;type.</span><br>
<span class="lineno">15</span><span class="keyword" id="5718452">type</span>&nbsp;<span class="ident" id="5718457">typeInfo</span>&nbsp;<span class="keyword" id="5718466">struct</span>&nbsp;<span class="op" id="5718473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718476">xmlname</span>&nbsp;<span class="op" id="5718484">*</span><span class="ident" id="5718485">fieldInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718496">fields</span>&nbsp;&nbsp;<span class="op" id="5718504">[</span><span class="op" id="5718505">]</span><span class="ident" id="5718506">fieldInfo</span><br>
<span class="lineno"></span><span class="op" id="5718516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="5718519">//&nbsp;fieldInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="5718592">type</span>&nbsp;<span class="ident" id="5718597">fieldInfo</span>&nbsp;<span class="keyword" id="5718607">struct</span>&nbsp;<span class="op" id="5718614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718617">idx</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5718625">[</span><span class="op" id="5718626">]</span><span class="builtintype" id="5718627">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718632">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5718640">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718648">xmlns</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5718656">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718664">flags</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5718672">fieldFlags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718684">parents</span>&nbsp;<span class="op" id="5718692">[</span><span class="op" id="5718693">]</span><span class="builtintype" id="5718694">string</span><br>
<span class="lineno"></span><span class="op" id="5718701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5718704">type</span>&nbsp;<span class="ident" id="5718709">fieldFlags</span>&nbsp;<span class="builtintype" id="5718720">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="5718725">const</span>&nbsp;<span class="op" id="5718731">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718734">fElement</span>&nbsp;<span class="ident" id="5718743">fieldFlags</span>&nbsp;<span class="op" id="5718754">=</span>&nbsp;<span class="num" id="5718756">1</span>&nbsp;<span class="op" id="5718758">&lt;&lt;</span>&nbsp;<span class="ident" id="5718761">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718767">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718774">fCharData</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718785">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718796">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718806">fAny</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718813">fOmitEmpty</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718826">fMode</span>&nbsp;<span class="op" id="5718832">=</span>&nbsp;<span class="ident" id="5718834">fElement</span>&nbsp;<span class="op" id="5718843">|</span>&nbsp;<span class="ident" id="5718845">fAttr</span>&nbsp;<span class="op" id="5718851">|</span>&nbsp;<span class="ident" id="5718853">fCharData</span>&nbsp;<span class="op" id="5718863">|</span>&nbsp;<span class="ident" id="5718865">fInnerXml</span>&nbsp;<span class="op" id="5718875">|</span>&nbsp;<span class="ident" id="5718877">fComment</span>&nbsp;<span class="op" id="5718886">|</span>&nbsp;<span class="ident" id="5718888">fAny</span><br>
<span class="lineno"></span><span class="op" id="5718893">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5718896">var</span>&nbsp;<span class="ident" id="5718900">tinfoMap</span>&nbsp;<span class="op" id="5718909">=</span>&nbsp;<span class="builtinfunc" id="5718911">make</span><span class="op" id="5718915">(</span><span class="keyword" id="5718916">map</span><span class="op" id="5718919">[</span><span class="ident" id="5718920">reflect</span><span class="op" id="5718927">.</span><span class="ident" id="5718928">Type</span><span class="op" id="5718932">]</span><span class="op" id="5718933">*</span><span class="ident" id="5718934">typeInfo</span><span class="op" id="5718942">)</span><br>
<span class="lineno">45</span><span class="keyword" id="5718944">var</span>&nbsp;<span class="ident" id="5718948">tinfoLock</span>&nbsp;<span class="ident" id="5718958">sync</span><span class="op" id="5718962">.</span><span class="ident" id="5718963">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5718972">var</span>&nbsp;<span class="ident" id="5718976">nameType</span>&nbsp;<span class="op" id="5718985">=</span>&nbsp;<span class="ident" id="5718987">reflect</span><span class="op" id="5718994">.</span><span class="ident" id="5718995">TypeOf</span><span class="op" id="5719001">(</span><span class="ident" id="5719002">Name</span><span class="op" id="5719006">{</span><span class="op" id="5719007">}</span><span class="op" id="5719008">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5719011">//&nbsp;getTypeInfo&nbsp;returns&nbsp;the&nbsp;typeInfo&nbsp;structure&nbsp;with&nbsp;details&nbsp;necessary</span><br>
<span class="lineno">50</span><span class="comment" id="5719080">//&nbsp;for&nbsp;marshalling&nbsp;and&nbsp;unmarshalling&nbsp;typ.</span><br>
<span class="lineno"></span><span class="keyword" id="5719122">func</span>&nbsp;<span class="ident" id="5719127">getTypeInfo</span><span class="op" id="5719138">(</span><span class="ident" id="5719139">typ</span>&nbsp;<span class="ident" id="5719143">reflect</span><span class="op" id="5719150">.</span><span class="ident" id="5719151">Type</span><span class="op" id="5719155">)</span>&nbsp;<span class="op" id="5719157">(</span><span class="op" id="5719158">*</span><span class="ident" id="5719159">typeInfo</span><span class="op" id="5719167">,</span>&nbsp;<span class="builtintype" id="5719169">error</span><span class="op" id="5719174">)</span>&nbsp;<span class="op" id="5719176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719179">tinfoLock</span><span class="op" id="5719188">.</span><span class="ident" id="5719189">RLock</span><span class="op" id="5719194">(</span><span class="op" id="5719195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719198">tinfo</span><span class="op" id="5719203">,</span>&nbsp;<span class="ident" id="5719205">ok</span>&nbsp;<span class="op" id="5719208">:=</span>&nbsp;<span class="ident" id="5719211">tinfoMap</span><span class="op" id="5719219">[</span><span class="ident" id="5719220">typ</span><span class="op" id="5719223">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719226">tinfoLock</span><span class="op" id="5719235">.</span><span class="ident" id="5719236">RUnlock</span><span class="op" id="5719243">(</span><span class="op" id="5719244">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719247">if</span>&nbsp;<span class="ident" id="5719250">ok</span>&nbsp;<span class="op" id="5719253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719257">return</span>&nbsp;<span class="ident" id="5719264">tinfo</span><span class="op" id="5719269">,</span>&nbsp;<span class="ident" id="5719271">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5719276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719279">tinfo</span>&nbsp;<span class="op" id="5719285">=</span>&nbsp;<span class="op" id="5719287">&amp;</span><span class="ident" id="5719288">typeInfo</span><span class="op" id="5719296">{</span><span class="op" id="5719297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719300">if</span>&nbsp;<span class="ident" id="5719303">typ</span><span class="op" id="5719306">.</span><span class="ident" id="5719307">Kind</span><span class="op" id="5719311">(</span><span class="op" id="5719312">)</span>&nbsp;<span class="op" id="5719314">==</span>&nbsp;<span class="ident" id="5719317">reflect</span><span class="op" id="5719324">.</span><span class="ident" id="5719325">Struct</span>&nbsp;<span class="op" id="5719332">&amp;&amp;</span>&nbsp;<span class="ident" id="5719335">typ</span>&nbsp;<span class="op" id="5719339">!=</span>&nbsp;<span class="ident" id="5719342">nameType</span>&nbsp;<span class="op" id="5719351">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719355">n</span>&nbsp;<span class="op" id="5719357">:=</span>&nbsp;<span class="ident" id="5719360">typ</span><span class="op" id="5719363">.</span><span class="ident" id="5719364">NumField</span><span class="op" id="5719372">(</span><span class="op" id="5719373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719377">for</span>&nbsp;<span class="ident" id="5719381">i</span>&nbsp;<span class="op" id="5719383">:=</span>&nbsp;<span class="num" id="5719386">0</span><span class="op" id="5719387">;</span>&nbsp;<span class="ident" id="5719389">i</span>&nbsp;<span class="op" id="5719391">&lt;</span>&nbsp;<span class="ident" id="5719393">n</span><span class="op" id="5719394">;</span>&nbsp;<span class="ident" id="5719396">i</span><span class="op" id="5719397">++</span>&nbsp;<span class="op" id="5719400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719405">f</span>&nbsp;<span class="op" id="5719407">:=</span>&nbsp;<span class="ident" id="5719410">typ</span><span class="op" id="5719413">.</span><span class="ident" id="5719414">Field</span><span class="op" id="5719419">(</span><span class="ident" id="5719420">i</span><span class="op" id="5719421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719426">if</span>&nbsp;<span class="ident" id="5719429">f</span><span class="op" id="5719430">.</span><span class="ident" id="5719431">PkgPath</span>&nbsp;<span class="op" id="5719439">!=</span>&nbsp;<span class="string" id="5719442">&#34;&#34;</span>&nbsp;<span class="op" id="5719445">||</span>&nbsp;<span class="ident" id="5719448">f</span><span class="op" id="5719449">.</span><span class="ident" id="5719450">Tag</span><span class="op" id="5719453">.</span><span class="ident" id="5719454">Get</span><span class="op" id="5719457">(</span><span class="string" id="5719458">&#34;xml&#34;</span><span class="op" id="5719463">)</span>&nbsp;<span class="op" id="5719465">==</span>&nbsp;<span class="string" id="5719468">&#34;-&#34;</span>&nbsp;<span class="op" id="5719472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719478">continue</span>&nbsp;<span class="comment" id="5719487">//&nbsp;Private&nbsp;field</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5719507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5719513">//&nbsp;For&nbsp;embedded&nbsp;structs,&nbsp;embed&nbsp;its&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719559">if</span>&nbsp;<span class="ident" id="5719562">f</span><span class="op" id="5719563">.</span><span class="ident" id="5719564">Anonymous</span>&nbsp;<span class="op" id="5719574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719580">t</span>&nbsp;<span class="op" id="5719582">:=</span>&nbsp;<span class="ident" id="5719585">f</span><span class="op" id="5719586">.</span><span class="ident" id="5719587">Type</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719596">if</span>&nbsp;<span class="ident" id="5719599">t</span><span class="op" id="5719600">.</span><span class="ident" id="5719601">Kind</span><span class="op" id="5719605">(</span><span class="op" id="5719606">)</span>&nbsp;<span class="op" id="5719608">==</span>&nbsp;<span class="ident" id="5719611">reflect</span><span class="op" id="5719618">.</span><span class="ident" id="5719619">Ptr</span>&nbsp;<span class="op" id="5719623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719630">t</span>&nbsp;<span class="op" id="5719632">=</span>&nbsp;<span class="ident" id="5719634">t</span><span class="op" id="5719635">.</span><span class="ident" id="5719636">Elem</span><span class="op" id="5719640">(</span><span class="op" id="5719641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5719647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719653">if</span>&nbsp;<span class="ident" id="5719656">t</span><span class="op" id="5719657">.</span><span class="ident" id="5719658">Kind</span><span class="op" id="5719662">(</span><span class="op" id="5719663">)</span>&nbsp;<span class="op" id="5719665">==</span>&nbsp;<span class="ident" id="5719668">reflect</span><span class="op" id="5719675">.</span><span class="ident" id="5719676">Struct</span>&nbsp;<span class="op" id="5719683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719690">inner</span><span class="op" id="5719695">,</span>&nbsp;<span class="ident" id="5719697">err</span>&nbsp;<span class="op" id="5719701">:=</span>&nbsp;<span class="ident" id="5719704">getTypeInfo</span><span class="op" id="5719715">(</span><span class="ident" id="5719716">t</span><span class="op" id="5719717">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719724">if</span>&nbsp;<span class="ident" id="5719727">err</span>&nbsp;<span class="op" id="5719731">!=</span>&nbsp;<span class="ident" id="5719734">nil</span>&nbsp;<span class="op" id="5719738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719746">return</span>&nbsp;<span class="ident" id="5719753">nil</span><span class="op" id="5719756">,</span>&nbsp;<span class="ident" id="5719758">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5719767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719774">if</span>&nbsp;<span class="ident" id="5719777">tinfo</span><span class="op" id="5719782">.</span><span class="ident" id="5719783">xmlname</span>&nbsp;<span class="op" id="5719791">==</span>&nbsp;<span class="ident" id="5719794">nil</span>&nbsp;<span class="op" id="5719798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719806">tinfo</span><span class="op" id="5719811">.</span><span class="ident" id="5719812">xmlname</span>&nbsp;<span class="op" id="5719820">=</span>&nbsp;<span class="ident" id="5719822">inner</span><span class="op" id="5719827">.</span><span class="ident" id="5719828">xmlname</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5719841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719848">for</span>&nbsp;<span class="ident" id="5719852">_</span><span class="op" id="5719853">,</span>&nbsp;<span class="ident" id="5719855">finfo</span>&nbsp;<span class="op" id="5719861">:=</span>&nbsp;<span class="keyword" id="5719864">range</span>&nbsp;<span class="ident" id="5719870">inner</span><span class="op" id="5719875">.</span><span class="ident" id="5719876">fields</span>&nbsp;<span class="op" id="5719883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719891">finfo</span><span class="op" id="5719896">.</span><span class="ident" id="5719897">idx</span>&nbsp;<span class="op" id="5719901">=</span>&nbsp;<span class="builtinfunc" id="5719903">append</span><span class="op" id="5719909">(</span><span class="op" id="5719910">[</span><span class="op" id="5719911">]</span><span class="builtintype" id="5719912">int</span><span class="op" id="5719915">{</span><span class="ident" id="5719916">i</span><span class="op" id="5719917">}</span><span class="op" id="5719918">,</span>&nbsp;<span class="ident" id="5719920">finfo</span><span class="op" id="5719925">.</span><span class="ident" id="5719926">idx</span><span class="op" id="5719929">...</span><span class="op" id="5719932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719940">if</span>&nbsp;<span class="ident" id="5719943">err</span>&nbsp;<span class="op" id="5719947">:=</span>&nbsp;<span class="ident" id="5719950">addFieldInfo</span><span class="op" id="5719962">(</span><span class="ident" id="5719963">typ</span><span class="op" id="5719966">,</span>&nbsp;<span class="ident" id="5719968">tinfo</span><span class="op" id="5719973">,</span>&nbsp;<span class="op" id="5719975">&amp;</span><span class="ident" id="5719976">finfo</span><span class="op" id="5719981">)</span><span class="op" id="5719982">;</span>&nbsp;<span class="ident" id="5719984">err</span>&nbsp;<span class="op" id="5719988">!=</span>&nbsp;<span class="ident" id="5719991">nil</span>&nbsp;<span class="op" id="5719995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720004">return</span>&nbsp;<span class="ident" id="5720011">nil</span><span class="op" id="5720014">,</span>&nbsp;<span class="ident" id="5720016">err</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720040">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720058">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720064">finfo</span><span class="op" id="5720069">,</span>&nbsp;<span class="ident" id="5720071">err</span>&nbsp;<span class="op" id="5720075">:=</span>&nbsp;<span class="ident" id="5720078">structFieldInfo</span><span class="op" id="5720093">(</span><span class="ident" id="5720094">typ</span><span class="op" id="5720097">,</span>&nbsp;<span class="op" id="5720099">&amp;</span><span class="ident" id="5720100">f</span><span class="op" id="5720101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720106">if</span>&nbsp;<span class="ident" id="5720109">err</span>&nbsp;<span class="op" id="5720113">!=</span>&nbsp;<span class="ident" id="5720116">nil</span>&nbsp;<span class="op" id="5720120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720126">return</span>&nbsp;<span class="ident" id="5720133">nil</span><span class="op" id="5720136">,</span>&nbsp;<span class="ident" id="5720138">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720145">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720151">if</span>&nbsp;<span class="ident" id="5720154">f</span><span class="op" id="5720155">.</span><span class="ident" id="5720156">Name</span>&nbsp;<span class="op" id="5720161">==</span>&nbsp;<span class="string" id="5720164">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5720174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720180">tinfo</span><span class="op" id="5720185">.</span><span class="ident" id="5720186">xmlname</span>&nbsp;<span class="op" id="5720194">=</span>&nbsp;<span class="ident" id="5720196">finfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720206">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720218">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5720224">//&nbsp;Add&nbsp;the&nbsp;field&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;conflict&nbsp;with&nbsp;other&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720286">if</span>&nbsp;<span class="ident" id="5720289">err</span>&nbsp;<span class="op" id="5720293">:=</span>&nbsp;<span class="ident" id="5720296">addFieldInfo</span><span class="op" id="5720308">(</span><span class="ident" id="5720309">typ</span><span class="op" id="5720312">,</span>&nbsp;<span class="ident" id="5720314">tinfo</span><span class="op" id="5720319">,</span>&nbsp;<span class="ident" id="5720321">finfo</span><span class="op" id="5720326">)</span><span class="op" id="5720327">;</span>&nbsp;<span class="ident" id="5720329">err</span>&nbsp;<span class="op" id="5720333">!=</span>&nbsp;<span class="ident" id="5720336">nil</span>&nbsp;<span class="op" id="5720340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720346">return</span>&nbsp;<span class="ident" id="5720353">nil</span><span class="op" id="5720356">,</span>&nbsp;<span class="ident" id="5720358">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720365">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720375">tinfoLock</span><span class="op" id="5720384">.</span><span class="ident" id="5720385">Lock</span><span class="op" id="5720389">(</span><span class="op" id="5720390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720393">tinfoMap</span><span class="op" id="5720401">[</span><span class="ident" id="5720402">typ</span><span class="op" id="5720405">]</span>&nbsp;<span class="op" id="5720407">=</span>&nbsp;<span class="ident" id="5720409">tinfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720416">tinfoLock</span><span class="op" id="5720425">.</span><span class="ident" id="5720426">Unlock</span><span class="op" id="5720432">(</span><span class="op" id="5720433">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720436">return</span>&nbsp;<span class="ident" id="5720443">tinfo</span><span class="op" id="5720448">,</span>&nbsp;<span class="ident" id="5720450">nil</span><br>
<span class="lineno"></span><span class="op" id="5720454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5720457">//&nbsp;structFieldInfo&nbsp;builds&nbsp;and&nbsp;returns&nbsp;a&nbsp;fieldInfo&nbsp;for&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="5720514">func</span>&nbsp;<span class="ident" id="5720519">structFieldInfo</span><span class="op" id="5720534">(</span><span class="ident" id="5720535">typ</span>&nbsp;<span class="ident" id="5720539">reflect</span><span class="op" id="5720546">.</span><span class="ident" id="5720547">Type</span><span class="op" id="5720551">,</span>&nbsp;<span class="ident" id="5720553">f</span>&nbsp;<span class="op" id="5720555">*</span><span class="ident" id="5720556">reflect</span><span class="op" id="5720563">.</span><span class="ident" id="5720564">StructField</span><span class="op" id="5720575">)</span>&nbsp;<span class="op" id="5720577">(</span><span class="op" id="5720578">*</span><span class="ident" id="5720579">fieldInfo</span><span class="op" id="5720588">,</span>&nbsp;<span class="builtintype" id="5720590">error</span><span class="op" id="5720595">)</span>&nbsp;<span class="op" id="5720597">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720600">finfo</span>&nbsp;<span class="op" id="5720606">:=</span>&nbsp;<span class="op" id="5720609">&amp;</span><span class="ident" id="5720610">fieldInfo</span><span class="op" id="5720619">{</span><span class="ident" id="5720620">idx</span><span class="op" id="5720623">:</span>&nbsp;<span class="ident" id="5720625">f</span><span class="op" id="5720626">.</span><span class="ident" id="5720627">Index</span><span class="op" id="5720632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5720636">//&nbsp;Split&nbsp;the&nbsp;tag&nbsp;from&nbsp;the&nbsp;xml&nbsp;namespace&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720691">tag</span>&nbsp;<span class="op" id="5720695">:=</span>&nbsp;<span class="ident" id="5720698">f</span><span class="op" id="5720699">.</span><span class="ident" id="5720700">Tag</span><span class="op" id="5720703">.</span><span class="ident" id="5720704">Get</span><span class="op" id="5720707">(</span><span class="string" id="5720708">&#34;xml&#34;</span><span class="op" id="5720713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720716">if</span>&nbsp;<span class="ident" id="5720719">i</span>&nbsp;<span class="op" id="5720721">:=</span>&nbsp;<span class="ident" id="5720724">strings</span><span class="op" id="5720731">.</span><span class="ident" id="5720732">Index</span><span class="op" id="5720737">(</span><span class="ident" id="5720738">tag</span><span class="op" id="5720741">,</span>&nbsp;<span class="string" id="5720743">&#34;&nbsp;&#34;</span><span class="op" id="5720746">)</span><span class="op" id="5720747">;</span>&nbsp;<span class="ident" id="5720749">i</span>&nbsp;<span class="op" id="5720751">&gt;=</span>&nbsp;<span class="num" id="5720754">0</span>&nbsp;<span class="op" id="5720756">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720760">finfo</span><span class="op" id="5720765">.</span><span class="ident" id="5720766">xmlns</span><span class="op" id="5720771">,</span>&nbsp;<span class="ident" id="5720773">tag</span>&nbsp;<span class="op" id="5720777">=</span>&nbsp;<span class="ident" id="5720779">tag</span><span class="op" id="5720782">[</span><span class="op" id="5720783">:</span><span class="ident" id="5720784">i</span><span class="op" id="5720785">]</span><span class="op" id="5720786">,</span>&nbsp;<span class="ident" id="5720788">tag</span><span class="op" id="5720791">[</span><span class="ident" id="5720792">i</span><span class="op" id="5720793">+</span><span class="num" id="5720794">1</span><span class="op" id="5720795">:</span><span class="op" id="5720796">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5720803">//&nbsp;Parse&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720820">tokens</span>&nbsp;<span class="op" id="5720827">:=</span>&nbsp;<span class="ident" id="5720830">strings</span><span class="op" id="5720837">.</span><span class="ident" id="5720838">Split</span><span class="op" id="5720843">(</span><span class="ident" id="5720844">tag</span><span class="op" id="5720847">,</span>&nbsp;<span class="string" id="5720849">&#34;,&#34;</span><span class="op" id="5720852">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720855">if</span>&nbsp;<span class="builtinfunc" id="5720858">len</span><span class="op" id="5720861">(</span><span class="ident" id="5720862">tokens</span><span class="op" id="5720868">)</span>&nbsp;<span class="op" id="5720870">==</span>&nbsp;<span class="num" id="5720873">1</span>&nbsp;<span class="op" id="5720875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720879">finfo</span><span class="op" id="5720884">.</span><span class="ident" id="5720885">flags</span>&nbsp;<span class="op" id="5720891">=</span>&nbsp;<span class="ident" id="5720893">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720903">}</span>&nbsp;<span class="keyword" id="5720905">else</span>&nbsp;<span class="op" id="5720910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720914">tag</span>&nbsp;<span class="op" id="5720918">=</span>&nbsp;<span class="ident" id="5720920">tokens</span><span class="op" id="5720926">[</span><span class="num" id="5720927">0</span><span class="op" id="5720928">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720932">for</span>&nbsp;<span class="ident" id="5720936">_</span><span class="op" id="5720937">,</span>&nbsp;<span class="ident" id="5720939">flag</span>&nbsp;<span class="op" id="5720944">:=</span>&nbsp;<span class="keyword" id="5720947">range</span>&nbsp;<span class="ident" id="5720953">tokens</span><span class="op" id="5720959">[</span><span class="num" id="5720960">1</span><span class="op" id="5720961">:</span><span class="op" id="5720962">]</span>&nbsp;<span class="op" id="5720964">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720969">switch</span>&nbsp;<span class="ident" id="5720976">flag</span>&nbsp;<span class="op" id="5720981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720986">case</span>&nbsp;<span class="string" id="5720991">&#34;attr&#34;</span><span class="op" id="5720997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721003">finfo</span><span class="op" id="5721008">.</span><span class="ident" id="5721009">flags</span>&nbsp;<span class="op" id="5721015">|=</span>&nbsp;<span class="ident" id="5721018">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721027">case</span>&nbsp;<span class="string" id="5721032">&#34;chardata&#34;</span><span class="op" id="5721042">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721048">finfo</span><span class="op" id="5721053">.</span><span class="ident" id="5721054">flags</span>&nbsp;<span class="op" id="5721060">|=</span>&nbsp;<span class="ident" id="5721063">fCharData</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721076">case</span>&nbsp;<span class="string" id="5721081">&#34;innerxml&#34;</span><span class="op" id="5721091">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721097">finfo</span><span class="op" id="5721102">.</span><span class="ident" id="5721103">flags</span>&nbsp;<span class="op" id="5721109">|=</span>&nbsp;<span class="ident" id="5721112">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721125">case</span>&nbsp;<span class="string" id="5721130">&#34;comment&#34;</span><span class="op" id="5721139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721145">finfo</span><span class="op" id="5721150">.</span><span class="ident" id="5721151">flags</span>&nbsp;<span class="op" id="5721157">|=</span>&nbsp;<span class="ident" id="5721160">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721172">case</span>&nbsp;<span class="string" id="5721177">&#34;any&#34;</span><span class="op" id="5721182">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721188">finfo</span><span class="op" id="5721193">.</span><span class="ident" id="5721194">flags</span>&nbsp;<span class="op" id="5721200">|=</span>&nbsp;<span class="ident" id="5721203">fAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721211">case</span>&nbsp;<span class="string" id="5721216">&#34;omitempty&#34;</span><span class="op" id="5721227">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721233">finfo</span><span class="op" id="5721238">.</span><span class="ident" id="5721239">flags</span>&nbsp;<span class="op" id="5721245">|=</span>&nbsp;<span class="ident" id="5721248">fOmitEmpty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5721262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5721266">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5721271">//&nbsp;Validate&nbsp;the&nbsp;flags&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721301">valid</span>&nbsp;<span class="op" id="5721307">:=</span>&nbsp;<span class="builtintype" id="5721310">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721317">switch</span>&nbsp;<span class="ident" id="5721324">mode</span>&nbsp;<span class="op" id="5721329">:=</span>&nbsp;<span class="ident" id="5721332">finfo</span><span class="op" id="5721337">.</span><span class="ident" id="5721338">flags</span>&nbsp;<span class="op" id="5721344">&amp;</span>&nbsp;<span class="ident" id="5721346">fMode</span><span class="op" id="5721351">;</span>&nbsp;<span class="ident" id="5721353">mode</span>&nbsp;<span class="op" id="5721358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721362">case</span>&nbsp;<span class="num" id="5721367">0</span><span class="op" id="5721368">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721373">finfo</span><span class="op" id="5721378">.</span><span class="ident" id="5721379">flags</span>&nbsp;<span class="op" id="5721385">|=</span>&nbsp;<span class="ident" id="5721388">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721399">case</span>&nbsp;<span class="ident" id="5721404">fAttr</span><span class="op" id="5721409">,</span>&nbsp;<span class="ident" id="5721411">fCharData</span><span class="op" id="5721420">,</span>&nbsp;<span class="ident" id="5721422">fInnerXml</span><span class="op" id="5721431">,</span>&nbsp;<span class="ident" id="5721433">fComment</span><span class="op" id="5721441">,</span>&nbsp;<span class="ident" id="5721443">fAny</span><span class="op" id="5721447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721452">if</span>&nbsp;<span class="ident" id="5721455">f</span><span class="op" id="5721456">.</span><span class="ident" id="5721457">Name</span>&nbsp;<span class="op" id="5721462">==</span>&nbsp;<span class="string" id="5721465">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5721475">||</span>&nbsp;<span class="ident" id="5721478">tag</span>&nbsp;<span class="op" id="5721482">!=</span>&nbsp;<span class="string" id="5721485">&#34;&#34;</span>&nbsp;<span class="op" id="5721488">&amp;&amp;</span>&nbsp;<span class="ident" id="5721491">mode</span>&nbsp;<span class="op" id="5721496">!=</span>&nbsp;<span class="ident" id="5721499">fAttr</span>&nbsp;<span class="op" id="5721505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721511">valid</span>&nbsp;<span class="op" id="5721517">=</span>&nbsp;<span class="builtintype" id="5721519">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5721528">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721532">default</span><span class="op" id="5721539">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5721544">//&nbsp;This&nbsp;will&nbsp;also&nbsp;catch&nbsp;multiple&nbsp;modes&nbsp;in&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721605">valid</span>&nbsp;<span class="op" id="5721611">=</span>&nbsp;<span class="builtintype" id="5721613">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5721621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721625">if</span>&nbsp;<span class="ident" id="5721628">finfo</span><span class="op" id="5721633">.</span><span class="ident" id="5721634">flags</span><span class="op" id="5721639">&amp;</span><span class="ident" id="5721640">fMode</span>&nbsp;<span class="op" id="5721646">==</span>&nbsp;<span class="ident" id="5721649">fAny</span>&nbsp;<span class="op" id="5721654">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721659">finfo</span><span class="op" id="5721664">.</span><span class="ident" id="5721665">flags</span>&nbsp;<span class="op" id="5721671">|=</span>&nbsp;<span class="ident" id="5721674">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5721685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721689">if</span>&nbsp;<span class="ident" id="5721692">finfo</span><span class="op" id="5721697">.</span><span class="ident" id="5721698">flags</span><span class="op" id="5721703">&amp;</span><span class="ident" id="5721704">fOmitEmpty</span>&nbsp;<span class="op" id="5721715">!=</span>&nbsp;<span class="num" id="5721718">0</span>&nbsp;<span class="op" id="5721720">&amp;&amp;</span>&nbsp;<span class="ident" id="5721723">finfo</span><span class="op" id="5721728">.</span><span class="ident" id="5721729">flags</span><span class="op" id="5721734">&amp;</span><span class="op" id="5721735">(</span><span class="ident" id="5721736">fElement</span><span class="op" id="5721744">|</span><span class="ident" id="5721745">fAttr</span><span class="op" id="5721750">)</span>&nbsp;<span class="op" id="5721752">==</span>&nbsp;<span class="num" id="5721755">0</span>&nbsp;<span class="op" id="5721757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721762">valid</span>&nbsp;<span class="op" id="5721768">=</span>&nbsp;<span class="builtintype" id="5721770">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5721778">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721782">if</span>&nbsp;<span class="op" id="5721785">!</span><span class="ident" id="5721786">valid</span>&nbsp;<span class="op" id="5721792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721797">return</span>&nbsp;<span class="ident" id="5721804">nil</span><span class="op" id="5721807">,</span>&nbsp;<span class="ident" id="5721809">fmt</span><span class="op" id="5721812">.</span><span class="ident" id="5721813">Errorf</span><span class="op" id="5721819">(</span><span class="string" id="5721820">&#34;xml:&nbsp;invalid&nbsp;tag&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="5721865">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721871">f</span><span class="op" id="5721872">.</span><span class="ident" id="5721873">Name</span><span class="op" id="5721877">,</span>&nbsp;<span class="ident" id="5721879">typ</span><span class="op" id="5721882">,</span>&nbsp;<span class="ident" id="5721884">f</span><span class="op" id="5721885">.</span><span class="ident" id="5721886">Tag</span><span class="op" id="5721889">.</span><span class="ident" id="5721890">Get</span><span class="op" id="5721893">(</span><span class="string" id="5721894">&#34;xml&#34;</span><span class="op" id="5721899">)</span><span class="op" id="5721900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5721904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5721907">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5721911">//&nbsp;Use&nbsp;of&nbsp;xmlns&nbsp;without&nbsp;a&nbsp;name&nbsp;is&nbsp;not&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721959">if</span>&nbsp;<span class="ident" id="5721962">finfo</span><span class="op" id="5721967">.</span><span class="ident" id="5721968">xmlns</span>&nbsp;<span class="op" id="5721974">!=</span>&nbsp;<span class="string" id="5721977">&#34;&#34;</span>&nbsp;<span class="op" id="5721980">&amp;&amp;</span>&nbsp;<span class="ident" id="5721983">tag</span>&nbsp;<span class="op" id="5721987">==</span>&nbsp;<span class="string" id="5721990">&#34;&#34;</span>&nbsp;<span class="op" id="5721993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721997">return</span>&nbsp;<span class="ident" id="5722004">nil</span><span class="op" id="5722007">,</span>&nbsp;<span class="ident" id="5722009">fmt</span><span class="op" id="5722012">.</span><span class="ident" id="5722013">Errorf</span><span class="op" id="5722019">(</span><span class="string" id="5722020">&#34;xml:&nbsp;namespace&nbsp;without&nbsp;name&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="5722076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722081">f</span><span class="op" id="5722082">.</span><span class="ident" id="5722083">Name</span><span class="op" id="5722087">,</span>&nbsp;<span class="ident" id="5722089">typ</span><span class="op" id="5722092">,</span>&nbsp;<span class="ident" id="5722094">f</span><span class="op" id="5722095">.</span><span class="ident" id="5722096">Tag</span><span class="op" id="5722099">.</span><span class="ident" id="5722100">Get</span><span class="op" id="5722103">(</span><span class="string" id="5722104">&#34;xml&#34;</span><span class="op" id="5722109">)</span><span class="op" id="5722110">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722117">if</span>&nbsp;<span class="ident" id="5722120">f</span><span class="op" id="5722121">.</span><span class="ident" id="5722122">Name</span>&nbsp;<span class="op" id="5722127">==</span>&nbsp;<span class="string" id="5722130">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5722140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5722144">//&nbsp;The&nbsp;XMLName&nbsp;field&nbsp;records&nbsp;the&nbsp;XML&nbsp;element&nbsp;name.&nbsp;Don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5722203">//&nbsp;process&nbsp;it&nbsp;as&nbsp;usual&nbsp;because&nbsp;its&nbsp;name&nbsp;should&nbsp;default&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5722263">//&nbsp;empty&nbsp;rather&nbsp;than&nbsp;to&nbsp;the&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722305">finfo</span><span class="op" id="5722310">.</span><span class="ident" id="5722311">name</span>&nbsp;<span class="op" id="5722316">=</span>&nbsp;<span class="ident" id="5722318">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722324">return</span>&nbsp;<span class="ident" id="5722331">finfo</span><span class="op" id="5722336">,</span>&nbsp;<span class="ident" id="5722338">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722347">if</span>&nbsp;<span class="ident" id="5722350">tag</span>&nbsp;<span class="op" id="5722354">==</span>&nbsp;<span class="string" id="5722357">&#34;&#34;</span>&nbsp;<span class="op" id="5722360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5722364">//&nbsp;If&nbsp;the&nbsp;name&nbsp;part&nbsp;of&nbsp;the&nbsp;tag&nbsp;is&nbsp;completely&nbsp;empty,&nbsp;get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5722422">//&nbsp;default&nbsp;from&nbsp;XMLName&nbsp;of&nbsp;underlying&nbsp;struct&nbsp;if&nbsp;feasible,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5722482">//&nbsp;or&nbsp;field&nbsp;name&nbsp;otherwise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722512">if</span>&nbsp;<span class="ident" id="5722515">xmlname</span>&nbsp;<span class="op" id="5722523">:=</span>&nbsp;<span class="ident" id="5722526">lookupXMLName</span><span class="op" id="5722539">(</span><span class="ident" id="5722540">f</span><span class="op" id="5722541">.</span><span class="ident" id="5722542">Type</span><span class="op" id="5722546">)</span><span class="op" id="5722547">;</span>&nbsp;<span class="ident" id="5722549">xmlname</span>&nbsp;<span class="op" id="5722557">!=</span>&nbsp;<span class="ident" id="5722560">nil</span>&nbsp;<span class="op" id="5722564">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722569">finfo</span><span class="op" id="5722574">.</span><span class="ident" id="5722575">xmlns</span><span class="op" id="5722580">,</span>&nbsp;<span class="ident" id="5722582">finfo</span><span class="op" id="5722587">.</span><span class="ident" id="5722588">name</span>&nbsp;<span class="op" id="5722593">=</span>&nbsp;<span class="ident" id="5722595">xmlname</span><span class="op" id="5722602">.</span><span class="ident" id="5722603">xmlns</span><span class="op" id="5722608">,</span>&nbsp;<span class="ident" id="5722610">xmlname</span><span class="op" id="5722617">.</span><span class="ident" id="5722618">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722625">}</span>&nbsp;<span class="keyword" id="5722627">else</span>&nbsp;<span class="op" id="5722632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722637">finfo</span><span class="op" id="5722642">.</span><span class="ident" id="5722643">name</span>&nbsp;<span class="op" id="5722648">=</span>&nbsp;<span class="ident" id="5722650">f</span><span class="op" id="5722651">.</span><span class="ident" id="5722652">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722663">return</span>&nbsp;<span class="ident" id="5722670">finfo</span><span class="op" id="5722675">,</span>&nbsp;<span class="ident" id="5722677">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5722686">//&nbsp;Prepare&nbsp;field&nbsp;name&nbsp;and&nbsp;parents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722722">parents</span>&nbsp;<span class="op" id="5722730">:=</span>&nbsp;<span class="ident" id="5722733">strings</span><span class="op" id="5722740">.</span><span class="ident" id="5722741">Split</span><span class="op" id="5722746">(</span><span class="ident" id="5722747">tag</span><span class="op" id="5722750">,</span>&nbsp;<span class="string" id="5722752">&#34;&gt;&#34;</span><span class="op" id="5722755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722758">if</span>&nbsp;<span class="ident" id="5722761">parents</span><span class="op" id="5722768">[</span><span class="num" id="5722769">0</span><span class="op" id="5722770">]</span>&nbsp;<span class="op" id="5722772">==</span>&nbsp;<span class="string" id="5722775">&#34;&#34;</span>&nbsp;<span class="op" id="5722778">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722782">parents</span><span class="op" id="5722789">[</span><span class="num" id="5722790">0</span><span class="op" id="5722791">]</span>&nbsp;<span class="op" id="5722793">=</span>&nbsp;<span class="ident" id="5722795">f</span><span class="op" id="5722796">.</span><span class="ident" id="5722797">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722806">if</span>&nbsp;<span class="ident" id="5722809">parents</span><span class="op" id="5722816">[</span><span class="builtinfunc" id="5722817">len</span><span class="op" id="5722820">(</span><span class="ident" id="5722821">parents</span><span class="op" id="5722828">)</span><span class="op" id="5722829">-</span><span class="num" id="5722830">1</span><span class="op" id="5722831">]</span>&nbsp;<span class="op" id="5722833">==</span>&nbsp;<span class="string" id="5722836">&#34;&#34;</span>&nbsp;<span class="op" id="5722839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722843">return</span>&nbsp;<span class="ident" id="5722850">nil</span><span class="op" id="5722853">,</span>&nbsp;<span class="ident" id="5722855">fmt</span><span class="op" id="5722858">.</span><span class="ident" id="5722859">Errorf</span><span class="op" id="5722865">(</span><span class="string" id="5722866">&#34;xml:&nbsp;trailing&nbsp;&#39;&gt;&#39;&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5722908">,</span>&nbsp;<span class="ident" id="5722910">f</span><span class="op" id="5722911">.</span><span class="ident" id="5722912">Name</span><span class="op" id="5722916">,</span>&nbsp;<span class="ident" id="5722918">typ</span><span class="op" id="5722921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722924">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722927">finfo</span><span class="op" id="5722932">.</span><span class="ident" id="5722933">name</span>&nbsp;<span class="op" id="5722938">=</span>&nbsp;<span class="ident" id="5722940">parents</span><span class="op" id="5722947">[</span><span class="builtinfunc" id="5722948">len</span><span class="op" id="5722951">(</span><span class="ident" id="5722952">parents</span><span class="op" id="5722959">)</span><span class="op" id="5722960">-</span><span class="num" id="5722961">1</span><span class="op" id="5722962">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722965">if</span>&nbsp;<span class="builtinfunc" id="5722968">len</span><span class="op" id="5722971">(</span><span class="ident" id="5722972">parents</span><span class="op" id="5722979">)</span>&nbsp;<span class="op" id="5722981">&gt;</span>&nbsp;<span class="num" id="5722983">1</span>&nbsp;<span class="op" id="5722985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722989">if</span>&nbsp;<span class="op" id="5722992">(</span><span class="ident" id="5722993">finfo</span><span class="op" id="5722998">.</span><span class="ident" id="5722999">flags</span>&nbsp;<span class="op" id="5723005">&amp;</span>&nbsp;<span class="ident" id="5723007">fElement</span><span class="op" id="5723015">)</span>&nbsp;<span class="op" id="5723017">==</span>&nbsp;<span class="num" id="5723020">0</span>&nbsp;<span class="op" id="5723022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723027">return</span>&nbsp;<span class="ident" id="5723034">nil</span><span class="op" id="5723037">,</span>&nbsp;<span class="ident" id="5723039">fmt</span><span class="op" id="5723042">.</span><span class="ident" id="5723043">Errorf</span><span class="op" id="5723049">(</span><span class="string" id="5723050">&#34;xml:&nbsp;%s&nbsp;chain&nbsp;not&nbsp;valid&nbsp;with&nbsp;%s&nbsp;flag&#34;</span><span class="op" id="5723088">,</span>&nbsp;<span class="ident" id="5723090">tag</span><span class="op" id="5723093">,</span>&nbsp;<span class="ident" id="5723095">strings</span><span class="op" id="5723102">.</span><span class="ident" id="5723103">Join</span><span class="op" id="5723107">(</span><span class="ident" id="5723108">tokens</span><span class="op" id="5723114">[</span><span class="num" id="5723115">1</span><span class="op" id="5723116">:</span><span class="op" id="5723117">]</span><span class="op" id="5723118">,</span>&nbsp;<span class="string" id="5723120">&#34;,&#34;</span><span class="op" id="5723123">)</span><span class="op" id="5723124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5723128">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5723132">finfo</span><span class="op" id="5723137">.</span><span class="ident" id="5723138">parents</span>&nbsp;<span class="op" id="5723146">=</span>&nbsp;<span class="ident" id="5723148">parents</span><span class="op" id="5723155">[</span><span class="op" id="5723156">:</span><span class="builtinfunc" id="5723157">len</span><span class="op" id="5723160">(</span><span class="ident" id="5723161">parents</span><span class="op" id="5723168">)</span><span class="op" id="5723169">-</span><span class="num" id="5723170">1</span><span class="op" id="5723171">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5723174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5723178">//&nbsp;If&nbsp;the&nbsp;field&nbsp;type&nbsp;has&nbsp;an&nbsp;XMLName&nbsp;field,&nbsp;the&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5723243">//&nbsp;so&nbsp;that&nbsp;the&nbsp;behavior&nbsp;of&nbsp;both&nbsp;marshalling&nbsp;and&nbsp;unmarshalling</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5723306">//&nbsp;is&nbsp;straightforward&nbsp;and&nbsp;unambiguous.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723346">if</span>&nbsp;<span class="ident" id="5723349">finfo</span><span class="op" id="5723354">.</span><span class="ident" id="5723355">flags</span><span class="op" id="5723360">&amp;</span><span class="ident" id="5723361">fElement</span>&nbsp;<span class="op" id="5723370">!=</span>&nbsp;<span class="num" id="5723373">0</span>&nbsp;<span class="op" id="5723375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5723379">ftyp</span>&nbsp;<span class="op" id="5723384">:=</span>&nbsp;<span class="ident" id="5723387">f</span><span class="op" id="5723388">.</span><span class="ident" id="5723389">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5723396">xmlname</span>&nbsp;<span class="op" id="5723404">:=</span>&nbsp;<span class="ident" id="5723407">lookupXMLName</span><span class="op" id="5723420">(</span><span class="ident" id="5723421">ftyp</span><span class="op" id="5723425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723429">if</span>&nbsp;<span class="ident" id="5723432">xmlname</span>&nbsp;<span class="op" id="5723440">!=</span>&nbsp;<span class="ident" id="5723443">nil</span>&nbsp;<span class="op" id="5723447">&amp;&amp;</span>&nbsp;<span class="ident" id="5723450">xmlname</span><span class="op" id="5723457">.</span><span class="ident" id="5723458">name</span>&nbsp;<span class="op" id="5723463">!=</span>&nbsp;<span class="ident" id="5723466">finfo</span><span class="op" id="5723471">.</span><span class="ident" id="5723472">name</span>&nbsp;<span class="op" id="5723477">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723482">return</span>&nbsp;<span class="ident" id="5723489">nil</span><span class="op" id="5723492">,</span>&nbsp;<span class="ident" id="5723494">fmt</span><span class="op" id="5723497">.</span><span class="ident" id="5723498">Errorf</span><span class="op" id="5723504">(</span><span class="string" id="5723505">&#34;xml:&nbsp;name&nbsp;%q&nbsp;in&nbsp;tag&nbsp;of&nbsp;%s.%s&nbsp;conflicts&nbsp;with&nbsp;name&nbsp;%q&nbsp;in&nbsp;%s.XMLName&#34;</span><span class="op" id="5723572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5723578">finfo</span><span class="op" id="5723583">.</span><span class="ident" id="5723584">name</span><span class="op" id="5723588">,</span>&nbsp;<span class="ident" id="5723590">typ</span><span class="op" id="5723593">,</span>&nbsp;<span class="ident" id="5723595">f</span><span class="op" id="5723596">.</span><span class="ident" id="5723597">Name</span><span class="op" id="5723601">,</span>&nbsp;<span class="ident" id="5723603">xmlname</span><span class="op" id="5723610">.</span><span class="ident" id="5723611">name</span><span class="op" id="5723615">,</span>&nbsp;<span class="ident" id="5723617">ftyp</span><span class="op" id="5723621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5723625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5723628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723631">return</span>&nbsp;<span class="ident" id="5723638">finfo</span><span class="op" id="5723643">,</span>&nbsp;<span class="ident" id="5723645">nil</span><br>
<span class="lineno">225</span><span class="op" id="5723649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5723652">//&nbsp;lookupXMLName&nbsp;returns&nbsp;the&nbsp;fieldInfo&nbsp;for&nbsp;typ&#39;s&nbsp;XMLName&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5723715">//&nbsp;in&nbsp;case&nbsp;it&nbsp;exists&nbsp;and&nbsp;has&nbsp;a&nbsp;valid&nbsp;xml&nbsp;field&nbsp;tag,&nbsp;otherwise</span><br>
<span class="lineno"></span><span class="comment" id="5723777">//&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">230</span><span class="keyword" id="5723796">func</span>&nbsp;<span class="ident" id="5723801">lookupXMLName</span><span class="op" id="5723814">(</span><span class="ident" id="5723815">typ</span>&nbsp;<span class="ident" id="5723819">reflect</span><span class="op" id="5723826">.</span><span class="ident" id="5723827">Type</span><span class="op" id="5723831">)</span>&nbsp;<span class="op" id="5723833">(</span><span class="ident" id="5723834">xmlname</span>&nbsp;<span class="op" id="5723842">*</span><span class="ident" id="5723843">fieldInfo</span><span class="op" id="5723852">)</span>&nbsp;<span class="op" id="5723854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723857">for</span>&nbsp;<span class="ident" id="5723861">typ</span><span class="op" id="5723864">.</span><span class="ident" id="5723865">Kind</span><span class="op" id="5723869">(</span><span class="op" id="5723870">)</span>&nbsp;<span class="op" id="5723872">==</span>&nbsp;<span class="ident" id="5723875">reflect</span><span class="op" id="5723882">.</span><span class="ident" id="5723883">Ptr</span>&nbsp;<span class="op" id="5723887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5723891">typ</span>&nbsp;<span class="op" id="5723895">=</span>&nbsp;<span class="ident" id="5723897">typ</span><span class="op" id="5723900">.</span><span class="ident" id="5723901">Elem</span><span class="op" id="5723905">(</span><span class="op" id="5723906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5723909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723912">if</span>&nbsp;<span class="ident" id="5723915">typ</span><span class="op" id="5723918">.</span><span class="ident" id="5723919">Kind</span><span class="op" id="5723923">(</span><span class="op" id="5723924">)</span>&nbsp;<span class="op" id="5723926">!=</span>&nbsp;<span class="ident" id="5723929">reflect</span><span class="op" id="5723936">.</span><span class="ident" id="5723937">Struct</span>&nbsp;<span class="op" id="5723944">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723948">return</span>&nbsp;<span class="ident" id="5723955">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5723960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723963">for</span>&nbsp;<span class="ident" id="5723967">i</span><span class="op" id="5723968">,</span>&nbsp;<span class="ident" id="5723970">n</span>&nbsp;<span class="op" id="5723972">:=</span>&nbsp;<span class="num" id="5723975">0</span><span class="op" id="5723976">,</span>&nbsp;<span class="ident" id="5723978">typ</span><span class="op" id="5723981">.</span><span class="ident" id="5723982">NumField</span><span class="op" id="5723990">(</span><span class="op" id="5723991">)</span><span class="op" id="5723992">;</span>&nbsp;<span class="ident" id="5723994">i</span>&nbsp;<span class="op" id="5723996">&lt;</span>&nbsp;<span class="ident" id="5723998">n</span><span class="op" id="5723999">;</span>&nbsp;<span class="ident" id="5724001">i</span><span class="op" id="5724002">++</span>&nbsp;<span class="op" id="5724005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5724009">f</span>&nbsp;<span class="op" id="5724011">:=</span>&nbsp;<span class="ident" id="5724014">typ</span><span class="op" id="5724017">.</span><span class="ident" id="5724018">Field</span><span class="op" id="5724023">(</span><span class="ident" id="5724024">i</span><span class="op" id="5724025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724029">if</span>&nbsp;<span class="ident" id="5724032">f</span><span class="op" id="5724033">.</span><span class="ident" id="5724034">Name</span>&nbsp;<span class="op" id="5724039">!=</span>&nbsp;<span class="string" id="5724042">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="5724052">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724057">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5724068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5724072">finfo</span><span class="op" id="5724077">,</span>&nbsp;<span class="ident" id="5724079">err</span>&nbsp;<span class="op" id="5724083">:=</span>&nbsp;<span class="ident" id="5724086">structFieldInfo</span><span class="op" id="5724101">(</span><span class="ident" id="5724102">typ</span><span class="op" id="5724105">,</span>&nbsp;<span class="op" id="5724107">&amp;</span><span class="ident" id="5724108">f</span><span class="op" id="5724109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724113">if</span>&nbsp;<span class="ident" id="5724116">finfo</span><span class="op" id="5724121">.</span><span class="ident" id="5724122">name</span>&nbsp;<span class="op" id="5724127">!=</span>&nbsp;<span class="string" id="5724130">&#34;&#34;</span>&nbsp;<span class="op" id="5724133">&amp;&amp;</span>&nbsp;<span class="ident" id="5724136">err</span>&nbsp;<span class="op" id="5724140">==</span>&nbsp;<span class="ident" id="5724143">nil</span>&nbsp;<span class="op" id="5724147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724152">return</span>&nbsp;<span class="ident" id="5724159">finfo</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5724167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5724171">//&nbsp;Also&nbsp;consider&nbsp;errors&nbsp;as&nbsp;a&nbsp;non-existent&nbsp;field&nbsp;tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5724225">//&nbsp;and&nbsp;let&nbsp;getTypeInfo&nbsp;itself&nbsp;report&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724275">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5724282">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724285">return</span>&nbsp;<span class="ident" id="5724292">nil</span><br>
<span class="lineno"></span><span class="op" id="5724296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5724299">func</span>&nbsp;<span class="ident" id="5724304">min</span><span class="op" id="5724307">(</span><span class="ident" id="5724308">a</span><span class="op" id="5724309">,</span>&nbsp;<span class="ident" id="5724311">b</span>&nbsp;<span class="builtintype" id="5724313">int</span><span class="op" id="5724316">)</span>&nbsp;<span class="builtintype" id="5724318">int</span>&nbsp;<span class="op" id="5724322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724325">if</span>&nbsp;<span class="ident" id="5724328">a</span>&nbsp;<span class="op" id="5724330">&lt;=</span>&nbsp;<span class="ident" id="5724333">b</span>&nbsp;<span class="op" id="5724335">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724339">return</span>&nbsp;<span class="ident" id="5724346">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5724349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724352">return</span>&nbsp;<span class="ident" id="5724359">b</span><br>
<span class="lineno"></span><span class="op" id="5724361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="5724364">//&nbsp;addFieldInfo&nbsp;adds&nbsp;finfo&nbsp;to&nbsp;tinfo.fields&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5724423">//&nbsp;conflicts,&nbsp;or&nbsp;if&nbsp;conflicts&nbsp;arise&nbsp;from&nbsp;previous&nbsp;fields&nbsp;that&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="5724490">//&nbsp;obtained&nbsp;from&nbsp;deeper&nbsp;embedded&nbsp;structures&nbsp;than&nbsp;finfo.&nbsp;In&nbsp;the&nbsp;latter</span><br>
<span class="lineno"></span><span class="comment" id="5724560">//&nbsp;case,&nbsp;the&nbsp;conflicting&nbsp;entries&nbsp;are&nbsp;dropped.</span><br>
<span class="lineno"></span><span class="comment" id="5724606">//&nbsp;A&nbsp;conflict&nbsp;occurs&nbsp;when&nbsp;the&nbsp;path&nbsp;(parent&nbsp;+&nbsp;name)&nbsp;to&nbsp;a&nbsp;field&nbsp;is</span><br>
<span class="lineno">265</span><span class="comment" id="5724671">//&nbsp;itself&nbsp;a&nbsp;prefix&nbsp;of&nbsp;another&nbsp;path,&nbsp;or&nbsp;when&nbsp;two&nbsp;paths&nbsp;match&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="comment" id="5724740">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;for&nbsp;field&nbsp;paths&nbsp;to&nbsp;share&nbsp;a&nbsp;common,&nbsp;shorter&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="5724805">func</span>&nbsp;<span class="ident" id="5724810">addFieldInfo</span><span class="op" id="5724822">(</span><span class="ident" id="5724823">typ</span>&nbsp;<span class="ident" id="5724827">reflect</span><span class="op" id="5724834">.</span><span class="ident" id="5724835">Type</span><span class="op" id="5724839">,</span>&nbsp;<span class="ident" id="5724841">tinfo</span>&nbsp;<span class="op" id="5724847">*</span><span class="ident" id="5724848">typeInfo</span><span class="op" id="5724856">,</span>&nbsp;<span class="ident" id="5724858">newf</span>&nbsp;<span class="op" id="5724863">*</span><span class="ident" id="5724864">fieldInfo</span><span class="op" id="5724873">)</span>&nbsp;<span class="builtintype" id="5724875">error</span>&nbsp;<span class="op" id="5724881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724884">var</span>&nbsp;<span class="ident" id="5724888">conflicts</span>&nbsp;<span class="op" id="5724898">[</span><span class="op" id="5724899">]</span><span class="builtintype" id="5724900">int</span><br>
<span class="lineno"></span><span class="ident" id="5724904">Loop</span><span class="op" id="5724908">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5724911">//&nbsp;First,&nbsp;figure&nbsp;all&nbsp;conflicts.&nbsp;Most&nbsp;working&nbsp;code&nbsp;will&nbsp;have&nbsp;none.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724978">for</span>&nbsp;<span class="ident" id="5724982">i</span>&nbsp;<span class="op" id="5724984">:=</span>&nbsp;<span class="keyword" id="5724987">range</span>&nbsp;<span class="ident" id="5724993">tinfo</span><span class="op" id="5724998">.</span><span class="ident" id="5724999">fields</span>&nbsp;<span class="op" id="5725006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725010">oldf</span>&nbsp;<span class="op" id="5725015">:=</span>&nbsp;<span class="op" id="5725018">&amp;</span><span class="ident" id="5725019">tinfo</span><span class="op" id="5725024">.</span><span class="ident" id="5725025">fields</span><span class="op" id="5725031">[</span><span class="ident" id="5725032">i</span><span class="op" id="5725033">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725037">if</span>&nbsp;<span class="ident" id="5725040">oldf</span><span class="op" id="5725044">.</span><span class="ident" id="5725045">flags</span><span class="op" id="5725050">&amp;</span><span class="ident" id="5725051">fMode</span>&nbsp;<span class="op" id="5725057">!=</span>&nbsp;<span class="ident" id="5725060">newf</span><span class="op" id="5725064">.</span><span class="ident" id="5725065">flags</span><span class="op" id="5725070">&amp;</span><span class="ident" id="5725071">fMode</span>&nbsp;<span class="op" id="5725077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725082">continue</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725097">if</span>&nbsp;<span class="ident" id="5725100">oldf</span><span class="op" id="5725104">.</span><span class="ident" id="5725105">xmlns</span>&nbsp;<span class="op" id="5725111">!=</span>&nbsp;<span class="string" id="5725114">&#34;&#34;</span>&nbsp;<span class="op" id="5725117">&amp;&amp;</span>&nbsp;<span class="ident" id="5725120">newf</span><span class="op" id="5725124">.</span><span class="ident" id="5725125">xmlns</span>&nbsp;<span class="op" id="5725131">!=</span>&nbsp;<span class="string" id="5725134">&#34;&#34;</span>&nbsp;<span class="op" id="5725137">&amp;&amp;</span>&nbsp;<span class="ident" id="5725140">oldf</span><span class="op" id="5725144">.</span><span class="ident" id="5725145">xmlns</span>&nbsp;<span class="op" id="5725151">!=</span>&nbsp;<span class="ident" id="5725154">newf</span><span class="op" id="5725158">.</span><span class="ident" id="5725159">xmlns</span>&nbsp;<span class="op" id="5725165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725170">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725185">minl</span>&nbsp;<span class="op" id="5725190">:=</span>&nbsp;<span class="ident" id="5725193">min</span><span class="op" id="5725196">(</span><span class="builtinfunc" id="5725197">len</span><span class="op" id="5725200">(</span><span class="ident" id="5725201">newf</span><span class="op" id="5725205">.</span><span class="ident" id="5725206">parents</span><span class="op" id="5725213">)</span><span class="op" id="5725214">,</span>&nbsp;<span class="builtinfunc" id="5725216">len</span><span class="op" id="5725219">(</span><span class="ident" id="5725220">oldf</span><span class="op" id="5725224">.</span><span class="ident" id="5725225">parents</span><span class="op" id="5725232">)</span><span class="op" id="5725233">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725237">for</span>&nbsp;<span class="ident" id="5725241">p</span>&nbsp;<span class="op" id="5725243">:=</span>&nbsp;<span class="num" id="5725246">0</span><span class="op" id="5725247">;</span>&nbsp;<span class="ident" id="5725249">p</span>&nbsp;<span class="op" id="5725251">&lt;</span>&nbsp;<span class="ident" id="5725253">minl</span><span class="op" id="5725257">;</span>&nbsp;<span class="ident" id="5725259">p</span><span class="op" id="5725260">++</span>&nbsp;<span class="op" id="5725263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725268">if</span>&nbsp;<span class="ident" id="5725271">oldf</span><span class="op" id="5725275">.</span><span class="ident" id="5725276">parents</span><span class="op" id="5725283">[</span><span class="ident" id="5725284">p</span><span class="op" id="5725285">]</span>&nbsp;<span class="op" id="5725287">!=</span>&nbsp;<span class="ident" id="5725290">newf</span><span class="op" id="5725294">.</span><span class="ident" id="5725295">parents</span><span class="op" id="5725302">[</span><span class="ident" id="5725303">p</span><span class="op" id="5725304">]</span>&nbsp;<span class="op" id="5725306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725312">continue</span>&nbsp;<span class="ident" id="5725321">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725333">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725337">if</span>&nbsp;<span class="builtinfunc" id="5725340">len</span><span class="op" id="5725343">(</span><span class="ident" id="5725344">oldf</span><span class="op" id="5725348">.</span><span class="ident" id="5725349">parents</span><span class="op" id="5725356">)</span>&nbsp;<span class="op" id="5725358">&gt;</span>&nbsp;<span class="builtinfunc" id="5725360">len</span><span class="op" id="5725363">(</span><span class="ident" id="5725364">newf</span><span class="op" id="5725368">.</span><span class="ident" id="5725369">parents</span><span class="op" id="5725376">)</span>&nbsp;<span class="op" id="5725378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725383">if</span>&nbsp;<span class="ident" id="5725386">oldf</span><span class="op" id="5725390">.</span><span class="ident" id="5725391">parents</span><span class="op" id="5725398">[</span><span class="builtinfunc" id="5725399">len</span><span class="op" id="5725402">(</span><span class="ident" id="5725403">newf</span><span class="op" id="5725407">.</span><span class="ident" id="5725408">parents</span><span class="op" id="5725415">)</span><span class="op" id="5725416">]</span>&nbsp;<span class="op" id="5725418">==</span>&nbsp;<span class="ident" id="5725421">newf</span><span class="op" id="5725425">.</span><span class="ident" id="5725426">name</span>&nbsp;<span class="op" id="5725431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725437">conflicts</span>&nbsp;<span class="op" id="5725447">=</span>&nbsp;<span class="builtinfunc" id="5725449">append</span><span class="op" id="5725455">(</span><span class="ident" id="5725456">conflicts</span><span class="op" id="5725465">,</span>&nbsp;<span class="ident" id="5725467">i</span><span class="op" id="5725468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725477">}</span>&nbsp;<span class="keyword" id="5725479">else</span>&nbsp;<span class="keyword" id="5725484">if</span>&nbsp;<span class="builtinfunc" id="5725487">len</span><span class="op" id="5725490">(</span><span class="ident" id="5725491">oldf</span><span class="op" id="5725495">.</span><span class="ident" id="5725496">parents</span><span class="op" id="5725503">)</span>&nbsp;<span class="op" id="5725505">&lt;</span>&nbsp;<span class="builtinfunc" id="5725507">len</span><span class="op" id="5725510">(</span><span class="ident" id="5725511">newf</span><span class="op" id="5725515">.</span><span class="ident" id="5725516">parents</span><span class="op" id="5725523">)</span>&nbsp;<span class="op" id="5725525">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725530">if</span>&nbsp;<span class="ident" id="5725533">newf</span><span class="op" id="5725537">.</span><span class="ident" id="5725538">parents</span><span class="op" id="5725545">[</span><span class="builtinfunc" id="5725546">len</span><span class="op" id="5725549">(</span><span class="ident" id="5725550">oldf</span><span class="op" id="5725554">.</span><span class="ident" id="5725555">parents</span><span class="op" id="5725562">)</span><span class="op" id="5725563">]</span>&nbsp;<span class="op" id="5725565">==</span>&nbsp;<span class="ident" id="5725568">oldf</span><span class="op" id="5725572">.</span><span class="ident" id="5725573">name</span>&nbsp;<span class="op" id="5725578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725584">conflicts</span>&nbsp;<span class="op" id="5725594">=</span>&nbsp;<span class="builtinfunc" id="5725596">append</span><span class="op" id="5725602">(</span><span class="ident" id="5725603">conflicts</span><span class="op" id="5725612">,</span>&nbsp;<span class="ident" id="5725614">i</span><span class="op" id="5725615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725624">}</span>&nbsp;<span class="keyword" id="5725626">else</span>&nbsp;<span class="op" id="5725631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725636">if</span>&nbsp;<span class="ident" id="5725639">newf</span><span class="op" id="5725643">.</span><span class="ident" id="5725644">name</span>&nbsp;<span class="op" id="5725649">==</span>&nbsp;<span class="ident" id="5725652">oldf</span><span class="op" id="5725656">.</span><span class="ident" id="5725657">name</span>&nbsp;<span class="op" id="5725662">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725668">conflicts</span>&nbsp;<span class="op" id="5725678">=</span>&nbsp;<span class="builtinfunc" id="5725680">append</span><span class="op" id="5725686">(</span><span class="ident" id="5725687">conflicts</span><span class="op" id="5725696">,</span>&nbsp;<span class="ident" id="5725698">i</span><span class="op" id="5725699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5725714">//&nbsp;Without&nbsp;conflicts,&nbsp;add&nbsp;the&nbsp;new&nbsp;field&nbsp;and&nbsp;return.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725767">if</span>&nbsp;<span class="ident" id="5725770">conflicts</span>&nbsp;<span class="op" id="5725780">==</span>&nbsp;<span class="ident" id="5725783">nil</span>&nbsp;<span class="op" id="5725787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725791">tinfo</span><span class="op" id="5725796">.</span><span class="ident" id="5725797">fields</span>&nbsp;<span class="op" id="5725804">=</span>&nbsp;<span class="builtinfunc" id="5725806">append</span><span class="op" id="5725812">(</span><span class="ident" id="5725813">tinfo</span><span class="op" id="5725818">.</span><span class="ident" id="5725819">fields</span><span class="op" id="5725825">,</span>&nbsp;<span class="op" id="5725827">*</span><span class="ident" id="5725828">newf</span><span class="op" id="5725832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725836">return</span>&nbsp;<span class="ident" id="5725843">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5725852">//&nbsp;If&nbsp;any&nbsp;conflict&nbsp;is&nbsp;shallower,&nbsp;ignore&nbsp;the&nbsp;new&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5725908">//&nbsp;This&nbsp;matches&nbsp;the&nbsp;Go&nbsp;field&nbsp;resolution&nbsp;on&nbsp;embedding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725963">for</span>&nbsp;<span class="ident" id="5725967">_</span><span class="op" id="5725968">,</span>&nbsp;<span class="ident" id="5725970">i</span>&nbsp;<span class="op" id="5725972">:=</span>&nbsp;<span class="keyword" id="5725975">range</span>&nbsp;<span class="ident" id="5725981">conflicts</span>&nbsp;<span class="op" id="5725991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725995">if</span>&nbsp;<span class="builtinfunc" id="5725998">len</span><span class="op" id="5726001">(</span><span class="ident" id="5726002">tinfo</span><span class="op" id="5726007">.</span><span class="ident" id="5726008">fields</span><span class="op" id="5726014">[</span><span class="ident" id="5726015">i</span><span class="op" id="5726016">]</span><span class="op" id="5726017">.</span><span class="ident" id="5726018">idx</span><span class="op" id="5726021">)</span>&nbsp;<span class="op" id="5726023">&lt;</span>&nbsp;<span class="builtinfunc" id="5726025">len</span><span class="op" id="5726028">(</span><span class="ident" id="5726029">newf</span><span class="op" id="5726033">.</span><span class="ident" id="5726034">idx</span><span class="op" id="5726037">)</span>&nbsp;<span class="op" id="5726039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5726044">return</span>&nbsp;<span class="ident" id="5726051">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5726057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5726060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5726064">//&nbsp;Otherwise,&nbsp;if&nbsp;any&nbsp;of&nbsp;them&nbsp;is&nbsp;at&nbsp;the&nbsp;same&nbsp;depth&nbsp;level,&nbsp;it&#39;s&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5726137">for</span>&nbsp;<span class="ident" id="5726141">_</span><span class="op" id="5726142">,</span>&nbsp;<span class="ident" id="5726144">i</span>&nbsp;<span class="op" id="5726146">:=</span>&nbsp;<span class="keyword" id="5726149">range</span>&nbsp;<span class="ident" id="5726155">conflicts</span>&nbsp;<span class="op" id="5726165">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726169">oldf</span>&nbsp;<span class="op" id="5726174">:=</span>&nbsp;<span class="op" id="5726177">&amp;</span><span class="ident" id="5726178">tinfo</span><span class="op" id="5726183">.</span><span class="ident" id="5726184">fields</span><span class="op" id="5726190">[</span><span class="ident" id="5726191">i</span><span class="op" id="5726192">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5726196">if</span>&nbsp;<span class="builtinfunc" id="5726199">len</span><span class="op" id="5726202">(</span><span class="ident" id="5726203">oldf</span><span class="op" id="5726207">.</span><span class="ident" id="5726208">idx</span><span class="op" id="5726211">)</span>&nbsp;<span class="op" id="5726213">==</span>&nbsp;<span class="builtinfunc" id="5726216">len</span><span class="op" id="5726219">(</span><span class="ident" id="5726220">newf</span><span class="op" id="5726224">.</span><span class="ident" id="5726225">idx</span><span class="op" id="5726228">)</span>&nbsp;<span class="op" id="5726230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726235">f1</span>&nbsp;<span class="op" id="5726238">:=</span>&nbsp;<span class="ident" id="5726241">typ</span><span class="op" id="5726244">.</span><span class="ident" id="5726245">FieldByIndex</span><span class="op" id="5726257">(</span><span class="ident" id="5726258">oldf</span><span class="op" id="5726262">.</span><span class="ident" id="5726263">idx</span><span class="op" id="5726266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726271">f2</span>&nbsp;<span class="op" id="5726274">:=</span>&nbsp;<span class="ident" id="5726277">typ</span><span class="op" id="5726280">.</span><span class="ident" id="5726281">FieldByIndex</span><span class="op" id="5726293">(</span><span class="ident" id="5726294">newf</span><span class="op" id="5726298">.</span><span class="ident" id="5726299">idx</span><span class="op" id="5726302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5726307">return</span>&nbsp;<span class="op" id="5726314">&amp;</span><span class="ident" id="5726315">TagPathError</span><span class="op" id="5726327">{</span><span class="ident" id="5726328">typ</span><span class="op" id="5726331">,</span>&nbsp;<span class="ident" id="5726333">f1</span><span class="op" id="5726335">.</span><span class="ident" id="5726336">Name</span><span class="op" id="5726340">,</span>&nbsp;<span class="ident" id="5726342">f1</span><span class="op" id="5726344">.</span><span class="ident" id="5726345">Tag</span><span class="op" id="5726348">.</span><span class="ident" id="5726349">Get</span><span class="op" id="5726352">(</span><span class="string" id="5726353">&#34;xml&#34;</span><span class="op" id="5726358">)</span><span class="op" id="5726359">,</span>&nbsp;<span class="ident" id="5726361">f2</span><span class="op" id="5726363">.</span><span class="ident" id="5726364">Name</span><span class="op" id="5726368">,</span>&nbsp;<span class="ident" id="5726370">f2</span><span class="op" id="5726372">.</span><span class="ident" id="5726373">Tag</span><span class="op" id="5726376">.</span><span class="ident" id="5726377">Get</span><span class="op" id="5726380">(</span><span class="string" id="5726381">&#34;xml&#34;</span><span class="op" id="5726386">)</span><span class="op" id="5726387">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5726391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5726394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5726398">//&nbsp;Otherwise,&nbsp;the&nbsp;new&nbsp;field&nbsp;is&nbsp;shallower,&nbsp;and&nbsp;thus&nbsp;takes&nbsp;precedence,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5726468">//&nbsp;so&nbsp;drop&nbsp;the&nbsp;conflicting&nbsp;fields&nbsp;from&nbsp;tinfo&nbsp;and&nbsp;append&nbsp;the&nbsp;new&nbsp;one.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5726538">for</span>&nbsp;<span class="ident" id="5726542">c</span>&nbsp;<span class="op" id="5726544">:=</span>&nbsp;<span class="builtinfunc" id="5726547">len</span><span class="op" id="5726550">(</span><span class="ident" id="5726551">conflicts</span><span class="op" id="5726560">)</span>&nbsp;<span class="op" id="5726562">-</span>&nbsp;<span class="num" id="5726564">1</span><span class="op" id="5726565">;</span>&nbsp;<span class="ident" id="5726567">c</span>&nbsp;<span class="op" id="5726569">&gt;=</span>&nbsp;<span class="num" id="5726572">0</span><span class="op" id="5726573">;</span>&nbsp;<span class="ident" id="5726575">c</span><span class="op" id="5726576">--</span>&nbsp;<span class="op" id="5726579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726583">i</span>&nbsp;<span class="op" id="5726585">:=</span>&nbsp;<span class="ident" id="5726588">conflicts</span><span class="op" id="5726597">[</span><span class="ident" id="5726598">c</span><span class="op" id="5726599">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5726603">copy</span><span class="op" id="5726607">(</span><span class="ident" id="5726608">tinfo</span><span class="op" id="5726613">.</span><span class="ident" id="5726614">fields</span><span class="op" id="5726620">[</span><span class="ident" id="5726621">i</span><span class="op" id="5726622">:</span><span class="op" id="5726623">]</span><span class="op" id="5726624">,</span>&nbsp;<span class="ident" id="5726626">tinfo</span><span class="op" id="5726631">.</span><span class="ident" id="5726632">fields</span><span class="op" id="5726638">[</span><span class="ident" id="5726639">i</span><span class="op" id="5726640">+</span><span class="num" id="5726641">1</span><span class="op" id="5726642">:</span><span class="op" id="5726643">]</span><span class="op" id="5726644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726648">tinfo</span><span class="op" id="5726653">.</span><span class="ident" id="5726654">fields</span>&nbsp;<span class="op" id="5726661">=</span>&nbsp;<span class="ident" id="5726663">tinfo</span><span class="op" id="5726668">.</span><span class="ident" id="5726669">fields</span><span class="op" id="5726675">[</span><span class="op" id="5726676">:</span><span class="builtinfunc" id="5726677">len</span><span class="op" id="5726680">(</span><span class="ident" id="5726681">tinfo</span><span class="op" id="5726686">.</span><span class="ident" id="5726687">fields</span><span class="op" id="5726693">)</span><span class="op" id="5726694">-</span><span class="num" id="5726695">1</span><span class="op" id="5726696">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5726699">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726702">tinfo</span><span class="op" id="5726707">.</span><span class="ident" id="5726708">fields</span>&nbsp;<span class="op" id="5726715">=</span>&nbsp;<span class="builtinfunc" id="5726717">append</span><span class="op" id="5726723">(</span><span class="ident" id="5726724">tinfo</span><span class="op" id="5726729">.</span><span class="ident" id="5726730">fields</span><span class="op" id="5726736">,</span>&nbsp;<span class="op" id="5726738">*</span><span class="ident" id="5726739">newf</span><span class="op" id="5726743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5726746">return</span>&nbsp;<span class="ident" id="5726753">nil</span><br>
<span class="lineno"></span><span class="op" id="5726757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5726760">//&nbsp;A&nbsp;TagPathError&nbsp;represents&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;unmarshalling&nbsp;process</span><br>
<span class="lineno">335</span><span class="comment" id="5726827">//&nbsp;caused&nbsp;by&nbsp;the&nbsp;use&nbsp;of&nbsp;field&nbsp;tags&nbsp;with&nbsp;conflicting&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="5726886">type</span>&nbsp;<span class="ident" id="5726891">TagPathError</span>&nbsp;<span class="keyword" id="5726904">struct</span>&nbsp;<span class="op" id="5726911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726914">Struct</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5726927">reflect</span><span class="op" id="5726934">.</span><span class="ident" id="5726935">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726941">Field1</span><span class="op" id="5726947">,</span>&nbsp;<span class="ident" id="5726949">Tag1</span>&nbsp;<span class="builtintype" id="5726954">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5726962">Field2</span><span class="op" id="5726968">,</span>&nbsp;<span class="ident" id="5726970">Tag2</span>&nbsp;<span class="builtintype" id="5726975">string</span><br>
<span class="lineno">340</span><span class="op" id="5726982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5726985">func</span>&nbsp;<span class="op" id="5726990">(</span><span class="ident" id="5726991">e</span>&nbsp;<span class="op" id="5726993">*</span><span class="ident" id="5726994">TagPathError</span><span class="op" id="5727006">)</span>&nbsp;<span class="ident" id="5727008">Error</span><span class="op" id="5727013">(</span><span class="op" id="5727014">)</span>&nbsp;<span class="builtintype" id="5727016">string</span>&nbsp;<span class="op" id="5727023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5727026">return</span>&nbsp;<span class="ident" id="5727033">fmt</span><span class="op" id="5727036">.</span><span class="ident" id="5727037">Sprintf</span><span class="op" id="5727044">(</span><span class="string" id="5727045">&#34;%s&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&nbsp;conflicts&nbsp;with&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&#34;</span><span class="op" id="5727106">,</span>&nbsp;<span class="ident" id="5727108">e</span><span class="op" id="5727109">.</span><span class="ident" id="5727110">Struct</span><span class="op" id="5727116">,</span>&nbsp;<span class="ident" id="5727118">e</span><span class="op" id="5727119">.</span><span class="ident" id="5727120">Field1</span><span class="op" id="5727126">,</span>&nbsp;<span class="ident" id="5727128">e</span><span class="op" id="5727129">.</span><span class="ident" id="5727130">Tag1</span><span class="op" id="5727134">,</span>&nbsp;<span class="ident" id="5727136">e</span><span class="op" id="5727137">.</span><span class="ident" id="5727138">Field2</span><span class="op" id="5727144">,</span>&nbsp;<span class="ident" id="5727146">e</span><span class="op" id="5727147">.</span><span class="ident" id="5727148">Tag2</span><span class="op" id="5727152">)</span><br>
<span class="lineno"></span><span class="op" id="5727154">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="5727157">//&nbsp;value&nbsp;returns&nbsp;v&#39;s&nbsp;field&nbsp;value&nbsp;corresponding&nbsp;to&nbsp;finfo.</span><br>
<span class="lineno"></span><span class="comment" id="5727214">//&nbsp;It&#39;s&nbsp;equivalent&nbsp;to&nbsp;v.FieldByIndex(finfo.idx),&nbsp;but&nbsp;initializes</span><br>
<span class="lineno"></span><span class="comment" id="5727279">//&nbsp;and&nbsp;dereferences&nbsp;pointers&nbsp;as&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="5727322">func</span>&nbsp;<span class="op" id="5727327">(</span><span class="ident" id="5727328">finfo</span>&nbsp;<span class="op" id="5727334">*</span><span class="ident" id="5727335">fieldInfo</span><span class="op" id="5727344">)</span>&nbsp;<span class="ident" id="5727346">value</span><span class="op" id="5727351">(</span><span class="ident" id="5727352">v</span>&nbsp;<span class="ident" id="5727354">reflect</span><span class="op" id="5727361">.</span><span class="ident" id="5727362">Value</span><span class="op" id="5727367">)</span>&nbsp;<span class="ident" id="5727369">reflect</span><span class="op" id="5727376">.</span><span class="ident" id="5727377">Value</span>&nbsp;<span class="op" id="5727383">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5727386">for</span>&nbsp;<span class="ident" id="5727390">i</span><span class="op" id="5727391">,</span>&nbsp;<span class="ident" id="5727393">x</span>&nbsp;<span class="op" id="5727395">:=</span>&nbsp;<span class="keyword" id="5727398">range</span>&nbsp;<span class="ident" id="5727404">finfo</span><span class="op" id="5727409">.</span><span class="ident" id="5727410">idx</span>&nbsp;<span class="op" id="5727414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5727418">if</span>&nbsp;<span class="ident" id="5727421">i</span>&nbsp;<span class="op" id="5727423">&gt;</span>&nbsp;<span class="num" id="5727425">0</span>&nbsp;<span class="op" id="5727427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727432">t</span>&nbsp;<span class="op" id="5727434">:=</span>&nbsp;<span class="ident" id="5727437">v</span><span class="op" id="5727438">.</span><span class="ident" id="5727439">Type</span><span class="op" id="5727443">(</span><span class="op" id="5727444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5727449">if</span>&nbsp;<span class="ident" id="5727452">t</span><span class="op" id="5727453">.</span><span class="ident" id="5727454">Kind</span><span class="op" id="5727458">(</span><span class="op" id="5727459">)</span>&nbsp;<span class="op" id="5727461">==</span>&nbsp;<span class="ident" id="5727464">reflect</span><span class="op" id="5727471">.</span><span class="ident" id="5727472">Ptr</span>&nbsp;<span class="op" id="5727476">&amp;&amp;</span>&nbsp;<span class="ident" id="5727479">t</span><span class="op" id="5727480">.</span><span class="ident" id="5727481">Elem</span><span class="op" id="5727485">(</span><span class="op" id="5727486">)</span><span class="op" id="5727487">.</span><span class="ident" id="5727488">Kind</span><span class="op" id="5727492">(</span><span class="op" id="5727493">)</span>&nbsp;<span class="op" id="5727495">==</span>&nbsp;<span class="ident" id="5727498">reflect</span><span class="op" id="5727505">.</span><span class="ident" id="5727506">Struct</span>&nbsp;<span class="op" id="5727513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5727519">if</span>&nbsp;<span class="ident" id="5727522">v</span><span class="op" id="5727523">.</span><span class="ident" id="5727524">IsNil</span><span class="op" id="5727529">(</span><span class="op" id="5727530">)</span>&nbsp;<span class="op" id="5727532">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727539">v</span><span class="op" id="5727540">.</span><span class="ident" id="5727541">Set</span><span class="op" id="5727544">(</span><span class="ident" id="5727545">reflect</span><span class="op" id="5727552">.</span><span class="ident" id="5727553">New</span><span class="op" id="5727556">(</span><span class="ident" id="5727557">v</span><span class="op" id="5727558">.</span><span class="ident" id="5727559">Type</span><span class="op" id="5727563">(</span><span class="op" id="5727564">)</span><span class="op" id="5727565">.</span><span class="ident" id="5727566">Elem</span><span class="op" id="5727570">(</span><span class="op" id="5727571">)</span><span class="op" id="5727572">)</span><span class="op" id="5727573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5727579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727585">v</span>&nbsp;<span class="op" id="5727587">=</span>&nbsp;<span class="ident" id="5727589">v</span><span class="op" id="5727590">.</span><span class="ident" id="5727591">Elem</span><span class="op" id="5727595">(</span><span class="op" id="5727596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5727601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5727605">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5727609">v</span>&nbsp;<span class="op" id="5727611">=</span>&nbsp;<span class="ident" id="5727613">v</span><span class="op" id="5727614">.</span><span class="ident" id="5727615">Field</span><span class="op" id="5727620">(</span><span class="ident" id="5727621">x</span><span class="op" id="5727622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5727625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5727628">return</span>&nbsp;<span class="ident" id="5727635">v</span><br>
<span class="lineno"></span><span class="op" id="5727637">}</span>
</div>
</body>
</html>
