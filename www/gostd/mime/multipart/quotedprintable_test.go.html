<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7532940">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7532995">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7533049">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7533100">package</span>&nbsp;<span class="ident" id="7533108">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7533119">import</span>&nbsp;<span class="op" id="7533126">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7533129">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7533138">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7533147">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7533157">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7533165">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7533172">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7533178">&#34;os/exec&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7533189">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7533199">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7533207">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7533218">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7533229">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="7533236">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7533239">func</span>&nbsp;<span class="ident" id="7533244">TestQuotedPrintable</span><span class="op" id="7533263">(</span><span class="ident" id="7533264">t</span>&nbsp;<span class="op" id="7533266">*</span><span class="ident" id="7533267">testing</span><span class="op" id="7533274">.</span><span class="ident" id="7533275">T</span><span class="op" id="7533276">)</span>&nbsp;<span class="op" id="7533278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533281">tests</span>&nbsp;<span class="op" id="7533287">:=</span>&nbsp;<span class="op" id="7533290">[</span><span class="op" id="7533291">]</span><span class="keyword" id="7533292">struct</span>&nbsp;<span class="op" id="7533299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533303">in</span><span class="op" id="7533305">,</span>&nbsp;<span class="ident" id="7533307">want</span>&nbsp;<span class="builtintype" id="7533312">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533321">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7533330">interface</span><span class="op" id="7533339">{</span><span class="op" id="7533340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533343">}</span><span class="op" id="7533344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533348">{</span><span class="ident" id="7533349">in</span><span class="op" id="7533351">:</span>&nbsp;<span class="string" id="7533353">&#34;&#34;</span><span class="op" id="7533355">,</span>&nbsp;<span class="ident" id="7533357">want</span><span class="op" id="7533361">:</span>&nbsp;<span class="string" id="7533363">&#34;&#34;</span><span class="op" id="7533365">}</span><span class="op" id="7533366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533370">{</span><span class="ident" id="7533371">in</span><span class="op" id="7533373">:</span>&nbsp;<span class="string" id="7533375">&#34;foo&nbsp;bar&#34;</span><span class="op" id="7533384">,</span>&nbsp;<span class="ident" id="7533386">want</span><span class="op" id="7533390">:</span>&nbsp;<span class="string" id="7533392">&#34;foo&nbsp;bar&#34;</span><span class="op" id="7533401">}</span><span class="op" id="7533402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533406">{</span><span class="ident" id="7533407">in</span><span class="op" id="7533409">:</span>&nbsp;<span class="string" id="7533411">&#34;foo&nbsp;bar=3D&#34;</span><span class="op" id="7533423">,</span>&nbsp;<span class="ident" id="7533425">want</span><span class="op" id="7533429">:</span>&nbsp;<span class="string" id="7533431">&#34;foo&nbsp;bar=&#34;</span><span class="op" id="7533441">}</span><span class="op" id="7533442">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533446">{</span><span class="ident" id="7533447">in</span><span class="op" id="7533449">:</span>&nbsp;<span class="string" id="7533451">&#34;foo&nbsp;bar=\n&#34;</span><span class="op" id="7533463">,</span>&nbsp;<span class="ident" id="7533465">want</span><span class="op" id="7533469">:</span>&nbsp;<span class="string" id="7533471">&#34;foo&nbsp;bar&#34;</span><span class="op" id="7533480">}</span><span class="op" id="7533481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533485">{</span><span class="ident" id="7533486">in</span><span class="op" id="7533488">:</span>&nbsp;<span class="string" id="7533490">&#34;foo&nbsp;bar\n&#34;</span><span class="op" id="7533501">,</span>&nbsp;<span class="ident" id="7533503">want</span><span class="op" id="7533507">:</span>&nbsp;<span class="string" id="7533509">&#34;foo&nbsp;bar\n&#34;</span><span class="op" id="7533520">}</span><span class="op" id="7533521">,</span>&nbsp;<span class="comment" id="7533523">//&nbsp;somewhat&nbsp;lax.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533542">{</span><span class="ident" id="7533543">in</span><span class="op" id="7533545">:</span>&nbsp;<span class="string" id="7533547">&#34;foo&nbsp;bar=0&#34;</span><span class="op" id="7533558">,</span>&nbsp;<span class="ident" id="7533560">want</span><span class="op" id="7533564">:</span>&nbsp;<span class="string" id="7533566">&#34;foo&nbsp;bar&#34;</span><span class="op" id="7533575">,</span>&nbsp;<span class="ident" id="7533577">err</span><span class="op" id="7533580">:</span>&nbsp;<span class="ident" id="7533582">io</span><span class="op" id="7533584">.</span><span class="ident" id="7533585">ErrUnexpectedEOF</span><span class="op" id="7533601">}</span><span class="op" id="7533602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533606">{</span><span class="ident" id="7533607">in</span><span class="op" id="7533609">:</span>&nbsp;<span class="string" id="7533611">&#34;foo&nbsp;bar=ab&#34;</span><span class="op" id="7533623">,</span>&nbsp;<span class="ident" id="7533625">want</span><span class="op" id="7533629">:</span>&nbsp;<span class="string" id="7533631">&#34;foo&nbsp;bar&#34;</span><span class="op" id="7533640">,</span>&nbsp;<span class="ident" id="7533642">err</span><span class="op" id="7533645">:</span>&nbsp;<span class="string" id="7533647">&#34;multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x61&#34;</span><span class="op" id="7533698">}</span><span class="op" id="7533699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533703">{</span><span class="ident" id="7533704">in</span><span class="op" id="7533706">:</span>&nbsp;<span class="string" id="7533708">&#34;foo&nbsp;bar=0D=0A&#34;</span><span class="op" id="7533723">,</span>&nbsp;<span class="ident" id="7533725">want</span><span class="op" id="7533729">:</span>&nbsp;<span class="string" id="7533731">&#34;foo&nbsp;bar\r\n&#34;</span><span class="op" id="7533744">}</span><span class="op" id="7533745">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533749">{</span><span class="ident" id="7533750">in</span><span class="op" id="7533752">:</span>&nbsp;<span class="string" id="7533754">&#34;&nbsp;A&nbsp;B&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n&nbsp;C&nbsp;&#34;</span><span class="op" id="7533775">,</span>&nbsp;<span class="ident" id="7533777">want</span><span class="op" id="7533781">:</span>&nbsp;<span class="string" id="7533783">&#34;&nbsp;A&nbsp;B\r\n&nbsp;C&#34;</span><span class="op" id="7533795">}</span><span class="op" id="7533796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533800">{</span><span class="ident" id="7533801">in</span><span class="op" id="7533803">:</span>&nbsp;<span class="string" id="7533805">&#34;&nbsp;A&nbsp;B&nbsp;=\r\n&nbsp;C&nbsp;&#34;</span><span class="op" id="7533820">,</span>&nbsp;<span class="ident" id="7533822">want</span><span class="op" id="7533826">:</span>&nbsp;<span class="string" id="7533828">&#34;&nbsp;A&nbsp;B&nbsp;&nbsp;C&#34;</span><span class="op" id="7533837">}</span><span class="op" id="7533838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533842">{</span><span class="ident" id="7533843">in</span><span class="op" id="7533845">:</span>&nbsp;<span class="string" id="7533847">&#34;&nbsp;A&nbsp;B&nbsp;=\n&nbsp;C&nbsp;&#34;</span><span class="op" id="7533860">,</span>&nbsp;<span class="ident" id="7533862">want</span><span class="op" id="7533866">:</span>&nbsp;<span class="string" id="7533868">&#34;&nbsp;A&nbsp;B&nbsp;&nbsp;C&#34;</span><span class="op" id="7533877">}</span><span class="op" id="7533878">,</span>&nbsp;<span class="comment" id="7533880">//&nbsp;lax.&nbsp;treating&nbsp;LF&nbsp;as&nbsp;CRLF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533910">{</span><span class="ident" id="7533911">in</span><span class="op" id="7533913">:</span>&nbsp;<span class="string" id="7533915">&#34;foo=\nbar&#34;</span><span class="op" id="7533926">,</span>&nbsp;<span class="ident" id="7533928">want</span><span class="op" id="7533932">:</span>&nbsp;<span class="string" id="7533934">&#34;foobar&#34;</span><span class="op" id="7533942">}</span><span class="op" id="7533943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533947">{</span><span class="ident" id="7533948">in</span><span class="op" id="7533950">:</span>&nbsp;<span class="string" id="7533952">&#34;foo\x00bar&#34;</span><span class="op" id="7533964">,</span>&nbsp;<span class="ident" id="7533966">want</span><span class="op" id="7533970">:</span>&nbsp;<span class="string" id="7533972">&#34;foo&#34;</span><span class="op" id="7533977">,</span>&nbsp;<span class="ident" id="7533979">err</span><span class="op" id="7533982">:</span>&nbsp;<span class="string" id="7533984">&#34;multipart:&nbsp;invalid&nbsp;unescaped&nbsp;byte&nbsp;0x00&nbsp;in&nbsp;quoted-printable&nbsp;body&#34;</span><span class="op" id="7534049">}</span><span class="op" id="7534050">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534054">{</span><span class="ident" id="7534055">in</span><span class="op" id="7534057">:</span>&nbsp;<span class="string" id="7534059">&#34;foo&nbsp;bar\xff&#34;</span><span class="op" id="7534072">,</span>&nbsp;<span class="ident" id="7534074">want</span><span class="op" id="7534078">:</span>&nbsp;<span class="string" id="7534080">&#34;foo&nbsp;bar&#34;</span><span class="op" id="7534089">,</span>&nbsp;<span class="ident" id="7534091">err</span><span class="op" id="7534094">:</span>&nbsp;<span class="string" id="7534096">&#34;multipart:&nbsp;invalid&nbsp;unescaped&nbsp;byte&nbsp;0xff&nbsp;in&nbsp;quoted-printable&nbsp;body&#34;</span><span class="op" id="7534161">}</span><span class="op" id="7534162">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7534167">//&nbsp;Equal&nbsp;sign.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534184">{</span><span class="ident" id="7534185">in</span><span class="op" id="7534187">:</span>&nbsp;<span class="string" id="7534189">&#34;=3D30\n&#34;</span><span class="op" id="7534198">,</span>&nbsp;<span class="ident" id="7534200">want</span><span class="op" id="7534204">:</span>&nbsp;<span class="string" id="7534206">&#34;=30\n&#34;</span><span class="op" id="7534213">}</span><span class="op" id="7534214">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534218">{</span><span class="ident" id="7534219">in</span><span class="op" id="7534221">:</span>&nbsp;<span class="string" id="7534223">&#34;=00=FF0=\n&#34;</span><span class="op" id="7534235">,</span>&nbsp;<span class="ident" id="7534237">want</span><span class="op" id="7534241">:</span>&nbsp;<span class="string" id="7534243">&#34;\x00\xff0&#34;</span><span class="op" id="7534254">}</span><span class="op" id="7534255">,</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7534260">//&nbsp;Trailing&nbsp;whitespace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534285">{</span><span class="ident" id="7534286">in</span><span class="op" id="7534288">:</span>&nbsp;<span class="string" id="7534290">&#34;foo&nbsp;&nbsp;\n&#34;</span><span class="op" id="7534299">,</span>&nbsp;<span class="ident" id="7534301">want</span><span class="op" id="7534305">:</span>&nbsp;<span class="string" id="7534307">&#34;foo\n&#34;</span><span class="op" id="7534314">}</span><span class="op" id="7534315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534319">{</span><span class="ident" id="7534320">in</span><span class="op" id="7534322">:</span>&nbsp;<span class="string" id="7534324">&#34;foo&nbsp;&nbsp;\n\nfoo&nbsp;=\n\nfoo=20\n\n&#34;</span><span class="op" id="7534354">,</span>&nbsp;<span class="ident" id="7534356">want</span><span class="op" id="7534360">:</span>&nbsp;<span class="string" id="7534362">&#34;foo\n\nfoo&nbsp;\nfoo&nbsp;\n\n&#34;</span><span class="op" id="7534385">}</span><span class="op" id="7534386">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7534391">//&nbsp;Tests&nbsp;that&nbsp;we&nbsp;allow&nbsp;bare&nbsp;\n&nbsp;and&nbsp;\r&nbsp;through,&nbsp;despite&nbsp;it&nbsp;being&nbsp;strictly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7534466">//&nbsp;not&nbsp;permitted&nbsp;per&nbsp;RFC&nbsp;2045,&nbsp;Section&nbsp;6.7&nbsp;Page&nbsp;22&nbsp;bullet&nbsp;(4).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534531">{</span><span class="ident" id="7534532">in</span><span class="op" id="7534534">:</span>&nbsp;<span class="string" id="7534536">&#34;foo\nbar&#34;</span><span class="op" id="7534546">,</span>&nbsp;<span class="ident" id="7534548">want</span><span class="op" id="7534552">:</span>&nbsp;<span class="string" id="7534554">&#34;foo\nbar&#34;</span><span class="op" id="7534564">}</span><span class="op" id="7534565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534569">{</span><span class="ident" id="7534570">in</span><span class="op" id="7534572">:</span>&nbsp;<span class="string" id="7534574">&#34;foo\rbar&#34;</span><span class="op" id="7534584">,</span>&nbsp;<span class="ident" id="7534586">want</span><span class="op" id="7534590">:</span>&nbsp;<span class="string" id="7534592">&#34;foo\rbar&#34;</span><span class="op" id="7534602">}</span><span class="op" id="7534603">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534607">{</span><span class="ident" id="7534608">in</span><span class="op" id="7534610">:</span>&nbsp;<span class="string" id="7534612">&#34;foo\r\nbar&#34;</span><span class="op" id="7534624">,</span>&nbsp;<span class="ident" id="7534626">want</span><span class="op" id="7534630">:</span>&nbsp;<span class="string" id="7534632">&#34;foo\r\nbar&#34;</span><span class="op" id="7534644">}</span><span class="op" id="7534645">,</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7534650">//&nbsp;Different&nbsp;types&nbsp;of&nbsp;soft&nbsp;line-breaks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534692">{</span><span class="ident" id="7534693">in</span><span class="op" id="7534695">:</span>&nbsp;<span class="string" id="7534697">&#34;foo=\r\nbar&#34;</span><span class="op" id="7534710">,</span>&nbsp;<span class="ident" id="7534712">want</span><span class="op" id="7534716">:</span>&nbsp;<span class="string" id="7534718">&#34;foobar&#34;</span><span class="op" id="7534726">}</span><span class="op" id="7534727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534731">{</span><span class="ident" id="7534732">in</span><span class="op" id="7534734">:</span>&nbsp;<span class="string" id="7534736">&#34;foo=\nbar&#34;</span><span class="op" id="7534747">,</span>&nbsp;<span class="ident" id="7534749">want</span><span class="op" id="7534753">:</span>&nbsp;<span class="string" id="7534755">&#34;foobar&#34;</span><span class="op" id="7534763">}</span><span class="op" id="7534764">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534768">{</span><span class="ident" id="7534769">in</span><span class="op" id="7534771">:</span>&nbsp;<span class="string" id="7534773">&#34;foo=\rbar&#34;</span><span class="op" id="7534784">,</span>&nbsp;<span class="ident" id="7534786">want</span><span class="op" id="7534790">:</span>&nbsp;<span class="string" id="7534792">&#34;foo&#34;</span><span class="op" id="7534797">,</span>&nbsp;<span class="ident" id="7534799">err</span><span class="op" id="7534802">:</span>&nbsp;<span class="string" id="7534804">&#34;multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x0d&#34;</span><span class="op" id="7534855">}</span><span class="op" id="7534856">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534860">{</span><span class="ident" id="7534861">in</span><span class="op" id="7534863">:</span>&nbsp;<span class="string" id="7534865">&#34;foo=\r\r\r&nbsp;\nbar&#34;</span><span class="op" id="7534883">,</span>&nbsp;<span class="ident" id="7534885">want</span><span class="op" id="7534889">:</span>&nbsp;<span class="string" id="7534891">&#34;foo&#34;</span><span class="op" id="7534896">,</span>&nbsp;<span class="ident" id="7534898">err</span><span class="op" id="7534901">:</span>&nbsp;<span class="string" id="7534903">`multipart:&nbsp;invalid&nbsp;bytes&nbsp;after&nbsp;=:&nbsp;&#34;\r\r\r&nbsp;\n&#34;`</span><span class="op" id="7534950">}</span><span class="op" id="7534951">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7534956">//&nbsp;Example&nbsp;from&nbsp;RFC&nbsp;2045:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534984">{</span><span class="ident" id="7534985">in</span><span class="op" id="7534987">:</span>&nbsp;<span class="string" id="7534989">&#34;Now&#39;s&nbsp;the&nbsp;time&nbsp;=\n&#34;</span>&nbsp;<span class="op" id="7535010">+</span>&nbsp;<span class="string" id="7535012">&#34;for&nbsp;all&nbsp;folk&nbsp;to&nbsp;come=\n&#34;</span>&nbsp;<span class="op" id="7535038">+</span>&nbsp;<span class="string" id="7535040">&#34;&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&nbsp;country.&#34;</span><span class="op" id="7535071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535076">want</span><span class="op" id="7535080">:</span>&nbsp;<span class="string" id="7535082">&#34;Now&#39;s&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;folk&nbsp;to&nbsp;come&nbsp;to&nbsp;the&nbsp;aid&nbsp;of&nbsp;their&nbsp;country.&#34;</span><span class="op" id="7535148">}</span><span class="op" id="7535149">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535155">for</span>&nbsp;<span class="ident" id="7535159">_</span><span class="op" id="7535160">,</span>&nbsp;<span class="ident" id="7535162">tt</span>&nbsp;<span class="op" id="7535165">:=</span>&nbsp;<span class="keyword" id="7535168">range</span>&nbsp;<span class="ident" id="7535174">tests</span>&nbsp;<span class="op" id="7535180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535184">var</span>&nbsp;<span class="ident" id="7535188">buf</span>&nbsp;<span class="ident" id="7535192">bytes</span><span class="op" id="7535197">.</span><span class="ident" id="7535198">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535207">_</span><span class="op" id="7535208">,</span>&nbsp;<span class="ident" id="7535210">err</span>&nbsp;<span class="op" id="7535214">:=</span>&nbsp;<span class="ident" id="7535217">io</span><span class="op" id="7535219">.</span><span class="ident" id="7535220">Copy</span><span class="op" id="7535224">(</span><span class="op" id="7535225">&amp;</span><span class="ident" id="7535226">buf</span><span class="op" id="7535229">,</span>&nbsp;<span class="ident" id="7535231">newQuotedPrintableReader</span><span class="op" id="7535255">(</span><span class="ident" id="7535256">strings</span><span class="op" id="7535263">.</span><span class="ident" id="7535264">NewReader</span><span class="op" id="7535273">(</span><span class="ident" id="7535274">tt</span><span class="op" id="7535276">.</span><span class="ident" id="7535277">in</span><span class="op" id="7535279">)</span><span class="op" id="7535280">)</span><span class="op" id="7535281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535285">if</span>&nbsp;<span class="ident" id="7535288">got</span>&nbsp;<span class="op" id="7535292">:=</span>&nbsp;<span class="ident" id="7535295">buf</span><span class="op" id="7535298">.</span><span class="ident" id="7535299">String</span><span class="op" id="7535305">(</span><span class="op" id="7535306">)</span><span class="op" id="7535307">;</span>&nbsp;<span class="ident" id="7535309">got</span>&nbsp;<span class="op" id="7535313">!=</span>&nbsp;<span class="ident" id="7535316">tt</span><span class="op" id="7535318">.</span><span class="ident" id="7535319">want</span>&nbsp;<span class="op" id="7535324">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535329">t</span><span class="op" id="7535330">.</span><span class="ident" id="7535331">Errorf</span><span class="op" id="7535337">(</span><span class="string" id="7535338">&#34;for&nbsp;%q,&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7535363">,</span>&nbsp;<span class="ident" id="7535365">tt</span><span class="op" id="7535367">.</span><span class="ident" id="7535368">in</span><span class="op" id="7535370">,</span>&nbsp;<span class="ident" id="7535372">got</span><span class="op" id="7535375">,</span>&nbsp;<span class="ident" id="7535377">tt</span><span class="op" id="7535379">.</span><span class="ident" id="7535380">want</span><span class="op" id="7535384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535392">switch</span>&nbsp;<span class="ident" id="7535399">verr</span>&nbsp;<span class="op" id="7535404">:=</span>&nbsp;<span class="ident" id="7535407">tt</span><span class="op" id="7535409">.</span><span class="ident" id="7535410">err</span><span class="op" id="7535413">.</span><span class="op" id="7535414">(</span><span class="keyword" id="7535415">type</span><span class="op" id="7535419">)</span>&nbsp;<span class="op" id="7535421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535425">case</span>&nbsp;<span class="ident" id="7535430">nil</span><span class="op" id="7535433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535438">if</span>&nbsp;<span class="ident" id="7535441">err</span>&nbsp;<span class="op" id="7535445">!=</span>&nbsp;<span class="ident" id="7535448">nil</span>&nbsp;<span class="op" id="7535452">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535458">t</span><span class="op" id="7535459">.</span><span class="ident" id="7535460">Errorf</span><span class="op" id="7535466">(</span><span class="string" id="7535467">&#34;for&nbsp;%q,&nbsp;got&nbsp;unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7535501">,</span>&nbsp;<span class="ident" id="7535503">tt</span><span class="op" id="7535505">.</span><span class="ident" id="7535506">in</span><span class="op" id="7535508">,</span>&nbsp;<span class="ident" id="7535510">err</span><span class="op" id="7535513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535522">case</span>&nbsp;<span class="builtintype" id="7535527">string</span><span class="op" id="7535533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535538">if</span>&nbsp;<span class="ident" id="7535541">got</span>&nbsp;<span class="op" id="7535545">:=</span>&nbsp;<span class="ident" id="7535548">fmt</span><span class="op" id="7535551">.</span><span class="ident" id="7535552">Sprint</span><span class="op" id="7535558">(</span><span class="ident" id="7535559">err</span><span class="op" id="7535562">)</span><span class="op" id="7535563">;</span>&nbsp;<span class="ident" id="7535565">got</span>&nbsp;<span class="op" id="7535569">!=</span>&nbsp;<span class="ident" id="7535572">verr</span>&nbsp;<span class="op" id="7535577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535583">t</span><span class="op" id="7535584">.</span><span class="ident" id="7535585">Errorf</span><span class="op" id="7535591">(</span><span class="string" id="7535592">&#34;for&nbsp;%q,&nbsp;got&nbsp;error&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7535623">,</span>&nbsp;<span class="ident" id="7535625">tt</span><span class="op" id="7535627">.</span><span class="ident" id="7535628">in</span><span class="op" id="7535630">,</span>&nbsp;<span class="ident" id="7535632">got</span><span class="op" id="7535635">,</span>&nbsp;<span class="ident" id="7535637">verr</span><span class="op" id="7535641">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535650">case</span>&nbsp;<span class="builtintype" id="7535655">error</span><span class="op" id="7535660">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535665">if</span>&nbsp;<span class="ident" id="7535668">err</span>&nbsp;<span class="op" id="7535672">!=</span>&nbsp;<span class="ident" id="7535675">verr</span>&nbsp;<span class="op" id="7535680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535686">t</span><span class="op" id="7535687">.</span><span class="ident" id="7535688">Errorf</span><span class="op" id="7535694">(</span><span class="string" id="7535695">&#34;for&nbsp;%q,&nbsp;got&nbsp;error&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7535726">,</span>&nbsp;<span class="ident" id="7535728">tt</span><span class="op" id="7535730">.</span><span class="ident" id="7535731">in</span><span class="op" id="7535733">,</span>&nbsp;<span class="ident" id="7535735">err</span><span class="op" id="7535738">,</span>&nbsp;<span class="ident" id="7535740">verr</span><span class="op" id="7535744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535749">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="7535759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7535762">func</span>&nbsp;<span class="ident" id="7535767">everySequence</span><span class="op" id="7535780">(</span><span class="ident" id="7535781">base</span><span class="op" id="7535785">,</span>&nbsp;<span class="ident" id="7535787">alpha</span>&nbsp;<span class="builtintype" id="7535793">string</span><span class="op" id="7535799">,</span>&nbsp;<span class="ident" id="7535801">length</span>&nbsp;<span class="builtintype" id="7535808">int</span><span class="op" id="7535811">,</span>&nbsp;<span class="ident" id="7535813">fn</span>&nbsp;<span class="keyword" id="7535816">func</span><span class="op" id="7535820">(</span><span class="builtintype" id="7535821">string</span><span class="op" id="7535827">)</span><span class="op" id="7535828">)</span>&nbsp;<span class="op" id="7535830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535833">if</span>&nbsp;<span class="builtinfunc" id="7535836">len</span><span class="op" id="7535839">(</span><span class="ident" id="7535840">base</span><span class="op" id="7535844">)</span>&nbsp;<span class="op" id="7535846">==</span>&nbsp;<span class="ident" id="7535849">length</span>&nbsp;<span class="op" id="7535856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535860">fn</span><span class="op" id="7535862">(</span><span class="ident" id="7535863">base</span><span class="op" id="7535867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535871">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535879">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7535882">for</span>&nbsp;<span class="ident" id="7535886">i</span>&nbsp;<span class="op" id="7535888">:=</span>&nbsp;<span class="num" id="7535891">0</span><span class="op" id="7535892">;</span>&nbsp;<span class="ident" id="7535894">i</span>&nbsp;<span class="op" id="7535896">&lt;</span>&nbsp;<span class="builtinfunc" id="7535898">len</span><span class="op" id="7535901">(</span><span class="ident" id="7535902">alpha</span><span class="op" id="7535907">)</span><span class="op" id="7535908">;</span>&nbsp;<span class="ident" id="7535910">i</span><span class="op" id="7535911">++</span>&nbsp;<span class="op" id="7535914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7535918">everySequence</span><span class="op" id="7535931">(</span><span class="ident" id="7535932">base</span><span class="op" id="7535936">+</span><span class="ident" id="7535937">alpha</span><span class="op" id="7535942">[</span><span class="ident" id="7535943">i</span><span class="op" id="7535944">:</span><span class="ident" id="7535945">i</span><span class="op" id="7535946">+</span><span class="num" id="7535947">1</span><span class="op" id="7535948">]</span><span class="op" id="7535949">,</span>&nbsp;<span class="ident" id="7535951">alpha</span><span class="op" id="7535956">,</span>&nbsp;<span class="ident" id="7535958">length</span><span class="op" id="7535964">,</span>&nbsp;<span class="ident" id="7535966">fn</span><span class="op" id="7535968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7535971">}</span><br>
<span class="lineno"></span><span class="op" id="7535973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="7535976">var</span>&nbsp;<span class="ident" id="7535980">useQprint</span>&nbsp;<span class="op" id="7535990">=</span>&nbsp;<span class="ident" id="7535992">flag</span><span class="op" id="7535996">.</span><span class="ident" id="7535997">Bool</span><span class="op" id="7536001">(</span><span class="string" id="7536002">&#34;qprint&#34;</span><span class="op" id="7536010">,</span>&nbsp;<span class="builtintype" id="7536012">false</span><span class="op" id="7536017">,</span>&nbsp;<span class="string" id="7536019">&#34;Compare&nbsp;against&nbsp;the&nbsp;&#39;qprint&#39;&nbsp;program.&#34;</span><span class="op" id="7536058">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7536061">var</span>&nbsp;<span class="ident" id="7536065">badSoftRx</span>&nbsp;<span class="op" id="7536075">=</span>&nbsp;<span class="ident" id="7536077">regexp</span><span class="op" id="7536083">.</span><span class="ident" id="7536084">MustCompile</span><span class="op" id="7536095">(</span><span class="string" id="7536096">`=([^\r\n]+?\n)|([^\r\n]+$)|(\r$)|(\r[^\n]+\n)|(&nbsp;\r\n)`</span><span class="op" id="7536151">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7536154">func</span>&nbsp;<span class="ident" id="7536159">TestQPExhaustive</span><span class="op" id="7536175">(</span><span class="ident" id="7536176">t</span>&nbsp;<span class="op" id="7536178">*</span><span class="ident" id="7536179">testing</span><span class="op" id="7536186">.</span><span class="ident" id="7536187">T</span><span class="op" id="7536188">)</span>&nbsp;<span class="op" id="7536190">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536193">if</span>&nbsp;<span class="op" id="7536196">*</span><span class="ident" id="7536197">useQprint</span>&nbsp;<span class="op" id="7536207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536211">_</span><span class="op" id="7536212">,</span>&nbsp;<span class="ident" id="7536214">err</span>&nbsp;<span class="op" id="7536218">:=</span>&nbsp;<span class="ident" id="7536221">exec</span><span class="op" id="7536225">.</span><span class="ident" id="7536226">LookPath</span><span class="op" id="7536234">(</span><span class="string" id="7536235">&#34;qprint&#34;</span><span class="op" id="7536243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536247">if</span>&nbsp;<span class="ident" id="7536250">err</span>&nbsp;<span class="op" id="7536254">!=</span>&nbsp;<span class="ident" id="7536257">nil</span>&nbsp;<span class="op" id="7536261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536266">t</span><span class="op" id="7536267">.</span><span class="ident" id="7536268">Fatalf</span><span class="op" id="7536274">(</span><span class="string" id="7536275">&#34;Error&nbsp;looking&nbsp;for&nbsp;qprint:&nbsp;%v&#34;</span><span class="op" id="7536305">,</span>&nbsp;<span class="ident" id="7536307">err</span><span class="op" id="7536310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7536314">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7536317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536321">var</span>&nbsp;<span class="ident" id="7536325">buf</span>&nbsp;<span class="ident" id="7536329">bytes</span><span class="op" id="7536334">.</span><span class="ident" id="7536335">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536343">res</span>&nbsp;<span class="op" id="7536347">:=</span>&nbsp;<span class="builtinfunc" id="7536350">make</span><span class="op" id="7536354">(</span><span class="keyword" id="7536355">map</span><span class="op" id="7536358">[</span><span class="builtintype" id="7536359">string</span><span class="op" id="7536365">]</span><span class="builtintype" id="7536366">int</span><span class="op" id="7536369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536372">everySequence</span><span class="op" id="7536385">(</span><span class="string" id="7536386">&#34;&#34;</span><span class="op" id="7536388">,</span>&nbsp;<span class="string" id="7536390">&#34;0A&nbsp;\r\n=&#34;</span><span class="op" id="7536400">,</span>&nbsp;<span class="num" id="7536402">6</span><span class="op" id="7536403">,</span>&nbsp;<span class="keyword" id="7536405">func</span><span class="op" id="7536409">(</span><span class="ident" id="7536410">s</span>&nbsp;<span class="builtintype" id="7536412">string</span><span class="op" id="7536418">)</span>&nbsp;<span class="op" id="7536420">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536424">if</span>&nbsp;<span class="ident" id="7536427">strings</span><span class="op" id="7536434">.</span><span class="ident" id="7536435">HasSuffix</span><span class="op" id="7536444">(</span><span class="ident" id="7536445">s</span><span class="op" id="7536446">,</span>&nbsp;<span class="string" id="7536448">&#34;=&#34;</span><span class="op" id="7536451">)</span>&nbsp;<span class="op" id="7536453">||</span>&nbsp;<span class="ident" id="7536456">strings</span><span class="op" id="7536463">.</span><span class="ident" id="7536464">Contains</span><span class="op" id="7536472">(</span><span class="ident" id="7536473">s</span><span class="op" id="7536474">,</span>&nbsp;<span class="string" id="7536476">&#34;==&#34;</span><span class="op" id="7536480">)</span>&nbsp;<span class="op" id="7536482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536487">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7536496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536500">buf</span><span class="op" id="7536503">.</span><span class="ident" id="7536504">Reset</span><span class="op" id="7536509">(</span><span class="op" id="7536510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536514">_</span><span class="op" id="7536515">,</span>&nbsp;<span class="ident" id="7536517">err</span>&nbsp;<span class="op" id="7536521">:=</span>&nbsp;<span class="ident" id="7536524">io</span><span class="op" id="7536526">.</span><span class="ident" id="7536527">Copy</span><span class="op" id="7536531">(</span><span class="op" id="7536532">&amp;</span><span class="ident" id="7536533">buf</span><span class="op" id="7536536">,</span>&nbsp;<span class="ident" id="7536538">newQuotedPrintableReader</span><span class="op" id="7536562">(</span><span class="ident" id="7536563">strings</span><span class="op" id="7536570">.</span><span class="ident" id="7536571">NewReader</span><span class="op" id="7536580">(</span><span class="ident" id="7536581">s</span><span class="op" id="7536582">)</span><span class="op" id="7536583">)</span><span class="op" id="7536584">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536588">if</span>&nbsp;<span class="ident" id="7536591">err</span>&nbsp;<span class="op" id="7536595">!=</span>&nbsp;<span class="ident" id="7536598">nil</span>&nbsp;<span class="op" id="7536602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536607">errStr</span>&nbsp;<span class="op" id="7536614">:=</span>&nbsp;<span class="ident" id="7536617">err</span><span class="op" id="7536620">.</span><span class="ident" id="7536621">Error</span><span class="op" id="7536626">(</span><span class="op" id="7536627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536632">if</span>&nbsp;<span class="ident" id="7536635">strings</span><span class="op" id="7536642">.</span><span class="ident" id="7536643">Contains</span><span class="op" id="7536651">(</span><span class="ident" id="7536652">errStr</span><span class="op" id="7536658">,</span>&nbsp;<span class="string" id="7536660">&#34;invalid&nbsp;bytes&nbsp;after&nbsp;=:&#34;</span><span class="op" id="7536684">)</span>&nbsp;<span class="op" id="7536686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536692">errStr</span>&nbsp;<span class="op" id="7536699">=</span>&nbsp;<span class="string" id="7536701">&#34;invalid&nbsp;bytes&nbsp;after&nbsp;=&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7536728">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7536733">res</span><span class="op" id="7536736">[</span><span class="ident" id="7536737">errStr</span><span class="op" id="7536743">]</span><span class="op" id="7536744">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536750">if</span>&nbsp;<span class="ident" id="7536753">strings</span><span class="op" id="7536760">.</span><span class="ident" id="7536761">Contains</span><span class="op" id="7536769">(</span><span class="ident" id="7536770">errStr</span><span class="op" id="7536776">,</span>&nbsp;<span class="string" id="7536778">&#34;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;&#34;</span><span class="op" id="7536814">)</span>&nbsp;<span class="op" id="7536816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536822">if</span>&nbsp;<span class="ident" id="7536825">strings</span><span class="op" id="7536832">.</span><span class="ident" id="7536833">HasSuffix</span><span class="op" id="7536842">(</span><span class="ident" id="7536843">errStr</span><span class="op" id="7536849">,</span>&nbsp;<span class="string" id="7536851">&#34;0x20&#34;</span><span class="op" id="7536857">)</span>&nbsp;<span class="op" id="7536859">&amp;&amp;</span>&nbsp;<span class="op" id="7536862">(</span><span class="ident" id="7536863">strings</span><span class="op" id="7536870">.</span><span class="ident" id="7536871">Contains</span><span class="op" id="7536879">(</span><span class="ident" id="7536880">s</span><span class="op" id="7536881">,</span>&nbsp;<span class="string" id="7536883">&#34;=0&nbsp;&#34;</span><span class="op" id="7536888">)</span>&nbsp;<span class="op" id="7536890">||</span>&nbsp;<span class="ident" id="7536893">strings</span><span class="op" id="7536900">.</span><span class="ident" id="7536901">Contains</span><span class="op" id="7536909">(</span><span class="ident" id="7536910">s</span><span class="op" id="7536911">,</span>&nbsp;<span class="string" id="7536913">&#34;=A&nbsp;&#34;</span><span class="op" id="7536918">)</span>&nbsp;<span class="op" id="7536920">||</span>&nbsp;<span class="ident" id="7536923">strings</span><span class="op" id="7536930">.</span><span class="ident" id="7536931">Contains</span><span class="op" id="7536939">(</span><span class="ident" id="7536940">s</span><span class="op" id="7536941">,</span>&nbsp;<span class="string" id="7536943">&#34;=&nbsp;&#34;</span><span class="op" id="7536947">)</span><span class="op" id="7536948">)</span>&nbsp;<span class="op" id="7536950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536957">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7536968">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7536974">if</span>&nbsp;<span class="ident" id="7536977">strings</span><span class="op" id="7536984">.</span><span class="ident" id="7536985">HasSuffix</span><span class="op" id="7536994">(</span><span class="ident" id="7536995">errStr</span><span class="op" id="7537001">,</span>&nbsp;<span class="string" id="7537003">&#34;0x3d&#34;</span><span class="op" id="7537009">)</span>&nbsp;<span class="op" id="7537011">&amp;&amp;</span>&nbsp;<span class="op" id="7537014">(</span><span class="ident" id="7537015">strings</span><span class="op" id="7537022">.</span><span class="ident" id="7537023">Contains</span><span class="op" id="7537031">(</span><span class="ident" id="7537032">s</span><span class="op" id="7537033">,</span>&nbsp;<span class="string" id="7537035">&#34;=0=&#34;</span><span class="op" id="7537040">)</span>&nbsp;<span class="op" id="7537042">||</span>&nbsp;<span class="ident" id="7537045">strings</span><span class="op" id="7537052">.</span><span class="ident" id="7537053">Contains</span><span class="op" id="7537061">(</span><span class="ident" id="7537062">s</span><span class="op" id="7537063">,</span>&nbsp;<span class="string" id="7537065">&#34;=A=&#34;</span><span class="op" id="7537070">)</span><span class="op" id="7537071">)</span>&nbsp;<span class="op" id="7537073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537080">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537097">if</span>&nbsp;<span class="ident" id="7537100">strings</span><span class="op" id="7537107">.</span><span class="ident" id="7537108">HasSuffix</span><span class="op" id="7537117">(</span><span class="ident" id="7537118">errStr</span><span class="op" id="7537124">,</span>&nbsp;<span class="string" id="7537126">&#34;0x0a&#34;</span><span class="op" id="7537132">)</span>&nbsp;<span class="op" id="7537134">||</span>&nbsp;<span class="ident" id="7537137">strings</span><span class="op" id="7537144">.</span><span class="ident" id="7537145">HasSuffix</span><span class="op" id="7537154">(</span><span class="ident" id="7537155">errStr</span><span class="op" id="7537161">,</span>&nbsp;<span class="string" id="7537163">&#34;0x0d&#34;</span><span class="op" id="7537169">)</span>&nbsp;<span class="op" id="7537171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7537178">//&nbsp;bunch&nbsp;of&nbsp;cases;&nbsp;since&nbsp;whitespace&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;before&nbsp;\n&nbsp;is&nbsp;removed.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537262">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537283">if</span>&nbsp;<span class="ident" id="7537286">strings</span><span class="op" id="7537293">.</span><span class="ident" id="7537294">Contains</span><span class="op" id="7537302">(</span><span class="ident" id="7537303">errStr</span><span class="op" id="7537309">,</span>&nbsp;<span class="string" id="7537311">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="7537327">)</span>&nbsp;<span class="op" id="7537329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537335">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537350">if</span>&nbsp;<span class="ident" id="7537353">errStr</span>&nbsp;<span class="op" id="7537360">==</span>&nbsp;<span class="string" id="7537363">&#34;invalid&nbsp;bytes&nbsp;after&nbsp;=&#34;</span>&nbsp;<span class="op" id="7537387">&amp;&amp;</span>&nbsp;<span class="ident" id="7537390">badSoftRx</span><span class="op" id="7537399">.</span><span class="ident" id="7537400">MatchString</span><span class="op" id="7537411">(</span><span class="ident" id="7537412">s</span><span class="op" id="7537413">)</span>&nbsp;<span class="op" id="7537415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537421">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537436">t</span><span class="op" id="7537437">.</span><span class="ident" id="7537438">Errorf</span><span class="op" id="7537444">(</span><span class="string" id="7537445">&#34;decode(%q)&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7537462">,</span>&nbsp;<span class="ident" id="7537464">s</span><span class="op" id="7537465">,</span>&nbsp;<span class="ident" id="7537467">err</span><span class="op" id="7537470">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537475">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537488">if</span>&nbsp;<span class="op" id="7537491">*</span><span class="ident" id="7537492">useQprint</span>&nbsp;<span class="op" id="7537502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537507">cmd</span>&nbsp;<span class="op" id="7537511">:=</span>&nbsp;<span class="ident" id="7537514">exec</span><span class="op" id="7537518">.</span><span class="ident" id="7537519">Command</span><span class="op" id="7537526">(</span><span class="string" id="7537527">&#34;qprint&#34;</span><span class="op" id="7537535">,</span>&nbsp;<span class="string" id="7537537">&#34;-d&#34;</span><span class="op" id="7537541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537546">cmd</span><span class="op" id="7537549">.</span><span class="ident" id="7537550">Stdin</span>&nbsp;<span class="op" id="7537556">=</span>&nbsp;<span class="ident" id="7537558">strings</span><span class="op" id="7537565">.</span><span class="ident" id="7537566">NewReader</span><span class="op" id="7537575">(</span><span class="ident" id="7537576">s</span><span class="op" id="7537577">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537582">stderr</span><span class="op" id="7537588">,</span>&nbsp;<span class="ident" id="7537590">err</span>&nbsp;<span class="op" id="7537594">:=</span>&nbsp;<span class="ident" id="7537597">cmd</span><span class="op" id="7537600">.</span><span class="ident" id="7537601">StderrPipe</span><span class="op" id="7537611">(</span><span class="op" id="7537612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537617">if</span>&nbsp;<span class="ident" id="7537620">err</span>&nbsp;<span class="op" id="7537624">!=</span>&nbsp;<span class="ident" id="7537627">nil</span>&nbsp;<span class="op" id="7537631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7537637">panic</span><span class="op" id="7537642">(</span><span class="ident" id="7537643">err</span><span class="op" id="7537646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537656">qpres</span>&nbsp;<span class="op" id="7537662">:=</span>&nbsp;<span class="builtinfunc" id="7537665">make</span><span class="op" id="7537669">(</span><span class="keyword" id="7537670">chan</span>&nbsp;<span class="keyword" id="7537675">interface</span><span class="op" id="7537684">{</span><span class="op" id="7537685">}</span><span class="op" id="7537686">,</span>&nbsp;<span class="num" id="7537688">2</span><span class="op" id="7537689">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537694">go</span>&nbsp;<span class="keyword" id="7537697">func</span><span class="op" id="7537701">(</span><span class="op" id="7537702">)</span>&nbsp;<span class="op" id="7537704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537710">br</span>&nbsp;<span class="op" id="7537713">:=</span>&nbsp;<span class="ident" id="7537716">bufio</span><span class="op" id="7537721">.</span><span class="ident" id="7537722">NewReader</span><span class="op" id="7537731">(</span><span class="ident" id="7537732">stderr</span><span class="op" id="7537738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537744">s</span><span class="op" id="7537745">,</span>&nbsp;<span class="ident" id="7537747">_</span>&nbsp;<span class="op" id="7537749">:=</span>&nbsp;<span class="ident" id="7537752">br</span><span class="op" id="7537754">.</span><span class="ident" id="7537755">ReadString</span><span class="op" id="7537765">(</span><span class="string" id="7537766">&#39;\n&#39;</span><span class="op" id="7537770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537776">if</span>&nbsp;<span class="ident" id="7537779">s</span>&nbsp;<span class="op" id="7537781">!=</span>&nbsp;<span class="string" id="7537784">&#34;&#34;</span>&nbsp;<span class="op" id="7537787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537794">qpres</span>&nbsp;<span class="op" id="7537800">&lt;-</span>&nbsp;<span class="ident" id="7537803">errors</span><span class="op" id="7537809">.</span><span class="ident" id="7537810">New</span><span class="op" id="7537813">(</span><span class="ident" id="7537814">s</span><span class="op" id="7537815">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537822">if</span>&nbsp;<span class="ident" id="7537825">cmd</span><span class="op" id="7537828">.</span><span class="ident" id="7537829">Process</span>&nbsp;<span class="op" id="7537837">!=</span>&nbsp;<span class="ident" id="7537840">nil</span>&nbsp;<span class="op" id="7537844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7537852">//&nbsp;It&nbsp;can&nbsp;get&nbsp;stuck&nbsp;on&nbsp;invalid&nbsp;input,&nbsp;like:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7537902">//&nbsp;echo&nbsp;-n&nbsp;&#34;0000=&nbsp;&#34;&nbsp;|&nbsp;qprint&nbsp;-d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537940">cmd</span><span class="op" id="7537943">.</span><span class="ident" id="7537944">Process</span><span class="op" id="7537951">.</span><span class="ident" id="7537952">Kill</span><span class="op" id="7537956">(</span><span class="op" id="7537957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537964">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7537975">}</span><span class="op" id="7537976">(</span><span class="op" id="7537977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7537982">go</span>&nbsp;<span class="keyword" id="7537985">func</span><span class="op" id="7537989">(</span><span class="op" id="7537990">)</span>&nbsp;<span class="op" id="7537992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7537998">want</span><span class="op" id="7538002">,</span>&nbsp;<span class="ident" id="7538004">err</span>&nbsp;<span class="op" id="7538008">:=</span>&nbsp;<span class="ident" id="7538011">cmd</span><span class="op" id="7538014">.</span><span class="ident" id="7538015">Output</span><span class="op" id="7538021">(</span><span class="op" id="7538022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538028">if</span>&nbsp;<span class="ident" id="7538031">err</span>&nbsp;<span class="op" id="7538035">==</span>&nbsp;<span class="ident" id="7538038">nil</span>&nbsp;<span class="op" id="7538042">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538049">qpres</span>&nbsp;<span class="op" id="7538055">&lt;-</span>&nbsp;<span class="ident" id="7538058">want</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538072">}</span><span class="op" id="7538073">(</span><span class="op" id="7538074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538079">select</span>&nbsp;<span class="op" id="7538086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538091">case</span>&nbsp;<span class="ident" id="7538096">got</span>&nbsp;<span class="op" id="7538100">:=</span>&nbsp;<span class="op" id="7538103">&lt;-</span><span class="ident" id="7538105">qpres</span><span class="op" id="7538110">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538116">if</span>&nbsp;<span class="ident" id="7538119">want</span><span class="op" id="7538123">,</span>&nbsp;<span class="ident" id="7538125">ok</span>&nbsp;<span class="op" id="7538128">:=</span>&nbsp;<span class="ident" id="7538131">got</span><span class="op" id="7538134">.</span><span class="op" id="7538135">(</span><span class="op" id="7538136">[</span><span class="op" id="7538137">]</span><span class="builtintype" id="7538138">byte</span><span class="op" id="7538142">)</span><span class="op" id="7538143">;</span>&nbsp;<span class="ident" id="7538145">ok</span>&nbsp;<span class="op" id="7538148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538155">if</span>&nbsp;<span class="builtintype" id="7538158">string</span><span class="op" id="7538164">(</span><span class="ident" id="7538165">want</span><span class="op" id="7538169">)</span>&nbsp;<span class="op" id="7538171">!=</span>&nbsp;<span class="ident" id="7538174">buf</span><span class="op" id="7538177">.</span><span class="ident" id="7538178">String</span><span class="op" id="7538184">(</span><span class="op" id="7538185">)</span>&nbsp;<span class="op" id="7538187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538195">t</span><span class="op" id="7538196">.</span><span class="ident" id="7538197">Errorf</span><span class="op" id="7538203">(</span><span class="string" id="7538204">&#34;go&nbsp;decode(%q)&nbsp;=&nbsp;%q;&nbsp;qprint&nbsp;=&nbsp;%q&#34;</span><span class="op" id="7538237">,</span>&nbsp;<span class="ident" id="7538239">s</span><span class="op" id="7538240">,</span>&nbsp;<span class="ident" id="7538242">want</span><span class="op" id="7538246">,</span>&nbsp;<span class="ident" id="7538248">buf</span><span class="op" id="7538251">.</span><span class="ident" id="7538252">String</span><span class="op" id="7538258">(</span><span class="op" id="7538259">)</span><span class="op" id="7538260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538273">}</span>&nbsp;<span class="keyword" id="7538275">else</span>&nbsp;<span class="op" id="7538280">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538287">t</span><span class="op" id="7538288">.</span><span class="ident" id="7538289">Logf</span><span class="op" id="7538293">(</span><span class="string" id="7538294">&#34;qprint&nbsp;-d(%q)&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7538314">,</span>&nbsp;<span class="ident" id="7538316">s</span><span class="op" id="7538317">,</span>&nbsp;<span class="ident" id="7538319">got</span><span class="op" id="7538322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538333">case</span>&nbsp;<span class="op" id="7538338">&lt;-</span><span class="ident" id="7538340">time</span><span class="op" id="7538344">.</span><span class="ident" id="7538345">After</span><span class="op" id="7538350">(</span><span class="num" id="7538351">5</span>&nbsp;<span class="op" id="7538353">*</span>&nbsp;<span class="ident" id="7538355">time</span><span class="op" id="7538359">.</span><span class="ident" id="7538360">Second</span><span class="op" id="7538366">)</span><span class="op" id="7538367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538373">t</span><span class="op" id="7538374">.</span><span class="ident" id="7538375">Logf</span><span class="op" id="7538379">(</span><span class="string" id="7538380">&#34;qprint&nbsp;timeout&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7538402">,</span>&nbsp;<span class="ident" id="7538404">s</span><span class="op" id="7538405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538410">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538418">res</span><span class="op" id="7538421">[</span><span class="string" id="7538422">&#34;OK&#34;</span><span class="op" id="7538426">]</span><span class="op" id="7538427">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538431">}</span><span class="op" id="7538432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538435">var</span>&nbsp;<span class="ident" id="7538439">outcomes</span>&nbsp;<span class="op" id="7538448">[</span><span class="op" id="7538449">]</span><span class="builtintype" id="7538450">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538458">for</span>&nbsp;<span class="ident" id="7538462">k</span><span class="op" id="7538463">,</span>&nbsp;<span class="ident" id="7538465">v</span>&nbsp;<span class="op" id="7538467">:=</span>&nbsp;<span class="keyword" id="7538470">range</span>&nbsp;<span class="ident" id="7538476">res</span>&nbsp;<span class="op" id="7538480">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538484">outcomes</span>&nbsp;<span class="op" id="7538493">=</span>&nbsp;<span class="builtinfunc" id="7538495">append</span><span class="op" id="7538501">(</span><span class="ident" id="7538502">outcomes</span><span class="op" id="7538510">,</span>&nbsp;<span class="ident" id="7538512">fmt</span><span class="op" id="7538515">.</span><span class="ident" id="7538516">Sprintf</span><span class="op" id="7538523">(</span><span class="string" id="7538524">&#34;%v:&nbsp;%d&#34;</span><span class="op" id="7538532">,</span>&nbsp;<span class="ident" id="7538534">k</span><span class="op" id="7538535">,</span>&nbsp;<span class="ident" id="7538537">v</span><span class="op" id="7538538">)</span><span class="op" id="7538539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538545">sort</span><span class="op" id="7538549">.</span><span class="ident" id="7538550">Strings</span><span class="op" id="7538557">(</span><span class="ident" id="7538558">outcomes</span><span class="op" id="7538566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538569">got</span>&nbsp;<span class="op" id="7538573">:=</span>&nbsp;<span class="ident" id="7538576">strings</span><span class="op" id="7538583">.</span><span class="ident" id="7538584">Join</span><span class="op" id="7538588">(</span><span class="ident" id="7538589">outcomes</span><span class="op" id="7538597">,</span>&nbsp;<span class="string" id="7538599">&#34;\n&#34;</span><span class="op" id="7538603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538606">want</span>&nbsp;<span class="op" id="7538611">:=</span>&nbsp;<span class="string" id="7538614">`OK:&nbsp;21576<br>
<span class="lineno">195</span>invalid&nbsp;bytes&nbsp;after&nbsp;=:&nbsp;3397<br>
<span class="lineno"></span>multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x0a:&nbsp;1400<br>
<span class="lineno"></span>multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x0d:&nbsp;2700<br>
<span class="lineno"></span>multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x20:&nbsp;2490<br>
<span class="lineno"></span>multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x3d:&nbsp;440<br>
<span class="lineno">200</span>unexpected&nbsp;EOF:&nbsp;3122`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7538899">if</span>&nbsp;<span class="ident" id="7538902">got</span>&nbsp;<span class="op" id="7538906">!=</span>&nbsp;<span class="ident" id="7538909">want</span>&nbsp;<span class="op" id="7538914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7538918">t</span><span class="op" id="7538919">.</span><span class="ident" id="7538920">Errorf</span><span class="op" id="7538926">(</span><span class="string" id="7538927">&#34;Got:\n%s\nWant:\n%s&#34;</span><span class="op" id="7538948">,</span>&nbsp;<span class="ident" id="7538950">got</span><span class="op" id="7538953">,</span>&nbsp;<span class="ident" id="7538955">want</span><span class="op" id="7538959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7538962">}</span><br>
<span class="lineno"></span><span class="op" id="7538964">}</span>
</div>
</body>
</html>
