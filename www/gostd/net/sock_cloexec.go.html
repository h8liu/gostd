<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3717591">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3717646">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3717700">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3717751">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;sysSocket&nbsp;and&nbsp;accept&nbsp;for&nbsp;platforms&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3717815">//&nbsp;provide&nbsp;a&nbsp;fast&nbsp;path&nbsp;for&nbsp;setting&nbsp;SetNonblock&nbsp;and&nbsp;CloseOnExec.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3717880">//&nbsp;+build&nbsp;freebsd&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3717905">package</span>&nbsp;<span class="ident" id="3717913">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3717918">import</span>&nbsp;<span class="string" id="3717925">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3717936">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;socket&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">15</span><span class="comment" id="3718006">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="3718054">func</span>&nbsp;<span class="ident" id="3718059">sysSocket</span><span class="op" id="3718068">(</span><span class="ident" id="3718069">family</span><span class="op" id="3718075">,</span>&nbsp;<span class="ident" id="3718077">sotype</span><span class="op" id="3718083">,</span>&nbsp;<span class="ident" id="3718085">proto</span>&nbsp;<span class="builtintype" id="3718091">int</span><span class="op" id="3718094">)</span>&nbsp;<span class="op" id="3718096">(</span><span class="builtintype" id="3718097">int</span><span class="op" id="3718100">,</span>&nbsp;<span class="builtintype" id="3718102">error</span><span class="op" id="3718107">)</span>&nbsp;<span class="op" id="3718109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718112">s</span><span class="op" id="3718113">,</span>&nbsp;<span class="ident" id="3718115">err</span>&nbsp;<span class="op" id="3718119">:=</span>&nbsp;<span class="ident" id="3718122">syscall</span><span class="op" id="3718129">.</span><span class="ident" id="3718130">Socket</span><span class="op" id="3718136">(</span><span class="ident" id="3718137">family</span><span class="op" id="3718143">,</span>&nbsp;<span class="ident" id="3718145">sotype</span><span class="op" id="3718151">|</span><span class="ident" id="3718152">syscall</span><span class="op" id="3718159">.</span><span class="ident" id="3718160">SOCK_NONBLOCK</span><span class="op" id="3718173">|</span><span class="ident" id="3718174">syscall</span><span class="op" id="3718181">.</span><span class="ident" id="3718182">SOCK_CLOEXEC</span><span class="op" id="3718194">,</span>&nbsp;<span class="ident" id="3718196">proto</span><span class="op" id="3718201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3718204">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;SOCK_NONBLOCK&nbsp;and&nbsp;SOCK_CLOEXEC&nbsp;flags&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3718263">//&nbsp;introduced&nbsp;in&nbsp;2.6.27&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;both&nbsp;flags&nbsp;were</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3718326">//&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we&nbsp;get&nbsp;an&nbsp;EINVAL&nbsp;error&nbsp;on&nbsp;Linux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3718390">//&nbsp;or&nbsp;EPROTONOSUPPORT&nbsp;error&nbsp;on&nbsp;FreeBSD,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3718450">//&nbsp;socket&nbsp;without&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718475">if</span>&nbsp;<span class="ident" id="3718478">err</span>&nbsp;<span class="op" id="3718482">==</span>&nbsp;<span class="ident" id="3718485">nil</span>&nbsp;<span class="op" id="3718489">||</span>&nbsp;<span class="op" id="3718492">(</span><span class="ident" id="3718493">err</span>&nbsp;<span class="op" id="3718497">!=</span>&nbsp;<span class="ident" id="3718500">syscall</span><span class="op" id="3718507">.</span><span class="ident" id="3718508">EPROTONOSUPPORT</span>&nbsp;<span class="op" id="3718524">&amp;&amp;</span>&nbsp;<span class="ident" id="3718527">err</span>&nbsp;<span class="op" id="3718531">!=</span>&nbsp;<span class="ident" id="3718534">syscall</span><span class="op" id="3718541">.</span><span class="ident" id="3718542">EINVAL</span><span class="op" id="3718548">)</span>&nbsp;<span class="op" id="3718550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718554">return</span>&nbsp;<span class="ident" id="3718561">s</span><span class="op" id="3718562">,</span>&nbsp;<span class="ident" id="3718564">err</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3718573">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718634">syscall</span><span class="op" id="3718641">.</span><span class="ident" id="3718642">ForkLock</span><span class="op" id="3718650">.</span><span class="ident" id="3718651">RLock</span><span class="op" id="3718656">(</span><span class="op" id="3718657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718660">s</span><span class="op" id="3718661">,</span>&nbsp;<span class="ident" id="3718663">err</span>&nbsp;<span class="op" id="3718667">=</span>&nbsp;<span class="ident" id="3718669">syscall</span><span class="op" id="3718676">.</span><span class="ident" id="3718677">Socket</span><span class="op" id="3718683">(</span><span class="ident" id="3718684">family</span><span class="op" id="3718690">,</span>&nbsp;<span class="ident" id="3718692">sotype</span><span class="op" id="3718698">,</span>&nbsp;<span class="ident" id="3718700">proto</span><span class="op" id="3718705">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718708">if</span>&nbsp;<span class="ident" id="3718711">err</span>&nbsp;<span class="op" id="3718715">==</span>&nbsp;<span class="ident" id="3718718">nil</span>&nbsp;<span class="op" id="3718722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718726">syscall</span><span class="op" id="3718733">.</span><span class="ident" id="3718734">CloseOnExec</span><span class="op" id="3718745">(</span><span class="ident" id="3718746">s</span><span class="op" id="3718747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718753">syscall</span><span class="op" id="3718760">.</span><span class="ident" id="3718761">ForkLock</span><span class="op" id="3718769">.</span><span class="ident" id="3718770">RUnlock</span><span class="op" id="3718777">(</span><span class="op" id="3718778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718781">if</span>&nbsp;<span class="ident" id="3718784">err</span>&nbsp;<span class="op" id="3718788">!=</span>&nbsp;<span class="ident" id="3718791">nil</span>&nbsp;<span class="op" id="3718795">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718799">return</span>&nbsp;<span class="op" id="3718806">-</span><span class="num" id="3718807">1</span><span class="op" id="3718808">,</span>&nbsp;<span class="ident" id="3718810">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718818">if</span>&nbsp;<span class="ident" id="3718821">err</span>&nbsp;<span class="op" id="3718825">=</span>&nbsp;<span class="ident" id="3718827">syscall</span><span class="op" id="3718834">.</span><span class="ident" id="3718835">SetNonblock</span><span class="op" id="3718846">(</span><span class="ident" id="3718847">s</span><span class="op" id="3718848">,</span>&nbsp;<span class="builtintype" id="3718850">true</span><span class="op" id="3718854">)</span><span class="op" id="3718855">;</span>&nbsp;<span class="ident" id="3718857">err</span>&nbsp;<span class="op" id="3718861">!=</span>&nbsp;<span class="ident" id="3718864">nil</span>&nbsp;<span class="op" id="3718868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718872">syscall</span><span class="op" id="3718879">.</span><span class="ident" id="3718880">Close</span><span class="op" id="3718885">(</span><span class="ident" id="3718886">s</span><span class="op" id="3718887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718891">return</span>&nbsp;<span class="op" id="3718898">-</span><span class="num" id="3718899">1</span><span class="op" id="3718900">,</span>&nbsp;<span class="ident" id="3718902">err</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718910">return</span>&nbsp;<span class="ident" id="3718917">s</span><span class="op" id="3718918">,</span>&nbsp;<span class="ident" id="3718920">nil</span><br>
<span class="lineno"></span><span class="op" id="3718924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3718927">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;accept&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">45</span><span class="comment" id="3718997">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="3719045">func</span>&nbsp;<span class="ident" id="3719050">accept</span><span class="op" id="3719056">(</span><span class="ident" id="3719057">s</span>&nbsp;<span class="builtintype" id="3719059">int</span><span class="op" id="3719062">)</span>&nbsp;<span class="op" id="3719064">(</span><span class="builtintype" id="3719065">int</span><span class="op" id="3719068">,</span>&nbsp;<span class="ident" id="3719070">syscall</span><span class="op" id="3719077">.</span><span class="ident" id="3719078">Sockaddr</span><span class="op" id="3719086">,</span>&nbsp;<span class="builtintype" id="3719088">error</span><span class="op" id="3719093">)</span>&nbsp;<span class="op" id="3719095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719098">ns</span><span class="op" id="3719100">,</span>&nbsp;<span class="ident" id="3719102">sa</span><span class="op" id="3719104">,</span>&nbsp;<span class="ident" id="3719106">err</span>&nbsp;<span class="op" id="3719110">:=</span>&nbsp;<span class="ident" id="3719113">syscall</span><span class="op" id="3719120">.</span><span class="ident" id="3719121">Accept4</span><span class="op" id="3719128">(</span><span class="ident" id="3719129">s</span><span class="op" id="3719130">,</span>&nbsp;<span class="ident" id="3719132">syscall</span><span class="op" id="3719139">.</span><span class="ident" id="3719140">SOCK_NONBLOCK</span><span class="op" id="3719153">|</span><span class="ident" id="3719154">syscall</span><span class="op" id="3719161">.</span><span class="ident" id="3719162">SOCK_CLOEXEC</span><span class="op" id="3719174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3719177">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;accept4&nbsp;system&nbsp;call&nbsp;was&nbsp;introduced&nbsp;in&nbsp;2.6.28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3719239">//&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;it&nbsp;was&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3719303">//&nbsp;get&nbsp;an&nbsp;ENOSYS&nbsp;error&nbsp;on&nbsp;both&nbsp;Linux&nbsp;and&nbsp;FreeBSD,&nbsp;or&nbsp;EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3719364">//&nbsp;error&nbsp;on&nbsp;Linux,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using&nbsp;accept.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719411">switch</span>&nbsp;<span class="ident" id="3719418">err</span>&nbsp;<span class="op" id="3719422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719425">default</span><span class="op" id="3719432">:</span>&nbsp;<span class="comment" id="3719434">//&nbsp;nil&nbsp;and&nbsp;errors&nbsp;other&nbsp;than&nbsp;the&nbsp;ones&nbsp;listed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719481">return</span>&nbsp;<span class="ident" id="3719488">ns</span><span class="op" id="3719490">,</span>&nbsp;<span class="ident" id="3719492">sa</span><span class="op" id="3719494">,</span>&nbsp;<span class="ident" id="3719496">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719501">case</span>&nbsp;<span class="ident" id="3719506">syscall</span><span class="op" id="3719513">.</span><span class="ident" id="3719514">ENOSYS</span><span class="op" id="3719520">:</span>&nbsp;<span class="comment" id="3719522">//&nbsp;syscall&nbsp;missing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719542">case</span>&nbsp;<span class="ident" id="3719547">syscall</span><span class="op" id="3719554">.</span><span class="ident" id="3719555">EINVAL</span><span class="op" id="3719561">:</span>&nbsp;<span class="comment" id="3719563">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719605">case</span>&nbsp;<span class="ident" id="3719610">syscall</span><span class="op" id="3719617">.</span><span class="ident" id="3719618">EACCES</span><span class="op" id="3719624">:</span>&nbsp;<span class="comment" id="3719626">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719668">case</span>&nbsp;<span class="ident" id="3719673">syscall</span><span class="op" id="3719680">.</span><span class="ident" id="3719681">EFAULT</span><span class="op" id="3719687">:</span>&nbsp;<span class="comment" id="3719689">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719731">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3719735">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3719796">//&nbsp;It&nbsp;is&nbsp;probably&nbsp;okay&nbsp;to&nbsp;hold&nbsp;the&nbsp;lock&nbsp;across&nbsp;syscall.Accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3719859">//&nbsp;because&nbsp;we&nbsp;have&nbsp;put&nbsp;fd.sysfd&nbsp;into&nbsp;non-blocking&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3719916">//&nbsp;However,&nbsp;a&nbsp;call&nbsp;to&nbsp;the&nbsp;File&nbsp;method&nbsp;will&nbsp;put&nbsp;it&nbsp;back&nbsp;into</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3719977">//&nbsp;blocking&nbsp;mode.&nbsp;We&nbsp;can&#39;t&nbsp;take&nbsp;that&nbsp;risk,&nbsp;so&nbsp;no&nbsp;use&nbsp;of&nbsp;ForkLock&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720049">ns</span><span class="op" id="3720051">,</span>&nbsp;<span class="ident" id="3720053">sa</span><span class="op" id="3720055">,</span>&nbsp;<span class="ident" id="3720057">err</span>&nbsp;<span class="op" id="3720061">=</span>&nbsp;<span class="ident" id="3720063">syscall</span><span class="op" id="3720070">.</span><span class="ident" id="3720071">Accept</span><span class="op" id="3720077">(</span><span class="ident" id="3720078">s</span><span class="op" id="3720079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720082">if</span>&nbsp;<span class="ident" id="3720085">err</span>&nbsp;<span class="op" id="3720089">==</span>&nbsp;<span class="ident" id="3720092">nil</span>&nbsp;<span class="op" id="3720096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720100">syscall</span><span class="op" id="3720107">.</span><span class="ident" id="3720108">CloseOnExec</span><span class="op" id="3720119">(</span><span class="ident" id="3720120">ns</span><span class="op" id="3720122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720125">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720128">if</span>&nbsp;<span class="ident" id="3720131">err</span>&nbsp;<span class="op" id="3720135">!=</span>&nbsp;<span class="ident" id="3720138">nil</span>&nbsp;<span class="op" id="3720142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720146">return</span>&nbsp;<span class="op" id="3720153">-</span><span class="num" id="3720154">1</span><span class="op" id="3720155">,</span>&nbsp;<span class="ident" id="3720157">nil</span><span class="op" id="3720160">,</span>&nbsp;<span class="ident" id="3720162">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720170">if</span>&nbsp;<span class="ident" id="3720173">err</span>&nbsp;<span class="op" id="3720177">=</span>&nbsp;<span class="ident" id="3720179">syscall</span><span class="op" id="3720186">.</span><span class="ident" id="3720187">SetNonblock</span><span class="op" id="3720198">(</span><span class="ident" id="3720199">ns</span><span class="op" id="3720201">,</span>&nbsp;<span class="builtintype" id="3720203">true</span><span class="op" id="3720207">)</span><span class="op" id="3720208">;</span>&nbsp;<span class="ident" id="3720210">err</span>&nbsp;<span class="op" id="3720214">!=</span>&nbsp;<span class="ident" id="3720217">nil</span>&nbsp;<span class="op" id="3720221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720225">syscall</span><span class="op" id="3720232">.</span><span class="ident" id="3720233">Close</span><span class="op" id="3720238">(</span><span class="ident" id="3720239">ns</span><span class="op" id="3720241">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720245">return</span>&nbsp;<span class="op" id="3720252">-</span><span class="num" id="3720253">1</span><span class="op" id="3720254">,</span>&nbsp;<span class="ident" id="3720256">nil</span><span class="op" id="3720259">,</span>&nbsp;<span class="ident" id="3720261">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720269">return</span>&nbsp;<span class="ident" id="3720276">ns</span><span class="op" id="3720278">,</span>&nbsp;<span class="ident" id="3720280">sa</span><span class="op" id="3720282">,</span>&nbsp;<span class="ident" id="3720284">nil</span><br>
<span class="lineno"></span><span class="op" id="3720288">}</span>
</div>
</body>
</html>
