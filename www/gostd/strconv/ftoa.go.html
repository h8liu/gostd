<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strconv</h2>
<ul>
<li><a href="/gostd/strconv/atob.go.html">atob.go</a></li>
<li><a href="/gostd/strconv/atob_test.go.html">atob_test.go</a></li>
<li><a href="/gostd/strconv/atof.go.html">atof.go</a></li>
<li><a href="/gostd/strconv/atof_test.go.html">atof_test.go</a></li>
<li><a href="/gostd/strconv/atoi.go.html">atoi.go</a></li>
<li><a href="/gostd/strconv/atoi_test.go.html">atoi_test.go</a></li>
<li><a href="/gostd/strconv/decimal.go.html">decimal.go</a></li>
<li><a href="/gostd/strconv/decimal_test.go.html">decimal_test.go</a></li>
<li><a href="/gostd/strconv/extfloat.go.html">extfloat.go</a></li>
<li><a href="/gostd/strconv/fp_test.go.html">fp_test.go</a></li>
<li><a href="/gostd/strconv/ftoa.go.html">ftoa.go</a></li>
<li><a href="/gostd/strconv/ftoa_test.go.html">ftoa_test.go</a></li>
<li><a href="/gostd/strconv/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/strconv/isprint.go.html">isprint.go</a></li>
<li><a href="/gostd/strconv/itoa.go.html">itoa.go</a></li>
<li><a href="/gostd/strconv/itoa_test.go.html">itoa_test.go</a></li>
<li><a href="/gostd/strconv/quote.go.html">quote.go</a></li>
<li><a href="/gostd/strconv/quote_example_test.go.html">quote_example_test.go</a></li>
<li><a href="/gostd/strconv/quote_test.go.html">quote_test.go</a></li>
<li><a href="/gostd/strconv/strconv_test.go.html">strconv_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1771512">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1771567">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1771621">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1771672">//&nbsp;Binary&nbsp;to&nbsp;decimal&nbsp;floating&nbsp;point&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment" id="1771720">//&nbsp;Algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="1771734">//&nbsp;&nbsp;&nbsp;1)&nbsp;store&nbsp;mantissa&nbsp;in&nbsp;multiprecision&nbsp;decimal</span><br>
<span class="lineno"></span><span class="comment" id="1771783">//&nbsp;&nbsp;&nbsp;2)&nbsp;shift&nbsp;decimal&nbsp;by&nbsp;exponent</span><br>
<span class="lineno"></span><span class="comment" id="1771817">//&nbsp;&nbsp;&nbsp;3)&nbsp;read&nbsp;digits&nbsp;out&nbsp;&amp;&nbsp;format</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1771851">package</span>&nbsp;<span class="ident" id="1771859">strconv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1771868">import</span>&nbsp;<span class="string" id="1771875">&#34;math&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1771883">//&nbsp;TODO:&nbsp;move&nbsp;elsewhere?</span><br>
<span class="lineno"></span><span class="keyword" id="1771908">type</span>&nbsp;<span class="ident" id="1771913">floatInfo</span>&nbsp;<span class="keyword" id="1771923">struct</span>&nbsp;<span class="op" id="1771930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771933">mantbits</span>&nbsp;<span class="builtintype" id="1771942">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771948">expbits</span>&nbsp;&nbsp;<span class="builtintype" id="1771957">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1771963">bias</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1771972">int</span><br>
<span class="lineno">20</span><span class="op" id="1771976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1771979">var</span>&nbsp;<span class="ident" id="1771983">float32info</span>&nbsp;<span class="op" id="1771995">=</span>&nbsp;<span class="ident" id="1771997">floatInfo</span><span class="op" id="1772006">{</span><span class="num" id="1772007">23</span><span class="op" id="1772009">,</span>&nbsp;<span class="num" id="1772011">8</span><span class="op" id="1772012">,</span>&nbsp;<span class="op" id="1772014">-</span><span class="num" id="1772015">127</span><span class="op" id="1772018">}</span><br>
<span class="lineno"></span><span class="keyword" id="1772020">var</span>&nbsp;<span class="ident" id="1772024">float64info</span>&nbsp;<span class="op" id="1772036">=</span>&nbsp;<span class="ident" id="1772038">floatInfo</span><span class="op" id="1772047">{</span><span class="num" id="1772048">52</span><span class="op" id="1772050">,</span>&nbsp;<span class="num" id="1772052">11</span><span class="op" id="1772054">,</span>&nbsp;<span class="op" id="1772056">-</span><span class="num" id="1772057">1023</span><span class="op" id="1772061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1772064">//&nbsp;FormatFloat&nbsp;converts&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f&nbsp;to&nbsp;a&nbsp;string,</span><br>
<span class="lineno"></span><span class="comment" id="1772129">//&nbsp;according&nbsp;to&nbsp;the&nbsp;format&nbsp;fmt&nbsp;and&nbsp;precision&nbsp;prec.&nbsp;&nbsp;It&nbsp;rounds&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1772195">//&nbsp;result&nbsp;assuming&nbsp;that&nbsp;the&nbsp;original&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="1772267">//&nbsp;value&nbsp;of&nbsp;bitSize&nbsp;bits&nbsp;(32&nbsp;for&nbsp;float32,&nbsp;64&nbsp;for&nbsp;float64).</span><br>
<span class="lineno"></span><span class="comment" id="1772326">//</span><br>
<span class="lineno">30</span><span class="comment" id="1772329">//&nbsp;The&nbsp;format&nbsp;fmt&nbsp;is&nbsp;one&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1772357">//&nbsp;&#39;b&#39;&nbsp;(-ddddp±ddd,&nbsp;a&nbsp;binary&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="1772398">//&nbsp;&#39;e&#39;&nbsp;(-d.dddde±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="1772441">//&nbsp;&#39;E&#39;&nbsp;(-d.ddddE±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="1772484">//&nbsp;&#39;f&#39;&nbsp;(-ddd.dddd,&nbsp;no&nbsp;exponent),</span><br>
<span class="lineno">35</span><span class="comment" id="1772517">//&nbsp;&#39;g&#39;&nbsp;(&#39;e&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise),&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="1772569">//&nbsp;&#39;G&#39;&nbsp;(&#39;E&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise).</span><br>
<span class="lineno"></span><span class="comment" id="1772618">//</span><br>
<span class="lineno"></span><span class="comment" id="1772621">//&nbsp;The&nbsp;precision&nbsp;prec&nbsp;controls&nbsp;the&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="1772673">//&nbsp;(excluding&nbsp;the&nbsp;exponent)&nbsp;printed&nbsp;by&nbsp;the&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;g&#39;,&nbsp;and&nbsp;&#39;G&#39;&nbsp;formats.</span><br>
<span class="lineno">40</span><span class="comment" id="1772753">//&nbsp;For&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;and&nbsp;&#39;f&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span><span class="comment" id="1772830">//&nbsp;For&nbsp;&#39;g&#39;&nbsp;and&nbsp;&#39;G&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="1772883">//&nbsp;The&nbsp;special&nbsp;precision&nbsp;-1&nbsp;uses&nbsp;the&nbsp;smallest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="1772946">//&nbsp;necessary&nbsp;such&nbsp;that&nbsp;ParseFloat&nbsp;will&nbsp;return&nbsp;f&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="keyword" id="1773003">func</span>&nbsp;<span class="ident" id="1773008">FormatFloat</span><span class="op" id="1773019">(</span><span class="ident" id="1773020">f</span>&nbsp;<span class="builtintype" id="1773022">float64</span><span class="op" id="1773029">,</span>&nbsp;<span class="ident" id="1773031">fmt</span>&nbsp;<span class="builtintype" id="1773035">byte</span><span class="op" id="1773039">,</span>&nbsp;<span class="ident" id="1773041">prec</span><span class="op" id="1773045">,</span>&nbsp;<span class="ident" id="1773047">bitSize</span>&nbsp;<span class="builtintype" id="1773055">int</span><span class="op" id="1773058">)</span>&nbsp;<span class="builtintype" id="1773060">string</span>&nbsp;<span class="op" id="1773067">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773070">return</span>&nbsp;<span class="builtintype" id="1773077">string</span><span class="op" id="1773083">(</span><span class="ident" id="1773084">genericFtoa</span><span class="op" id="1773095">(</span><span class="builtinfunc" id="1773096">make</span><span class="op" id="1773100">(</span><span class="op" id="1773101">[</span><span class="op" id="1773102">]</span><span class="builtintype" id="1773103">byte</span><span class="op" id="1773107">,</span>&nbsp;<span class="num" id="1773109">0</span><span class="op" id="1773110">,</span>&nbsp;<span class="ident" id="1773112">max</span><span class="op" id="1773115">(</span><span class="ident" id="1773116">prec</span><span class="op" id="1773120">+</span><span class="num" id="1773121">4</span><span class="op" id="1773122">,</span>&nbsp;<span class="num" id="1773124">24</span><span class="op" id="1773126">)</span><span class="op" id="1773127">)</span><span class="op" id="1773128">,</span>&nbsp;<span class="ident" id="1773130">f</span><span class="op" id="1773131">,</span>&nbsp;<span class="ident" id="1773133">fmt</span><span class="op" id="1773136">,</span>&nbsp;<span class="ident" id="1773138">prec</span><span class="op" id="1773142">,</span>&nbsp;<span class="ident" id="1773144">bitSize</span><span class="op" id="1773151">)</span><span class="op" id="1773152">)</span><br>
<span class="lineno"></span><span class="op" id="1773154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1773157">//&nbsp;AppendFloat&nbsp;appends&nbsp;the&nbsp;string&nbsp;form&nbsp;of&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f,</span><br>
<span class="lineno"></span><span class="comment" id="1773228">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;FormatFloat,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno">50</span><span class="keyword" id="1773300">func</span>&nbsp;<span class="ident" id="1773305">AppendFloat</span><span class="op" id="1773316">(</span><span class="ident" id="1773317">dst</span>&nbsp;<span class="op" id="1773321">[</span><span class="op" id="1773322">]</span><span class="builtintype" id="1773323">byte</span><span class="op" id="1773327">,</span>&nbsp;<span class="ident" id="1773329">f</span>&nbsp;<span class="builtintype" id="1773331">float64</span><span class="op" id="1773338">,</span>&nbsp;<span class="ident" id="1773340">fmt</span>&nbsp;<span class="builtintype" id="1773344">byte</span><span class="op" id="1773348">,</span>&nbsp;<span class="ident" id="1773350">prec</span>&nbsp;<span class="builtintype" id="1773355">int</span><span class="op" id="1773358">,</span>&nbsp;<span class="ident" id="1773360">bitSize</span>&nbsp;<span class="builtintype" id="1773368">int</span><span class="op" id="1773371">)</span>&nbsp;<span class="op" id="1773373">[</span><span class="op" id="1773374">]</span><span class="builtintype" id="1773375">byte</span>&nbsp;<span class="op" id="1773380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773383">return</span>&nbsp;<span class="ident" id="1773390">genericFtoa</span><span class="op" id="1773401">(</span><span class="ident" id="1773402">dst</span><span class="op" id="1773405">,</span>&nbsp;<span class="ident" id="1773407">f</span><span class="op" id="1773408">,</span>&nbsp;<span class="ident" id="1773410">fmt</span><span class="op" id="1773413">,</span>&nbsp;<span class="ident" id="1773415">prec</span><span class="op" id="1773419">,</span>&nbsp;<span class="ident" id="1773421">bitSize</span><span class="op" id="1773428">)</span><br>
<span class="lineno"></span><span class="op" id="1773430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1773433">func</span>&nbsp;<span class="ident" id="1773438">genericFtoa</span><span class="op" id="1773449">(</span><span class="ident" id="1773450">dst</span>&nbsp;<span class="op" id="1773454">[</span><span class="op" id="1773455">]</span><span class="builtintype" id="1773456">byte</span><span class="op" id="1773460">,</span>&nbsp;<span class="ident" id="1773462">val</span>&nbsp;<span class="builtintype" id="1773466">float64</span><span class="op" id="1773473">,</span>&nbsp;<span class="ident" id="1773475">fmt</span>&nbsp;<span class="builtintype" id="1773479">byte</span><span class="op" id="1773483">,</span>&nbsp;<span class="ident" id="1773485">prec</span><span class="op" id="1773489">,</span>&nbsp;<span class="ident" id="1773491">bitSize</span>&nbsp;<span class="builtintype" id="1773499">int</span><span class="op" id="1773502">)</span>&nbsp;<span class="op" id="1773504">[</span><span class="op" id="1773505">]</span><span class="builtintype" id="1773506">byte</span>&nbsp;<span class="op" id="1773511">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773514">var</span>&nbsp;<span class="ident" id="1773518">bits</span>&nbsp;<span class="ident" id="1773523">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773531">var</span>&nbsp;<span class="ident" id="1773535">flt</span>&nbsp;<span class="op" id="1773539">*</span><span class="ident" id="1773540">floatInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773551">switch</span>&nbsp;<span class="ident" id="1773558">bitSize</span>&nbsp;<span class="op" id="1773566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773569">case</span>&nbsp;<span class="num" id="1773574">32</span><span class="op" id="1773576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773580">bits</span>&nbsp;<span class="op" id="1773585">=</span>&nbsp;<span class="ident" id="1773587">uint64</span><span class="op" id="1773593">(</span><span class="ident" id="1773594">math</span><span class="op" id="1773598">.</span><span class="ident" id="1773599">Float32bits</span><span class="op" id="1773610">(</span><span class="builtintype" id="1773611">float32</span><span class="op" id="1773618">(</span><span class="ident" id="1773619">val</span><span class="op" id="1773622">)</span><span class="op" id="1773623">)</span><span class="op" id="1773624">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773628">flt</span>&nbsp;<span class="op" id="1773632">=</span>&nbsp;<span class="op" id="1773634">&amp;</span><span class="ident" id="1773635">float32info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773648">case</span>&nbsp;<span class="num" id="1773653">64</span><span class="op" id="1773655">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773659">bits</span>&nbsp;<span class="op" id="1773664">=</span>&nbsp;<span class="ident" id="1773666">math</span><span class="op" id="1773670">.</span><span class="ident" id="1773671">Float64bits</span><span class="op" id="1773682">(</span><span class="ident" id="1773683">val</span><span class="op" id="1773686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773690">flt</span>&nbsp;<span class="op" id="1773694">=</span>&nbsp;<span class="op" id="1773696">&amp;</span><span class="ident" id="1773697">float64info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773710">default</span><span class="op" id="1773717">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1773721">panic</span><span class="op" id="1773726">(</span><span class="string" id="1773727">&#34;strconv:&nbsp;illegal&nbsp;AppendFloat/FormatFloat&nbsp;bitSize&#34;</span><span class="op" id="1773777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1773780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773784">neg</span>&nbsp;<span class="op" id="1773788">:=</span>&nbsp;<span class="ident" id="1773791">bits</span><span class="op" id="1773795">&gt;&gt;</span><span class="op" id="1773797">(</span><span class="ident" id="1773798">flt</span><span class="op" id="1773801">.</span><span class="ident" id="1773802">expbits</span><span class="op" id="1773809">+</span><span class="ident" id="1773810">flt</span><span class="op" id="1773813">.</span><span class="ident" id="1773814">mantbits</span><span class="op" id="1773822">)</span>&nbsp;<span class="op" id="1773824">!=</span>&nbsp;<span class="num" id="1773827">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773830">exp</span>&nbsp;<span class="op" id="1773834">:=</span>&nbsp;<span class="builtintype" id="1773837">int</span><span class="op" id="1773840">(</span><span class="ident" id="1773841">bits</span><span class="op" id="1773845">&gt;&gt;</span><span class="ident" id="1773847">flt</span><span class="op" id="1773850">.</span><span class="ident" id="1773851">mantbits</span><span class="op" id="1773859">)</span>&nbsp;<span class="op" id="1773861">&amp;</span>&nbsp;<span class="op" id="1773863">(</span><span class="num" id="1773864">1</span><span class="op" id="1773865">&lt;&lt;</span><span class="ident" id="1773867">flt</span><span class="op" id="1773870">.</span><span class="ident" id="1773871">expbits</span>&nbsp;<span class="op" id="1773879">-</span>&nbsp;<span class="num" id="1773881">1</span><span class="op" id="1773882">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1773885">mant</span>&nbsp;<span class="op" id="1773890">:=</span>&nbsp;<span class="ident" id="1773893">bits</span>&nbsp;<span class="op" id="1773898">&amp;</span>&nbsp;<span class="op" id="1773900">(</span><span class="ident" id="1773901">uint64</span><span class="op" id="1773907">(</span><span class="num" id="1773908">1</span><span class="op" id="1773909">)</span><span class="op" id="1773910">&lt;&lt;</span><span class="ident" id="1773912">flt</span><span class="op" id="1773915">.</span><span class="ident" id="1773916">mantbits</span>&nbsp;<span class="op" id="1773925">-</span>&nbsp;<span class="num" id="1773927">1</span><span class="op" id="1773928">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773932">switch</span>&nbsp;<span class="ident" id="1773939">exp</span>&nbsp;<span class="op" id="1773943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773946">case</span>&nbsp;<span class="num" id="1773951">1</span><span class="op" id="1773952">&lt;&lt;</span><span class="ident" id="1773954">flt</span><span class="op" id="1773957">.</span><span class="ident" id="1773958">expbits</span>&nbsp;<span class="op" id="1773966">-</span>&nbsp;<span class="num" id="1773968">1</span><span class="op" id="1773969">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1773973">//&nbsp;Inf,&nbsp;NaN</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1773987">var</span>&nbsp;<span class="ident" id="1773991">s</span>&nbsp;<span class="builtintype" id="1773993">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774002">switch</span>&nbsp;<span class="op" id="1774009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774013">case</span>&nbsp;<span class="ident" id="1774018">mant</span>&nbsp;<span class="op" id="1774023">!=</span>&nbsp;<span class="num" id="1774026">0</span><span class="op" id="1774027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774032">s</span>&nbsp;<span class="op" id="1774034">=</span>&nbsp;<span class="string" id="1774036">&#34;NaN&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774044">case</span>&nbsp;<span class="ident" id="1774049">neg</span><span class="op" id="1774052">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774057">s</span>&nbsp;<span class="op" id="1774059">=</span>&nbsp;<span class="string" id="1774061">&#34;-Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774070">default</span><span class="op" id="1774077">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774082">s</span>&nbsp;<span class="op" id="1774084">=</span>&nbsp;<span class="string" id="1774086">&#34;+Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1774095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774099">return</span>&nbsp;<span class="builtinfunc" id="1774106">append</span><span class="op" id="1774112">(</span><span class="ident" id="1774113">dst</span><span class="op" id="1774116">,</span>&nbsp;<span class="ident" id="1774118">s</span><span class="op" id="1774119">...</span><span class="op" id="1774122">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774126">case</span>&nbsp;<span class="num" id="1774131">0</span><span class="op" id="1774132">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1774136">//&nbsp;denormalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774154">exp</span><span class="op" id="1774157">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774162">default</span><span class="op" id="1774169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1774173">//&nbsp;add&nbsp;implicit&nbsp;top&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774199">mant</span>&nbsp;<span class="op" id="1774204">|=</span>&nbsp;<span class="ident" id="1774207">uint64</span><span class="op" id="1774213">(</span><span class="num" id="1774214">1</span><span class="op" id="1774215">)</span>&nbsp;<span class="op" id="1774217">&lt;&lt;</span>&nbsp;<span class="ident" id="1774220">flt</span><span class="op" id="1774223">.</span><span class="ident" id="1774224">mantbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1774234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774237">exp</span>&nbsp;<span class="op" id="1774241">+=</span>&nbsp;<span class="ident" id="1774244">flt</span><span class="op" id="1774247">.</span><span class="ident" id="1774248">bias</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1774255">//&nbsp;Pick&nbsp;off&nbsp;easy&nbsp;binary&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774288">if</span>&nbsp;<span class="ident" id="1774291">fmt</span>&nbsp;<span class="op" id="1774295">==</span>&nbsp;<span class="string" id="1774298">&#39;b&#39;</span>&nbsp;<span class="op" id="1774302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774306">return</span>&nbsp;<span class="ident" id="1774313">fmtB</span><span class="op" id="1774317">(</span><span class="ident" id="1774318">dst</span><span class="op" id="1774321">,</span>&nbsp;<span class="ident" id="1774323">neg</span><span class="op" id="1774326">,</span>&nbsp;<span class="ident" id="1774328">mant</span><span class="op" id="1774332">,</span>&nbsp;<span class="ident" id="1774334">exp</span><span class="op" id="1774337">,</span>&nbsp;<span class="ident" id="1774339">flt</span><span class="op" id="1774342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1774345">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774349">if</span>&nbsp;<span class="op" id="1774352">!</span><span class="ident" id="1774353">optimize</span>&nbsp;<span class="op" id="1774362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774366">return</span>&nbsp;<span class="ident" id="1774373">bigFtoa</span><span class="op" id="1774380">(</span><span class="ident" id="1774381">dst</span><span class="op" id="1774384">,</span>&nbsp;<span class="ident" id="1774386">prec</span><span class="op" id="1774390">,</span>&nbsp;<span class="ident" id="1774392">fmt</span><span class="op" id="1774395">,</span>&nbsp;<span class="ident" id="1774397">neg</span><span class="op" id="1774400">,</span>&nbsp;<span class="ident" id="1774402">mant</span><span class="op" id="1774406">,</span>&nbsp;<span class="ident" id="1774408">exp</span><span class="op" id="1774411">,</span>&nbsp;<span class="ident" id="1774413">flt</span><span class="op" id="1774416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1774419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774423">var</span>&nbsp;<span class="ident" id="1774427">digs</span>&nbsp;<span class="ident" id="1774432">decimalSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774446">ok</span>&nbsp;<span class="op" id="1774449">:=</span>&nbsp;<span class="builtintype" id="1774452">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1774459">//&nbsp;Negative&nbsp;precision&nbsp;means&nbsp;&#34;only&nbsp;as&nbsp;much&nbsp;as&nbsp;needed&nbsp;to&nbsp;be&nbsp;exact.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774526">shortest</span>&nbsp;<span class="op" id="1774535">:=</span>&nbsp;<span class="ident" id="1774538">prec</span>&nbsp;<span class="op" id="1774543">&lt;</span>&nbsp;<span class="num" id="1774545">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774548">if</span>&nbsp;<span class="ident" id="1774551">shortest</span>&nbsp;<span class="op" id="1774560">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1774564">//&nbsp;Try&nbsp;Grisu3&nbsp;algorithm.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774591">f</span>&nbsp;<span class="op" id="1774593">:=</span>&nbsp;<span class="builtinfunc" id="1774596">new</span><span class="op" id="1774599">(</span><span class="ident" id="1774600">extFloat</span><span class="op" id="1774608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774612">lower</span><span class="op" id="1774617">,</span>&nbsp;<span class="ident" id="1774619">upper</span>&nbsp;<span class="op" id="1774625">:=</span>&nbsp;<span class="ident" id="1774628">f</span><span class="op" id="1774629">.</span><span class="ident" id="1774630">AssignComputeBounds</span><span class="op" id="1774649">(</span><span class="ident" id="1774650">mant</span><span class="op" id="1774654">,</span>&nbsp;<span class="ident" id="1774656">exp</span><span class="op" id="1774659">,</span>&nbsp;<span class="ident" id="1774661">neg</span><span class="op" id="1774664">,</span>&nbsp;<span class="ident" id="1774666">flt</span><span class="op" id="1774669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774673">var</span>&nbsp;<span class="ident" id="1774677">buf</span>&nbsp;<span class="op" id="1774681">[</span><span class="num" id="1774682">32</span><span class="op" id="1774684">]</span><span class="builtintype" id="1774685">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774692">digs</span><span class="op" id="1774696">.</span><span class="ident" id="1774697">d</span>&nbsp;<span class="op" id="1774699">=</span>&nbsp;<span class="ident" id="1774701">buf</span><span class="op" id="1774704">[</span><span class="op" id="1774705">:</span><span class="op" id="1774706">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774710">ok</span>&nbsp;<span class="op" id="1774713">=</span>&nbsp;<span class="ident" id="1774715">f</span><span class="op" id="1774716">.</span><span class="ident" id="1774717">ShortestDecimal</span><span class="op" id="1774732">(</span><span class="op" id="1774733">&amp;</span><span class="ident" id="1774734">digs</span><span class="op" id="1774738">,</span>&nbsp;<span class="op" id="1774740">&amp;</span><span class="ident" id="1774741">lower</span><span class="op" id="1774746">,</span>&nbsp;<span class="op" id="1774748">&amp;</span><span class="ident" id="1774749">upper</span><span class="op" id="1774754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774758">if</span>&nbsp;<span class="op" id="1774761">!</span><span class="ident" id="1774762">ok</span>&nbsp;<span class="op" id="1774765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774770">return</span>&nbsp;<span class="ident" id="1774777">bigFtoa</span><span class="op" id="1774784">(</span><span class="ident" id="1774785">dst</span><span class="op" id="1774788">,</span>&nbsp;<span class="ident" id="1774790">prec</span><span class="op" id="1774794">,</span>&nbsp;<span class="ident" id="1774796">fmt</span><span class="op" id="1774799">,</span>&nbsp;<span class="ident" id="1774801">neg</span><span class="op" id="1774804">,</span>&nbsp;<span class="ident" id="1774806">mant</span><span class="op" id="1774810">,</span>&nbsp;<span class="ident" id="1774812">exp</span><span class="op" id="1774815">,</span>&nbsp;<span class="ident" id="1774817">flt</span><span class="op" id="1774820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1774824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1774828">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774877">switch</span>&nbsp;<span class="ident" id="1774884">fmt</span>&nbsp;<span class="op" id="1774888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774892">case</span>&nbsp;<span class="string" id="1774897">&#39;e&#39;</span><span class="op" id="1774900">,</span>&nbsp;<span class="string" id="1774902">&#39;E&#39;</span><span class="op" id="1774905">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774910">prec</span>&nbsp;<span class="op" id="1774915">=</span>&nbsp;<span class="ident" id="1774917">digs</span><span class="op" id="1774921">.</span><span class="ident" id="1774922">nd</span>&nbsp;<span class="op" id="1774925">-</span>&nbsp;<span class="num" id="1774927">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774931">case</span>&nbsp;<span class="string" id="1774936">&#39;f&#39;</span><span class="op" id="1774939">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774944">prec</span>&nbsp;<span class="op" id="1774949">=</span>&nbsp;<span class="ident" id="1774951">max</span><span class="op" id="1774954">(</span><span class="ident" id="1774955">digs</span><span class="op" id="1774959">.</span><span class="ident" id="1774960">nd</span><span class="op" id="1774962">-</span><span class="ident" id="1774963">digs</span><span class="op" id="1774967">.</span><span class="ident" id="1774968">dp</span><span class="op" id="1774970">,</span>&nbsp;<span class="num" id="1774972">0</span><span class="op" id="1774973">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1774977">case</span>&nbsp;<span class="string" id="1774982">&#39;g&#39;</span><span class="op" id="1774985">,</span>&nbsp;<span class="string" id="1774987">&#39;G&#39;</span><span class="op" id="1774990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1774995">prec</span>&nbsp;<span class="op" id="1775000">=</span>&nbsp;<span class="ident" id="1775002">digs</span><span class="op" id="1775006">.</span><span class="ident" id="1775007">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1775012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1775015">}</span>&nbsp;<span class="keyword" id="1775017">else</span>&nbsp;<span class="keyword" id="1775022">if</span>&nbsp;<span class="ident" id="1775025">fmt</span>&nbsp;<span class="op" id="1775029">!=</span>&nbsp;<span class="string" id="1775032">&#39;f&#39;</span>&nbsp;<span class="op" id="1775036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1775040">//&nbsp;Fixed&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775069">digits</span>&nbsp;<span class="op" id="1775076">:=</span>&nbsp;<span class="ident" id="1775079">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775086">switch</span>&nbsp;<span class="ident" id="1775093">fmt</span>&nbsp;<span class="op" id="1775097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775101">case</span>&nbsp;<span class="string" id="1775106">&#39;e&#39;</span><span class="op" id="1775109">,</span>&nbsp;<span class="string" id="1775111">&#39;E&#39;</span><span class="op" id="1775114">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775119">digits</span><span class="op" id="1775125">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775130">case</span>&nbsp;<span class="string" id="1775135">&#39;g&#39;</span><span class="op" id="1775138">,</span>&nbsp;<span class="string" id="1775140">&#39;G&#39;</span><span class="op" id="1775143">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775148">if</span>&nbsp;<span class="ident" id="1775151">prec</span>&nbsp;<span class="op" id="1775156">==</span>&nbsp;<span class="num" id="1775159">0</span>&nbsp;<span class="op" id="1775161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775167">prec</span>&nbsp;<span class="op" id="1775172">=</span>&nbsp;<span class="num" id="1775174">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1775179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775184">digits</span>&nbsp;<span class="op" id="1775191">=</span>&nbsp;<span class="ident" id="1775193">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1775200">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775204">if</span>&nbsp;<span class="ident" id="1775207">digits</span>&nbsp;<span class="op" id="1775214">&lt;=</span>&nbsp;<span class="num" id="1775217">15</span>&nbsp;<span class="op" id="1775220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1775225">//&nbsp;try&nbsp;fast&nbsp;algorithm&nbsp;when&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;is&nbsp;reasonable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775291">var</span>&nbsp;<span class="ident" id="1775295">buf</span>&nbsp;<span class="op" id="1775299">[</span><span class="num" id="1775300">24</span><span class="op" id="1775302">]</span><span class="builtintype" id="1775303">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775311">digs</span><span class="op" id="1775315">.</span><span class="ident" id="1775316">d</span>&nbsp;<span class="op" id="1775318">=</span>&nbsp;<span class="ident" id="1775320">buf</span><span class="op" id="1775323">[</span><span class="op" id="1775324">:</span><span class="op" id="1775325">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775330">f</span>&nbsp;<span class="op" id="1775332">:=</span>&nbsp;<span class="ident" id="1775335">extFloat</span><span class="op" id="1775343">{</span><span class="ident" id="1775344">mant</span><span class="op" id="1775348">,</span>&nbsp;<span class="ident" id="1775350">exp</span>&nbsp;<span class="op" id="1775354">-</span>&nbsp;<span class="builtintype" id="1775356">int</span><span class="op" id="1775359">(</span><span class="ident" id="1775360">flt</span><span class="op" id="1775363">.</span><span class="ident" id="1775364">mantbits</span><span class="op" id="1775372">)</span><span class="op" id="1775373">,</span>&nbsp;<span class="ident" id="1775375">neg</span><span class="op" id="1775378">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775383">ok</span>&nbsp;<span class="op" id="1775386">=</span>&nbsp;<span class="ident" id="1775388">f</span><span class="op" id="1775389">.</span><span class="ident" id="1775390">FixedDecimal</span><span class="op" id="1775402">(</span><span class="op" id="1775403">&amp;</span><span class="ident" id="1775404">digs</span><span class="op" id="1775408">,</span>&nbsp;<span class="ident" id="1775410">digits</span><span class="op" id="1775416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1775420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1775423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775426">if</span>&nbsp;<span class="op" id="1775429">!</span><span class="ident" id="1775430">ok</span>&nbsp;<span class="op" id="1775433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775437">return</span>&nbsp;<span class="ident" id="1775444">bigFtoa</span><span class="op" id="1775451">(</span><span class="ident" id="1775452">dst</span><span class="op" id="1775455">,</span>&nbsp;<span class="ident" id="1775457">prec</span><span class="op" id="1775461">,</span>&nbsp;<span class="ident" id="1775463">fmt</span><span class="op" id="1775466">,</span>&nbsp;<span class="ident" id="1775468">neg</span><span class="op" id="1775471">,</span>&nbsp;<span class="ident" id="1775473">mant</span><span class="op" id="1775477">,</span>&nbsp;<span class="ident" id="1775479">exp</span><span class="op" id="1775482">,</span>&nbsp;<span class="ident" id="1775484">flt</span><span class="op" id="1775487">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1775490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775493">return</span>&nbsp;<span class="ident" id="1775500">formatDigits</span><span class="op" id="1775512">(</span><span class="ident" id="1775513">dst</span><span class="op" id="1775516">,</span>&nbsp;<span class="ident" id="1775518">shortest</span><span class="op" id="1775526">,</span>&nbsp;<span class="ident" id="1775528">neg</span><span class="op" id="1775531">,</span>&nbsp;<span class="ident" id="1775533">digs</span><span class="op" id="1775537">,</span>&nbsp;<span class="ident" id="1775539">prec</span><span class="op" id="1775543">,</span>&nbsp;<span class="ident" id="1775545">fmt</span><span class="op" id="1775548">)</span><br>
<span class="lineno"></span><span class="op" id="1775550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1775553">//&nbsp;bigFtoa&nbsp;uses&nbsp;multiprecision&nbsp;computations&nbsp;to&nbsp;format&nbsp;a&nbsp;float.</span><br>
<span class="lineno">155</span><span class="keyword" id="1775616">func</span>&nbsp;<span class="ident" id="1775621">bigFtoa</span><span class="op" id="1775628">(</span><span class="ident" id="1775629">dst</span>&nbsp;<span class="op" id="1775633">[</span><span class="op" id="1775634">]</span><span class="builtintype" id="1775635">byte</span><span class="op" id="1775639">,</span>&nbsp;<span class="ident" id="1775641">prec</span>&nbsp;<span class="builtintype" id="1775646">int</span><span class="op" id="1775649">,</span>&nbsp;<span class="ident" id="1775651">fmt</span>&nbsp;<span class="builtintype" id="1775655">byte</span><span class="op" id="1775659">,</span>&nbsp;<span class="ident" id="1775661">neg</span>&nbsp;<span class="builtintype" id="1775665">bool</span><span class="op" id="1775669">,</span>&nbsp;<span class="ident" id="1775671">mant</span>&nbsp;<span class="ident" id="1775676">uint64</span><span class="op" id="1775682">,</span>&nbsp;<span class="ident" id="1775684">exp</span>&nbsp;<span class="builtintype" id="1775688">int</span><span class="op" id="1775691">,</span>&nbsp;<span class="ident" id="1775693">flt</span>&nbsp;<span class="op" id="1775697">*</span><span class="ident" id="1775698">floatInfo</span><span class="op" id="1775707">)</span>&nbsp;<span class="op" id="1775709">[</span><span class="op" id="1775710">]</span><span class="builtintype" id="1775711">byte</span>&nbsp;<span class="op" id="1775716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775719">d</span>&nbsp;<span class="op" id="1775721">:=</span>&nbsp;<span class="builtinfunc" id="1775724">new</span><span class="op" id="1775727">(</span><span class="ident" id="1775728">decimal</span><span class="op" id="1775735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775738">d</span><span class="op" id="1775739">.</span><span class="ident" id="1775740">Assign</span><span class="op" id="1775746">(</span><span class="ident" id="1775747">mant</span><span class="op" id="1775751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775754">d</span><span class="op" id="1775755">.</span><span class="ident" id="1775756">Shift</span><span class="op" id="1775761">(</span><span class="ident" id="1775762">exp</span>&nbsp;<span class="op" id="1775766">-</span>&nbsp;<span class="builtintype" id="1775768">int</span><span class="op" id="1775771">(</span><span class="ident" id="1775772">flt</span><span class="op" id="1775775">.</span><span class="ident" id="1775776">mantbits</span><span class="op" id="1775784">)</span><span class="op" id="1775785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775788">var</span>&nbsp;<span class="ident" id="1775792">digs</span>&nbsp;<span class="ident" id="1775797">decimalSlice</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775811">shortest</span>&nbsp;<span class="op" id="1775820">:=</span>&nbsp;<span class="ident" id="1775823">prec</span>&nbsp;<span class="op" id="1775828">&lt;</span>&nbsp;<span class="num" id="1775830">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775833">if</span>&nbsp;<span class="ident" id="1775836">shortest</span>&nbsp;<span class="op" id="1775845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775849">roundShortest</span><span class="op" id="1775862">(</span><span class="ident" id="1775863">d</span><span class="op" id="1775864">,</span>&nbsp;<span class="ident" id="1775866">mant</span><span class="op" id="1775870">,</span>&nbsp;<span class="ident" id="1775872">exp</span><span class="op" id="1775875">,</span>&nbsp;<span class="ident" id="1775877">flt</span><span class="op" id="1775880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1775884">digs</span>&nbsp;<span class="op" id="1775889">=</span>&nbsp;<span class="ident" id="1775891">decimalSlice</span><span class="op" id="1775903">{</span><span class="ident" id="1775904">d</span><span class="op" id="1775905">:</span>&nbsp;<span class="ident" id="1775907">d</span><span class="op" id="1775908">.</span><span class="ident" id="1775909">d</span><span class="op" id="1775910">[</span><span class="op" id="1775911">:</span><span class="op" id="1775912">]</span><span class="op" id="1775913">,</span>&nbsp;<span class="ident" id="1775915">nd</span><span class="op" id="1775917">:</span>&nbsp;<span class="ident" id="1775919">d</span><span class="op" id="1775920">.</span><span class="ident" id="1775921">nd</span><span class="op" id="1775923">,</span>&nbsp;<span class="ident" id="1775925">dp</span><span class="op" id="1775927">:</span>&nbsp;<span class="ident" id="1775929">d</span><span class="op" id="1775930">.</span><span class="ident" id="1775931">dp</span><span class="op" id="1775933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1775937">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1775986">switch</span>&nbsp;<span class="ident" id="1775993">fmt</span>&nbsp;<span class="op" id="1775997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776001">case</span>&nbsp;<span class="string" id="1776006">&#39;e&#39;</span><span class="op" id="1776009">,</span>&nbsp;<span class="string" id="1776011">&#39;E&#39;</span><span class="op" id="1776014">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1776019">prec</span>&nbsp;<span class="op" id="1776024">=</span>&nbsp;<span class="ident" id="1776026">digs</span><span class="op" id="1776030">.</span><span class="ident" id="1776031">nd</span>&nbsp;<span class="op" id="1776034">-</span>&nbsp;<span class="num" id="1776036">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776040">case</span>&nbsp;<span class="string" id="1776045">&#39;f&#39;</span><span class="op" id="1776048">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1776053">prec</span>&nbsp;<span class="op" id="1776058">=</span>&nbsp;<span class="ident" id="1776060">max</span><span class="op" id="1776063">(</span><span class="ident" id="1776064">digs</span><span class="op" id="1776068">.</span><span class="ident" id="1776069">nd</span><span class="op" id="1776071">-</span><span class="ident" id="1776072">digs</span><span class="op" id="1776076">.</span><span class="ident" id="1776077">dp</span><span class="op" id="1776079">,</span>&nbsp;<span class="num" id="1776081">0</span><span class="op" id="1776082">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776086">case</span>&nbsp;<span class="string" id="1776091">&#39;g&#39;</span><span class="op" id="1776094">,</span>&nbsp;<span class="string" id="1776096">&#39;G&#39;</span><span class="op" id="1776099">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1776104">prec</span>&nbsp;<span class="op" id="1776109">=</span>&nbsp;<span class="ident" id="1776111">digs</span><span class="op" id="1776115">.</span><span class="ident" id="1776116">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1776121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1776124">}</span>&nbsp;<span class="keyword" id="1776126">else</span>&nbsp;<span class="op" id="1776131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1776135">//&nbsp;Round&nbsp;appropriately.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776161">switch</span>&nbsp;<span class="ident" id="1776168">fmt</span>&nbsp;<span class="op" id="1776172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776176">case</span>&nbsp;<span class="string" id="1776181">&#39;e&#39;</span><span class="op" id="1776184">,</span>&nbsp;<span class="string" id="1776186">&#39;E&#39;</span><span class="op" id="1776189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1776194">d</span><span class="op" id="1776195">.</span><span class="ident" id="1776196">Round</span><span class="op" id="1776201">(</span><span class="ident" id="1776202">prec</span>&nbsp;<span class="op" id="1776207">+</span>&nbsp;<span class="num" id="1776209">1</span><span class="op" id="1776210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776214">case</span>&nbsp;<span class="string" id="1776219">&#39;f&#39;</span><span class="op" id="1776222">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1776227">d</span><span class="op" id="1776228">.</span><span class="ident" id="1776229">Round</span><span class="op" id="1776234">(</span><span class="ident" id="1776235">d</span><span class="op" id="1776236">.</span><span class="ident" id="1776237">dp</span>&nbsp;<span class="op" id="1776240">+</span>&nbsp;<span class="ident" id="1776242">prec</span><span class="op" id="1776246">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776250">case</span>&nbsp;<span class="string" id="1776255">&#39;g&#39;</span><span class="op" id="1776258">,</span>&nbsp;<span class="string" id="1776260">&#39;G&#39;</span><span class="op" id="1776263">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776268">if</span>&nbsp;<span class="ident" id="1776271">prec</span>&nbsp;<span class="op" id="1776276">==</span>&nbsp;<span class="num" id="1776279">0</span>&nbsp;<span class="op" id="1776281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1776287">prec</span>&nbsp;<span class="op" id="1776292">=</span>&nbsp;<span class="num" id="1776294">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1776299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1776304">d</span><span class="op" id="1776305">.</span><span class="ident" id="1776306">Round</span><span class="op" id="1776311">(</span><span class="ident" id="1776312">prec</span><span class="op" id="1776316">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1776320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1776324">digs</span>&nbsp;<span class="op" id="1776329">=</span>&nbsp;<span class="ident" id="1776331">decimalSlice</span><span class="op" id="1776343">{</span><span class="ident" id="1776344">d</span><span class="op" id="1776345">:</span>&nbsp;<span class="ident" id="1776347">d</span><span class="op" id="1776348">.</span><span class="ident" id="1776349">d</span><span class="op" id="1776350">[</span><span class="op" id="1776351">:</span><span class="op" id="1776352">]</span><span class="op" id="1776353">,</span>&nbsp;<span class="ident" id="1776355">nd</span><span class="op" id="1776357">:</span>&nbsp;<span class="ident" id="1776359">d</span><span class="op" id="1776360">.</span><span class="ident" id="1776361">nd</span><span class="op" id="1776363">,</span>&nbsp;<span class="ident" id="1776365">dp</span><span class="op" id="1776367">:</span>&nbsp;<span class="ident" id="1776369">d</span><span class="op" id="1776370">.</span><span class="ident" id="1776371">dp</span><span class="op" id="1776373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1776376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776379">return</span>&nbsp;<span class="ident" id="1776386">formatDigits</span><span class="op" id="1776398">(</span><span class="ident" id="1776399">dst</span><span class="op" id="1776402">,</span>&nbsp;<span class="ident" id="1776404">shortest</span><span class="op" id="1776412">,</span>&nbsp;<span class="ident" id="1776414">neg</span><span class="op" id="1776417">,</span>&nbsp;<span class="ident" id="1776419">digs</span><span class="op" id="1776423">,</span>&nbsp;<span class="ident" id="1776425">prec</span><span class="op" id="1776429">,</span>&nbsp;<span class="ident" id="1776431">fmt</span><span class="op" id="1776434">)</span><br>
<span class="lineno"></span><span class="op" id="1776436">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="1776439">func</span>&nbsp;<span class="ident" id="1776444">formatDigits</span><span class="op" id="1776456">(</span><span class="ident" id="1776457">dst</span>&nbsp;<span class="op" id="1776461">[</span><span class="op" id="1776462">]</span><span class="builtintype" id="1776463">byte</span><span class="op" id="1776467">,</span>&nbsp;<span class="ident" id="1776469">shortest</span>&nbsp;<span class="builtintype" id="1776478">bool</span><span class="op" id="1776482">,</span>&nbsp;<span class="ident" id="1776484">neg</span>&nbsp;<span class="builtintype" id="1776488">bool</span><span class="op" id="1776492">,</span>&nbsp;<span class="ident" id="1776494">digs</span>&nbsp;<span class="ident" id="1776499">decimalSlice</span><span class="op" id="1776511">,</span>&nbsp;<span class="ident" id="1776513">prec</span>&nbsp;<span class="builtintype" id="1776518">int</span><span class="op" id="1776521">,</span>&nbsp;<span class="ident" id="1776523">fmt</span>&nbsp;<span class="builtintype" id="1776527">byte</span><span class="op" id="1776531">)</span>&nbsp;<span class="op" id="1776533">[</span><span class="op" id="1776534">]</span><span class="builtintype" id="1776535">byte</span>&nbsp;<span class="op" id="1776540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776543">switch</span>&nbsp;<span class="ident" id="1776550">fmt</span>&nbsp;<span class="op" id="1776554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776557">case</span>&nbsp;<span class="string" id="1776562">&#39;e&#39;</span><span class="op" id="1776565">,</span>&nbsp;<span class="string" id="1776567">&#39;E&#39;</span><span class="op" id="1776570">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776574">return</span>&nbsp;<span class="ident" id="1776581">fmtE</span><span class="op" id="1776585">(</span><span class="ident" id="1776586">dst</span><span class="op" id="1776589">,</span>&nbsp;<span class="ident" id="1776591">neg</span><span class="op" id="1776594">,</span>&nbsp;<span class="ident" id="1776596">digs</span><span class="op" id="1776600">,</span>&nbsp;<span class="ident" id="1776602">prec</span><span class="op" id="1776606">,</span>&nbsp;<span class="ident" id="1776608">fmt</span><span class="op" id="1776611">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776614">case</span>&nbsp;<span class="string" id="1776619">&#39;f&#39;</span><span class="op" id="1776622">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776626">return</span>&nbsp;<span class="ident" id="1776633">fmtF</span><span class="op" id="1776637">(</span><span class="ident" id="1776638">dst</span><span class="op" id="1776641">,</span>&nbsp;<span class="ident" id="1776643">neg</span><span class="op" id="1776646">,</span>&nbsp;<span class="ident" id="1776648">digs</span><span class="op" id="1776652">,</span>&nbsp;<span class="ident" id="1776654">prec</span><span class="op" id="1776658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776661">case</span>&nbsp;<span class="string" id="1776666">&#39;g&#39;</span><span class="op" id="1776669">,</span>&nbsp;<span class="string" id="1776671">&#39;G&#39;</span><span class="op" id="1776674">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1776678">//&nbsp;trailing&nbsp;fractional&nbsp;zeros&nbsp;in&nbsp;&#39;e&#39;&nbsp;form&nbsp;will&nbsp;be&nbsp;trimmed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1776738">eprec</span>&nbsp;<span class="op" id="1776744">:=</span>&nbsp;<span class="ident" id="1776747">prec</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1776754">if</span>&nbsp;<span class="ident" id="1776757">eprec</span>&nbsp;<span class="op" id="1776763">&gt;</span>&nbsp;<span class="ident" id="1776765">digs</span><span class="op" id="1776769">.</span><span class="ident" id="1776770">nd</span>&nbsp;<span class="op" id="1776773">&amp;&amp;</span>&nbsp;<span class="ident" id="1776776">digs</span><span class="op" id="1776780">.</span><span class="ident" id="1776781">nd</span>&nbsp;<span class="op" id="1776784">&gt;=</span>&nbsp;<span class="ident" id="1776787">digs</span><span class="op" id="1776791">.</span><span class="ident" id="1776792">dp</span>&nbsp;<span class="op" id="1776795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1776800">eprec</span>&nbsp;<span class="op" id="1776806">=</span>&nbsp;<span class="ident" id="1776808">digs</span><span class="op" id="1776812">.</span><span class="ident" id="1776813">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1776818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1776822">//&nbsp;%e&nbsp;is&nbsp;used&nbsp;if&nbsp;the&nbsp;exponent&nbsp;from&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1776874">//&nbsp;is&nbsp;less&nbsp;than&nbsp;-4&nbsp;or&nbsp;greater&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;the&nbsp;precision.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1776938">//&nbsp;if&nbsp;precision&nbsp;was&nbsp;the&nbsp;shortest&nbsp;possible,&nbsp;use&nbsp;precision&nbsp;6&nbsp;for&nbsp;this&nbsp;decision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777018">if</span>&nbsp;<span class="ident" id="1777021">shortest</span>&nbsp;<span class="op" id="1777030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1777035">eprec</span>&nbsp;<span class="op" id="1777041">=</span>&nbsp;<span class="num" id="1777043">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1777047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1777051">exp</span>&nbsp;<span class="op" id="1777055">:=</span>&nbsp;<span class="ident" id="1777058">digs</span><span class="op" id="1777062">.</span><span class="ident" id="1777063">dp</span>&nbsp;<span class="op" id="1777066">-</span>&nbsp;<span class="num" id="1777068">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777072">if</span>&nbsp;<span class="ident" id="1777075">exp</span>&nbsp;<span class="op" id="1777079">&lt;</span>&nbsp;<span class="op" id="1777081">-</span><span class="num" id="1777082">4</span>&nbsp;<span class="op" id="1777084">||</span>&nbsp;<span class="ident" id="1777087">exp</span>&nbsp;<span class="op" id="1777091">&gt;=</span>&nbsp;<span class="ident" id="1777094">eprec</span>&nbsp;<span class="op" id="1777100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777105">if</span>&nbsp;<span class="ident" id="1777108">prec</span>&nbsp;<span class="op" id="1777113">&gt;</span>&nbsp;<span class="ident" id="1777115">digs</span><span class="op" id="1777119">.</span><span class="ident" id="1777120">nd</span>&nbsp;<span class="op" id="1777123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1777129">prec</span>&nbsp;<span class="op" id="1777134">=</span>&nbsp;<span class="ident" id="1777136">digs</span><span class="op" id="1777140">.</span><span class="ident" id="1777141">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1777147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777152">return</span>&nbsp;<span class="ident" id="1777159">fmtE</span><span class="op" id="1777163">(</span><span class="ident" id="1777164">dst</span><span class="op" id="1777167">,</span>&nbsp;<span class="ident" id="1777169">neg</span><span class="op" id="1777172">,</span>&nbsp;<span class="ident" id="1777174">digs</span><span class="op" id="1777178">,</span>&nbsp;<span class="ident" id="1777180">prec</span><span class="op" id="1777184">-</span><span class="num" id="1777185">1</span><span class="op" id="1777186">,</span>&nbsp;<span class="ident" id="1777188">fmt</span><span class="op" id="1777191">+</span><span class="string" id="1777192">&#39;e&#39;</span><span class="op" id="1777195">-</span><span class="string" id="1777196">&#39;g&#39;</span><span class="op" id="1777199">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1777203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777207">if</span>&nbsp;<span class="ident" id="1777210">prec</span>&nbsp;<span class="op" id="1777215">&gt;</span>&nbsp;<span class="ident" id="1777217">digs</span><span class="op" id="1777221">.</span><span class="ident" id="1777222">dp</span>&nbsp;<span class="op" id="1777225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1777230">prec</span>&nbsp;<span class="op" id="1777235">=</span>&nbsp;<span class="ident" id="1777237">digs</span><span class="op" id="1777241">.</span><span class="ident" id="1777242">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1777247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777251">return</span>&nbsp;<span class="ident" id="1777258">fmtF</span><span class="op" id="1777262">(</span><span class="ident" id="1777263">dst</span><span class="op" id="1777266">,</span>&nbsp;<span class="ident" id="1777268">neg</span><span class="op" id="1777271">,</span>&nbsp;<span class="ident" id="1777273">digs</span><span class="op" id="1777277">,</span>&nbsp;<span class="ident" id="1777279">max</span><span class="op" id="1777282">(</span><span class="ident" id="1777283">prec</span><span class="op" id="1777287">-</span><span class="ident" id="1777288">digs</span><span class="op" id="1777292">.</span><span class="ident" id="1777293">dp</span><span class="op" id="1777295">,</span>&nbsp;<span class="num" id="1777297">0</span><span class="op" id="1777298">)</span><span class="op" id="1777299">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1777302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1777306">//&nbsp;unknown&nbsp;format</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777325">return</span>&nbsp;<span class="builtinfunc" id="1777332">append</span><span class="op" id="1777338">(</span><span class="ident" id="1777339">dst</span><span class="op" id="1777342">,</span>&nbsp;<span class="string" id="1777344">&#39;%&#39;</span><span class="op" id="1777347">,</span>&nbsp;<span class="ident" id="1777349">fmt</span><span class="op" id="1777352">)</span><br>
<span class="lineno"></span><span class="op" id="1777354">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="1777357">//&nbsp;Round&nbsp;d&nbsp;(=&nbsp;mant&nbsp;*&nbsp;2^exp)&nbsp;to&nbsp;the&nbsp;shortest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="1777418">//&nbsp;that&nbsp;will&nbsp;let&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;value&nbsp;be&nbsp;precisely</span><br>
<span class="lineno"></span><span class="comment" id="1777482">//&nbsp;reconstructed.&nbsp;&nbsp;Size&nbsp;is&nbsp;original&nbsp;floating&nbsp;point&nbsp;size&nbsp;(64&nbsp;or&nbsp;32).</span><br>
<span class="lineno"></span><span class="keyword" id="1777550">func</span>&nbsp;<span class="ident" id="1777555">roundShortest</span><span class="op" id="1777568">(</span><span class="ident" id="1777569">d</span>&nbsp;<span class="op" id="1777571">*</span><span class="ident" id="1777572">decimal</span><span class="op" id="1777579">,</span>&nbsp;<span class="ident" id="1777581">mant</span>&nbsp;<span class="ident" id="1777586">uint64</span><span class="op" id="1777592">,</span>&nbsp;<span class="ident" id="1777594">exp</span>&nbsp;<span class="builtintype" id="1777598">int</span><span class="op" id="1777601">,</span>&nbsp;<span class="ident" id="1777603">flt</span>&nbsp;<span class="op" id="1777607">*</span><span class="ident" id="1777608">floatInfo</span><span class="op" id="1777617">)</span>&nbsp;<span class="op" id="1777619">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1777622">//&nbsp;If&nbsp;mantissa&nbsp;is&nbsp;zero,&nbsp;the&nbsp;number&nbsp;is&nbsp;zero;&nbsp;stop&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777677">if</span>&nbsp;<span class="ident" id="1777680">mant</span>&nbsp;<span class="op" id="1777685">==</span>&nbsp;<span class="num" id="1777688">0</span>&nbsp;<span class="op" id="1777690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1777694">d</span><span class="op" id="1777695">.</span><span class="ident" id="1777696">nd</span>&nbsp;<span class="op" id="1777699">=</span>&nbsp;<span class="num" id="1777701">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1777705">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1777713">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1777717">//&nbsp;Compute&nbsp;upper&nbsp;and&nbsp;lower&nbsp;such&nbsp;that&nbsp;any&nbsp;decimal&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1777774">//&nbsp;between&nbsp;upper&nbsp;and&nbsp;lower&nbsp;(possibly&nbsp;inclusive)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1777823">//&nbsp;will&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;number.</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1777878">//&nbsp;We&nbsp;may&nbsp;see&nbsp;at&nbsp;once&nbsp;that&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1777938">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1777942">//&nbsp;Suppose&nbsp;d&nbsp;is&nbsp;not&nbsp;denormal,&nbsp;so&nbsp;that&nbsp;2^exp&nbsp;&lt;=&nbsp;d&nbsp;&lt;&nbsp;10^dp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778001">//&nbsp;The&nbsp;closest&nbsp;shorter&nbsp;number&nbsp;is&nbsp;at&nbsp;least&nbsp;10^(dp-nd)&nbsp;away.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778061">//&nbsp;The&nbsp;lower/upper&nbsp;bounds&nbsp;computed&nbsp;below&nbsp;are&nbsp;at&nbsp;distance</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778119">//&nbsp;at&nbsp;most&nbsp;2^(exp-mantbits).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778149">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778153">//&nbsp;So&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest&nbsp;if&nbsp;10^(dp-nd)&nbsp;&gt;&nbsp;2^(exp-mantbits),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778225">//&nbsp;or&nbsp;equivalently&nbsp;log2(10)*(dp-nd)&nbsp;&gt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778278">//&nbsp;It&nbsp;is&nbsp;true&nbsp;if&nbsp;332/100*(dp-nd)&nbsp;&gt;=&nbsp;exp-mantbits&nbsp;(log2(10)&nbsp;&gt;&nbsp;3.32).</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778347">minexp</span>&nbsp;<span class="op" id="1778354">:=</span>&nbsp;<span class="ident" id="1778357">flt</span><span class="op" id="1778360">.</span><span class="ident" id="1778361">bias</span>&nbsp;<span class="op" id="1778366">+</span>&nbsp;<span class="num" id="1778368">1</span>&nbsp;<span class="comment" id="1778370">//&nbsp;minimum&nbsp;possible&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1778400">if</span>&nbsp;<span class="ident" id="1778403">exp</span>&nbsp;<span class="op" id="1778407">&gt;</span>&nbsp;<span class="ident" id="1778409">minexp</span>&nbsp;<span class="op" id="1778416">&amp;&amp;</span>&nbsp;<span class="num" id="1778419">332</span><span class="op" id="1778422">*</span><span class="op" id="1778423">(</span><span class="ident" id="1778424">d</span><span class="op" id="1778425">.</span><span class="ident" id="1778426">dp</span><span class="op" id="1778428">-</span><span class="ident" id="1778429">d</span><span class="op" id="1778430">.</span><span class="ident" id="1778431">nd</span><span class="op" id="1778433">)</span>&nbsp;<span class="op" id="1778435">&gt;=</span>&nbsp;<span class="num" id="1778438">100</span><span class="op" id="1778441">*</span><span class="op" id="1778442">(</span><span class="ident" id="1778443">exp</span><span class="op" id="1778446">-</span><span class="builtintype" id="1778447">int</span><span class="op" id="1778450">(</span><span class="ident" id="1778451">flt</span><span class="op" id="1778454">.</span><span class="ident" id="1778455">mantbits</span><span class="op" id="1778463">)</span><span class="op" id="1778464">)</span>&nbsp;<span class="op" id="1778466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778470">//&nbsp;The&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1778507">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1778515">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778519">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778552">//&nbsp;Next&nbsp;highest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant+1&nbsp;&lt;&lt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778618">//&nbsp;Our&nbsp;upper&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mant*2+1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778686">upper</span>&nbsp;<span class="op" id="1778692">:=</span>&nbsp;<span class="builtinfunc" id="1778695">new</span><span class="op" id="1778698">(</span><span class="ident" id="1778699">decimal</span><span class="op" id="1778706">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778709">upper</span><span class="op" id="1778714">.</span><span class="ident" id="1778715">Assign</span><span class="op" id="1778721">(</span><span class="ident" id="1778722">mant</span><span class="op" id="1778726">*</span><span class="num" id="1778727">2</span>&nbsp;<span class="op" id="1778729">+</span>&nbsp;<span class="num" id="1778731">1</span><span class="op" id="1778732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1778735">upper</span><span class="op" id="1778740">.</span><span class="ident" id="1778741">Shift</span><span class="op" id="1778746">(</span><span class="ident" id="1778747">exp</span>&nbsp;<span class="op" id="1778751">-</span>&nbsp;<span class="builtintype" id="1778753">int</span><span class="op" id="1778756">(</span><span class="ident" id="1778757">flt</span><span class="op" id="1778760">.</span><span class="ident" id="1778761">mantbits</span><span class="op" id="1778769">)</span>&nbsp;<span class="op" id="1778771">-</span>&nbsp;<span class="num" id="1778773">1</span><span class="op" id="1778774">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778778">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778811">//&nbsp;Next&nbsp;lowest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant-1&nbsp;&lt;&lt;&nbsp;exp-mantbits,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778876">//&nbsp;unless&nbsp;mant-1&nbsp;drops&nbsp;the&nbsp;significant&nbsp;bit&nbsp;and&nbsp;exp&nbsp;is&nbsp;not&nbsp;the&nbsp;minimum&nbsp;exp,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1778952">//&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;next&nbsp;lowest&nbsp;is&nbsp;mant*2-1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1779017">//&nbsp;Either&nbsp;way,&nbsp;call&nbsp;it&nbsp;mantlo&nbsp;&lt;&lt;&nbsp;explo-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1779067">//&nbsp;Our&nbsp;lower&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mantlo*2+1&nbsp;&lt;&lt;&nbsp;explo-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1779139">var</span>&nbsp;<span class="ident" id="1779143">mantlo</span>&nbsp;<span class="ident" id="1779150">uint64</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1779158">var</span>&nbsp;<span class="ident" id="1779162">explo</span>&nbsp;<span class="builtintype" id="1779168">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1779173">if</span>&nbsp;<span class="ident" id="1779176">mant</span>&nbsp;<span class="op" id="1779181">&gt;</span>&nbsp;<span class="num" id="1779183">1</span><span class="op" id="1779184">&lt;&lt;</span><span class="ident" id="1779186">flt</span><span class="op" id="1779189">.</span><span class="ident" id="1779190">mantbits</span>&nbsp;<span class="op" id="1779199">||</span>&nbsp;<span class="ident" id="1779202">exp</span>&nbsp;<span class="op" id="1779206">==</span>&nbsp;<span class="ident" id="1779209">minexp</span>&nbsp;<span class="op" id="1779216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779220">mantlo</span>&nbsp;<span class="op" id="1779227">=</span>&nbsp;<span class="ident" id="1779229">mant</span>&nbsp;<span class="op" id="1779234">-</span>&nbsp;<span class="num" id="1779236">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779240">explo</span>&nbsp;<span class="op" id="1779246">=</span>&nbsp;<span class="ident" id="1779248">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1779253">}</span>&nbsp;<span class="keyword" id="1779255">else</span>&nbsp;<span class="op" id="1779260">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779264">mantlo</span>&nbsp;<span class="op" id="1779271">=</span>&nbsp;<span class="ident" id="1779273">mant</span><span class="op" id="1779277">*</span><span class="num" id="1779278">2</span>&nbsp;<span class="op" id="1779280">-</span>&nbsp;<span class="num" id="1779282">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779286">explo</span>&nbsp;<span class="op" id="1779292">=</span>&nbsp;<span class="ident" id="1779294">exp</span>&nbsp;<span class="op" id="1779298">-</span>&nbsp;<span class="num" id="1779300">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1779303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779306">lower</span>&nbsp;<span class="op" id="1779312">:=</span>&nbsp;<span class="builtinfunc" id="1779315">new</span><span class="op" id="1779318">(</span><span class="ident" id="1779319">decimal</span><span class="op" id="1779326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779329">lower</span><span class="op" id="1779334">.</span><span class="ident" id="1779335">Assign</span><span class="op" id="1779341">(</span><span class="ident" id="1779342">mantlo</span><span class="op" id="1779348">*</span><span class="num" id="1779349">2</span>&nbsp;<span class="op" id="1779351">+</span>&nbsp;<span class="num" id="1779353">1</span><span class="op" id="1779354">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779357">lower</span><span class="op" id="1779362">.</span><span class="ident" id="1779363">Shift</span><span class="op" id="1779368">(</span><span class="ident" id="1779369">explo</span>&nbsp;<span class="op" id="1779375">-</span>&nbsp;<span class="builtintype" id="1779377">int</span><span class="op" id="1779380">(</span><span class="ident" id="1779381">flt</span><span class="op" id="1779384">.</span><span class="ident" id="1779385">mantbits</span><span class="op" id="1779393">)</span>&nbsp;<span class="op" id="1779395">-</span>&nbsp;<span class="num" id="1779397">1</span><span class="op" id="1779398">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1779402">//&nbsp;The&nbsp;upper&nbsp;and&nbsp;lower&nbsp;bounds&nbsp;are&nbsp;possible&nbsp;outputs&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1779462">//&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;is&nbsp;even,&nbsp;so&nbsp;that&nbsp;IEEE&nbsp;round-to-even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1779524">//&nbsp;would&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;and&nbsp;not&nbsp;the&nbsp;neighbors.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779588">inclusive</span>&nbsp;<span class="op" id="1779598">:=</span>&nbsp;<span class="ident" id="1779601">mant</span><span class="op" id="1779605">%</span><span class="num" id="1779606">2</span>&nbsp;<span class="op" id="1779608">==</span>&nbsp;<span class="num" id="1779611">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1779615">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;figure&nbsp;out&nbsp;the&nbsp;minimum&nbsp;number&nbsp;of&nbsp;digits&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1779680">//&nbsp;Walk&nbsp;along&nbsp;until&nbsp;d&nbsp;has&nbsp;distinguished&nbsp;itself&nbsp;from&nbsp;upper&nbsp;and&nbsp;lower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1779750">for</span>&nbsp;<span class="ident" id="1779754">i</span>&nbsp;<span class="op" id="1779756">:=</span>&nbsp;<span class="num" id="1779759">0</span><span class="op" id="1779760">;</span>&nbsp;<span class="ident" id="1779762">i</span>&nbsp;<span class="op" id="1779764">&lt;</span>&nbsp;<span class="ident" id="1779766">d</span><span class="op" id="1779767">.</span><span class="ident" id="1779768">nd</span><span class="op" id="1779770">;</span>&nbsp;<span class="ident" id="1779772">i</span><span class="op" id="1779773">++</span>&nbsp;<span class="op" id="1779776">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1779780">var</span>&nbsp;<span class="ident" id="1779784">l</span><span class="op" id="1779785">,</span>&nbsp;<span class="ident" id="1779787">m</span><span class="op" id="1779788">,</span>&nbsp;<span class="ident" id="1779790">u</span>&nbsp;<span class="builtintype" id="1779792">byte</span>&nbsp;<span class="comment" id="1779797">//&nbsp;lower,&nbsp;middle,&nbsp;upper&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1779830">if</span>&nbsp;<span class="ident" id="1779833">i</span>&nbsp;<span class="op" id="1779835">&lt;</span>&nbsp;<span class="ident" id="1779837">lower</span><span class="op" id="1779842">.</span><span class="ident" id="1779843">nd</span>&nbsp;<span class="op" id="1779846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779851">l</span>&nbsp;<span class="op" id="1779853">=</span>&nbsp;<span class="ident" id="1779855">lower</span><span class="op" id="1779860">.</span><span class="ident" id="1779861">d</span><span class="op" id="1779862">[</span><span class="ident" id="1779863">i</span><span class="op" id="1779864">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1779868">}</span>&nbsp;<span class="keyword" id="1779870">else</span>&nbsp;<span class="op" id="1779875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779880">l</span>&nbsp;<span class="op" id="1779882">=</span>&nbsp;<span class="string" id="1779884">&#39;0&#39;</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1779890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779894">m</span>&nbsp;<span class="op" id="1779896">=</span>&nbsp;<span class="ident" id="1779898">d</span><span class="op" id="1779899">.</span><span class="ident" id="1779900">d</span><span class="op" id="1779901">[</span><span class="ident" id="1779902">i</span><span class="op" id="1779903">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1779907">if</span>&nbsp;<span class="ident" id="1779910">i</span>&nbsp;<span class="op" id="1779912">&lt;</span>&nbsp;<span class="ident" id="1779914">upper</span><span class="op" id="1779919">.</span><span class="ident" id="1779920">nd</span>&nbsp;<span class="op" id="1779923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779928">u</span>&nbsp;<span class="op" id="1779930">=</span>&nbsp;<span class="ident" id="1779932">upper</span><span class="op" id="1779937">.</span><span class="ident" id="1779938">d</span><span class="op" id="1779939">[</span><span class="ident" id="1779940">i</span><span class="op" id="1779941">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1779945">}</span>&nbsp;<span class="keyword" id="1779947">else</span>&nbsp;<span class="op" id="1779952">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1779957">u</span>&nbsp;<span class="op" id="1779959">=</span>&nbsp;<span class="string" id="1779961">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1779967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1779972">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;down&nbsp;(truncate)&nbsp;if&nbsp;lower&nbsp;has&nbsp;a&nbsp;different&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1780038">//&nbsp;or&nbsp;if&nbsp;lower&nbsp;is&nbsp;inclusive&nbsp;and&nbsp;is&nbsp;exactly&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;down.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780112">okdown</span>&nbsp;<span class="op" id="1780119">:=</span>&nbsp;<span class="ident" id="1780122">l</span>&nbsp;<span class="op" id="1780124">!=</span>&nbsp;<span class="ident" id="1780127">m</span>&nbsp;<span class="op" id="1780129">||</span>&nbsp;<span class="op" id="1780132">(</span><span class="ident" id="1780133">inclusive</span>&nbsp;<span class="op" id="1780143">&amp;&amp;</span>&nbsp;<span class="ident" id="1780146">l</span>&nbsp;<span class="op" id="1780148">==</span>&nbsp;<span class="ident" id="1780151">m</span>&nbsp;<span class="op" id="1780153">&amp;&amp;</span>&nbsp;<span class="ident" id="1780156">i</span><span class="op" id="1780157">+</span><span class="num" id="1780158">1</span>&nbsp;<span class="op" id="1780160">==</span>&nbsp;<span class="ident" id="1780163">lower</span><span class="op" id="1780168">.</span><span class="ident" id="1780169">nd</span><span class="op" id="1780171">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1780176">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;up&nbsp;if&nbsp;upper&nbsp;has&nbsp;a&nbsp;different&nbsp;digit&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1780233">//&nbsp;either&nbsp;upper&nbsp;is&nbsp;inclusive&nbsp;or&nbsp;upper&nbsp;is&nbsp;bigger&nbsp;than&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780315">okup</span>&nbsp;<span class="op" id="1780320">:=</span>&nbsp;<span class="ident" id="1780323">m</span>&nbsp;<span class="op" id="1780325">!=</span>&nbsp;<span class="ident" id="1780328">u</span>&nbsp;<span class="op" id="1780330">&amp;&amp;</span>&nbsp;<span class="op" id="1780333">(</span><span class="ident" id="1780334">inclusive</span>&nbsp;<span class="op" id="1780344">||</span>&nbsp;<span class="ident" id="1780347">m</span><span class="op" id="1780348">+</span><span class="num" id="1780349">1</span>&nbsp;<span class="op" id="1780351">&lt;</span>&nbsp;<span class="ident" id="1780353">u</span>&nbsp;<span class="op" id="1780355">||</span>&nbsp;<span class="ident" id="1780358">i</span><span class="op" id="1780359">+</span><span class="num" id="1780360">1</span>&nbsp;<span class="op" id="1780362">&lt;</span>&nbsp;<span class="ident" id="1780364">upper</span><span class="op" id="1780369">.</span><span class="ident" id="1780370">nd</span><span class="op" id="1780372">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1780377">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;either,&nbsp;then&nbsp;round&nbsp;to&nbsp;the&nbsp;nearest&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1780440">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;only&nbsp;one,&nbsp;do&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780481">switch</span>&nbsp;<span class="op" id="1780488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780492">case</span>&nbsp;<span class="ident" id="1780497">okdown</span>&nbsp;<span class="op" id="1780504">&amp;&amp;</span>&nbsp;<span class="ident" id="1780507">okup</span><span class="op" id="1780511">:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780516">d</span><span class="op" id="1780517">.</span><span class="ident" id="1780518">Round</span><span class="op" id="1780523">(</span><span class="ident" id="1780524">i</span>&nbsp;<span class="op" id="1780526">+</span>&nbsp;<span class="num" id="1780528">1</span><span class="op" id="1780529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780534">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780543">case</span>&nbsp;<span class="ident" id="1780548">okdown</span><span class="op" id="1780554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780559">d</span><span class="op" id="1780560">.</span><span class="ident" id="1780561">RoundDown</span><span class="op" id="1780570">(</span><span class="ident" id="1780571">i</span>&nbsp;<span class="op" id="1780573">+</span>&nbsp;<span class="num" id="1780575">1</span><span class="op" id="1780576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780581">return</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780590">case</span>&nbsp;<span class="ident" id="1780595">okup</span><span class="op" id="1780599">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780604">d</span><span class="op" id="1780605">.</span><span class="ident" id="1780606">RoundUp</span><span class="op" id="1780613">(</span><span class="ident" id="1780614">i</span>&nbsp;<span class="op" id="1780616">+</span>&nbsp;<span class="num" id="1780618">1</span><span class="op" id="1780619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780624">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1780633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1780636">}</span><br>
<span class="lineno">325</span><span class="op" id="1780638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1780641">type</span>&nbsp;<span class="ident" id="1780646">decimalSlice</span>&nbsp;<span class="keyword" id="1780659">struct</span>&nbsp;<span class="op" id="1780666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780669">d</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1780676">[</span><span class="op" id="1780677">]</span><span class="builtintype" id="1780678">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780684">nd</span><span class="op" id="1780686">,</span>&nbsp;<span class="ident" id="1780688">dp</span>&nbsp;<span class="builtintype" id="1780691">int</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780696">neg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1780703">bool</span><br>
<span class="lineno"></span><span class="op" id="1780708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1780711">//&nbsp;%e:&nbsp;-d.ddddde±dd</span><br>
<span class="lineno"></span><span class="keyword" id="1780732">func</span>&nbsp;<span class="ident" id="1780737">fmtE</span><span class="op" id="1780741">(</span><span class="ident" id="1780742">dst</span>&nbsp;<span class="op" id="1780746">[</span><span class="op" id="1780747">]</span><span class="builtintype" id="1780748">byte</span><span class="op" id="1780752">,</span>&nbsp;<span class="ident" id="1780754">neg</span>&nbsp;<span class="builtintype" id="1780758">bool</span><span class="op" id="1780762">,</span>&nbsp;<span class="ident" id="1780764">d</span>&nbsp;<span class="ident" id="1780766">decimalSlice</span><span class="op" id="1780778">,</span>&nbsp;<span class="ident" id="1780780">prec</span>&nbsp;<span class="builtintype" id="1780785">int</span><span class="op" id="1780788">,</span>&nbsp;<span class="ident" id="1780790">fmt</span>&nbsp;<span class="builtintype" id="1780794">byte</span><span class="op" id="1780798">)</span>&nbsp;<span class="op" id="1780800">[</span><span class="op" id="1780801">]</span><span class="builtintype" id="1780802">byte</span>&nbsp;<span class="op" id="1780807">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1780810">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780819">if</span>&nbsp;<span class="ident" id="1780822">neg</span>&nbsp;<span class="op" id="1780826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780830">dst</span>&nbsp;<span class="op" id="1780834">=</span>&nbsp;<span class="builtinfunc" id="1780836">append</span><span class="op" id="1780842">(</span><span class="ident" id="1780843">dst</span><span class="op" id="1780846">,</span>&nbsp;<span class="string" id="1780848">&#39;-&#39;</span><span class="op" id="1780851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1780854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1780858">//&nbsp;first&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780874">ch</span>&nbsp;<span class="op" id="1780877">:=</span>&nbsp;<span class="builtintype" id="1780880">byte</span><span class="op" id="1780884">(</span><span class="string" id="1780885">&#39;0&#39;</span><span class="op" id="1780888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780891">if</span>&nbsp;<span class="ident" id="1780894">d</span><span class="op" id="1780895">.</span><span class="ident" id="1780896">nd</span>&nbsp;<span class="op" id="1780899">!=</span>&nbsp;<span class="num" id="1780902">0</span>&nbsp;<span class="op" id="1780904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780908">ch</span>&nbsp;<span class="op" id="1780911">=</span>&nbsp;<span class="ident" id="1780913">d</span><span class="op" id="1780914">.</span><span class="ident" id="1780915">d</span><span class="op" id="1780916">[</span><span class="num" id="1780917">0</span><span class="op" id="1780918">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1780921">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780924">dst</span>&nbsp;<span class="op" id="1780928">=</span>&nbsp;<span class="builtinfunc" id="1780930">append</span><span class="op" id="1780936">(</span><span class="ident" id="1780937">dst</span><span class="op" id="1780940">,</span>&nbsp;<span class="ident" id="1780942">ch</span><span class="op" id="1780944">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1780948">//&nbsp;.moredigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1780964">if</span>&nbsp;<span class="ident" id="1780967">prec</span>&nbsp;<span class="op" id="1780972">&gt;</span>&nbsp;<span class="num" id="1780974">0</span>&nbsp;<span class="op" id="1780976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1780980">dst</span>&nbsp;<span class="op" id="1780984">=</span>&nbsp;<span class="builtinfunc" id="1780986">append</span><span class="op" id="1780992">(</span><span class="ident" id="1780993">dst</span><span class="op" id="1780996">,</span>&nbsp;<span class="string" id="1780998">&#39;.&#39;</span><span class="op" id="1781001">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781005">i</span>&nbsp;<span class="op" id="1781007">:=</span>&nbsp;<span class="num" id="1781010">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781014">m</span>&nbsp;<span class="op" id="1781016">:=</span>&nbsp;<span class="ident" id="1781019">d</span><span class="op" id="1781020">.</span><span class="ident" id="1781021">nd</span>&nbsp;<span class="op" id="1781024">+</span>&nbsp;<span class="ident" id="1781026">prec</span>&nbsp;<span class="op" id="1781031">+</span>&nbsp;<span class="num" id="1781033">1</span>&nbsp;<span class="op" id="1781035">-</span>&nbsp;<span class="ident" id="1781037">max</span><span class="op" id="1781040">(</span><span class="ident" id="1781041">d</span><span class="op" id="1781042">.</span><span class="ident" id="1781043">nd</span><span class="op" id="1781045">,</span>&nbsp;<span class="ident" id="1781047">prec</span><span class="op" id="1781051">+</span><span class="num" id="1781052">1</span><span class="op" id="1781053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781057">for</span>&nbsp;<span class="ident" id="1781061">i</span>&nbsp;<span class="op" id="1781063">&lt;</span>&nbsp;<span class="ident" id="1781065">m</span>&nbsp;<span class="op" id="1781067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781072">dst</span>&nbsp;<span class="op" id="1781076">=</span>&nbsp;<span class="builtinfunc" id="1781078">append</span><span class="op" id="1781084">(</span><span class="ident" id="1781085">dst</span><span class="op" id="1781088">,</span>&nbsp;<span class="ident" id="1781090">d</span><span class="op" id="1781091">.</span><span class="ident" id="1781092">d</span><span class="op" id="1781093">[</span><span class="ident" id="1781094">i</span><span class="op" id="1781095">]</span><span class="op" id="1781096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781101">i</span><span class="op" id="1781102">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1781107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781111">for</span>&nbsp;<span class="ident" id="1781115">i</span>&nbsp;<span class="op" id="1781117">&lt;=</span>&nbsp;<span class="ident" id="1781120">prec</span>&nbsp;<span class="op" id="1781125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781130">dst</span>&nbsp;<span class="op" id="1781134">=</span>&nbsp;<span class="builtinfunc" id="1781136">append</span><span class="op" id="1781142">(</span><span class="ident" id="1781143">dst</span><span class="op" id="1781146">,</span>&nbsp;<span class="string" id="1781148">&#39;0&#39;</span><span class="op" id="1781151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781156">i</span><span class="op" id="1781157">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1781162">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1781165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1781169">//&nbsp;e±</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781177">dst</span>&nbsp;<span class="op" id="1781181">=</span>&nbsp;<span class="builtinfunc" id="1781183">append</span><span class="op" id="1781189">(</span><span class="ident" id="1781190">dst</span><span class="op" id="1781193">,</span>&nbsp;<span class="ident" id="1781195">fmt</span><span class="op" id="1781198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781201">exp</span>&nbsp;<span class="op" id="1781205">:=</span>&nbsp;<span class="ident" id="1781208">d</span><span class="op" id="1781209">.</span><span class="ident" id="1781210">dp</span>&nbsp;<span class="op" id="1781213">-</span>&nbsp;<span class="num" id="1781215">1</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781218">if</span>&nbsp;<span class="ident" id="1781221">d</span><span class="op" id="1781222">.</span><span class="ident" id="1781223">nd</span>&nbsp;<span class="op" id="1781226">==</span>&nbsp;<span class="num" id="1781229">0</span>&nbsp;<span class="op" id="1781231">{</span>&nbsp;<span class="comment" id="1781233">//&nbsp;special&nbsp;case:&nbsp;0&nbsp;has&nbsp;exponent&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781269">exp</span>&nbsp;<span class="op" id="1781273">=</span>&nbsp;<span class="num" id="1781275">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1781278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781281">if</span>&nbsp;<span class="ident" id="1781284">exp</span>&nbsp;<span class="op" id="1781288">&lt;</span>&nbsp;<span class="num" id="1781290">0</span>&nbsp;<span class="op" id="1781292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781296">ch</span>&nbsp;<span class="op" id="1781299">=</span>&nbsp;<span class="string" id="1781301">&#39;-&#39;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781307">exp</span>&nbsp;<span class="op" id="1781311">=</span>&nbsp;<span class="op" id="1781313">-</span><span class="ident" id="1781314">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1781319">}</span>&nbsp;<span class="keyword" id="1781321">else</span>&nbsp;<span class="op" id="1781326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781330">ch</span>&nbsp;<span class="op" id="1781333">=</span>&nbsp;<span class="string" id="1781335">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1781340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781343">dst</span>&nbsp;<span class="op" id="1781347">=</span>&nbsp;<span class="builtinfunc" id="1781349">append</span><span class="op" id="1781355">(</span><span class="ident" id="1781356">dst</span><span class="op" id="1781359">,</span>&nbsp;<span class="ident" id="1781361">ch</span><span class="op" id="1781363">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1781367">//&nbsp;dddd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781376">var</span>&nbsp;<span class="ident" id="1781380">buf</span>&nbsp;<span class="op" id="1781384">[</span><span class="num" id="1781385">3</span><span class="op" id="1781386">]</span><span class="builtintype" id="1781387">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781393">i</span>&nbsp;<span class="op" id="1781395">:=</span>&nbsp;<span class="builtinfunc" id="1781398">len</span><span class="op" id="1781401">(</span><span class="ident" id="1781402">buf</span><span class="op" id="1781405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781408">for</span>&nbsp;<span class="ident" id="1781412">exp</span>&nbsp;<span class="op" id="1781416">&gt;=</span>&nbsp;<span class="num" id="1781419">10</span>&nbsp;<span class="op" id="1781422">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781426">i</span><span class="op" id="1781427">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781432">buf</span><span class="op" id="1781435">[</span><span class="ident" id="1781436">i</span><span class="op" id="1781437">]</span>&nbsp;<span class="op" id="1781439">=</span>&nbsp;<span class="builtintype" id="1781441">byte</span><span class="op" id="1781445">(</span><span class="ident" id="1781446">exp</span><span class="op" id="1781449">%</span><span class="num" id="1781450">10</span>&nbsp;<span class="op" id="1781453">+</span>&nbsp;<span class="string" id="1781455">&#39;0&#39;</span><span class="op" id="1781458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781462">exp</span>&nbsp;<span class="op" id="1781466">/=</span>&nbsp;<span class="num" id="1781469">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1781473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1781476">//&nbsp;exp&nbsp;&lt;&nbsp;10</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781489">i</span><span class="op" id="1781490">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781494">buf</span><span class="op" id="1781497">[</span><span class="ident" id="1781498">i</span><span class="op" id="1781499">]</span>&nbsp;<span class="op" id="1781501">=</span>&nbsp;<span class="builtintype" id="1781503">byte</span><span class="op" id="1781507">(</span><span class="ident" id="1781508">exp</span>&nbsp;<span class="op" id="1781512">+</span>&nbsp;<span class="string" id="1781514">&#39;0&#39;</span><span class="op" id="1781517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781521">switch</span>&nbsp;<span class="ident" id="1781528">i</span>&nbsp;<span class="op" id="1781530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781533">case</span>&nbsp;<span class="num" id="1781538">0</span><span class="op" id="1781539">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781543">dst</span>&nbsp;<span class="op" id="1781547">=</span>&nbsp;<span class="builtinfunc" id="1781549">append</span><span class="op" id="1781555">(</span><span class="ident" id="1781556">dst</span><span class="op" id="1781559">,</span>&nbsp;<span class="ident" id="1781561">buf</span><span class="op" id="1781564">[</span><span class="num" id="1781565">0</span><span class="op" id="1781566">]</span><span class="op" id="1781567">,</span>&nbsp;<span class="ident" id="1781569">buf</span><span class="op" id="1781572">[</span><span class="num" id="1781573">1</span><span class="op" id="1781574">]</span><span class="op" id="1781575">,</span>&nbsp;<span class="ident" id="1781577">buf</span><span class="op" id="1781580">[</span><span class="num" id="1781581">2</span><span class="op" id="1781582">]</span><span class="op" id="1781583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781586">case</span>&nbsp;<span class="num" id="1781591">1</span><span class="op" id="1781592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781596">dst</span>&nbsp;<span class="op" id="1781600">=</span>&nbsp;<span class="builtinfunc" id="1781602">append</span><span class="op" id="1781608">(</span><span class="ident" id="1781609">dst</span><span class="op" id="1781612">,</span>&nbsp;<span class="ident" id="1781614">buf</span><span class="op" id="1781617">[</span><span class="num" id="1781618">1</span><span class="op" id="1781619">]</span><span class="op" id="1781620">,</span>&nbsp;<span class="ident" id="1781622">buf</span><span class="op" id="1781625">[</span><span class="num" id="1781626">2</span><span class="op" id="1781627">]</span><span class="op" id="1781628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781631">case</span>&nbsp;<span class="num" id="1781636">2</span><span class="op" id="1781637">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1781641">//&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781661">dst</span>&nbsp;<span class="op" id="1781665">=</span>&nbsp;<span class="builtinfunc" id="1781667">append</span><span class="op" id="1781673">(</span><span class="ident" id="1781674">dst</span><span class="op" id="1781677">,</span>&nbsp;<span class="string" id="1781679">&#39;0&#39;</span><span class="op" id="1781682">,</span>&nbsp;<span class="ident" id="1781684">buf</span><span class="op" id="1781687">[</span><span class="num" id="1781688">2</span><span class="op" id="1781689">]</span><span class="op" id="1781690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1781693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781696">return</span>&nbsp;<span class="ident" id="1781703">dst</span><br>
<span class="lineno"></span><span class="op" id="1781707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="1781710">//&nbsp;%f:&nbsp;-ddddddd.ddddd</span><br>
<span class="lineno"></span><span class="keyword" id="1781732">func</span>&nbsp;<span class="ident" id="1781737">fmtF</span><span class="op" id="1781741">(</span><span class="ident" id="1781742">dst</span>&nbsp;<span class="op" id="1781746">[</span><span class="op" id="1781747">]</span><span class="builtintype" id="1781748">byte</span><span class="op" id="1781752">,</span>&nbsp;<span class="ident" id="1781754">neg</span>&nbsp;<span class="builtintype" id="1781758">bool</span><span class="op" id="1781762">,</span>&nbsp;<span class="ident" id="1781764">d</span>&nbsp;<span class="ident" id="1781766">decimalSlice</span><span class="op" id="1781778">,</span>&nbsp;<span class="ident" id="1781780">prec</span>&nbsp;<span class="builtintype" id="1781785">int</span><span class="op" id="1781788">)</span>&nbsp;<span class="op" id="1781790">[</span><span class="op" id="1781791">]</span><span class="builtintype" id="1781792">byte</span>&nbsp;<span class="op" id="1781797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1781800">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781809">if</span>&nbsp;<span class="ident" id="1781812">neg</span>&nbsp;<span class="op" id="1781816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781820">dst</span>&nbsp;<span class="op" id="1781824">=</span>&nbsp;<span class="builtinfunc" id="1781826">append</span><span class="op" id="1781832">(</span><span class="ident" id="1781833">dst</span><span class="op" id="1781836">,</span>&nbsp;<span class="string" id="1781838">&#39;-&#39;</span><span class="op" id="1781841">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1781844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1781848">//&nbsp;integer,&nbsp;padded&nbsp;with&nbsp;zeros&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781890">if</span>&nbsp;<span class="ident" id="1781893">d</span><span class="op" id="1781894">.</span><span class="ident" id="1781895">dp</span>&nbsp;<span class="op" id="1781898">&gt;</span>&nbsp;<span class="num" id="1781900">0</span>&nbsp;<span class="op" id="1781902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781906">var</span>&nbsp;<span class="ident" id="1781910">i</span>&nbsp;<span class="builtintype" id="1781912">int</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781918">for</span>&nbsp;<span class="ident" id="1781922">i</span>&nbsp;<span class="op" id="1781924">=</span>&nbsp;<span class="num" id="1781926">0</span><span class="op" id="1781927">;</span>&nbsp;<span class="ident" id="1781929">i</span>&nbsp;<span class="op" id="1781931">&lt;</span>&nbsp;<span class="ident" id="1781933">d</span><span class="op" id="1781934">.</span><span class="ident" id="1781935">dp</span>&nbsp;<span class="op" id="1781938">&amp;&amp;</span>&nbsp;<span class="ident" id="1781941">i</span>&nbsp;<span class="op" id="1781943">&lt;</span>&nbsp;<span class="ident" id="1781945">d</span><span class="op" id="1781946">.</span><span class="ident" id="1781947">nd</span><span class="op" id="1781949">;</span>&nbsp;<span class="ident" id="1781951">i</span><span class="op" id="1781952">++</span>&nbsp;<span class="op" id="1781955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1781960">dst</span>&nbsp;<span class="op" id="1781964">=</span>&nbsp;<span class="builtinfunc" id="1781966">append</span><span class="op" id="1781972">(</span><span class="ident" id="1781973">dst</span><span class="op" id="1781976">,</span>&nbsp;<span class="ident" id="1781978">d</span><span class="op" id="1781979">.</span><span class="ident" id="1781980">d</span><span class="op" id="1781981">[</span><span class="ident" id="1781982">i</span><span class="op" id="1781983">]</span><span class="op" id="1781984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1781988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1781992">for</span>&nbsp;<span class="op" id="1781996">;</span>&nbsp;<span class="ident" id="1781998">i</span>&nbsp;<span class="op" id="1782000">&lt;</span>&nbsp;<span class="ident" id="1782002">d</span><span class="op" id="1782003">.</span><span class="ident" id="1782004">dp</span><span class="op" id="1782006">;</span>&nbsp;<span class="ident" id="1782008">i</span><span class="op" id="1782009">++</span>&nbsp;<span class="op" id="1782012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782017">dst</span>&nbsp;<span class="op" id="1782021">=</span>&nbsp;<span class="builtinfunc" id="1782023">append</span><span class="op" id="1782029">(</span><span class="ident" id="1782030">dst</span><span class="op" id="1782033">,</span>&nbsp;<span class="string" id="1782035">&#39;0&#39;</span><span class="op" id="1782038">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1782042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1782045">}</span>&nbsp;<span class="keyword" id="1782047">else</span>&nbsp;<span class="op" id="1782052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782056">dst</span>&nbsp;<span class="op" id="1782060">=</span>&nbsp;<span class="builtinfunc" id="1782062">append</span><span class="op" id="1782068">(</span><span class="ident" id="1782069">dst</span><span class="op" id="1782072">,</span>&nbsp;<span class="string" id="1782074">&#39;0&#39;</span><span class="op" id="1782077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1782080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1782084">//&nbsp;fraction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1782097">if</span>&nbsp;<span class="ident" id="1782100">prec</span>&nbsp;<span class="op" id="1782105">&gt;</span>&nbsp;<span class="num" id="1782107">0</span>&nbsp;<span class="op" id="1782109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782113">dst</span>&nbsp;<span class="op" id="1782117">=</span>&nbsp;<span class="builtinfunc" id="1782119">append</span><span class="op" id="1782125">(</span><span class="ident" id="1782126">dst</span><span class="op" id="1782129">,</span>&nbsp;<span class="string" id="1782131">&#39;.&#39;</span><span class="op" id="1782134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1782138">for</span>&nbsp;<span class="ident" id="1782142">i</span>&nbsp;<span class="op" id="1782144">:=</span>&nbsp;<span class="num" id="1782147">0</span><span class="op" id="1782148">;</span>&nbsp;<span class="ident" id="1782150">i</span>&nbsp;<span class="op" id="1782152">&lt;</span>&nbsp;<span class="ident" id="1782154">prec</span><span class="op" id="1782158">;</span>&nbsp;<span class="ident" id="1782160">i</span><span class="op" id="1782161">++</span>&nbsp;<span class="op" id="1782164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782169">ch</span>&nbsp;<span class="op" id="1782172">:=</span>&nbsp;<span class="builtintype" id="1782175">byte</span><span class="op" id="1782179">(</span><span class="string" id="1782180">&#39;0&#39;</span><span class="op" id="1782183">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1782188">if</span>&nbsp;<span class="ident" id="1782191">j</span>&nbsp;<span class="op" id="1782193">:=</span>&nbsp;<span class="ident" id="1782196">d</span><span class="op" id="1782197">.</span><span class="ident" id="1782198">dp</span>&nbsp;<span class="op" id="1782201">+</span>&nbsp;<span class="ident" id="1782203">i</span><span class="op" id="1782204">;</span>&nbsp;<span class="num" id="1782206">0</span>&nbsp;<span class="op" id="1782208">&lt;=</span>&nbsp;<span class="ident" id="1782211">j</span>&nbsp;<span class="op" id="1782213">&amp;&amp;</span>&nbsp;<span class="ident" id="1782216">j</span>&nbsp;<span class="op" id="1782218">&lt;</span>&nbsp;<span class="ident" id="1782220">d</span><span class="op" id="1782221">.</span><span class="ident" id="1782222">nd</span>&nbsp;<span class="op" id="1782225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782231">ch</span>&nbsp;<span class="op" id="1782234">=</span>&nbsp;<span class="ident" id="1782236">d</span><span class="op" id="1782237">.</span><span class="ident" id="1782238">d</span><span class="op" id="1782239">[</span><span class="ident" id="1782240">j</span><span class="op" id="1782241">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1782246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782251">dst</span>&nbsp;<span class="op" id="1782255">=</span>&nbsp;<span class="builtinfunc" id="1782257">append</span><span class="op" id="1782263">(</span><span class="ident" id="1782264">dst</span><span class="op" id="1782267">,</span>&nbsp;<span class="ident" id="1782269">ch</span><span class="op" id="1782271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1782275">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1782278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1782282">return</span>&nbsp;<span class="ident" id="1782289">dst</span><br>
<span class="lineno"></span><span class="op" id="1782293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="comment" id="1782296">//&nbsp;%b:&nbsp;-ddddddddp+ddd</span><br>
<span class="lineno"></span><span class="keyword" id="1782318">func</span>&nbsp;<span class="ident" id="1782323">fmtB</span><span class="op" id="1782327">(</span><span class="ident" id="1782328">dst</span>&nbsp;<span class="op" id="1782332">[</span><span class="op" id="1782333">]</span><span class="builtintype" id="1782334">byte</span><span class="op" id="1782338">,</span>&nbsp;<span class="ident" id="1782340">neg</span>&nbsp;<span class="builtintype" id="1782344">bool</span><span class="op" id="1782348">,</span>&nbsp;<span class="ident" id="1782350">mant</span>&nbsp;<span class="ident" id="1782355">uint64</span><span class="op" id="1782361">,</span>&nbsp;<span class="ident" id="1782363">exp</span>&nbsp;<span class="builtintype" id="1782367">int</span><span class="op" id="1782370">,</span>&nbsp;<span class="ident" id="1782372">flt</span>&nbsp;<span class="op" id="1782376">*</span><span class="ident" id="1782377">floatInfo</span><span class="op" id="1782386">)</span>&nbsp;<span class="op" id="1782388">[</span><span class="op" id="1782389">]</span><span class="builtintype" id="1782390">byte</span>&nbsp;<span class="op" id="1782395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1782398">var</span>&nbsp;<span class="ident" id="1782402">buf</span>&nbsp;<span class="op" id="1782406">[</span><span class="num" id="1782407">50</span><span class="op" id="1782409">]</span><span class="builtintype" id="1782410">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782416">w</span>&nbsp;<span class="op" id="1782418">:=</span>&nbsp;<span class="builtinfunc" id="1782421">len</span><span class="op" id="1782424">(</span><span class="ident" id="1782425">buf</span><span class="op" id="1782428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782431">exp</span>&nbsp;<span class="op" id="1782435">-=</span>&nbsp;<span class="builtintype" id="1782438">int</span><span class="op" id="1782441">(</span><span class="ident" id="1782442">flt</span><span class="op" id="1782445">.</span><span class="ident" id="1782446">mantbits</span><span class="op" id="1782454">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782457">esign</span>&nbsp;<span class="op" id="1782463">:=</span>&nbsp;<span class="builtintype" id="1782466">byte</span><span class="op" id="1782470">(</span><span class="string" id="1782471">&#39;+&#39;</span><span class="op" id="1782474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1782477">if</span>&nbsp;<span class="ident" id="1782480">exp</span>&nbsp;<span class="op" id="1782484">&lt;</span>&nbsp;<span class="num" id="1782486">0</span>&nbsp;<span class="op" id="1782488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782492">esign</span>&nbsp;<span class="op" id="1782498">=</span>&nbsp;<span class="string" id="1782500">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782506">exp</span>&nbsp;<span class="op" id="1782510">=</span>&nbsp;<span class="op" id="1782512">-</span><span class="ident" id="1782513">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1782518">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782521">n</span>&nbsp;<span class="op" id="1782523">:=</span>&nbsp;<span class="num" id="1782526">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1782529">for</span>&nbsp;<span class="ident" id="1782533">exp</span>&nbsp;<span class="op" id="1782537">&gt;</span>&nbsp;<span class="num" id="1782539">0</span>&nbsp;<span class="op" id="1782541">||</span>&nbsp;<span class="ident" id="1782544">n</span>&nbsp;<span class="op" id="1782546">&lt;</span>&nbsp;<span class="num" id="1782548">1</span>&nbsp;<span class="op" id="1782550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782554">n</span><span class="op" id="1782555">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782560">w</span><span class="op" id="1782561">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782566">buf</span><span class="op" id="1782569">[</span><span class="ident" id="1782570">w</span><span class="op" id="1782571">]</span>&nbsp;<span class="op" id="1782573">=</span>&nbsp;<span class="builtintype" id="1782575">byte</span><span class="op" id="1782579">(</span><span class="ident" id="1782580">exp</span><span class="op" id="1782583">%</span><span class="num" id="1782584">10</span>&nbsp;<span class="op" id="1782587">+</span>&nbsp;<span class="string" id="1782589">&#39;0&#39;</span><span class="op" id="1782592">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782596">exp</span>&nbsp;<span class="op" id="1782600">/=</span>&nbsp;<span class="num" id="1782603">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1782607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782610">w</span><span class="op" id="1782611">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782615">buf</span><span class="op" id="1782618">[</span><span class="ident" id="1782619">w</span><span class="op" id="1782620">]</span>&nbsp;<span class="op" id="1782622">=</span>&nbsp;<span class="ident" id="1782624">esign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782631">w</span><span class="op" id="1782632">--</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782636">buf</span><span class="op" id="1782639">[</span><span class="ident" id="1782640">w</span><span class="op" id="1782641">]</span>&nbsp;<span class="op" id="1782643">=</span>&nbsp;<span class="string" id="1782645">&#39;p&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782650">n</span>&nbsp;<span class="op" id="1782652">=</span>&nbsp;<span class="num" id="1782654">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1782657">for</span>&nbsp;<span class="ident" id="1782661">mant</span>&nbsp;<span class="op" id="1782666">&gt;</span>&nbsp;<span class="num" id="1782668">0</span>&nbsp;<span class="op" id="1782670">||</span>&nbsp;<span class="ident" id="1782673">n</span>&nbsp;<span class="op" id="1782675">&lt;</span>&nbsp;<span class="num" id="1782677">1</span>&nbsp;<span class="op" id="1782679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782683">n</span><span class="op" id="1782684">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782689">w</span><span class="op" id="1782690">--</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782695">buf</span><span class="op" id="1782698">[</span><span class="ident" id="1782699">w</span><span class="op" id="1782700">]</span>&nbsp;<span class="op" id="1782702">=</span>&nbsp;<span class="builtintype" id="1782704">byte</span><span class="op" id="1782708">(</span><span class="ident" id="1782709">mant</span><span class="op" id="1782713">%</span><span class="num" id="1782714">10</span>&nbsp;<span class="op" id="1782717">+</span>&nbsp;<span class="string" id="1782719">&#39;0&#39;</span><span class="op" id="1782722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782726">mant</span>&nbsp;<span class="op" id="1782731">/=</span>&nbsp;<span class="num" id="1782734">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1782738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1782741">if</span>&nbsp;<span class="ident" id="1782744">neg</span>&nbsp;<span class="op" id="1782748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782752">w</span><span class="op" id="1782753">--</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1782758">buf</span><span class="op" id="1782761">[</span><span class="ident" id="1782762">w</span><span class="op" id="1782763">]</span>&nbsp;<span class="op" id="1782765">=</span>&nbsp;<span class="string" id="1782767">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1782772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1782775">return</span>&nbsp;<span class="builtinfunc" id="1782782">append</span><span class="op" id="1782788">(</span><span class="ident" id="1782789">dst</span><span class="op" id="1782792">,</span>&nbsp;<span class="ident" id="1782794">buf</span><span class="op" id="1782797">[</span><span class="ident" id="1782798">w</span><span class="op" id="1782799">:</span><span class="op" id="1782800">]</span><span class="op" id="1782801">...</span><span class="op" id="1782804">)</span><br>
<span class="lineno"></span><span class="op" id="1782806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="keyword" id="1782809">func</span>&nbsp;<span class="ident" id="1782814">max</span><span class="op" id="1782817">(</span><span class="ident" id="1782818">a</span><span class="op" id="1782819">,</span>&nbsp;<span class="ident" id="1782821">b</span>&nbsp;<span class="builtintype" id="1782823">int</span><span class="op" id="1782826">)</span>&nbsp;<span class="builtintype" id="1782828">int</span>&nbsp;<span class="op" id="1782832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1782835">if</span>&nbsp;<span class="ident" id="1782838">a</span>&nbsp;<span class="op" id="1782840">&gt;</span>&nbsp;<span class="ident" id="1782842">b</span>&nbsp;<span class="op" id="1782844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1782848">return</span>&nbsp;<span class="ident" id="1782855">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1782858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1782861">return</span>&nbsp;<span class="ident" id="1782868">b</span><br>
<span class="lineno">475</span><span class="op" id="1782870">}</span>
</div>
</body>
</html>
