<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math</h2>
<ul>
<li><a href="/gostd/math/abs.go.html">abs.go</a></li>
<li><a href="/gostd/math/acosh.go.html">acosh.go</a></li>
<li><a href="/gostd/math/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/math/asin.go.html">asin.go</a></li>
<li><a href="/gostd/math/asinh.go.html">asinh.go</a></li>
<li><a href="/gostd/math/atan.go.html">atan.go</a></li>
<li><a href="/gostd/math/atan2.go.html">atan2.go</a></li>
<li><a href="/gostd/math/atanh.go.html">atanh.go</a></li>
<li><a href="/gostd/math/bits.go.html">bits.go</a></li>
<li><a href="/gostd/math/cbrt.go.html">cbrt.go</a></li>
<li><a href="/gostd/math/const.go.html">const.go</a></li>
<li><a href="/gostd/math/copysign.go.html">copysign.go</a></li>
<li><a href="/gostd/math/dim.go.html">dim.go</a></li>
<li><a href="/gostd/math/erf.go.html">erf.go</a></li>
<li><a href="/gostd/math/exp.go.html">exp.go</a></li>
<li><a href="/gostd/math/expm1.go.html">expm1.go</a></li>
<li><a href="/gostd/math/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/math/floor.go.html">floor.go</a></li>
<li><a href="/gostd/math/frexp.go.html">frexp.go</a></li>
<li><a href="/gostd/math/gamma.go.html">gamma.go</a></li>
<li><a href="/gostd/math/hypot.go.html">hypot.go</a></li>
<li><a href="/gostd/math/j0.go.html">j0.go</a></li>
<li><a href="/gostd/math/j1.go.html">j1.go</a></li>
<li><a href="/gostd/math/jn.go.html">jn.go</a></li>
<li><a href="/gostd/math/ldexp.go.html">ldexp.go</a></li>
<li><a href="/gostd/math/lgamma.go.html">lgamma.go</a></li>
<li><a href="/gostd/math/log.go.html">log.go</a></li>
<li><a href="/gostd/math/log10.go.html">log10.go</a></li>
<li><a href="/gostd/math/log1p.go.html">log1p.go</a></li>
<li><a href="/gostd/math/logb.go.html">logb.go</a></li>
<li><a href="/gostd/math/mod.go.html">mod.go</a></li>
<li><a href="/gostd/math/modf.go.html">modf.go</a></li>
<li><a href="/gostd/math/nextafter.go.html">nextafter.go</a></li>
<li><a href="/gostd/math/pow.go.html">pow.go</a></li>
<li><a href="/gostd/math/pow10.go.html">pow10.go</a></li>
<li><a href="/gostd/math/remainder.go.html">remainder.go</a></li>
<li><a href="/gostd/math/signbit.go.html">signbit.go</a></li>
<li><a href="/gostd/math/sin.go.html">sin.go</a></li>
<li><a href="/gostd/math/sincos.go.html">sincos.go</a></li>
<li><a href="/gostd/math/sinh.go.html">sinh.go</a></li>
<li><a href="/gostd/math/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/math/tan.go.html">tan.go</a></li>
<li><a href="/gostd/math/tanh.go.html">tanh.go</a></li>
<li><a href="/gostd/math/unsafe.go.html">unsafe.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1843244">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1843299">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1843353">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1843404">package</span>&nbsp;<span class="ident" id="1843412">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1843418">//&nbsp;The&nbsp;original&nbsp;C&nbsp;code,&nbsp;the&nbsp;long&nbsp;comment,&nbsp;and&nbsp;the&nbsp;constants</span><br>
<span class="lineno"></span><span class="comment" id="1843478">//&nbsp;below&nbsp;are&nbsp;from&nbsp;FreeBSD&#39;s&nbsp;/usr/src/lib/msun/src/s_expm1.c</span><br>
<span class="lineno"></span><span class="comment" id="1843538">//&nbsp;and&nbsp;came&nbsp;with&nbsp;this&nbsp;notice.&nbsp;&nbsp;The&nbsp;go&nbsp;code&nbsp;is&nbsp;a&nbsp;simplified</span><br>
<span class="lineno">10</span><span class="comment" id="1843597">//&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="1843627">//</span><br>
<span class="lineno"></span><span class="comment" id="1843630">//&nbsp;====================================================</span><br>
<span class="lineno"></span><span class="comment" id="1843686">//&nbsp;Copyright&nbsp;(C)&nbsp;1993&nbsp;by&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1843755">//</span><br>
<span class="lineno">15</span><span class="comment" id="1843758">//&nbsp;Developed&nbsp;at&nbsp;SunPro,&nbsp;a&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;business.</span><br>
<span class="lineno"></span><span class="comment" id="1843817">//&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="1843873">//&nbsp;software&nbsp;is&nbsp;freely&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;notice</span><br>
<span class="lineno"></span><span class="comment" id="1843930">//&nbsp;is&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="comment" id="1843947">//&nbsp;====================================================</span><br>
<span class="lineno">20</span><span class="comment" id="1844003">//</span><br>
<span class="lineno"></span><span class="comment" id="1844006">//&nbsp;expm1(x)</span><br>
<span class="lineno"></span><span class="comment" id="1844018">//&nbsp;Returns&nbsp;exp(x)-1,&nbsp;the&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="1844069">//</span><br>
<span class="lineno"></span><span class="comment" id="1844072">//&nbsp;Method</span><br>
<span class="lineno">25</span><span class="comment" id="1844082">//&nbsp;&nbsp;&nbsp;1.&nbsp;Argument&nbsp;reduction:</span><br>
<span class="lineno"></span><span class="comment" id="1844110">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Given&nbsp;x,&nbsp;find&nbsp;r&nbsp;and&nbsp;integer&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="1844158">//</span><br>
<span class="lineno"></span><span class="comment" id="1844161">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;k*ln2&nbsp;+&nbsp;r,&nbsp;&nbsp;|r|&nbsp;&lt;=&nbsp;0.5*ln2&nbsp;~&nbsp;0.34658</span><br>
<span class="lineno"></span><span class="comment" id="1844219">//</span><br>
<span class="lineno">30</span><span class="comment" id="1844222">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;a&nbsp;correction&nbsp;term&nbsp;c&nbsp;will&nbsp;be&nbsp;computed&nbsp;to&nbsp;compensate</span><br>
<span class="lineno"></span><span class="comment" id="1844286">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;error&nbsp;in&nbsp;r&nbsp;when&nbsp;rounded&nbsp;to&nbsp;a&nbsp;floating-point&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="1844350">//</span><br>
<span class="lineno"></span><span class="comment" id="1844353">//&nbsp;&nbsp;&nbsp;2.&nbsp;Approximating&nbsp;expm1(r)&nbsp;by&nbsp;a&nbsp;special&nbsp;rational&nbsp;function&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="1844418">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;interval&nbsp;[0,0.34658]:</span><br>
<span class="lineno">35</span><span class="comment" id="1844452">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Since</span><br>
<span class="lineno"></span><span class="comment" id="1844466">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;-&nbsp;r**4/360&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="1844531">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;define&nbsp;R1(r*r)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1844560">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;*&nbsp;R1(r*r)</span><br>
<span class="lineno"></span><span class="comment" id="1844618">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;is,</span><br>
<span class="lineno">40</span><span class="comment" id="1844635">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(r**2)&nbsp;=&nbsp;6/r&nbsp;*((exp(r)+1)/(exp(r)-1)&nbsp;-&nbsp;2/r)</span><br>
<span class="lineno"></span><span class="comment" id="1844693">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6/r&nbsp;*&nbsp;(&nbsp;1&nbsp;+&nbsp;2.0*(1/(exp(r)-1)&nbsp;-&nbsp;1/r))</span><br>
<span class="lineno"></span><span class="comment" id="1844754">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;-&nbsp;r**2/60&nbsp;+&nbsp;r**4/2520&nbsp;-&nbsp;r**6/100800&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="1844821">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;a&nbsp;special&nbsp;Reme&nbsp;algorithm&nbsp;on&nbsp;[0,0.347]&nbsp;to&nbsp;generate</span><br>
<span class="lineno"></span><span class="comment" id="1844886">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;polynomial&nbsp;of&nbsp;degree&nbsp;5&nbsp;in&nbsp;r*r&nbsp;to&nbsp;approximate&nbsp;R1.&nbsp;The</span><br>
<span class="lineno">45</span><span class="comment" id="1844949">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum&nbsp;error&nbsp;of&nbsp;this&nbsp;polynomial&nbsp;approximation&nbsp;is&nbsp;bounded</span><br>
<span class="lineno"></span><span class="comment" id="1845015">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;2**-61.&nbsp;In&nbsp;other&nbsp;words,</span><br>
<span class="lineno"></span><span class="comment" id="1845050">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(z)&nbsp;~&nbsp;1.0&nbsp;+&nbsp;Q1*z&nbsp;+&nbsp;Q2*z**2&nbsp;+&nbsp;Q3*z**3&nbsp;+&nbsp;Q4*z**4&nbsp;+&nbsp;Q5*z**5</span><br>
<span class="lineno"></span><span class="comment" id="1845121">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;&nbsp;Q1&nbsp;&nbsp;=&nbsp;&nbsp;-1.6666666666666567384E-2,</span><br>
<span class="lineno"></span><span class="comment" id="1845171">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q2&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;3.9682539681370365873E-4,</span><br>
<span class="lineno">50</span><span class="comment" id="1845221">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3&nbsp;&nbsp;=&nbsp;&nbsp;-9.9206344733435987357E-6,</span><br>
<span class="lineno"></span><span class="comment" id="1845271">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q4&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2.5051361420808517002E-7,</span><br>
<span class="lineno"></span><span class="comment" id="1845321">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q5&nbsp;&nbsp;=&nbsp;&nbsp;-6.2843505682382617102E-9;</span><br>
<span class="lineno"></span><span class="comment" id="1845371">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(where&nbsp;z=r*r,&nbsp;and&nbsp;the&nbsp;values&nbsp;of&nbsp;Q1&nbsp;to&nbsp;Q5&nbsp;are&nbsp;listed&nbsp;below)</span><br>
<span class="lineno"></span><span class="comment" id="1845438">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;error&nbsp;bounded&nbsp;by</span><br>
<span class="lineno">55</span><span class="comment" id="1845468">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-61</span><br>
<span class="lineno"></span><span class="comment" id="1845521">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;1.0+Q1*z+...+Q5*z&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;R1(z)&nbsp;|&nbsp;&lt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="1845571">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="1845616">//</span><br>
<span class="lineno"></span><span class="comment" id="1845619">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;exp(r)-1&nbsp;is&nbsp;then&nbsp;computed&nbsp;by&nbsp;the&nbsp;following</span><br>
<span class="lineno">60</span><span class="comment" id="1845681">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specific&nbsp;way&nbsp;which&nbsp;minimize&nbsp;the&nbsp;accumulation&nbsp;rounding&nbsp;error:</span><br>
<span class="lineno"></span><span class="comment" id="1845750">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="1845789">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;3&nbsp;-&nbsp;(R1&nbsp;+&nbsp;R1*r/2)&nbsp;&nbsp;]</span><br>
<span class="lineno"></span><span class="comment" id="1845853">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;r&nbsp;+&nbsp;---&nbsp;+&nbsp;---&nbsp;*&nbsp;[--------------------]</span><br>
<span class="lineno"></span><span class="comment" id="1845917">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]</span><br>
<span class="lineno">65</span><span class="comment" id="1845981">//</span><br>
<span class="lineno"></span><span class="comment" id="1845984">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;compensate&nbsp;the&nbsp;error&nbsp;in&nbsp;the&nbsp;argument&nbsp;reduction,&nbsp;we&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="1846050">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)&nbsp;=&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;expm1(r)*c</span><br>
<span class="lineno"></span><span class="comment" id="1846105">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;r*c</span><br>
<span class="lineno"></span><span class="comment" id="1846153">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thus&nbsp;c+r*c&nbsp;will&nbsp;be&nbsp;added&nbsp;in&nbsp;as&nbsp;the&nbsp;correction&nbsp;terms&nbsp;for</span><br>
<span class="lineno">70</span><span class="comment" id="1846217">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c).&nbsp;Now&nbsp;rearrange&nbsp;the&nbsp;term&nbsp;to&nbsp;avoid&nbsp;optimization</span><br>
<span class="lineno"></span><span class="comment" id="1846282">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;up:</span><br>
<span class="lineno"></span><span class="comment" id="1846300">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1846372">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;R1&nbsp;-&nbsp;&nbsp;(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1846444">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)~r&nbsp;-&nbsp;({r*(---&nbsp;*&nbsp;[--------------------]-c)-c}&nbsp;-&nbsp;---&nbsp;)</span><br>
<span class="lineno">75</span><span class="comment" id="1846516">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1846588">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="1846660">//</span><br>
<span class="lineno"></span><span class="comment" id="1846663">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r&nbsp;-&nbsp;E</span><br>
<span class="lineno"></span><span class="comment" id="1846690">//&nbsp;&nbsp;&nbsp;3.&nbsp;Scale&nbsp;back&nbsp;to&nbsp;obtain&nbsp;expm1(x):</span><br>
<span class="lineno">80</span><span class="comment" id="1846729">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;step&nbsp;1,&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="1846758">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(x)&nbsp;=&nbsp;either&nbsp;2**k*[expm1(r)+1]&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="1846809">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2**k*[expm1(r)&nbsp;+&nbsp;(1-2**-k)]</span><br>
<span class="lineno"></span><span class="comment" id="1846866">//&nbsp;&nbsp;&nbsp;4.&nbsp;Implementation&nbsp;notes:</span><br>
<span class="lineno"></span><span class="comment" id="1846896">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(A).&nbsp;To&nbsp;save&nbsp;one&nbsp;multiplication,&nbsp;we&nbsp;scale&nbsp;the&nbsp;coefficient&nbsp;Qi</span><br>
<span class="lineno">85</span><span class="comment" id="1846965">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;Qi*2**i,&nbsp;and&nbsp;replace&nbsp;z&nbsp;by&nbsp;(x**2)/2.</span><br>
<span class="lineno"></span><span class="comment" id="1847017">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(B).&nbsp;To&nbsp;achieve&nbsp;maximum&nbsp;accuracy,&nbsp;we&nbsp;compute&nbsp;expm1(x)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="1847082">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(i)&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0,&nbsp;(raise&nbsp;inexact&nbsp;if&nbsp;x!=inf)</span><br>
<span class="lineno"></span><span class="comment" id="1847153">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ii)&nbsp;&nbsp;if&nbsp;k=0,&nbsp;return&nbsp;r-E</span><br>
<span class="lineno"></span><span class="comment" id="1847188">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iii)&nbsp;if&nbsp;k=-1,&nbsp;return&nbsp;0.5*(r-E)-0.5</span><br>
<span class="lineno">90</span><span class="comment" id="1847234">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iv)&nbsp;&nbsp;if&nbsp;k=1&nbsp;if&nbsp;r&nbsp;&lt;&nbsp;-0.25,&nbsp;return&nbsp;2*((r+0.5)-&nbsp;E)</span><br>
<span class="lineno"></span><span class="comment" id="1847293">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;1.0+2.0*(r-E);</span><br>
<span class="lineno"></span><span class="comment" id="1847353">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v)&nbsp;&nbsp;&nbsp;if&nbsp;(k&lt;-2||k&gt;56)&nbsp;return&nbsp;2**k(1-(E-r))&nbsp;-&nbsp;1&nbsp;(or&nbsp;exp(x)-1)</span><br>
<span class="lineno"></span><span class="comment" id="1847424">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vi)&nbsp;&nbsp;if&nbsp;k&nbsp;&lt;=&nbsp;20,&nbsp;return&nbsp;2**k((1-2**-k)-(E-r)),&nbsp;else</span><br>
<span class="lineno"></span><span class="comment" id="1847487">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vii)&nbsp;return&nbsp;2**k(1-((E+2**-k)-r))</span><br>
<span class="lineno">95</span><span class="comment" id="1847532">//</span><br>
<span class="lineno"></span><span class="comment" id="1847535">//&nbsp;Special&nbsp;cases:</span><br>
<span class="lineno"></span><span class="comment" id="1847553">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(INF)&nbsp;is&nbsp;INF,&nbsp;expm1(NaN)&nbsp;is&nbsp;NaN;</span><br>
<span class="lineno"></span><span class="comment" id="1847599">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(-INF)&nbsp;is&nbsp;-1,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1847630">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;finite&nbsp;argument,&nbsp;only&nbsp;expm1(0)=0&nbsp;is&nbsp;exact.</span><br>
<span class="lineno">100</span><span class="comment" id="1847685">//</span><br>
<span class="lineno"></span><span class="comment" id="1847688">//&nbsp;Accuracy:</span><br>
<span class="lineno"></span><span class="comment" id="1847701">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;an&nbsp;error&nbsp;analysis,&nbsp;the&nbsp;error&nbsp;is&nbsp;always&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="1847771">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;ulp&nbsp;(unit&nbsp;in&nbsp;the&nbsp;last&nbsp;place).</span><br>
<span class="lineno"></span><span class="comment" id="1847811">//</span><br>
<span class="lineno">105</span><span class="comment" id="1847814">//&nbsp;Misc.&nbsp;info.</span><br>
<span class="lineno"></span><span class="comment" id="1847829">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;IEEE&nbsp;double</span><br>
<span class="lineno"></span><span class="comment" id="1847853">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;7.09782712893383973096e+02&nbsp;then&nbsp;expm1(x)&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="1847923">//</span><br>
<span class="lineno"></span><span class="comment" id="1847926">//&nbsp;Constants:</span><br>
<span class="lineno">110</span><span class="comment" id="1847940">//&nbsp;The&nbsp;hexadecimal&nbsp;values&nbsp;are&nbsp;the&nbsp;intended&nbsp;ones&nbsp;for&nbsp;the&nbsp;following</span><br>
<span class="lineno"></span><span class="comment" id="1848006">//&nbsp;constants.&nbsp;The&nbsp;decimal&nbsp;values&nbsp;may&nbsp;be&nbsp;used,&nbsp;provided&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1848070">//&nbsp;compiler&nbsp;will&nbsp;convert&nbsp;from&nbsp;decimal&nbsp;to&nbsp;binary&nbsp;accurately&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="1848136">//&nbsp;to&nbsp;produce&nbsp;the&nbsp;hexadecimal&nbsp;values&nbsp;shown.</span><br>
<span class="lineno"></span><span class="comment" id="1848180">//</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1848184">//&nbsp;Expm1&nbsp;returns&nbsp;e**x&nbsp;-&nbsp;1,&nbsp;the&nbsp;base-e&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="1848248">//&nbsp;It&nbsp;is&nbsp;more&nbsp;accurate&nbsp;than&nbsp;Exp(x)&nbsp;-&nbsp;1&nbsp;when&nbsp;x&nbsp;is&nbsp;near&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="1848308">//</span><br>
<span class="lineno"></span><span class="comment" id="1848311">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno">120</span><span class="comment" id="1848333">//&nbsp;&nbsp;&nbsp;&nbspExpm1(+Inf)&nbsp;=&nbsp;+Inf</span><br>
<span class="lineno"></span><span class="comment" id="1848355">//&nbsp;&nbsp;&nbsp;&nbspExpm1(-Inf)&nbsp;=&nbsp;-1</span><br>
<span class="lineno"></span><span class="comment" id="1848375">//&nbsp;&nbsp;&nbsp;&nbspExpm1(NaN)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="comment" id="1848395">//&nbsp;Very&nbsp;large&nbsp;values&nbsp;overflow&nbsp;to&nbsp;-1&nbsp;or&nbsp;+Inf.</span><br>
<span class="lineno"></span><span class="keyword" id="1848440">func</span>&nbsp;<span class="ident" id="1848445">Expm1</span><span class="op" id="1848450">(</span><span class="ident" id="1848451">x</span>&nbsp;<span class="builtintype" id="1848453">float64</span><span class="op" id="1848460">)</span>&nbsp;<span class="builtintype" id="1848462">float64</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="1848471">func</span>&nbsp;<span class="ident" id="1848476">expm1</span><span class="op" id="1848481">(</span><span class="ident" id="1848482">x</span>&nbsp;<span class="builtintype" id="1848484">float64</span><span class="op" id="1848491">)</span>&nbsp;<span class="builtintype" id="1848493">float64</span>&nbsp;<span class="op" id="1848501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1848504">const</span>&nbsp;<span class="op" id="1848510">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848514">Othreshold</span>&nbsp;<span class="op" id="1848525">=</span>&nbsp;<span class="num" id="1848527">7.09782712893383973096e+02</span>&nbsp;<span class="comment" id="1848554">//&nbsp;0x40862E42FEFA39EF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848578">Ln2X56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1848589">=</span>&nbsp;<span class="num" id="1848591">3.88162421113569373274e+01</span>&nbsp;<span class="comment" id="1848618">//&nbsp;0x4043687a9f1af2b1</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848642">Ln2HalfX3</span>&nbsp;&nbsp;<span class="op" id="1848653">=</span>&nbsp;<span class="num" id="1848655">1.03972077083991796413e+00</span>&nbsp;<span class="comment" id="1848682">//&nbsp;0x3ff0a2b23f3bab73</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848706">Ln2Half</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1848717">=</span>&nbsp;<span class="num" id="1848719">3.46573590279972654709e-01</span>&nbsp;<span class="comment" id="1848746">//&nbsp;0x3fd62e42fefa39ef</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848770">Ln2Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1848781">=</span>&nbsp;<span class="num" id="1848783">6.93147180369123816490e-01</span>&nbsp;<span class="comment" id="1848810">//&nbsp;0x3fe62e42fee00000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848834">Ln2Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1848845">=</span>&nbsp;<span class="num" id="1848847">1.90821492927058770002e-10</span>&nbsp;<span class="comment" id="1848874">//&nbsp;0x3dea39ef35793c76</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848898">InvLn2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1848909">=</span>&nbsp;<span class="num" id="1848911">1.44269504088896338700e+00</span>&nbsp;<span class="comment" id="1848938">//&nbsp;0x3ff71547652b82fe</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1848962">Tiny</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1848973">=</span>&nbsp;<span class="num" id="1848975">1.0</span>&nbsp;<span class="op" id="1848979">/</span>&nbsp;<span class="op" id="1848981">(</span><span class="num" id="1848982">1</span>&nbsp;<span class="op" id="1848984">&lt;&lt;</span>&nbsp;<span class="num" id="1848987">54</span><span class="op" id="1848989">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1849002">//&nbsp;2**-54&nbsp;=&nbsp;0x3c90000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1849035">//&nbsp;scaled&nbsp;coefficients&nbsp;related&nbsp;to&nbsp;expm1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849077">Q1</span>&nbsp;<span class="op" id="1849080">=</span>&nbsp;<span class="op" id="1849082">-</span><span class="num" id="1849083">3.33333333333331316428e-02</span>&nbsp;<span class="comment" id="1849110">//&nbsp;0xBFA11111111110F4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849134">Q2</span>&nbsp;<span class="op" id="1849137">=</span>&nbsp;<span class="num" id="1849139">1.58730158725481460165e-03</span>&nbsp;&nbsp;<span class="comment" id="1849167">//&nbsp;0x3F5A01A019FE5585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849191">Q3</span>&nbsp;<span class="op" id="1849194">=</span>&nbsp;<span class="op" id="1849196">-</span><span class="num" id="1849197">7.93650757867487942473e-05</span>&nbsp;<span class="comment" id="1849224">//&nbsp;0xBF14CE199EAADBB7</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849248">Q4</span>&nbsp;<span class="op" id="1849251">=</span>&nbsp;<span class="num" id="1849253">4.00821782732936239552e-06</span>&nbsp;&nbsp;<span class="comment" id="1849281">//&nbsp;0x3ED0CFCA86E65239</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849305">Q5</span>&nbsp;<span class="op" id="1849308">=</span>&nbsp;<span class="op" id="1849310">-</span><span class="num" id="1849311">2.01099218183624371326e-07</span>&nbsp;<span class="comment" id="1849338">//&nbsp;0xBE8AFDB76E09C32D</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849361">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1849365">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849383">switch</span>&nbsp;<span class="op" id="1849390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849393">case</span>&nbsp;<span class="ident" id="1849398">IsInf</span><span class="op" id="1849403">(</span><span class="ident" id="1849404">x</span><span class="op" id="1849405">,</span>&nbsp;<span class="num" id="1849407">1</span><span class="op" id="1849408">)</span>&nbsp;<span class="op" id="1849410">||</span>&nbsp;<span class="ident" id="1849413">IsNaN</span><span class="op" id="1849418">(</span><span class="ident" id="1849419">x</span><span class="op" id="1849420">)</span><span class="op" id="1849421">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849425">return</span>&nbsp;<span class="ident" id="1849432">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849435">case</span>&nbsp;<span class="ident" id="1849440">IsInf</span><span class="op" id="1849445">(</span><span class="ident" id="1849446">x</span><span class="op" id="1849447">,</span>&nbsp;<span class="op" id="1849449">-</span><span class="num" id="1849450">1</span><span class="op" id="1849451">)</span><span class="op" id="1849452">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849456">return</span>&nbsp;<span class="op" id="1849463">-</span><span class="num" id="1849464">1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849471">absx</span>&nbsp;<span class="op" id="1849476">:=</span>&nbsp;<span class="ident" id="1849479">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849482">sign</span>&nbsp;<span class="op" id="1849487">:=</span>&nbsp;<span class="builtintype" id="1849490">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849497">if</span>&nbsp;<span class="ident" id="1849500">x</span>&nbsp;<span class="op" id="1849502">&lt;</span>&nbsp;<span class="num" id="1849504">0</span>&nbsp;<span class="op" id="1849506">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849510">absx</span>&nbsp;<span class="op" id="1849515">=</span>&nbsp;<span class="op" id="1849517">-</span><span class="ident" id="1849518">absx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849525">sign</span>&nbsp;<span class="op" id="1849530">=</span>&nbsp;<span class="builtintype" id="1849532">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1849542">//&nbsp;filter&nbsp;out&nbsp;huge&nbsp;argument</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849571">if</span>&nbsp;<span class="ident" id="1849574">absx</span>&nbsp;<span class="op" id="1849579">&gt;=</span>&nbsp;<span class="ident" id="1849582">Ln2X56</span>&nbsp;<span class="op" id="1849589">{</span>&nbsp;<span class="comment" id="1849591">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;56&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849615">if</span>&nbsp;<span class="ident" id="1849618">absx</span>&nbsp;<span class="op" id="1849623">&gt;=</span>&nbsp;<span class="ident" id="1849626">Othreshold</span>&nbsp;<span class="op" id="1849637">{</span>&nbsp;<span class="comment" id="1849639">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;709.78...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849665">return</span>&nbsp;<span class="ident" id="1849672">Inf</span><span class="op" id="1849675">(</span><span class="num" id="1849676">1</span><span class="op" id="1849677">)</span>&nbsp;<span class="comment" id="1849679">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849697">if</span>&nbsp;<span class="ident" id="1849700">sign</span>&nbsp;<span class="op" id="1849705">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849710">return</span>&nbsp;<span class="op" id="1849717">-</span><span class="num" id="1849718">1</span>&nbsp;<span class="comment" id="1849720">//&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1849757">//&nbsp;argument&nbsp;reduction</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849780">var</span>&nbsp;<span class="ident" id="1849784">c</span>&nbsp;<span class="builtintype" id="1849786">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849795">var</span>&nbsp;<span class="ident" id="1849799">k</span>&nbsp;<span class="builtintype" id="1849801">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849806">if</span>&nbsp;<span class="ident" id="1849809">absx</span>&nbsp;<span class="op" id="1849814">&gt;</span>&nbsp;<span class="ident" id="1849816">Ln2Half</span>&nbsp;<span class="op" id="1849824">{</span>&nbsp;<span class="comment" id="1849826">//&nbsp;if&nbsp;&nbsp;|x|&nbsp;&gt;&nbsp;0.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849851">var</span>&nbsp;<span class="ident" id="1849855">hi</span><span class="op" id="1849857">,</span>&nbsp;<span class="ident" id="1849859">lo</span>&nbsp;<span class="builtintype" id="1849862">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849872">if</span>&nbsp;<span class="ident" id="1849875">absx</span>&nbsp;<span class="op" id="1849880">&lt;</span>&nbsp;<span class="ident" id="1849882">Ln2HalfX3</span>&nbsp;<span class="op" id="1849892">{</span>&nbsp;<span class="comment" id="1849894">//&nbsp;and&nbsp;|x|&nbsp;&lt;&nbsp;1.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1849920">if</span>&nbsp;<span class="op" id="1849923">!</span><span class="ident" id="1849924">sign</span>&nbsp;<span class="op" id="1849929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849935">hi</span>&nbsp;<span class="op" id="1849938">=</span>&nbsp;<span class="ident" id="1849940">x</span>&nbsp;<span class="op" id="1849942">-</span>&nbsp;<span class="ident" id="1849944">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849954">lo</span>&nbsp;<span class="op" id="1849957">=</span>&nbsp;<span class="ident" id="1849959">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849969">k</span>&nbsp;<span class="op" id="1849971">=</span>&nbsp;<span class="num" id="1849973">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1849978">}</span>&nbsp;<span class="keyword" id="1849980">else</span>&nbsp;<span class="op" id="1849985">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1849991">hi</span>&nbsp;<span class="op" id="1849994">=</span>&nbsp;<span class="ident" id="1849996">x</span>&nbsp;<span class="op" id="1849998">+</span>&nbsp;<span class="ident" id="1850000">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850010">lo</span>&nbsp;<span class="op" id="1850013">=</span>&nbsp;<span class="op" id="1850015">-</span><span class="ident" id="1850016">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850026">k</span>&nbsp;<span class="op" id="1850028">=</span>&nbsp;<span class="op" id="1850030">-</span><span class="num" id="1850031">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1850036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1850040">}</span>&nbsp;<span class="keyword" id="1850042">else</span>&nbsp;<span class="op" id="1850047">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850052">if</span>&nbsp;<span class="op" id="1850055">!</span><span class="ident" id="1850056">sign</span>&nbsp;<span class="op" id="1850061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850067">k</span>&nbsp;<span class="op" id="1850069">=</span>&nbsp;<span class="builtintype" id="1850071">int</span><span class="op" id="1850074">(</span><span class="ident" id="1850075">InvLn2</span><span class="op" id="1850081">*</span><span class="ident" id="1850082">x</span>&nbsp;<span class="op" id="1850084">+</span>&nbsp;<span class="num" id="1850086">0.5</span><span class="op" id="1850089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1850094">}</span>&nbsp;<span class="keyword" id="1850096">else</span>&nbsp;<span class="op" id="1850101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850107">k</span>&nbsp;<span class="op" id="1850109">=</span>&nbsp;<span class="builtintype" id="1850111">int</span><span class="op" id="1850114">(</span><span class="ident" id="1850115">InvLn2</span><span class="op" id="1850121">*</span><span class="ident" id="1850122">x</span>&nbsp;<span class="op" id="1850124">-</span>&nbsp;<span class="num" id="1850126">0.5</span><span class="op" id="1850129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1850134">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850139">t</span>&nbsp;<span class="op" id="1850141">:=</span>&nbsp;<span class="builtintype" id="1850144">float64</span><span class="op" id="1850151">(</span><span class="ident" id="1850152">k</span><span class="op" id="1850153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850158">hi</span>&nbsp;<span class="op" id="1850161">=</span>&nbsp;<span class="ident" id="1850163">x</span>&nbsp;<span class="op" id="1850165">-</span>&nbsp;<span class="ident" id="1850167">t</span><span class="op" id="1850168">*</span><span class="ident" id="1850169">Ln2Hi</span>&nbsp;<span class="comment" id="1850175">//&nbsp;t&nbsp;*&nbsp;Ln2Hi&nbsp;is&nbsp;exact&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850205">lo</span>&nbsp;<span class="op" id="1850208">=</span>&nbsp;<span class="ident" id="1850210">t</span>&nbsp;<span class="op" id="1850212">*</span>&nbsp;<span class="ident" id="1850214">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1850222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850226">x</span>&nbsp;<span class="op" id="1850228">=</span>&nbsp;<span class="ident" id="1850230">hi</span>&nbsp;<span class="op" id="1850233">-</span>&nbsp;<span class="ident" id="1850235">lo</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850240">c</span>&nbsp;<span class="op" id="1850242">=</span>&nbsp;<span class="op" id="1850244">(</span><span class="ident" id="1850245">hi</span>&nbsp;<span class="op" id="1850248">-</span>&nbsp;<span class="ident" id="1850250">x</span><span class="op" id="1850251">)</span>&nbsp;<span class="op" id="1850253">-</span>&nbsp;<span class="ident" id="1850255">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1850259">}</span>&nbsp;<span class="keyword" id="1850261">else</span>&nbsp;<span class="keyword" id="1850266">if</span>&nbsp;<span class="ident" id="1850269">absx</span>&nbsp;<span class="op" id="1850274">&lt;</span>&nbsp;<span class="ident" id="1850276">Tiny</span>&nbsp;<span class="op" id="1850281">{</span>&nbsp;<span class="comment" id="1850283">//&nbsp;when&nbsp;|x|&nbsp;&lt;&nbsp;2**-54,&nbsp;return&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850316">return</span>&nbsp;<span class="ident" id="1850323">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1850326">}</span>&nbsp;<span class="keyword" id="1850328">else</span>&nbsp;<span class="op" id="1850333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850337">k</span>&nbsp;<span class="op" id="1850339">=</span>&nbsp;<span class="num" id="1850341">0</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1850344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1850348">//&nbsp;x&nbsp;is&nbsp;now&nbsp;in&nbsp;primary&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850378">hfx</span>&nbsp;<span class="op" id="1850382">:=</span>&nbsp;<span class="num" id="1850385">0.5</span>&nbsp;<span class="op" id="1850389">*</span>&nbsp;<span class="ident" id="1850391">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850394">hxs</span>&nbsp;<span class="op" id="1850398">:=</span>&nbsp;<span class="ident" id="1850401">x</span>&nbsp;<span class="op" id="1850403">*</span>&nbsp;<span class="ident" id="1850405">hfx</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850410">r1</span>&nbsp;<span class="op" id="1850413">:=</span>&nbsp;<span class="num" id="1850416">1</span>&nbsp;<span class="op" id="1850418">+</span>&nbsp;<span class="ident" id="1850420">hxs</span><span class="op" id="1850423">*</span><span class="op" id="1850424">(</span><span class="ident" id="1850425">Q1</span><span class="op" id="1850427">+</span><span class="ident" id="1850428">hxs</span><span class="op" id="1850431">*</span><span class="op" id="1850432">(</span><span class="ident" id="1850433">Q2</span><span class="op" id="1850435">+</span><span class="ident" id="1850436">hxs</span><span class="op" id="1850439">*</span><span class="op" id="1850440">(</span><span class="ident" id="1850441">Q3</span><span class="op" id="1850443">+</span><span class="ident" id="1850444">hxs</span><span class="op" id="1850447">*</span><span class="op" id="1850448">(</span><span class="ident" id="1850449">Q4</span><span class="op" id="1850451">+</span><span class="ident" id="1850452">hxs</span><span class="op" id="1850455">*</span><span class="ident" id="1850456">Q5</span><span class="op" id="1850458">)</span><span class="op" id="1850459">)</span><span class="op" id="1850460">)</span><span class="op" id="1850461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850464">t</span>&nbsp;<span class="op" id="1850466">:=</span>&nbsp;<span class="num" id="1850469">3</span>&nbsp;<span class="op" id="1850471">-</span>&nbsp;<span class="ident" id="1850473">r1</span><span class="op" id="1850475">*</span><span class="ident" id="1850476">hfx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850481">e</span>&nbsp;<span class="op" id="1850483">:=</span>&nbsp;<span class="ident" id="1850486">hxs</span>&nbsp;<span class="op" id="1850490">*</span>&nbsp;<span class="op" id="1850492">(</span><span class="op" id="1850493">(</span><span class="ident" id="1850494">r1</span>&nbsp;<span class="op" id="1850497">-</span>&nbsp;<span class="ident" id="1850499">t</span><span class="op" id="1850500">)</span>&nbsp;<span class="op" id="1850502">/</span>&nbsp;<span class="op" id="1850504">(</span><span class="num" id="1850505">6.0</span>&nbsp;<span class="op" id="1850509">-</span>&nbsp;<span class="ident" id="1850511">x</span><span class="op" id="1850512">*</span><span class="ident" id="1850513">t</span><span class="op" id="1850514">)</span><span class="op" id="1850515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850518">if</span>&nbsp;<span class="ident" id="1850521">k</span>&nbsp;<span class="op" id="1850523">!=</span>&nbsp;<span class="num" id="1850526">0</span>&nbsp;<span class="op" id="1850528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850532">e</span>&nbsp;<span class="op" id="1850534">=</span>&nbsp;<span class="op" id="1850536">(</span><span class="ident" id="1850537">x</span><span class="op" id="1850538">*</span><span class="op" id="1850539">(</span><span class="ident" id="1850540">e</span><span class="op" id="1850541">-</span><span class="ident" id="1850542">c</span><span class="op" id="1850543">)</span>&nbsp;<span class="op" id="1850545">-</span>&nbsp;<span class="ident" id="1850547">c</span><span class="op" id="1850548">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850552">e</span>&nbsp;<span class="op" id="1850554">-=</span>&nbsp;<span class="ident" id="1850557">hxs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850563">switch</span>&nbsp;<span class="op" id="1850570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850574">case</span>&nbsp;<span class="ident" id="1850579">k</span>&nbsp;<span class="op" id="1850581">==</span>&nbsp;<span class="op" id="1850584">-</span><span class="num" id="1850585">1</span><span class="op" id="1850586">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850591">return</span>&nbsp;<span class="num" id="1850598">0.5</span><span class="op" id="1850601">*</span><span class="op" id="1850602">(</span><span class="ident" id="1850603">x</span><span class="op" id="1850604">-</span><span class="ident" id="1850605">e</span><span class="op" id="1850606">)</span>&nbsp;<span class="op" id="1850608">-</span>&nbsp;<span class="num" id="1850610">0.5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850616">case</span>&nbsp;<span class="ident" id="1850621">k</span>&nbsp;<span class="op" id="1850623">==</span>&nbsp;<span class="num" id="1850626">1</span><span class="op" id="1850627">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850632">if</span>&nbsp;<span class="ident" id="1850635">x</span>&nbsp;<span class="op" id="1850637">&lt;</span>&nbsp;<span class="op" id="1850639">-</span><span class="num" id="1850640">0.25</span>&nbsp;<span class="op" id="1850645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850651">return</span>&nbsp;<span class="op" id="1850658">-</span><span class="num" id="1850659">2</span>&nbsp;<span class="op" id="1850661">*</span>&nbsp;<span class="op" id="1850663">(</span><span class="ident" id="1850664">e</span>&nbsp;<span class="op" id="1850666">-</span>&nbsp;<span class="op" id="1850668">(</span><span class="ident" id="1850669">x</span>&nbsp;<span class="op" id="1850671">+</span>&nbsp;<span class="num" id="1850673">0.5</span><span class="op" id="1850676">)</span><span class="op" id="1850677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1850682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850687">return</span>&nbsp;<span class="num" id="1850694">1</span>&nbsp;<span class="op" id="1850696">+</span>&nbsp;<span class="num" id="1850698">2</span><span class="op" id="1850699">*</span><span class="op" id="1850700">(</span><span class="ident" id="1850701">x</span><span class="op" id="1850702">-</span><span class="ident" id="1850703">e</span><span class="op" id="1850704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850708">case</span>&nbsp;<span class="ident" id="1850713">k</span>&nbsp;<span class="op" id="1850715">&lt;=</span>&nbsp;<span class="op" id="1850718">-</span><span class="num" id="1850719">2</span>&nbsp;<span class="op" id="1850721">||</span>&nbsp;<span class="ident" id="1850724">k</span>&nbsp;<span class="op" id="1850726">&gt;</span>&nbsp;<span class="num" id="1850728">56</span><span class="op" id="1850730">:</span>&nbsp;<span class="comment" id="1850732">//&nbsp;suffice&nbsp;to&nbsp;return&nbsp;exp(x)-1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850765">y</span>&nbsp;<span class="op" id="1850767">:=</span>&nbsp;<span class="num" id="1850770">1</span>&nbsp;<span class="op" id="1850772">-</span>&nbsp;<span class="op" id="1850774">(</span><span class="ident" id="1850775">e</span>&nbsp;<span class="op" id="1850777">-</span>&nbsp;<span class="ident" id="1850779">x</span><span class="op" id="1850780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850785">y</span>&nbsp;<span class="op" id="1850787">=</span>&nbsp;<span class="ident" id="1850789">Float64frombits</span><span class="op" id="1850804">(</span><span class="ident" id="1850805">Float64bits</span><span class="op" id="1850816">(</span><span class="ident" id="1850817">y</span><span class="op" id="1850818">)</span>&nbsp;<span class="op" id="1850820">+</span>&nbsp;<span class="ident" id="1850822">uint64</span><span class="op" id="1850828">(</span><span class="ident" id="1850829">k</span><span class="op" id="1850830">)</span><span class="op" id="1850831">&lt;&lt;</span><span class="num" id="1850833">52</span><span class="op" id="1850835">)</span>&nbsp;<span class="comment" id="1850837">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850865">return</span>&nbsp;<span class="ident" id="1850872">y</span>&nbsp;<span class="op" id="1850874">-</span>&nbsp;<span class="num" id="1850876">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1850880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1850884">if</span>&nbsp;<span class="ident" id="1850887">k</span>&nbsp;<span class="op" id="1850889">&lt;</span>&nbsp;<span class="num" id="1850891">20</span>&nbsp;<span class="op" id="1850894">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850899">t</span>&nbsp;<span class="op" id="1850901">:=</span>&nbsp;<span class="ident" id="1850904">Float64frombits</span><span class="op" id="1850919">(</span><span class="num" id="1850920">0x3ff0000000000000</span>&nbsp;<span class="op" id="1850939">-</span>&nbsp;<span class="op" id="1850941">(</span><span class="num" id="1850942">0x20000000000000</span>&nbsp;<span class="op" id="1850959">&gt;&gt;</span>&nbsp;<span class="builtintype" id="1850962">uint</span><span class="op" id="1850966">(</span><span class="ident" id="1850967">k</span><span class="op" id="1850968">)</span><span class="op" id="1850969">)</span><span class="op" id="1850970">)</span>&nbsp;<span class="comment" id="1850972">//&nbsp;t=1-2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1850988">y</span>&nbsp;<span class="op" id="1850990">:=</span>&nbsp;<span class="ident" id="1850993">t</span>&nbsp;<span class="op" id="1850995">-</span>&nbsp;<span class="op" id="1850997">(</span><span class="ident" id="1850998">e</span>&nbsp;<span class="op" id="1851000">-</span>&nbsp;<span class="ident" id="1851002">x</span><span class="op" id="1851003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851008">y</span>&nbsp;<span class="op" id="1851010">=</span>&nbsp;<span class="ident" id="1851012">Float64frombits</span><span class="op" id="1851027">(</span><span class="ident" id="1851028">Float64bits</span><span class="op" id="1851039">(</span><span class="ident" id="1851040">y</span><span class="op" id="1851041">)</span>&nbsp;<span class="op" id="1851043">+</span>&nbsp;<span class="ident" id="1851045">uint64</span><span class="op" id="1851051">(</span><span class="ident" id="1851052">k</span><span class="op" id="1851053">)</span><span class="op" id="1851054">&lt;&lt;</span><span class="num" id="1851056">52</span><span class="op" id="1851058">)</span>&nbsp;<span class="comment" id="1851060">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851088">return</span>&nbsp;<span class="ident" id="1851095">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1851099">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851103">t</span>&nbsp;<span class="op" id="1851105">:=</span>&nbsp;<span class="ident" id="1851108">Float64frombits</span><span class="op" id="1851123">(</span><span class="ident" id="1851124">uint64</span><span class="op" id="1851130">(</span><span class="op" id="1851131">(</span><span class="num" id="1851132">0x3ff</span>&nbsp;<span class="op" id="1851138">-</span>&nbsp;<span class="ident" id="1851140">k</span><span class="op" id="1851141">)</span>&nbsp;<span class="op" id="1851143">&lt;&lt;</span>&nbsp;<span class="num" id="1851146">52</span><span class="op" id="1851148">)</span><span class="op" id="1851149">)</span>&nbsp;<span class="comment" id="1851151">//&nbsp;2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851162">y</span>&nbsp;<span class="op" id="1851164">:=</span>&nbsp;<span class="ident" id="1851167">x</span>&nbsp;<span class="op" id="1851169">-</span>&nbsp;<span class="op" id="1851171">(</span><span class="ident" id="1851172">e</span>&nbsp;<span class="op" id="1851174">+</span>&nbsp;<span class="ident" id="1851176">t</span><span class="op" id="1851177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851181">y</span>&nbsp;<span class="op" id="1851183">+=</span>&nbsp;<span class="num" id="1851186">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1851190">y</span>&nbsp;<span class="op" id="1851192">=</span>&nbsp;<span class="ident" id="1851194">Float64frombits</span><span class="op" id="1851209">(</span><span class="ident" id="1851210">Float64bits</span><span class="op" id="1851221">(</span><span class="ident" id="1851222">y</span><span class="op" id="1851223">)</span>&nbsp;<span class="op" id="1851225">+</span>&nbsp;<span class="ident" id="1851227">uint64</span><span class="op" id="1851233">(</span><span class="ident" id="1851234">k</span><span class="op" id="1851235">)</span><span class="op" id="1851236">&lt;&lt;</span><span class="num" id="1851238">52</span><span class="op" id="1851240">)</span>&nbsp;<span class="comment" id="1851242">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851269">return</span>&nbsp;<span class="ident" id="1851276">y</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1851279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1851282">return</span>&nbsp;<span class="ident" id="1851289">x</span>&nbsp;<span class="op" id="1851291">-</span>&nbsp;<span class="op" id="1851293">(</span><span class="ident" id="1851294">x</span><span class="op" id="1851295">*</span><span class="ident" id="1851296">e</span>&nbsp;<span class="op" id="1851298">-</span>&nbsp;<span class="ident" id="1851300">hxs</span><span class="op" id="1851303">)</span>&nbsp;<span class="comment" id="1851305">//&nbsp;c&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="op" id="1851315">}</span>
</div>
</body>
</html>
