<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2389883">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2389939">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2389993">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2390044">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2390109">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2390137">package</span>&nbsp;<span class="ident" id="2390145">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2390154">import</span>&nbsp;<span class="string" id="2390161">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2390171">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;raw&nbsp;sockaddr&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2390234">func</span>&nbsp;<span class="ident" id="2390239">cmsgAlignOf</span><span class="op" id="2390250">(</span><span class="ident" id="2390251">salen</span>&nbsp;<span class="builtintype" id="2390257">int</span><span class="op" id="2390260">)</span>&nbsp;<span class="builtintype" id="2390262">int</span>&nbsp;<span class="op" id="2390266">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390269">salign</span>&nbsp;<span class="op" id="2390276">:=</span>&nbsp;<span class="ident" id="2390279">sizeofPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2390290">//&nbsp;NOTE:&nbsp;It&nbsp;seems&nbsp;like&nbsp;64-bit&nbsp;Darwin&nbsp;and&nbsp;DragonFly&nbsp;BSD&nbsp;kernels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2390354">//&nbsp;still&nbsp;require&nbsp;32-bit&nbsp;aligned&nbsp;access&nbsp;to&nbsp;network&nbsp;subsystem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390416">if</span>&nbsp;<span class="ident" id="2390419">darwin64Bit</span>&nbsp;<span class="op" id="2390431">||</span>&nbsp;<span class="ident" id="2390434">dragonfly64Bit</span>&nbsp;<span class="op" id="2390449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390453">salign</span>&nbsp;<span class="op" id="2390460">=</span>&nbsp;<span class="num" id="2390462">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2390465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390468">return</span>&nbsp;<span class="op" id="2390475">(</span><span class="ident" id="2390476">salen</span>&nbsp;<span class="op" id="2390482">+</span>&nbsp;<span class="ident" id="2390484">salign</span>&nbsp;<span class="op" id="2390491">-</span>&nbsp;<span class="num" id="2390493">1</span><span class="op" id="2390494">)</span>&nbsp;<span class="op" id="2390496">&amp;</span>&nbsp;<span class="op" id="2390498">^</span><span class="op" id="2390499">(</span><span class="ident" id="2390500">salign</span>&nbsp;<span class="op" id="2390507">-</span>&nbsp;<span class="num" id="2390509">1</span><span class="op" id="2390510">)</span><br>
<span class="lineno"></span><span class="op" id="2390512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2390515">//&nbsp;CmsgLen&nbsp;returns&nbsp;the&nbsp;value&nbsp;to&nbsp;store&nbsp;in&nbsp;the&nbsp;Len&nbsp;field&nbsp;of&nbsp;the&nbsp;Cmsghdr</span><br>
<span class="lineno">25</span><span class="comment" id="2390585">//&nbsp;structure,&nbsp;taking&nbsp;into&nbsp;account&nbsp;any&nbsp;necessary&nbsp;alignment.</span><br>
<span class="lineno"></span><span class="keyword" id="2390644">func</span>&nbsp;<span class="ident" id="2390649">CmsgLen</span><span class="op" id="2390656">(</span><span class="ident" id="2390657">datalen</span>&nbsp;<span class="builtintype" id="2390665">int</span><span class="op" id="2390668">)</span>&nbsp;<span class="builtintype" id="2390670">int</span>&nbsp;<span class="op" id="2390674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390677">return</span>&nbsp;<span class="ident" id="2390684">cmsgAlignOf</span><span class="op" id="2390695">(</span><span class="ident" id="2390696">SizeofCmsghdr</span><span class="op" id="2390709">)</span>&nbsp;<span class="op" id="2390711">+</span>&nbsp;<span class="ident" id="2390713">datalen</span><br>
<span class="lineno"></span><span class="op" id="2390721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2390724">//&nbsp;CmsgSpace&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;an&nbsp;ancillary&nbsp;element&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2390791">//&nbsp;payload&nbsp;of&nbsp;the&nbsp;passed&nbsp;data&nbsp;length&nbsp;occupies.</span><br>
<span class="lineno"></span><span class="keyword" id="2390838">func</span>&nbsp;<span class="ident" id="2390843">CmsgSpace</span><span class="op" id="2390852">(</span><span class="ident" id="2390853">datalen</span>&nbsp;<span class="builtintype" id="2390861">int</span><span class="op" id="2390864">)</span>&nbsp;<span class="builtintype" id="2390866">int</span>&nbsp;<span class="op" id="2390870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390873">return</span>&nbsp;<span class="ident" id="2390880">cmsgAlignOf</span><span class="op" id="2390891">(</span><span class="ident" id="2390892">SizeofCmsghdr</span><span class="op" id="2390905">)</span>&nbsp;<span class="op" id="2390907">+</span>&nbsp;<span class="ident" id="2390909">cmsgAlignOf</span><span class="op" id="2390920">(</span><span class="ident" id="2390921">datalen</span><span class="op" id="2390928">)</span><br>
<span class="lineno"></span><span class="op" id="2390930">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2390933">func</span>&nbsp;<span class="ident" id="2390938">cmsgData</span><span class="op" id="2390946">(</span><span class="ident" id="2390947">h</span>&nbsp;<span class="op" id="2390949">*</span><span class="ident" id="2390950">Cmsghdr</span><span class="op" id="2390957">)</span>&nbsp;<span class="ident" id="2390959">unsafe</span><span class="op" id="2390965">.</span><span class="ident" id="2390966">Pointer</span>&nbsp;<span class="op" id="2390974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390977">return</span>&nbsp;<span class="ident" id="2390984">unsafe</span><span class="op" id="2390990">.</span><span class="ident" id="2390991">Pointer</span><span class="op" id="2390998">(</span><span class="builtintype" id="2390999">uintptr</span><span class="op" id="2391006">(</span><span class="ident" id="2391007">unsafe</span><span class="op" id="2391013">.</span><span class="ident" id="2391014">Pointer</span><span class="op" id="2391021">(</span><span class="ident" id="2391022">h</span><span class="op" id="2391023">)</span><span class="op" id="2391024">)</span>&nbsp;<span class="op" id="2391026">+</span>&nbsp;<span class="builtintype" id="2391028">uintptr</span><span class="op" id="2391035">(</span><span class="ident" id="2391036">cmsgAlignOf</span><span class="op" id="2391047">(</span><span class="ident" id="2391048">SizeofCmsghdr</span><span class="op" id="2391061">)</span><span class="op" id="2391062">)</span><span class="op" id="2391063">)</span><br>
<span class="lineno"></span><span class="op" id="2391065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2391068">//&nbsp;SocketControlMessage&nbsp;represents&nbsp;a&nbsp;socket&nbsp;control&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2391129">type</span>&nbsp;<span class="ident" id="2391134">SocketControlMessage</span>&nbsp;<span class="keyword" id="2391155">struct</span>&nbsp;<span class="op" id="2391162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391165">Header</span>&nbsp;<span class="ident" id="2391172">Cmsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391181">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2391188">[</span><span class="op" id="2391189">]</span><span class="builtintype" id="2391190">byte</span><br>
<span class="lineno"></span><span class="op" id="2391195">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2391198">//&nbsp;ParseSocketControlMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;socket&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="2391266">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="2391279">func</span>&nbsp;<span class="ident" id="2391284">ParseSocketControlMessage</span><span class="op" id="2391309">(</span><span class="ident" id="2391310">b</span>&nbsp;<span class="op" id="2391312">[</span><span class="op" id="2391313">]</span><span class="builtintype" id="2391314">byte</span><span class="op" id="2391318">)</span>&nbsp;<span class="op" id="2391320">(</span><span class="op" id="2391321">[</span><span class="op" id="2391322">]</span><span class="ident" id="2391323">SocketControlMessage</span><span class="op" id="2391343">,</span>&nbsp;<span class="builtintype" id="2391345">error</span><span class="op" id="2391350">)</span>&nbsp;<span class="op" id="2391352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391355">var</span>&nbsp;<span class="ident" id="2391359">msgs</span>&nbsp;<span class="op" id="2391364">[</span><span class="op" id="2391365">]</span><span class="ident" id="2391366">SocketControlMessage</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391388">i</span>&nbsp;<span class="op" id="2391390">:=</span>&nbsp;<span class="num" id="2391393">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391396">for</span>&nbsp;<span class="ident" id="2391400">i</span><span class="op" id="2391401">+</span><span class="ident" id="2391402">CmsgLen</span><span class="op" id="2391409">(</span><span class="num" id="2391410">0</span><span class="op" id="2391411">)</span>&nbsp;<span class="op" id="2391413">&lt;=</span>&nbsp;<span class="builtinfunc" id="2391416">len</span><span class="op" id="2391419">(</span><span class="ident" id="2391420">b</span><span class="op" id="2391421">)</span>&nbsp;<span class="op" id="2391423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391427">h</span><span class="op" id="2391428">,</span>&nbsp;<span class="ident" id="2391430">dbuf</span><span class="op" id="2391434">,</span>&nbsp;<span class="ident" id="2391436">err</span>&nbsp;<span class="op" id="2391440">:=</span>&nbsp;<span class="ident" id="2391443">socketControlMessageHeaderAndData</span><span class="op" id="2391476">(</span><span class="ident" id="2391477">b</span><span class="op" id="2391478">[</span><span class="ident" id="2391479">i</span><span class="op" id="2391480">:</span><span class="op" id="2391481">]</span><span class="op" id="2391482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391486">if</span>&nbsp;<span class="ident" id="2391489">err</span>&nbsp;<span class="op" id="2391493">!=</span>&nbsp;<span class="ident" id="2391496">nil</span>&nbsp;<span class="op" id="2391500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391505">return</span>&nbsp;<span class="ident" id="2391512">nil</span><span class="op" id="2391515">,</span>&nbsp;<span class="ident" id="2391517">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2391523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391527">m</span>&nbsp;<span class="op" id="2391529">:=</span>&nbsp;<span class="ident" id="2391532">SocketControlMessage</span><span class="op" id="2391552">{</span><span class="ident" id="2391553">Header</span><span class="op" id="2391559">:</span>&nbsp;<span class="op" id="2391561">*</span><span class="ident" id="2391562">h</span><span class="op" id="2391563">,</span>&nbsp;<span class="ident" id="2391565">Data</span><span class="op" id="2391569">:</span>&nbsp;<span class="ident" id="2391571">dbuf</span><span class="op" id="2391575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391579">msgs</span>&nbsp;<span class="op" id="2391584">=</span>&nbsp;<span class="builtinfunc" id="2391586">append</span><span class="op" id="2391592">(</span><span class="ident" id="2391593">msgs</span><span class="op" id="2391597">,</span>&nbsp;<span class="ident" id="2391599">m</span><span class="op" id="2391600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391604">i</span>&nbsp;<span class="op" id="2391606">+=</span>&nbsp;<span class="ident" id="2391609">cmsgAlignOf</span><span class="op" id="2391620">(</span><span class="builtintype" id="2391621">int</span><span class="op" id="2391624">(</span><span class="ident" id="2391625">h</span><span class="op" id="2391626">.</span><span class="ident" id="2391627">Len</span><span class="op" id="2391630">)</span><span class="op" id="2391631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2391634">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391637">return</span>&nbsp;<span class="ident" id="2391644">msgs</span><span class="op" id="2391648">,</span>&nbsp;<span class="ident" id="2391650">nil</span><br>
<span class="lineno"></span><span class="op" id="2391654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2391657">func</span>&nbsp;<span class="ident" id="2391662">socketControlMessageHeaderAndData</span><span class="op" id="2391695">(</span><span class="ident" id="2391696">b</span>&nbsp;<span class="op" id="2391698">[</span><span class="op" id="2391699">]</span><span class="builtintype" id="2391700">byte</span><span class="op" id="2391704">)</span>&nbsp;<span class="op" id="2391706">(</span><span class="op" id="2391707">*</span><span class="ident" id="2391708">Cmsghdr</span><span class="op" id="2391715">,</span>&nbsp;<span class="op" id="2391717">[</span><span class="op" id="2391718">]</span><span class="builtintype" id="2391719">byte</span><span class="op" id="2391723">,</span>&nbsp;<span class="builtintype" id="2391725">error</span><span class="op" id="2391730">)</span>&nbsp;<span class="op" id="2391732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391735">h</span>&nbsp;<span class="op" id="2391737">:=</span>&nbsp;<span class="op" id="2391740">(</span><span class="op" id="2391741">*</span><span class="ident" id="2391742">Cmsghdr</span><span class="op" id="2391749">)</span><span class="op" id="2391750">(</span><span class="ident" id="2391751">unsafe</span><span class="op" id="2391757">.</span><span class="ident" id="2391758">Pointer</span><span class="op" id="2391765">(</span><span class="op" id="2391766">&amp;</span><span class="ident" id="2391767">b</span><span class="op" id="2391768">[</span><span class="num" id="2391769">0</span><span class="op" id="2391770">]</span><span class="op" id="2391771">)</span><span class="op" id="2391772">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391775">if</span>&nbsp;<span class="ident" id="2391778">h</span><span class="op" id="2391779">.</span><span class="ident" id="2391780">Len</span>&nbsp;<span class="op" id="2391784">&lt;</span>&nbsp;<span class="ident" id="2391786">SizeofCmsghdr</span>&nbsp;<span class="op" id="2391800">||</span>&nbsp;<span class="builtintype" id="2391803">int</span><span class="op" id="2391806">(</span><span class="ident" id="2391807">h</span><span class="op" id="2391808">.</span><span class="ident" id="2391809">Len</span><span class="op" id="2391812">)</span>&nbsp;<span class="op" id="2391814">&gt;</span>&nbsp;<span class="builtinfunc" id="2391816">len</span><span class="op" id="2391819">(</span><span class="ident" id="2391820">b</span><span class="op" id="2391821">)</span>&nbsp;<span class="op" id="2391823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391827">return</span>&nbsp;<span class="ident" id="2391834">nil</span><span class="op" id="2391837">,</span>&nbsp;<span class="ident" id="2391839">nil</span><span class="op" id="2391842">,</span>&nbsp;<span class="ident" id="2391844">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2391852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391855">return</span>&nbsp;<span class="ident" id="2391862">h</span><span class="op" id="2391863">,</span>&nbsp;<span class="ident" id="2391865">b</span><span class="op" id="2391866">[</span><span class="ident" id="2391867">cmsgAlignOf</span><span class="op" id="2391878">(</span><span class="ident" id="2391879">SizeofCmsghdr</span><span class="op" id="2391892">)</span><span class="op" id="2391893">:</span><span class="ident" id="2391894">h</span><span class="op" id="2391895">.</span><span class="ident" id="2391896">Len</span><span class="op" id="2391899">]</span><span class="op" id="2391900">,</span>&nbsp;<span class="ident" id="2391902">nil</span><br>
<span class="lineno"></span><span class="op" id="2391906">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="2391909">//&nbsp;UnixRights&nbsp;encodes&nbsp;a&nbsp;set&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;into&nbsp;a&nbsp;socket</span><br>
<span class="lineno"></span><span class="comment" id="2391976">//&nbsp;control&nbsp;message&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="2392027">func</span>&nbsp;<span class="ident" id="2392032">UnixRights</span><span class="op" id="2392042">(</span><span class="ident" id="2392043">fds</span>&nbsp;<span class="op" id="2392047">...</span><span class="builtintype" id="2392050">int</span><span class="op" id="2392053">)</span>&nbsp;<span class="op" id="2392055">[</span><span class="op" id="2392056">]</span><span class="builtintype" id="2392057">byte</span>&nbsp;<span class="op" id="2392062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392065">datalen</span>&nbsp;<span class="op" id="2392073">:=</span>&nbsp;<span class="builtinfunc" id="2392076">len</span><span class="op" id="2392079">(</span><span class="ident" id="2392080">fds</span><span class="op" id="2392083">)</span>&nbsp;<span class="op" id="2392085">*</span>&nbsp;<span class="num" id="2392087">4</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392090">b</span>&nbsp;<span class="op" id="2392092">:=</span>&nbsp;<span class="builtinfunc" id="2392095">make</span><span class="op" id="2392099">(</span><span class="op" id="2392100">[</span><span class="op" id="2392101">]</span><span class="builtintype" id="2392102">byte</span><span class="op" id="2392106">,</span>&nbsp;<span class="ident" id="2392108">CmsgSpace</span><span class="op" id="2392117">(</span><span class="ident" id="2392118">datalen</span><span class="op" id="2392125">)</span><span class="op" id="2392126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392129">h</span>&nbsp;<span class="op" id="2392131">:=</span>&nbsp;<span class="op" id="2392134">(</span><span class="op" id="2392135">*</span><span class="ident" id="2392136">Cmsghdr</span><span class="op" id="2392143">)</span><span class="op" id="2392144">(</span><span class="ident" id="2392145">unsafe</span><span class="op" id="2392151">.</span><span class="ident" id="2392152">Pointer</span><span class="op" id="2392159">(</span><span class="op" id="2392160">&amp;</span><span class="ident" id="2392161">b</span><span class="op" id="2392162">[</span><span class="num" id="2392163">0</span><span class="op" id="2392164">]</span><span class="op" id="2392165">)</span><span class="op" id="2392166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392169">h</span><span class="op" id="2392170">.</span><span class="ident" id="2392171">Level</span>&nbsp;<span class="op" id="2392177">=</span>&nbsp;<span class="ident" id="2392179">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392191">h</span><span class="op" id="2392192">.</span><span class="ident" id="2392193">Type</span>&nbsp;<span class="op" id="2392198">=</span>&nbsp;<span class="ident" id="2392200">SCM_RIGHTS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392212">h</span><span class="op" id="2392213">.</span><span class="ident" id="2392214">SetLen</span><span class="op" id="2392220">(</span><span class="ident" id="2392221">CmsgLen</span><span class="op" id="2392228">(</span><span class="ident" id="2392229">datalen</span><span class="op" id="2392236">)</span><span class="op" id="2392237">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392240">data</span>&nbsp;<span class="op" id="2392245">:=</span>&nbsp;<span class="builtintype" id="2392248">uintptr</span><span class="op" id="2392255">(</span><span class="ident" id="2392256">cmsgData</span><span class="op" id="2392264">(</span><span class="ident" id="2392265">h</span><span class="op" id="2392266">)</span><span class="op" id="2392267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392270">for</span>&nbsp;<span class="ident" id="2392274">_</span><span class="op" id="2392275">,</span>&nbsp;<span class="ident" id="2392277">fd</span>&nbsp;<span class="op" id="2392280">:=</span>&nbsp;<span class="keyword" id="2392283">range</span>&nbsp;<span class="ident" id="2392289">fds</span>&nbsp;<span class="op" id="2392293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2392297">*</span><span class="op" id="2392298">(</span><span class="op" id="2392299">*</span><span class="builtintype" id="2392300">int32</span><span class="op" id="2392305">)</span><span class="op" id="2392306">(</span><span class="ident" id="2392307">unsafe</span><span class="op" id="2392313">.</span><span class="ident" id="2392314">Pointer</span><span class="op" id="2392321">(</span><span class="ident" id="2392322">data</span><span class="op" id="2392326">)</span><span class="op" id="2392327">)</span>&nbsp;<span class="op" id="2392329">=</span>&nbsp;<span class="builtintype" id="2392331">int32</span><span class="op" id="2392336">(</span><span class="ident" id="2392337">fd</span><span class="op" id="2392339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392343">data</span>&nbsp;<span class="op" id="2392348">+=</span>&nbsp;<span class="num" id="2392351">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2392354">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392357">return</span>&nbsp;<span class="ident" id="2392364">b</span><br>
<span class="lineno"></span><span class="op" id="2392366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2392369">//&nbsp;ParseUnixRights&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2392438">//&nbsp;integer&nbsp;array&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;from&nbsp;another&nbsp;process.</span><br>
<span class="lineno">90</span><span class="keyword" id="2392502">func</span>&nbsp;<span class="ident" id="2392507">ParseUnixRights</span><span class="op" id="2392522">(</span><span class="ident" id="2392523">m</span>&nbsp;<span class="op" id="2392525">*</span><span class="ident" id="2392526">SocketControlMessage</span><span class="op" id="2392546">)</span>&nbsp;<span class="op" id="2392548">(</span><span class="op" id="2392549">[</span><span class="op" id="2392550">]</span><span class="builtintype" id="2392551">int</span><span class="op" id="2392554">,</span>&nbsp;<span class="builtintype" id="2392556">error</span><span class="op" id="2392561">)</span>&nbsp;<span class="op" id="2392563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392566">if</span>&nbsp;<span class="ident" id="2392569">m</span><span class="op" id="2392570">.</span><span class="ident" id="2392571">Header</span><span class="op" id="2392577">.</span><span class="ident" id="2392578">Level</span>&nbsp;<span class="op" id="2392584">!=</span>&nbsp;<span class="ident" id="2392587">SOL_SOCKET</span>&nbsp;<span class="op" id="2392598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392602">return</span>&nbsp;<span class="ident" id="2392609">nil</span><span class="op" id="2392612">,</span>&nbsp;<span class="ident" id="2392614">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2392622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392625">if</span>&nbsp;<span class="ident" id="2392628">m</span><span class="op" id="2392629">.</span><span class="ident" id="2392630">Header</span><span class="op" id="2392636">.</span><span class="ident" id="2392637">Type</span>&nbsp;<span class="op" id="2392642">!=</span>&nbsp;<span class="ident" id="2392645">SCM_RIGHTS</span>&nbsp;<span class="op" id="2392656">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392660">return</span>&nbsp;<span class="ident" id="2392667">nil</span><span class="op" id="2392670">,</span>&nbsp;<span class="ident" id="2392672">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2392680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392683">fds</span>&nbsp;<span class="op" id="2392687">:=</span>&nbsp;<span class="builtinfunc" id="2392690">make</span><span class="op" id="2392694">(</span><span class="op" id="2392695">[</span><span class="op" id="2392696">]</span><span class="builtintype" id="2392697">int</span><span class="op" id="2392700">,</span>&nbsp;<span class="builtinfunc" id="2392702">len</span><span class="op" id="2392705">(</span><span class="ident" id="2392706">m</span><span class="op" id="2392707">.</span><span class="ident" id="2392708">Data</span><span class="op" id="2392712">)</span><span class="op" id="2392713">&gt;&gt;</span><span class="num" id="2392715">2</span><span class="op" id="2392716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392719">for</span>&nbsp;<span class="ident" id="2392723">i</span><span class="op" id="2392724">,</span>&nbsp;<span class="ident" id="2392726">j</span>&nbsp;<span class="op" id="2392728">:=</span>&nbsp;<span class="num" id="2392731">0</span><span class="op" id="2392732">,</span>&nbsp;<span class="num" id="2392734">0</span><span class="op" id="2392735">;</span>&nbsp;<span class="ident" id="2392737">i</span>&nbsp;<span class="op" id="2392739">&lt;</span>&nbsp;<span class="builtinfunc" id="2392741">len</span><span class="op" id="2392744">(</span><span class="ident" id="2392745">m</span><span class="op" id="2392746">.</span><span class="ident" id="2392747">Data</span><span class="op" id="2392751">)</span><span class="op" id="2392752">;</span>&nbsp;<span class="ident" id="2392754">i</span>&nbsp;<span class="op" id="2392756">+=</span>&nbsp;<span class="num" id="2392759">4</span>&nbsp;<span class="op" id="2392761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392765">fds</span><span class="op" id="2392768">[</span><span class="ident" id="2392769">j</span><span class="op" id="2392770">]</span>&nbsp;<span class="op" id="2392772">=</span>&nbsp;<span class="builtintype" id="2392774">int</span><span class="op" id="2392777">(</span><span class="op" id="2392778">*</span><span class="op" id="2392779">(</span><span class="op" id="2392780">*</span><span class="builtintype" id="2392781">int32</span><span class="op" id="2392786">)</span><span class="op" id="2392787">(</span><span class="ident" id="2392788">unsafe</span><span class="op" id="2392794">.</span><span class="ident" id="2392795">Pointer</span><span class="op" id="2392802">(</span><span class="op" id="2392803">&amp;</span><span class="ident" id="2392804">m</span><span class="op" id="2392805">.</span><span class="ident" id="2392806">Data</span><span class="op" id="2392810">[</span><span class="ident" id="2392811">i</span><span class="op" id="2392812">]</span><span class="op" id="2392813">)</span><span class="op" id="2392814">)</span><span class="op" id="2392815">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392819">j</span><span class="op" id="2392820">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2392824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392827">return</span>&nbsp;<span class="ident" id="2392834">fds</span><span class="op" id="2392837">,</span>&nbsp;<span class="ident" id="2392839">nil</span><br>
<span class="lineno"></span><span class="op" id="2392843">}</span>
</div>
</body>
</html>
