<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/signal</h2>
<ul>
<li><a href="/gostd/os/signal/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/signal/signal.go.html" class="current">signal.go</a></li>
<li><a href="/gostd/os/signal/signal_test.go.html">signal_test.go</a></li>
<li><a href="/gostd/os/signal/signal_unix.go.html">signal_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5470737">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5470792">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5470846">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5470897">//&nbsp;Package&nbsp;signal&nbsp;implements&nbsp;access&nbsp;to&nbsp;incoming&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="5470954">package</span>&nbsp;<span class="ident" id="5470962">signal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5470970">//&nbsp;BUG(rsc):&nbsp;This&nbsp;package&nbsp;is&nbsp;not&nbsp;yet&nbsp;implemented&nbsp;on&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5471031">import</span>&nbsp;<span class="op" id="5471038">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5471041">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5471047">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5471054">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5471057">var</span>&nbsp;<span class="ident" id="5471061">handlers</span>&nbsp;<span class="keyword" id="5471070">struct</span>&nbsp;<span class="op" id="5471077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471080">sync</span><span class="op" id="5471084">.</span><span class="ident" id="5471085">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471092">m</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471096">map</span><span class="op" id="5471099">[</span><span class="keyword" id="5471100">chan</span><span class="op" id="5471104">&lt;-</span>&nbsp;<span class="ident" id="5471107">os</span><span class="op" id="5471109">.</span><span class="ident" id="5471110">Signal</span><span class="op" id="5471116">]</span><span class="op" id="5471117">*</span><span class="ident" id="5471118">handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471127">ref</span>&nbsp;<span class="op" id="5471131">[</span><span class="ident" id="5471132">numSig</span><span class="op" id="5471138">]</span><span class="ident" id="5471139">int64</span><br>
<span class="lineno"></span><span class="op" id="5471145">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5471148">type</span>&nbsp;<span class="ident" id="5471153">handler</span>&nbsp;<span class="keyword" id="5471161">struct</span>&nbsp;<span class="op" id="5471168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471171">mask</span>&nbsp;<span class="op" id="5471176">[</span><span class="op" id="5471177">(</span><span class="ident" id="5471178">numSig</span>&nbsp;<span class="op" id="5471185">+</span>&nbsp;<span class="num" id="5471187">31</span><span class="op" id="5471189">)</span>&nbsp;<span class="op" id="5471191">/</span>&nbsp;<span class="num" id="5471193">32</span><span class="op" id="5471195">]</span><span class="builtintype" id="5471196">uint32</span><br>
<span class="lineno"></span><span class="op" id="5471203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5471206">func</span>&nbsp;<span class="op" id="5471211">(</span><span class="ident" id="5471212">h</span>&nbsp;<span class="op" id="5471214">*</span><span class="ident" id="5471215">handler</span><span class="op" id="5471222">)</span>&nbsp;<span class="ident" id="5471224">want</span><span class="op" id="5471228">(</span><span class="ident" id="5471229">sig</span>&nbsp;<span class="builtintype" id="5471233">int</span><span class="op" id="5471236">)</span>&nbsp;<span class="builtintype" id="5471238">bool</span>&nbsp;<span class="op" id="5471243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5471246">return</span>&nbsp;<span class="op" id="5471253">(</span><span class="ident" id="5471254">h</span><span class="op" id="5471255">.</span><span class="ident" id="5471256">mask</span><span class="op" id="5471260">[</span><span class="ident" id="5471261">sig</span><span class="op" id="5471264">/</span><span class="num" id="5471265">32</span><span class="op" id="5471267">]</span><span class="op" id="5471268">&gt;&gt;</span><span class="builtintype" id="5471270">uint</span><span class="op" id="5471274">(</span><span class="ident" id="5471275">sig</span><span class="op" id="5471278">&amp;</span><span class="num" id="5471279">31</span><span class="op" id="5471281">)</span><span class="op" id="5471282">)</span><span class="op" id="5471283">&amp;</span><span class="num" id="5471284">1</span>&nbsp;<span class="op" id="5471286">!=</span>&nbsp;<span class="num" id="5471289">0</span><br>
<span class="lineno"></span><span class="op" id="5471291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5471294">func</span>&nbsp;<span class="op" id="5471299">(</span><span class="ident" id="5471300">h</span>&nbsp;<span class="op" id="5471302">*</span><span class="ident" id="5471303">handler</span><span class="op" id="5471310">)</span>&nbsp;<span class="ident" id="5471312">set</span><span class="op" id="5471315">(</span><span class="ident" id="5471316">sig</span>&nbsp;<span class="builtintype" id="5471320">int</span><span class="op" id="5471323">)</span>&nbsp;<span class="op" id="5471325">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5471328">h</span><span class="op" id="5471329">.</span><span class="ident" id="5471330">mask</span><span class="op" id="5471334">[</span><span class="ident" id="5471335">sig</span><span class="op" id="5471338">/</span><span class="num" id="5471339">32</span><span class="op" id="5471341">]</span>&nbsp;<span class="op" id="5471343">|=</span>&nbsp;<span class="num" id="5471346">1</span>&nbsp;<span class="op" id="5471348">&lt;&lt;</span>&nbsp;<span class="builtintype" id="5471351">uint</span><span class="op" id="5471355">(</span><span class="ident" id="5471356">sig</span><span class="op" id="5471359">&amp;</span><span class="num" id="5471360">31</span><span class="op" id="5471362">)</span><br>
<span class="lineno"></span><span class="op" id="5471364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5471367">//&nbsp;Notify&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;relay&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5471431">//&nbsp;If&nbsp;no&nbsp;signals&nbsp;are&nbsp;listed,&nbsp;all&nbsp;incoming&nbsp;signals&nbsp;will&nbsp;be&nbsp;relayed&nbsp;to&nbsp;c.</span><br>
<span class="lineno">35</span><span class="comment" id="5471503">//&nbsp;Otherwise,&nbsp;just&nbsp;the&nbsp;listed&nbsp;signals&nbsp;will.</span><br>
<span class="lineno"></span><span class="comment" id="5471547">//</span><br>
<span class="lineno"></span><span class="comment" id="5471550">//&nbsp;Package&nbsp;signal&nbsp;will&nbsp;not&nbsp;block&nbsp;sending&nbsp;to&nbsp;c:&nbsp;the&nbsp;caller&nbsp;must&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="5471620">//&nbsp;that&nbsp;c&nbsp;has&nbsp;sufficient&nbsp;buffer&nbsp;space&nbsp;to&nbsp;keep&nbsp;up&nbsp;with&nbsp;the&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="5471687">//&nbsp;signal&nbsp;rate.&nbsp;&nbsp;For&nbsp;a&nbsp;channel&nbsp;used&nbsp;for&nbsp;notification&nbsp;of&nbsp;just&nbsp;one&nbsp;signal&nbsp;value,</span><br>
<span class="lineno">40</span><span class="comment" id="5471766">//&nbsp;a&nbsp;buffer&nbsp;of&nbsp;size&nbsp;1&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="comment" id="5471803">//</span><br>
<span class="lineno"></span><span class="comment" id="5471806">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;the&nbsp;same&nbsp;channel:</span><br>
<span class="lineno"></span><span class="comment" id="5471876">//&nbsp;each&nbsp;call&nbsp;expands&nbsp;the&nbsp;set&nbsp;of&nbsp;signals&nbsp;sent&nbsp;to&nbsp;that&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="5471938">//&nbsp;The&nbsp;only&nbsp;way&nbsp;to&nbsp;remove&nbsp;signals&nbsp;from&nbsp;the&nbsp;set&nbsp;is&nbsp;to&nbsp;call&nbsp;Stop.</span><br>
<span class="lineno">45</span><span class="comment" id="5472002">//</span><br>
<span class="lineno"></span><span class="comment" id="5472005">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;different&nbsp;channels</span><br>
<span class="lineno"></span><span class="comment" id="5472076">//&nbsp;and&nbsp;the&nbsp;same&nbsp;signals:&nbsp;each&nbsp;channel&nbsp;receives&nbsp;copies&nbsp;of&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5472142">//&nbsp;signals&nbsp;independently.</span><br>
<span class="lineno"></span><span class="keyword" id="5472168">func</span>&nbsp;<span class="ident" id="5472173">Notify</span><span class="op" id="5472179">(</span><span class="ident" id="5472180">c</span>&nbsp;<span class="keyword" id="5472182">chan</span><span class="op" id="5472186">&lt;-</span>&nbsp;<span class="ident" id="5472189">os</span><span class="op" id="5472191">.</span><span class="ident" id="5472192">Signal</span><span class="op" id="5472198">,</span>&nbsp;<span class="ident" id="5472200">sig</span>&nbsp;<span class="op" id="5472204">...</span><span class="ident" id="5472207">os</span><span class="op" id="5472209">.</span><span class="ident" id="5472210">Signal</span><span class="op" id="5472216">)</span>&nbsp;<span class="op" id="5472218">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472221">if</span>&nbsp;<span class="ident" id="5472224">c</span>&nbsp;<span class="op" id="5472226">==</span>&nbsp;<span class="builtintype" id="5472229">nil</span>&nbsp;<span class="op" id="5472233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5472237">panic</span><span class="op" id="5472242">(</span><span class="string" id="5472243">&#34;os/signal:&nbsp;Notify&nbsp;using&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="5472280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472287">handlers</span><span class="op" id="5472295">.</span><span class="ident" id="5472296">Lock</span><span class="op" id="5472300">(</span><span class="op" id="5472301">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472304">defer</span>&nbsp;<span class="ident" id="5472310">handlers</span><span class="op" id="5472318">.</span><span class="ident" id="5472319">Unlock</span><span class="op" id="5472325">(</span><span class="op" id="5472326">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472330">h</span>&nbsp;<span class="op" id="5472332">:=</span>&nbsp;<span class="ident" id="5472335">handlers</span><span class="op" id="5472343">.</span><span class="ident" id="5472344">m</span><span class="op" id="5472345">[</span><span class="ident" id="5472346">c</span><span class="op" id="5472347">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472350">if</span>&nbsp;<span class="ident" id="5472353">h</span>&nbsp;<span class="op" id="5472355">==</span>&nbsp;<span class="builtintype" id="5472358">nil</span>&nbsp;<span class="op" id="5472362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472366">if</span>&nbsp;<span class="ident" id="5472369">handlers</span><span class="op" id="5472377">.</span><span class="ident" id="5472378">m</span>&nbsp;<span class="op" id="5472380">==</span>&nbsp;<span class="builtintype" id="5472383">nil</span>&nbsp;<span class="op" id="5472387">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472392">handlers</span><span class="op" id="5472400">.</span><span class="ident" id="5472401">m</span>&nbsp;<span class="op" id="5472403">=</span>&nbsp;<span class="builtinfunc" id="5472405">make</span><span class="op" id="5472409">(</span><span class="keyword" id="5472410">map</span><span class="op" id="5472413">[</span><span class="keyword" id="5472414">chan</span><span class="op" id="5472418">&lt;-</span>&nbsp;<span class="ident" id="5472421">os</span><span class="op" id="5472423">.</span><span class="ident" id="5472424">Signal</span><span class="op" id="5472430">]</span><span class="op" id="5472431">*</span><span class="ident" id="5472432">handler</span><span class="op" id="5472439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472447">h</span>&nbsp;<span class="op" id="5472449">=</span>&nbsp;<span class="builtinfunc" id="5472451">new</span><span class="op" id="5472454">(</span><span class="ident" id="5472455">handler</span><span class="op" id="5472462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472466">handlers</span><span class="op" id="5472474">.</span><span class="ident" id="5472475">m</span><span class="op" id="5472476">[</span><span class="ident" id="5472477">c</span><span class="op" id="5472478">]</span>&nbsp;<span class="op" id="5472480">=</span>&nbsp;<span class="ident" id="5472482">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472485">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472489">add</span>&nbsp;<span class="op" id="5472493">:=</span>&nbsp;<span class="keyword" id="5472496">func</span><span class="op" id="5472500">(</span><span class="ident" id="5472501">n</span>&nbsp;<span class="builtintype" id="5472503">int</span><span class="op" id="5472506">)</span>&nbsp;<span class="op" id="5472508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472512">if</span>&nbsp;<span class="ident" id="5472515">n</span>&nbsp;<span class="op" id="5472517">&lt;</span>&nbsp;<span class="num" id="5472519">0</span>&nbsp;<span class="op" id="5472521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472526">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472535">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472539">if</span>&nbsp;<span class="op" id="5472542">!</span><span class="ident" id="5472543">h</span><span class="op" id="5472544">.</span><span class="ident" id="5472545">want</span><span class="op" id="5472549">(</span><span class="ident" id="5472550">n</span><span class="op" id="5472551">)</span>&nbsp;<span class="op" id="5472553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472558">h</span><span class="op" id="5472559">.</span><span class="ident" id="5472560">set</span><span class="op" id="5472563">(</span><span class="ident" id="5472564">n</span><span class="op" id="5472565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472570">if</span>&nbsp;<span class="ident" id="5472573">handlers</span><span class="op" id="5472581">.</span><span class="ident" id="5472582">ref</span><span class="op" id="5472585">[</span><span class="ident" id="5472586">n</span><span class="op" id="5472587">]</span>&nbsp;<span class="op" id="5472589">==</span>&nbsp;<span class="num" id="5472592">0</span>&nbsp;<span class="op" id="5472594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472600">enableSignal</span><span class="op" id="5472612">(</span><span class="ident" id="5472613">n</span><span class="op" id="5472614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472619">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472624">handlers</span><span class="op" id="5472632">.</span><span class="ident" id="5472633">ref</span><span class="op" id="5472636">[</span><span class="ident" id="5472637">n</span><span class="op" id="5472638">]</span><span class="op" id="5472639">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472651">if</span>&nbsp;<span class="builtinfunc" id="5472654">len</span><span class="op" id="5472657">(</span><span class="ident" id="5472658">sig</span><span class="op" id="5472661">)</span>&nbsp;<span class="op" id="5472663">==</span>&nbsp;<span class="num" id="5472666">0</span>&nbsp;<span class="op" id="5472668">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472672">for</span>&nbsp;<span class="ident" id="5472676">n</span>&nbsp;<span class="op" id="5472678">:=</span>&nbsp;<span class="num" id="5472681">0</span><span class="op" id="5472682">;</span>&nbsp;<span class="ident" id="5472684">n</span>&nbsp;<span class="op" id="5472686">&lt;</span>&nbsp;<span class="ident" id="5472688">numSig</span><span class="op" id="5472694">;</span>&nbsp;<span class="ident" id="5472696">n</span><span class="op" id="5472697">++</span>&nbsp;<span class="op" id="5472700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472705">add</span><span class="op" id="5472708">(</span><span class="ident" id="5472709">n</span><span class="op" id="5472710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472717">}</span>&nbsp;<span class="keyword" id="5472719">else</span>&nbsp;<span class="op" id="5472724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5472728">for</span>&nbsp;<span class="ident" id="5472732">_</span><span class="op" id="5472733">,</span>&nbsp;<span class="ident" id="5472735">s</span>&nbsp;<span class="op" id="5472737">:=</span>&nbsp;<span class="keyword" id="5472740">range</span>&nbsp;<span class="ident" id="5472746">sig</span>&nbsp;<span class="op" id="5472750">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5472755">add</span><span class="op" id="5472758">(</span><span class="ident" id="5472759">signum</span><span class="op" id="5472765">(</span><span class="ident" id="5472766">s</span><span class="op" id="5472767">)</span><span class="op" id="5472768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5472775">}</span><br>
<span class="lineno"></span><span class="op" id="5472777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5472780">//&nbsp;Stop&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;stop&nbsp;relaying&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5472850">//&nbsp;It&nbsp;undoes&nbsp;the&nbsp;effect&nbsp;of&nbsp;all&nbsp;prior&nbsp;calls&nbsp;to&nbsp;Notify&nbsp;using&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5472912">//&nbsp;When&nbsp;Stop&nbsp;returns,&nbsp;it&nbsp;is&nbsp;guaranteed&nbsp;that&nbsp;c&nbsp;will&nbsp;receive&nbsp;no&nbsp;more&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="5472988">func</span>&nbsp;<span class="ident" id="5472993">Stop</span><span class="op" id="5472997">(</span><span class="ident" id="5472998">c</span>&nbsp;<span class="keyword" id="5473000">chan</span><span class="op" id="5473004">&lt;-</span>&nbsp;<span class="ident" id="5473007">os</span><span class="op" id="5473009">.</span><span class="ident" id="5473010">Signal</span><span class="op" id="5473016">)</span>&nbsp;<span class="op" id="5473018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473021">handlers</span><span class="op" id="5473029">.</span><span class="ident" id="5473030">Lock</span><span class="op" id="5473034">(</span><span class="op" id="5473035">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473038">defer</span>&nbsp;<span class="ident" id="5473044">handlers</span><span class="op" id="5473052">.</span><span class="ident" id="5473053">Unlock</span><span class="op" id="5473059">(</span><span class="op" id="5473060">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473064">h</span>&nbsp;<span class="op" id="5473066">:=</span>&nbsp;<span class="ident" id="5473069">handlers</span><span class="op" id="5473077">.</span><span class="ident" id="5473078">m</span><span class="op" id="5473079">[</span><span class="ident" id="5473080">c</span><span class="op" id="5473081">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473084">if</span>&nbsp;<span class="ident" id="5473087">h</span>&nbsp;<span class="op" id="5473089">==</span>&nbsp;<span class="builtintype" id="5473092">nil</span>&nbsp;<span class="op" id="5473096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473100">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5473111">delete</span><span class="op" id="5473117">(</span><span class="ident" id="5473118">handlers</span><span class="op" id="5473126">.</span><span class="ident" id="5473127">m</span><span class="op" id="5473128">,</span>&nbsp;<span class="ident" id="5473130">c</span><span class="op" id="5473131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473135">for</span>&nbsp;<span class="ident" id="5473139">n</span>&nbsp;<span class="op" id="5473141">:=</span>&nbsp;<span class="num" id="5473144">0</span><span class="op" id="5473145">;</span>&nbsp;<span class="ident" id="5473147">n</span>&nbsp;<span class="op" id="5473149">&lt;</span>&nbsp;<span class="ident" id="5473151">numSig</span><span class="op" id="5473157">;</span>&nbsp;<span class="ident" id="5473159">n</span><span class="op" id="5473160">++</span>&nbsp;<span class="op" id="5473163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473167">if</span>&nbsp;<span class="ident" id="5473170">h</span><span class="op" id="5473171">.</span><span class="ident" id="5473172">want</span><span class="op" id="5473176">(</span><span class="ident" id="5473177">n</span><span class="op" id="5473178">)</span>&nbsp;<span class="op" id="5473180">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473185">handlers</span><span class="op" id="5473193">.</span><span class="ident" id="5473194">ref</span><span class="op" id="5473197">[</span><span class="ident" id="5473198">n</span><span class="op" id="5473199">]</span><span class="op" id="5473200">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473206">if</span>&nbsp;<span class="ident" id="5473209">handlers</span><span class="op" id="5473217">.</span><span class="ident" id="5473218">ref</span><span class="op" id="5473221">[</span><span class="ident" id="5473222">n</span><span class="op" id="5473223">]</span>&nbsp;<span class="op" id="5473225">==</span>&nbsp;<span class="num" id="5473228">0</span>&nbsp;<span class="op" id="5473230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473236">disableSignal</span><span class="op" id="5473249">(</span><span class="ident" id="5473250">n</span><span class="op" id="5473251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473260">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473263">}</span><br>
<span class="lineno"></span><span class="op" id="5473265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5473268">func</span>&nbsp;<span class="ident" id="5473273">process</span><span class="op" id="5473280">(</span><span class="ident" id="5473281">sig</span>&nbsp;<span class="ident" id="5473285">os</span><span class="op" id="5473287">.</span><span class="ident" id="5473288">Signal</span><span class="op" id="5473294">)</span>&nbsp;<span class="op" id="5473296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473299">n</span>&nbsp;<span class="op" id="5473301">:=</span>&nbsp;<span class="ident" id="5473304">signum</span><span class="op" id="5473310">(</span><span class="ident" id="5473311">sig</span><span class="op" id="5473314">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473317">if</span>&nbsp;<span class="ident" id="5473320">n</span>&nbsp;<span class="op" id="5473322">&lt;</span>&nbsp;<span class="num" id="5473324">0</span>&nbsp;<span class="op" id="5473326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473330">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5473342">handlers</span><span class="op" id="5473350">.</span><span class="ident" id="5473351">Lock</span><span class="op" id="5473355">(</span><span class="op" id="5473356">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473359">defer</span>&nbsp;<span class="ident" id="5473365">handlers</span><span class="op" id="5473373">.</span><span class="ident" id="5473374">Unlock</span><span class="op" id="5473380">(</span><span class="op" id="5473381">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473385">for</span>&nbsp;<span class="ident" id="5473389">c</span><span class="op" id="5473390">,</span>&nbsp;<span class="ident" id="5473392">h</span>&nbsp;<span class="op" id="5473394">:=</span>&nbsp;<span class="keyword" id="5473397">range</span>&nbsp;<span class="ident" id="5473403">handlers</span><span class="op" id="5473411">.</span><span class="ident" id="5473412">m</span>&nbsp;<span class="op" id="5473414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473418">if</span>&nbsp;<span class="ident" id="5473421">h</span><span class="op" id="5473422">.</span><span class="ident" id="5473423">want</span><span class="op" id="5473427">(</span><span class="ident" id="5473428">n</span><span class="op" id="5473429">)</span>&nbsp;<span class="op" id="5473431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5473436">//&nbsp;send&nbsp;but&nbsp;do&nbsp;not&nbsp;block&nbsp;for&nbsp;it</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473471">select</span>&nbsp;<span class="op" id="5473478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473483">case</span>&nbsp;<span class="ident" id="5473488">c</span>&nbsp;<span class="op" id="5473490">&lt;-</span>&nbsp;<span class="ident" id="5473493">sig</span><span class="op" id="5473496">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5473501">default</span><span class="op" id="5473508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473517">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5473520">}</span><br>
<span class="lineno"></span><span class="op" id="5473522">}</span>
</div>
</body>
</html>
