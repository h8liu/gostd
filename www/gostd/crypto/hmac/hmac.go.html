<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/hmac</h2>
<ul>
<li><a href="/gostd/crypto/hmac/hmac.go.html" class="current">hmac.go</a></li>
<li><a href="/gostd/crypto/hmac/hmac_test.go.html">hmac_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4663264">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4663319">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4663373">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4663424">/*<br>
<span class="lineno"></span>Package&nbsp;hmac&nbsp;implements&nbsp;the&nbsp;Keyed-Hash&nbsp;Message&nbsp;Authentication&nbsp;Code&nbsp;(HMAC)&nbsp;as<br>
<span class="lineno"></span>defined&nbsp;in&nbsp;U.S.&nbsp;Federal&nbsp;Information&nbsp;Processing&nbsp;Standards&nbsp;Publication&nbsp;198.<br>
<span class="lineno"></span>An&nbsp;HMAC&nbsp;is&nbsp;a&nbsp;cryptographic&nbsp;hash&nbsp;that&nbsp;uses&nbsp;a&nbsp;key&nbsp;to&nbsp;sign&nbsp;a&nbsp;message.<br>
<span class="lineno"></span>The&nbsp;receiver&nbsp;verifies&nbsp;the&nbsp;hash&nbsp;by&nbsp;recomputing&nbsp;it&nbsp;using&nbsp;the&nbsp;same&nbsp;key.<br>
<span class="lineno">10</span><br>
<span class="lineno"></span>Receivers&nbsp;should&nbsp;be&nbsp;careful&nbsp;to&nbsp;use&nbsp;Equal&nbsp;to&nbsp;compare&nbsp;MACs&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid<br>
<span class="lineno"></span>timing&nbsp;side-channels:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;CheckMAC&nbsp;returns&nbsp;true&nbsp;if&nbsp;messageMAC&nbsp;is&nbsp;a&nbsp;valid&nbsp;HMAC&nbsp;tag&nbsp;for&nbsp;message.<br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;CheckMAC(message,&nbsp;messageMAC,&nbsp;key&nbsp;[]byte)&nbsp;bool&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac&nbsp;:=&nbsp;hmac.New(sha256.New,&nbsp;key)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac.Write(message)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspexpectedMAC&nbsp;:=&nbsp;mac.Sum(nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;hmac.Equal(messageMAC,&nbsp;expectedMAC)<br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="4664078">package</span>&nbsp;<span class="ident" id="4664086">hmac</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4664092">import</span>&nbsp;<span class="op" id="4664099">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4664102">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4664119">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4664126">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4664129">//&nbsp;FIPS&nbsp;198:</span><br>
<span class="lineno">30</span><span class="comment" id="4664142">//&nbsp;http://csrc.nist.gov/publications/fips/fips198/fips-198a.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4664207">//&nbsp;key&nbsp;is&nbsp;zero&nbsp;padded&nbsp;to&nbsp;the&nbsp;block&nbsp;size&nbsp;of&nbsp;the&nbsp;hash&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4664268">//&nbsp;ipad&nbsp;=&nbsp;0x36&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno"></span><span class="comment" id="4664312">//&nbsp;opad&nbsp;=&nbsp;0x5c&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno">35</span><span class="comment" id="4664356">//&nbsp;hmac&nbsp;=&nbsp;H([key&nbsp;^&nbsp;opad]&nbsp;H([key&nbsp;^&nbsp;ipad]&nbsp;text))</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4664404">type</span>&nbsp;<span class="ident" id="4664409">hmac</span>&nbsp;<span class="keyword" id="4664414">struct</span>&nbsp;<span class="op" id="4664421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4664424">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4664437">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4664442">blocksize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4664455">int</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4664460">key</span><span class="op" id="4664463">,</span>&nbsp;<span class="ident" id="4664465">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4664473">[</span><span class="op" id="4664474">]</span><span class="builtintype" id="4664475">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4664481">outer</span><span class="op" id="4664486">,</span>&nbsp;<span class="ident" id="4664488">inner</span>&nbsp;<span class="ident" id="4664494">hash</span><span class="op" id="4664498">.</span><span class="ident" id="4664499">Hash</span><br>
<span class="lineno"></span><span class="op" id="4664504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4664507">func</span>&nbsp;<span class="op" id="4664512">(</span><span class="ident" id="4664513">h</span>&nbsp;<span class="op" id="4664515">*</span><span class="ident" id="4664516">hmac</span><span class="op" id="4664520">)</span>&nbsp;<span class="ident" id="4664522">tmpPad</span><span class="op" id="4664528">(</span><span class="ident" id="4664529">xor</span>&nbsp;<span class="builtintype" id="4664533">byte</span><span class="op" id="4664537">)</span>&nbsp;<span class="op" id="4664539">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4664542">for</span>&nbsp;<span class="ident" id="4664546">i</span><span class="op" id="4664547">,</span>&nbsp;<span class="ident" id="4664549">k</span>&nbsp;<span class="op" id="4664551">:=</span>&nbsp;<span class="keyword" id="4664554">range</span>&nbsp;<span class="ident" id="4664560">h</span><span class="op" id="4664561">.</span><span class="ident" id="4664562">key</span>&nbsp;<span class="op" id="4664566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4664570">h</span><span class="op" id="4664571">.</span><span class="ident" id="4664572">tmp</span><span class="op" id="4664575">[</span><span class="ident" id="4664576">i</span><span class="op" id="4664577">]</span>&nbsp;<span class="op" id="4664579">=</span>&nbsp;<span class="ident" id="4664581">xor</span>&nbsp;<span class="op" id="4664585">^</span>&nbsp;<span class="ident" id="4664587">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4664590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4664593">for</span>&nbsp;<span class="ident" id="4664597">i</span>&nbsp;<span class="op" id="4664599">:=</span>&nbsp;<span class="builtinfunc" id="4664602">len</span><span class="op" id="4664605">(</span><span class="ident" id="4664606">h</span><span class="op" id="4664607">.</span><span class="ident" id="4664608">key</span><span class="op" id="4664611">)</span><span class="op" id="4664612">;</span>&nbsp;<span class="ident" id="4664614">i</span>&nbsp;<span class="op" id="4664616">&lt;</span>&nbsp;<span class="ident" id="4664618">h</span><span class="op" id="4664619">.</span><span class="ident" id="4664620">blocksize</span><span class="op" id="4664629">;</span>&nbsp;<span class="ident" id="4664631">i</span><span class="op" id="4664632">++</span>&nbsp;<span class="op" id="4664635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4664639">h</span><span class="op" id="4664640">.</span><span class="ident" id="4664641">tmp</span><span class="op" id="4664644">[</span><span class="ident" id="4664645">i</span><span class="op" id="4664646">]</span>&nbsp;<span class="op" id="4664648">=</span>&nbsp;<span class="ident" id="4664650">xor</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4664655">}</span><br>
<span class="lineno"></span><span class="op" id="4664657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4664660">func</span>&nbsp;<span class="op" id="4664665">(</span><span class="ident" id="4664666">h</span>&nbsp;<span class="op" id="4664668">*</span><span class="ident" id="4664669">hmac</span><span class="op" id="4664673">)</span>&nbsp;<span class="ident" id="4664675">Sum</span><span class="op" id="4664678">(</span><span class="ident" id="4664679">in</span>&nbsp;<span class="op" id="4664682">[</span><span class="op" id="4664683">]</span><span class="builtintype" id="4664684">byte</span><span class="op" id="4664688">)</span>&nbsp;<span class="op" id="4664690">[</span><span class="op" id="4664691">]</span><span class="builtintype" id="4664692">byte</span>&nbsp;<span class="op" id="4664697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4664700">origLen</span>&nbsp;<span class="op" id="4664708">:=</span>&nbsp;<span class="builtinfunc" id="4664711">len</span><span class="op" id="4664714">(</span><span class="ident" id="4664715">in</span><span class="op" id="4664717">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4664720">in</span>&nbsp;<span class="op" id="4664723">=</span>&nbsp;<span class="ident" id="4664725">h</span><span class="op" id="4664726">.</span><span class="ident" id="4664727">inner</span><span class="op" id="4664732">.</span><span class="ident" id="4664733">Sum</span><span class="op" id="4664736">(</span><span class="ident" id="4664737">in</span><span class="op" id="4664739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4664742">h</span><span class="op" id="4664743">.</span><span class="ident" id="4664744">tmpPad</span><span class="op" id="4664750">(</span><span class="num" id="4664751">0x5c</span><span class="op" id="4664755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4664758">copy</span><span class="op" id="4664762">(</span><span class="ident" id="4664763">h</span><span class="op" id="4664764">.</span><span class="ident" id="4664765">tmp</span><span class="op" id="4664768">[</span><span class="ident" id="4664769">h</span><span class="op" id="4664770">.</span><span class="ident" id="4664771">blocksize</span><span class="op" id="4664780">:</span><span class="op" id="4664781">]</span><span class="op" id="4664782">,</span>&nbsp;<span class="ident" id="4664784">in</span><span class="op" id="4664786">[</span><span class="ident" id="4664787">origLen</span><span class="op" id="4664794">:</span><span class="op" id="4664795">]</span><span class="op" id="4664796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4664799">h</span><span class="op" id="4664800">.</span><span class="ident" id="4664801">outer</span><span class="op" id="4664806">.</span><span class="ident" id="4664807">Reset</span><span class="op" id="4664812">(</span><span class="op" id="4664813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4664816">h</span><span class="op" id="4664817">.</span><span class="ident" id="4664818">outer</span><span class="op" id="4664823">.</span><span class="ident" id="4664824">Write</span><span class="op" id="4664829">(</span><span class="ident" id="4664830">h</span><span class="op" id="4664831">.</span><span class="ident" id="4664832">tmp</span><span class="op" id="4664835">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4664838">return</span>&nbsp;<span class="ident" id="4664845">h</span><span class="op" id="4664846">.</span><span class="ident" id="4664847">outer</span><span class="op" id="4664852">.</span><span class="ident" id="4664853">Sum</span><span class="op" id="4664856">(</span><span class="ident" id="4664857">in</span><span class="op" id="4664859">[</span><span class="op" id="4664860">:</span><span class="ident" id="4664861">origLen</span><span class="op" id="4664868">]</span><span class="op" id="4664869">)</span><br>
<span class="lineno"></span><span class="op" id="4664871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4664874">func</span>&nbsp;<span class="op" id="4664879">(</span><span class="ident" id="4664880">h</span>&nbsp;<span class="op" id="4664882">*</span><span class="ident" id="4664883">hmac</span><span class="op" id="4664887">)</span>&nbsp;<span class="ident" id="4664889">Write</span><span class="op" id="4664894">(</span><span class="ident" id="4664895">p</span>&nbsp;<span class="op" id="4664897">[</span><span class="op" id="4664898">]</span><span class="builtintype" id="4664899">byte</span><span class="op" id="4664903">)</span>&nbsp;<span class="op" id="4664905">(</span><span class="ident" id="4664906">n</span>&nbsp;<span class="builtintype" id="4664908">int</span><span class="op" id="4664911">,</span>&nbsp;<span class="ident" id="4664913">err</span>&nbsp;<span class="builtintype" id="4664917">error</span><span class="op" id="4664922">)</span>&nbsp;<span class="op" id="4664924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4664927">return</span>&nbsp;<span class="ident" id="4664934">h</span><span class="op" id="4664935">.</span><span class="ident" id="4664936">inner</span><span class="op" id="4664941">.</span><span class="ident" id="4664942">Write</span><span class="op" id="4664947">(</span><span class="ident" id="4664948">p</span><span class="op" id="4664949">)</span><br>
<span class="lineno">65</span><span class="op" id="4664951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4664954">func</span>&nbsp;<span class="op" id="4664959">(</span><span class="ident" id="4664960">h</span>&nbsp;<span class="op" id="4664962">*</span><span class="ident" id="4664963">hmac</span><span class="op" id="4664967">)</span>&nbsp;<span class="ident" id="4664969">Size</span><span class="op" id="4664973">(</span><span class="op" id="4664974">)</span>&nbsp;<span class="builtintype" id="4664976">int</span>&nbsp;<span class="op" id="4664980">{</span>&nbsp;<span class="keyword" id="4664982">return</span>&nbsp;<span class="ident" id="4664989">h</span><span class="op" id="4664990">.</span><span class="ident" id="4664991">size</span>&nbsp;<span class="op" id="4664996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4664999">func</span>&nbsp;<span class="op" id="4665004">(</span><span class="ident" id="4665005">h</span>&nbsp;<span class="op" id="4665007">*</span><span class="ident" id="4665008">hmac</span><span class="op" id="4665012">)</span>&nbsp;<span class="ident" id="4665014">BlockSize</span><span class="op" id="4665023">(</span><span class="op" id="4665024">)</span>&nbsp;<span class="builtintype" id="4665026">int</span>&nbsp;<span class="op" id="4665030">{</span>&nbsp;<span class="keyword" id="4665032">return</span>&nbsp;<span class="ident" id="4665039">h</span><span class="op" id="4665040">.</span><span class="ident" id="4665041">blocksize</span>&nbsp;<span class="op" id="4665051">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4665054">func</span>&nbsp;<span class="op" id="4665059">(</span><span class="ident" id="4665060">h</span>&nbsp;<span class="op" id="4665062">*</span><span class="ident" id="4665063">hmac</span><span class="op" id="4665067">)</span>&nbsp;<span class="ident" id="4665069">Reset</span><span class="op" id="4665074">(</span><span class="op" id="4665075">)</span>&nbsp;<span class="op" id="4665077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4665080">h</span><span class="op" id="4665081">.</span><span class="ident" id="4665082">inner</span><span class="op" id="4665087">.</span><span class="ident" id="4665088">Reset</span><span class="op" id="4665093">(</span><span class="op" id="4665094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4665097">h</span><span class="op" id="4665098">.</span><span class="ident" id="4665099">tmpPad</span><span class="op" id="4665105">(</span><span class="num" id="4665106">0x36</span><span class="op" id="4665110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4665113">h</span><span class="op" id="4665114">.</span><span class="ident" id="4665115">inner</span><span class="op" id="4665120">.</span><span class="ident" id="4665121">Write</span><span class="op" id="4665126">(</span><span class="ident" id="4665127">h</span><span class="op" id="4665128">.</span><span class="ident" id="4665129">tmp</span><span class="op" id="4665132">[</span><span class="op" id="4665133">:</span><span class="ident" id="4665134">h</span><span class="op" id="4665135">.</span><span class="ident" id="4665136">blocksize</span><span class="op" id="4665145">]</span><span class="op" id="4665146">)</span><br>
<span class="lineno">75</span><span class="op" id="4665148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4665151">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;HMAC&nbsp;hash&nbsp;using&nbsp;the&nbsp;given&nbsp;hash.Hash&nbsp;type&nbsp;and&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4665222">func</span>&nbsp;<span class="ident" id="4665227">New</span><span class="op" id="4665230">(</span><span class="ident" id="4665231">h</span>&nbsp;<span class="keyword" id="4665233">func</span><span class="op" id="4665237">(</span><span class="op" id="4665238">)</span>&nbsp;<span class="ident" id="4665240">hash</span><span class="op" id="4665244">.</span><span class="ident" id="4665245">Hash</span><span class="op" id="4665249">,</span>&nbsp;<span class="ident" id="4665251">key</span>&nbsp;<span class="op" id="4665255">[</span><span class="op" id="4665256">]</span><span class="builtintype" id="4665257">byte</span><span class="op" id="4665261">)</span>&nbsp;<span class="ident" id="4665263">hash</span><span class="op" id="4665267">.</span><span class="ident" id="4665268">Hash</span>&nbsp;<span class="op" id="4665273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4665276">hm</span>&nbsp;<span class="op" id="4665279">:=</span>&nbsp;<span class="builtinfunc" id="4665282">new</span><span class="op" id="4665285">(</span><span class="ident" id="4665286">hmac</span><span class="op" id="4665290">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4665293">hm</span><span class="op" id="4665295">.</span><span class="ident" id="4665296">outer</span>&nbsp;<span class="op" id="4665302">=</span>&nbsp;<span class="ident" id="4665304">h</span><span class="op" id="4665305">(</span><span class="op" id="4665306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4665309">hm</span><span class="op" id="4665311">.</span><span class="ident" id="4665312">inner</span>&nbsp;<span class="op" id="4665318">=</span>&nbsp;<span class="ident" id="4665320">h</span><span class="op" id="4665321">(</span><span class="op" id="4665322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4665325">hm</span><span class="op" id="4665327">.</span><span class="ident" id="4665328">size</span>&nbsp;<span class="op" id="4665333">=</span>&nbsp;<span class="ident" id="4665335">hm</span><span class="op" id="4665337">.</span><span class="ident" id="4665338">inner</span><span class="op" id="4665343">.</span><span class="ident" id="4665344">Size</span><span class="op" id="4665348">(</span><span class="op" id="4665349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4665352">hm</span><span class="op" id="4665354">.</span><span class="ident" id="4665355">blocksize</span>&nbsp;<span class="op" id="4665365">=</span>&nbsp;<span class="ident" id="4665367">hm</span><span class="op" id="4665369">.</span><span class="ident" id="4665370">inner</span><span class="op" id="4665375">.</span><span class="ident" id="4665376">BlockSize</span><span class="op" id="4665385">(</span><span class="op" id="4665386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4665389">hm</span><span class="op" id="4665391">.</span><span class="ident" id="4665392">tmp</span>&nbsp;<span class="op" id="4665396">=</span>&nbsp;<span class="builtinfunc" id="4665398">make</span><span class="op" id="4665402">(</span><span class="op" id="4665403">[</span><span class="op" id="4665404">]</span><span class="builtintype" id="4665405">byte</span><span class="op" id="4665409">,</span>&nbsp;<span class="ident" id="4665411">hm</span><span class="op" id="4665413">.</span><span class="ident" id="4665414">blocksize</span><span class="op" id="4665423">+</span><span class="ident" id="4665424">hm</span><span class="op" id="4665426">.</span><span class="ident" id="4665427">size</span><span class="op" id="4665431">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4665434">if</span>&nbsp;<span class="builtinfunc" id="4665437">len</span><span class="op" id="4665440">(</span><span class="ident" id="4665441">key</span><span class="op" id="4665444">)</span>&nbsp;<span class="op" id="4665446">&gt;</span>&nbsp;<span class="ident" id="4665448">hm</span><span class="op" id="4665450">.</span><span class="ident" id="4665451">blocksize</span>&nbsp;<span class="op" id="4665461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4665465">//&nbsp;If&nbsp;key&nbsp;is&nbsp;too&nbsp;big,&nbsp;hash&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4665498">hm</span><span class="op" id="4665500">.</span><span class="ident" id="4665501">outer</span><span class="op" id="4665506">.</span><span class="ident" id="4665507">Write</span><span class="op" id="4665512">(</span><span class="ident" id="4665513">key</span><span class="op" id="4665516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4665520">key</span>&nbsp;<span class="op" id="4665524">=</span>&nbsp;<span class="ident" id="4665526">hm</span><span class="op" id="4665528">.</span><span class="ident" id="4665529">outer</span><span class="op" id="4665534">.</span><span class="ident" id="4665535">Sum</span><span class="op" id="4665538">(</span><span class="ident" id="4665539">nil</span><span class="op" id="4665542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4665545">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4665548">hm</span><span class="op" id="4665550">.</span><span class="ident" id="4665551">key</span>&nbsp;<span class="op" id="4665555">=</span>&nbsp;<span class="builtinfunc" id="4665557">make</span><span class="op" id="4665561">(</span><span class="op" id="4665562">[</span><span class="op" id="4665563">]</span><span class="builtintype" id="4665564">byte</span><span class="op" id="4665568">,</span>&nbsp;<span class="builtinfunc" id="4665570">len</span><span class="op" id="4665573">(</span><span class="ident" id="4665574">key</span><span class="op" id="4665577">)</span><span class="op" id="4665578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4665581">copy</span><span class="op" id="4665585">(</span><span class="ident" id="4665586">hm</span><span class="op" id="4665588">.</span><span class="ident" id="4665589">key</span><span class="op" id="4665592">,</span>&nbsp;<span class="ident" id="4665594">key</span><span class="op" id="4665597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4665600">hm</span><span class="op" id="4665602">.</span><span class="ident" id="4665603">Reset</span><span class="op" id="4665608">(</span><span class="op" id="4665609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4665612">return</span>&nbsp;<span class="ident" id="4665619">hm</span><br>
<span class="lineno"></span><span class="op" id="4665622">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="4665625">//&nbsp;Equal&nbsp;compares&nbsp;two&nbsp;MACs&nbsp;for&nbsp;equality&nbsp;without&nbsp;leaking&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="4665701">func</span>&nbsp;<span class="ident" id="4665706">Equal</span><span class="op" id="4665711">(</span><span class="ident" id="4665712">mac1</span><span class="op" id="4665716">,</span>&nbsp;<span class="ident" id="4665718">mac2</span>&nbsp;<span class="op" id="4665723">[</span><span class="op" id="4665724">]</span><span class="builtintype" id="4665725">byte</span><span class="op" id="4665729">)</span>&nbsp;<span class="builtintype" id="4665731">bool</span>&nbsp;<span class="op" id="4665736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4665739">//&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;constant&nbsp;time&nbsp;if&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MACs&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4665808">//&nbsp;different&nbsp;as&nbsp;that&nbsp;suggests&nbsp;that&nbsp;a&nbsp;completely&nbsp;different&nbsp;hash&nbsp;function</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4665881">//&nbsp;was&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4665895">return</span>&nbsp;<span class="builtinfunc" id="4665902">len</span><span class="op" id="4665905">(</span><span class="ident" id="4665906">mac1</span><span class="op" id="4665910">)</span>&nbsp;<span class="op" id="4665912">==</span>&nbsp;<span class="builtinfunc" id="4665915">len</span><span class="op" id="4665918">(</span><span class="ident" id="4665919">mac2</span><span class="op" id="4665923">)</span>&nbsp;<span class="op" id="4665925">&amp;&amp;</span>&nbsp;<span class="ident" id="4665928">subtle</span><span class="op" id="4665934">.</span><span class="ident" id="4665935">ConstantTimeCompare</span><span class="op" id="4665954">(</span><span class="ident" id="4665955">mac1</span><span class="op" id="4665959">,</span>&nbsp;<span class="ident" id="4665961">mac2</span><span class="op" id="4665965">)</span>&nbsp;<span class="op" id="4665967">==</span>&nbsp;<span class="num" id="4665970">1</span><br>
<span class="lineno"></span><span class="op" id="4665972">}</span>
</div>
</body>
</html>
