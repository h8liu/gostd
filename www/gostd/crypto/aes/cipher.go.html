<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3580959">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3581014">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3581068">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3581119">package</span>&nbsp;<span class="ident" id="3581127">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3581132">import</span>&nbsp;<span class="op" id="3581139">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3581142">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3581159">&#34;strconv&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3581169">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3581172">//&nbsp;The&nbsp;AES&nbsp;block&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3581204">const</span>&nbsp;<span class="ident" id="3581210">BlockSize</span>&nbsp;<span class="op" id="3581220">=</span>&nbsp;<span class="num" id="3581222">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3581226">//&nbsp;A&nbsp;cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;AES&nbsp;encryption&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3581295">type</span>&nbsp;<span class="ident" id="3581300">aesCipher</span>&nbsp;<span class="keyword" id="3581310">struct</span>&nbsp;<span class="op" id="3581317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581320">enc</span>&nbsp;<span class="op" id="3581324">[</span><span class="op" id="3581325">]</span><span class="builtintype" id="3581326">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581334">dec</span>&nbsp;<span class="op" id="3581338">[</span><span class="op" id="3581339">]</span><span class="builtintype" id="3581340">uint32</span><br>
<span class="lineno"></span><span class="op" id="3581347">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3581350">type</span>&nbsp;<span class="ident" id="3581355">KeySizeError</span>&nbsp;<span class="builtintype" id="3581368">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3581373">func</span>&nbsp;<span class="op" id="3581378">(</span><span class="ident" id="3581379">k</span>&nbsp;<span class="ident" id="3581381">KeySizeError</span><span class="op" id="3581393">)</span>&nbsp;<span class="ident" id="3581395">Error</span><span class="op" id="3581400">(</span><span class="op" id="3581401">)</span>&nbsp;<span class="builtintype" id="3581403">string</span>&nbsp;<span class="op" id="3581410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3581413">return</span>&nbsp;<span class="string" id="3581420">&#34;crypto/aes:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="3581452">+</span>&nbsp;<span class="ident" id="3581454">strconv</span><span class="op" id="3581461">.</span><span class="ident" id="3581462">Itoa</span><span class="op" id="3581466">(</span><span class="builtintype" id="3581467">int</span><span class="op" id="3581470">(</span><span class="ident" id="3581471">k</span><span class="op" id="3581472">)</span><span class="op" id="3581473">)</span><br>
<span class="lineno">25</span><span class="op" id="3581475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3581478">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;cipher.Block.</span><br>
<span class="lineno"></span><span class="comment" id="3581531">//&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the&nbsp;AES&nbsp;key,</span><br>
<span class="lineno"></span><span class="comment" id="3581574">//&nbsp;either&nbsp;16,&nbsp;24,&nbsp;or&nbsp;32&nbsp;bytes&nbsp;to&nbsp;select</span><br>
<span class="lineno">30</span><span class="comment" id="3581614">//&nbsp;AES-128,&nbsp;AES-192,&nbsp;or&nbsp;AES-256.</span><br>
<span class="lineno"></span><span class="keyword" id="3581647">func</span>&nbsp;<span class="ident" id="3581652">NewCipher</span><span class="op" id="3581661">(</span><span class="ident" id="3581662">key</span>&nbsp;<span class="op" id="3581666">[</span><span class="op" id="3581667">]</span><span class="builtintype" id="3581668">byte</span><span class="op" id="3581672">)</span>&nbsp;<span class="op" id="3581674">(</span><span class="ident" id="3581675">cipher</span><span class="op" id="3581681">.</span><span class="ident" id="3581682">Block</span><span class="op" id="3581687">,</span>&nbsp;<span class="builtintype" id="3581689">error</span><span class="op" id="3581694">)</span>&nbsp;<span class="op" id="3581696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581699">k</span>&nbsp;<span class="op" id="3581701">:=</span>&nbsp;<span class="builtinfunc" id="3581704">len</span><span class="op" id="3581707">(</span><span class="ident" id="3581708">key</span><span class="op" id="3581711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3581714">switch</span>&nbsp;<span class="ident" id="3581721">k</span>&nbsp;<span class="op" id="3581723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3581726">default</span><span class="op" id="3581733">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3581737">return</span>&nbsp;<span class="ident" id="3581744">nil</span><span class="op" id="3581747">,</span>&nbsp;<span class="ident" id="3581749">KeySizeError</span><span class="op" id="3581761">(</span><span class="ident" id="3581762">k</span><span class="op" id="3581763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3581766">case</span>&nbsp;<span class="num" id="3581771">16</span><span class="op" id="3581773">,</span>&nbsp;<span class="num" id="3581775">24</span><span class="op" id="3581777">,</span>&nbsp;<span class="num" id="3581779">32</span><span class="op" id="3581781">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3581785">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3581792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581796">n</span>&nbsp;<span class="op" id="3581798">:=</span>&nbsp;<span class="ident" id="3581801">k</span>&nbsp;<span class="op" id="3581803">+</span>&nbsp;<span class="num" id="3581805">28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581809">c</span>&nbsp;<span class="op" id="3581811">:=</span>&nbsp;<span class="op" id="3581814">&amp;</span><span class="ident" id="3581815">aesCipher</span><span class="op" id="3581824">{</span><span class="builtinfunc" id="3581825">make</span><span class="op" id="3581829">(</span><span class="op" id="3581830">[</span><span class="op" id="3581831">]</span><span class="builtintype" id="3581832">uint32</span><span class="op" id="3581838">,</span>&nbsp;<span class="ident" id="3581840">n</span><span class="op" id="3581841">)</span><span class="op" id="3581842">,</span>&nbsp;<span class="builtinfunc" id="3581844">make</span><span class="op" id="3581848">(</span><span class="op" id="3581849">[</span><span class="op" id="3581850">]</span><span class="builtintype" id="3581851">uint32</span><span class="op" id="3581857">,</span>&nbsp;<span class="ident" id="3581859">n</span><span class="op" id="3581860">)</span><span class="op" id="3581861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3581864">expandKey</span><span class="op" id="3581873">(</span><span class="ident" id="3581874">key</span><span class="op" id="3581877">,</span>&nbsp;<span class="ident" id="3581879">c</span><span class="op" id="3581880">.</span><span class="ident" id="3581881">enc</span><span class="op" id="3581884">,</span>&nbsp;<span class="ident" id="3581886">c</span><span class="op" id="3581887">.</span><span class="ident" id="3581888">dec</span><span class="op" id="3581891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3581894">return</span>&nbsp;<span class="ident" id="3581901">c</span><span class="op" id="3581902">,</span>&nbsp;<span class="ident" id="3581904">nil</span><br>
<span class="lineno"></span><span class="op" id="3581908">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3581911">func</span>&nbsp;<span class="op" id="3581916">(</span><span class="ident" id="3581917">c</span>&nbsp;<span class="op" id="3581919">*</span><span class="ident" id="3581920">aesCipher</span><span class="op" id="3581929">)</span>&nbsp;<span class="ident" id="3581931">BlockSize</span><span class="op" id="3581940">(</span><span class="op" id="3581941">)</span>&nbsp;<span class="builtintype" id="3581943">int</span>&nbsp;<span class="op" id="3581947">{</span>&nbsp;<span class="keyword" id="3581949">return</span>&nbsp;<span class="ident" id="3581956">BlockSize</span>&nbsp;<span class="op" id="3581966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3581969">func</span>&nbsp;<span class="op" id="3581974">(</span><span class="ident" id="3581975">c</span>&nbsp;<span class="op" id="3581977">*</span><span class="ident" id="3581978">aesCipher</span><span class="op" id="3581987">)</span>&nbsp;<span class="ident" id="3581989">Encrypt</span><span class="op" id="3581996">(</span><span class="ident" id="3581997">dst</span><span class="op" id="3582000">,</span>&nbsp;<span class="ident" id="3582002">src</span>&nbsp;<span class="op" id="3582006">[</span><span class="op" id="3582007">]</span><span class="builtintype" id="3582008">byte</span><span class="op" id="3582012">)</span>&nbsp;<span class="op" id="3582014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582017">if</span>&nbsp;<span class="builtinfunc" id="3582020">len</span><span class="op" id="3582023">(</span><span class="ident" id="3582024">src</span><span class="op" id="3582027">)</span>&nbsp;<span class="op" id="3582029">&lt;</span>&nbsp;<span class="ident" id="3582031">BlockSize</span>&nbsp;<span class="op" id="3582041">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3582045">panic</span><span class="op" id="3582050">(</span><span class="string" id="3582051">&#34;crypto/aes:&nbsp;input&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3582085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3582088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582091">if</span>&nbsp;<span class="builtinfunc" id="3582094">len</span><span class="op" id="3582097">(</span><span class="ident" id="3582098">dst</span><span class="op" id="3582101">)</span>&nbsp;<span class="op" id="3582103">&lt;</span>&nbsp;<span class="ident" id="3582105">BlockSize</span>&nbsp;<span class="op" id="3582115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3582119">panic</span><span class="op" id="3582124">(</span><span class="string" id="3582125">&#34;crypto/aes:&nbsp;output&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3582160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3582163">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3582166">encryptBlock</span><span class="op" id="3582178">(</span><span class="ident" id="3582179">c</span><span class="op" id="3582180">.</span><span class="ident" id="3582181">enc</span><span class="op" id="3582184">,</span>&nbsp;<span class="ident" id="3582186">dst</span><span class="op" id="3582189">,</span>&nbsp;<span class="ident" id="3582191">src</span><span class="op" id="3582194">)</span><br>
<span class="lineno"></span><span class="op" id="3582196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3582199">func</span>&nbsp;<span class="op" id="3582204">(</span><span class="ident" id="3582205">c</span>&nbsp;<span class="op" id="3582207">*</span><span class="ident" id="3582208">aesCipher</span><span class="op" id="3582217">)</span>&nbsp;<span class="ident" id="3582219">Decrypt</span><span class="op" id="3582226">(</span><span class="ident" id="3582227">dst</span><span class="op" id="3582230">,</span>&nbsp;<span class="ident" id="3582232">src</span>&nbsp;<span class="op" id="3582236">[</span><span class="op" id="3582237">]</span><span class="builtintype" id="3582238">byte</span><span class="op" id="3582242">)</span>&nbsp;<span class="op" id="3582244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582247">if</span>&nbsp;<span class="builtinfunc" id="3582250">len</span><span class="op" id="3582253">(</span><span class="ident" id="3582254">src</span><span class="op" id="3582257">)</span>&nbsp;<span class="op" id="3582259">&lt;</span>&nbsp;<span class="ident" id="3582261">BlockSize</span>&nbsp;<span class="op" id="3582271">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3582275">panic</span><span class="op" id="3582280">(</span><span class="string" id="3582281">&#34;crypto/aes:&nbsp;input&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3582315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3582318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3582321">if</span>&nbsp;<span class="builtinfunc" id="3582324">len</span><span class="op" id="3582327">(</span><span class="ident" id="3582328">dst</span><span class="op" id="3582331">)</span>&nbsp;<span class="op" id="3582333">&lt;</span>&nbsp;<span class="ident" id="3582335">BlockSize</span>&nbsp;<span class="op" id="3582345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3582349">panic</span><span class="op" id="3582354">(</span><span class="string" id="3582355">&#34;crypto/aes:&nbsp;output&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3582390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3582393">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3582396">decryptBlock</span><span class="op" id="3582408">(</span><span class="ident" id="3582409">c</span><span class="op" id="3582410">.</span><span class="ident" id="3582411">dec</span><span class="op" id="3582414">,</span>&nbsp;<span class="ident" id="3582416">dst</span><span class="op" id="3582419">,</span>&nbsp;<span class="ident" id="3582421">src</span><span class="op" id="3582424">)</span><br>
<span class="lineno"></span><span class="op" id="3582426">}</span>
</div>
</body>
</html>
