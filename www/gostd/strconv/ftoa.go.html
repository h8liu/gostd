<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strconv</h2>
<ul>
<li><a href="/gostd/strconv/atob.go.html">atob.go</a></li>
<li><a href="/gostd/strconv/atob_test.go.html">atob_test.go</a></li>
<li><a href="/gostd/strconv/atof.go.html">atof.go</a></li>
<li><a href="/gostd/strconv/atof_test.go.html">atof_test.go</a></li>
<li><a href="/gostd/strconv/atoi.go.html">atoi.go</a></li>
<li><a href="/gostd/strconv/atoi_test.go.html">atoi_test.go</a></li>
<li><a href="/gostd/strconv/decimal.go.html">decimal.go</a></li>
<li><a href="/gostd/strconv/decimal_test.go.html">decimal_test.go</a></li>
<li><a href="/gostd/strconv/extfloat.go.html">extfloat.go</a></li>
<li><a href="/gostd/strconv/fp_test.go.html">fp_test.go</a></li>
<li><a href="/gostd/strconv/ftoa.go.html">ftoa.go</a></li>
<li><a href="/gostd/strconv/ftoa_test.go.html">ftoa_test.go</a></li>
<li><a href="/gostd/strconv/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/strconv/isprint.go.html">isprint.go</a></li>
<li><a href="/gostd/strconv/itoa.go.html">itoa.go</a></li>
<li><a href="/gostd/strconv/itoa_test.go.html">itoa_test.go</a></li>
<li><a href="/gostd/strconv/quote.go.html">quote.go</a></li>
<li><a href="/gostd/strconv/quote_example_test.go.html">quote_example_test.go</a></li>
<li><a href="/gostd/strconv/quote_test.go.html">quote_test.go</a></li>
<li><a href="/gostd/strconv/strconv_test.go.html">strconv_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2007849">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2007904">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2007958">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2008009">//&nbsp;Binary&nbsp;to&nbsp;decimal&nbsp;floating&nbsp;point&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment" id="2008057">//&nbsp;Algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2008071">//&nbsp;&nbsp;&nbsp;1)&nbsp;store&nbsp;mantissa&nbsp;in&nbsp;multiprecision&nbsp;decimal</span><br>
<span class="lineno"></span><span class="comment" id="2008120">//&nbsp;&nbsp;&nbsp;2)&nbsp;shift&nbsp;decimal&nbsp;by&nbsp;exponent</span><br>
<span class="lineno"></span><span class="comment" id="2008154">//&nbsp;&nbsp;&nbsp;3)&nbsp;read&nbsp;digits&nbsp;out&nbsp;&amp;&nbsp;format</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2008188">package</span>&nbsp;<span class="ident" id="2008196">strconv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2008205">import</span>&nbsp;<span class="string" id="2008212">&#34;math&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2008220">//&nbsp;TODO:&nbsp;move&nbsp;elsewhere?</span><br>
<span class="lineno"></span><span class="keyword" id="2008245">type</span>&nbsp;<span class="ident" id="2008250">floatInfo</span>&nbsp;<span class="keyword" id="2008260">struct</span>&nbsp;<span class="op" id="2008267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2008270">mantbits</span>&nbsp;<span class="builtintype" id="2008279">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2008285">expbits</span>&nbsp;&nbsp;<span class="builtintype" id="2008294">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2008300">bias</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2008309">int</span><br>
<span class="lineno">20</span><span class="op" id="2008313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2008316">var</span>&nbsp;<span class="ident" id="2008320">float32info</span>&nbsp;<span class="op" id="2008332">=</span>&nbsp;<span class="ident" id="2008334">floatInfo</span><span class="op" id="2008343">{</span><span class="num" id="2008344">23</span><span class="op" id="2008346">,</span>&nbsp;<span class="num" id="2008348">8</span><span class="op" id="2008349">,</span>&nbsp;<span class="op" id="2008351">-</span><span class="num" id="2008352">127</span><span class="op" id="2008355">}</span><br>
<span class="lineno"></span><span class="keyword" id="2008357">var</span>&nbsp;<span class="ident" id="2008361">float64info</span>&nbsp;<span class="op" id="2008373">=</span>&nbsp;<span class="ident" id="2008375">floatInfo</span><span class="op" id="2008384">{</span><span class="num" id="2008385">52</span><span class="op" id="2008387">,</span>&nbsp;<span class="num" id="2008389">11</span><span class="op" id="2008391">,</span>&nbsp;<span class="op" id="2008393">-</span><span class="num" id="2008394">1023</span><span class="op" id="2008398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2008401">//&nbsp;FormatFloat&nbsp;converts&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f&nbsp;to&nbsp;a&nbsp;string,</span><br>
<span class="lineno"></span><span class="comment" id="2008466">//&nbsp;according&nbsp;to&nbsp;the&nbsp;format&nbsp;fmt&nbsp;and&nbsp;precision&nbsp;prec.&nbsp;&nbsp;It&nbsp;rounds&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2008532">//&nbsp;result&nbsp;assuming&nbsp;that&nbsp;the&nbsp;original&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="2008604">//&nbsp;value&nbsp;of&nbsp;bitSize&nbsp;bits&nbsp;(32&nbsp;for&nbsp;float32,&nbsp;64&nbsp;for&nbsp;float64).</span><br>
<span class="lineno"></span><span class="comment" id="2008663">//</span><br>
<span class="lineno">30</span><span class="comment" id="2008666">//&nbsp;The&nbsp;format&nbsp;fmt&nbsp;is&nbsp;one&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2008694">//&nbsp;&#39;b&#39;&nbsp;(-ddddp±ddd,&nbsp;a&nbsp;binary&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2008735">//&nbsp;&#39;e&#39;&nbsp;(-d.dddde±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2008778">//&nbsp;&#39;E&#39;&nbsp;(-d.ddddE±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2008821">//&nbsp;&#39;f&#39;&nbsp;(-ddd.dddd,&nbsp;no&nbsp;exponent),</span><br>
<span class="lineno">35</span><span class="comment" id="2008854">//&nbsp;&#39;g&#39;&nbsp;(&#39;e&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise),&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2008906">//&nbsp;&#39;G&#39;&nbsp;(&#39;E&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise).</span><br>
<span class="lineno"></span><span class="comment" id="2008955">//</span><br>
<span class="lineno"></span><span class="comment" id="2008958">//&nbsp;The&nbsp;precision&nbsp;prec&nbsp;controls&nbsp;the&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2009010">//&nbsp;(excluding&nbsp;the&nbsp;exponent)&nbsp;printed&nbsp;by&nbsp;the&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;g&#39;,&nbsp;and&nbsp;&#39;G&#39;&nbsp;formats.</span><br>
<span class="lineno">40</span><span class="comment" id="2009090">//&nbsp;For&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;and&nbsp;&#39;f&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span><span class="comment" id="2009167">//&nbsp;For&nbsp;&#39;g&#39;&nbsp;and&nbsp;&#39;G&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="2009220">//&nbsp;The&nbsp;special&nbsp;precision&nbsp;-1&nbsp;uses&nbsp;the&nbsp;smallest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2009283">//&nbsp;necessary&nbsp;such&nbsp;that&nbsp;ParseFloat&nbsp;will&nbsp;return&nbsp;f&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="keyword" id="2009340">func</span>&nbsp;<span class="ident" id="2009345">FormatFloat</span><span class="op" id="2009356">(</span><span class="ident" id="2009357">f</span>&nbsp;<span class="builtintype" id="2009359">float64</span><span class="op" id="2009366">,</span>&nbsp;<span class="ident" id="2009368">fmt</span>&nbsp;<span class="builtintype" id="2009372">byte</span><span class="op" id="2009376">,</span>&nbsp;<span class="ident" id="2009378">prec</span><span class="op" id="2009382">,</span>&nbsp;<span class="ident" id="2009384">bitSize</span>&nbsp;<span class="builtintype" id="2009392">int</span><span class="op" id="2009395">)</span>&nbsp;<span class="builtintype" id="2009397">string</span>&nbsp;<span class="op" id="2009404">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2009407">return</span>&nbsp;<span class="builtintype" id="2009414">string</span><span class="op" id="2009420">(</span><span class="ident" id="2009421">genericFtoa</span><span class="op" id="2009432">(</span><span class="builtinfunc" id="2009433">make</span><span class="op" id="2009437">(</span><span class="op" id="2009438">[</span><span class="op" id="2009439">]</span><span class="builtintype" id="2009440">byte</span><span class="op" id="2009444">,</span>&nbsp;<span class="num" id="2009446">0</span><span class="op" id="2009447">,</span>&nbsp;<span class="ident" id="2009449">max</span><span class="op" id="2009452">(</span><span class="ident" id="2009453">prec</span><span class="op" id="2009457">+</span><span class="num" id="2009458">4</span><span class="op" id="2009459">,</span>&nbsp;<span class="num" id="2009461">24</span><span class="op" id="2009463">)</span><span class="op" id="2009464">)</span><span class="op" id="2009465">,</span>&nbsp;<span class="ident" id="2009467">f</span><span class="op" id="2009468">,</span>&nbsp;<span class="ident" id="2009470">fmt</span><span class="op" id="2009473">,</span>&nbsp;<span class="ident" id="2009475">prec</span><span class="op" id="2009479">,</span>&nbsp;<span class="ident" id="2009481">bitSize</span><span class="op" id="2009488">)</span><span class="op" id="2009489">)</span><br>
<span class="lineno"></span><span class="op" id="2009491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2009494">//&nbsp;AppendFloat&nbsp;appends&nbsp;the&nbsp;string&nbsp;form&nbsp;of&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f,</span><br>
<span class="lineno"></span><span class="comment" id="2009565">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;FormatFloat,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno">50</span><span class="keyword" id="2009637">func</span>&nbsp;<span class="ident" id="2009642">AppendFloat</span><span class="op" id="2009653">(</span><span class="ident" id="2009654">dst</span>&nbsp;<span class="op" id="2009658">[</span><span class="op" id="2009659">]</span><span class="builtintype" id="2009660">byte</span><span class="op" id="2009664">,</span>&nbsp;<span class="ident" id="2009666">f</span>&nbsp;<span class="builtintype" id="2009668">float64</span><span class="op" id="2009675">,</span>&nbsp;<span class="ident" id="2009677">fmt</span>&nbsp;<span class="builtintype" id="2009681">byte</span><span class="op" id="2009685">,</span>&nbsp;<span class="ident" id="2009687">prec</span>&nbsp;<span class="builtintype" id="2009692">int</span><span class="op" id="2009695">,</span>&nbsp;<span class="ident" id="2009697">bitSize</span>&nbsp;<span class="builtintype" id="2009705">int</span><span class="op" id="2009708">)</span>&nbsp;<span class="op" id="2009710">[</span><span class="op" id="2009711">]</span><span class="builtintype" id="2009712">byte</span>&nbsp;<span class="op" id="2009717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2009720">return</span>&nbsp;<span class="ident" id="2009727">genericFtoa</span><span class="op" id="2009738">(</span><span class="ident" id="2009739">dst</span><span class="op" id="2009742">,</span>&nbsp;<span class="ident" id="2009744">f</span><span class="op" id="2009745">,</span>&nbsp;<span class="ident" id="2009747">fmt</span><span class="op" id="2009750">,</span>&nbsp;<span class="ident" id="2009752">prec</span><span class="op" id="2009756">,</span>&nbsp;<span class="ident" id="2009758">bitSize</span><span class="op" id="2009765">)</span><br>
<span class="lineno"></span><span class="op" id="2009767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2009770">func</span>&nbsp;<span class="ident" id="2009775">genericFtoa</span><span class="op" id="2009786">(</span><span class="ident" id="2009787">dst</span>&nbsp;<span class="op" id="2009791">[</span><span class="op" id="2009792">]</span><span class="builtintype" id="2009793">byte</span><span class="op" id="2009797">,</span>&nbsp;<span class="ident" id="2009799">val</span>&nbsp;<span class="builtintype" id="2009803">float64</span><span class="op" id="2009810">,</span>&nbsp;<span class="ident" id="2009812">fmt</span>&nbsp;<span class="builtintype" id="2009816">byte</span><span class="op" id="2009820">,</span>&nbsp;<span class="ident" id="2009822">prec</span><span class="op" id="2009826">,</span>&nbsp;<span class="ident" id="2009828">bitSize</span>&nbsp;<span class="builtintype" id="2009836">int</span><span class="op" id="2009839">)</span>&nbsp;<span class="op" id="2009841">[</span><span class="op" id="2009842">]</span><span class="builtintype" id="2009843">byte</span>&nbsp;<span class="op" id="2009848">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2009851">var</span>&nbsp;<span class="ident" id="2009855">bits</span>&nbsp;<span class="ident" id="2009860">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2009868">var</span>&nbsp;<span class="ident" id="2009872">flt</span>&nbsp;<span class="op" id="2009876">*</span><span class="ident" id="2009877">floatInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2009888">switch</span>&nbsp;<span class="ident" id="2009895">bitSize</span>&nbsp;<span class="op" id="2009903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2009906">case</span>&nbsp;<span class="num" id="2009911">32</span><span class="op" id="2009913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009917">bits</span>&nbsp;<span class="op" id="2009922">=</span>&nbsp;<span class="ident" id="2009924">uint64</span><span class="op" id="2009930">(</span><span class="ident" id="2009931">math</span><span class="op" id="2009935">.</span><span class="ident" id="2009936">Float32bits</span><span class="op" id="2009947">(</span><span class="builtintype" id="2009948">float32</span><span class="op" id="2009955">(</span><span class="ident" id="2009956">val</span><span class="op" id="2009959">)</span><span class="op" id="2009960">)</span><span class="op" id="2009961">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009965">flt</span>&nbsp;<span class="op" id="2009969">=</span>&nbsp;<span class="op" id="2009971">&amp;</span><span class="ident" id="2009972">float32info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2009985">case</span>&nbsp;<span class="num" id="2009990">64</span><span class="op" id="2009992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2009996">bits</span>&nbsp;<span class="op" id="2010001">=</span>&nbsp;<span class="ident" id="2010003">math</span><span class="op" id="2010007">.</span><span class="ident" id="2010008">Float64bits</span><span class="op" id="2010019">(</span><span class="ident" id="2010020">val</span><span class="op" id="2010023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010027">flt</span>&nbsp;<span class="op" id="2010031">=</span>&nbsp;<span class="op" id="2010033">&amp;</span><span class="ident" id="2010034">float64info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010047">default</span><span class="op" id="2010054">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2010058">panic</span><span class="op" id="2010063">(</span><span class="string" id="2010064">&#34;strconv:&nbsp;illegal&nbsp;AppendFloat/FormatFloat&nbsp;bitSize&#34;</span><span class="op" id="2010114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2010117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010121">neg</span>&nbsp;<span class="op" id="2010125">:=</span>&nbsp;<span class="ident" id="2010128">bits</span><span class="op" id="2010132">&gt;&gt;</span><span class="op" id="2010134">(</span><span class="ident" id="2010135">flt</span><span class="op" id="2010138">.</span><span class="ident" id="2010139">expbits</span><span class="op" id="2010146">+</span><span class="ident" id="2010147">flt</span><span class="op" id="2010150">.</span><span class="ident" id="2010151">mantbits</span><span class="op" id="2010159">)</span>&nbsp;<span class="op" id="2010161">!=</span>&nbsp;<span class="num" id="2010164">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010167">exp</span>&nbsp;<span class="op" id="2010171">:=</span>&nbsp;<span class="builtintype" id="2010174">int</span><span class="op" id="2010177">(</span><span class="ident" id="2010178">bits</span><span class="op" id="2010182">&gt;&gt;</span><span class="ident" id="2010184">flt</span><span class="op" id="2010187">.</span><span class="ident" id="2010188">mantbits</span><span class="op" id="2010196">)</span>&nbsp;<span class="op" id="2010198">&amp;</span>&nbsp;<span class="op" id="2010200">(</span><span class="num" id="2010201">1</span><span class="op" id="2010202">&lt;&lt;</span><span class="ident" id="2010204">flt</span><span class="op" id="2010207">.</span><span class="ident" id="2010208">expbits</span>&nbsp;<span class="op" id="2010216">-</span>&nbsp;<span class="num" id="2010218">1</span><span class="op" id="2010219">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010222">mant</span>&nbsp;<span class="op" id="2010227">:=</span>&nbsp;<span class="ident" id="2010230">bits</span>&nbsp;<span class="op" id="2010235">&amp;</span>&nbsp;<span class="op" id="2010237">(</span><span class="ident" id="2010238">uint64</span><span class="op" id="2010244">(</span><span class="num" id="2010245">1</span><span class="op" id="2010246">)</span><span class="op" id="2010247">&lt;&lt;</span><span class="ident" id="2010249">flt</span><span class="op" id="2010252">.</span><span class="ident" id="2010253">mantbits</span>&nbsp;<span class="op" id="2010262">-</span>&nbsp;<span class="num" id="2010264">1</span><span class="op" id="2010265">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010269">switch</span>&nbsp;<span class="ident" id="2010276">exp</span>&nbsp;<span class="op" id="2010280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010283">case</span>&nbsp;<span class="num" id="2010288">1</span><span class="op" id="2010289">&lt;&lt;</span><span class="ident" id="2010291">flt</span><span class="op" id="2010294">.</span><span class="ident" id="2010295">expbits</span>&nbsp;<span class="op" id="2010303">-</span>&nbsp;<span class="num" id="2010305">1</span><span class="op" id="2010306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2010310">//&nbsp;Inf,&nbsp;NaN</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010324">var</span>&nbsp;<span class="ident" id="2010328">s</span>&nbsp;<span class="builtintype" id="2010330">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010339">switch</span>&nbsp;<span class="op" id="2010346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010350">case</span>&nbsp;<span class="ident" id="2010355">mant</span>&nbsp;<span class="op" id="2010360">!=</span>&nbsp;<span class="num" id="2010363">0</span><span class="op" id="2010364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010369">s</span>&nbsp;<span class="op" id="2010371">=</span>&nbsp;<span class="string" id="2010373">&#34;NaN&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010381">case</span>&nbsp;<span class="ident" id="2010386">neg</span><span class="op" id="2010389">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010394">s</span>&nbsp;<span class="op" id="2010396">=</span>&nbsp;<span class="string" id="2010398">&#34;-Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010407">default</span><span class="op" id="2010414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010419">s</span>&nbsp;<span class="op" id="2010421">=</span>&nbsp;<span class="string" id="2010423">&#34;+Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2010432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010436">return</span>&nbsp;<span class="builtinfunc" id="2010443">append</span><span class="op" id="2010449">(</span><span class="ident" id="2010450">dst</span><span class="op" id="2010453">,</span>&nbsp;<span class="ident" id="2010455">s</span><span class="op" id="2010456">...</span><span class="op" id="2010459">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010463">case</span>&nbsp;<span class="num" id="2010468">0</span><span class="op" id="2010469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2010473">//&nbsp;denormalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010491">exp</span><span class="op" id="2010494">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010499">default</span><span class="op" id="2010506">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2010510">//&nbsp;add&nbsp;implicit&nbsp;top&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010536">mant</span>&nbsp;<span class="op" id="2010541">|=</span>&nbsp;<span class="ident" id="2010544">uint64</span><span class="op" id="2010550">(</span><span class="num" id="2010551">1</span><span class="op" id="2010552">)</span>&nbsp;<span class="op" id="2010554">&lt;&lt;</span>&nbsp;<span class="ident" id="2010557">flt</span><span class="op" id="2010560">.</span><span class="ident" id="2010561">mantbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2010571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010574">exp</span>&nbsp;<span class="op" id="2010578">+=</span>&nbsp;<span class="ident" id="2010581">flt</span><span class="op" id="2010584">.</span><span class="ident" id="2010585">bias</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2010592">//&nbsp;Pick&nbsp;off&nbsp;easy&nbsp;binary&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010625">if</span>&nbsp;<span class="ident" id="2010628">fmt</span>&nbsp;<span class="op" id="2010632">==</span>&nbsp;<span class="string" id="2010635">&#39;b&#39;</span>&nbsp;<span class="op" id="2010639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010643">return</span>&nbsp;<span class="ident" id="2010650">fmtB</span><span class="op" id="2010654">(</span><span class="ident" id="2010655">dst</span><span class="op" id="2010658">,</span>&nbsp;<span class="ident" id="2010660">neg</span><span class="op" id="2010663">,</span>&nbsp;<span class="ident" id="2010665">mant</span><span class="op" id="2010669">,</span>&nbsp;<span class="ident" id="2010671">exp</span><span class="op" id="2010674">,</span>&nbsp;<span class="ident" id="2010676">flt</span><span class="op" id="2010679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2010682">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010686">if</span>&nbsp;<span class="op" id="2010689">!</span><span class="ident" id="2010690">optimize</span>&nbsp;<span class="op" id="2010699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010703">return</span>&nbsp;<span class="ident" id="2010710">bigFtoa</span><span class="op" id="2010717">(</span><span class="ident" id="2010718">dst</span><span class="op" id="2010721">,</span>&nbsp;<span class="ident" id="2010723">prec</span><span class="op" id="2010727">,</span>&nbsp;<span class="ident" id="2010729">fmt</span><span class="op" id="2010732">,</span>&nbsp;<span class="ident" id="2010734">neg</span><span class="op" id="2010737">,</span>&nbsp;<span class="ident" id="2010739">mant</span><span class="op" id="2010743">,</span>&nbsp;<span class="ident" id="2010745">exp</span><span class="op" id="2010748">,</span>&nbsp;<span class="ident" id="2010750">flt</span><span class="op" id="2010753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2010756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010760">var</span>&nbsp;<span class="ident" id="2010764">digs</span>&nbsp;<span class="ident" id="2010769">decimalSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010783">ok</span>&nbsp;<span class="op" id="2010786">:=</span>&nbsp;<span class="builtintype" id="2010789">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2010796">//&nbsp;Negative&nbsp;precision&nbsp;means&nbsp;&#34;only&nbsp;as&nbsp;much&nbsp;as&nbsp;needed&nbsp;to&nbsp;be&nbsp;exact.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010863">shortest</span>&nbsp;<span class="op" id="2010872">:=</span>&nbsp;<span class="ident" id="2010875">prec</span>&nbsp;<span class="op" id="2010880">&lt;</span>&nbsp;<span class="num" id="2010882">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2010885">if</span>&nbsp;<span class="ident" id="2010888">shortest</span>&nbsp;<span class="op" id="2010897">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2010901">//&nbsp;Try&nbsp;Grisu3&nbsp;algorithm.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010928">f</span>&nbsp;<span class="op" id="2010930">:=</span>&nbsp;<span class="builtinfunc" id="2010933">new</span><span class="op" id="2010936">(</span><span class="ident" id="2010937">extFloat</span><span class="op" id="2010945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2010949">lower</span><span class="op" id="2010954">,</span>&nbsp;<span class="ident" id="2010956">upper</span>&nbsp;<span class="op" id="2010962">:=</span>&nbsp;<span class="ident" id="2010965">f</span><span class="op" id="2010966">.</span><span class="ident" id="2010967">AssignComputeBounds</span><span class="op" id="2010986">(</span><span class="ident" id="2010987">mant</span><span class="op" id="2010991">,</span>&nbsp;<span class="ident" id="2010993">exp</span><span class="op" id="2010996">,</span>&nbsp;<span class="ident" id="2010998">neg</span><span class="op" id="2011001">,</span>&nbsp;<span class="ident" id="2011003">flt</span><span class="op" id="2011006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011010">var</span>&nbsp;<span class="ident" id="2011014">buf</span>&nbsp;<span class="op" id="2011018">[</span><span class="num" id="2011019">32</span><span class="op" id="2011021">]</span><span class="builtintype" id="2011022">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011029">digs</span><span class="op" id="2011033">.</span><span class="ident" id="2011034">d</span>&nbsp;<span class="op" id="2011036">=</span>&nbsp;<span class="ident" id="2011038">buf</span><span class="op" id="2011041">[</span><span class="op" id="2011042">:</span><span class="op" id="2011043">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011047">ok</span>&nbsp;<span class="op" id="2011050">=</span>&nbsp;<span class="ident" id="2011052">f</span><span class="op" id="2011053">.</span><span class="ident" id="2011054">ShortestDecimal</span><span class="op" id="2011069">(</span><span class="op" id="2011070">&amp;</span><span class="ident" id="2011071">digs</span><span class="op" id="2011075">,</span>&nbsp;<span class="op" id="2011077">&amp;</span><span class="ident" id="2011078">lower</span><span class="op" id="2011083">,</span>&nbsp;<span class="op" id="2011085">&amp;</span><span class="ident" id="2011086">upper</span><span class="op" id="2011091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011095">if</span>&nbsp;<span class="op" id="2011098">!</span><span class="ident" id="2011099">ok</span>&nbsp;<span class="op" id="2011102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011107">return</span>&nbsp;<span class="ident" id="2011114">bigFtoa</span><span class="op" id="2011121">(</span><span class="ident" id="2011122">dst</span><span class="op" id="2011125">,</span>&nbsp;<span class="ident" id="2011127">prec</span><span class="op" id="2011131">,</span>&nbsp;<span class="ident" id="2011133">fmt</span><span class="op" id="2011136">,</span>&nbsp;<span class="ident" id="2011138">neg</span><span class="op" id="2011141">,</span>&nbsp;<span class="ident" id="2011143">mant</span><span class="op" id="2011147">,</span>&nbsp;<span class="ident" id="2011149">exp</span><span class="op" id="2011152">,</span>&nbsp;<span class="ident" id="2011154">flt</span><span class="op" id="2011157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2011161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2011165">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011214">switch</span>&nbsp;<span class="ident" id="2011221">fmt</span>&nbsp;<span class="op" id="2011225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011229">case</span>&nbsp;<span class="string" id="2011234">&#39;e&#39;</span><span class="op" id="2011237">,</span>&nbsp;<span class="string" id="2011239">&#39;E&#39;</span><span class="op" id="2011242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011247">prec</span>&nbsp;<span class="op" id="2011252">=</span>&nbsp;<span class="ident" id="2011254">digs</span><span class="op" id="2011258">.</span><span class="ident" id="2011259">nd</span>&nbsp;<span class="op" id="2011262">-</span>&nbsp;<span class="num" id="2011264">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011268">case</span>&nbsp;<span class="string" id="2011273">&#39;f&#39;</span><span class="op" id="2011276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011281">prec</span>&nbsp;<span class="op" id="2011286">=</span>&nbsp;<span class="ident" id="2011288">max</span><span class="op" id="2011291">(</span><span class="ident" id="2011292">digs</span><span class="op" id="2011296">.</span><span class="ident" id="2011297">nd</span><span class="op" id="2011299">-</span><span class="ident" id="2011300">digs</span><span class="op" id="2011304">.</span><span class="ident" id="2011305">dp</span><span class="op" id="2011307">,</span>&nbsp;<span class="num" id="2011309">0</span><span class="op" id="2011310">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011314">case</span>&nbsp;<span class="string" id="2011319">&#39;g&#39;</span><span class="op" id="2011322">,</span>&nbsp;<span class="string" id="2011324">&#39;G&#39;</span><span class="op" id="2011327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011332">prec</span>&nbsp;<span class="op" id="2011337">=</span>&nbsp;<span class="ident" id="2011339">digs</span><span class="op" id="2011343">.</span><span class="ident" id="2011344">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2011349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2011352">}</span>&nbsp;<span class="keyword" id="2011354">else</span>&nbsp;<span class="keyword" id="2011359">if</span>&nbsp;<span class="ident" id="2011362">fmt</span>&nbsp;<span class="op" id="2011366">!=</span>&nbsp;<span class="string" id="2011369">&#39;f&#39;</span>&nbsp;<span class="op" id="2011373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2011377">//&nbsp;Fixed&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011406">digits</span>&nbsp;<span class="op" id="2011413">:=</span>&nbsp;<span class="ident" id="2011416">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011423">switch</span>&nbsp;<span class="ident" id="2011430">fmt</span>&nbsp;<span class="op" id="2011434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011438">case</span>&nbsp;<span class="string" id="2011443">&#39;e&#39;</span><span class="op" id="2011446">,</span>&nbsp;<span class="string" id="2011448">&#39;E&#39;</span><span class="op" id="2011451">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011456">digits</span><span class="op" id="2011462">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011467">case</span>&nbsp;<span class="string" id="2011472">&#39;g&#39;</span><span class="op" id="2011475">,</span>&nbsp;<span class="string" id="2011477">&#39;G&#39;</span><span class="op" id="2011480">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011485">if</span>&nbsp;<span class="ident" id="2011488">prec</span>&nbsp;<span class="op" id="2011493">==</span>&nbsp;<span class="num" id="2011496">0</span>&nbsp;<span class="op" id="2011498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011504">prec</span>&nbsp;<span class="op" id="2011509">=</span>&nbsp;<span class="num" id="2011511">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2011516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011521">digits</span>&nbsp;<span class="op" id="2011528">=</span>&nbsp;<span class="ident" id="2011530">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2011537">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011541">if</span>&nbsp;<span class="ident" id="2011544">digits</span>&nbsp;<span class="op" id="2011551">&lt;=</span>&nbsp;<span class="num" id="2011554">15</span>&nbsp;<span class="op" id="2011557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2011562">//&nbsp;try&nbsp;fast&nbsp;algorithm&nbsp;when&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;is&nbsp;reasonable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011628">var</span>&nbsp;<span class="ident" id="2011632">buf</span>&nbsp;<span class="op" id="2011636">[</span><span class="num" id="2011637">24</span><span class="op" id="2011639">]</span><span class="builtintype" id="2011640">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011648">digs</span><span class="op" id="2011652">.</span><span class="ident" id="2011653">d</span>&nbsp;<span class="op" id="2011655">=</span>&nbsp;<span class="ident" id="2011657">buf</span><span class="op" id="2011660">[</span><span class="op" id="2011661">:</span><span class="op" id="2011662">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011667">f</span>&nbsp;<span class="op" id="2011669">:=</span>&nbsp;<span class="ident" id="2011672">extFloat</span><span class="op" id="2011680">{</span><span class="ident" id="2011681">mant</span><span class="op" id="2011685">,</span>&nbsp;<span class="ident" id="2011687">exp</span>&nbsp;<span class="op" id="2011691">-</span>&nbsp;<span class="builtintype" id="2011693">int</span><span class="op" id="2011696">(</span><span class="ident" id="2011697">flt</span><span class="op" id="2011700">.</span><span class="ident" id="2011701">mantbits</span><span class="op" id="2011709">)</span><span class="op" id="2011710">,</span>&nbsp;<span class="ident" id="2011712">neg</span><span class="op" id="2011715">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2011720">ok</span>&nbsp;<span class="op" id="2011723">=</span>&nbsp;<span class="ident" id="2011725">f</span><span class="op" id="2011726">.</span><span class="ident" id="2011727">FixedDecimal</span><span class="op" id="2011739">(</span><span class="op" id="2011740">&amp;</span><span class="ident" id="2011741">digs</span><span class="op" id="2011745">,</span>&nbsp;<span class="ident" id="2011747">digits</span><span class="op" id="2011753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2011757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2011760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011763">if</span>&nbsp;<span class="op" id="2011766">!</span><span class="ident" id="2011767">ok</span>&nbsp;<span class="op" id="2011770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011774">return</span>&nbsp;<span class="ident" id="2011781">bigFtoa</span><span class="op" id="2011788">(</span><span class="ident" id="2011789">dst</span><span class="op" id="2011792">,</span>&nbsp;<span class="ident" id="2011794">prec</span><span class="op" id="2011798">,</span>&nbsp;<span class="ident" id="2011800">fmt</span><span class="op" id="2011803">,</span>&nbsp;<span class="ident" id="2011805">neg</span><span class="op" id="2011808">,</span>&nbsp;<span class="ident" id="2011810">mant</span><span class="op" id="2011814">,</span>&nbsp;<span class="ident" id="2011816">exp</span><span class="op" id="2011819">,</span>&nbsp;<span class="ident" id="2011821">flt</span><span class="op" id="2011824">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2011827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2011830">return</span>&nbsp;<span class="ident" id="2011837">formatDigits</span><span class="op" id="2011849">(</span><span class="ident" id="2011850">dst</span><span class="op" id="2011853">,</span>&nbsp;<span class="ident" id="2011855">shortest</span><span class="op" id="2011863">,</span>&nbsp;<span class="ident" id="2011865">neg</span><span class="op" id="2011868">,</span>&nbsp;<span class="ident" id="2011870">digs</span><span class="op" id="2011874">,</span>&nbsp;<span class="ident" id="2011876">prec</span><span class="op" id="2011880">,</span>&nbsp;<span class="ident" id="2011882">fmt</span><span class="op" id="2011885">)</span><br>
<span class="lineno"></span><span class="op" id="2011887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2011890">//&nbsp;bigFtoa&nbsp;uses&nbsp;multiprecision&nbsp;computations&nbsp;to&nbsp;format&nbsp;a&nbsp;float.</span><br>
<span class="lineno">155</span><span class="keyword" id="2011953">func</span>&nbsp;<span class="ident" id="2011958">bigFtoa</span><span class="op" id="2011965">(</span><span class="ident" id="2011966">dst</span>&nbsp;<span class="op" id="2011970">[</span><span class="op" id="2011971">]</span><span class="builtintype" id="2011972">byte</span><span class="op" id="2011976">,</span>&nbsp;<span class="ident" id="2011978">prec</span>&nbsp;<span class="builtintype" id="2011983">int</span><span class="op" id="2011986">,</span>&nbsp;<span class="ident" id="2011988">fmt</span>&nbsp;<span class="builtintype" id="2011992">byte</span><span class="op" id="2011996">,</span>&nbsp;<span class="ident" id="2011998">neg</span>&nbsp;<span class="builtintype" id="2012002">bool</span><span class="op" id="2012006">,</span>&nbsp;<span class="ident" id="2012008">mant</span>&nbsp;<span class="ident" id="2012013">uint64</span><span class="op" id="2012019">,</span>&nbsp;<span class="ident" id="2012021">exp</span>&nbsp;<span class="builtintype" id="2012025">int</span><span class="op" id="2012028">,</span>&nbsp;<span class="ident" id="2012030">flt</span>&nbsp;<span class="op" id="2012034">*</span><span class="ident" id="2012035">floatInfo</span><span class="op" id="2012044">)</span>&nbsp;<span class="op" id="2012046">[</span><span class="op" id="2012047">]</span><span class="builtintype" id="2012048">byte</span>&nbsp;<span class="op" id="2012053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012056">d</span>&nbsp;<span class="op" id="2012058">:=</span>&nbsp;<span class="builtinfunc" id="2012061">new</span><span class="op" id="2012064">(</span><span class="ident" id="2012065">decimal</span><span class="op" id="2012072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012075">d</span><span class="op" id="2012076">.</span><span class="ident" id="2012077">Assign</span><span class="op" id="2012083">(</span><span class="ident" id="2012084">mant</span><span class="op" id="2012088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012091">d</span><span class="op" id="2012092">.</span><span class="ident" id="2012093">Shift</span><span class="op" id="2012098">(</span><span class="ident" id="2012099">exp</span>&nbsp;<span class="op" id="2012103">-</span>&nbsp;<span class="builtintype" id="2012105">int</span><span class="op" id="2012108">(</span><span class="ident" id="2012109">flt</span><span class="op" id="2012112">.</span><span class="ident" id="2012113">mantbits</span><span class="op" id="2012121">)</span><span class="op" id="2012122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012125">var</span>&nbsp;<span class="ident" id="2012129">digs</span>&nbsp;<span class="ident" id="2012134">decimalSlice</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012148">shortest</span>&nbsp;<span class="op" id="2012157">:=</span>&nbsp;<span class="ident" id="2012160">prec</span>&nbsp;<span class="op" id="2012165">&lt;</span>&nbsp;<span class="num" id="2012167">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012170">if</span>&nbsp;<span class="ident" id="2012173">shortest</span>&nbsp;<span class="op" id="2012182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012186">roundShortest</span><span class="op" id="2012199">(</span><span class="ident" id="2012200">d</span><span class="op" id="2012201">,</span>&nbsp;<span class="ident" id="2012203">mant</span><span class="op" id="2012207">,</span>&nbsp;<span class="ident" id="2012209">exp</span><span class="op" id="2012212">,</span>&nbsp;<span class="ident" id="2012214">flt</span><span class="op" id="2012217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012221">digs</span>&nbsp;<span class="op" id="2012226">=</span>&nbsp;<span class="ident" id="2012228">decimalSlice</span><span class="op" id="2012240">{</span><span class="ident" id="2012241">d</span><span class="op" id="2012242">:</span>&nbsp;<span class="ident" id="2012244">d</span><span class="op" id="2012245">.</span><span class="ident" id="2012246">d</span><span class="op" id="2012247">[</span><span class="op" id="2012248">:</span><span class="op" id="2012249">]</span><span class="op" id="2012250">,</span>&nbsp;<span class="ident" id="2012252">nd</span><span class="op" id="2012254">:</span>&nbsp;<span class="ident" id="2012256">d</span><span class="op" id="2012257">.</span><span class="ident" id="2012258">nd</span><span class="op" id="2012260">,</span>&nbsp;<span class="ident" id="2012262">dp</span><span class="op" id="2012264">:</span>&nbsp;<span class="ident" id="2012266">d</span><span class="op" id="2012267">.</span><span class="ident" id="2012268">dp</span><span class="op" id="2012270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2012274">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012323">switch</span>&nbsp;<span class="ident" id="2012330">fmt</span>&nbsp;<span class="op" id="2012334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012338">case</span>&nbsp;<span class="string" id="2012343">&#39;e&#39;</span><span class="op" id="2012346">,</span>&nbsp;<span class="string" id="2012348">&#39;E&#39;</span><span class="op" id="2012351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012356">prec</span>&nbsp;<span class="op" id="2012361">=</span>&nbsp;<span class="ident" id="2012363">digs</span><span class="op" id="2012367">.</span><span class="ident" id="2012368">nd</span>&nbsp;<span class="op" id="2012371">-</span>&nbsp;<span class="num" id="2012373">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012377">case</span>&nbsp;<span class="string" id="2012382">&#39;f&#39;</span><span class="op" id="2012385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012390">prec</span>&nbsp;<span class="op" id="2012395">=</span>&nbsp;<span class="ident" id="2012397">max</span><span class="op" id="2012400">(</span><span class="ident" id="2012401">digs</span><span class="op" id="2012405">.</span><span class="ident" id="2012406">nd</span><span class="op" id="2012408">-</span><span class="ident" id="2012409">digs</span><span class="op" id="2012413">.</span><span class="ident" id="2012414">dp</span><span class="op" id="2012416">,</span>&nbsp;<span class="num" id="2012418">0</span><span class="op" id="2012419">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012423">case</span>&nbsp;<span class="string" id="2012428">&#39;g&#39;</span><span class="op" id="2012431">,</span>&nbsp;<span class="string" id="2012433">&#39;G&#39;</span><span class="op" id="2012436">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012441">prec</span>&nbsp;<span class="op" id="2012446">=</span>&nbsp;<span class="ident" id="2012448">digs</span><span class="op" id="2012452">.</span><span class="ident" id="2012453">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2012458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2012461">}</span>&nbsp;<span class="keyword" id="2012463">else</span>&nbsp;<span class="op" id="2012468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2012472">//&nbsp;Round&nbsp;appropriately.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012498">switch</span>&nbsp;<span class="ident" id="2012505">fmt</span>&nbsp;<span class="op" id="2012509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012513">case</span>&nbsp;<span class="string" id="2012518">&#39;e&#39;</span><span class="op" id="2012521">,</span>&nbsp;<span class="string" id="2012523">&#39;E&#39;</span><span class="op" id="2012526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012531">d</span><span class="op" id="2012532">.</span><span class="ident" id="2012533">Round</span><span class="op" id="2012538">(</span><span class="ident" id="2012539">prec</span>&nbsp;<span class="op" id="2012544">+</span>&nbsp;<span class="num" id="2012546">1</span><span class="op" id="2012547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012551">case</span>&nbsp;<span class="string" id="2012556">&#39;f&#39;</span><span class="op" id="2012559">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012564">d</span><span class="op" id="2012565">.</span><span class="ident" id="2012566">Round</span><span class="op" id="2012571">(</span><span class="ident" id="2012572">d</span><span class="op" id="2012573">.</span><span class="ident" id="2012574">dp</span>&nbsp;<span class="op" id="2012577">+</span>&nbsp;<span class="ident" id="2012579">prec</span><span class="op" id="2012583">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012587">case</span>&nbsp;<span class="string" id="2012592">&#39;g&#39;</span><span class="op" id="2012595">,</span>&nbsp;<span class="string" id="2012597">&#39;G&#39;</span><span class="op" id="2012600">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012605">if</span>&nbsp;<span class="ident" id="2012608">prec</span>&nbsp;<span class="op" id="2012613">==</span>&nbsp;<span class="num" id="2012616">0</span>&nbsp;<span class="op" id="2012618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012624">prec</span>&nbsp;<span class="op" id="2012629">=</span>&nbsp;<span class="num" id="2012631">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2012636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012641">d</span><span class="op" id="2012642">.</span><span class="ident" id="2012643">Round</span><span class="op" id="2012648">(</span><span class="ident" id="2012649">prec</span><span class="op" id="2012653">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2012657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2012661">digs</span>&nbsp;<span class="op" id="2012666">=</span>&nbsp;<span class="ident" id="2012668">decimalSlice</span><span class="op" id="2012680">{</span><span class="ident" id="2012681">d</span><span class="op" id="2012682">:</span>&nbsp;<span class="ident" id="2012684">d</span><span class="op" id="2012685">.</span><span class="ident" id="2012686">d</span><span class="op" id="2012687">[</span><span class="op" id="2012688">:</span><span class="op" id="2012689">]</span><span class="op" id="2012690">,</span>&nbsp;<span class="ident" id="2012692">nd</span><span class="op" id="2012694">:</span>&nbsp;<span class="ident" id="2012696">d</span><span class="op" id="2012697">.</span><span class="ident" id="2012698">nd</span><span class="op" id="2012700">,</span>&nbsp;<span class="ident" id="2012702">dp</span><span class="op" id="2012704">:</span>&nbsp;<span class="ident" id="2012706">d</span><span class="op" id="2012707">.</span><span class="ident" id="2012708">dp</span><span class="op" id="2012710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2012713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012716">return</span>&nbsp;<span class="ident" id="2012723">formatDigits</span><span class="op" id="2012735">(</span><span class="ident" id="2012736">dst</span><span class="op" id="2012739">,</span>&nbsp;<span class="ident" id="2012741">shortest</span><span class="op" id="2012749">,</span>&nbsp;<span class="ident" id="2012751">neg</span><span class="op" id="2012754">,</span>&nbsp;<span class="ident" id="2012756">digs</span><span class="op" id="2012760">,</span>&nbsp;<span class="ident" id="2012762">prec</span><span class="op" id="2012766">,</span>&nbsp;<span class="ident" id="2012768">fmt</span><span class="op" id="2012771">)</span><br>
<span class="lineno"></span><span class="op" id="2012773">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="2012776">func</span>&nbsp;<span class="ident" id="2012781">formatDigits</span><span class="op" id="2012793">(</span><span class="ident" id="2012794">dst</span>&nbsp;<span class="op" id="2012798">[</span><span class="op" id="2012799">]</span><span class="builtintype" id="2012800">byte</span><span class="op" id="2012804">,</span>&nbsp;<span class="ident" id="2012806">shortest</span>&nbsp;<span class="builtintype" id="2012815">bool</span><span class="op" id="2012819">,</span>&nbsp;<span class="ident" id="2012821">neg</span>&nbsp;<span class="builtintype" id="2012825">bool</span><span class="op" id="2012829">,</span>&nbsp;<span class="ident" id="2012831">digs</span>&nbsp;<span class="ident" id="2012836">decimalSlice</span><span class="op" id="2012848">,</span>&nbsp;<span class="ident" id="2012850">prec</span>&nbsp;<span class="builtintype" id="2012855">int</span><span class="op" id="2012858">,</span>&nbsp;<span class="ident" id="2012860">fmt</span>&nbsp;<span class="builtintype" id="2012864">byte</span><span class="op" id="2012868">)</span>&nbsp;<span class="op" id="2012870">[</span><span class="op" id="2012871">]</span><span class="builtintype" id="2012872">byte</span>&nbsp;<span class="op" id="2012877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012880">switch</span>&nbsp;<span class="ident" id="2012887">fmt</span>&nbsp;<span class="op" id="2012891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012894">case</span>&nbsp;<span class="string" id="2012899">&#39;e&#39;</span><span class="op" id="2012902">,</span>&nbsp;<span class="string" id="2012904">&#39;E&#39;</span><span class="op" id="2012907">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012911">return</span>&nbsp;<span class="ident" id="2012918">fmtE</span><span class="op" id="2012922">(</span><span class="ident" id="2012923">dst</span><span class="op" id="2012926">,</span>&nbsp;<span class="ident" id="2012928">neg</span><span class="op" id="2012931">,</span>&nbsp;<span class="ident" id="2012933">digs</span><span class="op" id="2012937">,</span>&nbsp;<span class="ident" id="2012939">prec</span><span class="op" id="2012943">,</span>&nbsp;<span class="ident" id="2012945">fmt</span><span class="op" id="2012948">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012951">case</span>&nbsp;<span class="string" id="2012956">&#39;f&#39;</span><span class="op" id="2012959">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012963">return</span>&nbsp;<span class="ident" id="2012970">fmtF</span><span class="op" id="2012974">(</span><span class="ident" id="2012975">dst</span><span class="op" id="2012978">,</span>&nbsp;<span class="ident" id="2012980">neg</span><span class="op" id="2012983">,</span>&nbsp;<span class="ident" id="2012985">digs</span><span class="op" id="2012989">,</span>&nbsp;<span class="ident" id="2012991">prec</span><span class="op" id="2012995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2012998">case</span>&nbsp;<span class="string" id="2013003">&#39;g&#39;</span><span class="op" id="2013006">,</span>&nbsp;<span class="string" id="2013008">&#39;G&#39;</span><span class="op" id="2013011">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013015">//&nbsp;trailing&nbsp;fractional&nbsp;zeros&nbsp;in&nbsp;&#39;e&#39;&nbsp;form&nbsp;will&nbsp;be&nbsp;trimmed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013075">eprec</span>&nbsp;<span class="op" id="2013081">:=</span>&nbsp;<span class="ident" id="2013084">prec</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013091">if</span>&nbsp;<span class="ident" id="2013094">eprec</span>&nbsp;<span class="op" id="2013100">&gt;</span>&nbsp;<span class="ident" id="2013102">digs</span><span class="op" id="2013106">.</span><span class="ident" id="2013107">nd</span>&nbsp;<span class="op" id="2013110">&amp;&amp;</span>&nbsp;<span class="ident" id="2013113">digs</span><span class="op" id="2013117">.</span><span class="ident" id="2013118">nd</span>&nbsp;<span class="op" id="2013121">&gt;=</span>&nbsp;<span class="ident" id="2013124">digs</span><span class="op" id="2013128">.</span><span class="ident" id="2013129">dp</span>&nbsp;<span class="op" id="2013132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013137">eprec</span>&nbsp;<span class="op" id="2013143">=</span>&nbsp;<span class="ident" id="2013145">digs</span><span class="op" id="2013149">.</span><span class="ident" id="2013150">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2013155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013159">//&nbsp;%e&nbsp;is&nbsp;used&nbsp;if&nbsp;the&nbsp;exponent&nbsp;from&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013211">//&nbsp;is&nbsp;less&nbsp;than&nbsp;-4&nbsp;or&nbsp;greater&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;the&nbsp;precision.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013275">//&nbsp;if&nbsp;precision&nbsp;was&nbsp;the&nbsp;shortest&nbsp;possible,&nbsp;use&nbsp;precision&nbsp;6&nbsp;for&nbsp;this&nbsp;decision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013355">if</span>&nbsp;<span class="ident" id="2013358">shortest</span>&nbsp;<span class="op" id="2013367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013372">eprec</span>&nbsp;<span class="op" id="2013378">=</span>&nbsp;<span class="num" id="2013380">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2013384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013388">exp</span>&nbsp;<span class="op" id="2013392">:=</span>&nbsp;<span class="ident" id="2013395">digs</span><span class="op" id="2013399">.</span><span class="ident" id="2013400">dp</span>&nbsp;<span class="op" id="2013403">-</span>&nbsp;<span class="num" id="2013405">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013409">if</span>&nbsp;<span class="ident" id="2013412">exp</span>&nbsp;<span class="op" id="2013416">&lt;</span>&nbsp;<span class="op" id="2013418">-</span><span class="num" id="2013419">4</span>&nbsp;<span class="op" id="2013421">||</span>&nbsp;<span class="ident" id="2013424">exp</span>&nbsp;<span class="op" id="2013428">&gt;=</span>&nbsp;<span class="ident" id="2013431">eprec</span>&nbsp;<span class="op" id="2013437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013442">if</span>&nbsp;<span class="ident" id="2013445">prec</span>&nbsp;<span class="op" id="2013450">&gt;</span>&nbsp;<span class="ident" id="2013452">digs</span><span class="op" id="2013456">.</span><span class="ident" id="2013457">nd</span>&nbsp;<span class="op" id="2013460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013466">prec</span>&nbsp;<span class="op" id="2013471">=</span>&nbsp;<span class="ident" id="2013473">digs</span><span class="op" id="2013477">.</span><span class="ident" id="2013478">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2013484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013489">return</span>&nbsp;<span class="ident" id="2013496">fmtE</span><span class="op" id="2013500">(</span><span class="ident" id="2013501">dst</span><span class="op" id="2013504">,</span>&nbsp;<span class="ident" id="2013506">neg</span><span class="op" id="2013509">,</span>&nbsp;<span class="ident" id="2013511">digs</span><span class="op" id="2013515">,</span>&nbsp;<span class="ident" id="2013517">prec</span><span class="op" id="2013521">-</span><span class="num" id="2013522">1</span><span class="op" id="2013523">,</span>&nbsp;<span class="ident" id="2013525">fmt</span><span class="op" id="2013528">+</span><span class="string" id="2013529">&#39;e&#39;</span><span class="op" id="2013532">-</span><span class="string" id="2013533">&#39;g&#39;</span><span class="op" id="2013536">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2013540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013544">if</span>&nbsp;<span class="ident" id="2013547">prec</span>&nbsp;<span class="op" id="2013552">&gt;</span>&nbsp;<span class="ident" id="2013554">digs</span><span class="op" id="2013558">.</span><span class="ident" id="2013559">dp</span>&nbsp;<span class="op" id="2013562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2013567">prec</span>&nbsp;<span class="op" id="2013572">=</span>&nbsp;<span class="ident" id="2013574">digs</span><span class="op" id="2013578">.</span><span class="ident" id="2013579">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2013584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013588">return</span>&nbsp;<span class="ident" id="2013595">fmtF</span><span class="op" id="2013599">(</span><span class="ident" id="2013600">dst</span><span class="op" id="2013603">,</span>&nbsp;<span class="ident" id="2013605">neg</span><span class="op" id="2013608">,</span>&nbsp;<span class="ident" id="2013610">digs</span><span class="op" id="2013614">,</span>&nbsp;<span class="ident" id="2013616">max</span><span class="op" id="2013619">(</span><span class="ident" id="2013620">prec</span><span class="op" id="2013624">-</span><span class="ident" id="2013625">digs</span><span class="op" id="2013629">.</span><span class="ident" id="2013630">dp</span><span class="op" id="2013632">,</span>&nbsp;<span class="num" id="2013634">0</span><span class="op" id="2013635">)</span><span class="op" id="2013636">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2013639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013643">//&nbsp;unknown&nbsp;format</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2013662">return</span>&nbsp;<span class="builtinfunc" id="2013669">append</span><span class="op" id="2013675">(</span><span class="ident" id="2013676">dst</span><span class="op" id="2013679">,</span>&nbsp;<span class="string" id="2013681">&#39;%&#39;</span><span class="op" id="2013684">,</span>&nbsp;<span class="ident" id="2013686">fmt</span><span class="op" id="2013689">)</span><br>
<span class="lineno"></span><span class="op" id="2013691">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="2013694">//&nbsp;Round&nbsp;d&nbsp;(=&nbsp;mant&nbsp;*&nbsp;2^exp)&nbsp;to&nbsp;the&nbsp;shortest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2013755">//&nbsp;that&nbsp;will&nbsp;let&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;value&nbsp;be&nbsp;precisely</span><br>
<span class="lineno"></span><span class="comment" id="2013819">//&nbsp;reconstructed.&nbsp;&nbsp;Size&nbsp;is&nbsp;original&nbsp;floating&nbsp;point&nbsp;size&nbsp;(64&nbsp;or&nbsp;32).</span><br>
<span class="lineno"></span><span class="keyword" id="2013887">func</span>&nbsp;<span class="ident" id="2013892">roundShortest</span><span class="op" id="2013905">(</span><span class="ident" id="2013906">d</span>&nbsp;<span class="op" id="2013908">*</span><span class="ident" id="2013909">decimal</span><span class="op" id="2013916">,</span>&nbsp;<span class="ident" id="2013918">mant</span>&nbsp;<span class="ident" id="2013923">uint64</span><span class="op" id="2013929">,</span>&nbsp;<span class="ident" id="2013931">exp</span>&nbsp;<span class="builtintype" id="2013935">int</span><span class="op" id="2013938">,</span>&nbsp;<span class="ident" id="2013940">flt</span>&nbsp;<span class="op" id="2013944">*</span><span class="ident" id="2013945">floatInfo</span><span class="op" id="2013954">)</span>&nbsp;<span class="op" id="2013956">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2013959">//&nbsp;If&nbsp;mantissa&nbsp;is&nbsp;zero,&nbsp;the&nbsp;number&nbsp;is&nbsp;zero;&nbsp;stop&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014014">if</span>&nbsp;<span class="ident" id="2014017">mant</span>&nbsp;<span class="op" id="2014022">==</span>&nbsp;<span class="num" id="2014025">0</span>&nbsp;<span class="op" id="2014027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014031">d</span><span class="op" id="2014032">.</span><span class="ident" id="2014033">nd</span>&nbsp;<span class="op" id="2014036">=</span>&nbsp;<span class="num" id="2014038">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014042">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2014050">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014054">//&nbsp;Compute&nbsp;upper&nbsp;and&nbsp;lower&nbsp;such&nbsp;that&nbsp;any&nbsp;decimal&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014111">//&nbsp;between&nbsp;upper&nbsp;and&nbsp;lower&nbsp;(possibly&nbsp;inclusive)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014160">//&nbsp;will&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;number.</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014215">//&nbsp;We&nbsp;may&nbsp;see&nbsp;at&nbsp;once&nbsp;that&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014275">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014279">//&nbsp;Suppose&nbsp;d&nbsp;is&nbsp;not&nbsp;denormal,&nbsp;so&nbsp;that&nbsp;2^exp&nbsp;&lt;=&nbsp;d&nbsp;&lt;&nbsp;10^dp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014338">//&nbsp;The&nbsp;closest&nbsp;shorter&nbsp;number&nbsp;is&nbsp;at&nbsp;least&nbsp;10^(dp-nd)&nbsp;away.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014398">//&nbsp;The&nbsp;lower/upper&nbsp;bounds&nbsp;computed&nbsp;below&nbsp;are&nbsp;at&nbsp;distance</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014456">//&nbsp;at&nbsp;most&nbsp;2^(exp-mantbits).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014486">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014490">//&nbsp;So&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest&nbsp;if&nbsp;10^(dp-nd)&nbsp;&gt;&nbsp;2^(exp-mantbits),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014562">//&nbsp;or&nbsp;equivalently&nbsp;log2(10)*(dp-nd)&nbsp;&gt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014615">//&nbsp;It&nbsp;is&nbsp;true&nbsp;if&nbsp;332/100*(dp-nd)&nbsp;&gt;=&nbsp;exp-mantbits&nbsp;(log2(10)&nbsp;&gt;&nbsp;3.32).</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2014684">minexp</span>&nbsp;<span class="op" id="2014691">:=</span>&nbsp;<span class="ident" id="2014694">flt</span><span class="op" id="2014697">.</span><span class="ident" id="2014698">bias</span>&nbsp;<span class="op" id="2014703">+</span>&nbsp;<span class="num" id="2014705">1</span>&nbsp;<span class="comment" id="2014707">//&nbsp;minimum&nbsp;possible&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014737">if</span>&nbsp;<span class="ident" id="2014740">exp</span>&nbsp;<span class="op" id="2014744">&gt;</span>&nbsp;<span class="ident" id="2014746">minexp</span>&nbsp;<span class="op" id="2014753">&amp;&amp;</span>&nbsp;<span class="num" id="2014756">332</span><span class="op" id="2014759">*</span><span class="op" id="2014760">(</span><span class="ident" id="2014761">d</span><span class="op" id="2014762">.</span><span class="ident" id="2014763">dp</span><span class="op" id="2014765">-</span><span class="ident" id="2014766">d</span><span class="op" id="2014767">.</span><span class="ident" id="2014768">nd</span><span class="op" id="2014770">)</span>&nbsp;<span class="op" id="2014772">&gt;=</span>&nbsp;<span class="num" id="2014775">100</span><span class="op" id="2014778">*</span><span class="op" id="2014779">(</span><span class="ident" id="2014780">exp</span><span class="op" id="2014783">-</span><span class="builtintype" id="2014784">int</span><span class="op" id="2014787">(</span><span class="ident" id="2014788">flt</span><span class="op" id="2014791">.</span><span class="ident" id="2014792">mantbits</span><span class="op" id="2014800">)</span><span class="op" id="2014801">)</span>&nbsp;<span class="op" id="2014803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014807">//&nbsp;The&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2014844">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2014852">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014856">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014889">//&nbsp;Next&nbsp;highest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant+1&nbsp;&lt;&lt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2014955">//&nbsp;Our&nbsp;upper&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mant*2+1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015023">upper</span>&nbsp;<span class="op" id="2015029">:=</span>&nbsp;<span class="builtinfunc" id="2015032">new</span><span class="op" id="2015035">(</span><span class="ident" id="2015036">decimal</span><span class="op" id="2015043">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015046">upper</span><span class="op" id="2015051">.</span><span class="ident" id="2015052">Assign</span><span class="op" id="2015058">(</span><span class="ident" id="2015059">mant</span><span class="op" id="2015063">*</span><span class="num" id="2015064">2</span>&nbsp;<span class="op" id="2015066">+</span>&nbsp;<span class="num" id="2015068">1</span><span class="op" id="2015069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015072">upper</span><span class="op" id="2015077">.</span><span class="ident" id="2015078">Shift</span><span class="op" id="2015083">(</span><span class="ident" id="2015084">exp</span>&nbsp;<span class="op" id="2015088">-</span>&nbsp;<span class="builtintype" id="2015090">int</span><span class="op" id="2015093">(</span><span class="ident" id="2015094">flt</span><span class="op" id="2015097">.</span><span class="ident" id="2015098">mantbits</span><span class="op" id="2015106">)</span>&nbsp;<span class="op" id="2015108">-</span>&nbsp;<span class="num" id="2015110">1</span><span class="op" id="2015111">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015115">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015148">//&nbsp;Next&nbsp;lowest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant-1&nbsp;&lt;&lt;&nbsp;exp-mantbits,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015213">//&nbsp;unless&nbsp;mant-1&nbsp;drops&nbsp;the&nbsp;significant&nbsp;bit&nbsp;and&nbsp;exp&nbsp;is&nbsp;not&nbsp;the&nbsp;minimum&nbsp;exp,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015289">//&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;next&nbsp;lowest&nbsp;is&nbsp;mant*2-1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015354">//&nbsp;Either&nbsp;way,&nbsp;call&nbsp;it&nbsp;mantlo&nbsp;&lt;&lt;&nbsp;explo-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015404">//&nbsp;Our&nbsp;lower&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mantlo*2+1&nbsp;&lt;&lt;&nbsp;explo-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015476">var</span>&nbsp;<span class="ident" id="2015480">mantlo</span>&nbsp;<span class="ident" id="2015487">uint64</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015495">var</span>&nbsp;<span class="ident" id="2015499">explo</span>&nbsp;<span class="builtintype" id="2015505">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2015510">if</span>&nbsp;<span class="ident" id="2015513">mant</span>&nbsp;<span class="op" id="2015518">&gt;</span>&nbsp;<span class="num" id="2015520">1</span><span class="op" id="2015521">&lt;&lt;</span><span class="ident" id="2015523">flt</span><span class="op" id="2015526">.</span><span class="ident" id="2015527">mantbits</span>&nbsp;<span class="op" id="2015536">||</span>&nbsp;<span class="ident" id="2015539">exp</span>&nbsp;<span class="op" id="2015543">==</span>&nbsp;<span class="ident" id="2015546">minexp</span>&nbsp;<span class="op" id="2015553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015557">mantlo</span>&nbsp;<span class="op" id="2015564">=</span>&nbsp;<span class="ident" id="2015566">mant</span>&nbsp;<span class="op" id="2015571">-</span>&nbsp;<span class="num" id="2015573">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015577">explo</span>&nbsp;<span class="op" id="2015583">=</span>&nbsp;<span class="ident" id="2015585">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015590">}</span>&nbsp;<span class="keyword" id="2015592">else</span>&nbsp;<span class="op" id="2015597">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015601">mantlo</span>&nbsp;<span class="op" id="2015608">=</span>&nbsp;<span class="ident" id="2015610">mant</span><span class="op" id="2015614">*</span><span class="num" id="2015615">2</span>&nbsp;<span class="op" id="2015617">-</span>&nbsp;<span class="num" id="2015619">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015623">explo</span>&nbsp;<span class="op" id="2015629">=</span>&nbsp;<span class="ident" id="2015631">exp</span>&nbsp;<span class="op" id="2015635">-</span>&nbsp;<span class="num" id="2015637">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2015640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015643">lower</span>&nbsp;<span class="op" id="2015649">:=</span>&nbsp;<span class="builtinfunc" id="2015652">new</span><span class="op" id="2015655">(</span><span class="ident" id="2015656">decimal</span><span class="op" id="2015663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015666">lower</span><span class="op" id="2015671">.</span><span class="ident" id="2015672">Assign</span><span class="op" id="2015678">(</span><span class="ident" id="2015679">mantlo</span><span class="op" id="2015685">*</span><span class="num" id="2015686">2</span>&nbsp;<span class="op" id="2015688">+</span>&nbsp;<span class="num" id="2015690">1</span><span class="op" id="2015691">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015694">lower</span><span class="op" id="2015699">.</span><span class="ident" id="2015700">Shift</span><span class="op" id="2015705">(</span><span class="ident" id="2015706">explo</span>&nbsp;<span class="op" id="2015712">-</span>&nbsp;<span class="builtintype" id="2015714">int</span><span class="op" id="2015717">(</span><span class="ident" id="2015718">flt</span><span class="op" id="2015721">.</span><span class="ident" id="2015722">mantbits</span><span class="op" id="2015730">)</span>&nbsp;<span class="op" id="2015732">-</span>&nbsp;<span class="num" id="2015734">1</span><span class="op" id="2015735">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015739">//&nbsp;The&nbsp;upper&nbsp;and&nbsp;lower&nbsp;bounds&nbsp;are&nbsp;possible&nbsp;outputs&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015799">//&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;is&nbsp;even,&nbsp;so&nbsp;that&nbsp;IEEE&nbsp;round-to-even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015861">//&nbsp;would&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;and&nbsp;not&nbsp;the&nbsp;neighbors.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2015925">inclusive</span>&nbsp;<span class="op" id="2015935">:=</span>&nbsp;<span class="ident" id="2015938">mant</span><span class="op" id="2015942">%</span><span class="num" id="2015943">2</span>&nbsp;<span class="op" id="2015945">==</span>&nbsp;<span class="num" id="2015948">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2015952">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;figure&nbsp;out&nbsp;the&nbsp;minimum&nbsp;number&nbsp;of&nbsp;digits&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016017">//&nbsp;Walk&nbsp;along&nbsp;until&nbsp;d&nbsp;has&nbsp;distinguished&nbsp;itself&nbsp;from&nbsp;upper&nbsp;and&nbsp;lower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016087">for</span>&nbsp;<span class="ident" id="2016091">i</span>&nbsp;<span class="op" id="2016093">:=</span>&nbsp;<span class="num" id="2016096">0</span><span class="op" id="2016097">;</span>&nbsp;<span class="ident" id="2016099">i</span>&nbsp;<span class="op" id="2016101">&lt;</span>&nbsp;<span class="ident" id="2016103">d</span><span class="op" id="2016104">.</span><span class="ident" id="2016105">nd</span><span class="op" id="2016107">;</span>&nbsp;<span class="ident" id="2016109">i</span><span class="op" id="2016110">++</span>&nbsp;<span class="op" id="2016113">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016117">var</span>&nbsp;<span class="ident" id="2016121">l</span><span class="op" id="2016122">,</span>&nbsp;<span class="ident" id="2016124">m</span><span class="op" id="2016125">,</span>&nbsp;<span class="ident" id="2016127">u</span>&nbsp;<span class="builtintype" id="2016129">byte</span>&nbsp;<span class="comment" id="2016134">//&nbsp;lower,&nbsp;middle,&nbsp;upper&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016167">if</span>&nbsp;<span class="ident" id="2016170">i</span>&nbsp;<span class="op" id="2016172">&lt;</span>&nbsp;<span class="ident" id="2016174">lower</span><span class="op" id="2016179">.</span><span class="ident" id="2016180">nd</span>&nbsp;<span class="op" id="2016183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016188">l</span>&nbsp;<span class="op" id="2016190">=</span>&nbsp;<span class="ident" id="2016192">lower</span><span class="op" id="2016197">.</span><span class="ident" id="2016198">d</span><span class="op" id="2016199">[</span><span class="ident" id="2016200">i</span><span class="op" id="2016201">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2016205">}</span>&nbsp;<span class="keyword" id="2016207">else</span>&nbsp;<span class="op" id="2016212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016217">l</span>&nbsp;<span class="op" id="2016219">=</span>&nbsp;<span class="string" id="2016221">&#39;0&#39;</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2016227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016231">m</span>&nbsp;<span class="op" id="2016233">=</span>&nbsp;<span class="ident" id="2016235">d</span><span class="op" id="2016236">.</span><span class="ident" id="2016237">d</span><span class="op" id="2016238">[</span><span class="ident" id="2016239">i</span><span class="op" id="2016240">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016244">if</span>&nbsp;<span class="ident" id="2016247">i</span>&nbsp;<span class="op" id="2016249">&lt;</span>&nbsp;<span class="ident" id="2016251">upper</span><span class="op" id="2016256">.</span><span class="ident" id="2016257">nd</span>&nbsp;<span class="op" id="2016260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016265">u</span>&nbsp;<span class="op" id="2016267">=</span>&nbsp;<span class="ident" id="2016269">upper</span><span class="op" id="2016274">.</span><span class="ident" id="2016275">d</span><span class="op" id="2016276">[</span><span class="ident" id="2016277">i</span><span class="op" id="2016278">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2016282">}</span>&nbsp;<span class="keyword" id="2016284">else</span>&nbsp;<span class="op" id="2016289">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016294">u</span>&nbsp;<span class="op" id="2016296">=</span>&nbsp;<span class="string" id="2016298">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2016304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016309">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;down&nbsp;(truncate)&nbsp;if&nbsp;lower&nbsp;has&nbsp;a&nbsp;different&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016375">//&nbsp;or&nbsp;if&nbsp;lower&nbsp;is&nbsp;inclusive&nbsp;and&nbsp;is&nbsp;exactly&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;down.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016449">okdown</span>&nbsp;<span class="op" id="2016456">:=</span>&nbsp;<span class="ident" id="2016459">l</span>&nbsp;<span class="op" id="2016461">!=</span>&nbsp;<span class="ident" id="2016464">m</span>&nbsp;<span class="op" id="2016466">||</span>&nbsp;<span class="op" id="2016469">(</span><span class="ident" id="2016470">inclusive</span>&nbsp;<span class="op" id="2016480">&amp;&amp;</span>&nbsp;<span class="ident" id="2016483">l</span>&nbsp;<span class="op" id="2016485">==</span>&nbsp;<span class="ident" id="2016488">m</span>&nbsp;<span class="op" id="2016490">&amp;&amp;</span>&nbsp;<span class="ident" id="2016493">i</span><span class="op" id="2016494">+</span><span class="num" id="2016495">1</span>&nbsp;<span class="op" id="2016497">==</span>&nbsp;<span class="ident" id="2016500">lower</span><span class="op" id="2016505">.</span><span class="ident" id="2016506">nd</span><span class="op" id="2016508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016513">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;up&nbsp;if&nbsp;upper&nbsp;has&nbsp;a&nbsp;different&nbsp;digit&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016570">//&nbsp;either&nbsp;upper&nbsp;is&nbsp;inclusive&nbsp;or&nbsp;upper&nbsp;is&nbsp;bigger&nbsp;than&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016652">okup</span>&nbsp;<span class="op" id="2016657">:=</span>&nbsp;<span class="ident" id="2016660">m</span>&nbsp;<span class="op" id="2016662">!=</span>&nbsp;<span class="ident" id="2016665">u</span>&nbsp;<span class="op" id="2016667">&amp;&amp;</span>&nbsp;<span class="op" id="2016670">(</span><span class="ident" id="2016671">inclusive</span>&nbsp;<span class="op" id="2016681">||</span>&nbsp;<span class="ident" id="2016684">m</span><span class="op" id="2016685">+</span><span class="num" id="2016686">1</span>&nbsp;<span class="op" id="2016688">&lt;</span>&nbsp;<span class="ident" id="2016690">u</span>&nbsp;<span class="op" id="2016692">||</span>&nbsp;<span class="ident" id="2016695">i</span><span class="op" id="2016696">+</span><span class="num" id="2016697">1</span>&nbsp;<span class="op" id="2016699">&lt;</span>&nbsp;<span class="ident" id="2016701">upper</span><span class="op" id="2016706">.</span><span class="ident" id="2016707">nd</span><span class="op" id="2016709">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016714">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;either,&nbsp;then&nbsp;round&nbsp;to&nbsp;the&nbsp;nearest&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2016777">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;only&nbsp;one,&nbsp;do&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016818">switch</span>&nbsp;<span class="op" id="2016825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016829">case</span>&nbsp;<span class="ident" id="2016834">okdown</span>&nbsp;<span class="op" id="2016841">&amp;&amp;</span>&nbsp;<span class="ident" id="2016844">okup</span><span class="op" id="2016848">:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016853">d</span><span class="op" id="2016854">.</span><span class="ident" id="2016855">Round</span><span class="op" id="2016860">(</span><span class="ident" id="2016861">i</span>&nbsp;<span class="op" id="2016863">+</span>&nbsp;<span class="num" id="2016865">1</span><span class="op" id="2016866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016871">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016880">case</span>&nbsp;<span class="ident" id="2016885">okdown</span><span class="op" id="2016891">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016896">d</span><span class="op" id="2016897">.</span><span class="ident" id="2016898">RoundDown</span><span class="op" id="2016907">(</span><span class="ident" id="2016908">i</span>&nbsp;<span class="op" id="2016910">+</span>&nbsp;<span class="num" id="2016912">1</span><span class="op" id="2016913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016918">return</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016927">case</span>&nbsp;<span class="ident" id="2016932">okup</span><span class="op" id="2016936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2016941">d</span><span class="op" id="2016942">.</span><span class="ident" id="2016943">RoundUp</span><span class="op" id="2016950">(</span><span class="ident" id="2016951">i</span>&nbsp;<span class="op" id="2016953">+</span>&nbsp;<span class="num" id="2016955">1</span><span class="op" id="2016956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2016961">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2016970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2016973">}</span><br>
<span class="lineno">325</span><span class="op" id="2016975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2016978">type</span>&nbsp;<span class="ident" id="2016983">decimalSlice</span>&nbsp;<span class="keyword" id="2016996">struct</span>&nbsp;<span class="op" id="2017003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017006">d</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2017013">[</span><span class="op" id="2017014">]</span><span class="builtintype" id="2017015">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017021">nd</span><span class="op" id="2017023">,</span>&nbsp;<span class="ident" id="2017025">dp</span>&nbsp;<span class="builtintype" id="2017028">int</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017033">neg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2017040">bool</span><br>
<span class="lineno"></span><span class="op" id="2017045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2017048">//&nbsp;%e:&nbsp;-d.ddddde±dd</span><br>
<span class="lineno"></span><span class="keyword" id="2017069">func</span>&nbsp;<span class="ident" id="2017074">fmtE</span><span class="op" id="2017078">(</span><span class="ident" id="2017079">dst</span>&nbsp;<span class="op" id="2017083">[</span><span class="op" id="2017084">]</span><span class="builtintype" id="2017085">byte</span><span class="op" id="2017089">,</span>&nbsp;<span class="ident" id="2017091">neg</span>&nbsp;<span class="builtintype" id="2017095">bool</span><span class="op" id="2017099">,</span>&nbsp;<span class="ident" id="2017101">d</span>&nbsp;<span class="ident" id="2017103">decimalSlice</span><span class="op" id="2017115">,</span>&nbsp;<span class="ident" id="2017117">prec</span>&nbsp;<span class="builtintype" id="2017122">int</span><span class="op" id="2017125">,</span>&nbsp;<span class="ident" id="2017127">fmt</span>&nbsp;<span class="builtintype" id="2017131">byte</span><span class="op" id="2017135">)</span>&nbsp;<span class="op" id="2017137">[</span><span class="op" id="2017138">]</span><span class="builtintype" id="2017139">byte</span>&nbsp;<span class="op" id="2017144">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017147">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017156">if</span>&nbsp;<span class="ident" id="2017159">neg</span>&nbsp;<span class="op" id="2017163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017167">dst</span>&nbsp;<span class="op" id="2017171">=</span>&nbsp;<span class="builtinfunc" id="2017173">append</span><span class="op" id="2017179">(</span><span class="ident" id="2017180">dst</span><span class="op" id="2017183">,</span>&nbsp;<span class="string" id="2017185">&#39;-&#39;</span><span class="op" id="2017188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017195">//&nbsp;first&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017211">ch</span>&nbsp;<span class="op" id="2017214">:=</span>&nbsp;<span class="builtintype" id="2017217">byte</span><span class="op" id="2017221">(</span><span class="string" id="2017222">&#39;0&#39;</span><span class="op" id="2017225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017228">if</span>&nbsp;<span class="ident" id="2017231">d</span><span class="op" id="2017232">.</span><span class="ident" id="2017233">nd</span>&nbsp;<span class="op" id="2017236">!=</span>&nbsp;<span class="num" id="2017239">0</span>&nbsp;<span class="op" id="2017241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017245">ch</span>&nbsp;<span class="op" id="2017248">=</span>&nbsp;<span class="ident" id="2017250">d</span><span class="op" id="2017251">.</span><span class="ident" id="2017252">d</span><span class="op" id="2017253">[</span><span class="num" id="2017254">0</span><span class="op" id="2017255">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017258">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017261">dst</span>&nbsp;<span class="op" id="2017265">=</span>&nbsp;<span class="builtinfunc" id="2017267">append</span><span class="op" id="2017273">(</span><span class="ident" id="2017274">dst</span><span class="op" id="2017277">,</span>&nbsp;<span class="ident" id="2017279">ch</span><span class="op" id="2017281">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017285">//&nbsp;.moredigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017301">if</span>&nbsp;<span class="ident" id="2017304">prec</span>&nbsp;<span class="op" id="2017309">&gt;</span>&nbsp;<span class="num" id="2017311">0</span>&nbsp;<span class="op" id="2017313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017317">dst</span>&nbsp;<span class="op" id="2017321">=</span>&nbsp;<span class="builtinfunc" id="2017323">append</span><span class="op" id="2017329">(</span><span class="ident" id="2017330">dst</span><span class="op" id="2017333">,</span>&nbsp;<span class="string" id="2017335">&#39;.&#39;</span><span class="op" id="2017338">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017342">i</span>&nbsp;<span class="op" id="2017344">:=</span>&nbsp;<span class="num" id="2017347">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017351">m</span>&nbsp;<span class="op" id="2017353">:=</span>&nbsp;<span class="ident" id="2017356">d</span><span class="op" id="2017357">.</span><span class="ident" id="2017358">nd</span>&nbsp;<span class="op" id="2017361">+</span>&nbsp;<span class="ident" id="2017363">prec</span>&nbsp;<span class="op" id="2017368">+</span>&nbsp;<span class="num" id="2017370">1</span>&nbsp;<span class="op" id="2017372">-</span>&nbsp;<span class="ident" id="2017374">max</span><span class="op" id="2017377">(</span><span class="ident" id="2017378">d</span><span class="op" id="2017379">.</span><span class="ident" id="2017380">nd</span><span class="op" id="2017382">,</span>&nbsp;<span class="ident" id="2017384">prec</span><span class="op" id="2017388">+</span><span class="num" id="2017389">1</span><span class="op" id="2017390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017394">for</span>&nbsp;<span class="ident" id="2017398">i</span>&nbsp;<span class="op" id="2017400">&lt;</span>&nbsp;<span class="ident" id="2017402">m</span>&nbsp;<span class="op" id="2017404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017409">dst</span>&nbsp;<span class="op" id="2017413">=</span>&nbsp;<span class="builtinfunc" id="2017415">append</span><span class="op" id="2017421">(</span><span class="ident" id="2017422">dst</span><span class="op" id="2017425">,</span>&nbsp;<span class="ident" id="2017427">d</span><span class="op" id="2017428">.</span><span class="ident" id="2017429">d</span><span class="op" id="2017430">[</span><span class="ident" id="2017431">i</span><span class="op" id="2017432">]</span><span class="op" id="2017433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017438">i</span><span class="op" id="2017439">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017448">for</span>&nbsp;<span class="ident" id="2017452">i</span>&nbsp;<span class="op" id="2017454">&lt;=</span>&nbsp;<span class="ident" id="2017457">prec</span>&nbsp;<span class="op" id="2017462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017467">dst</span>&nbsp;<span class="op" id="2017471">=</span>&nbsp;<span class="builtinfunc" id="2017473">append</span><span class="op" id="2017479">(</span><span class="ident" id="2017480">dst</span><span class="op" id="2017483">,</span>&nbsp;<span class="string" id="2017485">&#39;0&#39;</span><span class="op" id="2017488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017493">i</span><span class="op" id="2017494">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017499">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017506">//&nbsp;e±</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017514">dst</span>&nbsp;<span class="op" id="2017518">=</span>&nbsp;<span class="builtinfunc" id="2017520">append</span><span class="op" id="2017526">(</span><span class="ident" id="2017527">dst</span><span class="op" id="2017530">,</span>&nbsp;<span class="ident" id="2017532">fmt</span><span class="op" id="2017535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017538">exp</span>&nbsp;<span class="op" id="2017542">:=</span>&nbsp;<span class="ident" id="2017545">d</span><span class="op" id="2017546">.</span><span class="ident" id="2017547">dp</span>&nbsp;<span class="op" id="2017550">-</span>&nbsp;<span class="num" id="2017552">1</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017555">if</span>&nbsp;<span class="ident" id="2017558">d</span><span class="op" id="2017559">.</span><span class="ident" id="2017560">nd</span>&nbsp;<span class="op" id="2017563">==</span>&nbsp;<span class="num" id="2017566">0</span>&nbsp;<span class="op" id="2017568">{</span>&nbsp;<span class="comment" id="2017570">//&nbsp;special&nbsp;case:&nbsp;0&nbsp;has&nbsp;exponent&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017606">exp</span>&nbsp;<span class="op" id="2017610">=</span>&nbsp;<span class="num" id="2017612">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017618">if</span>&nbsp;<span class="ident" id="2017621">exp</span>&nbsp;<span class="op" id="2017625">&lt;</span>&nbsp;<span class="num" id="2017627">0</span>&nbsp;<span class="op" id="2017629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017633">ch</span>&nbsp;<span class="op" id="2017636">=</span>&nbsp;<span class="string" id="2017638">&#39;-&#39;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017644">exp</span>&nbsp;<span class="op" id="2017648">=</span>&nbsp;<span class="op" id="2017650">-</span><span class="ident" id="2017651">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017656">}</span>&nbsp;<span class="keyword" id="2017658">else</span>&nbsp;<span class="op" id="2017663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017667">ch</span>&nbsp;<span class="op" id="2017670">=</span>&nbsp;<span class="string" id="2017672">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017680">dst</span>&nbsp;<span class="op" id="2017684">=</span>&nbsp;<span class="builtinfunc" id="2017686">append</span><span class="op" id="2017692">(</span><span class="ident" id="2017693">dst</span><span class="op" id="2017696">,</span>&nbsp;<span class="ident" id="2017698">ch</span><span class="op" id="2017700">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017704">//&nbsp;dddd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017713">var</span>&nbsp;<span class="ident" id="2017717">buf</span>&nbsp;<span class="op" id="2017721">[</span><span class="num" id="2017722">3</span><span class="op" id="2017723">]</span><span class="builtintype" id="2017724">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017730">i</span>&nbsp;<span class="op" id="2017732">:=</span>&nbsp;<span class="builtinfunc" id="2017735">len</span><span class="op" id="2017738">(</span><span class="ident" id="2017739">buf</span><span class="op" id="2017742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017745">for</span>&nbsp;<span class="ident" id="2017749">exp</span>&nbsp;<span class="op" id="2017753">&gt;=</span>&nbsp;<span class="num" id="2017756">10</span>&nbsp;<span class="op" id="2017759">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017763">i</span><span class="op" id="2017764">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017769">buf</span><span class="op" id="2017772">[</span><span class="ident" id="2017773">i</span><span class="op" id="2017774">]</span>&nbsp;<span class="op" id="2017776">=</span>&nbsp;<span class="builtintype" id="2017778">byte</span><span class="op" id="2017782">(</span><span class="ident" id="2017783">exp</span><span class="op" id="2017786">%</span><span class="num" id="2017787">10</span>&nbsp;<span class="op" id="2017790">+</span>&nbsp;<span class="string" id="2017792">&#39;0&#39;</span><span class="op" id="2017795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017799">exp</span>&nbsp;<span class="op" id="2017803">/=</span>&nbsp;<span class="num" id="2017806">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2017810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017813">//&nbsp;exp&nbsp;&lt;&nbsp;10</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017826">i</span><span class="op" id="2017827">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017831">buf</span><span class="op" id="2017834">[</span><span class="ident" id="2017835">i</span><span class="op" id="2017836">]</span>&nbsp;<span class="op" id="2017838">=</span>&nbsp;<span class="builtintype" id="2017840">byte</span><span class="op" id="2017844">(</span><span class="ident" id="2017845">exp</span>&nbsp;<span class="op" id="2017849">+</span>&nbsp;<span class="string" id="2017851">&#39;0&#39;</span><span class="op" id="2017854">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017858">switch</span>&nbsp;<span class="ident" id="2017865">i</span>&nbsp;<span class="op" id="2017867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017870">case</span>&nbsp;<span class="num" id="2017875">0</span><span class="op" id="2017876">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017880">dst</span>&nbsp;<span class="op" id="2017884">=</span>&nbsp;<span class="builtinfunc" id="2017886">append</span><span class="op" id="2017892">(</span><span class="ident" id="2017893">dst</span><span class="op" id="2017896">,</span>&nbsp;<span class="ident" id="2017898">buf</span><span class="op" id="2017901">[</span><span class="num" id="2017902">0</span><span class="op" id="2017903">]</span><span class="op" id="2017904">,</span>&nbsp;<span class="ident" id="2017906">buf</span><span class="op" id="2017909">[</span><span class="num" id="2017910">1</span><span class="op" id="2017911">]</span><span class="op" id="2017912">,</span>&nbsp;<span class="ident" id="2017914">buf</span><span class="op" id="2017917">[</span><span class="num" id="2017918">2</span><span class="op" id="2017919">]</span><span class="op" id="2017920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017923">case</span>&nbsp;<span class="num" id="2017928">1</span><span class="op" id="2017929">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017933">dst</span>&nbsp;<span class="op" id="2017937">=</span>&nbsp;<span class="builtinfunc" id="2017939">append</span><span class="op" id="2017945">(</span><span class="ident" id="2017946">dst</span><span class="op" id="2017949">,</span>&nbsp;<span class="ident" id="2017951">buf</span><span class="op" id="2017954">[</span><span class="num" id="2017955">1</span><span class="op" id="2017956">]</span><span class="op" id="2017957">,</span>&nbsp;<span class="ident" id="2017959">buf</span><span class="op" id="2017962">[</span><span class="num" id="2017963">2</span><span class="op" id="2017964">]</span><span class="op" id="2017965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2017968">case</span>&nbsp;<span class="num" id="2017973">2</span><span class="op" id="2017974">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2017978">//&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2017998">dst</span>&nbsp;<span class="op" id="2018002">=</span>&nbsp;<span class="builtinfunc" id="2018004">append</span><span class="op" id="2018010">(</span><span class="ident" id="2018011">dst</span><span class="op" id="2018014">,</span>&nbsp;<span class="string" id="2018016">&#39;0&#39;</span><span class="op" id="2018019">,</span>&nbsp;<span class="ident" id="2018021">buf</span><span class="op" id="2018024">[</span><span class="num" id="2018025">2</span><span class="op" id="2018026">]</span><span class="op" id="2018027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018033">return</span>&nbsp;<span class="ident" id="2018040">dst</span><br>
<span class="lineno"></span><span class="op" id="2018044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="2018047">//&nbsp;%f:&nbsp;-ddddddd.ddddd</span><br>
<span class="lineno"></span><span class="keyword" id="2018069">func</span>&nbsp;<span class="ident" id="2018074">fmtF</span><span class="op" id="2018078">(</span><span class="ident" id="2018079">dst</span>&nbsp;<span class="op" id="2018083">[</span><span class="op" id="2018084">]</span><span class="builtintype" id="2018085">byte</span><span class="op" id="2018089">,</span>&nbsp;<span class="ident" id="2018091">neg</span>&nbsp;<span class="builtintype" id="2018095">bool</span><span class="op" id="2018099">,</span>&nbsp;<span class="ident" id="2018101">d</span>&nbsp;<span class="ident" id="2018103">decimalSlice</span><span class="op" id="2018115">,</span>&nbsp;<span class="ident" id="2018117">prec</span>&nbsp;<span class="builtintype" id="2018122">int</span><span class="op" id="2018125">)</span>&nbsp;<span class="op" id="2018127">[</span><span class="op" id="2018128">]</span><span class="builtintype" id="2018129">byte</span>&nbsp;<span class="op" id="2018134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018137">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018146">if</span>&nbsp;<span class="ident" id="2018149">neg</span>&nbsp;<span class="op" id="2018153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018157">dst</span>&nbsp;<span class="op" id="2018161">=</span>&nbsp;<span class="builtinfunc" id="2018163">append</span><span class="op" id="2018169">(</span><span class="ident" id="2018170">dst</span><span class="op" id="2018173">,</span>&nbsp;<span class="string" id="2018175">&#39;-&#39;</span><span class="op" id="2018178">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018185">//&nbsp;integer,&nbsp;padded&nbsp;with&nbsp;zeros&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018227">if</span>&nbsp;<span class="ident" id="2018230">d</span><span class="op" id="2018231">.</span><span class="ident" id="2018232">dp</span>&nbsp;<span class="op" id="2018235">&gt;</span>&nbsp;<span class="num" id="2018237">0</span>&nbsp;<span class="op" id="2018239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018243">var</span>&nbsp;<span class="ident" id="2018247">i</span>&nbsp;<span class="builtintype" id="2018249">int</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018255">for</span>&nbsp;<span class="ident" id="2018259">i</span>&nbsp;<span class="op" id="2018261">=</span>&nbsp;<span class="num" id="2018263">0</span><span class="op" id="2018264">;</span>&nbsp;<span class="ident" id="2018266">i</span>&nbsp;<span class="op" id="2018268">&lt;</span>&nbsp;<span class="ident" id="2018270">d</span><span class="op" id="2018271">.</span><span class="ident" id="2018272">dp</span>&nbsp;<span class="op" id="2018275">&amp;&amp;</span>&nbsp;<span class="ident" id="2018278">i</span>&nbsp;<span class="op" id="2018280">&lt;</span>&nbsp;<span class="ident" id="2018282">d</span><span class="op" id="2018283">.</span><span class="ident" id="2018284">nd</span><span class="op" id="2018286">;</span>&nbsp;<span class="ident" id="2018288">i</span><span class="op" id="2018289">++</span>&nbsp;<span class="op" id="2018292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018297">dst</span>&nbsp;<span class="op" id="2018301">=</span>&nbsp;<span class="builtinfunc" id="2018303">append</span><span class="op" id="2018309">(</span><span class="ident" id="2018310">dst</span><span class="op" id="2018313">,</span>&nbsp;<span class="ident" id="2018315">d</span><span class="op" id="2018316">.</span><span class="ident" id="2018317">d</span><span class="op" id="2018318">[</span><span class="ident" id="2018319">i</span><span class="op" id="2018320">]</span><span class="op" id="2018321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018329">for</span>&nbsp;<span class="op" id="2018333">;</span>&nbsp;<span class="ident" id="2018335">i</span>&nbsp;<span class="op" id="2018337">&lt;</span>&nbsp;<span class="ident" id="2018339">d</span><span class="op" id="2018340">.</span><span class="ident" id="2018341">dp</span><span class="op" id="2018343">;</span>&nbsp;<span class="ident" id="2018345">i</span><span class="op" id="2018346">++</span>&nbsp;<span class="op" id="2018349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018354">dst</span>&nbsp;<span class="op" id="2018358">=</span>&nbsp;<span class="builtinfunc" id="2018360">append</span><span class="op" id="2018366">(</span><span class="ident" id="2018367">dst</span><span class="op" id="2018370">,</span>&nbsp;<span class="string" id="2018372">&#39;0&#39;</span><span class="op" id="2018375">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018382">}</span>&nbsp;<span class="keyword" id="2018384">else</span>&nbsp;<span class="op" id="2018389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018393">dst</span>&nbsp;<span class="op" id="2018397">=</span>&nbsp;<span class="builtinfunc" id="2018399">append</span><span class="op" id="2018405">(</span><span class="ident" id="2018406">dst</span><span class="op" id="2018409">,</span>&nbsp;<span class="string" id="2018411">&#39;0&#39;</span><span class="op" id="2018414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2018421">//&nbsp;fraction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018434">if</span>&nbsp;<span class="ident" id="2018437">prec</span>&nbsp;<span class="op" id="2018442">&gt;</span>&nbsp;<span class="num" id="2018444">0</span>&nbsp;<span class="op" id="2018446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018450">dst</span>&nbsp;<span class="op" id="2018454">=</span>&nbsp;<span class="builtinfunc" id="2018456">append</span><span class="op" id="2018462">(</span><span class="ident" id="2018463">dst</span><span class="op" id="2018466">,</span>&nbsp;<span class="string" id="2018468">&#39;.&#39;</span><span class="op" id="2018471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018475">for</span>&nbsp;<span class="ident" id="2018479">i</span>&nbsp;<span class="op" id="2018481">:=</span>&nbsp;<span class="num" id="2018484">0</span><span class="op" id="2018485">;</span>&nbsp;<span class="ident" id="2018487">i</span>&nbsp;<span class="op" id="2018489">&lt;</span>&nbsp;<span class="ident" id="2018491">prec</span><span class="op" id="2018495">;</span>&nbsp;<span class="ident" id="2018497">i</span><span class="op" id="2018498">++</span>&nbsp;<span class="op" id="2018501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018506">ch</span>&nbsp;<span class="op" id="2018509">:=</span>&nbsp;<span class="builtintype" id="2018512">byte</span><span class="op" id="2018516">(</span><span class="string" id="2018517">&#39;0&#39;</span><span class="op" id="2018520">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018525">if</span>&nbsp;<span class="ident" id="2018528">j</span>&nbsp;<span class="op" id="2018530">:=</span>&nbsp;<span class="ident" id="2018533">d</span><span class="op" id="2018534">.</span><span class="ident" id="2018535">dp</span>&nbsp;<span class="op" id="2018538">+</span>&nbsp;<span class="ident" id="2018540">i</span><span class="op" id="2018541">;</span>&nbsp;<span class="num" id="2018543">0</span>&nbsp;<span class="op" id="2018545">&lt;=</span>&nbsp;<span class="ident" id="2018548">j</span>&nbsp;<span class="op" id="2018550">&amp;&amp;</span>&nbsp;<span class="ident" id="2018553">j</span>&nbsp;<span class="op" id="2018555">&lt;</span>&nbsp;<span class="ident" id="2018557">d</span><span class="op" id="2018558">.</span><span class="ident" id="2018559">nd</span>&nbsp;<span class="op" id="2018562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018568">ch</span>&nbsp;<span class="op" id="2018571">=</span>&nbsp;<span class="ident" id="2018573">d</span><span class="op" id="2018574">.</span><span class="ident" id="2018575">d</span><span class="op" id="2018576">[</span><span class="ident" id="2018577">j</span><span class="op" id="2018578">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018588">dst</span>&nbsp;<span class="op" id="2018592">=</span>&nbsp;<span class="builtinfunc" id="2018594">append</span><span class="op" id="2018600">(</span><span class="ident" id="2018601">dst</span><span class="op" id="2018604">,</span>&nbsp;<span class="ident" id="2018606">ch</span><span class="op" id="2018608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018612">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018619">return</span>&nbsp;<span class="ident" id="2018626">dst</span><br>
<span class="lineno"></span><span class="op" id="2018630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="comment" id="2018633">//&nbsp;%b:&nbsp;-ddddddddp+ddd</span><br>
<span class="lineno"></span><span class="keyword" id="2018655">func</span>&nbsp;<span class="ident" id="2018660">fmtB</span><span class="op" id="2018664">(</span><span class="ident" id="2018665">dst</span>&nbsp;<span class="op" id="2018669">[</span><span class="op" id="2018670">]</span><span class="builtintype" id="2018671">byte</span><span class="op" id="2018675">,</span>&nbsp;<span class="ident" id="2018677">neg</span>&nbsp;<span class="builtintype" id="2018681">bool</span><span class="op" id="2018685">,</span>&nbsp;<span class="ident" id="2018687">mant</span>&nbsp;<span class="ident" id="2018692">uint64</span><span class="op" id="2018698">,</span>&nbsp;<span class="ident" id="2018700">exp</span>&nbsp;<span class="builtintype" id="2018704">int</span><span class="op" id="2018707">,</span>&nbsp;<span class="ident" id="2018709">flt</span>&nbsp;<span class="op" id="2018713">*</span><span class="ident" id="2018714">floatInfo</span><span class="op" id="2018723">)</span>&nbsp;<span class="op" id="2018725">[</span><span class="op" id="2018726">]</span><span class="builtintype" id="2018727">byte</span>&nbsp;<span class="op" id="2018732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018735">var</span>&nbsp;<span class="ident" id="2018739">buf</span>&nbsp;<span class="op" id="2018743">[</span><span class="num" id="2018744">50</span><span class="op" id="2018746">]</span><span class="builtintype" id="2018747">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018753">w</span>&nbsp;<span class="op" id="2018755">:=</span>&nbsp;<span class="builtinfunc" id="2018758">len</span><span class="op" id="2018761">(</span><span class="ident" id="2018762">buf</span><span class="op" id="2018765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018768">exp</span>&nbsp;<span class="op" id="2018772">-=</span>&nbsp;<span class="builtintype" id="2018775">int</span><span class="op" id="2018778">(</span><span class="ident" id="2018779">flt</span><span class="op" id="2018782">.</span><span class="ident" id="2018783">mantbits</span><span class="op" id="2018791">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018794">esign</span>&nbsp;<span class="op" id="2018800">:=</span>&nbsp;<span class="builtintype" id="2018803">byte</span><span class="op" id="2018807">(</span><span class="string" id="2018808">&#39;+&#39;</span><span class="op" id="2018811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018814">if</span>&nbsp;<span class="ident" id="2018817">exp</span>&nbsp;<span class="op" id="2018821">&lt;</span>&nbsp;<span class="num" id="2018823">0</span>&nbsp;<span class="op" id="2018825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018829">esign</span>&nbsp;<span class="op" id="2018835">=</span>&nbsp;<span class="string" id="2018837">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018843">exp</span>&nbsp;<span class="op" id="2018847">=</span>&nbsp;<span class="op" id="2018849">-</span><span class="ident" id="2018850">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018855">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018858">n</span>&nbsp;<span class="op" id="2018860">:=</span>&nbsp;<span class="num" id="2018863">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018866">for</span>&nbsp;<span class="ident" id="2018870">exp</span>&nbsp;<span class="op" id="2018874">&gt;</span>&nbsp;<span class="num" id="2018876">0</span>&nbsp;<span class="op" id="2018878">||</span>&nbsp;<span class="ident" id="2018881">n</span>&nbsp;<span class="op" id="2018883">&lt;</span>&nbsp;<span class="num" id="2018885">1</span>&nbsp;<span class="op" id="2018887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018891">n</span><span class="op" id="2018892">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018897">w</span><span class="op" id="2018898">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018903">buf</span><span class="op" id="2018906">[</span><span class="ident" id="2018907">w</span><span class="op" id="2018908">]</span>&nbsp;<span class="op" id="2018910">=</span>&nbsp;<span class="builtintype" id="2018912">byte</span><span class="op" id="2018916">(</span><span class="ident" id="2018917">exp</span><span class="op" id="2018920">%</span><span class="num" id="2018921">10</span>&nbsp;<span class="op" id="2018924">+</span>&nbsp;<span class="string" id="2018926">&#39;0&#39;</span><span class="op" id="2018929">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018933">exp</span>&nbsp;<span class="op" id="2018937">/=</span>&nbsp;<span class="num" id="2018940">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2018944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018947">w</span><span class="op" id="2018948">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018952">buf</span><span class="op" id="2018955">[</span><span class="ident" id="2018956">w</span><span class="op" id="2018957">]</span>&nbsp;<span class="op" id="2018959">=</span>&nbsp;<span class="ident" id="2018961">esign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018968">w</span><span class="op" id="2018969">--</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018973">buf</span><span class="op" id="2018976">[</span><span class="ident" id="2018977">w</span><span class="op" id="2018978">]</span>&nbsp;<span class="op" id="2018980">=</span>&nbsp;<span class="string" id="2018982">&#39;p&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2018987">n</span>&nbsp;<span class="op" id="2018989">=</span>&nbsp;<span class="num" id="2018991">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2018994">for</span>&nbsp;<span class="ident" id="2018998">mant</span>&nbsp;<span class="op" id="2019003">&gt;</span>&nbsp;<span class="num" id="2019005">0</span>&nbsp;<span class="op" id="2019007">||</span>&nbsp;<span class="ident" id="2019010">n</span>&nbsp;<span class="op" id="2019012">&lt;</span>&nbsp;<span class="num" id="2019014">1</span>&nbsp;<span class="op" id="2019016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019020">n</span><span class="op" id="2019021">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019026">w</span><span class="op" id="2019027">--</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019032">buf</span><span class="op" id="2019035">[</span><span class="ident" id="2019036">w</span><span class="op" id="2019037">]</span>&nbsp;<span class="op" id="2019039">=</span>&nbsp;<span class="builtintype" id="2019041">byte</span><span class="op" id="2019045">(</span><span class="ident" id="2019046">mant</span><span class="op" id="2019050">%</span><span class="num" id="2019051">10</span>&nbsp;<span class="op" id="2019054">+</span>&nbsp;<span class="string" id="2019056">&#39;0&#39;</span><span class="op" id="2019059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019063">mant</span>&nbsp;<span class="op" id="2019068">/=</span>&nbsp;<span class="num" id="2019071">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2019075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2019078">if</span>&nbsp;<span class="ident" id="2019081">neg</span>&nbsp;<span class="op" id="2019085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019089">w</span><span class="op" id="2019090">--</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2019095">buf</span><span class="op" id="2019098">[</span><span class="ident" id="2019099">w</span><span class="op" id="2019100">]</span>&nbsp;<span class="op" id="2019102">=</span>&nbsp;<span class="string" id="2019104">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2019109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2019112">return</span>&nbsp;<span class="builtinfunc" id="2019119">append</span><span class="op" id="2019125">(</span><span class="ident" id="2019126">dst</span><span class="op" id="2019129">,</span>&nbsp;<span class="ident" id="2019131">buf</span><span class="op" id="2019134">[</span><span class="ident" id="2019135">w</span><span class="op" id="2019136">:</span><span class="op" id="2019137">]</span><span class="op" id="2019138">...</span><span class="op" id="2019141">)</span><br>
<span class="lineno"></span><span class="op" id="2019143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="keyword" id="2019146">func</span>&nbsp;<span class="ident" id="2019151">max</span><span class="op" id="2019154">(</span><span class="ident" id="2019155">a</span><span class="op" id="2019156">,</span>&nbsp;<span class="ident" id="2019158">b</span>&nbsp;<span class="builtintype" id="2019160">int</span><span class="op" id="2019163">)</span>&nbsp;<span class="builtintype" id="2019165">int</span>&nbsp;<span class="op" id="2019169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2019172">if</span>&nbsp;<span class="ident" id="2019175">a</span>&nbsp;<span class="op" id="2019177">&gt;</span>&nbsp;<span class="ident" id="2019179">b</span>&nbsp;<span class="op" id="2019181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2019185">return</span>&nbsp;<span class="ident" id="2019192">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2019195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2019198">return</span>&nbsp;<span class="ident" id="2019205">b</span><br>
<span class="lineno">475</span><span class="op" id="2019207">}</span>
</div>
</body>
</html>
