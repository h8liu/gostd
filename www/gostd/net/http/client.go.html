<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4823313">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4823368">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4823422">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4823473">//&nbsp;HTTP&nbsp;client.&nbsp;See&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="4823503">//</span><br>
<span class="lineno"></span><span class="comment" id="4823506">//&nbsp;This&nbsp;is&nbsp;the&nbsp;high-level&nbsp;Client&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="4823550">//&nbsp;The&nbsp;low-level&nbsp;implementation&nbsp;is&nbsp;in&nbsp;transport.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4823603">package</span>&nbsp;<span class="ident" id="4823611">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4823617">import</span>&nbsp;<span class="op" id="4823624">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4823627">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4823646">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4823656">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4823663">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4823669">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4823682">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4823689">&#34;net/url&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4823700">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4823711">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4823719">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4823726">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4823729">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;an&nbsp;HTTP&nbsp;client.&nbsp;Its&nbsp;zero&nbsp;value&nbsp;(DefaultClient)&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4823796">//&nbsp;usable&nbsp;client&nbsp;that&nbsp;uses&nbsp;DefaultTransport.</span><br>
<span class="lineno"></span><span class="comment" id="4823841">//</span><br>
<span class="lineno"></span><span class="comment" id="4823844">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;typically&nbsp;has&nbsp;internal&nbsp;state&nbsp;(cached&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="4823911">//&nbsp;connections),&nbsp;so&nbsp;Clients&nbsp;should&nbsp;be&nbsp;reused&nbsp;instead&nbsp;of&nbsp;created&nbsp;as</span><br>
<span class="lineno">30</span><span class="comment" id="4823978">//&nbsp;needed.&nbsp;Clients&nbsp;are&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="4824049">//</span><br>
<span class="lineno"></span><span class="comment" id="4824052">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;higher-level&nbsp;than&nbsp;a&nbsp;RoundTripper&nbsp;(such&nbsp;as&nbsp;Transport)</span><br>
<span class="lineno"></span><span class="comment" id="4824120">//&nbsp;and&nbsp;additionally&nbsp;handles&nbsp;HTTP&nbsp;details&nbsp;such&nbsp;as&nbsp;cookies&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4824181">//&nbsp;redirects.</span><br>
<span class="lineno">35</span><span class="keyword" id="4824195">type</span>&nbsp;<span class="ident" id="4824200">Client</span>&nbsp;<span class="keyword" id="4824207">struct</span>&nbsp;<span class="op" id="4824214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824217">//&nbsp;Transport&nbsp;specifies&nbsp;the&nbsp;mechanism&nbsp;by&nbsp;which&nbsp;individual</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824275">//&nbsp;HTTP&nbsp;requests&nbsp;are&nbsp;made.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824303">//&nbsp;If&nbsp;nil,&nbsp;DefaultTransport&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824341">Transport</span>&nbsp;<span class="ident" id="4824351">RoundTripper</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824366">//&nbsp;CheckRedirect&nbsp;specifies&nbsp;the&nbsp;policy&nbsp;for&nbsp;handling&nbsp;redirects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824429">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;not&nbsp;nil,&nbsp;the&nbsp;client&nbsp;calls&nbsp;it&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824489">//&nbsp;following&nbsp;an&nbsp;HTTP&nbsp;redirect.&nbsp;The&nbsp;arguments&nbsp;req&nbsp;and&nbsp;via&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824551">//&nbsp;the&nbsp;upcoming&nbsp;request&nbsp;and&nbsp;the&nbsp;requests&nbsp;made&nbsp;already,&nbsp;oldest</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824614">//&nbsp;first.&nbsp;If&nbsp;CheckRedirect&nbsp;returns&nbsp;an&nbsp;error,&nbsp;the&nbsp;Client&#39;s&nbsp;Get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824677">//&nbsp;method&nbsp;returns&nbsp;both&nbsp;the&nbsp;previous&nbsp;Response&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824727">//&nbsp;CheckRedirect&#39;s&nbsp;error&nbsp;(wrapped&nbsp;in&nbsp;a&nbsp;url.Error)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824789">//&nbsp;issuing&nbsp;the&nbsp;Request&nbsp;req.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824818">//</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824822">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;nil,&nbsp;the&nbsp;Client&nbsp;uses&nbsp;its&nbsp;default&nbsp;policy,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824887">//&nbsp;which&nbsp;is&nbsp;to&nbsp;stop&nbsp;after&nbsp;10&nbsp;consecutive&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4824939">CheckRedirect</span>&nbsp;<span class="keyword" id="4824953">func</span><span class="op" id="4824957">(</span><span class="ident" id="4824958">req</span>&nbsp;<span class="op" id="4824962">*</span><span class="ident" id="4824963">Request</span><span class="op" id="4824970">,</span>&nbsp;<span class="ident" id="4824972">via</span>&nbsp;<span class="op" id="4824976">[</span><span class="op" id="4824977">]</span><span class="op" id="4824978">*</span><span class="ident" id="4824979">Request</span><span class="op" id="4824986">)</span>&nbsp;<span class="builtintype" id="4824988">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4824996">//&nbsp;Jar&nbsp;specifies&nbsp;the&nbsp;cookie&nbsp;jar.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825030">//&nbsp;If&nbsp;Jar&nbsp;is&nbsp;nil,&nbsp;cookies&nbsp;are&nbsp;not&nbsp;sent&nbsp;in&nbsp;requests&nbsp;and&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825094">//&nbsp;in&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825112">Jar</span>&nbsp;<span class="ident" id="4825116">CookieJar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825128">//&nbsp;Timeout&nbsp;specifies&nbsp;a&nbsp;time&nbsp;limit&nbsp;for&nbsp;requests&nbsp;made&nbsp;by&nbsp;this</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825189">//&nbsp;Client.&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;connection&nbsp;time,&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825243">//&nbsp;redirects,&nbsp;and&nbsp;reading&nbsp;the&nbsp;response&nbsp;body.&nbsp;The&nbsp;timer&nbsp;remains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825307">//&nbsp;running&nbsp;after&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do&nbsp;return&nbsp;and&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825364">//&nbsp;interrupt&nbsp;reading&nbsp;of&nbsp;the&nbsp;Response.Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825408">//</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825412">//&nbsp;A&nbsp;Timeout&nbsp;of&nbsp;zero&nbsp;means&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825452">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825456">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;must&nbsp;support&nbsp;the&nbsp;CancelRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825514">//&nbsp;method&nbsp;or&nbsp;Client&nbsp;will&nbsp;return&nbsp;errors&nbsp;when&nbsp;attempting&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825578">//&nbsp;a&nbsp;request&nbsp;with&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do.&nbsp;Client&#39;s&nbsp;default</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4825638">//&nbsp;Transport&nbsp;(DefaultTransport)&nbsp;supports&nbsp;CancelRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4825695">Timeout</span>&nbsp;<span class="ident" id="4825703">time</span><span class="op" id="4825707">.</span><span class="ident" id="4825708">Duration</span><br>
<span class="lineno"></span><span class="op" id="4825717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4825720">//&nbsp;DefaultClient&nbsp;is&nbsp;the&nbsp;default&nbsp;Client&nbsp;and&nbsp;is&nbsp;used&nbsp;by&nbsp;Get,&nbsp;Head,&nbsp;and&nbsp;Post.</span><br>
<span class="lineno">75</span><span class="keyword" id="4825795">var</span>&nbsp;<span class="ident" id="4825799">DefaultClient</span>&nbsp;<span class="op" id="4825813">=</span>&nbsp;<span class="op" id="4825815">&amp;</span><span class="ident" id="4825816">Client</span><span class="op" id="4825822">{</span><span class="op" id="4825823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4825826">//&nbsp;RoundTripper&nbsp;is&nbsp;an&nbsp;interface&nbsp;representing&nbsp;the&nbsp;ability&nbsp;to&nbsp;execute&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4825896">//&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;obtaining&nbsp;the&nbsp;Response&nbsp;for&nbsp;a&nbsp;given&nbsp;Request.</span><br>
<span class="lineno"></span><span class="comment" id="4825968">//</span><br>
<span class="lineno">80</span><span class="comment" id="4825971">//&nbsp;A&nbsp;RoundTripper&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment" id="4826033">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="4826048">type</span>&nbsp;<span class="ident" id="4826053">RoundTripper</span>&nbsp;<span class="keyword" id="4826066">interface</span>&nbsp;<span class="op" id="4826076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4826079">//&nbsp;RoundTrip&nbsp;executes&nbsp;a&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;returning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4826139">//&nbsp;the&nbsp;Response&nbsp;for&nbsp;the&nbsp;request&nbsp;req.&nbsp;&nbsp;RoundTrip&nbsp;should&nbsp;not</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4826199">//&nbsp;attempt&nbsp;to&nbsp;interpret&nbsp;the&nbsp;response.&nbsp;&nbsp;In&nbsp;particular,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4826254">//&nbsp;RoundTrip&nbsp;must&nbsp;return&nbsp;err&nbsp;==&nbsp;nil&nbsp;if&nbsp;it&nbsp;obtained&nbsp;a&nbsp;response,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4826318">//&nbsp;regardless&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;HTTP&nbsp;status&nbsp;code.&nbsp;&nbsp;A&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4826380">//&nbsp;err&nbsp;should&nbsp;be&nbsp;reserved&nbsp;for&nbsp;failure&nbsp;to&nbsp;obtain&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4826441">//&nbsp;Similarly,&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;attempt&nbsp;to&nbsp;handle</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4826495">//&nbsp;higher-level&nbsp;protocol&nbsp;details&nbsp;such&nbsp;as&nbsp;redirects,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4826548">//&nbsp;authentication,&nbsp;or&nbsp;cookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4826580">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4826584">//&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;modify&nbsp;the&nbsp;request,&nbsp;except&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4826640">//&nbsp;consuming&nbsp;and&nbsp;closing&nbsp;the&nbsp;Body,&nbsp;including&nbsp;on&nbsp;errors.&nbsp;The</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4826701">//&nbsp;request&#39;s&nbsp;URL&nbsp;and&nbsp;Header&nbsp;fields&nbsp;are&nbsp;guaranteed&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4826758">//&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4826775">RoundTrip</span><span class="op" id="4826784">(</span><span class="op" id="4826785">*</span><span class="ident" id="4826786">Request</span><span class="op" id="4826793">)</span>&nbsp;<span class="op" id="4826795">(</span><span class="op" id="4826796">*</span><span class="ident" id="4826797">Response</span><span class="op" id="4826805">,</span>&nbsp;<span class="builtintype" id="4826807">error</span><span class="op" id="4826812">)</span><br>
<span class="lineno"></span><span class="op" id="4826814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="4826817">//&nbsp;Given&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host&#34;,&nbsp;&#34;host:port&#34;,&nbsp;or&nbsp;&#34;[ipv6::address]:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4826895">//&nbsp;return&nbsp;true&nbsp;if&nbsp;the&nbsp;string&nbsp;includes&nbsp;a&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="4826941">func</span>&nbsp;<span class="ident" id="4826946">hasPort</span><span class="op" id="4826953">(</span><span class="ident" id="4826954">s</span>&nbsp;<span class="builtintype" id="4826956">string</span><span class="op" id="4826962">)</span>&nbsp;<span class="builtintype" id="4826964">bool</span>&nbsp;<span class="op" id="4826969">{</span>&nbsp;<span class="keyword" id="4826971">return</span>&nbsp;<span class="ident" id="4826978">strings</span><span class="op" id="4826985">.</span><span class="ident" id="4826986">LastIndex</span><span class="op" id="4826995">(</span><span class="ident" id="4826996">s</span><span class="op" id="4826997">,</span>&nbsp;<span class="string" id="4826999">&#34;:&#34;</span><span class="op" id="4827002">)</span>&nbsp;<span class="op" id="4827004">&gt;</span>&nbsp;<span class="ident" id="4827006">strings</span><span class="op" id="4827013">.</span><span class="ident" id="4827014">LastIndex</span><span class="op" id="4827023">(</span><span class="ident" id="4827024">s</span><span class="op" id="4827025">,</span>&nbsp;<span class="string" id="4827027">&#34;]&#34;</span><span class="op" id="4827030">)</span>&nbsp;<span class="op" id="4827032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4827035">//&nbsp;refererForURL&nbsp;returns&nbsp;a&nbsp;referer&nbsp;without&nbsp;any&nbsp;authentication&nbsp;info&nbsp;or</span><br>
<span class="lineno">105</span><span class="comment" id="4827105">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;if&nbsp;lastReq&nbsp;scheme&nbsp;is&nbsp;https&nbsp;and&nbsp;newReq&nbsp;scheme&nbsp;is&nbsp;http.</span><br>
<span class="lineno"></span><span class="keyword" id="4827178">func</span>&nbsp;<span class="ident" id="4827183">refererForURL</span><span class="op" id="4827196">(</span><span class="ident" id="4827197">lastReq</span><span class="op" id="4827204">,</span>&nbsp;<span class="ident" id="4827206">newReq</span>&nbsp;<span class="op" id="4827213">*</span><span class="ident" id="4827214">url</span><span class="op" id="4827217">.</span><span class="ident" id="4827218">URL</span><span class="op" id="4827221">)</span>&nbsp;<span class="builtintype" id="4827223">string</span>&nbsp;<span class="op" id="4827230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827233">//&nbsp;https://tools.ietf.org/html/rfc7231#section-5.5.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827287">//&nbsp;&nbsp;&nbsp;&#34;Clients&nbsp;SHOULD&nbsp;NOT&nbsp;include&nbsp;a&nbsp;Referer&nbsp;header&nbsp;field&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827349">//&nbsp;&nbsp;&nbsp;&nbsp;(non-secure)&nbsp;HTTP&nbsp;request&nbsp;if&nbsp;the&nbsp;referring&nbsp;page&nbsp;was</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827408">//&nbsp;&nbsp;&nbsp;&nbsp;transferred&nbsp;with&nbsp;a&nbsp;secure&nbsp;protocol.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827452">if</span>&nbsp;<span class="ident" id="4827455">lastReq</span><span class="op" id="4827462">.</span><span class="ident" id="4827463">Scheme</span>&nbsp;<span class="op" id="4827470">==</span>&nbsp;<span class="string" id="4827473">&#34;https&#34;</span>&nbsp;<span class="op" id="4827481">&amp;&amp;</span>&nbsp;<span class="ident" id="4827484">newReq</span><span class="op" id="4827490">.</span><span class="ident" id="4827491">Scheme</span>&nbsp;<span class="op" id="4827498">==</span>&nbsp;<span class="string" id="4827501">&#34;http&#34;</span>&nbsp;<span class="op" id="4827508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827512">return</span>&nbsp;<span class="string" id="4827519">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827526">referer</span>&nbsp;<span class="op" id="4827534">:=</span>&nbsp;<span class="ident" id="4827537">lastReq</span><span class="op" id="4827544">.</span><span class="ident" id="4827545">String</span><span class="op" id="4827551">(</span><span class="op" id="4827552">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827555">if</span>&nbsp;<span class="ident" id="4827558">lastReq</span><span class="op" id="4827565">.</span><span class="ident" id="4827566">User</span>&nbsp;<span class="op" id="4827571">!=</span>&nbsp;<span class="ident" id="4827574">nil</span>&nbsp;<span class="op" id="4827578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827582">//&nbsp;This&nbsp;is&nbsp;not&nbsp;very&nbsp;efficient,&nbsp;but&nbsp;is&nbsp;the&nbsp;best&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827638">//&nbsp;do&nbsp;without:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827655">//&nbsp;-&nbsp;introducing&nbsp;a&nbsp;new&nbsp;method&nbsp;on&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827694">//&nbsp;-&nbsp;creating&nbsp;a&nbsp;race&nbsp;condition</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827727">//&nbsp;-&nbsp;copying&nbsp;the&nbsp;URL&nbsp;struct&nbsp;manually,&nbsp;which&nbsp;would&nbsp;cause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4827785">//&nbsp;&nbsp;&nbsp;maintenance&nbsp;problems&nbsp;down&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827827">auth</span>&nbsp;<span class="op" id="4827832">:=</span>&nbsp;<span class="ident" id="4827835">lastReq</span><span class="op" id="4827842">.</span><span class="ident" id="4827843">User</span><span class="op" id="4827847">.</span><span class="ident" id="4827848">String</span><span class="op" id="4827854">(</span><span class="op" id="4827855">)</span>&nbsp;<span class="op" id="4827857">+</span>&nbsp;<span class="string" id="4827859">&#34;@&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4827865">referer</span>&nbsp;<span class="op" id="4827873">=</span>&nbsp;<span class="ident" id="4827875">strings</span><span class="op" id="4827882">.</span><span class="ident" id="4827883">Replace</span><span class="op" id="4827890">(</span><span class="ident" id="4827891">referer</span><span class="op" id="4827898">,</span>&nbsp;<span class="ident" id="4827900">auth</span><span class="op" id="4827904">,</span>&nbsp;<span class="string" id="4827906">&#34;&#34;</span><span class="op" id="4827908">,</span>&nbsp;<span class="num" id="4827910">1</span><span class="op" id="4827911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4827914">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4827917">return</span>&nbsp;<span class="ident" id="4827924">referer</span><br>
<span class="lineno"></span><span class="op" id="4827932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4827935">//&nbsp;Used&nbsp;in&nbsp;Send&nbsp;to&nbsp;implement&nbsp;io.ReadCloser&nbsp;by&nbsp;bundling&nbsp;together&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4828003">//&nbsp;bufio.Reader&nbsp;through&nbsp;which&nbsp;we&nbsp;read&nbsp;the&nbsp;response,&nbsp;and&nbsp;the&nbsp;underlying</span><br>
<span class="lineno">130</span><span class="comment" id="4828074">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4828097">type</span>&nbsp;<span class="ident" id="4828102">readClose</span>&nbsp;<span class="keyword" id="4828112">struct</span>&nbsp;<span class="op" id="4828119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828122">io</span><span class="op" id="4828124">.</span><span class="ident" id="4828125">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828133">io</span><span class="op" id="4828135">.</span><span class="ident" id="4828136">Closer</span><br>
<span class="lineno"></span><span class="op" id="4828143">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="4828146">func</span>&nbsp;<span class="op" id="4828151">(</span><span class="ident" id="4828152">c</span>&nbsp;<span class="op" id="4828154">*</span><span class="ident" id="4828155">Client</span><span class="op" id="4828161">)</span>&nbsp;<span class="ident" id="4828163">send</span><span class="op" id="4828167">(</span><span class="ident" id="4828168">req</span>&nbsp;<span class="op" id="4828172">*</span><span class="ident" id="4828173">Request</span><span class="op" id="4828180">)</span>&nbsp;<span class="op" id="4828182">(</span><span class="op" id="4828183">*</span><span class="ident" id="4828184">Response</span><span class="op" id="4828192">,</span>&nbsp;<span class="builtintype" id="4828194">error</span><span class="op" id="4828199">)</span>&nbsp;<span class="op" id="4828201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828204">if</span>&nbsp;<span class="ident" id="4828207">c</span><span class="op" id="4828208">.</span><span class="ident" id="4828209">Jar</span>&nbsp;<span class="op" id="4828213">!=</span>&nbsp;<span class="ident" id="4828216">nil</span>&nbsp;<span class="op" id="4828220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828224">for</span>&nbsp;<span class="ident" id="4828228">_</span><span class="op" id="4828229">,</span>&nbsp;<span class="ident" id="4828231">cookie</span>&nbsp;<span class="op" id="4828238">:=</span>&nbsp;<span class="keyword" id="4828241">range</span>&nbsp;<span class="ident" id="4828247">c</span><span class="op" id="4828248">.</span><span class="ident" id="4828249">Jar</span><span class="op" id="4828252">.</span><span class="ident" id="4828253">Cookies</span><span class="op" id="4828260">(</span><span class="ident" id="4828261">req</span><span class="op" id="4828264">.</span><span class="ident" id="4828265">URL</span><span class="op" id="4828268">)</span>&nbsp;<span class="op" id="4828270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828275">req</span><span class="op" id="4828278">.</span><span class="ident" id="4828279">AddCookie</span><span class="op" id="4828288">(</span><span class="ident" id="4828289">cookie</span><span class="op" id="4828295">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828305">resp</span><span class="op" id="4828309">,</span>&nbsp;<span class="ident" id="4828311">err</span>&nbsp;<span class="op" id="4828315">:=</span>&nbsp;<span class="ident" id="4828318">send</span><span class="op" id="4828322">(</span><span class="ident" id="4828323">req</span><span class="op" id="4828326">,</span>&nbsp;<span class="ident" id="4828328">c</span><span class="op" id="4828329">.</span><span class="ident" id="4828330">transport</span><span class="op" id="4828339">(</span><span class="op" id="4828340">)</span><span class="op" id="4828341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828344">if</span>&nbsp;<span class="ident" id="4828347">err</span>&nbsp;<span class="op" id="4828351">!=</span>&nbsp;<span class="ident" id="4828354">nil</span>&nbsp;<span class="op" id="4828358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828362">return</span>&nbsp;<span class="ident" id="4828369">nil</span><span class="op" id="4828372">,</span>&nbsp;<span class="ident" id="4828374">err</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828382">if</span>&nbsp;<span class="ident" id="4828385">c</span><span class="op" id="4828386">.</span><span class="ident" id="4828387">Jar</span>&nbsp;<span class="op" id="4828391">!=</span>&nbsp;<span class="ident" id="4828394">nil</span>&nbsp;<span class="op" id="4828398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828402">if</span>&nbsp;<span class="ident" id="4828405">rc</span>&nbsp;<span class="op" id="4828408">:=</span>&nbsp;<span class="ident" id="4828411">resp</span><span class="op" id="4828415">.</span><span class="ident" id="4828416">Cookies</span><span class="op" id="4828423">(</span><span class="op" id="4828424">)</span><span class="op" id="4828425">;</span>&nbsp;<span class="builtinfunc" id="4828427">len</span><span class="op" id="4828430">(</span><span class="ident" id="4828431">rc</span><span class="op" id="4828433">)</span>&nbsp;<span class="op" id="4828435">&gt;</span>&nbsp;<span class="num" id="4828437">0</span>&nbsp;<span class="op" id="4828439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4828444">c</span><span class="op" id="4828445">.</span><span class="ident" id="4828446">Jar</span><span class="op" id="4828449">.</span><span class="ident" id="4828450">SetCookies</span><span class="op" id="4828460">(</span><span class="ident" id="4828461">req</span><span class="op" id="4828464">.</span><span class="ident" id="4828465">URL</span><span class="op" id="4828468">,</span>&nbsp;<span class="ident" id="4828470">rc</span><span class="op" id="4828472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828476">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4828479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4828482">return</span>&nbsp;<span class="ident" id="4828489">resp</span><span class="op" id="4828493">,</span>&nbsp;<span class="ident" id="4828495">err</span><br>
<span class="lineno"></span><span class="op" id="4828499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4828502">//&nbsp;Do&nbsp;sends&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response,&nbsp;following</span><br>
<span class="lineno">155</span><span class="comment" id="4828570">//&nbsp;policy&nbsp;(e.g.&nbsp;redirects,&nbsp;cookies,&nbsp;auth)&nbsp;as&nbsp;configured&nbsp;on&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="4828641">//</span><br>
<span class="lineno"></span><span class="comment" id="4828644">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;caused&nbsp;by&nbsp;client&nbsp;policy&nbsp;(such&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4828704">//&nbsp;CheckRedirect),&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4828763">//&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno">160</span><span class="comment" id="4828809">//</span><br>
<span class="lineno"></span><span class="comment" id="4828812">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4828874">//</span><br>
<span class="lineno"></span><span class="comment" id="4828877">//&nbsp;Callers&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="4828941">//&nbsp;resp.Body&nbsp;is&nbsp;not&nbsp;closed,&nbsp;the&nbsp;Client&#39;s&nbsp;underlying&nbsp;RoundTripper</span><br>
<span class="lineno">165</span><span class="comment" id="4829006">//&nbsp;(typically&nbsp;Transport)&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;re-use&nbsp;a&nbsp;persistent&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="4829074">//&nbsp;connection&nbsp;to&nbsp;the&nbsp;server&nbsp;for&nbsp;a&nbsp;subsequent&nbsp;&#34;keep-alive&#34;&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="4829141">//</span><br>
<span class="lineno"></span><span class="comment" id="4829144">//&nbsp;The&nbsp;request&nbsp;Body,&nbsp;if&nbsp;non-nil,&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4829210">//&nbsp;Transport,&nbsp;even&nbsp;on&nbsp;errors.</span><br>
<span class="lineno">170</span><span class="comment" id="4829240">//</span><br>
<span class="lineno"></span><span class="comment" id="4829243">//&nbsp;Generally&nbsp;Get,&nbsp;Post,&nbsp;or&nbsp;PostForm&nbsp;will&nbsp;be&nbsp;used&nbsp;instead&nbsp;of&nbsp;Do.</span><br>
<span class="lineno"></span><span class="keyword" id="4829307">func</span>&nbsp;<span class="op" id="4829312">(</span><span class="ident" id="4829313">c</span>&nbsp;<span class="op" id="4829315">*</span><span class="ident" id="4829316">Client</span><span class="op" id="4829322">)</span>&nbsp;<span class="ident" id="4829324">Do</span><span class="op" id="4829326">(</span><span class="ident" id="4829327">req</span>&nbsp;<span class="op" id="4829331">*</span><span class="ident" id="4829332">Request</span><span class="op" id="4829339">)</span>&nbsp;<span class="op" id="4829341">(</span><span class="ident" id="4829342">resp</span>&nbsp;<span class="op" id="4829347">*</span><span class="ident" id="4829348">Response</span><span class="op" id="4829356">,</span>&nbsp;<span class="ident" id="4829358">err</span>&nbsp;<span class="builtintype" id="4829362">error</span><span class="op" id="4829367">)</span>&nbsp;<span class="op" id="4829369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829372">if</span>&nbsp;<span class="ident" id="4829375">req</span><span class="op" id="4829378">.</span><span class="ident" id="4829379">Method</span>&nbsp;<span class="op" id="4829386">==</span>&nbsp;<span class="string" id="4829389">&#34;GET&#34;</span>&nbsp;<span class="op" id="4829395">||</span>&nbsp;<span class="ident" id="4829398">req</span><span class="op" id="4829401">.</span><span class="ident" id="4829402">Method</span>&nbsp;<span class="op" id="4829409">==</span>&nbsp;<span class="string" id="4829412">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="4829419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829423">return</span>&nbsp;<span class="ident" id="4829430">c</span><span class="op" id="4829431">.</span><span class="ident" id="4829432">doFollowingRedirects</span><span class="op" id="4829452">(</span><span class="ident" id="4829453">req</span><span class="op" id="4829456">,</span>&nbsp;<span class="ident" id="4829458">shouldRedirectGet</span><span class="op" id="4829475">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829481">if</span>&nbsp;<span class="ident" id="4829484">req</span><span class="op" id="4829487">.</span><span class="ident" id="4829488">Method</span>&nbsp;<span class="op" id="4829495">==</span>&nbsp;<span class="string" id="4829498">&#34;POST&#34;</span>&nbsp;<span class="op" id="4829505">||</span>&nbsp;<span class="ident" id="4829508">req</span><span class="op" id="4829511">.</span><span class="ident" id="4829512">Method</span>&nbsp;<span class="op" id="4829519">==</span>&nbsp;<span class="string" id="4829522">&#34;PUT&#34;</span>&nbsp;<span class="op" id="4829528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829532">return</span>&nbsp;<span class="ident" id="4829539">c</span><span class="op" id="4829540">.</span><span class="ident" id="4829541">doFollowingRedirects</span><span class="op" id="4829561">(</span><span class="ident" id="4829562">req</span><span class="op" id="4829565">,</span>&nbsp;<span class="ident" id="4829567">shouldRedirectPost</span><span class="op" id="4829585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829591">return</span>&nbsp;<span class="ident" id="4829598">c</span><span class="op" id="4829599">.</span><span class="ident" id="4829600">send</span><span class="op" id="4829604">(</span><span class="ident" id="4829605">req</span><span class="op" id="4829608">)</span><br>
<span class="lineno">180</span><span class="op" id="4829610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4829613">func</span>&nbsp;<span class="op" id="4829618">(</span><span class="ident" id="4829619">c</span>&nbsp;<span class="op" id="4829621">*</span><span class="ident" id="4829622">Client</span><span class="op" id="4829628">)</span>&nbsp;<span class="ident" id="4829630">transport</span><span class="op" id="4829639">(</span><span class="op" id="4829640">)</span>&nbsp;<span class="ident" id="4829642">RoundTripper</span>&nbsp;<span class="op" id="4829655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829658">if</span>&nbsp;<span class="ident" id="4829661">c</span><span class="op" id="4829662">.</span><span class="ident" id="4829663">Transport</span>&nbsp;<span class="op" id="4829673">!=</span>&nbsp;<span class="ident" id="4829676">nil</span>&nbsp;<span class="op" id="4829680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829684">return</span>&nbsp;<span class="ident" id="4829691">c</span><span class="op" id="4829692">.</span><span class="ident" id="4829693">Transport</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4829704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829707">return</span>&nbsp;<span class="ident" id="4829714">DefaultTransport</span><br>
<span class="lineno"></span><span class="op" id="4829731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4829734">//&nbsp;send&nbsp;issues&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno">190</span><span class="comment" id="4829766">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4829826">func</span>&nbsp;<span class="ident" id="4829831">send</span><span class="op" id="4829835">(</span><span class="ident" id="4829836">req</span>&nbsp;<span class="op" id="4829840">*</span><span class="ident" id="4829841">Request</span><span class="op" id="4829848">,</span>&nbsp;<span class="ident" id="4829850">t</span>&nbsp;<span class="ident" id="4829852">RoundTripper</span><span class="op" id="4829864">)</span>&nbsp;<span class="op" id="4829866">(</span><span class="ident" id="4829867">resp</span>&nbsp;<span class="op" id="4829872">*</span><span class="ident" id="4829873">Response</span><span class="op" id="4829881">,</span>&nbsp;<span class="ident" id="4829883">err</span>&nbsp;<span class="builtintype" id="4829887">error</span><span class="op" id="4829892">)</span>&nbsp;<span class="op" id="4829894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829897">if</span>&nbsp;<span class="ident" id="4829900">t</span>&nbsp;<span class="op" id="4829902">==</span>&nbsp;<span class="ident" id="4829905">nil</span>&nbsp;<span class="op" id="4829909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4829913">req</span><span class="op" id="4829916">.</span><span class="ident" id="4829917">closeBody</span><span class="op" id="4829926">(</span><span class="op" id="4829927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4829931">return</span>&nbsp;<span class="ident" id="4829938">nil</span><span class="op" id="4829941">,</span>&nbsp;<span class="ident" id="4829943">errors</span><span class="op" id="4829949">.</span><span class="ident" id="4829950">New</span><span class="op" id="4829953">(</span><span class="string" id="4829954">&#34;http:&nbsp;no&nbsp;Client.Transport&nbsp;or&nbsp;DefaultTransport&#34;</span><span class="op" id="4830001">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830008">if</span>&nbsp;<span class="ident" id="4830011">req</span><span class="op" id="4830014">.</span><span class="ident" id="4830015">URL</span>&nbsp;<span class="op" id="4830019">==</span>&nbsp;<span class="ident" id="4830022">nil</span>&nbsp;<span class="op" id="4830026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830030">req</span><span class="op" id="4830033">.</span><span class="ident" id="4830034">closeBody</span><span class="op" id="4830043">(</span><span class="op" id="4830044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830048">return</span>&nbsp;<span class="ident" id="4830055">nil</span><span class="op" id="4830058">,</span>&nbsp;<span class="ident" id="4830060">errors</span><span class="op" id="4830066">.</span><span class="ident" id="4830067">New</span><span class="op" id="4830070">(</span><span class="string" id="4830071">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="4830094">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830101">if</span>&nbsp;<span class="ident" id="4830104">req</span><span class="op" id="4830107">.</span><span class="ident" id="4830108">RequestURI</span>&nbsp;<span class="op" id="4830119">!=</span>&nbsp;<span class="string" id="4830122">&#34;&#34;</span>&nbsp;<span class="op" id="4830125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830129">req</span><span class="op" id="4830132">.</span><span class="ident" id="4830133">closeBody</span><span class="op" id="4830142">(</span><span class="op" id="4830143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830147">return</span>&nbsp;<span class="ident" id="4830154">nil</span><span class="op" id="4830157">,</span>&nbsp;<span class="ident" id="4830159">errors</span><span class="op" id="4830165">.</span><span class="ident" id="4830166">New</span><span class="op" id="4830169">(</span><span class="string" id="4830170">&#34;http:&nbsp;Request.RequestURI&nbsp;can&#39;t&nbsp;be&nbsp;set&nbsp;in&nbsp;client&nbsp;requests.&#34;</span><span class="op" id="4830229">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830236">//&nbsp;Most&nbsp;the&nbsp;callers&nbsp;of&nbsp;send&nbsp;(Get,&nbsp;Post,&nbsp;et&nbsp;al)&nbsp;don&#39;t&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830295">//&nbsp;Headers,&nbsp;leaving&nbsp;it&nbsp;uninitialized.&nbsp;&nbsp;We&nbsp;guarantee&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4830355">//&nbsp;Transport&nbsp;that&nbsp;this&nbsp;has&nbsp;been&nbsp;initialized,&nbsp;though.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830409">if</span>&nbsp;<span class="ident" id="4830412">req</span><span class="op" id="4830415">.</span><span class="ident" id="4830416">Header</span>&nbsp;<span class="op" id="4830423">==</span>&nbsp;<span class="ident" id="4830426">nil</span>&nbsp;<span class="op" id="4830430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830434">req</span><span class="op" id="4830437">.</span><span class="ident" id="4830438">Header</span>&nbsp;<span class="op" id="4830445">=</span>&nbsp;<span class="builtinfunc" id="4830447">make</span><span class="op" id="4830451">(</span><span class="ident" id="4830452">Header</span><span class="op" id="4830458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830465">if</span>&nbsp;<span class="ident" id="4830468">u</span>&nbsp;<span class="op" id="4830470">:=</span>&nbsp;<span class="ident" id="4830473">req</span><span class="op" id="4830476">.</span><span class="ident" id="4830477">URL</span><span class="op" id="4830480">.</span><span class="ident" id="4830481">User</span><span class="op" id="4830485">;</span>&nbsp;<span class="ident" id="4830487">u</span>&nbsp;<span class="op" id="4830489">!=</span>&nbsp;<span class="ident" id="4830492">nil</span>&nbsp;<span class="op" id="4830496">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830500">username</span>&nbsp;<span class="op" id="4830509">:=</span>&nbsp;<span class="ident" id="4830512">u</span><span class="op" id="4830513">.</span><span class="ident" id="4830514">Username</span><span class="op" id="4830522">(</span><span class="op" id="4830523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830527">password</span><span class="op" id="4830535">,</span>&nbsp;<span class="ident" id="4830537">_</span>&nbsp;<span class="op" id="4830539">:=</span>&nbsp;<span class="ident" id="4830542">u</span><span class="op" id="4830543">.</span><span class="ident" id="4830544">Password</span><span class="op" id="4830552">(</span><span class="op" id="4830553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830557">req</span><span class="op" id="4830560">.</span><span class="ident" id="4830561">Header</span><span class="op" id="4830567">.</span><span class="ident" id="4830568">Set</span><span class="op" id="4830571">(</span><span class="string" id="4830572">&#34;Authorization&#34;</span><span class="op" id="4830587">,</span>&nbsp;<span class="string" id="4830589">&#34;Basic&nbsp;&#34;</span><span class="op" id="4830597">+</span><span class="ident" id="4830598">basicAuth</span><span class="op" id="4830607">(</span><span class="ident" id="4830608">username</span><span class="op" id="4830616">,</span>&nbsp;<span class="ident" id="4830618">password</span><span class="op" id="4830626">)</span><span class="op" id="4830627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830633">resp</span><span class="op" id="4830637">,</span>&nbsp;<span class="ident" id="4830639">err</span>&nbsp;<span class="op" id="4830643">=</span>&nbsp;<span class="ident" id="4830645">t</span><span class="op" id="4830646">.</span><span class="ident" id="4830647">RoundTrip</span><span class="op" id="4830656">(</span><span class="ident" id="4830657">req</span><span class="op" id="4830660">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830663">if</span>&nbsp;<span class="ident" id="4830666">err</span>&nbsp;<span class="op" id="4830670">!=</span>&nbsp;<span class="ident" id="4830673">nil</span>&nbsp;<span class="op" id="4830677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830681">if</span>&nbsp;<span class="ident" id="4830684">resp</span>&nbsp;<span class="op" id="4830689">!=</span>&nbsp;<span class="ident" id="4830692">nil</span>&nbsp;<span class="op" id="4830696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4830701">log</span><span class="op" id="4830704">.</span><span class="ident" id="4830705">Printf</span><span class="op" id="4830711">(</span><span class="string" id="4830712">&#34;RoundTripper&nbsp;returned&nbsp;a&nbsp;response&nbsp;&amp;&nbsp;error;&nbsp;ignoring&nbsp;response&#34;</span><span class="op" id="4830773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830781">return</span>&nbsp;<span class="ident" id="4830788">nil</span><span class="op" id="4830791">,</span>&nbsp;<span class="ident" id="4830793">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4830798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4830801">return</span>&nbsp;<span class="ident" id="4830808">resp</span><span class="op" id="4830812">,</span>&nbsp;<span class="ident" id="4830814">nil</span><br>
<span class="lineno"></span><span class="op" id="4830818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4830821">//&nbsp;See&nbsp;2&nbsp;(end&nbsp;of&nbsp;page&nbsp;4)&nbsp;http://www.ietf.org/rfc/rfc2617.txt</span><br>
<span class="lineno">230</span><span class="comment" id="4830882">//&nbsp;&#34;To&nbsp;receive&nbsp;authorization,&nbsp;the&nbsp;client&nbsp;sends&nbsp;the&nbsp;userid&nbsp;and&nbsp;password,</span><br>
<span class="lineno"></span><span class="comment" id="4830954">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;single&nbsp;colon&nbsp;(&#34;:&#34;)&nbsp;character,&nbsp;within&nbsp;a&nbsp;base64</span><br>
<span class="lineno"></span><span class="comment" id="4831018">//&nbsp;encoded&nbsp;string&nbsp;in&nbsp;the&nbsp;credentials.&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4831057">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;urlencoded.</span><br>
<span class="lineno"></span><span class="keyword" id="4831094">func</span>&nbsp;<span class="ident" id="4831099">basicAuth</span><span class="op" id="4831108">(</span><span class="ident" id="4831109">username</span><span class="op" id="4831117">,</span>&nbsp;<span class="ident" id="4831119">password</span>&nbsp;<span class="builtintype" id="4831128">string</span><span class="op" id="4831134">)</span>&nbsp;<span class="builtintype" id="4831136">string</span>&nbsp;<span class="op" id="4831143">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4831146">auth</span>&nbsp;<span class="op" id="4831151">:=</span>&nbsp;<span class="ident" id="4831154">username</span>&nbsp;<span class="op" id="4831163">+</span>&nbsp;<span class="string" id="4831165">&#34;:&#34;</span>&nbsp;<span class="op" id="4831169">+</span>&nbsp;<span class="ident" id="4831171">password</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831181">return</span>&nbsp;<span class="ident" id="4831188">base64</span><span class="op" id="4831194">.</span><span class="ident" id="4831195">StdEncoding</span><span class="op" id="4831206">.</span><span class="ident" id="4831207">EncodeToString</span><span class="op" id="4831221">(</span><span class="op" id="4831222">[</span><span class="op" id="4831223">]</span><span class="builtintype" id="4831224">byte</span><span class="op" id="4831228">(</span><span class="ident" id="4831229">auth</span><span class="op" id="4831233">)</span><span class="op" id="4831234">)</span><br>
<span class="lineno"></span><span class="op" id="4831236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4831239">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Get&nbsp;utility&nbsp;should</span><br>
<span class="lineno">240</span><span class="comment" id="4831321">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="4831348">func</span>&nbsp;<span class="ident" id="4831353">shouldRedirectGet</span><span class="op" id="4831370">(</span><span class="ident" id="4831371">statusCode</span>&nbsp;<span class="builtintype" id="4831382">int</span><span class="op" id="4831385">)</span>&nbsp;<span class="builtintype" id="4831387">bool</span>&nbsp;<span class="op" id="4831392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831395">switch</span>&nbsp;<span class="ident" id="4831402">statusCode</span>&nbsp;<span class="op" id="4831413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831416">case</span>&nbsp;<span class="ident" id="4831421">StatusMovedPermanently</span><span class="op" id="4831443">,</span>&nbsp;<span class="ident" id="4831445">StatusFound</span><span class="op" id="4831456">,</span>&nbsp;<span class="ident" id="4831458">StatusSeeOther</span><span class="op" id="4831472">,</span>&nbsp;<span class="ident" id="4831474">StatusTemporaryRedirect</span><span class="op" id="4831497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831501">return</span>&nbsp;<span class="builtintype" id="4831508">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4831514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831517">return</span>&nbsp;<span class="builtintype" id="4831524">false</span><br>
<span class="lineno"></span><span class="op" id="4831530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4831533">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Post&nbsp;utility&nbsp;should</span><br>
<span class="lineno">250</span><span class="comment" id="4831616">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="4831643">func</span>&nbsp;<span class="ident" id="4831648">shouldRedirectPost</span><span class="op" id="4831666">(</span><span class="ident" id="4831667">statusCode</span>&nbsp;<span class="builtintype" id="4831678">int</span><span class="op" id="4831681">)</span>&nbsp;<span class="builtintype" id="4831683">bool</span>&nbsp;<span class="op" id="4831688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831691">switch</span>&nbsp;<span class="ident" id="4831698">statusCode</span>&nbsp;<span class="op" id="4831709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831712">case</span>&nbsp;<span class="ident" id="4831717">StatusFound</span><span class="op" id="4831728">,</span>&nbsp;<span class="ident" id="4831730">StatusSeeOther</span><span class="op" id="4831744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831748">return</span>&nbsp;<span class="builtintype" id="4831755">true</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4831761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4831764">return</span>&nbsp;<span class="builtintype" id="4831771">false</span><br>
<span class="lineno"></span><span class="op" id="4831777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4831780">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="4831863">//&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect,&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;10&nbsp;redirects:</span><br>
<span class="lineno"></span><span class="comment" id="4831941">//</span><br>
<span class="lineno"></span><span class="comment" id="4831944">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="4831974">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="4831992">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">265</span><span class="comment" id="4832014">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="4832045">//</span><br>
<span class="lineno"></span><span class="comment" id="4832048">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;there&nbsp;were&nbsp;too&nbsp;many&nbsp;redirects&nbsp;or&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="4832117">//&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4832184">//&nbsp;error.</span><br>
<span class="lineno">270</span><span class="comment" id="4832194">//</span><br>
<span class="lineno"></span><span class="comment" id="4832197">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4832259">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4832319">//</span><br>
<span class="lineno"></span><span class="comment" id="4832322">//&nbsp;Get&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Get.</span><br>
<span class="lineno">275</span><span class="keyword" id="4832368">func</span>&nbsp;<span class="ident" id="4832373">Get</span><span class="op" id="4832376">(</span><span class="ident" id="4832377">url</span>&nbsp;<span class="builtintype" id="4832381">string</span><span class="op" id="4832387">)</span>&nbsp;<span class="op" id="4832389">(</span><span class="ident" id="4832390">resp</span>&nbsp;<span class="op" id="4832395">*</span><span class="ident" id="4832396">Response</span><span class="op" id="4832404">,</span>&nbsp;<span class="ident" id="4832406">err</span>&nbsp;<span class="builtintype" id="4832410">error</span><span class="op" id="4832415">)</span>&nbsp;<span class="op" id="4832417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832420">return</span>&nbsp;<span class="ident" id="4832427">DefaultClient</span><span class="op" id="4832440">.</span><span class="ident" id="4832441">Get</span><span class="op" id="4832444">(</span><span class="ident" id="4832445">url</span><span class="op" id="4832448">)</span><br>
<span class="lineno"></span><span class="op" id="4832450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4832453">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">280</span><span class="comment" id="4832526">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4832598">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4832634">//</span><br>
<span class="lineno"></span><span class="comment" id="4832637">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="4832667">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">285</span><span class="comment" id="4832685">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="4832707">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="4832738">//</span><br>
<span class="lineno"></span><span class="comment" id="4832741">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function&nbsp;fails</span><br>
<span class="lineno"></span><span class="comment" id="4832810">//&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t</span><br>
<span class="lineno">290</span><span class="comment" id="4832880">//&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4832899">//</span><br>
<span class="lineno"></span><span class="comment" id="4832902">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4832964">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4833024">func</span>&nbsp;<span class="op" id="4833029">(</span><span class="ident" id="4833030">c</span>&nbsp;<span class="op" id="4833032">*</span><span class="ident" id="4833033">Client</span><span class="op" id="4833039">)</span>&nbsp;<span class="ident" id="4833041">Get</span><span class="op" id="4833044">(</span><span class="ident" id="4833045">url</span>&nbsp;<span class="builtintype" id="4833049">string</span><span class="op" id="4833055">)</span>&nbsp;<span class="op" id="4833057">(</span><span class="ident" id="4833058">resp</span>&nbsp;<span class="op" id="4833063">*</span><span class="ident" id="4833064">Response</span><span class="op" id="4833072">,</span>&nbsp;<span class="ident" id="4833074">err</span>&nbsp;<span class="builtintype" id="4833078">error</span><span class="op" id="4833083">)</span>&nbsp;<span class="op" id="4833085">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833088">req</span><span class="op" id="4833091">,</span>&nbsp;<span class="ident" id="4833093">err</span>&nbsp;<span class="op" id="4833097">:=</span>&nbsp;<span class="ident" id="4833100">NewRequest</span><span class="op" id="4833110">(</span><span class="string" id="4833111">&#34;GET&#34;</span><span class="op" id="4833116">,</span>&nbsp;<span class="ident" id="4833118">url</span><span class="op" id="4833121">,</span>&nbsp;<span class="ident" id="4833123">nil</span><span class="op" id="4833126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833129">if</span>&nbsp;<span class="ident" id="4833132">err</span>&nbsp;<span class="op" id="4833136">!=</span>&nbsp;<span class="ident" id="4833139">nil</span>&nbsp;<span class="op" id="4833143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833147">return</span>&nbsp;<span class="ident" id="4833154">nil</span><span class="op" id="4833157">,</span>&nbsp;<span class="ident" id="4833159">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833167">return</span>&nbsp;<span class="ident" id="4833174">c</span><span class="op" id="4833175">.</span><span class="ident" id="4833176">doFollowingRedirects</span><span class="op" id="4833196">(</span><span class="ident" id="4833197">req</span><span class="op" id="4833200">,</span>&nbsp;<span class="ident" id="4833202">shouldRedirectGet</span><span class="op" id="4833219">)</span><br>
<span class="lineno">300</span><span class="op" id="4833221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4833224">func</span>&nbsp;<span class="op" id="4833229">(</span><span class="ident" id="4833230">c</span>&nbsp;<span class="op" id="4833232">*</span><span class="ident" id="4833233">Client</span><span class="op" id="4833239">)</span>&nbsp;<span class="ident" id="4833241">doFollowingRedirects</span><span class="op" id="4833261">(</span><span class="ident" id="4833262">ireq</span>&nbsp;<span class="op" id="4833267">*</span><span class="ident" id="4833268">Request</span><span class="op" id="4833275">,</span>&nbsp;<span class="ident" id="4833277">shouldRedirect</span>&nbsp;<span class="keyword" id="4833292">func</span><span class="op" id="4833296">(</span><span class="builtintype" id="4833297">int</span><span class="op" id="4833300">)</span>&nbsp;<span class="builtintype" id="4833302">bool</span><span class="op" id="4833306">)</span>&nbsp;<span class="op" id="4833308">(</span><span class="ident" id="4833309">resp</span>&nbsp;<span class="op" id="4833314">*</span><span class="ident" id="4833315">Response</span><span class="op" id="4833323">,</span>&nbsp;<span class="ident" id="4833325">err</span>&nbsp;<span class="builtintype" id="4833329">error</span><span class="op" id="4833334">)</span>&nbsp;<span class="op" id="4833336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833339">var</span>&nbsp;<span class="ident" id="4833343">base</span>&nbsp;<span class="op" id="4833348">*</span><span class="ident" id="4833349">url</span><span class="op" id="4833352">.</span><span class="ident" id="4833353">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833358">redirectChecker</span>&nbsp;<span class="op" id="4833374">:=</span>&nbsp;<span class="ident" id="4833377">c</span><span class="op" id="4833378">.</span><span class="ident" id="4833379">CheckRedirect</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833394">if</span>&nbsp;<span class="ident" id="4833397">redirectChecker</span>&nbsp;<span class="op" id="4833413">==</span>&nbsp;<span class="ident" id="4833416">nil</span>&nbsp;<span class="op" id="4833420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833424">redirectChecker</span>&nbsp;<span class="op" id="4833440">=</span>&nbsp;<span class="ident" id="4833442">defaultCheckRedirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833467">var</span>&nbsp;<span class="ident" id="4833471">via</span>&nbsp;<span class="op" id="4833475">[</span><span class="op" id="4833476">]</span><span class="op" id="4833477">*</span><span class="ident" id="4833478">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833488">if</span>&nbsp;<span class="ident" id="4833491">ireq</span><span class="op" id="4833495">.</span><span class="ident" id="4833496">URL</span>&nbsp;<span class="op" id="4833500">==</span>&nbsp;<span class="ident" id="4833503">nil</span>&nbsp;<span class="op" id="4833507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833511">ireq</span><span class="op" id="4833515">.</span><span class="ident" id="4833516">closeBody</span><span class="op" id="4833525">(</span><span class="op" id="4833526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833530">return</span>&nbsp;<span class="ident" id="4833537">nil</span><span class="op" id="4833540">,</span>&nbsp;<span class="ident" id="4833542">errors</span><span class="op" id="4833548">.</span><span class="ident" id="4833549">New</span><span class="op" id="4833552">(</span><span class="string" id="4833553">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="4833576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833583">var</span>&nbsp;<span class="ident" id="4833587">reqmu</span>&nbsp;<span class="ident" id="4833593">sync</span><span class="op" id="4833597">.</span><span class="ident" id="4833598">Mutex</span>&nbsp;<span class="comment" id="4833604">//&nbsp;guards&nbsp;req</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833619">req</span>&nbsp;<span class="op" id="4833623">:=</span>&nbsp;<span class="ident" id="4833626">ireq</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833633">var</span>&nbsp;<span class="ident" id="4833637">timer</span>&nbsp;<span class="op" id="4833643">*</span><span class="ident" id="4833644">time</span><span class="op" id="4833648">.</span><span class="ident" id="4833649">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833656">if</span>&nbsp;<span class="ident" id="4833659">c</span><span class="op" id="4833660">.</span><span class="ident" id="4833661">Timeout</span>&nbsp;<span class="op" id="4833669">&gt;</span>&nbsp;<span class="num" id="4833671">0</span>&nbsp;<span class="op" id="4833673">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833677">type</span>&nbsp;<span class="ident" id="4833682">canceler</span>&nbsp;<span class="keyword" id="4833691">interface</span>&nbsp;<span class="op" id="4833701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833706">CancelRequest</span><span class="op" id="4833719">(</span><span class="op" id="4833720">*</span><span class="ident" id="4833721">Request</span><span class="op" id="4833728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833736">tr</span><span class="op" id="4833738">,</span>&nbsp;<span class="ident" id="4833740">ok</span>&nbsp;<span class="op" id="4833743">:=</span>&nbsp;<span class="ident" id="4833746">c</span><span class="op" id="4833747">.</span><span class="ident" id="4833748">transport</span><span class="op" id="4833757">(</span><span class="op" id="4833758">)</span><span class="op" id="4833759">.</span><span class="op" id="4833760">(</span><span class="ident" id="4833761">canceler</span><span class="op" id="4833769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833773">if</span>&nbsp;<span class="op" id="4833776">!</span><span class="ident" id="4833777">ok</span>&nbsp;<span class="op" id="4833780">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833785">return</span>&nbsp;<span class="ident" id="4833792">nil</span><span class="op" id="4833795">,</span>&nbsp;<span class="ident" id="4833797">fmt</span><span class="op" id="4833800">.</span><span class="ident" id="4833801">Errorf</span><span class="op" id="4833807">(</span><span class="string" id="4833808">&#34;net/http:&nbsp;Client&nbsp;Transport&nbsp;of&nbsp;type&nbsp;%T&nbsp;doesn&#39;t&nbsp;support&nbsp;CancelRequest;&nbsp;Timeout&nbsp;not&nbsp;supported&#34;</span><span class="op" id="4833900">,</span>&nbsp;<span class="ident" id="4833902">c</span><span class="op" id="4833903">.</span><span class="ident" id="4833904">transport</span><span class="op" id="4833913">(</span><span class="op" id="4833914">)</span><span class="op" id="4833915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4833919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833923">timer</span>&nbsp;<span class="op" id="4833929">=</span>&nbsp;<span class="ident" id="4833931">time</span><span class="op" id="4833935">.</span><span class="ident" id="4833936">AfterFunc</span><span class="op" id="4833945">(</span><span class="ident" id="4833946">c</span><span class="op" id="4833947">.</span><span class="ident" id="4833948">Timeout</span><span class="op" id="4833955">,</span>&nbsp;<span class="keyword" id="4833957">func</span><span class="op" id="4833961">(</span><span class="op" id="4833962">)</span>&nbsp;<span class="op" id="4833964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4833969">reqmu</span><span class="op" id="4833974">.</span><span class="ident" id="4833975">Lock</span><span class="op" id="4833979">(</span><span class="op" id="4833980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4833985">defer</span>&nbsp;<span class="ident" id="4833991">reqmu</span><span class="op" id="4833996">.</span><span class="ident" id="4833997">Unlock</span><span class="op" id="4834003">(</span><span class="op" id="4834004">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834009">tr</span><span class="op" id="4834011">.</span><span class="ident" id="4834012">CancelRequest</span><span class="op" id="4834025">(</span><span class="ident" id="4834026">req</span><span class="op" id="4834029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834033">}</span><span class="op" id="4834034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834041">urlStr</span>&nbsp;<span class="op" id="4834048">:=</span>&nbsp;<span class="string" id="4834051">&#34;&#34;</span>&nbsp;<span class="comment" id="4834054">//&nbsp;next&nbsp;relative&nbsp;or&nbsp;absolute&nbsp;URL&nbsp;to&nbsp;fetch&nbsp;(after&nbsp;first&nbsp;request)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834119">redirectFailed</span>&nbsp;<span class="op" id="4834134">:=</span>&nbsp;<span class="builtintype" id="4834137">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834144">for</span>&nbsp;<span class="ident" id="4834148">redirect</span>&nbsp;<span class="op" id="4834157">:=</span>&nbsp;<span class="num" id="4834160">0</span><span class="op" id="4834161">;</span>&nbsp;<span class="op" id="4834163">;</span>&nbsp;<span class="ident" id="4834165">redirect</span><span class="op" id="4834173">++</span>&nbsp;<span class="op" id="4834176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834180">if</span>&nbsp;<span class="ident" id="4834183">redirect</span>&nbsp;<span class="op" id="4834192">!=</span>&nbsp;<span class="num" id="4834195">0</span>&nbsp;<span class="op" id="4834197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834202">nreq</span>&nbsp;<span class="op" id="4834207">:=</span>&nbsp;<span class="builtinfunc" id="4834210">new</span><span class="op" id="4834213">(</span><span class="ident" id="4834214">Request</span><span class="op" id="4834221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834226">nreq</span><span class="op" id="4834230">.</span><span class="ident" id="4834231">Method</span>&nbsp;<span class="op" id="4834238">=</span>&nbsp;<span class="ident" id="4834240">ireq</span><span class="op" id="4834244">.</span><span class="ident" id="4834245">Method</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834255">if</span>&nbsp;<span class="ident" id="4834258">ireq</span><span class="op" id="4834262">.</span><span class="ident" id="4834263">Method</span>&nbsp;<span class="op" id="4834270">==</span>&nbsp;<span class="string" id="4834273">&#34;POST&#34;</span>&nbsp;<span class="op" id="4834280">||</span>&nbsp;<span class="ident" id="4834283">ireq</span><span class="op" id="4834287">.</span><span class="ident" id="4834288">Method</span>&nbsp;<span class="op" id="4834295">==</span>&nbsp;<span class="string" id="4834298">&#34;PUT&#34;</span>&nbsp;<span class="op" id="4834304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834310">nreq</span><span class="op" id="4834314">.</span><span class="ident" id="4834315">Method</span>&nbsp;<span class="op" id="4834322">=</span>&nbsp;<span class="string" id="4834324">&#34;GET&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834338">nreq</span><span class="op" id="4834342">.</span><span class="ident" id="4834343">Header</span>&nbsp;<span class="op" id="4834350">=</span>&nbsp;<span class="builtinfunc" id="4834352">make</span><span class="op" id="4834356">(</span><span class="ident" id="4834357">Header</span><span class="op" id="4834363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834368">nreq</span><span class="op" id="4834372">.</span><span class="ident" id="4834373">URL</span><span class="op" id="4834376">,</span>&nbsp;<span class="ident" id="4834378">err</span>&nbsp;<span class="op" id="4834382">=</span>&nbsp;<span class="ident" id="4834384">base</span><span class="op" id="4834388">.</span><span class="ident" id="4834389">Parse</span><span class="op" id="4834394">(</span><span class="ident" id="4834395">urlStr</span><span class="op" id="4834401">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834406">if</span>&nbsp;<span class="ident" id="4834409">err</span>&nbsp;<span class="op" id="4834413">!=</span>&nbsp;<span class="ident" id="4834416">nil</span>&nbsp;<span class="op" id="4834420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834426">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834440">if</span>&nbsp;<span class="builtinfunc" id="4834443">len</span><span class="op" id="4834446">(</span><span class="ident" id="4834447">via</span><span class="op" id="4834450">)</span>&nbsp;<span class="op" id="4834452">&gt;</span>&nbsp;<span class="num" id="4834454">0</span>&nbsp;<span class="op" id="4834456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4834462">//&nbsp;Add&nbsp;the&nbsp;Referer&nbsp;header.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834493">lastReq</span>&nbsp;<span class="op" id="4834501">:=</span>&nbsp;<span class="ident" id="4834504">via</span><span class="op" id="4834507">[</span><span class="builtinfunc" id="4834508">len</span><span class="op" id="4834511">(</span><span class="ident" id="4834512">via</span><span class="op" id="4834515">)</span><span class="op" id="4834516">-</span><span class="num" id="4834517">1</span><span class="op" id="4834518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834524">if</span>&nbsp;<span class="ident" id="4834527">ref</span>&nbsp;<span class="op" id="4834531">:=</span>&nbsp;<span class="ident" id="4834534">refererForURL</span><span class="op" id="4834547">(</span><span class="ident" id="4834548">lastReq</span><span class="op" id="4834555">.</span><span class="ident" id="4834556">URL</span><span class="op" id="4834559">,</span>&nbsp;<span class="ident" id="4834561">nreq</span><span class="op" id="4834565">.</span><span class="ident" id="4834566">URL</span><span class="op" id="4834569">)</span><span class="op" id="4834570">;</span>&nbsp;<span class="ident" id="4834572">ref</span>&nbsp;<span class="op" id="4834576">!=</span>&nbsp;<span class="string" id="4834579">&#34;&#34;</span>&nbsp;<span class="op" id="4834582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834589">nreq</span><span class="op" id="4834593">.</span><span class="ident" id="4834594">Header</span><span class="op" id="4834600">.</span><span class="ident" id="4834601">Set</span><span class="op" id="4834604">(</span><span class="string" id="4834605">&#34;Referer&#34;</span><span class="op" id="4834614">,</span>&nbsp;<span class="ident" id="4834616">ref</span><span class="op" id="4834619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834632">err</span>&nbsp;<span class="op" id="4834636">=</span>&nbsp;<span class="ident" id="4834638">redirectChecker</span><span class="op" id="4834653">(</span><span class="ident" id="4834654">nreq</span><span class="op" id="4834658">,</span>&nbsp;<span class="ident" id="4834660">via</span><span class="op" id="4834663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834669">if</span>&nbsp;<span class="ident" id="4834672">err</span>&nbsp;<span class="op" id="4834676">!=</span>&nbsp;<span class="ident" id="4834679">nil</span>&nbsp;<span class="op" id="4834683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834690">redirectFailed</span>&nbsp;<span class="op" id="4834705">=</span>&nbsp;<span class="builtintype" id="4834707">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834717">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834727">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834737">reqmu</span><span class="op" id="4834742">.</span><span class="ident" id="4834743">Lock</span><span class="op" id="4834747">(</span><span class="op" id="4834748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834753">req</span>&nbsp;<span class="op" id="4834757">=</span>&nbsp;<span class="ident" id="4834759">nreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834767">reqmu</span><span class="op" id="4834772">.</span><span class="ident" id="4834773">Unlock</span><span class="op" id="4834779">(</span><span class="op" id="4834780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834784">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4834789">urlStr</span>&nbsp;<span class="op" id="4834796">=</span>&nbsp;<span class="ident" id="4834798">req</span><span class="op" id="4834801">.</span><span class="ident" id="4834802">URL</span><span class="op" id="4834805">.</span><span class="ident" id="4834806">String</span><span class="op" id="4834812">(</span><span class="op" id="4834813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834817">if</span>&nbsp;<span class="ident" id="4834820">resp</span><span class="op" id="4834824">,</span>&nbsp;<span class="ident" id="4834826">err</span>&nbsp;<span class="op" id="4834830">=</span>&nbsp;<span class="ident" id="4834832">c</span><span class="op" id="4834833">.</span><span class="ident" id="4834834">send</span><span class="op" id="4834838">(</span><span class="ident" id="4834839">req</span><span class="op" id="4834842">)</span><span class="op" id="4834843">;</span>&nbsp;<span class="ident" id="4834845">err</span>&nbsp;<span class="op" id="4834849">!=</span>&nbsp;<span class="ident" id="4834852">nil</span>&nbsp;<span class="op" id="4834856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834861">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4834869">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4834874">if</span>&nbsp;<span class="ident" id="4834877">shouldRedirect</span><span class="op" id="4834891">(</span><span class="ident" id="4834892">resp</span><span class="op" id="4834896">.</span><span class="ident" id="4834897">StatusCode</span><span class="op" id="4834907">)</span>&nbsp;<span class="op" id="4834909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4834914">//&nbsp;Read&nbsp;the&nbsp;body&nbsp;if&nbsp;small&nbsp;so&nbsp;underlying&nbsp;TCP&nbsp;connection&nbsp;will&nbsp;be&nbsp;re-used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4834989">//&nbsp;No&nbsp;need&nbsp;to&nbsp;check&nbsp;for&nbsp;errors:&nbsp;if&nbsp;it&nbsp;fails,&nbsp;Transport&nbsp;won&#39;t&nbsp;reuse&nbsp;it&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835070">const</span>&nbsp;<span class="ident" id="4835076">maxBodySlurpSize</span>&nbsp;<span class="op" id="4835093">=</span>&nbsp;<span class="num" id="4835095">2</span>&nbsp;<span class="op" id="4835097">&lt;&lt;</span>&nbsp;<span class="num" id="4835100">10</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835106">if</span>&nbsp;<span class="ident" id="4835109">resp</span><span class="op" id="4835113">.</span><span class="ident" id="4835114">ContentLength</span>&nbsp;<span class="op" id="4835128">==</span>&nbsp;<span class="op" id="4835131">-</span><span class="num" id="4835132">1</span>&nbsp;<span class="op" id="4835134">||</span>&nbsp;<span class="ident" id="4835137">resp</span><span class="op" id="4835141">.</span><span class="ident" id="4835142">ContentLength</span>&nbsp;<span class="op" id="4835156">&lt;=</span>&nbsp;<span class="ident" id="4835159">maxBodySlurpSize</span>&nbsp;<span class="op" id="4835176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835182">io</span><span class="op" id="4835184">.</span><span class="ident" id="4835185">CopyN</span><span class="op" id="4835190">(</span><span class="ident" id="4835191">ioutil</span><span class="op" id="4835197">.</span><span class="ident" id="4835198">Discard</span><span class="op" id="4835205">,</span>&nbsp;<span class="ident" id="4835207">resp</span><span class="op" id="4835211">.</span><span class="ident" id="4835212">Body</span><span class="op" id="4835216">,</span>&nbsp;<span class="ident" id="4835218">maxBodySlurpSize</span><span class="op" id="4835234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835244">resp</span><span class="op" id="4835248">.</span><span class="ident" id="4835249">Body</span><span class="op" id="4835253">.</span><span class="ident" id="4835254">Close</span><span class="op" id="4835259">(</span><span class="op" id="4835260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835265">if</span>&nbsp;<span class="ident" id="4835268">urlStr</span>&nbsp;<span class="op" id="4835275">=</span>&nbsp;<span class="ident" id="4835277">resp</span><span class="op" id="4835281">.</span><span class="ident" id="4835282">Header</span><span class="op" id="4835288">.</span><span class="ident" id="4835289">Get</span><span class="op" id="4835292">(</span><span class="string" id="4835293">&#34;Location&#34;</span><span class="op" id="4835303">)</span><span class="op" id="4835304">;</span>&nbsp;<span class="ident" id="4835306">urlStr</span>&nbsp;<span class="op" id="4835313">==</span>&nbsp;<span class="string" id="4835316">&#34;&#34;</span>&nbsp;<span class="op" id="4835319">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835325">err</span>&nbsp;<span class="op" id="4835329">=</span>&nbsp;<span class="ident" id="4835331">errors</span><span class="op" id="4835337">.</span><span class="ident" id="4835338">New</span><span class="op" id="4835341">(</span><span class="ident" id="4835342">fmt</span><span class="op" id="4835345">.</span><span class="ident" id="4835346">Sprintf</span><span class="op" id="4835353">(</span><span class="string" id="4835354">&#34;%d&nbsp;response&nbsp;missing&nbsp;Location&nbsp;header&#34;</span><span class="op" id="4835391">,</span>&nbsp;<span class="ident" id="4835393">resp</span><span class="op" id="4835397">.</span><span class="ident" id="4835398">StatusCode</span><span class="op" id="4835408">)</span><span class="op" id="4835409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835415">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835429">base</span>&nbsp;<span class="op" id="4835434">=</span>&nbsp;<span class="ident" id="4835436">req</span><span class="op" id="4835439">.</span><span class="ident" id="4835440">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835447">via</span>&nbsp;<span class="op" id="4835451">=</span>&nbsp;<span class="builtinfunc" id="4835453">append</span><span class="op" id="4835459">(</span><span class="ident" id="4835460">via</span><span class="op" id="4835463">,</span>&nbsp;<span class="ident" id="4835465">req</span><span class="op" id="4835468">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835473">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835488">if</span>&nbsp;<span class="ident" id="4835491">timer</span>&nbsp;<span class="op" id="4835497">!=</span>&nbsp;<span class="ident" id="4835500">nil</span>&nbsp;<span class="op" id="4835504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835509">resp</span><span class="op" id="4835513">.</span><span class="ident" id="4835514">Body</span>&nbsp;<span class="op" id="4835519">=</span>&nbsp;<span class="op" id="4835521">&amp;</span><span class="ident" id="4835522">cancelTimerBody</span><span class="op" id="4835537">{</span><span class="ident" id="4835538">timer</span><span class="op" id="4835543">,</span>&nbsp;<span class="ident" id="4835545">resp</span><span class="op" id="4835549">.</span><span class="ident" id="4835550">Body</span><span class="op" id="4835554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835558">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835562">return</span>&nbsp;<span class="ident" id="4835569">resp</span><span class="op" id="4835573">,</span>&nbsp;<span class="ident" id="4835575">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835584">method</span>&nbsp;<span class="op" id="4835591">:=</span>&nbsp;<span class="ident" id="4835594">ireq</span><span class="op" id="4835598">.</span><span class="ident" id="4835599">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835607">urlErr</span>&nbsp;<span class="op" id="4835614">:=</span>&nbsp;<span class="op" id="4835617">&amp;</span><span class="ident" id="4835618">url</span><span class="op" id="4835621">.</span><span class="ident" id="4835622">Error</span><span class="op" id="4835627">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835631">Op</span><span class="op" id="4835633">:</span>&nbsp;&nbsp;<span class="ident" id="4835636">method</span><span class="op" id="4835642">[</span><span class="num" id="4835643">0</span><span class="op" id="4835644">:</span><span class="num" id="4835645">1</span><span class="op" id="4835646">]</span>&nbsp;<span class="op" id="4835648">+</span>&nbsp;<span class="ident" id="4835650">strings</span><span class="op" id="4835657">.</span><span class="ident" id="4835658">ToLower</span><span class="op" id="4835665">(</span><span class="ident" id="4835666">method</span><span class="op" id="4835672">[</span><span class="num" id="4835673">1</span><span class="op" id="4835674">:</span><span class="op" id="4835675">]</span><span class="op" id="4835676">)</span><span class="op" id="4835677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835681">URL</span><span class="op" id="4835684">:</span>&nbsp;<span class="ident" id="4835686">urlStr</span><span class="op" id="4835692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835696">Err</span><span class="op" id="4835699">:</span>&nbsp;<span class="ident" id="4835701">err</span><span class="op" id="4835704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835711">if</span>&nbsp;<span class="ident" id="4835714">redirectFailed</span>&nbsp;<span class="op" id="4835729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4835733">//&nbsp;Special&nbsp;case&nbsp;for&nbsp;Go&nbsp;1&nbsp;compatibility:&nbsp;return&nbsp;both&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4835800">//&nbsp;and&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;CheckRedirect&nbsp;function&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4835856">//&nbsp;See&nbsp;http://golang.org/issue/3795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835894">return</span>&nbsp;<span class="ident" id="4835901">resp</span><span class="op" id="4835905">,</span>&nbsp;<span class="ident" id="4835907">urlErr</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835919">if</span>&nbsp;<span class="ident" id="4835922">resp</span>&nbsp;<span class="op" id="4835927">!=</span>&nbsp;<span class="ident" id="4835930">nil</span>&nbsp;<span class="op" id="4835934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4835938">resp</span><span class="op" id="4835942">.</span><span class="ident" id="4835943">Body</span><span class="op" id="4835947">.</span><span class="ident" id="4835948">Close</span><span class="op" id="4835953">(</span><span class="op" id="4835954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4835957">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4835960">return</span>&nbsp;<span class="ident" id="4835967">nil</span><span class="op" id="4835970">,</span>&nbsp;<span class="ident" id="4835972">urlErr</span><br>
<span class="lineno"></span><span class="op" id="4835979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4835982">func</span>&nbsp;<span class="ident" id="4835987">defaultCheckRedirect</span><span class="op" id="4836007">(</span><span class="ident" id="4836008">req</span>&nbsp;<span class="op" id="4836012">*</span><span class="ident" id="4836013">Request</span><span class="op" id="4836020">,</span>&nbsp;<span class="ident" id="4836022">via</span>&nbsp;<span class="op" id="4836026">[</span><span class="op" id="4836027">]</span><span class="op" id="4836028">*</span><span class="ident" id="4836029">Request</span><span class="op" id="4836036">)</span>&nbsp;<span class="builtintype" id="4836038">error</span>&nbsp;<span class="op" id="4836044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836047">if</span>&nbsp;<span class="builtinfunc" id="4836050">len</span><span class="op" id="4836053">(</span><span class="ident" id="4836054">via</span><span class="op" id="4836057">)</span>&nbsp;<span class="op" id="4836059">&gt;=</span>&nbsp;<span class="num" id="4836062">10</span>&nbsp;<span class="op" id="4836065">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836069">return</span>&nbsp;<span class="ident" id="4836076">errors</span><span class="op" id="4836082">.</span><span class="ident" id="4836083">New</span><span class="op" id="4836086">(</span><span class="string" id="4836087">&#34;stopped&nbsp;after&nbsp;10&nbsp;redirects&#34;</span><span class="op" id="4836115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4836118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836121">return</span>&nbsp;<span class="ident" id="4836128">nil</span><br>
<span class="lineno"></span><span class="op" id="4836132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="4836135">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno"></span><span class="comment" id="4836179">//</span><br>
<span class="lineno"></span><span class="comment" id="4836182">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4836242">//</span><br>
<span class="lineno"></span><span class="comment" id="4836245">//&nbsp;Post&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Post</span><br>
<span class="lineno">425</span><span class="keyword" id="4836292">func</span>&nbsp;<span class="ident" id="4836297">Post</span><span class="op" id="4836301">(</span><span class="ident" id="4836302">url</span>&nbsp;<span class="builtintype" id="4836306">string</span><span class="op" id="4836312">,</span>&nbsp;<span class="ident" id="4836314">bodyType</span>&nbsp;<span class="builtintype" id="4836323">string</span><span class="op" id="4836329">,</span>&nbsp;<span class="ident" id="4836331">body</span>&nbsp;<span class="ident" id="4836336">io</span><span class="op" id="4836338">.</span><span class="ident" id="4836339">Reader</span><span class="op" id="4836345">)</span>&nbsp;<span class="op" id="4836347">(</span><span class="ident" id="4836348">resp</span>&nbsp;<span class="op" id="4836353">*</span><span class="ident" id="4836354">Response</span><span class="op" id="4836362">,</span>&nbsp;<span class="ident" id="4836364">err</span>&nbsp;<span class="builtintype" id="4836368">error</span><span class="op" id="4836373">)</span>&nbsp;<span class="op" id="4836375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836378">return</span>&nbsp;<span class="ident" id="4836385">DefaultClient</span><span class="op" id="4836398">.</span><span class="ident" id="4836399">Post</span><span class="op" id="4836403">(</span><span class="ident" id="4836404">url</span><span class="op" id="4836407">,</span>&nbsp;<span class="ident" id="4836409">bodyType</span><span class="op" id="4836417">,</span>&nbsp;<span class="ident" id="4836419">body</span><span class="op" id="4836423">)</span><br>
<span class="lineno"></span><span class="op" id="4836425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4836428">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno">430</span><span class="comment" id="4836472">//</span><br>
<span class="lineno"></span><span class="comment" id="4836475">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4836535">//</span><br>
<span class="lineno"></span><span class="comment" id="4836538">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;it&nbsp;is&nbsp;closed&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4836607">//&nbsp;request.</span><br>
<span class="lineno">435</span><span class="keyword" id="4836619">func</span>&nbsp;<span class="op" id="4836624">(</span><span class="ident" id="4836625">c</span>&nbsp;<span class="op" id="4836627">*</span><span class="ident" id="4836628">Client</span><span class="op" id="4836634">)</span>&nbsp;<span class="ident" id="4836636">Post</span><span class="op" id="4836640">(</span><span class="ident" id="4836641">url</span>&nbsp;<span class="builtintype" id="4836645">string</span><span class="op" id="4836651">,</span>&nbsp;<span class="ident" id="4836653">bodyType</span>&nbsp;<span class="builtintype" id="4836662">string</span><span class="op" id="4836668">,</span>&nbsp;<span class="ident" id="4836670">body</span>&nbsp;<span class="ident" id="4836675">io</span><span class="op" id="4836677">.</span><span class="ident" id="4836678">Reader</span><span class="op" id="4836684">)</span>&nbsp;<span class="op" id="4836686">(</span><span class="ident" id="4836687">resp</span>&nbsp;<span class="op" id="4836692">*</span><span class="ident" id="4836693">Response</span><span class="op" id="4836701">,</span>&nbsp;<span class="ident" id="4836703">err</span>&nbsp;<span class="builtintype" id="4836707">error</span><span class="op" id="4836712">)</span>&nbsp;<span class="op" id="4836714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4836717">req</span><span class="op" id="4836720">,</span>&nbsp;<span class="ident" id="4836722">err</span>&nbsp;<span class="op" id="4836726">:=</span>&nbsp;<span class="ident" id="4836729">NewRequest</span><span class="op" id="4836739">(</span><span class="string" id="4836740">&#34;POST&#34;</span><span class="op" id="4836746">,</span>&nbsp;<span class="ident" id="4836748">url</span><span class="op" id="4836751">,</span>&nbsp;<span class="ident" id="4836753">body</span><span class="op" id="4836757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836760">if</span>&nbsp;<span class="ident" id="4836763">err</span>&nbsp;<span class="op" id="4836767">!=</span>&nbsp;<span class="ident" id="4836770">nil</span>&nbsp;<span class="op" id="4836774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836778">return</span>&nbsp;<span class="ident" id="4836785">nil</span><span class="op" id="4836788">,</span>&nbsp;<span class="ident" id="4836790">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4836795">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4836798">req</span><span class="op" id="4836801">.</span><span class="ident" id="4836802">Header</span><span class="op" id="4836808">.</span><span class="ident" id="4836809">Set</span><span class="op" id="4836812">(</span><span class="string" id="4836813">&#34;Content-Type&#34;</span><span class="op" id="4836827">,</span>&nbsp;<span class="ident" id="4836829">bodyType</span><span class="op" id="4836837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4836840">return</span>&nbsp;<span class="ident" id="4836847">c</span><span class="op" id="4836848">.</span><span class="ident" id="4836849">doFollowingRedirects</span><span class="op" id="4836869">(</span><span class="ident" id="4836870">req</span><span class="op" id="4836873">,</span>&nbsp;<span class="ident" id="4836875">shouldRedirectPost</span><span class="op" id="4836893">)</span><br>
<span class="lineno"></span><span class="op" id="4836895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4836898">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and</span><br>
<span class="lineno">445</span><span class="comment" id="4836967">//&nbsp;values&nbsp;URL-encoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="4837010">//</span><br>
<span class="lineno"></span><span class="comment" id="4837013">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4837075">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4837135">//</span><br>
<span class="lineno">450</span><span class="comment" id="4837138">//&nbsp;PostForm&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.PostForm</span><br>
<span class="lineno"></span><span class="keyword" id="4837193">func</span>&nbsp;<span class="ident" id="4837198">PostForm</span><span class="op" id="4837206">(</span><span class="ident" id="4837207">url</span>&nbsp;<span class="builtintype" id="4837211">string</span><span class="op" id="4837217">,</span>&nbsp;<span class="ident" id="4837219">data</span>&nbsp;<span class="ident" id="4837224">url</span><span class="op" id="4837227">.</span><span class="ident" id="4837228">Values</span><span class="op" id="4837234">)</span>&nbsp;<span class="op" id="4837236">(</span><span class="ident" id="4837237">resp</span>&nbsp;<span class="op" id="4837242">*</span><span class="ident" id="4837243">Response</span><span class="op" id="4837251">,</span>&nbsp;<span class="ident" id="4837253">err</span>&nbsp;<span class="builtintype" id="4837257">error</span><span class="op" id="4837262">)</span>&nbsp;<span class="op" id="4837264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4837267">return</span>&nbsp;<span class="ident" id="4837274">DefaultClient</span><span class="op" id="4837287">.</span><span class="ident" id="4837288">PostForm</span><span class="op" id="4837296">(</span><span class="ident" id="4837297">url</span><span class="op" id="4837300">,</span>&nbsp;<span class="ident" id="4837302">data</span><span class="op" id="4837306">)</span><br>
<span class="lineno"></span><span class="op" id="4837308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="4837311">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,</span><br>
<span class="lineno"></span><span class="comment" id="4837359">//&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and&nbsp;values&nbsp;urlencoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="4837422">//</span><br>
<span class="lineno"></span><span class="comment" id="4837425">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="4837487">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno">460</span><span class="keyword" id="4837547">func</span>&nbsp;<span class="op" id="4837552">(</span><span class="ident" id="4837553">c</span>&nbsp;<span class="op" id="4837555">*</span><span class="ident" id="4837556">Client</span><span class="op" id="4837562">)</span>&nbsp;<span class="ident" id="4837564">PostForm</span><span class="op" id="4837572">(</span><span class="ident" id="4837573">url</span>&nbsp;<span class="builtintype" id="4837577">string</span><span class="op" id="4837583">,</span>&nbsp;<span class="ident" id="4837585">data</span>&nbsp;<span class="ident" id="4837590">url</span><span class="op" id="4837593">.</span><span class="ident" id="4837594">Values</span><span class="op" id="4837600">)</span>&nbsp;<span class="op" id="4837602">(</span><span class="ident" id="4837603">resp</span>&nbsp;<span class="op" id="4837608">*</span><span class="ident" id="4837609">Response</span><span class="op" id="4837617">,</span>&nbsp;<span class="ident" id="4837619">err</span>&nbsp;<span class="builtintype" id="4837623">error</span><span class="op" id="4837628">)</span>&nbsp;<span class="op" id="4837630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4837633">return</span>&nbsp;<span class="ident" id="4837640">c</span><span class="op" id="4837641">.</span><span class="ident" id="4837642">Post</span><span class="op" id="4837646">(</span><span class="ident" id="4837647">url</span><span class="op" id="4837650">,</span>&nbsp;<span class="string" id="4837652">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="4837687">,</span>&nbsp;<span class="ident" id="4837689">strings</span><span class="op" id="4837696">.</span><span class="ident" id="4837697">NewReader</span><span class="op" id="4837706">(</span><span class="ident" id="4837707">data</span><span class="op" id="4837711">.</span><span class="ident" id="4837712">Encode</span><span class="op" id="4837718">(</span><span class="op" id="4837719">)</span><span class="op" id="4837720">)</span><span class="op" id="4837721">)</span><br>
<span class="lineno"></span><span class="op" id="4837723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4837726">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="4837801">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4837874">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4837910">//</span><br>
<span class="lineno"></span><span class="comment" id="4837913">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="4837943">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">470</span><span class="comment" id="4837961">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="4837983">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="4838014">//</span><br>
<span class="lineno"></span><span class="comment" id="4838017">//&nbsp;Head&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Head</span><br>
<span class="lineno"></span><span class="keyword" id="4838064">func</span>&nbsp;<span class="ident" id="4838069">Head</span><span class="op" id="4838073">(</span><span class="ident" id="4838074">url</span>&nbsp;<span class="builtintype" id="4838078">string</span><span class="op" id="4838084">)</span>&nbsp;<span class="op" id="4838086">(</span><span class="ident" id="4838087">resp</span>&nbsp;<span class="op" id="4838092">*</span><span class="ident" id="4838093">Response</span><span class="op" id="4838101">,</span>&nbsp;<span class="ident" id="4838103">err</span>&nbsp;<span class="builtintype" id="4838107">error</span><span class="op" id="4838112">)</span>&nbsp;<span class="op" id="4838114">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838117">return</span>&nbsp;<span class="ident" id="4838124">DefaultClient</span><span class="op" id="4838137">.</span><span class="ident" id="4838138">Head</span><span class="op" id="4838142">(</span><span class="ident" id="4838143">url</span><span class="op" id="4838146">)</span><br>
<span class="lineno"></span><span class="op" id="4838148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4838151">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4838226">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="4838299">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4838335">//</span><br>
<span class="lineno"></span><span class="comment" id="4838338">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="4838368">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="4838386">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">485</span><span class="comment" id="4838408">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="keyword" id="4838439">func</span>&nbsp;<span class="op" id="4838444">(</span><span class="ident" id="4838445">c</span>&nbsp;<span class="op" id="4838447">*</span><span class="ident" id="4838448">Client</span><span class="op" id="4838454">)</span>&nbsp;<span class="ident" id="4838456">Head</span><span class="op" id="4838460">(</span><span class="ident" id="4838461">url</span>&nbsp;<span class="builtintype" id="4838465">string</span><span class="op" id="4838471">)</span>&nbsp;<span class="op" id="4838473">(</span><span class="ident" id="4838474">resp</span>&nbsp;<span class="op" id="4838479">*</span><span class="ident" id="4838480">Response</span><span class="op" id="4838488">,</span>&nbsp;<span class="ident" id="4838490">err</span>&nbsp;<span class="builtintype" id="4838494">error</span><span class="op" id="4838499">)</span>&nbsp;<span class="op" id="4838501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838504">req</span><span class="op" id="4838507">,</span>&nbsp;<span class="ident" id="4838509">err</span>&nbsp;<span class="op" id="4838513">:=</span>&nbsp;<span class="ident" id="4838516">NewRequest</span><span class="op" id="4838526">(</span><span class="string" id="4838527">&#34;HEAD&#34;</span><span class="op" id="4838533">,</span>&nbsp;<span class="ident" id="4838535">url</span><span class="op" id="4838538">,</span>&nbsp;<span class="ident" id="4838540">nil</span><span class="op" id="4838543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838546">if</span>&nbsp;<span class="ident" id="4838549">err</span>&nbsp;<span class="op" id="4838553">!=</span>&nbsp;<span class="ident" id="4838556">nil</span>&nbsp;<span class="op" id="4838560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838564">return</span>&nbsp;<span class="ident" id="4838571">nil</span><span class="op" id="4838574">,</span>&nbsp;<span class="ident" id="4838576">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4838581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838584">return</span>&nbsp;<span class="ident" id="4838591">c</span><span class="op" id="4838592">.</span><span class="ident" id="4838593">doFollowingRedirects</span><span class="op" id="4838613">(</span><span class="ident" id="4838614">req</span><span class="op" id="4838617">,</span>&nbsp;<span class="ident" id="4838619">shouldRedirectGet</span><span class="op" id="4838636">)</span><br>
<span class="lineno"></span><span class="op" id="4838638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4838641">type</span>&nbsp;<span class="ident" id="4838646">cancelTimerBody</span>&nbsp;<span class="keyword" id="4838662">struct</span>&nbsp;<span class="op" id="4838669">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838672">t</span>&nbsp;&nbsp;<span class="op" id="4838675">*</span><span class="ident" id="4838676">time</span><span class="op" id="4838680">.</span><span class="ident" id="4838681">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838688">rc</span>&nbsp;<span class="ident" id="4838691">io</span><span class="op" id="4838693">.</span><span class="ident" id="4838694">ReadCloser</span><br>
<span class="lineno"></span><span class="op" id="4838705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4838708">func</span>&nbsp;<span class="op" id="4838713">(</span><span class="ident" id="4838714">b</span>&nbsp;<span class="op" id="4838716">*</span><span class="ident" id="4838717">cancelTimerBody</span><span class="op" id="4838732">)</span>&nbsp;<span class="ident" id="4838734">Read</span><span class="op" id="4838738">(</span><span class="ident" id="4838739">p</span>&nbsp;<span class="op" id="4838741">[</span><span class="op" id="4838742">]</span><span class="builtintype" id="4838743">byte</span><span class="op" id="4838747">)</span>&nbsp;<span class="op" id="4838749">(</span><span class="ident" id="4838750">n</span>&nbsp;<span class="builtintype" id="4838752">int</span><span class="op" id="4838755">,</span>&nbsp;<span class="ident" id="4838757">err</span>&nbsp;<span class="builtintype" id="4838761">error</span><span class="op" id="4838766">)</span>&nbsp;<span class="op" id="4838768">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838771">n</span><span class="op" id="4838772">,</span>&nbsp;<span class="ident" id="4838774">err</span>&nbsp;<span class="op" id="4838778">=</span>&nbsp;<span class="ident" id="4838780">b</span><span class="op" id="4838781">.</span><span class="ident" id="4838782">rc</span><span class="op" id="4838784">.</span><span class="ident" id="4838785">Read</span><span class="op" id="4838789">(</span><span class="ident" id="4838790">p</span><span class="op" id="4838791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838794">if</span>&nbsp;<span class="ident" id="4838797">err</span>&nbsp;<span class="op" id="4838801">==</span>&nbsp;<span class="ident" id="4838804">io</span><span class="op" id="4838806">.</span><span class="ident" id="4838807">EOF</span>&nbsp;<span class="op" id="4838811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838815">b</span><span class="op" id="4838816">.</span><span class="ident" id="4838817">t</span><span class="op" id="4838818">.</span><span class="ident" id="4838819">Stop</span><span class="op" id="4838823">(</span><span class="op" id="4838824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4838827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838830">return</span><br>
<span class="lineno">505</span><span class="op" id="4838837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4838840">func</span>&nbsp;<span class="op" id="4838845">(</span><span class="ident" id="4838846">b</span>&nbsp;<span class="op" id="4838848">*</span><span class="ident" id="4838849">cancelTimerBody</span><span class="op" id="4838864">)</span>&nbsp;<span class="ident" id="4838866">Close</span><span class="op" id="4838871">(</span><span class="op" id="4838872">)</span>&nbsp;<span class="builtintype" id="4838874">error</span>&nbsp;<span class="op" id="4838880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838883">err</span>&nbsp;<span class="op" id="4838887">:=</span>&nbsp;<span class="ident" id="4838890">b</span><span class="op" id="4838891">.</span><span class="ident" id="4838892">rc</span><span class="op" id="4838894">.</span><span class="ident" id="4838895">Close</span><span class="op" id="4838900">(</span><span class="op" id="4838901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4838904">b</span><span class="op" id="4838905">.</span><span class="ident" id="4838906">t</span><span class="op" id="4838907">.</span><span class="ident" id="4838908">Stop</span><span class="op" id="4838912">(</span><span class="op" id="4838913">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4838916">return</span>&nbsp;<span class="ident" id="4838923">err</span><br>
<span class="lineno"></span><span class="op" id="4838927">}</span>
</div>
</body>
</html>
