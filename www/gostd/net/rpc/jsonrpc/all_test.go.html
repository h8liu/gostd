<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html" class="current">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8046438">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8046494">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8046548">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8046599">package</span>&nbsp;<span class="ident" id="8046607">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8046616">import</span>&nbsp;<span class="op" id="8046623">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8046626">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8046635">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8046652">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8046662">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8046669">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8046675">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8046688">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8046695">&#34;net/rpc&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8046706">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8046717">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8046727">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8046730">type</span>&nbsp;<span class="ident" id="8046735">Args</span>&nbsp;<span class="keyword" id="8046740">struct</span>&nbsp;<span class="op" id="8046747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8046750">A</span><span class="op" id="8046751">,</span>&nbsp;<span class="ident" id="8046753">B</span>&nbsp;<span class="builtintype" id="8046755">int</span><br>
<span class="lineno"></span><span class="op" id="8046759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8046762">type</span>&nbsp;<span class="ident" id="8046767">Reply</span>&nbsp;<span class="keyword" id="8046773">struct</span>&nbsp;<span class="op" id="8046780">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8046783">C</span>&nbsp;<span class="builtintype" id="8046785">int</span><br>
<span class="lineno"></span><span class="op" id="8046789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8046792">type</span>&nbsp;<span class="ident" id="8046797">Arith</span>&nbsp;<span class="builtintype" id="8046803">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8046808">type</span>&nbsp;<span class="ident" id="8046813">ArithAddResp</span>&nbsp;<span class="keyword" id="8046826">struct</span>&nbsp;<span class="op" id="8046833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8046836">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8046843">interface</span><span class="op" id="8046852">{</span><span class="op" id="8046853">}</span>&nbsp;<span class="string" id="8046855">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8046868">Result</span>&nbsp;<span class="ident" id="8046875">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8046887">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8046904">Error</span>&nbsp;&nbsp;<span class="keyword" id="8046911">interface</span><span class="op" id="8046920">{</span><span class="op" id="8046921">}</span>&nbsp;<span class="string" id="8046923">`json:&#34;error&#34;`</span><br>
<span class="lineno"></span><span class="op" id="8046938">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="8046941">func</span>&nbsp;<span class="op" id="8046946">(</span><span class="ident" id="8046947">t</span>&nbsp;<span class="op" id="8046949">*</span><span class="ident" id="8046950">Arith</span><span class="op" id="8046955">)</span>&nbsp;<span class="ident" id="8046957">Add</span><span class="op" id="8046960">(</span><span class="ident" id="8046961">args</span>&nbsp;<span class="op" id="8046966">*</span><span class="ident" id="8046967">Args</span><span class="op" id="8046971">,</span>&nbsp;<span class="ident" id="8046973">reply</span>&nbsp;<span class="op" id="8046979">*</span><span class="ident" id="8046980">Reply</span><span class="op" id="8046985">)</span>&nbsp;<span class="builtintype" id="8046987">error</span>&nbsp;<span class="op" id="8046993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8046996">reply</span><span class="op" id="8047001">.</span><span class="ident" id="8047002">C</span>&nbsp;<span class="op" id="8047004">=</span>&nbsp;<span class="ident" id="8047006">args</span><span class="op" id="8047010">.</span><span class="ident" id="8047011">A</span>&nbsp;<span class="op" id="8047013">+</span>&nbsp;<span class="ident" id="8047015">args</span><span class="op" id="8047019">.</span><span class="ident" id="8047020">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8047023">return</span>&nbsp;<span class="ident" id="8047030">nil</span><br>
<span class="lineno"></span><span class="op" id="8047034">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8047037">func</span>&nbsp;<span class="op" id="8047042">(</span><span class="ident" id="8047043">t</span>&nbsp;<span class="op" id="8047045">*</span><span class="ident" id="8047046">Arith</span><span class="op" id="8047051">)</span>&nbsp;<span class="ident" id="8047053">Mul</span><span class="op" id="8047056">(</span><span class="ident" id="8047057">args</span>&nbsp;<span class="op" id="8047062">*</span><span class="ident" id="8047063">Args</span><span class="op" id="8047067">,</span>&nbsp;<span class="ident" id="8047069">reply</span>&nbsp;<span class="op" id="8047075">*</span><span class="ident" id="8047076">Reply</span><span class="op" id="8047081">)</span>&nbsp;<span class="builtintype" id="8047083">error</span>&nbsp;<span class="op" id="8047089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8047092">reply</span><span class="op" id="8047097">.</span><span class="ident" id="8047098">C</span>&nbsp;<span class="op" id="8047100">=</span>&nbsp;<span class="ident" id="8047102">args</span><span class="op" id="8047106">.</span><span class="ident" id="8047107">A</span>&nbsp;<span class="op" id="8047109">*</span>&nbsp;<span class="ident" id="8047111">args</span><span class="op" id="8047115">.</span><span class="ident" id="8047116">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8047119">return</span>&nbsp;<span class="ident" id="8047126">nil</span><br>
<span class="lineno"></span><span class="op" id="8047130">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8047133">func</span>&nbsp;<span class="op" id="8047138">(</span><span class="ident" id="8047139">t</span>&nbsp;<span class="op" id="8047141">*</span><span class="ident" id="8047142">Arith</span><span class="op" id="8047147">)</span>&nbsp;<span class="ident" id="8047149">Div</span><span class="op" id="8047152">(</span><span class="ident" id="8047153">args</span>&nbsp;<span class="op" id="8047158">*</span><span class="ident" id="8047159">Args</span><span class="op" id="8047163">,</span>&nbsp;<span class="ident" id="8047165">reply</span>&nbsp;<span class="op" id="8047171">*</span><span class="ident" id="8047172">Reply</span><span class="op" id="8047177">)</span>&nbsp;<span class="builtintype" id="8047179">error</span>&nbsp;<span class="op" id="8047185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8047188">if</span>&nbsp;<span class="ident" id="8047191">args</span><span class="op" id="8047195">.</span><span class="ident" id="8047196">B</span>&nbsp;<span class="op" id="8047198">==</span>&nbsp;<span class="num" id="8047201">0</span>&nbsp;<span class="op" id="8047203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8047207">return</span>&nbsp;<span class="ident" id="8047214">errors</span><span class="op" id="8047220">.</span><span class="ident" id="8047221">New</span><span class="op" id="8047224">(</span><span class="string" id="8047225">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="8047241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8047244">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8047247">reply</span><span class="op" id="8047252">.</span><span class="ident" id="8047253">C</span>&nbsp;<span class="op" id="8047255">=</span>&nbsp;<span class="ident" id="8047257">args</span><span class="op" id="8047261">.</span><span class="ident" id="8047262">A</span>&nbsp;<span class="op" id="8047264">/</span>&nbsp;<span class="ident" id="8047266">args</span><span class="op" id="8047270">.</span><span class="ident" id="8047271">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8047274">return</span>&nbsp;<span class="ident" id="8047281">nil</span><br>
<span class="lineno"></span><span class="op" id="8047285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8047288">func</span>&nbsp;<span class="op" id="8047293">(</span><span class="ident" id="8047294">t</span>&nbsp;<span class="op" id="8047296">*</span><span class="ident" id="8047297">Arith</span><span class="op" id="8047302">)</span>&nbsp;<span class="ident" id="8047304">Error</span><span class="op" id="8047309">(</span><span class="ident" id="8047310">args</span>&nbsp;<span class="op" id="8047315">*</span><span class="ident" id="8047316">Args</span><span class="op" id="8047320">,</span>&nbsp;<span class="ident" id="8047322">reply</span>&nbsp;<span class="op" id="8047328">*</span><span class="ident" id="8047329">Reply</span><span class="op" id="8047334">)</span>&nbsp;<span class="builtintype" id="8047336">error</span>&nbsp;<span class="op" id="8047342">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8047345">panic</span><span class="op" id="8047350">(</span><span class="string" id="8047351">&#34;ERROR&#34;</span><span class="op" id="8047358">)</span><br>
<span class="lineno"></span><span class="op" id="8047360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8047363">func</span>&nbsp;<span class="ident" id="8047368">init</span><span class="op" id="8047372">(</span><span class="op" id="8047373">)</span>&nbsp;<span class="op" id="8047375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8047378">rpc</span><span class="op" id="8047381">.</span><span class="ident" id="8047382">Register</span><span class="op" id="8047390">(</span><span class="builtinfunc" id="8047391">new</span><span class="op" id="8047394">(</span><span class="ident" id="8047395">Arith</span><span class="op" id="8047400">)</span><span class="op" id="8047401">)</span><br>
<span class="lineno">60</span><span class="op" id="8047403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8047406">func</span>&nbsp;<span class="ident" id="8047411">TestServerNoParams</span><span class="op" id="8047429">(</span><span class="ident" id="8047430">t</span>&nbsp;<span class="op" id="8047432">*</span><span class="ident" id="8047433">testing</span><span class="op" id="8047440">.</span><span class="ident" id="8047441">T</span><span class="op" id="8047442">)</span>&nbsp;<span class="op" id="8047444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8047447">cli</span><span class="op" id="8047450">,</span>&nbsp;<span class="ident" id="8047452">srv</span>&nbsp;<span class="op" id="8047456">:=</span>&nbsp;<span class="ident" id="8047459">net</span><span class="op" id="8047462">.</span><span class="ident" id="8047463">Pipe</span><span class="op" id="8047467">(</span><span class="op" id="8047468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8047471">defer</span>&nbsp;<span class="ident" id="8047477">cli</span><span class="op" id="8047480">.</span><span class="ident" id="8047481">Close</span><span class="op" id="8047486">(</span><span class="op" id="8047487">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8047490">go</span>&nbsp;<span class="ident" id="8047493">ServeConn</span><span class="op" id="8047502">(</span><span class="ident" id="8047503">srv</span><span class="op" id="8047506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8047509">dec</span>&nbsp;<span class="op" id="8047513">:=</span>&nbsp;<span class="ident" id="8047516">json</span><span class="op" id="8047520">.</span><span class="ident" id="8047521">NewDecoder</span><span class="op" id="8047531">(</span><span class="ident" id="8047532">cli</span><span class="op" id="8047535">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8047539">fmt</span><span class="op" id="8047542">.</span><span class="ident" id="8047543">Fprintf</span><span class="op" id="8047550">(</span><span class="ident" id="8047551">cli</span><span class="op" id="8047554">,</span>&nbsp;<span class="string" id="8047556">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;}`</span><span class="op" id="8047594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8047597">var</span>&nbsp;<span class="ident" id="8047601">resp</span>&nbsp;<span class="ident" id="8047606">ArithAddResp</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8047620">if</span>&nbsp;<span class="ident" id="8047623">err</span>&nbsp;<span class="op" id="8047627">:=</span>&nbsp;<span class="ident" id="8047630">dec</span><span class="op" id="8047633">.</span><span class="ident" id="8047634">Decode</span><span class="op" id="8047640">(</span><span class="op" id="8047641">&amp;</span><span class="ident" id="8047642">resp</span><span class="op" id="8047646">)</span><span class="op" id="8047647">;</span>&nbsp;<span class="ident" id="8047649">err</span>&nbsp;<span class="op" id="8047653">!=</span>&nbsp;<span class="ident" id="8047656">nil</span>&nbsp;<span class="op" id="8047660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8047664">t</span><span class="op" id="8047665">.</span><span class="ident" id="8047666">Fatalf</span><span class="op" id="8047672">(</span><span class="string" id="8047673">&#34;Decode&nbsp;after&nbsp;no&nbsp;params:&nbsp;%s&#34;</span><span class="op" id="8047701">,</span>&nbsp;<span class="ident" id="8047703">err</span><span class="op" id="8047706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8047709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8047712">if</span>&nbsp;<span class="ident" id="8047715">resp</span><span class="op" id="8047719">.</span><span class="ident" id="8047720">Error</span>&nbsp;<span class="op" id="8047726">==</span>&nbsp;<span class="ident" id="8047729">nil</span>&nbsp;<span class="op" id="8047733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8047737">t</span><span class="op" id="8047738">.</span><span class="ident" id="8047739">Fatalf</span><span class="op" id="8047745">(</span><span class="string" id="8047746">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="8047771">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8047774">}</span><br>
<span class="lineno"></span><span class="op" id="8047776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8047779">func</span>&nbsp;<span class="ident" id="8047784">TestServerEmptyMessage</span><span class="op" id="8047806">(</span><span class="ident" id="8047807">t</span>&nbsp;<span class="op" id="8047809">*</span><span class="ident" id="8047810">testing</span><span class="op" id="8047817">.</span><span class="ident" id="8047818">T</span><span class="op" id="8047819">)</span>&nbsp;<span class="op" id="8047821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8047824">cli</span><span class="op" id="8047827">,</span>&nbsp;<span class="ident" id="8047829">srv</span>&nbsp;<span class="op" id="8047833">:=</span>&nbsp;<span class="ident" id="8047836">net</span><span class="op" id="8047839">.</span><span class="ident" id="8047840">Pipe</span><span class="op" id="8047844">(</span><span class="op" id="8047845">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8047848">defer</span>&nbsp;<span class="ident" id="8047854">cli</span><span class="op" id="8047857">.</span><span class="ident" id="8047858">Close</span><span class="op" id="8047863">(</span><span class="op" id="8047864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8047867">go</span>&nbsp;<span class="ident" id="8047870">ServeConn</span><span class="op" id="8047879">(</span><span class="ident" id="8047880">srv</span><span class="op" id="8047883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8047886">dec</span>&nbsp;<span class="op" id="8047890">:=</span>&nbsp;<span class="ident" id="8047893">json</span><span class="op" id="8047897">.</span><span class="ident" id="8047898">NewDecoder</span><span class="op" id="8047908">(</span><span class="ident" id="8047909">cli</span><span class="op" id="8047912">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8047916">fmt</span><span class="op" id="8047919">.</span><span class="ident" id="8047920">Fprintf</span><span class="op" id="8047927">(</span><span class="ident" id="8047928">cli</span><span class="op" id="8047931">,</span>&nbsp;<span class="string" id="8047933">&#34;{}&#34;</span><span class="op" id="8047937">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8047940">var</span>&nbsp;<span class="ident" id="8047944">resp</span>&nbsp;<span class="ident" id="8047949">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8047963">if</span>&nbsp;<span class="ident" id="8047966">err</span>&nbsp;<span class="op" id="8047970">:=</span>&nbsp;<span class="ident" id="8047973">dec</span><span class="op" id="8047976">.</span><span class="ident" id="8047977">Decode</span><span class="op" id="8047983">(</span><span class="op" id="8047984">&amp;</span><span class="ident" id="8047985">resp</span><span class="op" id="8047989">)</span><span class="op" id="8047990">;</span>&nbsp;<span class="ident" id="8047992">err</span>&nbsp;<span class="op" id="8047996">!=</span>&nbsp;<span class="ident" id="8047999">nil</span>&nbsp;<span class="op" id="8048003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8048007">t</span><span class="op" id="8048008">.</span><span class="ident" id="8048009">Fatalf</span><span class="op" id="8048015">(</span><span class="string" id="8048016">&#34;Decode&nbsp;after&nbsp;empty:&nbsp;%s&#34;</span><span class="op" id="8048040">,</span>&nbsp;<span class="ident" id="8048042">err</span><span class="op" id="8048045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8048048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8048051">if</span>&nbsp;<span class="ident" id="8048054">resp</span><span class="op" id="8048058">.</span><span class="ident" id="8048059">Error</span>&nbsp;<span class="op" id="8048065">==</span>&nbsp;<span class="ident" id="8048068">nil</span>&nbsp;<span class="op" id="8048072">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8048076">t</span><span class="op" id="8048077">.</span><span class="ident" id="8048078">Fatalf</span><span class="op" id="8048084">(</span><span class="string" id="8048085">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="8048110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8048113">}</span><br>
<span class="lineno"></span><span class="op" id="8048115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8048118">func</span>&nbsp;<span class="ident" id="8048123">TestServer</span><span class="op" id="8048133">(</span><span class="ident" id="8048134">t</span>&nbsp;<span class="op" id="8048136">*</span><span class="ident" id="8048137">testing</span><span class="op" id="8048144">.</span><span class="ident" id="8048145">T</span><span class="op" id="8048146">)</span>&nbsp;<span class="op" id="8048148">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8048151">cli</span><span class="op" id="8048154">,</span>&nbsp;<span class="ident" id="8048156">srv</span>&nbsp;<span class="op" id="8048160">:=</span>&nbsp;<span class="ident" id="8048163">net</span><span class="op" id="8048166">.</span><span class="ident" id="8048167">Pipe</span><span class="op" id="8048171">(</span><span class="op" id="8048172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8048175">defer</span>&nbsp;<span class="ident" id="8048181">cli</span><span class="op" id="8048184">.</span><span class="ident" id="8048185">Close</span><span class="op" id="8048190">(</span><span class="op" id="8048191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8048194">go</span>&nbsp;<span class="ident" id="8048197">ServeConn</span><span class="op" id="8048206">(</span><span class="ident" id="8048207">srv</span><span class="op" id="8048210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8048213">dec</span>&nbsp;<span class="op" id="8048217">:=</span>&nbsp;<span class="ident" id="8048220">json</span><span class="op" id="8048224">.</span><span class="ident" id="8048225">NewDecoder</span><span class="op" id="8048235">(</span><span class="ident" id="8048236">cli</span><span class="op" id="8048239">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8048243">//&nbsp;Send&nbsp;hand-coded&nbsp;requests&nbsp;to&nbsp;server,&nbsp;parse&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8048300">for</span>&nbsp;<span class="ident" id="8048304">i</span>&nbsp;<span class="op" id="8048306">:=</span>&nbsp;<span class="num" id="8048309">0</span><span class="op" id="8048310">;</span>&nbsp;<span class="ident" id="8048312">i</span>&nbsp;<span class="op" id="8048314">&lt;</span>&nbsp;<span class="num" id="8048316">10</span><span class="op" id="8048318">;</span>&nbsp;<span class="ident" id="8048320">i</span><span class="op" id="8048321">++</span>&nbsp;<span class="op" id="8048324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8048328">fmt</span><span class="op" id="8048331">.</span><span class="ident" id="8048332">Fprintf</span><span class="op" id="8048339">(</span><span class="ident" id="8048340">cli</span><span class="op" id="8048343">,</span>&nbsp;<span class="string" id="8048345">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;\u%04d&#34;,&nbsp;&#34;params&#34;:&nbsp;[{&#34;A&#34;:&nbsp;%d,&nbsp;&#34;B&#34;:&nbsp;%d}]}`</span><span class="op" id="8048418">,</span>&nbsp;<span class="ident" id="8048420">i</span><span class="op" id="8048421">,</span>&nbsp;<span class="ident" id="8048423">i</span><span class="op" id="8048424">,</span>&nbsp;<span class="ident" id="8048426">i</span><span class="op" id="8048427">+</span><span class="num" id="8048428">1</span><span class="op" id="8048429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8048433">var</span>&nbsp;<span class="ident" id="8048437">resp</span>&nbsp;<span class="ident" id="8048442">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8048457">err</span>&nbsp;<span class="op" id="8048461">:=</span>&nbsp;<span class="ident" id="8048464">dec</span><span class="op" id="8048467">.</span><span class="ident" id="8048468">Decode</span><span class="op" id="8048474">(</span><span class="op" id="8048475">&amp;</span><span class="ident" id="8048476">resp</span><span class="op" id="8048480">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8048484">if</span>&nbsp;<span class="ident" id="8048487">err</span>&nbsp;<span class="op" id="8048491">!=</span>&nbsp;<span class="ident" id="8048494">nil</span>&nbsp;<span class="op" id="8048498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8048503">t</span><span class="op" id="8048504">.</span><span class="ident" id="8048505">Fatalf</span><span class="op" id="8048511">(</span><span class="string" id="8048512">&#34;Decode:&nbsp;%s&#34;</span><span class="op" id="8048524">,</span>&nbsp;<span class="ident" id="8048526">err</span><span class="op" id="8048529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8048533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8048537">if</span>&nbsp;<span class="ident" id="8048540">resp</span><span class="op" id="8048544">.</span><span class="ident" id="8048545">Error</span>&nbsp;<span class="op" id="8048551">!=</span>&nbsp;<span class="ident" id="8048554">nil</span>&nbsp;<span class="op" id="8048558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8048563">t</span><span class="op" id="8048564">.</span><span class="ident" id="8048565">Fatalf</span><span class="op" id="8048571">(</span><span class="string" id="8048572">&#34;resp.Error:&nbsp;%s&#34;</span><span class="op" id="8048588">,</span>&nbsp;<span class="ident" id="8048590">resp</span><span class="op" id="8048594">.</span><span class="ident" id="8048595">Error</span><span class="op" id="8048600">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8048604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8048608">if</span>&nbsp;<span class="ident" id="8048611">resp</span><span class="op" id="8048615">.</span><span class="ident" id="8048616">Id</span><span class="op" id="8048618">.</span><span class="op" id="8048619">(</span><span class="builtintype" id="8048620">string</span><span class="op" id="8048626">)</span>&nbsp;<span class="op" id="8048628">!=</span>&nbsp;<span class="builtintype" id="8048631">string</span><span class="op" id="8048637">(</span><span class="ident" id="8048638">i</span><span class="op" id="8048639">)</span>&nbsp;<span class="op" id="8048641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8048646">t</span><span class="op" id="8048647">.</span><span class="ident" id="8048648">Fatalf</span><span class="op" id="8048654">(</span><span class="string" id="8048655">&#34;resp:&nbsp;bad&nbsp;id&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8048680">,</span>&nbsp;<span class="ident" id="8048682">resp</span><span class="op" id="8048686">.</span><span class="ident" id="8048687">Id</span><span class="op" id="8048689">.</span><span class="op" id="8048690">(</span><span class="builtintype" id="8048691">string</span><span class="op" id="8048697">)</span><span class="op" id="8048698">,</span>&nbsp;<span class="builtintype" id="8048700">string</span><span class="op" id="8048706">(</span><span class="ident" id="8048707">i</span><span class="op" id="8048708">)</span><span class="op" id="8048709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8048713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8048717">if</span>&nbsp;<span class="ident" id="8048720">resp</span><span class="op" id="8048724">.</span><span class="ident" id="8048725">Result</span><span class="op" id="8048731">.</span><span class="ident" id="8048732">C</span>&nbsp;<span class="op" id="8048734">!=</span>&nbsp;<span class="num" id="8048737">2</span><span class="op" id="8048738">*</span><span class="ident" id="8048739">i</span><span class="op" id="8048740">+</span><span class="num" id="8048741">1</span>&nbsp;<span class="op" id="8048743">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8048748">t</span><span class="op" id="8048749">.</span><span class="ident" id="8048750">Fatalf</span><span class="op" id="8048756">(</span><span class="string" id="8048757">&#34;resp:&nbsp;bad&nbsp;result:&nbsp;%d+%d=%d&#34;</span><span class="op" id="8048785">,</span>&nbsp;<span class="ident" id="8048787">i</span><span class="op" id="8048788">,</span>&nbsp;<span class="ident" id="8048790">i</span><span class="op" id="8048791">+</span><span class="num" id="8048792">1</span><span class="op" id="8048793">,</span>&nbsp;<span class="ident" id="8048795">resp</span><span class="op" id="8048799">.</span><span class="ident" id="8048800">Result</span><span class="op" id="8048806">.</span><span class="ident" id="8048807">C</span><span class="op" id="8048808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8048812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8048815">}</span><br>
<span class="lineno"></span><span class="op" id="8048817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8048820">func</span>&nbsp;<span class="ident" id="8048825">TestClient</span><span class="op" id="8048835">(</span><span class="ident" id="8048836">t</span>&nbsp;<span class="op" id="8048838">*</span><span class="ident" id="8048839">testing</span><span class="op" id="8048846">.</span><span class="ident" id="8048847">T</span><span class="op" id="8048848">)</span>&nbsp;<span class="op" id="8048850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8048853">//&nbsp;Assume&nbsp;server&nbsp;is&nbsp;okay&nbsp;(TestServer&nbsp;is&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8048902">//&nbsp;Test&nbsp;client&nbsp;against&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8048934">cli</span><span class="op" id="8048937">,</span>&nbsp;<span class="ident" id="8048939">srv</span>&nbsp;<span class="op" id="8048943">:=</span>&nbsp;<span class="ident" id="8048946">net</span><span class="op" id="8048949">.</span><span class="ident" id="8048950">Pipe</span><span class="op" id="8048954">(</span><span class="op" id="8048955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8048958">go</span>&nbsp;<span class="ident" id="8048961">ServeConn</span><span class="op" id="8048970">(</span><span class="ident" id="8048971">srv</span><span class="op" id="8048974">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8048978">client</span>&nbsp;<span class="op" id="8048985">:=</span>&nbsp;<span class="ident" id="8048988">NewClient</span><span class="op" id="8048997">(</span><span class="ident" id="8048998">cli</span><span class="op" id="8049001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8049004">defer</span>&nbsp;<span class="ident" id="8049010">client</span><span class="op" id="8049016">.</span><span class="ident" id="8049017">Close</span><span class="op" id="8049022">(</span><span class="op" id="8049023">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8049027">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049049">args</span>&nbsp;<span class="op" id="8049054">:=</span>&nbsp;<span class="op" id="8049057">&amp;</span><span class="ident" id="8049058">Args</span><span class="op" id="8049062">{</span><span class="num" id="8049063">7</span><span class="op" id="8049064">,</span>&nbsp;<span class="num" id="8049066">8</span><span class="op" id="8049067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049070">reply</span>&nbsp;<span class="op" id="8049076">:=</span>&nbsp;<span class="builtinfunc" id="8049079">new</span><span class="op" id="8049082">(</span><span class="ident" id="8049083">Reply</span><span class="op" id="8049088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049091">err</span>&nbsp;<span class="op" id="8049095">:=</span>&nbsp;<span class="ident" id="8049098">client</span><span class="op" id="8049104">.</span><span class="ident" id="8049105">Call</span><span class="op" id="8049109">(</span><span class="string" id="8049110">&#34;Arith.Add&#34;</span><span class="op" id="8049121">,</span>&nbsp;<span class="ident" id="8049123">args</span><span class="op" id="8049127">,</span>&nbsp;<span class="ident" id="8049129">reply</span><span class="op" id="8049134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8049137">if</span>&nbsp;<span class="ident" id="8049140">err</span>&nbsp;<span class="op" id="8049144">!=</span>&nbsp;<span class="ident" id="8049147">nil</span>&nbsp;<span class="op" id="8049151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049155">t</span><span class="op" id="8049156">.</span><span class="ident" id="8049157">Errorf</span><span class="op" id="8049163">(</span><span class="string" id="8049164">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8049206">,</span>&nbsp;<span class="ident" id="8049208">err</span><span class="op" id="8049211">.</span><span class="ident" id="8049212">Error</span><span class="op" id="8049217">(</span><span class="op" id="8049218">)</span><span class="op" id="8049219">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8049222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8049225">if</span>&nbsp;<span class="ident" id="8049228">reply</span><span class="op" id="8049233">.</span><span class="ident" id="8049234">C</span>&nbsp;<span class="op" id="8049236">!=</span>&nbsp;<span class="ident" id="8049239">args</span><span class="op" id="8049243">.</span><span class="ident" id="8049244">A</span><span class="op" id="8049245">+</span><span class="ident" id="8049246">args</span><span class="op" id="8049250">.</span><span class="ident" id="8049251">B</span>&nbsp;<span class="op" id="8049253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049257">t</span><span class="op" id="8049258">.</span><span class="ident" id="8049259">Errorf</span><span class="op" id="8049265">(</span><span class="string" id="8049266">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8049291">,</span>&nbsp;<span class="ident" id="8049293">reply</span><span class="op" id="8049298">.</span><span class="ident" id="8049299">C</span><span class="op" id="8049300">,</span>&nbsp;<span class="ident" id="8049302">args</span><span class="op" id="8049306">.</span><span class="ident" id="8049307">A</span><span class="op" id="8049308">+</span><span class="ident" id="8049309">args</span><span class="op" id="8049313">.</span><span class="ident" id="8049314">B</span><span class="op" id="8049315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8049318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049322">args</span>&nbsp;<span class="op" id="8049327">=</span>&nbsp;<span class="op" id="8049329">&amp;</span><span class="ident" id="8049330">Args</span><span class="op" id="8049334">{</span><span class="num" id="8049335">7</span><span class="op" id="8049336">,</span>&nbsp;<span class="num" id="8049338">8</span><span class="op" id="8049339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049342">reply</span>&nbsp;<span class="op" id="8049348">=</span>&nbsp;<span class="builtinfunc" id="8049350">new</span><span class="op" id="8049353">(</span><span class="ident" id="8049354">Reply</span><span class="op" id="8049359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049362">err</span>&nbsp;<span class="op" id="8049366">=</span>&nbsp;<span class="ident" id="8049368">client</span><span class="op" id="8049374">.</span><span class="ident" id="8049375">Call</span><span class="op" id="8049379">(</span><span class="string" id="8049380">&#34;Arith.Mul&#34;</span><span class="op" id="8049391">,</span>&nbsp;<span class="ident" id="8049393">args</span><span class="op" id="8049397">,</span>&nbsp;<span class="ident" id="8049399">reply</span><span class="op" id="8049404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8049407">if</span>&nbsp;<span class="ident" id="8049410">err</span>&nbsp;<span class="op" id="8049414">!=</span>&nbsp;<span class="ident" id="8049417">nil</span>&nbsp;<span class="op" id="8049421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049425">t</span><span class="op" id="8049426">.</span><span class="ident" id="8049427">Errorf</span><span class="op" id="8049433">(</span><span class="string" id="8049434">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8049476">,</span>&nbsp;<span class="ident" id="8049478">err</span><span class="op" id="8049481">.</span><span class="ident" id="8049482">Error</span><span class="op" id="8049487">(</span><span class="op" id="8049488">)</span><span class="op" id="8049489">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8049492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8049495">if</span>&nbsp;<span class="ident" id="8049498">reply</span><span class="op" id="8049503">.</span><span class="ident" id="8049504">C</span>&nbsp;<span class="op" id="8049506">!=</span>&nbsp;<span class="ident" id="8049509">args</span><span class="op" id="8049513">.</span><span class="ident" id="8049514">A</span><span class="op" id="8049515">*</span><span class="ident" id="8049516">args</span><span class="op" id="8049520">.</span><span class="ident" id="8049521">B</span>&nbsp;<span class="op" id="8049523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049527">t</span><span class="op" id="8049528">.</span><span class="ident" id="8049529">Errorf</span><span class="op" id="8049535">(</span><span class="string" id="8049536">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8049561">,</span>&nbsp;<span class="ident" id="8049563">reply</span><span class="op" id="8049568">.</span><span class="ident" id="8049569">C</span><span class="op" id="8049570">,</span>&nbsp;<span class="ident" id="8049572">args</span><span class="op" id="8049576">.</span><span class="ident" id="8049577">A</span><span class="op" id="8049578">*</span><span class="ident" id="8049579">args</span><span class="op" id="8049583">.</span><span class="ident" id="8049584">B</span><span class="op" id="8049585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8049588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8049592">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049610">args</span>&nbsp;<span class="op" id="8049615">=</span>&nbsp;<span class="op" id="8049617">&amp;</span><span class="ident" id="8049618">Args</span><span class="op" id="8049622">{</span><span class="num" id="8049623">7</span><span class="op" id="8049624">,</span>&nbsp;<span class="num" id="8049626">8</span><span class="op" id="8049627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049630">mulReply</span>&nbsp;<span class="op" id="8049639">:=</span>&nbsp;<span class="builtinfunc" id="8049642">new</span><span class="op" id="8049645">(</span><span class="ident" id="8049646">Reply</span><span class="op" id="8049651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049654">mulCall</span>&nbsp;<span class="op" id="8049662">:=</span>&nbsp;<span class="ident" id="8049665">client</span><span class="op" id="8049671">.</span><span class="ident" id="8049672">Go</span><span class="op" id="8049674">(</span><span class="string" id="8049675">&#34;Arith.Mul&#34;</span><span class="op" id="8049686">,</span>&nbsp;<span class="ident" id="8049688">args</span><span class="op" id="8049692">,</span>&nbsp;<span class="ident" id="8049694">mulReply</span><span class="op" id="8049702">,</span>&nbsp;<span class="ident" id="8049704">nil</span><span class="op" id="8049707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049710">addReply</span>&nbsp;<span class="op" id="8049719">:=</span>&nbsp;<span class="builtinfunc" id="8049722">new</span><span class="op" id="8049725">(</span><span class="ident" id="8049726">Reply</span><span class="op" id="8049731">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049734">addCall</span>&nbsp;<span class="op" id="8049742">:=</span>&nbsp;<span class="ident" id="8049745">client</span><span class="op" id="8049751">.</span><span class="ident" id="8049752">Go</span><span class="op" id="8049754">(</span><span class="string" id="8049755">&#34;Arith.Add&#34;</span><span class="op" id="8049766">,</span>&nbsp;<span class="ident" id="8049768">args</span><span class="op" id="8049772">,</span>&nbsp;<span class="ident" id="8049774">addReply</span><span class="op" id="8049782">,</span>&nbsp;<span class="ident" id="8049784">nil</span><span class="op" id="8049787">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049791">addCall</span>&nbsp;<span class="op" id="8049799">=</span>&nbsp;<span class="op" id="8049801">&lt;-</span><span class="ident" id="8049803">addCall</span><span class="op" id="8049810">.</span><span class="ident" id="8049811">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8049817">if</span>&nbsp;<span class="ident" id="8049820">addCall</span><span class="op" id="8049827">.</span><span class="ident" id="8049828">Error</span>&nbsp;<span class="op" id="8049834">!=</span>&nbsp;<span class="ident" id="8049837">nil</span>&nbsp;<span class="op" id="8049841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049845">t</span><span class="op" id="8049846">.</span><span class="ident" id="8049847">Errorf</span><span class="op" id="8049853">(</span><span class="string" id="8049854">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8049896">,</span>&nbsp;<span class="ident" id="8049898">addCall</span><span class="op" id="8049905">.</span><span class="ident" id="8049906">Error</span><span class="op" id="8049911">.</span><span class="ident" id="8049912">Error</span><span class="op" id="8049917">(</span><span class="op" id="8049918">)</span><span class="op" id="8049919">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8049922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8049925">if</span>&nbsp;<span class="ident" id="8049928">addReply</span><span class="op" id="8049936">.</span><span class="ident" id="8049937">C</span>&nbsp;<span class="op" id="8049939">!=</span>&nbsp;<span class="ident" id="8049942">args</span><span class="op" id="8049946">.</span><span class="ident" id="8049947">A</span><span class="op" id="8049948">+</span><span class="ident" id="8049949">args</span><span class="op" id="8049953">.</span><span class="ident" id="8049954">B</span>&nbsp;<span class="op" id="8049956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8049960">t</span><span class="op" id="8049961">.</span><span class="ident" id="8049962">Errorf</span><span class="op" id="8049968">(</span><span class="string" id="8049969">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8049994">,</span>&nbsp;<span class="ident" id="8049996">addReply</span><span class="op" id="8050004">.</span><span class="ident" id="8050005">C</span><span class="op" id="8050006">,</span>&nbsp;<span class="ident" id="8050008">args</span><span class="op" id="8050012">.</span><span class="ident" id="8050013">A</span><span class="op" id="8050014">+</span><span class="ident" id="8050015">args</span><span class="op" id="8050019">.</span><span class="ident" id="8050020">B</span><span class="op" id="8050021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8050024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8050028">mulCall</span>&nbsp;<span class="op" id="8050036">=</span>&nbsp;<span class="op" id="8050038">&lt;-</span><span class="ident" id="8050040">mulCall</span><span class="op" id="8050047">.</span><span class="ident" id="8050048">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8050054">if</span>&nbsp;<span class="ident" id="8050057">mulCall</span><span class="op" id="8050064">.</span><span class="ident" id="8050065">Error</span>&nbsp;<span class="op" id="8050071">!=</span>&nbsp;<span class="ident" id="8050074">nil</span>&nbsp;<span class="op" id="8050078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8050082">t</span><span class="op" id="8050083">.</span><span class="ident" id="8050084">Errorf</span><span class="op" id="8050090">(</span><span class="string" id="8050091">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="8050133">,</span>&nbsp;<span class="ident" id="8050135">mulCall</span><span class="op" id="8050142">.</span><span class="ident" id="8050143">Error</span><span class="op" id="8050148">.</span><span class="ident" id="8050149">Error</span><span class="op" id="8050154">(</span><span class="op" id="8050155">)</span><span class="op" id="8050156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8050159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8050162">if</span>&nbsp;<span class="ident" id="8050165">mulReply</span><span class="op" id="8050173">.</span><span class="ident" id="8050174">C</span>&nbsp;<span class="op" id="8050176">!=</span>&nbsp;<span class="ident" id="8050179">args</span><span class="op" id="8050183">.</span><span class="ident" id="8050184">A</span><span class="op" id="8050185">*</span><span class="ident" id="8050186">args</span><span class="op" id="8050190">.</span><span class="ident" id="8050191">B</span>&nbsp;<span class="op" id="8050193">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8050197">t</span><span class="op" id="8050198">.</span><span class="ident" id="8050199">Errorf</span><span class="op" id="8050205">(</span><span class="string" id="8050206">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8050231">,</span>&nbsp;<span class="ident" id="8050233">mulReply</span><span class="op" id="8050241">.</span><span class="ident" id="8050242">C</span><span class="op" id="8050243">,</span>&nbsp;<span class="ident" id="8050245">args</span><span class="op" id="8050249">.</span><span class="ident" id="8050250">A</span><span class="op" id="8050251">*</span><span class="ident" id="8050252">args</span><span class="op" id="8050256">.</span><span class="ident" id="8050257">B</span><span class="op" id="8050258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8050261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8050265">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8050280">args</span>&nbsp;<span class="op" id="8050285">=</span>&nbsp;<span class="op" id="8050287">&amp;</span><span class="ident" id="8050288">Args</span><span class="op" id="8050292">{</span><span class="num" id="8050293">7</span><span class="op" id="8050294">,</span>&nbsp;<span class="num" id="8050296">0</span><span class="op" id="8050297">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8050300">reply</span>&nbsp;<span class="op" id="8050306">=</span>&nbsp;<span class="builtinfunc" id="8050308">new</span><span class="op" id="8050311">(</span><span class="ident" id="8050312">Reply</span><span class="op" id="8050317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8050320">err</span>&nbsp;<span class="op" id="8050324">=</span>&nbsp;<span class="ident" id="8050326">client</span><span class="op" id="8050332">.</span><span class="ident" id="8050333">Call</span><span class="op" id="8050337">(</span><span class="string" id="8050338">&#34;Arith.Div&#34;</span><span class="op" id="8050349">,</span>&nbsp;<span class="ident" id="8050351">args</span><span class="op" id="8050355">,</span>&nbsp;<span class="ident" id="8050357">reply</span><span class="op" id="8050362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8050365">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8050398">if</span>&nbsp;<span class="ident" id="8050401">err</span>&nbsp;<span class="op" id="8050405">==</span>&nbsp;<span class="ident" id="8050408">nil</span>&nbsp;<span class="op" id="8050412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8050416">t</span><span class="op" id="8050417">.</span><span class="ident" id="8050418">Error</span><span class="op" id="8050423">(</span><span class="string" id="8050424">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8050445">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8050448">}</span>&nbsp;<span class="keyword" id="8050450">else</span>&nbsp;<span class="keyword" id="8050455">if</span>&nbsp;<span class="ident" id="8050458">err</span><span class="op" id="8050461">.</span><span class="ident" id="8050462">Error</span><span class="op" id="8050467">(</span><span class="op" id="8050468">)</span>&nbsp;<span class="op" id="8050470">!=</span>&nbsp;<span class="string" id="8050473">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="8050490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8050494">t</span><span class="op" id="8050495">.</span><span class="ident" id="8050496">Error</span><span class="op" id="8050501">(</span><span class="string" id="8050502">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8050543">,</span>&nbsp;<span class="ident" id="8050545">err</span><span class="op" id="8050548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8050551">}</span><br>
<span class="lineno"></span><span class="op" id="8050553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="8050556">func</span>&nbsp;<span class="ident" id="8050561">TestMalformedInput</span><span class="op" id="8050579">(</span><span class="ident" id="8050580">t</span>&nbsp;<span class="op" id="8050582">*</span><span class="ident" id="8050583">testing</span><span class="op" id="8050590">.</span><span class="ident" id="8050591">T</span><span class="op" id="8050592">)</span>&nbsp;<span class="op" id="8050594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8050597">cli</span><span class="op" id="8050600">,</span>&nbsp;<span class="ident" id="8050602">srv</span>&nbsp;<span class="op" id="8050606">:=</span>&nbsp;<span class="ident" id="8050609">net</span><span class="op" id="8050612">.</span><span class="ident" id="8050613">Pipe</span><span class="op" id="8050617">(</span><span class="op" id="8050618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8050621">go</span>&nbsp;<span class="ident" id="8050624">cli</span><span class="op" id="8050627">.</span><span class="ident" id="8050628">Write</span><span class="op" id="8050633">(</span><span class="op" id="8050634">[</span><span class="op" id="8050635">]</span><span class="builtintype" id="8050636">byte</span><span class="op" id="8050640">(</span><span class="string" id="8050641">`{id:1}`</span><span class="op" id="8050649">)</span><span class="op" id="8050650">)</span>&nbsp;<span class="comment" id="8050652">//&nbsp;invalid&nbsp;json</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8050669">ServeConn</span><span class="op" id="8050678">(</span><span class="ident" id="8050679">srv</span><span class="op" id="8050682">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8050700">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="8050725">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="8050728">func</span>&nbsp;<span class="ident" id="8050733">TestMalformedOutput</span><span class="op" id="8050752">(</span><span class="ident" id="8050753">t</span>&nbsp;<span class="op" id="8050755">*</span><span class="ident" id="8050756">testing</span><span class="op" id="8050763">.</span><span class="ident" id="8050764">T</span><span class="op" id="8050765">)</span>&nbsp;<span class="op" id="8050767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8050770">cli</span><span class="op" id="8050773">,</span>&nbsp;<span class="ident" id="8050775">srv</span>&nbsp;<span class="op" id="8050779">:=</span>&nbsp;<span class="ident" id="8050782">net</span><span class="op" id="8050785">.</span><span class="ident" id="8050786">Pipe</span><span class="op" id="8050790">(</span><span class="op" id="8050791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8050794">go</span>&nbsp;<span class="ident" id="8050797">srv</span><span class="op" id="8050800">.</span><span class="ident" id="8050801">Write</span><span class="op" id="8050806">(</span><span class="op" id="8050807">[</span><span class="op" id="8050808">]</span><span class="builtintype" id="8050809">byte</span><span class="op" id="8050813">(</span><span class="string" id="8050814">`{&#34;id&#34;:0,&#34;result&#34;:null,&#34;error&#34;:null}`</span><span class="op" id="8050851">)</span><span class="op" id="8050852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8050855">go</span>&nbsp;<span class="ident" id="8050858">ioutil</span><span class="op" id="8050864">.</span><span class="ident" id="8050865">ReadAll</span><span class="op" id="8050872">(</span><span class="ident" id="8050873">srv</span><span class="op" id="8050876">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8050880">client</span>&nbsp;<span class="op" id="8050887">:=</span>&nbsp;<span class="ident" id="8050890">NewClient</span><span class="op" id="8050899">(</span><span class="ident" id="8050900">cli</span><span class="op" id="8050903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8050906">defer</span>&nbsp;<span class="ident" id="8050912">client</span><span class="op" id="8050918">.</span><span class="ident" id="8050919">Close</span><span class="op" id="8050924">(</span><span class="op" id="8050925">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8050929">args</span>&nbsp;<span class="op" id="8050934">:=</span>&nbsp;<span class="op" id="8050937">&amp;</span><span class="ident" id="8050938">Args</span><span class="op" id="8050942">{</span><span class="num" id="8050943">7</span><span class="op" id="8050944">,</span>&nbsp;<span class="num" id="8050946">8</span><span class="op" id="8050947">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8050950">reply</span>&nbsp;<span class="op" id="8050956">:=</span>&nbsp;<span class="builtinfunc" id="8050959">new</span><span class="op" id="8050962">(</span><span class="ident" id="8050963">Reply</span><span class="op" id="8050968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8050971">err</span>&nbsp;<span class="op" id="8050975">:=</span>&nbsp;<span class="ident" id="8050978">client</span><span class="op" id="8050984">.</span><span class="ident" id="8050985">Call</span><span class="op" id="8050989">(</span><span class="string" id="8050990">&#34;Arith.Add&#34;</span><span class="op" id="8051001">,</span>&nbsp;<span class="ident" id="8051003">args</span><span class="op" id="8051007">,</span>&nbsp;<span class="ident" id="8051009">reply</span><span class="op" id="8051014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8051017">if</span>&nbsp;<span class="ident" id="8051020">err</span>&nbsp;<span class="op" id="8051024">==</span>&nbsp;<span class="ident" id="8051027">nil</span>&nbsp;<span class="op" id="8051031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051035">t</span><span class="op" id="8051036">.</span><span class="ident" id="8051037">Error</span><span class="op" id="8051042">(</span><span class="string" id="8051043">&#34;expected&nbsp;error&#34;</span><span class="op" id="8051059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8051062">}</span><br>
<span class="lineno">205</span><span class="op" id="8051064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8051067">func</span>&nbsp;<span class="ident" id="8051072">TestServerErrorHasNullResult</span><span class="op" id="8051100">(</span><span class="ident" id="8051101">t</span>&nbsp;<span class="op" id="8051103">*</span><span class="ident" id="8051104">testing</span><span class="op" id="8051111">.</span><span class="ident" id="8051112">T</span><span class="op" id="8051113">)</span>&nbsp;<span class="op" id="8051115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8051118">var</span>&nbsp;<span class="ident" id="8051122">out</span>&nbsp;<span class="ident" id="8051126">bytes</span><span class="op" id="8051131">.</span><span class="ident" id="8051132">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051140">sc</span>&nbsp;<span class="op" id="8051143">:=</span>&nbsp;<span class="ident" id="8051146">NewServerCodec</span><span class="op" id="8051160">(</span><span class="keyword" id="8051161">struct</span>&nbsp;<span class="op" id="8051168">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051172">io</span><span class="op" id="8051174">.</span><span class="ident" id="8051175">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051184">io</span><span class="op" id="8051186">.</span><span class="ident" id="8051187">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051196">io</span><span class="op" id="8051198">.</span><span class="ident" id="8051199">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8051207">}</span><span class="op" id="8051208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051212">Reader</span><span class="op" id="8051218">:</span>&nbsp;<span class="ident" id="8051220">strings</span><span class="op" id="8051227">.</span><span class="ident" id="8051228">NewReader</span><span class="op" id="8051237">(</span><span class="string" id="8051238">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;,&nbsp;&#34;params&#34;:&nbsp;[]}`</span><span class="op" id="8051290">)</span><span class="op" id="8051291">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051295">Writer</span><span class="op" id="8051301">:</span>&nbsp;<span class="op" id="8051303">&amp;</span><span class="ident" id="8051304">out</span><span class="op" id="8051307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051311">Closer</span><span class="op" id="8051317">:</span>&nbsp;<span class="ident" id="8051319">ioutil</span><span class="op" id="8051325">.</span><span class="ident" id="8051326">NopCloser</span><span class="op" id="8051335">(</span><span class="ident" id="8051336">nil</span><span class="op" id="8051339">)</span><span class="op" id="8051340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8051343">}</span><span class="op" id="8051344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051347">r</span>&nbsp;<span class="op" id="8051349">:=</span>&nbsp;<span class="builtinfunc" id="8051352">new</span><span class="op" id="8051355">(</span><span class="ident" id="8051356">rpc</span><span class="op" id="8051359">.</span><span class="ident" id="8051360">Request</span><span class="op" id="8051367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8051370">if</span>&nbsp;<span class="ident" id="8051373">err</span>&nbsp;<span class="op" id="8051377">:=</span>&nbsp;<span class="ident" id="8051380">sc</span><span class="op" id="8051382">.</span><span class="ident" id="8051383">ReadRequestHeader</span><span class="op" id="8051400">(</span><span class="ident" id="8051401">r</span><span class="op" id="8051402">)</span><span class="op" id="8051403">;</span>&nbsp;<span class="ident" id="8051405">err</span>&nbsp;<span class="op" id="8051409">!=</span>&nbsp;<span class="ident" id="8051412">nil</span>&nbsp;<span class="op" id="8051416">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051420">t</span><span class="op" id="8051421">.</span><span class="ident" id="8051422">Fatal</span><span class="op" id="8051427">(</span><span class="ident" id="8051428">err</span><span class="op" id="8051431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8051434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8051437">const</span>&nbsp;<span class="ident" id="8051443">valueText</span>&nbsp;<span class="op" id="8051453">=</span>&nbsp;<span class="string" id="8051455">&#34;the&nbsp;value&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;see&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8051489">const</span>&nbsp;<span class="ident" id="8051495">errorText</span>&nbsp;<span class="op" id="8051505">=</span>&nbsp;<span class="string" id="8051507">&#34;some&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051521">err</span>&nbsp;<span class="op" id="8051525">:=</span>&nbsp;<span class="ident" id="8051528">sc</span><span class="op" id="8051530">.</span><span class="ident" id="8051531">WriteResponse</span><span class="op" id="8051544">(</span><span class="op" id="8051545">&amp;</span><span class="ident" id="8051546">rpc</span><span class="op" id="8051549">.</span><span class="ident" id="8051550">Response</span><span class="op" id="8051558">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051562">ServiceMethod</span><span class="op" id="8051575">:</span>&nbsp;<span class="string" id="8051577">&#34;Method&#34;</span><span class="op" id="8051585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051589">Seq</span><span class="op" id="8051592">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8051604">1</span><span class="op" id="8051605">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051609">Error</span><span class="op" id="8051614">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8051624">errorText</span><span class="op" id="8051633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8051636">}</span><span class="op" id="8051637">,</span>&nbsp;<span class="ident" id="8051639">valueText</span><span class="op" id="8051648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8051651">if</span>&nbsp;<span class="ident" id="8051654">err</span>&nbsp;<span class="op" id="8051658">!=</span>&nbsp;<span class="ident" id="8051661">nil</span>&nbsp;<span class="op" id="8051665">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051669">t</span><span class="op" id="8051670">.</span><span class="ident" id="8051671">Fatal</span><span class="op" id="8051676">(</span><span class="ident" id="8051677">err</span><span class="op" id="8051680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8051683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8051686">if</span>&nbsp;<span class="op" id="8051689">!</span><span class="ident" id="8051690">strings</span><span class="op" id="8051697">.</span><span class="ident" id="8051698">Contains</span><span class="op" id="8051706">(</span><span class="ident" id="8051707">out</span><span class="op" id="8051710">.</span><span class="ident" id="8051711">String</span><span class="op" id="8051717">(</span><span class="op" id="8051718">)</span><span class="op" id="8051719">,</span>&nbsp;<span class="ident" id="8051721">errorText</span><span class="op" id="8051730">)</span>&nbsp;<span class="op" id="8051732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051736">t</span><span class="op" id="8051737">.</span><span class="ident" id="8051738">Fatalf</span><span class="op" id="8051744">(</span><span class="string" id="8051745">&#34;Response&nbsp;didn&#39;t&nbsp;contain&nbsp;expected&nbsp;error&nbsp;%q:&nbsp;%s&#34;</span><span class="op" id="8051792">,</span>&nbsp;<span class="ident" id="8051794">errorText</span><span class="op" id="8051803">,</span>&nbsp;<span class="op" id="8051805">&amp;</span><span class="ident" id="8051806">out</span><span class="op" id="8051809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8051812">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8051815">if</span>&nbsp;<span class="ident" id="8051818">strings</span><span class="op" id="8051825">.</span><span class="ident" id="8051826">Contains</span><span class="op" id="8051834">(</span><span class="ident" id="8051835">out</span><span class="op" id="8051838">.</span><span class="ident" id="8051839">String</span><span class="op" id="8051845">(</span><span class="op" id="8051846">)</span><span class="op" id="8051847">,</span>&nbsp;<span class="ident" id="8051849">valueText</span><span class="op" id="8051858">)</span>&nbsp;<span class="op" id="8051860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051864">t</span><span class="op" id="8051865">.</span><span class="ident" id="8051866">Errorf</span><span class="op" id="8051872">(</span><span class="string" id="8051873">&#34;Response&nbsp;contains&nbsp;both&nbsp;an&nbsp;error&nbsp;and&nbsp;value:&nbsp;%s&#34;</span><span class="op" id="8051920">,</span>&nbsp;<span class="op" id="8051922">&amp;</span><span class="ident" id="8051923">out</span><span class="op" id="8051926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8051929">}</span><br>
<span class="lineno"></span><span class="op" id="8051931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="8051934">func</span>&nbsp;<span class="ident" id="8051939">TestUnexpectedError</span><span class="op" id="8051958">(</span><span class="ident" id="8051959">t</span>&nbsp;<span class="op" id="8051961">*</span><span class="ident" id="8051962">testing</span><span class="op" id="8051969">.</span><span class="ident" id="8051970">T</span><span class="op" id="8051971">)</span>&nbsp;<span class="op" id="8051973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8051976">cli</span><span class="op" id="8051979">,</span>&nbsp;<span class="ident" id="8051981">srv</span>&nbsp;<span class="op" id="8051985">:=</span>&nbsp;<span class="ident" id="8051988">myPipe</span><span class="op" id="8051994">(</span><span class="op" id="8051995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8051998">go</span>&nbsp;<span class="ident" id="8052001">cli</span><span class="op" id="8052004">.</span><span class="ident" id="8052005">PipeWriter</span><span class="op" id="8052015">.</span><span class="ident" id="8052016">CloseWithError</span><span class="op" id="8052030">(</span><span class="ident" id="8052031">errors</span><span class="op" id="8052037">.</span><span class="ident" id="8052038">New</span><span class="op" id="8052041">(</span><span class="string" id="8052042">&#34;unexpected&nbsp;error!&#34;</span><span class="op" id="8052061">)</span><span class="op" id="8052062">)</span>&nbsp;<span class="comment" id="8052064">//&nbsp;reader&nbsp;will&nbsp;get&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8052095">ServeConn</span><span class="op" id="8052104">(</span><span class="ident" id="8052105">srv</span><span class="op" id="8052108">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8052161">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="8052186">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="8052189">//&nbsp;Copied&nbsp;from&nbsp;package&nbsp;net.</span><br>
<span class="lineno"></span><span class="keyword" id="8052217">func</span>&nbsp;<span class="ident" id="8052222">myPipe</span><span class="op" id="8052228">(</span><span class="op" id="8052229">)</span>&nbsp;<span class="op" id="8052231">(</span><span class="op" id="8052232">*</span><span class="ident" id="8052233">pipe</span><span class="op" id="8052237">,</span>&nbsp;<span class="op" id="8052239">*</span><span class="ident" id="8052240">pipe</span><span class="op" id="8052244">)</span>&nbsp;<span class="op" id="8052246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8052249">r1</span><span class="op" id="8052251">,</span>&nbsp;<span class="ident" id="8052253">w1</span>&nbsp;<span class="op" id="8052256">:=</span>&nbsp;<span class="ident" id="8052259">io</span><span class="op" id="8052261">.</span><span class="ident" id="8052262">Pipe</span><span class="op" id="8052266">(</span><span class="op" id="8052267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8052270">r2</span><span class="op" id="8052272">,</span>&nbsp;<span class="ident" id="8052274">w2</span>&nbsp;<span class="op" id="8052277">:=</span>&nbsp;<span class="ident" id="8052280">io</span><span class="op" id="8052282">.</span><span class="ident" id="8052283">Pipe</span><span class="op" id="8052287">(</span><span class="op" id="8052288">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8052292">return</span>&nbsp;<span class="op" id="8052299">&amp;</span><span class="ident" id="8052300">pipe</span><span class="op" id="8052304">{</span><span class="ident" id="8052305">r1</span><span class="op" id="8052307">,</span>&nbsp;<span class="ident" id="8052309">w2</span><span class="op" id="8052311">}</span><span class="op" id="8052312">,</span>&nbsp;<span class="op" id="8052314">&amp;</span><span class="ident" id="8052315">pipe</span><span class="op" id="8052319">{</span><span class="ident" id="8052320">r2</span><span class="op" id="8052322">,</span>&nbsp;<span class="ident" id="8052324">w1</span><span class="op" id="8052326">}</span><br>
<span class="lineno"></span><span class="op" id="8052328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8052331">type</span>&nbsp;<span class="ident" id="8052336">pipe</span>&nbsp;<span class="keyword" id="8052341">struct</span>&nbsp;<span class="op" id="8052348">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8052351">*</span><span class="ident" id="8052352">io</span><span class="op" id="8052354">.</span><span class="ident" id="8052355">PipeReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8052367">*</span><span class="ident" id="8052368">io</span><span class="op" id="8052370">.</span><span class="ident" id="8052371">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="8052382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8052385">type</span>&nbsp;<span class="ident" id="8052390">pipeAddr</span>&nbsp;<span class="builtintype" id="8052399">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="8052404">func</span>&nbsp;<span class="op" id="8052409">(</span><span class="ident" id="8052410">pipeAddr</span><span class="op" id="8052418">)</span>&nbsp;<span class="ident" id="8052420">Network</span><span class="op" id="8052427">(</span><span class="op" id="8052428">)</span>&nbsp;<span class="builtintype" id="8052430">string</span>&nbsp;<span class="op" id="8052437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8052440">return</span>&nbsp;<span class="string" id="8052447">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="8052454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="keyword" id="8052457">func</span>&nbsp;<span class="op" id="8052462">(</span><span class="ident" id="8052463">pipeAddr</span><span class="op" id="8052471">)</span>&nbsp;<span class="ident" id="8052473">String</span><span class="op" id="8052479">(</span><span class="op" id="8052480">)</span>&nbsp;<span class="builtintype" id="8052482">string</span>&nbsp;<span class="op" id="8052489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8052492">return</span>&nbsp;<span class="string" id="8052499">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="8052506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8052509">func</span>&nbsp;<span class="op" id="8052514">(</span><span class="ident" id="8052515">p</span>&nbsp;<span class="op" id="8052517">*</span><span class="ident" id="8052518">pipe</span><span class="op" id="8052522">)</span>&nbsp;<span class="ident" id="8052524">Close</span><span class="op" id="8052529">(</span><span class="op" id="8052530">)</span>&nbsp;<span class="builtintype" id="8052532">error</span>&nbsp;<span class="op" id="8052538">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8052541">err</span>&nbsp;<span class="op" id="8052545">:=</span>&nbsp;<span class="ident" id="8052548">p</span><span class="op" id="8052549">.</span><span class="ident" id="8052550">PipeReader</span><span class="op" id="8052560">.</span><span class="ident" id="8052561">Close</span><span class="op" id="8052566">(</span><span class="op" id="8052567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8052570">err1</span>&nbsp;<span class="op" id="8052575">:=</span>&nbsp;<span class="ident" id="8052578">p</span><span class="op" id="8052579">.</span><span class="ident" id="8052580">PipeWriter</span><span class="op" id="8052590">.</span><span class="ident" id="8052591">Close</span><span class="op" id="8052596">(</span><span class="op" id="8052597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8052600">if</span>&nbsp;<span class="ident" id="8052603">err</span>&nbsp;<span class="op" id="8052607">==</span>&nbsp;<span class="ident" id="8052610">nil</span>&nbsp;<span class="op" id="8052614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8052618">err</span>&nbsp;<span class="op" id="8052622">=</span>&nbsp;<span class="ident" id="8052624">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8052630">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8052633">return</span>&nbsp;<span class="ident" id="8052640">err</span><br>
<span class="lineno"></span><span class="op" id="8052644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8052647">func</span>&nbsp;<span class="op" id="8052652">(</span><span class="ident" id="8052653">p</span>&nbsp;<span class="op" id="8052655">*</span><span class="ident" id="8052656">pipe</span><span class="op" id="8052660">)</span>&nbsp;<span class="ident" id="8052662">LocalAddr</span><span class="op" id="8052671">(</span><span class="op" id="8052672">)</span>&nbsp;<span class="ident" id="8052674">net</span><span class="op" id="8052677">.</span><span class="ident" id="8052678">Addr</span>&nbsp;<span class="op" id="8052683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8052686">return</span>&nbsp;<span class="ident" id="8052693">pipeAddr</span><span class="op" id="8052701">(</span><span class="num" id="8052702">0</span><span class="op" id="8052703">)</span><br>
<span class="lineno">280</span><span class="op" id="8052705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8052708">func</span>&nbsp;<span class="op" id="8052713">(</span><span class="ident" id="8052714">p</span>&nbsp;<span class="op" id="8052716">*</span><span class="ident" id="8052717">pipe</span><span class="op" id="8052721">)</span>&nbsp;<span class="ident" id="8052723">RemoteAddr</span><span class="op" id="8052733">(</span><span class="op" id="8052734">)</span>&nbsp;<span class="ident" id="8052736">net</span><span class="op" id="8052739">.</span><span class="ident" id="8052740">Addr</span>&nbsp;<span class="op" id="8052745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8052748">return</span>&nbsp;<span class="ident" id="8052755">pipeAddr</span><span class="op" id="8052763">(</span><span class="num" id="8052764">0</span><span class="op" id="8052765">)</span><br>
<span class="lineno"></span><span class="op" id="8052767">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="8052770">func</span>&nbsp;<span class="op" id="8052775">(</span><span class="ident" id="8052776">p</span>&nbsp;<span class="op" id="8052778">*</span><span class="ident" id="8052779">pipe</span><span class="op" id="8052783">)</span>&nbsp;<span class="ident" id="8052785">SetTimeout</span><span class="op" id="8052795">(</span><span class="ident" id="8052796">nsec</span>&nbsp;<span class="ident" id="8052801">int64</span><span class="op" id="8052806">)</span>&nbsp;<span class="builtintype" id="8052808">error</span>&nbsp;<span class="op" id="8052814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8052817">return</span>&nbsp;<span class="ident" id="8052824">errors</span><span class="op" id="8052830">.</span><span class="ident" id="8052831">New</span><span class="op" id="8052834">(</span><span class="string" id="8052835">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="8052871">)</span><br>
<span class="lineno"></span><span class="op" id="8052873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="8052876">func</span>&nbsp;<span class="op" id="8052881">(</span><span class="ident" id="8052882">p</span>&nbsp;<span class="op" id="8052884">*</span><span class="ident" id="8052885">pipe</span><span class="op" id="8052889">)</span>&nbsp;<span class="ident" id="8052891">SetReadTimeout</span><span class="op" id="8052905">(</span><span class="ident" id="8052906">nsec</span>&nbsp;<span class="ident" id="8052911">int64</span><span class="op" id="8052916">)</span>&nbsp;<span class="builtintype" id="8052918">error</span>&nbsp;<span class="op" id="8052924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8052927">return</span>&nbsp;<span class="ident" id="8052934">errors</span><span class="op" id="8052940">.</span><span class="ident" id="8052941">New</span><span class="op" id="8052944">(</span><span class="string" id="8052945">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="8052981">)</span><br>
<span class="lineno"></span><span class="op" id="8052983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8052986">func</span>&nbsp;<span class="op" id="8052991">(</span><span class="ident" id="8052992">p</span>&nbsp;<span class="op" id="8052994">*</span><span class="ident" id="8052995">pipe</span><span class="op" id="8052999">)</span>&nbsp;<span class="ident" id="8053001">SetWriteTimeout</span><span class="op" id="8053016">(</span><span class="ident" id="8053017">nsec</span>&nbsp;<span class="ident" id="8053022">int64</span><span class="op" id="8053027">)</span>&nbsp;<span class="builtintype" id="8053029">error</span>&nbsp;<span class="op" id="8053035">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8053038">return</span>&nbsp;<span class="ident" id="8053045">errors</span><span class="op" id="8053051">.</span><span class="ident" id="8053052">New</span><span class="op" id="8053055">(</span><span class="string" id="8053056">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="8053092">)</span><br>
<span class="lineno"></span><span class="op" id="8053094">}</span>
</div>
</body>
</html>
