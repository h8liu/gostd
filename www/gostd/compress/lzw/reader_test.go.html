<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/lzw</h2>
<ul>
<li><a href="/gostd/compress/lzw/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/lzw/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/lzw/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/lzw/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6883226">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6883281">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6883335">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6883386">package</span>&nbsp;<span class="ident" id="6883394">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6883399">import</span>&nbsp;<span class="op" id="6883406">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883409">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883418">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883424">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883437">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883448">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883459">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883470">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6883480">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6883483">type</span>&nbsp;<span class="ident" id="6883488">lzwTest</span>&nbsp;<span class="keyword" id="6883496">struct</span>&nbsp;<span class="op" id="6883503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883506">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6883517">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883525">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6883536">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883544">compressed</span>&nbsp;<span class="builtintype" id="6883555">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883563">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6883574">error</span><br>
<span class="lineno"></span><span class="op" id="6883580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6883583">var</span>&nbsp;<span class="ident" id="6883587">lzwTests</span>&nbsp;<span class="op" id="6883596">=</span>&nbsp;<span class="op" id="6883598">[</span><span class="op" id="6883599">]</span><span class="ident" id="6883600">lzwTest</span><span class="op" id="6883607">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883614">&#34;empty;LSB;8&#34;</span><span class="op" id="6883627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883631">&#34;&#34;</span><span class="op" id="6883633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883637">&#34;\x01\x01&#34;</span><span class="op" id="6883647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883651">nil</span><span class="op" id="6883654">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883657">}</span><span class="op" id="6883658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883665">&#34;empty;MSB;8&#34;</span><span class="op" id="6883678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883682">&#34;&#34;</span><span class="op" id="6883684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883688">&#34;\x80\x80&#34;</span><span class="op" id="6883698">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883702">nil</span><span class="op" id="6883705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883708">}</span><span class="op" id="6883709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883716">&#34;tobe;LSB;7&#34;</span><span class="op" id="6883728">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883732">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="6883758">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883762">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="6883832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883836">nil</span><span class="op" id="6883839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883842">}</span><span class="op" id="6883843">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883850">&#34;tobe;LSB;8&#34;</span><span class="op" id="6883862">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883866">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="6883892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883896">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04\x12\x34\xb8\xb0\xe0\xc1\x84\x01\x01&#34;</span><span class="op" id="6883978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6883982">nil</span><span class="op" id="6883985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883988">}</span><span class="op" id="6883989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6883992">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6883996">&#34;tobe;MSB;7&#34;</span><span class="op" id="6884008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6884012">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="6884038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6884042">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="6884112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884116">nil</span><span class="op" id="6884119">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6884122">}</span><span class="op" id="6884123">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6884126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6884130">&#34;tobe;MSB;8&#34;</span><span class="op" id="6884142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6884146">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="6884172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6884176">&#34;\x2a\x13\xc8\x44\x52\x79\x48\x9c\x4f\x2a\x40\xa0\x90\x68\x5c\x16\x0f\x09\x80\x80&#34;</span><span class="op" id="6884258">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884262">nil</span><span class="op" id="6884265">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6884268">}</span><span class="op" id="6884269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6884272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6884276">&#34;tobe-truncated;LSB;8&#34;</span><span class="op" id="6884298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6884302">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="6884328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6884332">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04&#34;</span><span class="op" id="6884378">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884382">io</span><span class="op" id="6884384">.</span><span class="ident" id="6884385">ErrUnexpectedEOF</span><span class="op" id="6884401">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6884404">}</span><span class="op" id="6884405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6884408">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://en.wikipedia.org/wiki/Graphics_Interchange_Format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6884494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6884498">&#34;gif;LSB;8&#34;</span><span class="op" id="6884509">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6884513">&#34;\x28\xff\xff\xff\x28\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff&#34;</span><span class="op" id="6884575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6884579">&#34;\x00\x51\xfc\x1b\x28\x70\xa0\xc1\x83\x01\x01&#34;</span><span class="op" id="6884625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884629">nil</span><span class="op" id="6884632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6884635">}</span><span class="op" id="6884636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6884639">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://compgroups.net/comp.lang.ruby/Decompressing-LZW-compression-from-PDF-file</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6884748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6884752">&#34;pdf;MSB;8&#34;</span><span class="op" id="6884763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6884767">&#34;-----A---B&#34;</span><span class="op" id="6884779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6884783">&#34;\x80\x0b\x60\x50\x22\x0c\x0c\x85\x01&#34;</span><span class="op" id="6884821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884825">nil</span><span class="op" id="6884828">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6884831">}</span><span class="op" id="6884832">,</span><br>
<span class="lineno"></span><span class="op" id="6884834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6884837">func</span>&nbsp;<span class="ident" id="6884842">TestReader</span><span class="op" id="6884852">(</span><span class="ident" id="6884853">t</span>&nbsp;<span class="op" id="6884855">*</span><span class="ident" id="6884856">testing</span><span class="op" id="6884863">.</span><span class="ident" id="6884864">T</span><span class="op" id="6884865">)</span>&nbsp;<span class="op" id="6884867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6884870">var</span>&nbsp;<span class="ident" id="6884874">b</span>&nbsp;<span class="ident" id="6884876">bytes</span><span class="op" id="6884881">.</span><span class="ident" id="6884882">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6884890">for</span>&nbsp;<span class="ident" id="6884894">_</span><span class="op" id="6884895">,</span>&nbsp;<span class="ident" id="6884897">tt</span>&nbsp;<span class="op" id="6884900">:=</span>&nbsp;<span class="keyword" id="6884903">range</span>&nbsp;<span class="ident" id="6884909">lzwTests</span>&nbsp;<span class="op" id="6884918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6884922">d</span>&nbsp;<span class="op" id="6884924">:=</span>&nbsp;<span class="ident" id="6884927">strings</span><span class="op" id="6884934">.</span><span class="ident" id="6884935">Split</span><span class="op" id="6884940">(</span><span class="ident" id="6884941">tt</span><span class="op" id="6884943">.</span><span class="ident" id="6884944">desc</span><span class="op" id="6884948">,</span>&nbsp;<span class="string" id="6884950">&#34;;&#34;</span><span class="op" id="6884953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6884957">var</span>&nbsp;<span class="ident" id="6884961">order</span>&nbsp;<span class="ident" id="6884967">Order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6884975">switch</span>&nbsp;<span class="ident" id="6884982">d</span><span class="op" id="6884983">[</span><span class="num" id="6884984">1</span><span class="op" id="6884985">]</span>&nbsp;<span class="op" id="6884987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6884991">case</span>&nbsp;<span class="string" id="6884996">&#34;LSB&#34;</span><span class="op" id="6885001">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885006">order</span>&nbsp;<span class="op" id="6885012">=</span>&nbsp;<span class="ident" id="6885014">LSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885020">case</span>&nbsp;<span class="string" id="6885025">&#34;MSB&#34;</span><span class="op" id="6885030">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885035">order</span>&nbsp;<span class="op" id="6885041">=</span>&nbsp;<span class="ident" id="6885043">MSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885049">default</span><span class="op" id="6885056">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885061">t</span><span class="op" id="6885062">.</span><span class="ident" id="6885063">Errorf</span><span class="op" id="6885069">(</span><span class="string" id="6885070">&#34;%s:&nbsp;bad&nbsp;order&nbsp;%q&#34;</span><span class="op" id="6885088">,</span>&nbsp;<span class="ident" id="6885090">tt</span><span class="op" id="6885092">.</span><span class="ident" id="6885093">desc</span><span class="op" id="6885097">,</span>&nbsp;<span class="ident" id="6885099">d</span><span class="op" id="6885100">[</span><span class="num" id="6885101">1</span><span class="op" id="6885102">]</span><span class="op" id="6885103">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885111">litWidth</span><span class="op" id="6885119">,</span>&nbsp;<span class="ident" id="6885121">_</span>&nbsp;<span class="op" id="6885123">:=</span>&nbsp;<span class="ident" id="6885126">strconv</span><span class="op" id="6885133">.</span><span class="ident" id="6885134">Atoi</span><span class="op" id="6885138">(</span><span class="ident" id="6885139">d</span><span class="op" id="6885140">[</span><span class="num" id="6885141">2</span><span class="op" id="6885142">]</span><span class="op" id="6885143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885147">rc</span>&nbsp;<span class="op" id="6885150">:=</span>&nbsp;<span class="ident" id="6885153">NewReader</span><span class="op" id="6885162">(</span><span class="ident" id="6885163">strings</span><span class="op" id="6885170">.</span><span class="ident" id="6885171">NewReader</span><span class="op" id="6885180">(</span><span class="ident" id="6885181">tt</span><span class="op" id="6885183">.</span><span class="ident" id="6885184">compressed</span><span class="op" id="6885194">)</span><span class="op" id="6885195">,</span>&nbsp;<span class="ident" id="6885197">order</span><span class="op" id="6885202">,</span>&nbsp;<span class="ident" id="6885204">litWidth</span><span class="op" id="6885212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885216">defer</span>&nbsp;<span class="ident" id="6885222">rc</span><span class="op" id="6885224">.</span><span class="ident" id="6885225">Close</span><span class="op" id="6885230">(</span><span class="op" id="6885231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885235">b</span><span class="op" id="6885236">.</span><span class="ident" id="6885237">Reset</span><span class="op" id="6885242">(</span><span class="op" id="6885243">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885247">n</span><span class="op" id="6885248">,</span>&nbsp;<span class="ident" id="6885250">err</span>&nbsp;<span class="op" id="6885254">:=</span>&nbsp;<span class="ident" id="6885257">io</span><span class="op" id="6885259">.</span><span class="ident" id="6885260">Copy</span><span class="op" id="6885264">(</span><span class="op" id="6885265">&amp;</span><span class="ident" id="6885266">b</span><span class="op" id="6885267">,</span>&nbsp;<span class="ident" id="6885269">rc</span><span class="op" id="6885271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885275">if</span>&nbsp;<span class="ident" id="6885278">err</span>&nbsp;<span class="op" id="6885282">!=</span>&nbsp;<span class="ident" id="6885285">nil</span>&nbsp;<span class="op" id="6885289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885294">if</span>&nbsp;<span class="ident" id="6885297">err</span>&nbsp;<span class="op" id="6885301">!=</span>&nbsp;<span class="ident" id="6885304">tt</span><span class="op" id="6885306">.</span><span class="ident" id="6885307">err</span>&nbsp;<span class="op" id="6885311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885317">t</span><span class="op" id="6885318">.</span><span class="ident" id="6885319">Errorf</span><span class="op" id="6885325">(</span><span class="string" id="6885326">&#34;%s:&nbsp;io.Copy:&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6885351">,</span>&nbsp;<span class="ident" id="6885353">tt</span><span class="op" id="6885355">.</span><span class="ident" id="6885356">desc</span><span class="op" id="6885360">,</span>&nbsp;<span class="ident" id="6885362">err</span><span class="op" id="6885365">,</span>&nbsp;<span class="ident" id="6885367">tt</span><span class="op" id="6885369">.</span><span class="ident" id="6885370">err</span><span class="op" id="6885373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885378">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885383">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885398">s</span>&nbsp;<span class="op" id="6885400">:=</span>&nbsp;<span class="ident" id="6885403">b</span><span class="op" id="6885404">.</span><span class="ident" id="6885405">String</span><span class="op" id="6885411">(</span><span class="op" id="6885412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885416">if</span>&nbsp;<span class="ident" id="6885419">s</span>&nbsp;<span class="op" id="6885421">!=</span>&nbsp;<span class="ident" id="6885424">tt</span><span class="op" id="6885426">.</span><span class="ident" id="6885427">raw</span>&nbsp;<span class="op" id="6885431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885436">t</span><span class="op" id="6885437">.</span><span class="ident" id="6885438">Errorf</span><span class="op" id="6885444">(</span><span class="string" id="6885445">&#34;%s:&nbsp;got&nbsp;%d-byte&nbsp;%q&nbsp;want&nbsp;%d-byte&nbsp;%q&#34;</span><span class="op" id="6885481">,</span>&nbsp;<span class="ident" id="6885483">tt</span><span class="op" id="6885485">.</span><span class="ident" id="6885486">desc</span><span class="op" id="6885490">,</span>&nbsp;<span class="ident" id="6885492">n</span><span class="op" id="6885493">,</span>&nbsp;<span class="ident" id="6885495">s</span><span class="op" id="6885496">,</span>&nbsp;<span class="builtinfunc" id="6885498">len</span><span class="op" id="6885501">(</span><span class="ident" id="6885502">tt</span><span class="op" id="6885504">.</span><span class="ident" id="6885505">raw</span><span class="op" id="6885508">)</span><span class="op" id="6885509">,</span>&nbsp;<span class="ident" id="6885511">tt</span><span class="op" id="6885513">.</span><span class="ident" id="6885514">raw</span><span class="op" id="6885517">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885524">}</span><br>
<span class="lineno"></span><span class="op" id="6885526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6885529">func</span>&nbsp;<span class="ident" id="6885534">benchmarkDecoder</span><span class="op" id="6885550">(</span><span class="ident" id="6885551">b</span>&nbsp;<span class="op" id="6885553">*</span><span class="ident" id="6885554">testing</span><span class="op" id="6885561">.</span><span class="ident" id="6885562">B</span><span class="op" id="6885563">,</span>&nbsp;<span class="ident" id="6885565">n</span>&nbsp;<span class="builtintype" id="6885567">int</span><span class="op" id="6885570">)</span>&nbsp;<span class="op" id="6885572">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885575">b</span><span class="op" id="6885576">.</span><span class="ident" id="6885577">StopTimer</span><span class="op" id="6885586">(</span><span class="op" id="6885587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885590">b</span><span class="op" id="6885591">.</span><span class="ident" id="6885592">SetBytes</span><span class="op" id="6885600">(</span><span class="ident" id="6885601">int64</span><span class="op" id="6885606">(</span><span class="ident" id="6885607">n</span><span class="op" id="6885608">)</span><span class="op" id="6885609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885612">buf0</span><span class="op" id="6885616">,</span>&nbsp;<span class="ident" id="6885618">err</span>&nbsp;<span class="op" id="6885622">:=</span>&nbsp;<span class="ident" id="6885625">ioutil</span><span class="op" id="6885631">.</span><span class="ident" id="6885632">ReadFile</span><span class="op" id="6885640">(</span><span class="string" id="6885641">&#34;../testdata/e.txt&#34;</span><span class="op" id="6885660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885663">if</span>&nbsp;<span class="ident" id="6885666">err</span>&nbsp;<span class="op" id="6885670">!=</span>&nbsp;<span class="ident" id="6885673">nil</span>&nbsp;<span class="op" id="6885677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885681">b</span><span class="op" id="6885682">.</span><span class="ident" id="6885683">Fatal</span><span class="op" id="6885688">(</span><span class="ident" id="6885689">err</span><span class="op" id="6885692">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885698">if</span>&nbsp;<span class="builtinfunc" id="6885701">len</span><span class="op" id="6885704">(</span><span class="ident" id="6885705">buf0</span><span class="op" id="6885709">)</span>&nbsp;<span class="op" id="6885711">==</span>&nbsp;<span class="num" id="6885714">0</span>&nbsp;<span class="op" id="6885716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885720">b</span><span class="op" id="6885721">.</span><span class="ident" id="6885722">Fatalf</span><span class="op" id="6885728">(</span><span class="string" id="6885729">&#34;test&nbsp;file&nbsp;has&nbsp;no&nbsp;data&#34;</span><span class="op" id="6885752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885758">compressed</span>&nbsp;<span class="op" id="6885769">:=</span>&nbsp;<span class="builtinfunc" id="6885772">new</span><span class="op" id="6885775">(</span><span class="ident" id="6885776">bytes</span><span class="op" id="6885781">.</span><span class="ident" id="6885782">Buffer</span><span class="op" id="6885788">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885791">w</span>&nbsp;<span class="op" id="6885793">:=</span>&nbsp;<span class="ident" id="6885796">NewWriter</span><span class="op" id="6885805">(</span><span class="ident" id="6885806">compressed</span><span class="op" id="6885816">,</span>&nbsp;<span class="ident" id="6885818">LSB</span><span class="op" id="6885821">,</span>&nbsp;<span class="num" id="6885823">8</span><span class="op" id="6885824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885827">for</span>&nbsp;<span class="ident" id="6885831">i</span>&nbsp;<span class="op" id="6885833">:=</span>&nbsp;<span class="num" id="6885836">0</span><span class="op" id="6885837">;</span>&nbsp;<span class="ident" id="6885839">i</span>&nbsp;<span class="op" id="6885841">&lt;</span>&nbsp;<span class="ident" id="6885843">n</span><span class="op" id="6885844">;</span>&nbsp;<span class="ident" id="6885846">i</span>&nbsp;<span class="op" id="6885848">+=</span>&nbsp;<span class="builtinfunc" id="6885851">len</span><span class="op" id="6885854">(</span><span class="ident" id="6885855">buf0</span><span class="op" id="6885859">)</span>&nbsp;<span class="op" id="6885861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6885865">if</span>&nbsp;<span class="builtinfunc" id="6885868">len</span><span class="op" id="6885871">(</span><span class="ident" id="6885872">buf0</span><span class="op" id="6885876">)</span>&nbsp;<span class="op" id="6885878">&gt;</span>&nbsp;<span class="ident" id="6885880">n</span><span class="op" id="6885881">-</span><span class="ident" id="6885882">i</span>&nbsp;<span class="op" id="6885884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885889">buf0</span>&nbsp;<span class="op" id="6885894">=</span>&nbsp;<span class="ident" id="6885896">buf0</span><span class="op" id="6885900">[</span><span class="op" id="6885901">:</span><span class="ident" id="6885902">n</span><span class="op" id="6885903">-</span><span class="ident" id="6885904">i</span><span class="op" id="6885905">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885909">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885913">w</span><span class="op" id="6885914">.</span><span class="ident" id="6885915">Write</span><span class="op" id="6885920">(</span><span class="ident" id="6885921">buf0</span><span class="op" id="6885925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6885928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885931">w</span><span class="op" id="6885932">.</span><span class="ident" id="6885933">Close</span><span class="op" id="6885938">(</span><span class="op" id="6885939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885942">buf1</span>&nbsp;<span class="op" id="6885947">:=</span>&nbsp;<span class="ident" id="6885950">compressed</span><span class="op" id="6885960">.</span><span class="ident" id="6885961">Bytes</span><span class="op" id="6885966">(</span><span class="op" id="6885967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6885970">buf0</span><span class="op" id="6885974">,</span>&nbsp;<span class="ident" id="6885976">compressed</span><span class="op" id="6885986">,</span>&nbsp;<span class="ident" id="6885988">w</span>&nbsp;<span class="op" id="6885990">=</span>&nbsp;<span class="ident" id="6885992">nil</span><span class="op" id="6885995">,</span>&nbsp;<span class="ident" id="6885997">nil</span><span class="op" id="6886000">,</span>&nbsp;<span class="ident" id="6886002">nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6886007">runtime</span><span class="op" id="6886014">.</span><span class="ident" id="6886015">GC</span><span class="op" id="6886017">(</span><span class="op" id="6886018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6886021">b</span><span class="op" id="6886022">.</span><span class="ident" id="6886023">StartTimer</span><span class="op" id="6886033">(</span><span class="op" id="6886034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6886037">for</span>&nbsp;<span class="ident" id="6886041">i</span>&nbsp;<span class="op" id="6886043">:=</span>&nbsp;<span class="num" id="6886046">0</span><span class="op" id="6886047">;</span>&nbsp;<span class="ident" id="6886049">i</span>&nbsp;<span class="op" id="6886051">&lt;</span>&nbsp;<span class="ident" id="6886053">b</span><span class="op" id="6886054">.</span><span class="ident" id="6886055">N</span><span class="op" id="6886056">;</span>&nbsp;<span class="ident" id="6886058">i</span><span class="op" id="6886059">++</span>&nbsp;<span class="op" id="6886062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6886066">io</span><span class="op" id="6886068">.</span><span class="ident" id="6886069">Copy</span><span class="op" id="6886073">(</span><span class="ident" id="6886074">ioutil</span><span class="op" id="6886080">.</span><span class="ident" id="6886081">Discard</span><span class="op" id="6886088">,</span>&nbsp;<span class="ident" id="6886090">NewReader</span><span class="op" id="6886099">(</span><span class="ident" id="6886100">bytes</span><span class="op" id="6886105">.</span><span class="ident" id="6886106">NewReader</span><span class="op" id="6886115">(</span><span class="ident" id="6886116">buf1</span><span class="op" id="6886120">)</span><span class="op" id="6886121">,</span>&nbsp;<span class="ident" id="6886123">LSB</span><span class="op" id="6886126">,</span>&nbsp;<span class="num" id="6886128">8</span><span class="op" id="6886129">)</span><span class="op" id="6886130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6886133">}</span><br>
<span class="lineno">140</span><span class="op" id="6886135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6886138">func</span>&nbsp;<span class="ident" id="6886143">BenchmarkDecoder1e4</span><span class="op" id="6886162">(</span><span class="ident" id="6886163">b</span>&nbsp;<span class="op" id="6886165">*</span><span class="ident" id="6886166">testing</span><span class="op" id="6886173">.</span><span class="ident" id="6886174">B</span><span class="op" id="6886175">)</span>&nbsp;<span class="op" id="6886177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6886180">benchmarkDecoder</span><span class="op" id="6886196">(</span><span class="ident" id="6886197">b</span><span class="op" id="6886198">,</span>&nbsp;<span class="num" id="6886200">1e4</span><span class="op" id="6886203">)</span><br>
<span class="lineno"></span><span class="op" id="6886205">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="6886208">func</span>&nbsp;<span class="ident" id="6886213">BenchmarkDecoder1e5</span><span class="op" id="6886232">(</span><span class="ident" id="6886233">b</span>&nbsp;<span class="op" id="6886235">*</span><span class="ident" id="6886236">testing</span><span class="op" id="6886243">.</span><span class="ident" id="6886244">B</span><span class="op" id="6886245">)</span>&nbsp;<span class="op" id="6886247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6886250">benchmarkDecoder</span><span class="op" id="6886266">(</span><span class="ident" id="6886267">b</span><span class="op" id="6886268">,</span>&nbsp;<span class="num" id="6886270">1e5</span><span class="op" id="6886273">)</span><br>
<span class="lineno"></span><span class="op" id="6886275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="6886278">func</span>&nbsp;<span class="ident" id="6886283">BenchmarkDecoder1e6</span><span class="op" id="6886302">(</span><span class="ident" id="6886303">b</span>&nbsp;<span class="op" id="6886305">*</span><span class="ident" id="6886306">testing</span><span class="op" id="6886313">.</span><span class="ident" id="6886314">B</span><span class="op" id="6886315">)</span>&nbsp;<span class="op" id="6886317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6886320">benchmarkDecoder</span><span class="op" id="6886336">(</span><span class="ident" id="6886337">b</span><span class="op" id="6886338">,</span>&nbsp;<span class="num" id="6886340">1e6</span><span class="op" id="6886343">)</span><br>
<span class="lineno"></span><span class="op" id="6886345">}</span>
</div>
</body>
</html>
