<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html" class="current">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3125944">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3126000">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3126054">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3126105">package</span>&nbsp;<span class="ident" id="3126113">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3126121">import</span>&nbsp;<span class="op" id="3126128">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3126131">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3126139">&#34;strings&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3126150">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3126161">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3126176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3126179">//&nbsp;An&nbsp;Error&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">15</span><span class="comment" id="3126241">//&nbsp;and&nbsp;gives&nbsp;the&nbsp;offending&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="3126280">type</span>&nbsp;<span class="ident" id="3126285">Error</span>&nbsp;<span class="keyword" id="3126291">struct</span>&nbsp;<span class="op" id="3126298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126301">Code</span>&nbsp;<span class="ident" id="3126306">ErrorCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126317">Expr</span>&nbsp;<span class="builtintype" id="3126322">string</span><br>
<span class="lineno"></span><span class="op" id="3126329">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3126332">func</span>&nbsp;<span class="op" id="3126337">(</span><span class="ident" id="3126338">e</span>&nbsp;<span class="op" id="3126340">*</span><span class="ident" id="3126341">Error</span><span class="op" id="3126346">)</span>&nbsp;<span class="ident" id="3126348">Error</span><span class="op" id="3126353">(</span><span class="op" id="3126354">)</span>&nbsp;<span class="builtintype" id="3126356">string</span>&nbsp;<span class="op" id="3126363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126366">return</span>&nbsp;<span class="string" id="3126373">&#34;error&nbsp;parsing&nbsp;regexp:&nbsp;&#34;</span>&nbsp;<span class="op" id="3126398">+</span>&nbsp;<span class="ident" id="3126400">e</span><span class="op" id="3126401">.</span><span class="ident" id="3126402">Code</span><span class="op" id="3126406">.</span><span class="ident" id="3126407">String</span><span class="op" id="3126413">(</span><span class="op" id="3126414">)</span>&nbsp;<span class="op" id="3126416">+</span>&nbsp;<span class="string" id="3126418">&#34;:&nbsp;`&#34;</span>&nbsp;<span class="op" id="3126424">+</span>&nbsp;<span class="ident" id="3126426">e</span><span class="op" id="3126427">.</span><span class="ident" id="3126428">Expr</span>&nbsp;<span class="op" id="3126433">+</span>&nbsp;<span class="string" id="3126435">&#34;`&#34;</span><br>
<span class="lineno"></span><span class="op" id="3126439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3126442">//&nbsp;An&nbsp;ErrorCode&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="3126509">type</span>&nbsp;<span class="ident" id="3126514">ErrorCode</span>&nbsp;<span class="builtintype" id="3126524">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3126532">const</span>&nbsp;<span class="op" id="3126538">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3126541">//&nbsp;Unexpected&nbsp;error</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126562">ErrInternalError</span>&nbsp;<span class="ident" id="3126579">ErrorCode</span>&nbsp;<span class="op" id="3126589">=</span>&nbsp;<span class="string" id="3126591">&#34;regexp/syntax:&nbsp;internal&nbsp;error&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3126625">//&nbsp;Parse&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126642">ErrInvalidCharClass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3126667">ErrorCode</span>&nbsp;<span class="op" id="3126677">=</span>&nbsp;<span class="string" id="3126679">&#34;invalid&nbsp;character&nbsp;class&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126706">ErrInvalidCharRange</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3126731">ErrorCode</span>&nbsp;<span class="op" id="3126741">=</span>&nbsp;<span class="string" id="3126743">&#34;invalid&nbsp;character&nbsp;class&nbsp;range&#34;</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126776">ErrInvalidEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3126801">ErrorCode</span>&nbsp;<span class="op" id="3126811">=</span>&nbsp;<span class="string" id="3126813">&#34;invalid&nbsp;escape&nbsp;sequence&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126840">ErrInvalidNamedCapture</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3126865">ErrorCode</span>&nbsp;<span class="op" id="3126875">=</span>&nbsp;<span class="string" id="3126877">&#34;invalid&nbsp;named&nbsp;capture&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126902">ErrInvalidPerlOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3126927">ErrorCode</span>&nbsp;<span class="op" id="3126937">=</span>&nbsp;<span class="string" id="3126939">&#34;invalid&nbsp;or&nbsp;unsupported&nbsp;Perl&nbsp;syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126977">ErrInvalidRepeatOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3127002">ErrorCode</span>&nbsp;<span class="op" id="3127012">=</span>&nbsp;<span class="string" id="3127014">&#34;invalid&nbsp;nested&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127052">ErrInvalidRepeatSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3127077">ErrorCode</span>&nbsp;<span class="op" id="3127087">=</span>&nbsp;<span class="string" id="3127089">&#34;invalid&nbsp;repeat&nbsp;count&#34;</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127113">ErrInvalidUTF8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3127138">ErrorCode</span>&nbsp;<span class="op" id="3127148">=</span>&nbsp;<span class="string" id="3127150">&#34;invalid&nbsp;UTF-8&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127167">ErrMissingBracket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3127192">ErrorCode</span>&nbsp;<span class="op" id="3127202">=</span>&nbsp;<span class="string" id="3127204">&#34;missing&nbsp;closing&nbsp;]&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127225">ErrMissingParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3127250">ErrorCode</span>&nbsp;<span class="op" id="3127260">=</span>&nbsp;<span class="string" id="3127262">&#34;missing&nbsp;closing&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127283">ErrMissingRepeatArgument</span>&nbsp;<span class="ident" id="3127308">ErrorCode</span>&nbsp;<span class="op" id="3127318">=</span>&nbsp;<span class="string" id="3127320">&#34;missing&nbsp;argument&nbsp;to&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127363">ErrTrailingBackslash</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3127388">ErrorCode</span>&nbsp;<span class="op" id="3127398">=</span>&nbsp;<span class="string" id="3127400">&#34;trailing&nbsp;backslash&nbsp;at&nbsp;end&nbsp;of&nbsp;expression&#34;</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127443">ErrUnexpectedParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3127468">ErrorCode</span>&nbsp;<span class="op" id="3127478">=</span>&nbsp;<span class="string" id="3127480">&#34;unexpected&nbsp;)&#34;</span><br>
<span class="lineno"></span><span class="op" id="3127495">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3127498">func</span>&nbsp;<span class="op" id="3127503">(</span><span class="ident" id="3127504">e</span>&nbsp;<span class="ident" id="3127506">ErrorCode</span><span class="op" id="3127515">)</span>&nbsp;<span class="ident" id="3127517">String</span><span class="op" id="3127523">(</span><span class="op" id="3127524">)</span>&nbsp;<span class="builtintype" id="3127526">string</span>&nbsp;<span class="op" id="3127533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3127536">return</span>&nbsp;<span class="builtintype" id="3127543">string</span><span class="op" id="3127549">(</span><span class="ident" id="3127550">e</span><span class="op" id="3127551">)</span><br>
<span class="lineno">50</span><span class="op" id="3127553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3127556">//&nbsp;Flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;the&nbsp;parser&nbsp;and&nbsp;record&nbsp;information&nbsp;about&nbsp;regexp&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="3127645">type</span>&nbsp;<span class="ident" id="3127650">Flags</span>&nbsp;<span class="builtintype" id="3127656">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3127664">const</span>&nbsp;<span class="op" id="3127670">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127673">FoldCase</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3127687">Flags</span>&nbsp;<span class="op" id="3127693">=</span>&nbsp;<span class="num" id="3127695">1</span>&nbsp;<span class="op" id="3127697">&lt;&lt;</span>&nbsp;<span class="ident" id="3127700">iota</span>&nbsp;<span class="comment" id="3127705">//&nbsp;case-insensitive&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127732">Literal</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3127764">//&nbsp;treat&nbsp;pattern&nbsp;as&nbsp;literal&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127800">ClassNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3127832">//&nbsp;allow&nbsp;character&nbsp;classes&nbsp;like&nbsp;[^a-z]&nbsp;and&nbsp;[[:space:]]&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127905">DotNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3127937">//&nbsp;allow&nbsp;.&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127966">OneLine</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3127998">//&nbsp;treat&nbsp;^&nbsp;and&nbsp;$&nbsp;as&nbsp;only&nbsp;matching&nbsp;at&nbsp;beginning&nbsp;and&nbsp;end&nbsp;of&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128062">NonGreedy</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3128094">//&nbsp;make&nbsp;repetition&nbsp;operators&nbsp;default&nbsp;to&nbsp;non-greedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128146">PerlX</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3128178">//&nbsp;allow&nbsp;Perl&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128204">UnicodeGroups</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3128236">//&nbsp;allow&nbsp;\p{Han},&nbsp;\P{Han}&nbsp;for&nbsp;Unicode&nbsp;group&nbsp;and&nbsp;negation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128294">WasDollar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3128326">//&nbsp;regexp&nbsp;OpEndText&nbsp;was&nbsp;$,&nbsp;not&nbsp;\z</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128361">Simple</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3128393">//&nbsp;regexp&nbsp;contains&nbsp;no&nbsp;counted&nbsp;repetition</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128436">MatchNL</span>&nbsp;<span class="op" id="3128444">=</span>&nbsp;<span class="ident" id="3128446">ClassNL</span>&nbsp;<span class="op" id="3128454">|</span>&nbsp;<span class="ident" id="3128456">DotNL</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128464">Perl</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3128476">=</span>&nbsp;<span class="ident" id="3128478">ClassNL</span>&nbsp;<span class="op" id="3128486">|</span>&nbsp;<span class="ident" id="3128488">OneLine</span>&nbsp;<span class="op" id="3128496">|</span>&nbsp;<span class="ident" id="3128498">PerlX</span>&nbsp;<span class="op" id="3128504">|</span>&nbsp;<span class="ident" id="3128506">UnicodeGroups</span>&nbsp;<span class="comment" id="3128520">//&nbsp;as&nbsp;close&nbsp;to&nbsp;Perl&nbsp;as&nbsp;possible</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128553">POSIX</span>&nbsp;<span class="ident" id="3128559">Flags</span>&nbsp;<span class="op" id="3128565">=</span>&nbsp;<span class="num" id="3128567">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3128609">//&nbsp;POSIX&nbsp;syntax</span><br>
<span class="lineno"></span><span class="op" id="3128625">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3128628">//&nbsp;Pseudo-ops&nbsp;for&nbsp;parsing&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="3128661">const</span>&nbsp;<span class="op" id="3128667">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128670">opLeftParen</span>&nbsp;<span class="op" id="3128682">=</span>&nbsp;<span class="ident" id="3128684">opPseudo</span>&nbsp;<span class="op" id="3128693">+</span>&nbsp;<span class="ident" id="3128695">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128701">opVerticalBar</span><br>
<span class="lineno"></span><span class="op" id="3128715">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3128718">type</span>&nbsp;<span class="ident" id="3128723">parser</span>&nbsp;<span class="keyword" id="3128730">struct</span>&nbsp;<span class="op" id="3128737">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128740">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3128752">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3128762">//&nbsp;parse&nbsp;mode&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128783">stack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3128795">[</span><span class="op" id="3128796">]</span><span class="op" id="3128797">*</span><span class="ident" id="3128798">Regexp</span>&nbsp;<span class="comment" id="3128805">//&nbsp;stack&nbsp;of&nbsp;parsed&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128837">free</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3128849">*</span><span class="ident" id="3128850">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128858">numCap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3128870">int</span>&nbsp;<span class="comment" id="3128874">//&nbsp;number&nbsp;of&nbsp;capturing&nbsp;groups&nbsp;seen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128910">wholeRegexp</span>&nbsp;<span class="builtintype" id="3128922">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128930">tmpClass</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3128942">[</span><span class="op" id="3128943">]</span><span class="builtintype" id="3128944">rune</span>&nbsp;<span class="comment" id="3128949">//&nbsp;temporary&nbsp;char&nbsp;class&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="3128984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3128987">func</span>&nbsp;<span class="op" id="3128992">(</span><span class="ident" id="3128993">p</span>&nbsp;<span class="op" id="3128995">*</span><span class="ident" id="3128996">parser</span><span class="op" id="3129002">)</span>&nbsp;<span class="ident" id="3129004">newRegexp</span><span class="op" id="3129013">(</span><span class="ident" id="3129014">op</span>&nbsp;<span class="ident" id="3129017">Op</span><span class="op" id="3129019">)</span>&nbsp;<span class="op" id="3129021">*</span><span class="ident" id="3129022">Regexp</span>&nbsp;<span class="op" id="3129029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129032">re</span>&nbsp;<span class="op" id="3129035">:=</span>&nbsp;<span class="ident" id="3129038">p</span><span class="op" id="3129039">.</span><span class="ident" id="3129040">free</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129046">if</span>&nbsp;<span class="ident" id="3129049">re</span>&nbsp;<span class="op" id="3129052">!=</span>&nbsp;<span class="ident" id="3129055">nil</span>&nbsp;<span class="op" id="3129059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129063">p</span><span class="op" id="3129064">.</span><span class="ident" id="3129065">free</span>&nbsp;<span class="op" id="3129070">=</span>&nbsp;<span class="ident" id="3129072">re</span><span class="op" id="3129074">.</span><span class="ident" id="3129075">Sub0</span><span class="op" id="3129079">[</span><span class="num" id="3129080">0</span><span class="op" id="3129081">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129085">*</span><span class="ident" id="3129086">re</span>&nbsp;<span class="op" id="3129089">=</span>&nbsp;<span class="ident" id="3129091">Regexp</span><span class="op" id="3129097">{</span><span class="op" id="3129098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129101">}</span>&nbsp;<span class="keyword" id="3129103">else</span>&nbsp;<span class="op" id="3129108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129112">re</span>&nbsp;<span class="op" id="3129115">=</span>&nbsp;<span class="builtinfunc" id="3129117">new</span><span class="op" id="3129120">(</span><span class="ident" id="3129121">Regexp</span><span class="op" id="3129127">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129133">re</span><span class="op" id="3129135">.</span><span class="ident" id="3129136">Op</span>&nbsp;<span class="op" id="3129139">=</span>&nbsp;<span class="ident" id="3129141">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129145">return</span>&nbsp;<span class="ident" id="3129152">re</span><br>
<span class="lineno"></span><span class="op" id="3129155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="3129158">func</span>&nbsp;<span class="op" id="3129163">(</span><span class="ident" id="3129164">p</span>&nbsp;<span class="op" id="3129166">*</span><span class="ident" id="3129167">parser</span><span class="op" id="3129173">)</span>&nbsp;<span class="ident" id="3129175">reuse</span><span class="op" id="3129180">(</span><span class="ident" id="3129181">re</span>&nbsp;<span class="op" id="3129184">*</span><span class="ident" id="3129185">Regexp</span><span class="op" id="3129191">)</span>&nbsp;<span class="op" id="3129193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129196">re</span><span class="op" id="3129198">.</span><span class="ident" id="3129199">Sub0</span><span class="op" id="3129203">[</span><span class="num" id="3129204">0</span><span class="op" id="3129205">]</span>&nbsp;<span class="op" id="3129207">=</span>&nbsp;<span class="ident" id="3129209">p</span><span class="op" id="3129210">.</span><span class="ident" id="3129211">free</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129217">p</span><span class="op" id="3129218">.</span><span class="ident" id="3129219">free</span>&nbsp;<span class="op" id="3129224">=</span>&nbsp;<span class="ident" id="3129226">re</span><br>
<span class="lineno"></span><span class="op" id="3129229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3129232">//&nbsp;Parse&nbsp;stack&nbsp;manipulation.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3129262">//&nbsp;push&nbsp;pushes&nbsp;the&nbsp;regexp&nbsp;re&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack&nbsp;and&nbsp;returns&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="3129336">func</span>&nbsp;<span class="op" id="3129341">(</span><span class="ident" id="3129342">p</span>&nbsp;<span class="op" id="3129344">*</span><span class="ident" id="3129345">parser</span><span class="op" id="3129351">)</span>&nbsp;<span class="ident" id="3129353">push</span><span class="op" id="3129357">(</span><span class="ident" id="3129358">re</span>&nbsp;<span class="op" id="3129361">*</span><span class="ident" id="3129362">Regexp</span><span class="op" id="3129368">)</span>&nbsp;<span class="op" id="3129370">*</span><span class="ident" id="3129371">Regexp</span>&nbsp;<span class="op" id="3129378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129381">if</span>&nbsp;<span class="ident" id="3129384">re</span><span class="op" id="3129386">.</span><span class="ident" id="3129387">Op</span>&nbsp;<span class="op" id="3129390">==</span>&nbsp;<span class="ident" id="3129393">OpCharClass</span>&nbsp;<span class="op" id="3129405">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3129408">len</span><span class="op" id="3129411">(</span><span class="ident" id="3129412">re</span><span class="op" id="3129414">.</span><span class="ident" id="3129415">Rune</span><span class="op" id="3129419">)</span>&nbsp;<span class="op" id="3129421">==</span>&nbsp;<span class="num" id="3129424">2</span>&nbsp;<span class="op" id="3129426">&amp;&amp;</span>&nbsp;<span class="ident" id="3129429">re</span><span class="op" id="3129431">.</span><span class="ident" id="3129432">Rune</span><span class="op" id="3129436">[</span><span class="num" id="3129437">0</span><span class="op" id="3129438">]</span>&nbsp;<span class="op" id="3129440">==</span>&nbsp;<span class="ident" id="3129443">re</span><span class="op" id="3129445">.</span><span class="ident" id="3129446">Rune</span><span class="op" id="3129450">[</span><span class="num" id="3129451">1</span><span class="op" id="3129452">]</span>&nbsp;<span class="op" id="3129454">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3129458">//&nbsp;Single&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129476">if</span>&nbsp;<span class="ident" id="3129479">p</span><span class="op" id="3129480">.</span><span class="ident" id="3129481">maybeConcat</span><span class="op" id="3129492">(</span><span class="ident" id="3129493">re</span><span class="op" id="3129495">.</span><span class="ident" id="3129496">Rune</span><span class="op" id="3129500">[</span><span class="num" id="3129501">0</span><span class="op" id="3129502">]</span><span class="op" id="3129503">,</span>&nbsp;<span class="ident" id="3129505">p</span><span class="op" id="3129506">.</span><span class="ident" id="3129507">flags</span><span class="op" id="3129512">&amp;^</span><span class="ident" id="3129514">FoldCase</span><span class="op" id="3129522">)</span>&nbsp;<span class="op" id="3129524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129529">return</span>&nbsp;<span class="ident" id="3129536">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129546">re</span><span class="op" id="3129548">.</span><span class="ident" id="3129549">Op</span>&nbsp;<span class="op" id="3129552">=</span>&nbsp;<span class="ident" id="3129554">OpLiteral</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129566">re</span><span class="op" id="3129568">.</span><span class="ident" id="3129569">Rune</span>&nbsp;<span class="op" id="3129574">=</span>&nbsp;<span class="ident" id="3129576">re</span><span class="op" id="3129578">.</span><span class="ident" id="3129579">Rune</span><span class="op" id="3129583">[</span><span class="op" id="3129584">:</span><span class="num" id="3129585">1</span><span class="op" id="3129586">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129590">re</span><span class="op" id="3129592">.</span><span class="ident" id="3129593">Flags</span>&nbsp;<span class="op" id="3129599">=</span>&nbsp;<span class="ident" id="3129601">p</span><span class="op" id="3129602">.</span><span class="ident" id="3129603">flags</span>&nbsp;<span class="op" id="3129609">&amp;^</span>&nbsp;<span class="ident" id="3129612">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129622">}</span>&nbsp;<span class="keyword" id="3129624">else</span>&nbsp;<span class="keyword" id="3129629">if</span>&nbsp;<span class="ident" id="3129632">re</span><span class="op" id="3129634">.</span><span class="ident" id="3129635">Op</span>&nbsp;<span class="op" id="3129638">==</span>&nbsp;<span class="ident" id="3129641">OpCharClass</span>&nbsp;<span class="op" id="3129653">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3129656">len</span><span class="op" id="3129659">(</span><span class="ident" id="3129660">re</span><span class="op" id="3129662">.</span><span class="ident" id="3129663">Rune</span><span class="op" id="3129667">)</span>&nbsp;<span class="op" id="3129669">==</span>&nbsp;<span class="num" id="3129672">4</span>&nbsp;<span class="op" id="3129674">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129679">re</span><span class="op" id="3129681">.</span><span class="ident" id="3129682">Rune</span><span class="op" id="3129686">[</span><span class="num" id="3129687">0</span><span class="op" id="3129688">]</span>&nbsp;<span class="op" id="3129690">==</span>&nbsp;<span class="ident" id="3129693">re</span><span class="op" id="3129695">.</span><span class="ident" id="3129696">Rune</span><span class="op" id="3129700">[</span><span class="num" id="3129701">1</span><span class="op" id="3129702">]</span>&nbsp;<span class="op" id="3129704">&amp;&amp;</span>&nbsp;<span class="ident" id="3129707">re</span><span class="op" id="3129709">.</span><span class="ident" id="3129710">Rune</span><span class="op" id="3129714">[</span><span class="num" id="3129715">2</span><span class="op" id="3129716">]</span>&nbsp;<span class="op" id="3129718">==</span>&nbsp;<span class="ident" id="3129721">re</span><span class="op" id="3129723">.</span><span class="ident" id="3129724">Rune</span><span class="op" id="3129728">[</span><span class="num" id="3129729">3</span><span class="op" id="3129730">]</span>&nbsp;<span class="op" id="3129732">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129737">unicode</span><span class="op" id="3129744">.</span><span class="ident" id="3129745">SimpleFold</span><span class="op" id="3129755">(</span><span class="ident" id="3129756">re</span><span class="op" id="3129758">.</span><span class="ident" id="3129759">Rune</span><span class="op" id="3129763">[</span><span class="num" id="3129764">0</span><span class="op" id="3129765">]</span><span class="op" id="3129766">)</span>&nbsp;<span class="op" id="3129768">==</span>&nbsp;<span class="ident" id="3129771">re</span><span class="op" id="3129773">.</span><span class="ident" id="3129774">Rune</span><span class="op" id="3129778">[</span><span class="num" id="3129779">2</span><span class="op" id="3129780">]</span>&nbsp;<span class="op" id="3129782">&amp;&amp;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129787">unicode</span><span class="op" id="3129794">.</span><span class="ident" id="3129795">SimpleFold</span><span class="op" id="3129805">(</span><span class="ident" id="3129806">re</span><span class="op" id="3129808">.</span><span class="ident" id="3129809">Rune</span><span class="op" id="3129813">[</span><span class="num" id="3129814">2</span><span class="op" id="3129815">]</span><span class="op" id="3129816">)</span>&nbsp;<span class="op" id="3129818">==</span>&nbsp;<span class="ident" id="3129821">re</span><span class="op" id="3129823">.</span><span class="ident" id="3129824">Rune</span><span class="op" id="3129828">[</span><span class="num" id="3129829">0</span><span class="op" id="3129830">]</span>&nbsp;<span class="op" id="3129832">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129837">re</span><span class="op" id="3129839">.</span><span class="ident" id="3129840">Op</span>&nbsp;<span class="op" id="3129843">==</span>&nbsp;<span class="ident" id="3129846">OpCharClass</span>&nbsp;<span class="op" id="3129858">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3129861">len</span><span class="op" id="3129864">(</span><span class="ident" id="3129865">re</span><span class="op" id="3129867">.</span><span class="ident" id="3129868">Rune</span><span class="op" id="3129872">)</span>&nbsp;<span class="op" id="3129874">==</span>&nbsp;<span class="num" id="3129877">2</span>&nbsp;<span class="op" id="3129879">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129885">re</span><span class="op" id="3129887">.</span><span class="ident" id="3129888">Rune</span><span class="op" id="3129892">[</span><span class="num" id="3129893">0</span><span class="op" id="3129894">]</span><span class="op" id="3129895">+</span><span class="num" id="3129896">1</span>&nbsp;<span class="op" id="3129898">==</span>&nbsp;<span class="ident" id="3129901">re</span><span class="op" id="3129903">.</span><span class="ident" id="3129904">Rune</span><span class="op" id="3129908">[</span><span class="num" id="3129909">1</span><span class="op" id="3129910">]</span>&nbsp;<span class="op" id="3129912">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129918">unicode</span><span class="op" id="3129925">.</span><span class="ident" id="3129926">SimpleFold</span><span class="op" id="3129936">(</span><span class="ident" id="3129937">re</span><span class="op" id="3129939">.</span><span class="ident" id="3129940">Rune</span><span class="op" id="3129944">[</span><span class="num" id="3129945">0</span><span class="op" id="3129946">]</span><span class="op" id="3129947">)</span>&nbsp;<span class="op" id="3129949">==</span>&nbsp;<span class="ident" id="3129952">re</span><span class="op" id="3129954">.</span><span class="ident" id="3129955">Rune</span><span class="op" id="3129959">[</span><span class="num" id="3129960">1</span><span class="op" id="3129961">]</span>&nbsp;<span class="op" id="3129963">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129969">unicode</span><span class="op" id="3129976">.</span><span class="ident" id="3129977">SimpleFold</span><span class="op" id="3129987">(</span><span class="ident" id="3129988">re</span><span class="op" id="3129990">.</span><span class="ident" id="3129991">Rune</span><span class="op" id="3129995">[</span><span class="num" id="3129996">1</span><span class="op" id="3129997">]</span><span class="op" id="3129998">)</span>&nbsp;<span class="op" id="3130000">==</span>&nbsp;<span class="ident" id="3130003">re</span><span class="op" id="3130005">.</span><span class="ident" id="3130006">Rune</span><span class="op" id="3130010">[</span><span class="num" id="3130011">0</span><span class="op" id="3130012">]</span>&nbsp;<span class="op" id="3130014">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3130018">//&nbsp;Case-insensitive&nbsp;rune&nbsp;like&nbsp;[Aa]&nbsp;or&nbsp;[Δδ].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3130066">if</span>&nbsp;<span class="ident" id="3130069">p</span><span class="op" id="3130070">.</span><span class="ident" id="3130071">maybeConcat</span><span class="op" id="3130082">(</span><span class="ident" id="3130083">re</span><span class="op" id="3130085">.</span><span class="ident" id="3130086">Rune</span><span class="op" id="3130090">[</span><span class="num" id="3130091">0</span><span class="op" id="3130092">]</span><span class="op" id="3130093">,</span>&nbsp;<span class="ident" id="3130095">p</span><span class="op" id="3130096">.</span><span class="ident" id="3130097">flags</span><span class="op" id="3130102">|</span><span class="ident" id="3130103">FoldCase</span><span class="op" id="3130111">)</span>&nbsp;<span class="op" id="3130113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3130118">return</span>&nbsp;<span class="ident" id="3130125">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3130131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3130136">//&nbsp;Rewrite&nbsp;as&nbsp;(case-insensitive)&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3130180">re</span><span class="op" id="3130182">.</span><span class="ident" id="3130183">Op</span>&nbsp;<span class="op" id="3130186">=</span>&nbsp;<span class="ident" id="3130188">OpLiteral</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3130200">re</span><span class="op" id="3130202">.</span><span class="ident" id="3130203">Rune</span>&nbsp;<span class="op" id="3130208">=</span>&nbsp;<span class="ident" id="3130210">re</span><span class="op" id="3130212">.</span><span class="ident" id="3130213">Rune</span><span class="op" id="3130217">[</span><span class="op" id="3130218">:</span><span class="num" id="3130219">1</span><span class="op" id="3130220">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3130224">re</span><span class="op" id="3130226">.</span><span class="ident" id="3130227">Flags</span>&nbsp;<span class="op" id="3130233">=</span>&nbsp;<span class="ident" id="3130235">p</span><span class="op" id="3130236">.</span><span class="ident" id="3130237">flags</span>&nbsp;<span class="op" id="3130243">|</span>&nbsp;<span class="ident" id="3130245">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3130255">}</span>&nbsp;<span class="keyword" id="3130257">else</span>&nbsp;<span class="op" id="3130262">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3130266">//&nbsp;Incremental&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3130298">p</span><span class="op" id="3130299">.</span><span class="ident" id="3130300">maybeConcat</span><span class="op" id="3130311">(</span><span class="op" id="3130312">-</span><span class="num" id="3130313">1</span><span class="op" id="3130314">,</span>&nbsp;<span class="num" id="3130316">0</span><span class="op" id="3130317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3130320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3130324">p</span><span class="op" id="3130325">.</span><span class="ident" id="3130326">stack</span>&nbsp;<span class="op" id="3130332">=</span>&nbsp;<span class="builtinfunc" id="3130334">append</span><span class="op" id="3130340">(</span><span class="ident" id="3130341">p</span><span class="op" id="3130342">.</span><span class="ident" id="3130343">stack</span><span class="op" id="3130348">,</span>&nbsp;<span class="ident" id="3130350">re</span><span class="op" id="3130352">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3130355">return</span>&nbsp;<span class="ident" id="3130362">re</span><br>
<span class="lineno"></span><span class="op" id="3130365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3130368">//&nbsp;maybeConcat&nbsp;implements&nbsp;incremental&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="3130420">//&nbsp;of&nbsp;literal&nbsp;runes&nbsp;into&nbsp;string&nbsp;nodes.&nbsp;&nbsp;The&nbsp;parser&nbsp;calls&nbsp;this</span><br>
<span class="lineno">145</span><span class="comment" id="3130482">//&nbsp;before&nbsp;each&nbsp;push,&nbsp;so&nbsp;only&nbsp;the&nbsp;top&nbsp;fragment&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="3130541">//&nbsp;might&nbsp;need&nbsp;processing.&nbsp;&nbsp;Since&nbsp;this&nbsp;is&nbsp;called&nbsp;before&nbsp;a&nbsp;push,</span><br>
<span class="lineno"></span><span class="comment" id="3130604">//&nbsp;the&nbsp;topmost&nbsp;literal&nbsp;is&nbsp;no&nbsp;longer&nbsp;subject&nbsp;to&nbsp;operators&nbsp;like&nbsp;*</span><br>
<span class="lineno"></span><span class="comment" id="3130668">//&nbsp;(Otherwise&nbsp;ab*&nbsp;would&nbsp;turn&nbsp;into&nbsp;(ab)*.)</span><br>
<span class="lineno"></span><span class="comment" id="3130710">//&nbsp;If&nbsp;r&nbsp;&gt;=&nbsp;0&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;node&nbsp;left&nbsp;over,&nbsp;maybeConcat&nbsp;uses&nbsp;it</span><br>
<span class="lineno">150</span><span class="comment" id="3130773">//&nbsp;to&nbsp;push&nbsp;r&nbsp;with&nbsp;the&nbsp;given&nbsp;flags.</span><br>
<span class="lineno"></span><span class="comment" id="3130808">//&nbsp;maybeConcat&nbsp;reports&nbsp;whether&nbsp;r&nbsp;was&nbsp;pushed.</span><br>
<span class="lineno"></span><span class="keyword" id="3130853">func</span>&nbsp;<span class="op" id="3130858">(</span><span class="ident" id="3130859">p</span>&nbsp;<span class="op" id="3130861">*</span><span class="ident" id="3130862">parser</span><span class="op" id="3130868">)</span>&nbsp;<span class="ident" id="3130870">maybeConcat</span><span class="op" id="3130881">(</span><span class="ident" id="3130882">r</span>&nbsp;<span class="builtintype" id="3130884">rune</span><span class="op" id="3130888">,</span>&nbsp;<span class="ident" id="3130890">flags</span>&nbsp;<span class="ident" id="3130896">Flags</span><span class="op" id="3130901">)</span>&nbsp;<span class="builtintype" id="3130903">bool</span>&nbsp;<span class="op" id="3130908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3130911">n</span>&nbsp;<span class="op" id="3130913">:=</span>&nbsp;<span class="builtinfunc" id="3130916">len</span><span class="op" id="3130919">(</span><span class="ident" id="3130920">p</span><span class="op" id="3130921">.</span><span class="ident" id="3130922">stack</span><span class="op" id="3130927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3130930">if</span>&nbsp;<span class="ident" id="3130933">n</span>&nbsp;<span class="op" id="3130935">&lt;</span>&nbsp;<span class="num" id="3130937">2</span>&nbsp;<span class="op" id="3130939">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3130943">return</span>&nbsp;<span class="builtintype" id="3130950">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3130957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3130961">re1</span>&nbsp;<span class="op" id="3130965">:=</span>&nbsp;<span class="ident" id="3130968">p</span><span class="op" id="3130969">.</span><span class="ident" id="3130970">stack</span><span class="op" id="3130975">[</span><span class="ident" id="3130976">n</span><span class="op" id="3130977">-</span><span class="num" id="3130978">1</span><span class="op" id="3130979">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3130982">re2</span>&nbsp;<span class="op" id="3130986">:=</span>&nbsp;<span class="ident" id="3130989">p</span><span class="op" id="3130990">.</span><span class="ident" id="3130991">stack</span><span class="op" id="3130996">[</span><span class="ident" id="3130997">n</span><span class="op" id="3130998">-</span><span class="num" id="3130999">2</span><span class="op" id="3131000">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131003">if</span>&nbsp;<span class="ident" id="3131006">re1</span><span class="op" id="3131009">.</span><span class="ident" id="3131010">Op</span>&nbsp;<span class="op" id="3131013">!=</span>&nbsp;<span class="ident" id="3131016">OpLiteral</span>&nbsp;<span class="op" id="3131026">||</span>&nbsp;<span class="ident" id="3131029">re2</span><span class="op" id="3131032">.</span><span class="ident" id="3131033">Op</span>&nbsp;<span class="op" id="3131036">!=</span>&nbsp;<span class="ident" id="3131039">OpLiteral</span>&nbsp;<span class="op" id="3131049">||</span>&nbsp;<span class="ident" id="3131052">re1</span><span class="op" id="3131055">.</span><span class="ident" id="3131056">Flags</span><span class="op" id="3131061">&amp;</span><span class="ident" id="3131062">FoldCase</span>&nbsp;<span class="op" id="3131071">!=</span>&nbsp;<span class="ident" id="3131074">re2</span><span class="op" id="3131077">.</span><span class="ident" id="3131078">Flags</span><span class="op" id="3131083">&amp;</span><span class="ident" id="3131084">FoldCase</span>&nbsp;<span class="op" id="3131093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131097">return</span>&nbsp;<span class="builtintype" id="3131104">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3131111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3131115">//&nbsp;Push&nbsp;re1&nbsp;into&nbsp;re2.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3131138">re2</span><span class="op" id="3131141">.</span><span class="ident" id="3131142">Rune</span>&nbsp;<span class="op" id="3131147">=</span>&nbsp;<span class="builtinfunc" id="3131149">append</span><span class="op" id="3131155">(</span><span class="ident" id="3131156">re2</span><span class="op" id="3131159">.</span><span class="ident" id="3131160">Rune</span><span class="op" id="3131164">,</span>&nbsp;<span class="ident" id="3131166">re1</span><span class="op" id="3131169">.</span><span class="ident" id="3131170">Rune</span><span class="op" id="3131174">...</span><span class="op" id="3131177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3131181">//&nbsp;Reuse&nbsp;re1&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131208">if</span>&nbsp;<span class="ident" id="3131211">r</span>&nbsp;<span class="op" id="3131213">&gt;=</span>&nbsp;<span class="num" id="3131216">0</span>&nbsp;<span class="op" id="3131218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3131222">re1</span><span class="op" id="3131225">.</span><span class="ident" id="3131226">Rune</span>&nbsp;<span class="op" id="3131231">=</span>&nbsp;<span class="ident" id="3131233">re1</span><span class="op" id="3131236">.</span><span class="ident" id="3131237">Rune0</span><span class="op" id="3131242">[</span><span class="op" id="3131243">:</span><span class="num" id="3131244">1</span><span class="op" id="3131245">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3131249">re1</span><span class="op" id="3131252">.</span><span class="ident" id="3131253">Rune</span><span class="op" id="3131257">[</span><span class="num" id="3131258">0</span><span class="op" id="3131259">]</span>&nbsp;<span class="op" id="3131261">=</span>&nbsp;<span class="ident" id="3131263">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3131267">re1</span><span class="op" id="3131270">.</span><span class="ident" id="3131271">Flags</span>&nbsp;<span class="op" id="3131277">=</span>&nbsp;<span class="ident" id="3131279">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131287">return</span>&nbsp;<span class="builtintype" id="3131294">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3131300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3131304">p</span><span class="op" id="3131305">.</span><span class="ident" id="3131306">stack</span>&nbsp;<span class="op" id="3131312">=</span>&nbsp;<span class="ident" id="3131314">p</span><span class="op" id="3131315">.</span><span class="ident" id="3131316">stack</span><span class="op" id="3131321">[</span><span class="op" id="3131322">:</span><span class="ident" id="3131323">n</span><span class="op" id="3131324">-</span><span class="num" id="3131325">1</span><span class="op" id="3131326">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3131329">p</span><span class="op" id="3131330">.</span><span class="ident" id="3131331">reuse</span><span class="op" id="3131336">(</span><span class="ident" id="3131337">re1</span><span class="op" id="3131340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131343">return</span>&nbsp;<span class="builtintype" id="3131350">false</span>&nbsp;<span class="comment" id="3131356">//&nbsp;did&nbsp;not&nbsp;push&nbsp;r</span><br>
<span class="lineno"></span><span class="op" id="3131374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="3131377">//&nbsp;newLiteral&nbsp;returns&nbsp;a&nbsp;new&nbsp;OpLiteral&nbsp;Regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;flags</span><br>
<span class="lineno"></span><span class="keyword" id="3131443">func</span>&nbsp;<span class="op" id="3131448">(</span><span class="ident" id="3131449">p</span>&nbsp;<span class="op" id="3131451">*</span><span class="ident" id="3131452">parser</span><span class="op" id="3131458">)</span>&nbsp;<span class="ident" id="3131460">newLiteral</span><span class="op" id="3131470">(</span><span class="ident" id="3131471">r</span>&nbsp;<span class="builtintype" id="3131473">rune</span><span class="op" id="3131477">,</span>&nbsp;<span class="ident" id="3131479">flags</span>&nbsp;<span class="ident" id="3131485">Flags</span><span class="op" id="3131490">)</span>&nbsp;<span class="op" id="3131492">*</span><span class="ident" id="3131493">Regexp</span>&nbsp;<span class="op" id="3131500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3131503">re</span>&nbsp;<span class="op" id="3131506">:=</span>&nbsp;<span class="ident" id="3131509">p</span><span class="op" id="3131510">.</span><span class="ident" id="3131511">newRegexp</span><span class="op" id="3131520">(</span><span class="ident" id="3131521">OpLiteral</span><span class="op" id="3131530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3131533">re</span><span class="op" id="3131535">.</span><span class="ident" id="3131536">Flags</span>&nbsp;<span class="op" id="3131542">=</span>&nbsp;<span class="ident" id="3131544">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131551">if</span>&nbsp;<span class="ident" id="3131554">flags</span><span class="op" id="3131559">&amp;</span><span class="ident" id="3131560">FoldCase</span>&nbsp;<span class="op" id="3131569">!=</span>&nbsp;<span class="num" id="3131572">0</span>&nbsp;<span class="op" id="3131574">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3131578">r</span>&nbsp;<span class="op" id="3131580">=</span>&nbsp;<span class="ident" id="3131582">minFoldRune</span><span class="op" id="3131593">(</span><span class="ident" id="3131594">r</span><span class="op" id="3131595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3131598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3131601">re</span><span class="op" id="3131603">.</span><span class="ident" id="3131604">Rune0</span><span class="op" id="3131609">[</span><span class="num" id="3131610">0</span><span class="op" id="3131611">]</span>&nbsp;<span class="op" id="3131613">=</span>&nbsp;<span class="ident" id="3131615">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3131618">re</span><span class="op" id="3131620">.</span><span class="ident" id="3131621">Rune</span>&nbsp;<span class="op" id="3131626">=</span>&nbsp;<span class="ident" id="3131628">re</span><span class="op" id="3131630">.</span><span class="ident" id="3131631">Rune0</span><span class="op" id="3131636">[</span><span class="op" id="3131637">:</span><span class="num" id="3131638">1</span><span class="op" id="3131639">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131642">return</span>&nbsp;<span class="ident" id="3131649">re</span><br>
<span class="lineno">190</span><span class="op" id="3131652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3131655">//&nbsp;minFoldRune&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;rune&nbsp;fold-equivalent&nbsp;to&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3131717">func</span>&nbsp;<span class="ident" id="3131722">minFoldRune</span><span class="op" id="3131733">(</span><span class="ident" id="3131734">r</span>&nbsp;<span class="builtintype" id="3131736">rune</span><span class="op" id="3131740">)</span>&nbsp;<span class="builtintype" id="3131742">rune</span>&nbsp;<span class="op" id="3131747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131750">if</span>&nbsp;<span class="ident" id="3131753">r</span>&nbsp;<span class="op" id="3131755">&lt;</span>&nbsp;<span class="ident" id="3131757">minFold</span>&nbsp;<span class="op" id="3131765">||</span>&nbsp;<span class="ident" id="3131768">r</span>&nbsp;<span class="op" id="3131770">&gt;</span>&nbsp;<span class="ident" id="3131772">maxFold</span>&nbsp;<span class="op" id="3131780">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131784">return</span>&nbsp;<span class="ident" id="3131791">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3131794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3131797">min</span>&nbsp;<span class="op" id="3131801">:=</span>&nbsp;<span class="ident" id="3131804">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3131807">r0</span>&nbsp;<span class="op" id="3131810">:=</span>&nbsp;<span class="ident" id="3131813">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131816">for</span>&nbsp;<span class="ident" id="3131820">r</span>&nbsp;<span class="op" id="3131822">=</span>&nbsp;<span class="ident" id="3131824">unicode</span><span class="op" id="3131831">.</span><span class="ident" id="3131832">SimpleFold</span><span class="op" id="3131842">(</span><span class="ident" id="3131843">r</span><span class="op" id="3131844">)</span><span class="op" id="3131845">;</span>&nbsp;<span class="ident" id="3131847">r</span>&nbsp;<span class="op" id="3131849">!=</span>&nbsp;<span class="ident" id="3131852">r0</span><span class="op" id="3131854">;</span>&nbsp;<span class="ident" id="3131856">r</span>&nbsp;<span class="op" id="3131858">=</span>&nbsp;<span class="ident" id="3131860">unicode</span><span class="op" id="3131867">.</span><span class="ident" id="3131868">SimpleFold</span><span class="op" id="3131878">(</span><span class="ident" id="3131879">r</span><span class="op" id="3131880">)</span>&nbsp;<span class="op" id="3131882">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131886">if</span>&nbsp;<span class="ident" id="3131889">min</span>&nbsp;<span class="op" id="3131893">&gt;</span>&nbsp;<span class="ident" id="3131895">r</span>&nbsp;<span class="op" id="3131897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3131902">min</span>&nbsp;<span class="op" id="3131906">=</span>&nbsp;<span class="ident" id="3131908">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3131912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3131915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3131918">return</span>&nbsp;<span class="ident" id="3131925">min</span><br>
<span class="lineno">205</span><span class="op" id="3131929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3131932">//&nbsp;literal&nbsp;pushes&nbsp;a&nbsp;literal&nbsp;regexp&nbsp;for&nbsp;the&nbsp;rune&nbsp;r&nbsp;on&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="3131995">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="3132023">func</span>&nbsp;<span class="op" id="3132028">(</span><span class="ident" id="3132029">p</span>&nbsp;<span class="op" id="3132031">*</span><span class="ident" id="3132032">parser</span><span class="op" id="3132038">)</span>&nbsp;<span class="ident" id="3132040">literal</span><span class="op" id="3132047">(</span><span class="ident" id="3132048">r</span>&nbsp;<span class="builtintype" id="3132050">rune</span><span class="op" id="3132054">)</span>&nbsp;<span class="op" id="3132056">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3132059">p</span><span class="op" id="3132060">.</span><span class="ident" id="3132061">push</span><span class="op" id="3132065">(</span><span class="ident" id="3132066">p</span><span class="op" id="3132067">.</span><span class="ident" id="3132068">newLiteral</span><span class="op" id="3132078">(</span><span class="ident" id="3132079">r</span><span class="op" id="3132080">,</span>&nbsp;<span class="ident" id="3132082">p</span><span class="op" id="3132083">.</span><span class="ident" id="3132084">flags</span><span class="op" id="3132089">)</span><span class="op" id="3132090">)</span><br>
<span class="lineno"></span><span class="op" id="3132092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3132095">//&nbsp;op&nbsp;pushes&nbsp;a&nbsp;regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;op&nbsp;onto&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="3132150">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno">215</span><span class="keyword" id="3132178">func</span>&nbsp;<span class="op" id="3132183">(</span><span class="ident" id="3132184">p</span>&nbsp;<span class="op" id="3132186">*</span><span class="ident" id="3132187">parser</span><span class="op" id="3132193">)</span>&nbsp;<span class="ident" id="3132195">op</span><span class="op" id="3132197">(</span><span class="ident" id="3132198">op</span>&nbsp;<span class="ident" id="3132201">Op</span><span class="op" id="3132203">)</span>&nbsp;<span class="op" id="3132205">*</span><span class="ident" id="3132206">Regexp</span>&nbsp;<span class="op" id="3132213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3132216">re</span>&nbsp;<span class="op" id="3132219">:=</span>&nbsp;<span class="ident" id="3132222">p</span><span class="op" id="3132223">.</span><span class="ident" id="3132224">newRegexp</span><span class="op" id="3132233">(</span><span class="ident" id="3132234">op</span><span class="op" id="3132236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3132239">re</span><span class="op" id="3132241">.</span><span class="ident" id="3132242">Flags</span>&nbsp;<span class="op" id="3132248">=</span>&nbsp;<span class="ident" id="3132250">p</span><span class="op" id="3132251">.</span><span class="ident" id="3132252">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3132259">return</span>&nbsp;<span class="ident" id="3132266">p</span><span class="op" id="3132267">.</span><span class="ident" id="3132268">push</span><span class="op" id="3132272">(</span><span class="ident" id="3132273">re</span><span class="op" id="3132275">)</span><br>
<span class="lineno"></span><span class="op" id="3132277">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3132280">//&nbsp;repeat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;stack&nbsp;element&nbsp;with&nbsp;itself&nbsp;repeated&nbsp;according&nbsp;to&nbsp;op,&nbsp;min,&nbsp;max.</span><br>
<span class="lineno"></span><span class="comment" id="3132369">//&nbsp;before&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;starting&nbsp;at&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="3132437">//&nbsp;after&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;following&nbsp;after&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="3132508">//&nbsp;repeat&nbsp;returns&nbsp;an&nbsp;updated&nbsp;&#39;after&#39;&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">225</span><span class="keyword" id="3132567">func</span>&nbsp;<span class="op" id="3132572">(</span><span class="ident" id="3132573">p</span>&nbsp;<span class="op" id="3132575">*</span><span class="ident" id="3132576">parser</span><span class="op" id="3132582">)</span>&nbsp;<span class="ident" id="3132584">repeat</span><span class="op" id="3132590">(</span><span class="ident" id="3132591">op</span>&nbsp;<span class="ident" id="3132594">Op</span><span class="op" id="3132596">,</span>&nbsp;<span class="ident" id="3132598">min</span><span class="op" id="3132601">,</span>&nbsp;<span class="ident" id="3132603">max</span>&nbsp;<span class="builtintype" id="3132607">int</span><span class="op" id="3132610">,</span>&nbsp;<span class="ident" id="3132612">before</span><span class="op" id="3132618">,</span>&nbsp;<span class="ident" id="3132620">after</span><span class="op" id="3132625">,</span>&nbsp;<span class="ident" id="3132627">lastRepeat</span>&nbsp;<span class="builtintype" id="3132638">string</span><span class="op" id="3132644">)</span>&nbsp;<span class="op" id="3132646">(</span><span class="builtintype" id="3132647">string</span><span class="op" id="3132653">,</span>&nbsp;<span class="builtintype" id="3132655">error</span><span class="op" id="3132660">)</span>&nbsp;<span class="op" id="3132662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3132665">flags</span>&nbsp;<span class="op" id="3132671">:=</span>&nbsp;<span class="ident" id="3132674">p</span><span class="op" id="3132675">.</span><span class="ident" id="3132676">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3132683">if</span>&nbsp;<span class="ident" id="3132686">p</span><span class="op" id="3132687">.</span><span class="ident" id="3132688">flags</span><span class="op" id="3132693">&amp;</span><span class="ident" id="3132694">PerlX</span>&nbsp;<span class="op" id="3132700">!=</span>&nbsp;<span class="num" id="3132703">0</span>&nbsp;<span class="op" id="3132705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3132709">if</span>&nbsp;<span class="builtinfunc" id="3132712">len</span><span class="op" id="3132715">(</span><span class="ident" id="3132716">after</span><span class="op" id="3132721">)</span>&nbsp;<span class="op" id="3132723">&gt;</span>&nbsp;<span class="num" id="3132725">0</span>&nbsp;<span class="op" id="3132727">&amp;&amp;</span>&nbsp;<span class="ident" id="3132730">after</span><span class="op" id="3132735">[</span><span class="num" id="3132736">0</span><span class="op" id="3132737">]</span>&nbsp;<span class="op" id="3132739">==</span>&nbsp;<span class="string" id="3132742">&#39;?&#39;</span>&nbsp;<span class="op" id="3132746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3132751">after</span>&nbsp;<span class="op" id="3132757">=</span>&nbsp;<span class="ident" id="3132759">after</span><span class="op" id="3132764">[</span><span class="num" id="3132765">1</span><span class="op" id="3132766">:</span><span class="op" id="3132767">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3132772">flags</span>&nbsp;<span class="op" id="3132778">^=</span>&nbsp;<span class="ident" id="3132781">NonGreedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3132793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3132797">if</span>&nbsp;<span class="ident" id="3132800">lastRepeat</span>&nbsp;<span class="op" id="3132811">!=</span>&nbsp;<span class="string" id="3132814">&#34;&#34;</span>&nbsp;<span class="op" id="3132817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3132822">//&nbsp;In&nbsp;Perl&nbsp;it&nbsp;is&nbsp;not&nbsp;allowed&nbsp;to&nbsp;stack&nbsp;repetition&nbsp;operators:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3132885">//&nbsp;a**&nbsp;is&nbsp;a&nbsp;syntax&nbsp;error,&nbsp;not&nbsp;a&nbsp;doubled&nbsp;star,&nbsp;and&nbsp;a++&nbsp;means</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3132948">//&nbsp;something&nbsp;else&nbsp;entirely,&nbsp;which&nbsp;we&nbsp;don&#39;t&nbsp;support!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133003">return</span>&nbsp;<span class="string" id="3133010">&#34;&#34;</span><span class="op" id="3133012">,</span>&nbsp;<span class="op" id="3133014">&amp;</span><span class="ident" id="3133015">Error</span><span class="op" id="3133020">{</span><span class="ident" id="3133021">ErrInvalidRepeatOp</span><span class="op" id="3133039">,</span>&nbsp;<span class="ident" id="3133041">lastRepeat</span><span class="op" id="3133051">[</span><span class="op" id="3133052">:</span><span class="builtinfunc" id="3133053">len</span><span class="op" id="3133056">(</span><span class="ident" id="3133057">lastRepeat</span><span class="op" id="3133067">)</span><span class="op" id="3133068">-</span><span class="builtinfunc" id="3133069">len</span><span class="op" id="3133072">(</span><span class="ident" id="3133073">after</span><span class="op" id="3133078">)</span><span class="op" id="3133079">]</span><span class="op" id="3133080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3133084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3133087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3133090">n</span>&nbsp;<span class="op" id="3133092">:=</span>&nbsp;<span class="builtinfunc" id="3133095">len</span><span class="op" id="3133098">(</span><span class="ident" id="3133099">p</span><span class="op" id="3133100">.</span><span class="ident" id="3133101">stack</span><span class="op" id="3133106">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133109">if</span>&nbsp;<span class="ident" id="3133112">n</span>&nbsp;<span class="op" id="3133114">==</span>&nbsp;<span class="num" id="3133117">0</span>&nbsp;<span class="op" id="3133119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133123">return</span>&nbsp;<span class="string" id="3133130">&#34;&#34;</span><span class="op" id="3133132">,</span>&nbsp;<span class="op" id="3133134">&amp;</span><span class="ident" id="3133135">Error</span><span class="op" id="3133140">{</span><span class="ident" id="3133141">ErrMissingRepeatArgument</span><span class="op" id="3133165">,</span>&nbsp;<span class="ident" id="3133167">before</span><span class="op" id="3133173">[</span><span class="op" id="3133174">:</span><span class="builtinfunc" id="3133175">len</span><span class="op" id="3133178">(</span><span class="ident" id="3133179">before</span><span class="op" id="3133185">)</span><span class="op" id="3133186">-</span><span class="builtinfunc" id="3133187">len</span><span class="op" id="3133190">(</span><span class="ident" id="3133191">after</span><span class="op" id="3133196">)</span><span class="op" id="3133197">]</span><span class="op" id="3133198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3133201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3133204">sub</span>&nbsp;<span class="op" id="3133208">:=</span>&nbsp;<span class="ident" id="3133211">p</span><span class="op" id="3133212">.</span><span class="ident" id="3133213">stack</span><span class="op" id="3133218">[</span><span class="ident" id="3133219">n</span><span class="op" id="3133220">-</span><span class="num" id="3133221">1</span><span class="op" id="3133222">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133225">if</span>&nbsp;<span class="ident" id="3133228">sub</span><span class="op" id="3133231">.</span><span class="ident" id="3133232">Op</span>&nbsp;<span class="op" id="3133235">&gt;=</span>&nbsp;<span class="ident" id="3133238">opPseudo</span>&nbsp;<span class="op" id="3133247">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133251">return</span>&nbsp;<span class="string" id="3133258">&#34;&#34;</span><span class="op" id="3133260">,</span>&nbsp;<span class="op" id="3133262">&amp;</span><span class="ident" id="3133263">Error</span><span class="op" id="3133268">{</span><span class="ident" id="3133269">ErrMissingRepeatArgument</span><span class="op" id="3133293">,</span>&nbsp;<span class="ident" id="3133295">before</span><span class="op" id="3133301">[</span><span class="op" id="3133302">:</span><span class="builtinfunc" id="3133303">len</span><span class="op" id="3133306">(</span><span class="ident" id="3133307">before</span><span class="op" id="3133313">)</span><span class="op" id="3133314">-</span><span class="builtinfunc" id="3133315">len</span><span class="op" id="3133318">(</span><span class="ident" id="3133319">after</span><span class="op" id="3133324">)</span><span class="op" id="3133325">]</span><span class="op" id="3133326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3133329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3133333">re</span>&nbsp;<span class="op" id="3133336">:=</span>&nbsp;<span class="ident" id="3133339">p</span><span class="op" id="3133340">.</span><span class="ident" id="3133341">newRegexp</span><span class="op" id="3133350">(</span><span class="ident" id="3133351">op</span><span class="op" id="3133353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3133356">re</span><span class="op" id="3133358">.</span><span class="ident" id="3133359">Min</span>&nbsp;<span class="op" id="3133363">=</span>&nbsp;<span class="ident" id="3133365">min</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3133370">re</span><span class="op" id="3133372">.</span><span class="ident" id="3133373">Max</span>&nbsp;<span class="op" id="3133377">=</span>&nbsp;<span class="ident" id="3133379">max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3133384">re</span><span class="op" id="3133386">.</span><span class="ident" id="3133387">Flags</span>&nbsp;<span class="op" id="3133393">=</span>&nbsp;<span class="ident" id="3133395">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3133402">re</span><span class="op" id="3133404">.</span><span class="ident" id="3133405">Sub</span>&nbsp;<span class="op" id="3133409">=</span>&nbsp;<span class="ident" id="3133411">re</span><span class="op" id="3133413">.</span><span class="ident" id="3133414">Sub0</span><span class="op" id="3133418">[</span><span class="op" id="3133419">:</span><span class="num" id="3133420">1</span><span class="op" id="3133421">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3133424">re</span><span class="op" id="3133426">.</span><span class="ident" id="3133427">Sub</span><span class="op" id="3133430">[</span><span class="num" id="3133431">0</span><span class="op" id="3133432">]</span>&nbsp;<span class="op" id="3133434">=</span>&nbsp;<span class="ident" id="3133436">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3133441">p</span><span class="op" id="3133442">.</span><span class="ident" id="3133443">stack</span><span class="op" id="3133448">[</span><span class="ident" id="3133449">n</span><span class="op" id="3133450">-</span><span class="num" id="3133451">1</span><span class="op" id="3133452">]</span>&nbsp;<span class="op" id="3133454">=</span>&nbsp;<span class="ident" id="3133456">re</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133461">if</span>&nbsp;<span class="ident" id="3133464">op</span>&nbsp;<span class="op" id="3133467">==</span>&nbsp;<span class="ident" id="3133470">OpRepeat</span>&nbsp;<span class="op" id="3133479">&amp;&amp;</span>&nbsp;<span class="op" id="3133482">(</span><span class="ident" id="3133483">min</span>&nbsp;<span class="op" id="3133487">&gt;=</span>&nbsp;<span class="num" id="3133490">2</span>&nbsp;<span class="op" id="3133492">||</span>&nbsp;<span class="ident" id="3133495">max</span>&nbsp;<span class="op" id="3133499">&gt;=</span>&nbsp;<span class="num" id="3133502">2</span><span class="op" id="3133503">)</span>&nbsp;<span class="op" id="3133505">&amp;&amp;</span>&nbsp;<span class="op" id="3133508">!</span><span class="ident" id="3133509">repeatIsValid</span><span class="op" id="3133522">(</span><span class="ident" id="3133523">re</span><span class="op" id="3133525">,</span>&nbsp;<span class="num" id="3133527">1000</span><span class="op" id="3133531">)</span>&nbsp;<span class="op" id="3133533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133537">return</span>&nbsp;<span class="string" id="3133544">&#34;&#34;</span><span class="op" id="3133546">,</span>&nbsp;<span class="op" id="3133548">&amp;</span><span class="ident" id="3133549">Error</span><span class="op" id="3133554">{</span><span class="ident" id="3133555">ErrInvalidRepeatSize</span><span class="op" id="3133575">,</span>&nbsp;<span class="ident" id="3133577">before</span><span class="op" id="3133583">[</span><span class="op" id="3133584">:</span><span class="builtinfunc" id="3133585">len</span><span class="op" id="3133588">(</span><span class="ident" id="3133589">before</span><span class="op" id="3133595">)</span><span class="op" id="3133596">-</span><span class="builtinfunc" id="3133597">len</span><span class="op" id="3133600">(</span><span class="ident" id="3133601">after</span><span class="op" id="3133606">)</span><span class="op" id="3133607">]</span><span class="op" id="3133608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3133611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3133615">return</span>&nbsp;<span class="ident" id="3133622">after</span><span class="op" id="3133627">,</span>&nbsp;<span class="ident" id="3133629">nil</span><br>
<span class="lineno"></span><span class="op" id="3133633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3133636">//&nbsp;repeatIsValid&nbsp;reports&nbsp;whether&nbsp;the&nbsp;repetition&nbsp;re&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="comment" id="3133697">//&nbsp;Valid&nbsp;means&nbsp;that&nbsp;the&nbsp;combination&nbsp;of&nbsp;the&nbsp;top-level&nbsp;repetition</span><br>
<span class="lineno">265</span><span class="comment" id="3133761">//&nbsp;and&nbsp;any&nbsp;inner&nbsp;repetitions&nbsp;does&nbsp;not&nbsp;exceed&nbsp;n&nbsp;copies&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3133822">//&nbsp;innermost&nbsp;thing.</span><br>
<span class="lineno"></span><span class="comment" id="3133842">//&nbsp;This&nbsp;function&nbsp;rewalks&nbsp;the&nbsp;regexp&nbsp;tree&nbsp;and&nbsp;is&nbsp;called&nbsp;for&nbsp;every&nbsp;repetition,</span><br>
<span class="lineno"></span><span class="comment" id="3133919">//&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;worry&nbsp;about&nbsp;inducing&nbsp;quadratic&nbsp;behavior&nbsp;in&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><span class="comment" id="3133991">//&nbsp;We&nbsp;avoid&nbsp;this&nbsp;by&nbsp;only&nbsp;calling&nbsp;repeatIsValid&nbsp;when&nbsp;min&nbsp;or&nbsp;max&nbsp;&gt;=&nbsp;2.</span><br>
<span class="lineno">270</span><span class="comment" id="3134060">//&nbsp;In&nbsp;that&nbsp;case&nbsp;the&nbsp;depth&nbsp;of&nbsp;any&nbsp;&gt;=&nbsp;2&nbsp;nesting&nbsp;can&nbsp;only&nbsp;get&nbsp;to&nbsp;9&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="3134132">//&nbsp;triggering&nbsp;a&nbsp;parse&nbsp;error,&nbsp;so&nbsp;each&nbsp;subtree&nbsp;can&nbsp;only&nbsp;be&nbsp;rewalked&nbsp;9&nbsp;times.</span><br>
<span class="lineno"></span><span class="keyword" id="3134207">func</span>&nbsp;<span class="ident" id="3134212">repeatIsValid</span><span class="op" id="3134225">(</span><span class="ident" id="3134226">re</span>&nbsp;<span class="op" id="3134229">*</span><span class="ident" id="3134230">Regexp</span><span class="op" id="3134236">,</span>&nbsp;<span class="ident" id="3134238">n</span>&nbsp;<span class="builtintype" id="3134240">int</span><span class="op" id="3134243">)</span>&nbsp;<span class="builtintype" id="3134245">bool</span>&nbsp;<span class="op" id="3134250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134253">if</span>&nbsp;<span class="ident" id="3134256">re</span><span class="op" id="3134258">.</span><span class="ident" id="3134259">Op</span>&nbsp;<span class="op" id="3134262">==</span>&nbsp;<span class="ident" id="3134265">OpRepeat</span>&nbsp;<span class="op" id="3134274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3134278">m</span>&nbsp;<span class="op" id="3134280">:=</span>&nbsp;<span class="ident" id="3134283">re</span><span class="op" id="3134285">.</span><span class="ident" id="3134286">Max</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134292">if</span>&nbsp;<span class="ident" id="3134295">m</span>&nbsp;<span class="op" id="3134297">==</span>&nbsp;<span class="num" id="3134300">0</span>&nbsp;<span class="op" id="3134302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134307">return</span>&nbsp;<span class="builtintype" id="3134314">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3134321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134325">if</span>&nbsp;<span class="ident" id="3134328">m</span>&nbsp;<span class="op" id="3134330">&lt;</span>&nbsp;<span class="num" id="3134332">0</span>&nbsp;<span class="op" id="3134334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3134339">m</span>&nbsp;<span class="op" id="3134341">=</span>&nbsp;<span class="ident" id="3134343">re</span><span class="op" id="3134345">.</span><span class="ident" id="3134346">Min</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3134352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134356">if</span>&nbsp;<span class="ident" id="3134359">m</span>&nbsp;<span class="op" id="3134361">&gt;</span>&nbsp;<span class="ident" id="3134363">n</span>&nbsp;<span class="op" id="3134365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134370">return</span>&nbsp;<span class="builtintype" id="3134377">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3134385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134389">if</span>&nbsp;<span class="ident" id="3134392">m</span>&nbsp;<span class="op" id="3134394">&gt;</span>&nbsp;<span class="num" id="3134396">0</span>&nbsp;<span class="op" id="3134398">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3134403">n</span>&nbsp;<span class="op" id="3134405">/=</span>&nbsp;<span class="ident" id="3134408">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3134412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3134415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134418">for</span>&nbsp;<span class="ident" id="3134422">_</span><span class="op" id="3134423">,</span>&nbsp;<span class="ident" id="3134425">sub</span>&nbsp;<span class="op" id="3134429">:=</span>&nbsp;<span class="keyword" id="3134432">range</span>&nbsp;<span class="ident" id="3134438">re</span><span class="op" id="3134440">.</span><span class="ident" id="3134441">Sub</span>&nbsp;<span class="op" id="3134445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134449">if</span>&nbsp;<span class="op" id="3134452">!</span><span class="ident" id="3134453">repeatIsValid</span><span class="op" id="3134466">(</span><span class="ident" id="3134467">sub</span><span class="op" id="3134470">,</span>&nbsp;<span class="ident" id="3134472">n</span><span class="op" id="3134473">)</span>&nbsp;<span class="op" id="3134475">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134480">return</span>&nbsp;<span class="builtintype" id="3134487">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3134495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3134498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134501">return</span>&nbsp;<span class="builtintype" id="3134508">true</span><br>
<span class="lineno"></span><span class="op" id="3134513">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span><span class="comment" id="3134516">//&nbsp;concat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;|&#39;&nbsp;or&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;concatenation.</span><br>
<span class="lineno"></span><span class="keyword" id="3134611">func</span>&nbsp;<span class="op" id="3134616">(</span><span class="ident" id="3134617">p</span>&nbsp;<span class="op" id="3134619">*</span><span class="ident" id="3134620">parser</span><span class="op" id="3134626">)</span>&nbsp;<span class="ident" id="3134628">concat</span><span class="op" id="3134634">(</span><span class="op" id="3134635">)</span>&nbsp;<span class="op" id="3134637">*</span><span class="ident" id="3134638">Regexp</span>&nbsp;<span class="op" id="3134645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3134648">p</span><span class="op" id="3134649">.</span><span class="ident" id="3134650">maybeConcat</span><span class="op" id="3134661">(</span><span class="op" id="3134662">-</span><span class="num" id="3134663">1</span><span class="op" id="3134664">,</span>&nbsp;<span class="num" id="3134666">0</span><span class="op" id="3134667">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3134671">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;|&nbsp;or&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3134717">i</span>&nbsp;<span class="op" id="3134719">:=</span>&nbsp;<span class="builtinfunc" id="3134722">len</span><span class="op" id="3134725">(</span><span class="ident" id="3134726">p</span><span class="op" id="3134727">.</span><span class="ident" id="3134728">stack</span><span class="op" id="3134733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134736">for</span>&nbsp;<span class="ident" id="3134740">i</span>&nbsp;<span class="op" id="3134742">&gt;</span>&nbsp;<span class="num" id="3134744">0</span>&nbsp;<span class="op" id="3134746">&amp;&amp;</span>&nbsp;<span class="ident" id="3134749">p</span><span class="op" id="3134750">.</span><span class="ident" id="3134751">stack</span><span class="op" id="3134756">[</span><span class="ident" id="3134757">i</span><span class="op" id="3134758">-</span><span class="num" id="3134759">1</span><span class="op" id="3134760">]</span><span class="op" id="3134761">.</span><span class="ident" id="3134762">Op</span>&nbsp;<span class="op" id="3134765">&lt;</span>&nbsp;<span class="ident" id="3134767">opPseudo</span>&nbsp;<span class="op" id="3134776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3134780">i</span><span class="op" id="3134781">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3134785">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3134788">subs</span>&nbsp;<span class="op" id="3134793">:=</span>&nbsp;<span class="ident" id="3134796">p</span><span class="op" id="3134797">.</span><span class="ident" id="3134798">stack</span><span class="op" id="3134803">[</span><span class="ident" id="3134804">i</span><span class="op" id="3134805">:</span><span class="op" id="3134806">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3134809">p</span><span class="op" id="3134810">.</span><span class="ident" id="3134811">stack</span>&nbsp;<span class="op" id="3134817">=</span>&nbsp;<span class="ident" id="3134819">p</span><span class="op" id="3134820">.</span><span class="ident" id="3134821">stack</span><span class="op" id="3134826">[</span><span class="op" id="3134827">:</span><span class="ident" id="3134828">i</span><span class="op" id="3134829">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3134833">//&nbsp;Empty&nbsp;concatenation&nbsp;is&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134874">if</span>&nbsp;<span class="builtinfunc" id="3134877">len</span><span class="op" id="3134880">(</span><span class="ident" id="3134881">subs</span><span class="op" id="3134885">)</span>&nbsp;<span class="op" id="3134887">==</span>&nbsp;<span class="num" id="3134890">0</span>&nbsp;<span class="op" id="3134892">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134896">return</span>&nbsp;<span class="ident" id="3134903">p</span><span class="op" id="3134904">.</span><span class="ident" id="3134905">push</span><span class="op" id="3134909">(</span><span class="ident" id="3134910">p</span><span class="op" id="3134911">.</span><span class="ident" id="3134912">newRegexp</span><span class="op" id="3134921">(</span><span class="ident" id="3134922">OpEmptyMatch</span><span class="op" id="3134934">)</span><span class="op" id="3134935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3134938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3134942">return</span>&nbsp;<span class="ident" id="3134949">p</span><span class="op" id="3134950">.</span><span class="ident" id="3134951">push</span><span class="op" id="3134955">(</span><span class="ident" id="3134956">p</span><span class="op" id="3134957">.</span><span class="ident" id="3134958">collapse</span><span class="op" id="3134966">(</span><span class="ident" id="3134967">subs</span><span class="op" id="3134971">,</span>&nbsp;<span class="ident" id="3134973">OpConcat</span><span class="op" id="3134981">)</span><span class="op" id="3134982">)</span><br>
<span class="lineno"></span><span class="op" id="3134984">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="3134987">//&nbsp;alternate&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="3135076">func</span>&nbsp;<span class="op" id="3135081">(</span><span class="ident" id="3135082">p</span>&nbsp;<span class="op" id="3135084">*</span><span class="ident" id="3135085">parser</span><span class="op" id="3135091">)</span>&nbsp;<span class="ident" id="3135093">alternate</span><span class="op" id="3135102">(</span><span class="op" id="3135103">)</span>&nbsp;<span class="op" id="3135105">*</span><span class="ident" id="3135106">Regexp</span>&nbsp;<span class="op" id="3135113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3135116">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3135157">//&nbsp;There&nbsp;are&nbsp;no&nbsp;|&nbsp;above&nbsp;(.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3135185">i</span>&nbsp;<span class="op" id="3135187">:=</span>&nbsp;<span class="builtinfunc" id="3135190">len</span><span class="op" id="3135193">(</span><span class="ident" id="3135194">p</span><span class="op" id="3135195">.</span><span class="ident" id="3135196">stack</span><span class="op" id="3135201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135204">for</span>&nbsp;<span class="ident" id="3135208">i</span>&nbsp;<span class="op" id="3135210">&gt;</span>&nbsp;<span class="num" id="3135212">0</span>&nbsp;<span class="op" id="3135214">&amp;&amp;</span>&nbsp;<span class="ident" id="3135217">p</span><span class="op" id="3135218">.</span><span class="ident" id="3135219">stack</span><span class="op" id="3135224">[</span><span class="ident" id="3135225">i</span><span class="op" id="3135226">-</span><span class="num" id="3135227">1</span><span class="op" id="3135228">]</span><span class="op" id="3135229">.</span><span class="ident" id="3135230">Op</span>&nbsp;<span class="op" id="3135233">&lt;</span>&nbsp;<span class="ident" id="3135235">opPseudo</span>&nbsp;<span class="op" id="3135244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3135248">i</span><span class="op" id="3135249">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3135253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3135256">subs</span>&nbsp;<span class="op" id="3135261">:=</span>&nbsp;<span class="ident" id="3135264">p</span><span class="op" id="3135265">.</span><span class="ident" id="3135266">stack</span><span class="op" id="3135271">[</span><span class="ident" id="3135272">i</span><span class="op" id="3135273">:</span><span class="op" id="3135274">]</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3135277">p</span><span class="op" id="3135278">.</span><span class="ident" id="3135279">stack</span>&nbsp;<span class="op" id="3135285">=</span>&nbsp;<span class="ident" id="3135287">p</span><span class="op" id="3135288">.</span><span class="ident" id="3135289">stack</span><span class="op" id="3135294">[</span><span class="op" id="3135295">:</span><span class="ident" id="3135296">i</span><span class="op" id="3135297">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3135301">//&nbsp;Make&nbsp;sure&nbsp;top&nbsp;class&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3135335">//&nbsp;All&nbsp;the&nbsp;others&nbsp;already&nbsp;are&nbsp;(see&nbsp;swapVerticalBar).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135389">if</span>&nbsp;<span class="builtinfunc" id="3135392">len</span><span class="op" id="3135395">(</span><span class="ident" id="3135396">subs</span><span class="op" id="3135400">)</span>&nbsp;<span class="op" id="3135402">&gt;</span>&nbsp;<span class="num" id="3135404">0</span>&nbsp;<span class="op" id="3135406">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3135410">cleanAlt</span><span class="op" id="3135418">(</span><span class="ident" id="3135419">subs</span><span class="op" id="3135423">[</span><span class="builtinfunc" id="3135424">len</span><span class="op" id="3135427">(</span><span class="ident" id="3135428">subs</span><span class="op" id="3135432">)</span><span class="op" id="3135433">-</span><span class="num" id="3135434">1</span><span class="op" id="3135435">]</span><span class="op" id="3135436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3135439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3135443">//&nbsp;Empty&nbsp;alternate&nbsp;is&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3135479">//&nbsp;(shouldn&#39;t&nbsp;happen&nbsp;but&nbsp;easy&nbsp;to&nbsp;handle).</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135522">if</span>&nbsp;<span class="builtinfunc" id="3135525">len</span><span class="op" id="3135528">(</span><span class="ident" id="3135529">subs</span><span class="op" id="3135533">)</span>&nbsp;<span class="op" id="3135535">==</span>&nbsp;<span class="num" id="3135538">0</span>&nbsp;<span class="op" id="3135540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135544">return</span>&nbsp;<span class="ident" id="3135551">p</span><span class="op" id="3135552">.</span><span class="ident" id="3135553">push</span><span class="op" id="3135557">(</span><span class="ident" id="3135558">p</span><span class="op" id="3135559">.</span><span class="ident" id="3135560">newRegexp</span><span class="op" id="3135569">(</span><span class="ident" id="3135570">OpNoMatch</span><span class="op" id="3135579">)</span><span class="op" id="3135580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3135583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135587">return</span>&nbsp;<span class="ident" id="3135594">p</span><span class="op" id="3135595">.</span><span class="ident" id="3135596">push</span><span class="op" id="3135600">(</span><span class="ident" id="3135601">p</span><span class="op" id="3135602">.</span><span class="ident" id="3135603">collapse</span><span class="op" id="3135611">(</span><span class="ident" id="3135612">subs</span><span class="op" id="3135616">,</span>&nbsp;<span class="ident" id="3135618">OpAlternate</span><span class="op" id="3135629">)</span><span class="op" id="3135630">)</span><br>
<span class="lineno">340</span><span class="op" id="3135632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3135635">//&nbsp;cleanAlt&nbsp;cleans&nbsp;re&nbsp;for&nbsp;eventual&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="3135699">func</span>&nbsp;<span class="ident" id="3135704">cleanAlt</span><span class="op" id="3135712">(</span><span class="ident" id="3135713">re</span>&nbsp;<span class="op" id="3135716">*</span><span class="ident" id="3135717">Regexp</span><span class="op" id="3135723">)</span>&nbsp;<span class="op" id="3135725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135728">switch</span>&nbsp;<span class="ident" id="3135735">re</span><span class="op" id="3135737">.</span><span class="ident" id="3135738">Op</span>&nbsp;<span class="op" id="3135741">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135744">case</span>&nbsp;<span class="ident" id="3135749">OpCharClass</span><span class="op" id="3135760">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3135764">re</span><span class="op" id="3135766">.</span><span class="ident" id="3135767">Rune</span>&nbsp;<span class="op" id="3135772">=</span>&nbsp;<span class="ident" id="3135774">cleanClass</span><span class="op" id="3135784">(</span><span class="op" id="3135785">&amp;</span><span class="ident" id="3135786">re</span><span class="op" id="3135788">.</span><span class="ident" id="3135789">Rune</span><span class="op" id="3135793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135797">if</span>&nbsp;<span class="builtinfunc" id="3135800">len</span><span class="op" id="3135803">(</span><span class="ident" id="3135804">re</span><span class="op" id="3135806">.</span><span class="ident" id="3135807">Rune</span><span class="op" id="3135811">)</span>&nbsp;<span class="op" id="3135813">==</span>&nbsp;<span class="num" id="3135816">2</span>&nbsp;<span class="op" id="3135818">&amp;&amp;</span>&nbsp;<span class="ident" id="3135821">re</span><span class="op" id="3135823">.</span><span class="ident" id="3135824">Rune</span><span class="op" id="3135828">[</span><span class="num" id="3135829">0</span><span class="op" id="3135830">]</span>&nbsp;<span class="op" id="3135832">==</span>&nbsp;<span class="num" id="3135835">0</span>&nbsp;<span class="op" id="3135837">&amp;&amp;</span>&nbsp;<span class="ident" id="3135840">re</span><span class="op" id="3135842">.</span><span class="ident" id="3135843">Rune</span><span class="op" id="3135847">[</span><span class="num" id="3135848">1</span><span class="op" id="3135849">]</span>&nbsp;<span class="op" id="3135851">==</span>&nbsp;<span class="ident" id="3135854">unicode</span><span class="op" id="3135861">.</span><span class="ident" id="3135862">MaxRune</span>&nbsp;<span class="op" id="3135870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3135875">re</span><span class="op" id="3135877">.</span><span class="ident" id="3135878">Rune</span>&nbsp;<span class="op" id="3135883">=</span>&nbsp;<span class="ident" id="3135885">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3135892">re</span><span class="op" id="3135894">.</span><span class="ident" id="3135895">Op</span>&nbsp;<span class="op" id="3135898">=</span>&nbsp;<span class="ident" id="3135900">OpAnyChar</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135913">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3135922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3135926">if</span>&nbsp;<span class="builtinfunc" id="3135929">len</span><span class="op" id="3135932">(</span><span class="ident" id="3135933">re</span><span class="op" id="3135935">.</span><span class="ident" id="3135936">Rune</span><span class="op" id="3135940">)</span>&nbsp;<span class="op" id="3135942">==</span>&nbsp;<span class="num" id="3135945">4</span>&nbsp;<span class="op" id="3135947">&amp;&amp;</span>&nbsp;<span class="ident" id="3135950">re</span><span class="op" id="3135952">.</span><span class="ident" id="3135953">Rune</span><span class="op" id="3135957">[</span><span class="num" id="3135958">0</span><span class="op" id="3135959">]</span>&nbsp;<span class="op" id="3135961">==</span>&nbsp;<span class="num" id="3135964">0</span>&nbsp;<span class="op" id="3135966">&amp;&amp;</span>&nbsp;<span class="ident" id="3135969">re</span><span class="op" id="3135971">.</span><span class="ident" id="3135972">Rune</span><span class="op" id="3135976">[</span><span class="num" id="3135977">1</span><span class="op" id="3135978">]</span>&nbsp;<span class="op" id="3135980">==</span>&nbsp;<span class="string" id="3135983">&#39;\n&#39;</span><span class="op" id="3135987">-</span><span class="num" id="3135988">1</span>&nbsp;<span class="op" id="3135990">&amp;&amp;</span>&nbsp;<span class="ident" id="3135993">re</span><span class="op" id="3135995">.</span><span class="ident" id="3135996">Rune</span><span class="op" id="3136000">[</span><span class="num" id="3136001">2</span><span class="op" id="3136002">]</span>&nbsp;<span class="op" id="3136004">==</span>&nbsp;<span class="string" id="3136007">&#39;\n&#39;</span><span class="op" id="3136011">+</span><span class="num" id="3136012">1</span>&nbsp;<span class="op" id="3136014">&amp;&amp;</span>&nbsp;<span class="ident" id="3136017">re</span><span class="op" id="3136019">.</span><span class="ident" id="3136020">Rune</span><span class="op" id="3136024">[</span><span class="num" id="3136025">3</span><span class="op" id="3136026">]</span>&nbsp;<span class="op" id="3136028">==</span>&nbsp;<span class="ident" id="3136031">unicode</span><span class="op" id="3136038">.</span><span class="ident" id="3136039">MaxRune</span>&nbsp;<span class="op" id="3136047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136052">re</span><span class="op" id="3136054">.</span><span class="ident" id="3136055">Rune</span>&nbsp;<span class="op" id="3136060">=</span>&nbsp;<span class="ident" id="3136062">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136069">re</span><span class="op" id="3136071">.</span><span class="ident" id="3136072">Op</span>&nbsp;<span class="op" id="3136075">=</span>&nbsp;<span class="ident" id="3136077">OpAnyCharNotNL</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136095">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3136104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136108">if</span>&nbsp;<span class="builtinfunc" id="3136111">cap</span><span class="op" id="3136114">(</span><span class="ident" id="3136115">re</span><span class="op" id="3136117">.</span><span class="ident" id="3136118">Rune</span><span class="op" id="3136122">)</span><span class="op" id="3136123">-</span><span class="builtinfunc" id="3136124">len</span><span class="op" id="3136127">(</span><span class="ident" id="3136128">re</span><span class="op" id="3136130">.</span><span class="ident" id="3136131">Rune</span><span class="op" id="3136135">)</span>&nbsp;<span class="op" id="3136137">&gt;</span>&nbsp;<span class="num" id="3136139">100</span>&nbsp;<span class="op" id="3136143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3136148">//&nbsp;re.Rune&nbsp;will&nbsp;not&nbsp;grow&nbsp;any&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3136186">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;or&nbsp;inline&nbsp;to&nbsp;reclaim&nbsp;storage.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136234">re</span><span class="op" id="3136236">.</span><span class="ident" id="3136237">Rune</span>&nbsp;<span class="op" id="3136242">=</span>&nbsp;<span class="builtinfunc" id="3136244">append</span><span class="op" id="3136250">(</span><span class="ident" id="3136251">re</span><span class="op" id="3136253">.</span><span class="ident" id="3136254">Rune0</span><span class="op" id="3136259">[</span><span class="op" id="3136260">:</span><span class="num" id="3136261">0</span><span class="op" id="3136262">]</span><span class="op" id="3136263">,</span>&nbsp;<span class="ident" id="3136265">re</span><span class="op" id="3136267">.</span><span class="ident" id="3136268">Rune</span><span class="op" id="3136272">...</span><span class="op" id="3136275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3136279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3136282">}</span><br>
<span class="lineno"></span><span class="op" id="3136284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="3136287">//&nbsp;collapse&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;applying&nbsp;op&nbsp;to&nbsp;sub.</span><br>
<span class="lineno"></span><span class="comment" id="3136341">//&nbsp;If&nbsp;sub&nbsp;contains&nbsp;op&nbsp;nodes,&nbsp;they&nbsp;all&nbsp;get&nbsp;hoisted&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="3136394">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;never&nbsp;a&nbsp;concat&nbsp;of&nbsp;a&nbsp;concat&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3136447">//&nbsp;alternate&nbsp;of&nbsp;an&nbsp;alternate.</span><br>
<span class="lineno"></span><span class="keyword" id="3136477">func</span>&nbsp;<span class="op" id="3136482">(</span><span class="ident" id="3136483">p</span>&nbsp;<span class="op" id="3136485">*</span><span class="ident" id="3136486">parser</span><span class="op" id="3136492">)</span>&nbsp;<span class="ident" id="3136494">collapse</span><span class="op" id="3136502">(</span><span class="ident" id="3136503">subs</span>&nbsp;<span class="op" id="3136508">[</span><span class="op" id="3136509">]</span><span class="op" id="3136510">*</span><span class="ident" id="3136511">Regexp</span><span class="op" id="3136517">,</span>&nbsp;<span class="ident" id="3136519">op</span>&nbsp;<span class="ident" id="3136522">Op</span><span class="op" id="3136524">)</span>&nbsp;<span class="op" id="3136526">*</span><span class="ident" id="3136527">Regexp</span>&nbsp;<span class="op" id="3136534">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136537">if</span>&nbsp;<span class="builtinfunc" id="3136540">len</span><span class="op" id="3136543">(</span><span class="ident" id="3136544">subs</span><span class="op" id="3136548">)</span>&nbsp;<span class="op" id="3136550">==</span>&nbsp;<span class="num" id="3136553">1</span>&nbsp;<span class="op" id="3136555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136559">return</span>&nbsp;<span class="ident" id="3136566">subs</span><span class="op" id="3136570">[</span><span class="num" id="3136571">0</span><span class="op" id="3136572">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3136575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136578">re</span>&nbsp;<span class="op" id="3136581">:=</span>&nbsp;<span class="ident" id="3136584">p</span><span class="op" id="3136585">.</span><span class="ident" id="3136586">newRegexp</span><span class="op" id="3136595">(</span><span class="ident" id="3136596">op</span><span class="op" id="3136598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136601">re</span><span class="op" id="3136603">.</span><span class="ident" id="3136604">Sub</span>&nbsp;<span class="op" id="3136608">=</span>&nbsp;<span class="ident" id="3136610">re</span><span class="op" id="3136612">.</span><span class="ident" id="3136613">Sub0</span><span class="op" id="3136617">[</span><span class="op" id="3136618">:</span><span class="num" id="3136619">0</span><span class="op" id="3136620">]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136623">for</span>&nbsp;<span class="ident" id="3136627">_</span><span class="op" id="3136628">,</span>&nbsp;<span class="ident" id="3136630">sub</span>&nbsp;<span class="op" id="3136634">:=</span>&nbsp;<span class="keyword" id="3136637">range</span>&nbsp;<span class="ident" id="3136643">subs</span>&nbsp;<span class="op" id="3136648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136652">if</span>&nbsp;<span class="ident" id="3136655">sub</span><span class="op" id="3136658">.</span><span class="ident" id="3136659">Op</span>&nbsp;<span class="op" id="3136662">==</span>&nbsp;<span class="ident" id="3136665">op</span>&nbsp;<span class="op" id="3136668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136673">re</span><span class="op" id="3136675">.</span><span class="ident" id="3136676">Sub</span>&nbsp;<span class="op" id="3136680">=</span>&nbsp;<span class="builtinfunc" id="3136682">append</span><span class="op" id="3136688">(</span><span class="ident" id="3136689">re</span><span class="op" id="3136691">.</span><span class="ident" id="3136692">Sub</span><span class="op" id="3136695">,</span>&nbsp;<span class="ident" id="3136697">sub</span><span class="op" id="3136700">.</span><span class="ident" id="3136701">Sub</span><span class="op" id="3136704">...</span><span class="op" id="3136707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136712">p</span><span class="op" id="3136713">.</span><span class="ident" id="3136714">reuse</span><span class="op" id="3136719">(</span><span class="ident" id="3136720">sub</span><span class="op" id="3136723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3136727">}</span>&nbsp;<span class="keyword" id="3136729">else</span>&nbsp;<span class="op" id="3136734">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136739">re</span><span class="op" id="3136741">.</span><span class="ident" id="3136742">Sub</span>&nbsp;<span class="op" id="3136746">=</span>&nbsp;<span class="builtinfunc" id="3136748">append</span><span class="op" id="3136754">(</span><span class="ident" id="3136755">re</span><span class="op" id="3136757">.</span><span class="ident" id="3136758">Sub</span><span class="op" id="3136761">,</span>&nbsp;<span class="ident" id="3136763">sub</span><span class="op" id="3136766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3136770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3136773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136776">if</span>&nbsp;<span class="ident" id="3136779">op</span>&nbsp;<span class="op" id="3136782">==</span>&nbsp;<span class="ident" id="3136785">OpAlternate</span>&nbsp;<span class="op" id="3136797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136801">re</span><span class="op" id="3136803">.</span><span class="ident" id="3136804">Sub</span>&nbsp;<span class="op" id="3136808">=</span>&nbsp;<span class="ident" id="3136810">p</span><span class="op" id="3136811">.</span><span class="ident" id="3136812">factor</span><span class="op" id="3136818">(</span><span class="ident" id="3136819">re</span><span class="op" id="3136821">.</span><span class="ident" id="3136822">Sub</span><span class="op" id="3136825">,</span>&nbsp;<span class="ident" id="3136827">re</span><span class="op" id="3136829">.</span><span class="ident" id="3136830">Flags</span><span class="op" id="3136835">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136839">if</span>&nbsp;<span class="builtinfunc" id="3136842">len</span><span class="op" id="3136845">(</span><span class="ident" id="3136846">re</span><span class="op" id="3136848">.</span><span class="ident" id="3136849">Sub</span><span class="op" id="3136852">)</span>&nbsp;<span class="op" id="3136854">==</span>&nbsp;<span class="num" id="3136857">1</span>&nbsp;<span class="op" id="3136859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136864">old</span>&nbsp;<span class="op" id="3136868">:=</span>&nbsp;<span class="ident" id="3136871">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136877">re</span>&nbsp;<span class="op" id="3136880">=</span>&nbsp;<span class="ident" id="3136882">re</span><span class="op" id="3136884">.</span><span class="ident" id="3136885">Sub</span><span class="op" id="3136888">[</span><span class="num" id="3136889">0</span><span class="op" id="3136890">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3136895">p</span><span class="op" id="3136896">.</span><span class="ident" id="3136897">reuse</span><span class="op" id="3136902">(</span><span class="ident" id="3136903">old</span><span class="op" id="3136906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3136910">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3136913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3136916">return</span>&nbsp;<span class="ident" id="3136923">re</span><br>
<span class="lineno"></span><span class="op" id="3136926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3136929">//&nbsp;factor&nbsp;factors&nbsp;common&nbsp;prefixes&nbsp;from&nbsp;the&nbsp;alternation&nbsp;list&nbsp;sub.</span><br>
<span class="lineno">395</span><span class="comment" id="3136994">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;replacement&nbsp;list&nbsp;that&nbsp;reuses&nbsp;the&nbsp;same&nbsp;storage&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3137060">//&nbsp;frees&nbsp;(passes&nbsp;to&nbsp;p.reuse)&nbsp;any&nbsp;removed&nbsp;*Regexps.</span><br>
<span class="lineno"></span><span class="comment" id="3137111">//</span><br>
<span class="lineno"></span><span class="comment" id="3137114">//&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="3137130">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ABC|ABD|AEF|BCX|BCY</span><br>
<span class="lineno">400</span><span class="comment" id="3137157">//&nbsp;simplifies&nbsp;by&nbsp;literal&nbsp;prefix&nbsp;extraction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3137203">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B(C|D)|EF)|BC(X|Y)</span><br>
<span class="lineno"></span><span class="comment" id="3137231">//&nbsp;which&nbsp;simplifies&nbsp;by&nbsp;character&nbsp;class&nbsp;introduction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3137286">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B[CD]|EF)|BC[XY]</span><br>
<span class="lineno"></span><span class="comment" id="3137312">//</span><br>
<span class="lineno">405</span><span class="keyword" id="3137315">func</span>&nbsp;<span class="op" id="3137320">(</span><span class="ident" id="3137321">p</span>&nbsp;<span class="op" id="3137323">*</span><span class="ident" id="3137324">parser</span><span class="op" id="3137330">)</span>&nbsp;<span class="ident" id="3137332">factor</span><span class="op" id="3137338">(</span><span class="ident" id="3137339">sub</span>&nbsp;<span class="op" id="3137343">[</span><span class="op" id="3137344">]</span><span class="op" id="3137345">*</span><span class="ident" id="3137346">Regexp</span><span class="op" id="3137352">,</span>&nbsp;<span class="ident" id="3137354">flags</span>&nbsp;<span class="ident" id="3137360">Flags</span><span class="op" id="3137365">)</span>&nbsp;<span class="op" id="3137367">[</span><span class="op" id="3137368">]</span><span class="op" id="3137369">*</span><span class="ident" id="3137370">Regexp</span>&nbsp;<span class="op" id="3137377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137380">if</span>&nbsp;<span class="builtinfunc" id="3137383">len</span><span class="op" id="3137386">(</span><span class="ident" id="3137387">sub</span><span class="op" id="3137390">)</span>&nbsp;<span class="op" id="3137392">&lt;</span>&nbsp;<span class="num" id="3137394">2</span>&nbsp;<span class="op" id="3137396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137400">return</span>&nbsp;<span class="ident" id="3137407">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3137412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3137416">//&nbsp;Round&nbsp;1:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;literal&nbsp;prefixes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137465">var</span>&nbsp;<span class="ident" id="3137469">str</span>&nbsp;<span class="op" id="3137473">[</span><span class="op" id="3137474">]</span><span class="builtintype" id="3137475">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137481">var</span>&nbsp;<span class="ident" id="3137485">strflags</span>&nbsp;<span class="ident" id="3137494">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137501">start</span>&nbsp;<span class="op" id="3137507">:=</span>&nbsp;<span class="num" id="3137510">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137513">out</span>&nbsp;<span class="op" id="3137517">:=</span>&nbsp;<span class="ident" id="3137520">sub</span><span class="op" id="3137523">[</span><span class="op" id="3137524">:</span><span class="num" id="3137525">0</span><span class="op" id="3137526">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137529">for</span>&nbsp;<span class="ident" id="3137533">i</span>&nbsp;<span class="op" id="3137535">:=</span>&nbsp;<span class="num" id="3137538">0</span><span class="op" id="3137539">;</span>&nbsp;<span class="ident" id="3137541">i</span>&nbsp;<span class="op" id="3137543">&lt;=</span>&nbsp;<span class="builtinfunc" id="3137546">len</span><span class="op" id="3137549">(</span><span class="ident" id="3137550">sub</span><span class="op" id="3137553">)</span><span class="op" id="3137554">;</span>&nbsp;<span class="ident" id="3137556">i</span><span class="op" id="3137557">++</span>&nbsp;<span class="op" id="3137560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3137564">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3137628">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3137695">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3137729">//</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3137734">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3137798">//&nbsp;with&nbsp;str&nbsp;as&nbsp;modified&nbsp;by&nbsp;strflags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137837">var</span>&nbsp;<span class="ident" id="3137841">istr</span>&nbsp;<span class="op" id="3137846">[</span><span class="op" id="3137847">]</span><span class="builtintype" id="3137848">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137855">var</span>&nbsp;<span class="ident" id="3137859">iflags</span>&nbsp;<span class="ident" id="3137866">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137874">if</span>&nbsp;<span class="ident" id="3137877">i</span>&nbsp;<span class="op" id="3137879">&lt;</span>&nbsp;<span class="builtinfunc" id="3137881">len</span><span class="op" id="3137884">(</span><span class="ident" id="3137885">sub</span><span class="op" id="3137888">)</span>&nbsp;<span class="op" id="3137890">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137895">istr</span><span class="op" id="3137899">,</span>&nbsp;<span class="ident" id="3137901">iflags</span>&nbsp;<span class="op" id="3137908">=</span>&nbsp;<span class="ident" id="3137910">p</span><span class="op" id="3137911">.</span><span class="ident" id="3137912">leadingString</span><span class="op" id="3137925">(</span><span class="ident" id="3137926">sub</span><span class="op" id="3137929">[</span><span class="ident" id="3137930">i</span><span class="op" id="3137931">]</span><span class="op" id="3137932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137937">if</span>&nbsp;<span class="ident" id="3137940">iflags</span>&nbsp;<span class="op" id="3137947">==</span>&nbsp;<span class="ident" id="3137950">strflags</span>&nbsp;<span class="op" id="3137959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3137965">same</span>&nbsp;<span class="op" id="3137970">:=</span>&nbsp;<span class="num" id="3137973">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3137979">for</span>&nbsp;<span class="ident" id="3137983">same</span>&nbsp;<span class="op" id="3137988">&lt;</span>&nbsp;<span class="builtinfunc" id="3137990">len</span><span class="op" id="3137993">(</span><span class="ident" id="3137994">str</span><span class="op" id="3137997">)</span>&nbsp;<span class="op" id="3137999">&amp;&amp;</span>&nbsp;<span class="ident" id="3138002">same</span>&nbsp;<span class="op" id="3138007">&lt;</span>&nbsp;<span class="builtinfunc" id="3138009">len</span><span class="op" id="3138012">(</span><span class="ident" id="3138013">istr</span><span class="op" id="3138017">)</span>&nbsp;<span class="op" id="3138019">&amp;&amp;</span>&nbsp;<span class="ident" id="3138022">str</span><span class="op" id="3138025">[</span><span class="ident" id="3138026">same</span><span class="op" id="3138030">]</span>&nbsp;<span class="op" id="3138032">==</span>&nbsp;<span class="ident" id="3138035">istr</span><span class="op" id="3138039">[</span><span class="ident" id="3138040">same</span><span class="op" id="3138044">]</span>&nbsp;<span class="op" id="3138046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138053">same</span><span class="op" id="3138057">++</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138070">if</span>&nbsp;<span class="ident" id="3138073">same</span>&nbsp;<span class="op" id="3138078">&gt;</span>&nbsp;<span class="num" id="3138080">0</span>&nbsp;<span class="op" id="3138082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138089">//&nbsp;Matches&nbsp;at&nbsp;least&nbsp;one&nbsp;rune&nbsp;in&nbsp;current&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138141">//&nbsp;Keep&nbsp;going&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138168">str</span>&nbsp;<span class="op" id="3138172">=</span>&nbsp;<span class="ident" id="3138174">str</span><span class="op" id="3138177">[</span><span class="op" id="3138178">:</span><span class="ident" id="3138179">same</span><span class="op" id="3138183">]</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138190">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138217">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;literal&nbsp;string:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138277">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;str[0:len(str)],&nbsp;but&nbsp;sub[i]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138338">//&nbsp;does&nbsp;not&nbsp;even&nbsp;begin&nbsp;with&nbsp;str[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138376">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138381">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;string&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138450">if</span>&nbsp;<span class="ident" id="3138453">i</span>&nbsp;<span class="op" id="3138455">==</span>&nbsp;<span class="ident" id="3138458">start</span>&nbsp;<span class="op" id="3138464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138469">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138507">}</span>&nbsp;<span class="keyword" id="3138509">else</span>&nbsp;<span class="keyword" id="3138514">if</span>&nbsp;<span class="ident" id="3138517">i</span>&nbsp;<span class="op" id="3138519">==</span>&nbsp;<span class="ident" id="3138522">start</span><span class="op" id="3138527">+</span><span class="num" id="3138528">1</span>&nbsp;<span class="op" id="3138530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138535">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138575">out</span>&nbsp;<span class="op" id="3138579">=</span>&nbsp;<span class="builtinfunc" id="3138581">append</span><span class="op" id="3138587">(</span><span class="ident" id="3138588">out</span><span class="op" id="3138591">,</span>&nbsp;<span class="ident" id="3138593">sub</span><span class="op" id="3138596">[</span><span class="ident" id="3138597">start</span><span class="op" id="3138602">]</span><span class="op" id="3138603">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138607">}</span>&nbsp;<span class="keyword" id="3138609">else</span>&nbsp;<span class="op" id="3138614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3138619">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138678">prefix</span>&nbsp;<span class="op" id="3138685">:=</span>&nbsp;<span class="ident" id="3138688">p</span><span class="op" id="3138689">.</span><span class="ident" id="3138690">newRegexp</span><span class="op" id="3138699">(</span><span class="ident" id="3138700">OpLiteral</span><span class="op" id="3138709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138714">prefix</span><span class="op" id="3138720">.</span><span class="ident" id="3138721">Flags</span>&nbsp;<span class="op" id="3138727">=</span>&nbsp;<span class="ident" id="3138729">strflags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138741">prefix</span><span class="op" id="3138747">.</span><span class="ident" id="3138748">Rune</span>&nbsp;<span class="op" id="3138753">=</span>&nbsp;<span class="builtinfunc" id="3138755">append</span><span class="op" id="3138761">(</span><span class="ident" id="3138762">prefix</span><span class="op" id="3138768">.</span><span class="ident" id="3138769">Rune</span><span class="op" id="3138773">[</span><span class="op" id="3138774">:</span><span class="num" id="3138775">0</span><span class="op" id="3138776">]</span><span class="op" id="3138777">,</span>&nbsp;<span class="ident" id="3138779">str</span><span class="op" id="3138782">...</span><span class="op" id="3138785">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3138791">for</span>&nbsp;<span class="ident" id="3138795">j</span>&nbsp;<span class="op" id="3138797">:=</span>&nbsp;<span class="ident" id="3138800">start</span><span class="op" id="3138805">;</span>&nbsp;<span class="ident" id="3138807">j</span>&nbsp;<span class="op" id="3138809">&lt;</span>&nbsp;<span class="ident" id="3138811">i</span><span class="op" id="3138812">;</span>&nbsp;<span class="ident" id="3138814">j</span><span class="op" id="3138815">++</span>&nbsp;<span class="op" id="3138818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138824">sub</span><span class="op" id="3138827">[</span><span class="ident" id="3138828">j</span><span class="op" id="3138829">]</span>&nbsp;<span class="op" id="3138831">=</span>&nbsp;<span class="ident" id="3138833">p</span><span class="op" id="3138834">.</span><span class="ident" id="3138835">removeLeadingString</span><span class="op" id="3138854">(</span><span class="ident" id="3138855">sub</span><span class="op" id="3138858">[</span><span class="ident" id="3138859">j</span><span class="op" id="3138860">]</span><span class="op" id="3138861">,</span>&nbsp;<span class="builtinfunc" id="3138863">len</span><span class="op" id="3138866">(</span><span class="ident" id="3138867">str</span><span class="op" id="3138870">)</span><span class="op" id="3138871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3138876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138881">suffix</span>&nbsp;<span class="op" id="3138888">:=</span>&nbsp;<span class="ident" id="3138891">p</span><span class="op" id="3138892">.</span><span class="ident" id="3138893">collapse</span><span class="op" id="3138901">(</span><span class="ident" id="3138902">sub</span><span class="op" id="3138905">[</span><span class="ident" id="3138906">start</span><span class="op" id="3138911">:</span><span class="ident" id="3138912">i</span><span class="op" id="3138913">]</span><span class="op" id="3138914">,</span>&nbsp;<span class="ident" id="3138916">OpAlternate</span><span class="op" id="3138927">)</span>&nbsp;<span class="comment" id="3138929">//&nbsp;recurse</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138944">re</span>&nbsp;<span class="op" id="3138947">:=</span>&nbsp;<span class="ident" id="3138950">p</span><span class="op" id="3138951">.</span><span class="ident" id="3138952">newRegexp</span><span class="op" id="3138961">(</span><span class="ident" id="3138962">OpConcat</span><span class="op" id="3138970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3138975">re</span><span class="op" id="3138977">.</span><span class="ident" id="3138978">Sub</span>&nbsp;<span class="op" id="3138982">=</span>&nbsp;<span class="builtinfunc" id="3138984">append</span><span class="op" id="3138990">(</span><span class="ident" id="3138991">re</span><span class="op" id="3138993">.</span><span class="ident" id="3138994">Sub</span><span class="op" id="3138997">[</span><span class="op" id="3138998">:</span><span class="num" id="3138999">0</span><span class="op" id="3139000">]</span><span class="op" id="3139001">,</span>&nbsp;<span class="ident" id="3139003">prefix</span><span class="op" id="3139009">,</span>&nbsp;<span class="ident" id="3139011">suffix</span><span class="op" id="3139017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139022">out</span>&nbsp;<span class="op" id="3139026">=</span>&nbsp;<span class="builtinfunc" id="3139028">append</span><span class="op" id="3139034">(</span><span class="ident" id="3139035">out</span><span class="op" id="3139038">,</span>&nbsp;<span class="ident" id="3139040">re</span><span class="op" id="3139042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139046">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139051">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139084">start</span>&nbsp;<span class="op" id="3139090">=</span>&nbsp;<span class="ident" id="3139092">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139096">str</span>&nbsp;<span class="op" id="3139100">=</span>&nbsp;<span class="ident" id="3139102">istr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139109">strflags</span>&nbsp;<span class="op" id="3139118">=</span>&nbsp;<span class="ident" id="3139120">iflags</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139131">sub</span>&nbsp;<span class="op" id="3139135">=</span>&nbsp;<span class="ident" id="3139137">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139143">//&nbsp;Round&nbsp;2:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;complex&nbsp;prefixes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139192">//&nbsp;just&nbsp;the&nbsp;first&nbsp;piece&nbsp;of&nbsp;each&nbsp;concatenation,</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139240">//&nbsp;whatever&nbsp;it&nbsp;is.&nbsp;&nbsp;This&nbsp;is&nbsp;good&nbsp;enough&nbsp;a&nbsp;lot&nbsp;of&nbsp;the&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139300">start</span>&nbsp;<span class="op" id="3139306">=</span>&nbsp;<span class="num" id="3139308">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139311">out</span>&nbsp;<span class="op" id="3139315">=</span>&nbsp;<span class="ident" id="3139317">sub</span><span class="op" id="3139320">[</span><span class="op" id="3139321">:</span><span class="num" id="3139322">0</span><span class="op" id="3139323">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139326">var</span>&nbsp;<span class="ident" id="3139330">first</span>&nbsp;<span class="op" id="3139336">*</span><span class="ident" id="3139337">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139345">for</span>&nbsp;<span class="ident" id="3139349">i</span>&nbsp;<span class="op" id="3139351">:=</span>&nbsp;<span class="num" id="3139354">0</span><span class="op" id="3139355">;</span>&nbsp;<span class="ident" id="3139357">i</span>&nbsp;<span class="op" id="3139359">&lt;=</span>&nbsp;<span class="builtinfunc" id="3139362">len</span><span class="op" id="3139365">(</span><span class="ident" id="3139366">sub</span><span class="op" id="3139369">)</span><span class="op" id="3139370">;</span>&nbsp;<span class="ident" id="3139372">i</span><span class="op" id="3139373">++</span>&nbsp;<span class="op" id="3139376">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139380">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139444">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139511">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139545">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139550">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin&nbsp;with&nbsp;ifirst.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139627">var</span>&nbsp;<span class="ident" id="3139631">ifirst</span>&nbsp;<span class="op" id="3139638">*</span><span class="ident" id="3139639">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139648">if</span>&nbsp;<span class="ident" id="3139651">i</span>&nbsp;<span class="op" id="3139653">&lt;</span>&nbsp;<span class="builtinfunc" id="3139655">len</span><span class="op" id="3139658">(</span><span class="ident" id="3139659">sub</span><span class="op" id="3139662">)</span>&nbsp;<span class="op" id="3139664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3139669">ifirst</span>&nbsp;<span class="op" id="3139676">=</span>&nbsp;<span class="ident" id="3139678">p</span><span class="op" id="3139679">.</span><span class="ident" id="3139680">leadingRegexp</span><span class="op" id="3139693">(</span><span class="ident" id="3139694">sub</span><span class="op" id="3139697">[</span><span class="ident" id="3139698">i</span><span class="op" id="3139699">]</span><span class="op" id="3139700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139705">if</span>&nbsp;<span class="ident" id="3139708">first</span>&nbsp;<span class="op" id="3139714">!=</span>&nbsp;<span class="ident" id="3139717">nil</span>&nbsp;<span class="op" id="3139721">&amp;&amp;</span>&nbsp;<span class="ident" id="3139724">first</span><span class="op" id="3139729">.</span><span class="ident" id="3139730">Equal</span><span class="op" id="3139735">(</span><span class="ident" id="3139736">ifirst</span><span class="op" id="3139742">)</span>&nbsp;<span class="op" id="3139744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139750">continue</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3139766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139771">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;regexp:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139823">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;first&nbsp;but&nbsp;sub[i]&nbsp;does&nbsp;not.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139883">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139888">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;regexp&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3139957">if</span>&nbsp;<span class="ident" id="3139960">i</span>&nbsp;<span class="op" id="3139962">==</span>&nbsp;<span class="ident" id="3139965">start</span>&nbsp;<span class="op" id="3139971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3139976">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3140014">}</span>&nbsp;<span class="keyword" id="3140016">else</span>&nbsp;<span class="keyword" id="3140021">if</span>&nbsp;<span class="ident" id="3140024">i</span>&nbsp;<span class="op" id="3140026">==</span>&nbsp;<span class="ident" id="3140029">start</span><span class="op" id="3140034">+</span><span class="num" id="3140035">1</span>&nbsp;<span class="op" id="3140037">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3140042">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140082">out</span>&nbsp;<span class="op" id="3140086">=</span>&nbsp;<span class="builtinfunc" id="3140088">append</span><span class="op" id="3140094">(</span><span class="ident" id="3140095">out</span><span class="op" id="3140098">,</span>&nbsp;<span class="ident" id="3140100">sub</span><span class="op" id="3140103">[</span><span class="ident" id="3140104">start</span><span class="op" id="3140109">]</span><span class="op" id="3140110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3140114">}</span>&nbsp;<span class="keyword" id="3140116">else</span>&nbsp;<span class="op" id="3140121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3140126">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140185">prefix</span>&nbsp;<span class="op" id="3140192">:=</span>&nbsp;<span class="ident" id="3140195">first</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3140204">for</span>&nbsp;<span class="ident" id="3140208">j</span>&nbsp;<span class="op" id="3140210">:=</span>&nbsp;<span class="ident" id="3140213">start</span><span class="op" id="3140218">;</span>&nbsp;<span class="ident" id="3140220">j</span>&nbsp;<span class="op" id="3140222">&lt;</span>&nbsp;<span class="ident" id="3140224">i</span><span class="op" id="3140225">;</span>&nbsp;<span class="ident" id="3140227">j</span><span class="op" id="3140228">++</span>&nbsp;<span class="op" id="3140231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140237">reuse</span>&nbsp;<span class="op" id="3140243">:=</span>&nbsp;<span class="ident" id="3140246">j</span>&nbsp;<span class="op" id="3140248">!=</span>&nbsp;<span class="ident" id="3140251">start</span>&nbsp;<span class="comment" id="3140257">//&nbsp;prefix&nbsp;came&nbsp;from&nbsp;sub[start]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140292">sub</span><span class="op" id="3140295">[</span><span class="ident" id="3140296">j</span><span class="op" id="3140297">]</span>&nbsp;<span class="op" id="3140299">=</span>&nbsp;<span class="ident" id="3140301">p</span><span class="op" id="3140302">.</span><span class="ident" id="3140303">removeLeadingRegexp</span><span class="op" id="3140322">(</span><span class="ident" id="3140323">sub</span><span class="op" id="3140326">[</span><span class="ident" id="3140327">j</span><span class="op" id="3140328">]</span><span class="op" id="3140329">,</span>&nbsp;<span class="ident" id="3140331">reuse</span><span class="op" id="3140336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3140341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140346">suffix</span>&nbsp;<span class="op" id="3140353">:=</span>&nbsp;<span class="ident" id="3140356">p</span><span class="op" id="3140357">.</span><span class="ident" id="3140358">collapse</span><span class="op" id="3140366">(</span><span class="ident" id="3140367">sub</span><span class="op" id="3140370">[</span><span class="ident" id="3140371">start</span><span class="op" id="3140376">:</span><span class="ident" id="3140377">i</span><span class="op" id="3140378">]</span><span class="op" id="3140379">,</span>&nbsp;<span class="ident" id="3140381">OpAlternate</span><span class="op" id="3140392">)</span>&nbsp;<span class="comment" id="3140394">//&nbsp;recurse</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140409">re</span>&nbsp;<span class="op" id="3140412">:=</span>&nbsp;<span class="ident" id="3140415">p</span><span class="op" id="3140416">.</span><span class="ident" id="3140417">newRegexp</span><span class="op" id="3140426">(</span><span class="ident" id="3140427">OpConcat</span><span class="op" id="3140435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140440">re</span><span class="op" id="3140442">.</span><span class="ident" id="3140443">Sub</span>&nbsp;<span class="op" id="3140447">=</span>&nbsp;<span class="builtinfunc" id="3140449">append</span><span class="op" id="3140455">(</span><span class="ident" id="3140456">re</span><span class="op" id="3140458">.</span><span class="ident" id="3140459">Sub</span><span class="op" id="3140462">[</span><span class="op" id="3140463">:</span><span class="num" id="3140464">0</span><span class="op" id="3140465">]</span><span class="op" id="3140466">,</span>&nbsp;<span class="ident" id="3140468">prefix</span><span class="op" id="3140474">,</span>&nbsp;<span class="ident" id="3140476">suffix</span><span class="op" id="3140482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140487">out</span>&nbsp;<span class="op" id="3140491">=</span>&nbsp;<span class="builtinfunc" id="3140493">append</span><span class="op" id="3140499">(</span><span class="ident" id="3140500">out</span><span class="op" id="3140503">,</span>&nbsp;<span class="ident" id="3140505">re</span><span class="op" id="3140507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3140511">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3140516">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140549">start</span>&nbsp;<span class="op" id="3140555">=</span>&nbsp;<span class="ident" id="3140557">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140561">first</span>&nbsp;<span class="op" id="3140567">=</span>&nbsp;<span class="ident" id="3140569">ifirst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3140577">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140580">sub</span>&nbsp;<span class="op" id="3140584">=</span>&nbsp;<span class="ident" id="3140586">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3140592">//&nbsp;Round&nbsp;3:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;single&nbsp;literals&nbsp;into&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140662">start</span>&nbsp;<span class="op" id="3140668">=</span>&nbsp;<span class="num" id="3140670">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3140673">out</span>&nbsp;<span class="op" id="3140677">=</span>&nbsp;<span class="ident" id="3140679">sub</span><span class="op" id="3140682">[</span><span class="op" id="3140683">:</span><span class="num" id="3140684">0</span><span class="op" id="3140685">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3140688">for</span>&nbsp;<span class="ident" id="3140692">i</span>&nbsp;<span class="op" id="3140694">:=</span>&nbsp;<span class="num" id="3140697">0</span><span class="op" id="3140698">;</span>&nbsp;<span class="ident" id="3140700">i</span>&nbsp;<span class="op" id="3140702">&lt;=</span>&nbsp;<span class="builtinfunc" id="3140705">len</span><span class="op" id="3140708">(</span><span class="ident" id="3140709">sub</span><span class="op" id="3140712">)</span><span class="op" id="3140713">;</span>&nbsp;<span class="ident" id="3140715">i</span><span class="op" id="3140716">++</span>&nbsp;<span class="op" id="3140719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3140723">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3140787">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3140854">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3140888">//</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3140893">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;are&nbsp;either</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3140958">//&nbsp;literal&nbsp;runes&nbsp;or&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3140999">if</span>&nbsp;<span class="ident" id="3141002">i</span>&nbsp;<span class="op" id="3141004">&lt;</span>&nbsp;<span class="builtinfunc" id="3141006">len</span><span class="op" id="3141009">(</span><span class="ident" id="3141010">sub</span><span class="op" id="3141013">)</span>&nbsp;<span class="op" id="3141015">&amp;&amp;</span>&nbsp;<span class="ident" id="3141018">isCharClass</span><span class="op" id="3141029">(</span><span class="ident" id="3141030">sub</span><span class="op" id="3141033">[</span><span class="ident" id="3141034">i</span><span class="op" id="3141035">]</span><span class="op" id="3141036">)</span>&nbsp;<span class="op" id="3141038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141043">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141054">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3141059">//&nbsp;sub[i]&nbsp;is&nbsp;not&nbsp;a&nbsp;char&nbsp;or&nbsp;char&nbsp;class;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3141100">//&nbsp;emit&nbsp;char&nbsp;class&nbsp;for&nbsp;sub[start:i]...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141141">if</span>&nbsp;<span class="ident" id="3141144">i</span>&nbsp;<span class="op" id="3141146">==</span>&nbsp;<span class="ident" id="3141149">start</span>&nbsp;<span class="op" id="3141155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3141160">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141198">}</span>&nbsp;<span class="keyword" id="3141200">else</span>&nbsp;<span class="keyword" id="3141205">if</span>&nbsp;<span class="ident" id="3141208">i</span>&nbsp;<span class="op" id="3141210">==</span>&nbsp;<span class="ident" id="3141213">start</span><span class="op" id="3141218">+</span><span class="num" id="3141219">1</span>&nbsp;<span class="op" id="3141221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141226">out</span>&nbsp;<span class="op" id="3141230">=</span>&nbsp;<span class="builtinfunc" id="3141232">append</span><span class="op" id="3141238">(</span><span class="ident" id="3141239">out</span><span class="op" id="3141242">,</span>&nbsp;<span class="ident" id="3141244">sub</span><span class="op" id="3141247">[</span><span class="ident" id="3141248">start</span><span class="op" id="3141253">]</span><span class="op" id="3141254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141258">}</span>&nbsp;<span class="keyword" id="3141260">else</span>&nbsp;<span class="op" id="3141265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3141270">//&nbsp;Make&nbsp;new&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3141297">//&nbsp;Start&nbsp;with&nbsp;most&nbsp;complex&nbsp;regexp&nbsp;in&nbsp;sub[start].</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141349">max</span>&nbsp;<span class="op" id="3141353">:=</span>&nbsp;<span class="ident" id="3141356">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141365">for</span>&nbsp;<span class="ident" id="3141369">j</span>&nbsp;<span class="op" id="3141371">:=</span>&nbsp;<span class="ident" id="3141374">start</span>&nbsp;<span class="op" id="3141380">+</span>&nbsp;<span class="num" id="3141382">1</span><span class="op" id="3141383">;</span>&nbsp;<span class="ident" id="3141385">j</span>&nbsp;<span class="op" id="3141387">&lt;</span>&nbsp;<span class="ident" id="3141389">i</span><span class="op" id="3141390">;</span>&nbsp;<span class="ident" id="3141392">j</span><span class="op" id="3141393">++</span>&nbsp;<span class="op" id="3141396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141402">if</span>&nbsp;<span class="ident" id="3141405">sub</span><span class="op" id="3141408">[</span><span class="ident" id="3141409">max</span><span class="op" id="3141412">]</span><span class="op" id="3141413">.</span><span class="ident" id="3141414">Op</span>&nbsp;<span class="op" id="3141417">&lt;</span>&nbsp;<span class="ident" id="3141419">sub</span><span class="op" id="3141422">[</span><span class="ident" id="3141423">j</span><span class="op" id="3141424">]</span><span class="op" id="3141425">.</span><span class="ident" id="3141426">Op</span>&nbsp;<span class="op" id="3141429">||</span>&nbsp;<span class="ident" id="3141432">sub</span><span class="op" id="3141435">[</span><span class="ident" id="3141436">max</span><span class="op" id="3141439">]</span><span class="op" id="3141440">.</span><span class="ident" id="3141441">Op</span>&nbsp;<span class="op" id="3141444">==</span>&nbsp;<span class="ident" id="3141447">sub</span><span class="op" id="3141450">[</span><span class="ident" id="3141451">j</span><span class="op" id="3141452">]</span><span class="op" id="3141453">.</span><span class="ident" id="3141454">Op</span>&nbsp;<span class="op" id="3141457">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3141460">len</span><span class="op" id="3141463">(</span><span class="ident" id="3141464">sub</span><span class="op" id="3141467">[</span><span class="ident" id="3141468">max</span><span class="op" id="3141471">]</span><span class="op" id="3141472">.</span><span class="ident" id="3141473">Rune</span><span class="op" id="3141477">)</span>&nbsp;<span class="op" id="3141479">&lt;</span>&nbsp;<span class="builtinfunc" id="3141481">len</span><span class="op" id="3141484">(</span><span class="ident" id="3141485">sub</span><span class="op" id="3141488">[</span><span class="ident" id="3141489">j</span><span class="op" id="3141490">]</span><span class="op" id="3141491">.</span><span class="ident" id="3141492">Rune</span><span class="op" id="3141496">)</span>&nbsp;<span class="op" id="3141498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141505">max</span>&nbsp;<span class="op" id="3141509">=</span>&nbsp;<span class="ident" id="3141511">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141517">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141527">sub</span><span class="op" id="3141530">[</span><span class="ident" id="3141531">start</span><span class="op" id="3141536">]</span><span class="op" id="3141537">,</span>&nbsp;<span class="ident" id="3141539">sub</span><span class="op" id="3141542">[</span><span class="ident" id="3141543">max</span><span class="op" id="3141546">]</span>&nbsp;<span class="op" id="3141548">=</span>&nbsp;<span class="ident" id="3141550">sub</span><span class="op" id="3141553">[</span><span class="ident" id="3141554">max</span><span class="op" id="3141557">]</span><span class="op" id="3141558">,</span>&nbsp;<span class="ident" id="3141560">sub</span><span class="op" id="3141563">[</span><span class="ident" id="3141564">start</span><span class="op" id="3141569">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141575">for</span>&nbsp;<span class="ident" id="3141579">j</span>&nbsp;<span class="op" id="3141581">:=</span>&nbsp;<span class="ident" id="3141584">start</span>&nbsp;<span class="op" id="3141590">+</span>&nbsp;<span class="num" id="3141592">1</span><span class="op" id="3141593">;</span>&nbsp;<span class="ident" id="3141595">j</span>&nbsp;<span class="op" id="3141597">&lt;</span>&nbsp;<span class="ident" id="3141599">i</span><span class="op" id="3141600">;</span>&nbsp;<span class="ident" id="3141602">j</span><span class="op" id="3141603">++</span>&nbsp;<span class="op" id="3141606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141612">mergeCharClass</span><span class="op" id="3141626">(</span><span class="ident" id="3141627">sub</span><span class="op" id="3141630">[</span><span class="ident" id="3141631">start</span><span class="op" id="3141636">]</span><span class="op" id="3141637">,</span>&nbsp;<span class="ident" id="3141639">sub</span><span class="op" id="3141642">[</span><span class="ident" id="3141643">j</span><span class="op" id="3141644">]</span><span class="op" id="3141645">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141651">p</span><span class="op" id="3141652">.</span><span class="ident" id="3141653">reuse</span><span class="op" id="3141658">(</span><span class="ident" id="3141659">sub</span><span class="op" id="3141662">[</span><span class="ident" id="3141663">j</span><span class="op" id="3141664">]</span><span class="op" id="3141665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141675">cleanAlt</span><span class="op" id="3141683">(</span><span class="ident" id="3141684">sub</span><span class="op" id="3141687">[</span><span class="ident" id="3141688">start</span><span class="op" id="3141693">]</span><span class="op" id="3141694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141699">out</span>&nbsp;<span class="op" id="3141703">=</span>&nbsp;<span class="builtinfunc" id="3141705">append</span><span class="op" id="3141711">(</span><span class="ident" id="3141712">out</span><span class="op" id="3141715">,</span>&nbsp;<span class="ident" id="3141717">sub</span><span class="op" id="3141720">[</span><span class="ident" id="3141721">start</span><span class="op" id="3141726">]</span><span class="op" id="3141727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141731">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3141736">//&nbsp;...&nbsp;and&nbsp;then&nbsp;emit&nbsp;sub[i].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141767">if</span>&nbsp;<span class="ident" id="3141770">i</span>&nbsp;<span class="op" id="3141772">&lt;</span>&nbsp;<span class="builtinfunc" id="3141774">len</span><span class="op" id="3141777">(</span><span class="ident" id="3141778">sub</span><span class="op" id="3141781">)</span>&nbsp;<span class="op" id="3141783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141788">out</span>&nbsp;<span class="op" id="3141792">=</span>&nbsp;<span class="builtinfunc" id="3141794">append</span><span class="op" id="3141800">(</span><span class="ident" id="3141801">out</span><span class="op" id="3141804">,</span>&nbsp;<span class="ident" id="3141806">sub</span><span class="op" id="3141809">[</span><span class="ident" id="3141810">i</span><span class="op" id="3141811">]</span><span class="op" id="3141812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141816">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141820">start</span>&nbsp;<span class="op" id="3141826">=</span>&nbsp;<span class="ident" id="3141828">i</span>&nbsp;<span class="op" id="3141830">+</span>&nbsp;<span class="num" id="3141832">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3141835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141838">sub</span>&nbsp;<span class="op" id="3141842">=</span>&nbsp;<span class="ident" id="3141844">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3141850">//&nbsp;Round&nbsp;4:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;empty&nbsp;matches&nbsp;into&nbsp;a&nbsp;single&nbsp;empty&nbsp;match.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141921">start</span>&nbsp;<span class="op" id="3141927">=</span>&nbsp;<span class="num" id="3141929">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3141932">out</span>&nbsp;<span class="op" id="3141936">=</span>&nbsp;<span class="ident" id="3141938">sub</span><span class="op" id="3141941">[</span><span class="op" id="3141942">:</span><span class="num" id="3141943">0</span><span class="op" id="3141944">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141947">for</span>&nbsp;<span class="ident" id="3141951">i</span>&nbsp;<span class="op" id="3141953">:=</span>&nbsp;<span class="keyword" id="3141956">range</span>&nbsp;<span class="ident" id="3141962">sub</span>&nbsp;<span class="op" id="3141966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3141970">if</span>&nbsp;<span class="ident" id="3141973">i</span><span class="op" id="3141974">+</span><span class="num" id="3141975">1</span>&nbsp;<span class="op" id="3141977">&lt;</span>&nbsp;<span class="builtinfunc" id="3141979">len</span><span class="op" id="3141982">(</span><span class="ident" id="3141983">sub</span><span class="op" id="3141986">)</span>&nbsp;<span class="op" id="3141988">&amp;&amp;</span>&nbsp;<span class="ident" id="3141991">sub</span><span class="op" id="3141994">[</span><span class="ident" id="3141995">i</span><span class="op" id="3141996">]</span><span class="op" id="3141997">.</span><span class="ident" id="3141998">Op</span>&nbsp;<span class="op" id="3142001">==</span>&nbsp;<span class="ident" id="3142004">OpEmptyMatch</span>&nbsp;<span class="op" id="3142017">&amp;&amp;</span>&nbsp;<span class="ident" id="3142020">sub</span><span class="op" id="3142023">[</span><span class="ident" id="3142024">i</span><span class="op" id="3142025">+</span><span class="num" id="3142026">1</span><span class="op" id="3142027">]</span><span class="op" id="3142028">.</span><span class="ident" id="3142029">Op</span>&nbsp;<span class="op" id="3142032">==</span>&nbsp;<span class="ident" id="3142035">OpEmptyMatch</span>&nbsp;<span class="op" id="3142048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142053">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142068">out</span>&nbsp;<span class="op" id="3142072">=</span>&nbsp;<span class="builtinfunc" id="3142074">append</span><span class="op" id="3142080">(</span><span class="ident" id="3142081">out</span><span class="op" id="3142084">,</span>&nbsp;<span class="ident" id="3142086">sub</span><span class="op" id="3142089">[</span><span class="ident" id="3142090">i</span><span class="op" id="3142091">]</span><span class="op" id="3142092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142098">sub</span>&nbsp;<span class="op" id="3142102">=</span>&nbsp;<span class="ident" id="3142104">out</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142110">return</span>&nbsp;<span class="ident" id="3142117">sub</span><br>
<span class="lineno"></span><span class="op" id="3142121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3142124">//&nbsp;leadingString&nbsp;returns&nbsp;the&nbsp;leading&nbsp;literal&nbsp;string&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="3142197">//&nbsp;The&nbsp;string&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno">585</span><span class="keyword" id="3142252">func</span>&nbsp;<span class="op" id="3142257">(</span><span class="ident" id="3142258">p</span>&nbsp;<span class="op" id="3142260">*</span><span class="ident" id="3142261">parser</span><span class="op" id="3142267">)</span>&nbsp;<span class="ident" id="3142269">leadingString</span><span class="op" id="3142282">(</span><span class="ident" id="3142283">re</span>&nbsp;<span class="op" id="3142286">*</span><span class="ident" id="3142287">Regexp</span><span class="op" id="3142293">)</span>&nbsp;<span class="op" id="3142295">(</span><span class="op" id="3142296">[</span><span class="op" id="3142297">]</span><span class="builtintype" id="3142298">rune</span><span class="op" id="3142302">,</span>&nbsp;<span class="ident" id="3142304">Flags</span><span class="op" id="3142309">)</span>&nbsp;<span class="op" id="3142311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142314">if</span>&nbsp;<span class="ident" id="3142317">re</span><span class="op" id="3142319">.</span><span class="ident" id="3142320">Op</span>&nbsp;<span class="op" id="3142323">==</span>&nbsp;<span class="ident" id="3142326">OpConcat</span>&nbsp;<span class="op" id="3142335">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3142338">len</span><span class="op" id="3142341">(</span><span class="ident" id="3142342">re</span><span class="op" id="3142344">.</span><span class="ident" id="3142345">Sub</span><span class="op" id="3142348">)</span>&nbsp;<span class="op" id="3142350">&gt;</span>&nbsp;<span class="num" id="3142352">0</span>&nbsp;<span class="op" id="3142354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142358">re</span>&nbsp;<span class="op" id="3142361">=</span>&nbsp;<span class="ident" id="3142363">re</span><span class="op" id="3142365">.</span><span class="ident" id="3142366">Sub</span><span class="op" id="3142369">[</span><span class="num" id="3142370">0</span><span class="op" id="3142371">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142377">if</span>&nbsp;<span class="ident" id="3142380">re</span><span class="op" id="3142382">.</span><span class="ident" id="3142383">Op</span>&nbsp;<span class="op" id="3142386">!=</span>&nbsp;<span class="ident" id="3142389">OpLiteral</span>&nbsp;<span class="op" id="3142399">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142403">return</span>&nbsp;<span class="ident" id="3142410">nil</span><span class="op" id="3142413">,</span>&nbsp;<span class="num" id="3142415">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3142418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142421">return</span>&nbsp;<span class="ident" id="3142428">re</span><span class="op" id="3142430">.</span><span class="ident" id="3142431">Rune</span><span class="op" id="3142435">,</span>&nbsp;<span class="ident" id="3142437">re</span><span class="op" id="3142439">.</span><span class="ident" id="3142440">Flags</span>&nbsp;<span class="op" id="3142446">&amp;</span>&nbsp;<span class="ident" id="3142448">FoldCase</span><br>
<span class="lineno"></span><span class="op" id="3142457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="3142460">//&nbsp;removeLeadingString&nbsp;removes&nbsp;the&nbsp;first&nbsp;n&nbsp;leading&nbsp;runes</span><br>
<span class="lineno"></span><span class="comment" id="3142517">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno"></span><span class="keyword" id="3142582">func</span>&nbsp;<span class="op" id="3142587">(</span><span class="ident" id="3142588">p</span>&nbsp;<span class="op" id="3142590">*</span><span class="ident" id="3142591">parser</span><span class="op" id="3142597">)</span>&nbsp;<span class="ident" id="3142599">removeLeadingString</span><span class="op" id="3142618">(</span><span class="ident" id="3142619">re</span>&nbsp;<span class="op" id="3142622">*</span><span class="ident" id="3142623">Regexp</span><span class="op" id="3142629">,</span>&nbsp;<span class="ident" id="3142631">n</span>&nbsp;<span class="builtintype" id="3142633">int</span><span class="op" id="3142636">)</span>&nbsp;<span class="op" id="3142638">*</span><span class="ident" id="3142639">Regexp</span>&nbsp;<span class="op" id="3142646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142649">if</span>&nbsp;<span class="ident" id="3142652">re</span><span class="op" id="3142654">.</span><span class="ident" id="3142655">Op</span>&nbsp;<span class="op" id="3142658">==</span>&nbsp;<span class="ident" id="3142661">OpConcat</span>&nbsp;<span class="op" id="3142670">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3142673">len</span><span class="op" id="3142676">(</span><span class="ident" id="3142677">re</span><span class="op" id="3142679">.</span><span class="ident" id="3142680">Sub</span><span class="op" id="3142683">)</span>&nbsp;<span class="op" id="3142685">&gt;</span>&nbsp;<span class="num" id="3142687">0</span>&nbsp;<span class="op" id="3142689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3142693">//&nbsp;Removing&nbsp;a&nbsp;leading&nbsp;string&nbsp;in&nbsp;a&nbsp;concatenation</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3142743">//&nbsp;might&nbsp;simplify&nbsp;the&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142782">sub</span>&nbsp;<span class="op" id="3142786">:=</span>&nbsp;<span class="ident" id="3142789">re</span><span class="op" id="3142791">.</span><span class="ident" id="3142792">Sub</span><span class="op" id="3142795">[</span><span class="num" id="3142796">0</span><span class="op" id="3142797">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142801">sub</span>&nbsp;<span class="op" id="3142805">=</span>&nbsp;<span class="ident" id="3142807">p</span><span class="op" id="3142808">.</span><span class="ident" id="3142809">removeLeadingString</span><span class="op" id="3142828">(</span><span class="ident" id="3142829">sub</span><span class="op" id="3142832">,</span>&nbsp;<span class="ident" id="3142834">n</span><span class="op" id="3142835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142839">re</span><span class="op" id="3142841">.</span><span class="ident" id="3142842">Sub</span><span class="op" id="3142845">[</span><span class="num" id="3142846">0</span><span class="op" id="3142847">]</span>&nbsp;<span class="op" id="3142849">=</span>&nbsp;<span class="ident" id="3142851">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142857">if</span>&nbsp;<span class="ident" id="3142860">sub</span><span class="op" id="3142863">.</span><span class="ident" id="3142864">Op</span>&nbsp;<span class="op" id="3142867">==</span>&nbsp;<span class="ident" id="3142870">OpEmptyMatch</span>&nbsp;<span class="op" id="3142883">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142888">p</span><span class="op" id="3142889">.</span><span class="ident" id="3142890">reuse</span><span class="op" id="3142895">(</span><span class="ident" id="3142896">sub</span><span class="op" id="3142899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142904">switch</span>&nbsp;<span class="builtinfunc" id="3142911">len</span><span class="op" id="3142914">(</span><span class="ident" id="3142915">re</span><span class="op" id="3142917">.</span><span class="ident" id="3142918">Sub</span><span class="op" id="3142921">)</span>&nbsp;<span class="op" id="3142923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3142928">case</span>&nbsp;<span class="num" id="3142933">0</span><span class="op" id="3142934">,</span>&nbsp;<span class="num" id="3142936">1</span><span class="op" id="3142937">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3142943">//&nbsp;Impossible&nbsp;but&nbsp;handle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142973">re</span><span class="op" id="3142975">.</span><span class="ident" id="3142976">Op</span>&nbsp;<span class="op" id="3142979">=</span>&nbsp;<span class="ident" id="3142981">OpEmptyMatch</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3142998">re</span><span class="op" id="3143000">.</span><span class="ident" id="3143001">Sub</span>&nbsp;<span class="op" id="3143005">=</span>&nbsp;<span class="ident" id="3143007">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143014">case</span>&nbsp;<span class="num" id="3143019">2</span><span class="op" id="3143020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143026">old</span>&nbsp;<span class="op" id="3143030">:=</span>&nbsp;<span class="ident" id="3143033">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143040">re</span>&nbsp;<span class="op" id="3143043">=</span>&nbsp;<span class="ident" id="3143045">re</span><span class="op" id="3143047">.</span><span class="ident" id="3143048">Sub</span><span class="op" id="3143051">[</span><span class="num" id="3143052">1</span><span class="op" id="3143053">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143059">p</span><span class="op" id="3143060">.</span><span class="ident" id="3143061">reuse</span><span class="op" id="3143066">(</span><span class="ident" id="3143067">old</span><span class="op" id="3143070">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143075">default</span><span class="op" id="3143082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3143088">copy</span><span class="op" id="3143092">(</span><span class="ident" id="3143093">re</span><span class="op" id="3143095">.</span><span class="ident" id="3143096">Sub</span><span class="op" id="3143099">,</span>&nbsp;<span class="ident" id="3143101">re</span><span class="op" id="3143103">.</span><span class="ident" id="3143104">Sub</span><span class="op" id="3143107">[</span><span class="num" id="3143108">1</span><span class="op" id="3143109">:</span><span class="op" id="3143110">]</span><span class="op" id="3143111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143117">re</span><span class="op" id="3143119">.</span><span class="ident" id="3143120">Sub</span>&nbsp;<span class="op" id="3143124">=</span>&nbsp;<span class="ident" id="3143126">re</span><span class="op" id="3143128">.</span><span class="ident" id="3143129">Sub</span><span class="op" id="3143132">[</span><span class="op" id="3143133">:</span><span class="builtinfunc" id="3143134">len</span><span class="op" id="3143137">(</span><span class="ident" id="3143138">re</span><span class="op" id="3143140">.</span><span class="ident" id="3143141">Sub</span><span class="op" id="3143144">)</span><span class="op" id="3143145">-</span><span class="num" id="3143146">1</span><span class="op" id="3143147">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143156">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143160">return</span>&nbsp;<span class="ident" id="3143167">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143175">if</span>&nbsp;<span class="ident" id="3143178">re</span><span class="op" id="3143180">.</span><span class="ident" id="3143181">Op</span>&nbsp;<span class="op" id="3143184">==</span>&nbsp;<span class="ident" id="3143187">OpLiteral</span>&nbsp;<span class="op" id="3143197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143201">re</span><span class="op" id="3143203">.</span><span class="ident" id="3143204">Rune</span>&nbsp;<span class="op" id="3143209">=</span>&nbsp;<span class="ident" id="3143211">re</span><span class="op" id="3143213">.</span><span class="ident" id="3143214">Rune</span><span class="op" id="3143218">[</span><span class="op" id="3143219">:</span><span class="builtinfunc" id="3143220">copy</span><span class="op" id="3143224">(</span><span class="ident" id="3143225">re</span><span class="op" id="3143227">.</span><span class="ident" id="3143228">Rune</span><span class="op" id="3143232">,</span>&nbsp;<span class="ident" id="3143234">re</span><span class="op" id="3143236">.</span><span class="ident" id="3143237">Rune</span><span class="op" id="3143241">[</span><span class="ident" id="3143242">n</span><span class="op" id="3143243">:</span><span class="op" id="3143244">]</span><span class="op" id="3143245">)</span><span class="op" id="3143246">]</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143250">if</span>&nbsp;<span class="builtinfunc" id="3143253">len</span><span class="op" id="3143256">(</span><span class="ident" id="3143257">re</span><span class="op" id="3143259">.</span><span class="ident" id="3143260">Rune</span><span class="op" id="3143264">)</span>&nbsp;<span class="op" id="3143266">==</span>&nbsp;<span class="num" id="3143269">0</span>&nbsp;<span class="op" id="3143271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143276">re</span><span class="op" id="3143278">.</span><span class="ident" id="3143279">Op</span>&nbsp;<span class="op" id="3143282">=</span>&nbsp;<span class="ident" id="3143284">OpEmptyMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143305">return</span>&nbsp;<span class="ident" id="3143312">re</span><br>
<span class="lineno">630</span><span class="op" id="3143315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3143318">//&nbsp;leadingRegexp&nbsp;returns&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="3143383">//&nbsp;The&nbsp;regexp&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno"></span><span class="keyword" id="3143438">func</span>&nbsp;<span class="op" id="3143443">(</span><span class="ident" id="3143444">p</span>&nbsp;<span class="op" id="3143446">*</span><span class="ident" id="3143447">parser</span><span class="op" id="3143453">)</span>&nbsp;<span class="ident" id="3143455">leadingRegexp</span><span class="op" id="3143468">(</span><span class="ident" id="3143469">re</span>&nbsp;<span class="op" id="3143472">*</span><span class="ident" id="3143473">Regexp</span><span class="op" id="3143479">)</span>&nbsp;<span class="op" id="3143481">*</span><span class="ident" id="3143482">Regexp</span>&nbsp;<span class="op" id="3143489">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143492">if</span>&nbsp;<span class="ident" id="3143495">re</span><span class="op" id="3143497">.</span><span class="ident" id="3143498">Op</span>&nbsp;<span class="op" id="3143501">==</span>&nbsp;<span class="ident" id="3143504">OpEmptyMatch</span>&nbsp;<span class="op" id="3143517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143521">return</span>&nbsp;<span class="ident" id="3143528">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143536">if</span>&nbsp;<span class="ident" id="3143539">re</span><span class="op" id="3143541">.</span><span class="ident" id="3143542">Op</span>&nbsp;<span class="op" id="3143545">==</span>&nbsp;<span class="ident" id="3143548">OpConcat</span>&nbsp;<span class="op" id="3143557">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3143560">len</span><span class="op" id="3143563">(</span><span class="ident" id="3143564">re</span><span class="op" id="3143566">.</span><span class="ident" id="3143567">Sub</span><span class="op" id="3143570">)</span>&nbsp;<span class="op" id="3143572">&gt;</span>&nbsp;<span class="num" id="3143574">0</span>&nbsp;<span class="op" id="3143576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143580">sub</span>&nbsp;<span class="op" id="3143584">:=</span>&nbsp;<span class="ident" id="3143587">re</span><span class="op" id="3143589">.</span><span class="ident" id="3143590">Sub</span><span class="op" id="3143593">[</span><span class="num" id="3143594">0</span><span class="op" id="3143595">]</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143599">if</span>&nbsp;<span class="ident" id="3143602">sub</span><span class="op" id="3143605">.</span><span class="ident" id="3143606">Op</span>&nbsp;<span class="op" id="3143609">==</span>&nbsp;<span class="ident" id="3143612">OpEmptyMatch</span>&nbsp;<span class="op" id="3143625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143630">return</span>&nbsp;<span class="ident" id="3143637">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143647">return</span>&nbsp;<span class="ident" id="3143654">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3143659">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143662">return</span>&nbsp;<span class="ident" id="3143669">re</span><br>
<span class="lineno"></span><span class="op" id="3143672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3143675">//&nbsp;removeLeadingRegexp&nbsp;removes&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;in&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="3143732">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno">650</span><span class="comment" id="3143770">//&nbsp;If&nbsp;reuse&nbsp;is&nbsp;true,&nbsp;it&nbsp;passes&nbsp;the&nbsp;removed&nbsp;regexp&nbsp;(if&nbsp;no&nbsp;longer&nbsp;needed)&nbsp;to&nbsp;p.reuse.</span><br>
<span class="lineno"></span><span class="keyword" id="3143854">func</span>&nbsp;<span class="op" id="3143859">(</span><span class="ident" id="3143860">p</span>&nbsp;<span class="op" id="3143862">*</span><span class="ident" id="3143863">parser</span><span class="op" id="3143869">)</span>&nbsp;<span class="ident" id="3143871">removeLeadingRegexp</span><span class="op" id="3143890">(</span><span class="ident" id="3143891">re</span>&nbsp;<span class="op" id="3143894">*</span><span class="ident" id="3143895">Regexp</span><span class="op" id="3143901">,</span>&nbsp;<span class="ident" id="3143903">reuse</span>&nbsp;<span class="builtintype" id="3143909">bool</span><span class="op" id="3143913">)</span>&nbsp;<span class="op" id="3143915">*</span><span class="ident" id="3143916">Regexp</span>&nbsp;<span class="op" id="3143923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143926">if</span>&nbsp;<span class="ident" id="3143929">re</span><span class="op" id="3143931">.</span><span class="ident" id="3143932">Op</span>&nbsp;<span class="op" id="3143935">==</span>&nbsp;<span class="ident" id="3143938">OpConcat</span>&nbsp;<span class="op" id="3143947">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3143950">len</span><span class="op" id="3143953">(</span><span class="ident" id="3143954">re</span><span class="op" id="3143956">.</span><span class="ident" id="3143957">Sub</span><span class="op" id="3143960">)</span>&nbsp;<span class="op" id="3143962">&gt;</span>&nbsp;<span class="num" id="3143964">0</span>&nbsp;<span class="op" id="3143966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3143970">if</span>&nbsp;<span class="ident" id="3143973">reuse</span>&nbsp;<span class="op" id="3143979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3143984">p</span><span class="op" id="3143985">.</span><span class="ident" id="3143986">reuse</span><span class="op" id="3143991">(</span><span class="ident" id="3143992">re</span><span class="op" id="3143994">.</span><span class="ident" id="3143995">Sub</span><span class="op" id="3143998">[</span><span class="num" id="3143999">0</span><span class="op" id="3144000">]</span><span class="op" id="3144001">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3144005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144009">re</span><span class="op" id="3144011">.</span><span class="ident" id="3144012">Sub</span>&nbsp;<span class="op" id="3144016">=</span>&nbsp;<span class="ident" id="3144018">re</span><span class="op" id="3144020">.</span><span class="ident" id="3144021">Sub</span><span class="op" id="3144024">[</span><span class="op" id="3144025">:</span><span class="builtinfunc" id="3144026">copy</span><span class="op" id="3144030">(</span><span class="ident" id="3144031">re</span><span class="op" id="3144033">.</span><span class="ident" id="3144034">Sub</span><span class="op" id="3144037">,</span>&nbsp;<span class="ident" id="3144039">re</span><span class="op" id="3144041">.</span><span class="ident" id="3144042">Sub</span><span class="op" id="3144045">[</span><span class="num" id="3144046">1</span><span class="op" id="3144047">:</span><span class="op" id="3144048">]</span><span class="op" id="3144049">)</span><span class="op" id="3144050">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144054">switch</span>&nbsp;<span class="builtinfunc" id="3144061">len</span><span class="op" id="3144064">(</span><span class="ident" id="3144065">re</span><span class="op" id="3144067">.</span><span class="ident" id="3144068">Sub</span><span class="op" id="3144071">)</span>&nbsp;<span class="op" id="3144073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144077">case</span>&nbsp;<span class="num" id="3144082">0</span><span class="op" id="3144083">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144088">re</span><span class="op" id="3144090">.</span><span class="ident" id="3144091">Op</span>&nbsp;<span class="op" id="3144094">=</span>&nbsp;<span class="ident" id="3144096">OpEmptyMatch</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144112">re</span><span class="op" id="3144114">.</span><span class="ident" id="3144115">Sub</span>&nbsp;<span class="op" id="3144119">=</span>&nbsp;<span class="ident" id="3144121">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144127">case</span>&nbsp;<span class="num" id="3144132">1</span><span class="op" id="3144133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144138">old</span>&nbsp;<span class="op" id="3144142">:=</span>&nbsp;<span class="ident" id="3144145">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144151">re</span>&nbsp;<span class="op" id="3144154">=</span>&nbsp;<span class="ident" id="3144156">re</span><span class="op" id="3144158">.</span><span class="ident" id="3144159">Sub</span><span class="op" id="3144162">[</span><span class="num" id="3144163">0</span><span class="op" id="3144164">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144169">p</span><span class="op" id="3144170">.</span><span class="ident" id="3144171">reuse</span><span class="op" id="3144176">(</span><span class="ident" id="3144177">old</span><span class="op" id="3144180">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3144184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144188">return</span>&nbsp;<span class="ident" id="3144195">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3144199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144202">if</span>&nbsp;<span class="ident" id="3144205">reuse</span>&nbsp;<span class="op" id="3144211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144215">p</span><span class="op" id="3144216">.</span><span class="ident" id="3144217">reuse</span><span class="op" id="3144222">(</span><span class="ident" id="3144223">re</span><span class="op" id="3144225">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3144228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144231">return</span>&nbsp;<span class="ident" id="3144238">p</span><span class="op" id="3144239">.</span><span class="ident" id="3144240">newRegexp</span><span class="op" id="3144249">(</span><span class="ident" id="3144250">OpEmptyMatch</span><span class="op" id="3144262">)</span><br>
<span class="lineno"></span><span class="op" id="3144264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3144267">func</span>&nbsp;<span class="ident" id="3144272">literalRegexp</span><span class="op" id="3144285">(</span><span class="ident" id="3144286">s</span>&nbsp;<span class="builtintype" id="3144288">string</span><span class="op" id="3144294">,</span>&nbsp;<span class="ident" id="3144296">flags</span>&nbsp;<span class="ident" id="3144302">Flags</span><span class="op" id="3144307">)</span>&nbsp;<span class="op" id="3144309">*</span><span class="ident" id="3144310">Regexp</span>&nbsp;<span class="op" id="3144317">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144320">re</span>&nbsp;<span class="op" id="3144323">:=</span>&nbsp;<span class="op" id="3144326">&amp;</span><span class="ident" id="3144327">Regexp</span><span class="op" id="3144333">{</span><span class="ident" id="3144334">Op</span><span class="op" id="3144336">:</span>&nbsp;<span class="ident" id="3144338">OpLiteral</span><span class="op" id="3144347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144350">re</span><span class="op" id="3144352">.</span><span class="ident" id="3144353">Flags</span>&nbsp;<span class="op" id="3144359">=</span>&nbsp;<span class="ident" id="3144361">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144368">re</span><span class="op" id="3144370">.</span><span class="ident" id="3144371">Rune</span>&nbsp;<span class="op" id="3144376">=</span>&nbsp;<span class="ident" id="3144378">re</span><span class="op" id="3144380">.</span><span class="ident" id="3144381">Rune0</span><span class="op" id="3144386">[</span><span class="op" id="3144387">:</span><span class="num" id="3144388">0</span><span class="op" id="3144389">]</span>&nbsp;<span class="comment" id="3144391">//&nbsp;use&nbsp;local&nbsp;storage&nbsp;for&nbsp;small&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144431">for</span>&nbsp;<span class="ident" id="3144435">_</span><span class="op" id="3144436">,</span>&nbsp;<span class="ident" id="3144438">c</span>&nbsp;<span class="op" id="3144440">:=</span>&nbsp;<span class="keyword" id="3144443">range</span>&nbsp;<span class="ident" id="3144449">s</span>&nbsp;<span class="op" id="3144451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144455">if</span>&nbsp;<span class="builtinfunc" id="3144458">len</span><span class="op" id="3144461">(</span><span class="ident" id="3144462">re</span><span class="op" id="3144464">.</span><span class="ident" id="3144465">Rune</span><span class="op" id="3144469">)</span>&nbsp;<span class="op" id="3144471">&gt;=</span>&nbsp;<span class="builtinfunc" id="3144474">cap</span><span class="op" id="3144477">(</span><span class="ident" id="3144478">re</span><span class="op" id="3144480">.</span><span class="ident" id="3144481">Rune</span><span class="op" id="3144485">)</span>&nbsp;<span class="op" id="3144487">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3144492">//&nbsp;string&nbsp;is&nbsp;too&nbsp;long&nbsp;to&nbsp;fit&nbsp;in&nbsp;Rune0.&nbsp;&nbsp;let&nbsp;Go&nbsp;handle&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144552">re</span><span class="op" id="3144554">.</span><span class="ident" id="3144555">Rune</span>&nbsp;<span class="op" id="3144560">=</span>&nbsp;<span class="op" id="3144562">[</span><span class="op" id="3144563">]</span><span class="builtintype" id="3144564">rune</span><span class="op" id="3144568">(</span><span class="ident" id="3144569">s</span><span class="op" id="3144570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144575">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3144583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3144587">re</span><span class="op" id="3144589">.</span><span class="ident" id="3144590">Rune</span>&nbsp;<span class="op" id="3144595">=</span>&nbsp;<span class="builtinfunc" id="3144597">append</span><span class="op" id="3144603">(</span><span class="ident" id="3144604">re</span><span class="op" id="3144606">.</span><span class="ident" id="3144607">Rune</span><span class="op" id="3144611">,</span>&nbsp;<span class="ident" id="3144613">c</span><span class="op" id="3144614">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3144617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144620">return</span>&nbsp;<span class="ident" id="3144627">re</span><br>
<span class="lineno"></span><span class="op" id="3144630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3144633">//&nbsp;Parsing.</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="comment" id="3144646">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;string&nbsp;s,&nbsp;controlled&nbsp;by&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="3144721">//&nbsp;Flags,&nbsp;and&nbsp;returns&nbsp;a&nbsp;regular&nbsp;expression&nbsp;parse&nbsp;tree.&nbsp;The&nbsp;syntax&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3144790">//&nbsp;described&nbsp;in&nbsp;the&nbsp;top-level&nbsp;comment.</span><br>
<span class="lineno"></span><span class="keyword" id="3144829">func</span>&nbsp;<span class="ident" id="3144834">Parse</span><span class="op" id="3144839">(</span><span class="ident" id="3144840">s</span>&nbsp;<span class="builtintype" id="3144842">string</span><span class="op" id="3144848">,</span>&nbsp;<span class="ident" id="3144850">flags</span>&nbsp;<span class="ident" id="3144856">Flags</span><span class="op" id="3144861">)</span>&nbsp;<span class="op" id="3144863">(</span><span class="op" id="3144864">*</span><span class="ident" id="3144865">Regexp</span><span class="op" id="3144871">,</span>&nbsp;<span class="builtintype" id="3144873">error</span><span class="op" id="3144878">)</span>&nbsp;<span class="op" id="3144880">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144883">if</span>&nbsp;<span class="ident" id="3144886">flags</span><span class="op" id="3144891">&amp;</span><span class="ident" id="3144892">Literal</span>&nbsp;<span class="op" id="3144900">!=</span>&nbsp;<span class="num" id="3144903">0</span>&nbsp;<span class="op" id="3144905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3144909">//&nbsp;Trivial&nbsp;parser&nbsp;for&nbsp;literal&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144949">if</span>&nbsp;<span class="ident" id="3144952">err</span>&nbsp;<span class="op" id="3144956">:=</span>&nbsp;<span class="ident" id="3144959">checkUTF8</span><span class="op" id="3144968">(</span><span class="ident" id="3144969">s</span><span class="op" id="3144970">)</span><span class="op" id="3144971">;</span>&nbsp;<span class="ident" id="3144973">err</span>&nbsp;<span class="op" id="3144977">!=</span>&nbsp;<span class="ident" id="3144980">nil</span>&nbsp;<span class="op" id="3144984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3144989">return</span>&nbsp;<span class="ident" id="3144996">nil</span><span class="op" id="3144999">,</span>&nbsp;<span class="ident" id="3145001">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145007">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145011">return</span>&nbsp;<span class="ident" id="3145018">literalRegexp</span><span class="op" id="3145031">(</span><span class="ident" id="3145032">s</span><span class="op" id="3145033">,</span>&nbsp;<span class="ident" id="3145035">flags</span><span class="op" id="3145040">)</span><span class="op" id="3145041">,</span>&nbsp;<span class="ident" id="3145043">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3145052">//&nbsp;Otherwise,&nbsp;must&nbsp;do&nbsp;real&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145086">var</span>&nbsp;<span class="op" id="3145090">(</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145094">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3145105">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145114">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3145125">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145133">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3145144">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145151">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3145162">Op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145167">lastRepeat</span>&nbsp;<span class="builtintype" id="3145178">string</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145189">p</span><span class="op" id="3145190">.</span><span class="ident" id="3145191">flags</span>&nbsp;<span class="op" id="3145197">=</span>&nbsp;<span class="ident" id="3145199">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145206">p</span><span class="op" id="3145207">.</span><span class="ident" id="3145208">wholeRegexp</span>&nbsp;<span class="op" id="3145220">=</span>&nbsp;<span class="ident" id="3145222">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145225">t</span>&nbsp;<span class="op" id="3145227">:=</span>&nbsp;<span class="ident" id="3145230">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145233">for</span>&nbsp;<span class="ident" id="3145237">t</span>&nbsp;<span class="op" id="3145239">!=</span>&nbsp;<span class="string" id="3145242">&#34;&#34;</span>&nbsp;<span class="op" id="3145245">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145249">repeat</span>&nbsp;<span class="op" id="3145256">:=</span>&nbsp;<span class="string" id="3145259">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145263">BigSwitch</span><span class="op" id="3145272">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145276">switch</span>&nbsp;<span class="ident" id="3145283">t</span><span class="op" id="3145284">[</span><span class="num" id="3145285">0</span><span class="op" id="3145286">]</span>&nbsp;<span class="op" id="3145288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145292">default</span><span class="op" id="3145299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145304">if</span>&nbsp;<span class="ident" id="3145307">c</span><span class="op" id="3145308">,</span>&nbsp;<span class="ident" id="3145310">t</span><span class="op" id="3145311">,</span>&nbsp;<span class="ident" id="3145313">err</span>&nbsp;<span class="op" id="3145317">=</span>&nbsp;<span class="ident" id="3145319">nextRune</span><span class="op" id="3145327">(</span><span class="ident" id="3145328">t</span><span class="op" id="3145329">)</span><span class="op" id="3145330">;</span>&nbsp;<span class="ident" id="3145332">err</span>&nbsp;<span class="op" id="3145336">!=</span>&nbsp;<span class="ident" id="3145339">nil</span>&nbsp;<span class="op" id="3145343">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145349">return</span>&nbsp;<span class="ident" id="3145356">nil</span><span class="op" id="3145359">,</span>&nbsp;<span class="ident" id="3145361">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145373">p</span><span class="op" id="3145374">.</span><span class="ident" id="3145375">literal</span><span class="op" id="3145382">(</span><span class="ident" id="3145383">c</span><span class="op" id="3145384">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145389">case</span>&nbsp;<span class="string" id="3145394">&#39;(&#39;</span><span class="op" id="3145397">:</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145402">if</span>&nbsp;<span class="ident" id="3145405">p</span><span class="op" id="3145406">.</span><span class="ident" id="3145407">flags</span><span class="op" id="3145412">&amp;</span><span class="ident" id="3145413">PerlX</span>&nbsp;<span class="op" id="3145419">!=</span>&nbsp;<span class="num" id="3145422">0</span>&nbsp;<span class="op" id="3145424">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3145427">len</span><span class="op" id="3145430">(</span><span class="ident" id="3145431">t</span><span class="op" id="3145432">)</span>&nbsp;<span class="op" id="3145434">&gt;=</span>&nbsp;<span class="num" id="3145437">2</span>&nbsp;<span class="op" id="3145439">&amp;&amp;</span>&nbsp;<span class="ident" id="3145442">t</span><span class="op" id="3145443">[</span><span class="num" id="3145444">1</span><span class="op" id="3145445">]</span>&nbsp;<span class="op" id="3145447">==</span>&nbsp;<span class="string" id="3145450">&#39;?&#39;</span>&nbsp;<span class="op" id="3145454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3145460">//&nbsp;Flag&nbsp;changes&nbsp;and&nbsp;non-capturing&nbsp;groups.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145506">if</span>&nbsp;<span class="ident" id="3145509">t</span><span class="op" id="3145510">,</span>&nbsp;<span class="ident" id="3145512">err</span>&nbsp;<span class="op" id="3145516">=</span>&nbsp;<span class="ident" id="3145518">p</span><span class="op" id="3145519">.</span><span class="ident" id="3145520">parsePerlFlags</span><span class="op" id="3145534">(</span><span class="ident" id="3145535">t</span><span class="op" id="3145536">)</span><span class="op" id="3145537">;</span>&nbsp;<span class="ident" id="3145539">err</span>&nbsp;<span class="op" id="3145543">!=</span>&nbsp;<span class="ident" id="3145546">nil</span>&nbsp;<span class="op" id="3145550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145557">return</span>&nbsp;<span class="ident" id="3145564">nil</span><span class="op" id="3145567">,</span>&nbsp;<span class="ident" id="3145569">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145577">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145583">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145597">p</span><span class="op" id="3145598">.</span><span class="ident" id="3145599">numCap</span><span class="op" id="3145605">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145611">p</span><span class="op" id="3145612">.</span><span class="ident" id="3145613">op</span><span class="op" id="3145615">(</span><span class="ident" id="3145616">opLeftParen</span><span class="op" id="3145627">)</span><span class="op" id="3145628">.</span><span class="ident" id="3145629">Cap</span>&nbsp;<span class="op" id="3145633">=</span>&nbsp;<span class="ident" id="3145635">p</span><span class="op" id="3145636">.</span><span class="ident" id="3145637">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145647">t</span>&nbsp;<span class="op" id="3145649">=</span>&nbsp;<span class="ident" id="3145651">t</span><span class="op" id="3145652">[</span><span class="num" id="3145653">1</span><span class="op" id="3145654">:</span><span class="op" id="3145655">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145659">case</span>&nbsp;<span class="string" id="3145664">&#39;|&#39;</span><span class="op" id="3145667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145672">if</span>&nbsp;<span class="ident" id="3145675">err</span>&nbsp;<span class="op" id="3145679">=</span>&nbsp;<span class="ident" id="3145681">p</span><span class="op" id="3145682">.</span><span class="ident" id="3145683">parseVerticalBar</span><span class="op" id="3145699">(</span><span class="op" id="3145700">)</span><span class="op" id="3145701">;</span>&nbsp;<span class="ident" id="3145703">err</span>&nbsp;<span class="op" id="3145707">!=</span>&nbsp;<span class="ident" id="3145710">nil</span>&nbsp;<span class="op" id="3145714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145720">return</span>&nbsp;<span class="ident" id="3145727">nil</span><span class="op" id="3145730">,</span>&nbsp;<span class="ident" id="3145732">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145744">t</span>&nbsp;<span class="op" id="3145746">=</span>&nbsp;<span class="ident" id="3145748">t</span><span class="op" id="3145749">[</span><span class="num" id="3145750">1</span><span class="op" id="3145751">:</span><span class="op" id="3145752">]</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145756">case</span>&nbsp;<span class="string" id="3145761">&#39;)&#39;</span><span class="op" id="3145764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145769">if</span>&nbsp;<span class="ident" id="3145772">err</span>&nbsp;<span class="op" id="3145776">=</span>&nbsp;<span class="ident" id="3145778">p</span><span class="op" id="3145779">.</span><span class="ident" id="3145780">parseRightParen</span><span class="op" id="3145795">(</span><span class="op" id="3145796">)</span><span class="op" id="3145797">;</span>&nbsp;<span class="ident" id="3145799">err</span>&nbsp;<span class="op" id="3145803">!=</span>&nbsp;<span class="ident" id="3145806">nil</span>&nbsp;<span class="op" id="3145810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145816">return</span>&nbsp;<span class="ident" id="3145823">nil</span><span class="op" id="3145826">,</span>&nbsp;<span class="ident" id="3145828">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145840">t</span>&nbsp;<span class="op" id="3145842">=</span>&nbsp;<span class="ident" id="3145844">t</span><span class="op" id="3145845">[</span><span class="num" id="3145846">1</span><span class="op" id="3145847">:</span><span class="op" id="3145848">]</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145852">case</span>&nbsp;<span class="string" id="3145857">&#39;^&#39;</span><span class="op" id="3145860">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145865">if</span>&nbsp;<span class="ident" id="3145868">p</span><span class="op" id="3145869">.</span><span class="ident" id="3145870">flags</span><span class="op" id="3145875">&amp;</span><span class="ident" id="3145876">OneLine</span>&nbsp;<span class="op" id="3145884">!=</span>&nbsp;<span class="num" id="3145887">0</span>&nbsp;<span class="op" id="3145889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145895">p</span><span class="op" id="3145896">.</span><span class="ident" id="3145897">op</span><span class="op" id="3145899">(</span><span class="ident" id="3145900">OpBeginText</span><span class="op" id="3145911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145916">}</span>&nbsp;<span class="keyword" id="3145918">else</span>&nbsp;<span class="op" id="3145923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145929">p</span><span class="op" id="3145930">.</span><span class="ident" id="3145931">op</span><span class="op" id="3145933">(</span><span class="ident" id="3145934">OpBeginLine</span><span class="op" id="3145945">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3145950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3145955">t</span>&nbsp;<span class="op" id="3145957">=</span>&nbsp;<span class="ident" id="3145959">t</span><span class="op" id="3145960">[</span><span class="num" id="3145961">1</span><span class="op" id="3145962">:</span><span class="op" id="3145963">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145967">case</span>&nbsp;<span class="string" id="3145972">&#39;$&#39;</span><span class="op" id="3145975">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3145980">if</span>&nbsp;<span class="ident" id="3145983">p</span><span class="op" id="3145984">.</span><span class="ident" id="3145985">flags</span><span class="op" id="3145990">&amp;</span><span class="ident" id="3145991">OneLine</span>&nbsp;<span class="op" id="3145999">!=</span>&nbsp;<span class="num" id="3146002">0</span>&nbsp;<span class="op" id="3146004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146010">p</span><span class="op" id="3146011">.</span><span class="ident" id="3146012">op</span><span class="op" id="3146014">(</span><span class="ident" id="3146015">OpEndText</span><span class="op" id="3146024">)</span><span class="op" id="3146025">.</span><span class="ident" id="3146026">Flags</span>&nbsp;<span class="op" id="3146032">|=</span>&nbsp;<span class="ident" id="3146035">WasDollar</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146048">}</span>&nbsp;<span class="keyword" id="3146050">else</span>&nbsp;<span class="op" id="3146055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146061">p</span><span class="op" id="3146062">.</span><span class="ident" id="3146063">op</span><span class="op" id="3146065">(</span><span class="ident" id="3146066">OpEndLine</span><span class="op" id="3146075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146085">t</span>&nbsp;<span class="op" id="3146087">=</span>&nbsp;<span class="ident" id="3146089">t</span><span class="op" id="3146090">[</span><span class="num" id="3146091">1</span><span class="op" id="3146092">:</span><span class="op" id="3146093">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146097">case</span>&nbsp;<span class="string" id="3146102">&#39;.&#39;</span><span class="op" id="3146105">:</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146110">if</span>&nbsp;<span class="ident" id="3146113">p</span><span class="op" id="3146114">.</span><span class="ident" id="3146115">flags</span><span class="op" id="3146120">&amp;</span><span class="ident" id="3146121">DotNL</span>&nbsp;<span class="op" id="3146127">!=</span>&nbsp;<span class="num" id="3146130">0</span>&nbsp;<span class="op" id="3146132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146138">p</span><span class="op" id="3146139">.</span><span class="ident" id="3146140">op</span><span class="op" id="3146142">(</span><span class="ident" id="3146143">OpAnyChar</span><span class="op" id="3146152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146157">}</span>&nbsp;<span class="keyword" id="3146159">else</span>&nbsp;<span class="op" id="3146164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146170">p</span><span class="op" id="3146171">.</span><span class="ident" id="3146172">op</span><span class="op" id="3146174">(</span><span class="ident" id="3146175">OpAnyCharNotNL</span><span class="op" id="3146189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146194">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146199">t</span>&nbsp;<span class="op" id="3146201">=</span>&nbsp;<span class="ident" id="3146203">t</span><span class="op" id="3146204">[</span><span class="num" id="3146205">1</span><span class="op" id="3146206">:</span><span class="op" id="3146207">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146211">case</span>&nbsp;<span class="string" id="3146216">&#39;[&#39;</span><span class="op" id="3146219">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146224">if</span>&nbsp;<span class="ident" id="3146227">t</span><span class="op" id="3146228">,</span>&nbsp;<span class="ident" id="3146230">err</span>&nbsp;<span class="op" id="3146234">=</span>&nbsp;<span class="ident" id="3146236">p</span><span class="op" id="3146237">.</span><span class="ident" id="3146238">parseClass</span><span class="op" id="3146248">(</span><span class="ident" id="3146249">t</span><span class="op" id="3146250">)</span><span class="op" id="3146251">;</span>&nbsp;<span class="ident" id="3146253">err</span>&nbsp;<span class="op" id="3146257">!=</span>&nbsp;<span class="ident" id="3146260">nil</span>&nbsp;<span class="op" id="3146264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146270">return</span>&nbsp;<span class="ident" id="3146277">nil</span><span class="op" id="3146280">,</span>&nbsp;<span class="ident" id="3146282">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146289">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146293">case</span>&nbsp;<span class="string" id="3146298">&#39;*&#39;</span><span class="op" id="3146301">,</span>&nbsp;<span class="string" id="3146303">&#39;+&#39;</span><span class="op" id="3146306">,</span>&nbsp;<span class="string" id="3146308">&#39;?&#39;</span><span class="op" id="3146311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146316">before</span>&nbsp;<span class="op" id="3146323">:=</span>&nbsp;<span class="ident" id="3146326">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146331">switch</span>&nbsp;<span class="ident" id="3146338">t</span><span class="op" id="3146339">[</span><span class="num" id="3146340">0</span><span class="op" id="3146341">]</span>&nbsp;<span class="op" id="3146343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146348">case</span>&nbsp;<span class="string" id="3146353">&#39;*&#39;</span><span class="op" id="3146356">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146362">op</span>&nbsp;<span class="op" id="3146365">=</span>&nbsp;<span class="ident" id="3146367">OpStar</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146377">case</span>&nbsp;<span class="string" id="3146382">&#39;+&#39;</span><span class="op" id="3146385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146391">op</span>&nbsp;<span class="op" id="3146394">=</span>&nbsp;<span class="ident" id="3146396">OpPlus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146406">case</span>&nbsp;<span class="string" id="3146411">&#39;?&#39;</span><span class="op" id="3146414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146420">op</span>&nbsp;<span class="op" id="3146423">=</span>&nbsp;<span class="ident" id="3146425">OpQuest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146436">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146441">after</span>&nbsp;<span class="op" id="3146447">:=</span>&nbsp;<span class="ident" id="3146450">t</span><span class="op" id="3146451">[</span><span class="num" id="3146452">1</span><span class="op" id="3146453">:</span><span class="op" id="3146454">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146459">if</span>&nbsp;<span class="ident" id="3146462">after</span><span class="op" id="3146467">,</span>&nbsp;<span class="ident" id="3146469">err</span>&nbsp;<span class="op" id="3146473">=</span>&nbsp;<span class="ident" id="3146475">p</span><span class="op" id="3146476">.</span><span class="ident" id="3146477">repeat</span><span class="op" id="3146483">(</span><span class="ident" id="3146484">op</span><span class="op" id="3146486">,</span>&nbsp;<span class="num" id="3146488">0</span><span class="op" id="3146489">,</span>&nbsp;<span class="num" id="3146491">0</span><span class="op" id="3146492">,</span>&nbsp;<span class="ident" id="3146494">before</span><span class="op" id="3146500">,</span>&nbsp;<span class="ident" id="3146502">after</span><span class="op" id="3146507">,</span>&nbsp;<span class="ident" id="3146509">lastRepeat</span><span class="op" id="3146519">)</span><span class="op" id="3146520">;</span>&nbsp;<span class="ident" id="3146522">err</span>&nbsp;<span class="op" id="3146526">!=</span>&nbsp;<span class="ident" id="3146529">nil</span>&nbsp;<span class="op" id="3146533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146539">return</span>&nbsp;<span class="ident" id="3146546">nil</span><span class="op" id="3146549">,</span>&nbsp;<span class="ident" id="3146551">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146563">repeat</span>&nbsp;<span class="op" id="3146570">=</span>&nbsp;<span class="ident" id="3146572">before</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146582">t</span>&nbsp;<span class="op" id="3146584">=</span>&nbsp;<span class="ident" id="3146586">after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146594">case</span>&nbsp;<span class="string" id="3146599">&#39;{&#39;</span><span class="op" id="3146602">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146607">op</span>&nbsp;<span class="op" id="3146610">=</span>&nbsp;<span class="ident" id="3146612">OpRepeat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146624">before</span>&nbsp;<span class="op" id="3146631">:=</span>&nbsp;<span class="ident" id="3146634">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146639">min</span><span class="op" id="3146642">,</span>&nbsp;<span class="ident" id="3146644">max</span><span class="op" id="3146647">,</span>&nbsp;<span class="ident" id="3146649">after</span><span class="op" id="3146654">,</span>&nbsp;<span class="ident" id="3146656">ok</span>&nbsp;<span class="op" id="3146659">:=</span>&nbsp;<span class="ident" id="3146662">p</span><span class="op" id="3146663">.</span><span class="ident" id="3146664">parseRepeat</span><span class="op" id="3146675">(</span><span class="ident" id="3146676">t</span><span class="op" id="3146677">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146682">if</span>&nbsp;<span class="op" id="3146685">!</span><span class="ident" id="3146686">ok</span>&nbsp;<span class="op" id="3146689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3146695">//&nbsp;If&nbsp;the&nbsp;repeat&nbsp;cannot&nbsp;be&nbsp;parsed,&nbsp;{&nbsp;is&nbsp;a&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146750">p</span><span class="op" id="3146751">.</span><span class="ident" id="3146752">literal</span><span class="op" id="3146759">(</span><span class="string" id="3146760">&#39;{&#39;</span><span class="op" id="3146763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3146769">t</span>&nbsp;<span class="op" id="3146771">=</span>&nbsp;<span class="ident" id="3146773">t</span><span class="op" id="3146774">[</span><span class="num" id="3146775">1</span><span class="op" id="3146776">:</span><span class="op" id="3146777">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146783">break</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3146792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146797">if</span>&nbsp;<span class="ident" id="3146800">min</span>&nbsp;<span class="op" id="3146804">&lt;</span>&nbsp;<span class="num" id="3146806">0</span>&nbsp;<span class="op" id="3146808">||</span>&nbsp;<span class="ident" id="3146811">min</span>&nbsp;<span class="op" id="3146815">&gt;</span>&nbsp;<span class="num" id="3146817">1000</span>&nbsp;<span class="op" id="3146822">||</span>&nbsp;<span class="ident" id="3146825">max</span>&nbsp;<span class="op" id="3146829">&gt;</span>&nbsp;<span class="num" id="3146831">1000</span>&nbsp;<span class="op" id="3146836">||</span>&nbsp;<span class="ident" id="3146839">max</span>&nbsp;<span class="op" id="3146843">&gt;=</span>&nbsp;<span class="num" id="3146846">0</span>&nbsp;<span class="op" id="3146848">&amp;&amp;</span>&nbsp;<span class="ident" id="3146851">min</span>&nbsp;<span class="op" id="3146855">&gt;</span>&nbsp;<span class="ident" id="3146857">max</span>&nbsp;<span class="op" id="3146861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3146867">//&nbsp;Numbers&nbsp;were&nbsp;too&nbsp;big,&nbsp;or&nbsp;max&nbsp;is&nbsp;present&nbsp;and&nbsp;min&nbsp;&gt;&nbsp;max.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3146929">return</span>&nbsp;<span class="ident" id="3146936">nil</span><span class="op" id="3146939">,</span>&nbsp;<span class="op" id="3146941">&amp;</span><span class="ident" id="3146942">Error</span><span class="op" id="3146947">{</span><span class="ident" id="3146948">ErrInvalidRepeatSize</span><span class="op" id="3146968">,</span>&nbsp;<span class="ident" id="3146970">before</span><span class="op" id="3146976">[</span><span class="op" id="3146977">:</span><span class="builtinfunc" id="3146978">len</span><span class="op" id="3146981">(</span><span class="ident" id="3146982">before</span><span class="op" id="3146988">)</span><span class="op" id="3146989">-</span><span class="builtinfunc" id="3146990">len</span><span class="op" id="3146993">(</span><span class="ident" id="3146994">after</span><span class="op" id="3146999">)</span><span class="op" id="3147000">]</span><span class="op" id="3147001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3147006">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147011">if</span>&nbsp;<span class="ident" id="3147014">after</span><span class="op" id="3147019">,</span>&nbsp;<span class="ident" id="3147021">err</span>&nbsp;<span class="op" id="3147025">=</span>&nbsp;<span class="ident" id="3147027">p</span><span class="op" id="3147028">.</span><span class="ident" id="3147029">repeat</span><span class="op" id="3147035">(</span><span class="ident" id="3147036">op</span><span class="op" id="3147038">,</span>&nbsp;<span class="ident" id="3147040">min</span><span class="op" id="3147043">,</span>&nbsp;<span class="ident" id="3147045">max</span><span class="op" id="3147048">,</span>&nbsp;<span class="ident" id="3147050">before</span><span class="op" id="3147056">,</span>&nbsp;<span class="ident" id="3147058">after</span><span class="op" id="3147063">,</span>&nbsp;<span class="ident" id="3147065">lastRepeat</span><span class="op" id="3147075">)</span><span class="op" id="3147076">;</span>&nbsp;<span class="ident" id="3147078">err</span>&nbsp;<span class="op" id="3147082">!=</span>&nbsp;<span class="ident" id="3147085">nil</span>&nbsp;<span class="op" id="3147089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147095">return</span>&nbsp;<span class="ident" id="3147102">nil</span><span class="op" id="3147105">,</span>&nbsp;<span class="ident" id="3147107">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3147114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147119">repeat</span>&nbsp;<span class="op" id="3147126">=</span>&nbsp;<span class="ident" id="3147128">before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147138">t</span>&nbsp;<span class="op" id="3147140">=</span>&nbsp;<span class="ident" id="3147142">after</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147150">case</span>&nbsp;<span class="string" id="3147155">&#39;\\&#39;</span><span class="op" id="3147159">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147164">if</span>&nbsp;<span class="ident" id="3147167">p</span><span class="op" id="3147168">.</span><span class="ident" id="3147169">flags</span><span class="op" id="3147174">&amp;</span><span class="ident" id="3147175">PerlX</span>&nbsp;<span class="op" id="3147181">!=</span>&nbsp;<span class="num" id="3147184">0</span>&nbsp;<span class="op" id="3147186">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3147189">len</span><span class="op" id="3147192">(</span><span class="ident" id="3147193">t</span><span class="op" id="3147194">)</span>&nbsp;<span class="op" id="3147196">&gt;=</span>&nbsp;<span class="num" id="3147199">2</span>&nbsp;<span class="op" id="3147201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147207">switch</span>&nbsp;<span class="ident" id="3147214">t</span><span class="op" id="3147215">[</span><span class="num" id="3147216">1</span><span class="op" id="3147217">]</span>&nbsp;<span class="op" id="3147219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147225">case</span>&nbsp;<span class="string" id="3147230">&#39;A&#39;</span><span class="op" id="3147233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147240">p</span><span class="op" id="3147241">.</span><span class="ident" id="3147242">op</span><span class="op" id="3147244">(</span><span class="ident" id="3147245">OpBeginText</span><span class="op" id="3147256">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147263">t</span>&nbsp;<span class="op" id="3147265">=</span>&nbsp;<span class="ident" id="3147267">t</span><span class="op" id="3147268">[</span><span class="num" id="3147269">2</span><span class="op" id="3147270">:</span><span class="op" id="3147271">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147278">break</span>&nbsp;<span class="ident" id="3147284">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147298">case</span>&nbsp;<span class="string" id="3147303">&#39;b&#39;</span><span class="op" id="3147306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147313">p</span><span class="op" id="3147314">.</span><span class="ident" id="3147315">op</span><span class="op" id="3147317">(</span><span class="ident" id="3147318">OpWordBoundary</span><span class="op" id="3147332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147339">t</span>&nbsp;<span class="op" id="3147341">=</span>&nbsp;<span class="ident" id="3147343">t</span><span class="op" id="3147344">[</span><span class="num" id="3147345">2</span><span class="op" id="3147346">:</span><span class="op" id="3147347">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147354">break</span>&nbsp;<span class="ident" id="3147360">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147374">case</span>&nbsp;<span class="string" id="3147379">&#39;B&#39;</span><span class="op" id="3147382">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147389">p</span><span class="op" id="3147390">.</span><span class="ident" id="3147391">op</span><span class="op" id="3147393">(</span><span class="ident" id="3147394">OpNoWordBoundary</span><span class="op" id="3147410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147417">t</span>&nbsp;<span class="op" id="3147419">=</span>&nbsp;<span class="ident" id="3147421">t</span><span class="op" id="3147422">[</span><span class="num" id="3147423">2</span><span class="op" id="3147424">:</span><span class="op" id="3147425">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147432">break</span>&nbsp;<span class="ident" id="3147438">BigSwitch</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147452">case</span>&nbsp;<span class="string" id="3147457">&#39;C&#39;</span><span class="op" id="3147460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147467">//&nbsp;any&nbsp;byte;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147499">return</span>&nbsp;<span class="ident" id="3147506">nil</span><span class="op" id="3147509">,</span>&nbsp;<span class="op" id="3147511">&amp;</span><span class="ident" id="3147512">Error</span><span class="op" id="3147517">{</span><span class="ident" id="3147518">ErrInvalidEscape</span><span class="op" id="3147534">,</span>&nbsp;<span class="ident" id="3147536">t</span><span class="op" id="3147537">[</span><span class="op" id="3147538">:</span><span class="num" id="3147539">2</span><span class="op" id="3147540">]</span><span class="op" id="3147541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147547">case</span>&nbsp;<span class="string" id="3147552">&#39;Q&#39;</span><span class="op" id="3147555">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147562">//&nbsp;\Q&nbsp;...&nbsp;\E:&nbsp;the&nbsp;...&nbsp;is&nbsp;always&nbsp;literals</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147608">var</span>&nbsp;<span class="ident" id="3147612">lit</span>&nbsp;<span class="builtintype" id="3147616">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147628">if</span>&nbsp;<span class="ident" id="3147631">i</span>&nbsp;<span class="op" id="3147633">:=</span>&nbsp;<span class="ident" id="3147636">strings</span><span class="op" id="3147643">.</span><span class="ident" id="3147644">Index</span><span class="op" id="3147649">(</span><span class="ident" id="3147650">t</span><span class="op" id="3147651">,</span>&nbsp;<span class="string" id="3147653">`\E`</span><span class="op" id="3147657">)</span><span class="op" id="3147658">;</span>&nbsp;<span class="ident" id="3147660">i</span>&nbsp;<span class="op" id="3147662">&lt;</span>&nbsp;<span class="num" id="3147664">0</span>&nbsp;<span class="op" id="3147666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147674">lit</span>&nbsp;<span class="op" id="3147678">=</span>&nbsp;<span class="ident" id="3147680">t</span><span class="op" id="3147681">[</span><span class="num" id="3147682">2</span><span class="op" id="3147683">:</span><span class="op" id="3147684">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147692">t</span>&nbsp;<span class="op" id="3147694">=</span>&nbsp;<span class="string" id="3147696">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3147704">}</span>&nbsp;<span class="keyword" id="3147706">else</span>&nbsp;<span class="op" id="3147711">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147719">lit</span>&nbsp;<span class="op" id="3147723">=</span>&nbsp;<span class="ident" id="3147725">t</span><span class="op" id="3147726">[</span><span class="num" id="3147727">2</span><span class="op" id="3147728">:</span><span class="ident" id="3147729">i</span><span class="op" id="3147730">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147738">t</span>&nbsp;<span class="op" id="3147740">=</span>&nbsp;<span class="ident" id="3147742">t</span><span class="op" id="3147743">[</span><span class="ident" id="3147744">i</span><span class="op" id="3147745">+</span><span class="num" id="3147746">2</span><span class="op" id="3147747">:</span><span class="op" id="3147748">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3147755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147762">p</span><span class="op" id="3147763">.</span><span class="ident" id="3147764">push</span><span class="op" id="3147768">(</span><span class="ident" id="3147769">literalRegexp</span><span class="op" id="3147782">(</span><span class="ident" id="3147783">lit</span><span class="op" id="3147786">,</span>&nbsp;<span class="ident" id="3147788">p</span><span class="op" id="3147789">.</span><span class="ident" id="3147790">flags</span><span class="op" id="3147795">)</span><span class="op" id="3147796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147803">break</span>&nbsp;<span class="ident" id="3147809">BigSwitch</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147823">case</span>&nbsp;<span class="string" id="3147828">&#39;z&#39;</span><span class="op" id="3147831">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147838">p</span><span class="op" id="3147839">.</span><span class="ident" id="3147840">op</span><span class="op" id="3147842">(</span><span class="ident" id="3147843">OpEndText</span><span class="op" id="3147852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147859">t</span>&nbsp;<span class="op" id="3147861">=</span>&nbsp;<span class="ident" id="3147863">t</span><span class="op" id="3147864">[</span><span class="num" id="3147865">2</span><span class="op" id="3147866">:</span><span class="op" id="3147867">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3147874">break</span>&nbsp;<span class="ident" id="3147880">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3147894">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3147899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147905">re</span>&nbsp;<span class="op" id="3147908">:=</span>&nbsp;<span class="ident" id="3147911">p</span><span class="op" id="3147912">.</span><span class="ident" id="3147913">newRegexp</span><span class="op" id="3147922">(</span><span class="ident" id="3147923">OpCharClass</span><span class="op" id="3147934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3147939">re</span><span class="op" id="3147941">.</span><span class="ident" id="3147942">Flags</span>&nbsp;<span class="op" id="3147948">=</span>&nbsp;<span class="ident" id="3147950">p</span><span class="op" id="3147951">.</span><span class="ident" id="3147952">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3147962">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148014">if</span>&nbsp;<span class="builtinfunc" id="3148017">len</span><span class="op" id="3148020">(</span><span class="ident" id="3148021">t</span><span class="op" id="3148022">)</span>&nbsp;<span class="op" id="3148024">&gt;=</span>&nbsp;<span class="num" id="3148027">2</span>&nbsp;<span class="op" id="3148029">&amp;&amp;</span>&nbsp;<span class="op" id="3148032">(</span><span class="ident" id="3148033">t</span><span class="op" id="3148034">[</span><span class="num" id="3148035">1</span><span class="op" id="3148036">]</span>&nbsp;<span class="op" id="3148038">==</span>&nbsp;<span class="string" id="3148041">&#39;p&#39;</span>&nbsp;<span class="op" id="3148045">||</span>&nbsp;<span class="ident" id="3148048">t</span><span class="op" id="3148049">[</span><span class="num" id="3148050">1</span><span class="op" id="3148051">]</span>&nbsp;<span class="op" id="3148053">==</span>&nbsp;<span class="string" id="3148056">&#39;P&#39;</span><span class="op" id="3148059">)</span>&nbsp;<span class="op" id="3148061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148067">r</span><span class="op" id="3148068">,</span>&nbsp;<span class="ident" id="3148070">rest</span><span class="op" id="3148074">,</span>&nbsp;<span class="ident" id="3148076">err</span>&nbsp;<span class="op" id="3148080">:=</span>&nbsp;<span class="ident" id="3148083">p</span><span class="op" id="3148084">.</span><span class="ident" id="3148085">parseUnicodeClass</span><span class="op" id="3148102">(</span><span class="ident" id="3148103">t</span><span class="op" id="3148104">,</span>&nbsp;<span class="ident" id="3148106">re</span><span class="op" id="3148108">.</span><span class="ident" id="3148109">Rune0</span><span class="op" id="3148114">[</span><span class="op" id="3148115">:</span><span class="num" id="3148116">0</span><span class="op" id="3148117">]</span><span class="op" id="3148118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148124">if</span>&nbsp;<span class="ident" id="3148127">err</span>&nbsp;<span class="op" id="3148131">!=</span>&nbsp;<span class="ident" id="3148134">nil</span>&nbsp;<span class="op" id="3148138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148145">return</span>&nbsp;<span class="ident" id="3148152">nil</span><span class="op" id="3148155">,</span>&nbsp;<span class="ident" id="3148157">err</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148171">if</span>&nbsp;<span class="ident" id="3148174">r</span>&nbsp;<span class="op" id="3148176">!=</span>&nbsp;<span class="ident" id="3148179">nil</span>&nbsp;<span class="op" id="3148183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148190">re</span><span class="op" id="3148192">.</span><span class="ident" id="3148193">Rune</span>&nbsp;<span class="op" id="3148198">=</span>&nbsp;<span class="ident" id="3148200">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148207">t</span>&nbsp;<span class="op" id="3148209">=</span>&nbsp;<span class="ident" id="3148211">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148221">p</span><span class="op" id="3148222">.</span><span class="ident" id="3148223">push</span><span class="op" id="3148227">(</span><span class="ident" id="3148228">re</span><span class="op" id="3148230">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148237">break</span>&nbsp;<span class="ident" id="3148243">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3148268">//&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148303">if</span>&nbsp;<span class="ident" id="3148306">r</span><span class="op" id="3148307">,</span>&nbsp;<span class="ident" id="3148309">rest</span>&nbsp;<span class="op" id="3148314">:=</span>&nbsp;<span class="ident" id="3148317">p</span><span class="op" id="3148318">.</span><span class="ident" id="3148319">parsePerlClassEscape</span><span class="op" id="3148339">(</span><span class="ident" id="3148340">t</span><span class="op" id="3148341">,</span>&nbsp;<span class="ident" id="3148343">re</span><span class="op" id="3148345">.</span><span class="ident" id="3148346">Rune0</span><span class="op" id="3148351">[</span><span class="op" id="3148352">:</span><span class="num" id="3148353">0</span><span class="op" id="3148354">]</span><span class="op" id="3148355">)</span><span class="op" id="3148356">;</span>&nbsp;<span class="ident" id="3148358">r</span>&nbsp;<span class="op" id="3148360">!=</span>&nbsp;<span class="ident" id="3148363">nil</span>&nbsp;<span class="op" id="3148367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148373">re</span><span class="op" id="3148375">.</span><span class="ident" id="3148376">Rune</span>&nbsp;<span class="op" id="3148381">=</span>&nbsp;<span class="ident" id="3148383">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148389">t</span>&nbsp;<span class="op" id="3148391">=</span>&nbsp;<span class="ident" id="3148393">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148402">p</span><span class="op" id="3148403">.</span><span class="ident" id="3148404">push</span><span class="op" id="3148408">(</span><span class="ident" id="3148409">re</span><span class="op" id="3148411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148417">break</span>&nbsp;<span class="ident" id="3148423">BigSwitch</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148441">p</span><span class="op" id="3148442">.</span><span class="ident" id="3148443">reuse</span><span class="op" id="3148448">(</span><span class="ident" id="3148449">re</span><span class="op" id="3148451">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3148457">//&nbsp;Ordinary&nbsp;single-character&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148497">if</span>&nbsp;<span class="ident" id="3148500">c</span><span class="op" id="3148501">,</span>&nbsp;<span class="ident" id="3148503">t</span><span class="op" id="3148504">,</span>&nbsp;<span class="ident" id="3148506">err</span>&nbsp;<span class="op" id="3148510">=</span>&nbsp;<span class="ident" id="3148512">p</span><span class="op" id="3148513">.</span><span class="ident" id="3148514">parseEscape</span><span class="op" id="3148525">(</span><span class="ident" id="3148526">t</span><span class="op" id="3148527">)</span><span class="op" id="3148528">;</span>&nbsp;<span class="ident" id="3148530">err</span>&nbsp;<span class="op" id="3148534">!=</span>&nbsp;<span class="ident" id="3148537">nil</span>&nbsp;<span class="op" id="3148541">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148547">return</span>&nbsp;<span class="ident" id="3148554">nil</span><span class="op" id="3148557">,</span>&nbsp;<span class="ident" id="3148559">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148571">p</span><span class="op" id="3148572">.</span><span class="ident" id="3148573">literal</span><span class="op" id="3148580">(</span><span class="ident" id="3148581">c</span><span class="op" id="3148582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148590">lastRepeat</span>&nbsp;<span class="op" id="3148601">=</span>&nbsp;<span class="ident" id="3148603">repeat</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148615">p</span><span class="op" id="3148616">.</span><span class="ident" id="3148617">concat</span><span class="op" id="3148623">(</span><span class="op" id="3148624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148627">if</span>&nbsp;<span class="ident" id="3148630">p</span><span class="op" id="3148631">.</span><span class="ident" id="3148632">swapVerticalBar</span><span class="op" id="3148647">(</span><span class="op" id="3148648">)</span>&nbsp;<span class="op" id="3148650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3148654">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148676">p</span><span class="op" id="3148677">.</span><span class="ident" id="3148678">stack</span>&nbsp;<span class="op" id="3148684">=</span>&nbsp;<span class="ident" id="3148686">p</span><span class="op" id="3148687">.</span><span class="ident" id="3148688">stack</span><span class="op" id="3148693">[</span><span class="op" id="3148694">:</span><span class="builtinfunc" id="3148695">len</span><span class="op" id="3148698">(</span><span class="ident" id="3148699">p</span><span class="op" id="3148700">.</span><span class="ident" id="3148701">stack</span><span class="op" id="3148706">)</span><span class="op" id="3148707">-</span><span class="num" id="3148708">1</span><span class="op" id="3148709">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148715">p</span><span class="op" id="3148716">.</span><span class="ident" id="3148717">alternate</span><span class="op" id="3148726">(</span><span class="op" id="3148727">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3148731">n</span>&nbsp;<span class="op" id="3148733">:=</span>&nbsp;<span class="builtinfunc" id="3148736">len</span><span class="op" id="3148739">(</span><span class="ident" id="3148740">p</span><span class="op" id="3148741">.</span><span class="ident" id="3148742">stack</span><span class="op" id="3148747">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148750">if</span>&nbsp;<span class="ident" id="3148753">n</span>&nbsp;<span class="op" id="3148755">!=</span>&nbsp;<span class="num" id="3148758">1</span>&nbsp;<span class="op" id="3148760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148764">return</span>&nbsp;<span class="ident" id="3148771">nil</span><span class="op" id="3148774">,</span>&nbsp;<span class="op" id="3148776">&amp;</span><span class="ident" id="3148777">Error</span><span class="op" id="3148782">{</span><span class="ident" id="3148783">ErrMissingParen</span><span class="op" id="3148798">,</span>&nbsp;<span class="ident" id="3148800">s</span><span class="op" id="3148801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3148804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3148807">return</span>&nbsp;<span class="ident" id="3148814">p</span><span class="op" id="3148815">.</span><span class="ident" id="3148816">stack</span><span class="op" id="3148821">[</span><span class="num" id="3148822">0</span><span class="op" id="3148823">]</span><span class="op" id="3148824">,</span>&nbsp;<span class="ident" id="3148826">nil</span><br>
<span class="lineno"></span><span class="op" id="3148830">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span><span class="comment" id="3148833">//&nbsp;parseRepeat&nbsp;parses&nbsp;{min}&nbsp;(max=min)&nbsp;or&nbsp;{min,}&nbsp;(max=-1)&nbsp;or&nbsp;{min,max}.</span><br>
<span class="lineno"></span><span class="comment" id="3148904">//&nbsp;If&nbsp;s&nbsp;is&nbsp;not&nbsp;of&nbsp;that&nbsp;form,&nbsp;it&nbsp;returns&nbsp;ok&nbsp;==&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3148957">//&nbsp;If&nbsp;s&nbsp;has&nbsp;the&nbsp;right&nbsp;form&nbsp;but&nbsp;the&nbsp;values&nbsp;are&nbsp;too&nbsp;big,&nbsp;it&nbsp;returns&nbsp;min&nbsp;==&nbsp;-1,&nbsp;ok&nbsp;==&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="3149046">func</span>&nbsp;<span class="op" id="3149051">(</span><span class="ident" id="3149052">p</span>&nbsp;<span class="op" id="3149054">*</span><span class="ident" id="3149055">parser</span><span class="op" id="3149061">)</span>&nbsp;<span class="ident" id="3149063">parseRepeat</span><span class="op" id="3149074">(</span><span class="ident" id="3149075">s</span>&nbsp;<span class="builtintype" id="3149077">string</span><span class="op" id="3149083">)</span>&nbsp;<span class="op" id="3149085">(</span><span class="ident" id="3149086">min</span><span class="op" id="3149089">,</span>&nbsp;<span class="ident" id="3149091">max</span>&nbsp;<span class="builtintype" id="3149095">int</span><span class="op" id="3149098">,</span>&nbsp;<span class="ident" id="3149100">rest</span>&nbsp;<span class="builtintype" id="3149105">string</span><span class="op" id="3149111">,</span>&nbsp;<span class="ident" id="3149113">ok</span>&nbsp;<span class="builtintype" id="3149116">bool</span><span class="op" id="3149120">)</span>&nbsp;<span class="op" id="3149122">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149125">if</span>&nbsp;<span class="ident" id="3149128">s</span>&nbsp;<span class="op" id="3149130">==</span>&nbsp;<span class="string" id="3149133">&#34;&#34;</span>&nbsp;<span class="op" id="3149136">||</span>&nbsp;<span class="ident" id="3149139">s</span><span class="op" id="3149140">[</span><span class="num" id="3149141">0</span><span class="op" id="3149142">]</span>&nbsp;<span class="op" id="3149144">!=</span>&nbsp;<span class="string" id="3149147">&#39;{&#39;</span>&nbsp;<span class="op" id="3149151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149155">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149166">s</span>&nbsp;<span class="op" id="3149168">=</span>&nbsp;<span class="ident" id="3149170">s</span><span class="op" id="3149171">[</span><span class="num" id="3149172">1</span><span class="op" id="3149173">:</span><span class="op" id="3149174">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149177">var</span>&nbsp;<span class="ident" id="3149181">ok1</span>&nbsp;<span class="builtintype" id="3149185">bool</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149191">if</span>&nbsp;<span class="ident" id="3149194">min</span><span class="op" id="3149197">,</span>&nbsp;<span class="ident" id="3149199">s</span><span class="op" id="3149200">,</span>&nbsp;<span class="ident" id="3149202">ok1</span>&nbsp;<span class="op" id="3149206">=</span>&nbsp;<span class="ident" id="3149208">p</span><span class="op" id="3149209">.</span><span class="ident" id="3149210">parseInt</span><span class="op" id="3149218">(</span><span class="ident" id="3149219">s</span><span class="op" id="3149220">)</span><span class="op" id="3149221">;</span>&nbsp;<span class="op" id="3149223">!</span><span class="ident" id="3149224">ok1</span>&nbsp;<span class="op" id="3149228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149232">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149243">if</span>&nbsp;<span class="ident" id="3149246">s</span>&nbsp;<span class="op" id="3149248">==</span>&nbsp;<span class="string" id="3149251">&#34;&#34;</span>&nbsp;<span class="op" id="3149254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149258">return</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149269">if</span>&nbsp;<span class="ident" id="3149272">s</span><span class="op" id="3149273">[</span><span class="num" id="3149274">0</span><span class="op" id="3149275">]</span>&nbsp;<span class="op" id="3149277">!=</span>&nbsp;<span class="string" id="3149280">&#39;,&#39;</span>&nbsp;<span class="op" id="3149284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149288">max</span>&nbsp;<span class="op" id="3149292">=</span>&nbsp;<span class="ident" id="3149294">min</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149299">}</span>&nbsp;<span class="keyword" id="3149301">else</span>&nbsp;<span class="op" id="3149306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149310">s</span>&nbsp;<span class="op" id="3149312">=</span>&nbsp;<span class="ident" id="3149314">s</span><span class="op" id="3149315">[</span><span class="num" id="3149316">1</span><span class="op" id="3149317">:</span><span class="op" id="3149318">]</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149322">if</span>&nbsp;<span class="ident" id="3149325">s</span>&nbsp;<span class="op" id="3149327">==</span>&nbsp;<span class="string" id="3149330">&#34;&#34;</span>&nbsp;<span class="op" id="3149333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149338">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149351">if</span>&nbsp;<span class="ident" id="3149354">s</span><span class="op" id="3149355">[</span><span class="num" id="3149356">0</span><span class="op" id="3149357">]</span>&nbsp;<span class="op" id="3149359">==</span>&nbsp;<span class="string" id="3149362">&#39;}&#39;</span>&nbsp;<span class="op" id="3149366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149371">max</span>&nbsp;<span class="op" id="3149375">=</span>&nbsp;<span class="op" id="3149377">-</span><span class="num" id="3149378">1</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149382">}</span>&nbsp;<span class="keyword" id="3149384">else</span>&nbsp;<span class="keyword" id="3149389">if</span>&nbsp;<span class="ident" id="3149392">max</span><span class="op" id="3149395">,</span>&nbsp;<span class="ident" id="3149397">s</span><span class="op" id="3149398">,</span>&nbsp;<span class="ident" id="3149400">ok1</span>&nbsp;<span class="op" id="3149404">=</span>&nbsp;<span class="ident" id="3149406">p</span><span class="op" id="3149407">.</span><span class="ident" id="3149408">parseInt</span><span class="op" id="3149416">(</span><span class="ident" id="3149417">s</span><span class="op" id="3149418">)</span><span class="op" id="3149419">;</span>&nbsp;<span class="op" id="3149421">!</span><span class="ident" id="3149422">ok1</span>&nbsp;<span class="op" id="3149426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149431">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149440">}</span>&nbsp;<span class="keyword" id="3149442">else</span>&nbsp;<span class="keyword" id="3149447">if</span>&nbsp;<span class="ident" id="3149450">max</span>&nbsp;<span class="op" id="3149454">&lt;</span>&nbsp;<span class="num" id="3149456">0</span>&nbsp;<span class="op" id="3149458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3149463">//&nbsp;parseInt&nbsp;found&nbsp;too&nbsp;big&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149501">min</span>&nbsp;<span class="op" id="3149505">=</span>&nbsp;<span class="op" id="3149507">-</span><span class="num" id="3149508">1</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149518">if</span>&nbsp;<span class="ident" id="3149521">s</span>&nbsp;<span class="op" id="3149523">==</span>&nbsp;<span class="string" id="3149526">&#34;&#34;</span>&nbsp;<span class="op" id="3149529">||</span>&nbsp;<span class="ident" id="3149532">s</span><span class="op" id="3149533">[</span><span class="num" id="3149534">0</span><span class="op" id="3149535">]</span>&nbsp;<span class="op" id="3149537">!=</span>&nbsp;<span class="string" id="3149540">&#39;}&#39;</span>&nbsp;<span class="op" id="3149544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149548">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3149556">}</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149559">rest</span>&nbsp;<span class="op" id="3149564">=</span>&nbsp;<span class="ident" id="3149566">s</span><span class="op" id="3149567">[</span><span class="num" id="3149568">1</span><span class="op" id="3149569">:</span><span class="op" id="3149570">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149573">ok</span>&nbsp;<span class="op" id="3149576">=</span>&nbsp;<span class="builtintype" id="3149578">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3149584">return</span><br>
<span class="lineno"></span><span class="op" id="3149591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span><span class="comment" id="3149594">//&nbsp;parsePerlFlags&nbsp;parses&nbsp;a&nbsp;Perl&nbsp;flag&nbsp;setting&nbsp;or&nbsp;non-capturing&nbsp;group&nbsp;or&nbsp;both,</span><br>
<span class="lineno"></span><span class="comment" id="3149671">//&nbsp;like&nbsp;(?i)&nbsp;or&nbsp;(?:&nbsp;or&nbsp;(?i:.&nbsp;&nbsp;It&nbsp;removes&nbsp;the&nbsp;prefix&nbsp;from&nbsp;s&nbsp;and&nbsp;updates&nbsp;the&nbsp;parse&nbsp;state.</span><br>
<span class="lineno"></span><span class="comment" id="3149759">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;have&nbsp;ensured&nbsp;that&nbsp;s&nbsp;begins&nbsp;with&nbsp;&#34;(?&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3149816">func</span>&nbsp;<span class="op" id="3149821">(</span><span class="ident" id="3149822">p</span>&nbsp;<span class="op" id="3149824">*</span><span class="ident" id="3149825">parser</span><span class="op" id="3149831">)</span>&nbsp;<span class="ident" id="3149833">parsePerlFlags</span><span class="op" id="3149847">(</span><span class="ident" id="3149848">s</span>&nbsp;<span class="builtintype" id="3149850">string</span><span class="op" id="3149856">)</span>&nbsp;<span class="op" id="3149858">(</span><span class="ident" id="3149859">rest</span>&nbsp;<span class="builtintype" id="3149864">string</span><span class="op" id="3149870">,</span>&nbsp;<span class="ident" id="3149872">err</span>&nbsp;<span class="builtintype" id="3149876">error</span><span class="op" id="3149881">)</span>&nbsp;<span class="op" id="3149883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3149886">t</span>&nbsp;<span class="op" id="3149888">:=</span>&nbsp;<span class="ident" id="3149891">s</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3149895">//&nbsp;Check&nbsp;for&nbsp;named&nbsp;captures,&nbsp;first&nbsp;introduced&nbsp;in&nbsp;Python&#39;s&nbsp;regexp&nbsp;library.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3149970">//&nbsp;As&nbsp;usual,&nbsp;there&nbsp;are&nbsp;three&nbsp;slightly&nbsp;different&nbsp;syntaxes:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3150029">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3150033">//&nbsp;&nbsp;&nbsp;(?P&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;the&nbsp;original,&nbsp;introduced&nbsp;by&nbsp;Python</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3150091">//&nbsp;&nbsp;&nbsp;(?&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3150156">//&nbsp;&nbsp;&nbsp;(?&#39;name&#39;expr)&nbsp;&nbsp;&nbsp;&nbsp;another&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3150225">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3150229">//&nbsp;Perl&nbsp;5.10&nbsp;gave&nbsp;in&nbsp;and&nbsp;implemented&nbsp;the&nbsp;Python&nbsp;version&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3150291">//&nbsp;but&nbsp;they&nbsp;claim&nbsp;that&nbsp;the&nbsp;last&nbsp;two&nbsp;are&nbsp;the&nbsp;preferred&nbsp;forms.</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3150353">//&nbsp;PCRE&nbsp;and&nbsp;languages&nbsp;based&nbsp;on&nbsp;it&nbsp;(specifically,&nbsp;PHP&nbsp;and&nbsp;Ruby)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3150417">//&nbsp;support&nbsp;all&nbsp;three&nbsp;as&nbsp;well.&nbsp;&nbsp;EcmaScript&nbsp;4&nbsp;uses&nbsp;only&nbsp;the&nbsp;Python&nbsp;form.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3150489">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3150493">//&nbsp;In&nbsp;both&nbsp;the&nbsp;open&nbsp;source&nbsp;world&nbsp;(via&nbsp;Code&nbsp;Search)&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3150553">//&nbsp;Google&nbsp;source&nbsp;tree,&nbsp;(?P&lt;expr&gt;name)&nbsp;is&nbsp;the&nbsp;dominant&nbsp;form,</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3150614">//&nbsp;so&nbsp;that&#39;s&nbsp;the&nbsp;one&nbsp;we&nbsp;implement.&nbsp;&nbsp;One&nbsp;is&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150666">if</span>&nbsp;<span class="builtinfunc" id="3150669">len</span><span class="op" id="3150672">(</span><span class="ident" id="3150673">t</span><span class="op" id="3150674">)</span>&nbsp;<span class="op" id="3150676">&gt;</span>&nbsp;<span class="num" id="3150678">4</span>&nbsp;<span class="op" id="3150680">&amp;&amp;</span>&nbsp;<span class="ident" id="3150683">t</span><span class="op" id="3150684">[</span><span class="num" id="3150685">2</span><span class="op" id="3150686">]</span>&nbsp;<span class="op" id="3150688">==</span>&nbsp;<span class="string" id="3150691">&#39;P&#39;</span>&nbsp;<span class="op" id="3150695">&amp;&amp;</span>&nbsp;<span class="ident" id="3150698">t</span><span class="op" id="3150699">[</span><span class="num" id="3150700">3</span><span class="op" id="3150701">]</span>&nbsp;<span class="op" id="3150703">==</span>&nbsp;<span class="string" id="3150706">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="3150710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3150714">//&nbsp;Pull&nbsp;out&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150734">end</span>&nbsp;<span class="op" id="3150738">:=</span>&nbsp;<span class="ident" id="3150741">strings</span><span class="op" id="3150748">.</span><span class="ident" id="3150749">IndexRune</span><span class="op" id="3150758">(</span><span class="ident" id="3150759">t</span><span class="op" id="3150760">,</span>&nbsp;<span class="string" id="3150762">&#39;&gt;&#39;</span><span class="op" id="3150765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150769">if</span>&nbsp;<span class="ident" id="3150772">end</span>&nbsp;<span class="op" id="3150776">&lt;</span>&nbsp;<span class="num" id="3150778">0</span>&nbsp;<span class="op" id="3150780">{</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150785">if</span>&nbsp;<span class="ident" id="3150788">err</span>&nbsp;<span class="op" id="3150792">=</span>&nbsp;<span class="ident" id="3150794">checkUTF8</span><span class="op" id="3150803">(</span><span class="ident" id="3150804">t</span><span class="op" id="3150805">)</span><span class="op" id="3150806">;</span>&nbsp;<span class="ident" id="3150808">err</span>&nbsp;<span class="op" id="3150812">!=</span>&nbsp;<span class="ident" id="3150815">nil</span>&nbsp;<span class="op" id="3150819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150825">return</span>&nbsp;<span class="string" id="3150832">&#34;&#34;</span><span class="op" id="3150834">,</span>&nbsp;<span class="ident" id="3150836">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3150843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150848">return</span>&nbsp;<span class="string" id="3150855">&#34;&#34;</span><span class="op" id="3150857">,</span>&nbsp;<span class="op" id="3150859">&amp;</span><span class="ident" id="3150860">Error</span><span class="op" id="3150865">{</span><span class="ident" id="3150866">ErrInvalidNamedCapture</span><span class="op" id="3150888">,</span>&nbsp;<span class="ident" id="3150890">s</span><span class="op" id="3150891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3150895">}</span><br>
<span class="lineno">960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150900">capture</span>&nbsp;<span class="op" id="3150908">:=</span>&nbsp;<span class="ident" id="3150911">t</span><span class="op" id="3150912">[</span><span class="op" id="3150913">:</span><span class="ident" id="3150914">end</span><span class="op" id="3150917">+</span><span class="num" id="3150918">1</span><span class="op" id="3150919">]</span>&nbsp;<span class="comment" id="3150921">//&nbsp;&#34;(?P&lt;name&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3150938">name</span>&nbsp;<span class="op" id="3150943">:=</span>&nbsp;<span class="ident" id="3150946">t</span><span class="op" id="3150947">[</span><span class="num" id="3150948">4</span><span class="op" id="3150949">:</span><span class="ident" id="3150950">end</span><span class="op" id="3150953">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3150959">//&nbsp;&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3150971">if</span>&nbsp;<span class="ident" id="3150974">err</span>&nbsp;<span class="op" id="3150978">=</span>&nbsp;<span class="ident" id="3150980">checkUTF8</span><span class="op" id="3150989">(</span><span class="ident" id="3150990">name</span><span class="op" id="3150994">)</span><span class="op" id="3150995">;</span>&nbsp;<span class="ident" id="3150997">err</span>&nbsp;<span class="op" id="3151001">!=</span>&nbsp;<span class="ident" id="3151004">nil</span>&nbsp;<span class="op" id="3151008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151013">return</span>&nbsp;<span class="string" id="3151020">&#34;&#34;</span><span class="op" id="3151022">,</span>&nbsp;<span class="ident" id="3151024">err</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3151030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151034">if</span>&nbsp;<span class="op" id="3151037">!</span><span class="ident" id="3151038">isValidCaptureName</span><span class="op" id="3151056">(</span><span class="ident" id="3151057">name</span><span class="op" id="3151061">)</span>&nbsp;<span class="op" id="3151063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151068">return</span>&nbsp;<span class="string" id="3151075">&#34;&#34;</span><span class="op" id="3151077">,</span>&nbsp;<span class="op" id="3151079">&amp;</span><span class="ident" id="3151080">Error</span><span class="op" id="3151085">{</span><span class="ident" id="3151086">ErrInvalidNamedCapture</span><span class="op" id="3151108">,</span>&nbsp;<span class="ident" id="3151110">capture</span><span class="op" id="3151117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3151121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3151126">//&nbsp;Like&nbsp;ordinary&nbsp;capture,&nbsp;but&nbsp;named.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151165">p</span><span class="op" id="3151166">.</span><span class="ident" id="3151167">numCap</span><span class="op" id="3151173">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151178">re</span>&nbsp;<span class="op" id="3151181">:=</span>&nbsp;<span class="ident" id="3151184">p</span><span class="op" id="3151185">.</span><span class="ident" id="3151186">op</span><span class="op" id="3151188">(</span><span class="ident" id="3151189">opLeftParen</span><span class="op" id="3151200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151204">re</span><span class="op" id="3151206">.</span><span class="ident" id="3151207">Cap</span>&nbsp;<span class="op" id="3151211">=</span>&nbsp;<span class="ident" id="3151213">p</span><span class="op" id="3151214">.</span><span class="ident" id="3151215">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151224">re</span><span class="op" id="3151226">.</span><span class="ident" id="3151227">Name</span>&nbsp;<span class="op" id="3151232">=</span>&nbsp;<span class="ident" id="3151234">name</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151241">return</span>&nbsp;<span class="ident" id="3151248">t</span><span class="op" id="3151249">[</span><span class="ident" id="3151250">end</span><span class="op" id="3151253">+</span><span class="num" id="3151254">1</span><span class="op" id="3151255">:</span><span class="op" id="3151256">]</span><span class="op" id="3151257">,</span>&nbsp;<span class="ident" id="3151259">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3151264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3151268">//&nbsp;Non-capturing&nbsp;group.&nbsp;&nbsp;Might&nbsp;also&nbsp;twiddle&nbsp;Perl&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151325">var</span>&nbsp;<span class="ident" id="3151329">c</span>&nbsp;<span class="builtintype" id="3151331">rune</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151337">t</span>&nbsp;<span class="op" id="3151339">=</span>&nbsp;<span class="ident" id="3151341">t</span><span class="op" id="3151342">[</span><span class="num" id="3151343">2</span><span class="op" id="3151344">:</span><span class="op" id="3151345">]</span>&nbsp;<span class="comment" id="3151347">//&nbsp;skip&nbsp;(?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151359">flags</span>&nbsp;<span class="op" id="3151365">:=</span>&nbsp;<span class="ident" id="3151368">p</span><span class="op" id="3151369">.</span><span class="ident" id="3151370">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151377">sign</span>&nbsp;<span class="op" id="3151382">:=</span>&nbsp;<span class="op" id="3151385">+</span><span class="num" id="3151386">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151389">sawFlag</span>&nbsp;<span class="op" id="3151397">:=</span>&nbsp;<span class="builtintype" id="3151400">false</span><br>
<span class="lineno"></span><span class="ident" id="3151406">Loop</span><span class="op" id="3151410">:</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151413">for</span>&nbsp;<span class="ident" id="3151417">t</span>&nbsp;<span class="op" id="3151419">!=</span>&nbsp;<span class="string" id="3151422">&#34;&#34;</span>&nbsp;<span class="op" id="3151425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151429">if</span>&nbsp;<span class="ident" id="3151432">c</span><span class="op" id="3151433">,</span>&nbsp;<span class="ident" id="3151435">t</span><span class="op" id="3151436">,</span>&nbsp;<span class="ident" id="3151438">err</span>&nbsp;<span class="op" id="3151442">=</span>&nbsp;<span class="ident" id="3151444">nextRune</span><span class="op" id="3151452">(</span><span class="ident" id="3151453">t</span><span class="op" id="3151454">)</span><span class="op" id="3151455">;</span>&nbsp;<span class="ident" id="3151457">err</span>&nbsp;<span class="op" id="3151461">!=</span>&nbsp;<span class="ident" id="3151464">nil</span>&nbsp;<span class="op" id="3151468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151473">return</span>&nbsp;<span class="string" id="3151480">&#34;&#34;</span><span class="op" id="3151482">,</span>&nbsp;<span class="ident" id="3151484">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3151490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151494">switch</span>&nbsp;<span class="ident" id="3151501">c</span>&nbsp;<span class="op" id="3151503">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151507">default</span><span class="op" id="3151514">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151519">break</span>&nbsp;<span class="ident" id="3151525">Loop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3151533">//&nbsp;Flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151545">case</span>&nbsp;<span class="string" id="3151550">&#39;i&#39;</span><span class="op" id="3151553">:</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151558">flags</span>&nbsp;<span class="op" id="3151564">|=</span>&nbsp;<span class="ident" id="3151567">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151579">sawFlag</span>&nbsp;<span class="op" id="3151587">=</span>&nbsp;<span class="builtintype" id="3151589">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151596">case</span>&nbsp;<span class="string" id="3151601">&#39;m&#39;</span><span class="op" id="3151604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151609">flags</span>&nbsp;<span class="op" id="3151615">&amp;^=</span>&nbsp;<span class="ident" id="3151619">OneLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151630">sawFlag</span>&nbsp;<span class="op" id="3151638">=</span>&nbsp;<span class="builtintype" id="3151640">true</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151647">case</span>&nbsp;<span class="string" id="3151652">&#39;s&#39;</span><span class="op" id="3151655">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151660">flags</span>&nbsp;<span class="op" id="3151666">|=</span>&nbsp;<span class="ident" id="3151669">DotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151678">sawFlag</span>&nbsp;<span class="op" id="3151686">=</span>&nbsp;<span class="builtintype" id="3151688">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151695">case</span>&nbsp;<span class="string" id="3151700">&#39;U&#39;</span><span class="op" id="3151703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151708">flags</span>&nbsp;<span class="op" id="3151714">|=</span>&nbsp;<span class="ident" id="3151717">NonGreedy</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151730">sawFlag</span>&nbsp;<span class="op" id="3151738">=</span>&nbsp;<span class="builtintype" id="3151740">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3151748">//&nbsp;Switch&nbsp;to&nbsp;negation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151773">case</span>&nbsp;<span class="string" id="3151778">&#39;-&#39;</span><span class="op" id="3151781">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151786">if</span>&nbsp;<span class="ident" id="3151789">sign</span>&nbsp;<span class="op" id="3151794">&lt;</span>&nbsp;<span class="num" id="3151796">0</span>&nbsp;<span class="op" id="3151798">{</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151804">break</span>&nbsp;<span class="ident" id="3151810">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3151818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151823">sign</span>&nbsp;<span class="op" id="3151828">=</span>&nbsp;<span class="op" id="3151830">-</span><span class="num" id="3151831">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3151836">//&nbsp;Invert&nbsp;flags&nbsp;so&nbsp;that&nbsp;|&nbsp;above&nbsp;turn&nbsp;into&nbsp;&amp;^&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3151900">//&nbsp;We&#39;ll&nbsp;invert&nbsp;flags&nbsp;again&nbsp;before&nbsp;using&nbsp;it&nbsp;below.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151954">flags</span>&nbsp;<span class="op" id="3151960">=</span>&nbsp;<span class="op" id="3151962">^</span><span class="ident" id="3151963">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151972">sawFlag</span>&nbsp;<span class="op" id="3151980">=</span>&nbsp;<span class="builtintype" id="3151982">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3151991">//&nbsp;End&nbsp;of&nbsp;flags,&nbsp;starting&nbsp;group&nbsp;or&nbsp;not.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152033">case</span>&nbsp;<span class="string" id="3152038">&#39;:&#39;</span><span class="op" id="3152041">,</span>&nbsp;<span class="string" id="3152043">&#39;)&#39;</span><span class="op" id="3152046">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152051">if</span>&nbsp;<span class="ident" id="3152054">sign</span>&nbsp;<span class="op" id="3152059">&lt;</span>&nbsp;<span class="num" id="3152061">0</span>&nbsp;<span class="op" id="3152063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152069">if</span>&nbsp;<span class="op" id="3152072">!</span><span class="ident" id="3152073">sawFlag</span>&nbsp;<span class="op" id="3152081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152088">break</span>&nbsp;<span class="ident" id="3152094">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152109">flags</span>&nbsp;<span class="op" id="3152115">=</span>&nbsp;<span class="op" id="3152117">^</span><span class="ident" id="3152118">flags</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152132">if</span>&nbsp;<span class="ident" id="3152135">c</span>&nbsp;<span class="op" id="3152137">==</span>&nbsp;<span class="string" id="3152140">&#39;:&#39;</span>&nbsp;<span class="op" id="3152144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3152150">//&nbsp;Open&nbsp;new&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152172">p</span><span class="op" id="3152173">.</span><span class="ident" id="3152174">op</span><span class="op" id="3152176">(</span><span class="ident" id="3152177">opLeftParen</span><span class="op" id="3152188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152193">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152198">p</span><span class="op" id="3152199">.</span><span class="ident" id="3152200">flags</span>&nbsp;<span class="op" id="3152206">=</span>&nbsp;<span class="ident" id="3152208">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152217">return</span>&nbsp;<span class="ident" id="3152224">t</span><span class="op" id="3152225">,</span>&nbsp;<span class="ident" id="3152227">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152240">return</span>&nbsp;<span class="string" id="3152247">&#34;&#34;</span><span class="op" id="3152249">,</span>&nbsp;<span class="op" id="3152251">&amp;</span><span class="ident" id="3152252">Error</span><span class="op" id="3152257">{</span><span class="ident" id="3152258">ErrInvalidPerlOp</span><span class="op" id="3152274">,</span>&nbsp;<span class="ident" id="3152276">s</span><span class="op" id="3152277">[</span><span class="op" id="3152278">:</span><span class="builtinfunc" id="3152279">len</span><span class="op" id="3152282">(</span><span class="ident" id="3152283">s</span><span class="op" id="3152284">)</span><span class="op" id="3152285">-</span><span class="builtinfunc" id="3152286">len</span><span class="op" id="3152289">(</span><span class="ident" id="3152290">t</span><span class="op" id="3152291">)</span><span class="op" id="3152292">]</span><span class="op" id="3152293">}</span><br>
<span class="lineno"></span><span class="op" id="3152295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3152298">//&nbsp;isValidCaptureName&nbsp;reports&nbsp;whether&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="3152341">//&nbsp;is&nbsp;a&nbsp;valid&nbsp;capture&nbsp;name:&nbsp;[A-Za-z0-9_]+.</span><br>
<span class="lineno">1040</span><span class="comment" id="3152384">//&nbsp;PCRE&nbsp;limits&nbsp;names&nbsp;to&nbsp;32&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="3152418">//&nbsp;Python&nbsp;rejects&nbsp;names&nbsp;starting&nbsp;with&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="3152464">//&nbsp;We&nbsp;don&#39;t&nbsp;enforce&nbsp;either&nbsp;of&nbsp;those.</span><br>
<span class="lineno"></span><span class="keyword" id="3152501">func</span>&nbsp;<span class="ident" id="3152506">isValidCaptureName</span><span class="op" id="3152524">(</span><span class="ident" id="3152525">name</span>&nbsp;<span class="builtintype" id="3152530">string</span><span class="op" id="3152536">)</span>&nbsp;<span class="builtintype" id="3152538">bool</span>&nbsp;<span class="op" id="3152543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152546">if</span>&nbsp;<span class="ident" id="3152549">name</span>&nbsp;<span class="op" id="3152554">==</span>&nbsp;<span class="string" id="3152557">&#34;&#34;</span>&nbsp;<span class="op" id="3152560">{</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152564">return</span>&nbsp;<span class="builtintype" id="3152571">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152581">for</span>&nbsp;<span class="ident" id="3152585">_</span><span class="op" id="3152586">,</span>&nbsp;<span class="ident" id="3152588">c</span>&nbsp;<span class="op" id="3152590">:=</span>&nbsp;<span class="keyword" id="3152593">range</span>&nbsp;<span class="ident" id="3152599">name</span>&nbsp;<span class="op" id="3152604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152608">if</span>&nbsp;<span class="ident" id="3152611">c</span>&nbsp;<span class="op" id="3152613">!=</span>&nbsp;<span class="string" id="3152616">&#39;_&#39;</span>&nbsp;<span class="op" id="3152620">&amp;&amp;</span>&nbsp;<span class="op" id="3152623">!</span><span class="ident" id="3152624">isalnum</span><span class="op" id="3152631">(</span><span class="ident" id="3152632">c</span><span class="op" id="3152633">)</span>&nbsp;<span class="op" id="3152635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152640">return</span>&nbsp;<span class="builtintype" id="3152647">false</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152661">return</span>&nbsp;<span class="builtintype" id="3152668">true</span><br>
<span class="lineno"></span><span class="op" id="3152673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1055</span><span class="comment" id="3152676">//&nbsp;parseInt&nbsp;parses&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="3152714">func</span>&nbsp;<span class="op" id="3152719">(</span><span class="ident" id="3152720">p</span>&nbsp;<span class="op" id="3152722">*</span><span class="ident" id="3152723">parser</span><span class="op" id="3152729">)</span>&nbsp;<span class="ident" id="3152731">parseInt</span><span class="op" id="3152739">(</span><span class="ident" id="3152740">s</span>&nbsp;<span class="builtintype" id="3152742">string</span><span class="op" id="3152748">)</span>&nbsp;<span class="op" id="3152750">(</span><span class="ident" id="3152751">n</span>&nbsp;<span class="builtintype" id="3152753">int</span><span class="op" id="3152756">,</span>&nbsp;<span class="ident" id="3152758">rest</span>&nbsp;<span class="builtintype" id="3152763">string</span><span class="op" id="3152769">,</span>&nbsp;<span class="ident" id="3152771">ok</span>&nbsp;<span class="builtintype" id="3152774">bool</span><span class="op" id="3152778">)</span>&nbsp;<span class="op" id="3152780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152783">if</span>&nbsp;<span class="ident" id="3152786">s</span>&nbsp;<span class="op" id="3152788">==</span>&nbsp;<span class="string" id="3152791">&#34;&#34;</span>&nbsp;<span class="op" id="3152794">||</span>&nbsp;<span class="ident" id="3152797">s</span><span class="op" id="3152798">[</span><span class="num" id="3152799">0</span><span class="op" id="3152800">]</span>&nbsp;<span class="op" id="3152802">&lt;</span>&nbsp;<span class="string" id="3152804">&#39;0&#39;</span>&nbsp;<span class="op" id="3152808">||</span>&nbsp;<span class="string" id="3152811">&#39;9&#39;</span>&nbsp;<span class="op" id="3152815">&lt;</span>&nbsp;<span class="ident" id="3152817">s</span><span class="op" id="3152818">[</span><span class="num" id="3152819">0</span><span class="op" id="3152820">]</span>&nbsp;<span class="op" id="3152822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152826">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152834">}</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3152837">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152865">if</span>&nbsp;<span class="builtinfunc" id="3152868">len</span><span class="op" id="3152871">(</span><span class="ident" id="3152872">s</span><span class="op" id="3152873">)</span>&nbsp;<span class="op" id="3152875">&gt;=</span>&nbsp;<span class="num" id="3152878">2</span>&nbsp;<span class="op" id="3152880">&amp;&amp;</span>&nbsp;<span class="ident" id="3152883">s</span><span class="op" id="3152884">[</span><span class="num" id="3152885">0</span><span class="op" id="3152886">]</span>&nbsp;<span class="op" id="3152888">==</span>&nbsp;<span class="string" id="3152891">&#39;0&#39;</span>&nbsp;<span class="op" id="3152895">&amp;&amp;</span>&nbsp;<span class="string" id="3152898">&#39;0&#39;</span>&nbsp;<span class="op" id="3152902">&lt;=</span>&nbsp;<span class="ident" id="3152905">s</span><span class="op" id="3152906">[</span><span class="num" id="3152907">1</span><span class="op" id="3152908">]</span>&nbsp;<span class="op" id="3152910">&amp;&amp;</span>&nbsp;<span class="ident" id="3152913">s</span><span class="op" id="3152914">[</span><span class="num" id="3152915">1</span><span class="op" id="3152916">]</span>&nbsp;<span class="op" id="3152918">&lt;=</span>&nbsp;<span class="string" id="3152921">&#39;9&#39;</span>&nbsp;<span class="op" id="3152925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152929">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152940">t</span>&nbsp;<span class="op" id="3152942">:=</span>&nbsp;<span class="ident" id="3152945">s</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152948">for</span>&nbsp;<span class="ident" id="3152952">s</span>&nbsp;<span class="op" id="3152954">!=</span>&nbsp;<span class="string" id="3152957">&#34;&#34;</span>&nbsp;<span class="op" id="3152960">&amp;&amp;</span>&nbsp;<span class="string" id="3152963">&#39;0&#39;</span>&nbsp;<span class="op" id="3152967">&lt;=</span>&nbsp;<span class="ident" id="3152970">s</span><span class="op" id="3152971">[</span><span class="num" id="3152972">0</span><span class="op" id="3152973">]</span>&nbsp;<span class="op" id="3152975">&amp;&amp;</span>&nbsp;<span class="ident" id="3152978">s</span><span class="op" id="3152979">[</span><span class="num" id="3152980">0</span><span class="op" id="3152981">]</span>&nbsp;<span class="op" id="3152983">&lt;=</span>&nbsp;<span class="string" id="3152986">&#39;9&#39;</span>&nbsp;<span class="op" id="3152990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152994">s</span>&nbsp;<span class="op" id="3152996">=</span>&nbsp;<span class="ident" id="3152998">s</span><span class="op" id="3152999">[</span><span class="num" id="3153000">1</span><span class="op" id="3153001">:</span><span class="op" id="3153002">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3153005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153008">rest</span>&nbsp;<span class="op" id="3153013">=</span>&nbsp;<span class="ident" id="3153015">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153018">ok</span>&nbsp;<span class="op" id="3153021">=</span>&nbsp;<span class="builtintype" id="3153023">true</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153029">//&nbsp;Have&nbsp;digits,&nbsp;compute&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153061">t</span>&nbsp;<span class="op" id="3153063">=</span>&nbsp;<span class="ident" id="3153065">t</span><span class="op" id="3153066">[</span><span class="op" id="3153067">:</span><span class="builtinfunc" id="3153068">len</span><span class="op" id="3153071">(</span><span class="ident" id="3153072">t</span><span class="op" id="3153073">)</span><span class="op" id="3153074">-</span><span class="builtinfunc" id="3153075">len</span><span class="op" id="3153078">(</span><span class="ident" id="3153079">s</span><span class="op" id="3153080">)</span><span class="op" id="3153081">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153084">for</span>&nbsp;<span class="ident" id="3153088">i</span>&nbsp;<span class="op" id="3153090">:=</span>&nbsp;<span class="num" id="3153093">0</span><span class="op" id="3153094">;</span>&nbsp;<span class="ident" id="3153096">i</span>&nbsp;<span class="op" id="3153098">&lt;</span>&nbsp;<span class="builtinfunc" id="3153100">len</span><span class="op" id="3153103">(</span><span class="ident" id="3153104">t</span><span class="op" id="3153105">)</span><span class="op" id="3153106">;</span>&nbsp;<span class="ident" id="3153108">i</span><span class="op" id="3153109">++</span>&nbsp;<span class="op" id="3153112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153116">//&nbsp;Avoid&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153137">if</span>&nbsp;<span class="ident" id="3153140">n</span>&nbsp;<span class="op" id="3153142">&gt;=</span>&nbsp;<span class="num" id="3153145">1e8</span>&nbsp;<span class="op" id="3153149">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153154">n</span>&nbsp;<span class="op" id="3153156">=</span>&nbsp;<span class="op" id="3153158">-</span><span class="num" id="3153159">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153164">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3153172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153176">n</span>&nbsp;<span class="op" id="3153178">=</span>&nbsp;<span class="ident" id="3153180">n</span><span class="op" id="3153181">*</span><span class="num" id="3153182">10</span>&nbsp;<span class="op" id="3153185">+</span>&nbsp;<span class="builtintype" id="3153187">int</span><span class="op" id="3153190">(</span><span class="ident" id="3153191">t</span><span class="op" id="3153192">[</span><span class="ident" id="3153193">i</span><span class="op" id="3153194">]</span><span class="op" id="3153195">)</span>&nbsp;<span class="op" id="3153197">-</span>&nbsp;<span class="string" id="3153199">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3153204">}</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153207">return</span><br>
<span class="lineno"></span><span class="op" id="3153214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3153217">//&nbsp;can&nbsp;this&nbsp;be&nbsp;represented&nbsp;as&nbsp;a&nbsp;character&nbsp;class?</span><br>
<span class="lineno"></span><span class="comment" id="3153266">//&nbsp;single-rune&nbsp;literal&nbsp;string,&nbsp;char&nbsp;class,&nbsp;.,&nbsp;and&nbsp;.|\n.</span><br>
<span class="lineno">1085</span><span class="keyword" id="3153322">func</span>&nbsp;<span class="ident" id="3153327">isCharClass</span><span class="op" id="3153338">(</span><span class="ident" id="3153339">re</span>&nbsp;<span class="op" id="3153342">*</span><span class="ident" id="3153343">Regexp</span><span class="op" id="3153349">)</span>&nbsp;<span class="builtintype" id="3153351">bool</span>&nbsp;<span class="op" id="3153356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153359">return</span>&nbsp;<span class="ident" id="3153366">re</span><span class="op" id="3153368">.</span><span class="ident" id="3153369">Op</span>&nbsp;<span class="op" id="3153372">==</span>&nbsp;<span class="ident" id="3153375">OpLiteral</span>&nbsp;<span class="op" id="3153385">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3153388">len</span><span class="op" id="3153391">(</span><span class="ident" id="3153392">re</span><span class="op" id="3153394">.</span><span class="ident" id="3153395">Rune</span><span class="op" id="3153399">)</span>&nbsp;<span class="op" id="3153401">==</span>&nbsp;<span class="num" id="3153404">1</span>&nbsp;<span class="op" id="3153406">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153411">re</span><span class="op" id="3153413">.</span><span class="ident" id="3153414">Op</span>&nbsp;<span class="op" id="3153417">==</span>&nbsp;<span class="ident" id="3153420">OpCharClass</span>&nbsp;<span class="op" id="3153432">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153437">re</span><span class="op" id="3153439">.</span><span class="ident" id="3153440">Op</span>&nbsp;<span class="op" id="3153443">==</span>&nbsp;<span class="ident" id="3153446">OpAnyCharNotNL</span>&nbsp;<span class="op" id="3153461">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153466">re</span><span class="op" id="3153468">.</span><span class="ident" id="3153469">Op</span>&nbsp;<span class="op" id="3153472">==</span>&nbsp;<span class="ident" id="3153475">OpAnyChar</span><br>
<span class="lineno">1090</span><span class="op" id="3153485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3153488">//&nbsp;does&nbsp;re&nbsp;match&nbsp;r?</span><br>
<span class="lineno"></span><span class="keyword" id="3153508">func</span>&nbsp;<span class="ident" id="3153513">matchRune</span><span class="op" id="3153522">(</span><span class="ident" id="3153523">re</span>&nbsp;<span class="op" id="3153526">*</span><span class="ident" id="3153527">Regexp</span><span class="op" id="3153533">,</span>&nbsp;<span class="ident" id="3153535">r</span>&nbsp;<span class="builtintype" id="3153537">rune</span><span class="op" id="3153541">)</span>&nbsp;<span class="builtintype" id="3153543">bool</span>&nbsp;<span class="op" id="3153548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153551">switch</span>&nbsp;<span class="ident" id="3153558">re</span><span class="op" id="3153560">.</span><span class="ident" id="3153561">Op</span>&nbsp;<span class="op" id="3153564">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153567">case</span>&nbsp;<span class="ident" id="3153572">OpLiteral</span><span class="op" id="3153581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153585">return</span>&nbsp;<span class="builtinfunc" id="3153592">len</span><span class="op" id="3153595">(</span><span class="ident" id="3153596">re</span><span class="op" id="3153598">.</span><span class="ident" id="3153599">Rune</span><span class="op" id="3153603">)</span>&nbsp;<span class="op" id="3153605">==</span>&nbsp;<span class="num" id="3153608">1</span>&nbsp;<span class="op" id="3153610">&amp;&amp;</span>&nbsp;<span class="ident" id="3153613">re</span><span class="op" id="3153615">.</span><span class="ident" id="3153616">Rune</span><span class="op" id="3153620">[</span><span class="num" id="3153621">0</span><span class="op" id="3153622">]</span>&nbsp;<span class="op" id="3153624">==</span>&nbsp;<span class="ident" id="3153627">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153630">case</span>&nbsp;<span class="ident" id="3153635">OpCharClass</span><span class="op" id="3153646">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153650">for</span>&nbsp;<span class="ident" id="3153654">i</span>&nbsp;<span class="op" id="3153656">:=</span>&nbsp;<span class="num" id="3153659">0</span><span class="op" id="3153660">;</span>&nbsp;<span class="ident" id="3153662">i</span>&nbsp;<span class="op" id="3153664">&lt;</span>&nbsp;<span class="builtinfunc" id="3153666">len</span><span class="op" id="3153669">(</span><span class="ident" id="3153670">re</span><span class="op" id="3153672">.</span><span class="ident" id="3153673">Rune</span><span class="op" id="3153677">)</span><span class="op" id="3153678">;</span>&nbsp;<span class="ident" id="3153680">i</span>&nbsp;<span class="op" id="3153682">+=</span>&nbsp;<span class="num" id="3153685">2</span>&nbsp;<span class="op" id="3153687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153692">if</span>&nbsp;<span class="ident" id="3153695">re</span><span class="op" id="3153697">.</span><span class="ident" id="3153698">Rune</span><span class="op" id="3153702">[</span><span class="ident" id="3153703">i</span><span class="op" id="3153704">]</span>&nbsp;<span class="op" id="3153706">&lt;=</span>&nbsp;<span class="ident" id="3153709">r</span>&nbsp;<span class="op" id="3153711">&amp;&amp;</span>&nbsp;<span class="ident" id="3153714">r</span>&nbsp;<span class="op" id="3153716">&lt;=</span>&nbsp;<span class="ident" id="3153719">re</span><span class="op" id="3153721">.</span><span class="ident" id="3153722">Rune</span><span class="op" id="3153726">[</span><span class="ident" id="3153727">i</span><span class="op" id="3153728">+</span><span class="num" id="3153729">1</span><span class="op" id="3153730">]</span>&nbsp;<span class="op" id="3153732">{</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153738">return</span>&nbsp;<span class="builtintype" id="3153745">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3153753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3153757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153761">return</span>&nbsp;<span class="builtintype" id="3153768">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153775">case</span>&nbsp;<span class="ident" id="3153780">OpAnyCharNotNL</span><span class="op" id="3153794">:</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153798">return</span>&nbsp;<span class="ident" id="3153805">r</span>&nbsp;<span class="op" id="3153807">!=</span>&nbsp;<span class="string" id="3153810">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153816">case</span>&nbsp;<span class="ident" id="3153821">OpAnyChar</span><span class="op" id="3153830">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153834">return</span>&nbsp;<span class="builtintype" id="3153841">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3153847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153850">return</span>&nbsp;<span class="builtintype" id="3153857">false</span><br>
<span class="lineno">1110</span><span class="op" id="3153863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3153866">//&nbsp;parseVerticalBar&nbsp;handles&nbsp;a&nbsp;|&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="3153912">func</span>&nbsp;<span class="op" id="3153917">(</span><span class="ident" id="3153918">p</span>&nbsp;<span class="op" id="3153920">*</span><span class="ident" id="3153921">parser</span><span class="op" id="3153927">)</span>&nbsp;<span class="ident" id="3153929">parseVerticalBar</span><span class="op" id="3153945">(</span><span class="op" id="3153946">)</span>&nbsp;<span class="builtintype" id="3153948">error</span>&nbsp;<span class="op" id="3153954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153957">p</span><span class="op" id="3153958">.</span><span class="ident" id="3153959">concat</span><span class="op" id="3153965">(</span><span class="op" id="3153966">)</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153970">//&nbsp;The&nbsp;concatenation&nbsp;we&nbsp;just&nbsp;parsed&nbsp;is&nbsp;on&nbsp;top&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3154031">//&nbsp;If&nbsp;it&nbsp;sits&nbsp;above&nbsp;an&nbsp;opVerticalBar,&nbsp;swap&nbsp;it&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3154084">//&nbsp;(things&nbsp;below&nbsp;an&nbsp;opVerticalBar&nbsp;become&nbsp;an&nbsp;alternation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3154143">//&nbsp;Otherwise,&nbsp;push&nbsp;a&nbsp;new&nbsp;vertical&nbsp;bar.</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154183">if</span>&nbsp;<span class="op" id="3154186">!</span><span class="ident" id="3154187">p</span><span class="op" id="3154188">.</span><span class="ident" id="3154189">swapVerticalBar</span><span class="op" id="3154204">(</span><span class="op" id="3154205">)</span>&nbsp;<span class="op" id="3154207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154211">p</span><span class="op" id="3154212">.</span><span class="ident" id="3154213">op</span><span class="op" id="3154215">(</span><span class="ident" id="3154216">opVerticalBar</span><span class="op" id="3154229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154236">return</span>&nbsp;<span class="ident" id="3154243">nil</span><br>
<span class="lineno">1125</span><span class="op" id="3154247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3154250">//&nbsp;mergeCharClass&nbsp;makes&nbsp;dst&nbsp;=&nbsp;dst|src.</span><br>
<span class="lineno"></span><span class="comment" id="3154289">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;ensure&nbsp;that&nbsp;dst.Op&nbsp;&gt;=&nbsp;src.Op,</span><br>
<span class="lineno"></span><span class="comment" id="3154338">//&nbsp;to&nbsp;reduce&nbsp;the&nbsp;amount&nbsp;of&nbsp;copying.</span><br>
<span class="lineno">1130</span><span class="keyword" id="3154374">func</span>&nbsp;<span class="ident" id="3154379">mergeCharClass</span><span class="op" id="3154393">(</span><span class="ident" id="3154394">dst</span><span class="op" id="3154397">,</span>&nbsp;<span class="ident" id="3154399">src</span>&nbsp;<span class="op" id="3154403">*</span><span class="ident" id="3154404">Regexp</span><span class="op" id="3154410">)</span>&nbsp;<span class="op" id="3154412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154415">switch</span>&nbsp;<span class="ident" id="3154422">dst</span><span class="op" id="3154425">.</span><span class="ident" id="3154426">Op</span>&nbsp;<span class="op" id="3154429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154432">case</span>&nbsp;<span class="ident" id="3154437">OpAnyChar</span><span class="op" id="3154446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3154450">//&nbsp;src&nbsp;doesn&#39;t&nbsp;add&nbsp;anything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154480">case</span>&nbsp;<span class="ident" id="3154485">OpAnyCharNotNL</span><span class="op" id="3154499">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3154503">//&nbsp;src&nbsp;might&nbsp;add&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154525">if</span>&nbsp;<span class="ident" id="3154528">matchRune</span><span class="op" id="3154537">(</span><span class="ident" id="3154538">src</span><span class="op" id="3154541">,</span>&nbsp;<span class="string" id="3154543">&#39;\n&#39;</span><span class="op" id="3154547">)</span>&nbsp;<span class="op" id="3154549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154554">dst</span><span class="op" id="3154557">.</span><span class="ident" id="3154558">Op</span>&nbsp;<span class="op" id="3154561">=</span>&nbsp;<span class="ident" id="3154563">OpAnyChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154578">case</span>&nbsp;<span class="ident" id="3154583">OpCharClass</span><span class="op" id="3154594">:</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3154598">//&nbsp;src&nbsp;is&nbsp;simpler,&nbsp;so&nbsp;either&nbsp;literal&nbsp;or&nbsp;char&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154651">if</span>&nbsp;<span class="ident" id="3154654">src</span><span class="op" id="3154657">.</span><span class="ident" id="3154658">Op</span>&nbsp;<span class="op" id="3154661">==</span>&nbsp;<span class="ident" id="3154664">OpLiteral</span>&nbsp;<span class="op" id="3154674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154679">dst</span><span class="op" id="3154682">.</span><span class="ident" id="3154683">Rune</span>&nbsp;<span class="op" id="3154688">=</span>&nbsp;<span class="ident" id="3154690">appendLiteral</span><span class="op" id="3154703">(</span><span class="ident" id="3154704">dst</span><span class="op" id="3154707">.</span><span class="ident" id="3154708">Rune</span><span class="op" id="3154712">,</span>&nbsp;<span class="ident" id="3154714">src</span><span class="op" id="3154717">.</span><span class="ident" id="3154718">Rune</span><span class="op" id="3154722">[</span><span class="num" id="3154723">0</span><span class="op" id="3154724">]</span><span class="op" id="3154725">,</span>&nbsp;<span class="ident" id="3154727">src</span><span class="op" id="3154730">.</span><span class="ident" id="3154731">Flags</span><span class="op" id="3154736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154740">}</span>&nbsp;<span class="keyword" id="3154742">else</span>&nbsp;<span class="op" id="3154747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154752">dst</span><span class="op" id="3154755">.</span><span class="ident" id="3154756">Rune</span>&nbsp;<span class="op" id="3154761">=</span>&nbsp;<span class="ident" id="3154763">appendClass</span><span class="op" id="3154774">(</span><span class="ident" id="3154775">dst</span><span class="op" id="3154778">.</span><span class="ident" id="3154779">Rune</span><span class="op" id="3154783">,</span>&nbsp;<span class="ident" id="3154785">src</span><span class="op" id="3154788">.</span><span class="ident" id="3154789">Rune</span><span class="op" id="3154793">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154800">case</span>&nbsp;<span class="ident" id="3154805">OpLiteral</span><span class="op" id="3154814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3154818">//&nbsp;both&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154836">if</span>&nbsp;<span class="ident" id="3154839">src</span><span class="op" id="3154842">.</span><span class="ident" id="3154843">Rune</span><span class="op" id="3154847">[</span><span class="num" id="3154848">0</span><span class="op" id="3154849">]</span>&nbsp;<span class="op" id="3154851">==</span>&nbsp;<span class="ident" id="3154854">dst</span><span class="op" id="3154857">.</span><span class="ident" id="3154858">Rune</span><span class="op" id="3154862">[</span><span class="num" id="3154863">0</span><span class="op" id="3154864">]</span>&nbsp;<span class="op" id="3154866">&amp;&amp;</span>&nbsp;<span class="ident" id="3154869">src</span><span class="op" id="3154872">.</span><span class="ident" id="3154873">Flags</span>&nbsp;<span class="op" id="3154879">==</span>&nbsp;<span class="ident" id="3154882">dst</span><span class="op" id="3154885">.</span><span class="ident" id="3154886">Flags</span>&nbsp;<span class="op" id="3154892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154897">break</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154909">dst</span><span class="op" id="3154912">.</span><span class="ident" id="3154913">Op</span>&nbsp;<span class="op" id="3154916">=</span>&nbsp;<span class="ident" id="3154918">OpCharClass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154932">dst</span><span class="op" id="3154935">.</span><span class="ident" id="3154936">Rune</span>&nbsp;<span class="op" id="3154941">=</span>&nbsp;<span class="ident" id="3154943">appendLiteral</span><span class="op" id="3154956">(</span><span class="ident" id="3154957">dst</span><span class="op" id="3154960">.</span><span class="ident" id="3154961">Rune</span><span class="op" id="3154965">[</span><span class="op" id="3154966">:</span><span class="num" id="3154967">0</span><span class="op" id="3154968">]</span><span class="op" id="3154969">,</span>&nbsp;<span class="ident" id="3154971">dst</span><span class="op" id="3154974">.</span><span class="ident" id="3154975">Rune</span><span class="op" id="3154979">[</span><span class="num" id="3154980">0</span><span class="op" id="3154981">]</span><span class="op" id="3154982">,</span>&nbsp;<span class="ident" id="3154984">dst</span><span class="op" id="3154987">.</span><span class="ident" id="3154988">Flags</span><span class="op" id="3154993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154997">dst</span><span class="op" id="3155000">.</span><span class="ident" id="3155001">Rune</span>&nbsp;<span class="op" id="3155006">=</span>&nbsp;<span class="ident" id="3155008">appendLiteral</span><span class="op" id="3155021">(</span><span class="ident" id="3155022">dst</span><span class="op" id="3155025">.</span><span class="ident" id="3155026">Rune</span><span class="op" id="3155030">,</span>&nbsp;<span class="ident" id="3155032">src</span><span class="op" id="3155035">.</span><span class="ident" id="3155036">Rune</span><span class="op" id="3155040">[</span><span class="num" id="3155041">0</span><span class="op" id="3155042">]</span><span class="op" id="3155043">,</span>&nbsp;<span class="ident" id="3155045">src</span><span class="op" id="3155048">.</span><span class="ident" id="3155049">Flags</span><span class="op" id="3155054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3155057">}</span><br>
<span class="lineno">1155</span><span class="op" id="3155059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3155062">//&nbsp;If&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;is&nbsp;an&nbsp;element&nbsp;followed&nbsp;by&nbsp;an&nbsp;opVerticalBar</span><br>
<span class="lineno"></span><span class="comment" id="3155132">//&nbsp;swapVerticalBar&nbsp;swaps&nbsp;the&nbsp;two&nbsp;and&nbsp;returns&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="3155183">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;false.</span><br>
<span class="lineno">1160</span><span class="keyword" id="3155214">func</span>&nbsp;<span class="op" id="3155219">(</span><span class="ident" id="3155220">p</span>&nbsp;<span class="op" id="3155222">*</span><span class="ident" id="3155223">parser</span><span class="op" id="3155229">)</span>&nbsp;<span class="ident" id="3155231">swapVerticalBar</span><span class="op" id="3155246">(</span><span class="op" id="3155247">)</span>&nbsp;<span class="builtintype" id="3155249">bool</span>&nbsp;<span class="op" id="3155254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155257">//&nbsp;If&nbsp;above&nbsp;and&nbsp;below&nbsp;vertical&nbsp;bar&nbsp;are&nbsp;literal&nbsp;or&nbsp;char&nbsp;class,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155320">//&nbsp;can&nbsp;merge&nbsp;into&nbsp;a&nbsp;single&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155360">n</span>&nbsp;<span class="op" id="3155362">:=</span>&nbsp;<span class="builtinfunc" id="3155365">len</span><span class="op" id="3155368">(</span><span class="ident" id="3155369">p</span><span class="op" id="3155370">.</span><span class="ident" id="3155371">stack</span><span class="op" id="3155376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155379">if</span>&nbsp;<span class="ident" id="3155382">n</span>&nbsp;<span class="op" id="3155384">&gt;=</span>&nbsp;<span class="num" id="3155387">3</span>&nbsp;<span class="op" id="3155389">&amp;&amp;</span>&nbsp;<span class="ident" id="3155392">p</span><span class="op" id="3155393">.</span><span class="ident" id="3155394">stack</span><span class="op" id="3155399">[</span><span class="ident" id="3155400">n</span><span class="op" id="3155401">-</span><span class="num" id="3155402">2</span><span class="op" id="3155403">]</span><span class="op" id="3155404">.</span><span class="ident" id="3155405">Op</span>&nbsp;<span class="op" id="3155408">==</span>&nbsp;<span class="ident" id="3155411">opVerticalBar</span>&nbsp;<span class="op" id="3155425">&amp;&amp;</span>&nbsp;<span class="ident" id="3155428">isCharClass</span><span class="op" id="3155439">(</span><span class="ident" id="3155440">p</span><span class="op" id="3155441">.</span><span class="ident" id="3155442">stack</span><span class="op" id="3155447">[</span><span class="ident" id="3155448">n</span><span class="op" id="3155449">-</span><span class="num" id="3155450">1</span><span class="op" id="3155451">]</span><span class="op" id="3155452">)</span>&nbsp;<span class="op" id="3155454">&amp;&amp;</span>&nbsp;<span class="ident" id="3155457">isCharClass</span><span class="op" id="3155468">(</span><span class="ident" id="3155469">p</span><span class="op" id="3155470">.</span><span class="ident" id="3155471">stack</span><span class="op" id="3155476">[</span><span class="ident" id="3155477">n</span><span class="op" id="3155478">-</span><span class="num" id="3155479">3</span><span class="op" id="3155480">]</span><span class="op" id="3155481">)</span>&nbsp;<span class="op" id="3155483">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155487">re1</span>&nbsp;<span class="op" id="3155491">:=</span>&nbsp;<span class="ident" id="3155494">p</span><span class="op" id="3155495">.</span><span class="ident" id="3155496">stack</span><span class="op" id="3155501">[</span><span class="ident" id="3155502">n</span><span class="op" id="3155503">-</span><span class="num" id="3155504">1</span><span class="op" id="3155505">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155509">re3</span>&nbsp;<span class="op" id="3155513">:=</span>&nbsp;<span class="ident" id="3155516">p</span><span class="op" id="3155517">.</span><span class="ident" id="3155518">stack</span><span class="op" id="3155523">[</span><span class="ident" id="3155524">n</span><span class="op" id="3155525">-</span><span class="num" id="3155526">3</span><span class="op" id="3155527">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155531">//&nbsp;Make&nbsp;re3&nbsp;the&nbsp;more&nbsp;complex&nbsp;of&nbsp;the&nbsp;two.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155574">if</span>&nbsp;<span class="ident" id="3155577">re1</span><span class="op" id="3155580">.</span><span class="ident" id="3155581">Op</span>&nbsp;<span class="op" id="3155584">&gt;</span>&nbsp;<span class="ident" id="3155586">re3</span><span class="op" id="3155589">.</span><span class="ident" id="3155590">Op</span>&nbsp;<span class="op" id="3155593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155598">re1</span><span class="op" id="3155601">,</span>&nbsp;<span class="ident" id="3155603">re3</span>&nbsp;<span class="op" id="3155607">=</span>&nbsp;<span class="ident" id="3155609">re3</span><span class="op" id="3155612">,</span>&nbsp;<span class="ident" id="3155614">re1</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155621">p</span><span class="op" id="3155622">.</span><span class="ident" id="3155623">stack</span><span class="op" id="3155628">[</span><span class="ident" id="3155629">n</span><span class="op" id="3155630">-</span><span class="num" id="3155631">3</span><span class="op" id="3155632">]</span>&nbsp;<span class="op" id="3155634">=</span>&nbsp;<span class="ident" id="3155636">re3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3155642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155646">mergeCharClass</span><span class="op" id="3155660">(</span><span class="ident" id="3155661">re3</span><span class="op" id="3155664">,</span>&nbsp;<span class="ident" id="3155666">re1</span><span class="op" id="3155669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155673">p</span><span class="op" id="3155674">.</span><span class="ident" id="3155675">reuse</span><span class="op" id="3155680">(</span><span class="ident" id="3155681">re1</span><span class="op" id="3155684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155688">p</span><span class="op" id="3155689">.</span><span class="ident" id="3155690">stack</span>&nbsp;<span class="op" id="3155696">=</span>&nbsp;<span class="ident" id="3155698">p</span><span class="op" id="3155699">.</span><span class="ident" id="3155700">stack</span><span class="op" id="3155705">[</span><span class="op" id="3155706">:</span><span class="ident" id="3155707">n</span><span class="op" id="3155708">-</span><span class="num" id="3155709">1</span><span class="op" id="3155710">]</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155714">return</span>&nbsp;<span class="builtintype" id="3155721">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3155727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155731">if</span>&nbsp;<span class="ident" id="3155734">n</span>&nbsp;<span class="op" id="3155736">&gt;=</span>&nbsp;<span class="num" id="3155739">2</span>&nbsp;<span class="op" id="3155741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155745">re1</span>&nbsp;<span class="op" id="3155749">:=</span>&nbsp;<span class="ident" id="3155752">p</span><span class="op" id="3155753">.</span><span class="ident" id="3155754">stack</span><span class="op" id="3155759">[</span><span class="ident" id="3155760">n</span><span class="op" id="3155761">-</span><span class="num" id="3155762">1</span><span class="op" id="3155763">]</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155767">re2</span>&nbsp;<span class="op" id="3155771">:=</span>&nbsp;<span class="ident" id="3155774">p</span><span class="op" id="3155775">.</span><span class="ident" id="3155776">stack</span><span class="op" id="3155781">[</span><span class="ident" id="3155782">n</span><span class="op" id="3155783">-</span><span class="num" id="3155784">2</span><span class="op" id="3155785">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155789">if</span>&nbsp;<span class="ident" id="3155792">re2</span><span class="op" id="3155795">.</span><span class="ident" id="3155796">Op</span>&nbsp;<span class="op" id="3155799">==</span>&nbsp;<span class="ident" id="3155802">opVerticalBar</span>&nbsp;<span class="op" id="3155816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155821">if</span>&nbsp;<span class="ident" id="3155824">n</span>&nbsp;<span class="op" id="3155826">&gt;=</span>&nbsp;<span class="num" id="3155829">3</span>&nbsp;<span class="op" id="3155831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155837">//&nbsp;Now&nbsp;out&nbsp;of&nbsp;reach.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155862">//&nbsp;Clean&nbsp;opportunistically.</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155894">cleanAlt</span><span class="op" id="3155902">(</span><span class="ident" id="3155903">p</span><span class="op" id="3155904">.</span><span class="ident" id="3155905">stack</span><span class="op" id="3155910">[</span><span class="ident" id="3155911">n</span><span class="op" id="3155912">-</span><span class="num" id="3155913">3</span><span class="op" id="3155914">]</span><span class="op" id="3155915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3155920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155925">p</span><span class="op" id="3155926">.</span><span class="ident" id="3155927">stack</span><span class="op" id="3155932">[</span><span class="ident" id="3155933">n</span><span class="op" id="3155934">-</span><span class="num" id="3155935">2</span><span class="op" id="3155936">]</span>&nbsp;<span class="op" id="3155938">=</span>&nbsp;<span class="ident" id="3155940">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155947">p</span><span class="op" id="3155948">.</span><span class="ident" id="3155949">stack</span><span class="op" id="3155954">[</span><span class="ident" id="3155955">n</span><span class="op" id="3155956">-</span><span class="num" id="3155957">1</span><span class="op" id="3155958">]</span>&nbsp;<span class="op" id="3155960">=</span>&nbsp;<span class="ident" id="3155962">re2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155969">return</span>&nbsp;<span class="builtintype" id="3155976">true</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3155983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3155986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155989">return</span>&nbsp;<span class="builtintype" id="3155996">false</span><br>
<span class="lineno"></span><span class="op" id="3156002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1195</span><span class="comment" id="3156005">//&nbsp;parseRightParen&nbsp;handles&nbsp;a&nbsp;)&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="3156050">func</span>&nbsp;<span class="op" id="3156055">(</span><span class="ident" id="3156056">p</span>&nbsp;<span class="op" id="3156058">*</span><span class="ident" id="3156059">parser</span><span class="op" id="3156065">)</span>&nbsp;<span class="ident" id="3156067">parseRightParen</span><span class="op" id="3156082">(</span><span class="op" id="3156083">)</span>&nbsp;<span class="builtintype" id="3156085">error</span>&nbsp;<span class="op" id="3156091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156094">p</span><span class="op" id="3156095">.</span><span class="ident" id="3156096">concat</span><span class="op" id="3156102">(</span><span class="op" id="3156103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156106">if</span>&nbsp;<span class="ident" id="3156109">p</span><span class="op" id="3156110">.</span><span class="ident" id="3156111">swapVerticalBar</span><span class="op" id="3156126">(</span><span class="op" id="3156127">)</span>&nbsp;<span class="op" id="3156129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156133">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156155">p</span><span class="op" id="3156156">.</span><span class="ident" id="3156157">stack</span>&nbsp;<span class="op" id="3156163">=</span>&nbsp;<span class="ident" id="3156165">p</span><span class="op" id="3156166">.</span><span class="ident" id="3156167">stack</span><span class="op" id="3156172">[</span><span class="op" id="3156173">:</span><span class="builtinfunc" id="3156174">len</span><span class="op" id="3156177">(</span><span class="ident" id="3156178">p</span><span class="op" id="3156179">.</span><span class="ident" id="3156180">stack</span><span class="op" id="3156185">)</span><span class="op" id="3156186">-</span><span class="num" id="3156187">1</span><span class="op" id="3156188">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156194">p</span><span class="op" id="3156195">.</span><span class="ident" id="3156196">alternate</span><span class="op" id="3156205">(</span><span class="op" id="3156206">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156210">n</span>&nbsp;<span class="op" id="3156212">:=</span>&nbsp;<span class="builtinfunc" id="3156215">len</span><span class="op" id="3156218">(</span><span class="ident" id="3156219">p</span><span class="op" id="3156220">.</span><span class="ident" id="3156221">stack</span><span class="op" id="3156226">)</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156229">if</span>&nbsp;<span class="ident" id="3156232">n</span>&nbsp;<span class="op" id="3156234">&lt;</span>&nbsp;<span class="num" id="3156236">2</span>&nbsp;<span class="op" id="3156238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156242">return</span>&nbsp;<span class="op" id="3156249">&amp;</span><span class="ident" id="3156250">Error</span><span class="op" id="3156255">{</span><span class="ident" id="3156256">ErrUnexpectedParen</span><span class="op" id="3156274">,</span>&nbsp;<span class="ident" id="3156276">p</span><span class="op" id="3156277">.</span><span class="ident" id="3156278">wholeRegexp</span><span class="op" id="3156289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156295">re1</span>&nbsp;<span class="op" id="3156299">:=</span>&nbsp;<span class="ident" id="3156302">p</span><span class="op" id="3156303">.</span><span class="ident" id="3156304">stack</span><span class="op" id="3156309">[</span><span class="ident" id="3156310">n</span><span class="op" id="3156311">-</span><span class="num" id="3156312">1</span><span class="op" id="3156313">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156316">re2</span>&nbsp;<span class="op" id="3156320">:=</span>&nbsp;<span class="ident" id="3156323">p</span><span class="op" id="3156324">.</span><span class="ident" id="3156325">stack</span><span class="op" id="3156330">[</span><span class="ident" id="3156331">n</span><span class="op" id="3156332">-</span><span class="num" id="3156333">2</span><span class="op" id="3156334">]</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156337">p</span><span class="op" id="3156338">.</span><span class="ident" id="3156339">stack</span>&nbsp;<span class="op" id="3156345">=</span>&nbsp;<span class="ident" id="3156347">p</span><span class="op" id="3156348">.</span><span class="ident" id="3156349">stack</span><span class="op" id="3156354">[</span><span class="op" id="3156355">:</span><span class="ident" id="3156356">n</span><span class="op" id="3156357">-</span><span class="num" id="3156358">2</span><span class="op" id="3156359">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156362">if</span>&nbsp;<span class="ident" id="3156365">re2</span><span class="op" id="3156368">.</span><span class="ident" id="3156369">Op</span>&nbsp;<span class="op" id="3156372">!=</span>&nbsp;<span class="ident" id="3156375">opLeftParen</span>&nbsp;<span class="op" id="3156387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156391">return</span>&nbsp;<span class="op" id="3156398">&amp;</span><span class="ident" id="3156399">Error</span><span class="op" id="3156404">{</span><span class="ident" id="3156405">ErrUnexpectedParen</span><span class="op" id="3156423">,</span>&nbsp;<span class="ident" id="3156425">p</span><span class="op" id="3156426">.</span><span class="ident" id="3156427">wholeRegexp</span><span class="op" id="3156438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156444">//&nbsp;Restore&nbsp;flags&nbsp;at&nbsp;time&nbsp;of&nbsp;paren.</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156480">p</span><span class="op" id="3156481">.</span><span class="ident" id="3156482">flags</span>&nbsp;<span class="op" id="3156488">=</span>&nbsp;<span class="ident" id="3156490">re2</span><span class="op" id="3156493">.</span><span class="ident" id="3156494">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156501">if</span>&nbsp;<span class="ident" id="3156504">re2</span><span class="op" id="3156507">.</span><span class="ident" id="3156508">Cap</span>&nbsp;<span class="op" id="3156512">==</span>&nbsp;<span class="num" id="3156515">0</span>&nbsp;<span class="op" id="3156517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156521">//&nbsp;Just&nbsp;for&nbsp;grouping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156545">p</span><span class="op" id="3156546">.</span><span class="ident" id="3156547">push</span><span class="op" id="3156551">(</span><span class="ident" id="3156552">re1</span><span class="op" id="3156555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156558">}</span>&nbsp;<span class="keyword" id="3156560">else</span>&nbsp;<span class="op" id="3156565">{</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156569">re2</span><span class="op" id="3156572">.</span><span class="ident" id="3156573">Op</span>&nbsp;<span class="op" id="3156576">=</span>&nbsp;<span class="ident" id="3156578">OpCapture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156590">re2</span><span class="op" id="3156593">.</span><span class="ident" id="3156594">Sub</span>&nbsp;<span class="op" id="3156598">=</span>&nbsp;<span class="ident" id="3156600">re2</span><span class="op" id="3156603">.</span><span class="ident" id="3156604">Sub0</span><span class="op" id="3156608">[</span><span class="op" id="3156609">:</span><span class="num" id="3156610">1</span><span class="op" id="3156611">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156615">re2</span><span class="op" id="3156618">.</span><span class="ident" id="3156619">Sub</span><span class="op" id="3156622">[</span><span class="num" id="3156623">0</span><span class="op" id="3156624">]</span>&nbsp;<span class="op" id="3156626">=</span>&nbsp;<span class="ident" id="3156628">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156634">p</span><span class="op" id="3156635">.</span><span class="ident" id="3156636">push</span><span class="op" id="3156640">(</span><span class="ident" id="3156641">re2</span><span class="op" id="3156644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156647">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156650">return</span>&nbsp;<span class="ident" id="3156657">nil</span><br>
<span class="lineno"></span><span class="op" id="3156661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3156664">//&nbsp;parseEscape&nbsp;parses&nbsp;an&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="3156727">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune.</span><br>
<span class="lineno">1230</span><span class="keyword" id="3156752">func</span>&nbsp;<span class="op" id="3156757">(</span><span class="ident" id="3156758">p</span>&nbsp;<span class="op" id="3156760">*</span><span class="ident" id="3156761">parser</span><span class="op" id="3156767">)</span>&nbsp;<span class="ident" id="3156769">parseEscape</span><span class="op" id="3156780">(</span><span class="ident" id="3156781">s</span>&nbsp;<span class="builtintype" id="3156783">string</span><span class="op" id="3156789">)</span>&nbsp;<span class="op" id="3156791">(</span><span class="ident" id="3156792">r</span>&nbsp;<span class="builtintype" id="3156794">rune</span><span class="op" id="3156798">,</span>&nbsp;<span class="ident" id="3156800">rest</span>&nbsp;<span class="builtintype" id="3156805">string</span><span class="op" id="3156811">,</span>&nbsp;<span class="ident" id="3156813">err</span>&nbsp;<span class="builtintype" id="3156817">error</span><span class="op" id="3156822">)</span>&nbsp;<span class="op" id="3156824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156827">t</span>&nbsp;<span class="op" id="3156829">:=</span>&nbsp;<span class="ident" id="3156832">s</span><span class="op" id="3156833">[</span><span class="num" id="3156834">1</span><span class="op" id="3156835">:</span><span class="op" id="3156836">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156839">if</span>&nbsp;<span class="ident" id="3156842">t</span>&nbsp;<span class="op" id="3156844">==</span>&nbsp;<span class="string" id="3156847">&#34;&#34;</span>&nbsp;<span class="op" id="3156850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156854">return</span>&nbsp;<span class="num" id="3156861">0</span><span class="op" id="3156862">,</span>&nbsp;<span class="string" id="3156864">&#34;&#34;</span><span class="op" id="3156866">,</span>&nbsp;<span class="op" id="3156868">&amp;</span><span class="ident" id="3156869">Error</span><span class="op" id="3156874">{</span><span class="ident" id="3156875">ErrTrailingBackslash</span><span class="op" id="3156895">,</span>&nbsp;<span class="string" id="3156897">&#34;&#34;</span><span class="op" id="3156899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156902">}</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156905">c</span><span class="op" id="3156906">,</span>&nbsp;<span class="ident" id="3156908">t</span><span class="op" id="3156909">,</span>&nbsp;<span class="ident" id="3156911">err</span>&nbsp;<span class="op" id="3156915">:=</span>&nbsp;<span class="ident" id="3156918">nextRune</span><span class="op" id="3156926">(</span><span class="ident" id="3156927">t</span><span class="op" id="3156928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156931">if</span>&nbsp;<span class="ident" id="3156934">err</span>&nbsp;<span class="op" id="3156938">!=</span>&nbsp;<span class="ident" id="3156941">nil</span>&nbsp;<span class="op" id="3156945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156949">return</span>&nbsp;<span class="num" id="3156956">0</span><span class="op" id="3156957">,</span>&nbsp;<span class="string" id="3156959">&#34;&#34;</span><span class="op" id="3156961">,</span>&nbsp;<span class="ident" id="3156963">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1240</span><span class="ident" id="3156971">Switch</span><span class="op" id="3156977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156980">switch</span>&nbsp;<span class="ident" id="3156987">c</span>&nbsp;<span class="op" id="3156989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156992">default</span><span class="op" id="3156999">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157003">if</span>&nbsp;<span class="ident" id="3157006">c</span>&nbsp;<span class="op" id="3157008">&lt;</span>&nbsp;<span class="ident" id="3157010">utf8</span><span class="op" id="3157014">.</span><span class="ident" id="3157015">RuneSelf</span>&nbsp;<span class="op" id="3157024">&amp;&amp;</span>&nbsp;<span class="op" id="3157027">!</span><span class="ident" id="3157028">isalnum</span><span class="op" id="3157035">(</span><span class="ident" id="3157036">c</span><span class="op" id="3157037">)</span>&nbsp;<span class="op" id="3157039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157044">//&nbsp;Escaped&nbsp;non-word&nbsp;characters&nbsp;are&nbsp;always&nbsp;themselves.</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157101">//&nbsp;PCRE&nbsp;is&nbsp;not&nbsp;quite&nbsp;so&nbsp;rigorous:&nbsp;it&nbsp;accepts&nbsp;things&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157161">//&nbsp;\q,&nbsp;but&nbsp;we&nbsp;don&#39;t.&nbsp;&nbsp;We&nbsp;once&nbsp;rejected&nbsp;\_,&nbsp;but&nbsp;too&nbsp;many</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157220">//&nbsp;programs&nbsp;and&nbsp;people&nbsp;insist&nbsp;on&nbsp;using&nbsp;it,&nbsp;so&nbsp;allow&nbsp;\_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157279">return</span>&nbsp;<span class="ident" id="3157286">c</span><span class="op" id="3157287">,</span>&nbsp;<span class="ident" id="3157289">t</span><span class="op" id="3157290">,</span>&nbsp;<span class="ident" id="3157292">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157298">}</span><br>
<span class="lineno">1250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157302">//&nbsp;Octal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157321">case</span>&nbsp;<span class="string" id="3157326">&#39;1&#39;</span><span class="op" id="3157329">,</span>&nbsp;<span class="string" id="3157331">&#39;2&#39;</span><span class="op" id="3157334">,</span>&nbsp;<span class="string" id="3157336">&#39;3&#39;</span><span class="op" id="3157339">,</span>&nbsp;<span class="string" id="3157341">&#39;4&#39;</span><span class="op" id="3157344">,</span>&nbsp;<span class="string" id="3157346">&#39;5&#39;</span><span class="op" id="3157349">,</span>&nbsp;<span class="string" id="3157351">&#39;6&#39;</span><span class="op" id="3157354">,</span>&nbsp;<span class="string" id="3157356">&#39;7&#39;</span><span class="op" id="3157359">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157363">//&nbsp;Single&nbsp;non-zero&nbsp;digit&nbsp;is&nbsp;a&nbsp;backreference;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157424">if</span>&nbsp;<span class="ident" id="3157427">t</span>&nbsp;<span class="op" id="3157429">==</span>&nbsp;<span class="string" id="3157432">&#34;&#34;</span>&nbsp;<span class="op" id="3157435">||</span>&nbsp;<span class="ident" id="3157438">t</span><span class="op" id="3157439">[</span><span class="num" id="3157440">0</span><span class="op" id="3157441">]</span>&nbsp;<span class="op" id="3157443">&lt;</span>&nbsp;<span class="string" id="3157445">&#39;0&#39;</span>&nbsp;<span class="op" id="3157449">||</span>&nbsp;<span class="ident" id="3157452">t</span><span class="op" id="3157453">[</span><span class="num" id="3157454">0</span><span class="op" id="3157455">]</span>&nbsp;<span class="op" id="3157457">&gt;</span>&nbsp;<span class="string" id="3157459">&#39;7&#39;</span>&nbsp;<span class="op" id="3157463">{</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157468">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157480">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157493">case</span>&nbsp;<span class="string" id="3157498">&#39;0&#39;</span><span class="op" id="3157501">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157505">//&nbsp;Consume&nbsp;up&nbsp;to&nbsp;three&nbsp;octal&nbsp;digits;&nbsp;already&nbsp;have&nbsp;one.</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157562">r</span>&nbsp;<span class="op" id="3157564">=</span>&nbsp;<span class="ident" id="3157566">c</span>&nbsp;<span class="op" id="3157568">-</span>&nbsp;<span class="string" id="3157570">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157576">for</span>&nbsp;<span class="ident" id="3157580">i</span>&nbsp;<span class="op" id="3157582">:=</span>&nbsp;<span class="num" id="3157585">1</span><span class="op" id="3157586">;</span>&nbsp;<span class="ident" id="3157588">i</span>&nbsp;<span class="op" id="3157590">&lt;</span>&nbsp;<span class="num" id="3157592">3</span><span class="op" id="3157593">;</span>&nbsp;<span class="ident" id="3157595">i</span><span class="op" id="3157596">++</span>&nbsp;<span class="op" id="3157599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157604">if</span>&nbsp;<span class="ident" id="3157607">t</span>&nbsp;<span class="op" id="3157609">==</span>&nbsp;<span class="string" id="3157612">&#34;&#34;</span>&nbsp;<span class="op" id="3157615">||</span>&nbsp;<span class="ident" id="3157618">t</span><span class="op" id="3157619">[</span><span class="num" id="3157620">0</span><span class="op" id="3157621">]</span>&nbsp;<span class="op" id="3157623">&lt;</span>&nbsp;<span class="string" id="3157625">&#39;0&#39;</span>&nbsp;<span class="op" id="3157629">||</span>&nbsp;<span class="ident" id="3157632">t</span><span class="op" id="3157633">[</span><span class="num" id="3157634">0</span><span class="op" id="3157635">]</span>&nbsp;<span class="op" id="3157637">&gt;</span>&nbsp;<span class="string" id="3157639">&#39;7&#39;</span>&nbsp;<span class="op" id="3157643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157649">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157658">}</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157663">r</span>&nbsp;<span class="op" id="3157665">=</span>&nbsp;<span class="ident" id="3157667">r</span><span class="op" id="3157668">*</span><span class="num" id="3157669">8</span>&nbsp;<span class="op" id="3157671">+</span>&nbsp;<span class="builtintype" id="3157673">rune</span><span class="op" id="3157677">(</span><span class="ident" id="3157678">t</span><span class="op" id="3157679">[</span><span class="num" id="3157680">0</span><span class="op" id="3157681">]</span><span class="op" id="3157682">)</span>&nbsp;<span class="op" id="3157684">-</span>&nbsp;<span class="string" id="3157686">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157693">t</span>&nbsp;<span class="op" id="3157695">=</span>&nbsp;<span class="ident" id="3157697">t</span><span class="op" id="3157698">[</span><span class="num" id="3157699">1</span><span class="op" id="3157700">:</span><span class="op" id="3157701">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157709">return</span>&nbsp;<span class="ident" id="3157716">r</span><span class="op" id="3157717">,</span>&nbsp;<span class="ident" id="3157719">t</span><span class="op" id="3157720">,</span>&nbsp;<span class="ident" id="3157722">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157728">//&nbsp;Hexadecimal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157753">case</span>&nbsp;<span class="string" id="3157758">&#39;x&#39;</span><span class="op" id="3157761">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157765">if</span>&nbsp;<span class="ident" id="3157768">t</span>&nbsp;<span class="op" id="3157770">==</span>&nbsp;<span class="string" id="3157773">&#34;&#34;</span>&nbsp;<span class="op" id="3157776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157781">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157789">}</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157793">if</span>&nbsp;<span class="ident" id="3157796">c</span><span class="op" id="3157797">,</span>&nbsp;<span class="ident" id="3157799">t</span><span class="op" id="3157800">,</span>&nbsp;<span class="ident" id="3157802">err</span>&nbsp;<span class="op" id="3157806">=</span>&nbsp;<span class="ident" id="3157808">nextRune</span><span class="op" id="3157816">(</span><span class="ident" id="3157817">t</span><span class="op" id="3157818">)</span><span class="op" id="3157819">;</span>&nbsp;<span class="ident" id="3157821">err</span>&nbsp;<span class="op" id="3157825">!=</span>&nbsp;<span class="ident" id="3157828">nil</span>&nbsp;<span class="op" id="3157832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157837">return</span>&nbsp;<span class="num" id="3157844">0</span><span class="op" id="3157845">,</span>&nbsp;<span class="string" id="3157847">&#34;&#34;</span><span class="op" id="3157849">,</span>&nbsp;<span class="ident" id="3157851">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157861">if</span>&nbsp;<span class="ident" id="3157864">c</span>&nbsp;<span class="op" id="3157866">==</span>&nbsp;<span class="string" id="3157869">&#39;{&#39;</span>&nbsp;<span class="op" id="3157873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157878">//&nbsp;Any&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;braces.</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157916">//&nbsp;Perl&nbsp;accepts&nbsp;any&nbsp;text&nbsp;at&nbsp;all;&nbsp;it&nbsp;ignores&nbsp;all&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157972">//&nbsp;after&nbsp;the&nbsp;first&nbsp;non-hex&nbsp;digit.&nbsp;&nbsp;We&nbsp;require&nbsp;only&nbsp;hex&nbsp;digits,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3158038">//&nbsp;and&nbsp;at&nbsp;least&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158062">nhex</span>&nbsp;<span class="op" id="3158067">:=</span>&nbsp;<span class="num" id="3158070">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158075">r</span>&nbsp;<span class="op" id="3158077">=</span>&nbsp;<span class="num" id="3158079">0</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158084">for</span>&nbsp;<span class="op" id="3158088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158094">if</span>&nbsp;<span class="ident" id="3158097">t</span>&nbsp;<span class="op" id="3158099">==</span>&nbsp;<span class="string" id="3158102">&#34;&#34;</span>&nbsp;<span class="op" id="3158105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158112">break</span>&nbsp;<span class="ident" id="3158118">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158135">if</span>&nbsp;<span class="ident" id="3158138">c</span><span class="op" id="3158139">,</span>&nbsp;<span class="ident" id="3158141">t</span><span class="op" id="3158142">,</span>&nbsp;<span class="ident" id="3158144">err</span>&nbsp;<span class="op" id="3158148">=</span>&nbsp;<span class="ident" id="3158150">nextRune</span><span class="op" id="3158158">(</span><span class="ident" id="3158159">t</span><span class="op" id="3158160">)</span><span class="op" id="3158161">;</span>&nbsp;<span class="ident" id="3158163">err</span>&nbsp;<span class="op" id="3158167">!=</span>&nbsp;<span class="ident" id="3158170">nil</span>&nbsp;<span class="op" id="3158174">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158181">return</span>&nbsp;<span class="num" id="3158188">0</span><span class="op" id="3158189">,</span>&nbsp;<span class="string" id="3158191">&#34;&#34;</span><span class="op" id="3158193">,</span>&nbsp;<span class="ident" id="3158195">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158209">if</span>&nbsp;<span class="ident" id="3158212">c</span>&nbsp;<span class="op" id="3158214">==</span>&nbsp;<span class="string" id="3158217">&#39;}&#39;</span>&nbsp;<span class="op" id="3158221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158228">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158238">}</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158244">v</span>&nbsp;<span class="op" id="3158246">:=</span>&nbsp;<span class="ident" id="3158249">unhex</span><span class="op" id="3158254">(</span><span class="ident" id="3158255">c</span><span class="op" id="3158256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158262">if</span>&nbsp;<span class="ident" id="3158265">v</span>&nbsp;<span class="op" id="3158267">&lt;</span>&nbsp;<span class="num" id="3158269">0</span>&nbsp;<span class="op" id="3158271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158278">break</span>&nbsp;<span class="ident" id="3158284">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158301">r</span>&nbsp;<span class="op" id="3158303">=</span>&nbsp;<span class="ident" id="3158305">r</span><span class="op" id="3158306">*</span><span class="num" id="3158307">16</span>&nbsp;<span class="op" id="3158310">+</span>&nbsp;<span class="ident" id="3158312">v</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158318">if</span>&nbsp;<span class="ident" id="3158321">r</span>&nbsp;<span class="op" id="3158323">&gt;</span>&nbsp;<span class="ident" id="3158325">unicode</span><span class="op" id="3158332">.</span><span class="ident" id="3158333">MaxRune</span>&nbsp;<span class="op" id="3158341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158348">break</span>&nbsp;<span class="ident" id="3158354">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158371">nhex</span><span class="op" id="3158375">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158381">}</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158386">if</span>&nbsp;<span class="ident" id="3158389">nhex</span>&nbsp;<span class="op" id="3158394">==</span>&nbsp;<span class="num" id="3158397">0</span>&nbsp;<span class="op" id="3158399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158405">break</span>&nbsp;<span class="ident" id="3158411">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158426">return</span>&nbsp;<span class="ident" id="3158433">r</span><span class="op" id="3158434">,</span>&nbsp;<span class="ident" id="3158436">t</span><span class="op" id="3158437">,</span>&nbsp;<span class="ident" id="3158439">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158445">}</span><br>
<span class="lineno">1310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3158450">//&nbsp;Easy&nbsp;case:&nbsp;two&nbsp;hex&nbsp;digits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158482">x</span>&nbsp;<span class="op" id="3158484">:=</span>&nbsp;<span class="ident" id="3158487">unhex</span><span class="op" id="3158492">(</span><span class="ident" id="3158493">c</span><span class="op" id="3158494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158498">if</span>&nbsp;<span class="ident" id="3158501">c</span><span class="op" id="3158502">,</span>&nbsp;<span class="ident" id="3158504">t</span><span class="op" id="3158505">,</span>&nbsp;<span class="ident" id="3158507">err</span>&nbsp;<span class="op" id="3158511">=</span>&nbsp;<span class="ident" id="3158513">nextRune</span><span class="op" id="3158521">(</span><span class="ident" id="3158522">t</span><span class="op" id="3158523">)</span><span class="op" id="3158524">;</span>&nbsp;<span class="ident" id="3158526">err</span>&nbsp;<span class="op" id="3158530">!=</span>&nbsp;<span class="ident" id="3158533">nil</span>&nbsp;<span class="op" id="3158537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158542">return</span>&nbsp;<span class="num" id="3158549">0</span><span class="op" id="3158550">,</span>&nbsp;<span class="string" id="3158552">&#34;&#34;</span><span class="op" id="3158554">,</span>&nbsp;<span class="ident" id="3158556">err</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158566">y</span>&nbsp;<span class="op" id="3158568">:=</span>&nbsp;<span class="ident" id="3158571">unhex</span><span class="op" id="3158576">(</span><span class="ident" id="3158577">c</span><span class="op" id="3158578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158582">if</span>&nbsp;<span class="ident" id="3158585">x</span>&nbsp;<span class="op" id="3158587">&lt;</span>&nbsp;<span class="num" id="3158589">0</span>&nbsp;<span class="op" id="3158591">||</span>&nbsp;<span class="ident" id="3158594">y</span>&nbsp;<span class="op" id="3158596">&lt;</span>&nbsp;<span class="num" id="3158598">0</span>&nbsp;<span class="op" id="3158600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158605">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158613">}</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158617">return</span>&nbsp;<span class="ident" id="3158624">x</span><span class="op" id="3158625">*</span><span class="num" id="3158626">16</span>&nbsp;<span class="op" id="3158629">+</span>&nbsp;<span class="ident" id="3158631">y</span><span class="op" id="3158632">,</span>&nbsp;<span class="ident" id="3158634">t</span><span class="op" id="3158635">,</span>&nbsp;<span class="ident" id="3158637">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3158643">//&nbsp;C&nbsp;escapes.&nbsp;&nbsp;There&nbsp;is&nbsp;no&nbsp;case&nbsp;&#39;b&#39;,&nbsp;to&nbsp;avoid&nbsp;misparsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3158701">//&nbsp;the&nbsp;Perl&nbsp;word-boundary&nbsp;\b&nbsp;as&nbsp;the&nbsp;C&nbsp;backspace&nbsp;\b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3158753">//&nbsp;when&nbsp;in&nbsp;POSIX&nbsp;mode.&nbsp;&nbsp;In&nbsp;Perl,&nbsp;/\b/&nbsp;means&nbsp;word-boundary</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3158812">//&nbsp;but&nbsp;/[\b]/&nbsp;means&nbsp;backspace.&nbsp;&nbsp;We&nbsp;don&#39;t&nbsp;support&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3158868">//&nbsp;If&nbsp;you&nbsp;want&nbsp;a&nbsp;backspace,&nbsp;embed&nbsp;a&nbsp;literal&nbsp;backspace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3158923">//&nbsp;character&nbsp;or&nbsp;use&nbsp;\x08.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158950">case</span>&nbsp;<span class="string" id="3158955">&#39;a&#39;</span><span class="op" id="3158958">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158962">return</span>&nbsp;<span class="string" id="3158969">&#39;\a&#39;</span><span class="op" id="3158973">,</span>&nbsp;<span class="ident" id="3158975">t</span><span class="op" id="3158976">,</span>&nbsp;<span class="ident" id="3158978">err</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158983">case</span>&nbsp;<span class="string" id="3158988">&#39;f&#39;</span><span class="op" id="3158991">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158995">return</span>&nbsp;<span class="string" id="3159002">&#39;\f&#39;</span><span class="op" id="3159006">,</span>&nbsp;<span class="ident" id="3159008">t</span><span class="op" id="3159009">,</span>&nbsp;<span class="ident" id="3159011">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159016">case</span>&nbsp;<span class="string" id="3159021">&#39;n&#39;</span><span class="op" id="3159024">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159028">return</span>&nbsp;<span class="string" id="3159035">&#39;\n&#39;</span><span class="op" id="3159039">,</span>&nbsp;<span class="ident" id="3159041">t</span><span class="op" id="3159042">,</span>&nbsp;<span class="ident" id="3159044">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159049">case</span>&nbsp;<span class="string" id="3159054">&#39;r&#39;</span><span class="op" id="3159057">:</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159061">return</span>&nbsp;<span class="string" id="3159068">&#39;\r&#39;</span><span class="op" id="3159072">,</span>&nbsp;<span class="ident" id="3159074">t</span><span class="op" id="3159075">,</span>&nbsp;<span class="ident" id="3159077">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159082">case</span>&nbsp;<span class="string" id="3159087">&#39;t&#39;</span><span class="op" id="3159090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159094">return</span>&nbsp;<span class="string" id="3159101">&#39;\t&#39;</span><span class="op" id="3159105">,</span>&nbsp;<span class="ident" id="3159107">t</span><span class="op" id="3159108">,</span>&nbsp;<span class="ident" id="3159110">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159115">case</span>&nbsp;<span class="string" id="3159120">&#39;v&#39;</span><span class="op" id="3159123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159127">return</span>&nbsp;<span class="string" id="3159134">&#39;\v&#39;</span><span class="op" id="3159138">,</span>&nbsp;<span class="ident" id="3159140">t</span><span class="op" id="3159141">,</span>&nbsp;<span class="ident" id="3159143">err</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159151">return</span>&nbsp;<span class="num" id="3159158">0</span><span class="op" id="3159159">,</span>&nbsp;<span class="string" id="3159161">&#34;&#34;</span><span class="op" id="3159163">,</span>&nbsp;<span class="op" id="3159165">&amp;</span><span class="ident" id="3159166">Error</span><span class="op" id="3159171">{</span><span class="ident" id="3159172">ErrInvalidEscape</span><span class="op" id="3159188">,</span>&nbsp;<span class="ident" id="3159190">s</span><span class="op" id="3159191">[</span><span class="op" id="3159192">:</span><span class="builtinfunc" id="3159193">len</span><span class="op" id="3159196">(</span><span class="ident" id="3159197">s</span><span class="op" id="3159198">)</span><span class="op" id="3159199">-</span><span class="builtinfunc" id="3159200">len</span><span class="op" id="3159203">(</span><span class="ident" id="3159204">t</span><span class="op" id="3159205">)</span><span class="op" id="3159206">]</span><span class="op" id="3159207">}</span><br>
<span class="lineno"></span><span class="op" id="3159209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3159212">//&nbsp;parseClassChar&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;character&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno">1345</span><span class="comment" id="3159287">//&nbsp;and&nbsp;returns&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3159306">func</span>&nbsp;<span class="op" id="3159311">(</span><span class="ident" id="3159312">p</span>&nbsp;<span class="op" id="3159314">*</span><span class="ident" id="3159315">parser</span><span class="op" id="3159321">)</span>&nbsp;<span class="ident" id="3159323">parseClassChar</span><span class="op" id="3159337">(</span><span class="ident" id="3159338">s</span><span class="op" id="3159339">,</span>&nbsp;<span class="ident" id="3159341">wholeClass</span>&nbsp;<span class="builtintype" id="3159352">string</span><span class="op" id="3159358">)</span>&nbsp;<span class="op" id="3159360">(</span><span class="ident" id="3159361">r</span>&nbsp;<span class="builtintype" id="3159363">rune</span><span class="op" id="3159367">,</span>&nbsp;<span class="ident" id="3159369">rest</span>&nbsp;<span class="builtintype" id="3159374">string</span><span class="op" id="3159380">,</span>&nbsp;<span class="ident" id="3159382">err</span>&nbsp;<span class="builtintype" id="3159386">error</span><span class="op" id="3159391">)</span>&nbsp;<span class="op" id="3159393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159396">if</span>&nbsp;<span class="ident" id="3159399">s</span>&nbsp;<span class="op" id="3159401">==</span>&nbsp;<span class="string" id="3159404">&#34;&#34;</span>&nbsp;<span class="op" id="3159407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159411">return</span>&nbsp;<span class="num" id="3159418">0</span><span class="op" id="3159419">,</span>&nbsp;<span class="string" id="3159421">&#34;&#34;</span><span class="op" id="3159423">,</span>&nbsp;<span class="op" id="3159425">&amp;</span><span class="ident" id="3159426">Error</span><span class="op" id="3159431">{</span><span class="ident" id="3159432">Code</span><span class="op" id="3159436">:</span>&nbsp;<span class="ident" id="3159438">ErrMissingBracket</span><span class="op" id="3159455">,</span>&nbsp;<span class="ident" id="3159457">Expr</span><span class="op" id="3159461">:</span>&nbsp;<span class="ident" id="3159463">wholeClass</span><span class="op" id="3159473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159476">}</span><br>
<span class="lineno">1350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3159480">//&nbsp;Allow&nbsp;regular&nbsp;escape&nbsp;sequences&nbsp;even&nbsp;though</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3159527">//&nbsp;many&nbsp;need&nbsp;not&nbsp;be&nbsp;escaped&nbsp;in&nbsp;this&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159573">if</span>&nbsp;<span class="ident" id="3159576">s</span><span class="op" id="3159577">[</span><span class="num" id="3159578">0</span><span class="op" id="3159579">]</span>&nbsp;<span class="op" id="3159581">==</span>&nbsp;<span class="string" id="3159584">&#39;\\&#39;</span>&nbsp;<span class="op" id="3159589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159593">return</span>&nbsp;<span class="ident" id="3159600">p</span><span class="op" id="3159601">.</span><span class="ident" id="3159602">parseEscape</span><span class="op" id="3159613">(</span><span class="ident" id="3159614">s</span><span class="op" id="3159615">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159622">return</span>&nbsp;<span class="ident" id="3159629">nextRune</span><span class="op" id="3159637">(</span><span class="ident" id="3159638">s</span><span class="op" id="3159639">)</span><br>
<span class="lineno"></span><span class="op" id="3159641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1360</span><span class="keyword" id="3159644">type</span>&nbsp;<span class="ident" id="3159649">charGroup</span>&nbsp;<span class="keyword" id="3159659">struct</span>&nbsp;<span class="op" id="3159666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159669">sign</span>&nbsp;&nbsp;<span class="builtintype" id="3159675">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159680">class</span>&nbsp;<span class="op" id="3159686">[</span><span class="op" id="3159687">]</span><span class="builtintype" id="3159688">rune</span><br>
<span class="lineno"></span><span class="op" id="3159693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1365</span><span class="comment" id="3159696">//&nbsp;parsePerlClassEscape&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape&nbsp;like&nbsp;\d</span><br>
<span class="lineno"></span><span class="comment" id="3159773">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="3159852">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3159916">func</span>&nbsp;<span class="op" id="3159921">(</span><span class="ident" id="3159922">p</span>&nbsp;<span class="op" id="3159924">*</span><span class="ident" id="3159925">parser</span><span class="op" id="3159931">)</span>&nbsp;<span class="ident" id="3159933">parsePerlClassEscape</span><span class="op" id="3159953">(</span><span class="ident" id="3159954">s</span>&nbsp;<span class="builtintype" id="3159956">string</span><span class="op" id="3159962">,</span>&nbsp;<span class="ident" id="3159964">r</span>&nbsp;<span class="op" id="3159966">[</span><span class="op" id="3159967">]</span><span class="builtintype" id="3159968">rune</span><span class="op" id="3159972">)</span>&nbsp;<span class="op" id="3159974">(</span><span class="ident" id="3159975">out</span>&nbsp;<span class="op" id="3159979">[</span><span class="op" id="3159980">]</span><span class="builtintype" id="3159981">rune</span><span class="op" id="3159985">,</span>&nbsp;<span class="ident" id="3159987">rest</span>&nbsp;<span class="builtintype" id="3159992">string</span><span class="op" id="3159998">)</span>&nbsp;<span class="op" id="3160000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160003">if</span>&nbsp;<span class="ident" id="3160006">p</span><span class="op" id="3160007">.</span><span class="ident" id="3160008">flags</span><span class="op" id="3160013">&amp;</span><span class="ident" id="3160014">PerlX</span>&nbsp;<span class="op" id="3160020">==</span>&nbsp;<span class="num" id="3160023">0</span>&nbsp;<span class="op" id="3160025">||</span>&nbsp;<span class="builtinfunc" id="3160028">len</span><span class="op" id="3160031">(</span><span class="ident" id="3160032">s</span><span class="op" id="3160033">)</span>&nbsp;<span class="op" id="3160035">&lt;</span>&nbsp;<span class="num" id="3160037">2</span>&nbsp;<span class="op" id="3160039">||</span>&nbsp;<span class="ident" id="3160042">s</span><span class="op" id="3160043">[</span><span class="num" id="3160044">0</span><span class="op" id="3160045">]</span>&nbsp;<span class="op" id="3160047">!=</span>&nbsp;<span class="string" id="3160050">&#39;\\&#39;</span>&nbsp;<span class="op" id="3160055">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160059">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160070">g</span>&nbsp;<span class="op" id="3160072">:=</span>&nbsp;<span class="ident" id="3160075">perlGroup</span><span class="op" id="3160084">[</span><span class="ident" id="3160085">s</span><span class="op" id="3160086">[</span><span class="num" id="3160087">0</span><span class="op" id="3160088">:</span><span class="num" id="3160089">2</span><span class="op" id="3160090">]</span><span class="op" id="3160091">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160094">if</span>&nbsp;<span class="ident" id="3160097">g</span><span class="op" id="3160098">.</span><span class="ident" id="3160099">sign</span>&nbsp;<span class="op" id="3160104">==</span>&nbsp;<span class="num" id="3160107">0</span>&nbsp;<span class="op" id="3160109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160113">return</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160124">return</span>&nbsp;<span class="ident" id="3160131">p</span><span class="op" id="3160132">.</span><span class="ident" id="3160133">appendGroup</span><span class="op" id="3160144">(</span><span class="ident" id="3160145">r</span><span class="op" id="3160146">,</span>&nbsp;<span class="ident" id="3160148">g</span><span class="op" id="3160149">)</span><span class="op" id="3160150">,</span>&nbsp;<span class="ident" id="3160152">s</span><span class="op" id="3160153">[</span><span class="num" id="3160154">2</span><span class="op" id="3160155">:</span><span class="op" id="3160156">]</span><br>
<span class="lineno"></span><span class="op" id="3160158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3160161">//&nbsp;parseNamedClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;POSIX&nbsp;named&nbsp;character&nbsp;class&nbsp;like&nbsp;[:alnum:]</span><br>
<span class="lineno">1380</span><span class="comment" id="3160240">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="3160319">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3160383">func</span>&nbsp;<span class="op" id="3160388">(</span><span class="ident" id="3160389">p</span>&nbsp;<span class="op" id="3160391">*</span><span class="ident" id="3160392">parser</span><span class="op" id="3160398">)</span>&nbsp;<span class="ident" id="3160400">parseNamedClass</span><span class="op" id="3160415">(</span><span class="ident" id="3160416">s</span>&nbsp;<span class="builtintype" id="3160418">string</span><span class="op" id="3160424">,</span>&nbsp;<span class="ident" id="3160426">r</span>&nbsp;<span class="op" id="3160428">[</span><span class="op" id="3160429">]</span><span class="builtintype" id="3160430">rune</span><span class="op" id="3160434">)</span>&nbsp;<span class="op" id="3160436">(</span><span class="ident" id="3160437">out</span>&nbsp;<span class="op" id="3160441">[</span><span class="op" id="3160442">]</span><span class="builtintype" id="3160443">rune</span><span class="op" id="3160447">,</span>&nbsp;<span class="ident" id="3160449">rest</span>&nbsp;<span class="builtintype" id="3160454">string</span><span class="op" id="3160460">,</span>&nbsp;<span class="ident" id="3160462">err</span>&nbsp;<span class="builtintype" id="3160466">error</span><span class="op" id="3160471">)</span>&nbsp;<span class="op" id="3160473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160476">if</span>&nbsp;<span class="builtinfunc" id="3160479">len</span><span class="op" id="3160482">(</span><span class="ident" id="3160483">s</span><span class="op" id="3160484">)</span>&nbsp;<span class="op" id="3160486">&lt;</span>&nbsp;<span class="num" id="3160488">2</span>&nbsp;<span class="op" id="3160490">||</span>&nbsp;<span class="ident" id="3160493">s</span><span class="op" id="3160494">[</span><span class="num" id="3160495">0</span><span class="op" id="3160496">]</span>&nbsp;<span class="op" id="3160498">!=</span>&nbsp;<span class="string" id="3160501">&#39;[&#39;</span>&nbsp;<span class="op" id="3160505">||</span>&nbsp;<span class="ident" id="3160508">s</span><span class="op" id="3160509">[</span><span class="num" id="3160510">1</span><span class="op" id="3160511">]</span>&nbsp;<span class="op" id="3160513">!=</span>&nbsp;<span class="string" id="3160516">&#39;:&#39;</span>&nbsp;<span class="op" id="3160520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160524">return</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160536">i</span>&nbsp;<span class="op" id="3160538">:=</span>&nbsp;<span class="ident" id="3160541">strings</span><span class="op" id="3160548">.</span><span class="ident" id="3160549">Index</span><span class="op" id="3160554">(</span><span class="ident" id="3160555">s</span><span class="op" id="3160556">[</span><span class="num" id="3160557">2</span><span class="op" id="3160558">:</span><span class="op" id="3160559">]</span><span class="op" id="3160560">,</span>&nbsp;<span class="string" id="3160562">&#34;:]&#34;</span><span class="op" id="3160566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160569">if</span>&nbsp;<span class="ident" id="3160572">i</span>&nbsp;<span class="op" id="3160574">&lt;</span>&nbsp;<span class="num" id="3160576">0</span>&nbsp;<span class="op" id="3160578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160582">return</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160593">i</span>&nbsp;<span class="op" id="3160595">+=</span>&nbsp;<span class="num" id="3160598">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160601">name</span><span class="op" id="3160605">,</span>&nbsp;<span class="ident" id="3160607">s</span>&nbsp;<span class="op" id="3160609">:=</span>&nbsp;<span class="ident" id="3160612">s</span><span class="op" id="3160613">[</span><span class="num" id="3160614">0</span><span class="op" id="3160615">:</span><span class="ident" id="3160616">i</span><span class="op" id="3160617">+</span><span class="num" id="3160618">2</span><span class="op" id="3160619">]</span><span class="op" id="3160620">,</span>&nbsp;<span class="ident" id="3160622">s</span><span class="op" id="3160623">[</span><span class="ident" id="3160624">i</span><span class="op" id="3160625">+</span><span class="num" id="3160626">2</span><span class="op" id="3160627">:</span><span class="op" id="3160628">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160631">g</span>&nbsp;<span class="op" id="3160633">:=</span>&nbsp;<span class="ident" id="3160636">posixGroup</span><span class="op" id="3160646">[</span><span class="ident" id="3160647">name</span><span class="op" id="3160651">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160654">if</span>&nbsp;<span class="ident" id="3160657">g</span><span class="op" id="3160658">.</span><span class="ident" id="3160659">sign</span>&nbsp;<span class="op" id="3160664">==</span>&nbsp;<span class="num" id="3160667">0</span>&nbsp;<span class="op" id="3160669">{</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160673">return</span>&nbsp;<span class="ident" id="3160680">nil</span><span class="op" id="3160683">,</span>&nbsp;<span class="string" id="3160685">&#34;&#34;</span><span class="op" id="3160687">,</span>&nbsp;<span class="op" id="3160689">&amp;</span><span class="ident" id="3160690">Error</span><span class="op" id="3160695">{</span><span class="ident" id="3160696">ErrInvalidCharRange</span><span class="op" id="3160715">,</span>&nbsp;<span class="ident" id="3160717">name</span><span class="op" id="3160721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160727">return</span>&nbsp;<span class="ident" id="3160734">p</span><span class="op" id="3160735">.</span><span class="ident" id="3160736">appendGroup</span><span class="op" id="3160747">(</span><span class="ident" id="3160748">r</span><span class="op" id="3160749">,</span>&nbsp;<span class="ident" id="3160751">g</span><span class="op" id="3160752">)</span><span class="op" id="3160753">,</span>&nbsp;<span class="ident" id="3160755">s</span><span class="op" id="3160756">,</span>&nbsp;<span class="ident" id="3160758">nil</span><br>
<span class="lineno"></span><span class="op" id="3160762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1400</span><span class="keyword" id="3160765">func</span>&nbsp;<span class="op" id="3160770">(</span><span class="ident" id="3160771">p</span>&nbsp;<span class="op" id="3160773">*</span><span class="ident" id="3160774">parser</span><span class="op" id="3160780">)</span>&nbsp;<span class="ident" id="3160782">appendGroup</span><span class="op" id="3160793">(</span><span class="ident" id="3160794">r</span>&nbsp;<span class="op" id="3160796">[</span><span class="op" id="3160797">]</span><span class="builtintype" id="3160798">rune</span><span class="op" id="3160802">,</span>&nbsp;<span class="ident" id="3160804">g</span>&nbsp;<span class="ident" id="3160806">charGroup</span><span class="op" id="3160815">)</span>&nbsp;<span class="op" id="3160817">[</span><span class="op" id="3160818">]</span><span class="builtintype" id="3160819">rune</span>&nbsp;<span class="op" id="3160824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160827">if</span>&nbsp;<span class="ident" id="3160830">p</span><span class="op" id="3160831">.</span><span class="ident" id="3160832">flags</span><span class="op" id="3160837">&amp;</span><span class="ident" id="3160838">FoldCase</span>&nbsp;<span class="op" id="3160847">==</span>&nbsp;<span class="num" id="3160850">0</span>&nbsp;<span class="op" id="3160852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160856">if</span>&nbsp;<span class="ident" id="3160859">g</span><span class="op" id="3160860">.</span><span class="ident" id="3160861">sign</span>&nbsp;<span class="op" id="3160866">&lt;</span>&nbsp;<span class="num" id="3160868">0</span>&nbsp;<span class="op" id="3160870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160875">r</span>&nbsp;<span class="op" id="3160877">=</span>&nbsp;<span class="ident" id="3160879">appendNegatedClass</span><span class="op" id="3160897">(</span><span class="ident" id="3160898">r</span><span class="op" id="3160899">,</span>&nbsp;<span class="ident" id="3160901">g</span><span class="op" id="3160902">.</span><span class="ident" id="3160903">class</span><span class="op" id="3160908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160912">}</span>&nbsp;<span class="keyword" id="3160914">else</span>&nbsp;<span class="op" id="3160919">{</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160924">r</span>&nbsp;<span class="op" id="3160926">=</span>&nbsp;<span class="ident" id="3160928">appendClass</span><span class="op" id="3160939">(</span><span class="ident" id="3160940">r</span><span class="op" id="3160941">,</span>&nbsp;<span class="ident" id="3160943">g</span><span class="op" id="3160944">.</span><span class="ident" id="3160945">class</span><span class="op" id="3160950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160957">}</span>&nbsp;<span class="keyword" id="3160959">else</span>&nbsp;<span class="op" id="3160964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160968">tmp</span>&nbsp;<span class="op" id="3160972">:=</span>&nbsp;<span class="ident" id="3160975">p</span><span class="op" id="3160976">.</span><span class="ident" id="3160977">tmpClass</span><span class="op" id="3160985">[</span><span class="op" id="3160986">:</span><span class="num" id="3160987">0</span><span class="op" id="3160988">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160992">tmp</span>&nbsp;<span class="op" id="3160996">=</span>&nbsp;<span class="ident" id="3160998">appendFoldedClass</span><span class="op" id="3161015">(</span><span class="ident" id="3161016">tmp</span><span class="op" id="3161019">,</span>&nbsp;<span class="ident" id="3161021">g</span><span class="op" id="3161022">.</span><span class="ident" id="3161023">class</span><span class="op" id="3161028">)</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161032">p</span><span class="op" id="3161033">.</span><span class="ident" id="3161034">tmpClass</span>&nbsp;<span class="op" id="3161043">=</span>&nbsp;<span class="ident" id="3161045">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161051">tmp</span>&nbsp;<span class="op" id="3161055">=</span>&nbsp;<span class="ident" id="3161057">cleanClass</span><span class="op" id="3161067">(</span><span class="op" id="3161068">&amp;</span><span class="ident" id="3161069">p</span><span class="op" id="3161070">.</span><span class="ident" id="3161071">tmpClass</span><span class="op" id="3161079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161083">if</span>&nbsp;<span class="ident" id="3161086">g</span><span class="op" id="3161087">.</span><span class="ident" id="3161088">sign</span>&nbsp;<span class="op" id="3161093">&lt;</span>&nbsp;<span class="num" id="3161095">0</span>&nbsp;<span class="op" id="3161097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161102">r</span>&nbsp;<span class="op" id="3161104">=</span>&nbsp;<span class="ident" id="3161106">appendNegatedClass</span><span class="op" id="3161124">(</span><span class="ident" id="3161125">r</span><span class="op" id="3161126">,</span>&nbsp;<span class="ident" id="3161128">tmp</span><span class="op" id="3161131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161135">}</span>&nbsp;<span class="keyword" id="3161137">else</span>&nbsp;<span class="op" id="3161142">{</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161147">r</span>&nbsp;<span class="op" id="3161149">=</span>&nbsp;<span class="ident" id="3161151">appendClass</span><span class="op" id="3161162">(</span><span class="ident" id="3161163">r</span><span class="op" id="3161164">,</span>&nbsp;<span class="ident" id="3161166">tmp</span><span class="op" id="3161169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161179">return</span>&nbsp;<span class="ident" id="3161186">r</span><br>
<span class="lineno"></span><span class="op" id="3161188">}</span><br>
<span class="lineno">1420</span><br>
<span class="lineno"></span><span class="keyword" id="3161191">var</span>&nbsp;<span class="ident" id="3161195">anyTable</span>&nbsp;<span class="op" id="3161204">=</span>&nbsp;<span class="op" id="3161206">&amp;</span><span class="ident" id="3161207">unicode</span><span class="op" id="3161214">.</span><span class="ident" id="3161215">RangeTable</span><span class="op" id="3161225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161228">R16</span><span class="op" id="3161231">:</span>&nbsp;<span class="op" id="3161233">[</span><span class="op" id="3161234">]</span><span class="ident" id="3161235">unicode</span><span class="op" id="3161242">.</span><span class="ident" id="3161243">Range16</span><span class="op" id="3161250">{</span><span class="op" id="3161251">{</span><span class="ident" id="3161252">Lo</span><span class="op" id="3161254">:</span>&nbsp;<span class="num" id="3161256">0</span><span class="op" id="3161257">,</span>&nbsp;<span class="ident" id="3161259">Hi</span><span class="op" id="3161261">:</span>&nbsp;<span class="num" id="3161263">1</span><span class="op" id="3161264">&lt;&lt;</span><span class="num" id="3161266">16</span>&nbsp;<span class="op" id="3161269">-</span>&nbsp;<span class="num" id="3161271">1</span><span class="op" id="3161272">,</span>&nbsp;<span class="ident" id="3161274">Stride</span><span class="op" id="3161280">:</span>&nbsp;<span class="num" id="3161282">1</span><span class="op" id="3161283">}</span><span class="op" id="3161284">}</span><span class="op" id="3161285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161288">R32</span><span class="op" id="3161291">:</span>&nbsp;<span class="op" id="3161293">[</span><span class="op" id="3161294">]</span><span class="ident" id="3161295">unicode</span><span class="op" id="3161302">.</span><span class="ident" id="3161303">Range32</span><span class="op" id="3161310">{</span><span class="op" id="3161311">{</span><span class="ident" id="3161312">Lo</span><span class="op" id="3161314">:</span>&nbsp;<span class="num" id="3161316">1</span>&nbsp;<span class="op" id="3161318">&lt;&lt;</span>&nbsp;<span class="num" id="3161321">16</span><span class="op" id="3161323">,</span>&nbsp;<span class="ident" id="3161325">Hi</span><span class="op" id="3161327">:</span>&nbsp;<span class="ident" id="3161329">unicode</span><span class="op" id="3161336">.</span><span class="ident" id="3161337">MaxRune</span><span class="op" id="3161344">,</span>&nbsp;<span class="ident" id="3161346">Stride</span><span class="op" id="3161352">:</span>&nbsp;<span class="num" id="3161354">1</span><span class="op" id="3161355">}</span><span class="op" id="3161356">}</span><span class="op" id="3161357">,</span><br>
<span class="lineno"></span><span class="op" id="3161359">}</span><br>
<span class="lineno">1425</span><br>
<span class="lineno"></span><span class="comment" id="3161362">//&nbsp;unicodeTable&nbsp;returns&nbsp;the&nbsp;unicode.RangeTable&nbsp;identified&nbsp;by&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="3161428">//&nbsp;and&nbsp;the&nbsp;table&nbsp;of&nbsp;additional&nbsp;fold-equivalent&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="3161488">func</span>&nbsp;<span class="ident" id="3161493">unicodeTable</span><span class="op" id="3161505">(</span><span class="ident" id="3161506">name</span>&nbsp;<span class="builtintype" id="3161511">string</span><span class="op" id="3161517">)</span>&nbsp;<span class="op" id="3161519">(</span><span class="op" id="3161520">*</span><span class="ident" id="3161521">unicode</span><span class="op" id="3161528">.</span><span class="ident" id="3161529">RangeTable</span><span class="op" id="3161539">,</span>&nbsp;<span class="op" id="3161541">*</span><span class="ident" id="3161542">unicode</span><span class="op" id="3161549">.</span><span class="ident" id="3161550">RangeTable</span><span class="op" id="3161560">)</span>&nbsp;<span class="op" id="3161562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3161565">//&nbsp;Special&nbsp;case:&nbsp;&#34;Any&#34;&nbsp;means&nbsp;any.</span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161600">if</span>&nbsp;<span class="ident" id="3161603">name</span>&nbsp;<span class="op" id="3161608">==</span>&nbsp;<span class="string" id="3161611">&#34;Any&#34;</span>&nbsp;<span class="op" id="3161617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161621">return</span>&nbsp;<span class="ident" id="3161628">anyTable</span><span class="op" id="3161636">,</span>&nbsp;<span class="ident" id="3161638">anyTable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161651">if</span>&nbsp;<span class="ident" id="3161654">t</span>&nbsp;<span class="op" id="3161656">:=</span>&nbsp;<span class="ident" id="3161659">unicode</span><span class="op" id="3161666">.</span><span class="ident" id="3161667">Categories</span><span class="op" id="3161677">[</span><span class="ident" id="3161678">name</span><span class="op" id="3161682">]</span><span class="op" id="3161683">;</span>&nbsp;<span class="ident" id="3161685">t</span>&nbsp;<span class="op" id="3161687">!=</span>&nbsp;<span class="ident" id="3161690">nil</span>&nbsp;<span class="op" id="3161694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161698">return</span>&nbsp;<span class="ident" id="3161705">t</span><span class="op" id="3161706">,</span>&nbsp;<span class="ident" id="3161708">unicode</span><span class="op" id="3161715">.</span><span class="ident" id="3161716">FoldCategory</span><span class="op" id="3161728">[</span><span class="ident" id="3161729">name</span><span class="op" id="3161733">]</span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161739">if</span>&nbsp;<span class="ident" id="3161742">t</span>&nbsp;<span class="op" id="3161744">:=</span>&nbsp;<span class="ident" id="3161747">unicode</span><span class="op" id="3161754">.</span><span class="ident" id="3161755">Scripts</span><span class="op" id="3161762">[</span><span class="ident" id="3161763">name</span><span class="op" id="3161767">]</span><span class="op" id="3161768">;</span>&nbsp;<span class="ident" id="3161770">t</span>&nbsp;<span class="op" id="3161772">!=</span>&nbsp;<span class="ident" id="3161775">nil</span>&nbsp;<span class="op" id="3161779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161783">return</span>&nbsp;<span class="ident" id="3161790">t</span><span class="op" id="3161791">,</span>&nbsp;<span class="ident" id="3161793">unicode</span><span class="op" id="3161800">.</span><span class="ident" id="3161801">FoldScript</span><span class="op" id="3161811">[</span><span class="ident" id="3161812">name</span><span class="op" id="3161816">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161822">return</span>&nbsp;<span class="ident" id="3161829">nil</span><span class="op" id="3161832">,</span>&nbsp;<span class="ident" id="3161834">nil</span><br>
<span class="lineno">1440</span><span class="op" id="3161838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3161841">//&nbsp;parseUnicodeClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Unicode&nbsp;character&nbsp;class&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span><span class="comment" id="3161916">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="3161995">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno">1445</span><span class="keyword" id="3162059">func</span>&nbsp;<span class="op" id="3162064">(</span><span class="ident" id="3162065">p</span>&nbsp;<span class="op" id="3162067">*</span><span class="ident" id="3162068">parser</span><span class="op" id="3162074">)</span>&nbsp;<span class="ident" id="3162076">parseUnicodeClass</span><span class="op" id="3162093">(</span><span class="ident" id="3162094">s</span>&nbsp;<span class="builtintype" id="3162096">string</span><span class="op" id="3162102">,</span>&nbsp;<span class="ident" id="3162104">r</span>&nbsp;<span class="op" id="3162106">[</span><span class="op" id="3162107">]</span><span class="builtintype" id="3162108">rune</span><span class="op" id="3162112">)</span>&nbsp;<span class="op" id="3162114">(</span><span class="ident" id="3162115">out</span>&nbsp;<span class="op" id="3162119">[</span><span class="op" id="3162120">]</span><span class="builtintype" id="3162121">rune</span><span class="op" id="3162125">,</span>&nbsp;<span class="ident" id="3162127">rest</span>&nbsp;<span class="builtintype" id="3162132">string</span><span class="op" id="3162138">,</span>&nbsp;<span class="ident" id="3162140">err</span>&nbsp;<span class="builtintype" id="3162144">error</span><span class="op" id="3162149">)</span>&nbsp;<span class="op" id="3162151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162154">if</span>&nbsp;<span class="ident" id="3162157">p</span><span class="op" id="3162158">.</span><span class="ident" id="3162159">flags</span><span class="op" id="3162164">&amp;</span><span class="ident" id="3162165">UnicodeGroups</span>&nbsp;<span class="op" id="3162179">==</span>&nbsp;<span class="num" id="3162182">0</span>&nbsp;<span class="op" id="3162184">||</span>&nbsp;<span class="builtinfunc" id="3162187">len</span><span class="op" id="3162190">(</span><span class="ident" id="3162191">s</span><span class="op" id="3162192">)</span>&nbsp;<span class="op" id="3162194">&lt;</span>&nbsp;<span class="num" id="3162196">2</span>&nbsp;<span class="op" id="3162198">||</span>&nbsp;<span class="ident" id="3162201">s</span><span class="op" id="3162202">[</span><span class="num" id="3162203">0</span><span class="op" id="3162204">]</span>&nbsp;<span class="op" id="3162206">!=</span>&nbsp;<span class="string" id="3162209">&#39;\\&#39;</span>&nbsp;<span class="op" id="3162214">||</span>&nbsp;<span class="ident" id="3162217">s</span><span class="op" id="3162218">[</span><span class="num" id="3162219">1</span><span class="op" id="3162220">]</span>&nbsp;<span class="op" id="3162222">!=</span>&nbsp;<span class="string" id="3162225">&#39;p&#39;</span>&nbsp;<span class="op" id="3162229">&amp;&amp;</span>&nbsp;<span class="ident" id="3162232">s</span><span class="op" id="3162233">[</span><span class="num" id="3162234">1</span><span class="op" id="3162235">]</span>&nbsp;<span class="op" id="3162237">!=</span>&nbsp;<span class="string" id="3162240">&#39;P&#39;</span>&nbsp;<span class="op" id="3162244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162248">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3162260">//&nbsp;Committed&nbsp;to&nbsp;parse&nbsp;or&nbsp;return&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162300">sign</span>&nbsp;<span class="op" id="3162305">:=</span>&nbsp;<span class="op" id="3162308">+</span><span class="num" id="3162309">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162312">if</span>&nbsp;<span class="ident" id="3162315">s</span><span class="op" id="3162316">[</span><span class="num" id="3162317">1</span><span class="op" id="3162318">]</span>&nbsp;<span class="op" id="3162320">==</span>&nbsp;<span class="string" id="3162323">&#39;P&#39;</span>&nbsp;<span class="op" id="3162327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162331">sign</span>&nbsp;<span class="op" id="3162336">=</span>&nbsp;<span class="op" id="3162338">-</span><span class="num" id="3162339">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162342">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162345">t</span>&nbsp;<span class="op" id="3162347">:=</span>&nbsp;<span class="ident" id="3162350">s</span><span class="op" id="3162351">[</span><span class="num" id="3162352">2</span><span class="op" id="3162353">:</span><span class="op" id="3162354">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162357">c</span><span class="op" id="3162358">,</span>&nbsp;<span class="ident" id="3162360">t</span><span class="op" id="3162361">,</span>&nbsp;<span class="ident" id="3162363">err</span>&nbsp;<span class="op" id="3162367">:=</span>&nbsp;<span class="ident" id="3162370">nextRune</span><span class="op" id="3162378">(</span><span class="ident" id="3162379">t</span><span class="op" id="3162380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162383">if</span>&nbsp;<span class="ident" id="3162386">err</span>&nbsp;<span class="op" id="3162390">!=</span>&nbsp;<span class="ident" id="3162393">nil</span>&nbsp;<span class="op" id="3162397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162401">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162409">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162412">var</span>&nbsp;<span class="ident" id="3162416">seq</span><span class="op" id="3162419">,</span>&nbsp;<span class="ident" id="3162421">name</span>&nbsp;<span class="builtintype" id="3162426">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162434">if</span>&nbsp;<span class="ident" id="3162437">c</span>&nbsp;<span class="op" id="3162439">!=</span>&nbsp;<span class="string" id="3162442">&#39;{&#39;</span>&nbsp;<span class="op" id="3162446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3162450">//&nbsp;Single-letter&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162475">seq</span>&nbsp;<span class="op" id="3162479">=</span>&nbsp;<span class="ident" id="3162481">s</span><span class="op" id="3162482">[</span><span class="op" id="3162483">:</span><span class="builtinfunc" id="3162484">len</span><span class="op" id="3162487">(</span><span class="ident" id="3162488">s</span><span class="op" id="3162489">)</span><span class="op" id="3162490">-</span><span class="builtinfunc" id="3162491">len</span><span class="op" id="3162494">(</span><span class="ident" id="3162495">t</span><span class="op" id="3162496">)</span><span class="op" id="3162497">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162501">name</span>&nbsp;<span class="op" id="3162506">=</span>&nbsp;<span class="ident" id="3162508">seq</span><span class="op" id="3162511">[</span><span class="num" id="3162512">2</span><span class="op" id="3162513">:</span><span class="op" id="3162514">]</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162517">}</span>&nbsp;<span class="keyword" id="3162519">else</span>&nbsp;<span class="op" id="3162524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3162528">//&nbsp;Name&nbsp;is&nbsp;in&nbsp;braces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162552">end</span>&nbsp;<span class="op" id="3162556">:=</span>&nbsp;<span class="ident" id="3162559">strings</span><span class="op" id="3162566">.</span><span class="ident" id="3162567">IndexRune</span><span class="op" id="3162576">(</span><span class="ident" id="3162577">s</span><span class="op" id="3162578">,</span>&nbsp;<span class="string" id="3162580">&#39;}&#39;</span><span class="op" id="3162583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162587">if</span>&nbsp;<span class="ident" id="3162590">end</span>&nbsp;<span class="op" id="3162594">&lt;</span>&nbsp;<span class="num" id="3162596">0</span>&nbsp;<span class="op" id="3162598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162603">if</span>&nbsp;<span class="ident" id="3162606">err</span>&nbsp;<span class="op" id="3162610">=</span>&nbsp;<span class="ident" id="3162612">checkUTF8</span><span class="op" id="3162621">(</span><span class="ident" id="3162622">s</span><span class="op" id="3162623">)</span><span class="op" id="3162624">;</span>&nbsp;<span class="ident" id="3162626">err</span>&nbsp;<span class="op" id="3162630">!=</span>&nbsp;<span class="ident" id="3162633">nil</span>&nbsp;<span class="op" id="3162637">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162643">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162658">return</span>&nbsp;<span class="ident" id="3162665">nil</span><span class="op" id="3162668">,</span>&nbsp;<span class="string" id="3162670">&#34;&#34;</span><span class="op" id="3162672">,</span>&nbsp;<span class="op" id="3162674">&amp;</span><span class="ident" id="3162675">Error</span><span class="op" id="3162680">{</span><span class="ident" id="3162681">ErrInvalidCharRange</span><span class="op" id="3162700">,</span>&nbsp;<span class="ident" id="3162702">s</span><span class="op" id="3162703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162711">seq</span><span class="op" id="3162714">,</span>&nbsp;<span class="ident" id="3162716">t</span>&nbsp;<span class="op" id="3162718">=</span>&nbsp;<span class="ident" id="3162720">s</span><span class="op" id="3162721">[</span><span class="op" id="3162722">:</span><span class="ident" id="3162723">end</span><span class="op" id="3162726">+</span><span class="num" id="3162727">1</span><span class="op" id="3162728">]</span><span class="op" id="3162729">,</span>&nbsp;<span class="ident" id="3162731">s</span><span class="op" id="3162732">[</span><span class="ident" id="3162733">end</span><span class="op" id="3162736">+</span><span class="num" id="3162737">1</span><span class="op" id="3162738">:</span><span class="op" id="3162739">]</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162743">name</span>&nbsp;<span class="op" id="3162748">=</span>&nbsp;<span class="ident" id="3162750">s</span><span class="op" id="3162751">[</span><span class="num" id="3162752">3</span><span class="op" id="3162753">:</span><span class="ident" id="3162754">end</span><span class="op" id="3162757">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162761">if</span>&nbsp;<span class="ident" id="3162764">err</span>&nbsp;<span class="op" id="3162768">=</span>&nbsp;<span class="ident" id="3162770">checkUTF8</span><span class="op" id="3162779">(</span><span class="ident" id="3162780">name</span><span class="op" id="3162784">)</span><span class="op" id="3162785">;</span>&nbsp;<span class="ident" id="3162787">err</span>&nbsp;<span class="op" id="3162791">!=</span>&nbsp;<span class="ident" id="3162794">nil</span>&nbsp;<span class="op" id="3162798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162803">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162815">}</span><br>
<span class="lineno">1480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3162819">//&nbsp;Group&nbsp;can&nbsp;have&nbsp;leading&nbsp;negation&nbsp;too.&nbsp;&nbsp;\p{^Han}&nbsp;==&nbsp;\P{Han},&nbsp;\P{^Han}&nbsp;==&nbsp;\p{Han}.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162903">if</span>&nbsp;<span class="ident" id="3162906">name</span>&nbsp;<span class="op" id="3162911">!=</span>&nbsp;<span class="string" id="3162914">&#34;&#34;</span>&nbsp;<span class="op" id="3162917">&amp;&amp;</span>&nbsp;<span class="ident" id="3162920">name</span><span class="op" id="3162924">[</span><span class="num" id="3162925">0</span><span class="op" id="3162926">]</span>&nbsp;<span class="op" id="3162928">==</span>&nbsp;<span class="string" id="3162931">&#39;^&#39;</span>&nbsp;<span class="op" id="3162935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162939">sign</span>&nbsp;<span class="op" id="3162944">=</span>&nbsp;<span class="op" id="3162946">-</span><span class="ident" id="3162947">sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162954">name</span>&nbsp;<span class="op" id="3162959">=</span>&nbsp;<span class="ident" id="3162961">name</span><span class="op" id="3162965">[</span><span class="num" id="3162966">1</span><span class="op" id="3162967">:</span><span class="op" id="3162968">]</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162975">tab</span><span class="op" id="3162978">,</span>&nbsp;<span class="ident" id="3162980">fold</span>&nbsp;<span class="op" id="3162985">:=</span>&nbsp;<span class="ident" id="3162988">unicodeTable</span><span class="op" id="3163000">(</span><span class="ident" id="3163001">name</span><span class="op" id="3163005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163008">if</span>&nbsp;<span class="ident" id="3163011">tab</span>&nbsp;<span class="op" id="3163015">==</span>&nbsp;<span class="ident" id="3163018">nil</span>&nbsp;<span class="op" id="3163022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163026">return</span>&nbsp;<span class="ident" id="3163033">nil</span><span class="op" id="3163036">,</span>&nbsp;<span class="string" id="3163038">&#34;&#34;</span><span class="op" id="3163040">,</span>&nbsp;<span class="op" id="3163042">&amp;</span><span class="ident" id="3163043">Error</span><span class="op" id="3163048">{</span><span class="ident" id="3163049">ErrInvalidCharRange</span><span class="op" id="3163068">,</span>&nbsp;<span class="ident" id="3163070">seq</span><span class="op" id="3163073">}</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163080">if</span>&nbsp;<span class="ident" id="3163083">p</span><span class="op" id="3163084">.</span><span class="ident" id="3163085">flags</span><span class="op" id="3163090">&amp;</span><span class="ident" id="3163091">FoldCase</span>&nbsp;<span class="op" id="3163100">==</span>&nbsp;<span class="num" id="3163103">0</span>&nbsp;<span class="op" id="3163105">||</span>&nbsp;<span class="ident" id="3163108">fold</span>&nbsp;<span class="op" id="3163113">==</span>&nbsp;<span class="ident" id="3163116">nil</span>&nbsp;<span class="op" id="3163120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163124">if</span>&nbsp;<span class="ident" id="3163127">sign</span>&nbsp;<span class="op" id="3163132">&gt;</span>&nbsp;<span class="num" id="3163134">0</span>&nbsp;<span class="op" id="3163136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163141">r</span>&nbsp;<span class="op" id="3163143">=</span>&nbsp;<span class="ident" id="3163145">appendTable</span><span class="op" id="3163156">(</span><span class="ident" id="3163157">r</span><span class="op" id="3163158">,</span>&nbsp;<span class="ident" id="3163160">tab</span><span class="op" id="3163163">)</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163167">}</span>&nbsp;<span class="keyword" id="3163169">else</span>&nbsp;<span class="op" id="3163174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163179">r</span>&nbsp;<span class="op" id="3163181">=</span>&nbsp;<span class="ident" id="3163183">appendNegatedTable</span><span class="op" id="3163201">(</span><span class="ident" id="3163202">r</span><span class="op" id="3163203">,</span>&nbsp;<span class="ident" id="3163205">tab</span><span class="op" id="3163208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163215">}</span>&nbsp;<span class="keyword" id="3163217">else</span>&nbsp;<span class="op" id="3163222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3163226">//&nbsp;Merge&nbsp;and&nbsp;clean&nbsp;tab&nbsp;and&nbsp;fold&nbsp;in&nbsp;a&nbsp;temporary&nbsp;buffer.</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3163283">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;for&nbsp;the&nbsp;negative&nbsp;case&nbsp;and&nbsp;just&nbsp;tidy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3163342">//&nbsp;for&nbsp;the&nbsp;positive&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163370">tmp</span>&nbsp;<span class="op" id="3163374">:=</span>&nbsp;<span class="ident" id="3163377">p</span><span class="op" id="3163378">.</span><span class="ident" id="3163379">tmpClass</span><span class="op" id="3163387">[</span><span class="op" id="3163388">:</span><span class="num" id="3163389">0</span><span class="op" id="3163390">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163394">tmp</span>&nbsp;<span class="op" id="3163398">=</span>&nbsp;<span class="ident" id="3163400">appendTable</span><span class="op" id="3163411">(</span><span class="ident" id="3163412">tmp</span><span class="op" id="3163415">,</span>&nbsp;<span class="ident" id="3163417">tab</span><span class="op" id="3163420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163424">tmp</span>&nbsp;<span class="op" id="3163428">=</span>&nbsp;<span class="ident" id="3163430">appendTable</span><span class="op" id="3163441">(</span><span class="ident" id="3163442">tmp</span><span class="op" id="3163445">,</span>&nbsp;<span class="ident" id="3163447">fold</span><span class="op" id="3163451">)</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163455">p</span><span class="op" id="3163456">.</span><span class="ident" id="3163457">tmpClass</span>&nbsp;<span class="op" id="3163466">=</span>&nbsp;<span class="ident" id="3163468">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163474">tmp</span>&nbsp;<span class="op" id="3163478">=</span>&nbsp;<span class="ident" id="3163480">cleanClass</span><span class="op" id="3163490">(</span><span class="op" id="3163491">&amp;</span><span class="ident" id="3163492">p</span><span class="op" id="3163493">.</span><span class="ident" id="3163494">tmpClass</span><span class="op" id="3163502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163506">if</span>&nbsp;<span class="ident" id="3163509">sign</span>&nbsp;<span class="op" id="3163514">&gt;</span>&nbsp;<span class="num" id="3163516">0</span>&nbsp;<span class="op" id="3163518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163523">r</span>&nbsp;<span class="op" id="3163525">=</span>&nbsp;<span class="ident" id="3163527">appendClass</span><span class="op" id="3163538">(</span><span class="ident" id="3163539">r</span><span class="op" id="3163540">,</span>&nbsp;<span class="ident" id="3163542">tmp</span><span class="op" id="3163545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163549">}</span>&nbsp;<span class="keyword" id="3163551">else</span>&nbsp;<span class="op" id="3163556">{</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163561">r</span>&nbsp;<span class="op" id="3163563">=</span>&nbsp;<span class="ident" id="3163565">appendNegatedClass</span><span class="op" id="3163583">(</span><span class="ident" id="3163584">r</span><span class="op" id="3163585">,</span>&nbsp;<span class="ident" id="3163587">tmp</span><span class="op" id="3163590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163600">return</span>&nbsp;<span class="ident" id="3163607">r</span><span class="op" id="3163608">,</span>&nbsp;<span class="ident" id="3163610">t</span><span class="op" id="3163611">,</span>&nbsp;<span class="ident" id="3163613">nil</span><br>
<span class="lineno"></span><span class="op" id="3163617">}</span><br>
<span class="lineno">1515</span><br>
<span class="lineno"></span><span class="comment" id="3163620">//&nbsp;parseClass&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="3163681">//&nbsp;and&nbsp;pushes&nbsp;it&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="3163720">func</span>&nbsp;<span class="op" id="3163725">(</span><span class="ident" id="3163726">p</span>&nbsp;<span class="op" id="3163728">*</span><span class="ident" id="3163729">parser</span><span class="op" id="3163735">)</span>&nbsp;<span class="ident" id="3163737">parseClass</span><span class="op" id="3163747">(</span><span class="ident" id="3163748">s</span>&nbsp;<span class="builtintype" id="3163750">string</span><span class="op" id="3163756">)</span>&nbsp;<span class="op" id="3163758">(</span><span class="ident" id="3163759">rest</span>&nbsp;<span class="builtintype" id="3163764">string</span><span class="op" id="3163770">,</span>&nbsp;<span class="ident" id="3163772">err</span>&nbsp;<span class="builtintype" id="3163776">error</span><span class="op" id="3163781">)</span>&nbsp;<span class="op" id="3163783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163786">t</span>&nbsp;<span class="op" id="3163788">:=</span>&nbsp;<span class="ident" id="3163791">s</span><span class="op" id="3163792">[</span><span class="num" id="3163793">1</span><span class="op" id="3163794">:</span><span class="op" id="3163795">]</span>&nbsp;<span class="comment" id="3163797">//&nbsp;chop&nbsp;[</span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163808">re</span>&nbsp;<span class="op" id="3163811">:=</span>&nbsp;<span class="ident" id="3163814">p</span><span class="op" id="3163815">.</span><span class="ident" id="3163816">newRegexp</span><span class="op" id="3163825">(</span><span class="ident" id="3163826">OpCharClass</span><span class="op" id="3163837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163840">re</span><span class="op" id="3163842">.</span><span class="ident" id="3163843">Flags</span>&nbsp;<span class="op" id="3163849">=</span>&nbsp;<span class="ident" id="3163851">p</span><span class="op" id="3163852">.</span><span class="ident" id="3163853">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163860">re</span><span class="op" id="3163862">.</span><span class="ident" id="3163863">Rune</span>&nbsp;<span class="op" id="3163868">=</span>&nbsp;<span class="ident" id="3163870">re</span><span class="op" id="3163872">.</span><span class="ident" id="3163873">Rune0</span><span class="op" id="3163878">[</span><span class="op" id="3163879">:</span><span class="num" id="3163880">0</span><span class="op" id="3163881">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163885">sign</span>&nbsp;<span class="op" id="3163890">:=</span>&nbsp;<span class="op" id="3163893">+</span><span class="num" id="3163894">1</span><br>
<span class="lineno">1525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163897">if</span>&nbsp;<span class="ident" id="3163900">t</span>&nbsp;<span class="op" id="3163902">!=</span>&nbsp;<span class="string" id="3163905">&#34;&#34;</span>&nbsp;<span class="op" id="3163908">&amp;&amp;</span>&nbsp;<span class="ident" id="3163911">t</span><span class="op" id="3163912">[</span><span class="num" id="3163913">0</span><span class="op" id="3163914">]</span>&nbsp;<span class="op" id="3163916">==</span>&nbsp;<span class="string" id="3163919">&#39;^&#39;</span>&nbsp;<span class="op" id="3163923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163927">sign</span>&nbsp;<span class="op" id="3163932">=</span>&nbsp;<span class="op" id="3163934">-</span><span class="num" id="3163935">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163939">t</span>&nbsp;<span class="op" id="3163941">=</span>&nbsp;<span class="ident" id="3163943">t</span><span class="op" id="3163944">[</span><span class="num" id="3163945">1</span><span class="op" id="3163946">:</span><span class="op" id="3163947">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3163952">//&nbsp;If&nbsp;character&nbsp;class&nbsp;does&nbsp;not&nbsp;match&nbsp;\n,&nbsp;add&nbsp;it&nbsp;here,</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3164008">//&nbsp;so&nbsp;that&nbsp;negation&nbsp;later&nbsp;will&nbsp;do&nbsp;the&nbsp;right&nbsp;thing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164061">if</span>&nbsp;<span class="ident" id="3164064">p</span><span class="op" id="3164065">.</span><span class="ident" id="3164066">flags</span><span class="op" id="3164071">&amp;</span><span class="ident" id="3164072">ClassNL</span>&nbsp;<span class="op" id="3164080">==</span>&nbsp;<span class="num" id="3164083">0</span>&nbsp;<span class="op" id="3164085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164090">re</span><span class="op" id="3164092">.</span><span class="ident" id="3164093">Rune</span>&nbsp;<span class="op" id="3164098">=</span>&nbsp;<span class="builtinfunc" id="3164100">append</span><span class="op" id="3164106">(</span><span class="ident" id="3164107">re</span><span class="op" id="3164109">.</span><span class="ident" id="3164110">Rune</span><span class="op" id="3164114">,</span>&nbsp;<span class="string" id="3164116">&#39;\n&#39;</span><span class="op" id="3164120">,</span>&nbsp;<span class="string" id="3164122">&#39;\n&#39;</span><span class="op" id="3164126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164133">}</span><br>
<span class="lineno">1535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164137">class</span>&nbsp;<span class="op" id="3164143">:=</span>&nbsp;<span class="ident" id="3164146">re</span><span class="op" id="3164148">.</span><span class="ident" id="3164149">Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164155">first</span>&nbsp;<span class="op" id="3164161">:=</span>&nbsp;<span class="builtintype" id="3164164">true</span>&nbsp;<span class="comment" id="3164169">//&nbsp;]&nbsp;and&nbsp;-&nbsp;are&nbsp;okay&nbsp;as&nbsp;first&nbsp;char&nbsp;in&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164213">for</span>&nbsp;<span class="ident" id="3164217">t</span>&nbsp;<span class="op" id="3164219">==</span>&nbsp;<span class="string" id="3164222">&#34;&#34;</span>&nbsp;<span class="op" id="3164225">||</span>&nbsp;<span class="ident" id="3164228">t</span><span class="op" id="3164229">[</span><span class="num" id="3164230">0</span><span class="op" id="3164231">]</span>&nbsp;<span class="op" id="3164233">!=</span>&nbsp;<span class="string" id="3164236">&#39;]&#39;</span>&nbsp;<span class="op" id="3164240">||</span>&nbsp;<span class="ident" id="3164243">first</span>&nbsp;<span class="op" id="3164249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3164253">//&nbsp;POSIX:&nbsp;-&nbsp;is&nbsp;only&nbsp;okay&nbsp;unescaped&nbsp;as&nbsp;first&nbsp;or&nbsp;last&nbsp;in&nbsp;class.</span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3164317">//&nbsp;Perl:&nbsp;-&nbsp;is&nbsp;okay&nbsp;anywhere.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164348">if</span>&nbsp;<span class="ident" id="3164351">t</span>&nbsp;<span class="op" id="3164353">!=</span>&nbsp;<span class="string" id="3164356">&#34;&#34;</span>&nbsp;<span class="op" id="3164359">&amp;&amp;</span>&nbsp;<span class="ident" id="3164362">t</span><span class="op" id="3164363">[</span><span class="num" id="3164364">0</span><span class="op" id="3164365">]</span>&nbsp;<span class="op" id="3164367">==</span>&nbsp;<span class="string" id="3164370">&#39;-&#39;</span>&nbsp;<span class="op" id="3164374">&amp;&amp;</span>&nbsp;<span class="ident" id="3164377">p</span><span class="op" id="3164378">.</span><span class="ident" id="3164379">flags</span><span class="op" id="3164384">&amp;</span><span class="ident" id="3164385">PerlX</span>&nbsp;<span class="op" id="3164391">==</span>&nbsp;<span class="num" id="3164394">0</span>&nbsp;<span class="op" id="3164396">&amp;&amp;</span>&nbsp;<span class="op" id="3164399">!</span><span class="ident" id="3164400">first</span>&nbsp;<span class="op" id="3164406">&amp;&amp;</span>&nbsp;<span class="op" id="3164409">(</span><span class="builtinfunc" id="3164410">len</span><span class="op" id="3164413">(</span><span class="ident" id="3164414">t</span><span class="op" id="3164415">)</span>&nbsp;<span class="op" id="3164417">==</span>&nbsp;<span class="num" id="3164420">1</span>&nbsp;<span class="op" id="3164422">||</span>&nbsp;<span class="ident" id="3164425">t</span><span class="op" id="3164426">[</span><span class="num" id="3164427">1</span><span class="op" id="3164428">]</span>&nbsp;<span class="op" id="3164430">!=</span>&nbsp;<span class="string" id="3164433">&#39;]&#39;</span><span class="op" id="3164436">)</span>&nbsp;<span class="op" id="3164438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164443">_</span><span class="op" id="3164444">,</span>&nbsp;<span class="ident" id="3164446">size</span>&nbsp;<span class="op" id="3164451">:=</span>&nbsp;<span class="ident" id="3164454">utf8</span><span class="op" id="3164458">.</span><span class="ident" id="3164459">DecodeRuneInString</span><span class="op" id="3164477">(</span><span class="ident" id="3164478">t</span><span class="op" id="3164479">[</span><span class="num" id="3164480">1</span><span class="op" id="3164481">:</span><span class="op" id="3164482">]</span><span class="op" id="3164483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164488">return</span>&nbsp;<span class="string" id="3164495">&#34;&#34;</span><span class="op" id="3164497">,</span>&nbsp;<span class="op" id="3164499">&amp;</span><span class="ident" id="3164500">Error</span><span class="op" id="3164505">{</span><span class="ident" id="3164506">Code</span><span class="op" id="3164510">:</span>&nbsp;<span class="ident" id="3164512">ErrInvalidCharRange</span><span class="op" id="3164531">,</span>&nbsp;<span class="ident" id="3164533">Expr</span><span class="op" id="3164537">:</span>&nbsp;<span class="ident" id="3164539">t</span><span class="op" id="3164540">[</span><span class="op" id="3164541">:</span><span class="num" id="3164542">1</span><span class="op" id="3164543">+</span><span class="ident" id="3164544">size</span><span class="op" id="3164548">]</span><span class="op" id="3164549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164553">}</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164557">first</span>&nbsp;<span class="op" id="3164563">=</span>&nbsp;<span class="builtintype" id="3164565">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3164574">//&nbsp;Look&nbsp;for&nbsp;POSIX&nbsp;[:alnum:]&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164609">if</span>&nbsp;<span class="builtinfunc" id="3164612">len</span><span class="op" id="3164615">(</span><span class="ident" id="3164616">t</span><span class="op" id="3164617">)</span>&nbsp;<span class="op" id="3164619">&gt;</span>&nbsp;<span class="num" id="3164621">2</span>&nbsp;<span class="op" id="3164623">&amp;&amp;</span>&nbsp;<span class="ident" id="3164626">t</span><span class="op" id="3164627">[</span><span class="num" id="3164628">0</span><span class="op" id="3164629">]</span>&nbsp;<span class="op" id="3164631">==</span>&nbsp;<span class="string" id="3164634">&#39;[&#39;</span>&nbsp;<span class="op" id="3164638">&amp;&amp;</span>&nbsp;<span class="ident" id="3164641">t</span><span class="op" id="3164642">[</span><span class="num" id="3164643">1</span><span class="op" id="3164644">]</span>&nbsp;<span class="op" id="3164646">==</span>&nbsp;<span class="string" id="3164649">&#39;:&#39;</span>&nbsp;<span class="op" id="3164653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164658">nclass</span><span class="op" id="3164664">,</span>&nbsp;<span class="ident" id="3164666">nt</span><span class="op" id="3164668">,</span>&nbsp;<span class="ident" id="3164670">err</span>&nbsp;<span class="op" id="3164674">:=</span>&nbsp;<span class="ident" id="3164677">p</span><span class="op" id="3164678">.</span><span class="ident" id="3164679">parseNamedClass</span><span class="op" id="3164694">(</span><span class="ident" id="3164695">t</span><span class="op" id="3164696">,</span>&nbsp;<span class="ident" id="3164698">class</span><span class="op" id="3164703">)</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164708">if</span>&nbsp;<span class="ident" id="3164711">err</span>&nbsp;<span class="op" id="3164715">!=</span>&nbsp;<span class="ident" id="3164718">nil</span>&nbsp;<span class="op" id="3164722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164728">return</span>&nbsp;<span class="string" id="3164735">&#34;&#34;</span><span class="op" id="3164737">,</span>&nbsp;<span class="ident" id="3164739">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164751">if</span>&nbsp;<span class="ident" id="3164754">nclass</span>&nbsp;<span class="op" id="3164761">!=</span>&nbsp;<span class="ident" id="3164764">nil</span>&nbsp;<span class="op" id="3164768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164774">class</span><span class="op" id="3164779">,</span>&nbsp;<span class="ident" id="3164781">t</span>&nbsp;<span class="op" id="3164783">=</span>&nbsp;<span class="ident" id="3164785">nclass</span><span class="op" id="3164791">,</span>&nbsp;<span class="ident" id="3164793">nt</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164800">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3164821">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}.</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164873">nclass</span><span class="op" id="3164879">,</span>&nbsp;<span class="ident" id="3164881">nt</span><span class="op" id="3164883">,</span>&nbsp;<span class="ident" id="3164885">err</span>&nbsp;<span class="op" id="3164889">:=</span>&nbsp;<span class="ident" id="3164892">p</span><span class="op" id="3164893">.</span><span class="ident" id="3164894">parseUnicodeClass</span><span class="op" id="3164911">(</span><span class="ident" id="3164912">t</span><span class="op" id="3164913">,</span>&nbsp;<span class="ident" id="3164915">class</span><span class="op" id="3164920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164924">if</span>&nbsp;<span class="ident" id="3164927">err</span>&nbsp;<span class="op" id="3164931">!=</span>&nbsp;<span class="ident" id="3164934">nil</span>&nbsp;<span class="op" id="3164938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164943">return</span>&nbsp;<span class="string" id="3164950">&#34;&#34;</span><span class="op" id="3164952">,</span>&nbsp;<span class="ident" id="3164954">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164964">if</span>&nbsp;<span class="ident" id="3164967">nclass</span>&nbsp;<span class="op" id="3164974">!=</span>&nbsp;<span class="ident" id="3164977">nil</span>&nbsp;<span class="op" id="3164981">{</span><br>
<span class="lineno">1565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164986">class</span><span class="op" id="3164991">,</span>&nbsp;<span class="ident" id="3164993">t</span>&nbsp;<span class="op" id="3164995">=</span>&nbsp;<span class="ident" id="3164997">nclass</span><span class="op" id="3165003">,</span>&nbsp;<span class="ident" id="3165005">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165011">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3165027">//&nbsp;Look&nbsp;for&nbsp;Perl&nbsp;character&nbsp;class&nbsp;symbols&nbsp;(extension).</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165083">if</span>&nbsp;<span class="ident" id="3165086">nclass</span><span class="op" id="3165092">,</span>&nbsp;<span class="ident" id="3165094">nt</span>&nbsp;<span class="op" id="3165097">:=</span>&nbsp;<span class="ident" id="3165100">p</span><span class="op" id="3165101">.</span><span class="ident" id="3165102">parsePerlClassEscape</span><span class="op" id="3165122">(</span><span class="ident" id="3165123">t</span><span class="op" id="3165124">,</span>&nbsp;<span class="ident" id="3165126">class</span><span class="op" id="3165131">)</span><span class="op" id="3165132">;</span>&nbsp;<span class="ident" id="3165134">nclass</span>&nbsp;<span class="op" id="3165141">!=</span>&nbsp;<span class="ident" id="3165144">nil</span>&nbsp;<span class="op" id="3165148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165153">class</span><span class="op" id="3165158">,</span>&nbsp;<span class="ident" id="3165160">t</span>&nbsp;<span class="op" id="3165162">=</span>&nbsp;<span class="ident" id="3165164">nclass</span><span class="op" id="3165170">,</span>&nbsp;<span class="ident" id="3165172">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165178">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3165194">//&nbsp;Single&nbsp;character&nbsp;or&nbsp;simple&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165233">rng</span>&nbsp;<span class="op" id="3165237">:=</span>&nbsp;<span class="ident" id="3165240">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165244">var</span>&nbsp;<span class="ident" id="3165248">lo</span><span class="op" id="3165250">,</span>&nbsp;<span class="ident" id="3165252">hi</span>&nbsp;<span class="builtintype" id="3165255">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165262">if</span>&nbsp;<span class="ident" id="3165265">lo</span><span class="op" id="3165267">,</span>&nbsp;<span class="ident" id="3165269">t</span><span class="op" id="3165270">,</span>&nbsp;<span class="ident" id="3165272">err</span>&nbsp;<span class="op" id="3165276">=</span>&nbsp;<span class="ident" id="3165278">p</span><span class="op" id="3165279">.</span><span class="ident" id="3165280">parseClassChar</span><span class="op" id="3165294">(</span><span class="ident" id="3165295">t</span><span class="op" id="3165296">,</span>&nbsp;<span class="ident" id="3165298">s</span><span class="op" id="3165299">)</span><span class="op" id="3165300">;</span>&nbsp;<span class="ident" id="3165302">err</span>&nbsp;<span class="op" id="3165306">!=</span>&nbsp;<span class="ident" id="3165309">nil</span>&nbsp;<span class="op" id="3165313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165318">return</span>&nbsp;<span class="string" id="3165325">&#34;&#34;</span><span class="op" id="3165327">,</span>&nbsp;<span class="ident" id="3165329">err</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165339">hi</span>&nbsp;<span class="op" id="3165342">=</span>&nbsp;<span class="ident" id="3165344">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3165349">//&nbsp;[a-]&nbsp;means&nbsp;(a|-)&nbsp;so&nbsp;check&nbsp;for&nbsp;final&nbsp;].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165393">if</span>&nbsp;<span class="builtinfunc" id="3165396">len</span><span class="op" id="3165399">(</span><span class="ident" id="3165400">t</span><span class="op" id="3165401">)</span>&nbsp;<span class="op" id="3165403">&gt;=</span>&nbsp;<span class="num" id="3165406">2</span>&nbsp;<span class="op" id="3165408">&amp;&amp;</span>&nbsp;<span class="ident" id="3165411">t</span><span class="op" id="3165412">[</span><span class="num" id="3165413">0</span><span class="op" id="3165414">]</span>&nbsp;<span class="op" id="3165416">==</span>&nbsp;<span class="string" id="3165419">&#39;-&#39;</span>&nbsp;<span class="op" id="3165423">&amp;&amp;</span>&nbsp;<span class="ident" id="3165426">t</span><span class="op" id="3165427">[</span><span class="num" id="3165428">1</span><span class="op" id="3165429">]</span>&nbsp;<span class="op" id="3165431">!=</span>&nbsp;<span class="string" id="3165434">&#39;]&#39;</span>&nbsp;<span class="op" id="3165438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165443">t</span>&nbsp;<span class="op" id="3165445">=</span>&nbsp;<span class="ident" id="3165447">t</span><span class="op" id="3165448">[</span><span class="num" id="3165449">1</span><span class="op" id="3165450">:</span><span class="op" id="3165451">]</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165456">if</span>&nbsp;<span class="ident" id="3165459">hi</span><span class="op" id="3165461">,</span>&nbsp;<span class="ident" id="3165463">t</span><span class="op" id="3165464">,</span>&nbsp;<span class="ident" id="3165466">err</span>&nbsp;<span class="op" id="3165470">=</span>&nbsp;<span class="ident" id="3165472">p</span><span class="op" id="3165473">.</span><span class="ident" id="3165474">parseClassChar</span><span class="op" id="3165488">(</span><span class="ident" id="3165489">t</span><span class="op" id="3165490">,</span>&nbsp;<span class="ident" id="3165492">s</span><span class="op" id="3165493">)</span><span class="op" id="3165494">;</span>&nbsp;<span class="ident" id="3165496">err</span>&nbsp;<span class="op" id="3165500">!=</span>&nbsp;<span class="ident" id="3165503">nil</span>&nbsp;<span class="op" id="3165507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165513">return</span>&nbsp;<span class="string" id="3165520">&#34;&#34;</span><span class="op" id="3165522">,</span>&nbsp;<span class="ident" id="3165524">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165536">if</span>&nbsp;<span class="ident" id="3165539">hi</span>&nbsp;<span class="op" id="3165542">&lt;</span>&nbsp;<span class="ident" id="3165544">lo</span>&nbsp;<span class="op" id="3165547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165553">rng</span>&nbsp;<span class="op" id="3165557">=</span>&nbsp;<span class="ident" id="3165559">rng</span><span class="op" id="3165562">[</span><span class="op" id="3165563">:</span><span class="builtinfunc" id="3165564">len</span><span class="op" id="3165567">(</span><span class="ident" id="3165568">rng</span><span class="op" id="3165571">)</span><span class="op" id="3165572">-</span><span class="builtinfunc" id="3165573">len</span><span class="op" id="3165576">(</span><span class="ident" id="3165577">t</span><span class="op" id="3165578">)</span><span class="op" id="3165579">]</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165585">return</span>&nbsp;<span class="string" id="3165592">&#34;&#34;</span><span class="op" id="3165594">,</span>&nbsp;<span class="op" id="3165596">&amp;</span><span class="ident" id="3165597">Error</span><span class="op" id="3165602">{</span><span class="ident" id="3165603">Code</span><span class="op" id="3165607">:</span>&nbsp;<span class="ident" id="3165609">ErrInvalidCharRange</span><span class="op" id="3165628">,</span>&nbsp;<span class="ident" id="3165630">Expr</span><span class="op" id="3165634">:</span>&nbsp;<span class="ident" id="3165636">rng</span><span class="op" id="3165639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165652">if</span>&nbsp;<span class="ident" id="3165655">p</span><span class="op" id="3165656">.</span><span class="ident" id="3165657">flags</span><span class="op" id="3165662">&amp;</span><span class="ident" id="3165663">FoldCase</span>&nbsp;<span class="op" id="3165672">==</span>&nbsp;<span class="num" id="3165675">0</span>&nbsp;<span class="op" id="3165677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165682">class</span>&nbsp;<span class="op" id="3165688">=</span>&nbsp;<span class="ident" id="3165690">appendRange</span><span class="op" id="3165701">(</span><span class="ident" id="3165702">class</span><span class="op" id="3165707">,</span>&nbsp;<span class="ident" id="3165709">lo</span><span class="op" id="3165711">,</span>&nbsp;<span class="ident" id="3165713">hi</span><span class="op" id="3165715">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165719">}</span>&nbsp;<span class="keyword" id="3165721">else</span>&nbsp;<span class="op" id="3165726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165731">class</span>&nbsp;<span class="op" id="3165737">=</span>&nbsp;<span class="ident" id="3165739">appendFoldedRange</span><span class="op" id="3165756">(</span><span class="ident" id="3165757">class</span><span class="op" id="3165762">,</span>&nbsp;<span class="ident" id="3165764">lo</span><span class="op" id="3165766">,</span>&nbsp;<span class="ident" id="3165768">hi</span><span class="op" id="3165770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165780">t</span>&nbsp;<span class="op" id="3165782">=</span>&nbsp;<span class="ident" id="3165784">t</span><span class="op" id="3165785">[</span><span class="num" id="3165786">1</span><span class="op" id="3165787">:</span><span class="op" id="3165788">]</span>&nbsp;<span class="comment" id="3165790">//&nbsp;chop&nbsp;]</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3165802">//&nbsp;Use&nbsp;&amp;re.Rune&nbsp;instead&nbsp;of&nbsp;&amp;class&nbsp;to&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165858">re</span><span class="op" id="3165860">.</span><span class="ident" id="3165861">Rune</span>&nbsp;<span class="op" id="3165866">=</span>&nbsp;<span class="ident" id="3165868">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165875">class</span>&nbsp;<span class="op" id="3165881">=</span>&nbsp;<span class="ident" id="3165883">cleanClass</span><span class="op" id="3165893">(</span><span class="op" id="3165894">&amp;</span><span class="ident" id="3165895">re</span><span class="op" id="3165897">.</span><span class="ident" id="3165898">Rune</span><span class="op" id="3165902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165905">if</span>&nbsp;<span class="ident" id="3165908">sign</span>&nbsp;<span class="op" id="3165913">&lt;</span>&nbsp;<span class="num" id="3165915">0</span>&nbsp;<span class="op" id="3165917">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165921">class</span>&nbsp;<span class="op" id="3165927">=</span>&nbsp;<span class="ident" id="3165929">negateClass</span><span class="op" id="3165940">(</span><span class="ident" id="3165941">class</span><span class="op" id="3165946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165952">re</span><span class="op" id="3165954">.</span><span class="ident" id="3165955">Rune</span>&nbsp;<span class="op" id="3165960">=</span>&nbsp;<span class="ident" id="3165962">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165969">p</span><span class="op" id="3165970">.</span><span class="ident" id="3165971">push</span><span class="op" id="3165975">(</span><span class="ident" id="3165976">re</span><span class="op" id="3165978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165981">return</span>&nbsp;<span class="ident" id="3165988">t</span><span class="op" id="3165989">,</span>&nbsp;<span class="ident" id="3165991">nil</span><br>
<span class="lineno">1610</span><span class="op" id="3165995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3165998">//&nbsp;cleanClass&nbsp;sorts&nbsp;the&nbsp;ranges&nbsp;(pairs&nbsp;of&nbsp;elements&nbsp;of&nbsp;r),</span><br>
<span class="lineno"></span><span class="comment" id="3166055">//&nbsp;merges&nbsp;them,&nbsp;and&nbsp;eliminates&nbsp;duplicates.</span><br>
<span class="lineno"></span><span class="keyword" id="3166098">func</span>&nbsp;<span class="ident" id="3166103">cleanClass</span><span class="op" id="3166113">(</span><span class="ident" id="3166114">rp</span>&nbsp;<span class="op" id="3166117">*</span><span class="op" id="3166118">[</span><span class="op" id="3166119">]</span><span class="builtintype" id="3166120">rune</span><span class="op" id="3166124">)</span>&nbsp;<span class="op" id="3166126">[</span><span class="op" id="3166127">]</span><span class="builtintype" id="3166128">rune</span>&nbsp;<span class="op" id="3166133">{</span><br>
<span class="lineno">1615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3166137">//&nbsp;Sort&nbsp;by&nbsp;lo&nbsp;increasing,&nbsp;hi&nbsp;decreasing&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166193">sort</span><span class="op" id="3166197">.</span><span class="ident" id="3166198">Sort</span><span class="op" id="3166202">(</span><span class="ident" id="3166203">ranges</span><span class="op" id="3166209">{</span><span class="ident" id="3166210">rp</span><span class="op" id="3166212">}</span><span class="op" id="3166213">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166217">r</span>&nbsp;<span class="op" id="3166219">:=</span>&nbsp;<span class="op" id="3166222">*</span><span class="ident" id="3166223">rp</span><br>
<span class="lineno">1620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166227">if</span>&nbsp;<span class="builtinfunc" id="3166230">len</span><span class="op" id="3166233">(</span><span class="ident" id="3166234">r</span><span class="op" id="3166235">)</span>&nbsp;<span class="op" id="3166237">&lt;</span>&nbsp;<span class="num" id="3166239">2</span>&nbsp;<span class="op" id="3166241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166245">return</span>&nbsp;<span class="ident" id="3166252">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3166259">//&nbsp;Merge&nbsp;abutting,&nbsp;overlapping.</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166292">w</span>&nbsp;<span class="op" id="3166294">:=</span>&nbsp;<span class="num" id="3166297">2</span>&nbsp;<span class="comment" id="3166299">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166315">for</span>&nbsp;<span class="ident" id="3166319">i</span>&nbsp;<span class="op" id="3166321">:=</span>&nbsp;<span class="num" id="3166324">2</span><span class="op" id="3166325">;</span>&nbsp;<span class="ident" id="3166327">i</span>&nbsp;<span class="op" id="3166329">&lt;</span>&nbsp;<span class="builtinfunc" id="3166331">len</span><span class="op" id="3166334">(</span><span class="ident" id="3166335">r</span><span class="op" id="3166336">)</span><span class="op" id="3166337">;</span>&nbsp;<span class="ident" id="3166339">i</span>&nbsp;<span class="op" id="3166341">+=</span>&nbsp;<span class="num" id="3166344">2</span>&nbsp;<span class="op" id="3166346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166350">lo</span><span class="op" id="3166352">,</span>&nbsp;<span class="ident" id="3166354">hi</span>&nbsp;<span class="op" id="3166357">:=</span>&nbsp;<span class="ident" id="3166360">r</span><span class="op" id="3166361">[</span><span class="ident" id="3166362">i</span><span class="op" id="3166363">]</span><span class="op" id="3166364">,</span>&nbsp;<span class="ident" id="3166366">r</span><span class="op" id="3166367">[</span><span class="ident" id="3166368">i</span><span class="op" id="3166369">+</span><span class="num" id="3166370">1</span><span class="op" id="3166371">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166375">if</span>&nbsp;<span class="ident" id="3166378">lo</span>&nbsp;<span class="op" id="3166381">&lt;=</span>&nbsp;<span class="ident" id="3166384">r</span><span class="op" id="3166385">[</span><span class="ident" id="3166386">w</span><span class="op" id="3166387">-</span><span class="num" id="3166388">1</span><span class="op" id="3166389">]</span><span class="op" id="3166390">+</span><span class="num" id="3166391">1</span>&nbsp;<span class="op" id="3166393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3166398">//&nbsp;merge&nbsp;with&nbsp;previous&nbsp;range</span><br>
<span class="lineno">1630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166430">if</span>&nbsp;<span class="ident" id="3166433">hi</span>&nbsp;<span class="op" id="3166436">&gt;</span>&nbsp;<span class="ident" id="3166438">r</span><span class="op" id="3166439">[</span><span class="ident" id="3166440">w</span><span class="op" id="3166441">-</span><span class="num" id="3166442">1</span><span class="op" id="3166443">]</span>&nbsp;<span class="op" id="3166445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166451">r</span><span class="op" id="3166452">[</span><span class="ident" id="3166453">w</span><span class="op" id="3166454">-</span><span class="num" id="3166455">1</span><span class="op" id="3166456">]</span>&nbsp;<span class="op" id="3166458">=</span>&nbsp;<span class="ident" id="3166460">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166471">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166482">}</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3166486">//&nbsp;new&nbsp;disjoint&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166510">r</span><span class="op" id="3166511">[</span><span class="ident" id="3166512">w</span><span class="op" id="3166513">]</span>&nbsp;<span class="op" id="3166515">=</span>&nbsp;<span class="ident" id="3166517">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166522">r</span><span class="op" id="3166523">[</span><span class="ident" id="3166524">w</span><span class="op" id="3166525">+</span><span class="num" id="3166526">1</span><span class="op" id="3166527">]</span>&nbsp;<span class="op" id="3166529">=</span>&nbsp;<span class="ident" id="3166531">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166536">w</span>&nbsp;<span class="op" id="3166538">+=</span>&nbsp;<span class="num" id="3166541">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166544">}</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166548">return</span>&nbsp;<span class="ident" id="3166555">r</span><span class="op" id="3166556">[</span><span class="op" id="3166557">:</span><span class="ident" id="3166558">w</span><span class="op" id="3166559">]</span><br>
<span class="lineno"></span><span class="op" id="3166561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3166564">//&nbsp;appendLiteral&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;literal&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1645</span><span class="keyword" id="3166643">func</span>&nbsp;<span class="ident" id="3166648">appendLiteral</span><span class="op" id="3166661">(</span><span class="ident" id="3166662">r</span>&nbsp;<span class="op" id="3166664">[</span><span class="op" id="3166665">]</span><span class="builtintype" id="3166666">rune</span><span class="op" id="3166670">,</span>&nbsp;<span class="ident" id="3166672">x</span>&nbsp;<span class="builtintype" id="3166674">rune</span><span class="op" id="3166678">,</span>&nbsp;<span class="ident" id="3166680">flags</span>&nbsp;<span class="ident" id="3166686">Flags</span><span class="op" id="3166691">)</span>&nbsp;<span class="op" id="3166693">[</span><span class="op" id="3166694">]</span><span class="builtintype" id="3166695">rune</span>&nbsp;<span class="op" id="3166700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166703">if</span>&nbsp;<span class="ident" id="3166706">flags</span><span class="op" id="3166711">&amp;</span><span class="ident" id="3166712">FoldCase</span>&nbsp;<span class="op" id="3166721">!=</span>&nbsp;<span class="num" id="3166724">0</span>&nbsp;<span class="op" id="3166726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166730">return</span>&nbsp;<span class="ident" id="3166737">appendFoldedRange</span><span class="op" id="3166754">(</span><span class="ident" id="3166755">r</span><span class="op" id="3166756">,</span>&nbsp;<span class="ident" id="3166758">x</span><span class="op" id="3166759">,</span>&nbsp;<span class="ident" id="3166761">x</span><span class="op" id="3166762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166768">return</span>&nbsp;<span class="ident" id="3166775">appendRange</span><span class="op" id="3166786">(</span><span class="ident" id="3166787">r</span><span class="op" id="3166788">,</span>&nbsp;<span class="ident" id="3166790">x</span><span class="op" id="3166791">,</span>&nbsp;<span class="ident" id="3166793">x</span><span class="op" id="3166794">)</span><br>
<span class="lineno">1650</span><span class="op" id="3166796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3166799">//&nbsp;appendRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3166878">func</span>&nbsp;<span class="ident" id="3166883">appendRange</span><span class="op" id="3166894">(</span><span class="ident" id="3166895">r</span>&nbsp;<span class="op" id="3166897">[</span><span class="op" id="3166898">]</span><span class="builtintype" id="3166899">rune</span><span class="op" id="3166903">,</span>&nbsp;<span class="ident" id="3166905">lo</span><span class="op" id="3166907">,</span>&nbsp;<span class="ident" id="3166909">hi</span>&nbsp;<span class="builtintype" id="3166912">rune</span><span class="op" id="3166916">)</span>&nbsp;<span class="op" id="3166918">[</span><span class="op" id="3166919">]</span><span class="builtintype" id="3166920">rune</span>&nbsp;<span class="op" id="3166925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3166928">//&nbsp;Expand&nbsp;last&nbsp;range&nbsp;or&nbsp;next&nbsp;to&nbsp;last&nbsp;range&nbsp;if&nbsp;it&nbsp;overlaps&nbsp;or&nbsp;abuts.</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3166997">//&nbsp;Checking&nbsp;two&nbsp;ranges&nbsp;helps&nbsp;when&nbsp;appending&nbsp;case-folded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167054">//&nbsp;alphabets,&nbsp;so&nbsp;that&nbsp;one&nbsp;range&nbsp;can&nbsp;be&nbsp;expanding&nbsp;A-Z&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167116">//&nbsp;other&nbsp;expanding&nbsp;a-z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167141">n</span>&nbsp;<span class="op" id="3167143">:=</span>&nbsp;<span class="builtinfunc" id="3167146">len</span><span class="op" id="3167149">(</span><span class="ident" id="3167150">r</span><span class="op" id="3167151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167154">for</span>&nbsp;<span class="ident" id="3167158">i</span>&nbsp;<span class="op" id="3167160">:=</span>&nbsp;<span class="num" id="3167163">2</span><span class="op" id="3167164">;</span>&nbsp;<span class="ident" id="3167166">i</span>&nbsp;<span class="op" id="3167168">&lt;=</span>&nbsp;<span class="num" id="3167171">4</span><span class="op" id="3167172">;</span>&nbsp;<span class="ident" id="3167174">i</span>&nbsp;<span class="op" id="3167176">+=</span>&nbsp;<span class="num" id="3167179">2</span>&nbsp;<span class="op" id="3167181">{</span>&nbsp;<span class="comment" id="3167183">//&nbsp;twice,&nbsp;using&nbsp;i=2,&nbsp;i=4</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167210">if</span>&nbsp;<span class="ident" id="3167213">n</span>&nbsp;<span class="op" id="3167215">&gt;=</span>&nbsp;<span class="ident" id="3167218">i</span>&nbsp;<span class="op" id="3167220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167225">rlo</span><span class="op" id="3167228">,</span>&nbsp;<span class="ident" id="3167230">rhi</span>&nbsp;<span class="op" id="3167234">:=</span>&nbsp;<span class="ident" id="3167237">r</span><span class="op" id="3167238">[</span><span class="ident" id="3167239">n</span><span class="op" id="3167240">-</span><span class="ident" id="3167241">i</span><span class="op" id="3167242">]</span><span class="op" id="3167243">,</span>&nbsp;<span class="ident" id="3167245">r</span><span class="op" id="3167246">[</span><span class="ident" id="3167247">n</span><span class="op" id="3167248">-</span><span class="ident" id="3167249">i</span><span class="op" id="3167250">+</span><span class="num" id="3167251">1</span><span class="op" id="3167252">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167257">if</span>&nbsp;<span class="ident" id="3167260">lo</span>&nbsp;<span class="op" id="3167263">&lt;=</span>&nbsp;<span class="ident" id="3167266">rhi</span><span class="op" id="3167269">+</span><span class="num" id="3167270">1</span>&nbsp;<span class="op" id="3167272">&amp;&amp;</span>&nbsp;<span class="ident" id="3167275">rlo</span>&nbsp;<span class="op" id="3167279">&lt;=</span>&nbsp;<span class="ident" id="3167282">hi</span><span class="op" id="3167284">+</span><span class="num" id="3167285">1</span>&nbsp;<span class="op" id="3167287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167293">if</span>&nbsp;<span class="ident" id="3167296">lo</span>&nbsp;<span class="op" id="3167299">&lt;</span>&nbsp;<span class="ident" id="3167301">rlo</span>&nbsp;<span class="op" id="3167305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167312">r</span><span class="op" id="3167313">[</span><span class="ident" id="3167314">n</span><span class="op" id="3167315">-</span><span class="ident" id="3167316">i</span><span class="op" id="3167317">]</span>&nbsp;<span class="op" id="3167319">=</span>&nbsp;<span class="ident" id="3167321">lo</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167334">if</span>&nbsp;<span class="ident" id="3167337">hi</span>&nbsp;<span class="op" id="3167340">&gt;</span>&nbsp;<span class="ident" id="3167342">rhi</span>&nbsp;<span class="op" id="3167346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167353">r</span><span class="op" id="3167354">[</span><span class="ident" id="3167355">n</span><span class="op" id="3167356">-</span><span class="ident" id="3167357">i</span><span class="op" id="3167358">+</span><span class="num" id="3167359">1</span><span class="op" id="3167360">]</span>&nbsp;<span class="op" id="3167362">=</span>&nbsp;<span class="ident" id="3167364">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167377">return</span>&nbsp;<span class="ident" id="3167384">r</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167400">return</span>&nbsp;<span class="builtinfunc" id="3167407">append</span><span class="op" id="3167413">(</span><span class="ident" id="3167414">r</span><span class="op" id="3167415">,</span>&nbsp;<span class="ident" id="3167417">lo</span><span class="op" id="3167419">,</span>&nbsp;<span class="ident" id="3167421">hi</span><span class="op" id="3167423">)</span><br>
<span class="lineno">1675</span><span class="op" id="3167425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3167428">const</span>&nbsp;<span class="op" id="3167434">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167437">//&nbsp;minimum&nbsp;and&nbsp;maximum&nbsp;runes&nbsp;involved&nbsp;in&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167488">//&nbsp;checked&nbsp;during&nbsp;test.</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167513">minFold</span>&nbsp;<span class="op" id="3167521">=</span>&nbsp;<span class="num" id="3167523">0x0041</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167531">maxFold</span>&nbsp;<span class="op" id="3167539">=</span>&nbsp;<span class="num" id="3167541">0x118df</span><br>
<span class="lineno"></span><span class="op" id="3167549">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3167552">//&nbsp;appendFoldedRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi</span><br>
<span class="lineno">1685</span><span class="comment" id="3167621">//&nbsp;and&nbsp;its&nbsp;case&nbsp;folding-equivalent&nbsp;runes&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3167678">func</span>&nbsp;<span class="ident" id="3167683">appendFoldedRange</span><span class="op" id="3167700">(</span><span class="ident" id="3167701">r</span>&nbsp;<span class="op" id="3167703">[</span><span class="op" id="3167704">]</span><span class="builtintype" id="3167705">rune</span><span class="op" id="3167709">,</span>&nbsp;<span class="ident" id="3167711">lo</span><span class="op" id="3167713">,</span>&nbsp;<span class="ident" id="3167715">hi</span>&nbsp;<span class="builtintype" id="3167718">rune</span><span class="op" id="3167722">)</span>&nbsp;<span class="op" id="3167724">[</span><span class="op" id="3167725">]</span><span class="builtintype" id="3167726">rune</span>&nbsp;<span class="op" id="3167731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167734">//&nbsp;Optimizations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167753">if</span>&nbsp;<span class="ident" id="3167756">lo</span>&nbsp;<span class="op" id="3167759">&lt;=</span>&nbsp;<span class="ident" id="3167762">minFold</span>&nbsp;<span class="op" id="3167770">&amp;&amp;</span>&nbsp;<span class="ident" id="3167773">hi</span>&nbsp;<span class="op" id="3167776">&gt;=</span>&nbsp;<span class="ident" id="3167779">maxFold</span>&nbsp;<span class="op" id="3167787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167791">//&nbsp;Range&nbsp;is&nbsp;full:&nbsp;folding&nbsp;can&#39;t&nbsp;add&nbsp;more.</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167835">return</span>&nbsp;<span class="ident" id="3167842">appendRange</span><span class="op" id="3167853">(</span><span class="ident" id="3167854">r</span><span class="op" id="3167855">,</span>&nbsp;<span class="ident" id="3167857">lo</span><span class="op" id="3167859">,</span>&nbsp;<span class="ident" id="3167861">hi</span><span class="op" id="3167863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167869">if</span>&nbsp;<span class="ident" id="3167872">hi</span>&nbsp;<span class="op" id="3167875">&lt;</span>&nbsp;<span class="ident" id="3167877">minFold</span>&nbsp;<span class="op" id="3167885">||</span>&nbsp;<span class="ident" id="3167888">lo</span>&nbsp;<span class="op" id="3167891">&gt;</span>&nbsp;<span class="ident" id="3167893">maxFold</span>&nbsp;<span class="op" id="3167901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167905">//&nbsp;Range&nbsp;is&nbsp;outside&nbsp;folding&nbsp;possibilities.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167950">return</span>&nbsp;<span class="ident" id="3167957">appendRange</span><span class="op" id="3167968">(</span><span class="ident" id="3167969">r</span><span class="op" id="3167970">,</span>&nbsp;<span class="ident" id="3167972">lo</span><span class="op" id="3167974">,</span>&nbsp;<span class="ident" id="3167976">hi</span><span class="op" id="3167978">)</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167984">if</span>&nbsp;<span class="ident" id="3167987">lo</span>&nbsp;<span class="op" id="3167990">&lt;</span>&nbsp;<span class="ident" id="3167992">minFold</span>&nbsp;<span class="op" id="3168000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3168004">//&nbsp;[lo,&nbsp;minFold-1]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168043">r</span>&nbsp;<span class="op" id="3168045">=</span>&nbsp;<span class="ident" id="3168047">appendRange</span><span class="op" id="3168058">(</span><span class="ident" id="3168059">r</span><span class="op" id="3168060">,</span>&nbsp;<span class="ident" id="3168062">lo</span><span class="op" id="3168064">,</span>&nbsp;<span class="ident" id="3168066">minFold</span><span class="op" id="3168073">-</span><span class="num" id="3168074">1</span><span class="op" id="3168075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168079">lo</span>&nbsp;<span class="op" id="3168082">=</span>&nbsp;<span class="ident" id="3168084">minFold</span><br>
<span class="lineno">1700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3168093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168096">if</span>&nbsp;<span class="ident" id="3168099">hi</span>&nbsp;<span class="op" id="3168102">&gt;</span>&nbsp;<span class="ident" id="3168104">maxFold</span>&nbsp;<span class="op" id="3168112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3168116">//&nbsp;[maxFold+1,&nbsp;hi]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168155">r</span>&nbsp;<span class="op" id="3168157">=</span>&nbsp;<span class="ident" id="3168159">appendRange</span><span class="op" id="3168170">(</span><span class="ident" id="3168171">r</span><span class="op" id="3168172">,</span>&nbsp;<span class="ident" id="3168174">maxFold</span><span class="op" id="3168181">+</span><span class="num" id="3168182">1</span><span class="op" id="3168183">,</span>&nbsp;<span class="ident" id="3168185">hi</span><span class="op" id="3168187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168191">hi</span>&nbsp;<span class="op" id="3168194">=</span>&nbsp;<span class="ident" id="3168196">maxFold</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3168205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3168209">//&nbsp;Brute&nbsp;force.&nbsp;&nbsp;Depend&nbsp;on&nbsp;appendRange&nbsp;to&nbsp;coalesce&nbsp;ranges&nbsp;on&nbsp;the&nbsp;fly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168280">for</span>&nbsp;<span class="ident" id="3168284">c</span>&nbsp;<span class="op" id="3168286">:=</span>&nbsp;<span class="ident" id="3168289">lo</span><span class="op" id="3168291">;</span>&nbsp;<span class="ident" id="3168293">c</span>&nbsp;<span class="op" id="3168295">&lt;=</span>&nbsp;<span class="ident" id="3168298">hi</span><span class="op" id="3168300">;</span>&nbsp;<span class="ident" id="3168302">c</span><span class="op" id="3168303">++</span>&nbsp;<span class="op" id="3168306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168310">r</span>&nbsp;<span class="op" id="3168312">=</span>&nbsp;<span class="ident" id="3168314">appendRange</span><span class="op" id="3168325">(</span><span class="ident" id="3168326">r</span><span class="op" id="3168327">,</span>&nbsp;<span class="ident" id="3168329">c</span><span class="op" id="3168330">,</span>&nbsp;<span class="ident" id="3168332">c</span><span class="op" id="3168333">)</span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168337">f</span>&nbsp;<span class="op" id="3168339">:=</span>&nbsp;<span class="ident" id="3168342">unicode</span><span class="op" id="3168349">.</span><span class="ident" id="3168350">SimpleFold</span><span class="op" id="3168360">(</span><span class="ident" id="3168361">c</span><span class="op" id="3168362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168366">for</span>&nbsp;<span class="ident" id="3168370">f</span>&nbsp;<span class="op" id="3168372">!=</span>&nbsp;<span class="ident" id="3168375">c</span>&nbsp;<span class="op" id="3168377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168382">r</span>&nbsp;<span class="op" id="3168384">=</span>&nbsp;<span class="ident" id="3168386">appendRange</span><span class="op" id="3168397">(</span><span class="ident" id="3168398">r</span><span class="op" id="3168399">,</span>&nbsp;<span class="ident" id="3168401">f</span><span class="op" id="3168402">,</span>&nbsp;<span class="ident" id="3168404">f</span><span class="op" id="3168405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168410">f</span>&nbsp;<span class="op" id="3168412">=</span>&nbsp;<span class="ident" id="3168414">unicode</span><span class="op" id="3168421">.</span><span class="ident" id="3168422">SimpleFold</span><span class="op" id="3168432">(</span><span class="ident" id="3168433">f</span><span class="op" id="3168434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3168438">}</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3168441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168444">return</span>&nbsp;<span class="ident" id="3168451">r</span><br>
<span class="lineno"></span><span class="op" id="3168453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3168456">//&nbsp;appendClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1720</span><span class="comment" id="3168531">//&nbsp;It&nbsp;assume&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="3168556">func</span>&nbsp;<span class="ident" id="3168561">appendClass</span><span class="op" id="3168572">(</span><span class="ident" id="3168573">r</span>&nbsp;<span class="op" id="3168575">[</span><span class="op" id="3168576">]</span><span class="builtintype" id="3168577">rune</span><span class="op" id="3168581">,</span>&nbsp;<span class="ident" id="3168583">x</span>&nbsp;<span class="op" id="3168585">[</span><span class="op" id="3168586">]</span><span class="builtintype" id="3168587">rune</span><span class="op" id="3168591">)</span>&nbsp;<span class="op" id="3168593">[</span><span class="op" id="3168594">]</span><span class="builtintype" id="3168595">rune</span>&nbsp;<span class="op" id="3168600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168603">for</span>&nbsp;<span class="ident" id="3168607">i</span>&nbsp;<span class="op" id="3168609">:=</span>&nbsp;<span class="num" id="3168612">0</span><span class="op" id="3168613">;</span>&nbsp;<span class="ident" id="3168615">i</span>&nbsp;<span class="op" id="3168617">&lt;</span>&nbsp;<span class="builtinfunc" id="3168619">len</span><span class="op" id="3168622">(</span><span class="ident" id="3168623">x</span><span class="op" id="3168624">)</span><span class="op" id="3168625">;</span>&nbsp;<span class="ident" id="3168627">i</span>&nbsp;<span class="op" id="3168629">+=</span>&nbsp;<span class="num" id="3168632">2</span>&nbsp;<span class="op" id="3168634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168638">r</span>&nbsp;<span class="op" id="3168640">=</span>&nbsp;<span class="ident" id="3168642">appendRange</span><span class="op" id="3168653">(</span><span class="ident" id="3168654">r</span><span class="op" id="3168655">,</span>&nbsp;<span class="ident" id="3168657">x</span><span class="op" id="3168658">[</span><span class="ident" id="3168659">i</span><span class="op" id="3168660">]</span><span class="op" id="3168661">,</span>&nbsp;<span class="ident" id="3168663">x</span><span class="op" id="3168664">[</span><span class="ident" id="3168665">i</span><span class="op" id="3168666">+</span><span class="num" id="3168667">1</span><span class="op" id="3168668">]</span><span class="op" id="3168669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3168672">}</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168675">return</span>&nbsp;<span class="ident" id="3168682">r</span><br>
<span class="lineno"></span><span class="op" id="3168684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3168687">//&nbsp;appendFolded&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;case&nbsp;folding&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3168783">func</span>&nbsp;<span class="ident" id="3168788">appendFoldedClass</span><span class="op" id="3168805">(</span><span class="ident" id="3168806">r</span>&nbsp;<span class="op" id="3168808">[</span><span class="op" id="3168809">]</span><span class="builtintype" id="3168810">rune</span><span class="op" id="3168814">,</span>&nbsp;<span class="ident" id="3168816">x</span>&nbsp;<span class="op" id="3168818">[</span><span class="op" id="3168819">]</span><span class="builtintype" id="3168820">rune</span><span class="op" id="3168824">)</span>&nbsp;<span class="op" id="3168826">[</span><span class="op" id="3168827">]</span><span class="builtintype" id="3168828">rune</span>&nbsp;<span class="op" id="3168833">{</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168836">for</span>&nbsp;<span class="ident" id="3168840">i</span>&nbsp;<span class="op" id="3168842">:=</span>&nbsp;<span class="num" id="3168845">0</span><span class="op" id="3168846">;</span>&nbsp;<span class="ident" id="3168848">i</span>&nbsp;<span class="op" id="3168850">&lt;</span>&nbsp;<span class="builtinfunc" id="3168852">len</span><span class="op" id="3168855">(</span><span class="ident" id="3168856">x</span><span class="op" id="3168857">)</span><span class="op" id="3168858">;</span>&nbsp;<span class="ident" id="3168860">i</span>&nbsp;<span class="op" id="3168862">+=</span>&nbsp;<span class="num" id="3168865">2</span>&nbsp;<span class="op" id="3168867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168871">r</span>&nbsp;<span class="op" id="3168873">=</span>&nbsp;<span class="ident" id="3168875">appendFoldedRange</span><span class="op" id="3168892">(</span><span class="ident" id="3168893">r</span><span class="op" id="3168894">,</span>&nbsp;<span class="ident" id="3168896">x</span><span class="op" id="3168897">[</span><span class="ident" id="3168898">i</span><span class="op" id="3168899">]</span><span class="op" id="3168900">,</span>&nbsp;<span class="ident" id="3168902">x</span><span class="op" id="3168903">[</span><span class="ident" id="3168904">i</span><span class="op" id="3168905">+</span><span class="num" id="3168906">1</span><span class="op" id="3168907">]</span><span class="op" id="3168908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3168911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168914">return</span>&nbsp;<span class="ident" id="3168921">r</span><br>
<span class="lineno"></span><span class="op" id="3168923">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span><span class="comment" id="3168926">//&nbsp;appendNegatedClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3169024">//&nbsp;It&nbsp;assumes&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="3169050">func</span>&nbsp;<span class="ident" id="3169055">appendNegatedClass</span><span class="op" id="3169073">(</span><span class="ident" id="3169074">r</span>&nbsp;<span class="op" id="3169076">[</span><span class="op" id="3169077">]</span><span class="builtintype" id="3169078">rune</span><span class="op" id="3169082">,</span>&nbsp;<span class="ident" id="3169084">x</span>&nbsp;<span class="op" id="3169086">[</span><span class="op" id="3169087">]</span><span class="builtintype" id="3169088">rune</span><span class="op" id="3169092">)</span>&nbsp;<span class="op" id="3169094">[</span><span class="op" id="3169095">]</span><span class="builtintype" id="3169096">rune</span>&nbsp;<span class="op" id="3169101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169104">nextLo</span>&nbsp;<span class="op" id="3169111">:=</span>&nbsp;<span class="string" id="3169114">&#39;\u0000&#39;</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169124">for</span>&nbsp;<span class="ident" id="3169128">i</span>&nbsp;<span class="op" id="3169130">:=</span>&nbsp;<span class="num" id="3169133">0</span><span class="op" id="3169134">;</span>&nbsp;<span class="ident" id="3169136">i</span>&nbsp;<span class="op" id="3169138">&lt;</span>&nbsp;<span class="builtinfunc" id="3169140">len</span><span class="op" id="3169143">(</span><span class="ident" id="3169144">x</span><span class="op" id="3169145">)</span><span class="op" id="3169146">;</span>&nbsp;<span class="ident" id="3169148">i</span>&nbsp;<span class="op" id="3169150">+=</span>&nbsp;<span class="num" id="3169153">2</span>&nbsp;<span class="op" id="3169155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169159">lo</span><span class="op" id="3169161">,</span>&nbsp;<span class="ident" id="3169163">hi</span>&nbsp;<span class="op" id="3169166">:=</span>&nbsp;<span class="ident" id="3169169">x</span><span class="op" id="3169170">[</span><span class="ident" id="3169171">i</span><span class="op" id="3169172">]</span><span class="op" id="3169173">,</span>&nbsp;<span class="ident" id="3169175">x</span><span class="op" id="3169176">[</span><span class="ident" id="3169177">i</span><span class="op" id="3169178">+</span><span class="num" id="3169179">1</span><span class="op" id="3169180">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169184">if</span>&nbsp;<span class="ident" id="3169187">nextLo</span>&nbsp;<span class="op" id="3169194">&lt;=</span>&nbsp;<span class="ident" id="3169197">lo</span><span class="op" id="3169199">-</span><span class="num" id="3169200">1</span>&nbsp;<span class="op" id="3169202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169207">r</span>&nbsp;<span class="op" id="3169209">=</span>&nbsp;<span class="ident" id="3169211">appendRange</span><span class="op" id="3169222">(</span><span class="ident" id="3169223">r</span><span class="op" id="3169224">,</span>&nbsp;<span class="ident" id="3169226">nextLo</span><span class="op" id="3169232">,</span>&nbsp;<span class="ident" id="3169234">lo</span><span class="op" id="3169236">-</span><span class="num" id="3169237">1</span><span class="op" id="3169238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169242">}</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169246">nextLo</span>&nbsp;<span class="op" id="3169253">=</span>&nbsp;<span class="ident" id="3169255">hi</span>&nbsp;<span class="op" id="3169258">+</span>&nbsp;<span class="num" id="3169260">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169266">if</span>&nbsp;<span class="ident" id="3169269">nextLo</span>&nbsp;<span class="op" id="3169276">&lt;=</span>&nbsp;<span class="ident" id="3169279">unicode</span><span class="op" id="3169286">.</span><span class="ident" id="3169287">MaxRune</span>&nbsp;<span class="op" id="3169295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169299">r</span>&nbsp;<span class="op" id="3169301">=</span>&nbsp;<span class="ident" id="3169303">appendRange</span><span class="op" id="3169314">(</span><span class="ident" id="3169315">r</span><span class="op" id="3169316">,</span>&nbsp;<span class="ident" id="3169318">nextLo</span><span class="op" id="3169324">,</span>&nbsp;<span class="ident" id="3169326">unicode</span><span class="op" id="3169333">.</span><span class="ident" id="3169334">MaxRune</span><span class="op" id="3169341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169344">}</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169347">return</span>&nbsp;<span class="ident" id="3169354">r</span><br>
<span class="lineno"></span><span class="op" id="3169356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3169359">//&nbsp;appendTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3169424">func</span>&nbsp;<span class="ident" id="3169429">appendTable</span><span class="op" id="3169440">(</span><span class="ident" id="3169441">r</span>&nbsp;<span class="op" id="3169443">[</span><span class="op" id="3169444">]</span><span class="builtintype" id="3169445">rune</span><span class="op" id="3169449">,</span>&nbsp;<span class="ident" id="3169451">x</span>&nbsp;<span class="op" id="3169453">*</span><span class="ident" id="3169454">unicode</span><span class="op" id="3169461">.</span><span class="ident" id="3169462">RangeTable</span><span class="op" id="3169472">)</span>&nbsp;<span class="op" id="3169474">[</span><span class="op" id="3169475">]</span><span class="builtintype" id="3169476">rune</span>&nbsp;<span class="op" id="3169481">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169484">for</span>&nbsp;<span class="ident" id="3169488">_</span><span class="op" id="3169489">,</span>&nbsp;<span class="ident" id="3169491">xr</span>&nbsp;<span class="op" id="3169494">:=</span>&nbsp;<span class="keyword" id="3169497">range</span>&nbsp;<span class="ident" id="3169503">x</span><span class="op" id="3169504">.</span><span class="ident" id="3169505">R16</span>&nbsp;<span class="op" id="3169509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169513">lo</span><span class="op" id="3169515">,</span>&nbsp;<span class="ident" id="3169517">hi</span><span class="op" id="3169519">,</span>&nbsp;<span class="ident" id="3169521">stride</span>&nbsp;<span class="op" id="3169528">:=</span>&nbsp;<span class="builtintype" id="3169531">rune</span><span class="op" id="3169535">(</span><span class="ident" id="3169536">xr</span><span class="op" id="3169538">.</span><span class="ident" id="3169539">Lo</span><span class="op" id="3169541">)</span><span class="op" id="3169542">,</span>&nbsp;<span class="builtintype" id="3169544">rune</span><span class="op" id="3169548">(</span><span class="ident" id="3169549">xr</span><span class="op" id="3169551">.</span><span class="ident" id="3169552">Hi</span><span class="op" id="3169554">)</span><span class="op" id="3169555">,</span>&nbsp;<span class="builtintype" id="3169557">rune</span><span class="op" id="3169561">(</span><span class="ident" id="3169562">xr</span><span class="op" id="3169564">.</span><span class="ident" id="3169565">Stride</span><span class="op" id="3169571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169575">if</span>&nbsp;<span class="ident" id="3169578">stride</span>&nbsp;<span class="op" id="3169585">==</span>&nbsp;<span class="num" id="3169588">1</span>&nbsp;<span class="op" id="3169590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169595">r</span>&nbsp;<span class="op" id="3169597">=</span>&nbsp;<span class="ident" id="3169599">appendRange</span><span class="op" id="3169610">(</span><span class="ident" id="3169611">r</span><span class="op" id="3169612">,</span>&nbsp;<span class="ident" id="3169614">lo</span><span class="op" id="3169616">,</span>&nbsp;<span class="ident" id="3169618">hi</span><span class="op" id="3169620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169625">continue</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169640">for</span>&nbsp;<span class="ident" id="3169644">c</span>&nbsp;<span class="op" id="3169646">:=</span>&nbsp;<span class="ident" id="3169649">lo</span><span class="op" id="3169651">;</span>&nbsp;<span class="ident" id="3169653">c</span>&nbsp;<span class="op" id="3169655">&lt;=</span>&nbsp;<span class="ident" id="3169658">hi</span><span class="op" id="3169660">;</span>&nbsp;<span class="ident" id="3169662">c</span>&nbsp;<span class="op" id="3169664">+=</span>&nbsp;<span class="ident" id="3169667">stride</span>&nbsp;<span class="op" id="3169674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169679">r</span>&nbsp;<span class="op" id="3169681">=</span>&nbsp;<span class="ident" id="3169683">appendRange</span><span class="op" id="3169694">(</span><span class="ident" id="3169695">r</span><span class="op" id="3169696">,</span>&nbsp;<span class="ident" id="3169698">c</span><span class="op" id="3169699">,</span>&nbsp;<span class="ident" id="3169701">c</span><span class="op" id="3169702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169709">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169712">for</span>&nbsp;<span class="ident" id="3169716">_</span><span class="op" id="3169717">,</span>&nbsp;<span class="ident" id="3169719">xr</span>&nbsp;<span class="op" id="3169722">:=</span>&nbsp;<span class="keyword" id="3169725">range</span>&nbsp;<span class="ident" id="3169731">x</span><span class="op" id="3169732">.</span><span class="ident" id="3169733">R32</span>&nbsp;<span class="op" id="3169737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169741">lo</span><span class="op" id="3169743">,</span>&nbsp;<span class="ident" id="3169745">hi</span><span class="op" id="3169747">,</span>&nbsp;<span class="ident" id="3169749">stride</span>&nbsp;<span class="op" id="3169756">:=</span>&nbsp;<span class="builtintype" id="3169759">rune</span><span class="op" id="3169763">(</span><span class="ident" id="3169764">xr</span><span class="op" id="3169766">.</span><span class="ident" id="3169767">Lo</span><span class="op" id="3169769">)</span><span class="op" id="3169770">,</span>&nbsp;<span class="builtintype" id="3169772">rune</span><span class="op" id="3169776">(</span><span class="ident" id="3169777">xr</span><span class="op" id="3169779">.</span><span class="ident" id="3169780">Hi</span><span class="op" id="3169782">)</span><span class="op" id="3169783">,</span>&nbsp;<span class="builtintype" id="3169785">rune</span><span class="op" id="3169789">(</span><span class="ident" id="3169790">xr</span><span class="op" id="3169792">.</span><span class="ident" id="3169793">Stride</span><span class="op" id="3169799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169803">if</span>&nbsp;<span class="ident" id="3169806">stride</span>&nbsp;<span class="op" id="3169813">==</span>&nbsp;<span class="num" id="3169816">1</span>&nbsp;<span class="op" id="3169818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169823">r</span>&nbsp;<span class="op" id="3169825">=</span>&nbsp;<span class="ident" id="3169827">appendRange</span><span class="op" id="3169838">(</span><span class="ident" id="3169839">r</span><span class="op" id="3169840">,</span>&nbsp;<span class="ident" id="3169842">lo</span><span class="op" id="3169844">,</span>&nbsp;<span class="ident" id="3169846">hi</span><span class="op" id="3169848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169853">continue</span><br>
<span class="lineno">1770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169868">for</span>&nbsp;<span class="ident" id="3169872">c</span>&nbsp;<span class="op" id="3169874">:=</span>&nbsp;<span class="ident" id="3169877">lo</span><span class="op" id="3169879">;</span>&nbsp;<span class="ident" id="3169881">c</span>&nbsp;<span class="op" id="3169883">&lt;=</span>&nbsp;<span class="ident" id="3169886">hi</span><span class="op" id="3169888">;</span>&nbsp;<span class="ident" id="3169890">c</span>&nbsp;<span class="op" id="3169892">+=</span>&nbsp;<span class="ident" id="3169895">stride</span>&nbsp;<span class="op" id="3169902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3169907">r</span>&nbsp;<span class="op" id="3169909">=</span>&nbsp;<span class="ident" id="3169911">appendRange</span><span class="op" id="3169922">(</span><span class="ident" id="3169923">r</span><span class="op" id="3169924">,</span>&nbsp;<span class="ident" id="3169926">c</span><span class="op" id="3169927">,</span>&nbsp;<span class="ident" id="3169929">c</span><span class="op" id="3169930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3169937">}</span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3169940">return</span>&nbsp;<span class="ident" id="3169947">r</span><br>
<span class="lineno"></span><span class="op" id="3169949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3169952">//&nbsp;appendNegatedTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3170040">func</span>&nbsp;<span class="ident" id="3170045">appendNegatedTable</span><span class="op" id="3170063">(</span><span class="ident" id="3170064">r</span>&nbsp;<span class="op" id="3170066">[</span><span class="op" id="3170067">]</span><span class="builtintype" id="3170068">rune</span><span class="op" id="3170072">,</span>&nbsp;<span class="ident" id="3170074">x</span>&nbsp;<span class="op" id="3170076">*</span><span class="ident" id="3170077">unicode</span><span class="op" id="3170084">.</span><span class="ident" id="3170085">RangeTable</span><span class="op" id="3170095">)</span>&nbsp;<span class="op" id="3170097">[</span><span class="op" id="3170098">]</span><span class="builtintype" id="3170099">rune</span>&nbsp;<span class="op" id="3170104">{</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170107">nextLo</span>&nbsp;<span class="op" id="3170114">:=</span>&nbsp;<span class="string" id="3170117">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="3170126">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170158">for</span>&nbsp;<span class="ident" id="3170162">_</span><span class="op" id="3170163">,</span>&nbsp;<span class="ident" id="3170165">xr</span>&nbsp;<span class="op" id="3170168">:=</span>&nbsp;<span class="keyword" id="3170171">range</span>&nbsp;<span class="ident" id="3170177">x</span><span class="op" id="3170178">.</span><span class="ident" id="3170179">R16</span>&nbsp;<span class="op" id="3170183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170187">lo</span><span class="op" id="3170189">,</span>&nbsp;<span class="ident" id="3170191">hi</span><span class="op" id="3170193">,</span>&nbsp;<span class="ident" id="3170195">stride</span>&nbsp;<span class="op" id="3170202">:=</span>&nbsp;<span class="builtintype" id="3170205">rune</span><span class="op" id="3170209">(</span><span class="ident" id="3170210">xr</span><span class="op" id="3170212">.</span><span class="ident" id="3170213">Lo</span><span class="op" id="3170215">)</span><span class="op" id="3170216">,</span>&nbsp;<span class="builtintype" id="3170218">rune</span><span class="op" id="3170222">(</span><span class="ident" id="3170223">xr</span><span class="op" id="3170225">.</span><span class="ident" id="3170226">Hi</span><span class="op" id="3170228">)</span><span class="op" id="3170229">,</span>&nbsp;<span class="builtintype" id="3170231">rune</span><span class="op" id="3170235">(</span><span class="ident" id="3170236">xr</span><span class="op" id="3170238">.</span><span class="ident" id="3170239">Stride</span><span class="op" id="3170245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170249">if</span>&nbsp;<span class="ident" id="3170252">stride</span>&nbsp;<span class="op" id="3170259">==</span>&nbsp;<span class="num" id="3170262">1</span>&nbsp;<span class="op" id="3170264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170269">if</span>&nbsp;<span class="ident" id="3170272">nextLo</span>&nbsp;<span class="op" id="3170279">&lt;=</span>&nbsp;<span class="ident" id="3170282">lo</span><span class="op" id="3170284">-</span><span class="num" id="3170285">1</span>&nbsp;<span class="op" id="3170287">{</span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170293">r</span>&nbsp;<span class="op" id="3170295">=</span>&nbsp;<span class="ident" id="3170297">appendRange</span><span class="op" id="3170308">(</span><span class="ident" id="3170309">r</span><span class="op" id="3170310">,</span>&nbsp;<span class="ident" id="3170312">nextLo</span><span class="op" id="3170318">,</span>&nbsp;<span class="ident" id="3170320">lo</span><span class="op" id="3170322">-</span><span class="num" id="3170323">1</span><span class="op" id="3170324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170334">nextLo</span>&nbsp;<span class="op" id="3170341">=</span>&nbsp;<span class="ident" id="3170343">hi</span>&nbsp;<span class="op" id="3170346">+</span>&nbsp;<span class="num" id="3170348">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170353">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170364">}</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170368">for</span>&nbsp;<span class="ident" id="3170372">c</span>&nbsp;<span class="op" id="3170374">:=</span>&nbsp;<span class="ident" id="3170377">lo</span><span class="op" id="3170379">;</span>&nbsp;<span class="ident" id="3170381">c</span>&nbsp;<span class="op" id="3170383">&lt;=</span>&nbsp;<span class="ident" id="3170386">hi</span><span class="op" id="3170388">;</span>&nbsp;<span class="ident" id="3170390">c</span>&nbsp;<span class="op" id="3170392">+=</span>&nbsp;<span class="ident" id="3170395">stride</span>&nbsp;<span class="op" id="3170402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170407">if</span>&nbsp;<span class="ident" id="3170410">nextLo</span>&nbsp;<span class="op" id="3170417">&lt;=</span>&nbsp;<span class="ident" id="3170420">c</span><span class="op" id="3170421">-</span><span class="num" id="3170422">1</span>&nbsp;<span class="op" id="3170424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170430">r</span>&nbsp;<span class="op" id="3170432">=</span>&nbsp;<span class="ident" id="3170434">appendRange</span><span class="op" id="3170445">(</span><span class="ident" id="3170446">r</span><span class="op" id="3170447">,</span>&nbsp;<span class="ident" id="3170449">nextLo</span><span class="op" id="3170455">,</span>&nbsp;<span class="ident" id="3170457">c</span><span class="op" id="3170458">-</span><span class="num" id="3170459">1</span><span class="op" id="3170460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170470">nextLo</span>&nbsp;<span class="op" id="3170477">=</span>&nbsp;<span class="ident" id="3170479">c</span>&nbsp;<span class="op" id="3170481">+</span>&nbsp;<span class="num" id="3170483">1</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170493">for</span>&nbsp;<span class="ident" id="3170497">_</span><span class="op" id="3170498">,</span>&nbsp;<span class="ident" id="3170500">xr</span>&nbsp;<span class="op" id="3170503">:=</span>&nbsp;<span class="keyword" id="3170506">range</span>&nbsp;<span class="ident" id="3170512">x</span><span class="op" id="3170513">.</span><span class="ident" id="3170514">R32</span>&nbsp;<span class="op" id="3170518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170522">lo</span><span class="op" id="3170524">,</span>&nbsp;<span class="ident" id="3170526">hi</span><span class="op" id="3170528">,</span>&nbsp;<span class="ident" id="3170530">stride</span>&nbsp;<span class="op" id="3170537">:=</span>&nbsp;<span class="builtintype" id="3170540">rune</span><span class="op" id="3170544">(</span><span class="ident" id="3170545">xr</span><span class="op" id="3170547">.</span><span class="ident" id="3170548">Lo</span><span class="op" id="3170550">)</span><span class="op" id="3170551">,</span>&nbsp;<span class="builtintype" id="3170553">rune</span><span class="op" id="3170557">(</span><span class="ident" id="3170558">xr</span><span class="op" id="3170560">.</span><span class="ident" id="3170561">Hi</span><span class="op" id="3170563">)</span><span class="op" id="3170564">,</span>&nbsp;<span class="builtintype" id="3170566">rune</span><span class="op" id="3170570">(</span><span class="ident" id="3170571">xr</span><span class="op" id="3170573">.</span><span class="ident" id="3170574">Stride</span><span class="op" id="3170580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170584">if</span>&nbsp;<span class="ident" id="3170587">stride</span>&nbsp;<span class="op" id="3170594">==</span>&nbsp;<span class="num" id="3170597">1</span>&nbsp;<span class="op" id="3170599">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170604">if</span>&nbsp;<span class="ident" id="3170607">nextLo</span>&nbsp;<span class="op" id="3170614">&lt;=</span>&nbsp;<span class="ident" id="3170617">lo</span><span class="op" id="3170619">-</span><span class="num" id="3170620">1</span>&nbsp;<span class="op" id="3170622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170628">r</span>&nbsp;<span class="op" id="3170630">=</span>&nbsp;<span class="ident" id="3170632">appendRange</span><span class="op" id="3170643">(</span><span class="ident" id="3170644">r</span><span class="op" id="3170645">,</span>&nbsp;<span class="ident" id="3170647">nextLo</span><span class="op" id="3170653">,</span>&nbsp;<span class="ident" id="3170655">lo</span><span class="op" id="3170657">-</span><span class="num" id="3170658">1</span><span class="op" id="3170659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170669">nextLo</span>&nbsp;<span class="op" id="3170676">=</span>&nbsp;<span class="ident" id="3170678">hi</span>&nbsp;<span class="op" id="3170681">+</span>&nbsp;<span class="num" id="3170683">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170688">continue</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170703">for</span>&nbsp;<span class="ident" id="3170707">c</span>&nbsp;<span class="op" id="3170709">:=</span>&nbsp;<span class="ident" id="3170712">lo</span><span class="op" id="3170714">;</span>&nbsp;<span class="ident" id="3170716">c</span>&nbsp;<span class="op" id="3170718">&lt;=</span>&nbsp;<span class="ident" id="3170721">hi</span><span class="op" id="3170723">;</span>&nbsp;<span class="ident" id="3170725">c</span>&nbsp;<span class="op" id="3170727">+=</span>&nbsp;<span class="ident" id="3170730">stride</span>&nbsp;<span class="op" id="3170737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170742">if</span>&nbsp;<span class="ident" id="3170745">nextLo</span>&nbsp;<span class="op" id="3170752">&lt;=</span>&nbsp;<span class="ident" id="3170755">c</span><span class="op" id="3170756">-</span><span class="num" id="3170757">1</span>&nbsp;<span class="op" id="3170759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170765">r</span>&nbsp;<span class="op" id="3170767">=</span>&nbsp;<span class="ident" id="3170769">appendRange</span><span class="op" id="3170780">(</span><span class="ident" id="3170781">r</span><span class="op" id="3170782">,</span>&nbsp;<span class="ident" id="3170784">nextLo</span><span class="op" id="3170790">,</span>&nbsp;<span class="ident" id="3170792">c</span><span class="op" id="3170793">-</span><span class="num" id="3170794">1</span><span class="op" id="3170795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170800">}</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170805">nextLo</span>&nbsp;<span class="op" id="3170812">=</span>&nbsp;<span class="ident" id="3170814">c</span>&nbsp;<span class="op" id="3170816">+</span>&nbsp;<span class="num" id="3170818">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170828">if</span>&nbsp;<span class="ident" id="3170831">nextLo</span>&nbsp;<span class="op" id="3170838">&lt;=</span>&nbsp;<span class="ident" id="3170841">unicode</span><span class="op" id="3170848">.</span><span class="ident" id="3170849">MaxRune</span>&nbsp;<span class="op" id="3170857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3170861">r</span>&nbsp;<span class="op" id="3170863">=</span>&nbsp;<span class="ident" id="3170865">appendRange</span><span class="op" id="3170876">(</span><span class="ident" id="3170877">r</span><span class="op" id="3170878">,</span>&nbsp;<span class="ident" id="3170880">nextLo</span><span class="op" id="3170886">,</span>&nbsp;<span class="ident" id="3170888">unicode</span><span class="op" id="3170895">.</span><span class="ident" id="3170896">MaxRune</span><span class="op" id="3170903">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3170906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3170909">return</span>&nbsp;<span class="ident" id="3170916">r</span><br>
<span class="lineno"></span><span class="op" id="3170918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3170921">//&nbsp;negateClass&nbsp;overwrites&nbsp;r&nbsp;and&nbsp;returns&nbsp;r&#39;s&nbsp;negation.</span><br>
<span class="lineno">1820</span><span class="comment" id="3170975">//&nbsp;It&nbsp;assumes&nbsp;the&nbsp;class&nbsp;r&nbsp;is&nbsp;already&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="3171019">func</span>&nbsp;<span class="ident" id="3171024">negateClass</span><span class="op" id="3171035">(</span><span class="ident" id="3171036">r</span>&nbsp;<span class="op" id="3171038">[</span><span class="op" id="3171039">]</span><span class="builtintype" id="3171040">rune</span><span class="op" id="3171044">)</span>&nbsp;<span class="op" id="3171046">[</span><span class="op" id="3171047">]</span><span class="builtintype" id="3171048">rune</span>&nbsp;<span class="op" id="3171053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171056">nextLo</span>&nbsp;<span class="op" id="3171063">:=</span>&nbsp;<span class="string" id="3171066">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="3171075">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171107">w</span>&nbsp;<span class="op" id="3171109">:=</span>&nbsp;<span class="num" id="3171112">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3171126">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171142">for</span>&nbsp;<span class="ident" id="3171146">i</span>&nbsp;<span class="op" id="3171148">:=</span>&nbsp;<span class="num" id="3171151">0</span><span class="op" id="3171152">;</span>&nbsp;<span class="ident" id="3171154">i</span>&nbsp;<span class="op" id="3171156">&lt;</span>&nbsp;<span class="builtinfunc" id="3171158">len</span><span class="op" id="3171161">(</span><span class="ident" id="3171162">r</span><span class="op" id="3171163">)</span><span class="op" id="3171164">;</span>&nbsp;<span class="ident" id="3171166">i</span>&nbsp;<span class="op" id="3171168">+=</span>&nbsp;<span class="num" id="3171171">2</span>&nbsp;<span class="op" id="3171173">{</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171177">lo</span><span class="op" id="3171179">,</span>&nbsp;<span class="ident" id="3171181">hi</span>&nbsp;<span class="op" id="3171184">:=</span>&nbsp;<span class="ident" id="3171187">r</span><span class="op" id="3171188">[</span><span class="ident" id="3171189">i</span><span class="op" id="3171190">]</span><span class="op" id="3171191">,</span>&nbsp;<span class="ident" id="3171193">r</span><span class="op" id="3171194">[</span><span class="ident" id="3171195">i</span><span class="op" id="3171196">+</span><span class="num" id="3171197">1</span><span class="op" id="3171198">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171202">if</span>&nbsp;<span class="ident" id="3171205">nextLo</span>&nbsp;<span class="op" id="3171212">&lt;=</span>&nbsp;<span class="ident" id="3171215">lo</span><span class="op" id="3171217">-</span><span class="num" id="3171218">1</span>&nbsp;<span class="op" id="3171220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171225">r</span><span class="op" id="3171226">[</span><span class="ident" id="3171227">w</span><span class="op" id="3171228">]</span>&nbsp;<span class="op" id="3171230">=</span>&nbsp;<span class="ident" id="3171232">nextLo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171242">r</span><span class="op" id="3171243">[</span><span class="ident" id="3171244">w</span><span class="op" id="3171245">+</span><span class="num" id="3171246">1</span><span class="op" id="3171247">]</span>&nbsp;<span class="op" id="3171249">=</span>&nbsp;<span class="ident" id="3171251">lo</span>&nbsp;<span class="op" id="3171254">-</span>&nbsp;<span class="num" id="3171256">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171261">w</span>&nbsp;<span class="op" id="3171263">+=</span>&nbsp;<span class="num" id="3171266">2</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171274">nextLo</span>&nbsp;<span class="op" id="3171281">=</span>&nbsp;<span class="ident" id="3171283">hi</span>&nbsp;<span class="op" id="3171286">+</span>&nbsp;<span class="num" id="3171288">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171294">r</span>&nbsp;<span class="op" id="3171296">=</span>&nbsp;<span class="ident" id="3171298">r</span><span class="op" id="3171299">[</span><span class="op" id="3171300">:</span><span class="ident" id="3171301">w</span><span class="op" id="3171302">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171305">if</span>&nbsp;<span class="ident" id="3171308">nextLo</span>&nbsp;<span class="op" id="3171315">&lt;=</span>&nbsp;<span class="ident" id="3171318">unicode</span><span class="op" id="3171325">.</span><span class="ident" id="3171326">MaxRune</span>&nbsp;<span class="op" id="3171334">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3171338">//&nbsp;It&#39;s&nbsp;possible&nbsp;for&nbsp;the&nbsp;negation&nbsp;to&nbsp;have&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3171391">//&nbsp;range&nbsp;-&nbsp;this&nbsp;one&nbsp;-&nbsp;than&nbsp;the&nbsp;original&nbsp;class,&nbsp;so&nbsp;use&nbsp;append.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171455">r</span>&nbsp;<span class="op" id="3171457">=</span>&nbsp;<span class="builtinfunc" id="3171459">append</span><span class="op" id="3171465">(</span><span class="ident" id="3171466">r</span><span class="op" id="3171467">,</span>&nbsp;<span class="ident" id="3171469">nextLo</span><span class="op" id="3171475">,</span>&nbsp;<span class="ident" id="3171477">unicode</span><span class="op" id="3171484">.</span><span class="ident" id="3171485">MaxRune</span><span class="op" id="3171492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3171495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171498">return</span>&nbsp;<span class="ident" id="3171505">r</span><br>
<span class="lineno">1840</span><span class="op" id="3171507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3171510">//&nbsp;ranges&nbsp;implements&nbsp;sort.Interface&nbsp;on&nbsp;a&nbsp;[]rune.</span><br>
<span class="lineno"></span><span class="comment" id="3171559">//&nbsp;The&nbsp;choice&nbsp;of&nbsp;receiver&nbsp;type&nbsp;definition&nbsp;is&nbsp;strange</span><br>
<span class="lineno"></span><span class="comment" id="3171612">//&nbsp;but&nbsp;avoids&nbsp;an&nbsp;allocation&nbsp;since&nbsp;we&nbsp;already&nbsp;have</span><br>
<span class="lineno">1845</span><span class="comment" id="3171662">//&nbsp;a&nbsp;*[]rune.</span><br>
<span class="lineno"></span><span class="keyword" id="3171676">type</span>&nbsp;<span class="ident" id="3171681">ranges</span>&nbsp;<span class="keyword" id="3171688">struct</span>&nbsp;<span class="op" id="3171695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171698">p</span>&nbsp;<span class="op" id="3171700">*</span><span class="op" id="3171701">[</span><span class="op" id="3171702">]</span><span class="builtintype" id="3171703">rune</span><br>
<span class="lineno"></span><span class="op" id="3171708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1850</span><span class="keyword" id="3171711">func</span>&nbsp;<span class="op" id="3171716">(</span><span class="ident" id="3171717">ra</span>&nbsp;<span class="ident" id="3171720">ranges</span><span class="op" id="3171726">)</span>&nbsp;<span class="ident" id="3171728">Less</span><span class="op" id="3171732">(</span><span class="ident" id="3171733">i</span><span class="op" id="3171734">,</span>&nbsp;<span class="ident" id="3171736">j</span>&nbsp;<span class="builtintype" id="3171738">int</span><span class="op" id="3171741">)</span>&nbsp;<span class="builtintype" id="3171743">bool</span>&nbsp;<span class="op" id="3171748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171751">p</span>&nbsp;<span class="op" id="3171753">:=</span>&nbsp;<span class="op" id="3171756">*</span><span class="ident" id="3171757">ra</span><span class="op" id="3171759">.</span><span class="ident" id="3171760">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171763">i</span>&nbsp;<span class="op" id="3171765">*=</span>&nbsp;<span class="num" id="3171768">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171771">j</span>&nbsp;<span class="op" id="3171773">*=</span>&nbsp;<span class="num" id="3171776">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171779">return</span>&nbsp;<span class="ident" id="3171786">p</span><span class="op" id="3171787">[</span><span class="ident" id="3171788">i</span><span class="op" id="3171789">]</span>&nbsp;<span class="op" id="3171791">&lt;</span>&nbsp;<span class="ident" id="3171793">p</span><span class="op" id="3171794">[</span><span class="ident" id="3171795">j</span><span class="op" id="3171796">]</span>&nbsp;<span class="op" id="3171798">||</span>&nbsp;<span class="ident" id="3171801">p</span><span class="op" id="3171802">[</span><span class="ident" id="3171803">i</span><span class="op" id="3171804">]</span>&nbsp;<span class="op" id="3171806">==</span>&nbsp;<span class="ident" id="3171809">p</span><span class="op" id="3171810">[</span><span class="ident" id="3171811">j</span><span class="op" id="3171812">]</span>&nbsp;<span class="op" id="3171814">&amp;&amp;</span>&nbsp;<span class="ident" id="3171817">p</span><span class="op" id="3171818">[</span><span class="ident" id="3171819">i</span><span class="op" id="3171820">+</span><span class="num" id="3171821">1</span><span class="op" id="3171822">]</span>&nbsp;<span class="op" id="3171824">&gt;</span>&nbsp;<span class="ident" id="3171826">p</span><span class="op" id="3171827">[</span><span class="ident" id="3171828">j</span><span class="op" id="3171829">+</span><span class="num" id="3171830">1</span><span class="op" id="3171831">]</span><br>
<span class="lineno">1855</span><span class="op" id="3171833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3171836">func</span>&nbsp;<span class="op" id="3171841">(</span><span class="ident" id="3171842">ra</span>&nbsp;<span class="ident" id="3171845">ranges</span><span class="op" id="3171851">)</span>&nbsp;<span class="ident" id="3171853">Len</span><span class="op" id="3171856">(</span><span class="op" id="3171857">)</span>&nbsp;<span class="builtintype" id="3171859">int</span>&nbsp;<span class="op" id="3171863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3171866">return</span>&nbsp;<span class="builtinfunc" id="3171873">len</span><span class="op" id="3171876">(</span><span class="op" id="3171877">*</span><span class="ident" id="3171878">ra</span><span class="op" id="3171880">.</span><span class="ident" id="3171881">p</span><span class="op" id="3171882">)</span>&nbsp;<span class="op" id="3171884">/</span>&nbsp;<span class="num" id="3171886">2</span><br>
<span class="lineno"></span><span class="op" id="3171888">}</span><br>
<span class="lineno">1860</span><br>
<span class="lineno"></span><span class="keyword" id="3171891">func</span>&nbsp;<span class="op" id="3171896">(</span><span class="ident" id="3171897">ra</span>&nbsp;<span class="ident" id="3171900">ranges</span><span class="op" id="3171906">)</span>&nbsp;<span class="ident" id="3171908">Swap</span><span class="op" id="3171912">(</span><span class="ident" id="3171913">i</span><span class="op" id="3171914">,</span>&nbsp;<span class="ident" id="3171916">j</span>&nbsp;<span class="builtintype" id="3171918">int</span><span class="op" id="3171921">)</span>&nbsp;<span class="op" id="3171923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171926">p</span>&nbsp;<span class="op" id="3171928">:=</span>&nbsp;<span class="op" id="3171931">*</span><span class="ident" id="3171932">ra</span><span class="op" id="3171934">.</span><span class="ident" id="3171935">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171938">i</span>&nbsp;<span class="op" id="3171940">*=</span>&nbsp;<span class="num" id="3171943">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171946">j</span>&nbsp;<span class="op" id="3171948">*=</span>&nbsp;<span class="num" id="3171951">2</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3171954">p</span><span class="op" id="3171955">[</span><span class="ident" id="3171956">i</span><span class="op" id="3171957">]</span><span class="op" id="3171958">,</span>&nbsp;<span class="ident" id="3171960">p</span><span class="op" id="3171961">[</span><span class="ident" id="3171962">i</span><span class="op" id="3171963">+</span><span class="num" id="3171964">1</span><span class="op" id="3171965">]</span><span class="op" id="3171966">,</span>&nbsp;<span class="ident" id="3171968">p</span><span class="op" id="3171969">[</span><span class="ident" id="3171970">j</span><span class="op" id="3171971">]</span><span class="op" id="3171972">,</span>&nbsp;<span class="ident" id="3171974">p</span><span class="op" id="3171975">[</span><span class="ident" id="3171976">j</span><span class="op" id="3171977">+</span><span class="num" id="3171978">1</span><span class="op" id="3171979">]</span>&nbsp;<span class="op" id="3171981">=</span>&nbsp;<span class="ident" id="3171983">p</span><span class="op" id="3171984">[</span><span class="ident" id="3171985">j</span><span class="op" id="3171986">]</span><span class="op" id="3171987">,</span>&nbsp;<span class="ident" id="3171989">p</span><span class="op" id="3171990">[</span><span class="ident" id="3171991">j</span><span class="op" id="3171992">+</span><span class="num" id="3171993">1</span><span class="op" id="3171994">]</span><span class="op" id="3171995">,</span>&nbsp;<span class="ident" id="3171997">p</span><span class="op" id="3171998">[</span><span class="ident" id="3171999">i</span><span class="op" id="3172000">]</span><span class="op" id="3172001">,</span>&nbsp;<span class="ident" id="3172003">p</span><span class="op" id="3172004">[</span><span class="ident" id="3172005">i</span><span class="op" id="3172006">+</span><span class="num" id="3172007">1</span><span class="op" id="3172008">]</span><br>
<span class="lineno"></span><span class="op" id="3172010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3172013">func</span>&nbsp;<span class="ident" id="3172018">checkUTF8</span><span class="op" id="3172027">(</span><span class="ident" id="3172028">s</span>&nbsp;<span class="builtintype" id="3172030">string</span><span class="op" id="3172036">)</span>&nbsp;<span class="builtintype" id="3172038">error</span>&nbsp;<span class="op" id="3172044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172047">for</span>&nbsp;<span class="ident" id="3172051">s</span>&nbsp;<span class="op" id="3172053">!=</span>&nbsp;<span class="string" id="3172056">&#34;&#34;</span>&nbsp;<span class="op" id="3172059">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3172063">rune</span><span class="op" id="3172067">,</span>&nbsp;<span class="ident" id="3172069">size</span>&nbsp;<span class="op" id="3172074">:=</span>&nbsp;<span class="ident" id="3172077">utf8</span><span class="op" id="3172081">.</span><span class="ident" id="3172082">DecodeRuneInString</span><span class="op" id="3172100">(</span><span class="ident" id="3172101">s</span><span class="op" id="3172102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172106">if</span>&nbsp;<span class="builtintype" id="3172109">rune</span>&nbsp;<span class="op" id="3172114">==</span>&nbsp;<span class="ident" id="3172117">utf8</span><span class="op" id="3172121">.</span><span class="ident" id="3172122">RuneError</span>&nbsp;<span class="op" id="3172132">&amp;&amp;</span>&nbsp;<span class="ident" id="3172135">size</span>&nbsp;<span class="op" id="3172140">==</span>&nbsp;<span class="num" id="3172143">1</span>&nbsp;<span class="op" id="3172145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172150">return</span>&nbsp;<span class="op" id="3172157">&amp;</span><span class="ident" id="3172158">Error</span><span class="op" id="3172163">{</span><span class="ident" id="3172164">Code</span><span class="op" id="3172168">:</span>&nbsp;<span class="ident" id="3172170">ErrInvalidUTF8</span><span class="op" id="3172184">,</span>&nbsp;<span class="ident" id="3172186">Expr</span><span class="op" id="3172190">:</span>&nbsp;<span class="ident" id="3172192">s</span><span class="op" id="3172193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172201">s</span>&nbsp;<span class="op" id="3172203">=</span>&nbsp;<span class="ident" id="3172205">s</span><span class="op" id="3172206">[</span><span class="ident" id="3172207">size</span><span class="op" id="3172211">:</span><span class="op" id="3172212">]</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172218">return</span>&nbsp;<span class="ident" id="3172225">nil</span><br>
<span class="lineno"></span><span class="op" id="3172229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3172232">func</span>&nbsp;<span class="ident" id="3172237">nextRune</span><span class="op" id="3172245">(</span><span class="ident" id="3172246">s</span>&nbsp;<span class="builtintype" id="3172248">string</span><span class="op" id="3172254">)</span>&nbsp;<span class="op" id="3172256">(</span><span class="ident" id="3172257">c</span>&nbsp;<span class="builtintype" id="3172259">rune</span><span class="op" id="3172263">,</span>&nbsp;<span class="ident" id="3172265">t</span>&nbsp;<span class="builtintype" id="3172267">string</span><span class="op" id="3172273">,</span>&nbsp;<span class="ident" id="3172275">err</span>&nbsp;<span class="builtintype" id="3172279">error</span><span class="op" id="3172284">)</span>&nbsp;<span class="op" id="3172286">{</span><br>
<span class="lineno">1880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3172289">c</span><span class="op" id="3172290">,</span>&nbsp;<span class="ident" id="3172292">size</span>&nbsp;<span class="op" id="3172297">:=</span>&nbsp;<span class="ident" id="3172300">utf8</span><span class="op" id="3172304">.</span><span class="ident" id="3172305">DecodeRuneInString</span><span class="op" id="3172323">(</span><span class="ident" id="3172324">s</span><span class="op" id="3172325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172328">if</span>&nbsp;<span class="ident" id="3172331">c</span>&nbsp;<span class="op" id="3172333">==</span>&nbsp;<span class="ident" id="3172336">utf8</span><span class="op" id="3172340">.</span><span class="ident" id="3172341">RuneError</span>&nbsp;<span class="op" id="3172351">&amp;&amp;</span>&nbsp;<span class="ident" id="3172354">size</span>&nbsp;<span class="op" id="3172359">==</span>&nbsp;<span class="num" id="3172362">1</span>&nbsp;<span class="op" id="3172364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172368">return</span>&nbsp;<span class="num" id="3172375">0</span><span class="op" id="3172376">,</span>&nbsp;<span class="string" id="3172378">&#34;&#34;</span><span class="op" id="3172380">,</span>&nbsp;<span class="op" id="3172382">&amp;</span><span class="ident" id="3172383">Error</span><span class="op" id="3172388">{</span><span class="ident" id="3172389">Code</span><span class="op" id="3172393">:</span>&nbsp;<span class="ident" id="3172395">ErrInvalidUTF8</span><span class="op" id="3172409">,</span>&nbsp;<span class="ident" id="3172411">Expr</span><span class="op" id="3172415">:</span>&nbsp;<span class="ident" id="3172417">s</span><span class="op" id="3172418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172424">return</span>&nbsp;<span class="ident" id="3172431">c</span><span class="op" id="3172432">,</span>&nbsp;<span class="ident" id="3172434">s</span><span class="op" id="3172435">[</span><span class="ident" id="3172436">size</span><span class="op" id="3172440">:</span><span class="op" id="3172441">]</span><span class="op" id="3172442">,</span>&nbsp;<span class="ident" id="3172444">nil</span><br>
<span class="lineno">1885</span><span class="op" id="3172448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3172451">func</span>&nbsp;<span class="ident" id="3172456">isalnum</span><span class="op" id="3172463">(</span><span class="ident" id="3172464">c</span>&nbsp;<span class="builtintype" id="3172466">rune</span><span class="op" id="3172470">)</span>&nbsp;<span class="builtintype" id="3172472">bool</span>&nbsp;<span class="op" id="3172477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172480">return</span>&nbsp;<span class="string" id="3172487">&#39;0&#39;</span>&nbsp;<span class="op" id="3172491">&lt;=</span>&nbsp;<span class="ident" id="3172494">c</span>&nbsp;<span class="op" id="3172496">&amp;&amp;</span>&nbsp;<span class="ident" id="3172499">c</span>&nbsp;<span class="op" id="3172501">&lt;=</span>&nbsp;<span class="string" id="3172504">&#39;9&#39;</span>&nbsp;<span class="op" id="3172508">||</span>&nbsp;<span class="string" id="3172511">&#39;A&#39;</span>&nbsp;<span class="op" id="3172515">&lt;=</span>&nbsp;<span class="ident" id="3172518">c</span>&nbsp;<span class="op" id="3172520">&amp;&amp;</span>&nbsp;<span class="ident" id="3172523">c</span>&nbsp;<span class="op" id="3172525">&lt;=</span>&nbsp;<span class="string" id="3172528">&#39;Z&#39;</span>&nbsp;<span class="op" id="3172532">||</span>&nbsp;<span class="string" id="3172535">&#39;a&#39;</span>&nbsp;<span class="op" id="3172539">&lt;=</span>&nbsp;<span class="ident" id="3172542">c</span>&nbsp;<span class="op" id="3172544">&amp;&amp;</span>&nbsp;<span class="ident" id="3172547">c</span>&nbsp;<span class="op" id="3172549">&lt;=</span>&nbsp;<span class="string" id="3172552">&#39;z&#39;</span><br>
<span class="lineno"></span><span class="op" id="3172556">}</span><br>
<span class="lineno">1890</span><br>
<span class="lineno"></span><span class="keyword" id="3172559">func</span>&nbsp;<span class="ident" id="3172564">unhex</span><span class="op" id="3172569">(</span><span class="ident" id="3172570">c</span>&nbsp;<span class="builtintype" id="3172572">rune</span><span class="op" id="3172576">)</span>&nbsp;<span class="builtintype" id="3172578">rune</span>&nbsp;<span class="op" id="3172583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172586">if</span>&nbsp;<span class="string" id="3172589">&#39;0&#39;</span>&nbsp;<span class="op" id="3172593">&lt;=</span>&nbsp;<span class="ident" id="3172596">c</span>&nbsp;<span class="op" id="3172598">&amp;&amp;</span>&nbsp;<span class="ident" id="3172601">c</span>&nbsp;<span class="op" id="3172603">&lt;=</span>&nbsp;<span class="string" id="3172606">&#39;9&#39;</span>&nbsp;<span class="op" id="3172610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172614">return</span>&nbsp;<span class="ident" id="3172621">c</span>&nbsp;<span class="op" id="3172623">-</span>&nbsp;<span class="string" id="3172625">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172630">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172633">if</span>&nbsp;<span class="string" id="3172636">&#39;a&#39;</span>&nbsp;<span class="op" id="3172640">&lt;=</span>&nbsp;<span class="ident" id="3172643">c</span>&nbsp;<span class="op" id="3172645">&amp;&amp;</span>&nbsp;<span class="ident" id="3172648">c</span>&nbsp;<span class="op" id="3172650">&lt;=</span>&nbsp;<span class="string" id="3172653">&#39;f&#39;</span>&nbsp;<span class="op" id="3172657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172661">return</span>&nbsp;<span class="ident" id="3172668">c</span>&nbsp;<span class="op" id="3172670">-</span>&nbsp;<span class="string" id="3172672">&#39;a&#39;</span>&nbsp;<span class="op" id="3172676">+</span>&nbsp;<span class="num" id="3172678">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172685">if</span>&nbsp;<span class="string" id="3172688">&#39;A&#39;</span>&nbsp;<span class="op" id="3172692">&lt;=</span>&nbsp;<span class="ident" id="3172695">c</span>&nbsp;<span class="op" id="3172697">&amp;&amp;</span>&nbsp;<span class="ident" id="3172700">c</span>&nbsp;<span class="op" id="3172702">&lt;=</span>&nbsp;<span class="string" id="3172705">&#39;F&#39;</span>&nbsp;<span class="op" id="3172709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172713">return</span>&nbsp;<span class="ident" id="3172720">c</span>&nbsp;<span class="op" id="3172722">-</span>&nbsp;<span class="string" id="3172724">&#39;A&#39;</span>&nbsp;<span class="op" id="3172728">+</span>&nbsp;<span class="num" id="3172730">10</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3172734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3172737">return</span>&nbsp;<span class="op" id="3172744">-</span><span class="num" id="3172745">1</span><br>
<span class="lineno"></span><span class="op" id="3172747">}</span>
</div>
</body>
</html>
