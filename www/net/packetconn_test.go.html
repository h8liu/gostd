<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7502467">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7502523">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7502577">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7502628">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;API&nbsp;tests&nbsp;across&nbsp;platforms&nbsp;and&nbsp;will&nbsp;never&nbsp;have&nbsp;a&nbsp;build</span><br>
<span class="lineno"></span><span class="comment" id="7502707">//&nbsp;tag.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7502716">package</span>&nbsp;<span class="ident" id="7502724">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7502729">import</span>&nbsp;<span class="op" id="7502736">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7502739">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7502745">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7502756">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7502767">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7502778">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7502785">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7502788">func</span>&nbsp;<span class="ident" id="7502793">packetConnTestData</span><span class="op" id="7502811">(</span><span class="ident" id="7502812">t</span>&nbsp;<span class="op" id="7502814">*</span><span class="ident" id="7502815">testing</span><span class="op" id="7502822">.</span><span class="ident" id="7502823">T</span><span class="op" id="7502824">,</span>&nbsp;<span class="ident" id="7502826">net</span>&nbsp;<span class="builtintype" id="7502830">string</span><span class="op" id="7502836">,</span>&nbsp;<span class="ident" id="7502838">i</span>&nbsp;<span class="builtintype" id="7502840">int</span><span class="op" id="7502843">)</span>&nbsp;<span class="op" id="7502845">(</span><span class="op" id="7502846">[</span><span class="op" id="7502847">]</span><span class="builtintype" id="7502848">byte</span><span class="op" id="7502852">,</span>&nbsp;<span class="keyword" id="7502854">func</span><span class="op" id="7502858">(</span><span class="op" id="7502859">)</span><span class="op" id="7502860">)</span>&nbsp;<span class="op" id="7502862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7502865">switch</span>&nbsp;<span class="ident" id="7502872">net</span>&nbsp;<span class="op" id="7502876">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7502879">case</span>&nbsp;<span class="string" id="7502884">&#34;udp&#34;</span><span class="op" id="7502889">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7502893">return</span>&nbsp;<span class="op" id="7502900">[</span><span class="op" id="7502901">]</span><span class="builtintype" id="7502902">byte</span><span class="op" id="7502906">(</span><span class="string" id="7502907">&#34;UDP&nbsp;PACKETCONN&nbsp;TEST&#34;</span><span class="op" id="7502928">)</span><span class="op" id="7502929">,</span>&nbsp;<span class="ident" id="7502931">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7502936">case</span>&nbsp;<span class="string" id="7502941">&#34;ip&#34;</span><span class="op" id="7502945">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7502949">if</span>&nbsp;<span class="ident" id="7502952">skip</span><span class="op" id="7502956">,</span>&nbsp;<span class="ident" id="7502958">skipmsg</span>&nbsp;<span class="op" id="7502966">:=</span>&nbsp;<span class="ident" id="7502969">skipRawSocketTest</span><span class="op" id="7502986">(</span><span class="ident" id="7502987">t</span><span class="op" id="7502988">)</span><span class="op" id="7502989">;</span>&nbsp;<span class="ident" id="7502991">skip</span>&nbsp;<span class="op" id="7502996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7503001">return</span>&nbsp;<span class="ident" id="7503008">nil</span><span class="op" id="7503011">,</span>&nbsp;<span class="keyword" id="7503013">func</span><span class="op" id="7503017">(</span><span class="op" id="7503018">)</span>&nbsp;<span class="op" id="7503020">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7503026">t</span><span class="op" id="7503027">.</span><span class="ident" id="7503028">Logf</span><span class="op" id="7503032">(</span><span class="ident" id="7503033">skipmsg</span><span class="op" id="7503040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7503045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7503049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7503053">b</span><span class="op" id="7503054">,</span>&nbsp;<span class="ident" id="7503056">err</span>&nbsp;<span class="op" id="7503060">:=</span>&nbsp;<span class="op" id="7503063">(</span><span class="op" id="7503064">&amp;</span><span class="ident" id="7503065">icmpMessage</span><span class="op" id="7503076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7503081">Type</span><span class="op" id="7503085">:</span>&nbsp;<span class="ident" id="7503087">icmpv4EchoRequest</span><span class="op" id="7503104">,</span>&nbsp;<span class="ident" id="7503106">Code</span><span class="op" id="7503110">:</span>&nbsp;<span class="num" id="7503112">0</span><span class="op" id="7503113">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7503118">Body</span><span class="op" id="7503122">:</span>&nbsp;<span class="op" id="7503124">&amp;</span><span class="ident" id="7503125">icmpEcho</span><span class="op" id="7503133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7503139">ID</span><span class="op" id="7503141">:</span>&nbsp;<span class="ident" id="7503143">os</span><span class="op" id="7503145">.</span><span class="ident" id="7503146">Getpid</span><span class="op" id="7503152">(</span><span class="op" id="7503153">)</span>&nbsp;<span class="op" id="7503155">&amp;</span>&nbsp;<span class="num" id="7503157">0xffff</span><span class="op" id="7503163">,</span>&nbsp;<span class="ident" id="7503165">Seq</span><span class="op" id="7503168">:</span>&nbsp;<span class="ident" id="7503170">i</span>&nbsp;<span class="op" id="7503172">+</span>&nbsp;<span class="num" id="7503174">1</span><span class="op" id="7503175">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7503181">Data</span><span class="op" id="7503185">:</span>&nbsp;<span class="op" id="7503187">[</span><span class="op" id="7503188">]</span><span class="builtintype" id="7503189">byte</span><span class="op" id="7503193">(</span><span class="string" id="7503194">&#34;IP&nbsp;PACKETCONN&nbsp;TEST&#34;</span><span class="op" id="7503214">)</span><span class="op" id="7503215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7503220">}</span><span class="op" id="7503221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7503225">}</span><span class="op" id="7503226">)</span><span class="op" id="7503227">.</span><span class="ident" id="7503228">Marshal</span><span class="op" id="7503235">(</span><span class="op" id="7503236">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7503240">if</span>&nbsp;<span class="ident" id="7503243">err</span>&nbsp;<span class="op" id="7503247">!=</span>&nbsp;<span class="ident" id="7503250">nil</span>&nbsp;<span class="op" id="7503254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7503259">return</span>&nbsp;<span class="ident" id="7503266">nil</span><span class="op" id="7503269">,</span>&nbsp;<span class="keyword" id="7503271">func</span><span class="op" id="7503275">(</span><span class="op" id="7503276">)</span>&nbsp;<span class="op" id="7503278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7503284">t</span><span class="op" id="7503285">.</span><span class="ident" id="7503286">Fatalf</span><span class="op" id="7503292">(</span><span class="string" id="7503293">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7503325">,</span>&nbsp;<span class="ident" id="7503327">err</span><span class="op" id="7503330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7503335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7503339">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7503343">return</span>&nbsp;<span class="ident" id="7503350">b</span><span class="op" id="7503351">,</span>&nbsp;<span class="ident" id="7503353">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7503358">case</span>&nbsp;<span class="string" id="7503363">&#34;unixgram&#34;</span><span class="op" id="7503373">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7503377">switch</span>&nbsp;<span class="ident" id="7503384">runtime</span><span class="op" id="7503391">.</span><span class="ident" id="7503392">GOOS</span>&nbsp;<span class="op" id="7503397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7503401">case</span>&nbsp;<span class="string" id="7503406">&#34;nacl&#34;</span><span class="op" id="7503412">,</span>&nbsp;<span class="string" id="7503414">&#34;plan9&#34;</span><span class="op" id="7503421">,</span>&nbsp;<span class="string" id="7503423">&#34;windows&#34;</span><span class="op" id="7503432">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7503437">return</span>&nbsp;<span class="ident" id="7503444">nil</span><span class="op" id="7503447">,</span>&nbsp;<span class="keyword" id="7503449">func</span><span class="op" id="7503453">(</span><span class="op" id="7503454">)</span>&nbsp;<span class="op" id="7503456">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7503462">t</span><span class="op" id="7503463">.</span><span class="ident" id="7503464">Logf</span><span class="op" id="7503468">(</span><span class="string" id="7503469">&#34;skipping&nbsp;%q&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7503493">,</span>&nbsp;<span class="ident" id="7503495">net</span><span class="op" id="7503498">,</span>&nbsp;<span class="ident" id="7503500">runtime</span><span class="op" id="7503507">.</span><span class="ident" id="7503508">GOOS</span><span class="op" id="7503512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7503517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7503521">default</span><span class="op" id="7503528">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7503533">return</span>&nbsp;<span class="op" id="7503540">[</span><span class="op" id="7503541">]</span><span class="builtintype" id="7503542">byte</span><span class="op" id="7503546">(</span><span class="string" id="7503547">&#34;UNIXGRAM&nbsp;PACKETCONN&nbsp;TEST&#34;</span><span class="op" id="7503573">)</span><span class="op" id="7503574">,</span>&nbsp;<span class="ident" id="7503576">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7503582">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7503585">default</span><span class="op" id="7503592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7503596">return</span>&nbsp;<span class="ident" id="7503603">nil</span><span class="op" id="7503606">,</span>&nbsp;<span class="keyword" id="7503608">func</span><span class="op" id="7503612">(</span><span class="op" id="7503613">)</span>&nbsp;<span class="op" id="7503615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7503620">t</span><span class="op" id="7503621">.</span><span class="ident" id="7503622">Logf</span><span class="op" id="7503626">(</span><span class="string" id="7503627">&#34;skipping&nbsp;%q&nbsp;test&#34;</span><span class="op" id="7503645">,</span>&nbsp;<span class="ident" id="7503647">net</span><span class="op" id="7503650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7503654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7503657">}</span><br>
<span class="lineno">55</span><span class="op" id="7503659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7503662">var</span>&nbsp;<span class="ident" id="7503666">packetConnTests</span>&nbsp;<span class="op" id="7503682">=</span>&nbsp;<span class="op" id="7503684">[</span><span class="op" id="7503685">]</span><span class="keyword" id="7503686">struct</span>&nbsp;<span class="op" id="7503693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7503696">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7503702">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7503710">addr1</span>&nbsp;<span class="builtintype" id="7503716">string</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7503724">addr2</span>&nbsp;<span class="builtintype" id="7503730">string</span><br>
<span class="lineno"></span><span class="op" id="7503737">}</span><span class="op" id="7503738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7503741">{</span><span class="string" id="7503742">&#34;udp&#34;</span><span class="op" id="7503747">,</span>&nbsp;<span class="string" id="7503749">&#34;127.0.0.1:0&#34;</span><span class="op" id="7503762">,</span>&nbsp;<span class="string" id="7503764">&#34;127.0.0.1:0&#34;</span><span class="op" id="7503777">}</span><span class="op" id="7503778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7503781">{</span><span class="string" id="7503782">&#34;ip:icmp&#34;</span><span class="op" id="7503791">,</span>&nbsp;<span class="string" id="7503793">&#34;127.0.0.1&#34;</span><span class="op" id="7503804">,</span>&nbsp;<span class="string" id="7503806">&#34;127.0.0.1&#34;</span><span class="op" id="7503817">}</span><span class="op" id="7503818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7503821">{</span><span class="string" id="7503822">&#34;unixgram&#34;</span><span class="op" id="7503832">,</span>&nbsp;<span class="ident" id="7503834">testUnixAddr</span><span class="op" id="7503846">(</span><span class="op" id="7503847">)</span><span class="op" id="7503848">,</span>&nbsp;<span class="ident" id="7503850">testUnixAddr</span><span class="op" id="7503862">(</span><span class="op" id="7503863">)</span><span class="op" id="7503864">}</span><span class="op" id="7503865">,</span><br>
<span class="lineno">65</span><span class="op" id="7503867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7503870">func</span>&nbsp;<span class="ident" id="7503875">TestPacketConn</span><span class="op" id="7503889">(</span><span class="ident" id="7503890">t</span>&nbsp;<span class="op" id="7503892">*</span><span class="ident" id="7503893">testing</span><span class="op" id="7503900">.</span><span class="ident" id="7503901">T</span><span class="op" id="7503902">)</span>&nbsp;<span class="op" id="7503904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7503907">closer</span>&nbsp;<span class="op" id="7503914">:=</span>&nbsp;<span class="keyword" id="7503917">func</span><span class="op" id="7503921">(</span><span class="ident" id="7503922">c</span>&nbsp;<span class="ident" id="7503924">PacketConn</span><span class="op" id="7503934">,</span>&nbsp;<span class="ident" id="7503936">net</span><span class="op" id="7503939">,</span>&nbsp;<span class="ident" id="7503941">addr1</span><span class="op" id="7503946">,</span>&nbsp;<span class="ident" id="7503948">addr2</span>&nbsp;<span class="builtintype" id="7503954">string</span><span class="op" id="7503960">)</span>&nbsp;<span class="op" id="7503962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7503966">c</span><span class="op" id="7503967">.</span><span class="ident" id="7503968">Close</span><span class="op" id="7503973">(</span><span class="op" id="7503974">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7503978">switch</span>&nbsp;<span class="ident" id="7503985">net</span>&nbsp;<span class="op" id="7503989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7503993">case</span>&nbsp;<span class="string" id="7503998">&#34;unixgram&#34;</span><span class="op" id="7504008">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504013">os</span><span class="op" id="7504015">.</span><span class="ident" id="7504016">Remove</span><span class="op" id="7504022">(</span><span class="ident" id="7504023">addr1</span><span class="op" id="7504028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504033">os</span><span class="op" id="7504035">.</span><span class="ident" id="7504036">Remove</span><span class="op" id="7504042">(</span><span class="ident" id="7504043">addr2</span><span class="op" id="7504048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7504052">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7504055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7504059">for</span>&nbsp;<span class="ident" id="7504063">i</span><span class="op" id="7504064">,</span>&nbsp;<span class="ident" id="7504066">tt</span>&nbsp;<span class="op" id="7504069">:=</span>&nbsp;<span class="keyword" id="7504072">range</span>&nbsp;<span class="ident" id="7504078">packetConnTests</span>&nbsp;<span class="op" id="7504094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504098">netstr</span>&nbsp;<span class="op" id="7504105">:=</span>&nbsp;<span class="ident" id="7504108">strings</span><span class="op" id="7504115">.</span><span class="ident" id="7504116">Split</span><span class="op" id="7504121">(</span><span class="ident" id="7504122">tt</span><span class="op" id="7504124">.</span><span class="ident" id="7504125">net</span><span class="op" id="7504128">,</span>&nbsp;<span class="string" id="7504130">&#34;:&#34;</span><span class="op" id="7504133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504137">wb</span><span class="op" id="7504139">,</span>&nbsp;<span class="ident" id="7504141">skipOrFatalFn</span>&nbsp;<span class="op" id="7504155">:=</span>&nbsp;<span class="ident" id="7504158">packetConnTestData</span><span class="op" id="7504176">(</span><span class="ident" id="7504177">t</span><span class="op" id="7504178">,</span>&nbsp;<span class="ident" id="7504180">netstr</span><span class="op" id="7504186">[</span><span class="num" id="7504187">0</span><span class="op" id="7504188">]</span><span class="op" id="7504189">,</span>&nbsp;<span class="ident" id="7504191">i</span><span class="op" id="7504192">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7504196">if</span>&nbsp;<span class="ident" id="7504199">skipOrFatalFn</span>&nbsp;<span class="op" id="7504213">!=</span>&nbsp;<span class="ident" id="7504216">nil</span>&nbsp;<span class="op" id="7504220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504225">skipOrFatalFn</span><span class="op" id="7504238">(</span><span class="op" id="7504239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7504244">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7504255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504260">c1</span><span class="op" id="7504262">,</span>&nbsp;<span class="ident" id="7504264">err</span>&nbsp;<span class="op" id="7504268">:=</span>&nbsp;<span class="ident" id="7504271">ListenPacket</span><span class="op" id="7504283">(</span><span class="ident" id="7504284">tt</span><span class="op" id="7504286">.</span><span class="ident" id="7504287">net</span><span class="op" id="7504290">,</span>&nbsp;<span class="ident" id="7504292">tt</span><span class="op" id="7504294">.</span><span class="ident" id="7504295">addr1</span><span class="op" id="7504300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7504304">if</span>&nbsp;<span class="ident" id="7504307">err</span>&nbsp;<span class="op" id="7504311">!=</span>&nbsp;<span class="ident" id="7504314">nil</span>&nbsp;<span class="op" id="7504318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504323">t</span><span class="op" id="7504324">.</span><span class="ident" id="7504325">Fatalf</span><span class="op" id="7504331">(</span><span class="string" id="7504332">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7504357">,</span>&nbsp;<span class="ident" id="7504359">err</span><span class="op" id="7504362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7504366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7504370">defer</span>&nbsp;<span class="ident" id="7504376">closer</span><span class="op" id="7504382">(</span><span class="ident" id="7504383">c1</span><span class="op" id="7504385">,</span>&nbsp;<span class="ident" id="7504387">netstr</span><span class="op" id="7504393">[</span><span class="num" id="7504394">0</span><span class="op" id="7504395">]</span><span class="op" id="7504396">,</span>&nbsp;<span class="ident" id="7504398">tt</span><span class="op" id="7504400">.</span><span class="ident" id="7504401">addr1</span><span class="op" id="7504406">,</span>&nbsp;<span class="ident" id="7504408">tt</span><span class="op" id="7504410">.</span><span class="ident" id="7504411">addr2</span><span class="op" id="7504416">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504420">c1</span><span class="op" id="7504422">.</span><span class="ident" id="7504423">LocalAddr</span><span class="op" id="7504432">(</span><span class="op" id="7504433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504437">c1</span><span class="op" id="7504439">.</span><span class="ident" id="7504440">SetDeadline</span><span class="op" id="7504451">(</span><span class="ident" id="7504452">time</span><span class="op" id="7504456">.</span><span class="ident" id="7504457">Now</span><span class="op" id="7504460">(</span><span class="op" id="7504461">)</span><span class="op" id="7504462">.</span><span class="ident" id="7504463">Add</span><span class="op" id="7504466">(</span><span class="num" id="7504467">100</span>&nbsp;<span class="op" id="7504471">*</span>&nbsp;<span class="ident" id="7504473">time</span><span class="op" id="7504477">.</span><span class="ident" id="7504478">Millisecond</span><span class="op" id="7504489">)</span><span class="op" id="7504490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504494">c1</span><span class="op" id="7504496">.</span><span class="ident" id="7504497">SetReadDeadline</span><span class="op" id="7504512">(</span><span class="ident" id="7504513">time</span><span class="op" id="7504517">.</span><span class="ident" id="7504518">Now</span><span class="op" id="7504521">(</span><span class="op" id="7504522">)</span><span class="op" id="7504523">.</span><span class="ident" id="7504524">Add</span><span class="op" id="7504527">(</span><span class="num" id="7504528">100</span>&nbsp;<span class="op" id="7504532">*</span>&nbsp;<span class="ident" id="7504534">time</span><span class="op" id="7504538">.</span><span class="ident" id="7504539">Millisecond</span><span class="op" id="7504550">)</span><span class="op" id="7504551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504555">c1</span><span class="op" id="7504557">.</span><span class="ident" id="7504558">SetWriteDeadline</span><span class="op" id="7504574">(</span><span class="ident" id="7504575">time</span><span class="op" id="7504579">.</span><span class="ident" id="7504580">Now</span><span class="op" id="7504583">(</span><span class="op" id="7504584">)</span><span class="op" id="7504585">.</span><span class="ident" id="7504586">Add</span><span class="op" id="7504589">(</span><span class="num" id="7504590">100</span>&nbsp;<span class="op" id="7504594">*</span>&nbsp;<span class="ident" id="7504596">time</span><span class="op" id="7504600">.</span><span class="ident" id="7504601">Millisecond</span><span class="op" id="7504612">)</span><span class="op" id="7504613">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504618">c2</span><span class="op" id="7504620">,</span>&nbsp;<span class="ident" id="7504622">err</span>&nbsp;<span class="op" id="7504626">:=</span>&nbsp;<span class="ident" id="7504629">ListenPacket</span><span class="op" id="7504641">(</span><span class="ident" id="7504642">tt</span><span class="op" id="7504644">.</span><span class="ident" id="7504645">net</span><span class="op" id="7504648">,</span>&nbsp;<span class="ident" id="7504650">tt</span><span class="op" id="7504652">.</span><span class="ident" id="7504653">addr2</span><span class="op" id="7504658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7504662">if</span>&nbsp;<span class="ident" id="7504665">err</span>&nbsp;<span class="op" id="7504669">!=</span>&nbsp;<span class="ident" id="7504672">nil</span>&nbsp;<span class="op" id="7504676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504681">t</span><span class="op" id="7504682">.</span><span class="ident" id="7504683">Fatalf</span><span class="op" id="7504689">(</span><span class="string" id="7504690">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7504715">,</span>&nbsp;<span class="ident" id="7504717">err</span><span class="op" id="7504720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7504724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7504728">defer</span>&nbsp;<span class="ident" id="7504734">closer</span><span class="op" id="7504740">(</span><span class="ident" id="7504741">c2</span><span class="op" id="7504743">,</span>&nbsp;<span class="ident" id="7504745">netstr</span><span class="op" id="7504751">[</span><span class="num" id="7504752">0</span><span class="op" id="7504753">]</span><span class="op" id="7504754">,</span>&nbsp;<span class="ident" id="7504756">tt</span><span class="op" id="7504758">.</span><span class="ident" id="7504759">addr1</span><span class="op" id="7504764">,</span>&nbsp;<span class="ident" id="7504766">tt</span><span class="op" id="7504768">.</span><span class="ident" id="7504769">addr2</span><span class="op" id="7504774">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504778">c2</span><span class="op" id="7504780">.</span><span class="ident" id="7504781">LocalAddr</span><span class="op" id="7504790">(</span><span class="op" id="7504791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504795">c2</span><span class="op" id="7504797">.</span><span class="ident" id="7504798">SetDeadline</span><span class="op" id="7504809">(</span><span class="ident" id="7504810">time</span><span class="op" id="7504814">.</span><span class="ident" id="7504815">Now</span><span class="op" id="7504818">(</span><span class="op" id="7504819">)</span><span class="op" id="7504820">.</span><span class="ident" id="7504821">Add</span><span class="op" id="7504824">(</span><span class="num" id="7504825">100</span>&nbsp;<span class="op" id="7504829">*</span>&nbsp;<span class="ident" id="7504831">time</span><span class="op" id="7504835">.</span><span class="ident" id="7504836">Millisecond</span><span class="op" id="7504847">)</span><span class="op" id="7504848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504852">c2</span><span class="op" id="7504854">.</span><span class="ident" id="7504855">SetReadDeadline</span><span class="op" id="7504870">(</span><span class="ident" id="7504871">time</span><span class="op" id="7504875">.</span><span class="ident" id="7504876">Now</span><span class="op" id="7504879">(</span><span class="op" id="7504880">)</span><span class="op" id="7504881">.</span><span class="ident" id="7504882">Add</span><span class="op" id="7504885">(</span><span class="num" id="7504886">100</span>&nbsp;<span class="op" id="7504890">*</span>&nbsp;<span class="ident" id="7504892">time</span><span class="op" id="7504896">.</span><span class="ident" id="7504897">Millisecond</span><span class="op" id="7504908">)</span><span class="op" id="7504909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7504913">c2</span><span class="op" id="7504915">.</span><span class="ident" id="7504916">SetWriteDeadline</span><span class="op" id="7504932">(</span><span class="ident" id="7504933">time</span><span class="op" id="7504937">.</span><span class="ident" id="7504938">Now</span><span class="op" id="7504941">(</span><span class="op" id="7504942">)</span><span class="op" id="7504943">.</span><span class="ident" id="7504944">Add</span><span class="op" id="7504947">(</span><span class="num" id="7504948">100</span>&nbsp;<span class="op" id="7504952">*</span>&nbsp;<span class="ident" id="7504954">time</span><span class="op" id="7504958">.</span><span class="ident" id="7504959">Millisecond</span><span class="op" id="7504970">)</span><span class="op" id="7504971">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7504976">if</span>&nbsp;<span class="ident" id="7504979">_</span><span class="op" id="7504980">,</span>&nbsp;<span class="ident" id="7504982">err</span>&nbsp;<span class="op" id="7504986">:=</span>&nbsp;<span class="ident" id="7504989">c1</span><span class="op" id="7504991">.</span><span class="ident" id="7504992">WriteTo</span><span class="op" id="7504999">(</span><span class="ident" id="7505000">wb</span><span class="op" id="7505002">,</span>&nbsp;<span class="ident" id="7505004">c2</span><span class="op" id="7505006">.</span><span class="ident" id="7505007">LocalAddr</span><span class="op" id="7505016">(</span><span class="op" id="7505017">)</span><span class="op" id="7505018">)</span><span class="op" id="7505019">;</span>&nbsp;<span class="ident" id="7505021">err</span>&nbsp;<span class="op" id="7505025">!=</span>&nbsp;<span class="ident" id="7505028">nil</span>&nbsp;<span class="op" id="7505032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505037">t</span><span class="op" id="7505038">.</span><span class="ident" id="7505039">Fatalf</span><span class="op" id="7505045">(</span><span class="string" id="7505046">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7505077">,</span>&nbsp;<span class="ident" id="7505079">err</span><span class="op" id="7505082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505090">rb2</span>&nbsp;<span class="op" id="7505094">:=</span>&nbsp;<span class="builtinfunc" id="7505097">make</span><span class="op" id="7505101">(</span><span class="op" id="7505102">[</span><span class="op" id="7505103">]</span><span class="builtintype" id="7505104">byte</span><span class="op" id="7505108">,</span>&nbsp;<span class="num" id="7505110">128</span><span class="op" id="7505113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7505117">if</span>&nbsp;<span class="ident" id="7505120">_</span><span class="op" id="7505121">,</span>&nbsp;<span class="ident" id="7505123">_</span><span class="op" id="7505124">,</span>&nbsp;<span class="ident" id="7505126">err</span>&nbsp;<span class="op" id="7505130">:=</span>&nbsp;<span class="ident" id="7505133">c2</span><span class="op" id="7505135">.</span><span class="ident" id="7505136">ReadFrom</span><span class="op" id="7505144">(</span><span class="ident" id="7505145">rb2</span><span class="op" id="7505148">)</span><span class="op" id="7505149">;</span>&nbsp;<span class="ident" id="7505151">err</span>&nbsp;<span class="op" id="7505155">!=</span>&nbsp;<span class="ident" id="7505158">nil</span>&nbsp;<span class="op" id="7505162">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505167">t</span><span class="op" id="7505168">.</span><span class="ident" id="7505169">Fatalf</span><span class="op" id="7505175">(</span><span class="string" id="7505176">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7505208">,</span>&nbsp;<span class="ident" id="7505210">err</span><span class="op" id="7505213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7505221">if</span>&nbsp;<span class="ident" id="7505224">_</span><span class="op" id="7505225">,</span>&nbsp;<span class="ident" id="7505227">err</span>&nbsp;<span class="op" id="7505231">:=</span>&nbsp;<span class="ident" id="7505234">c2</span><span class="op" id="7505236">.</span><span class="ident" id="7505237">WriteTo</span><span class="op" id="7505244">(</span><span class="ident" id="7505245">wb</span><span class="op" id="7505247">,</span>&nbsp;<span class="ident" id="7505249">c1</span><span class="op" id="7505251">.</span><span class="ident" id="7505252">LocalAddr</span><span class="op" id="7505261">(</span><span class="op" id="7505262">)</span><span class="op" id="7505263">)</span><span class="op" id="7505264">;</span>&nbsp;<span class="ident" id="7505266">err</span>&nbsp;<span class="op" id="7505270">!=</span>&nbsp;<span class="ident" id="7505273">nil</span>&nbsp;<span class="op" id="7505277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505282">t</span><span class="op" id="7505283">.</span><span class="ident" id="7505284">Fatalf</span><span class="op" id="7505290">(</span><span class="string" id="7505291">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7505322">,</span>&nbsp;<span class="ident" id="7505324">err</span><span class="op" id="7505327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505331">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505335">rb1</span>&nbsp;<span class="op" id="7505339">:=</span>&nbsp;<span class="builtinfunc" id="7505342">make</span><span class="op" id="7505346">(</span><span class="op" id="7505347">[</span><span class="op" id="7505348">]</span><span class="builtintype" id="7505349">byte</span><span class="op" id="7505353">,</span>&nbsp;<span class="num" id="7505355">128</span><span class="op" id="7505358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7505362">if</span>&nbsp;<span class="ident" id="7505365">_</span><span class="op" id="7505366">,</span>&nbsp;<span class="ident" id="7505368">_</span><span class="op" id="7505369">,</span>&nbsp;<span class="ident" id="7505371">err</span>&nbsp;<span class="op" id="7505375">:=</span>&nbsp;<span class="ident" id="7505378">c1</span><span class="op" id="7505380">.</span><span class="ident" id="7505381">ReadFrom</span><span class="op" id="7505389">(</span><span class="ident" id="7505390">rb1</span><span class="op" id="7505393">)</span><span class="op" id="7505394">;</span>&nbsp;<span class="ident" id="7505396">err</span>&nbsp;<span class="op" id="7505400">!=</span>&nbsp;<span class="ident" id="7505403">nil</span>&nbsp;<span class="op" id="7505407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505412">t</span><span class="op" id="7505413">.</span><span class="ident" id="7505414">Fatalf</span><span class="op" id="7505420">(</span><span class="string" id="7505421">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7505453">,</span>&nbsp;<span class="ident" id="7505455">err</span><span class="op" id="7505458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505465">}</span><br>
<span class="lineno">120</span><span class="op" id="7505467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7505470">func</span>&nbsp;<span class="ident" id="7505475">TestConnAndPacketConn</span><span class="op" id="7505496">(</span><span class="ident" id="7505497">t</span>&nbsp;<span class="op" id="7505499">*</span><span class="ident" id="7505500">testing</span><span class="op" id="7505507">.</span><span class="ident" id="7505508">T</span><span class="op" id="7505509">)</span>&nbsp;<span class="op" id="7505511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505514">closer</span>&nbsp;<span class="op" id="7505521">:=</span>&nbsp;<span class="keyword" id="7505524">func</span><span class="op" id="7505528">(</span><span class="ident" id="7505529">c</span>&nbsp;<span class="ident" id="7505531">PacketConn</span><span class="op" id="7505541">,</span>&nbsp;<span class="ident" id="7505543">net</span><span class="op" id="7505546">,</span>&nbsp;<span class="ident" id="7505548">addr1</span><span class="op" id="7505553">,</span>&nbsp;<span class="ident" id="7505555">addr2</span>&nbsp;<span class="builtintype" id="7505561">string</span><span class="op" id="7505567">)</span>&nbsp;<span class="op" id="7505569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505573">c</span><span class="op" id="7505574">.</span><span class="ident" id="7505575">Close</span><span class="op" id="7505580">(</span><span class="op" id="7505581">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7505585">switch</span>&nbsp;<span class="ident" id="7505592">net</span>&nbsp;<span class="op" id="7505596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7505600">case</span>&nbsp;<span class="string" id="7505605">&#34;unixgram&#34;</span><span class="op" id="7505615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505620">os</span><span class="op" id="7505622">.</span><span class="ident" id="7505623">Remove</span><span class="op" id="7505629">(</span><span class="ident" id="7505630">addr1</span><span class="op" id="7505635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505640">os</span><span class="op" id="7505642">.</span><span class="ident" id="7505643">Remove</span><span class="op" id="7505649">(</span><span class="ident" id="7505650">addr2</span><span class="op" id="7505655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505659">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7505666">for</span>&nbsp;<span class="ident" id="7505670">i</span><span class="op" id="7505671">,</span>&nbsp;<span class="ident" id="7505673">tt</span>&nbsp;<span class="op" id="7505676">:=</span>&nbsp;<span class="keyword" id="7505679">range</span>&nbsp;<span class="ident" id="7505685">packetConnTests</span>&nbsp;<span class="op" id="7505701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7505705">var</span>&nbsp;<span class="ident" id="7505709">wb</span>&nbsp;<span class="op" id="7505712">[</span><span class="op" id="7505713">]</span><span class="builtintype" id="7505714">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505721">netstr</span>&nbsp;<span class="op" id="7505728">:=</span>&nbsp;<span class="ident" id="7505731">strings</span><span class="op" id="7505738">.</span><span class="ident" id="7505739">Split</span><span class="op" id="7505744">(</span><span class="ident" id="7505745">tt</span><span class="op" id="7505747">.</span><span class="ident" id="7505748">net</span><span class="op" id="7505751">,</span>&nbsp;<span class="string" id="7505753">&#34;:&#34;</span><span class="op" id="7505756">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505760">wb</span><span class="op" id="7505762">,</span>&nbsp;<span class="ident" id="7505764">skipOrFatalFn</span>&nbsp;<span class="op" id="7505778">:=</span>&nbsp;<span class="ident" id="7505781">packetConnTestData</span><span class="op" id="7505799">(</span><span class="ident" id="7505800">t</span><span class="op" id="7505801">,</span>&nbsp;<span class="ident" id="7505803">netstr</span><span class="op" id="7505809">[</span><span class="num" id="7505810">0</span><span class="op" id="7505811">]</span><span class="op" id="7505812">,</span>&nbsp;<span class="ident" id="7505814">i</span><span class="op" id="7505815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7505819">if</span>&nbsp;<span class="ident" id="7505822">skipOrFatalFn</span>&nbsp;<span class="op" id="7505836">!=</span>&nbsp;<span class="ident" id="7505839">nil</span>&nbsp;<span class="op" id="7505843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505848">skipOrFatalFn</span><span class="op" id="7505861">(</span><span class="op" id="7505862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7505867">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505878">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505883">c1</span><span class="op" id="7505885">,</span>&nbsp;<span class="ident" id="7505887">err</span>&nbsp;<span class="op" id="7505891">:=</span>&nbsp;<span class="ident" id="7505894">ListenPacket</span><span class="op" id="7505906">(</span><span class="ident" id="7505907">tt</span><span class="op" id="7505909">.</span><span class="ident" id="7505910">net</span><span class="op" id="7505913">,</span>&nbsp;<span class="ident" id="7505915">tt</span><span class="op" id="7505917">.</span><span class="ident" id="7505918">addr1</span><span class="op" id="7505923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7505927">if</span>&nbsp;<span class="ident" id="7505930">err</span>&nbsp;<span class="op" id="7505934">!=</span>&nbsp;<span class="ident" id="7505937">nil</span>&nbsp;<span class="op" id="7505941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7505946">t</span><span class="op" id="7505947">.</span><span class="ident" id="7505948">Fatalf</span><span class="op" id="7505954">(</span><span class="string" id="7505955">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7505980">,</span>&nbsp;<span class="ident" id="7505982">err</span><span class="op" id="7505985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7505989">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7505993">defer</span>&nbsp;<span class="ident" id="7505999">closer</span><span class="op" id="7506005">(</span><span class="ident" id="7506006">c1</span><span class="op" id="7506008">,</span>&nbsp;<span class="ident" id="7506010">netstr</span><span class="op" id="7506016">[</span><span class="num" id="7506017">0</span><span class="op" id="7506018">]</span><span class="op" id="7506019">,</span>&nbsp;<span class="ident" id="7506021">tt</span><span class="op" id="7506023">.</span><span class="ident" id="7506024">addr1</span><span class="op" id="7506029">,</span>&nbsp;<span class="ident" id="7506031">tt</span><span class="op" id="7506033">.</span><span class="ident" id="7506034">addr2</span><span class="op" id="7506039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506043">c1</span><span class="op" id="7506045">.</span><span class="ident" id="7506046">LocalAddr</span><span class="op" id="7506055">(</span><span class="op" id="7506056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506060">c1</span><span class="op" id="7506062">.</span><span class="ident" id="7506063">SetDeadline</span><span class="op" id="7506074">(</span><span class="ident" id="7506075">time</span><span class="op" id="7506079">.</span><span class="ident" id="7506080">Now</span><span class="op" id="7506083">(</span><span class="op" id="7506084">)</span><span class="op" id="7506085">.</span><span class="ident" id="7506086">Add</span><span class="op" id="7506089">(</span><span class="num" id="7506090">100</span>&nbsp;<span class="op" id="7506094">*</span>&nbsp;<span class="ident" id="7506096">time</span><span class="op" id="7506100">.</span><span class="ident" id="7506101">Millisecond</span><span class="op" id="7506112">)</span><span class="op" id="7506113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506117">c1</span><span class="op" id="7506119">.</span><span class="ident" id="7506120">SetReadDeadline</span><span class="op" id="7506135">(</span><span class="ident" id="7506136">time</span><span class="op" id="7506140">.</span><span class="ident" id="7506141">Now</span><span class="op" id="7506144">(</span><span class="op" id="7506145">)</span><span class="op" id="7506146">.</span><span class="ident" id="7506147">Add</span><span class="op" id="7506150">(</span><span class="num" id="7506151">100</span>&nbsp;<span class="op" id="7506155">*</span>&nbsp;<span class="ident" id="7506157">time</span><span class="op" id="7506161">.</span><span class="ident" id="7506162">Millisecond</span><span class="op" id="7506173">)</span><span class="op" id="7506174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506178">c1</span><span class="op" id="7506180">.</span><span class="ident" id="7506181">SetWriteDeadline</span><span class="op" id="7506197">(</span><span class="ident" id="7506198">time</span><span class="op" id="7506202">.</span><span class="ident" id="7506203">Now</span><span class="op" id="7506206">(</span><span class="op" id="7506207">)</span><span class="op" id="7506208">.</span><span class="ident" id="7506209">Add</span><span class="op" id="7506212">(</span><span class="num" id="7506213">100</span>&nbsp;<span class="op" id="7506217">*</span>&nbsp;<span class="ident" id="7506219">time</span><span class="op" id="7506223">.</span><span class="ident" id="7506224">Millisecond</span><span class="op" id="7506235">)</span><span class="op" id="7506236">)</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506241">c2</span><span class="op" id="7506243">,</span>&nbsp;<span class="ident" id="7506245">err</span>&nbsp;<span class="op" id="7506249">:=</span>&nbsp;<span class="ident" id="7506252">Dial</span><span class="op" id="7506256">(</span><span class="ident" id="7506257">tt</span><span class="op" id="7506259">.</span><span class="ident" id="7506260">net</span><span class="op" id="7506263">,</span>&nbsp;<span class="ident" id="7506265">c1</span><span class="op" id="7506267">.</span><span class="ident" id="7506268">LocalAddr</span><span class="op" id="7506277">(</span><span class="op" id="7506278">)</span><span class="op" id="7506279">.</span><span class="ident" id="7506280">String</span><span class="op" id="7506286">(</span><span class="op" id="7506287">)</span><span class="op" id="7506288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506292">if</span>&nbsp;<span class="ident" id="7506295">err</span>&nbsp;<span class="op" id="7506299">!=</span>&nbsp;<span class="ident" id="7506302">nil</span>&nbsp;<span class="op" id="7506306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506311">t</span><span class="op" id="7506312">.</span><span class="ident" id="7506313">Fatalf</span><span class="op" id="7506319">(</span><span class="string" id="7506320">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7506337">,</span>&nbsp;<span class="ident" id="7506339">err</span><span class="op" id="7506342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7506346">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506350">defer</span>&nbsp;<span class="ident" id="7506356">c2</span><span class="op" id="7506358">.</span><span class="ident" id="7506359">Close</span><span class="op" id="7506364">(</span><span class="op" id="7506365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506369">c2</span><span class="op" id="7506371">.</span><span class="ident" id="7506372">LocalAddr</span><span class="op" id="7506381">(</span><span class="op" id="7506382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506386">c2</span><span class="op" id="7506388">.</span><span class="ident" id="7506389">RemoteAddr</span><span class="op" id="7506399">(</span><span class="op" id="7506400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506404">c2</span><span class="op" id="7506406">.</span><span class="ident" id="7506407">SetDeadline</span><span class="op" id="7506418">(</span><span class="ident" id="7506419">time</span><span class="op" id="7506423">.</span><span class="ident" id="7506424">Now</span><span class="op" id="7506427">(</span><span class="op" id="7506428">)</span><span class="op" id="7506429">.</span><span class="ident" id="7506430">Add</span><span class="op" id="7506433">(</span><span class="num" id="7506434">100</span>&nbsp;<span class="op" id="7506438">*</span>&nbsp;<span class="ident" id="7506440">time</span><span class="op" id="7506444">.</span><span class="ident" id="7506445">Millisecond</span><span class="op" id="7506456">)</span><span class="op" id="7506457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506461">c2</span><span class="op" id="7506463">.</span><span class="ident" id="7506464">SetReadDeadline</span><span class="op" id="7506479">(</span><span class="ident" id="7506480">time</span><span class="op" id="7506484">.</span><span class="ident" id="7506485">Now</span><span class="op" id="7506488">(</span><span class="op" id="7506489">)</span><span class="op" id="7506490">.</span><span class="ident" id="7506491">Add</span><span class="op" id="7506494">(</span><span class="num" id="7506495">100</span>&nbsp;<span class="op" id="7506499">*</span>&nbsp;<span class="ident" id="7506501">time</span><span class="op" id="7506505">.</span><span class="ident" id="7506506">Millisecond</span><span class="op" id="7506517">)</span><span class="op" id="7506518">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506522">c2</span><span class="op" id="7506524">.</span><span class="ident" id="7506525">SetWriteDeadline</span><span class="op" id="7506541">(</span><span class="ident" id="7506542">time</span><span class="op" id="7506546">.</span><span class="ident" id="7506547">Now</span><span class="op" id="7506550">(</span><span class="op" id="7506551">)</span><span class="op" id="7506552">.</span><span class="ident" id="7506553">Add</span><span class="op" id="7506556">(</span><span class="num" id="7506557">100</span>&nbsp;<span class="op" id="7506561">*</span>&nbsp;<span class="ident" id="7506563">time</span><span class="op" id="7506567">.</span><span class="ident" id="7506568">Millisecond</span><span class="op" id="7506579">)</span><span class="op" id="7506580">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506585">if</span>&nbsp;<span class="ident" id="7506588">_</span><span class="op" id="7506589">,</span>&nbsp;<span class="ident" id="7506591">err</span>&nbsp;<span class="op" id="7506595">:=</span>&nbsp;<span class="ident" id="7506598">c2</span><span class="op" id="7506600">.</span><span class="ident" id="7506601">Write</span><span class="op" id="7506606">(</span><span class="ident" id="7506607">wb</span><span class="op" id="7506609">)</span><span class="op" id="7506610">;</span>&nbsp;<span class="ident" id="7506612">err</span>&nbsp;<span class="op" id="7506616">!=</span>&nbsp;<span class="ident" id="7506619">nil</span>&nbsp;<span class="op" id="7506623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506628">t</span><span class="op" id="7506629">.</span><span class="ident" id="7506630">Fatalf</span><span class="op" id="7506636">(</span><span class="string" id="7506637">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7506660">,</span>&nbsp;<span class="ident" id="7506662">err</span><span class="op" id="7506665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7506669">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506673">rb1</span>&nbsp;<span class="op" id="7506677">:=</span>&nbsp;<span class="builtinfunc" id="7506680">make</span><span class="op" id="7506684">(</span><span class="op" id="7506685">[</span><span class="op" id="7506686">]</span><span class="builtintype" id="7506687">byte</span><span class="op" id="7506691">,</span>&nbsp;<span class="num" id="7506693">128</span><span class="op" id="7506696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506700">if</span>&nbsp;<span class="ident" id="7506703">_</span><span class="op" id="7506704">,</span>&nbsp;<span class="ident" id="7506706">_</span><span class="op" id="7506707">,</span>&nbsp;<span class="ident" id="7506709">err</span>&nbsp;<span class="op" id="7506713">:=</span>&nbsp;<span class="ident" id="7506716">c1</span><span class="op" id="7506718">.</span><span class="ident" id="7506719">ReadFrom</span><span class="op" id="7506727">(</span><span class="ident" id="7506728">rb1</span><span class="op" id="7506731">)</span><span class="op" id="7506732">;</span>&nbsp;<span class="ident" id="7506734">err</span>&nbsp;<span class="op" id="7506738">!=</span>&nbsp;<span class="ident" id="7506741">nil</span>&nbsp;<span class="op" id="7506745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506750">t</span><span class="op" id="7506751">.</span><span class="ident" id="7506752">Fatalf</span><span class="op" id="7506758">(</span><span class="string" id="7506759">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7506791">,</span>&nbsp;<span class="ident" id="7506793">err</span><span class="op" id="7506796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7506800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506804">var</span>&nbsp;<span class="ident" id="7506808">dst</span>&nbsp;<span class="ident" id="7506812">Addr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506819">switch</span>&nbsp;<span class="ident" id="7506826">netstr</span><span class="op" id="7506832">[</span><span class="num" id="7506833">0</span><span class="op" id="7506834">]</span>&nbsp;<span class="op" id="7506836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506840">case</span>&nbsp;<span class="string" id="7506845">&#34;ip&#34;</span><span class="op" id="7506849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506854">dst</span>&nbsp;<span class="op" id="7506858">=</span>&nbsp;<span class="op" id="7506860">&amp;</span><span class="ident" id="7506861">IPAddr</span><span class="op" id="7506867">{</span><span class="ident" id="7506868">IP</span><span class="op" id="7506870">:</span>&nbsp;<span class="ident" id="7506872">IPv4</span><span class="op" id="7506876">(</span><span class="num" id="7506877">127</span><span class="op" id="7506880">,</span>&nbsp;<span class="num" id="7506882">0</span><span class="op" id="7506883">,</span>&nbsp;<span class="num" id="7506885">0</span><span class="op" id="7506886">,</span>&nbsp;<span class="num" id="7506888">1</span><span class="op" id="7506889">)</span><span class="op" id="7506890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506894">case</span>&nbsp;<span class="string" id="7506899">&#34;unixgram&#34;</span><span class="op" id="7506909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506914">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506925">default</span><span class="op" id="7506932">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7506937">dst</span>&nbsp;<span class="op" id="7506941">=</span>&nbsp;<span class="ident" id="7506943">c2</span><span class="op" id="7506945">.</span><span class="ident" id="7506946">LocalAddr</span><span class="op" id="7506955">(</span><span class="op" id="7506956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7506960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7506964">if</span>&nbsp;<span class="ident" id="7506967">_</span><span class="op" id="7506968">,</span>&nbsp;<span class="ident" id="7506970">err</span>&nbsp;<span class="op" id="7506974">:=</span>&nbsp;<span class="ident" id="7506977">c1</span><span class="op" id="7506979">.</span><span class="ident" id="7506980">WriteTo</span><span class="op" id="7506987">(</span><span class="ident" id="7506988">wb</span><span class="op" id="7506990">,</span>&nbsp;<span class="ident" id="7506992">dst</span><span class="op" id="7506995">)</span><span class="op" id="7506996">;</span>&nbsp;<span class="ident" id="7506998">err</span>&nbsp;<span class="op" id="7507002">!=</span>&nbsp;<span class="ident" id="7507005">nil</span>&nbsp;<span class="op" id="7507009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7507014">t</span><span class="op" id="7507015">.</span><span class="ident" id="7507016">Fatalf</span><span class="op" id="7507022">(</span><span class="string" id="7507023">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7507054">,</span>&nbsp;<span class="ident" id="7507056">err</span><span class="op" id="7507059">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7507063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7507067">rb2</span>&nbsp;<span class="op" id="7507071">:=</span>&nbsp;<span class="builtinfunc" id="7507074">make</span><span class="op" id="7507078">(</span><span class="op" id="7507079">[</span><span class="op" id="7507080">]</span><span class="builtintype" id="7507081">byte</span><span class="op" id="7507085">,</span>&nbsp;<span class="num" id="7507087">128</span><span class="op" id="7507090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7507094">if</span>&nbsp;<span class="ident" id="7507097">_</span><span class="op" id="7507098">,</span>&nbsp;<span class="ident" id="7507100">err</span>&nbsp;<span class="op" id="7507104">:=</span>&nbsp;<span class="ident" id="7507107">c2</span><span class="op" id="7507109">.</span><span class="ident" id="7507110">Read</span><span class="op" id="7507114">(</span><span class="ident" id="7507115">rb2</span><span class="op" id="7507118">)</span><span class="op" id="7507119">;</span>&nbsp;<span class="ident" id="7507121">err</span>&nbsp;<span class="op" id="7507125">!=</span>&nbsp;<span class="ident" id="7507128">nil</span>&nbsp;<span class="op" id="7507132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7507137">t</span><span class="op" id="7507138">.</span><span class="ident" id="7507139">Fatalf</span><span class="op" id="7507145">(</span><span class="string" id="7507146">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7507168">,</span>&nbsp;<span class="ident" id="7507170">err</span><span class="op" id="7507173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7507177">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7507180">}</span><br>
<span class="lineno"></span><span class="op" id="7507182">}</span>
</div>
</body>
</html>
