<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3509442">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3509497">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3509551">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3509602">package</span>&nbsp;<span class="ident" id="3509610">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3509616">import</span>&nbsp;<span class="op" id="3509623">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3509626">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3509633">&#34;io&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3509638">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3509641">//&nbsp;fileTransport&nbsp;implements&nbsp;RoundTripper&nbsp;for&nbsp;the&nbsp;&#39;file&#39;&nbsp;protocol.</span><br>
<span class="lineno"></span><span class="keyword" id="3509707">type</span>&nbsp;<span class="ident" id="3509712">fileTransport</span>&nbsp;<span class="keyword" id="3509726">struct</span>&nbsp;<span class="op" id="3509733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3509736">fh</span>&nbsp;<span class="ident" id="3509739">fileHandler</span><br>
<span class="lineno">15</span><span class="op" id="3509751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3509754">//&nbsp;NewFileTransport&nbsp;returns&nbsp;a&nbsp;new&nbsp;RoundTripper,&nbsp;serving&nbsp;the&nbsp;provided</span><br>
<span class="lineno"></span><span class="comment" id="3509823">//&nbsp;FileSystem.&nbsp;The&nbsp;returned&nbsp;RoundTripper&nbsp;ignores&nbsp;the&nbsp;URL&nbsp;host&nbsp;in&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="3509892">//&nbsp;incoming&nbsp;requests,&nbsp;as&nbsp;well&nbsp;as&nbsp;most&nbsp;other&nbsp;properties&nbsp;of&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="3509954">//&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3509966">//</span><br>
<span class="lineno"></span><span class="comment" id="3509969">//&nbsp;The&nbsp;typical&nbsp;use&nbsp;case&nbsp;for&nbsp;NewFileTransport&nbsp;is&nbsp;to&nbsp;register&nbsp;the&nbsp;&#34;file&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3510040">//&nbsp;protocol&nbsp;with&nbsp;a&nbsp;Transport,&nbsp;as&nbsp;in:</span><br>
<span class="lineno"></span><span class="comment" id="3510077">//</span><br>
<span class="lineno">25</span><span class="comment" id="3510080">//&nbsp;&nbsp;&nbsp;t&nbsp;:=&nbsp;&amp;http.Transport{}</span><br>
<span class="lineno"></span><span class="comment" id="3510108">//&nbsp;&nbsp;&nbsp;t.RegisterProtocol(&#34;file&#34;,&nbsp;http.NewFileTransport(http.Dir(&#34;/&#34;)))</span><br>
<span class="lineno"></span><span class="comment" id="3510178">//&nbsp;&nbsp;&nbsp;c&nbsp;:=&nbsp;&amp;http.Client{Transport:&nbsp;t}</span><br>
<span class="lineno"></span><span class="comment" id="3510215">//&nbsp;&nbsp;&nbsp;res,&nbsp;err&nbsp;:=&nbsp;c.Get(&#34;file:///etc/passwd&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3510260">//&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno">30</span><span class="keyword" id="3510269">func</span>&nbsp;<span class="ident" id="3510274">NewFileTransport</span><span class="op" id="3510290">(</span><span class="ident" id="3510291">fs</span>&nbsp;<span class="ident" id="3510294">FileSystem</span><span class="op" id="3510304">)</span>&nbsp;<span class="ident" id="3510306">RoundTripper</span>&nbsp;<span class="op" id="3510319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3510322">return</span>&nbsp;<span class="ident" id="3510329">fileTransport</span><span class="op" id="3510342">{</span><span class="ident" id="3510343">fileHandler</span><span class="op" id="3510354">{</span><span class="ident" id="3510355">fs</span><span class="op" id="3510357">}</span><span class="op" id="3510358">}</span><br>
<span class="lineno"></span><span class="op" id="3510360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3510363">func</span>&nbsp;<span class="op" id="3510368">(</span><span class="ident" id="3510369">t</span>&nbsp;<span class="ident" id="3510371">fileTransport</span><span class="op" id="3510384">)</span>&nbsp;<span class="ident" id="3510386">RoundTrip</span><span class="op" id="3510395">(</span><span class="ident" id="3510396">req</span>&nbsp;<span class="op" id="3510400">*</span><span class="ident" id="3510401">Request</span><span class="op" id="3510408">)</span>&nbsp;<span class="op" id="3510410">(</span><span class="ident" id="3510411">resp</span>&nbsp;<span class="op" id="3510416">*</span><span class="ident" id="3510417">Response</span><span class="op" id="3510425">,</span>&nbsp;<span class="ident" id="3510427">err</span>&nbsp;<span class="builtintype" id="3510431">error</span><span class="op" id="3510436">)</span>&nbsp;<span class="op" id="3510438">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3510441">//&nbsp;We&nbsp;start&nbsp;ServeHTTP&nbsp;in&nbsp;a&nbsp;goroutine,&nbsp;which&nbsp;may&nbsp;take&nbsp;a&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3510502">//&nbsp;time&nbsp;if&nbsp;the&nbsp;file&nbsp;is&nbsp;large.&nbsp;&nbsp;The&nbsp;newPopulateResponseWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3510564">//&nbsp;call&nbsp;returns&nbsp;a&nbsp;channel&nbsp;which&nbsp;either&nbsp;ServeHTTP&nbsp;or&nbsp;finish()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3510626">//&nbsp;sends&nbsp;our&nbsp;*Response&nbsp;on,&nbsp;once&nbsp;the&nbsp;*Response&nbsp;itself&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3510689">//&nbsp;populated&nbsp;(even&nbsp;if&nbsp;the&nbsp;body&nbsp;itself&nbsp;is&nbsp;still&nbsp;being</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3510743">//&nbsp;written&nbsp;to&nbsp;the&nbsp;res.Body,&nbsp;a&nbsp;pipe)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3510780">rw</span><span class="op" id="3510782">,</span>&nbsp;<span class="ident" id="3510784">resc</span>&nbsp;<span class="op" id="3510789">:=</span>&nbsp;<span class="ident" id="3510792">newPopulateResponseWriter</span><span class="op" id="3510817">(</span><span class="op" id="3510818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3510821">go</span>&nbsp;<span class="keyword" id="3510824">func</span><span class="op" id="3510828">(</span><span class="op" id="3510829">)</span>&nbsp;<span class="op" id="3510831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3510835">t</span><span class="op" id="3510836">.</span><span class="ident" id="3510837">fh</span><span class="op" id="3510839">.</span><span class="ident" id="3510840">ServeHTTP</span><span class="op" id="3510849">(</span><span class="ident" id="3510850">rw</span><span class="op" id="3510852">,</span>&nbsp;<span class="ident" id="3510854">req</span><span class="op" id="3510857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3510861">rw</span><span class="op" id="3510863">.</span><span class="ident" id="3510864">finish</span><span class="op" id="3510870">(</span><span class="op" id="3510871">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3510874">}</span><span class="op" id="3510875">(</span><span class="op" id="3510876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3510879">return</span>&nbsp;<span class="op" id="3510886">&lt;-</span><span class="ident" id="3510888">resc</span><span class="op" id="3510892">,</span>&nbsp;<span class="ident" id="3510894">nil</span><br>
<span class="lineno"></span><span class="op" id="3510898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3510901">func</span>&nbsp;<span class="ident" id="3510906">newPopulateResponseWriter</span><span class="op" id="3510931">(</span><span class="op" id="3510932">)</span>&nbsp;<span class="op" id="3510934">(</span><span class="op" id="3510935">*</span><span class="ident" id="3510936">populateResponse</span><span class="op" id="3510952">,</span>&nbsp;<span class="op" id="3510954">&lt;-</span><span class="keyword" id="3510956">chan</span>&nbsp;<span class="op" id="3510961">*</span><span class="ident" id="3510962">Response</span><span class="op" id="3510970">)</span>&nbsp;<span class="op" id="3510972">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3510975">pr</span><span class="op" id="3510977">,</span>&nbsp;<span class="ident" id="3510979">pw</span>&nbsp;<span class="op" id="3510982">:=</span>&nbsp;<span class="ident" id="3510985">io</span><span class="op" id="3510987">.</span><span class="ident" id="3510988">Pipe</span><span class="op" id="3510992">(</span><span class="op" id="3510993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3510996">rw</span>&nbsp;<span class="op" id="3510999">:=</span>&nbsp;<span class="op" id="3511002">&amp;</span><span class="ident" id="3511003">populateResponse</span><span class="op" id="3511019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511023">ch</span><span class="op" id="3511025">:</span>&nbsp;<span class="builtinfunc" id="3511027">make</span><span class="op" id="3511031">(</span><span class="keyword" id="3511032">chan</span>&nbsp;<span class="op" id="3511037">*</span><span class="ident" id="3511038">Response</span><span class="op" id="3511046">)</span><span class="op" id="3511047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511051">pw</span><span class="op" id="3511053">:</span>&nbsp;<span class="ident" id="3511055">pw</span><span class="op" id="3511057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511061">res</span><span class="op" id="3511064">:</span>&nbsp;<span class="op" id="3511066">&amp;</span><span class="ident" id="3511067">Response</span><span class="op" id="3511075">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511080">Proto</span><span class="op" id="3511085">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3511092">&#34;HTTP/1.0&#34;</span><span class="op" id="3511102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511107">ProtoMajor</span><span class="op" id="3511117">:</span>&nbsp;<span class="num" id="3511119">1</span><span class="op" id="3511120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511125">Header</span><span class="op" id="3511131">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3511137">make</span><span class="op" id="3511141">(</span><span class="ident" id="3511142">Header</span><span class="op" id="3511148">)</span><span class="op" id="3511149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511154">Close</span><span class="op" id="3511159">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3511166">true</span><span class="op" id="3511170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511175">Body</span><span class="op" id="3511179">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3511187">pr</span><span class="op" id="3511189">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3511193">}</span><span class="op" id="3511194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3511197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3511200">return</span>&nbsp;<span class="ident" id="3511207">rw</span><span class="op" id="3511209">,</span>&nbsp;<span class="ident" id="3511211">rw</span><span class="op" id="3511213">.</span><span class="ident" id="3511214">ch</span><br>
<span class="lineno"></span><span class="op" id="3511217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3511220">//&nbsp;populateResponse&nbsp;is&nbsp;a&nbsp;ResponseWriter&nbsp;that&nbsp;populates&nbsp;the&nbsp;*Response</span><br>
<span class="lineno"></span><span class="comment" id="3511289">//&nbsp;in&nbsp;res,&nbsp;and&nbsp;writes&nbsp;its&nbsp;body&nbsp;to&nbsp;a&nbsp;pipe&nbsp;connected&nbsp;to&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="comment" id="3511356">//&nbsp;body.&nbsp;Once&nbsp;writes&nbsp;begin&nbsp;or&nbsp;finish()&nbsp;is&nbsp;called,&nbsp;the&nbsp;response&nbsp;is&nbsp;sent</span><br>
<span class="lineno"></span><span class="comment" id="3511427">//&nbsp;on&nbsp;ch.</span><br>
<span class="lineno"></span><span class="keyword" id="3511437">type</span>&nbsp;<span class="ident" id="3511442">populateResponse</span>&nbsp;<span class="keyword" id="3511459">struct</span>&nbsp;<span class="op" id="3511466">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511469">res</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3511482">*</span><span class="ident" id="3511483">Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511493">ch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3511506">chan</span>&nbsp;<span class="op" id="3511511">*</span><span class="ident" id="3511512">Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511522">wroteHeader</span>&nbsp;&nbsp;<span class="builtintype" id="3511535">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511541">hasContent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3511554">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511560">sentResponse</span>&nbsp;<span class="builtintype" id="3511573">bool</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511579">pw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3511592">*</span><span class="ident" id="3511593">io</span><span class="op" id="3511595">.</span><span class="ident" id="3511596">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="3511607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3511610">func</span>&nbsp;<span class="op" id="3511615">(</span><span class="ident" id="3511616">pr</span>&nbsp;<span class="op" id="3511619">*</span><span class="ident" id="3511620">populateResponse</span><span class="op" id="3511636">)</span>&nbsp;<span class="ident" id="3511638">finish</span><span class="op" id="3511644">(</span><span class="op" id="3511645">)</span>&nbsp;<span class="op" id="3511647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3511650">if</span>&nbsp;<span class="op" id="3511653">!</span><span class="ident" id="3511654">pr</span><span class="op" id="3511656">.</span><span class="ident" id="3511657">wroteHeader</span>&nbsp;<span class="op" id="3511669">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511673">pr</span><span class="op" id="3511675">.</span><span class="ident" id="3511676">WriteHeader</span><span class="op" id="3511687">(</span><span class="num" id="3511688">500</span><span class="op" id="3511691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3511694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3511697">if</span>&nbsp;<span class="op" id="3511700">!</span><span class="ident" id="3511701">pr</span><span class="op" id="3511703">.</span><span class="ident" id="3511704">sentResponse</span>&nbsp;<span class="op" id="3511717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511721">pr</span><span class="op" id="3511723">.</span><span class="ident" id="3511724">sendResponse</span><span class="op" id="3511736">(</span><span class="op" id="3511737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3511740">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511743">pr</span><span class="op" id="3511745">.</span><span class="ident" id="3511746">pw</span><span class="op" id="3511748">.</span><span class="ident" id="3511749">Close</span><span class="op" id="3511754">(</span><span class="op" id="3511755">)</span><br>
<span class="lineno"></span><span class="op" id="3511757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3511760">func</span>&nbsp;<span class="op" id="3511765">(</span><span class="ident" id="3511766">pr</span>&nbsp;<span class="op" id="3511769">*</span><span class="ident" id="3511770">populateResponse</span><span class="op" id="3511786">)</span>&nbsp;<span class="ident" id="3511788">sendResponse</span><span class="op" id="3511800">(</span><span class="op" id="3511801">)</span>&nbsp;<span class="op" id="3511803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3511806">if</span>&nbsp;<span class="ident" id="3511809">pr</span><span class="op" id="3511811">.</span><span class="ident" id="3511812">sentResponse</span>&nbsp;<span class="op" id="3511825">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3511829">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3511837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511840">pr</span><span class="op" id="3511842">.</span><span class="ident" id="3511843">sentResponse</span>&nbsp;<span class="op" id="3511856">=</span>&nbsp;<span class="ident" id="3511858">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3511865">if</span>&nbsp;<span class="ident" id="3511868">pr</span><span class="op" id="3511870">.</span><span class="ident" id="3511871">hasContent</span>&nbsp;<span class="op" id="3511882">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511886">pr</span><span class="op" id="3511888">.</span><span class="ident" id="3511889">res</span><span class="op" id="3511892">.</span><span class="ident" id="3511893">ContentLength</span>&nbsp;<span class="op" id="3511907">=</span>&nbsp;<span class="op" id="3511909">-</span><span class="num" id="3511910">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3511913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3511916">pr</span><span class="op" id="3511918">.</span><span class="ident" id="3511919">ch</span>&nbsp;<span class="op" id="3511922">&lt;-</span>&nbsp;<span class="ident" id="3511925">pr</span><span class="op" id="3511927">.</span><span class="ident" id="3511928">res</span><br>
<span class="lineno"></span><span class="op" id="3511932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="3511935">func</span>&nbsp;<span class="op" id="3511940">(</span><span class="ident" id="3511941">pr</span>&nbsp;<span class="op" id="3511944">*</span><span class="ident" id="3511945">populateResponse</span><span class="op" id="3511961">)</span>&nbsp;<span class="ident" id="3511963">Header</span><span class="op" id="3511969">(</span><span class="op" id="3511970">)</span>&nbsp;<span class="ident" id="3511972">Header</span>&nbsp;<span class="op" id="3511979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3511982">return</span>&nbsp;<span class="ident" id="3511989">pr</span><span class="op" id="3511991">.</span><span class="ident" id="3511992">res</span><span class="op" id="3511995">.</span><span class="ident" id="3511996">Header</span><br>
<span class="lineno"></span><span class="op" id="3512003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3512006">func</span>&nbsp;<span class="op" id="3512011">(</span><span class="ident" id="3512012">pr</span>&nbsp;<span class="op" id="3512015">*</span><span class="ident" id="3512016">populateResponse</span><span class="op" id="3512032">)</span>&nbsp;<span class="ident" id="3512034">WriteHeader</span><span class="op" id="3512045">(</span><span class="ident" id="3512046">code</span>&nbsp;<span class="builtintype" id="3512051">int</span><span class="op" id="3512054">)</span>&nbsp;<span class="op" id="3512056">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512059">if</span>&nbsp;<span class="ident" id="3512062">pr</span><span class="op" id="3512064">.</span><span class="ident" id="3512065">wroteHeader</span>&nbsp;<span class="op" id="3512077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512081">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3512089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512092">pr</span><span class="op" id="3512094">.</span><span class="ident" id="3512095">wroteHeader</span>&nbsp;<span class="op" id="3512107">=</span>&nbsp;<span class="ident" id="3512109">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512116">pr</span><span class="op" id="3512118">.</span><span class="ident" id="3512119">res</span><span class="op" id="3512122">.</span><span class="ident" id="3512123">StatusCode</span>&nbsp;<span class="op" id="3512134">=</span>&nbsp;<span class="ident" id="3512136">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512142">pr</span><span class="op" id="3512144">.</span><span class="ident" id="3512145">res</span><span class="op" id="3512148">.</span><span class="ident" id="3512149">Status</span>&nbsp;<span class="op" id="3512156">=</span>&nbsp;<span class="ident" id="3512158">fmt</span><span class="op" id="3512161">.</span><span class="ident" id="3512162">Sprintf</span><span class="op" id="3512169">(</span><span class="string" id="3512170">&#34;%d&nbsp;%s&#34;</span><span class="op" id="3512177">,</span>&nbsp;<span class="ident" id="3512179">code</span><span class="op" id="3512183">,</span>&nbsp;<span class="ident" id="3512185">StatusText</span><span class="op" id="3512195">(</span><span class="ident" id="3512196">code</span><span class="op" id="3512200">)</span><span class="op" id="3512201">)</span><br>
<span class="lineno"></span><span class="op" id="3512203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3512206">func</span>&nbsp;<span class="op" id="3512211">(</span><span class="ident" id="3512212">pr</span>&nbsp;<span class="op" id="3512215">*</span><span class="ident" id="3512216">populateResponse</span><span class="op" id="3512232">)</span>&nbsp;<span class="ident" id="3512234">Write</span><span class="op" id="3512239">(</span><span class="ident" id="3512240">p</span>&nbsp;<span class="op" id="3512242">[</span><span class="op" id="3512243">]</span><span class="builtintype" id="3512244">byte</span><span class="op" id="3512248">)</span>&nbsp;<span class="op" id="3512250">(</span><span class="ident" id="3512251">n</span>&nbsp;<span class="builtintype" id="3512253">int</span><span class="op" id="3512256">,</span>&nbsp;<span class="ident" id="3512258">err</span>&nbsp;<span class="builtintype" id="3512262">error</span><span class="op" id="3512267">)</span>&nbsp;<span class="op" id="3512269">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512272">if</span>&nbsp;<span class="op" id="3512275">!</span><span class="ident" id="3512276">pr</span><span class="op" id="3512278">.</span><span class="ident" id="3512279">wroteHeader</span>&nbsp;<span class="op" id="3512291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512295">pr</span><span class="op" id="3512297">.</span><span class="ident" id="3512298">WriteHeader</span><span class="op" id="3512309">(</span><span class="ident" id="3512310">StatusOK</span><span class="op" id="3512318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3512321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512324">pr</span><span class="op" id="3512326">.</span><span class="ident" id="3512327">hasContent</span>&nbsp;<span class="op" id="3512338">=</span>&nbsp;<span class="ident" id="3512340">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512346">if</span>&nbsp;<span class="op" id="3512349">!</span><span class="ident" id="3512350">pr</span><span class="op" id="3512352">.</span><span class="ident" id="3512353">sentResponse</span>&nbsp;<span class="op" id="3512366">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3512370">pr</span><span class="op" id="3512372">.</span><span class="ident" id="3512373">sendResponse</span><span class="op" id="3512385">(</span><span class="op" id="3512386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3512389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3512392">return</span>&nbsp;<span class="ident" id="3512399">pr</span><span class="op" id="3512401">.</span><span class="ident" id="3512402">pw</span><span class="op" id="3512404">.</span><span class="ident" id="3512405">Write</span><span class="op" id="3512410">(</span><span class="ident" id="3512411">p</span><span class="op" id="3512412">)</span><br>
<span class="lineno"></span><span class="op" id="3512414">}</span>
</div>
</body>
</html>
