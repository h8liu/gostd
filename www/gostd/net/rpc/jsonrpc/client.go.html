<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html" class="current">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5421142">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5421198">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5421252">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5421303">//&nbsp;Package&nbsp;jsonrpc&nbsp;implements&nbsp;a&nbsp;JSON-RPC&nbsp;ClientCodec&nbsp;and&nbsp;ServerCodec</span><br>
<span class="lineno"></span><span class="comment" id="5421372">//&nbsp;for&nbsp;the&nbsp;rpc&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="5421396">package</span>&nbsp;<span class="ident" id="5421404">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5421413">import</span>&nbsp;<span class="op" id="5421420">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5421423">&#34;encoding/json&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5421440">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5421447">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5421453">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5421460">&#34;net/rpc&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5421471">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5421478">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5421481">type</span>&nbsp;<span class="ident" id="5421486">clientCodec</span>&nbsp;<span class="keyword" id="5421498">struct</span>&nbsp;<span class="op" id="5421505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421508">dec</span>&nbsp;<span class="op" id="5421512">*</span><span class="ident" id="5421513">json</span><span class="op" id="5421517">.</span><span class="ident" id="5421518">Decoder</span>&nbsp;<span class="comment" id="5421526">//&nbsp;for&nbsp;reading&nbsp;JSON&nbsp;values</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421554">enc</span>&nbsp;<span class="op" id="5421558">*</span><span class="ident" id="5421559">json</span><span class="op" id="5421563">.</span><span class="ident" id="5421564">Encoder</span>&nbsp;<span class="comment" id="5421572">//&nbsp;for&nbsp;writing&nbsp;JSON&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421600">c</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5421604">io</span><span class="op" id="5421606">.</span><span class="ident" id="5421607">Closer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5421616">//&nbsp;temporary&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421641">req</span>&nbsp;&nbsp;<span class="ident" id="5421646">clientRequest</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421661">resp</span>&nbsp;<span class="ident" id="5421666">clientResponse</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5421683">//&nbsp;JSON-RPC&nbsp;responses&nbsp;include&nbsp;the&nbsp;request&nbsp;id&nbsp;but&nbsp;not&nbsp;the&nbsp;request&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5421757">//&nbsp;Package&nbsp;rpc&nbsp;expects&nbsp;both.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5421787">//&nbsp;We&nbsp;save&nbsp;the&nbsp;request&nbsp;method&nbsp;in&nbsp;pending&nbsp;when&nbsp;sending&nbsp;a&nbsp;request</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5421852">//&nbsp;and&nbsp;then&nbsp;look&nbsp;it&nbsp;up&nbsp;by&nbsp;request&nbsp;ID&nbsp;when&nbsp;filling&nbsp;out&nbsp;the&nbsp;rpc&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421925">mutex</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5421933">sync</span><span class="op" id="5421937">.</span><span class="ident" id="5421938">Mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5421951">//&nbsp;protects&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421972">pending</span>&nbsp;<span class="keyword" id="5421980">map</span><span class="op" id="5421983">[</span><span class="ident" id="5421984">uint64</span><span class="op" id="5421990">]</span><span class="builtintype" id="5421991">string</span>&nbsp;<span class="comment" id="5421998">//&nbsp;map&nbsp;request&nbsp;id&nbsp;to&nbsp;method&nbsp;name</span><br>
<span class="lineno"></span><span class="op" id="5422031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5422034">//&nbsp;NewClientCodec&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.ClientCodec&nbsp;using&nbsp;JSON-RPC&nbsp;on&nbsp;conn.</span><br>
<span class="lineno"></span><span class="keyword" id="5422106">func</span>&nbsp;<span class="ident" id="5422111">NewClientCodec</span><span class="op" id="5422125">(</span><span class="ident" id="5422126">conn</span>&nbsp;<span class="ident" id="5422131">io</span><span class="op" id="5422133">.</span><span class="ident" id="5422134">ReadWriteCloser</span><span class="op" id="5422149">)</span>&nbsp;<span class="ident" id="5422151">rpc</span><span class="op" id="5422154">.</span><span class="ident" id="5422155">ClientCodec</span>&nbsp;<span class="op" id="5422167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5422170">return</span>&nbsp;<span class="op" id="5422177">&amp;</span><span class="ident" id="5422178">clientCodec</span><span class="op" id="5422189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422193">dec</span><span class="op" id="5422196">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422202">json</span><span class="op" id="5422206">.</span><span class="ident" id="5422207">NewDecoder</span><span class="op" id="5422217">(</span><span class="ident" id="5422218">conn</span><span class="op" id="5422222">)</span><span class="op" id="5422223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422227">enc</span><span class="op" id="5422230">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422236">json</span><span class="op" id="5422240">.</span><span class="ident" id="5422241">NewEncoder</span><span class="op" id="5422251">(</span><span class="ident" id="5422252">conn</span><span class="op" id="5422256">)</span><span class="op" id="5422257">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422261">c</span><span class="op" id="5422262">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422270">conn</span><span class="op" id="5422274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422278">pending</span><span class="op" id="5422285">:</span>&nbsp;<span class="builtinfunc" id="5422287">make</span><span class="op" id="5422291">(</span><span class="keyword" id="5422292">map</span><span class="op" id="5422295">[</span><span class="ident" id="5422296">uint64</span><span class="op" id="5422302">]</span><span class="builtintype" id="5422303">string</span><span class="op" id="5422309">)</span><span class="op" id="5422310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5422313">}</span><br>
<span class="lineno"></span><span class="op" id="5422315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="5422318">type</span>&nbsp;<span class="ident" id="5422323">clientRequest</span>&nbsp;<span class="keyword" id="5422337">struct</span>&nbsp;<span class="op" id="5422344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422347">Method</span>&nbsp;<span class="builtintype" id="5422354">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5422369">`json:&#34;method&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422386">Params</span>&nbsp;<span class="op" id="5422393">[</span><span class="num" id="5422394">1</span><span class="op" id="5422395">]</span><span class="keyword" id="5422396">interface</span><span class="op" id="5422405">{</span><span class="op" id="5422406">}</span>&nbsp;<span class="string" id="5422408">`json:&#34;params&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422425">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422432">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5422447">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span><span class="op" id="5422459">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5422462">func</span>&nbsp;<span class="op" id="5422467">(</span><span class="ident" id="5422468">c</span>&nbsp;<span class="op" id="5422470">*</span><span class="ident" id="5422471">clientCodec</span><span class="op" id="5422482">)</span>&nbsp;<span class="ident" id="5422484">WriteRequest</span><span class="op" id="5422496">(</span><span class="ident" id="5422497">r</span>&nbsp;<span class="op" id="5422499">*</span><span class="ident" id="5422500">rpc</span><span class="op" id="5422503">.</span><span class="ident" id="5422504">Request</span><span class="op" id="5422511">,</span>&nbsp;<span class="ident" id="5422513">param</span>&nbsp;<span class="keyword" id="5422519">interface</span><span class="op" id="5422528">{</span><span class="op" id="5422529">}</span><span class="op" id="5422530">)</span>&nbsp;<span class="builtintype" id="5422532">error</span>&nbsp;<span class="op" id="5422538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422541">c</span><span class="op" id="5422542">.</span><span class="ident" id="5422543">mutex</span><span class="op" id="5422548">.</span><span class="ident" id="5422549">Lock</span><span class="op" id="5422553">(</span><span class="op" id="5422554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422557">c</span><span class="op" id="5422558">.</span><span class="ident" id="5422559">pending</span><span class="op" id="5422566">[</span><span class="ident" id="5422567">r</span><span class="op" id="5422568">.</span><span class="ident" id="5422569">Seq</span><span class="op" id="5422572">]</span>&nbsp;<span class="op" id="5422574">=</span>&nbsp;<span class="ident" id="5422576">r</span><span class="op" id="5422577">.</span><span class="ident" id="5422578">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422593">c</span><span class="op" id="5422594">.</span><span class="ident" id="5422595">mutex</span><span class="op" id="5422600">.</span><span class="ident" id="5422601">Unlock</span><span class="op" id="5422607">(</span><span class="op" id="5422608">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422611">c</span><span class="op" id="5422612">.</span><span class="ident" id="5422613">req</span><span class="op" id="5422616">.</span><span class="ident" id="5422617">Method</span>&nbsp;<span class="op" id="5422624">=</span>&nbsp;<span class="ident" id="5422626">r</span><span class="op" id="5422627">.</span><span class="ident" id="5422628">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422643">c</span><span class="op" id="5422644">.</span><span class="ident" id="5422645">req</span><span class="op" id="5422648">.</span><span class="ident" id="5422649">Params</span><span class="op" id="5422655">[</span><span class="num" id="5422656">0</span><span class="op" id="5422657">]</span>&nbsp;<span class="op" id="5422659">=</span>&nbsp;<span class="ident" id="5422661">param</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422668">c</span><span class="op" id="5422669">.</span><span class="ident" id="5422670">req</span><span class="op" id="5422673">.</span><span class="ident" id="5422674">Id</span>&nbsp;<span class="op" id="5422677">=</span>&nbsp;<span class="ident" id="5422679">r</span><span class="op" id="5422680">.</span><span class="ident" id="5422681">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5422686">return</span>&nbsp;<span class="ident" id="5422693">c</span><span class="op" id="5422694">.</span><span class="ident" id="5422695">enc</span><span class="op" id="5422698">.</span><span class="ident" id="5422699">Encode</span><span class="op" id="5422705">(</span><span class="op" id="5422706">&amp;</span><span class="ident" id="5422707">c</span><span class="op" id="5422708">.</span><span class="ident" id="5422709">req</span><span class="op" id="5422712">)</span><br>
<span class="lineno"></span><span class="op" id="5422714">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="5422717">type</span>&nbsp;<span class="ident" id="5422722">clientResponse</span>&nbsp;<span class="keyword" id="5422737">struct</span>&nbsp;<span class="op" id="5422744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422747">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422754">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5422771">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422784">Result</span>&nbsp;<span class="op" id="5422791">*</span><span class="ident" id="5422792">json</span><span class="op" id="5422796">.</span><span class="ident" id="5422797">RawMessage</span>&nbsp;<span class="string" id="5422808">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422825">Error</span>&nbsp;&nbsp;<span class="keyword" id="5422832">interface</span><span class="op" id="5422841">{</span><span class="op" id="5422842">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5422849">`json:&#34;error&#34;`</span><br>
<span class="lineno">65</span><span class="op" id="5422864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5422867">func</span>&nbsp;<span class="op" id="5422872">(</span><span class="ident" id="5422873">r</span>&nbsp;<span class="op" id="5422875">*</span><span class="ident" id="5422876">clientResponse</span><span class="op" id="5422890">)</span>&nbsp;<span class="ident" id="5422892">reset</span><span class="op" id="5422897">(</span><span class="op" id="5422898">)</span>&nbsp;<span class="op" id="5422900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422903">r</span><span class="op" id="5422904">.</span><span class="ident" id="5422905">Id</span>&nbsp;<span class="op" id="5422908">=</span>&nbsp;<span class="num" id="5422910">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422913">r</span><span class="op" id="5422914">.</span><span class="ident" id="5422915">Result</span>&nbsp;<span class="op" id="5422922">=</span>&nbsp;<span class="builtintype" id="5422924">nil</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422929">r</span><span class="op" id="5422930">.</span><span class="ident" id="5422931">Error</span>&nbsp;<span class="op" id="5422937">=</span>&nbsp;<span class="builtintype" id="5422939">nil</span><br>
<span class="lineno"></span><span class="op" id="5422943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5422946">func</span>&nbsp;<span class="op" id="5422951">(</span><span class="ident" id="5422952">c</span>&nbsp;<span class="op" id="5422954">*</span><span class="ident" id="5422955">clientCodec</span><span class="op" id="5422966">)</span>&nbsp;<span class="ident" id="5422968">ReadResponseHeader</span><span class="op" id="5422986">(</span><span class="ident" id="5422987">r</span>&nbsp;<span class="op" id="5422989">*</span><span class="ident" id="5422990">rpc</span><span class="op" id="5422993">.</span><span class="ident" id="5422994">Response</span><span class="op" id="5423002">)</span>&nbsp;<span class="builtintype" id="5423004">error</span>&nbsp;<span class="op" id="5423010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423013">c</span><span class="op" id="5423014">.</span><span class="ident" id="5423015">resp</span><span class="op" id="5423019">.</span><span class="ident" id="5423020">reset</span><span class="op" id="5423025">(</span><span class="op" id="5423026">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423029">if</span>&nbsp;<span class="ident" id="5423032">err</span>&nbsp;<span class="op" id="5423036">:=</span>&nbsp;<span class="ident" id="5423039">c</span><span class="op" id="5423040">.</span><span class="ident" id="5423041">dec</span><span class="op" id="5423044">.</span><span class="ident" id="5423045">Decode</span><span class="op" id="5423051">(</span><span class="op" id="5423052">&amp;</span><span class="ident" id="5423053">c</span><span class="op" id="5423054">.</span><span class="ident" id="5423055">resp</span><span class="op" id="5423059">)</span><span class="op" id="5423060">;</span>&nbsp;<span class="ident" id="5423062">err</span>&nbsp;<span class="op" id="5423066">!=</span>&nbsp;<span class="builtintype" id="5423069">nil</span>&nbsp;<span class="op" id="5423073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423077">return</span>&nbsp;<span class="ident" id="5423084">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5423089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423093">c</span><span class="op" id="5423094">.</span><span class="ident" id="5423095">mutex</span><span class="op" id="5423100">.</span><span class="ident" id="5423101">Lock</span><span class="op" id="5423105">(</span><span class="op" id="5423106">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423109">r</span><span class="op" id="5423110">.</span><span class="ident" id="5423111">ServiceMethod</span>&nbsp;<span class="op" id="5423125">=</span>&nbsp;<span class="ident" id="5423127">c</span><span class="op" id="5423128">.</span><span class="ident" id="5423129">pending</span><span class="op" id="5423136">[</span><span class="ident" id="5423137">c</span><span class="op" id="5423138">.</span><span class="ident" id="5423139">resp</span><span class="op" id="5423143">.</span><span class="ident" id="5423144">Id</span><span class="op" id="5423146">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5423149">delete</span><span class="op" id="5423155">(</span><span class="ident" id="5423156">c</span><span class="op" id="5423157">.</span><span class="ident" id="5423158">pending</span><span class="op" id="5423165">,</span>&nbsp;<span class="ident" id="5423167">c</span><span class="op" id="5423168">.</span><span class="ident" id="5423169">resp</span><span class="op" id="5423173">.</span><span class="ident" id="5423174">Id</span><span class="op" id="5423176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423179">c</span><span class="op" id="5423180">.</span><span class="ident" id="5423181">mutex</span><span class="op" id="5423186">.</span><span class="ident" id="5423187">Unlock</span><span class="op" id="5423193">(</span><span class="op" id="5423194">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423198">r</span><span class="op" id="5423199">.</span><span class="ident" id="5423200">Error</span>&nbsp;<span class="op" id="5423206">=</span>&nbsp;<span class="string" id="5423208">&#34;&#34;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423212">r</span><span class="op" id="5423213">.</span><span class="ident" id="5423214">Seq</span>&nbsp;<span class="op" id="5423218">=</span>&nbsp;<span class="ident" id="5423220">c</span><span class="op" id="5423221">.</span><span class="ident" id="5423222">resp</span><span class="op" id="5423226">.</span><span class="ident" id="5423227">Id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423231">if</span>&nbsp;<span class="ident" id="5423234">c</span><span class="op" id="5423235">.</span><span class="ident" id="5423236">resp</span><span class="op" id="5423240">.</span><span class="ident" id="5423241">Error</span>&nbsp;<span class="op" id="5423247">!=</span>&nbsp;<span class="builtintype" id="5423250">nil</span>&nbsp;<span class="op" id="5423254">||</span>&nbsp;<span class="ident" id="5423257">c</span><span class="op" id="5423258">.</span><span class="ident" id="5423259">resp</span><span class="op" id="5423263">.</span><span class="ident" id="5423264">Result</span>&nbsp;<span class="op" id="5423271">==</span>&nbsp;<span class="builtintype" id="5423274">nil</span>&nbsp;<span class="op" id="5423278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423282">x</span><span class="op" id="5423283">,</span>&nbsp;<span class="ident" id="5423285">ok</span>&nbsp;<span class="op" id="5423288">:=</span>&nbsp;<span class="ident" id="5423291">c</span><span class="op" id="5423292">.</span><span class="ident" id="5423293">resp</span><span class="op" id="5423297">.</span><span class="ident" id="5423298">Error</span><span class="op" id="5423303">.</span><span class="op" id="5423304">(</span><span class="builtintype" id="5423305">string</span><span class="op" id="5423311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423315">if</span>&nbsp;<span class="op" id="5423318">!</span><span class="ident" id="5423319">ok</span>&nbsp;<span class="op" id="5423322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423327">return</span>&nbsp;<span class="ident" id="5423334">fmt</span><span class="op" id="5423337">.</span><span class="ident" id="5423338">Errorf</span><span class="op" id="5423344">(</span><span class="string" id="5423345">&#34;invalid&nbsp;error&nbsp;%v&#34;</span><span class="op" id="5423363">,</span>&nbsp;<span class="ident" id="5423365">c</span><span class="op" id="5423366">.</span><span class="ident" id="5423367">resp</span><span class="op" id="5423371">.</span><span class="ident" id="5423372">Error</span><span class="op" id="5423377">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5423381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423385">if</span>&nbsp;<span class="ident" id="5423388">x</span>&nbsp;<span class="op" id="5423390">==</span>&nbsp;<span class="string" id="5423393">&#34;&#34;</span>&nbsp;<span class="op" id="5423396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423401">x</span>&nbsp;<span class="op" id="5423403">=</span>&nbsp;<span class="string" id="5423405">&#34;unspecified&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5423427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423431">r</span><span class="op" id="5423432">.</span><span class="ident" id="5423433">Error</span>&nbsp;<span class="op" id="5423439">=</span>&nbsp;<span class="ident" id="5423441">x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5423444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423447">return</span>&nbsp;<span class="builtintype" id="5423454">nil</span><br>
<span class="lineno"></span><span class="op" id="5423458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5423461">func</span>&nbsp;<span class="op" id="5423466">(</span><span class="ident" id="5423467">c</span>&nbsp;<span class="op" id="5423469">*</span><span class="ident" id="5423470">clientCodec</span><span class="op" id="5423481">)</span>&nbsp;<span class="ident" id="5423483">ReadResponseBody</span><span class="op" id="5423499">(</span><span class="ident" id="5423500">x</span>&nbsp;<span class="keyword" id="5423502">interface</span><span class="op" id="5423511">{</span><span class="op" id="5423512">}</span><span class="op" id="5423513">)</span>&nbsp;<span class="builtintype" id="5423515">error</span>&nbsp;<span class="op" id="5423521">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423524">if</span>&nbsp;<span class="ident" id="5423527">x</span>&nbsp;<span class="op" id="5423529">==</span>&nbsp;<span class="builtintype" id="5423532">nil</span>&nbsp;<span class="op" id="5423536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423540">return</span>&nbsp;<span class="builtintype" id="5423547">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5423552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423555">return</span>&nbsp;<span class="ident" id="5423562">json</span><span class="op" id="5423566">.</span><span class="ident" id="5423567">Unmarshal</span><span class="op" id="5423576">(</span><span class="op" id="5423577">*</span><span class="ident" id="5423578">c</span><span class="op" id="5423579">.</span><span class="ident" id="5423580">resp</span><span class="op" id="5423584">.</span><span class="ident" id="5423585">Result</span><span class="op" id="5423591">,</span>&nbsp;<span class="ident" id="5423593">x</span><span class="op" id="5423594">)</span><br>
<span class="lineno"></span><span class="op" id="5423596">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5423599">func</span>&nbsp;<span class="op" id="5423604">(</span><span class="ident" id="5423605">c</span>&nbsp;<span class="op" id="5423607">*</span><span class="ident" id="5423608">clientCodec</span><span class="op" id="5423619">)</span>&nbsp;<span class="ident" id="5423621">Close</span><span class="op" id="5423626">(</span><span class="op" id="5423627">)</span>&nbsp;<span class="builtintype" id="5423629">error</span>&nbsp;<span class="op" id="5423635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423638">return</span>&nbsp;<span class="ident" id="5423645">c</span><span class="op" id="5423646">.</span><span class="ident" id="5423647">c</span><span class="op" id="5423648">.</span><span class="ident" id="5423649">Close</span><span class="op" id="5423654">(</span><span class="op" id="5423655">)</span><br>
<span class="lineno"></span><span class="op" id="5423657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5423660">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5423724">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5423779">func</span>&nbsp;<span class="ident" id="5423784">NewClient</span><span class="op" id="5423793">(</span><span class="ident" id="5423794">conn</span>&nbsp;<span class="ident" id="5423799">io</span><span class="op" id="5423801">.</span><span class="ident" id="5423802">ReadWriteCloser</span><span class="op" id="5423817">)</span>&nbsp;<span class="op" id="5423819">*</span><span class="ident" id="5423820">rpc</span><span class="op" id="5423823">.</span><span class="ident" id="5423824">Client</span>&nbsp;<span class="op" id="5423831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423834">return</span>&nbsp;<span class="ident" id="5423841">rpc</span><span class="op" id="5423844">.</span><span class="ident" id="5423845">NewClientWithCodec</span><span class="op" id="5423863">(</span><span class="ident" id="5423864">NewClientCodec</span><span class="op" id="5423878">(</span><span class="ident" id="5423879">conn</span><span class="op" id="5423883">)</span><span class="op" id="5423884">)</span><br>
<span class="lineno"></span><span class="op" id="5423886">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="5423889">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;a&nbsp;JSON-RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5423961">func</span>&nbsp;<span class="ident" id="5423966">Dial</span><span class="op" id="5423970">(</span><span class="ident" id="5423971">network</span><span class="op" id="5423978">,</span>&nbsp;<span class="ident" id="5423980">address</span>&nbsp;<span class="builtintype" id="5423988">string</span><span class="op" id="5423994">)</span>&nbsp;<span class="op" id="5423996">(</span><span class="op" id="5423997">*</span><span class="ident" id="5423998">rpc</span><span class="op" id="5424001">.</span><span class="ident" id="5424002">Client</span><span class="op" id="5424008">,</span>&nbsp;<span class="builtintype" id="5424010">error</span><span class="op" id="5424015">)</span>&nbsp;<span class="op" id="5424017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5424020">conn</span><span class="op" id="5424024">,</span>&nbsp;<span class="ident" id="5424026">err</span>&nbsp;<span class="op" id="5424030">:=</span>&nbsp;<span class="ident" id="5424033">net</span><span class="op" id="5424036">.</span><span class="ident" id="5424037">Dial</span><span class="op" id="5424041">(</span><span class="ident" id="5424042">network</span><span class="op" id="5424049">,</span>&nbsp;<span class="ident" id="5424051">address</span><span class="op" id="5424058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5424061">if</span>&nbsp;<span class="ident" id="5424064">err</span>&nbsp;<span class="op" id="5424068">!=</span>&nbsp;<span class="builtintype" id="5424071">nil</span>&nbsp;<span class="op" id="5424075">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5424079">return</span>&nbsp;<span class="builtintype" id="5424086">nil</span><span class="op" id="5424089">,</span>&nbsp;<span class="ident" id="5424091">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5424096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5424099">return</span>&nbsp;<span class="ident" id="5424106">NewClient</span><span class="op" id="5424115">(</span><span class="ident" id="5424116">conn</span><span class="op" id="5424120">)</span><span class="op" id="5424121">,</span>&nbsp;<span class="ident" id="5424123">err</span><br>
<span class="lineno"></span><span class="op" id="5424127">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
