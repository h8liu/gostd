<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html" class="current">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7586215">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7586270">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7586324">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7586375">package</span>&nbsp;<span class="ident" id="7586383">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7586390">import</span>&nbsp;<span class="op" id="7586397">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7586400">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7586409">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7586425">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7586432">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7586442">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7586445">//&nbsp;equal&nbsp;returns&nbsp;nil&nbsp;if&nbsp;p&nbsp;and&nbsp;q&nbsp;describe&nbsp;the&nbsp;same&nbsp;file&nbsp;set;</span><br>
<span class="lineno">15</span><span class="comment" id="7586505">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;discrepancy.</span><br>
<span class="lineno"></span><span class="keyword" id="7586566">func</span>&nbsp;<span class="ident" id="7586571">equal</span><span class="op" id="7586576">(</span><span class="ident" id="7586577">p</span><span class="op" id="7586578">,</span>&nbsp;<span class="ident" id="7586580">q</span>&nbsp;<span class="op" id="7586582">*</span><span class="ident" id="7586583">FileSet</span><span class="op" id="7586590">)</span>&nbsp;<span class="builtintype" id="7586592">error</span>&nbsp;<span class="op" id="7586598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586601">if</span>&nbsp;<span class="ident" id="7586604">p</span>&nbsp;<span class="op" id="7586606">==</span>&nbsp;<span class="ident" id="7586609">q</span>&nbsp;<span class="op" id="7586611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7586615">//&nbsp;avoid&nbsp;deadlock&nbsp;if&nbsp;p&nbsp;==&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586645">return</span>&nbsp;<span class="ident" id="7586652">nil</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7586657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7586661">//&nbsp;not&nbsp;strictly&nbsp;needed&nbsp;for&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7586698">p</span><span class="op" id="7586699">.</span><span class="ident" id="7586700">mutex</span><span class="op" id="7586705">.</span><span class="ident" id="7586706">Lock</span><span class="op" id="7586710">(</span><span class="op" id="7586711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7586714">q</span><span class="op" id="7586715">.</span><span class="ident" id="7586716">mutex</span><span class="op" id="7586721">.</span><span class="ident" id="7586722">Lock</span><span class="op" id="7586726">(</span><span class="op" id="7586727">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586730">defer</span>&nbsp;<span class="ident" id="7586736">q</span><span class="op" id="7586737">.</span><span class="ident" id="7586738">mutex</span><span class="op" id="7586743">.</span><span class="ident" id="7586744">Unlock</span><span class="op" id="7586750">(</span><span class="op" id="7586751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586754">defer</span>&nbsp;<span class="ident" id="7586760">p</span><span class="op" id="7586761">.</span><span class="ident" id="7586762">mutex</span><span class="op" id="7586767">.</span><span class="ident" id="7586768">Unlock</span><span class="op" id="7586774">(</span><span class="op" id="7586775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586779">if</span>&nbsp;<span class="ident" id="7586782">p</span><span class="op" id="7586783">.</span><span class="ident" id="7586784">base</span>&nbsp;<span class="op" id="7586789">!=</span>&nbsp;<span class="ident" id="7586792">q</span><span class="op" id="7586793">.</span><span class="ident" id="7586794">base</span>&nbsp;<span class="op" id="7586799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586803">return</span>&nbsp;<span class="ident" id="7586810">fmt</span><span class="op" id="7586813">.</span><span class="ident" id="7586814">Errorf</span><span class="op" id="7586820">(</span><span class="string" id="7586821">&#34;different&nbsp;bases:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7586848">,</span>&nbsp;<span class="ident" id="7586850">p</span><span class="op" id="7586851">.</span><span class="ident" id="7586852">base</span><span class="op" id="7586856">,</span>&nbsp;<span class="ident" id="7586858">q</span><span class="op" id="7586859">.</span><span class="ident" id="7586860">base</span><span class="op" id="7586864">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7586867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586871">if</span>&nbsp;<span class="builtinfunc" id="7586874">len</span><span class="op" id="7586877">(</span><span class="ident" id="7586878">p</span><span class="op" id="7586879">.</span><span class="ident" id="7586880">files</span><span class="op" id="7586885">)</span>&nbsp;<span class="op" id="7586887">!=</span>&nbsp;<span class="builtinfunc" id="7586890">len</span><span class="op" id="7586893">(</span><span class="ident" id="7586894">q</span><span class="op" id="7586895">.</span><span class="ident" id="7586896">files</span><span class="op" id="7586901">)</span>&nbsp;<span class="op" id="7586903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586907">return</span>&nbsp;<span class="ident" id="7586914">fmt</span><span class="op" id="7586917">.</span><span class="ident" id="7586918">Errorf</span><span class="op" id="7586924">(</span><span class="string" id="7586925">&#34;different&nbsp;number&nbsp;of&nbsp;files:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7586962">,</span>&nbsp;<span class="builtinfunc" id="7586964">len</span><span class="op" id="7586967">(</span><span class="ident" id="7586968">p</span><span class="op" id="7586969">.</span><span class="ident" id="7586970">files</span><span class="op" id="7586975">)</span><span class="op" id="7586976">,</span>&nbsp;<span class="builtinfunc" id="7586978">len</span><span class="op" id="7586981">(</span><span class="ident" id="7586982">q</span><span class="op" id="7586983">.</span><span class="ident" id="7586984">files</span><span class="op" id="7586989">)</span><span class="op" id="7586990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7586993">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586997">for</span>&nbsp;<span class="ident" id="7587001">i</span><span class="op" id="7587002">,</span>&nbsp;<span class="ident" id="7587004">f</span>&nbsp;<span class="op" id="7587006">:=</span>&nbsp;<span class="keyword" id="7587009">range</span>&nbsp;<span class="ident" id="7587015">p</span><span class="op" id="7587016">.</span><span class="ident" id="7587017">files</span>&nbsp;<span class="op" id="7587023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7587027">g</span>&nbsp;<span class="op" id="7587029">:=</span>&nbsp;<span class="ident" id="7587032">q</span><span class="op" id="7587033">.</span><span class="ident" id="7587034">files</span><span class="op" id="7587039">[</span><span class="ident" id="7587040">i</span><span class="op" id="7587041">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587045">if</span>&nbsp;<span class="ident" id="7587048">f</span><span class="op" id="7587049">.</span><span class="ident" id="7587050">set</span>&nbsp;<span class="op" id="7587054">!=</span>&nbsp;<span class="ident" id="7587057">p</span>&nbsp;<span class="op" id="7587059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587064">return</span>&nbsp;<span class="ident" id="7587071">fmt</span><span class="op" id="7587074">.</span><span class="ident" id="7587075">Errorf</span><span class="op" id="7587081">(</span><span class="string" id="7587082">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7587104">,</span>&nbsp;<span class="ident" id="7587106">f</span><span class="op" id="7587107">.</span><span class="ident" id="7587108">name</span><span class="op" id="7587112">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587120">if</span>&nbsp;<span class="ident" id="7587123">g</span><span class="op" id="7587124">.</span><span class="ident" id="7587125">set</span>&nbsp;<span class="op" id="7587129">!=</span>&nbsp;<span class="ident" id="7587132">q</span>&nbsp;<span class="op" id="7587134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587139">return</span>&nbsp;<span class="ident" id="7587146">fmt</span><span class="op" id="7587149">.</span><span class="ident" id="7587150">Errorf</span><span class="op" id="7587156">(</span><span class="string" id="7587157">&#34;wrong&nbsp;fileset&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7587179">,</span>&nbsp;<span class="ident" id="7587181">g</span><span class="op" id="7587182">.</span><span class="ident" id="7587183">name</span><span class="op" id="7587187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587195">if</span>&nbsp;<span class="ident" id="7587198">f</span><span class="op" id="7587199">.</span><span class="ident" id="7587200">name</span>&nbsp;<span class="op" id="7587205">!=</span>&nbsp;<span class="ident" id="7587208">g</span><span class="op" id="7587209">.</span><span class="ident" id="7587210">name</span>&nbsp;<span class="op" id="7587215">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587220">return</span>&nbsp;<span class="ident" id="7587227">fmt</span><span class="op" id="7587230">.</span><span class="ident" id="7587231">Errorf</span><span class="op" id="7587237">(</span><span class="string" id="7587238">&#34;different&nbsp;filenames:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="7587269">,</span>&nbsp;<span class="ident" id="7587271">f</span><span class="op" id="7587272">.</span><span class="ident" id="7587273">name</span><span class="op" id="7587277">,</span>&nbsp;<span class="ident" id="7587279">g</span><span class="op" id="7587280">.</span><span class="ident" id="7587281">name</span><span class="op" id="7587285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587293">if</span>&nbsp;<span class="ident" id="7587296">f</span><span class="op" id="7587297">.</span><span class="ident" id="7587298">base</span>&nbsp;<span class="op" id="7587303">!=</span>&nbsp;<span class="ident" id="7587306">g</span><span class="op" id="7587307">.</span><span class="ident" id="7587308">base</span>&nbsp;<span class="op" id="7587313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587318">return</span>&nbsp;<span class="ident" id="7587325">fmt</span><span class="op" id="7587328">.</span><span class="ident" id="7587329">Errorf</span><span class="op" id="7587335">(</span><span class="string" id="7587336">&#34;different&nbsp;base&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7587369">,</span>&nbsp;<span class="ident" id="7587371">f</span><span class="op" id="7587372">.</span><span class="ident" id="7587373">name</span><span class="op" id="7587377">,</span>&nbsp;<span class="ident" id="7587379">f</span><span class="op" id="7587380">.</span><span class="ident" id="7587381">base</span><span class="op" id="7587385">,</span>&nbsp;<span class="ident" id="7587387">g</span><span class="op" id="7587388">.</span><span class="ident" id="7587389">base</span><span class="op" id="7587393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587397">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587401">if</span>&nbsp;<span class="ident" id="7587404">f</span><span class="op" id="7587405">.</span><span class="ident" id="7587406">size</span>&nbsp;<span class="op" id="7587411">!=</span>&nbsp;<span class="ident" id="7587414">g</span><span class="op" id="7587415">.</span><span class="ident" id="7587416">size</span>&nbsp;<span class="op" id="7587421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587426">return</span>&nbsp;<span class="ident" id="7587433">fmt</span><span class="op" id="7587436">.</span><span class="ident" id="7587437">Errorf</span><span class="op" id="7587443">(</span><span class="string" id="7587444">&#34;different&nbsp;size&nbsp;for&nbsp;%q:&nbsp;%d&nbsp;!=&nbsp;%d&#34;</span><span class="op" id="7587477">,</span>&nbsp;<span class="ident" id="7587479">f</span><span class="op" id="7587480">.</span><span class="ident" id="7587481">name</span><span class="op" id="7587485">,</span>&nbsp;<span class="ident" id="7587487">f</span><span class="op" id="7587488">.</span><span class="ident" id="7587489">size</span><span class="op" id="7587493">,</span>&nbsp;<span class="ident" id="7587495">g</span><span class="op" id="7587496">.</span><span class="ident" id="7587497">size</span><span class="op" id="7587501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587509">for</span>&nbsp;<span class="ident" id="7587513">j</span><span class="op" id="7587514">,</span>&nbsp;<span class="ident" id="7587516">l</span>&nbsp;<span class="op" id="7587518">:=</span>&nbsp;<span class="keyword" id="7587521">range</span>&nbsp;<span class="ident" id="7587527">f</span><span class="op" id="7587528">.</span><span class="ident" id="7587529">lines</span>&nbsp;<span class="op" id="7587535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7587540">m</span>&nbsp;<span class="op" id="7587542">:=</span>&nbsp;<span class="ident" id="7587545">g</span><span class="op" id="7587546">.</span><span class="ident" id="7587547">lines</span><span class="op" id="7587552">[</span><span class="ident" id="7587553">j</span><span class="op" id="7587554">]</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587559">if</span>&nbsp;<span class="ident" id="7587562">l</span>&nbsp;<span class="op" id="7587564">!=</span>&nbsp;<span class="ident" id="7587567">m</span>&nbsp;<span class="op" id="7587569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587575">return</span>&nbsp;<span class="ident" id="7587582">fmt</span><span class="op" id="7587585">.</span><span class="ident" id="7587586">Errorf</span><span class="op" id="7587592">(</span><span class="string" id="7587593">&#34;different&nbsp;offsets&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7587619">,</span>&nbsp;<span class="ident" id="7587621">f</span><span class="op" id="7587622">.</span><span class="ident" id="7587623">name</span><span class="op" id="7587627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587640">for</span>&nbsp;<span class="ident" id="7587644">j</span><span class="op" id="7587645">,</span>&nbsp;<span class="ident" id="7587647">l</span>&nbsp;<span class="op" id="7587649">:=</span>&nbsp;<span class="keyword" id="7587652">range</span>&nbsp;<span class="ident" id="7587658">f</span><span class="op" id="7587659">.</span><span class="ident" id="7587660">infos</span>&nbsp;<span class="op" id="7587666">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7587671">m</span>&nbsp;<span class="op" id="7587673">:=</span>&nbsp;<span class="ident" id="7587676">g</span><span class="op" id="7587677">.</span><span class="ident" id="7587678">infos</span><span class="op" id="7587683">[</span><span class="ident" id="7587684">j</span><span class="op" id="7587685">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587690">if</span>&nbsp;<span class="ident" id="7587693">l</span><span class="op" id="7587694">.</span><span class="ident" id="7587695">Offset</span>&nbsp;<span class="op" id="7587702">!=</span>&nbsp;<span class="ident" id="7587705">m</span><span class="op" id="7587706">.</span><span class="ident" id="7587707">Offset</span>&nbsp;<span class="op" id="7587714">||</span>&nbsp;<span class="ident" id="7587717">l</span><span class="op" id="7587718">.</span><span class="ident" id="7587719">Filename</span>&nbsp;<span class="op" id="7587728">!=</span>&nbsp;<span class="ident" id="7587731">m</span><span class="op" id="7587732">.</span><span class="ident" id="7587733">Filename</span>&nbsp;<span class="op" id="7587742">||</span>&nbsp;<span class="ident" id="7587745">l</span><span class="op" id="7587746">.</span><span class="ident" id="7587747">Line</span>&nbsp;<span class="op" id="7587752">!=</span>&nbsp;<span class="ident" id="7587755">m</span><span class="op" id="7587756">.</span><span class="ident" id="7587757">Line</span>&nbsp;<span class="op" id="7587762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587768">return</span>&nbsp;<span class="ident" id="7587775">fmt</span><span class="op" id="7587778">.</span><span class="ident" id="7587779">Errorf</span><span class="op" id="7587785">(</span><span class="string" id="7587786">&#34;different&nbsp;infos&nbsp;for&nbsp;%q&#34;</span><span class="op" id="7587810">,</span>&nbsp;<span class="ident" id="7587812">f</span><span class="op" id="7587813">.</span><span class="ident" id="7587814">name</span><span class="op" id="7587818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587827">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7587830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7587834">//&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;about&nbsp;.last&nbsp;-&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587884">return</span>&nbsp;<span class="ident" id="7587891">nil</span><br>
<span class="lineno"></span><span class="op" id="7587895">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="7587898">func</span>&nbsp;<span class="ident" id="7587903">checkSerialize</span><span class="op" id="7587917">(</span><span class="ident" id="7587918">t</span>&nbsp;<span class="op" id="7587920">*</span><span class="ident" id="7587921">testing</span><span class="op" id="7587928">.</span><span class="ident" id="7587929">T</span><span class="op" id="7587930">,</span>&nbsp;<span class="ident" id="7587932">p</span>&nbsp;<span class="op" id="7587934">*</span><span class="ident" id="7587935">FileSet</span><span class="op" id="7587942">)</span>&nbsp;<span class="op" id="7587944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7587947">var</span>&nbsp;<span class="ident" id="7587951">buf</span>&nbsp;<span class="ident" id="7587955">bytes</span><span class="op" id="7587960">.</span><span class="ident" id="7587961">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7587969">encode</span>&nbsp;<span class="op" id="7587976">:=</span>&nbsp;<span class="keyword" id="7587979">func</span><span class="op" id="7587983">(</span><span class="ident" id="7587984">x</span>&nbsp;<span class="keyword" id="7587986">interface</span><span class="op" id="7587995">{</span><span class="op" id="7587996">}</span><span class="op" id="7587997">)</span>&nbsp;<span class="builtintype" id="7587999">error</span>&nbsp;<span class="op" id="7588005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588009">return</span>&nbsp;<span class="ident" id="7588016">gob</span><span class="op" id="7588019">.</span><span class="ident" id="7588020">NewEncoder</span><span class="op" id="7588030">(</span><span class="op" id="7588031">&amp;</span><span class="ident" id="7588032">buf</span><span class="op" id="7588035">)</span><span class="op" id="7588036">.</span><span class="ident" id="7588037">Encode</span><span class="op" id="7588043">(</span><span class="ident" id="7588044">x</span><span class="op" id="7588045">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588051">if</span>&nbsp;<span class="ident" id="7588054">err</span>&nbsp;<span class="op" id="7588058">:=</span>&nbsp;<span class="ident" id="7588061">p</span><span class="op" id="7588062">.</span><span class="ident" id="7588063">Write</span><span class="op" id="7588068">(</span><span class="ident" id="7588069">encode</span><span class="op" id="7588075">)</span><span class="op" id="7588076">;</span>&nbsp;<span class="ident" id="7588078">err</span>&nbsp;<span class="op" id="7588082">!=</span>&nbsp;<span class="ident" id="7588085">nil</span>&nbsp;<span class="op" id="7588089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588093">t</span><span class="op" id="7588094">.</span><span class="ident" id="7588095">Errorf</span><span class="op" id="7588101">(</span><span class="string" id="7588102">&#34;writing&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7588130">,</span>&nbsp;<span class="ident" id="7588132">err</span><span class="op" id="7588135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588139">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588147">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588150">q</span>&nbsp;<span class="op" id="7588152">:=</span>&nbsp;<span class="ident" id="7588155">NewFileSet</span><span class="op" id="7588165">(</span><span class="op" id="7588166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588169">decode</span>&nbsp;<span class="op" id="7588176">:=</span>&nbsp;<span class="keyword" id="7588179">func</span><span class="op" id="7588183">(</span><span class="ident" id="7588184">x</span>&nbsp;<span class="keyword" id="7588186">interface</span><span class="op" id="7588195">{</span><span class="op" id="7588196">}</span><span class="op" id="7588197">)</span>&nbsp;<span class="builtintype" id="7588199">error</span>&nbsp;<span class="op" id="7588205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588209">return</span>&nbsp;<span class="ident" id="7588216">gob</span><span class="op" id="7588219">.</span><span class="ident" id="7588220">NewDecoder</span><span class="op" id="7588230">(</span><span class="op" id="7588231">&amp;</span><span class="ident" id="7588232">buf</span><span class="op" id="7588235">)</span><span class="op" id="7588236">.</span><span class="ident" id="7588237">Decode</span><span class="op" id="7588243">(</span><span class="ident" id="7588244">x</span><span class="op" id="7588245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588251">if</span>&nbsp;<span class="ident" id="7588254">err</span>&nbsp;<span class="op" id="7588258">:=</span>&nbsp;<span class="ident" id="7588261">q</span><span class="op" id="7588262">.</span><span class="ident" id="7588263">Read</span><span class="op" id="7588267">(</span><span class="ident" id="7588268">decode</span><span class="op" id="7588274">)</span><span class="op" id="7588275">;</span>&nbsp;<span class="ident" id="7588277">err</span>&nbsp;<span class="op" id="7588281">!=</span>&nbsp;<span class="ident" id="7588284">nil</span>&nbsp;<span class="op" id="7588288">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588292">t</span><span class="op" id="7588293">.</span><span class="ident" id="7588294">Errorf</span><span class="op" id="7588300">(</span><span class="string" id="7588301">&#34;reading&nbsp;fileset&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="7588329">,</span>&nbsp;<span class="ident" id="7588331">err</span><span class="op" id="7588334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588338">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588349">if</span>&nbsp;<span class="ident" id="7588352">err</span>&nbsp;<span class="op" id="7588356">:=</span>&nbsp;<span class="ident" id="7588359">equal</span><span class="op" id="7588364">(</span><span class="ident" id="7588365">p</span><span class="op" id="7588366">,</span>&nbsp;<span class="ident" id="7588368">q</span><span class="op" id="7588369">)</span><span class="op" id="7588370">;</span>&nbsp;<span class="ident" id="7588372">err</span>&nbsp;<span class="op" id="7588376">!=</span>&nbsp;<span class="ident" id="7588379">nil</span>&nbsp;<span class="op" id="7588383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588387">t</span><span class="op" id="7588388">.</span><span class="ident" id="7588389">Errorf</span><span class="op" id="7588395">(</span><span class="string" id="7588396">&#34;filesets&nbsp;not&nbsp;identical:&nbsp;%s&#34;</span><span class="op" id="7588424">,</span>&nbsp;<span class="ident" id="7588426">err</span><span class="op" id="7588429">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588432">}</span><br>
<span class="lineno"></span><span class="op" id="7588434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7588437">func</span>&nbsp;<span class="ident" id="7588442">TestSerialization</span><span class="op" id="7588459">(</span><span class="ident" id="7588460">t</span>&nbsp;<span class="op" id="7588462">*</span><span class="ident" id="7588463">testing</span><span class="op" id="7588470">.</span><span class="ident" id="7588471">T</span><span class="op" id="7588472">)</span>&nbsp;<span class="op" id="7588474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588477">p</span>&nbsp;<span class="op" id="7588479">:=</span>&nbsp;<span class="ident" id="7588482">NewFileSet</span><span class="op" id="7588492">(</span><span class="op" id="7588493">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588496">checkSerialize</span><span class="op" id="7588510">(</span><span class="ident" id="7588511">t</span><span class="op" id="7588512">,</span>&nbsp;<span class="ident" id="7588514">p</span><span class="op" id="7588515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7588518">//&nbsp;add&nbsp;some&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588537">for</span>&nbsp;<span class="ident" id="7588541">i</span>&nbsp;<span class="op" id="7588543">:=</span>&nbsp;<span class="num" id="7588546">0</span><span class="op" id="7588547">;</span>&nbsp;<span class="ident" id="7588549">i</span>&nbsp;<span class="op" id="7588551">&lt;</span>&nbsp;<span class="num" id="7588553">10</span><span class="op" id="7588555">;</span>&nbsp;<span class="ident" id="7588557">i</span><span class="op" id="7588558">++</span>&nbsp;<span class="op" id="7588561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588565">f</span>&nbsp;<span class="op" id="7588567">:=</span>&nbsp;<span class="ident" id="7588570">p</span><span class="op" id="7588571">.</span><span class="ident" id="7588572">AddFile</span><span class="op" id="7588579">(</span><span class="ident" id="7588580">fmt</span><span class="op" id="7588583">.</span><span class="ident" id="7588584">Sprintf</span><span class="op" id="7588591">(</span><span class="string" id="7588592">&#34;file%d&#34;</span><span class="op" id="7588600">,</span>&nbsp;<span class="ident" id="7588602">i</span><span class="op" id="7588603">)</span><span class="op" id="7588604">,</span>&nbsp;<span class="ident" id="7588606">p</span><span class="op" id="7588607">.</span><span class="ident" id="7588608">Base</span><span class="op" id="7588612">(</span><span class="op" id="7588613">)</span><span class="op" id="7588614">+</span><span class="ident" id="7588615">i</span><span class="op" id="7588616">,</span>&nbsp;<span class="ident" id="7588618">i</span><span class="op" id="7588619">*</span><span class="num" id="7588620">100</span><span class="op" id="7588623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588627">checkSerialize</span><span class="op" id="7588641">(</span><span class="ident" id="7588642">t</span><span class="op" id="7588643">,</span>&nbsp;<span class="ident" id="7588645">p</span><span class="op" id="7588646">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7588650">//&nbsp;add&nbsp;some&nbsp;lines&nbsp;and&nbsp;alternative&nbsp;file&nbsp;infos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588697">line</span>&nbsp;<span class="op" id="7588702">:=</span>&nbsp;<span class="num" id="7588705">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588712">for</span>&nbsp;<span class="ident" id="7588716">offs</span>&nbsp;<span class="op" id="7588721">:=</span>&nbsp;<span class="num" id="7588724">0</span><span class="op" id="7588725">;</span>&nbsp;<span class="ident" id="7588727">offs</span>&nbsp;<span class="op" id="7588732">&lt;</span>&nbsp;<span class="ident" id="7588734">f</span><span class="op" id="7588735">.</span><span class="ident" id="7588736">Size</span><span class="op" id="7588740">(</span><span class="op" id="7588741">)</span><span class="op" id="7588742">;</span>&nbsp;<span class="ident" id="7588744">offs</span>&nbsp;<span class="op" id="7588749">+=</span>&nbsp;<span class="num" id="7588752">40</span>&nbsp;<span class="op" id="7588755">+</span>&nbsp;<span class="ident" id="7588757">i</span>&nbsp;<span class="op" id="7588759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588764">f</span><span class="op" id="7588765">.</span><span class="ident" id="7588766">AddLine</span><span class="op" id="7588773">(</span><span class="ident" id="7588774">offs</span><span class="op" id="7588778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7588783">if</span>&nbsp;<span class="ident" id="7588786">offs</span><span class="op" id="7588790">%</span><span class="num" id="7588791">7</span>&nbsp;<span class="op" id="7588793">==</span>&nbsp;<span class="num" id="7588796">0</span>&nbsp;<span class="op" id="7588798">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588804">f</span><span class="op" id="7588805">.</span><span class="ident" id="7588806">AddLineInfo</span><span class="op" id="7588817">(</span><span class="ident" id="7588818">offs</span><span class="op" id="7588822">,</span>&nbsp;<span class="ident" id="7588824">fmt</span><span class="op" id="7588827">.</span><span class="ident" id="7588828">Sprintf</span><span class="op" id="7588835">(</span><span class="string" id="7588836">&#34;file%d&#34;</span><span class="op" id="7588844">,</span>&nbsp;<span class="ident" id="7588846">offs</span><span class="op" id="7588850">)</span><span class="op" id="7588851">,</span>&nbsp;<span class="ident" id="7588853">line</span><span class="op" id="7588857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588863">line</span>&nbsp;<span class="op" id="7588868">+=</span>&nbsp;<span class="num" id="7588871">33</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7588885">checkSerialize</span><span class="op" id="7588899">(</span><span class="ident" id="7588900">t</span><span class="op" id="7588901">,</span>&nbsp;<span class="ident" id="7588903">p</span><span class="op" id="7588904">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7588907">}</span><br>
<span class="lineno"></span><span class="op" id="7588909">}</span>
</div>
</body>
</html>
