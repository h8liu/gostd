<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html" class="current">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8276346">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8276401">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8276455">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8276506">package</span>&nbsp;<span class="ident" id="8276514">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8276519">import</span>&nbsp;<span class="op" id="8276526">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276529">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276538">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276554">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276573">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276587">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276603">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276619">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276629">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276636">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276642">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276654">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276661">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276667">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276678">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276695">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276706">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8276717">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="8276724">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8276727">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="8276805">type</span>&nbsp;<span class="ident" id="8276810">zeroSource</span>&nbsp;<span class="keyword" id="8276821">struct</span><span class="op" id="8276827">{</span><span class="op" id="8276828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8276831">func</span>&nbsp;<span class="op" id="8276836">(</span><span class="ident" id="8276837">zeroSource</span><span class="op" id="8276847">)</span>&nbsp;<span class="ident" id="8276849">Read</span><span class="op" id="8276853">(</span><span class="ident" id="8276854">b</span>&nbsp;<span class="op" id="8276856">[</span><span class="op" id="8276857">]</span><span class="builtintype" id="8276858">byte</span><span class="op" id="8276862">)</span>&nbsp;<span class="op" id="8276864">(</span><span class="ident" id="8276865">n</span>&nbsp;<span class="builtintype" id="8276867">int</span><span class="op" id="8276870">,</span>&nbsp;<span class="ident" id="8276872">err</span>&nbsp;<span class="builtintype" id="8276876">error</span><span class="op" id="8276881">)</span>&nbsp;<span class="op" id="8276883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276886">for</span>&nbsp;<span class="ident" id="8276890">i</span>&nbsp;<span class="op" id="8276892">:=</span>&nbsp;<span class="keyword" id="8276895">range</span>&nbsp;<span class="ident" id="8276901">b</span>&nbsp;<span class="op" id="8276903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276907">b</span><span class="op" id="8276908">[</span><span class="ident" id="8276909">i</span><span class="op" id="8276910">]</span>&nbsp;<span class="op" id="8276912">=</span>&nbsp;<span class="num" id="8276914">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8276917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8276921">return</span>&nbsp;<span class="builtinfunc" id="8276928">len</span><span class="op" id="8276931">(</span><span class="ident" id="8276932">b</span><span class="op" id="8276933">)</span><span class="op" id="8276934">,</span>&nbsp;<span class="ident" id="8276936">nil</span><br>
<span class="lineno"></span><span class="op" id="8276940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8276943">var</span>&nbsp;<span class="ident" id="8276947">testConfig</span>&nbsp;<span class="op" id="8276958">*</span><span class="ident" id="8276959">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="8276967">func</span>&nbsp;<span class="ident" id="8276972">init</span><span class="op" id="8276976">(</span><span class="op" id="8276977">)</span>&nbsp;<span class="op" id="8276979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8276982">testConfig</span>&nbsp;<span class="op" id="8276993">=</span>&nbsp;<span class="op" id="8276995">&amp;</span><span class="ident" id="8276996">Config</span><span class="op" id="8277002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277006">Time</span><span class="op" id="8277010">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8277026">func</span><span class="op" id="8277030">(</span><span class="op" id="8277031">)</span>&nbsp;<span class="ident" id="8277033">time</span><span class="op" id="8277037">.</span><span class="ident" id="8277038">Time</span>&nbsp;<span class="op" id="8277043">{</span>&nbsp;<span class="keyword" id="8277045">return</span>&nbsp;<span class="ident" id="8277052">time</span><span class="op" id="8277056">.</span><span class="ident" id="8277057">Unix</span><span class="op" id="8277061">(</span><span class="num" id="8277062">0</span><span class="op" id="8277063">,</span>&nbsp;<span class="num" id="8277065">0</span><span class="op" id="8277066">)</span>&nbsp;<span class="op" id="8277068">}</span><span class="op" id="8277069">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277073">Rand</span><span class="op" id="8277077">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8277093">zeroSource</span><span class="op" id="8277103">{</span><span class="op" id="8277104">}</span><span class="op" id="8277105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277109">Certificates</span><span class="op" id="8277121">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8277129">make</span><span class="op" id="8277133">(</span><span class="op" id="8277134">[</span><span class="op" id="8277135">]</span><span class="ident" id="8277136">Certificate</span><span class="op" id="8277147">,</span>&nbsp;<span class="num" id="8277149">2</span><span class="op" id="8277150">)</span><span class="op" id="8277151">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277155">InsecureSkipVerify</span><span class="op" id="8277173">:</span>&nbsp;<span class="builtintype" id="8277175">true</span><span class="op" id="8277179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277183">MinVersion</span><span class="op" id="8277193">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8277203">VersionSSL30</span><span class="op" id="8277215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277219">MaxVersion</span><span class="op" id="8277229">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8277239">VersionTLS12</span><span class="op" id="8277251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8277254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277257">testConfig</span><span class="op" id="8277267">.</span><span class="ident" id="8277268">Certificates</span><span class="op" id="8277280">[</span><span class="num" id="8277281">0</span><span class="op" id="8277282">]</span><span class="op" id="8277283">.</span><span class="ident" id="8277284">Certificate</span>&nbsp;<span class="op" id="8277296">=</span>&nbsp;<span class="op" id="8277298">[</span><span class="op" id="8277299">]</span><span class="op" id="8277300">[</span><span class="op" id="8277301">]</span><span class="builtintype" id="8277302">byte</span><span class="op" id="8277306">{</span><span class="ident" id="8277307">testRSACertificate</span><span class="op" id="8277325">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277328">testConfig</span><span class="op" id="8277338">.</span><span class="ident" id="8277339">Certificates</span><span class="op" id="8277351">[</span><span class="num" id="8277352">0</span><span class="op" id="8277353">]</span><span class="op" id="8277354">.</span><span class="ident" id="8277355">PrivateKey</span>&nbsp;<span class="op" id="8277366">=</span>&nbsp;<span class="ident" id="8277368">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277387">testConfig</span><span class="op" id="8277397">.</span><span class="ident" id="8277398">Certificates</span><span class="op" id="8277410">[</span><span class="num" id="8277411">1</span><span class="op" id="8277412">]</span><span class="op" id="8277413">.</span><span class="ident" id="8277414">Certificate</span>&nbsp;<span class="op" id="8277426">=</span>&nbsp;<span class="op" id="8277428">[</span><span class="op" id="8277429">]</span><span class="op" id="8277430">[</span><span class="op" id="8277431">]</span><span class="builtintype" id="8277432">byte</span><span class="op" id="8277436">{</span><span class="ident" id="8277437">testSNICertificate</span><span class="op" id="8277455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277458">testConfig</span><span class="op" id="8277468">.</span><span class="ident" id="8277469">Certificates</span><span class="op" id="8277481">[</span><span class="num" id="8277482">1</span><span class="op" id="8277483">]</span><span class="op" id="8277484">.</span><span class="ident" id="8277485">PrivateKey</span>&nbsp;<span class="op" id="8277496">=</span>&nbsp;<span class="ident" id="8277498">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277517">testConfig</span><span class="op" id="8277527">.</span><span class="ident" id="8277528">BuildNameToCertificate</span><span class="op" id="8277550">(</span><span class="op" id="8277551">)</span><br>
<span class="lineno"></span><span class="op" id="8277553">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="8277556">func</span>&nbsp;<span class="ident" id="8277561">testClientHelloFailure</span><span class="op" id="8277583">(</span><span class="ident" id="8277584">t</span>&nbsp;<span class="op" id="8277586">*</span><span class="ident" id="8277587">testing</span><span class="op" id="8277594">.</span><span class="ident" id="8277595">T</span><span class="op" id="8277596">,</span>&nbsp;<span class="ident" id="8277598">m</span>&nbsp;<span class="ident" id="8277600">handshakeMessage</span><span class="op" id="8277616">,</span>&nbsp;<span class="ident" id="8277618">expectedSubStr</span>&nbsp;<span class="builtintype" id="8277633">string</span><span class="op" id="8277639">)</span>&nbsp;<span class="op" id="8277641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8277644">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8277685">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8277728">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277748">c</span><span class="op" id="8277749">,</span>&nbsp;<span class="ident" id="8277751">s</span>&nbsp;<span class="op" id="8277753">:=</span>&nbsp;<span class="ident" id="8277756">net</span><span class="op" id="8277759">.</span><span class="ident" id="8277760">Pipe</span><span class="op" id="8277764">(</span><span class="op" id="8277765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8277768">go</span>&nbsp;<span class="keyword" id="8277771">func</span><span class="op" id="8277775">(</span><span class="op" id="8277776">)</span>&nbsp;<span class="op" id="8277778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277782">cli</span>&nbsp;<span class="op" id="8277786">:=</span>&nbsp;<span class="ident" id="8277789">Client</span><span class="op" id="8277795">(</span><span class="ident" id="8277796">c</span><span class="op" id="8277797">,</span>&nbsp;<span class="ident" id="8277799">testConfig</span><span class="op" id="8277809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8277813">if</span>&nbsp;<span class="ident" id="8277816">ch</span><span class="op" id="8277818">,</span>&nbsp;<span class="ident" id="8277820">ok</span>&nbsp;<span class="op" id="8277823">:=</span>&nbsp;<span class="ident" id="8277826">m</span><span class="op" id="8277827">.</span><span class="op" id="8277828">(</span><span class="op" id="8277829">*</span><span class="ident" id="8277830">clientHelloMsg</span><span class="op" id="8277844">)</span><span class="op" id="8277845">;</span>&nbsp;<span class="ident" id="8277847">ok</span>&nbsp;<span class="op" id="8277850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277855">cli</span><span class="op" id="8277858">.</span><span class="ident" id="8277859">vers</span>&nbsp;<span class="op" id="8277864">=</span>&nbsp;<span class="ident" id="8277866">ch</span><span class="op" id="8277868">.</span><span class="ident" id="8277869">vers</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8277876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277880">cli</span><span class="op" id="8277883">.</span><span class="ident" id="8277884">writeRecord</span><span class="op" id="8277895">(</span><span class="ident" id="8277896">recordTypeHandshake</span><span class="op" id="8277915">,</span>&nbsp;<span class="ident" id="8277917">m</span><span class="op" id="8277918">.</span><span class="ident" id="8277919">marshal</span><span class="op" id="8277926">(</span><span class="op" id="8277927">)</span><span class="op" id="8277928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277932">c</span><span class="op" id="8277933">.</span><span class="ident" id="8277934">Close</span><span class="op" id="8277939">(</span><span class="op" id="8277940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8277943">}</span><span class="op" id="8277944">(</span><span class="op" id="8277945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277948">err</span>&nbsp;<span class="op" id="8277952">:=</span>&nbsp;<span class="ident" id="8277955">Server</span><span class="op" id="8277961">(</span><span class="ident" id="8277962">s</span><span class="op" id="8277963">,</span>&nbsp;<span class="ident" id="8277965">testConfig</span><span class="op" id="8277975">)</span><span class="op" id="8277976">.</span><span class="ident" id="8277977">Handshake</span><span class="op" id="8277986">(</span><span class="op" id="8277987">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8277990">s</span><span class="op" id="8277991">.</span><span class="ident" id="8277992">Close</span><span class="op" id="8277997">(</span><span class="op" id="8277998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8278001">if</span>&nbsp;<span class="ident" id="8278004">err</span>&nbsp;<span class="op" id="8278008">==</span>&nbsp;<span class="ident" id="8278011">nil</span>&nbsp;<span class="op" id="8278015">||</span>&nbsp;<span class="op" id="8278018">!</span><span class="ident" id="8278019">strings</span><span class="op" id="8278026">.</span><span class="ident" id="8278027">Contains</span><span class="op" id="8278035">(</span><span class="ident" id="8278036">err</span><span class="op" id="8278039">.</span><span class="ident" id="8278040">Error</span><span class="op" id="8278045">(</span><span class="op" id="8278046">)</span><span class="op" id="8278047">,</span>&nbsp;<span class="ident" id="8278049">expectedSubStr</span><span class="op" id="8278063">)</span>&nbsp;<span class="op" id="8278065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8278069">t</span><span class="op" id="8278070">.</span><span class="ident" id="8278071">Errorf</span><span class="op" id="8278077">(</span><span class="string" id="8278078">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="8278127">,</span>&nbsp;<span class="ident" id="8278129">err</span><span class="op" id="8278132">,</span>&nbsp;<span class="ident" id="8278134">expectedSubStr</span><span class="op" id="8278148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8278151">}</span><br>
<span class="lineno"></span><span class="op" id="8278153">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="8278156">func</span>&nbsp;<span class="ident" id="8278161">TestSimpleError</span><span class="op" id="8278176">(</span><span class="ident" id="8278177">t</span>&nbsp;<span class="op" id="8278179">*</span><span class="ident" id="8278180">testing</span><span class="op" id="8278187">.</span><span class="ident" id="8278188">T</span><span class="op" id="8278189">)</span>&nbsp;<span class="op" id="8278191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8278194">testClientHelloFailure</span><span class="op" id="8278216">(</span><span class="ident" id="8278217">t</span><span class="op" id="8278218">,</span>&nbsp;<span class="op" id="8278220">&amp;</span><span class="ident" id="8278221">serverHelloDoneMsg</span><span class="op" id="8278239">{</span><span class="op" id="8278240">}</span><span class="op" id="8278241">,</span>&nbsp;<span class="string" id="8278243">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="8278273">)</span><br>
<span class="lineno"></span><span class="op" id="8278275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="8278278">var</span>&nbsp;<span class="ident" id="8278282">badProtocolVersions</span>&nbsp;<span class="op" id="8278302">=</span>&nbsp;<span class="op" id="8278304">[</span><span class="op" id="8278305">]</span><span class="builtintype" id="8278306">uint16</span><span class="op" id="8278312">{</span><span class="num" id="8278313">0x0000</span><span class="op" id="8278319">,</span>&nbsp;<span class="num" id="8278321">0x0005</span><span class="op" id="8278327">,</span>&nbsp;<span class="num" id="8278329">0x0100</span><span class="op" id="8278335">,</span>&nbsp;<span class="num" id="8278337">0x0105</span><span class="op" id="8278343">,</span>&nbsp;<span class="num" id="8278345">0x0200</span><span class="op" id="8278351">,</span>&nbsp;<span class="num" id="8278353">0x0205</span><span class="op" id="8278359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8278362">func</span>&nbsp;<span class="ident" id="8278367">TestRejectBadProtocolVersion</span><span class="op" id="8278395">(</span><span class="ident" id="8278396">t</span>&nbsp;<span class="op" id="8278398">*</span><span class="ident" id="8278399">testing</span><span class="op" id="8278406">.</span><span class="ident" id="8278407">T</span><span class="op" id="8278408">)</span>&nbsp;<span class="op" id="8278410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8278413">for</span>&nbsp;<span class="ident" id="8278417">_</span><span class="op" id="8278418">,</span>&nbsp;<span class="ident" id="8278420">v</span>&nbsp;<span class="op" id="8278422">:=</span>&nbsp;<span class="keyword" id="8278425">range</span>&nbsp;<span class="ident" id="8278431">badProtocolVersions</span>&nbsp;<span class="op" id="8278451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8278455">testClientHelloFailure</span><span class="op" id="8278477">(</span><span class="ident" id="8278478">t</span><span class="op" id="8278479">,</span>&nbsp;<span class="op" id="8278481">&amp;</span><span class="ident" id="8278482">clientHelloMsg</span><span class="op" id="8278496">{</span><span class="ident" id="8278497">vers</span><span class="op" id="8278501">:</span>&nbsp;<span class="ident" id="8278503">v</span><span class="op" id="8278504">}</span><span class="op" id="8278505">,</span>&nbsp;<span class="string" id="8278507">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="8278546">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8278549">}</span><br>
<span class="lineno"></span><span class="op" id="8278551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8278554">func</span>&nbsp;<span class="ident" id="8278559">TestNoSuiteOverlap</span><span class="op" id="8278577">(</span><span class="ident" id="8278578">t</span>&nbsp;<span class="op" id="8278580">*</span><span class="ident" id="8278581">testing</span><span class="op" id="8278588">.</span><span class="ident" id="8278589">T</span><span class="op" id="8278590">)</span>&nbsp;<span class="op" id="8278592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8278595">clientHello</span>&nbsp;<span class="op" id="8278607">:=</span>&nbsp;<span class="op" id="8278610">&amp;</span><span class="ident" id="8278611">clientHelloMsg</span><span class="op" id="8278625">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8278629">vers</span><span class="op" id="8278633">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8278649">0x0301</span><span class="op" id="8278655">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8278659">cipherSuites</span><span class="op" id="8278671">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8278679">[</span><span class="op" id="8278680">]</span><span class="builtintype" id="8278681">uint16</span><span class="op" id="8278687">{</span><span class="num" id="8278688">0xff00</span><span class="op" id="8278694">}</span><span class="op" id="8278695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8278699">compressionMethods</span><span class="op" id="8278717">:</span>&nbsp;<span class="op" id="8278719">[</span><span class="op" id="8278720">]</span><span class="builtintype" id="8278721">uint8</span><span class="op" id="8278726">{</span><span class="num" id="8278727">0</span><span class="op" id="8278728">}</span><span class="op" id="8278729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8278732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8278735">testClientHelloFailure</span><span class="op" id="8278757">(</span><span class="ident" id="8278758">t</span><span class="op" id="8278759">,</span>&nbsp;<span class="ident" id="8278761">clientHello</span><span class="op" id="8278772">,</span>&nbsp;<span class="string" id="8278774">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="8278827">)</span><br>
<span class="lineno">95</span><span class="op" id="8278829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8278832">func</span>&nbsp;<span class="ident" id="8278837">TestNoCompressionOverlap</span><span class="op" id="8278861">(</span><span class="ident" id="8278862">t</span>&nbsp;<span class="op" id="8278864">*</span><span class="ident" id="8278865">testing</span><span class="op" id="8278872">.</span><span class="ident" id="8278873">T</span><span class="op" id="8278874">)</span>&nbsp;<span class="op" id="8278876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8278879">clientHello</span>&nbsp;<span class="op" id="8278891">:=</span>&nbsp;<span class="op" id="8278894">&amp;</span><span class="ident" id="8278895">clientHelloMsg</span><span class="op" id="8278909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8278913">vers</span><span class="op" id="8278917">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8278933">0x0301</span><span class="op" id="8278939">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8278943">cipherSuites</span><span class="op" id="8278955">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8278963">[</span><span class="op" id="8278964">]</span><span class="builtintype" id="8278965">uint16</span><span class="op" id="8278971">{</span><span class="ident" id="8278972">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8278996">}</span><span class="op" id="8278997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279001">compressionMethods</span><span class="op" id="8279019">:</span>&nbsp;<span class="op" id="8279021">[</span><span class="op" id="8279022">]</span><span class="builtintype" id="8279023">uint8</span><span class="op" id="8279028">{</span><span class="num" id="8279029">0xff</span><span class="op" id="8279033">}</span><span class="op" id="8279034">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8279037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279040">testClientHelloFailure</span><span class="op" id="8279062">(</span><span class="ident" id="8279063">t</span><span class="op" id="8279064">,</span>&nbsp;<span class="ident" id="8279066">clientHello</span><span class="op" id="8279077">,</span>&nbsp;<span class="string" id="8279079">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="8279129">)</span><br>
<span class="lineno"></span><span class="op" id="8279131">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="8279134">func</span>&nbsp;<span class="ident" id="8279139">TestTLS12OnlyCipherSuites</span><span class="op" id="8279164">(</span><span class="ident" id="8279165">t</span>&nbsp;<span class="op" id="8279167">*</span><span class="ident" id="8279168">testing</span><span class="op" id="8279175">.</span><span class="ident" id="8279176">T</span><span class="op" id="8279177">)</span>&nbsp;<span class="op" id="8279179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8279182">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8279253">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279288">var</span>&nbsp;<span class="ident" id="8279292">zeros</span>&nbsp;<span class="op" id="8279298">[</span><span class="num" id="8279299">32</span><span class="op" id="8279301">]</span><span class="builtintype" id="8279302">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279309">clientHello</span>&nbsp;<span class="op" id="8279321">:=</span>&nbsp;<span class="op" id="8279324">&amp;</span><span class="ident" id="8279325">clientHelloMsg</span><span class="op" id="8279339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279343">vers</span><span class="op" id="8279347">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8279351">VersionTLS11</span><span class="op" id="8279363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279367">random</span><span class="op" id="8279373">:</span>&nbsp;<span class="ident" id="8279375">zeros</span><span class="op" id="8279380">[</span><span class="op" id="8279381">:</span><span class="op" id="8279382">]</span><span class="op" id="8279383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279387">cipherSuites</span><span class="op" id="8279399">:</span>&nbsp;<span class="op" id="8279401">[</span><span class="op" id="8279402">]</span><span class="builtintype" id="8279403">uint16</span><span class="op" id="8279409">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8279414">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8279466">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8279514">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8279566">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279608">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><span class="op" id="8279645">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279650">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8279674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8279678">}</span><span class="op" id="8279679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279683">compressionMethods</span><span class="op" id="8279701">:</span>&nbsp;<span class="op" id="8279703">[</span><span class="op" id="8279704">]</span><span class="builtintype" id="8279705">uint8</span><span class="op" id="8279710">{</span><span class="ident" id="8279711">compressionNone</span><span class="op" id="8279726">}</span><span class="op" id="8279727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279731">supportedCurves</span><span class="op" id="8279746">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8279751">[</span><span class="op" id="8279752">]</span><span class="ident" id="8279753">CurveID</span><span class="op" id="8279760">{</span><span class="ident" id="8279761">CurveP256</span><span class="op" id="8279770">,</span>&nbsp;<span class="ident" id="8279772">CurveP384</span><span class="op" id="8279781">,</span>&nbsp;<span class="ident" id="8279783">CurveP521</span><span class="op" id="8279792">}</span><span class="op" id="8279793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279797">supportedPoints</span><span class="op" id="8279812">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8279817">[</span><span class="op" id="8279818">]</span><span class="builtintype" id="8279819">uint8</span><span class="op" id="8279824">{</span><span class="ident" id="8279825">pointFormatUncompressed</span><span class="op" id="8279848">}</span><span class="op" id="8279849">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8279852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279856">c</span><span class="op" id="8279857">,</span>&nbsp;<span class="ident" id="8279859">s</span>&nbsp;<span class="op" id="8279861">:=</span>&nbsp;<span class="ident" id="8279864">net</span><span class="op" id="8279867">.</span><span class="ident" id="8279868">Pipe</span><span class="op" id="8279872">(</span><span class="op" id="8279873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279876">var</span>&nbsp;<span class="ident" id="8279880">reply</span>&nbsp;<span class="keyword" id="8279886">interface</span><span class="op" id="8279895">{</span><span class="op" id="8279896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279899">var</span>&nbsp;<span class="ident" id="8279903">clientErr</span>&nbsp;<span class="builtintype" id="8279913">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8279920">go</span>&nbsp;<span class="keyword" id="8279923">func</span><span class="op" id="8279927">(</span><span class="op" id="8279928">)</span>&nbsp;<span class="op" id="8279930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279934">cli</span>&nbsp;<span class="op" id="8279938">:=</span>&nbsp;<span class="ident" id="8279941">Client</span><span class="op" id="8279947">(</span><span class="ident" id="8279948">c</span><span class="op" id="8279949">,</span>&nbsp;<span class="ident" id="8279951">testConfig</span><span class="op" id="8279961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279965">cli</span><span class="op" id="8279968">.</span><span class="ident" id="8279969">vers</span>&nbsp;<span class="op" id="8279974">=</span>&nbsp;<span class="ident" id="8279976">clientHello</span><span class="op" id="8279987">.</span><span class="ident" id="8279988">vers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8279995">cli</span><span class="op" id="8279998">.</span><span class="ident" id="8279999">writeRecord</span><span class="op" id="8280010">(</span><span class="ident" id="8280011">recordTypeHandshake</span><span class="op" id="8280030">,</span>&nbsp;<span class="ident" id="8280032">clientHello</span><span class="op" id="8280043">.</span><span class="ident" id="8280044">marshal</span><span class="op" id="8280051">(</span><span class="op" id="8280052">)</span><span class="op" id="8280053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280057">reply</span><span class="op" id="8280062">,</span>&nbsp;<span class="ident" id="8280064">clientErr</span>&nbsp;<span class="op" id="8280074">=</span>&nbsp;<span class="ident" id="8280076">cli</span><span class="op" id="8280079">.</span><span class="ident" id="8280080">readHandshake</span><span class="op" id="8280093">(</span><span class="op" id="8280094">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280098">c</span><span class="op" id="8280099">.</span><span class="ident" id="8280100">Close</span><span class="op" id="8280105">(</span><span class="op" id="8280106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280109">}</span><span class="op" id="8280110">(</span><span class="op" id="8280111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280114">config</span>&nbsp;<span class="op" id="8280121">:=</span>&nbsp;<span class="op" id="8280124">*</span><span class="ident" id="8280125">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280137">config</span><span class="op" id="8280143">.</span><span class="ident" id="8280144">CipherSuites</span>&nbsp;<span class="op" id="8280157">=</span>&nbsp;<span class="ident" id="8280159">clientHello</span><span class="op" id="8280170">.</span><span class="ident" id="8280171">cipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280185">Server</span><span class="op" id="8280191">(</span><span class="ident" id="8280192">s</span><span class="op" id="8280193">,</span>&nbsp;<span class="op" id="8280195">&amp;</span><span class="ident" id="8280196">config</span><span class="op" id="8280202">)</span><span class="op" id="8280203">.</span><span class="ident" id="8280204">Handshake</span><span class="op" id="8280213">(</span><span class="op" id="8280214">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280217">s</span><span class="op" id="8280218">.</span><span class="ident" id="8280219">Close</span><span class="op" id="8280224">(</span><span class="op" id="8280225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280228">if</span>&nbsp;<span class="ident" id="8280231">clientErr</span>&nbsp;<span class="op" id="8280241">!=</span>&nbsp;<span class="ident" id="8280244">nil</span>&nbsp;<span class="op" id="8280248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280252">t</span><span class="op" id="8280253">.</span><span class="ident" id="8280254">Fatal</span><span class="op" id="8280259">(</span><span class="ident" id="8280260">clientErr</span><span class="op" id="8280269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280275">serverHello</span><span class="op" id="8280286">,</span>&nbsp;<span class="ident" id="8280288">ok</span>&nbsp;<span class="op" id="8280291">:=</span>&nbsp;<span class="ident" id="8280294">reply</span><span class="op" id="8280299">.</span><span class="op" id="8280300">(</span><span class="op" id="8280301">*</span><span class="ident" id="8280302">serverHelloMsg</span><span class="op" id="8280316">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280319">if</span>&nbsp;<span class="op" id="8280322">!</span><span class="ident" id="8280323">ok</span>&nbsp;<span class="op" id="8280326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280330">t</span><span class="op" id="8280331">.</span><span class="ident" id="8280332">Fatalf</span><span class="op" id="8280338">(</span><span class="string" id="8280339">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="8280390">,</span>&nbsp;<span class="ident" id="8280392">reply</span><span class="op" id="8280397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280403">if</span>&nbsp;<span class="ident" id="8280406">s</span>&nbsp;<span class="op" id="8280408">:=</span>&nbsp;<span class="ident" id="8280411">serverHello</span><span class="op" id="8280422">.</span><span class="ident" id="8280423">cipherSuite</span><span class="op" id="8280434">;</span>&nbsp;<span class="ident" id="8280436">s</span>&nbsp;<span class="op" id="8280438">!=</span>&nbsp;<span class="ident" id="8280441">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="8280466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280470">t</span><span class="op" id="8280471">.</span><span class="ident" id="8280472">Fatalf</span><span class="op" id="8280478">(</span><span class="string" id="8280479">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="8280513">,</span>&nbsp;<span class="ident" id="8280515">s</span><span class="op" id="8280516">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280519">}</span><br>
<span class="lineno"></span><span class="op" id="8280521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8280524">func</span>&nbsp;<span class="ident" id="8280529">TestAlertForwarding</span><span class="op" id="8280548">(</span><span class="ident" id="8280549">t</span>&nbsp;<span class="op" id="8280551">*</span><span class="ident" id="8280552">testing</span><span class="op" id="8280559">.</span><span class="ident" id="8280560">T</span><span class="op" id="8280561">)</span>&nbsp;<span class="op" id="8280563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280566">c</span><span class="op" id="8280567">,</span>&nbsp;<span class="ident" id="8280569">s</span>&nbsp;<span class="op" id="8280571">:=</span>&nbsp;<span class="ident" id="8280574">net</span><span class="op" id="8280577">.</span><span class="ident" id="8280578">Pipe</span><span class="op" id="8280582">(</span><span class="op" id="8280583">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280586">go</span>&nbsp;<span class="keyword" id="8280589">func</span><span class="op" id="8280593">(</span><span class="op" id="8280594">)</span>&nbsp;<span class="op" id="8280596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280600">Client</span><span class="op" id="8280606">(</span><span class="ident" id="8280607">c</span><span class="op" id="8280608">,</span>&nbsp;<span class="ident" id="8280610">testConfig</span><span class="op" id="8280620">)</span><span class="op" id="8280621">.</span><span class="ident" id="8280622">sendAlert</span><span class="op" id="8280631">(</span><span class="ident" id="8280632">alertUnknownCA</span><span class="op" id="8280646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280650">c</span><span class="op" id="8280651">.</span><span class="ident" id="8280652">Close</span><span class="op" id="8280657">(</span><span class="op" id="8280658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280661">}</span><span class="op" id="8280662">(</span><span class="op" id="8280663">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280667">err</span>&nbsp;<span class="op" id="8280671">:=</span>&nbsp;<span class="ident" id="8280674">Server</span><span class="op" id="8280680">(</span><span class="ident" id="8280681">s</span><span class="op" id="8280682">,</span>&nbsp;<span class="ident" id="8280684">testConfig</span><span class="op" id="8280694">)</span><span class="op" id="8280695">.</span><span class="ident" id="8280696">Handshake</span><span class="op" id="8280705">(</span><span class="op" id="8280706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280709">s</span><span class="op" id="8280710">.</span><span class="ident" id="8280711">Close</span><span class="op" id="8280716">(</span><span class="op" id="8280717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280720">if</span>&nbsp;<span class="ident" id="8280723">e</span><span class="op" id="8280724">,</span>&nbsp;<span class="ident" id="8280726">ok</span>&nbsp;<span class="op" id="8280729">:=</span>&nbsp;<span class="ident" id="8280732">err</span><span class="op" id="8280735">.</span><span class="op" id="8280736">(</span><span class="op" id="8280737">*</span><span class="ident" id="8280738">net</span><span class="op" id="8280741">.</span><span class="ident" id="8280742">OpError</span><span class="op" id="8280749">)</span><span class="op" id="8280750">;</span>&nbsp;<span class="op" id="8280752">!</span><span class="ident" id="8280753">ok</span>&nbsp;<span class="op" id="8280756">||</span>&nbsp;<span class="ident" id="8280759">e</span><span class="op" id="8280760">.</span><span class="ident" id="8280761">Err</span>&nbsp;<span class="op" id="8280765">!=</span>&nbsp;<span class="builtintype" id="8280768">error</span><span class="op" id="8280773">(</span><span class="ident" id="8280774">alertUnknownCA</span><span class="op" id="8280788">)</span>&nbsp;<span class="op" id="8280790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280794">t</span><span class="op" id="8280795">.</span><span class="ident" id="8280796">Errorf</span><span class="op" id="8280802">(</span><span class="string" id="8280803">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="8280832">,</span>&nbsp;<span class="ident" id="8280834">err</span><span class="op" id="8280837">,</span>&nbsp;<span class="builtintype" id="8280839">error</span><span class="op" id="8280844">(</span><span class="ident" id="8280845">alertUnknownCA</span><span class="op" id="8280859">)</span><span class="op" id="8280860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8280863">}</span><br>
<span class="lineno">165</span><span class="op" id="8280865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8280868">func</span>&nbsp;<span class="ident" id="8280873">TestClose</span><span class="op" id="8280882">(</span><span class="ident" id="8280883">t</span>&nbsp;<span class="op" id="8280885">*</span><span class="ident" id="8280886">testing</span><span class="op" id="8280893">.</span><span class="ident" id="8280894">T</span><span class="op" id="8280895">)</span>&nbsp;<span class="op" id="8280897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280900">c</span><span class="op" id="8280901">,</span>&nbsp;<span class="ident" id="8280903">s</span>&nbsp;<span class="op" id="8280905">:=</span>&nbsp;<span class="ident" id="8280908">net</span><span class="op" id="8280911">.</span><span class="ident" id="8280912">Pipe</span><span class="op" id="8280916">(</span><span class="op" id="8280917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280920">go</span>&nbsp;<span class="ident" id="8280923">c</span><span class="op" id="8280924">.</span><span class="ident" id="8280925">Close</span><span class="op" id="8280930">(</span><span class="op" id="8280931">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280935">err</span>&nbsp;<span class="op" id="8280939">:=</span>&nbsp;<span class="ident" id="8280942">Server</span><span class="op" id="8280948">(</span><span class="ident" id="8280949">s</span><span class="op" id="8280950">,</span>&nbsp;<span class="ident" id="8280952">testConfig</span><span class="op" id="8280962">)</span><span class="op" id="8280963">.</span><span class="ident" id="8280964">Handshake</span><span class="op" id="8280973">(</span><span class="op" id="8280974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8280977">s</span><span class="op" id="8280978">.</span><span class="ident" id="8280979">Close</span><span class="op" id="8280984">(</span><span class="op" id="8280985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8280988">if</span>&nbsp;<span class="ident" id="8280991">err</span>&nbsp;<span class="op" id="8280995">!=</span>&nbsp;<span class="ident" id="8280998">io</span><span class="op" id="8281000">.</span><span class="ident" id="8281001">EOF</span>&nbsp;<span class="op" id="8281005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281009">t</span><span class="op" id="8281010">.</span><span class="ident" id="8281011">Errorf</span><span class="op" id="8281017">(</span><span class="string" id="8281018">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="8281047">,</span>&nbsp;<span class="ident" id="8281049">err</span><span class="op" id="8281052">,</span>&nbsp;<span class="ident" id="8281054">io</span><span class="op" id="8281056">.</span><span class="ident" id="8281057">EOF</span><span class="op" id="8281060">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281063">}</span><br>
<span class="lineno"></span><span class="op" id="8281065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8281068">func</span>&nbsp;<span class="ident" id="8281073">testHandshake</span><span class="op" id="8281086">(</span><span class="ident" id="8281087">clientConfig</span><span class="op" id="8281099">,</span>&nbsp;<span class="ident" id="8281101">serverConfig</span>&nbsp;<span class="op" id="8281114">*</span><span class="ident" id="8281115">Config</span><span class="op" id="8281121">)</span>&nbsp;<span class="op" id="8281123">(</span><span class="ident" id="8281124">state</span>&nbsp;<span class="ident" id="8281130">ConnectionState</span><span class="op" id="8281145">,</span>&nbsp;<span class="ident" id="8281147">err</span>&nbsp;<span class="builtintype" id="8281151">error</span><span class="op" id="8281156">)</span>&nbsp;<span class="op" id="8281158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281161">c</span><span class="op" id="8281162">,</span>&nbsp;<span class="ident" id="8281164">s</span>&nbsp;<span class="op" id="8281166">:=</span>&nbsp;<span class="ident" id="8281169">net</span><span class="op" id="8281172">.</span><span class="ident" id="8281173">Pipe</span><span class="op" id="8281177">(</span><span class="op" id="8281178">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281181">done</span>&nbsp;<span class="op" id="8281186">:=</span>&nbsp;<span class="builtinfunc" id="8281189">make</span><span class="op" id="8281193">(</span><span class="keyword" id="8281194">chan</span>&nbsp;<span class="builtintype" id="8281199">bool</span><span class="op" id="8281203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281206">go</span>&nbsp;<span class="keyword" id="8281209">func</span><span class="op" id="8281213">(</span><span class="op" id="8281214">)</span>&nbsp;<span class="op" id="8281216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281220">cli</span>&nbsp;<span class="op" id="8281224">:=</span>&nbsp;<span class="ident" id="8281227">Client</span><span class="op" id="8281233">(</span><span class="ident" id="8281234">c</span><span class="op" id="8281235">,</span>&nbsp;<span class="ident" id="8281237">clientConfig</span><span class="op" id="8281249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281253">cli</span><span class="op" id="8281256">.</span><span class="ident" id="8281257">Handshake</span><span class="op" id="8281266">(</span><span class="op" id="8281267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281271">c</span><span class="op" id="8281272">.</span><span class="ident" id="8281273">Close</span><span class="op" id="8281278">(</span><span class="op" id="8281279">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281283">done</span>&nbsp;<span class="op" id="8281288">&lt;-</span>&nbsp;<span class="builtintype" id="8281291">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281297">}</span><span class="op" id="8281298">(</span><span class="op" id="8281299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281302">server</span>&nbsp;<span class="op" id="8281309">:=</span>&nbsp;<span class="ident" id="8281312">Server</span><span class="op" id="8281318">(</span><span class="ident" id="8281319">s</span><span class="op" id="8281320">,</span>&nbsp;<span class="ident" id="8281322">serverConfig</span><span class="op" id="8281334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281337">err</span>&nbsp;<span class="op" id="8281341">=</span>&nbsp;<span class="ident" id="8281343">server</span><span class="op" id="8281349">.</span><span class="ident" id="8281350">Handshake</span><span class="op" id="8281359">(</span><span class="op" id="8281360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281363">if</span>&nbsp;<span class="ident" id="8281366">err</span>&nbsp;<span class="op" id="8281370">==</span>&nbsp;<span class="ident" id="8281373">nil</span>&nbsp;<span class="op" id="8281377">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281381">state</span>&nbsp;<span class="op" id="8281387">=</span>&nbsp;<span class="ident" id="8281389">server</span><span class="op" id="8281395">.</span><span class="ident" id="8281396">ConnectionState</span><span class="op" id="8281411">(</span><span class="op" id="8281412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281418">s</span><span class="op" id="8281419">.</span><span class="ident" id="8281420">Close</span><span class="op" id="8281425">(</span><span class="op" id="8281426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281429">&lt;-</span><span class="ident" id="8281431">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281437">return</span><br>
<span class="lineno">195</span><span class="op" id="8281444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8281447">func</span>&nbsp;<span class="ident" id="8281452">TestVersion</span><span class="op" id="8281463">(</span><span class="ident" id="8281464">t</span>&nbsp;<span class="op" id="8281466">*</span><span class="ident" id="8281467">testing</span><span class="op" id="8281474">.</span><span class="ident" id="8281475">T</span><span class="op" id="8281476">)</span>&nbsp;<span class="op" id="8281478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281481">serverConfig</span>&nbsp;<span class="op" id="8281494">:=</span>&nbsp;<span class="op" id="8281497">&amp;</span><span class="ident" id="8281498">Config</span><span class="op" id="8281504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281508">Certificates</span><span class="op" id="8281520">:</span>&nbsp;<span class="ident" id="8281522">testConfig</span><span class="op" id="8281532">.</span><span class="ident" id="8281533">Certificates</span><span class="op" id="8281545">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281549">MaxVersion</span><span class="op" id="8281559">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8281563">VersionTLS11</span><span class="op" id="8281575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281581">clientConfig</span>&nbsp;<span class="op" id="8281594">:=</span>&nbsp;<span class="op" id="8281597">&amp;</span><span class="ident" id="8281598">Config</span><span class="op" id="8281604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281608">InsecureSkipVerify</span><span class="op" id="8281626">:</span>&nbsp;<span class="builtintype" id="8281628">true</span><span class="op" id="8281632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281635">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281638">state</span><span class="op" id="8281643">,</span>&nbsp;<span class="ident" id="8281645">err</span>&nbsp;<span class="op" id="8281649">:=</span>&nbsp;<span class="ident" id="8281652">testHandshake</span><span class="op" id="8281665">(</span><span class="ident" id="8281666">clientConfig</span><span class="op" id="8281678">,</span>&nbsp;<span class="ident" id="8281680">serverConfig</span><span class="op" id="8281692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281695">if</span>&nbsp;<span class="ident" id="8281698">err</span>&nbsp;<span class="op" id="8281702">!=</span>&nbsp;<span class="ident" id="8281705">nil</span>&nbsp;<span class="op" id="8281709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281713">t</span><span class="op" id="8281714">.</span><span class="ident" id="8281715">Fatalf</span><span class="op" id="8281721">(</span><span class="string" id="8281722">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8281744">,</span>&nbsp;<span class="ident" id="8281746">err</span><span class="op" id="8281749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8281755">if</span>&nbsp;<span class="ident" id="8281758">state</span><span class="op" id="8281763">.</span><span class="ident" id="8281764">Version</span>&nbsp;<span class="op" id="8281772">!=</span>&nbsp;<span class="ident" id="8281775">VersionTLS11</span>&nbsp;<span class="op" id="8281788">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281792">t</span><span class="op" id="8281793">.</span><span class="ident" id="8281794">Fatalf</span><span class="op" id="8281800">(</span><span class="string" id="8281801">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="8281837">,</span>&nbsp;<span class="ident" id="8281839">state</span><span class="op" id="8281844">.</span><span class="ident" id="8281845">Version</span><span class="op" id="8281852">,</span>&nbsp;<span class="ident" id="8281854">VersionTLS11</span><span class="op" id="8281866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8281869">}</span><br>
<span class="lineno"></span><span class="op" id="8281871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8281874">func</span>&nbsp;<span class="ident" id="8281879">TestCipherSuitePreference</span><span class="op" id="8281904">(</span><span class="ident" id="8281905">t</span>&nbsp;<span class="op" id="8281907">*</span><span class="ident" id="8281908">testing</span><span class="op" id="8281915">.</span><span class="ident" id="8281916">T</span><span class="op" id="8281917">)</span>&nbsp;<span class="op" id="8281919">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281922">serverConfig</span>&nbsp;<span class="op" id="8281935">:=</span>&nbsp;<span class="op" id="8281938">&amp;</span><span class="ident" id="8281939">Config</span><span class="op" id="8281945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8281949">CipherSuites</span><span class="op" id="8281961">:</span>&nbsp;<span class="op" id="8281963">[</span><span class="op" id="8281964">]</span><span class="builtintype" id="8281965">uint16</span><span class="op" id="8281971">{</span><span class="ident" id="8281972">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8281996">,</span>&nbsp;<span class="ident" id="8281998">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="8282026">,</span>&nbsp;<span class="ident" id="8282028">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="8282058">}</span><span class="op" id="8282059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282063">Certificates</span><span class="op" id="8282075">:</span>&nbsp;<span class="ident" id="8282077">testConfig</span><span class="op" id="8282087">.</span><span class="ident" id="8282088">Certificates</span><span class="op" id="8282100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282104">MaxVersion</span><span class="op" id="8282114">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8282118">VersionTLS11</span><span class="op" id="8282130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282133">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282136">clientConfig</span>&nbsp;<span class="op" id="8282149">:=</span>&nbsp;<span class="op" id="8282152">&amp;</span><span class="ident" id="8282153">Config</span><span class="op" id="8282159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282163">CipherSuites</span><span class="op" id="8282175">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8282183">[</span><span class="op" id="8282184">]</span><span class="builtintype" id="8282185">uint16</span><span class="op" id="8282191">{</span><span class="ident" id="8282192">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="8282220">,</span>&nbsp;<span class="ident" id="8282222">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8282246">}</span><span class="op" id="8282247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282251">InsecureSkipVerify</span><span class="op" id="8282269">:</span>&nbsp;<span class="builtintype" id="8282271">true</span><span class="op" id="8282275">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282281">state</span><span class="op" id="8282286">,</span>&nbsp;<span class="ident" id="8282288">err</span>&nbsp;<span class="op" id="8282292">:=</span>&nbsp;<span class="ident" id="8282295">testHandshake</span><span class="op" id="8282308">(</span><span class="ident" id="8282309">clientConfig</span><span class="op" id="8282321">,</span>&nbsp;<span class="ident" id="8282323">serverConfig</span><span class="op" id="8282335">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282338">if</span>&nbsp;<span class="ident" id="8282341">err</span>&nbsp;<span class="op" id="8282345">!=</span>&nbsp;<span class="ident" id="8282348">nil</span>&nbsp;<span class="op" id="8282352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282356">t</span><span class="op" id="8282357">.</span><span class="ident" id="8282358">Fatalf</span><span class="op" id="8282364">(</span><span class="string" id="8282365">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8282387">,</span>&nbsp;<span class="ident" id="8282389">err</span><span class="op" id="8282392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282398">if</span>&nbsp;<span class="ident" id="8282401">state</span><span class="op" id="8282406">.</span><span class="ident" id="8282407">CipherSuite</span>&nbsp;<span class="op" id="8282419">!=</span>&nbsp;<span class="ident" id="8282422">TLS_RSA_WITH_AES_128_CBC_SHA</span>&nbsp;<span class="op" id="8282451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8282455">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282518">t</span><span class="op" id="8282519">.</span><span class="ident" id="8282520">Fatalf</span><span class="op" id="8282526">(</span><span class="string" id="8282527">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="8282569">,</span>&nbsp;<span class="ident" id="8282571">state</span><span class="op" id="8282576">.</span><span class="ident" id="8282577">CipherSuite</span><span class="op" id="8282588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282595">serverConfig</span><span class="op" id="8282607">.</span><span class="ident" id="8282608">PreferServerCipherSuites</span>&nbsp;<span class="op" id="8282633">=</span>&nbsp;<span class="builtintype" id="8282635">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282641">state</span><span class="op" id="8282646">,</span>&nbsp;<span class="ident" id="8282648">err</span>&nbsp;<span class="op" id="8282652">=</span>&nbsp;<span class="ident" id="8282654">testHandshake</span><span class="op" id="8282667">(</span><span class="ident" id="8282668">clientConfig</span><span class="op" id="8282680">,</span>&nbsp;<span class="ident" id="8282682">serverConfig</span><span class="op" id="8282694">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282697">if</span>&nbsp;<span class="ident" id="8282700">err</span>&nbsp;<span class="op" id="8282704">!=</span>&nbsp;<span class="ident" id="8282707">nil</span>&nbsp;<span class="op" id="8282711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282715">t</span><span class="op" id="8282716">.</span><span class="ident" id="8282717">Fatalf</span><span class="op" id="8282723">(</span><span class="string" id="8282724">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8282746">,</span>&nbsp;<span class="ident" id="8282748">err</span><span class="op" id="8282751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8282757">if</span>&nbsp;<span class="ident" id="8282760">state</span><span class="op" id="8282765">.</span><span class="ident" id="8282766">CipherSuite</span>&nbsp;<span class="op" id="8282778">!=</span>&nbsp;<span class="ident" id="8282781">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="8282806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8282810">t</span><span class="op" id="8282811">.</span><span class="ident" id="8282812">Fatalf</span><span class="op" id="8282818">(</span><span class="string" id="8282819">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="8282861">,</span>&nbsp;<span class="ident" id="8282863">state</span><span class="op" id="8282868">.</span><span class="ident" id="8282869">CipherSuite</span><span class="op" id="8282880">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8282883">}</span><br>
<span class="lineno"></span><span class="op" id="8282885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8282888">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="8282963">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="8282979">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="8283059">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="8283078">type</span>&nbsp;<span class="ident" id="8283083">serverTest</span>&nbsp;<span class="keyword" id="8283094">struct</span>&nbsp;<span class="op" id="8283101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8283104">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8283177">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283218">name</span>&nbsp;<span class="builtintype" id="8283223">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8283231">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8283297">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283342">command</span>&nbsp;<span class="op" id="8283350">[</span><span class="op" id="8283351">]</span><span class="builtintype" id="8283352">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8283360">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8283424">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283458">expectedPeerCerts</span>&nbsp;<span class="op" id="8283476">[</span><span class="op" id="8283477">]</span><span class="builtintype" id="8283478">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8283486">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283557">config</span>&nbsp;<span class="op" id="8283564">*</span><span class="ident" id="8283565">Config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8283573">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8283647">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283685">expectAlert</span>&nbsp;<span class="builtintype" id="8283697">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8283703">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8283772">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8283844">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="8283874">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8283882">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8283951">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8284024">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284061">validate</span>&nbsp;<span class="keyword" id="8284070">func</span><span class="op" id="8284074">(</span><span class="ident" id="8284075">ConnectionState</span><span class="op" id="8284090">)</span>&nbsp;<span class="builtintype" id="8284092">error</span><br>
<span class="lineno">270</span><span class="op" id="8284098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8284101">var</span>&nbsp;<span class="ident" id="8284105">defaultClientCommand</span>&nbsp;<span class="op" id="8284126">=</span>&nbsp;<span class="op" id="8284128">[</span><span class="op" id="8284129">]</span><span class="builtintype" id="8284130">string</span><span class="op" id="8284136">{</span><span class="string" id="8284137">&#34;openssl&#34;</span><span class="op" id="8284146">,</span>&nbsp;<span class="string" id="8284148">&#34;s_client&#34;</span><span class="op" id="8284158">,</span>&nbsp;<span class="string" id="8284160">&#34;-no_ticket&#34;</span><span class="op" id="8284172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8284175">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="8284251">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="8284331">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="8284346">func</span>&nbsp;<span class="op" id="8284351">(</span><span class="ident" id="8284352">test</span>&nbsp;<span class="op" id="8284357">*</span><span class="ident" id="8284358">serverTest</span><span class="op" id="8284368">)</span>&nbsp;<span class="ident" id="8284370">connFromCommand</span><span class="op" id="8284385">(</span><span class="op" id="8284386">)</span>&nbsp;<span class="op" id="8284388">(</span><span class="ident" id="8284389">conn</span>&nbsp;<span class="op" id="8284394">*</span><span class="ident" id="8284395">recordingConn</span><span class="op" id="8284408">,</span>&nbsp;<span class="ident" id="8284410">child</span>&nbsp;<span class="op" id="8284416">*</span><span class="ident" id="8284417">exec</span><span class="op" id="8284421">.</span><span class="ident" id="8284422">Cmd</span><span class="op" id="8284425">,</span>&nbsp;<span class="ident" id="8284427">err</span>&nbsp;<span class="builtintype" id="8284431">error</span><span class="op" id="8284436">)</span>&nbsp;<span class="op" id="8284438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284441">l</span><span class="op" id="8284442">,</span>&nbsp;<span class="ident" id="8284444">err</span>&nbsp;<span class="op" id="8284448">:=</span>&nbsp;<span class="ident" id="8284451">net</span><span class="op" id="8284454">.</span><span class="ident" id="8284455">ListenTCP</span><span class="op" id="8284464">(</span><span class="string" id="8284465">&#34;tcp&#34;</span><span class="op" id="8284470">,</span>&nbsp;<span class="op" id="8284472">&amp;</span><span class="ident" id="8284473">net</span><span class="op" id="8284476">.</span><span class="ident" id="8284477">TCPAddr</span><span class="op" id="8284484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284488">IP</span><span class="op" id="8284490">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8284494">net</span><span class="op" id="8284497">.</span><span class="ident" id="8284498">IPv4</span><span class="op" id="8284502">(</span><span class="num" id="8284503">127</span><span class="op" id="8284506">,</span>&nbsp;<span class="num" id="8284508">0</span><span class="op" id="8284509">,</span>&nbsp;<span class="num" id="8284511">0</span><span class="op" id="8284512">,</span>&nbsp;<span class="num" id="8284514">1</span><span class="op" id="8284515">)</span><span class="op" id="8284516">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284520">Port</span><span class="op" id="8284524">:</span>&nbsp;<span class="num" id="8284526">0</span><span class="op" id="8284527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8284530">}</span><span class="op" id="8284531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284534">if</span>&nbsp;<span class="ident" id="8284537">err</span>&nbsp;<span class="op" id="8284541">!=</span>&nbsp;<span class="ident" id="8284544">nil</span>&nbsp;<span class="op" id="8284548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284552">return</span>&nbsp;<span class="ident" id="8284559">nil</span><span class="op" id="8284562">,</span>&nbsp;<span class="ident" id="8284564">nil</span><span class="op" id="8284567">,</span>&nbsp;<span class="ident" id="8284569">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8284574">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284577">defer</span>&nbsp;<span class="ident" id="8284583">l</span><span class="op" id="8284584">.</span><span class="ident" id="8284585">Close</span><span class="op" id="8284590">(</span><span class="op" id="8284591">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284595">port</span>&nbsp;<span class="op" id="8284600">:=</span>&nbsp;<span class="ident" id="8284603">l</span><span class="op" id="8284604">.</span><span class="ident" id="8284605">Addr</span><span class="op" id="8284609">(</span><span class="op" id="8284610">)</span><span class="op" id="8284611">.</span><span class="op" id="8284612">(</span><span class="op" id="8284613">*</span><span class="ident" id="8284614">net</span><span class="op" id="8284617">.</span><span class="ident" id="8284618">TCPAddr</span><span class="op" id="8284625">)</span><span class="op" id="8284626">.</span><span class="ident" id="8284627">Port</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284634">var</span>&nbsp;<span class="ident" id="8284638">command</span>&nbsp;<span class="op" id="8284646">[</span><span class="op" id="8284647">]</span><span class="builtintype" id="8284648">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284656">command</span>&nbsp;<span class="op" id="8284664">=</span>&nbsp;<span class="builtinfunc" id="8284666">append</span><span class="op" id="8284672">(</span><span class="ident" id="8284673">command</span><span class="op" id="8284680">,</span>&nbsp;<span class="ident" id="8284682">test</span><span class="op" id="8284686">.</span><span class="ident" id="8284687">command</span><span class="op" id="8284694">...</span><span class="op" id="8284697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284700">if</span>&nbsp;<span class="builtinfunc" id="8284703">len</span><span class="op" id="8284706">(</span><span class="ident" id="8284707">command</span><span class="op" id="8284714">)</span>&nbsp;<span class="op" id="8284716">==</span>&nbsp;<span class="num" id="8284719">0</span>&nbsp;<span class="op" id="8284721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284725">command</span>&nbsp;<span class="op" id="8284733">=</span>&nbsp;<span class="ident" id="8284735">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8284757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284760">command</span>&nbsp;<span class="op" id="8284768">=</span>&nbsp;<span class="builtinfunc" id="8284770">append</span><span class="op" id="8284776">(</span><span class="ident" id="8284777">command</span><span class="op" id="8284784">,</span>&nbsp;<span class="string" id="8284786">&#34;-connect&#34;</span><span class="op" id="8284796">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284799">command</span>&nbsp;<span class="op" id="8284807">=</span>&nbsp;<span class="builtinfunc" id="8284809">append</span><span class="op" id="8284815">(</span><span class="ident" id="8284816">command</span><span class="op" id="8284823">,</span>&nbsp;<span class="ident" id="8284825">fmt</span><span class="op" id="8284828">.</span><span class="ident" id="8284829">Sprintf</span><span class="op" id="8284836">(</span><span class="string" id="8284837">&#34;127.0.0.1:%d&#34;</span><span class="op" id="8284851">,</span>&nbsp;<span class="ident" id="8284853">port</span><span class="op" id="8284857">)</span><span class="op" id="8284858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284861">cmd</span>&nbsp;<span class="op" id="8284865">:=</span>&nbsp;<span class="ident" id="8284868">exec</span><span class="op" id="8284872">.</span><span class="ident" id="8284873">Command</span><span class="op" id="8284880">(</span><span class="ident" id="8284881">command</span><span class="op" id="8284888">[</span><span class="num" id="8284889">0</span><span class="op" id="8284890">]</span><span class="op" id="8284891">,</span>&nbsp;<span class="ident" id="8284893">command</span><span class="op" id="8284900">[</span><span class="num" id="8284901">1</span><span class="op" id="8284902">:</span><span class="op" id="8284903">]</span><span class="op" id="8284904">...</span><span class="op" id="8284907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284910">cmd</span><span class="op" id="8284913">.</span><span class="ident" id="8284914">Stdin</span>&nbsp;<span class="op" id="8284920">=</span>&nbsp;<span class="ident" id="8284922">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284927">var</span>&nbsp;<span class="ident" id="8284931">output</span>&nbsp;<span class="ident" id="8284938">bytes</span><span class="op" id="8284943">.</span><span class="ident" id="8284944">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284952">cmd</span><span class="op" id="8284955">.</span><span class="ident" id="8284956">Stdout</span>&nbsp;<span class="op" id="8284963">=</span>&nbsp;<span class="op" id="8284965">&amp;</span><span class="ident" id="8284966">output</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8284974">cmd</span><span class="op" id="8284977">.</span><span class="ident" id="8284978">Stderr</span>&nbsp;<span class="op" id="8284985">=</span>&nbsp;<span class="op" id="8284987">&amp;</span><span class="ident" id="8284988">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8284996">if</span>&nbsp;<span class="ident" id="8284999">err</span>&nbsp;<span class="op" id="8285003">:=</span>&nbsp;<span class="ident" id="8285006">cmd</span><span class="op" id="8285009">.</span><span class="ident" id="8285010">Start</span><span class="op" id="8285015">(</span><span class="op" id="8285016">)</span><span class="op" id="8285017">;</span>&nbsp;<span class="ident" id="8285019">err</span>&nbsp;<span class="op" id="8285023">!=</span>&nbsp;<span class="ident" id="8285026">nil</span>&nbsp;<span class="op" id="8285030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285034">return</span>&nbsp;<span class="ident" id="8285041">nil</span><span class="op" id="8285044">,</span>&nbsp;<span class="ident" id="8285046">nil</span><span class="op" id="8285049">,</span>&nbsp;<span class="ident" id="8285051">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285060">connChan</span>&nbsp;<span class="op" id="8285069">:=</span>&nbsp;<span class="builtinfunc" id="8285072">make</span><span class="op" id="8285076">(</span><span class="keyword" id="8285077">chan</span>&nbsp;<span class="keyword" id="8285082">interface</span><span class="op" id="8285091">{</span><span class="op" id="8285092">}</span><span class="op" id="8285093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285096">go</span>&nbsp;<span class="keyword" id="8285099">func</span><span class="op" id="8285103">(</span><span class="op" id="8285104">)</span>&nbsp;<span class="op" id="8285106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285110">tcpConn</span><span class="op" id="8285117">,</span>&nbsp;<span class="ident" id="8285119">err</span>&nbsp;<span class="op" id="8285123">:=</span>&nbsp;<span class="ident" id="8285126">l</span><span class="op" id="8285127">.</span><span class="ident" id="8285128">Accept</span><span class="op" id="8285134">(</span><span class="op" id="8285135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285139">if</span>&nbsp;<span class="ident" id="8285142">err</span>&nbsp;<span class="op" id="8285146">!=</span>&nbsp;<span class="ident" id="8285149">nil</span>&nbsp;<span class="op" id="8285153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285158">connChan</span>&nbsp;<span class="op" id="8285167">&lt;-</span>&nbsp;<span class="ident" id="8285170">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285180">connChan</span>&nbsp;<span class="op" id="8285189">&lt;-</span>&nbsp;<span class="ident" id="8285192">tcpConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285201">}</span><span class="op" id="8285202">(</span><span class="op" id="8285203">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285207">var</span>&nbsp;<span class="ident" id="8285211">tcpConn</span>&nbsp;<span class="ident" id="8285219">net</span><span class="op" id="8285222">.</span><span class="ident" id="8285223">Conn</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285229">select</span>&nbsp;<span class="op" id="8285236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285239">case</span>&nbsp;<span class="ident" id="8285244">connOrError</span>&nbsp;<span class="op" id="8285256">:=</span>&nbsp;<span class="op" id="8285259">&lt;-</span><span class="ident" id="8285261">connChan</span><span class="op" id="8285269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285273">if</span>&nbsp;<span class="ident" id="8285276">err</span><span class="op" id="8285279">,</span>&nbsp;<span class="ident" id="8285281">ok</span>&nbsp;<span class="op" id="8285284">:=</span>&nbsp;<span class="ident" id="8285287">connOrError</span><span class="op" id="8285298">.</span><span class="op" id="8285299">(</span><span class="builtintype" id="8285300">error</span><span class="op" id="8285305">)</span><span class="op" id="8285306">;</span>&nbsp;<span class="ident" id="8285308">ok</span>&nbsp;<span class="op" id="8285311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285316">return</span>&nbsp;<span class="ident" id="8285323">nil</span><span class="op" id="8285326">,</span>&nbsp;<span class="ident" id="8285328">nil</span><span class="op" id="8285331">,</span>&nbsp;<span class="ident" id="8285333">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285339">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285343">tcpConn</span>&nbsp;<span class="op" id="8285351">=</span>&nbsp;<span class="ident" id="8285353">connOrError</span><span class="op" id="8285364">.</span><span class="op" id="8285365">(</span><span class="ident" id="8285366">net</span><span class="op" id="8285369">.</span><span class="ident" id="8285370">Conn</span><span class="op" id="8285374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285377">case</span>&nbsp;<span class="op" id="8285382">&lt;-</span><span class="ident" id="8285384">time</span><span class="op" id="8285388">.</span><span class="ident" id="8285389">After</span><span class="op" id="8285394">(</span><span class="num" id="8285395">2</span>&nbsp;<span class="op" id="8285397">*</span>&nbsp;<span class="ident" id="8285399">time</span><span class="op" id="8285403">.</span><span class="ident" id="8285404">Second</span><span class="op" id="8285410">)</span><span class="op" id="8285411">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285415">output</span><span class="op" id="8285421">.</span><span class="ident" id="8285422">WriteTo</span><span class="op" id="8285429">(</span><span class="ident" id="8285430">os</span><span class="op" id="8285432">.</span><span class="ident" id="8285433">Stdout</span><span class="op" id="8285439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285443">return</span>&nbsp;<span class="ident" id="8285450">nil</span><span class="op" id="8285453">,</span>&nbsp;<span class="ident" id="8285455">nil</span><span class="op" id="8285458">,</span>&nbsp;<span class="ident" id="8285460">errors</span><span class="op" id="8285466">.</span><span class="ident" id="8285467">New</span><span class="op" id="8285470">(</span><span class="string" id="8285471">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="8285524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285527">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285531">record</span>&nbsp;<span class="op" id="8285538">:=</span>&nbsp;<span class="op" id="8285541">&amp;</span><span class="ident" id="8285542">recordingConn</span><span class="op" id="8285555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285559">Conn</span><span class="op" id="8285563">:</span>&nbsp;<span class="ident" id="8285565">tcpConn</span><span class="op" id="8285572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285579">return</span>&nbsp;<span class="ident" id="8285586">record</span><span class="op" id="8285592">,</span>&nbsp;<span class="ident" id="8285594">cmd</span><span class="op" id="8285597">,</span>&nbsp;<span class="ident" id="8285599">nil</span><br>
<span class="lineno"></span><span class="op" id="8285603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8285606">func</span>&nbsp;<span class="op" id="8285611">(</span><span class="ident" id="8285612">test</span>&nbsp;<span class="op" id="8285617">*</span><span class="ident" id="8285618">serverTest</span><span class="op" id="8285628">)</span>&nbsp;<span class="ident" id="8285630">dataPath</span><span class="op" id="8285638">(</span><span class="op" id="8285639">)</span>&nbsp;<span class="builtintype" id="8285641">string</span>&nbsp;<span class="op" id="8285648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285651">return</span>&nbsp;<span class="ident" id="8285658">filepath</span><span class="op" id="8285666">.</span><span class="ident" id="8285667">Join</span><span class="op" id="8285671">(</span><span class="string" id="8285672">&#34;testdata&#34;</span><span class="op" id="8285682">,</span>&nbsp;<span class="string" id="8285684">&#34;Server-&#34;</span><span class="op" id="8285693">+</span><span class="ident" id="8285694">test</span><span class="op" id="8285698">.</span><span class="ident" id="8285699">name</span><span class="op" id="8285703">)</span><br>
<span class="lineno">335</span><span class="op" id="8285705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8285708">func</span>&nbsp;<span class="op" id="8285713">(</span><span class="ident" id="8285714">test</span>&nbsp;<span class="op" id="8285719">*</span><span class="ident" id="8285720">serverTest</span><span class="op" id="8285730">)</span>&nbsp;<span class="ident" id="8285732">loadData</span><span class="op" id="8285740">(</span><span class="op" id="8285741">)</span>&nbsp;<span class="op" id="8285743">(</span><span class="ident" id="8285744">flows</span>&nbsp;<span class="op" id="8285750">[</span><span class="op" id="8285751">]</span><span class="op" id="8285752">[</span><span class="op" id="8285753">]</span><span class="builtintype" id="8285754">byte</span><span class="op" id="8285758">,</span>&nbsp;<span class="ident" id="8285760">err</span>&nbsp;<span class="builtintype" id="8285764">error</span><span class="op" id="8285769">)</span>&nbsp;<span class="op" id="8285771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8285774">in</span><span class="op" id="8285776">,</span>&nbsp;<span class="ident" id="8285778">err</span>&nbsp;<span class="op" id="8285782">:=</span>&nbsp;<span class="ident" id="8285785">os</span><span class="op" id="8285787">.</span><span class="ident" id="8285788">Open</span><span class="op" id="8285792">(</span><span class="ident" id="8285793">test</span><span class="op" id="8285797">.</span><span class="ident" id="8285798">dataPath</span><span class="op" id="8285806">(</span><span class="op" id="8285807">)</span><span class="op" id="8285808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285811">if</span>&nbsp;<span class="ident" id="8285814">err</span>&nbsp;<span class="op" id="8285818">!=</span>&nbsp;<span class="ident" id="8285821">nil</span>&nbsp;<span class="op" id="8285825">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285829">return</span>&nbsp;<span class="ident" id="8285836">nil</span><span class="op" id="8285839">,</span>&nbsp;<span class="ident" id="8285841">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8285846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285849">defer</span>&nbsp;<span class="ident" id="8285855">in</span><span class="op" id="8285857">.</span><span class="ident" id="8285858">Close</span><span class="op" id="8285863">(</span><span class="op" id="8285864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285867">return</span>&nbsp;<span class="ident" id="8285874">parseTestData</span><span class="op" id="8285887">(</span><span class="ident" id="8285888">in</span><span class="op" id="8285890">)</span><br>
<span class="lineno"></span><span class="op" id="8285892">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="8285895">func</span>&nbsp;<span class="op" id="8285900">(</span><span class="ident" id="8285901">test</span>&nbsp;<span class="op" id="8285906">*</span><span class="ident" id="8285907">serverTest</span><span class="op" id="8285917">)</span>&nbsp;<span class="ident" id="8285919">run</span><span class="op" id="8285922">(</span><span class="ident" id="8285923">t</span>&nbsp;<span class="op" id="8285925">*</span><span class="ident" id="8285926">testing</span><span class="op" id="8285933">.</span><span class="ident" id="8285934">T</span><span class="op" id="8285935">,</span>&nbsp;<span class="ident" id="8285937">write</span>&nbsp;<span class="builtintype" id="8285943">bool</span><span class="op" id="8285947">)</span>&nbsp;<span class="op" id="8285949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285952">var</span>&nbsp;<span class="ident" id="8285956">clientConn</span><span class="op" id="8285966">,</span>&nbsp;<span class="ident" id="8285968">serverConn</span>&nbsp;<span class="ident" id="8285979">net</span><span class="op" id="8285982">.</span><span class="ident" id="8285983">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8285989">var</span>&nbsp;<span class="ident" id="8285993">recordingConn</span>&nbsp;<span class="op" id="8286007">*</span><span class="ident" id="8286008">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8286023">var</span>&nbsp;<span class="ident" id="8286027">childProcess</span>&nbsp;<span class="op" id="8286040">*</span><span class="ident" id="8286041">exec</span><span class="op" id="8286045">.</span><span class="ident" id="8286046">Cmd</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8286052">if</span>&nbsp;<span class="ident" id="8286055">write</span>&nbsp;<span class="op" id="8286061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8286065">var</span>&nbsp;<span class="ident" id="8286069">err</span>&nbsp;<span class="builtintype" id="8286073">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286081">recordingConn</span><span class="op" id="8286094">,</span>&nbsp;<span class="ident" id="8286096">childProcess</span><span class="op" id="8286108">,</span>&nbsp;<span class="ident" id="8286110">err</span>&nbsp;<span class="op" id="8286114">=</span>&nbsp;<span class="ident" id="8286116">test</span><span class="op" id="8286120">.</span><span class="ident" id="8286121">connFromCommand</span><span class="op" id="8286136">(</span><span class="op" id="8286137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8286141">if</span>&nbsp;<span class="ident" id="8286144">err</span>&nbsp;<span class="op" id="8286148">!=</span>&nbsp;<span class="ident" id="8286151">nil</span>&nbsp;<span class="op" id="8286155">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286160">t</span><span class="op" id="8286161">.</span><span class="ident" id="8286162">Fatalf</span><span class="op" id="8286168">(</span><span class="string" id="8286169">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="8286201">,</span>&nbsp;<span class="ident" id="8286203">err</span><span class="op" id="8286206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286214">serverConn</span>&nbsp;<span class="op" id="8286225">=</span>&nbsp;<span class="ident" id="8286227">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286242">}</span>&nbsp;<span class="keyword" id="8286244">else</span>&nbsp;<span class="op" id="8286249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286253">clientConn</span><span class="op" id="8286263">,</span>&nbsp;<span class="ident" id="8286265">serverConn</span>&nbsp;<span class="op" id="8286276">=</span>&nbsp;<span class="ident" id="8286278">net</span><span class="op" id="8286281">.</span><span class="ident" id="8286282">Pipe</span><span class="op" id="8286286">(</span><span class="op" id="8286287">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286293">config</span>&nbsp;<span class="op" id="8286300">:=</span>&nbsp;<span class="ident" id="8286303">test</span><span class="op" id="8286307">.</span><span class="ident" id="8286308">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8286316">if</span>&nbsp;<span class="ident" id="8286319">config</span>&nbsp;<span class="op" id="8286326">==</span>&nbsp;<span class="ident" id="8286329">nil</span>&nbsp;<span class="op" id="8286333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286337">config</span>&nbsp;<span class="op" id="8286344">=</span>&nbsp;<span class="ident" id="8286346">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286358">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286361">server</span>&nbsp;<span class="op" id="8286368">:=</span>&nbsp;<span class="ident" id="8286371">Server</span><span class="op" id="8286377">(</span><span class="ident" id="8286378">serverConn</span><span class="op" id="8286388">,</span>&nbsp;<span class="ident" id="8286390">config</span><span class="op" id="8286396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286399">connStateChan</span>&nbsp;<span class="op" id="8286413">:=</span>&nbsp;<span class="builtinfunc" id="8286416">make</span><span class="op" id="8286420">(</span><span class="keyword" id="8286421">chan</span>&nbsp;<span class="ident" id="8286426">ConnectionState</span><span class="op" id="8286441">,</span>&nbsp;<span class="num" id="8286443">1</span><span class="op" id="8286444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8286447">go</span>&nbsp;<span class="keyword" id="8286450">func</span><span class="op" id="8286454">(</span><span class="op" id="8286455">)</span>&nbsp;<span class="op" id="8286457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8286461">var</span>&nbsp;<span class="ident" id="8286465">err</span>&nbsp;<span class="builtintype" id="8286469">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8286477">if</span>&nbsp;<span class="ident" id="8286480">_</span><span class="op" id="8286481">,</span>&nbsp;<span class="ident" id="8286483">err</span>&nbsp;<span class="op" id="8286487">=</span>&nbsp;<span class="ident" id="8286489">server</span><span class="op" id="8286495">.</span><span class="ident" id="8286496">Write</span><span class="op" id="8286501">(</span><span class="op" id="8286502">[</span><span class="op" id="8286503">]</span><span class="builtintype" id="8286504">byte</span><span class="op" id="8286508">(</span><span class="string" id="8286509">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="8286525">)</span><span class="op" id="8286526">)</span><span class="op" id="8286527">;</span>&nbsp;<span class="ident" id="8286529">err</span>&nbsp;<span class="op" id="8286533">!=</span>&nbsp;<span class="ident" id="8286536">nil</span>&nbsp;<span class="op" id="8286540">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286545">t</span><span class="op" id="8286546">.</span><span class="ident" id="8286547">Logf</span><span class="op" id="8286551">(</span><span class="string" id="8286552">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="8286581">,</span>&nbsp;<span class="ident" id="8286583">err</span><span class="op" id="8286586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8286594">if</span>&nbsp;<span class="builtinfunc" id="8286597">len</span><span class="op" id="8286600">(</span><span class="ident" id="8286601">test</span><span class="op" id="8286605">.</span><span class="ident" id="8286606">expectHandshakeErrorIncluding</span><span class="op" id="8286635">)</span>&nbsp;<span class="op" id="8286637">&gt;</span>&nbsp;<span class="num" id="8286639">0</span>&nbsp;<span class="op" id="8286641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8286646">if</span>&nbsp;<span class="ident" id="8286649">err</span>&nbsp;<span class="op" id="8286653">==</span>&nbsp;<span class="ident" id="8286656">nil</span>&nbsp;<span class="op" id="8286660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286666">t</span><span class="op" id="8286667">.</span><span class="ident" id="8286668">Errorf</span><span class="op" id="8286674">(</span><span class="string" id="8286675">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="8286714">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286719">}</span>&nbsp;<span class="keyword" id="8286721">else</span>&nbsp;<span class="keyword" id="8286726">if</span>&nbsp;<span class="ident" id="8286729">s</span>&nbsp;<span class="op" id="8286731">:=</span>&nbsp;<span class="ident" id="8286734">err</span><span class="op" id="8286737">.</span><span class="ident" id="8286738">Error</span><span class="op" id="8286743">(</span><span class="op" id="8286744">)</span><span class="op" id="8286745">;</span>&nbsp;<span class="op" id="8286747">!</span><span class="ident" id="8286748">strings</span><span class="op" id="8286755">.</span><span class="ident" id="8286756">Contains</span><span class="op" id="8286764">(</span><span class="ident" id="8286765">s</span><span class="op" id="8286766">,</span>&nbsp;<span class="ident" id="8286768">test</span><span class="op" id="8286772">.</span><span class="ident" id="8286773">expectHandshakeErrorIncluding</span><span class="op" id="8286802">)</span>&nbsp;<span class="op" id="8286804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286810">t</span><span class="op" id="8286811">.</span><span class="ident" id="8286812">Errorf</span><span class="op" id="8286818">(</span><span class="string" id="8286819">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="8286864">,</span>&nbsp;<span class="ident" id="8286866">test</span><span class="op" id="8286870">.</span><span class="ident" id="8286871">expectHandshakeErrorIncluding</span><span class="op" id="8286900">,</span>&nbsp;<span class="ident" id="8286902">s</span><span class="op" id="8286903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286916">server</span><span class="op" id="8286922">.</span><span class="ident" id="8286923">Close</span><span class="op" id="8286928">(</span><span class="op" id="8286929">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286933">serverConn</span><span class="op" id="8286943">.</span><span class="ident" id="8286944">Close</span><span class="op" id="8286949">(</span><span class="op" id="8286950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8286954">connStateChan</span>&nbsp;<span class="op" id="8286968">&lt;-</span>&nbsp;<span class="ident" id="8286971">server</span><span class="op" id="8286977">.</span><span class="ident" id="8286978">ConnectionState</span><span class="op" id="8286993">(</span><span class="op" id="8286994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8286997">}</span><span class="op" id="8286998">(</span><span class="op" id="8286999">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287003">if</span>&nbsp;<span class="op" id="8287006">!</span><span class="ident" id="8287007">write</span>&nbsp;<span class="op" id="8287013">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287017">flows</span><span class="op" id="8287022">,</span>&nbsp;<span class="ident" id="8287024">err</span>&nbsp;<span class="op" id="8287028">:=</span>&nbsp;<span class="ident" id="8287031">test</span><span class="op" id="8287035">.</span><span class="ident" id="8287036">loadData</span><span class="op" id="8287044">(</span><span class="op" id="8287045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287049">if</span>&nbsp;<span class="ident" id="8287052">err</span>&nbsp;<span class="op" id="8287056">!=</span>&nbsp;<span class="ident" id="8287059">nil</span>&nbsp;<span class="op" id="8287063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287068">if</span>&nbsp;<span class="op" id="8287071">!</span><span class="ident" id="8287072">test</span><span class="op" id="8287076">.</span><span class="ident" id="8287077">expectAlert</span>&nbsp;<span class="op" id="8287089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287095">t</span><span class="op" id="8287096">.</span><span class="ident" id="8287097">Fatalf</span><span class="op" id="8287103">(</span><span class="string" id="8287104">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="8287137">,</span>&nbsp;<span class="ident" id="8287139">test</span><span class="op" id="8287143">.</span><span class="ident" id="8287144">name</span><span class="op" id="8287148">,</span>&nbsp;<span class="ident" id="8287150">test</span><span class="op" id="8287154">.</span><span class="ident" id="8287155">dataPath</span><span class="op" id="8287163">(</span><span class="op" id="8287164">)</span><span class="op" id="8287165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287170">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287178">for</span>&nbsp;<span class="ident" id="8287182">i</span><span class="op" id="8287183">,</span>&nbsp;<span class="ident" id="8287185">b</span>&nbsp;<span class="op" id="8287187">:=</span>&nbsp;<span class="keyword" id="8287190">range</span>&nbsp;<span class="ident" id="8287196">flows</span>&nbsp;<span class="op" id="8287202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287207">if</span>&nbsp;<span class="ident" id="8287210">i</span><span class="op" id="8287211">%</span><span class="num" id="8287212">2</span>&nbsp;<span class="op" id="8287214">==</span>&nbsp;<span class="num" id="8287217">0</span>&nbsp;<span class="op" id="8287219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287225">clientConn</span><span class="op" id="8287235">.</span><span class="ident" id="8287236">Write</span><span class="op" id="8287241">(</span><span class="ident" id="8287242">b</span><span class="op" id="8287243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287249">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287266">bb</span>&nbsp;<span class="op" id="8287269">:=</span>&nbsp;<span class="builtinfunc" id="8287272">make</span><span class="op" id="8287276">(</span><span class="op" id="8287277">[</span><span class="op" id="8287278">]</span><span class="builtintype" id="8287279">byte</span><span class="op" id="8287283">,</span>&nbsp;<span class="builtinfunc" id="8287285">len</span><span class="op" id="8287288">(</span><span class="ident" id="8287289">b</span><span class="op" id="8287290">)</span><span class="op" id="8287291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287296">n</span><span class="op" id="8287297">,</span>&nbsp;<span class="ident" id="8287299">err</span>&nbsp;<span class="op" id="8287303">:=</span>&nbsp;<span class="ident" id="8287306">io</span><span class="op" id="8287308">.</span><span class="ident" id="8287309">ReadFull</span><span class="op" id="8287317">(</span><span class="ident" id="8287318">clientConn</span><span class="op" id="8287328">,</span>&nbsp;<span class="ident" id="8287330">bb</span><span class="op" id="8287332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287337">if</span>&nbsp;<span class="ident" id="8287340">test</span><span class="op" id="8287344">.</span><span class="ident" id="8287345">expectAlert</span>&nbsp;<span class="op" id="8287357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287363">if</span>&nbsp;<span class="ident" id="8287366">err</span>&nbsp;<span class="op" id="8287370">==</span>&nbsp;<span class="ident" id="8287373">nil</span>&nbsp;<span class="op" id="8287377">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287384">t</span><span class="op" id="8287385">.</span><span class="ident" id="8287386">Fatal</span><span class="op" id="8287391">(</span><span class="string" id="8287392">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="8287434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287445">}</span>&nbsp;<span class="keyword" id="8287447">else</span>&nbsp;<span class="op" id="8287452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287458">if</span>&nbsp;<span class="ident" id="8287461">err</span>&nbsp;<span class="op" id="8287465">!=</span>&nbsp;<span class="ident" id="8287468">nil</span>&nbsp;<span class="op" id="8287472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287479">t</span><span class="op" id="8287480">.</span><span class="ident" id="8287481">Fatalf</span><span class="op" id="8287487">(</span><span class="string" id="8287488">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="8287541">,</span>&nbsp;<span class="ident" id="8287543">test</span><span class="op" id="8287547">.</span><span class="ident" id="8287548">name</span><span class="op" id="8287552">,</span>&nbsp;<span class="ident" id="8287554">i</span><span class="op" id="8287555">+</span><span class="num" id="8287556">1</span><span class="op" id="8287557">,</span>&nbsp;<span class="ident" id="8287559">err</span><span class="op" id="8287562">,</span>&nbsp;<span class="ident" id="8287564">n</span><span class="op" id="8287565">,</span>&nbsp;<span class="builtinfunc" id="8287567">len</span><span class="op" id="8287570">(</span><span class="ident" id="8287571">bb</span><span class="op" id="8287573">)</span><span class="op" id="8287574">,</span>&nbsp;<span class="ident" id="8287576">bb</span><span class="op" id="8287578">[</span><span class="op" id="8287579">:</span><span class="ident" id="8287580">n</span><span class="op" id="8287581">]</span><span class="op" id="8287582">,</span>&nbsp;<span class="ident" id="8287584">b</span><span class="op" id="8287585">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287597">if</span>&nbsp;<span class="op" id="8287600">!</span><span class="ident" id="8287601">bytes</span><span class="op" id="8287606">.</span><span class="ident" id="8287607">Equal</span><span class="op" id="8287612">(</span><span class="ident" id="8287613">b</span><span class="op" id="8287614">,</span>&nbsp;<span class="ident" id="8287616">bb</span><span class="op" id="8287618">)</span>&nbsp;<span class="op" id="8287620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287627">t</span><span class="op" id="8287628">.</span><span class="ident" id="8287629">Fatalf</span><span class="op" id="8287635">(</span><span class="string" id="8287636">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="8287678">,</span>&nbsp;<span class="ident" id="8287680">test</span><span class="op" id="8287684">.</span><span class="ident" id="8287685">name</span><span class="op" id="8287689">,</span>&nbsp;<span class="ident" id="8287691">i</span><span class="op" id="8287692">+</span><span class="num" id="8287693">1</span><span class="op" id="8287694">,</span>&nbsp;<span class="ident" id="8287696">bb</span><span class="op" id="8287698">,</span>&nbsp;<span class="ident" id="8287700">b</span><span class="op" id="8287701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287712">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287720">clientConn</span><span class="op" id="8287730">.</span><span class="ident" id="8287731">Close</span><span class="op" id="8287736">(</span><span class="op" id="8287737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8287740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287744">connState</span>&nbsp;<span class="op" id="8287754">:=</span>&nbsp;<span class="op" id="8287757">&lt;-</span><span class="ident" id="8287759">connStateChan</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287774">peerCerts</span>&nbsp;<span class="op" id="8287784">:=</span>&nbsp;<span class="ident" id="8287787">connState</span><span class="op" id="8287796">.</span><span class="ident" id="8287797">PeerCertificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287815">if</span>&nbsp;<span class="builtinfunc" id="8287818">len</span><span class="op" id="8287821">(</span><span class="ident" id="8287822">peerCerts</span><span class="op" id="8287831">)</span>&nbsp;<span class="op" id="8287833">==</span>&nbsp;<span class="builtinfunc" id="8287836">len</span><span class="op" id="8287839">(</span><span class="ident" id="8287840">test</span><span class="op" id="8287844">.</span><span class="ident" id="8287845">expectedPeerCerts</span><span class="op" id="8287862">)</span>&nbsp;<span class="op" id="8287864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287868">for</span>&nbsp;<span class="ident" id="8287872">i</span><span class="op" id="8287873">,</span>&nbsp;<span class="ident" id="8287875">peerCert</span>&nbsp;<span class="op" id="8287884">:=</span>&nbsp;<span class="keyword" id="8287887">range</span>&nbsp;<span class="ident" id="8287893">peerCerts</span>&nbsp;<span class="op" id="8287903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8287908">block</span><span class="op" id="8287913">,</span>&nbsp;<span class="ident" id="8287915">_</span>&nbsp;<span class="op" id="8287917">:=</span>&nbsp;<span class="ident" id="8287920">pem</span><span class="op" id="8287923">.</span><span class="ident" id="8287924">Decode</span><span class="op" id="8287930">(</span><span class="op" id="8287931">[</span><span class="op" id="8287932">]</span><span class="builtintype" id="8287933">byte</span><span class="op" id="8287937">(</span><span class="ident" id="8287938">test</span><span class="op" id="8287942">.</span><span class="ident" id="8287943">expectedPeerCerts</span><span class="op" id="8287960">[</span><span class="ident" id="8287961">i</span><span class="op" id="8287962">]</span><span class="op" id="8287963">)</span><span class="op" id="8287964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8287969">if</span>&nbsp;<span class="op" id="8287972">!</span><span class="ident" id="8287973">bytes</span><span class="op" id="8287978">.</span><span class="ident" id="8287979">Equal</span><span class="op" id="8287984">(</span><span class="ident" id="8287985">block</span><span class="op" id="8287990">.</span><span class="ident" id="8287991">Bytes</span><span class="op" id="8287996">,</span>&nbsp;<span class="ident" id="8287998">peerCert</span><span class="op" id="8288006">.</span><span class="ident" id="8288007">Raw</span><span class="op" id="8288010">)</span>&nbsp;<span class="op" id="8288012">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288018">t</span><span class="op" id="8288019">.</span><span class="ident" id="8288020">Fatalf</span><span class="op" id="8288026">(</span><span class="string" id="8288027">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="8288057">,</span>&nbsp;<span class="ident" id="8288059">test</span><span class="op" id="8288063">.</span><span class="ident" id="8288064">name</span><span class="op" id="8288068">,</span>&nbsp;<span class="ident" id="8288070">i</span><span class="op" id="8288071">+</span><span class="num" id="8288072">1</span><span class="op" id="8288073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288085">}</span>&nbsp;<span class="keyword" id="8288087">else</span>&nbsp;<span class="op" id="8288092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288096">t</span><span class="op" id="8288097">.</span><span class="ident" id="8288098">Fatalf</span><span class="op" id="8288104">(</span><span class="string" id="8288105">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="8288164">,</span>&nbsp;<span class="ident" id="8288166">test</span><span class="op" id="8288170">.</span><span class="ident" id="8288171">name</span><span class="op" id="8288175">,</span>&nbsp;<span class="builtinfunc" id="8288177">len</span><span class="op" id="8288180">(</span><span class="ident" id="8288181">test</span><span class="op" id="8288185">.</span><span class="ident" id="8288186">expectedPeerCerts</span><span class="op" id="8288203">)</span><span class="op" id="8288204">,</span>&nbsp;<span class="builtinfunc" id="8288206">len</span><span class="op" id="8288209">(</span><span class="ident" id="8288210">peerCerts</span><span class="op" id="8288219">)</span><span class="op" id="8288220">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288227">if</span>&nbsp;<span class="ident" id="8288230">test</span><span class="op" id="8288234">.</span><span class="ident" id="8288235">validate</span>&nbsp;<span class="op" id="8288244">!=</span>&nbsp;<span class="ident" id="8288247">nil</span>&nbsp;<span class="op" id="8288251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288255">if</span>&nbsp;<span class="ident" id="8288258">err</span>&nbsp;<span class="op" id="8288262">:=</span>&nbsp;<span class="ident" id="8288265">test</span><span class="op" id="8288269">.</span><span class="ident" id="8288270">validate</span><span class="op" id="8288278">(</span><span class="ident" id="8288279">connState</span><span class="op" id="8288288">)</span><span class="op" id="8288289">;</span>&nbsp;<span class="ident" id="8288291">err</span>&nbsp;<span class="op" id="8288295">!=</span>&nbsp;<span class="ident" id="8288298">nil</span>&nbsp;<span class="op" id="8288302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288307">t</span><span class="op" id="8288308">.</span><span class="ident" id="8288309">Fatalf</span><span class="op" id="8288315">(</span><span class="string" id="8288316">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8288354">,</span>&nbsp;<span class="ident" id="8288356">err</span><span class="op" id="8288359">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288370">if</span>&nbsp;<span class="ident" id="8288373">write</span>&nbsp;<span class="op" id="8288379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288383">path</span>&nbsp;<span class="op" id="8288388">:=</span>&nbsp;<span class="ident" id="8288391">test</span><span class="op" id="8288395">.</span><span class="ident" id="8288396">dataPath</span><span class="op" id="8288404">(</span><span class="op" id="8288405">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288409">out</span><span class="op" id="8288412">,</span>&nbsp;<span class="ident" id="8288414">err</span>&nbsp;<span class="op" id="8288418">:=</span>&nbsp;<span class="ident" id="8288421">os</span><span class="op" id="8288423">.</span><span class="ident" id="8288424">OpenFile</span><span class="op" id="8288432">(</span><span class="ident" id="8288433">path</span><span class="op" id="8288437">,</span>&nbsp;<span class="ident" id="8288439">os</span><span class="op" id="8288441">.</span><span class="ident" id="8288442">O_WRONLY</span><span class="op" id="8288450">|</span><span class="ident" id="8288451">os</span><span class="op" id="8288453">.</span><span class="ident" id="8288454">O_CREATE</span><span class="op" id="8288462">|</span><span class="ident" id="8288463">os</span><span class="op" id="8288465">.</span><span class="ident" id="8288466">O_TRUNC</span><span class="op" id="8288473">,</span>&nbsp;<span class="num" id="8288475">0644</span><span class="op" id="8288479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288483">if</span>&nbsp;<span class="ident" id="8288486">err</span>&nbsp;<span class="op" id="8288490">!=</span>&nbsp;<span class="ident" id="8288493">nil</span>&nbsp;<span class="op" id="8288497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288502">t</span><span class="op" id="8288503">.</span><span class="ident" id="8288504">Fatalf</span><span class="op" id="8288510">(</span><span class="string" id="8288511">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="8288545">,</span>&nbsp;<span class="ident" id="8288547">err</span><span class="op" id="8288550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288558">defer</span>&nbsp;<span class="ident" id="8288564">out</span><span class="op" id="8288567">.</span><span class="ident" id="8288568">Close</span><span class="op" id="8288573">(</span><span class="op" id="8288574">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288578">recordingConn</span><span class="op" id="8288591">.</span><span class="ident" id="8288592">Close</span><span class="op" id="8288597">(</span><span class="op" id="8288598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288602">if</span>&nbsp;<span class="builtinfunc" id="8288605">len</span><span class="op" id="8288608">(</span><span class="ident" id="8288609">recordingConn</span><span class="op" id="8288622">.</span><span class="ident" id="8288623">flows</span><span class="op" id="8288628">)</span>&nbsp;<span class="op" id="8288630">&lt;</span>&nbsp;<span class="num" id="8288632">3</span>&nbsp;<span class="op" id="8288634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288639">childProcess</span><span class="op" id="8288651">.</span><span class="ident" id="8288652">Stdout</span><span class="op" id="8288658">.</span><span class="op" id="8288659">(</span><span class="op" id="8288660">*</span><span class="ident" id="8288661">bytes</span><span class="op" id="8288666">.</span><span class="ident" id="8288667">Buffer</span><span class="op" id="8288673">)</span><span class="op" id="8288674">.</span><span class="ident" id="8288675">WriteTo</span><span class="op" id="8288682">(</span><span class="ident" id="8288683">os</span><span class="op" id="8288685">.</span><span class="ident" id="8288686">Stdout</span><span class="op" id="8288692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8288697">if</span>&nbsp;<span class="builtinfunc" id="8288700">len</span><span class="op" id="8288703">(</span><span class="ident" id="8288704">test</span><span class="op" id="8288708">.</span><span class="ident" id="8288709">expectHandshakeErrorIncluding</span><span class="op" id="8288738">)</span>&nbsp;<span class="op" id="8288740">==</span>&nbsp;<span class="num" id="8288743">0</span>&nbsp;<span class="op" id="8288745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288751">t</span><span class="op" id="8288752">.</span><span class="ident" id="8288753">Fatalf</span><span class="op" id="8288759">(</span><span class="string" id="8288760">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="8288778">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288791">recordingConn</span><span class="op" id="8288804">.</span><span class="ident" id="8288805">WriteTo</span><span class="op" id="8288812">(</span><span class="ident" id="8288813">out</span><span class="op" id="8288816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288820">fmt</span><span class="op" id="8288823">.</span><span class="ident" id="8288824">Printf</span><span class="op" id="8288830">(</span><span class="string" id="8288831">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="8288843">,</span>&nbsp;<span class="ident" id="8288845">path</span><span class="op" id="8288849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288853">childProcess</span><span class="op" id="8288865">.</span><span class="ident" id="8288866">Wait</span><span class="op" id="8288870">(</span><span class="op" id="8288871">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8288874">}</span><br>
<span class="lineno"></span><span class="op" id="8288876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8288879">func</span>&nbsp;<span class="ident" id="8288884">runServerTestForVersion</span><span class="op" id="8288907">(</span><span class="ident" id="8288908">t</span>&nbsp;<span class="op" id="8288910">*</span><span class="ident" id="8288911">testing</span><span class="op" id="8288918">.</span><span class="ident" id="8288919">T</span><span class="op" id="8288920">,</span>&nbsp;<span class="ident" id="8288922">template</span>&nbsp;<span class="op" id="8288931">*</span><span class="ident" id="8288932">serverTest</span><span class="op" id="8288942">,</span>&nbsp;<span class="ident" id="8288944">prefix</span><span class="op" id="8288950">,</span>&nbsp;<span class="ident" id="8288952">option</span>&nbsp;<span class="builtintype" id="8288959">string</span><span class="op" id="8288965">)</span>&nbsp;<span class="op" id="8288967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288970">test</span>&nbsp;<span class="op" id="8288975">:=</span>&nbsp;<span class="op" id="8288978">*</span><span class="ident" id="8288979">template</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8288989">test</span><span class="op" id="8288993">.</span><span class="ident" id="8288994">name</span>&nbsp;<span class="op" id="8288999">=</span>&nbsp;<span class="ident" id="8289001">prefix</span>&nbsp;<span class="op" id="8289008">+</span>&nbsp;<span class="ident" id="8289010">test</span><span class="op" id="8289014">.</span><span class="ident" id="8289015">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8289021">if</span>&nbsp;<span class="builtinfunc" id="8289024">len</span><span class="op" id="8289027">(</span><span class="ident" id="8289028">test</span><span class="op" id="8289032">.</span><span class="ident" id="8289033">command</span><span class="op" id="8289040">)</span>&nbsp;<span class="op" id="8289042">==</span>&nbsp;<span class="num" id="8289045">0</span>&nbsp;<span class="op" id="8289047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289051">test</span><span class="op" id="8289055">.</span><span class="ident" id="8289056">command</span>&nbsp;<span class="op" id="8289064">=</span>&nbsp;<span class="ident" id="8289066">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8289088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289091">test</span><span class="op" id="8289095">.</span><span class="ident" id="8289096">command</span>&nbsp;<span class="op" id="8289104">=</span>&nbsp;<span class="builtinfunc" id="8289106">append</span><span class="op" id="8289112">(</span><span class="op" id="8289113">[</span><span class="op" id="8289114">]</span><span class="builtintype" id="8289115">string</span><span class="op" id="8289121">(</span><span class="ident" id="8289122">nil</span><span class="op" id="8289125">)</span><span class="op" id="8289126">,</span>&nbsp;<span class="ident" id="8289128">test</span><span class="op" id="8289132">.</span><span class="ident" id="8289133">command</span><span class="op" id="8289140">...</span><span class="op" id="8289143">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289146">test</span><span class="op" id="8289150">.</span><span class="ident" id="8289151">command</span>&nbsp;<span class="op" id="8289159">=</span>&nbsp;<span class="builtinfunc" id="8289161">append</span><span class="op" id="8289167">(</span><span class="ident" id="8289168">test</span><span class="op" id="8289172">.</span><span class="ident" id="8289173">command</span><span class="op" id="8289180">,</span>&nbsp;<span class="ident" id="8289182">option</span><span class="op" id="8289188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289191">test</span><span class="op" id="8289195">.</span><span class="ident" id="8289196">run</span><span class="op" id="8289199">(</span><span class="ident" id="8289200">t</span><span class="op" id="8289201">,</span>&nbsp;<span class="op" id="8289203">*</span><span class="ident" id="8289204">update</span><span class="op" id="8289210">)</span><br>
<span class="lineno"></span><span class="op" id="8289212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8289215">func</span>&nbsp;<span class="ident" id="8289220">runServerTestSSLv3</span><span class="op" id="8289238">(</span><span class="ident" id="8289239">t</span>&nbsp;<span class="op" id="8289241">*</span><span class="ident" id="8289242">testing</span><span class="op" id="8289249">.</span><span class="ident" id="8289250">T</span><span class="op" id="8289251">,</span>&nbsp;<span class="ident" id="8289253">template</span>&nbsp;<span class="op" id="8289262">*</span><span class="ident" id="8289263">serverTest</span><span class="op" id="8289273">)</span>&nbsp;<span class="op" id="8289275">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289278">runServerTestForVersion</span><span class="op" id="8289301">(</span><span class="ident" id="8289302">t</span><span class="op" id="8289303">,</span>&nbsp;<span class="ident" id="8289305">template</span><span class="op" id="8289313">,</span>&nbsp;<span class="string" id="8289315">&#34;SSLv3-&#34;</span><span class="op" id="8289323">,</span>&nbsp;<span class="string" id="8289325">&#34;-ssl3&#34;</span><span class="op" id="8289332">)</span><br>
<span class="lineno"></span><span class="op" id="8289334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8289337">func</span>&nbsp;<span class="ident" id="8289342">runServerTestTLS10</span><span class="op" id="8289360">(</span><span class="ident" id="8289361">t</span>&nbsp;<span class="op" id="8289363">*</span><span class="ident" id="8289364">testing</span><span class="op" id="8289371">.</span><span class="ident" id="8289372">T</span><span class="op" id="8289373">,</span>&nbsp;<span class="ident" id="8289375">template</span>&nbsp;<span class="op" id="8289384">*</span><span class="ident" id="8289385">serverTest</span><span class="op" id="8289395">)</span>&nbsp;<span class="op" id="8289397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289400">runServerTestForVersion</span><span class="op" id="8289423">(</span><span class="ident" id="8289424">t</span><span class="op" id="8289425">,</span>&nbsp;<span class="ident" id="8289427">template</span><span class="op" id="8289435">,</span>&nbsp;<span class="string" id="8289437">&#34;TLSv10-&#34;</span><span class="op" id="8289446">,</span>&nbsp;<span class="string" id="8289448">&#34;-tls1&#34;</span><span class="op" id="8289455">)</span><br>
<span class="lineno">470</span><span class="op" id="8289457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8289460">func</span>&nbsp;<span class="ident" id="8289465">runServerTestTLS11</span><span class="op" id="8289483">(</span><span class="ident" id="8289484">t</span>&nbsp;<span class="op" id="8289486">*</span><span class="ident" id="8289487">testing</span><span class="op" id="8289494">.</span><span class="ident" id="8289495">T</span><span class="op" id="8289496">,</span>&nbsp;<span class="ident" id="8289498">template</span>&nbsp;<span class="op" id="8289507">*</span><span class="ident" id="8289508">serverTest</span><span class="op" id="8289518">)</span>&nbsp;<span class="op" id="8289520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289523">runServerTestForVersion</span><span class="op" id="8289546">(</span><span class="ident" id="8289547">t</span><span class="op" id="8289548">,</span>&nbsp;<span class="ident" id="8289550">template</span><span class="op" id="8289558">,</span>&nbsp;<span class="string" id="8289560">&#34;TLSv11-&#34;</span><span class="op" id="8289569">,</span>&nbsp;<span class="string" id="8289571">&#34;-tls1_1&#34;</span><span class="op" id="8289580">)</span><br>
<span class="lineno"></span><span class="op" id="8289582">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="8289585">func</span>&nbsp;<span class="ident" id="8289590">runServerTestTLS12</span><span class="op" id="8289608">(</span><span class="ident" id="8289609">t</span>&nbsp;<span class="op" id="8289611">*</span><span class="ident" id="8289612">testing</span><span class="op" id="8289619">.</span><span class="ident" id="8289620">T</span><span class="op" id="8289621">,</span>&nbsp;<span class="ident" id="8289623">template</span>&nbsp;<span class="op" id="8289632">*</span><span class="ident" id="8289633">serverTest</span><span class="op" id="8289643">)</span>&nbsp;<span class="op" id="8289645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289648">runServerTestForVersion</span><span class="op" id="8289671">(</span><span class="ident" id="8289672">t</span><span class="op" id="8289673">,</span>&nbsp;<span class="ident" id="8289675">template</span><span class="op" id="8289683">,</span>&nbsp;<span class="string" id="8289685">&#34;TLSv12-&#34;</span><span class="op" id="8289694">,</span>&nbsp;<span class="string" id="8289696">&#34;-tls1_2&#34;</span><span class="op" id="8289705">)</span><br>
<span class="lineno"></span><span class="op" id="8289707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="8289710">func</span>&nbsp;<span class="ident" id="8289715">TestHandshakeServerRSARC4</span><span class="op" id="8289740">(</span><span class="ident" id="8289741">t</span>&nbsp;<span class="op" id="8289743">*</span><span class="ident" id="8289744">testing</span><span class="op" id="8289751">.</span><span class="ident" id="8289752">T</span><span class="op" id="8289753">)</span>&nbsp;<span class="op" id="8289755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289758">test</span>&nbsp;<span class="op" id="8289763">:=</span>&nbsp;<span class="op" id="8289766">&amp;</span><span class="ident" id="8289767">serverTest</span><span class="op" id="8289777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289781">name</span><span class="op" id="8289785">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8289790">&#34;RSA-RC4&#34;</span><span class="op" id="8289799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289803">command</span><span class="op" id="8289810">:</span>&nbsp;<span class="op" id="8289812">[</span><span class="op" id="8289813">]</span><span class="builtintype" id="8289814">string</span><span class="op" id="8289820">{</span><span class="string" id="8289821">&#34;openssl&#34;</span><span class="op" id="8289830">,</span>&nbsp;<span class="string" id="8289832">&#34;s_client&#34;</span><span class="op" id="8289842">,</span>&nbsp;<span class="string" id="8289844">&#34;-no_ticket&#34;</span><span class="op" id="8289856">,</span>&nbsp;<span class="string" id="8289858">&#34;-cipher&#34;</span><span class="op" id="8289867">,</span>&nbsp;<span class="string" id="8289869">&#34;RC4-SHA&#34;</span><span class="op" id="8289878">}</span><span class="op" id="8289879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8289882">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289885">runServerTestSSLv3</span><span class="op" id="8289903">(</span><span class="ident" id="8289904">t</span><span class="op" id="8289905">,</span>&nbsp;<span class="ident" id="8289907">test</span><span class="op" id="8289911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289914">runServerTestTLS10</span><span class="op" id="8289932">(</span><span class="ident" id="8289933">t</span><span class="op" id="8289934">,</span>&nbsp;<span class="ident" id="8289936">test</span><span class="op" id="8289940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289943">runServerTestTLS11</span><span class="op" id="8289961">(</span><span class="ident" id="8289962">t</span><span class="op" id="8289963">,</span>&nbsp;<span class="ident" id="8289965">test</span><span class="op" id="8289969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8289972">runServerTestTLS12</span><span class="op" id="8289990">(</span><span class="ident" id="8289991">t</span><span class="op" id="8289992">,</span>&nbsp;<span class="ident" id="8289994">test</span><span class="op" id="8289998">)</span><br>
<span class="lineno"></span><span class="op" id="8290000">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="8290003">func</span>&nbsp;<span class="ident" id="8290008">TestHandshakeServerRSA3DES</span><span class="op" id="8290034">(</span><span class="ident" id="8290035">t</span>&nbsp;<span class="op" id="8290037">*</span><span class="ident" id="8290038">testing</span><span class="op" id="8290045">.</span><span class="ident" id="8290046">T</span><span class="op" id="8290047">)</span>&nbsp;<span class="op" id="8290049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290052">test</span>&nbsp;<span class="op" id="8290057">:=</span>&nbsp;<span class="op" id="8290060">&amp;</span><span class="ident" id="8290061">serverTest</span><span class="op" id="8290071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290075">name</span><span class="op" id="8290079">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8290084">&#34;RSA-3DES&#34;</span><span class="op" id="8290094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290098">command</span><span class="op" id="8290105">:</span>&nbsp;<span class="op" id="8290107">[</span><span class="op" id="8290108">]</span><span class="builtintype" id="8290109">string</span><span class="op" id="8290115">{</span><span class="string" id="8290116">&#34;openssl&#34;</span><span class="op" id="8290125">,</span>&nbsp;<span class="string" id="8290127">&#34;s_client&#34;</span><span class="op" id="8290137">,</span>&nbsp;<span class="string" id="8290139">&#34;-no_ticket&#34;</span><span class="op" id="8290151">,</span>&nbsp;<span class="string" id="8290153">&#34;-cipher&#34;</span><span class="op" id="8290162">,</span>&nbsp;<span class="string" id="8290164">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="8290178">}</span><span class="op" id="8290179">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290185">runServerTestSSLv3</span><span class="op" id="8290203">(</span><span class="ident" id="8290204">t</span><span class="op" id="8290205">,</span>&nbsp;<span class="ident" id="8290207">test</span><span class="op" id="8290211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290214">runServerTestTLS10</span><span class="op" id="8290232">(</span><span class="ident" id="8290233">t</span><span class="op" id="8290234">,</span>&nbsp;<span class="ident" id="8290236">test</span><span class="op" id="8290240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290243">runServerTestTLS12</span><span class="op" id="8290261">(</span><span class="ident" id="8290262">t</span><span class="op" id="8290263">,</span>&nbsp;<span class="ident" id="8290265">test</span><span class="op" id="8290269">)</span><br>
<span class="lineno"></span><span class="op" id="8290271">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="8290274">func</span>&nbsp;<span class="ident" id="8290279">TestHandshakeServerRSAAES</span><span class="op" id="8290304">(</span><span class="ident" id="8290305">t</span>&nbsp;<span class="op" id="8290307">*</span><span class="ident" id="8290308">testing</span><span class="op" id="8290315">.</span><span class="ident" id="8290316">T</span><span class="op" id="8290317">)</span>&nbsp;<span class="op" id="8290319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290322">test</span>&nbsp;<span class="op" id="8290327">:=</span>&nbsp;<span class="op" id="8290330">&amp;</span><span class="ident" id="8290331">serverTest</span><span class="op" id="8290341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290345">name</span><span class="op" id="8290349">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8290354">&#34;RSA-AES&#34;</span><span class="op" id="8290363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290367">command</span><span class="op" id="8290374">:</span>&nbsp;<span class="op" id="8290376">[</span><span class="op" id="8290377">]</span><span class="builtintype" id="8290378">string</span><span class="op" id="8290384">{</span><span class="string" id="8290385">&#34;openssl&#34;</span><span class="op" id="8290394">,</span>&nbsp;<span class="string" id="8290396">&#34;s_client&#34;</span><span class="op" id="8290406">,</span>&nbsp;<span class="string" id="8290408">&#34;-no_ticket&#34;</span><span class="op" id="8290420">,</span>&nbsp;<span class="string" id="8290422">&#34;-cipher&#34;</span><span class="op" id="8290431">,</span>&nbsp;<span class="string" id="8290433">&#34;AES128-SHA&#34;</span><span class="op" id="8290445">}</span><span class="op" id="8290446">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290452">runServerTestSSLv3</span><span class="op" id="8290470">(</span><span class="ident" id="8290471">t</span><span class="op" id="8290472">,</span>&nbsp;<span class="ident" id="8290474">test</span><span class="op" id="8290478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290481">runServerTestTLS10</span><span class="op" id="8290499">(</span><span class="ident" id="8290500">t</span><span class="op" id="8290501">,</span>&nbsp;<span class="ident" id="8290503">test</span><span class="op" id="8290507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290510">runServerTestTLS12</span><span class="op" id="8290528">(</span><span class="ident" id="8290529">t</span><span class="op" id="8290530">,</span>&nbsp;<span class="ident" id="8290532">test</span><span class="op" id="8290536">)</span><br>
<span class="lineno"></span><span class="op" id="8290538">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="8290541">func</span>&nbsp;<span class="ident" id="8290546">TestHandshakeServerAESGCM</span><span class="op" id="8290571">(</span><span class="ident" id="8290572">t</span>&nbsp;<span class="op" id="8290574">*</span><span class="ident" id="8290575">testing</span><span class="op" id="8290582">.</span><span class="ident" id="8290583">T</span><span class="op" id="8290584">)</span>&nbsp;<span class="op" id="8290586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290589">test</span>&nbsp;<span class="op" id="8290594">:=</span>&nbsp;<span class="op" id="8290597">&amp;</span><span class="ident" id="8290598">serverTest</span><span class="op" id="8290608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290612">name</span><span class="op" id="8290616">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8290621">&#34;RSA-AES-GCM&#34;</span><span class="op" id="8290634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290638">command</span><span class="op" id="8290645">:</span>&nbsp;<span class="op" id="8290647">[</span><span class="op" id="8290648">]</span><span class="builtintype" id="8290649">string</span><span class="op" id="8290655">{</span><span class="string" id="8290656">&#34;openssl&#34;</span><span class="op" id="8290665">,</span>&nbsp;<span class="string" id="8290667">&#34;s_client&#34;</span><span class="op" id="8290677">,</span>&nbsp;<span class="string" id="8290679">&#34;-no_ticket&#34;</span><span class="op" id="8290691">,</span>&nbsp;<span class="string" id="8290693">&#34;-cipher&#34;</span><span class="op" id="8290702">,</span>&nbsp;<span class="string" id="8290704">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="8290733">}</span><span class="op" id="8290734">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8290737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290740">runServerTestTLS12</span><span class="op" id="8290758">(</span><span class="ident" id="8290759">t</span><span class="op" id="8290760">,</span>&nbsp;<span class="ident" id="8290762">test</span><span class="op" id="8290766">)</span><br>
<span class="lineno"></span><span class="op" id="8290768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8290771">func</span>&nbsp;<span class="ident" id="8290776">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="8290808">(</span><span class="ident" id="8290809">t</span>&nbsp;<span class="op" id="8290811">*</span><span class="ident" id="8290812">testing</span><span class="op" id="8290819">.</span><span class="ident" id="8290820">T</span><span class="op" id="8290821">)</span>&nbsp;<span class="op" id="8290823">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290826">config</span>&nbsp;<span class="op" id="8290833">:=</span>&nbsp;<span class="op" id="8290836">*</span><span class="ident" id="8290837">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290849">config</span><span class="op" id="8290855">.</span><span class="ident" id="8290856">Certificates</span>&nbsp;<span class="op" id="8290869">=</span>&nbsp;<span class="builtinfunc" id="8290871">make</span><span class="op" id="8290875">(</span><span class="op" id="8290876">[</span><span class="op" id="8290877">]</span><span class="ident" id="8290878">Certificate</span><span class="op" id="8290889">,</span>&nbsp;<span class="num" id="8290891">1</span><span class="op" id="8290892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290895">config</span><span class="op" id="8290901">.</span><span class="ident" id="8290902">Certificates</span><span class="op" id="8290914">[</span><span class="num" id="8290915">0</span><span class="op" id="8290916">]</span><span class="op" id="8290917">.</span><span class="ident" id="8290918">Certificate</span>&nbsp;<span class="op" id="8290930">=</span>&nbsp;<span class="op" id="8290932">[</span><span class="op" id="8290933">]</span><span class="op" id="8290934">[</span><span class="op" id="8290935">]</span><span class="builtintype" id="8290936">byte</span><span class="op" id="8290940">{</span><span class="ident" id="8290941">testECDSACertificate</span><span class="op" id="8290961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8290964">config</span><span class="op" id="8290970">.</span><span class="ident" id="8290971">Certificates</span><span class="op" id="8290983">[</span><span class="num" id="8290984">0</span><span class="op" id="8290985">]</span><span class="op" id="8290986">.</span><span class="ident" id="8290987">PrivateKey</span>&nbsp;<span class="op" id="8290998">=</span>&nbsp;<span class="ident" id="8291000">testECDSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291021">config</span><span class="op" id="8291027">.</span><span class="ident" id="8291028">BuildNameToCertificate</span><span class="op" id="8291050">(</span><span class="op" id="8291051">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291055">test</span>&nbsp;<span class="op" id="8291060">:=</span>&nbsp;<span class="op" id="8291063">&amp;</span><span class="ident" id="8291064">serverTest</span><span class="op" id="8291074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291078">name</span><span class="op" id="8291082">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8291087">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="8291104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291108">command</span><span class="op" id="8291115">:</span>&nbsp;<span class="op" id="8291117">[</span><span class="op" id="8291118">]</span><span class="builtintype" id="8291119">string</span><span class="op" id="8291125">{</span><span class="string" id="8291126">&#34;openssl&#34;</span><span class="op" id="8291135">,</span>&nbsp;<span class="string" id="8291137">&#34;s_client&#34;</span><span class="op" id="8291147">,</span>&nbsp;<span class="string" id="8291149">&#34;-no_ticket&#34;</span><span class="op" id="8291161">,</span>&nbsp;<span class="string" id="8291163">&#34;-cipher&#34;</span><span class="op" id="8291172">,</span>&nbsp;<span class="string" id="8291174">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="8291198">}</span><span class="op" id="8291199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291203">config</span><span class="op" id="8291209">:</span>&nbsp;&nbsp;<span class="op" id="8291212">&amp;</span><span class="ident" id="8291213">config</span><span class="op" id="8291219">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291225">runServerTestTLS10</span><span class="op" id="8291243">(</span><span class="ident" id="8291244">t</span><span class="op" id="8291245">,</span>&nbsp;<span class="ident" id="8291247">test</span><span class="op" id="8291251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291254">runServerTestTLS12</span><span class="op" id="8291272">(</span><span class="ident" id="8291273">t</span><span class="op" id="8291274">,</span>&nbsp;<span class="ident" id="8291276">test</span><span class="op" id="8291280">)</span><br>
<span class="lineno"></span><span class="op" id="8291282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="8291285">func</span>&nbsp;<span class="ident" id="8291290">TestHandshakeServerALPN</span><span class="op" id="8291313">(</span><span class="ident" id="8291314">t</span>&nbsp;<span class="op" id="8291316">*</span><span class="ident" id="8291317">testing</span><span class="op" id="8291324">.</span><span class="ident" id="8291325">T</span><span class="op" id="8291326">)</span>&nbsp;<span class="op" id="8291328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291331">config</span>&nbsp;<span class="op" id="8291338">:=</span>&nbsp;<span class="op" id="8291341">*</span><span class="ident" id="8291342">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291354">config</span><span class="op" id="8291360">.</span><span class="ident" id="8291361">NextProtos</span>&nbsp;<span class="op" id="8291372">=</span>&nbsp;<span class="op" id="8291374">[</span><span class="op" id="8291375">]</span><span class="builtintype" id="8291376">string</span><span class="op" id="8291382">{</span><span class="string" id="8291383">&#34;proto1&#34;</span><span class="op" id="8291391">,</span>&nbsp;<span class="string" id="8291393">&#34;proto2&#34;</span><span class="op" id="8291401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291405">test</span>&nbsp;<span class="op" id="8291410">:=</span>&nbsp;<span class="op" id="8291413">&amp;</span><span class="ident" id="8291414">serverTest</span><span class="op" id="8291424">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291428">name</span><span class="op" id="8291432">:</span>&nbsp;<span class="string" id="8291434">&#34;ALPN&#34;</span><span class="op" id="8291440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8291444">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8291510">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291553">command</span><span class="op" id="8291560">:</span>&nbsp;<span class="op" id="8291562">[</span><span class="op" id="8291563">]</span><span class="builtintype" id="8291564">string</span><span class="op" id="8291570">{</span><span class="string" id="8291571">&#34;openssl&#34;</span><span class="op" id="8291580">,</span>&nbsp;<span class="string" id="8291582">&#34;s_client&#34;</span><span class="op" id="8291592">,</span>&nbsp;<span class="string" id="8291594">&#34;-alpn&#34;</span><span class="op" id="8291601">,</span>&nbsp;<span class="string" id="8291603">&#34;proto2,proto1&#34;</span><span class="op" id="8291618">}</span><span class="op" id="8291619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291623">config</span><span class="op" id="8291629">:</span>&nbsp;&nbsp;<span class="op" id="8291632">&amp;</span><span class="ident" id="8291633">config</span><span class="op" id="8291639">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291643">validate</span><span class="op" id="8291651">:</span>&nbsp;<span class="keyword" id="8291653">func</span><span class="op" id="8291657">(</span><span class="ident" id="8291658">state</span>&nbsp;<span class="ident" id="8291664">ConnectionState</span><span class="op" id="8291679">)</span>&nbsp;<span class="builtintype" id="8291681">error</span>&nbsp;<span class="op" id="8291687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8291692">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291751">if</span>&nbsp;<span class="ident" id="8291754">state</span><span class="op" id="8291759">.</span><span class="ident" id="8291760">NegotiatedProtocol</span>&nbsp;<span class="op" id="8291779">!=</span>&nbsp;<span class="string" id="8291782">&#34;proto1&#34;</span>&nbsp;<span class="op" id="8291791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291797">return</span>&nbsp;<span class="ident" id="8291804">fmt</span><span class="op" id="8291807">.</span><span class="ident" id="8291808">Errorf</span><span class="op" id="8291814">(</span><span class="string" id="8291815">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="8291847">,</span>&nbsp;<span class="ident" id="8291849">state</span><span class="op" id="8291854">.</span><span class="ident" id="8291855">NegotiatedProtocol</span><span class="op" id="8291873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291878">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8291883">return</span>&nbsp;<span class="ident" id="8291890">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291896">}</span><span class="op" id="8291897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8291900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291903">runServerTestTLS12</span><span class="op" id="8291921">(</span><span class="ident" id="8291922">t</span><span class="op" id="8291923">,</span>&nbsp;<span class="ident" id="8291925">test</span><span class="op" id="8291929">)</span><br>
<span class="lineno"></span><span class="op" id="8291931">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="8291934">func</span>&nbsp;<span class="ident" id="8291939">TestHandshakeServerALPNNoMatch</span><span class="op" id="8291969">(</span><span class="ident" id="8291970">t</span>&nbsp;<span class="op" id="8291972">*</span><span class="ident" id="8291973">testing</span><span class="op" id="8291980">.</span><span class="ident" id="8291981">T</span><span class="op" id="8291982">)</span>&nbsp;<span class="op" id="8291984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8291987">config</span>&nbsp;<span class="op" id="8291994">:=</span>&nbsp;<span class="op" id="8291997">*</span><span class="ident" id="8291998">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292010">config</span><span class="op" id="8292016">.</span><span class="ident" id="8292017">NextProtos</span>&nbsp;<span class="op" id="8292028">=</span>&nbsp;<span class="op" id="8292030">[</span><span class="op" id="8292031">]</span><span class="builtintype" id="8292032">string</span><span class="op" id="8292038">{</span><span class="string" id="8292039">&#34;proto3&#34;</span><span class="op" id="8292047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292051">test</span>&nbsp;<span class="op" id="8292056">:=</span>&nbsp;<span class="op" id="8292059">&amp;</span><span class="ident" id="8292060">serverTest</span><span class="op" id="8292070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292074">name</span><span class="op" id="8292078">:</span>&nbsp;<span class="string" id="8292080">&#34;ALPN-NoMatch&#34;</span><span class="op" id="8292094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8292098">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8292164">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292207">command</span><span class="op" id="8292214">:</span>&nbsp;<span class="op" id="8292216">[</span><span class="op" id="8292217">]</span><span class="builtintype" id="8292218">string</span><span class="op" id="8292224">{</span><span class="string" id="8292225">&#34;openssl&#34;</span><span class="op" id="8292234">,</span>&nbsp;<span class="string" id="8292236">&#34;s_client&#34;</span><span class="op" id="8292246">,</span>&nbsp;<span class="string" id="8292248">&#34;-alpn&#34;</span><span class="op" id="8292255">,</span>&nbsp;<span class="string" id="8292257">&#34;proto2,proto1&#34;</span><span class="op" id="8292272">}</span><span class="op" id="8292273">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292277">config</span><span class="op" id="8292283">:</span>&nbsp;&nbsp;<span class="op" id="8292286">&amp;</span><span class="ident" id="8292287">config</span><span class="op" id="8292293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292297">validate</span><span class="op" id="8292305">:</span>&nbsp;<span class="keyword" id="8292307">func</span><span class="op" id="8292311">(</span><span class="ident" id="8292312">state</span>&nbsp;<span class="ident" id="8292318">ConnectionState</span><span class="op" id="8292333">)</span>&nbsp;<span class="builtintype" id="8292335">error</span>&nbsp;<span class="op" id="8292341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8292346">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8292405">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292448">if</span>&nbsp;<span class="ident" id="8292451">state</span><span class="op" id="8292456">.</span><span class="ident" id="8292457">NegotiatedProtocol</span>&nbsp;<span class="op" id="8292476">!=</span>&nbsp;<span class="string" id="8292479">&#34;&#34;</span>&nbsp;<span class="op" id="8292482">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292488">return</span>&nbsp;<span class="ident" id="8292495">fmt</span><span class="op" id="8292498">.</span><span class="ident" id="8292499">Errorf</span><span class="op" id="8292505">(</span><span class="string" id="8292506">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="8292534">,</span>&nbsp;<span class="ident" id="8292536">state</span><span class="op" id="8292541">.</span><span class="ident" id="8292542">NegotiatedProtocol</span><span class="op" id="8292560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8292570">return</span>&nbsp;<span class="ident" id="8292577">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292583">}</span><span class="op" id="8292584">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8292587">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292590">runServerTestTLS12</span><span class="op" id="8292608">(</span><span class="ident" id="8292609">t</span><span class="op" id="8292610">,</span>&nbsp;<span class="ident" id="8292612">test</span><span class="op" id="8292616">)</span><br>
<span class="lineno"></span><span class="op" id="8292618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8292621">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="8292693">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="8292773">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="8292837">func</span>&nbsp;<span class="ident" id="8292842">TestHandshakeServerSNI</span><span class="op" id="8292864">(</span><span class="ident" id="8292865">t</span>&nbsp;<span class="op" id="8292867">*</span><span class="ident" id="8292868">testing</span><span class="op" id="8292875">.</span><span class="ident" id="8292876">T</span><span class="op" id="8292877">)</span>&nbsp;<span class="op" id="8292879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292882">test</span>&nbsp;<span class="op" id="8292887">:=</span>&nbsp;<span class="op" id="8292890">&amp;</span><span class="ident" id="8292891">serverTest</span><span class="op" id="8292901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292905">name</span><span class="op" id="8292909">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8292914">&#34;SNI&#34;</span><span class="op" id="8292919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8292923">command</span><span class="op" id="8292930">:</span>&nbsp;<span class="op" id="8292932">[</span><span class="op" id="8292933">]</span><span class="builtintype" id="8292934">string</span><span class="op" id="8292940">{</span><span class="string" id="8292941">&#34;openssl&#34;</span><span class="op" id="8292950">,</span>&nbsp;<span class="string" id="8292952">&#34;s_client&#34;</span><span class="op" id="8292962">,</span>&nbsp;<span class="string" id="8292964">&#34;-no_ticket&#34;</span><span class="op" id="8292976">,</span>&nbsp;<span class="string" id="8292978">&#34;-cipher&#34;</span><span class="op" id="8292987">,</span>&nbsp;<span class="string" id="8292989">&#34;AES128-SHA&#34;</span><span class="op" id="8293001">,</span>&nbsp;<span class="string" id="8293003">&#34;-servername&#34;</span><span class="op" id="8293016">,</span>&nbsp;<span class="string" id="8293018">&#34;snitest.com&#34;</span><span class="op" id="8293031">}</span><span class="op" id="8293032">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293038">runServerTestTLS12</span><span class="op" id="8293056">(</span><span class="ident" id="8293057">t</span><span class="op" id="8293058">,</span>&nbsp;<span class="ident" id="8293060">test</span><span class="op" id="8293064">)</span><br>
<span class="lineno"></span><span class="op" id="8293066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8293069">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="8293148">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="8293191">func</span>&nbsp;<span class="ident" id="8293196">TestHandshakeServerSNIGetCertificate</span><span class="op" id="8293232">(</span><span class="ident" id="8293233">t</span>&nbsp;<span class="op" id="8293235">*</span><span class="ident" id="8293236">testing</span><span class="op" id="8293243">.</span><span class="ident" id="8293244">T</span><span class="op" id="8293245">)</span>&nbsp;<span class="op" id="8293247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293250">config</span>&nbsp;<span class="op" id="8293257">:=</span>&nbsp;<span class="op" id="8293260">*</span><span class="ident" id="8293261">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8293274">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293343">nameToCert</span>&nbsp;<span class="op" id="8293354">:=</span>&nbsp;<span class="ident" id="8293357">config</span><span class="op" id="8293363">.</span><span class="ident" id="8293364">NameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293383">config</span><span class="op" id="8293389">.</span><span class="ident" id="8293390">NameToCertificate</span>&nbsp;<span class="op" id="8293408">=</span>&nbsp;<span class="ident" id="8293410">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293415">config</span><span class="op" id="8293421">.</span><span class="ident" id="8293422">GetCertificate</span>&nbsp;<span class="op" id="8293437">=</span>&nbsp;<span class="keyword" id="8293439">func</span><span class="op" id="8293443">(</span><span class="ident" id="8293444">clientHello</span>&nbsp;<span class="op" id="8293456">*</span><span class="ident" id="8293457">ClientHelloInfo</span><span class="op" id="8293472">)</span>&nbsp;<span class="op" id="8293474">(</span><span class="op" id="8293475">*</span><span class="ident" id="8293476">Certificate</span><span class="op" id="8293487">,</span>&nbsp;<span class="builtintype" id="8293489">error</span><span class="op" id="8293494">)</span>&nbsp;<span class="op" id="8293496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293500">cert</span><span class="op" id="8293504">,</span>&nbsp;<span class="ident" id="8293506">_</span>&nbsp;<span class="op" id="8293508">:=</span>&nbsp;<span class="ident" id="8293511">nameToCert</span><span class="op" id="8293521">[</span><span class="ident" id="8293522">clientHello</span><span class="op" id="8293533">.</span><span class="ident" id="8293534">ServerName</span><span class="op" id="8293544">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8293548">return</span>&nbsp;<span class="ident" id="8293555">cert</span><span class="op" id="8293559">,</span>&nbsp;<span class="ident" id="8293561">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293569">test</span>&nbsp;<span class="op" id="8293574">:=</span>&nbsp;<span class="op" id="8293577">&amp;</span><span class="ident" id="8293578">serverTest</span><span class="op" id="8293588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293592">name</span><span class="op" id="8293596">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8293601">&#34;SNI&#34;</span><span class="op" id="8293606">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293610">command</span><span class="op" id="8293617">:</span>&nbsp;<span class="op" id="8293619">[</span><span class="op" id="8293620">]</span><span class="builtintype" id="8293621">string</span><span class="op" id="8293627">{</span><span class="string" id="8293628">&#34;openssl&#34;</span><span class="op" id="8293637">,</span>&nbsp;<span class="string" id="8293639">&#34;s_client&#34;</span><span class="op" id="8293649">,</span>&nbsp;<span class="string" id="8293651">&#34;-no_ticket&#34;</span><span class="op" id="8293663">,</span>&nbsp;<span class="string" id="8293665">&#34;-cipher&#34;</span><span class="op" id="8293674">,</span>&nbsp;<span class="string" id="8293676">&#34;AES128-SHA&#34;</span><span class="op" id="8293688">,</span>&nbsp;<span class="string" id="8293690">&#34;-servername&#34;</span><span class="op" id="8293703">,</span>&nbsp;<span class="string" id="8293705">&#34;snitest.com&#34;</span><span class="op" id="8293718">}</span><span class="op" id="8293719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293723">config</span><span class="op" id="8293729">:</span>&nbsp;&nbsp;<span class="op" id="8293732">&amp;</span><span class="ident" id="8293733">config</span><span class="op" id="8293739">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8293742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8293745">runServerTestTLS12</span><span class="op" id="8293763">(</span><span class="ident" id="8293764">t</span><span class="op" id="8293765">,</span>&nbsp;<span class="ident" id="8293767">test</span><span class="op" id="8293771">)</span><br>
<span class="lineno"></span><span class="op" id="8293773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8293776">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="8293835">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8293910">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8293984">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="8294014">func</span>&nbsp;<span class="ident" id="8294019">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="8294063">(</span><span class="ident" id="8294064">t</span>&nbsp;<span class="op" id="8294066">*</span><span class="ident" id="8294067">testing</span><span class="op" id="8294074">.</span><span class="ident" id="8294075">T</span><span class="op" id="8294076">)</span>&nbsp;<span class="op" id="8294078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294081">config</span>&nbsp;<span class="op" id="8294088">:=</span>&nbsp;<span class="op" id="8294091">*</span><span class="ident" id="8294092">testConfig</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294105">config</span><span class="op" id="8294111">.</span><span class="ident" id="8294112">GetCertificate</span>&nbsp;<span class="op" id="8294127">=</span>&nbsp;<span class="keyword" id="8294129">func</span><span class="op" id="8294133">(</span><span class="ident" id="8294134">clientHello</span>&nbsp;<span class="op" id="8294146">*</span><span class="ident" id="8294147">ClientHelloInfo</span><span class="op" id="8294162">)</span>&nbsp;<span class="op" id="8294164">(</span><span class="op" id="8294165">*</span><span class="ident" id="8294166">Certificate</span><span class="op" id="8294177">,</span>&nbsp;<span class="builtintype" id="8294179">error</span><span class="op" id="8294184">)</span>&nbsp;<span class="op" id="8294186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294190">return</span>&nbsp;<span class="ident" id="8294197">nil</span><span class="op" id="8294200">,</span>&nbsp;<span class="ident" id="8294202">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294210">test</span>&nbsp;<span class="op" id="8294215">:=</span>&nbsp;<span class="op" id="8294218">&amp;</span><span class="ident" id="8294219">serverTest</span><span class="op" id="8294229">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294233">name</span><span class="op" id="8294237">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8294242">&#34;SNI&#34;</span><span class="op" id="8294247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294251">command</span><span class="op" id="8294258">:</span>&nbsp;<span class="op" id="8294260">[</span><span class="op" id="8294261">]</span><span class="builtintype" id="8294262">string</span><span class="op" id="8294268">{</span><span class="string" id="8294269">&#34;openssl&#34;</span><span class="op" id="8294278">,</span>&nbsp;<span class="string" id="8294280">&#34;s_client&#34;</span><span class="op" id="8294290">,</span>&nbsp;<span class="string" id="8294292">&#34;-no_ticket&#34;</span><span class="op" id="8294304">,</span>&nbsp;<span class="string" id="8294306">&#34;-cipher&#34;</span><span class="op" id="8294315">,</span>&nbsp;<span class="string" id="8294317">&#34;AES128-SHA&#34;</span><span class="op" id="8294329">,</span>&nbsp;<span class="string" id="8294331">&#34;-servername&#34;</span><span class="op" id="8294344">,</span>&nbsp;<span class="string" id="8294346">&#34;snitest.com&#34;</span><span class="op" id="8294359">}</span><span class="op" id="8294360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294364">config</span><span class="op" id="8294370">:</span>&nbsp;&nbsp;<span class="op" id="8294373">&amp;</span><span class="ident" id="8294374">config</span><span class="op" id="8294380">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294386">runServerTestTLS12</span><span class="op" id="8294404">(</span><span class="ident" id="8294405">t</span><span class="op" id="8294406">,</span>&nbsp;<span class="ident" id="8294408">test</span><span class="op" id="8294412">)</span><br>
<span class="lineno">625</span><span class="op" id="8294414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8294417">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8294493">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="8294534">func</span>&nbsp;<span class="ident" id="8294539">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="8294580">(</span><span class="ident" id="8294581">t</span>&nbsp;<span class="op" id="8294583">*</span><span class="ident" id="8294584">testing</span><span class="op" id="8294591">.</span><span class="ident" id="8294592">T</span><span class="op" id="8294593">)</span>&nbsp;<span class="op" id="8294595">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294598">config</span>&nbsp;<span class="op" id="8294605">:=</span>&nbsp;<span class="op" id="8294608">*</span><span class="ident" id="8294609">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294622">config</span><span class="op" id="8294628">.</span><span class="ident" id="8294629">GetCertificate</span>&nbsp;<span class="op" id="8294644">=</span>&nbsp;<span class="keyword" id="8294646">func</span><span class="op" id="8294650">(</span><span class="ident" id="8294651">clientHello</span>&nbsp;<span class="op" id="8294663">*</span><span class="ident" id="8294664">ClientHelloInfo</span><span class="op" id="8294679">)</span>&nbsp;<span class="op" id="8294681">(</span><span class="op" id="8294682">*</span><span class="ident" id="8294683">Certificate</span><span class="op" id="8294694">,</span>&nbsp;<span class="builtintype" id="8294696">error</span><span class="op" id="8294701">)</span>&nbsp;<span class="op" id="8294703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8294707">return</span>&nbsp;<span class="ident" id="8294714">nil</span><span class="op" id="8294717">,</span>&nbsp;<span class="ident" id="8294719">fmt</span><span class="op" id="8294722">.</span><span class="ident" id="8294723">Errorf</span><span class="op" id="8294729">(</span><span class="string" id="8294730">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="8294760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294763">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294766">test</span>&nbsp;<span class="op" id="8294771">:=</span>&nbsp;<span class="op" id="8294774">&amp;</span><span class="ident" id="8294775">serverTest</span><span class="op" id="8294785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294789">name</span><span class="op" id="8294793">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8294802">&#34;SNI&#34;</span><span class="op" id="8294807">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294811">command</span><span class="op" id="8294818">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8294824">[</span><span class="op" id="8294825">]</span><span class="builtintype" id="8294826">string</span><span class="op" id="8294832">{</span><span class="string" id="8294833">&#34;openssl&#34;</span><span class="op" id="8294842">,</span>&nbsp;<span class="string" id="8294844">&#34;s_client&#34;</span><span class="op" id="8294854">,</span>&nbsp;<span class="string" id="8294856">&#34;-no_ticket&#34;</span><span class="op" id="8294868">,</span>&nbsp;<span class="string" id="8294870">&#34;-cipher&#34;</span><span class="op" id="8294879">,</span>&nbsp;<span class="string" id="8294881">&#34;AES128-SHA&#34;</span><span class="op" id="8294893">,</span>&nbsp;<span class="string" id="8294895">&#34;-servername&#34;</span><span class="op" id="8294908">,</span>&nbsp;<span class="string" id="8294910">&#34;snitest.com&#34;</span><span class="op" id="8294923">}</span><span class="op" id="8294924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294928">config</span><span class="op" id="8294934">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8294941">&amp;</span><span class="ident" id="8294942">config</span><span class="op" id="8294948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294952">expectAlert</span><span class="op" id="8294963">:</span>&nbsp;<span class="builtintype" id="8294965">true</span><span class="op" id="8294969">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8294972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8294975">runServerTestTLS12</span><span class="op" id="8294993">(</span><span class="ident" id="8294994">t</span><span class="op" id="8294995">,</span>&nbsp;<span class="ident" id="8294997">test</span><span class="op" id="8295001">)</span><br>
<span class="lineno"></span><span class="op" id="8295003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8295006">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="8295086">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="8295160">func</span>&nbsp;<span class="ident" id="8295165">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="8295199">(</span><span class="ident" id="8295200">t</span>&nbsp;<span class="op" id="8295202">*</span><span class="ident" id="8295203">testing</span><span class="op" id="8295210">.</span><span class="ident" id="8295211">T</span><span class="op" id="8295212">)</span>&nbsp;<span class="op" id="8295214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295217">config</span>&nbsp;<span class="op" id="8295224">:=</span>&nbsp;<span class="op" id="8295227">*</span><span class="ident" id="8295228">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295240">config</span><span class="op" id="8295246">.</span><span class="ident" id="8295247">CipherSuites</span>&nbsp;<span class="op" id="8295260">=</span>&nbsp;<span class="op" id="8295262">[</span><span class="op" id="8295263">]</span><span class="builtintype" id="8295264">uint16</span><span class="op" id="8295270">{</span><span class="ident" id="8295271">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8295307">,</span>&nbsp;<span class="ident" id="8295309">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8295343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295346">config</span><span class="op" id="8295352">.</span><span class="ident" id="8295353">PreferServerCipherSuites</span>&nbsp;<span class="op" id="8295378">=</span>&nbsp;<span class="builtintype" id="8295380">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295387">test</span>&nbsp;<span class="op" id="8295392">:=</span>&nbsp;<span class="op" id="8295395">&amp;</span><span class="ident" id="8295396">serverTest</span><span class="op" id="8295406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295410">name</span><span class="op" id="8295414">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8295418">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="8295448">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295452">config</span><span class="op" id="8295458">:</span>&nbsp;<span class="op" id="8295460">&amp;</span><span class="ident" id="8295461">config</span><span class="op" id="8295467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8295470">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295473">runServerTestTLS12</span><span class="op" id="8295491">(</span><span class="ident" id="8295492">t</span><span class="op" id="8295493">,</span>&nbsp;<span class="ident" id="8295495">test</span><span class="op" id="8295499">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295503">config</span>&nbsp;<span class="op" id="8295510">=</span>&nbsp;<span class="op" id="8295512">*</span><span class="ident" id="8295513">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295525">config</span><span class="op" id="8295531">.</span><span class="ident" id="8295532">CipherSuites</span>&nbsp;<span class="op" id="8295545">=</span>&nbsp;<span class="op" id="8295547">[</span><span class="op" id="8295548">]</span><span class="builtintype" id="8295549">uint16</span><span class="op" id="8295555">{</span><span class="ident" id="8295556">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8295590">,</span>&nbsp;<span class="ident" id="8295592">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8295628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295631">config</span><span class="op" id="8295637">.</span><span class="ident" id="8295638">Certificates</span>&nbsp;<span class="op" id="8295651">=</span>&nbsp;<span class="op" id="8295653">[</span><span class="op" id="8295654">]</span><span class="ident" id="8295655">Certificate</span><span class="op" id="8295666">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8295670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295675">Certificate</span><span class="op" id="8295686">:</span>&nbsp;<span class="op" id="8295688">[</span><span class="op" id="8295689">]</span><span class="op" id="8295690">[</span><span class="op" id="8295691">]</span><span class="builtintype" id="8295692">byte</span><span class="op" id="8295696">{</span><span class="ident" id="8295697">testECDSACertificate</span><span class="op" id="8295717">}</span><span class="op" id="8295718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295723">PrivateKey</span><span class="op" id="8295733">:</span>&nbsp;&nbsp;<span class="ident" id="8295736">testECDSAPrivateKey</span><span class="op" id="8295755">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8295759">}</span><span class="op" id="8295760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8295763">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295766">config</span><span class="op" id="8295772">.</span><span class="ident" id="8295773">BuildNameToCertificate</span><span class="op" id="8295795">(</span><span class="op" id="8295796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295799">config</span><span class="op" id="8295805">.</span><span class="ident" id="8295806">PreferServerCipherSuites</span>&nbsp;<span class="op" id="8295831">=</span>&nbsp;<span class="builtintype" id="8295833">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295840">test</span>&nbsp;<span class="op" id="8295845">=</span>&nbsp;<span class="op" id="8295847">&amp;</span><span class="ident" id="8295848">serverTest</span><span class="op" id="8295858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295862">name</span><span class="op" id="8295866">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8295870">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="8295902">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295906">config</span><span class="op" id="8295912">:</span>&nbsp;<span class="op" id="8295914">&amp;</span><span class="ident" id="8295915">config</span><span class="op" id="8295921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8295924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295927">runServerTestTLS12</span><span class="op" id="8295945">(</span><span class="ident" id="8295946">t</span><span class="op" id="8295947">,</span>&nbsp;<span class="ident" id="8295949">test</span><span class="op" id="8295953">)</span><br>
<span class="lineno"></span><span class="op" id="8295955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="8295958">func</span>&nbsp;<span class="ident" id="8295963">TestResumption</span><span class="op" id="8295977">(</span><span class="ident" id="8295978">t</span>&nbsp;<span class="op" id="8295980">*</span><span class="ident" id="8295981">testing</span><span class="op" id="8295988">.</span><span class="ident" id="8295989">T</span><span class="op" id="8295990">)</span>&nbsp;<span class="op" id="8295992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8295995">sessionFilePath</span>&nbsp;<span class="op" id="8296011">:=</span>&nbsp;<span class="ident" id="8296014">tempFile</span><span class="op" id="8296022">(</span><span class="string" id="8296023">&#34;&#34;</span><span class="op" id="8296025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8296028">defer</span>&nbsp;<span class="ident" id="8296034">os</span><span class="op" id="8296036">.</span><span class="ident" id="8296037">Remove</span><span class="op" id="8296043">(</span><span class="ident" id="8296044">sessionFilePath</span><span class="op" id="8296059">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296063">test</span>&nbsp;<span class="op" id="8296068">:=</span>&nbsp;<span class="op" id="8296071">&amp;</span><span class="ident" id="8296072">serverTest</span><span class="op" id="8296082">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296086">name</span><span class="op" id="8296090">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8296095">&#34;IssueTicket&#34;</span><span class="op" id="8296108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296112">command</span><span class="op" id="8296119">:</span>&nbsp;<span class="op" id="8296121">[</span><span class="op" id="8296122">]</span><span class="builtintype" id="8296123">string</span><span class="op" id="8296129">{</span><span class="string" id="8296130">&#34;openssl&#34;</span><span class="op" id="8296139">,</span>&nbsp;<span class="string" id="8296141">&#34;s_client&#34;</span><span class="op" id="8296151">,</span>&nbsp;<span class="string" id="8296153">&#34;-cipher&#34;</span><span class="op" id="8296162">,</span>&nbsp;<span class="string" id="8296164">&#34;RC4-SHA&#34;</span><span class="op" id="8296173">,</span>&nbsp;<span class="string" id="8296175">&#34;-sess_out&#34;</span><span class="op" id="8296186">,</span>&nbsp;<span class="ident" id="8296188">sessionFilePath</span><span class="op" id="8296203">}</span><span class="op" id="8296204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8296207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296210">runServerTestTLS12</span><span class="op" id="8296228">(</span><span class="ident" id="8296229">t</span><span class="op" id="8296230">,</span>&nbsp;<span class="ident" id="8296232">test</span><span class="op" id="8296236">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296240">test</span>&nbsp;<span class="op" id="8296245">=</span>&nbsp;<span class="op" id="8296247">&amp;</span><span class="ident" id="8296248">serverTest</span><span class="op" id="8296258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296262">name</span><span class="op" id="8296266">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8296271">&#34;Resume&#34;</span><span class="op" id="8296279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296283">command</span><span class="op" id="8296290">:</span>&nbsp;<span class="op" id="8296292">[</span><span class="op" id="8296293">]</span><span class="builtintype" id="8296294">string</span><span class="op" id="8296300">{</span><span class="string" id="8296301">&#34;openssl&#34;</span><span class="op" id="8296310">,</span>&nbsp;<span class="string" id="8296312">&#34;s_client&#34;</span><span class="op" id="8296322">,</span>&nbsp;<span class="string" id="8296324">&#34;-cipher&#34;</span><span class="op" id="8296333">,</span>&nbsp;<span class="string" id="8296335">&#34;RC4-SHA&#34;</span><span class="op" id="8296344">,</span>&nbsp;<span class="string" id="8296346">&#34;-sess_in&#34;</span><span class="op" id="8296356">,</span>&nbsp;<span class="ident" id="8296358">sessionFilePath</span><span class="op" id="8296373">}</span><span class="op" id="8296374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8296377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296380">runServerTestTLS12</span><span class="op" id="8296398">(</span><span class="ident" id="8296399">t</span><span class="op" id="8296400">,</span>&nbsp;<span class="ident" id="8296402">test</span><span class="op" id="8296406">)</span><br>
<span class="lineno">690</span><span class="op" id="8296408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8296411">func</span>&nbsp;<span class="ident" id="8296416">TestResumptionDisabled</span><span class="op" id="8296438">(</span><span class="ident" id="8296439">t</span>&nbsp;<span class="op" id="8296441">*</span><span class="ident" id="8296442">testing</span><span class="op" id="8296449">.</span><span class="ident" id="8296450">T</span><span class="op" id="8296451">)</span>&nbsp;<span class="op" id="8296453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296456">sessionFilePath</span>&nbsp;<span class="op" id="8296472">:=</span>&nbsp;<span class="ident" id="8296475">tempFile</span><span class="op" id="8296483">(</span><span class="string" id="8296484">&#34;&#34;</span><span class="op" id="8296486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8296489">defer</span>&nbsp;<span class="ident" id="8296495">os</span><span class="op" id="8296497">.</span><span class="ident" id="8296498">Remove</span><span class="op" id="8296504">(</span><span class="ident" id="8296505">sessionFilePath</span><span class="op" id="8296520">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296524">config</span>&nbsp;<span class="op" id="8296531">:=</span>&nbsp;<span class="op" id="8296534">*</span><span class="ident" id="8296535">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296548">test</span>&nbsp;<span class="op" id="8296553">:=</span>&nbsp;<span class="op" id="8296556">&amp;</span><span class="ident" id="8296557">serverTest</span><span class="op" id="8296567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296571">name</span><span class="op" id="8296575">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8296580">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="8296603">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296607">command</span><span class="op" id="8296614">:</span>&nbsp;<span class="op" id="8296616">[</span><span class="op" id="8296617">]</span><span class="builtintype" id="8296618">string</span><span class="op" id="8296624">{</span><span class="string" id="8296625">&#34;openssl&#34;</span><span class="op" id="8296634">,</span>&nbsp;<span class="string" id="8296636">&#34;s_client&#34;</span><span class="op" id="8296646">,</span>&nbsp;<span class="string" id="8296648">&#34;-cipher&#34;</span><span class="op" id="8296657">,</span>&nbsp;<span class="string" id="8296659">&#34;RC4-SHA&#34;</span><span class="op" id="8296668">,</span>&nbsp;<span class="string" id="8296670">&#34;-sess_out&#34;</span><span class="op" id="8296681">,</span>&nbsp;<span class="ident" id="8296683">sessionFilePath</span><span class="op" id="8296698">}</span><span class="op" id="8296699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296703">config</span><span class="op" id="8296709">:</span>&nbsp;&nbsp;<span class="op" id="8296712">&amp;</span><span class="ident" id="8296713">config</span><span class="op" id="8296719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8296722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296725">runServerTestTLS12</span><span class="op" id="8296743">(</span><span class="ident" id="8296744">t</span><span class="op" id="8296745">,</span>&nbsp;<span class="ident" id="8296747">test</span><span class="op" id="8296751">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296755">config</span><span class="op" id="8296761">.</span><span class="ident" id="8296762">SessionTicketsDisabled</span>&nbsp;<span class="op" id="8296785">=</span>&nbsp;<span class="builtintype" id="8296787">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296794">test</span>&nbsp;<span class="op" id="8296799">=</span>&nbsp;<span class="op" id="8296801">&amp;</span><span class="ident" id="8296802">serverTest</span><span class="op" id="8296812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296816">name</span><span class="op" id="8296820">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8296825">&#34;ResumeDisabled&#34;</span><span class="op" id="8296841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296845">command</span><span class="op" id="8296852">:</span>&nbsp;<span class="op" id="8296854">[</span><span class="op" id="8296855">]</span><span class="builtintype" id="8296856">string</span><span class="op" id="8296862">{</span><span class="string" id="8296863">&#34;openssl&#34;</span><span class="op" id="8296872">,</span>&nbsp;<span class="string" id="8296874">&#34;s_client&#34;</span><span class="op" id="8296884">,</span>&nbsp;<span class="string" id="8296886">&#34;-cipher&#34;</span><span class="op" id="8296895">,</span>&nbsp;<span class="string" id="8296897">&#34;RC4-SHA&#34;</span><span class="op" id="8296906">,</span>&nbsp;<span class="string" id="8296908">&#34;-sess_in&#34;</span><span class="op" id="8296918">,</span>&nbsp;<span class="ident" id="8296920">sessionFilePath</span><span class="op" id="8296935">}</span><span class="op" id="8296936">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296940">config</span><span class="op" id="8296946">:</span>&nbsp;&nbsp;<span class="op" id="8296949">&amp;</span><span class="ident" id="8296950">config</span><span class="op" id="8296956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8296959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8296962">runServerTestTLS12</span><span class="op" id="8296980">(</span><span class="ident" id="8296981">t</span><span class="op" id="8296982">,</span>&nbsp;<span class="ident" id="8296984">test</span><span class="op" id="8296988">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8296992">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8297064">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="8297132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8297135">func</span>&nbsp;<span class="ident" id="8297140">TestFallbackSCSV</span><span class="op" id="8297156">(</span><span class="ident" id="8297157">t</span>&nbsp;<span class="op" id="8297159">*</span><span class="ident" id="8297160">testing</span><span class="op" id="8297167">.</span><span class="ident" id="8297168">T</span><span class="op" id="8297169">)</span>&nbsp;<span class="op" id="8297171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8297174">test</span>&nbsp;<span class="op" id="8297179">:=</span>&nbsp;<span class="op" id="8297182">&amp;</span><span class="ident" id="8297183">serverTest</span><span class="op" id="8297193">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8297197">name</span><span class="op" id="8297201">:</span>&nbsp;<span class="string" id="8297203">&#34;FallbackSCSV&#34;</span><span class="op" id="8297217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8297221">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8297282">command</span><span class="op" id="8297289">:</span>&nbsp;<span class="op" id="8297291">[</span><span class="op" id="8297292">]</span><span class="builtintype" id="8297293">string</span><span class="op" id="8297299">{</span><span class="string" id="8297300">&#34;openssl&#34;</span><span class="op" id="8297309">,</span>&nbsp;<span class="string" id="8297311">&#34;s_client&#34;</span><span class="op" id="8297321">,</span>&nbsp;<span class="string" id="8297323">&#34;-fallback_scsv&#34;</span><span class="op" id="8297339">}</span><span class="op" id="8297340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8297344">expectHandshakeErrorIncluding</span><span class="op" id="8297373">:</span>&nbsp;<span class="string" id="8297375">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="8297407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8297410">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8297413">runServerTestTLS11</span><span class="op" id="8297431">(</span><span class="ident" id="8297432">t</span><span class="op" id="8297433">,</span>&nbsp;<span class="ident" id="8297435">test</span><span class="op" id="8297439">)</span><br>
<span class="lineno"></span><span class="op" id="8297441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8297444">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="8297505">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="8297567">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8297603">const</span>&nbsp;<span class="ident" id="8297609">clientCertificatePEM</span>&nbsp;<span class="op" id="8297630">=</span>&nbsp;<span class="string" id="8297632">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8298365">const</span>&nbsp;<span class="ident" id="8298371">clientKeyPEM</span>&nbsp;<span class="op" id="8298384">=</span>&nbsp;<span class="string" id="8298386">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8299273">const</span>&nbsp;<span class="ident" id="8299279">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="8299305">=</span>&nbsp;<span class="string" id="8299307">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8300060">const</span>&nbsp;<span class="ident" id="8300066">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="8300084">=</span>&nbsp;<span class="string" id="8300086">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="8300526">func</span>&nbsp;<span class="ident" id="8300531">TestClientAuth</span><span class="op" id="8300545">(</span><span class="ident" id="8300546">t</span>&nbsp;<span class="op" id="8300548">*</span><span class="ident" id="8300549">testing</span><span class="op" id="8300556">.</span><span class="ident" id="8300557">T</span><span class="op" id="8300558">)</span>&nbsp;<span class="op" id="8300560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300563">var</span>&nbsp;<span class="ident" id="8300567">certPath</span><span class="op" id="8300575">,</span>&nbsp;<span class="ident" id="8300577">keyPath</span><span class="op" id="8300584">,</span>&nbsp;<span class="ident" id="8300586">ecdsaCertPath</span><span class="op" id="8300599">,</span>&nbsp;<span class="ident" id="8300601">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="8300614">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300623">if</span>&nbsp;<span class="op" id="8300626">*</span><span class="ident" id="8300627">update</span>&nbsp;<span class="op" id="8300634">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300638">certPath</span>&nbsp;<span class="op" id="8300647">=</span>&nbsp;<span class="ident" id="8300649">tempFile</span><span class="op" id="8300657">(</span><span class="ident" id="8300658">clientCertificatePEM</span><span class="op" id="8300678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300682">defer</span>&nbsp;<span class="ident" id="8300688">os</span><span class="op" id="8300690">.</span><span class="ident" id="8300691">Remove</span><span class="op" id="8300697">(</span><span class="ident" id="8300698">certPath</span><span class="op" id="8300706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300710">keyPath</span>&nbsp;<span class="op" id="8300718">=</span>&nbsp;<span class="ident" id="8300720">tempFile</span><span class="op" id="8300728">(</span><span class="ident" id="8300729">clientKeyPEM</span><span class="op" id="8300741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300745">defer</span>&nbsp;<span class="ident" id="8300751">os</span><span class="op" id="8300753">.</span><span class="ident" id="8300754">Remove</span><span class="op" id="8300760">(</span><span class="ident" id="8300761">keyPath</span><span class="op" id="8300768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300772">ecdsaCertPath</span>&nbsp;<span class="op" id="8300786">=</span>&nbsp;<span class="ident" id="8300788">tempFile</span><span class="op" id="8300796">(</span><span class="ident" id="8300797">clientECDSACertificatePEM</span><span class="op" id="8300822">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300826">defer</span>&nbsp;<span class="ident" id="8300832">os</span><span class="op" id="8300834">.</span><span class="ident" id="8300835">Remove</span><span class="op" id="8300841">(</span><span class="ident" id="8300842">ecdsaCertPath</span><span class="op" id="8300855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300859">ecdsaKeyPath</span>&nbsp;<span class="op" id="8300872">=</span>&nbsp;<span class="ident" id="8300874">tempFile</span><span class="op" id="8300882">(</span><span class="ident" id="8300883">clientECDSAKeyPEM</span><span class="op" id="8300900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8300904">defer</span>&nbsp;<span class="ident" id="8300910">os</span><span class="op" id="8300912">.</span><span class="ident" id="8300913">Remove</span><span class="op" id="8300919">(</span><span class="ident" id="8300920">ecdsaKeyPath</span><span class="op" id="8300932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8300935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300939">config</span>&nbsp;<span class="op" id="8300946">:=</span>&nbsp;<span class="op" id="8300949">*</span><span class="ident" id="8300950">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8300962">config</span><span class="op" id="8300968">.</span><span class="ident" id="8300969">ClientAuth</span>&nbsp;<span class="op" id="8300980">=</span>&nbsp;<span class="ident" id="8300982">RequestClientCert</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301002">test</span>&nbsp;<span class="op" id="8301007">:=</span>&nbsp;<span class="op" id="8301010">&amp;</span><span class="ident" id="8301011">serverTest</span><span class="op" id="8301021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301025">name</span><span class="op" id="8301029">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8301034">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="8301063">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301067">command</span><span class="op" id="8301074">:</span>&nbsp;<span class="op" id="8301076">[</span><span class="op" id="8301077">]</span><span class="builtintype" id="8301078">string</span><span class="op" id="8301084">{</span><span class="string" id="8301085">&#34;openssl&#34;</span><span class="op" id="8301094">,</span>&nbsp;<span class="string" id="8301096">&#34;s_client&#34;</span><span class="op" id="8301106">,</span>&nbsp;<span class="string" id="8301108">&#34;-no_ticket&#34;</span><span class="op" id="8301120">,</span>&nbsp;<span class="string" id="8301122">&#34;-cipher&#34;</span><span class="op" id="8301131">,</span>&nbsp;<span class="string" id="8301133">&#34;RC4-SHA&#34;</span><span class="op" id="8301142">}</span><span class="op" id="8301143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301147">config</span><span class="op" id="8301153">:</span>&nbsp;&nbsp;<span class="op" id="8301156">&amp;</span><span class="ident" id="8301157">config</span><span class="op" id="8301163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301169">runServerTestTLS12</span><span class="op" id="8301187">(</span><span class="ident" id="8301188">t</span><span class="op" id="8301189">,</span>&nbsp;<span class="ident" id="8301191">test</span><span class="op" id="8301195">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301199">test</span>&nbsp;<span class="op" id="8301204">=</span>&nbsp;<span class="op" id="8301206">&amp;</span><span class="ident" id="8301207">serverTest</span><span class="op" id="8301217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301221">name</span><span class="op" id="8301225">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8301240">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="8301269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301273">command</span><span class="op" id="8301280">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8301292">[</span><span class="op" id="8301293">]</span><span class="builtintype" id="8301294">string</span><span class="op" id="8301300">{</span><span class="string" id="8301301">&#34;openssl&#34;</span><span class="op" id="8301310">,</span>&nbsp;<span class="string" id="8301312">&#34;s_client&#34;</span><span class="op" id="8301322">,</span>&nbsp;<span class="string" id="8301324">&#34;-no_ticket&#34;</span><span class="op" id="8301336">,</span>&nbsp;<span class="string" id="8301338">&#34;-cipher&#34;</span><span class="op" id="8301347">,</span>&nbsp;<span class="string" id="8301349">&#34;RC4-SHA&#34;</span><span class="op" id="8301358">,</span>&nbsp;<span class="string" id="8301360">&#34;-cert&#34;</span><span class="op" id="8301367">,</span>&nbsp;<span class="ident" id="8301369">certPath</span><span class="op" id="8301377">,</span>&nbsp;<span class="string" id="8301379">&#34;-key&#34;</span><span class="op" id="8301385">,</span>&nbsp;<span class="ident" id="8301387">keyPath</span><span class="op" id="8301394">}</span><span class="op" id="8301395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301399">config</span><span class="op" id="8301405">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8301418">&amp;</span><span class="ident" id="8301419">config</span><span class="op" id="8301425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301429">expectedPeerCerts</span><span class="op" id="8301446">:</span>&nbsp;<span class="op" id="8301448">[</span><span class="op" id="8301449">]</span><span class="builtintype" id="8301450">string</span><span class="op" id="8301456">{</span><span class="ident" id="8301457">clientCertificatePEM</span><span class="op" id="8301477">}</span><span class="op" id="8301478">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301484">runServerTestTLS12</span><span class="op" id="8301502">(</span><span class="ident" id="8301503">t</span><span class="op" id="8301504">,</span>&nbsp;<span class="ident" id="8301506">test</span><span class="op" id="8301510">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301514">test</span>&nbsp;<span class="op" id="8301519">=</span>&nbsp;<span class="op" id="8301521">&amp;</span><span class="ident" id="8301522">serverTest</span><span class="op" id="8301532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301536">name</span><span class="op" id="8301540">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8301555">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="8301589">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301593">command</span><span class="op" id="8301600">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8301612">[</span><span class="op" id="8301613">]</span><span class="builtintype" id="8301614">string</span><span class="op" id="8301620">{</span><span class="string" id="8301621">&#34;openssl&#34;</span><span class="op" id="8301630">,</span>&nbsp;<span class="string" id="8301632">&#34;s_client&#34;</span><span class="op" id="8301642">,</span>&nbsp;<span class="string" id="8301644">&#34;-no_ticket&#34;</span><span class="op" id="8301656">,</span>&nbsp;<span class="string" id="8301658">&#34;-cipher&#34;</span><span class="op" id="8301667">,</span>&nbsp;<span class="string" id="8301669">&#34;RC4-SHA&#34;</span><span class="op" id="8301678">,</span>&nbsp;<span class="string" id="8301680">&#34;-cert&#34;</span><span class="op" id="8301687">,</span>&nbsp;<span class="ident" id="8301689">ecdsaCertPath</span><span class="op" id="8301702">,</span>&nbsp;<span class="string" id="8301704">&#34;-key&#34;</span><span class="op" id="8301710">,</span>&nbsp;<span class="ident" id="8301712">ecdsaKeyPath</span><span class="op" id="8301724">}</span><span class="op" id="8301725">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301729">config</span><span class="op" id="8301735">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8301748">&amp;</span><span class="ident" id="8301749">config</span><span class="op" id="8301755">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301759">expectedPeerCerts</span><span class="op" id="8301776">:</span>&nbsp;<span class="op" id="8301778">[</span><span class="op" id="8301779">]</span><span class="builtintype" id="8301780">string</span><span class="op" id="8301786">{</span><span class="ident" id="8301787">clientECDSACertificatePEM</span><span class="op" id="8301812">}</span><span class="op" id="8301813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8301816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301819">runServerTestTLS12</span><span class="op" id="8301837">(</span><span class="ident" id="8301838">t</span><span class="op" id="8301839">,</span>&nbsp;<span class="ident" id="8301841">test</span><span class="op" id="8301845">)</span><br>
<span class="lineno">830</span><span class="op" id="8301847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8301850">func</span>&nbsp;<span class="ident" id="8301855">bigFromString</span><span class="op" id="8301868">(</span><span class="ident" id="8301869">s</span>&nbsp;<span class="builtintype" id="8301871">string</span><span class="op" id="8301877">)</span>&nbsp;<span class="op" id="8301879">*</span><span class="ident" id="8301880">big</span><span class="op" id="8301883">.</span><span class="ident" id="8301884">Int</span>&nbsp;<span class="op" id="8301888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301891">ret</span>&nbsp;<span class="op" id="8301895">:=</span>&nbsp;<span class="builtinfunc" id="8301898">new</span><span class="op" id="8301901">(</span><span class="ident" id="8301902">big</span><span class="op" id="8301905">.</span><span class="ident" id="8301906">Int</span><span class="op" id="8301909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301912">ret</span><span class="op" id="8301915">.</span><span class="ident" id="8301916">SetString</span><span class="op" id="8301925">(</span><span class="ident" id="8301926">s</span><span class="op" id="8301927">,</span>&nbsp;<span class="num" id="8301929">10</span><span class="op" id="8301931">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8301934">return</span>&nbsp;<span class="ident" id="8301941">ret</span><br>
<span class="lineno"></span><span class="op" id="8301945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8301948">func</span>&nbsp;<span class="ident" id="8301953">fromHex</span><span class="op" id="8301960">(</span><span class="ident" id="8301961">s</span>&nbsp;<span class="builtintype" id="8301963">string</span><span class="op" id="8301969">)</span>&nbsp;<span class="op" id="8301971">[</span><span class="op" id="8301972">]</span><span class="builtintype" id="8301973">byte</span>&nbsp;<span class="op" id="8301978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8301981">b</span><span class="op" id="8301982">,</span>&nbsp;<span class="ident" id="8301984">_</span>&nbsp;<span class="op" id="8301986">:=</span>&nbsp;<span class="ident" id="8301989">hex</span><span class="op" id="8301992">.</span><span class="ident" id="8301993">DecodeString</span><span class="op" id="8302005">(</span><span class="ident" id="8302006">s</span><span class="op" id="8302007">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8302010">return</span>&nbsp;<span class="ident" id="8302017">b</span><br>
<span class="lineno"></span><span class="op" id="8302019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8302022">var</span>&nbsp;<span class="ident" id="8302026">testRSACertificate</span>&nbsp;<span class="op" id="8302045">=</span>&nbsp;<span class="ident" id="8302047">fromHex</span><span class="op" id="8302054">(</span><span class="string" id="8302055">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="8303441">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="8303444">var</span>&nbsp;<span class="ident" id="8303448">testECDSACertificate</span>&nbsp;<span class="op" id="8303469">=</span>&nbsp;<span class="ident" id="8303471">fromHex</span><span class="op" id="8303478">(</span><span class="string" id="8303479">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="8304513">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8304516">var</span>&nbsp;<span class="ident" id="8304520">testSNICertificate</span>&nbsp;<span class="op" id="8304539">=</span>&nbsp;<span class="ident" id="8304541">fromHex</span><span class="op" id="8304548">(</span><span class="string" id="8304549">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="8305555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8305558">var</span>&nbsp;<span class="ident" id="8305562">testRSAPrivateKey</span>&nbsp;<span class="op" id="8305580">=</span>&nbsp;<span class="op" id="8305582">&amp;</span><span class="ident" id="8305583">rsa</span><span class="op" id="8305586">.</span><span class="ident" id="8305587">PrivateKey</span><span class="op" id="8305597">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305600">PublicKey</span><span class="op" id="8305609">:</span>&nbsp;<span class="ident" id="8305611">rsa</span><span class="op" id="8305614">.</span><span class="ident" id="8305615">PublicKey</span><span class="op" id="8305624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305628">N</span><span class="op" id="8305629">:</span>&nbsp;<span class="ident" id="8305631">bigFromString</span><span class="op" id="8305644">(</span><span class="string" id="8305645">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="8305956">)</span><span class="op" id="8305957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305961">E</span><span class="op" id="8305962">:</span>&nbsp;<span class="num" id="8305964">65537</span><span class="op" id="8305969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8305972">}</span><span class="op" id="8305973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8305976">D</span><span class="op" id="8305977">:</span>&nbsp;<span class="ident" id="8305979">bigFromString</span><span class="op" id="8305992">(</span><span class="string" id="8305993">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="8306303">)</span><span class="op" id="8306304">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306307">Primes</span><span class="op" id="8306313">:</span>&nbsp;<span class="op" id="8306315">[</span><span class="op" id="8306316">]</span><span class="op" id="8306317">*</span><span class="ident" id="8306318">big</span><span class="op" id="8306321">.</span><span class="ident" id="8306322">Int</span><span class="op" id="8306325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306329">bigFromString</span><span class="op" id="8306342">(</span><span class="string" id="8306343">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="8306500">)</span><span class="op" id="8306501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306505">bigFromString</span><span class="op" id="8306518">(</span><span class="string" id="8306519">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="8306676">)</span><span class="op" id="8306677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8306680">}</span><span class="op" id="8306681">,</span><br>
<span class="lineno"></span><span class="op" id="8306683">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="8306686">var</span>&nbsp;<span class="ident" id="8306690">testECDSAPrivateKey</span>&nbsp;<span class="op" id="8306710">=</span>&nbsp;<span class="op" id="8306712">&amp;</span><span class="ident" id="8306713">ecdsa</span><span class="op" id="8306718">.</span><span class="ident" id="8306719">PrivateKey</span><span class="op" id="8306729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306732">PublicKey</span><span class="op" id="8306741">:</span>&nbsp;<span class="ident" id="8306743">ecdsa</span><span class="op" id="8306748">.</span><span class="ident" id="8306749">PublicKey</span><span class="op" id="8306758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306762">Curve</span><span class="op" id="8306767">:</span>&nbsp;<span class="ident" id="8306769">elliptic</span><span class="op" id="8306777">.</span><span class="ident" id="8306778">P521</span><span class="op" id="8306782">(</span><span class="op" id="8306783">)</span><span class="op" id="8306784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306788">X</span><span class="op" id="8306789">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8306795">bigFromString</span><span class="op" id="8306808">(</span><span class="string" id="8306809">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="8306968">)</span><span class="op" id="8306969">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8306973">Y</span><span class="op" id="8306974">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8306980">bigFromString</span><span class="op" id="8306993">(</span><span class="string" id="8306994">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="8307153">)</span><span class="op" id="8307154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8307157">}</span><span class="op" id="8307158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8307161">D</span><span class="op" id="8307162">:</span>&nbsp;<span class="ident" id="8307164">bigFromString</span><span class="op" id="8307177">(</span><span class="string" id="8307178">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="8307337">)</span><span class="op" id="8307338">,</span><br>
<span class="lineno"></span><span class="op" id="8307340">}</span>
</div>
</body>
</html>
