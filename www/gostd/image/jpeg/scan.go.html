<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5905948">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5906003">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5906057">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5906108">package</span>&nbsp;<span class="ident" id="5906116">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5906122">import</span>&nbsp;<span class="op" id="5906129">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5906132">&#34;image&#34;</span><br>
<span class="lineno"></span><span class="op" id="5906140">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="5906143">//&nbsp;makeImg&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;the&nbsp;destination&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5906203">func</span>&nbsp;<span class="op" id="5906208">(</span><span class="ident" id="5906209">d</span>&nbsp;<span class="op" id="5906211">*</span><span class="ident" id="5906212">decoder</span><span class="op" id="5906219">)</span>&nbsp;<span class="ident" id="5906221">makeImg</span><span class="op" id="5906228">(</span><span class="ident" id="5906229">h0</span><span class="op" id="5906231">,</span>&nbsp;<span class="ident" id="5906233">v0</span><span class="op" id="5906235">,</span>&nbsp;<span class="ident" id="5906237">mxx</span><span class="op" id="5906240">,</span>&nbsp;<span class="ident" id="5906242">myy</span>&nbsp;<span class="builtintype" id="5906246">int</span><span class="op" id="5906249">)</span>&nbsp;<span class="op" id="5906251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906254">if</span>&nbsp;<span class="ident" id="5906257">d</span><span class="op" id="5906258">.</span><span class="ident" id="5906259">nComp</span>&nbsp;<span class="op" id="5906265">==</span>&nbsp;<span class="ident" id="5906268">nGrayComponent</span>&nbsp;<span class="op" id="5906283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906287">m</span>&nbsp;<span class="op" id="5906289">:=</span>&nbsp;<span class="ident" id="5906292">image</span><span class="op" id="5906297">.</span><span class="ident" id="5906298">NewGray</span><span class="op" id="5906305">(</span><span class="ident" id="5906306">image</span><span class="op" id="5906311">.</span><span class="ident" id="5906312">Rect</span><span class="op" id="5906316">(</span><span class="num" id="5906317">0</span><span class="op" id="5906318">,</span>&nbsp;<span class="num" id="5906320">0</span><span class="op" id="5906321">,</span>&nbsp;<span class="num" id="5906323">8</span><span class="op" id="5906324">*</span><span class="ident" id="5906325">mxx</span><span class="op" id="5906328">,</span>&nbsp;<span class="num" id="5906330">8</span><span class="op" id="5906331">*</span><span class="ident" id="5906332">myy</span><span class="op" id="5906335">)</span><span class="op" id="5906336">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906340">d</span><span class="op" id="5906341">.</span><span class="ident" id="5906342">img1</span>&nbsp;<span class="op" id="5906347">=</span>&nbsp;<span class="ident" id="5906349">m</span><span class="op" id="5906350">.</span><span class="ident" id="5906351">SubImage</span><span class="op" id="5906359">(</span><span class="ident" id="5906360">image</span><span class="op" id="5906365">.</span><span class="ident" id="5906366">Rect</span><span class="op" id="5906370">(</span><span class="num" id="5906371">0</span><span class="op" id="5906372">,</span>&nbsp;<span class="num" id="5906374">0</span><span class="op" id="5906375">,</span>&nbsp;<span class="ident" id="5906377">d</span><span class="op" id="5906378">.</span><span class="ident" id="5906379">width</span><span class="op" id="5906384">,</span>&nbsp;<span class="ident" id="5906386">d</span><span class="op" id="5906387">.</span><span class="ident" id="5906388">height</span><span class="op" id="5906394">)</span><span class="op" id="5906395">)</span><span class="op" id="5906396">.</span><span class="op" id="5906397">(</span><span class="op" id="5906398">*</span><span class="ident" id="5906399">image</span><span class="op" id="5906404">.</span><span class="ident" id="5906405">Gray</span><span class="op" id="5906409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906413">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906424">var</span>&nbsp;<span class="ident" id="5906428">subsampleRatio</span>&nbsp;<span class="ident" id="5906443">image</span><span class="op" id="5906448">.</span><span class="ident" id="5906449">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906470">switch</span>&nbsp;<span class="op" id="5906477">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906480">case</span>&nbsp;<span class="ident" id="5906485">h0</span>&nbsp;<span class="op" id="5906488">==</span>&nbsp;<span class="num" id="5906491">1</span>&nbsp;<span class="op" id="5906493">&amp;&amp;</span>&nbsp;<span class="ident" id="5906496">v0</span>&nbsp;<span class="op" id="5906499">==</span>&nbsp;<span class="num" id="5906502">1</span><span class="op" id="5906503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906507">subsampleRatio</span>&nbsp;<span class="op" id="5906522">=</span>&nbsp;<span class="ident" id="5906524">image</span><span class="op" id="5906529">.</span><span class="ident" id="5906530">YCbCrSubsampleRatio444</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906554">case</span>&nbsp;<span class="ident" id="5906559">h0</span>&nbsp;<span class="op" id="5906562">==</span>&nbsp;<span class="num" id="5906565">1</span>&nbsp;<span class="op" id="5906567">&amp;&amp;</span>&nbsp;<span class="ident" id="5906570">v0</span>&nbsp;<span class="op" id="5906573">==</span>&nbsp;<span class="num" id="5906576">2</span><span class="op" id="5906577">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906581">subsampleRatio</span>&nbsp;<span class="op" id="5906596">=</span>&nbsp;<span class="ident" id="5906598">image</span><span class="op" id="5906603">.</span><span class="ident" id="5906604">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906628">case</span>&nbsp;<span class="ident" id="5906633">h0</span>&nbsp;<span class="op" id="5906636">==</span>&nbsp;<span class="num" id="5906639">2</span>&nbsp;<span class="op" id="5906641">&amp;&amp;</span>&nbsp;<span class="ident" id="5906644">v0</span>&nbsp;<span class="op" id="5906647">==</span>&nbsp;<span class="num" id="5906650">1</span><span class="op" id="5906651">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906655">subsampleRatio</span>&nbsp;<span class="op" id="5906670">=</span>&nbsp;<span class="ident" id="5906672">image</span><span class="op" id="5906677">.</span><span class="ident" id="5906678">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906702">case</span>&nbsp;<span class="ident" id="5906707">h0</span>&nbsp;<span class="op" id="5906710">==</span>&nbsp;<span class="num" id="5906713">2</span>&nbsp;<span class="op" id="5906715">&amp;&amp;</span>&nbsp;<span class="ident" id="5906718">v0</span>&nbsp;<span class="op" id="5906721">==</span>&nbsp;<span class="num" id="5906724">2</span><span class="op" id="5906725">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906729">subsampleRatio</span>&nbsp;<span class="op" id="5906744">=</span>&nbsp;<span class="ident" id="5906746">image</span><span class="op" id="5906751">.</span><span class="ident" id="5906752">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5906776">default</span><span class="op" id="5906783">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5906787">panic</span><span class="op" id="5906792">(</span><span class="string" id="5906793">&#34;unreachable&#34;</span><span class="op" id="5906806">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5906809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906812">m</span>&nbsp;<span class="op" id="5906814">:=</span>&nbsp;<span class="ident" id="5906817">image</span><span class="op" id="5906822">.</span><span class="ident" id="5906823">NewYCbCr</span><span class="op" id="5906831">(</span><span class="ident" id="5906832">image</span><span class="op" id="5906837">.</span><span class="ident" id="5906838">Rect</span><span class="op" id="5906842">(</span><span class="num" id="5906843">0</span><span class="op" id="5906844">,</span>&nbsp;<span class="num" id="5906846">0</span><span class="op" id="5906847">,</span>&nbsp;<span class="num" id="5906849">8</span><span class="op" id="5906850">*</span><span class="ident" id="5906851">h0</span><span class="op" id="5906853">*</span><span class="ident" id="5906854">mxx</span><span class="op" id="5906857">,</span>&nbsp;<span class="num" id="5906859">8</span><span class="op" id="5906860">*</span><span class="ident" id="5906861">v0</span><span class="op" id="5906863">*</span><span class="ident" id="5906864">myy</span><span class="op" id="5906867">)</span><span class="op" id="5906868">,</span>&nbsp;<span class="ident" id="5906870">subsampleRatio</span><span class="op" id="5906884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5906887">d</span><span class="op" id="5906888">.</span><span class="ident" id="5906889">img3</span>&nbsp;<span class="op" id="5906894">=</span>&nbsp;<span class="ident" id="5906896">m</span><span class="op" id="5906897">.</span><span class="ident" id="5906898">SubImage</span><span class="op" id="5906906">(</span><span class="ident" id="5906907">image</span><span class="op" id="5906912">.</span><span class="ident" id="5906913">Rect</span><span class="op" id="5906917">(</span><span class="num" id="5906918">0</span><span class="op" id="5906919">,</span>&nbsp;<span class="num" id="5906921">0</span><span class="op" id="5906922">,</span>&nbsp;<span class="ident" id="5906924">d</span><span class="op" id="5906925">.</span><span class="ident" id="5906926">width</span><span class="op" id="5906931">,</span>&nbsp;<span class="ident" id="5906933">d</span><span class="op" id="5906934">.</span><span class="ident" id="5906935">height</span><span class="op" id="5906941">)</span><span class="op" id="5906942">)</span><span class="op" id="5906943">.</span><span class="op" id="5906944">(</span><span class="op" id="5906945">*</span><span class="ident" id="5906946">image</span><span class="op" id="5906951">.</span><span class="ident" id="5906952">YCbCr</span><span class="op" id="5906957">)</span><br>
<span class="lineno"></span><span class="op" id="5906959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5906962">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.3.</span><br>
<span class="lineno"></span><span class="keyword" id="5906993">func</span>&nbsp;<span class="op" id="5906998">(</span><span class="ident" id="5906999">d</span>&nbsp;<span class="op" id="5907001">*</span><span class="ident" id="5907002">decoder</span><span class="op" id="5907009">)</span>&nbsp;<span class="ident" id="5907011">processSOS</span><span class="op" id="5907021">(</span><span class="ident" id="5907022">n</span>&nbsp;<span class="builtintype" id="5907024">int</span><span class="op" id="5907027">)</span>&nbsp;<span class="builtintype" id="5907029">error</span>&nbsp;<span class="op" id="5907035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907038">if</span>&nbsp;<span class="ident" id="5907041">d</span><span class="op" id="5907042">.</span><span class="ident" id="5907043">nComp</span>&nbsp;<span class="op" id="5907049">==</span>&nbsp;<span class="num" id="5907052">0</span>&nbsp;<span class="op" id="5907054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907058">return</span>&nbsp;<span class="ident" id="5907065">FormatError</span><span class="op" id="5907076">(</span><span class="string" id="5907077">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="5907097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907100">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907103">if</span>&nbsp;<span class="ident" id="5907106">n</span>&nbsp;<span class="op" id="5907108">&lt;</span>&nbsp;<span class="num" id="5907110">6</span>&nbsp;<span class="op" id="5907112">||</span>&nbsp;<span class="num" id="5907115">4</span><span class="op" id="5907116">+</span><span class="num" id="5907117">2</span><span class="op" id="5907118">*</span><span class="ident" id="5907119">d</span><span class="op" id="5907120">.</span><span class="ident" id="5907121">nComp</span>&nbsp;<span class="op" id="5907127">&lt;</span>&nbsp;<span class="ident" id="5907129">n</span>&nbsp;<span class="op" id="5907131">||</span>&nbsp;<span class="ident" id="5907134">n</span><span class="op" id="5907135">%</span><span class="num" id="5907136">2</span>&nbsp;<span class="op" id="5907138">!=</span>&nbsp;<span class="num" id="5907141">0</span>&nbsp;<span class="op" id="5907143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907147">return</span>&nbsp;<span class="ident" id="5907154">FormatError</span><span class="op" id="5907165">(</span><span class="string" id="5907166">&#34;SOS&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5907188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907194">if</span>&nbsp;<span class="ident" id="5907197">err</span>&nbsp;<span class="op" id="5907201">:=</span>&nbsp;<span class="ident" id="5907204">d</span><span class="op" id="5907205">.</span><span class="ident" id="5907206">readFull</span><span class="op" id="5907214">(</span><span class="ident" id="5907215">d</span><span class="op" id="5907216">.</span><span class="ident" id="5907217">tmp</span><span class="op" id="5907220">[</span><span class="op" id="5907221">:</span><span class="ident" id="5907222">n</span><span class="op" id="5907223">]</span><span class="op" id="5907224">)</span><span class="op" id="5907225">;</span>&nbsp;<span class="ident" id="5907227">err</span>&nbsp;<span class="op" id="5907231">!=</span>&nbsp;<span class="ident" id="5907234">nil</span>&nbsp;<span class="op" id="5907238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907242">return</span>&nbsp;<span class="ident" id="5907249">err</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907257">nComp</span>&nbsp;<span class="op" id="5907263">:=</span>&nbsp;<span class="builtintype" id="5907266">int</span><span class="op" id="5907269">(</span><span class="ident" id="5907270">d</span><span class="op" id="5907271">.</span><span class="ident" id="5907272">tmp</span><span class="op" id="5907275">[</span><span class="num" id="5907276">0</span><span class="op" id="5907277">]</span><span class="op" id="5907278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907281">if</span>&nbsp;<span class="ident" id="5907284">n</span>&nbsp;<span class="op" id="5907286">!=</span>&nbsp;<span class="num" id="5907289">4</span><span class="op" id="5907290">+</span><span class="num" id="5907291">2</span><span class="op" id="5907292">*</span><span class="ident" id="5907293">nComp</span>&nbsp;<span class="op" id="5907299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907303">return</span>&nbsp;<span class="ident" id="5907310">FormatError</span><span class="op" id="5907321">(</span><span class="string" id="5907322">&#34;SOS&nbsp;length&nbsp;inconsistent&nbsp;with&nbsp;number&nbsp;of&nbsp;components&#34;</span><span class="op" id="5907373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907376">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907379">var</span>&nbsp;<span class="ident" id="5907383">scan</span>&nbsp;<span class="op" id="5907388">[</span><span class="ident" id="5907389">nColorComponent</span><span class="op" id="5907404">]</span><span class="keyword" id="5907405">struct</span>&nbsp;<span class="op" id="5907412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907416">compIndex</span>&nbsp;<span class="builtintype" id="5907426">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907434">td</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5907444">uint8</span>&nbsp;<span class="comment" id="5907450">//&nbsp;DC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907474">ta</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5907484">uint8</span>&nbsp;<span class="comment" id="5907490">//&nbsp;AC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907513">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907516">for</span>&nbsp;<span class="ident" id="5907520">i</span>&nbsp;<span class="op" id="5907522">:=</span>&nbsp;<span class="num" id="5907525">0</span><span class="op" id="5907526">;</span>&nbsp;<span class="ident" id="5907528">i</span>&nbsp;<span class="op" id="5907530">&lt;</span>&nbsp;<span class="ident" id="5907532">nComp</span><span class="op" id="5907537">;</span>&nbsp;<span class="ident" id="5907539">i</span><span class="op" id="5907540">++</span>&nbsp;<span class="op" id="5907543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907547">cs</span>&nbsp;<span class="op" id="5907550">:=</span>&nbsp;<span class="ident" id="5907553">d</span><span class="op" id="5907554">.</span><span class="ident" id="5907555">tmp</span><span class="op" id="5907558">[</span><span class="num" id="5907559">1</span><span class="op" id="5907560">+</span><span class="num" id="5907561">2</span><span class="op" id="5907562">*</span><span class="ident" id="5907563">i</span><span class="op" id="5907564">]</span>&nbsp;<span class="comment" id="5907566">//&nbsp;Component&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907591">compIndex</span>&nbsp;<span class="op" id="5907601">:=</span>&nbsp;<span class="op" id="5907604">-</span><span class="num" id="5907605">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907609">for</span>&nbsp;<span class="ident" id="5907613">j</span><span class="op" id="5907614">,</span>&nbsp;<span class="ident" id="5907616">comp</span>&nbsp;<span class="op" id="5907621">:=</span>&nbsp;<span class="keyword" id="5907624">range</span>&nbsp;<span class="ident" id="5907630">d</span><span class="op" id="5907631">.</span><span class="ident" id="5907632">comp</span>&nbsp;<span class="op" id="5907637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907642">if</span>&nbsp;<span class="ident" id="5907645">cs</span>&nbsp;<span class="op" id="5907648">==</span>&nbsp;<span class="ident" id="5907651">comp</span><span class="op" id="5907655">.</span><span class="ident" id="5907656">c</span>&nbsp;<span class="op" id="5907658">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907664">compIndex</span>&nbsp;<span class="op" id="5907674">=</span>&nbsp;<span class="ident" id="5907676">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907689">if</span>&nbsp;<span class="ident" id="5907692">compIndex</span>&nbsp;<span class="op" id="5907702">&lt;</span>&nbsp;<span class="num" id="5907704">0</span>&nbsp;<span class="op" id="5907706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907711">return</span>&nbsp;<span class="ident" id="5907718">FormatError</span><span class="op" id="5907729">(</span><span class="string" id="5907730">&#34;unknown&nbsp;component&nbsp;selector&#34;</span><span class="op" id="5907758">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907766">scan</span><span class="op" id="5907770">[</span><span class="ident" id="5907771">i</span><span class="op" id="5907772">]</span><span class="op" id="5907773">.</span><span class="ident" id="5907774">compIndex</span>&nbsp;<span class="op" id="5907784">=</span>&nbsp;<span class="builtintype" id="5907786">uint8</span><span class="op" id="5907791">(</span><span class="ident" id="5907792">compIndex</span><span class="op" id="5907801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907805">scan</span><span class="op" id="5907809">[</span><span class="ident" id="5907810">i</span><span class="op" id="5907811">]</span><span class="op" id="5907812">.</span><span class="ident" id="5907813">td</span>&nbsp;<span class="op" id="5907816">=</span>&nbsp;<span class="ident" id="5907818">d</span><span class="op" id="5907819">.</span><span class="ident" id="5907820">tmp</span><span class="op" id="5907823">[</span><span class="num" id="5907824">2</span><span class="op" id="5907825">+</span><span class="num" id="5907826">2</span><span class="op" id="5907827">*</span><span class="ident" id="5907828">i</span><span class="op" id="5907829">]</span>&nbsp;<span class="op" id="5907831">&gt;&gt;</span>&nbsp;<span class="num" id="5907834">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907838">if</span>&nbsp;<span class="ident" id="5907841">scan</span><span class="op" id="5907845">[</span><span class="ident" id="5907846">i</span><span class="op" id="5907847">]</span><span class="op" id="5907848">.</span><span class="ident" id="5907849">td</span>&nbsp;<span class="op" id="5907852">&gt;</span>&nbsp;<span class="ident" id="5907854">maxTh</span>&nbsp;<span class="op" id="5907860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907865">return</span>&nbsp;<span class="ident" id="5907872">FormatError</span><span class="op" id="5907883">(</span><span class="string" id="5907884">&#34;bad&nbsp;Td&nbsp;value&#34;</span><span class="op" id="5907898">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5907902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5907906">scan</span><span class="op" id="5907910">[</span><span class="ident" id="5907911">i</span><span class="op" id="5907912">]</span><span class="op" id="5907913">.</span><span class="ident" id="5907914">ta</span>&nbsp;<span class="op" id="5907917">=</span>&nbsp;<span class="ident" id="5907919">d</span><span class="op" id="5907920">.</span><span class="ident" id="5907921">tmp</span><span class="op" id="5907924">[</span><span class="num" id="5907925">2</span><span class="op" id="5907926">+</span><span class="num" id="5907927">2</span><span class="op" id="5907928">*</span><span class="ident" id="5907929">i</span><span class="op" id="5907930">]</span>&nbsp;<span class="op" id="5907932">&amp;</span>&nbsp;<span class="num" id="5907934">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907941">if</span>&nbsp;<span class="ident" id="5907944">scan</span><span class="op" id="5907948">[</span><span class="ident" id="5907949">i</span><span class="op" id="5907950">]</span><span class="op" id="5907951">.</span><span class="ident" id="5907952">ta</span>&nbsp;<span class="op" id="5907955">&gt;</span>&nbsp;<span class="ident" id="5907957">maxTh</span>&nbsp;<span class="op" id="5907963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5907968">return</span>&nbsp;<span class="ident" id="5907975">FormatError</span><span class="op" id="5907986">(</span><span class="string" id="5907987">&#34;bad&nbsp;Ta&nbsp;value&#34;</span><span class="op" id="5908001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5908005">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5908008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908012">//&nbsp;zigStart&nbsp;and&nbsp;zigEnd&nbsp;are&nbsp;the&nbsp;spectral&nbsp;selection&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908071">//&nbsp;ah&nbsp;and&nbsp;al&nbsp;are&nbsp;the&nbsp;successive&nbsp;approximation&nbsp;high&nbsp;and&nbsp;low&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908139">//&nbsp;The&nbsp;spec&nbsp;calls&nbsp;these&nbsp;values&nbsp;Ss,&nbsp;Se,&nbsp;Ah&nbsp;and&nbsp;Al.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908190">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908194">//&nbsp;For&nbsp;progressive&nbsp;JPEGs,&nbsp;these&nbsp;are&nbsp;the&nbsp;two&nbsp;more-or-less&nbsp;independent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908264">//&nbsp;aspects&nbsp;of&nbsp;progression.&nbsp;Spectral&nbsp;selection&nbsp;progression&nbsp;is&nbsp;when&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908335">//&nbsp;all&nbsp;of&nbsp;a&nbsp;block&#39;s&nbsp;64&nbsp;DCT&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908405">//&nbsp;For&nbsp;example,&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;coefficient&nbsp;0&nbsp;(the&nbsp;DC</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908472">//&nbsp;component),&nbsp;coefficients&nbsp;1-5,&nbsp;and&nbsp;coefficients&nbsp;6-63,&nbsp;in&nbsp;zig-zag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908540">//&nbsp;order.&nbsp;Successive&nbsp;approximation&nbsp;is&nbsp;when&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908609">//&nbsp;band&nbsp;of&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908676">//&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;the&nbsp;6&nbsp;most&nbsp;significant&nbsp;bits,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908746">//&nbsp;by&nbsp;the&nbsp;second-least&nbsp;significant&nbsp;bit,&nbsp;followed&nbsp;by&nbsp;the&nbsp;least</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908809">//&nbsp;significant&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908830">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5908834">//&nbsp;For&nbsp;baseline&nbsp;JPEGs,&nbsp;these&nbsp;parameters&nbsp;are&nbsp;hard-coded&nbsp;to&nbsp;0/63/0/0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5908903">zigStart</span><span class="op" id="5908911">,</span>&nbsp;<span class="ident" id="5908913">zigEnd</span><span class="op" id="5908919">,</span>&nbsp;<span class="ident" id="5908921">ah</span><span class="op" id="5908923">,</span>&nbsp;<span class="ident" id="5908925">al</span>&nbsp;<span class="op" id="5908928">:=</span>&nbsp;<span class="builtintype" id="5908931">int32</span><span class="op" id="5908936">(</span><span class="num" id="5908937">0</span><span class="op" id="5908938">)</span><span class="op" id="5908939">,</span>&nbsp;<span class="builtintype" id="5908941">int32</span><span class="op" id="5908946">(</span><span class="ident" id="5908947">blockSize</span><span class="op" id="5908956">-</span><span class="num" id="5908957">1</span><span class="op" id="5908958">)</span><span class="op" id="5908959">,</span>&nbsp;<span class="builtintype" id="5908961">uint32</span><span class="op" id="5908967">(</span><span class="num" id="5908968">0</span><span class="op" id="5908969">)</span><span class="op" id="5908970">,</span>&nbsp;<span class="builtintype" id="5908972">uint32</span><span class="op" id="5908978">(</span><span class="num" id="5908979">0</span><span class="op" id="5908980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5908983">if</span>&nbsp;<span class="ident" id="5908986">d</span><span class="op" id="5908987">.</span><span class="ident" id="5908988">progressive</span>&nbsp;<span class="op" id="5909000">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909004">zigStart</span>&nbsp;<span class="op" id="5909013">=</span>&nbsp;<span class="builtintype" id="5909015">int32</span><span class="op" id="5909020">(</span><span class="ident" id="5909021">d</span><span class="op" id="5909022">.</span><span class="ident" id="5909023">tmp</span><span class="op" id="5909026">[</span><span class="num" id="5909027">1</span><span class="op" id="5909028">+</span><span class="num" id="5909029">2</span><span class="op" id="5909030">*</span><span class="ident" id="5909031">nComp</span><span class="op" id="5909036">]</span><span class="op" id="5909037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909041">zigEnd</span>&nbsp;<span class="op" id="5909048">=</span>&nbsp;<span class="builtintype" id="5909050">int32</span><span class="op" id="5909055">(</span><span class="ident" id="5909056">d</span><span class="op" id="5909057">.</span><span class="ident" id="5909058">tmp</span><span class="op" id="5909061">[</span><span class="num" id="5909062">2</span><span class="op" id="5909063">+</span><span class="num" id="5909064">2</span><span class="op" id="5909065">*</span><span class="ident" id="5909066">nComp</span><span class="op" id="5909071">]</span><span class="op" id="5909072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909076">ah</span>&nbsp;<span class="op" id="5909079">=</span>&nbsp;<span class="builtintype" id="5909081">uint32</span><span class="op" id="5909087">(</span><span class="ident" id="5909088">d</span><span class="op" id="5909089">.</span><span class="ident" id="5909090">tmp</span><span class="op" id="5909093">[</span><span class="num" id="5909094">3</span><span class="op" id="5909095">+</span><span class="num" id="5909096">2</span><span class="op" id="5909097">*</span><span class="ident" id="5909098">nComp</span><span class="op" id="5909103">]</span>&nbsp;<span class="op" id="5909105">&gt;&gt;</span>&nbsp;<span class="num" id="5909108">4</span><span class="op" id="5909109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909113">al</span>&nbsp;<span class="op" id="5909116">=</span>&nbsp;<span class="builtintype" id="5909118">uint32</span><span class="op" id="5909124">(</span><span class="ident" id="5909125">d</span><span class="op" id="5909126">.</span><span class="ident" id="5909127">tmp</span><span class="op" id="5909130">[</span><span class="num" id="5909131">3</span><span class="op" id="5909132">+</span><span class="num" id="5909133">2</span><span class="op" id="5909134">*</span><span class="ident" id="5909135">nComp</span><span class="op" id="5909140">]</span>&nbsp;<span class="op" id="5909142">&amp;</span>&nbsp;<span class="num" id="5909144">0x0f</span><span class="op" id="5909148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909152">if</span>&nbsp;<span class="op" id="5909155">(</span><span class="ident" id="5909156">zigStart</span>&nbsp;<span class="op" id="5909165">==</span>&nbsp;<span class="num" id="5909168">0</span>&nbsp;<span class="op" id="5909170">&amp;&amp;</span>&nbsp;<span class="ident" id="5909173">zigEnd</span>&nbsp;<span class="op" id="5909180">!=</span>&nbsp;<span class="num" id="5909183">0</span><span class="op" id="5909184">)</span>&nbsp;<span class="op" id="5909186">||</span>&nbsp;<span class="ident" id="5909189">zigStart</span>&nbsp;<span class="op" id="5909198">&gt;</span>&nbsp;<span class="ident" id="5909200">zigEnd</span>&nbsp;<span class="op" id="5909207">||</span>&nbsp;<span class="ident" id="5909210">blockSize</span>&nbsp;<span class="op" id="5909220">&lt;=</span>&nbsp;<span class="ident" id="5909223">zigEnd</span>&nbsp;<span class="op" id="5909230">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909235">return</span>&nbsp;<span class="ident" id="5909242">FormatError</span><span class="op" id="5909253">(</span><span class="string" id="5909254">&#34;bad&nbsp;spectral&nbsp;selection&nbsp;bounds&#34;</span><span class="op" id="5909285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909293">if</span>&nbsp;<span class="ident" id="5909296">zigStart</span>&nbsp;<span class="op" id="5909305">!=</span>&nbsp;<span class="num" id="5909308">0</span>&nbsp;<span class="op" id="5909310">&amp;&amp;</span>&nbsp;<span class="ident" id="5909313">nComp</span>&nbsp;<span class="op" id="5909319">!=</span>&nbsp;<span class="num" id="5909322">1</span>&nbsp;<span class="op" id="5909324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909329">return</span>&nbsp;<span class="ident" id="5909336">FormatError</span><span class="op" id="5909347">(</span><span class="string" id="5909348">&#34;progressive&nbsp;AC&nbsp;coefficients&nbsp;for&nbsp;more&nbsp;than&nbsp;one&nbsp;component&#34;</span><span class="op" id="5909405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909409">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909413">if</span>&nbsp;<span class="ident" id="5909416">ah</span>&nbsp;<span class="op" id="5909419">!=</span>&nbsp;<span class="num" id="5909422">0</span>&nbsp;<span class="op" id="5909424">&amp;&amp;</span>&nbsp;<span class="ident" id="5909427">ah</span>&nbsp;<span class="op" id="5909430">!=</span>&nbsp;<span class="ident" id="5909433">al</span><span class="op" id="5909435">+</span><span class="num" id="5909436">1</span>&nbsp;<span class="op" id="5909438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909443">return</span>&nbsp;<span class="ident" id="5909450">FormatError</span><span class="op" id="5909461">(</span><span class="string" id="5909462">&#34;bad&nbsp;successive&nbsp;approximation&nbsp;values&#34;</span><span class="op" id="5909499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5909510">//&nbsp;mxx&nbsp;and&nbsp;myy&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;MCUs&nbsp;(Minimum&nbsp;Coded&nbsp;Units)&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909585">h0</span><span class="op" id="5909587">,</span>&nbsp;<span class="ident" id="5909589">v0</span>&nbsp;<span class="op" id="5909592">:=</span>&nbsp;<span class="ident" id="5909595">d</span><span class="op" id="5909596">.</span><span class="ident" id="5909597">comp</span><span class="op" id="5909601">[</span><span class="num" id="5909602">0</span><span class="op" id="5909603">]</span><span class="op" id="5909604">.</span><span class="ident" id="5909605">h</span><span class="op" id="5909606">,</span>&nbsp;<span class="ident" id="5909608">d</span><span class="op" id="5909609">.</span><span class="ident" id="5909610">comp</span><span class="op" id="5909614">[</span><span class="num" id="5909615">0</span><span class="op" id="5909616">]</span><span class="op" id="5909617">.</span><span class="ident" id="5909618">v</span>&nbsp;<span class="comment" id="5909620">//&nbsp;The&nbsp;h&nbsp;and&nbsp;v&nbsp;values&nbsp;from&nbsp;the&nbsp;Y&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909666">mxx</span>&nbsp;<span class="op" id="5909670">:=</span>&nbsp;<span class="op" id="5909673">(</span><span class="ident" id="5909674">d</span><span class="op" id="5909675">.</span><span class="ident" id="5909676">width</span>&nbsp;<span class="op" id="5909682">+</span>&nbsp;<span class="num" id="5909684">8</span><span class="op" id="5909685">*</span><span class="ident" id="5909686">h0</span>&nbsp;<span class="op" id="5909689">-</span>&nbsp;<span class="num" id="5909691">1</span><span class="op" id="5909692">)</span>&nbsp;<span class="op" id="5909694">/</span>&nbsp;<span class="op" id="5909696">(</span><span class="num" id="5909697">8</span>&nbsp;<span class="op" id="5909699">*</span>&nbsp;<span class="ident" id="5909701">h0</span><span class="op" id="5909703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909706">myy</span>&nbsp;<span class="op" id="5909710">:=</span>&nbsp;<span class="op" id="5909713">(</span><span class="ident" id="5909714">d</span><span class="op" id="5909715">.</span><span class="ident" id="5909716">height</span>&nbsp;<span class="op" id="5909723">+</span>&nbsp;<span class="num" id="5909725">8</span><span class="op" id="5909726">*</span><span class="ident" id="5909727">v0</span>&nbsp;<span class="op" id="5909730">-</span>&nbsp;<span class="num" id="5909732">1</span><span class="op" id="5909733">)</span>&nbsp;<span class="op" id="5909735">/</span>&nbsp;<span class="op" id="5909737">(</span><span class="num" id="5909738">8</span>&nbsp;<span class="op" id="5909740">*</span>&nbsp;<span class="ident" id="5909742">v0</span><span class="op" id="5909744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909747">if</span>&nbsp;<span class="ident" id="5909750">d</span><span class="op" id="5909751">.</span><span class="ident" id="5909752">img1</span>&nbsp;<span class="op" id="5909757">==</span>&nbsp;<span class="ident" id="5909760">nil</span>&nbsp;<span class="op" id="5909764">&amp;&amp;</span>&nbsp;<span class="ident" id="5909767">d</span><span class="op" id="5909768">.</span><span class="ident" id="5909769">img3</span>&nbsp;<span class="op" id="5909774">==</span>&nbsp;<span class="ident" id="5909777">nil</span>&nbsp;<span class="op" id="5909781">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909785">d</span><span class="op" id="5909786">.</span><span class="ident" id="5909787">makeImg</span><span class="op" id="5909794">(</span><span class="ident" id="5909795">h0</span><span class="op" id="5909797">,</span>&nbsp;<span class="ident" id="5909799">v0</span><span class="op" id="5909801">,</span>&nbsp;<span class="ident" id="5909803">mxx</span><span class="op" id="5909806">,</span>&nbsp;<span class="ident" id="5909808">myy</span><span class="op" id="5909811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5909814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909817">if</span>&nbsp;<span class="ident" id="5909820">d</span><span class="op" id="5909821">.</span><span class="ident" id="5909822">progressive</span>&nbsp;<span class="op" id="5909834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909838">for</span>&nbsp;<span class="ident" id="5909842">i</span>&nbsp;<span class="op" id="5909844">:=</span>&nbsp;<span class="num" id="5909847">0</span><span class="op" id="5909848">;</span>&nbsp;<span class="ident" id="5909850">i</span>&nbsp;<span class="op" id="5909852">&lt;</span>&nbsp;<span class="ident" id="5909854">nComp</span><span class="op" id="5909859">;</span>&nbsp;<span class="ident" id="5909861">i</span><span class="op" id="5909862">++</span>&nbsp;<span class="op" id="5909865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909870">compIndex</span>&nbsp;<span class="op" id="5909880">:=</span>&nbsp;<span class="ident" id="5909883">scan</span><span class="op" id="5909887">[</span><span class="ident" id="5909888">i</span><span class="op" id="5909889">]</span><span class="op" id="5909890">.</span><span class="ident" id="5909891">compIndex</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5909904">if</span>&nbsp;<span class="ident" id="5909907">d</span><span class="op" id="5909908">.</span><span class="ident" id="5909909">progCoeffs</span><span class="op" id="5909919">[</span><span class="ident" id="5909920">compIndex</span><span class="op" id="5909929">]</span>&nbsp;<span class="op" id="5909931">==</span>&nbsp;<span class="ident" id="5909934">nil</span>&nbsp;<span class="op" id="5909938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5909944">d</span><span class="op" id="5909945">.</span><span class="ident" id="5909946">progCoeffs</span><span class="op" id="5909956">[</span><span class="ident" id="5909957">compIndex</span><span class="op" id="5909966">]</span>&nbsp;<span class="op" id="5909968">=</span>&nbsp;<span class="builtinfunc" id="5909970">make</span><span class="op" id="5909974">(</span><span class="op" id="5909975">[</span><span class="op" id="5909976">]</span><span class="ident" id="5909977">block</span><span class="op" id="5909982">,</span>&nbsp;<span class="ident" id="5909984">mxx</span><span class="op" id="5909987">*</span><span class="ident" id="5909988">myy</span><span class="op" id="5909991">*</span><span class="ident" id="5909992">d</span><span class="op" id="5909993">.</span><span class="ident" id="5909994">comp</span><span class="op" id="5909998">[</span><span class="ident" id="5909999">compIndex</span><span class="op" id="5910008">]</span><span class="op" id="5910009">.</span><span class="ident" id="5910010">h</span><span class="op" id="5910011">*</span><span class="ident" id="5910012">d</span><span class="op" id="5910013">.</span><span class="ident" id="5910014">comp</span><span class="op" id="5910018">[</span><span class="ident" id="5910019">compIndex</span><span class="op" id="5910028">]</span><span class="op" id="5910029">.</span><span class="ident" id="5910030">v</span><span class="op" id="5910031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910043">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910047">d</span><span class="op" id="5910048">.</span><span class="ident" id="5910049">bits</span>&nbsp;<span class="op" id="5910054">=</span>&nbsp;<span class="ident" id="5910056">bits</span><span class="op" id="5910060">{</span><span class="op" id="5910061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910064">mcu</span><span class="op" id="5910067">,</span>&nbsp;<span class="ident" id="5910069">expectedRST</span>&nbsp;<span class="op" id="5910081">:=</span>&nbsp;<span class="num" id="5910084">0</span><span class="op" id="5910085">,</span>&nbsp;<span class="builtintype" id="5910087">uint8</span><span class="op" id="5910092">(</span><span class="ident" id="5910093">rst0Marker</span><span class="op" id="5910103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910106">var</span>&nbsp;<span class="op" id="5910110">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910114">//&nbsp;b&nbsp;is&nbsp;the&nbsp;decoded&nbsp;coefficients,&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910182">b</span>&nbsp;&nbsp;<span class="ident" id="5910185">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910193">dc</span>&nbsp;<span class="op" id="5910196">[</span><span class="ident" id="5910197">nColorComponent</span><span class="op" id="5910212">]</span><span class="builtintype" id="5910213">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910221">//&nbsp;bx&nbsp;and&nbsp;by&nbsp;are&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;current&nbsp;(in&nbsp;terms&nbsp;of&nbsp;8x8&nbsp;blocks).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910294">//&nbsp;For&nbsp;example,&nbsp;with&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling,&nbsp;the&nbsp;block&nbsp;whose&nbsp;top&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910368">//&nbsp;pixel&nbsp;co-ordinates&nbsp;are&nbsp;(16,&nbsp;8)&nbsp;is&nbsp;the&nbsp;third&nbsp;block&nbsp;in&nbsp;the&nbsp;first&nbsp;row:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910441">//&nbsp;bx&nbsp;is&nbsp;2&nbsp;and&nbsp;by&nbsp;is&nbsp;0,&nbsp;even&nbsp;though&nbsp;the&nbsp;pixel&nbsp;is&nbsp;in&nbsp;the&nbsp;second&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910511">bx</span><span class="op" id="5910513">,</span>&nbsp;<span class="ident" id="5910515">by</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5910522">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910528">blockCount</span>&nbsp;<span class="builtintype" id="5910539">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5910544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910547">for</span>&nbsp;<span class="ident" id="5910551">my</span>&nbsp;<span class="op" id="5910554">:=</span>&nbsp;<span class="num" id="5910557">0</span><span class="op" id="5910558">;</span>&nbsp;<span class="ident" id="5910560">my</span>&nbsp;<span class="op" id="5910563">&lt;</span>&nbsp;<span class="ident" id="5910565">myy</span><span class="op" id="5910568">;</span>&nbsp;<span class="ident" id="5910570">my</span><span class="op" id="5910572">++</span>&nbsp;<span class="op" id="5910575">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910579">for</span>&nbsp;<span class="ident" id="5910583">mx</span>&nbsp;<span class="op" id="5910586">:=</span>&nbsp;<span class="num" id="5910589">0</span><span class="op" id="5910590">;</span>&nbsp;<span class="ident" id="5910592">mx</span>&nbsp;<span class="op" id="5910595">&lt;</span>&nbsp;<span class="ident" id="5910597">mxx</span><span class="op" id="5910600">;</span>&nbsp;<span class="ident" id="5910602">mx</span><span class="op" id="5910604">++</span>&nbsp;<span class="op" id="5910607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910612">for</span>&nbsp;<span class="ident" id="5910616">i</span>&nbsp;<span class="op" id="5910618">:=</span>&nbsp;<span class="num" id="5910621">0</span><span class="op" id="5910622">;</span>&nbsp;<span class="ident" id="5910624">i</span>&nbsp;<span class="op" id="5910626">&lt;</span>&nbsp;<span class="ident" id="5910628">nComp</span><span class="op" id="5910633">;</span>&nbsp;<span class="ident" id="5910635">i</span><span class="op" id="5910636">++</span>&nbsp;<span class="op" id="5910639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910645">compIndex</span>&nbsp;<span class="op" id="5910655">:=</span>&nbsp;<span class="ident" id="5910658">scan</span><span class="op" id="5910662">[</span><span class="ident" id="5910663">i</span><span class="op" id="5910664">]</span><span class="op" id="5910665">.</span><span class="ident" id="5910666">compIndex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5910680">qt</span>&nbsp;<span class="op" id="5910683">:=</span>&nbsp;<span class="op" id="5910686">&amp;</span><span class="ident" id="5910687">d</span><span class="op" id="5910688">.</span><span class="ident" id="5910689">quant</span><span class="op" id="5910694">[</span><span class="ident" id="5910695">d</span><span class="op" id="5910696">.</span><span class="ident" id="5910697">comp</span><span class="op" id="5910701">[</span><span class="ident" id="5910702">compIndex</span><span class="op" id="5910711">]</span><span class="op" id="5910712">.</span><span class="ident" id="5910713">tq</span><span class="op" id="5910715">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5910721">for</span>&nbsp;<span class="ident" id="5910725">j</span>&nbsp;<span class="op" id="5910727">:=</span>&nbsp;<span class="num" id="5910730">0</span><span class="op" id="5910731">;</span>&nbsp;<span class="ident" id="5910733">j</span>&nbsp;<span class="op" id="5910735">&lt;</span>&nbsp;<span class="ident" id="5910737">d</span><span class="op" id="5910738">.</span><span class="ident" id="5910739">comp</span><span class="op" id="5910743">[</span><span class="ident" id="5910744">compIndex</span><span class="op" id="5910753">]</span><span class="op" id="5910754">.</span><span class="ident" id="5910755">h</span><span class="op" id="5910756">*</span><span class="ident" id="5910757">d</span><span class="op" id="5910758">.</span><span class="ident" id="5910759">comp</span><span class="op" id="5910763">[</span><span class="ident" id="5910764">compIndex</span><span class="op" id="5910773">]</span><span class="op" id="5910774">.</span><span class="ident" id="5910775">v</span><span class="op" id="5910776">;</span>&nbsp;<span class="ident" id="5910778">j</span><span class="op" id="5910779">++</span>&nbsp;<span class="op" id="5910782">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910789">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;traversed&nbsp;one&nbsp;MCU&nbsp;at&nbsp;a&nbsp;time.&nbsp;For&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910858">//&nbsp;subsampling,&nbsp;there&nbsp;are&nbsp;four&nbsp;Y&nbsp;8x8&nbsp;blocks&nbsp;in&nbsp;every&nbsp;16x16&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910927">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5910935">//&nbsp;For&nbsp;a&nbsp;baseline&nbsp;32x16&nbsp;pixel&nbsp;image,&nbsp;the&nbsp;Y&nbsp;blocks&nbsp;visiting&nbsp;order&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911009">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911025">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911041">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911049">//&nbsp;For&nbsp;progressive&nbsp;images,&nbsp;the&nbsp;interleaved&nbsp;scans&nbsp;(those&nbsp;with&nbsp;nComp&nbsp;&gt;&nbsp;1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911126">//&nbsp;are&nbsp;traversed&nbsp;as&nbsp;above,&nbsp;but&nbsp;non-interleaved&nbsp;scans&nbsp;are&nbsp;traversed&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911203">//&nbsp;to&nbsp;right,&nbsp;top&nbsp;to&nbsp;bottom:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911236">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911252">//&nbsp;&nbsp;&nbsp;&nbsp4&nbsp;5&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911268">//&nbsp;Only&nbsp;DC&nbsp;scans&nbsp;(zigStart&nbsp;==&nbsp;0)&nbsp;can&nbsp;be&nbsp;interleaved.&nbsp;AC&nbsp;scans&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911345">//&nbsp;only&nbsp;one&nbsp;component.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911373">//</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911381">//&nbsp;To&nbsp;further&nbsp;complicate&nbsp;matters,&nbsp;for&nbsp;non-interleaved&nbsp;scans,&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911459">//&nbsp;data&nbsp;for&nbsp;any&nbsp;blocks&nbsp;that&nbsp;are&nbsp;inside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;MCU&nbsp;level&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911534">//&nbsp;outside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;pixel&nbsp;level.&nbsp;For&nbsp;example,&nbsp;a&nbsp;24x16&nbsp;pixel&nbsp;4:2:0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911613">//&nbsp;progressive&nbsp;image&nbsp;consists&nbsp;of&nbsp;two&nbsp;16x16&nbsp;MCUs.&nbsp;The&nbsp;interleaved&nbsp;scans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911689">//&nbsp;will&nbsp;process&nbsp;8&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911722">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911738">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911754">//&nbsp;The&nbsp;non-interleaved&nbsp;scans&nbsp;will&nbsp;process&nbsp;only&nbsp;6&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911818">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5911832">//&nbsp;&nbsp;&nbsp;&nbsp3&nbsp;4&nbsp;5</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911846">if</span>&nbsp;<span class="ident" id="5911849">nComp</span>&nbsp;<span class="op" id="5911855">!=</span>&nbsp;<span class="num" id="5911858">1</span>&nbsp;<span class="op" id="5911860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911868">bx</span><span class="op" id="5911870">,</span>&nbsp;<span class="ident" id="5911872">by</span>&nbsp;<span class="op" id="5911875">=</span>&nbsp;<span class="ident" id="5911877">d</span><span class="op" id="5911878">.</span><span class="ident" id="5911879">comp</span><span class="op" id="5911883">[</span><span class="ident" id="5911884">compIndex</span><span class="op" id="5911893">]</span><span class="op" id="5911894">.</span><span class="ident" id="5911895">h</span><span class="op" id="5911896">*</span><span class="ident" id="5911897">mx</span><span class="op" id="5911899">,</span>&nbsp;<span class="ident" id="5911901">d</span><span class="op" id="5911902">.</span><span class="ident" id="5911903">comp</span><span class="op" id="5911907">[</span><span class="ident" id="5911908">compIndex</span><span class="op" id="5911917">]</span><span class="op" id="5911918">.</span><span class="ident" id="5911919">v</span><span class="op" id="5911920">*</span><span class="ident" id="5911921">my</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5911930">if</span>&nbsp;<span class="ident" id="5911933">h0</span>&nbsp;<span class="op" id="5911936">==</span>&nbsp;<span class="num" id="5911939">1</span>&nbsp;<span class="op" id="5911941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911950">by</span>&nbsp;<span class="op" id="5911953">+=</span>&nbsp;<span class="ident" id="5911956">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5911964">}</span>&nbsp;<span class="keyword" id="5911966">else</span>&nbsp;<span class="op" id="5911971">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911980">bx</span>&nbsp;<span class="op" id="5911983">+=</span>&nbsp;<span class="ident" id="5911986">j</span>&nbsp;<span class="op" id="5911988">%</span>&nbsp;<span class="num" id="5911990">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5911999">by</span>&nbsp;<span class="op" id="5912002">+=</span>&nbsp;<span class="ident" id="5912005">j</span>&nbsp;<span class="op" id="5912007">/</span>&nbsp;<span class="num" id="5912009">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912024">}</span>&nbsp;<span class="keyword" id="5912026">else</span>&nbsp;<span class="op" id="5912031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912039">q</span>&nbsp;<span class="op" id="5912041">:=</span>&nbsp;<span class="ident" id="5912044">mxx</span>&nbsp;<span class="op" id="5912048">*</span>&nbsp;<span class="ident" id="5912050">d</span><span class="op" id="5912051">.</span><span class="ident" id="5912052">comp</span><span class="op" id="5912056">[</span><span class="ident" id="5912057">compIndex</span><span class="op" id="5912066">]</span><span class="op" id="5912067">.</span><span class="ident" id="5912068">h</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912076">bx</span>&nbsp;<span class="op" id="5912079">=</span>&nbsp;<span class="ident" id="5912081">blockCount</span>&nbsp;<span class="op" id="5912092">%</span>&nbsp;<span class="ident" id="5912094">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912102">by</span>&nbsp;<span class="op" id="5912105">=</span>&nbsp;<span class="ident" id="5912107">blockCount</span>&nbsp;<span class="op" id="5912118">/</span>&nbsp;<span class="ident" id="5912120">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912128">blockCount</span><span class="op" id="5912138">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912147">if</span>&nbsp;<span class="ident" id="5912150">bx</span><span class="op" id="5912152">*</span><span class="num" id="5912153">8</span>&nbsp;<span class="op" id="5912155">&gt;=</span>&nbsp;<span class="ident" id="5912158">d</span><span class="op" id="5912159">.</span><span class="ident" id="5912160">width</span>&nbsp;<span class="op" id="5912166">||</span>&nbsp;<span class="ident" id="5912169">by</span><span class="op" id="5912171">*</span><span class="num" id="5912172">8</span>&nbsp;<span class="op" id="5912174">&gt;=</span>&nbsp;<span class="ident" id="5912177">d</span><span class="op" id="5912178">.</span><span class="ident" id="5912179">height</span>&nbsp;<span class="op" id="5912186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912195">continue</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5912225">//&nbsp;Load&nbsp;the&nbsp;previous&nbsp;partially&nbsp;decoded&nbsp;coefficients,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912298">if</span>&nbsp;<span class="ident" id="5912301">d</span><span class="op" id="5912302">.</span><span class="ident" id="5912303">progressive</span>&nbsp;<span class="op" id="5912315">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912323">b</span>&nbsp;<span class="op" id="5912325">=</span>&nbsp;<span class="ident" id="5912327">d</span><span class="op" id="5912328">.</span><span class="ident" id="5912329">progCoeffs</span><span class="op" id="5912339">[</span><span class="ident" id="5912340">compIndex</span><span class="op" id="5912349">]</span><span class="op" id="5912350">[</span><span class="ident" id="5912351">by</span><span class="op" id="5912353">*</span><span class="ident" id="5912354">mxx</span><span class="op" id="5912357">*</span><span class="ident" id="5912358">d</span><span class="op" id="5912359">.</span><span class="ident" id="5912360">comp</span><span class="op" id="5912364">[</span><span class="ident" id="5912365">compIndex</span><span class="op" id="5912374">]</span><span class="op" id="5912375">.</span><span class="ident" id="5912376">h</span><span class="op" id="5912377">+</span><span class="ident" id="5912378">bx</span><span class="op" id="5912380">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912387">}</span>&nbsp;<span class="keyword" id="5912389">else</span>&nbsp;<span class="op" id="5912394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912402">b</span>&nbsp;<span class="op" id="5912404">=</span>&nbsp;<span class="ident" id="5912406">block</span><span class="op" id="5912411">{</span><span class="op" id="5912412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912427">if</span>&nbsp;<span class="ident" id="5912430">ah</span>&nbsp;<span class="op" id="5912433">!=</span>&nbsp;<span class="num" id="5912436">0</span>&nbsp;<span class="op" id="5912438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912446">if</span>&nbsp;<span class="ident" id="5912449">err</span>&nbsp;<span class="op" id="5912453">:=</span>&nbsp;<span class="ident" id="5912456">d</span><span class="op" id="5912457">.</span><span class="ident" id="5912458">refine</span><span class="op" id="5912464">(</span><span class="op" id="5912465">&amp;</span><span class="ident" id="5912466">b</span><span class="op" id="5912467">,</span>&nbsp;<span class="op" id="5912469">&amp;</span><span class="ident" id="5912470">d</span><span class="op" id="5912471">.</span><span class="ident" id="5912472">huff</span><span class="op" id="5912476">[</span><span class="ident" id="5912477">acTable</span><span class="op" id="5912484">]</span><span class="op" id="5912485">[</span><span class="ident" id="5912486">scan</span><span class="op" id="5912490">[</span><span class="ident" id="5912491">i</span><span class="op" id="5912492">]</span><span class="op" id="5912493">.</span><span class="ident" id="5912494">ta</span><span class="op" id="5912496">]</span><span class="op" id="5912497">,</span>&nbsp;<span class="ident" id="5912499">zigStart</span><span class="op" id="5912507">,</span>&nbsp;<span class="ident" id="5912509">zigEnd</span><span class="op" id="5912515">,</span>&nbsp;<span class="num" id="5912517">1</span><span class="op" id="5912518">&lt;&lt;</span><span class="ident" id="5912520">al</span><span class="op" id="5912522">)</span><span class="op" id="5912523">;</span>&nbsp;<span class="ident" id="5912525">err</span>&nbsp;<span class="op" id="5912529">!=</span>&nbsp;<span class="ident" id="5912532">nil</span>&nbsp;<span class="op" id="5912536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912545">return</span>&nbsp;<span class="ident" id="5912552">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912569">}</span>&nbsp;<span class="keyword" id="5912571">else</span>&nbsp;<span class="op" id="5912576">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912584">zig</span>&nbsp;<span class="op" id="5912588">:=</span>&nbsp;<span class="ident" id="5912591">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912606">if</span>&nbsp;<span class="ident" id="5912609">zig</span>&nbsp;<span class="op" id="5912613">==</span>&nbsp;<span class="num" id="5912616">0</span>&nbsp;<span class="op" id="5912618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912627">zig</span><span class="op" id="5912630">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5912640">//&nbsp;Decode&nbsp;the&nbsp;DC&nbsp;coefficient,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912710">value</span><span class="op" id="5912715">,</span>&nbsp;<span class="ident" id="5912717">err</span>&nbsp;<span class="op" id="5912721">:=</span>&nbsp;<span class="ident" id="5912724">d</span><span class="op" id="5912725">.</span><span class="ident" id="5912726">decodeHuffman</span><span class="op" id="5912739">(</span><span class="op" id="5912740">&amp;</span><span class="ident" id="5912741">d</span><span class="op" id="5912742">.</span><span class="ident" id="5912743">huff</span><span class="op" id="5912747">[</span><span class="ident" id="5912748">dcTable</span><span class="op" id="5912755">]</span><span class="op" id="5912756">[</span><span class="ident" id="5912757">scan</span><span class="op" id="5912761">[</span><span class="ident" id="5912762">i</span><span class="op" id="5912763">]</span><span class="op" id="5912764">.</span><span class="ident" id="5912765">td</span><span class="op" id="5912767">]</span><span class="op" id="5912768">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912777">if</span>&nbsp;<span class="ident" id="5912780">err</span>&nbsp;<span class="op" id="5912784">!=</span>&nbsp;<span class="ident" id="5912787">nil</span>&nbsp;<span class="op" id="5912791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912801">return</span>&nbsp;<span class="ident" id="5912808">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912828">if</span>&nbsp;<span class="ident" id="5912831">value</span>&nbsp;<span class="op" id="5912837">&gt;</span>&nbsp;<span class="num" id="5912839">16</span>&nbsp;<span class="op" id="5912842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912852">return</span>&nbsp;<span class="ident" id="5912859">UnsupportedError</span><span class="op" id="5912875">(</span><span class="string" id="5912876">&#34;excessive&nbsp;DC&nbsp;component&#34;</span><span class="op" id="5912900">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5912909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5912918">dcDelta</span><span class="op" id="5912925">,</span>&nbsp;<span class="ident" id="5912927">err</span>&nbsp;<span class="op" id="5912931">:=</span>&nbsp;<span class="ident" id="5912934">d</span><span class="op" id="5912935">.</span><span class="ident" id="5912936">receiveExtend</span><span class="op" id="5912949">(</span><span class="ident" id="5912950">value</span><span class="op" id="5912955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912964">if</span>&nbsp;<span class="ident" id="5912967">err</span>&nbsp;<span class="op" id="5912971">!=</span>&nbsp;<span class="ident" id="5912974">nil</span>&nbsp;<span class="op" id="5912978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5912988">return</span>&nbsp;<span class="ident" id="5912995">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913006">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913015">dc</span><span class="op" id="5913017">[</span><span class="ident" id="5913018">compIndex</span><span class="op" id="5913027">]</span>&nbsp;<span class="op" id="5913029">+=</span>&nbsp;<span class="ident" id="5913032">dcDelta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913047">b</span><span class="op" id="5913048">[</span><span class="num" id="5913049">0</span><span class="op" id="5913050">]</span>&nbsp;<span class="op" id="5913052">=</span>&nbsp;<span class="ident" id="5913054">dc</span><span class="op" id="5913056">[</span><span class="ident" id="5913057">compIndex</span><span class="op" id="5913066">]</span>&nbsp;<span class="op" id="5913068">&lt;&lt;</span>&nbsp;<span class="ident" id="5913071">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913089">if</span>&nbsp;<span class="ident" id="5913092">zig</span>&nbsp;<span class="op" id="5913096">&lt;=</span>&nbsp;<span class="ident" id="5913099">zigEnd</span>&nbsp;<span class="op" id="5913106">&amp;&amp;</span>&nbsp;<span class="ident" id="5913109">d</span><span class="op" id="5913110">.</span><span class="ident" id="5913111">eobRun</span>&nbsp;<span class="op" id="5913118">&gt;</span>&nbsp;<span class="num" id="5913120">0</span>&nbsp;<span class="op" id="5913122">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913131">d</span><span class="op" id="5913132">.</span><span class="ident" id="5913133">eobRun</span><span class="op" id="5913139">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913148">}</span>&nbsp;<span class="keyword" id="5913150">else</span>&nbsp;<span class="op" id="5913155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5913164">//&nbsp;Decode&nbsp;the&nbsp;AC&nbsp;coefficients,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913235">huff</span>&nbsp;<span class="op" id="5913240">:=</span>&nbsp;<span class="op" id="5913243">&amp;</span><span class="ident" id="5913244">d</span><span class="op" id="5913245">.</span><span class="ident" id="5913246">huff</span><span class="op" id="5913250">[</span><span class="ident" id="5913251">acTable</span><span class="op" id="5913258">]</span><span class="op" id="5913259">[</span><span class="ident" id="5913260">scan</span><span class="op" id="5913264">[</span><span class="ident" id="5913265">i</span><span class="op" id="5913266">]</span><span class="op" id="5913267">.</span><span class="ident" id="5913268">ta</span><span class="op" id="5913270">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913279">for</span>&nbsp;<span class="op" id="5913283">;</span>&nbsp;<span class="ident" id="5913285">zig</span>&nbsp;<span class="op" id="5913289">&lt;=</span>&nbsp;<span class="ident" id="5913292">zigEnd</span><span class="op" id="5913298">;</span>&nbsp;<span class="ident" id="5913300">zig</span><span class="op" id="5913303">++</span>&nbsp;<span class="op" id="5913306">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913316">value</span><span class="op" id="5913321">,</span>&nbsp;<span class="ident" id="5913323">err</span>&nbsp;<span class="op" id="5913327">:=</span>&nbsp;<span class="ident" id="5913330">d</span><span class="op" id="5913331">.</span><span class="ident" id="5913332">decodeHuffman</span><span class="op" id="5913345">(</span><span class="ident" id="5913346">huff</span><span class="op" id="5913350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913360">if</span>&nbsp;<span class="ident" id="5913363">err</span>&nbsp;<span class="op" id="5913367">!=</span>&nbsp;<span class="ident" id="5913370">nil</span>&nbsp;<span class="op" id="5913374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913385">return</span>&nbsp;<span class="ident" id="5913392">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913414">val0</span>&nbsp;<span class="op" id="5913419">:=</span>&nbsp;<span class="ident" id="5913422">value</span>&nbsp;<span class="op" id="5913428">&gt;&gt;</span>&nbsp;<span class="num" id="5913431">4</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913441">val1</span>&nbsp;<span class="op" id="5913446">:=</span>&nbsp;<span class="ident" id="5913449">value</span>&nbsp;<span class="op" id="5913455">&amp;</span>&nbsp;<span class="num" id="5913457">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913470">if</span>&nbsp;<span class="ident" id="5913473">val1</span>&nbsp;<span class="op" id="5913478">!=</span>&nbsp;<span class="num" id="5913481">0</span>&nbsp;<span class="op" id="5913483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913494">zig</span>&nbsp;<span class="op" id="5913498">+=</span>&nbsp;<span class="builtintype" id="5913501">int32</span><span class="op" id="5913506">(</span><span class="ident" id="5913507">val0</span><span class="op" id="5913511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913522">if</span>&nbsp;<span class="ident" id="5913525">zig</span>&nbsp;<span class="op" id="5913529">&gt;</span>&nbsp;<span class="ident" id="5913531">zigEnd</span>&nbsp;<span class="op" id="5913538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913550">break</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913576">ac</span><span class="op" id="5913578">,</span>&nbsp;<span class="ident" id="5913580">err</span>&nbsp;<span class="op" id="5913584">:=</span>&nbsp;<span class="ident" id="5913587">d</span><span class="op" id="5913588">.</span><span class="ident" id="5913589">receiveExtend</span><span class="op" id="5913602">(</span><span class="ident" id="5913603">val1</span><span class="op" id="5913607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913618">if</span>&nbsp;<span class="ident" id="5913621">err</span>&nbsp;<span class="op" id="5913625">!=</span>&nbsp;<span class="ident" id="5913628">nil</span>&nbsp;<span class="op" id="5913632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913644">return</span>&nbsp;<span class="ident" id="5913651">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913664">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913675">b</span><span class="op" id="5913676">[</span><span class="ident" id="5913677">unzig</span><span class="op" id="5913682">[</span><span class="ident" id="5913683">zig</span><span class="op" id="5913686">]</span><span class="op" id="5913687">]</span>&nbsp;<span class="op" id="5913689">=</span>&nbsp;<span class="ident" id="5913691">ac</span>&nbsp;<span class="op" id="5913694">&lt;&lt;</span>&nbsp;<span class="ident" id="5913697">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913708">}</span>&nbsp;<span class="keyword" id="5913710">else</span>&nbsp;<span class="op" id="5913715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913726">if</span>&nbsp;<span class="ident" id="5913729">val0</span>&nbsp;<span class="op" id="5913734">!=</span>&nbsp;<span class="num" id="5913737">0x0f</span>&nbsp;<span class="op" id="5913742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913754">d</span><span class="op" id="5913755">.</span><span class="ident" id="5913756">eobRun</span>&nbsp;<span class="op" id="5913763">=</span>&nbsp;<span class="builtintype" id="5913765">uint16</span><span class="op" id="5913771">(</span><span class="num" id="5913772">1</span>&nbsp;<span class="op" id="5913774">&lt;&lt;</span>&nbsp;<span class="ident" id="5913777">val0</span><span class="op" id="5913781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913793">if</span>&nbsp;<span class="ident" id="5913796">val0</span>&nbsp;<span class="op" id="5913801">!=</span>&nbsp;<span class="num" id="5913804">0</span>&nbsp;<span class="op" id="5913806">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913819">bits</span><span class="op" id="5913823">,</span>&nbsp;<span class="ident" id="5913825">err</span>&nbsp;<span class="op" id="5913829">:=</span>&nbsp;<span class="ident" id="5913832">d</span><span class="op" id="5913833">.</span><span class="ident" id="5913834">decodeBits</span><span class="op" id="5913844">(</span><span class="builtintype" id="5913845">int32</span><span class="op" id="5913850">(</span><span class="ident" id="5913851">val0</span><span class="op" id="5913855">)</span><span class="op" id="5913856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913869">if</span>&nbsp;<span class="ident" id="5913872">err</span>&nbsp;<span class="op" id="5913876">!=</span>&nbsp;<span class="ident" id="5913879">nil</span>&nbsp;<span class="op" id="5913883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5913897">return</span>&nbsp;<span class="ident" id="5913904">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913932">d</span><span class="op" id="5913933">.</span><span class="ident" id="5913934">eobRun</span>&nbsp;<span class="op" id="5913941">|=</span>&nbsp;<span class="builtintype" id="5913944">uint16</span><span class="op" id="5913950">(</span><span class="ident" id="5913951">bits</span><span class="op" id="5913955">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5913967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5913979">d</span><span class="op" id="5913980">.</span><span class="ident" id="5913981">eobRun</span><span class="op" id="5913987">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914000">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914026">zig</span>&nbsp;<span class="op" id="5914030">+=</span>&nbsp;<span class="num" id="5914033">0x0f</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914078">if</span>&nbsp;<span class="ident" id="5914081">d</span><span class="op" id="5914082">.</span><span class="ident" id="5914083">progressive</span>&nbsp;<span class="op" id="5914095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914103">if</span>&nbsp;<span class="ident" id="5914106">zigEnd</span>&nbsp;<span class="op" id="5914113">!=</span>&nbsp;<span class="ident" id="5914116">blockSize</span><span class="op" id="5914125">-</span><span class="num" id="5914126">1</span>&nbsp;<span class="op" id="5914128">||</span>&nbsp;<span class="ident" id="5914131">al</span>&nbsp;<span class="op" id="5914134">!=</span>&nbsp;<span class="num" id="5914137">0</span>&nbsp;<span class="op" id="5914139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914148">//&nbsp;We&nbsp;haven&#39;t&nbsp;completely&nbsp;decoded&nbsp;this&nbsp;8x8&nbsp;block.&nbsp;Save&nbsp;the&nbsp;coefficients.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914227">d</span><span class="op" id="5914228">.</span><span class="ident" id="5914229">progCoeffs</span><span class="op" id="5914239">[</span><span class="ident" id="5914240">compIndex</span><span class="op" id="5914249">]</span><span class="op" id="5914250">[</span><span class="ident" id="5914251">by</span><span class="op" id="5914253">*</span><span class="ident" id="5914254">mxx</span><span class="op" id="5914257">*</span><span class="ident" id="5914258">d</span><span class="op" id="5914259">.</span><span class="ident" id="5914260">comp</span><span class="op" id="5914264">[</span><span class="ident" id="5914265">compIndex</span><span class="op" id="5914274">]</span><span class="op" id="5914275">.</span><span class="ident" id="5914276">h</span><span class="op" id="5914277">+</span><span class="ident" id="5914278">bx</span><span class="op" id="5914280">]</span>&nbsp;<span class="op" id="5914282">=</span>&nbsp;<span class="ident" id="5914284">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914293">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;we&nbsp;could&nbsp;execute&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;loop&nbsp;body&nbsp;to&nbsp;dequantize&nbsp;and</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914379">//&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT,&nbsp;to&nbsp;save&nbsp;early&nbsp;stages&nbsp;of&nbsp;a&nbsp;progressive&nbsp;image&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914465">//&nbsp;*image.YCbCr&nbsp;buffers&nbsp;(the&nbsp;whole&nbsp;point&nbsp;of&nbsp;progressive&nbsp;encoding),&nbsp;but&nbsp;in&nbsp;Go,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914550">//&nbsp;the&nbsp;jpeg.Decode&nbsp;function&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;entire&nbsp;image&nbsp;is&nbsp;decoded,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914636">//&nbsp;so&nbsp;we&nbsp;&#34;continue&#34;&nbsp;here&nbsp;to&nbsp;avoid&nbsp;wasted&nbsp;computation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914697">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5914727">//&nbsp;Dequantize,&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT&nbsp;and&nbsp;store&nbsp;the&nbsp;block&nbsp;to&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914805">for</span>&nbsp;<span class="ident" id="5914809">zig</span>&nbsp;<span class="op" id="5914813">:=</span>&nbsp;<span class="num" id="5914816">0</span><span class="op" id="5914817">;</span>&nbsp;<span class="ident" id="5914819">zig</span>&nbsp;<span class="op" id="5914823">&lt;</span>&nbsp;<span class="ident" id="5914825">blockSize</span><span class="op" id="5914834">;</span>&nbsp;<span class="ident" id="5914836">zig</span><span class="op" id="5914839">++</span>&nbsp;<span class="op" id="5914842">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914850">b</span><span class="op" id="5914851">[</span><span class="ident" id="5914852">unzig</span><span class="op" id="5914857">[</span><span class="ident" id="5914858">zig</span><span class="op" id="5914861">]</span><span class="op" id="5914862">]</span>&nbsp;<span class="op" id="5914864">*=</span>&nbsp;<span class="ident" id="5914867">qt</span><span class="op" id="5914869">[</span><span class="ident" id="5914870">zig</span><span class="op" id="5914873">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5914880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914887">idct</span><span class="op" id="5914891">(</span><span class="op" id="5914892">&amp;</span><span class="ident" id="5914893">b</span><span class="op" id="5914894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914901">dst</span><span class="op" id="5914904">,</span>&nbsp;<span class="ident" id="5914906">stride</span>&nbsp;<span class="op" id="5914913">:=</span>&nbsp;<span class="op" id="5914916">[</span><span class="op" id="5914917">]</span><span class="builtintype" id="5914918">byte</span><span class="op" id="5914922">(</span><span class="ident" id="5914923">nil</span><span class="op" id="5914926">)</span><span class="op" id="5914927">,</span>&nbsp;<span class="num" id="5914929">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5914936">if</span>&nbsp;<span class="ident" id="5914939">d</span><span class="op" id="5914940">.</span><span class="ident" id="5914941">nComp</span>&nbsp;<span class="op" id="5914947">==</span>&nbsp;<span class="ident" id="5914950">nGrayComponent</span>&nbsp;<span class="op" id="5914965">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5914973">dst</span><span class="op" id="5914976">,</span>&nbsp;<span class="ident" id="5914978">stride</span>&nbsp;<span class="op" id="5914985">=</span>&nbsp;<span class="ident" id="5914987">d</span><span class="op" id="5914988">.</span><span class="ident" id="5914989">img1</span><span class="op" id="5914993">.</span><span class="ident" id="5914994">Pix</span><span class="op" id="5914997">[</span><span class="num" id="5914998">8</span><span class="op" id="5914999">*</span><span class="op" id="5915000">(</span><span class="ident" id="5915001">by</span><span class="op" id="5915003">*</span><span class="ident" id="5915004">d</span><span class="op" id="5915005">.</span><span class="ident" id="5915006">img1</span><span class="op" id="5915010">.</span><span class="ident" id="5915011">Stride</span><span class="op" id="5915017">+</span><span class="ident" id="5915018">bx</span><span class="op" id="5915020">)</span><span class="op" id="5915021">:</span><span class="op" id="5915022">]</span><span class="op" id="5915023">,</span>&nbsp;<span class="ident" id="5915025">d</span><span class="op" id="5915026">.</span><span class="ident" id="5915027">img1</span><span class="op" id="5915031">.</span><span class="ident" id="5915032">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915044">}</span>&nbsp;<span class="keyword" id="5915046">else</span>&nbsp;<span class="op" id="5915051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915059">switch</span>&nbsp;<span class="ident" id="5915066">compIndex</span>&nbsp;<span class="op" id="5915076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915084">case</span>&nbsp;<span class="num" id="5915089">0</span><span class="op" id="5915090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915099">dst</span><span class="op" id="5915102">,</span>&nbsp;<span class="ident" id="5915104">stride</span>&nbsp;<span class="op" id="5915111">=</span>&nbsp;<span class="ident" id="5915113">d</span><span class="op" id="5915114">.</span><span class="ident" id="5915115">img3</span><span class="op" id="5915119">.</span><span class="ident" id="5915120">Y</span><span class="op" id="5915121">[</span><span class="num" id="5915122">8</span><span class="op" id="5915123">*</span><span class="op" id="5915124">(</span><span class="ident" id="5915125">by</span><span class="op" id="5915127">*</span><span class="ident" id="5915128">d</span><span class="op" id="5915129">.</span><span class="ident" id="5915130">img3</span><span class="op" id="5915134">.</span><span class="ident" id="5915135">YStride</span><span class="op" id="5915142">+</span><span class="ident" id="5915143">bx</span><span class="op" id="5915145">)</span><span class="op" id="5915146">:</span><span class="op" id="5915147">]</span><span class="op" id="5915148">,</span>&nbsp;<span class="ident" id="5915150">d</span><span class="op" id="5915151">.</span><span class="ident" id="5915152">img3</span><span class="op" id="5915156">.</span><span class="ident" id="5915157">YStride</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915171">case</span>&nbsp;<span class="num" id="5915176">1</span><span class="op" id="5915177">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915186">dst</span><span class="op" id="5915189">,</span>&nbsp;<span class="ident" id="5915191">stride</span>&nbsp;<span class="op" id="5915198">=</span>&nbsp;<span class="ident" id="5915200">d</span><span class="op" id="5915201">.</span><span class="ident" id="5915202">img3</span><span class="op" id="5915206">.</span><span class="ident" id="5915207">Cb</span><span class="op" id="5915209">[</span><span class="num" id="5915210">8</span><span class="op" id="5915211">*</span><span class="op" id="5915212">(</span><span class="ident" id="5915213">by</span><span class="op" id="5915215">*</span><span class="ident" id="5915216">d</span><span class="op" id="5915217">.</span><span class="ident" id="5915218">img3</span><span class="op" id="5915222">.</span><span class="ident" id="5915223">CStride</span><span class="op" id="5915230">+</span><span class="ident" id="5915231">bx</span><span class="op" id="5915233">)</span><span class="op" id="5915234">:</span><span class="op" id="5915235">]</span><span class="op" id="5915236">,</span>&nbsp;<span class="ident" id="5915238">d</span><span class="op" id="5915239">.</span><span class="ident" id="5915240">img3</span><span class="op" id="5915244">.</span><span class="ident" id="5915245">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915259">case</span>&nbsp;<span class="num" id="5915264">2</span><span class="op" id="5915265">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915274">dst</span><span class="op" id="5915277">,</span>&nbsp;<span class="ident" id="5915279">stride</span>&nbsp;<span class="op" id="5915286">=</span>&nbsp;<span class="ident" id="5915288">d</span><span class="op" id="5915289">.</span><span class="ident" id="5915290">img3</span><span class="op" id="5915294">.</span><span class="ident" id="5915295">Cr</span><span class="op" id="5915297">[</span><span class="num" id="5915298">8</span><span class="op" id="5915299">*</span><span class="op" id="5915300">(</span><span class="ident" id="5915301">by</span><span class="op" id="5915303">*</span><span class="ident" id="5915304">d</span><span class="op" id="5915305">.</span><span class="ident" id="5915306">img3</span><span class="op" id="5915310">.</span><span class="ident" id="5915311">CStride</span><span class="op" id="5915318">+</span><span class="ident" id="5915319">bx</span><span class="op" id="5915321">)</span><span class="op" id="5915322">:</span><span class="op" id="5915323">]</span><span class="op" id="5915324">,</span>&nbsp;<span class="ident" id="5915326">d</span><span class="op" id="5915327">.</span><span class="ident" id="5915328">img3</span><span class="op" id="5915332">.</span><span class="ident" id="5915333">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915347">default</span><span class="op" id="5915354">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915363">return</span>&nbsp;<span class="ident" id="5915370">UnsupportedError</span><span class="op" id="5915386">(</span><span class="string" id="5915387">&#34;too&nbsp;many&nbsp;components&#34;</span><span class="op" id="5915408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915430">//&nbsp;Level&nbsp;shift&nbsp;by&nbsp;+128,&nbsp;clip&nbsp;to&nbsp;[0,&nbsp;255],&nbsp;and&nbsp;write&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915495">for</span>&nbsp;<span class="ident" id="5915499">y</span>&nbsp;<span class="op" id="5915501">:=</span>&nbsp;<span class="num" id="5915504">0</span><span class="op" id="5915505">;</span>&nbsp;<span class="ident" id="5915507">y</span>&nbsp;<span class="op" id="5915509">&lt;</span>&nbsp;<span class="num" id="5915511">8</span><span class="op" id="5915512">;</span>&nbsp;<span class="ident" id="5915514">y</span><span class="op" id="5915515">++</span>&nbsp;<span class="op" id="5915518">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915526">y8</span>&nbsp;<span class="op" id="5915529">:=</span>&nbsp;<span class="ident" id="5915532">y</span>&nbsp;<span class="op" id="5915534">*</span>&nbsp;<span class="num" id="5915536">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915544">yStride</span>&nbsp;<span class="op" id="5915552">:=</span>&nbsp;<span class="ident" id="5915555">y</span>&nbsp;<span class="op" id="5915557">*</span>&nbsp;<span class="ident" id="5915559">stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915572">for</span>&nbsp;<span class="ident" id="5915576">x</span>&nbsp;<span class="op" id="5915578">:=</span>&nbsp;<span class="num" id="5915581">0</span><span class="op" id="5915582">;</span>&nbsp;<span class="ident" id="5915584">x</span>&nbsp;<span class="op" id="5915586">&lt;</span>&nbsp;<span class="num" id="5915588">8</span><span class="op" id="5915589">;</span>&nbsp;<span class="ident" id="5915591">x</span><span class="op" id="5915592">++</span>&nbsp;<span class="op" id="5915595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915604">c</span>&nbsp;<span class="op" id="5915606">:=</span>&nbsp;<span class="ident" id="5915609">b</span><span class="op" id="5915610">[</span><span class="ident" id="5915611">y8</span><span class="op" id="5915613">+</span><span class="ident" id="5915614">x</span><span class="op" id="5915615">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915624">if</span>&nbsp;<span class="ident" id="5915627">c</span>&nbsp;<span class="op" id="5915629">&lt;</span>&nbsp;<span class="op" id="5915631">-</span><span class="num" id="5915632">128</span>&nbsp;<span class="op" id="5915636">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915646">c</span>&nbsp;<span class="op" id="5915648">=</span>&nbsp;<span class="num" id="5915650">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915659">}</span>&nbsp;<span class="keyword" id="5915661">else</span>&nbsp;<span class="keyword" id="5915666">if</span>&nbsp;<span class="ident" id="5915669">c</span>&nbsp;<span class="op" id="5915671">&gt;</span>&nbsp;<span class="num" id="5915673">127</span>&nbsp;<span class="op" id="5915677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915687">c</span>&nbsp;<span class="op" id="5915689">=</span>&nbsp;<span class="num" id="5915691">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915702">}</span>&nbsp;<span class="keyword" id="5915704">else</span>&nbsp;<span class="op" id="5915709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915719">c</span>&nbsp;<span class="op" id="5915721">+=</span>&nbsp;<span class="num" id="5915724">128</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915744">dst</span><span class="op" id="5915747">[</span><span class="ident" id="5915748">yStride</span><span class="op" id="5915755">+</span><span class="ident" id="5915756">x</span><span class="op" id="5915757">]</span>&nbsp;<span class="op" id="5915759">=</span>&nbsp;<span class="builtintype" id="5915761">uint8</span><span class="op" id="5915766">(</span><span class="ident" id="5915767">c</span><span class="op" id="5915768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915789">}</span>&nbsp;<span class="comment" id="5915791">//&nbsp;for&nbsp;j</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5915803">}</span>&nbsp;<span class="comment" id="5915805">//&nbsp;for&nbsp;i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5915817">mcu</span><span class="op" id="5915820">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5915826">if</span>&nbsp;<span class="ident" id="5915829">d</span><span class="op" id="5915830">.</span><span class="ident" id="5915831">ri</span>&nbsp;<span class="op" id="5915834">&gt;</span>&nbsp;<span class="num" id="5915836">0</span>&nbsp;<span class="op" id="5915838">&amp;&amp;</span>&nbsp;<span class="ident" id="5915841">mcu</span><span class="op" id="5915844">%</span><span class="ident" id="5915845">d</span><span class="op" id="5915846">.</span><span class="ident" id="5915847">ri</span>&nbsp;<span class="op" id="5915850">==</span>&nbsp;<span class="num" id="5915853">0</span>&nbsp;<span class="op" id="5915855">&amp;&amp;</span>&nbsp;<span class="ident" id="5915858">mcu</span>&nbsp;<span class="op" id="5915862">&lt;</span>&nbsp;<span class="ident" id="5915864">mxx</span><span class="op" id="5915867">*</span><span class="ident" id="5915868">myy</span>&nbsp;<span class="op" id="5915872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915878">//&nbsp;A&nbsp;more&nbsp;sophisticated&nbsp;decoder&nbsp;could&nbsp;use&nbsp;RST[0-7]&nbsp;markers&nbsp;to&nbsp;resynchronize&nbsp;from&nbsp;corrupt&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5915978">//&nbsp;but&nbsp;this&nbsp;one&nbsp;assumes&nbsp;well-formed&nbsp;input,&nbsp;and&nbsp;hence&nbsp;the&nbsp;restart&nbsp;marker&nbsp;follows&nbsp;immediately.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916075">if</span>&nbsp;<span class="ident" id="5916078">err</span>&nbsp;<span class="op" id="5916082">:=</span>&nbsp;<span class="ident" id="5916085">d</span><span class="op" id="5916086">.</span><span class="ident" id="5916087">readFull</span><span class="op" id="5916095">(</span><span class="ident" id="5916096">d</span><span class="op" id="5916097">.</span><span class="ident" id="5916098">tmp</span><span class="op" id="5916101">[</span><span class="op" id="5916102">:</span><span class="num" id="5916103">2</span><span class="op" id="5916104">]</span><span class="op" id="5916105">)</span><span class="op" id="5916106">;</span>&nbsp;<span class="ident" id="5916108">err</span>&nbsp;<span class="op" id="5916112">!=</span>&nbsp;<span class="ident" id="5916115">nil</span>&nbsp;<span class="op" id="5916119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916126">return</span>&nbsp;<span class="ident" id="5916133">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916147">if</span>&nbsp;<span class="ident" id="5916150">d</span><span class="op" id="5916151">.</span><span class="ident" id="5916152">tmp</span><span class="op" id="5916155">[</span><span class="num" id="5916156">0</span><span class="op" id="5916157">]</span>&nbsp;<span class="op" id="5916159">!=</span>&nbsp;<span class="num" id="5916162">0xff</span>&nbsp;<span class="op" id="5916167">||</span>&nbsp;<span class="ident" id="5916170">d</span><span class="op" id="5916171">.</span><span class="ident" id="5916172">tmp</span><span class="op" id="5916175">[</span><span class="num" id="5916176">1</span><span class="op" id="5916177">]</span>&nbsp;<span class="op" id="5916179">!=</span>&nbsp;<span class="ident" id="5916182">expectedRST</span>&nbsp;<span class="op" id="5916194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916201">return</span>&nbsp;<span class="ident" id="5916208">FormatError</span><span class="op" id="5916219">(</span><span class="string" id="5916220">&#34;bad&nbsp;RST&nbsp;marker&#34;</span><span class="op" id="5916236">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916248">expectedRST</span><span class="op" id="5916259">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916266">if</span>&nbsp;<span class="ident" id="5916269">expectedRST</span>&nbsp;<span class="op" id="5916281">==</span>&nbsp;<span class="ident" id="5916284">rst7Marker</span><span class="op" id="5916294">+</span><span class="num" id="5916295">1</span>&nbsp;<span class="op" id="5916297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916304">expectedRST</span>&nbsp;<span class="op" id="5916316">=</span>&nbsp;<span class="ident" id="5916318">rst0Marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916333">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916339">//&nbsp;Reset&nbsp;the&nbsp;Huffman&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916373">d</span><span class="op" id="5916374">.</span><span class="ident" id="5916375">bits</span>&nbsp;<span class="op" id="5916380">=</span>&nbsp;<span class="ident" id="5916382">bits</span><span class="op" id="5916386">{</span><span class="op" id="5916387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916393">//&nbsp;Reset&nbsp;the&nbsp;DC&nbsp;components,&nbsp;as&nbsp;per&nbsp;section&nbsp;F.2.1.3.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916451">dc</span>&nbsp;<span class="op" id="5916454">=</span>&nbsp;<span class="op" id="5916456">[</span><span class="ident" id="5916457">nColorComponent</span><span class="op" id="5916472">]</span><span class="builtintype" id="5916473">int32</span><span class="op" id="5916478">{</span><span class="op" id="5916479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916485">//&nbsp;Reset&nbsp;the&nbsp;progressive&nbsp;decoder&nbsp;state,&nbsp;as&nbsp;per&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916553">d</span><span class="op" id="5916554">.</span><span class="ident" id="5916555">eobRun</span>&nbsp;<span class="op" id="5916562">=</span>&nbsp;<span class="num" id="5916564">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916573">}</span>&nbsp;<span class="comment" id="5916575">//&nbsp;for&nbsp;mx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916586">}</span>&nbsp;<span class="comment" id="5916588">//&nbsp;for&nbsp;my</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916600">return</span>&nbsp;<span class="ident" id="5916607">nil</span><br>
<span class="lineno"></span><span class="op" id="5916611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5916614">//&nbsp;refine&nbsp;decodes&nbsp;a&nbsp;successive&nbsp;approximation&nbsp;refinement&nbsp;block,&nbsp;as&nbsp;specified&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5916693">//&nbsp;section&nbsp;G.1.2.</span><br>
<span class="lineno">340</span><span class="keyword" id="5916711">func</span>&nbsp;<span class="op" id="5916716">(</span><span class="ident" id="5916717">d</span>&nbsp;<span class="op" id="5916719">*</span><span class="ident" id="5916720">decoder</span><span class="op" id="5916727">)</span>&nbsp;<span class="ident" id="5916729">refine</span><span class="op" id="5916735">(</span><span class="ident" id="5916736">b</span>&nbsp;<span class="op" id="5916738">*</span><span class="ident" id="5916739">block</span><span class="op" id="5916744">,</span>&nbsp;<span class="ident" id="5916746">h</span>&nbsp;<span class="op" id="5916748">*</span><span class="ident" id="5916749">huffman</span><span class="op" id="5916756">,</span>&nbsp;<span class="ident" id="5916758">zigStart</span><span class="op" id="5916766">,</span>&nbsp;<span class="ident" id="5916768">zigEnd</span><span class="op" id="5916774">,</span>&nbsp;<span class="ident" id="5916776">delta</span>&nbsp;<span class="builtintype" id="5916782">int32</span><span class="op" id="5916787">)</span>&nbsp;<span class="builtintype" id="5916789">error</span>&nbsp;<span class="op" id="5916795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5916798">//&nbsp;Refining&nbsp;a&nbsp;DC&nbsp;component&nbsp;is&nbsp;trivial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916838">if</span>&nbsp;<span class="ident" id="5916841">zigStart</span>&nbsp;<span class="op" id="5916850">==</span>&nbsp;<span class="num" id="5916853">0</span>&nbsp;<span class="op" id="5916855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916859">if</span>&nbsp;<span class="ident" id="5916862">zigEnd</span>&nbsp;<span class="op" id="5916869">!=</span>&nbsp;<span class="num" id="5916872">0</span>&nbsp;<span class="op" id="5916874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5916879">panic</span><span class="op" id="5916884">(</span><span class="string" id="5916885">&#34;unreachable&#34;</span><span class="op" id="5916898">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916906">bit</span><span class="op" id="5916909">,</span>&nbsp;<span class="ident" id="5916911">err</span>&nbsp;<span class="op" id="5916915">:=</span>&nbsp;<span class="ident" id="5916918">d</span><span class="op" id="5916919">.</span><span class="ident" id="5916920">decodeBit</span><span class="op" id="5916929">(</span><span class="op" id="5916930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916934">if</span>&nbsp;<span class="ident" id="5916937">err</span>&nbsp;<span class="op" id="5916941">!=</span>&nbsp;<span class="ident" id="5916944">nil</span>&nbsp;<span class="op" id="5916948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916953">return</span>&nbsp;<span class="ident" id="5916960">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916966">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5916970">if</span>&nbsp;<span class="ident" id="5916973">bit</span>&nbsp;<span class="op" id="5916977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916982">b</span><span class="op" id="5916983">[</span><span class="num" id="5916984">0</span><span class="op" id="5916985">]</span>&nbsp;<span class="op" id="5916987">|=</span>&nbsp;<span class="ident" id="5916990">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5916998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917002">return</span>&nbsp;<span class="ident" id="5917009">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917014">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5917018">//&nbsp;Refining&nbsp;AC&nbsp;components&nbsp;is&nbsp;more&nbsp;complicated;&nbsp;see&nbsp;sections&nbsp;G.1.2.2&nbsp;and&nbsp;G.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917100">zig</span>&nbsp;<span class="op" id="5917104">:=</span>&nbsp;<span class="ident" id="5917107">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917117">if</span>&nbsp;<span class="ident" id="5917120">d</span><span class="op" id="5917121">.</span><span class="ident" id="5917122">eobRun</span>&nbsp;<span class="op" id="5917129">==</span>&nbsp;<span class="num" id="5917132">0</span>&nbsp;<span class="op" id="5917134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917137">loop</span><span class="op" id="5917141">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917145">for</span>&nbsp;<span class="op" id="5917149">;</span>&nbsp;<span class="ident" id="5917151">zig</span>&nbsp;<span class="op" id="5917155">&lt;=</span>&nbsp;<span class="ident" id="5917158">zigEnd</span><span class="op" id="5917164">;</span>&nbsp;<span class="ident" id="5917166">zig</span><span class="op" id="5917169">++</span>&nbsp;<span class="op" id="5917172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917177">z</span>&nbsp;<span class="op" id="5917179">:=</span>&nbsp;<span class="builtintype" id="5917182">int32</span><span class="op" id="5917187">(</span><span class="num" id="5917188">0</span><span class="op" id="5917189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917194">value</span><span class="op" id="5917199">,</span>&nbsp;<span class="ident" id="5917201">err</span>&nbsp;<span class="op" id="5917205">:=</span>&nbsp;<span class="ident" id="5917208">d</span><span class="op" id="5917209">.</span><span class="ident" id="5917210">decodeHuffman</span><span class="op" id="5917223">(</span><span class="ident" id="5917224">h</span><span class="op" id="5917225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917230">if</span>&nbsp;<span class="ident" id="5917233">err</span>&nbsp;<span class="op" id="5917237">!=</span>&nbsp;<span class="ident" id="5917240">nil</span>&nbsp;<span class="op" id="5917244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917250">return</span>&nbsp;<span class="ident" id="5917257">err</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917269">val0</span>&nbsp;<span class="op" id="5917274">:=</span>&nbsp;<span class="ident" id="5917277">value</span>&nbsp;<span class="op" id="5917283">&gt;&gt;</span>&nbsp;<span class="num" id="5917286">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917291">val1</span>&nbsp;<span class="op" id="5917296">:=</span>&nbsp;<span class="ident" id="5917299">value</span>&nbsp;<span class="op" id="5917305">&amp;</span>&nbsp;<span class="num" id="5917307">0x0f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917316">switch</span>&nbsp;<span class="ident" id="5917323">val1</span>&nbsp;<span class="op" id="5917328">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917333">case</span>&nbsp;<span class="num" id="5917338">0</span><span class="op" id="5917339">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917345">if</span>&nbsp;<span class="ident" id="5917348">val0</span>&nbsp;<span class="op" id="5917353">!=</span>&nbsp;<span class="num" id="5917356">0x0f</span>&nbsp;<span class="op" id="5917361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917368">d</span><span class="op" id="5917369">.</span><span class="ident" id="5917370">eobRun</span>&nbsp;<span class="op" id="5917377">=</span>&nbsp;<span class="builtintype" id="5917379">uint16</span><span class="op" id="5917385">(</span><span class="num" id="5917386">1</span>&nbsp;<span class="op" id="5917388">&lt;&lt;</span>&nbsp;<span class="ident" id="5917391">val0</span><span class="op" id="5917395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917402">if</span>&nbsp;<span class="ident" id="5917405">val0</span>&nbsp;<span class="op" id="5917410">!=</span>&nbsp;<span class="num" id="5917413">0</span>&nbsp;<span class="op" id="5917415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917423">bits</span><span class="op" id="5917427">,</span>&nbsp;<span class="ident" id="5917429">err</span>&nbsp;<span class="op" id="5917433">:=</span>&nbsp;<span class="ident" id="5917436">d</span><span class="op" id="5917437">.</span><span class="ident" id="5917438">decodeBits</span><span class="op" id="5917448">(</span><span class="builtintype" id="5917449">int32</span><span class="op" id="5917454">(</span><span class="ident" id="5917455">val0</span><span class="op" id="5917459">)</span><span class="op" id="5917460">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917468">if</span>&nbsp;<span class="ident" id="5917471">err</span>&nbsp;<span class="op" id="5917475">!=</span>&nbsp;<span class="ident" id="5917478">nil</span>&nbsp;<span class="op" id="5917482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917491">return</span>&nbsp;<span class="ident" id="5917498">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917516">d</span><span class="op" id="5917517">.</span><span class="ident" id="5917518">eobRun</span>&nbsp;<span class="op" id="5917525">|=</span>&nbsp;<span class="builtintype" id="5917528">uint16</span><span class="op" id="5917534">(</span><span class="ident" id="5917535">bits</span><span class="op" id="5917539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917546">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917553">break</span>&nbsp;<span class="ident" id="5917559">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917573">case</span>&nbsp;<span class="num" id="5917578">1</span><span class="op" id="5917579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917585">z</span>&nbsp;<span class="op" id="5917587">=</span>&nbsp;<span class="ident" id="5917589">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917599">bit</span><span class="op" id="5917602">,</span>&nbsp;<span class="ident" id="5917604">err</span>&nbsp;<span class="op" id="5917608">:=</span>&nbsp;<span class="ident" id="5917611">d</span><span class="op" id="5917612">.</span><span class="ident" id="5917613">decodeBit</span><span class="op" id="5917622">(</span><span class="op" id="5917623">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917629">if</span>&nbsp;<span class="ident" id="5917632">err</span>&nbsp;<span class="op" id="5917636">!=</span>&nbsp;<span class="ident" id="5917639">nil</span>&nbsp;<span class="op" id="5917643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917650">return</span>&nbsp;<span class="ident" id="5917657">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917671">if</span>&nbsp;<span class="op" id="5917674">!</span><span class="ident" id="5917675">bit</span>&nbsp;<span class="op" id="5917679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917686">z</span>&nbsp;<span class="op" id="5917688">=</span>&nbsp;<span class="op" id="5917690">-</span><span class="ident" id="5917691">z</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917702">default</span><span class="op" id="5917709">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917715">return</span>&nbsp;<span class="ident" id="5917722">FormatError</span><span class="op" id="5917733">(</span><span class="string" id="5917734">&#34;unexpected&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="5917759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917770">zig</span><span class="op" id="5917773">,</span>&nbsp;<span class="ident" id="5917775">err</span>&nbsp;<span class="op" id="5917779">=</span>&nbsp;<span class="ident" id="5917781">d</span><span class="op" id="5917782">.</span><span class="ident" id="5917783">refineNonZeroes</span><span class="op" id="5917798">(</span><span class="ident" id="5917799">b</span><span class="op" id="5917800">,</span>&nbsp;<span class="ident" id="5917802">zig</span><span class="op" id="5917805">,</span>&nbsp;<span class="ident" id="5917807">zigEnd</span><span class="op" id="5917813">,</span>&nbsp;<span class="builtintype" id="5917815">int32</span><span class="op" id="5917820">(</span><span class="ident" id="5917821">val0</span><span class="op" id="5917825">)</span><span class="op" id="5917826">,</span>&nbsp;<span class="ident" id="5917828">delta</span><span class="op" id="5917833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917838">if</span>&nbsp;<span class="ident" id="5917841">err</span>&nbsp;<span class="op" id="5917845">!=</span>&nbsp;<span class="ident" id="5917848">nil</span>&nbsp;<span class="op" id="5917852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917858">return</span>&nbsp;<span class="ident" id="5917865">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917877">if</span>&nbsp;<span class="ident" id="5917880">zig</span>&nbsp;<span class="op" id="5917884">&gt;</span>&nbsp;<span class="ident" id="5917886">zigEnd</span>&nbsp;<span class="op" id="5917893">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917899">return</span>&nbsp;<span class="ident" id="5917906">FormatError</span><span class="op" id="5917917">(</span><span class="string" id="5917918">&#34;too&nbsp;many&nbsp;coefficients&#34;</span><span class="op" id="5917941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917951">if</span>&nbsp;<span class="ident" id="5917954">z</span>&nbsp;<span class="op" id="5917956">!=</span>&nbsp;<span class="num" id="5917959">0</span>&nbsp;<span class="op" id="5917961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917967">b</span><span class="op" id="5917968">[</span><span class="ident" id="5917969">unzig</span><span class="op" id="5917974">[</span><span class="ident" id="5917975">zig</span><span class="op" id="5917978">]</span><span class="op" id="5917979">]</span>&nbsp;<span class="op" id="5917981">=</span>&nbsp;<span class="ident" id="5917983">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917988">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5917995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917998">if</span>&nbsp;<span class="ident" id="5918001">d</span><span class="op" id="5918002">.</span><span class="ident" id="5918003">eobRun</span>&nbsp;<span class="op" id="5918010">&gt;</span>&nbsp;<span class="num" id="5918012">0</span>&nbsp;<span class="op" id="5918014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918018">d</span><span class="op" id="5918019">.</span><span class="ident" id="5918020">eobRun</span><span class="op" id="5918026">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918031">if</span>&nbsp;<span class="ident" id="5918034">_</span><span class="op" id="5918035">,</span>&nbsp;<span class="ident" id="5918037">err</span>&nbsp;<span class="op" id="5918041">:=</span>&nbsp;<span class="ident" id="5918044">d</span><span class="op" id="5918045">.</span><span class="ident" id="5918046">refineNonZeroes</span><span class="op" id="5918061">(</span><span class="ident" id="5918062">b</span><span class="op" id="5918063">,</span>&nbsp;<span class="ident" id="5918065">zig</span><span class="op" id="5918068">,</span>&nbsp;<span class="ident" id="5918070">zigEnd</span><span class="op" id="5918076">,</span>&nbsp;<span class="op" id="5918078">-</span><span class="num" id="5918079">1</span><span class="op" id="5918080">,</span>&nbsp;<span class="ident" id="5918082">delta</span><span class="op" id="5918087">)</span><span class="op" id="5918088">;</span>&nbsp;<span class="ident" id="5918090">err</span>&nbsp;<span class="op" id="5918094">!=</span>&nbsp;<span class="ident" id="5918097">nil</span>&nbsp;<span class="op" id="5918101">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918106">return</span>&nbsp;<span class="ident" id="5918113">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918125">return</span>&nbsp;<span class="ident" id="5918132">nil</span><br>
<span class="lineno"></span><span class="op" id="5918136">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="5918139">//&nbsp;refineNonZeroes&nbsp;refines&nbsp;non-zero&nbsp;entries&nbsp;of&nbsp;b&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;If&nbsp;nz&nbsp;&gt;=&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="5918218">//&nbsp;the&nbsp;first&nbsp;nz&nbsp;zero&nbsp;entries&nbsp;are&nbsp;skipped&nbsp;over.</span><br>
<span class="lineno"></span><span class="keyword" id="5918265">func</span>&nbsp;<span class="op" id="5918270">(</span><span class="ident" id="5918271">d</span>&nbsp;<span class="op" id="5918273">*</span><span class="ident" id="5918274">decoder</span><span class="op" id="5918281">)</span>&nbsp;<span class="ident" id="5918283">refineNonZeroes</span><span class="op" id="5918298">(</span><span class="ident" id="5918299">b</span>&nbsp;<span class="op" id="5918301">*</span><span class="ident" id="5918302">block</span><span class="op" id="5918307">,</span>&nbsp;<span class="ident" id="5918309">zig</span><span class="op" id="5918312">,</span>&nbsp;<span class="ident" id="5918314">zigEnd</span><span class="op" id="5918320">,</span>&nbsp;<span class="ident" id="5918322">nz</span><span class="op" id="5918324">,</span>&nbsp;<span class="ident" id="5918326">delta</span>&nbsp;<span class="builtintype" id="5918332">int32</span><span class="op" id="5918337">)</span>&nbsp;<span class="op" id="5918339">(</span><span class="builtintype" id="5918340">int32</span><span class="op" id="5918345">,</span>&nbsp;<span class="builtintype" id="5918347">error</span><span class="op" id="5918352">)</span>&nbsp;<span class="op" id="5918354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918357">for</span>&nbsp;<span class="op" id="5918361">;</span>&nbsp;<span class="ident" id="5918363">zig</span>&nbsp;<span class="op" id="5918367">&lt;=</span>&nbsp;<span class="ident" id="5918370">zigEnd</span><span class="op" id="5918376">;</span>&nbsp;<span class="ident" id="5918378">zig</span><span class="op" id="5918381">++</span>&nbsp;<span class="op" id="5918384">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918388">u</span>&nbsp;<span class="op" id="5918390">:=</span>&nbsp;<span class="ident" id="5918393">unzig</span><span class="op" id="5918398">[</span><span class="ident" id="5918399">zig</span><span class="op" id="5918402">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918406">if</span>&nbsp;<span class="ident" id="5918409">b</span><span class="op" id="5918410">[</span><span class="ident" id="5918411">u</span><span class="op" id="5918412">]</span>&nbsp;<span class="op" id="5918414">==</span>&nbsp;<span class="num" id="5918417">0</span>&nbsp;<span class="op" id="5918419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918424">if</span>&nbsp;<span class="ident" id="5918427">nz</span>&nbsp;<span class="op" id="5918430">==</span>&nbsp;<span class="num" id="5918433">0</span>&nbsp;<span class="op" id="5918435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918441">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918450">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918455">nz</span><span class="op" id="5918457">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918463">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918478">bit</span><span class="op" id="5918481">,</span>&nbsp;<span class="ident" id="5918483">err</span>&nbsp;<span class="op" id="5918487">:=</span>&nbsp;<span class="ident" id="5918490">d</span><span class="op" id="5918491">.</span><span class="ident" id="5918492">decodeBit</span><span class="op" id="5918501">(</span><span class="op" id="5918502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918506">if</span>&nbsp;<span class="ident" id="5918509">err</span>&nbsp;<span class="op" id="5918513">!=</span>&nbsp;<span class="ident" id="5918516">nil</span>&nbsp;<span class="op" id="5918520">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918525">return</span>&nbsp;<span class="num" id="5918532">0</span><span class="op" id="5918533">,</span>&nbsp;<span class="ident" id="5918535">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918545">if</span>&nbsp;<span class="op" id="5918548">!</span><span class="ident" id="5918549">bit</span>&nbsp;<span class="op" id="5918553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918558">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918569">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918573">if</span>&nbsp;<span class="ident" id="5918576">b</span><span class="op" id="5918577">[</span><span class="ident" id="5918578">u</span><span class="op" id="5918579">]</span>&nbsp;<span class="op" id="5918581">&gt;=</span>&nbsp;<span class="num" id="5918584">0</span>&nbsp;<span class="op" id="5918586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918591">b</span><span class="op" id="5918592">[</span><span class="ident" id="5918593">u</span><span class="op" id="5918594">]</span>&nbsp;<span class="op" id="5918596">+=</span>&nbsp;<span class="ident" id="5918599">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918607">}</span>&nbsp;<span class="keyword" id="5918609">else</span>&nbsp;<span class="op" id="5918614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918619">b</span><span class="op" id="5918620">[</span><span class="ident" id="5918621">u</span><span class="op" id="5918622">]</span>&nbsp;<span class="op" id="5918624">-=</span>&nbsp;<span class="ident" id="5918627">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918635">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918641">return</span>&nbsp;<span class="ident" id="5918648">zig</span><span class="op" id="5918651">,</span>&nbsp;<span class="ident" id="5918653">nil</span><br>
<span class="lineno"></span><span class="op" id="5918657">}</span>
</div>
</body>
</html>
