<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4236831">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4236886">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4236940">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4236991">//&nbsp;Package&nbsp;gzip&nbsp;implements&nbsp;reading&nbsp;and&nbsp;writing&nbsp;of&nbsp;gzip&nbsp;format&nbsp;compressed&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4237071">//&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;1952.</span><br>
<span class="lineno"></span><span class="keyword" id="4237100">package</span>&nbsp;<span class="ident" id="4237108">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4237114">import</span>&nbsp;<span class="op" id="4237121">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4237124">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4237133">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4237151">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4237161">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4237169">&#34;hash/crc32&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4237183">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4237189">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4237196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4237199">const</span>&nbsp;<span class="op" id="4237205">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237208">gzipID1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237220">=</span>&nbsp;<span class="num" id="4237222">0x1f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237228">gzipID2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237240">=</span>&nbsp;<span class="num" id="4237242">0x8b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237248">gzipDeflate</span>&nbsp;<span class="op" id="4237260">=</span>&nbsp;<span class="num" id="4237262">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237265">flagText</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237277">=</span>&nbsp;<span class="num" id="4237279">1</span>&nbsp;<span class="op" id="4237281">&lt;&lt;</span>&nbsp;<span class="num" id="4237284">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237287">flagHdrCrc</span>&nbsp;&nbsp;<span class="op" id="4237299">=</span>&nbsp;<span class="num" id="4237301">1</span>&nbsp;<span class="op" id="4237303">&lt;&lt;</span>&nbsp;<span class="num" id="4237306">1</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237309">flagExtra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4237321">=</span>&nbsp;<span class="num" id="4237323">1</span>&nbsp;<span class="op" id="4237325">&lt;&lt;</span>&nbsp;<span class="num" id="4237328">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237331">flagName</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237343">=</span>&nbsp;<span class="num" id="4237345">1</span>&nbsp;<span class="op" id="4237347">&lt;&lt;</span>&nbsp;<span class="num" id="4237350">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237353">flagComment</span>&nbsp;<span class="op" id="4237365">=</span>&nbsp;<span class="num" id="4237367">1</span>&nbsp;<span class="op" id="4237369">&lt;&lt;</span>&nbsp;<span class="num" id="4237372">4</span><br>
<span class="lineno"></span><span class="op" id="4237374">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4237377">func</span>&nbsp;<span class="ident" id="4237382">makeReader</span><span class="op" id="4237392">(</span><span class="ident" id="4237393">r</span>&nbsp;<span class="ident" id="4237395">io</span><span class="op" id="4237397">.</span><span class="ident" id="4237398">Reader</span><span class="op" id="4237404">)</span>&nbsp;<span class="ident" id="4237406">flate</span><span class="op" id="4237411">.</span><span class="ident" id="4237412">Reader</span>&nbsp;<span class="op" id="4237419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237422">if</span>&nbsp;<span class="ident" id="4237425">rr</span><span class="op" id="4237427">,</span>&nbsp;<span class="ident" id="4237429">ok</span>&nbsp;<span class="op" id="4237432">:=</span>&nbsp;<span class="ident" id="4237435">r</span><span class="op" id="4237436">.</span><span class="op" id="4237437">(</span><span class="ident" id="4237438">flate</span><span class="op" id="4237443">.</span><span class="ident" id="4237444">Reader</span><span class="op" id="4237450">)</span><span class="op" id="4237451">;</span>&nbsp;<span class="ident" id="4237453">ok</span>&nbsp;<span class="op" id="4237456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237460">return</span>&nbsp;<span class="ident" id="4237467">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4237471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4237474">return</span>&nbsp;<span class="ident" id="4237481">bufio</span><span class="op" id="4237486">.</span><span class="ident" id="4237487">NewReader</span><span class="op" id="4237496">(</span><span class="ident" id="4237497">r</span><span class="op" id="4237498">)</span><br>
<span class="lineno">35</span><span class="op" id="4237500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4237503">var</span>&nbsp;<span class="op" id="4237507">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4237510">//&nbsp;ErrChecksum&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237591">ErrChecksum</span>&nbsp;<span class="op" id="4237603">=</span>&nbsp;<span class="ident" id="4237605">errors</span><span class="op" id="4237611">.</span><span class="ident" id="4237612">New</span><span class="op" id="4237615">(</span><span class="string" id="4237616">&#34;gzip:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="4237640">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4237643">//&nbsp;ErrHeader&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237720">ErrHeader</span>&nbsp;<span class="op" id="4237730">=</span>&nbsp;<span class="ident" id="4237732">errors</span><span class="op" id="4237738">.</span><span class="ident" id="4237739">New</span><span class="op" id="4237742">(</span><span class="string" id="4237743">&#34;gzip:&nbsp;invalid&nbsp;header&#34;</span><span class="op" id="4237765">)</span><br>
<span class="lineno"></span><span class="op" id="4237767">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4237770">//&nbsp;The&nbsp;gzip&nbsp;file&nbsp;stores&nbsp;a&nbsp;header&nbsp;giving&nbsp;metadata&nbsp;about&nbsp;the&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno">45</span><span class="comment" id="4237846">//&nbsp;That&nbsp;header&nbsp;is&nbsp;exposed&nbsp;as&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;Writer&nbsp;and&nbsp;Reader&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="4237920">type</span>&nbsp;<span class="ident" id="4237925">Header</span>&nbsp;<span class="keyword" id="4237932">struct</span>&nbsp;<span class="op" id="4237939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237942">Comment</span>&nbsp;<span class="builtintype" id="4237950">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4237960">//&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4237972">Extra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4237980">[</span><span class="op" id="4237981">]</span><span class="builtintype" id="4237982">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4237990">//&nbsp;&#34;extra&nbsp;data&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238007">ModTime</span>&nbsp;<span class="ident" id="4238015">time</span><span class="op" id="4238019">.</span><span class="ident" id="4238020">Time</span>&nbsp;<span class="comment" id="4238025">//&nbsp;modification&nbsp;time</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238047">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4238055">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4238065">//&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238079">OS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4238087">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4238097">//&nbsp;operating&nbsp;system&nbsp;type</span><br>
<span class="lineno"></span><span class="op" id="4238122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4238125">//&nbsp;A&nbsp;Reader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;to&nbsp;retrieve</span><br>
<span class="lineno">55</span><span class="comment" id="4238182">//&nbsp;uncompressed&nbsp;data&nbsp;from&nbsp;a&nbsp;gzip-format&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4238239">//</span><br>
<span class="lineno"></span><span class="comment" id="4238242">//&nbsp;In&nbsp;general,&nbsp;a&nbsp;gzip&nbsp;file&nbsp;can&nbsp;be&nbsp;a&nbsp;concatenation&nbsp;of&nbsp;gzip&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4238307">//&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header.&nbsp;&nbsp;Reads&nbsp;from&nbsp;the&nbsp;Reader</span><br>
<span class="lineno"></span><span class="comment" id="4238359">//&nbsp;return&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;of&nbsp;each.</span><br>
<span class="lineno">60</span><span class="comment" id="4238421">//&nbsp;Only&nbsp;the&nbsp;first&nbsp;header&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the&nbsp;Reader&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="4238480">//</span><br>
<span class="lineno"></span><span class="comment" id="4238483">//&nbsp;Gzip&nbsp;files&nbsp;store&nbsp;a&nbsp;length&nbsp;and&nbsp;checksum&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4238551">//&nbsp;The&nbsp;Reader&nbsp;will&nbsp;return&nbsp;a&nbsp;ErrChecksum&nbsp;when&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="4238601">//&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;if&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno">65</span><span class="comment" id="4238660">//&nbsp;have&nbsp;the&nbsp;expected&nbsp;length&nbsp;or&nbsp;checksum.&nbsp;&nbsp;Clients&nbsp;should&nbsp;treat&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4238728">//&nbsp;returned&nbsp;by&nbsp;Read&nbsp;as&nbsp;tentative&nbsp;until&nbsp;they&nbsp;receive&nbsp;the&nbsp;io.EOF</span><br>
<span class="lineno"></span><span class="comment" id="4238791">//&nbsp;marking&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4238823">type</span>&nbsp;<span class="ident" id="4238828">Reader</span>&nbsp;<span class="keyword" id="4238835">struct</span>&nbsp;<span class="op" id="4238842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238845">Header</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238853">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238866">flate</span><span class="op" id="4238871">.</span><span class="ident" id="4238872">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238880">decompressor</span>&nbsp;<span class="ident" id="4238893">io</span><span class="op" id="4238895">.</span><span class="ident" id="4238896">ReadCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238908">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238921">hash</span><span class="op" id="4238925">.</span><span class="ident" id="4238926">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238934">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4238947">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238955">flg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4238968">byte</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238974">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4238987">[</span><span class="num" id="4238988">512</span><span class="op" id="4238991">]</span><span class="builtintype" id="4238992">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4238998">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4239011">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239018">multistream</span>&nbsp;&nbsp;<span class="builtintype" id="4239031">bool</span><br>
<span class="lineno"></span><span class="op" id="4239036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4239039">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno"></span><span class="comment" id="4239099">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4239146">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4239208">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;Reader&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="4239284">func</span>&nbsp;<span class="ident" id="4239289">NewReader</span><span class="op" id="4239298">(</span><span class="ident" id="4239299">r</span>&nbsp;<span class="ident" id="4239301">io</span><span class="op" id="4239303">.</span><span class="ident" id="4239304">Reader</span><span class="op" id="4239310">)</span>&nbsp;<span class="op" id="4239312">(</span><span class="op" id="4239313">*</span><span class="ident" id="4239314">Reader</span><span class="op" id="4239320">,</span>&nbsp;<span class="builtintype" id="4239322">error</span><span class="op" id="4239327">)</span>&nbsp;<span class="op" id="4239329">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239332">z</span>&nbsp;<span class="op" id="4239334">:=</span>&nbsp;<span class="builtinfunc" id="4239337">new</span><span class="op" id="4239340">(</span><span class="ident" id="4239341">Reader</span><span class="op" id="4239347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239350">z</span><span class="op" id="4239351">.</span><span class="ident" id="4239352">r</span>&nbsp;<span class="op" id="4239354">=</span>&nbsp;<span class="ident" id="4239356">makeReader</span><span class="op" id="4239366">(</span><span class="ident" id="4239367">r</span><span class="op" id="4239368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239371">z</span><span class="op" id="4239372">.</span><span class="ident" id="4239373">multistream</span>&nbsp;<span class="op" id="4239385">=</span>&nbsp;<span class="builtintype" id="4239387">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239393">z</span><span class="op" id="4239394">.</span><span class="ident" id="4239395">digest</span>&nbsp;<span class="op" id="4239402">=</span>&nbsp;<span class="ident" id="4239404">crc32</span><span class="op" id="4239409">.</span><span class="ident" id="4239410">NewIEEE</span><span class="op" id="4239417">(</span><span class="op" id="4239418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4239421">if</span>&nbsp;<span class="ident" id="4239424">err</span>&nbsp;<span class="op" id="4239428">:=</span>&nbsp;<span class="ident" id="4239431">z</span><span class="op" id="4239432">.</span><span class="ident" id="4239433">readHeader</span><span class="op" id="4239443">(</span><span class="builtintype" id="4239444">true</span><span class="op" id="4239448">)</span><span class="op" id="4239449">;</span>&nbsp;<span class="ident" id="4239451">err</span>&nbsp;<span class="op" id="4239455">!=</span>&nbsp;<span class="ident" id="4239458">nil</span>&nbsp;<span class="op" id="4239462">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4239466">return</span>&nbsp;<span class="ident" id="4239473">nil</span><span class="op" id="4239476">,</span>&nbsp;<span class="ident" id="4239478">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4239483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4239486">return</span>&nbsp;<span class="ident" id="4239493">z</span><span class="op" id="4239494">,</span>&nbsp;<span class="ident" id="4239496">nil</span><br>
<span class="lineno"></span><span class="op" id="4239500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4239503">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Reader&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4239573">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewReader,&nbsp;but&nbsp;reading&nbsp;from&nbsp;r&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="4239649">//&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Reader&nbsp;rather&nbsp;than&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4239716">func</span>&nbsp;<span class="op" id="4239721">(</span><span class="ident" id="4239722">z</span>&nbsp;<span class="op" id="4239724">*</span><span class="ident" id="4239725">Reader</span><span class="op" id="4239731">)</span>&nbsp;<span class="ident" id="4239733">Reset</span><span class="op" id="4239738">(</span><span class="ident" id="4239739">r</span>&nbsp;<span class="ident" id="4239741">io</span><span class="op" id="4239743">.</span><span class="ident" id="4239744">Reader</span><span class="op" id="4239750">)</span>&nbsp;<span class="builtintype" id="4239752">error</span>&nbsp;<span class="op" id="4239758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239761">z</span><span class="op" id="4239762">.</span><span class="ident" id="4239763">r</span>&nbsp;<span class="op" id="4239765">=</span>&nbsp;<span class="ident" id="4239767">makeReader</span><span class="op" id="4239777">(</span><span class="ident" id="4239778">r</span><span class="op" id="4239779">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4239782">if</span>&nbsp;<span class="ident" id="4239785">z</span><span class="op" id="4239786">.</span><span class="ident" id="4239787">digest</span>&nbsp;<span class="op" id="4239794">==</span>&nbsp;<span class="ident" id="4239797">nil</span>&nbsp;<span class="op" id="4239801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239805">z</span><span class="op" id="4239806">.</span><span class="ident" id="4239807">digest</span>&nbsp;<span class="op" id="4239814">=</span>&nbsp;<span class="ident" id="4239816">crc32</span><span class="op" id="4239821">.</span><span class="ident" id="4239822">NewIEEE</span><span class="op" id="4239829">(</span><span class="op" id="4239830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4239833">}</span>&nbsp;<span class="keyword" id="4239835">else</span>&nbsp;<span class="op" id="4239840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239844">z</span><span class="op" id="4239845">.</span><span class="ident" id="4239846">digest</span><span class="op" id="4239852">.</span><span class="ident" id="4239853">Reset</span><span class="op" id="4239858">(</span><span class="op" id="4239859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4239862">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239865">z</span><span class="op" id="4239866">.</span><span class="ident" id="4239867">size</span>&nbsp;<span class="op" id="4239872">=</span>&nbsp;<span class="num" id="4239874">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239877">z</span><span class="op" id="4239878">.</span><span class="ident" id="4239879">err</span>&nbsp;<span class="op" id="4239883">=</span>&nbsp;<span class="ident" id="4239885">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4239890">z</span><span class="op" id="4239891">.</span><span class="ident" id="4239892">multistream</span>&nbsp;<span class="op" id="4239904">=</span>&nbsp;<span class="builtintype" id="4239906">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4239912">return</span>&nbsp;<span class="ident" id="4239919">z</span><span class="op" id="4239920">.</span><span class="ident" id="4239921">readHeader</span><span class="op" id="4239931">(</span><span class="builtintype" id="4239932">true</span><span class="op" id="4239936">)</span><br>
<span class="lineno"></span><span class="op" id="4239938">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4239941">//&nbsp;Multistream&nbsp;controls&nbsp;whether&nbsp;the&nbsp;reader&nbsp;supports&nbsp;multistream&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4240012">//</span><br>
<span class="lineno"></span><span class="comment" id="4240015">//&nbsp;If&nbsp;enabled&nbsp;(the&nbsp;default),&nbsp;the&nbsp;Reader&nbsp;expects&nbsp;the&nbsp;input&nbsp;to&nbsp;be&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4240090">//&nbsp;of&nbsp;individually&nbsp;gzipped&nbsp;data&nbsp;streams,&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="4240160">//&nbsp;trailer,&nbsp;ending&nbsp;at&nbsp;EOF.&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4240238">//&nbsp;of&nbsp;gzipped&nbsp;files&nbsp;is&nbsp;treated&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;gzip&nbsp;of&nbsp;the&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="4240316">//&nbsp;of&nbsp;the&nbsp;sequence.&nbsp;This&nbsp;is&nbsp;standard&nbsp;behavior&nbsp;for&nbsp;gzip&nbsp;readers.</span><br>
<span class="lineno"></span><span class="comment" id="4240380">//</span><br>
<span class="lineno"></span><span class="comment" id="4240383">//&nbsp;Calling&nbsp;Multistream(false)&nbsp;disables&nbsp;this&nbsp;behavior;&nbsp;disabling&nbsp;the&nbsp;behavior</span><br>
<span class="lineno">120</span><span class="comment" id="4240460">//&nbsp;can&nbsp;be&nbsp;useful&nbsp;when&nbsp;reading&nbsp;file&nbsp;formats&nbsp;that&nbsp;distinguish&nbsp;individual&nbsp;gzip</span><br>
<span class="lineno"></span><span class="comment" id="4240536">//&nbsp;data&nbsp;streams&nbsp;or&nbsp;mix&nbsp;gzip&nbsp;data&nbsp;streams&nbsp;with&nbsp;other&nbsp;data&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="4240602">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;when&nbsp;the&nbsp;Reader&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="4240671">//&nbsp;Read&nbsp;returns&nbsp;io.EOF.&nbsp;If&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;implements&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4240746">//&nbsp;it&nbsp;will&nbsp;be&nbsp;left&nbsp;positioned&nbsp;just&nbsp;after&nbsp;the&nbsp;gzip&nbsp;stream.</span><br>
<span class="lineno">125</span><span class="comment" id="4240804">//&nbsp;To&nbsp;start&nbsp;the&nbsp;next&nbsp;stream,&nbsp;call&nbsp;z.Reset(r)&nbsp;followed&nbsp;by&nbsp;z.Multistream(false).</span><br>
<span class="lineno"></span><span class="comment" id="4240883">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;next&nbsp;stream,&nbsp;z.Reset(r)&nbsp;will&nbsp;return&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="4240945">func</span>&nbsp;<span class="op" id="4240950">(</span><span class="ident" id="4240951">z</span>&nbsp;<span class="op" id="4240953">*</span><span class="ident" id="4240954">Reader</span><span class="op" id="4240960">)</span>&nbsp;<span class="ident" id="4240962">Multistream</span><span class="op" id="4240973">(</span><span class="ident" id="4240974">ok</span>&nbsp;<span class="builtintype" id="4240977">bool</span><span class="op" id="4240981">)</span>&nbsp;<span class="op" id="4240983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4240986">z</span><span class="op" id="4240987">.</span><span class="ident" id="4240988">multistream</span>&nbsp;<span class="op" id="4241000">=</span>&nbsp;<span class="ident" id="4241002">ok</span><br>
<span class="lineno"></span><span class="op" id="4241005">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4241008">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4241069">func</span>&nbsp;<span class="ident" id="4241074">get4</span><span class="op" id="4241078">(</span><span class="ident" id="4241079">p</span>&nbsp;<span class="op" id="4241081">[</span><span class="op" id="4241082">]</span><span class="builtintype" id="4241083">byte</span><span class="op" id="4241087">)</span>&nbsp;<span class="builtintype" id="4241089">uint32</span>&nbsp;<span class="op" id="4241096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241099">return</span>&nbsp;<span class="builtintype" id="4241106">uint32</span><span class="op" id="4241112">(</span><span class="ident" id="4241113">p</span><span class="op" id="4241114">[</span><span class="num" id="4241115">0</span><span class="op" id="4241116">]</span><span class="op" id="4241117">)</span>&nbsp;<span class="op" id="4241119">|</span>&nbsp;<span class="builtintype" id="4241121">uint32</span><span class="op" id="4241127">(</span><span class="ident" id="4241128">p</span><span class="op" id="4241129">[</span><span class="num" id="4241130">1</span><span class="op" id="4241131">]</span><span class="op" id="4241132">)</span><span class="op" id="4241133">&lt;&lt;</span><span class="num" id="4241135">8</span>&nbsp;<span class="op" id="4241137">|</span>&nbsp;<span class="builtintype" id="4241139">uint32</span><span class="op" id="4241145">(</span><span class="ident" id="4241146">p</span><span class="op" id="4241147">[</span><span class="num" id="4241148">2</span><span class="op" id="4241149">]</span><span class="op" id="4241150">)</span><span class="op" id="4241151">&lt;&lt;</span><span class="num" id="4241153">16</span>&nbsp;<span class="op" id="4241156">|</span>&nbsp;<span class="builtintype" id="4241158">uint32</span><span class="op" id="4241164">(</span><span class="ident" id="4241165">p</span><span class="op" id="4241166">[</span><span class="num" id="4241167">3</span><span class="op" id="4241168">]</span><span class="op" id="4241169">)</span><span class="op" id="4241170">&lt;&lt;</span><span class="num" id="4241172">24</span><br>
<span class="lineno"></span><span class="op" id="4241175">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="4241178">func</span>&nbsp;<span class="op" id="4241183">(</span><span class="ident" id="4241184">z</span>&nbsp;<span class="op" id="4241186">*</span><span class="ident" id="4241187">Reader</span><span class="op" id="4241193">)</span>&nbsp;<span class="ident" id="4241195">readString</span><span class="op" id="4241205">(</span><span class="op" id="4241206">)</span>&nbsp;<span class="op" id="4241208">(</span><span class="builtintype" id="4241209">string</span><span class="op" id="4241215">,</span>&nbsp;<span class="builtintype" id="4241217">error</span><span class="op" id="4241222">)</span>&nbsp;<span class="op" id="4241224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241227">var</span>&nbsp;<span class="ident" id="4241231">err</span>&nbsp;<span class="builtintype" id="4241235">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4241242">needconv</span>&nbsp;<span class="op" id="4241251">:=</span>&nbsp;<span class="builtintype" id="4241254">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241261">for</span>&nbsp;<span class="ident" id="4241265">i</span>&nbsp;<span class="op" id="4241267">:=</span>&nbsp;<span class="num" id="4241270">0</span><span class="op" id="4241271">;</span>&nbsp;<span class="op" id="4241273">;</span>&nbsp;<span class="ident" id="4241275">i</span><span class="op" id="4241276">++</span>&nbsp;<span class="op" id="4241279">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241283">if</span>&nbsp;<span class="ident" id="4241286">i</span>&nbsp;<span class="op" id="4241288">&gt;=</span>&nbsp;<span class="builtinfunc" id="4241291">len</span><span class="op" id="4241294">(</span><span class="ident" id="4241295">z</span><span class="op" id="4241296">.</span><span class="ident" id="4241297">buf</span><span class="op" id="4241300">)</span>&nbsp;<span class="op" id="4241302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241307">return</span>&nbsp;<span class="string" id="4241314">&#34;&#34;</span><span class="op" id="4241316">,</span>&nbsp;<span class="ident" id="4241318">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4241330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4241334">z</span><span class="op" id="4241335">.</span><span class="ident" id="4241336">buf</span><span class="op" id="4241339">[</span><span class="ident" id="4241340">i</span><span class="op" id="4241341">]</span><span class="op" id="4241342">,</span>&nbsp;<span class="ident" id="4241344">err</span>&nbsp;<span class="op" id="4241348">=</span>&nbsp;<span class="ident" id="4241350">z</span><span class="op" id="4241351">.</span><span class="ident" id="4241352">r</span><span class="op" id="4241353">.</span><span class="ident" id="4241354">ReadByte</span><span class="op" id="4241362">(</span><span class="op" id="4241363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241367">if</span>&nbsp;<span class="ident" id="4241370">err</span>&nbsp;<span class="op" id="4241374">!=</span>&nbsp;<span class="ident" id="4241377">nil</span>&nbsp;<span class="op" id="4241381">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241386">return</span>&nbsp;<span class="string" id="4241393">&#34;&#34;</span><span class="op" id="4241395">,</span>&nbsp;<span class="ident" id="4241397">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4241403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241407">if</span>&nbsp;<span class="ident" id="4241410">z</span><span class="op" id="4241411">.</span><span class="ident" id="4241412">buf</span><span class="op" id="4241415">[</span><span class="ident" id="4241416">i</span><span class="op" id="4241417">]</span>&nbsp;<span class="op" id="4241419">&gt;</span>&nbsp;<span class="num" id="4241421">0x7f</span>&nbsp;<span class="op" id="4241426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4241431">needconv</span>&nbsp;<span class="op" id="4241440">=</span>&nbsp;<span class="builtintype" id="4241442">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4241449">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241453">if</span>&nbsp;<span class="ident" id="4241456">z</span><span class="op" id="4241457">.</span><span class="ident" id="4241458">buf</span><span class="op" id="4241461">[</span><span class="ident" id="4241462">i</span><span class="op" id="4241463">]</span>&nbsp;<span class="op" id="4241465">==</span>&nbsp;<span class="num" id="4241468">0</span>&nbsp;<span class="op" id="4241470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4241475">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241561">if</span>&nbsp;<span class="ident" id="4241564">needconv</span>&nbsp;<span class="op" id="4241573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4241579">s</span>&nbsp;<span class="op" id="4241581">:=</span>&nbsp;<span class="builtinfunc" id="4241584">make</span><span class="op" id="4241588">(</span><span class="op" id="4241589">[</span><span class="op" id="4241590">]</span><span class="builtintype" id="4241591">rune</span><span class="op" id="4241595">,</span>&nbsp;<span class="num" id="4241597">0</span><span class="op" id="4241598">,</span>&nbsp;<span class="ident" id="4241600">i</span><span class="op" id="4241601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241607">for</span>&nbsp;<span class="ident" id="4241611">_</span><span class="op" id="4241612">,</span>&nbsp;<span class="ident" id="4241614">v</span>&nbsp;<span class="op" id="4241616">:=</span>&nbsp;<span class="keyword" id="4241619">range</span>&nbsp;<span class="ident" id="4241625">z</span><span class="op" id="4241626">.</span><span class="ident" id="4241627">buf</span><span class="op" id="4241630">[</span><span class="num" id="4241631">0</span><span class="op" id="4241632">:</span><span class="ident" id="4241633">i</span><span class="op" id="4241634">]</span>&nbsp;<span class="op" id="4241636">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4241643">s</span>&nbsp;<span class="op" id="4241645">=</span>&nbsp;<span class="builtinfunc" id="4241647">append</span><span class="op" id="4241653">(</span><span class="ident" id="4241654">s</span><span class="op" id="4241655">,</span>&nbsp;<span class="builtintype" id="4241657">rune</span><span class="op" id="4241661">(</span><span class="ident" id="4241662">v</span><span class="op" id="4241663">)</span><span class="op" id="4241664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4241670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241676">return</span>&nbsp;<span class="builtintype" id="4241683">string</span><span class="op" id="4241689">(</span><span class="ident" id="4241690">s</span><span class="op" id="4241691">)</span><span class="op" id="4241692">,</span>&nbsp;<span class="ident" id="4241694">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4241701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241706">return</span>&nbsp;<span class="builtintype" id="4241713">string</span><span class="op" id="4241719">(</span><span class="ident" id="4241720">z</span><span class="op" id="4241721">.</span><span class="ident" id="4241722">buf</span><span class="op" id="4241725">[</span><span class="num" id="4241726">0</span><span class="op" id="4241727">:</span><span class="ident" id="4241728">i</span><span class="op" id="4241729">]</span><span class="op" id="4241730">)</span><span class="op" id="4241731">,</span>&nbsp;<span class="ident" id="4241733">nil</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4241739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4241742">}</span><br>
<span class="lineno"></span><span class="op" id="4241744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4241747">func</span>&nbsp;<span class="op" id="4241752">(</span><span class="ident" id="4241753">z</span>&nbsp;<span class="op" id="4241755">*</span><span class="ident" id="4241756">Reader</span><span class="op" id="4241762">)</span>&nbsp;<span class="ident" id="4241764">read2</span><span class="op" id="4241769">(</span><span class="op" id="4241770">)</span>&nbsp;<span class="op" id="4241772">(</span><span class="builtintype" id="4241773">uint32</span><span class="op" id="4241779">,</span>&nbsp;<span class="builtintype" id="4241781">error</span><span class="op" id="4241786">)</span>&nbsp;<span class="op" id="4241788">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4241791">_</span><span class="op" id="4241792">,</span>&nbsp;<span class="ident" id="4241794">err</span>&nbsp;<span class="op" id="4241798">:=</span>&nbsp;<span class="ident" id="4241801">io</span><span class="op" id="4241803">.</span><span class="ident" id="4241804">ReadFull</span><span class="op" id="4241812">(</span><span class="ident" id="4241813">z</span><span class="op" id="4241814">.</span><span class="ident" id="4241815">r</span><span class="op" id="4241816">,</span>&nbsp;<span class="ident" id="4241818">z</span><span class="op" id="4241819">.</span><span class="ident" id="4241820">buf</span><span class="op" id="4241823">[</span><span class="num" id="4241824">0</span><span class="op" id="4241825">:</span><span class="num" id="4241826">2</span><span class="op" id="4241827">]</span><span class="op" id="4241828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241831">if</span>&nbsp;<span class="ident" id="4241834">err</span>&nbsp;<span class="op" id="4241838">!=</span>&nbsp;<span class="ident" id="4241841">nil</span>&nbsp;<span class="op" id="4241845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241849">return</span>&nbsp;<span class="num" id="4241856">0</span><span class="op" id="4241857">,</span>&nbsp;<span class="ident" id="4241859">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4241864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4241867">return</span>&nbsp;<span class="builtintype" id="4241874">uint32</span><span class="op" id="4241880">(</span><span class="ident" id="4241881">z</span><span class="op" id="4241882">.</span><span class="ident" id="4241883">buf</span><span class="op" id="4241886">[</span><span class="num" id="4241887">0</span><span class="op" id="4241888">]</span><span class="op" id="4241889">)</span>&nbsp;<span class="op" id="4241891">|</span>&nbsp;<span class="builtintype" id="4241893">uint32</span><span class="op" id="4241899">(</span><span class="ident" id="4241900">z</span><span class="op" id="4241901">.</span><span class="ident" id="4241902">buf</span><span class="op" id="4241905">[</span><span class="num" id="4241906">1</span><span class="op" id="4241907">]</span><span class="op" id="4241908">)</span><span class="op" id="4241909">&lt;&lt;</span><span class="num" id="4241911">8</span><span class="op" id="4241912">,</span>&nbsp;<span class="ident" id="4241914">nil</span><br>
<span class="lineno">170</span><span class="op" id="4241918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4241921">func</span>&nbsp;<span class="op" id="4241926">(</span><span class="ident" id="4241927">z</span>&nbsp;<span class="op" id="4241929">*</span><span class="ident" id="4241930">Reader</span><span class="op" id="4241936">)</span>&nbsp;<span class="ident" id="4241938">readHeader</span><span class="op" id="4241948">(</span><span class="ident" id="4241949">save</span>&nbsp;<span class="builtintype" id="4241954">bool</span><span class="op" id="4241958">)</span>&nbsp;<span class="builtintype" id="4241960">error</span>&nbsp;<span class="op" id="4241966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4241969">_</span><span class="op" id="4241970">,</span>&nbsp;<span class="ident" id="4241972">err</span>&nbsp;<span class="op" id="4241976">:=</span>&nbsp;<span class="ident" id="4241979">io</span><span class="op" id="4241981">.</span><span class="ident" id="4241982">ReadFull</span><span class="op" id="4241990">(</span><span class="ident" id="4241991">z</span><span class="op" id="4241992">.</span><span class="ident" id="4241993">r</span><span class="op" id="4241994">,</span>&nbsp;<span class="ident" id="4241996">z</span><span class="op" id="4241997">.</span><span class="ident" id="4241998">buf</span><span class="op" id="4242001">[</span><span class="num" id="4242002">0</span><span class="op" id="4242003">:</span><span class="num" id="4242004">10</span><span class="op" id="4242006">]</span><span class="op" id="4242007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242010">if</span>&nbsp;<span class="ident" id="4242013">err</span>&nbsp;<span class="op" id="4242017">!=</span>&nbsp;<span class="ident" id="4242020">nil</span>&nbsp;<span class="op" id="4242024">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242028">return</span>&nbsp;<span class="ident" id="4242035">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242043">if</span>&nbsp;<span class="ident" id="4242046">z</span><span class="op" id="4242047">.</span><span class="ident" id="4242048">buf</span><span class="op" id="4242051">[</span><span class="num" id="4242052">0</span><span class="op" id="4242053">]</span>&nbsp;<span class="op" id="4242055">!=</span>&nbsp;<span class="ident" id="4242058">gzipID1</span>&nbsp;<span class="op" id="4242066">||</span>&nbsp;<span class="ident" id="4242069">z</span><span class="op" id="4242070">.</span><span class="ident" id="4242071">buf</span><span class="op" id="4242074">[</span><span class="num" id="4242075">1</span><span class="op" id="4242076">]</span>&nbsp;<span class="op" id="4242078">!=</span>&nbsp;<span class="ident" id="4242081">gzipID2</span>&nbsp;<span class="op" id="4242089">||</span>&nbsp;<span class="ident" id="4242092">z</span><span class="op" id="4242093">.</span><span class="ident" id="4242094">buf</span><span class="op" id="4242097">[</span><span class="num" id="4242098">2</span><span class="op" id="4242099">]</span>&nbsp;<span class="op" id="4242101">!=</span>&nbsp;<span class="ident" id="4242104">gzipDeflate</span>&nbsp;<span class="op" id="4242116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242120">return</span>&nbsp;<span class="ident" id="4242127">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242138">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242141">z</span><span class="op" id="4242142">.</span><span class="ident" id="4242143">flg</span>&nbsp;<span class="op" id="4242147">=</span>&nbsp;<span class="ident" id="4242149">z</span><span class="op" id="4242150">.</span><span class="ident" id="4242151">buf</span><span class="op" id="4242154">[</span><span class="num" id="4242155">3</span><span class="op" id="4242156">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242159">if</span>&nbsp;<span class="ident" id="4242162">save</span>&nbsp;<span class="op" id="4242167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242171">z</span><span class="op" id="4242172">.</span><span class="ident" id="4242173">ModTime</span>&nbsp;<span class="op" id="4242181">=</span>&nbsp;<span class="ident" id="4242183">time</span><span class="op" id="4242187">.</span><span class="ident" id="4242188">Unix</span><span class="op" id="4242192">(</span><span class="ident" id="4242193">int64</span><span class="op" id="4242198">(</span><span class="ident" id="4242199">get4</span><span class="op" id="4242203">(</span><span class="ident" id="4242204">z</span><span class="op" id="4242205">.</span><span class="ident" id="4242206">buf</span><span class="op" id="4242209">[</span><span class="num" id="4242210">4</span><span class="op" id="4242211">:</span><span class="num" id="4242212">8</span><span class="op" id="4242213">]</span><span class="op" id="4242214">)</span><span class="op" id="4242215">)</span><span class="op" id="4242216">,</span>&nbsp;<span class="num" id="4242218">0</span><span class="op" id="4242219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4242223">//&nbsp;z.buf[8]&nbsp;is&nbsp;xfl,&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242253">z</span><span class="op" id="4242254">.</span><span class="ident" id="4242255">OS</span>&nbsp;<span class="op" id="4242258">=</span>&nbsp;<span class="ident" id="4242260">z</span><span class="op" id="4242261">.</span><span class="ident" id="4242262">buf</span><span class="op" id="4242265">[</span><span class="num" id="4242266">9</span><span class="op" id="4242267">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242273">z</span><span class="op" id="4242274">.</span><span class="ident" id="4242275">digest</span><span class="op" id="4242281">.</span><span class="ident" id="4242282">Reset</span><span class="op" id="4242287">(</span><span class="op" id="4242288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242291">z</span><span class="op" id="4242292">.</span><span class="ident" id="4242293">digest</span><span class="op" id="4242299">.</span><span class="ident" id="4242300">Write</span><span class="op" id="4242305">(</span><span class="ident" id="4242306">z</span><span class="op" id="4242307">.</span><span class="ident" id="4242308">buf</span><span class="op" id="4242311">[</span><span class="num" id="4242312">0</span><span class="op" id="4242313">:</span><span class="num" id="4242314">10</span><span class="op" id="4242316">]</span><span class="op" id="4242317">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242321">if</span>&nbsp;<span class="ident" id="4242324">z</span><span class="op" id="4242325">.</span><span class="ident" id="4242326">flg</span><span class="op" id="4242329">&amp;</span><span class="ident" id="4242330">flagExtra</span>&nbsp;<span class="op" id="4242340">!=</span>&nbsp;<span class="num" id="4242343">0</span>&nbsp;<span class="op" id="4242345">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242349">n</span><span class="op" id="4242350">,</span>&nbsp;<span class="ident" id="4242352">err</span>&nbsp;<span class="op" id="4242356">:=</span>&nbsp;<span class="ident" id="4242359">z</span><span class="op" id="4242360">.</span><span class="ident" id="4242361">read2</span><span class="op" id="4242366">(</span><span class="op" id="4242367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242371">if</span>&nbsp;<span class="ident" id="4242374">err</span>&nbsp;<span class="op" id="4242378">!=</span>&nbsp;<span class="ident" id="4242381">nil</span>&nbsp;<span class="op" id="4242385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242390">return</span>&nbsp;<span class="ident" id="4242397">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242407">data</span>&nbsp;<span class="op" id="4242412">:=</span>&nbsp;<span class="builtinfunc" id="4242415">make</span><span class="op" id="4242419">(</span><span class="op" id="4242420">[</span><span class="op" id="4242421">]</span><span class="builtintype" id="4242422">byte</span><span class="op" id="4242426">,</span>&nbsp;<span class="ident" id="4242428">n</span><span class="op" id="4242429">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242433">if</span>&nbsp;<span class="ident" id="4242436">_</span><span class="op" id="4242437">,</span>&nbsp;<span class="ident" id="4242439">err</span>&nbsp;<span class="op" id="4242443">=</span>&nbsp;<span class="ident" id="4242445">io</span><span class="op" id="4242447">.</span><span class="ident" id="4242448">ReadFull</span><span class="op" id="4242456">(</span><span class="ident" id="4242457">z</span><span class="op" id="4242458">.</span><span class="ident" id="4242459">r</span><span class="op" id="4242460">,</span>&nbsp;<span class="ident" id="4242462">data</span><span class="op" id="4242466">)</span><span class="op" id="4242467">;</span>&nbsp;<span class="ident" id="4242469">err</span>&nbsp;<span class="op" id="4242473">!=</span>&nbsp;<span class="ident" id="4242476">nil</span>&nbsp;<span class="op" id="4242480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242485">return</span>&nbsp;<span class="ident" id="4242492">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242502">if</span>&nbsp;<span class="ident" id="4242505">save</span>&nbsp;<span class="op" id="4242510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242515">z</span><span class="op" id="4242516">.</span><span class="ident" id="4242517">Extra</span>&nbsp;<span class="op" id="4242523">=</span>&nbsp;<span class="ident" id="4242525">data</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242539">var</span>&nbsp;<span class="ident" id="4242543">s</span>&nbsp;<span class="builtintype" id="4242545">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242553">if</span>&nbsp;<span class="ident" id="4242556">z</span><span class="op" id="4242557">.</span><span class="ident" id="4242558">flg</span><span class="op" id="4242561">&amp;</span><span class="ident" id="4242562">flagName</span>&nbsp;<span class="op" id="4242571">!=</span>&nbsp;<span class="num" id="4242574">0</span>&nbsp;<span class="op" id="4242576">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242580">if</span>&nbsp;<span class="ident" id="4242583">s</span><span class="op" id="4242584">,</span>&nbsp;<span class="ident" id="4242586">err</span>&nbsp;<span class="op" id="4242590">=</span>&nbsp;<span class="ident" id="4242592">z</span><span class="op" id="4242593">.</span><span class="ident" id="4242594">readString</span><span class="op" id="4242604">(</span><span class="op" id="4242605">)</span><span class="op" id="4242606">;</span>&nbsp;<span class="ident" id="4242608">err</span>&nbsp;<span class="op" id="4242612">!=</span>&nbsp;<span class="ident" id="4242615">nil</span>&nbsp;<span class="op" id="4242619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242624">return</span>&nbsp;<span class="ident" id="4242631">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242641">if</span>&nbsp;<span class="ident" id="4242644">save</span>&nbsp;<span class="op" id="4242649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242654">z</span><span class="op" id="4242655">.</span><span class="ident" id="4242656">Name</span>&nbsp;<span class="op" id="4242661">=</span>&nbsp;<span class="ident" id="4242663">s</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242674">if</span>&nbsp;<span class="ident" id="4242677">z</span><span class="op" id="4242678">.</span><span class="ident" id="4242679">flg</span><span class="op" id="4242682">&amp;</span><span class="ident" id="4242683">flagComment</span>&nbsp;<span class="op" id="4242695">!=</span>&nbsp;<span class="num" id="4242698">0</span>&nbsp;<span class="op" id="4242700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242704">if</span>&nbsp;<span class="ident" id="4242707">s</span><span class="op" id="4242708">,</span>&nbsp;<span class="ident" id="4242710">err</span>&nbsp;<span class="op" id="4242714">=</span>&nbsp;<span class="ident" id="4242716">z</span><span class="op" id="4242717">.</span><span class="ident" id="4242718">readString</span><span class="op" id="4242728">(</span><span class="op" id="4242729">)</span><span class="op" id="4242730">;</span>&nbsp;<span class="ident" id="4242732">err</span>&nbsp;<span class="op" id="4242736">!=</span>&nbsp;<span class="ident" id="4242739">nil</span>&nbsp;<span class="op" id="4242743">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242748">return</span>&nbsp;<span class="ident" id="4242755">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242765">if</span>&nbsp;<span class="ident" id="4242768">save</span>&nbsp;<span class="op" id="4242773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242778">z</span><span class="op" id="4242779">.</span><span class="ident" id="4242780">Comment</span>&nbsp;<span class="op" id="4242788">=</span>&nbsp;<span class="ident" id="4242790">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242794">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242801">if</span>&nbsp;<span class="ident" id="4242804">z</span><span class="op" id="4242805">.</span><span class="ident" id="4242806">flg</span><span class="op" id="4242809">&amp;</span><span class="ident" id="4242810">flagHdrCrc</span>&nbsp;<span class="op" id="4242821">!=</span>&nbsp;<span class="num" id="4242824">0</span>&nbsp;<span class="op" id="4242826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242830">n</span><span class="op" id="4242831">,</span>&nbsp;<span class="ident" id="4242833">err</span>&nbsp;<span class="op" id="4242837">:=</span>&nbsp;<span class="ident" id="4242840">z</span><span class="op" id="4242841">.</span><span class="ident" id="4242842">read2</span><span class="op" id="4242847">(</span><span class="op" id="4242848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242852">if</span>&nbsp;<span class="ident" id="4242855">err</span>&nbsp;<span class="op" id="4242859">!=</span>&nbsp;<span class="ident" id="4242862">nil</span>&nbsp;<span class="op" id="4242866">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242871">return</span>&nbsp;<span class="ident" id="4242878">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242888">sum</span>&nbsp;<span class="op" id="4242892">:=</span>&nbsp;<span class="ident" id="4242895">z</span><span class="op" id="4242896">.</span><span class="ident" id="4242897">digest</span><span class="op" id="4242903">.</span><span class="ident" id="4242904">Sum32</span><span class="op" id="4242909">(</span><span class="op" id="4242910">)</span>&nbsp;<span class="op" id="4242912">&amp;</span>&nbsp;<span class="num" id="4242914">0xFFFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242923">if</span>&nbsp;<span class="ident" id="4242926">n</span>&nbsp;<span class="op" id="4242928">!=</span>&nbsp;<span class="ident" id="4242931">sum</span>&nbsp;<span class="op" id="4242935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242940">return</span>&nbsp;<span class="ident" id="4242947">ErrHeader</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4242962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4242966">z</span><span class="op" id="4242967">.</span><span class="ident" id="4242968">digest</span><span class="op" id="4242974">.</span><span class="ident" id="4242975">Reset</span><span class="op" id="4242980">(</span><span class="op" id="4242981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4242984">if</span>&nbsp;<span class="ident" id="4242987">z</span><span class="op" id="4242988">.</span><span class="ident" id="4242989">decompressor</span>&nbsp;<span class="op" id="4243002">==</span>&nbsp;<span class="ident" id="4243005">nil</span>&nbsp;<span class="op" id="4243009">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243013">z</span><span class="op" id="4243014">.</span><span class="ident" id="4243015">decompressor</span>&nbsp;<span class="op" id="4243028">=</span>&nbsp;<span class="ident" id="4243030">flate</span><span class="op" id="4243035">.</span><span class="ident" id="4243036">NewReader</span><span class="op" id="4243045">(</span><span class="ident" id="4243046">z</span><span class="op" id="4243047">.</span><span class="ident" id="4243048">r</span><span class="op" id="4243049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4243052">}</span>&nbsp;<span class="keyword" id="4243054">else</span>&nbsp;<span class="op" id="4243059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243063">z</span><span class="op" id="4243064">.</span><span class="ident" id="4243065">decompressor</span><span class="op" id="4243077">.</span><span class="op" id="4243078">(</span><span class="ident" id="4243079">flate</span><span class="op" id="4243084">.</span><span class="ident" id="4243085">Resetter</span><span class="op" id="4243093">)</span><span class="op" id="4243094">.</span><span class="ident" id="4243095">Reset</span><span class="op" id="4243100">(</span><span class="ident" id="4243101">z</span><span class="op" id="4243102">.</span><span class="ident" id="4243103">r</span><span class="op" id="4243104">,</span>&nbsp;<span class="ident" id="4243106">nil</span><span class="op" id="4243109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4243112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243115">return</span>&nbsp;<span class="ident" id="4243122">nil</span><br>
<span class="lineno">240</span><span class="op" id="4243126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4243129">func</span>&nbsp;<span class="op" id="4243134">(</span><span class="ident" id="4243135">z</span>&nbsp;<span class="op" id="4243137">*</span><span class="ident" id="4243138">Reader</span><span class="op" id="4243144">)</span>&nbsp;<span class="ident" id="4243146">Read</span><span class="op" id="4243150">(</span><span class="ident" id="4243151">p</span>&nbsp;<span class="op" id="4243153">[</span><span class="op" id="4243154">]</span><span class="builtintype" id="4243155">byte</span><span class="op" id="4243159">)</span>&nbsp;<span class="op" id="4243161">(</span><span class="ident" id="4243162">n</span>&nbsp;<span class="builtintype" id="4243164">int</span><span class="op" id="4243167">,</span>&nbsp;<span class="ident" id="4243169">err</span>&nbsp;<span class="builtintype" id="4243173">error</span><span class="op" id="4243178">)</span>&nbsp;<span class="op" id="4243180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243183">if</span>&nbsp;<span class="ident" id="4243186">z</span><span class="op" id="4243187">.</span><span class="ident" id="4243188">err</span>&nbsp;<span class="op" id="4243192">!=</span>&nbsp;<span class="ident" id="4243195">nil</span>&nbsp;<span class="op" id="4243199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243203">return</span>&nbsp;<span class="num" id="4243210">0</span><span class="op" id="4243211">,</span>&nbsp;<span class="ident" id="4243213">z</span><span class="op" id="4243214">.</span><span class="ident" id="4243215">err</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4243220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243223">if</span>&nbsp;<span class="builtinfunc" id="4243226">len</span><span class="op" id="4243229">(</span><span class="ident" id="4243230">p</span><span class="op" id="4243231">)</span>&nbsp;<span class="op" id="4243233">==</span>&nbsp;<span class="num" id="4243236">0</span>&nbsp;<span class="op" id="4243238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243242">return</span>&nbsp;<span class="num" id="4243249">0</span><span class="op" id="4243250">,</span>&nbsp;<span class="ident" id="4243252">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4243257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243261">n</span><span class="op" id="4243262">,</span>&nbsp;<span class="ident" id="4243264">err</span>&nbsp;<span class="op" id="4243268">=</span>&nbsp;<span class="ident" id="4243270">z</span><span class="op" id="4243271">.</span><span class="ident" id="4243272">decompressor</span><span class="op" id="4243284">.</span><span class="ident" id="4243285">Read</span><span class="op" id="4243289">(</span><span class="ident" id="4243290">p</span><span class="op" id="4243291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243294">z</span><span class="op" id="4243295">.</span><span class="ident" id="4243296">digest</span><span class="op" id="4243302">.</span><span class="ident" id="4243303">Write</span><span class="op" id="4243308">(</span><span class="ident" id="4243309">p</span><span class="op" id="4243310">[</span><span class="num" id="4243311">0</span><span class="op" id="4243312">:</span><span class="ident" id="4243313">n</span><span class="op" id="4243314">]</span><span class="op" id="4243315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243318">z</span><span class="op" id="4243319">.</span><span class="ident" id="4243320">size</span>&nbsp;<span class="op" id="4243325">+=</span>&nbsp;<span class="builtintype" id="4243328">uint32</span><span class="op" id="4243334">(</span><span class="ident" id="4243335">n</span><span class="op" id="4243336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243339">if</span>&nbsp;<span class="ident" id="4243342">n</span>&nbsp;<span class="op" id="4243344">!=</span>&nbsp;<span class="num" id="4243347">0</span>&nbsp;<span class="op" id="4243349">||</span>&nbsp;<span class="ident" id="4243352">err</span>&nbsp;<span class="op" id="4243356">!=</span>&nbsp;<span class="ident" id="4243359">io</span><span class="op" id="4243361">.</span><span class="ident" id="4243362">EOF</span>&nbsp;<span class="op" id="4243366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243370">z</span><span class="op" id="4243371">.</span><span class="ident" id="4243372">err</span>&nbsp;<span class="op" id="4243376">=</span>&nbsp;<span class="ident" id="4243378">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243384">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4243392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4243396">//&nbsp;Finished&nbsp;file;&nbsp;check&nbsp;checksum&nbsp;+&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243438">if</span>&nbsp;<span class="ident" id="4243441">_</span><span class="op" id="4243442">,</span>&nbsp;<span class="ident" id="4243444">err</span>&nbsp;<span class="op" id="4243448">:=</span>&nbsp;<span class="ident" id="4243451">io</span><span class="op" id="4243453">.</span><span class="ident" id="4243454">ReadFull</span><span class="op" id="4243462">(</span><span class="ident" id="4243463">z</span><span class="op" id="4243464">.</span><span class="ident" id="4243465">r</span><span class="op" id="4243466">,</span>&nbsp;<span class="ident" id="4243468">z</span><span class="op" id="4243469">.</span><span class="ident" id="4243470">buf</span><span class="op" id="4243473">[</span><span class="num" id="4243474">0</span><span class="op" id="4243475">:</span><span class="num" id="4243476">8</span><span class="op" id="4243477">]</span><span class="op" id="4243478">)</span><span class="op" id="4243479">;</span>&nbsp;<span class="ident" id="4243481">err</span>&nbsp;<span class="op" id="4243485">!=</span>&nbsp;<span class="ident" id="4243488">nil</span>&nbsp;<span class="op" id="4243492">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243496">z</span><span class="op" id="4243497">.</span><span class="ident" id="4243498">err</span>&nbsp;<span class="op" id="4243502">=</span>&nbsp;<span class="ident" id="4243504">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243510">return</span>&nbsp;<span class="num" id="4243517">0</span><span class="op" id="4243518">,</span>&nbsp;<span class="ident" id="4243520">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4243525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243528">crc32</span><span class="op" id="4243533">,</span>&nbsp;<span class="ident" id="4243535">isize</span>&nbsp;<span class="op" id="4243541">:=</span>&nbsp;<span class="ident" id="4243544">get4</span><span class="op" id="4243548">(</span><span class="ident" id="4243549">z</span><span class="op" id="4243550">.</span><span class="ident" id="4243551">buf</span><span class="op" id="4243554">[</span><span class="num" id="4243555">0</span><span class="op" id="4243556">:</span><span class="num" id="4243557">4</span><span class="op" id="4243558">]</span><span class="op" id="4243559">)</span><span class="op" id="4243560">,</span>&nbsp;<span class="ident" id="4243562">get4</span><span class="op" id="4243566">(</span><span class="ident" id="4243567">z</span><span class="op" id="4243568">.</span><span class="ident" id="4243569">buf</span><span class="op" id="4243572">[</span><span class="num" id="4243573">4</span><span class="op" id="4243574">:</span><span class="num" id="4243575">8</span><span class="op" id="4243576">]</span><span class="op" id="4243577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243580">sum</span>&nbsp;<span class="op" id="4243584">:=</span>&nbsp;<span class="ident" id="4243587">z</span><span class="op" id="4243588">.</span><span class="ident" id="4243589">digest</span><span class="op" id="4243595">.</span><span class="ident" id="4243596">Sum32</span><span class="op" id="4243601">(</span><span class="op" id="4243602">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243605">if</span>&nbsp;<span class="ident" id="4243608">sum</span>&nbsp;<span class="op" id="4243612">!=</span>&nbsp;<span class="ident" id="4243615">crc32</span>&nbsp;<span class="op" id="4243621">||</span>&nbsp;<span class="ident" id="4243624">isize</span>&nbsp;<span class="op" id="4243630">!=</span>&nbsp;<span class="ident" id="4243633">z</span><span class="op" id="4243634">.</span><span class="ident" id="4243635">size</span>&nbsp;<span class="op" id="4243640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243644">z</span><span class="op" id="4243645">.</span><span class="ident" id="4243646">err</span>&nbsp;<span class="op" id="4243650">=</span>&nbsp;<span class="ident" id="4243652">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243666">return</span>&nbsp;<span class="num" id="4243673">0</span><span class="op" id="4243674">,</span>&nbsp;<span class="ident" id="4243676">z</span><span class="op" id="4243677">.</span><span class="ident" id="4243678">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4243683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4243687">//&nbsp;File&nbsp;is&nbsp;ok;&nbsp;is&nbsp;there&nbsp;another?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243721">if</span>&nbsp;<span class="op" id="4243724">!</span><span class="ident" id="4243725">z</span><span class="op" id="4243726">.</span><span class="ident" id="4243727">multistream</span>&nbsp;<span class="op" id="4243739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243743">return</span>&nbsp;<span class="num" id="4243750">0</span><span class="op" id="4243751">,</span>&nbsp;<span class="ident" id="4243753">io</span><span class="op" id="4243755">.</span><span class="ident" id="4243756">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4243761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243765">if</span>&nbsp;<span class="ident" id="4243768">err</span>&nbsp;<span class="op" id="4243772">=</span>&nbsp;<span class="ident" id="4243774">z</span><span class="op" id="4243775">.</span><span class="ident" id="4243776">readHeader</span><span class="op" id="4243786">(</span><span class="builtintype" id="4243787">false</span><span class="op" id="4243792">)</span><span class="op" id="4243793">;</span>&nbsp;<span class="ident" id="4243795">err</span>&nbsp;<span class="op" id="4243799">!=</span>&nbsp;<span class="ident" id="4243802">nil</span>&nbsp;<span class="op" id="4243806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243810">z</span><span class="op" id="4243811">.</span><span class="ident" id="4243812">err</span>&nbsp;<span class="op" id="4243816">=</span>&nbsp;<span class="ident" id="4243818">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243824">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4243832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4243836">//&nbsp;Yes.&nbsp;&nbsp;Reset&nbsp;and&nbsp;read&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243870">z</span><span class="op" id="4243871">.</span><span class="ident" id="4243872">digest</span><span class="op" id="4243878">.</span><span class="ident" id="4243879">Reset</span><span class="op" id="4243884">(</span><span class="op" id="4243885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4243888">z</span><span class="op" id="4243889">.</span><span class="ident" id="4243890">size</span>&nbsp;<span class="op" id="4243895">=</span>&nbsp;<span class="num" id="4243897">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4243900">return</span>&nbsp;<span class="ident" id="4243907">z</span><span class="op" id="4243908">.</span><span class="ident" id="4243909">Read</span><span class="op" id="4243913">(</span><span class="ident" id="4243914">p</span><span class="op" id="4243915">)</span><br>
<span class="lineno"></span><span class="op" id="4243917">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="4243920">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Reader.&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="4243992">func</span>&nbsp;<span class="op" id="4243997">(</span><span class="ident" id="4243998">z</span>&nbsp;<span class="op" id="4244000">*</span><span class="ident" id="4244001">Reader</span><span class="op" id="4244007">)</span>&nbsp;<span class="ident" id="4244009">Close</span><span class="op" id="4244014">(</span><span class="op" id="4244015">)</span>&nbsp;<span class="builtintype" id="4244017">error</span>&nbsp;<span class="op" id="4244023">{</span>&nbsp;<span class="keyword" id="4244025">return</span>&nbsp;<span class="ident" id="4244032">z</span><span class="op" id="4244033">.</span><span class="ident" id="4244034">decompressor</span><span class="op" id="4244046">.</span><span class="ident" id="4244047">Close</span><span class="op" id="4244052">(</span><span class="op" id="4244053">)</span>&nbsp;<span class="op" id="4244055">}</span>
</div>
</body>
</html>
