<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html" class="current">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2533895">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2533951">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2534005">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2534056">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2534126">//&nbsp;Unix&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2534158">package</span>&nbsp;<span class="ident" id="2534166">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2534175">import</span>&nbsp;<span class="string" id="2534182">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2534190">var</span>&nbsp;<span class="op" id="2534194">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2534197">//&nbsp;envOnce&nbsp;guards&nbsp;initialization&nbsp;by&nbsp;copyenv,&nbsp;which&nbsp;populates&nbsp;env.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2534264">envOnce</span>&nbsp;<span class="ident" id="2534272">sync</span><span class="op" id="2534276">.</span><span class="ident" id="2534277">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2534284">//&nbsp;envLock&nbsp;guards&nbsp;env&nbsp;and&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2534317">envLock</span>&nbsp;<span class="ident" id="2534325">sync</span><span class="op" id="2534329">.</span><span class="ident" id="2534330">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2534340">//&nbsp;env&nbsp;maps&nbsp;from&nbsp;an&nbsp;environment&nbsp;variable&nbsp;to&nbsp;its&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2534415">env</span>&nbsp;<span class="keyword" id="2534419">map</span><span class="op" id="2534422">[</span><span class="builtintype" id="2534423">string</span><span class="op" id="2534429">]</span><span class="builtintype" id="2534430">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2534436">//&nbsp;envs&nbsp;is&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime.&nbsp;elements&nbsp;are&nbsp;expected&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2534498">//&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;key=value&#34;.&nbsp;An&nbsp;empty&nbsp;string&nbsp;means&nbsp;deleted</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2534560">//&nbsp;(or&nbsp;a&nbsp;duplicate&nbsp;to&nbsp;be&nbsp;ignored).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2534596">envs</span>&nbsp;<span class="op" id="2534601">[</span><span class="op" id="2534602">]</span><span class="builtintype" id="2534603">string</span>&nbsp;<span class="op" id="2534610">=</span>&nbsp;<span class="ident" id="2534612">runtime_envs</span><span class="op" id="2534624">(</span><span class="op" id="2534625">)</span><br>
<span class="lineno"></span><span class="op" id="2534627">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2534630">func</span>&nbsp;<span class="ident" id="2534635">runtime_envs</span><span class="op" id="2534647">(</span><span class="op" id="2534648">)</span>&nbsp;<span class="op" id="2534650">[</span><span class="op" id="2534651">]</span><span class="builtintype" id="2534652">string</span>&nbsp;<span class="comment" id="2534659">//&nbsp;in&nbsp;package&nbsp;runtime</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2534682">//&nbsp;setenv_c&nbsp;and&nbsp;unsetenv_c&nbsp;are&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime&nbsp;but&nbsp;are&nbsp;no-ops</span><br>
<span class="lineno"></span><span class="comment" id="2534752">//&nbsp;if&nbsp;cgo&nbsp;isn&#39;t&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="keyword" id="2534776">func</span>&nbsp;<span class="ident" id="2534781">setenv_c</span><span class="op" id="2534789">(</span><span class="ident" id="2534790">k</span><span class="op" id="2534791">,</span>&nbsp;<span class="ident" id="2534793">v</span>&nbsp;<span class="builtintype" id="2534795">string</span><span class="op" id="2534801">)</span><br>
<span class="lineno"></span><span class="keyword" id="2534803">func</span>&nbsp;<span class="ident" id="2534808">unsetenv_c</span><span class="op" id="2534818">(</span><span class="ident" id="2534819">k</span>&nbsp;<span class="builtintype" id="2534821">string</span><span class="op" id="2534827">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2534830">func</span>&nbsp;<span class="ident" id="2534835">copyenv</span><span class="op" id="2534842">(</span><span class="op" id="2534843">)</span>&nbsp;<span class="op" id="2534845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2534848">env</span>&nbsp;<span class="op" id="2534852">=</span>&nbsp;<span class="builtinfunc" id="2534854">make</span><span class="op" id="2534858">(</span><span class="keyword" id="2534859">map</span><span class="op" id="2534862">[</span><span class="builtintype" id="2534863">string</span><span class="op" id="2534869">]</span><span class="builtintype" id="2534870">int</span><span class="op" id="2534873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2534876">for</span>&nbsp;<span class="ident" id="2534880">i</span><span class="op" id="2534881">,</span>&nbsp;<span class="ident" id="2534883">s</span>&nbsp;<span class="op" id="2534885">:=</span>&nbsp;<span class="keyword" id="2534888">range</span>&nbsp;<span class="ident" id="2534894">envs</span>&nbsp;<span class="op" id="2534899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2534903">for</span>&nbsp;<span class="ident" id="2534907">j</span>&nbsp;<span class="op" id="2534909">:=</span>&nbsp;<span class="num" id="2534912">0</span><span class="op" id="2534913">;</span>&nbsp;<span class="ident" id="2534915">j</span>&nbsp;<span class="op" id="2534917">&lt;</span>&nbsp;<span class="builtinfunc" id="2534919">len</span><span class="op" id="2534922">(</span><span class="ident" id="2534923">s</span><span class="op" id="2534924">)</span><span class="op" id="2534925">;</span>&nbsp;<span class="ident" id="2534927">j</span><span class="op" id="2534928">++</span>&nbsp;<span class="op" id="2534931">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2534936">if</span>&nbsp;<span class="ident" id="2534939">s</span><span class="op" id="2534940">[</span><span class="ident" id="2534941">j</span><span class="op" id="2534942">]</span>&nbsp;<span class="op" id="2534944">==</span>&nbsp;<span class="string" id="2534947">&#39;=&#39;</span>&nbsp;<span class="op" id="2534951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2534957">key</span>&nbsp;<span class="op" id="2534961">:=</span>&nbsp;<span class="ident" id="2534964">s</span><span class="op" id="2534965">[</span><span class="op" id="2534966">:</span><span class="ident" id="2534967">j</span><span class="op" id="2534968">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2534974">if</span>&nbsp;<span class="ident" id="2534977">_</span><span class="op" id="2534978">,</span>&nbsp;<span class="ident" id="2534980">ok</span>&nbsp;<span class="op" id="2534983">:=</span>&nbsp;<span class="ident" id="2534986">env</span><span class="op" id="2534989">[</span><span class="ident" id="2534990">key</span><span class="op" id="2534993">]</span><span class="op" id="2534994">;</span>&nbsp;<span class="op" id="2534996">!</span><span class="ident" id="2534997">ok</span>&nbsp;<span class="op" id="2535000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535007">env</span><span class="op" id="2535010">[</span><span class="ident" id="2535011">key</span><span class="op" id="2535014">]</span>&nbsp;<span class="op" id="2535016">=</span>&nbsp;<span class="ident" id="2535018">i</span>&nbsp;<span class="comment" id="2535020">//&nbsp;first&nbsp;mention&nbsp;of&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2535048">}</span>&nbsp;<span class="keyword" id="2535050">else</span>&nbsp;<span class="op" id="2535055">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2535062">//&nbsp;Clear&nbsp;duplicate&nbsp;keys.&nbsp;This&nbsp;permits&nbsp;Unsetenv&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2535117">//&nbsp;safely&nbsp;delete&nbsp;only&nbsp;the&nbsp;first&nbsp;item&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2535167">//&nbsp;worrying&nbsp;about&nbsp;unshadowing&nbsp;a&nbsp;later&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2535215">//&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;security&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535258">envs</span><span class="op" id="2535262">[</span><span class="ident" id="2535263">i</span><span class="op" id="2535264">]</span>&nbsp;<span class="op" id="2535266">=</span>&nbsp;<span class="string" id="2535268">&#34;&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2535275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535281">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2535290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2535294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2535297">}</span><br>
<span class="lineno">55</span><span class="op" id="2535299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2535302">func</span>&nbsp;<span class="ident" id="2535307">Unsetenv</span><span class="op" id="2535315">(</span><span class="ident" id="2535316">key</span>&nbsp;<span class="builtintype" id="2535320">string</span><span class="op" id="2535326">)</span>&nbsp;<span class="builtintype" id="2535328">error</span>&nbsp;<span class="op" id="2535334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535337">envOnce</span><span class="op" id="2535344">.</span><span class="ident" id="2535345">Do</span><span class="op" id="2535347">(</span><span class="ident" id="2535348">copyenv</span><span class="op" id="2535355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535359">envLock</span><span class="op" id="2535366">.</span><span class="ident" id="2535367">Lock</span><span class="op" id="2535371">(</span><span class="op" id="2535372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535375">defer</span>&nbsp;<span class="ident" id="2535381">envLock</span><span class="op" id="2535388">.</span><span class="ident" id="2535389">Unlock</span><span class="op" id="2535395">(</span><span class="op" id="2535396">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535400">if</span>&nbsp;<span class="ident" id="2535403">i</span><span class="op" id="2535404">,</span>&nbsp;<span class="ident" id="2535406">ok</span>&nbsp;<span class="op" id="2535409">:=</span>&nbsp;<span class="ident" id="2535412">env</span><span class="op" id="2535415">[</span><span class="ident" id="2535416">key</span><span class="op" id="2535419">]</span><span class="op" id="2535420">;</span>&nbsp;<span class="ident" id="2535422">ok</span>&nbsp;<span class="op" id="2535425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535429">envs</span><span class="op" id="2535433">[</span><span class="ident" id="2535434">i</span><span class="op" id="2535435">]</span>&nbsp;<span class="op" id="2535437">=</span>&nbsp;<span class="string" id="2535439">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2535444">delete</span><span class="op" id="2535450">(</span><span class="ident" id="2535451">env</span><span class="op" id="2535454">,</span>&nbsp;<span class="ident" id="2535456">key</span><span class="op" id="2535459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2535462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535465">unsetenv_c</span><span class="op" id="2535475">(</span><span class="ident" id="2535476">key</span><span class="op" id="2535479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535482">return</span>&nbsp;<span class="ident" id="2535489">nil</span><br>
<span class="lineno"></span><span class="op" id="2535493">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2535496">func</span>&nbsp;<span class="ident" id="2535501">Getenv</span><span class="op" id="2535507">(</span><span class="ident" id="2535508">key</span>&nbsp;<span class="builtintype" id="2535512">string</span><span class="op" id="2535518">)</span>&nbsp;<span class="op" id="2535520">(</span><span class="ident" id="2535521">value</span>&nbsp;<span class="builtintype" id="2535527">string</span><span class="op" id="2535533">,</span>&nbsp;<span class="ident" id="2535535">found</span>&nbsp;<span class="builtintype" id="2535541">bool</span><span class="op" id="2535545">)</span>&nbsp;<span class="op" id="2535547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535550">envOnce</span><span class="op" id="2535557">.</span><span class="ident" id="2535558">Do</span><span class="op" id="2535560">(</span><span class="ident" id="2535561">copyenv</span><span class="op" id="2535568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535571">if</span>&nbsp;<span class="builtinfunc" id="2535574">len</span><span class="op" id="2535577">(</span><span class="ident" id="2535578">key</span><span class="op" id="2535581">)</span>&nbsp;<span class="op" id="2535583">==</span>&nbsp;<span class="num" id="2535586">0</span>&nbsp;<span class="op" id="2535588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535592">return</span>&nbsp;<span class="string" id="2535599">&#34;&#34;</span><span class="op" id="2535601">,</span>&nbsp;<span class="builtintype" id="2535603">false</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2535610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535614">envLock</span><span class="op" id="2535621">.</span><span class="ident" id="2535622">RLock</span><span class="op" id="2535627">(</span><span class="op" id="2535628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535631">defer</span>&nbsp;<span class="ident" id="2535637">envLock</span><span class="op" id="2535644">.</span><span class="ident" id="2535645">RUnlock</span><span class="op" id="2535652">(</span><span class="op" id="2535653">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535657">i</span><span class="op" id="2535658">,</span>&nbsp;<span class="ident" id="2535660">ok</span>&nbsp;<span class="op" id="2535663">:=</span>&nbsp;<span class="ident" id="2535666">env</span><span class="op" id="2535669">[</span><span class="ident" id="2535670">key</span><span class="op" id="2535673">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535676">if</span>&nbsp;<span class="op" id="2535679">!</span><span class="ident" id="2535680">ok</span>&nbsp;<span class="op" id="2535683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535687">return</span>&nbsp;<span class="string" id="2535694">&#34;&#34;</span><span class="op" id="2535696">,</span>&nbsp;<span class="builtintype" id="2535698">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2535705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535708">s</span>&nbsp;<span class="op" id="2535710">:=</span>&nbsp;<span class="ident" id="2535713">envs</span><span class="op" id="2535717">[</span><span class="ident" id="2535718">i</span><span class="op" id="2535719">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535722">for</span>&nbsp;<span class="ident" id="2535726">i</span>&nbsp;<span class="op" id="2535728">:=</span>&nbsp;<span class="num" id="2535731">0</span><span class="op" id="2535732">;</span>&nbsp;<span class="ident" id="2535734">i</span>&nbsp;<span class="op" id="2535736">&lt;</span>&nbsp;<span class="builtinfunc" id="2535738">len</span><span class="op" id="2535741">(</span><span class="ident" id="2535742">s</span><span class="op" id="2535743">)</span><span class="op" id="2535744">;</span>&nbsp;<span class="ident" id="2535746">i</span><span class="op" id="2535747">++</span>&nbsp;<span class="op" id="2535750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535754">if</span>&nbsp;<span class="ident" id="2535757">s</span><span class="op" id="2535758">[</span><span class="ident" id="2535759">i</span><span class="op" id="2535760">]</span>&nbsp;<span class="op" id="2535762">==</span>&nbsp;<span class="string" id="2535765">&#39;=&#39;</span>&nbsp;<span class="op" id="2535769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535774">return</span>&nbsp;<span class="ident" id="2535781">s</span><span class="op" id="2535782">[</span><span class="ident" id="2535783">i</span><span class="op" id="2535784">+</span><span class="num" id="2535785">1</span><span class="op" id="2535786">:</span><span class="op" id="2535787">]</span><span class="op" id="2535788">,</span>&nbsp;<span class="builtintype" id="2535790">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2535797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2535800">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535803">return</span>&nbsp;<span class="string" id="2535810">&#34;&#34;</span><span class="op" id="2535812">,</span>&nbsp;<span class="builtintype" id="2535814">false</span><br>
<span class="lineno"></span><span class="op" id="2535820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2535823">func</span>&nbsp;<span class="ident" id="2535828">Setenv</span><span class="op" id="2535834">(</span><span class="ident" id="2535835">key</span><span class="op" id="2535838">,</span>&nbsp;<span class="ident" id="2535840">value</span>&nbsp;<span class="builtintype" id="2535846">string</span><span class="op" id="2535852">)</span>&nbsp;<span class="builtintype" id="2535854">error</span>&nbsp;<span class="op" id="2535860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2535863">envOnce</span><span class="op" id="2535870">.</span><span class="ident" id="2535871">Do</span><span class="op" id="2535873">(</span><span class="ident" id="2535874">copyenv</span><span class="op" id="2535881">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535884">if</span>&nbsp;<span class="builtinfunc" id="2535887">len</span><span class="op" id="2535890">(</span><span class="ident" id="2535891">key</span><span class="op" id="2535894">)</span>&nbsp;<span class="op" id="2535896">==</span>&nbsp;<span class="num" id="2535899">0</span>&nbsp;<span class="op" id="2535901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535905">return</span>&nbsp;<span class="ident" id="2535912">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2535920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535923">for</span>&nbsp;<span class="ident" id="2535927">i</span>&nbsp;<span class="op" id="2535929">:=</span>&nbsp;<span class="num" id="2535932">0</span><span class="op" id="2535933">;</span>&nbsp;<span class="ident" id="2535935">i</span>&nbsp;<span class="op" id="2535937">&lt;</span>&nbsp;<span class="builtinfunc" id="2535939">len</span><span class="op" id="2535942">(</span><span class="ident" id="2535943">key</span><span class="op" id="2535946">)</span><span class="op" id="2535947">;</span>&nbsp;<span class="ident" id="2535949">i</span><span class="op" id="2535950">++</span>&nbsp;<span class="op" id="2535953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535957">if</span>&nbsp;<span class="ident" id="2535960">key</span><span class="op" id="2535963">[</span><span class="ident" id="2535964">i</span><span class="op" id="2535965">]</span>&nbsp;<span class="op" id="2535967">==</span>&nbsp;<span class="string" id="2535970">&#39;=&#39;</span>&nbsp;<span class="op" id="2535974">||</span>&nbsp;<span class="ident" id="2535977">key</span><span class="op" id="2535980">[</span><span class="ident" id="2535981">i</span><span class="op" id="2535982">]</span>&nbsp;<span class="op" id="2535984">==</span>&nbsp;<span class="num" id="2535987">0</span>&nbsp;<span class="op" id="2535989">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2535994">return</span>&nbsp;<span class="ident" id="2536001">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2536010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2536013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536016">for</span>&nbsp;<span class="ident" id="2536020">i</span>&nbsp;<span class="op" id="2536022">:=</span>&nbsp;<span class="num" id="2536025">0</span><span class="op" id="2536026">;</span>&nbsp;<span class="ident" id="2536028">i</span>&nbsp;<span class="op" id="2536030">&lt;</span>&nbsp;<span class="builtinfunc" id="2536032">len</span><span class="op" id="2536035">(</span><span class="ident" id="2536036">value</span><span class="op" id="2536041">)</span><span class="op" id="2536042">;</span>&nbsp;<span class="ident" id="2536044">i</span><span class="op" id="2536045">++</span>&nbsp;<span class="op" id="2536048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536052">if</span>&nbsp;<span class="ident" id="2536055">value</span><span class="op" id="2536060">[</span><span class="ident" id="2536061">i</span><span class="op" id="2536062">]</span>&nbsp;<span class="op" id="2536064">==</span>&nbsp;<span class="num" id="2536067">0</span>&nbsp;<span class="op" id="2536069">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536074">return</span>&nbsp;<span class="ident" id="2536081">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2536090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2536093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536097">envLock</span><span class="op" id="2536104">.</span><span class="ident" id="2536105">Lock</span><span class="op" id="2536109">(</span><span class="op" id="2536110">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536113">defer</span>&nbsp;<span class="ident" id="2536119">envLock</span><span class="op" id="2536126">.</span><span class="ident" id="2536127">Unlock</span><span class="op" id="2536133">(</span><span class="op" id="2536134">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536138">i</span><span class="op" id="2536139">,</span>&nbsp;<span class="ident" id="2536141">ok</span>&nbsp;<span class="op" id="2536144">:=</span>&nbsp;<span class="ident" id="2536147">env</span><span class="op" id="2536150">[</span><span class="ident" id="2536151">key</span><span class="op" id="2536154">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536157">kv</span>&nbsp;<span class="op" id="2536160">:=</span>&nbsp;<span class="ident" id="2536163">key</span>&nbsp;<span class="op" id="2536167">+</span>&nbsp;<span class="string" id="2536169">&#34;=&#34;</span>&nbsp;<span class="op" id="2536173">+</span>&nbsp;<span class="ident" id="2536175">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536182">if</span>&nbsp;<span class="ident" id="2536185">ok</span>&nbsp;<span class="op" id="2536188">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536192">envs</span><span class="op" id="2536196">[</span><span class="ident" id="2536197">i</span><span class="op" id="2536198">]</span>&nbsp;<span class="op" id="2536200">=</span>&nbsp;<span class="ident" id="2536202">kv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2536206">}</span>&nbsp;<span class="keyword" id="2536208">else</span>&nbsp;<span class="op" id="2536213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536217">i</span>&nbsp;<span class="op" id="2536219">=</span>&nbsp;<span class="builtinfunc" id="2536221">len</span><span class="op" id="2536224">(</span><span class="ident" id="2536225">envs</span><span class="op" id="2536229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536233">envs</span>&nbsp;<span class="op" id="2536238">=</span>&nbsp;<span class="builtinfunc" id="2536240">append</span><span class="op" id="2536246">(</span><span class="ident" id="2536247">envs</span><span class="op" id="2536251">,</span>&nbsp;<span class="ident" id="2536253">kv</span><span class="op" id="2536255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2536258">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536261">env</span><span class="op" id="2536264">[</span><span class="ident" id="2536265">key</span><span class="op" id="2536268">]</span>&nbsp;<span class="op" id="2536270">=</span>&nbsp;<span class="ident" id="2536272">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536275">setenv_c</span><span class="op" id="2536283">(</span><span class="ident" id="2536284">key</span><span class="op" id="2536287">,</span>&nbsp;<span class="ident" id="2536289">value</span><span class="op" id="2536294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536297">return</span>&nbsp;<span class="ident" id="2536304">nil</span><br>
<span class="lineno"></span><span class="op" id="2536308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2536311">func</span>&nbsp;<span class="ident" id="2536316">Clearenv</span><span class="op" id="2536324">(</span><span class="op" id="2536325">)</span>&nbsp;<span class="op" id="2536327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536330">envOnce</span><span class="op" id="2536337">.</span><span class="ident" id="2536338">Do</span><span class="op" id="2536340">(</span><span class="ident" id="2536341">copyenv</span><span class="op" id="2536348">)</span>&nbsp;<span class="comment" id="2536350">//&nbsp;prevent&nbsp;copyenv&nbsp;in&nbsp;Getenv/Setenv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536388">envLock</span><span class="op" id="2536395">.</span><span class="ident" id="2536396">Lock</span><span class="op" id="2536400">(</span><span class="op" id="2536401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536404">defer</span>&nbsp;<span class="ident" id="2536410">envLock</span><span class="op" id="2536417">.</span><span class="ident" id="2536418">Unlock</span><span class="op" id="2536424">(</span><span class="op" id="2536425">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536429">for</span>&nbsp;<span class="ident" id="2536433">k</span>&nbsp;<span class="op" id="2536435">:=</span>&nbsp;<span class="keyword" id="2536438">range</span>&nbsp;<span class="ident" id="2536444">env</span>&nbsp;<span class="op" id="2536448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536452">unsetenv_c</span><span class="op" id="2536462">(</span><span class="ident" id="2536463">k</span><span class="op" id="2536464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2536467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536470">env</span>&nbsp;<span class="op" id="2536474">=</span>&nbsp;<span class="builtinfunc" id="2536476">make</span><span class="op" id="2536480">(</span><span class="keyword" id="2536481">map</span><span class="op" id="2536484">[</span><span class="builtintype" id="2536485">string</span><span class="op" id="2536491">]</span><span class="builtintype" id="2536492">int</span><span class="op" id="2536495">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536498">envs</span>&nbsp;<span class="op" id="2536503">=</span>&nbsp;<span class="op" id="2536505">[</span><span class="op" id="2536506">]</span><span class="builtintype" id="2536507">string</span><span class="op" id="2536513">{</span><span class="op" id="2536514">}</span><br>
<span class="lineno"></span><span class="op" id="2536516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2536519">func</span>&nbsp;<span class="ident" id="2536524">Environ</span><span class="op" id="2536531">(</span><span class="op" id="2536532">)</span>&nbsp;<span class="op" id="2536534">[</span><span class="op" id="2536535">]</span><span class="builtintype" id="2536536">string</span>&nbsp;<span class="op" id="2536543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536546">envOnce</span><span class="op" id="2536553">.</span><span class="ident" id="2536554">Do</span><span class="op" id="2536556">(</span><span class="ident" id="2536557">copyenv</span><span class="op" id="2536564">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536567">envLock</span><span class="op" id="2536574">.</span><span class="ident" id="2536575">RLock</span><span class="op" id="2536580">(</span><span class="op" id="2536581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536584">defer</span>&nbsp;<span class="ident" id="2536590">envLock</span><span class="op" id="2536597">.</span><span class="ident" id="2536598">RUnlock</span><span class="op" id="2536605">(</span><span class="op" id="2536606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536609">a</span>&nbsp;<span class="op" id="2536611">:=</span>&nbsp;<span class="builtinfunc" id="2536614">make</span><span class="op" id="2536618">(</span><span class="op" id="2536619">[</span><span class="op" id="2536620">]</span><span class="builtintype" id="2536621">string</span><span class="op" id="2536627">,</span>&nbsp;<span class="num" id="2536629">0</span><span class="op" id="2536630">,</span>&nbsp;<span class="builtinfunc" id="2536632">len</span><span class="op" id="2536635">(</span><span class="ident" id="2536636">envs</span><span class="op" id="2536640">)</span><span class="op" id="2536641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536644">for</span>&nbsp;<span class="ident" id="2536648">_</span><span class="op" id="2536649">,</span>&nbsp;<span class="ident" id="2536651">env</span>&nbsp;<span class="op" id="2536655">:=</span>&nbsp;<span class="keyword" id="2536658">range</span>&nbsp;<span class="ident" id="2536664">envs</span>&nbsp;<span class="op" id="2536669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536673">if</span>&nbsp;<span class="ident" id="2536676">env</span>&nbsp;<span class="op" id="2536680">!=</span>&nbsp;<span class="string" id="2536683">&#34;&#34;</span>&nbsp;<span class="op" id="2536686">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2536691">a</span>&nbsp;<span class="op" id="2536693">=</span>&nbsp;<span class="builtinfunc" id="2536695">append</span><span class="op" id="2536701">(</span><span class="ident" id="2536702">a</span><span class="op" id="2536703">,</span>&nbsp;<span class="ident" id="2536705">env</span><span class="op" id="2536708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2536712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2536715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2536718">return</span>&nbsp;<span class="ident" id="2536725">a</span><br>
<span class="lineno"></span><span class="op" id="2536727">}</span>
</div>
</body>
</html>
