<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3123964">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3124019">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3124073">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3124124">package</span>&nbsp;<span class="ident" id="3124132">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3124138">import</span>&nbsp;<span class="op" id="3124145">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3124148">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3124153">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="3124156">//&nbsp;maxCodeLength&nbsp;is&nbsp;the&nbsp;maximum&nbsp;(inclusive)&nbsp;number&nbsp;of&nbsp;bits&nbsp;in&nbsp;a&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="3124234">const</span>&nbsp;<span class="ident" id="3124240">maxCodeLength</span>&nbsp;<span class="op" id="3124254">=</span>&nbsp;<span class="num" id="3124256">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3124260">//&nbsp;maxNCodes&nbsp;is&nbsp;the&nbsp;maximum&nbsp;(inclusive)&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;a&nbsp;Huffman&nbsp;tree.</span><br>
<span class="lineno">15</span><span class="keyword" id="3124335">const</span>&nbsp;<span class="ident" id="3124341">maxNCodes</span>&nbsp;<span class="op" id="3124351">=</span>&nbsp;<span class="num" id="3124353">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3124358">//&nbsp;lutSize&nbsp;is&nbsp;the&nbsp;log-2&nbsp;size&nbsp;of&nbsp;the&nbsp;Huffman&nbsp;decoder&#39;s&nbsp;look-up&nbsp;table.</span><br>
<span class="lineno"></span><span class="keyword" id="3124427">const</span>&nbsp;<span class="ident" id="3124433">lutSize</span>&nbsp;<span class="op" id="3124441">=</span>&nbsp;<span class="num" id="3124443">8</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3124446">//&nbsp;huffman&nbsp;is&nbsp;a&nbsp;Huffman&nbsp;decoder,&nbsp;specified&nbsp;in&nbsp;section&nbsp;C.</span><br>
<span class="lineno"></span><span class="keyword" id="3124503">type</span>&nbsp;<span class="ident" id="3124508">huffman</span>&nbsp;<span class="keyword" id="3124516">struct</span>&nbsp;<span class="op" id="3124523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3124526">//&nbsp;length&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3124573">nCodes</span>&nbsp;<span class="builtintype" id="3124580">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3124587">//&nbsp;lut&nbsp;is&nbsp;the&nbsp;look-up&nbsp;table&nbsp;for&nbsp;the&nbsp;next&nbsp;lutSize&nbsp;bits&nbsp;in&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3124661">//&nbsp;The&nbsp;high&nbsp;8&nbsp;bits&nbsp;of&nbsp;the&nbsp;uint16&nbsp;are&nbsp;the&nbsp;encoded&nbsp;value.&nbsp;The&nbsp;low&nbsp;8&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3124733">//&nbsp;are&nbsp;1&nbsp;plus&nbsp;the&nbsp;code&nbsp;length,&nbsp;or&nbsp;0&nbsp;if&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;fit&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3124806">//&nbsp;lutSize&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3124824">lut</span>&nbsp;<span class="op" id="3124828">[</span><span class="num" id="3124829">1</span>&nbsp;<span class="op" id="3124831">&lt;&lt;</span>&nbsp;<span class="ident" id="3124834"><a href="/image/jpeg/huffman.go.html#3124433">lutSize</a></span><span class="op" id="3124841">]</span><span class="builtintype" id="3124842">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3124850">//&nbsp;vals&nbsp;are&nbsp;the&nbsp;decoded&nbsp;values,&nbsp;sorted&nbsp;by&nbsp;their&nbsp;encoding.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3124909">vals</span>&nbsp;<span class="op" id="3124914">[</span><span class="ident" id="3124915"><a href="/image/jpeg/huffman.go.html#3124341">maxNCodes</a></span><span class="op" id="3124924">]</span><span class="builtintype" id="3124925">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3124932">//&nbsp;minCodes[i]&nbsp;is&nbsp;the&nbsp;minimum&nbsp;code&nbsp;of&nbsp;length&nbsp;i,&nbsp;or&nbsp;-1&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3125003">//&nbsp;codes&nbsp;of&nbsp;that&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3125029">minCodes</span>&nbsp;<span class="op" id="3125038">[</span><span class="ident" id="3125039"><a href="/image/jpeg/huffman.go.html#3124240">maxCodeLength</a></span><span class="op" id="3125052">]</span><span class="builtintype" id="3125053">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3125060">//&nbsp;maxCodes[i]&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code&nbsp;of&nbsp;length&nbsp;i,&nbsp;or&nbsp;-1&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3125131">//&nbsp;codes&nbsp;of&nbsp;that&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3125157">maxCodes</span>&nbsp;<span class="op" id="3125166">[</span><span class="ident" id="3125167"><a href="/image/jpeg/huffman.go.html#3124240">maxCodeLength</a></span><span class="op" id="3125180">]</span><span class="builtintype" id="3125181">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3125188">//&nbsp;valsIndices[i]&nbsp;is&nbsp;the&nbsp;index&nbsp;into&nbsp;vals&nbsp;of&nbsp;minCodes[i].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3125246">valsIndices</span>&nbsp;<span class="op" id="3125258">[</span><span class="ident" id="3125259"><a href="/image/jpeg/huffman.go.html#3124240">maxCodeLength</a></span><span class="op" id="3125272">]</span><span class="builtintype" id="3125273">int32</span><br>
<span class="lineno"></span><span class="op" id="3125279">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3125282">//&nbsp;errShortHuffmanData&nbsp;means&nbsp;that&nbsp;an&nbsp;unexpected&nbsp;EOF&nbsp;occurred&nbsp;while&nbsp;decoding</span><br>
<span class="lineno"></span><span class="comment" id="3125358">//&nbsp;Huffman&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3125375">var</span>&nbsp;<span class="ident" id="3125379">errShortHuffmanData</span>&nbsp;<span class="op" id="3125399">=</span>&nbsp;<span class="ident" id="3125401"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3125412">(</span><span class="string" id="3125413">&#34;short&nbsp;Huffman&nbsp;data&#34;</span><span class="op" id="3125433">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="3125436">//&nbsp;ensureNBits&nbsp;reads&nbsp;bytes&nbsp;from&nbsp;the&nbsp;byte&nbsp;buffer&nbsp;to&nbsp;ensure&nbsp;that&nbsp;d.bits.n&nbsp;is&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="3125514">//&nbsp;least&nbsp;n.&nbsp;For&nbsp;best&nbsp;performance&nbsp;(avoiding&nbsp;function&nbsp;calls&nbsp;inside&nbsp;hot&nbsp;loops),</span><br>
<span class="lineno"></span><span class="comment" id="3125591">//&nbsp;the&nbsp;caller&nbsp;is&nbsp;the&nbsp;one&nbsp;responsible&nbsp;for&nbsp;first&nbsp;checking&nbsp;that&nbsp;d.bits.n&nbsp;&lt;&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="3125666">func</span>&nbsp;<span class="op" id="3125671">(</span><span class="ident" id="3125672">d</span>&nbsp;<span class="op" id="3125674">*</span><span class="ident" id="3125675"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3125682">)</span>&nbsp;<span class="ident" id="3125684">ensureNBits</span><span class="op" id="3125695">(</span><span class="ident" id="3125696">n</span>&nbsp;<span class="builtintype" id="3125698">int32</span><span class="op" id="3125703">)</span>&nbsp;<span class="builtintype" id="3125705">error</span>&nbsp;<span class="op" id="3125711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3125714">for</span>&nbsp;<span class="op" id="3125718">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3125722">c</span><span class="op" id="3125723">,</span>&nbsp;<span class="ident" id="3125725">err</span>&nbsp;<span class="op" id="3125729">:=</span>&nbsp;<span class="ident" id="3125732"><a href="/image/jpeg/huffman.go.html#3125672">d</a></span><span class="op" id="3125733">.</span><span class="ident" id="3125734">readByteStuffedByte</span><span class="op" id="3125753">(</span><span class="op" id="3125754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3125758">if</span>&nbsp;<span class="ident" id="3125761"><a href="/image/jpeg/huffman.go.html#3125725">err</a></span>&nbsp;<span class="op" id="3125765">!=</span>&nbsp;<span class="ident" id="3125768">nil</span>&nbsp;<span class="op" id="3125772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3125777">if</span>&nbsp;<span class="ident" id="3125780"><a href="/image/jpeg/huffman.go.html#3125725">err</a></span>&nbsp;<span class="op" id="3125784">==</span>&nbsp;<span class="ident" id="3125787"><a href="/image/jpeg/huffman.go.html#3124148">io</a></span><span class="op" id="3125789">.</span><span class="ident" id="3125790">EOF</span>&nbsp;<span class="op" id="3125794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3125800">return</span>&nbsp;<span class="ident" id="3125807"><a href="/image/jpeg/huffman.go.html#3125379">errShortHuffmanData</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3125830">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3125835">return</span>&nbsp;<span class="ident" id="3125842"><a href="/image/jpeg/huffman.go.html#3125725">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3125848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3125852"><a href="/image/jpeg/huffman.go.html#3125672">d</a></span><span class="op" id="3125853">.</span><span class="ident" id="3125854">bits</span><span class="op" id="3125858">.</span><span class="ident" id="3125859">a</span>&nbsp;<span class="op" id="3125861">=</span>&nbsp;<span class="ident" id="3125863"><a href="/image/jpeg/huffman.go.html#3125672">d</a></span><span class="op" id="3125864">.</span><span class="ident" id="3125865">bits</span><span class="op" id="3125869">.</span><span class="ident" id="3125870">a</span><span class="op" id="3125871">&lt;&lt;</span><span class="num" id="3125873">8</span>&nbsp;<span class="op" id="3125875">|</span>&nbsp;<span class="builtintype" id="3125877">uint32</span><span class="op" id="3125883">(</span><span class="ident" id="3125884"><a href="/image/jpeg/huffman.go.html#3125722">c</a></span><span class="op" id="3125885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3125889"><a href="/image/jpeg/huffman.go.html#3125672">d</a></span><span class="op" id="3125890">.</span><span class="ident" id="3125891">bits</span><span class="op" id="3125895">.</span><span class="ident" id="3125896">n</span>&nbsp;<span class="op" id="3125898">+=</span>&nbsp;<span class="num" id="3125901">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3125905">if</span>&nbsp;<span class="ident" id="3125908"><a href="/image/jpeg/huffman.go.html#3125672">d</a></span><span class="op" id="3125909">.</span><span class="ident" id="3125910">bits</span><span class="op" id="3125914">.</span><span class="ident" id="3125915">m</span>&nbsp;<span class="op" id="3125917">==</span>&nbsp;<span class="num" id="3125920">0</span>&nbsp;<span class="op" id="3125922">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3125927"><a href="/image/jpeg/huffman.go.html#3125672">d</a></span><span class="op" id="3125928">.</span><span class="ident" id="3125929">bits</span><span class="op" id="3125933">.</span><span class="ident" id="3125934">m</span>&nbsp;<span class="op" id="3125936">=</span>&nbsp;<span class="num" id="3125938">1</span>&nbsp;<span class="op" id="3125940">&lt;&lt;</span>&nbsp;<span class="num" id="3125943">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3125947">}</span>&nbsp;<span class="keyword" id="3125949">else</span>&nbsp;<span class="op" id="3125954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3125959"><a href="/image/jpeg/huffman.go.html#3125672">d</a></span><span class="op" id="3125960">.</span><span class="ident" id="3125961">bits</span><span class="op" id="3125965">.</span><span class="ident" id="3125966">m</span>&nbsp;<span class="op" id="3125968">&lt;&lt;=</span>&nbsp;<span class="num" id="3125972">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3125976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3125980">if</span>&nbsp;<span class="ident" id="3125983"><a href="/image/jpeg/huffman.go.html#3125672">d</a></span><span class="op" id="3125984">.</span><span class="ident" id="3125985">bits</span><span class="op" id="3125989">.</span><span class="ident" id="3125990">n</span>&nbsp;<span class="op" id="3125992">&gt;=</span>&nbsp;<span class="ident" id="3125995"><a href="/image/jpeg/huffman.go.html#3125696">n</a></span>&nbsp;<span class="op" id="3125997">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126002">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3126010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3126013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126016">return</span>&nbsp;<span class="ident" id="3126023">nil</span><br>
<span class="lineno"></span><span class="op" id="3126027">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3126030">//&nbsp;receiveExtend&nbsp;is&nbsp;the&nbsp;composition&nbsp;of&nbsp;RECEIVE&nbsp;and&nbsp;EXTEND,&nbsp;specified&nbsp;in&nbsp;section</span><br>
<span class="lineno"></span><span class="comment" id="3126110">//&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="3126122">func</span>&nbsp;<span class="op" id="3126127">(</span><span class="ident" id="3126128">d</span>&nbsp;<span class="op" id="3126130">*</span><span class="ident" id="3126131"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3126138">)</span>&nbsp;<span class="ident" id="3126140">receiveExtend</span><span class="op" id="3126153">(</span><span class="ident" id="3126154">t</span>&nbsp;<span class="builtintype" id="3126156">uint8</span><span class="op" id="3126161">)</span>&nbsp;<span class="op" id="3126163">(</span><span class="builtintype" id="3126164">int32</span><span class="op" id="3126169">,</span>&nbsp;<span class="builtintype" id="3126171">error</span><span class="op" id="3126176">)</span>&nbsp;<span class="op" id="3126178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126181">if</span>&nbsp;<span class="ident" id="3126184"><a href="/image/jpeg/huffman.go.html#3126128">d</a></span><span class="op" id="3126185">.</span><span class="ident" id="3126186">bits</span><span class="op" id="3126190">.</span><span class="ident" id="3126191">n</span>&nbsp;<span class="op" id="3126193">&lt;</span>&nbsp;<span class="builtintype" id="3126195">int32</span><span class="op" id="3126200">(</span><span class="ident" id="3126201"><a href="/image/jpeg/huffman.go.html#3126154">t</a></span><span class="op" id="3126202">)</span>&nbsp;<span class="op" id="3126204">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126208">if</span>&nbsp;<span class="ident" id="3126211">err</span>&nbsp;<span class="op" id="3126215">:=</span>&nbsp;<span class="ident" id="3126218"><a href="/image/jpeg/huffman.go.html#3126128">d</a></span><span class="op" id="3126219">.</span><span class="ident" id="3126220">ensureNBits</span><span class="op" id="3126231">(</span><span class="builtintype" id="3126232">int32</span><span class="op" id="3126237">(</span><span class="ident" id="3126238"><a href="/image/jpeg/huffman.go.html#3126154">t</a></span><span class="op" id="3126239">)</span><span class="op" id="3126240">)</span><span class="op" id="3126241">;</span>&nbsp;<span class="ident" id="3126243"><a href="/image/jpeg/huffman.go.html#3126211">err</a></span>&nbsp;<span class="op" id="3126247">!=</span>&nbsp;<span class="ident" id="3126250">nil</span>&nbsp;<span class="op" id="3126254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126259">return</span>&nbsp;<span class="num" id="3126266">0</span><span class="op" id="3126267">,</span>&nbsp;<span class="ident" id="3126269"><a href="/image/jpeg/huffman.go.html#3126211">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3126275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3126278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126281"><a href="/image/jpeg/huffman.go.html#3126128">d</a></span><span class="op" id="3126282">.</span><span class="ident" id="3126283">bits</span><span class="op" id="3126287">.</span><span class="ident" id="3126288">n</span>&nbsp;<span class="op" id="3126290">-=</span>&nbsp;<span class="builtintype" id="3126293">int32</span><span class="op" id="3126298">(</span><span class="ident" id="3126299"><a href="/image/jpeg/huffman.go.html#3126154">t</a></span><span class="op" id="3126300">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126303"><a href="/image/jpeg/huffman.go.html#3126128">d</a></span><span class="op" id="3126304">.</span><span class="ident" id="3126305">bits</span><span class="op" id="3126309">.</span><span class="ident" id="3126310">m</span>&nbsp;<span class="op" id="3126312">&gt;&gt;=</span>&nbsp;<span class="ident" id="3126316"><a href="/image/jpeg/huffman.go.html#3126154">t</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126319">s</span>&nbsp;<span class="op" id="3126321">:=</span>&nbsp;<span class="builtintype" id="3126324">int32</span><span class="op" id="3126329">(</span><span class="num" id="3126330">1</span><span class="op" id="3126331">)</span>&nbsp;<span class="op" id="3126333">&lt;&lt;</span>&nbsp;<span class="ident" id="3126336"><a href="/image/jpeg/huffman.go.html#3126154">t</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126339">x</span>&nbsp;<span class="op" id="3126341">:=</span>&nbsp;<span class="builtintype" id="3126344">int32</span><span class="op" id="3126349">(</span><span class="ident" id="3126350"><a href="/image/jpeg/huffman.go.html#3126128">d</a></span><span class="op" id="3126351">.</span><span class="ident" id="3126352">bits</span><span class="op" id="3126356">.</span><span class="ident" id="3126357">a</span><span class="op" id="3126358">&gt;&gt;</span><span class="builtintype" id="3126360">uint8</span><span class="op" id="3126365">(</span><span class="ident" id="3126366"><a href="/image/jpeg/huffman.go.html#3126128">d</a></span><span class="op" id="3126367">.</span><span class="ident" id="3126368">bits</span><span class="op" id="3126372">.</span><span class="ident" id="3126373">n</span><span class="op" id="3126374">)</span><span class="op" id="3126375">)</span>&nbsp;<span class="op" id="3126377">&amp;</span>&nbsp;<span class="op" id="3126379">(</span><span class="ident" id="3126380"><a href="/image/jpeg/huffman.go.html#3126319">s</a></span>&nbsp;<span class="op" id="3126382">-</span>&nbsp;<span class="num" id="3126384">1</span><span class="op" id="3126385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126388">if</span>&nbsp;<span class="ident" id="3126391"><a href="/image/jpeg/huffman.go.html#3126339">x</a></span>&nbsp;<span class="op" id="3126393">&lt;</span>&nbsp;<span class="ident" id="3126395"><a href="/image/jpeg/huffman.go.html#3126319">s</a></span><span class="op" id="3126396">&gt;&gt;</span><span class="num" id="3126398">1</span>&nbsp;<span class="op" id="3126400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126404"><a href="/image/jpeg/huffman.go.html#3126339">x</a></span>&nbsp;<span class="op" id="3126406">+=</span>&nbsp;<span class="op" id="3126409">(</span><span class="op" id="3126410">(</span><span class="op" id="3126411">-</span><span class="num" id="3126412">1</span><span class="op" id="3126413">)</span>&nbsp;<span class="op" id="3126415">&lt;&lt;</span>&nbsp;<span class="ident" id="3126418"><a href="/image/jpeg/huffman.go.html#3126154">t</a></span><span class="op" id="3126419">)</span>&nbsp;<span class="op" id="3126421">+</span>&nbsp;<span class="num" id="3126423">1</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3126426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126429">return</span>&nbsp;<span class="ident" id="3126436"><a href="/image/jpeg/huffman.go.html#3126339">x</a></span><span class="op" id="3126437">,</span>&nbsp;<span class="ident" id="3126439">nil</span><br>
<span class="lineno"></span><span class="op" id="3126443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3126446">//&nbsp;processDHT&nbsp;processes&nbsp;a&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker,&nbsp;and&nbsp;initializes&nbsp;a&nbsp;huffman</span><br>
<span class="lineno">90</span><span class="comment" id="3126527">//&nbsp;struct&nbsp;from&nbsp;its&nbsp;contents.&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.2.</span><br>
<span class="lineno"></span><span class="keyword" id="3126586">func</span>&nbsp;<span class="op" id="3126591">(</span><span class="ident" id="3126592">d</span>&nbsp;<span class="op" id="3126594">*</span><span class="ident" id="3126595"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3126602">)</span>&nbsp;<span class="ident" id="3126604">processDHT</span><span class="op" id="3126614">(</span><span class="ident" id="3126615">n</span>&nbsp;<span class="builtintype" id="3126617">int</span><span class="op" id="3126620">)</span>&nbsp;<span class="builtintype" id="3126622">error</span>&nbsp;<span class="op" id="3126628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126631">for</span>&nbsp;<span class="ident" id="3126635"><a href="/image/jpeg/huffman.go.html#3126615">n</a></span>&nbsp;<span class="op" id="3126637">&gt;</span>&nbsp;<span class="num" id="3126639">0</span>&nbsp;<span class="op" id="3126641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126645">if</span>&nbsp;<span class="ident" id="3126648"><a href="/image/jpeg/huffman.go.html#3126615">n</a></span>&nbsp;<span class="op" id="3126650">&lt;</span>&nbsp;<span class="num" id="3126652">17</span>&nbsp;<span class="op" id="3126655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126660">return</span>&nbsp;<span class="ident" id="3126667"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3126678">(</span><span class="string" id="3126679">&#34;DHT&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="3126701">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3126705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126709">if</span>&nbsp;<span class="ident" id="3126712">err</span>&nbsp;<span class="op" id="3126716">:=</span>&nbsp;<span class="ident" id="3126719"><a href="/image/jpeg/huffman.go.html#3126592">d</a></span><span class="op" id="3126720">.</span><span class="ident" id="3126721">readFull</span><span class="op" id="3126729">(</span><span class="ident" id="3126730"><a href="/image/jpeg/huffman.go.html#3126592">d</a></span><span class="op" id="3126731">.</span><span class="ident" id="3126732">tmp</span><span class="op" id="3126735">[</span><span class="op" id="3126736">:</span><span class="num" id="3126737">17</span><span class="op" id="3126739">]</span><span class="op" id="3126740">)</span><span class="op" id="3126741">;</span>&nbsp;<span class="ident" id="3126743"><a href="/image/jpeg/huffman.go.html#3126712">err</a></span>&nbsp;<span class="op" id="3126747">!=</span>&nbsp;<span class="ident" id="3126750">nil</span>&nbsp;<span class="op" id="3126754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126759">return</span>&nbsp;<span class="ident" id="3126766"><a href="/image/jpeg/huffman.go.html#3126712">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3126772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126776">tc</span>&nbsp;<span class="op" id="3126779">:=</span>&nbsp;<span class="ident" id="3126782"><a href="/image/jpeg/huffman.go.html#3126592">d</a></span><span class="op" id="3126783">.</span><span class="ident" id="3126784">tmp</span><span class="op" id="3126787">[</span><span class="num" id="3126788">0</span><span class="op" id="3126789">]</span>&nbsp;<span class="op" id="3126791">&gt;&gt;</span>&nbsp;<span class="num" id="3126794">4</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126798">if</span>&nbsp;<span class="ident" id="3126801"><a href="/image/jpeg/huffman.go.html#3126776">tc</a></span>&nbsp;<span class="op" id="3126804">&gt;</span>&nbsp;<span class="ident" id="3126806"><a href="/image/jpeg/reader.go.html#3136590">maxTc</a></span>&nbsp;<span class="op" id="3126812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126817">return</span>&nbsp;<span class="ident" id="3126824"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3126835">(</span><span class="string" id="3126836">&#34;bad&nbsp;Tc&nbsp;value&#34;</span><span class="op" id="3126850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3126854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126858">th</span>&nbsp;<span class="op" id="3126861">:=</span>&nbsp;<span class="ident" id="3126864"><a href="/image/jpeg/huffman.go.html#3126592">d</a></span><span class="op" id="3126865">.</span><span class="ident" id="3126866">tmp</span><span class="op" id="3126869">[</span><span class="num" id="3126870">0</span><span class="op" id="3126871">]</span>&nbsp;<span class="op" id="3126873">&amp;</span>&nbsp;<span class="num" id="3126875">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126882">if</span>&nbsp;<span class="ident" id="3126885"><a href="/image/jpeg/huffman.go.html#3126858">th</a></span>&nbsp;<span class="op" id="3126888">&gt;</span>&nbsp;<span class="ident" id="3126890"><a href="/image/jpeg/reader.go.html#3136603">maxTh</a></span>&nbsp;<span class="op" id="3126896">||</span>&nbsp;<span class="op" id="3126899">!</span><span class="ident" id="3126900"><a href="/image/jpeg/huffman.go.html#3126592">d</a></span><span class="op" id="3126901">.</span><span class="ident" id="3126902">progressive</span>&nbsp;<span class="op" id="3126914">&amp;&amp;</span>&nbsp;<span class="ident" id="3126917"><a href="/image/jpeg/huffman.go.html#3126858">th</a></span>&nbsp;<span class="op" id="3126920">&gt;</span>&nbsp;<span class="num" id="3126922">1</span>&nbsp;<span class="op" id="3126924">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3126929">return</span>&nbsp;<span class="ident" id="3126936"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3126947">(</span><span class="string" id="3126948">&#34;bad&nbsp;Th&nbsp;value&#34;</span><span class="op" id="3126962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3126966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3126970">h</span>&nbsp;<span class="op" id="3126972">:=</span>&nbsp;<span class="op" id="3126975">&amp;</span><span class="ident" id="3126976"><a href="/image/jpeg/huffman.go.html#3126592">d</a></span><span class="op" id="3126977">.</span><span class="ident" id="3126978">huff</span><span class="op" id="3126982">[</span><span class="ident" id="3126983"><a href="/image/jpeg/huffman.go.html#3126776">tc</a></span><span class="op" id="3126985">]</span><span class="op" id="3126986">[</span><span class="ident" id="3126987"><a href="/image/jpeg/huffman.go.html#3126858">th</a></span><span class="op" id="3126989">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3126994">//&nbsp;Read&nbsp;nCodes&nbsp;and&nbsp;h.vals&nbsp;(and&nbsp;derive&nbsp;h.nCodes).</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3127045">//&nbsp;nCodes[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;with&nbsp;code&nbsp;length&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3127103">//&nbsp;h.nCodes&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127147"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3127148">.</span><span class="ident" id="3127149">nCodes</span>&nbsp;<span class="op" id="3127156">=</span>&nbsp;<span class="num" id="3127158">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3127162">var</span>&nbsp;<span class="ident" id="3127166">nCodes</span>&nbsp;<span class="op" id="3127173">[</span><span class="ident" id="3127174"><a href="/image/jpeg/huffman.go.html#3124240">maxCodeLength</a></span><span class="op" id="3127187">]</span><span class="builtintype" id="3127188">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3127196">for</span>&nbsp;<span class="ident" id="3127200">i</span>&nbsp;<span class="op" id="3127202">:=</span>&nbsp;<span class="keyword" id="3127205">range</span>&nbsp;<span class="ident" id="3127211"><a href="/image/jpeg/huffman.go.html#3127166">nCodes</a></span>&nbsp;<span class="op" id="3127218">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127223"><a href="/image/jpeg/huffman.go.html#3127166">nCodes</a></span><span class="op" id="3127229">[</span><span class="ident" id="3127230"><a href="/image/jpeg/huffman.go.html#3127200">i</a></span><span class="op" id="3127231">]</span>&nbsp;<span class="op" id="3127233">=</span>&nbsp;<span class="builtintype" id="3127235">int32</span><span class="op" id="3127240">(</span><span class="ident" id="3127241"><a href="/image/jpeg/huffman.go.html#3126592">d</a></span><span class="op" id="3127242">.</span><span class="ident" id="3127243">tmp</span><span class="op" id="3127246">[</span><span class="ident" id="3127247"><a href="/image/jpeg/huffman.go.html#3127200">i</a></span><span class="op" id="3127248">+</span><span class="num" id="3127249">1</span><span class="op" id="3127250">]</span><span class="op" id="3127251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127256"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3127257">.</span><span class="ident" id="3127258">nCodes</span>&nbsp;<span class="op" id="3127265">+=</span>&nbsp;<span class="ident" id="3127268"><a href="/image/jpeg/huffman.go.html#3127166">nCodes</a></span><span class="op" id="3127274">[</span><span class="ident" id="3127275"><a href="/image/jpeg/huffman.go.html#3127200">i</a></span><span class="op" id="3127276">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3127280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3127284">if</span>&nbsp;<span class="ident" id="3127287"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3127288">.</span><span class="ident" id="3127289">nCodes</span>&nbsp;<span class="op" id="3127296">==</span>&nbsp;<span class="num" id="3127299">0</span>&nbsp;<span class="op" id="3127301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3127306">return</span>&nbsp;<span class="ident" id="3127313"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3127324">(</span><span class="string" id="3127325">&#34;Huffman&nbsp;table&nbsp;has&nbsp;zero&nbsp;length&#34;</span><span class="op" id="3127356">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3127360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3127364">if</span>&nbsp;<span class="ident" id="3127367"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3127368">.</span><span class="ident" id="3127369">nCodes</span>&nbsp;<span class="op" id="3127376">&gt;</span>&nbsp;<span class="ident" id="3127378"><a href="/image/jpeg/huffman.go.html#3124341">maxNCodes</a></span>&nbsp;<span class="op" id="3127388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3127393">return</span>&nbsp;<span class="ident" id="3127400"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3127411">(</span><span class="string" id="3127412">&#34;Huffman&nbsp;table&nbsp;has&nbsp;excessive&nbsp;length&#34;</span><span class="op" id="3127448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3127452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127456"><a href="/image/jpeg/huffman.go.html#3126615">n</a></span>&nbsp;<span class="op" id="3127458">-=</span>&nbsp;<span class="builtintype" id="3127461">int</span><span class="op" id="3127464">(</span><span class="ident" id="3127465"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3127466">.</span><span class="ident" id="3127467">nCodes</span><span class="op" id="3127473">)</span>&nbsp;<span class="op" id="3127475">+</span>&nbsp;<span class="num" id="3127477">17</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3127482">if</span>&nbsp;<span class="ident" id="3127485"><a href="/image/jpeg/huffman.go.html#3126615">n</a></span>&nbsp;<span class="op" id="3127487">&lt;</span>&nbsp;<span class="num" id="3127489">0</span>&nbsp;<span class="op" id="3127491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3127496">return</span>&nbsp;<span class="ident" id="3127503"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3127514">(</span><span class="string" id="3127515">&#34;DHT&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="3127537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3127541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3127545">if</span>&nbsp;<span class="ident" id="3127548">err</span>&nbsp;<span class="op" id="3127552">:=</span>&nbsp;<span class="ident" id="3127555"><a href="/image/jpeg/huffman.go.html#3126592">d</a></span><span class="op" id="3127556">.</span><span class="ident" id="3127557">readFull</span><span class="op" id="3127565">(</span><span class="ident" id="3127566"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3127567">.</span><span class="ident" id="3127568">vals</span><span class="op" id="3127572">[</span><span class="op" id="3127573">:</span><span class="ident" id="3127574"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3127575">.</span><span class="ident" id="3127576">nCodes</span><span class="op" id="3127582">]</span><span class="op" id="3127583">)</span><span class="op" id="3127584">;</span>&nbsp;<span class="ident" id="3127586"><a href="/image/jpeg/huffman.go.html#3127548">err</a></span>&nbsp;<span class="op" id="3127590">!=</span>&nbsp;<span class="ident" id="3127593">nil</span>&nbsp;<span class="op" id="3127597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3127602">return</span>&nbsp;<span class="ident" id="3127609"><a href="/image/jpeg/huffman.go.html#3127548">err</a></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3127615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3127620">//&nbsp;Derive&nbsp;the&nbsp;look-up&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3127651">for</span>&nbsp;<span class="ident" id="3127655">i</span>&nbsp;<span class="op" id="3127657">:=</span>&nbsp;<span class="keyword" id="3127660">range</span>&nbsp;<span class="ident" id="3127666"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3127667">.</span><span class="ident" id="3127668">lut</span>&nbsp;<span class="op" id="3127672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127677"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3127678">.</span><span class="ident" id="3127679">lut</span><span class="op" id="3127682">[</span><span class="ident" id="3127683"><a href="/image/jpeg/huffman.go.html#3127655">i</a></span><span class="op" id="3127684">]</span>&nbsp;<span class="op" id="3127686">=</span>&nbsp;<span class="num" id="3127688">0</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3127692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3127696">var</span>&nbsp;<span class="ident" id="3127700">x</span><span class="op" id="3127701">,</span>&nbsp;<span class="ident" id="3127703">code</span>&nbsp;<span class="builtintype" id="3127708">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3127717">for</span>&nbsp;<span class="ident" id="3127721">i</span>&nbsp;<span class="op" id="3127723">:=</span>&nbsp;<span class="builtintype" id="3127726">uint32</span><span class="op" id="3127732">(</span><span class="num" id="3127733">0</span><span class="op" id="3127734">)</span><span class="op" id="3127735">;</span>&nbsp;<span class="ident" id="3127737"><a href="/image/jpeg/huffman.go.html#3127721">i</a></span>&nbsp;<span class="op" id="3127739">&lt;</span>&nbsp;<span class="ident" id="3127741"><a href="/image/jpeg/huffman.go.html#3124433">lutSize</a></span><span class="op" id="3127748">;</span>&nbsp;<span class="ident" id="3127750"><a href="/image/jpeg/huffman.go.html#3127721">i</a></span><span class="op" id="3127751">++</span>&nbsp;<span class="op" id="3127754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3127759"><a href="/image/jpeg/huffman.go.html#3127703">code</a></span>&nbsp;<span class="op" id="3127764">&lt;&lt;=</span>&nbsp;<span class="num" id="3127768">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3127773">for</span>&nbsp;<span class="ident" id="3127777">j</span>&nbsp;<span class="op" id="3127779">:=</span>&nbsp;<span class="builtintype" id="3127782">int32</span><span class="op" id="3127787">(</span><span class="num" id="3127788">0</span><span class="op" id="3127789">)</span><span class="op" id="3127790">;</span>&nbsp;<span class="ident" id="3127792"><a href="/image/jpeg/huffman.go.html#3127777">j</a></span>&nbsp;<span class="op" id="3127794">&lt;</span>&nbsp;<span class="ident" id="3127796"><a href="/image/jpeg/huffman.go.html#3127166">nCodes</a></span><span class="op" id="3127802">[</span><span class="ident" id="3127803"><a href="/image/jpeg/huffman.go.html#3127721">i</a></span><span class="op" id="3127804">]</span><span class="op" id="3127805">;</span>&nbsp;<span class="ident" id="3127807"><a href="/image/jpeg/huffman.go.html#3127777">j</a></span><span class="op" id="3127808">++</span>&nbsp;<span class="op" id="3127811">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3127817">//&nbsp;The&nbsp;codeLength&nbsp;is&nbsp;1+i,&nbsp;so&nbsp;shift&nbsp;code&nbsp;by&nbsp;8-(1+i)&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3127875">//&nbsp;calculate&nbsp;the&nbsp;high&nbsp;bits&nbsp;for&nbsp;every&nbsp;8-bit&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3127931">//&nbsp;whose&nbsp;codeLength&#39;s&nbsp;high&nbsp;bits&nbsp;matches&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3127981">//&nbsp;The&nbsp;high&nbsp;8&nbsp;bits&nbsp;of&nbsp;lutValue&nbsp;are&nbsp;the&nbsp;encoded&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3128039">//&nbsp;The&nbsp;low&nbsp;8&nbsp;bits&nbsp;are&nbsp;1&nbsp;plus&nbsp;the&nbsp;codeLength.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128088">base</span>&nbsp;<span class="op" id="3128093">:=</span>&nbsp;<span class="builtintype" id="3128096">uint8</span><span class="op" id="3128101">(</span><span class="ident" id="3128102"><a href="/image/jpeg/huffman.go.html#3127703">code</a></span>&nbsp;<span class="op" id="3128107">&lt;&lt;</span>&nbsp;<span class="op" id="3128110">(</span><span class="num" id="3128111">7</span>&nbsp;<span class="op" id="3128113">-</span>&nbsp;<span class="ident" id="3128115"><a href="/image/jpeg/huffman.go.html#3127721">i</a></span><span class="op" id="3128116">)</span><span class="op" id="3128117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128123">lutValue</span>&nbsp;<span class="op" id="3128132">:=</span>&nbsp;<span class="builtintype" id="3128135">uint16</span><span class="op" id="3128141">(</span><span class="ident" id="3128142"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3128143">.</span><span class="ident" id="3128144">vals</span><span class="op" id="3128148">[</span><span class="ident" id="3128149"><a href="/image/jpeg/huffman.go.html#3127700">x</a></span><span class="op" id="3128150">]</span><span class="op" id="3128151">)</span><span class="op" id="3128152">&lt;&lt;</span><span class="num" id="3128154">8</span>&nbsp;<span class="op" id="3128156">|</span>&nbsp;<span class="builtintype" id="3128158">uint16</span><span class="op" id="3128164">(</span><span class="num" id="3128165">2</span><span class="op" id="3128166">+</span><span class="ident" id="3128167"><a href="/image/jpeg/huffman.go.html#3127721">i</a></span><span class="op" id="3128168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3128174">for</span>&nbsp;<span class="ident" id="3128178">k</span>&nbsp;<span class="op" id="3128180">:=</span>&nbsp;<span class="builtintype" id="3128183">uint8</span><span class="op" id="3128188">(</span><span class="num" id="3128189">0</span><span class="op" id="3128190">)</span><span class="op" id="3128191">;</span>&nbsp;<span class="ident" id="3128193"><a href="/image/jpeg/huffman.go.html#3128178">k</a></span>&nbsp;<span class="op" id="3128195">&lt;</span>&nbsp;<span class="num" id="3128197">1</span><span class="op" id="3128198">&lt;&lt;</span><span class="op" id="3128200">(</span><span class="num" id="3128201">7</span><span class="op" id="3128202">-</span><span class="ident" id="3128203"><a href="/image/jpeg/huffman.go.html#3127721">i</a></span><span class="op" id="3128204">)</span><span class="op" id="3128205">;</span>&nbsp;<span class="ident" id="3128207"><a href="/image/jpeg/huffman.go.html#3128178">k</a></span><span class="op" id="3128208">++</span>&nbsp;<span class="op" id="3128211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128218"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3128219">.</span><span class="ident" id="3128220">lut</span><span class="op" id="3128223">[</span><span class="ident" id="3128224"><a href="/image/jpeg/huffman.go.html#3128088">base</a></span><span class="op" id="3128228">|</span><span class="ident" id="3128229"><a href="/image/jpeg/huffman.go.html#3128178">k</a></span><span class="op" id="3128230">]</span>&nbsp;<span class="op" id="3128232">=</span>&nbsp;<span class="ident" id="3128234"><a href="/image/jpeg/huffman.go.html#3128123">lutValue</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3128247">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128253"><a href="/image/jpeg/huffman.go.html#3127703">code</a></span><span class="op" id="3128257">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128264"><a href="/image/jpeg/huffman.go.html#3127700">x</a></span><span class="op" id="3128265">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3128271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3128275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3128280">//&nbsp;Derive&nbsp;minCodes,&nbsp;maxCodes,&nbsp;and&nbsp;valsIndices.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3128329">var</span>&nbsp;<span class="ident" id="3128333">c</span><span class="op" id="3128334">,</span>&nbsp;<span class="ident" id="3128336">index</span>&nbsp;<span class="builtintype" id="3128342">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3128350">for</span>&nbsp;<span class="ident" id="3128354">i</span><span class="op" id="3128355">,</span>&nbsp;<span class="ident" id="3128357">n</span>&nbsp;<span class="op" id="3128359">:=</span>&nbsp;<span class="keyword" id="3128362">range</span>&nbsp;<span class="ident" id="3128368"><a href="/image/jpeg/huffman.go.html#3127166">nCodes</a></span>&nbsp;<span class="op" id="3128375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3128380">if</span>&nbsp;<span class="ident" id="3128383"><a href="/image/jpeg/huffman.go.html#3128357">n</a></span>&nbsp;<span class="op" id="3128385">==</span>&nbsp;<span class="num" id="3128388">0</span>&nbsp;<span class="op" id="3128390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128396"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3128397">.</span><span class="ident" id="3128398">minCodes</span><span class="op" id="3128406">[</span><span class="ident" id="3128407"><a href="/image/jpeg/huffman.go.html#3128354">i</a></span><span class="op" id="3128408">]</span>&nbsp;<span class="op" id="3128410">=</span>&nbsp;<span class="op" id="3128412">-</span><span class="num" id="3128413">1</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128419"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3128420">.</span><span class="ident" id="3128421">maxCodes</span><span class="op" id="3128429">[</span><span class="ident" id="3128430"><a href="/image/jpeg/huffman.go.html#3128354">i</a></span><span class="op" id="3128431">]</span>&nbsp;<span class="op" id="3128433">=</span>&nbsp;<span class="op" id="3128435">-</span><span class="num" id="3128436">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128442"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3128443">.</span><span class="ident" id="3128444">valsIndices</span><span class="op" id="3128455">[</span><span class="ident" id="3128456"><a href="/image/jpeg/huffman.go.html#3128354">i</a></span><span class="op" id="3128457">]</span>&nbsp;<span class="op" id="3128459">=</span>&nbsp;<span class="op" id="3128461">-</span><span class="num" id="3128462">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3128467">}</span>&nbsp;<span class="keyword" id="3128469">else</span>&nbsp;<span class="op" id="3128474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128480"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3128481">.</span><span class="ident" id="3128482">minCodes</span><span class="op" id="3128490">[</span><span class="ident" id="3128491"><a href="/image/jpeg/huffman.go.html#3128354">i</a></span><span class="op" id="3128492">]</span>&nbsp;<span class="op" id="3128494">=</span>&nbsp;<span class="ident" id="3128496"><a href="/image/jpeg/huffman.go.html#3128333">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128502"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3128503">.</span><span class="ident" id="3128504">maxCodes</span><span class="op" id="3128512">[</span><span class="ident" id="3128513"><a href="/image/jpeg/huffman.go.html#3128354">i</a></span><span class="op" id="3128514">]</span>&nbsp;<span class="op" id="3128516">=</span>&nbsp;<span class="ident" id="3128518"><a href="/image/jpeg/huffman.go.html#3128333">c</a></span>&nbsp;<span class="op" id="3128520">+</span>&nbsp;<span class="ident" id="3128522"><a href="/image/jpeg/huffman.go.html#3128357">n</a></span>&nbsp;<span class="op" id="3128524">-</span>&nbsp;<span class="num" id="3128526">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128532"><a href="/image/jpeg/huffman.go.html#3126970">h</a></span><span class="op" id="3128533">.</span><span class="ident" id="3128534">valsIndices</span><span class="op" id="3128545">[</span><span class="ident" id="3128546"><a href="/image/jpeg/huffman.go.html#3128354">i</a></span><span class="op" id="3128547">]</span>&nbsp;<span class="op" id="3128549">=</span>&nbsp;<span class="ident" id="3128551"><a href="/image/jpeg/huffman.go.html#3128336">index</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128561"><a href="/image/jpeg/huffman.go.html#3128333">c</a></span>&nbsp;<span class="op" id="3128563">+=</span>&nbsp;<span class="ident" id="3128566"><a href="/image/jpeg/huffman.go.html#3128357">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128572"><a href="/image/jpeg/huffman.go.html#3128336">index</a></span>&nbsp;<span class="op" id="3128578">+=</span>&nbsp;<span class="ident" id="3128581"><a href="/image/jpeg/huffman.go.html#3128357">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3128586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3128591"><a href="/image/jpeg/huffman.go.html#3128333">c</a></span>&nbsp;<span class="op" id="3128593">&lt;&lt;=</span>&nbsp;<span class="num" id="3128597">1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3128601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3128604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3128607">return</span>&nbsp;<span class="ident" id="3128614">nil</span><br>
<span class="lineno"></span><span class="op" id="3128618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="3128621">//&nbsp;decodeHuffman&nbsp;returns&nbsp;the&nbsp;next&nbsp;Huffman-coded&nbsp;value&nbsp;from&nbsp;the&nbsp;bit-stream,</span><br>
<span class="lineno"></span><span class="comment" id="3128696">//&nbsp;decoded&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno"></span><span class="keyword" id="3128723">func</span>&nbsp;<span class="op" id="3128728">(</span><span class="ident" id="3128729">d</span>&nbsp;<span class="op" id="3128731">*</span><span class="ident" id="3128732"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3128739">)</span>&nbsp;<span class="ident" id="3128741">decodeHuffman</span><span class="op" id="3128754">(</span><span class="ident" id="3128755">h</span>&nbsp;<span class="op" id="3128757">*</span><span class="ident" id="3128758"><a href="/image/jpeg/huffman.go.html#3124508">huffman</a></span><span class="op" id="3128765">)</span>&nbsp;<span class="op" id="3128767">(</span><span class="builtintype" id="3128768">uint8</span><span class="op" id="3128773">,</span>&nbsp;<span class="builtintype" id="3128775">error</span><span class="op" id="3128780">)</span>&nbsp;<span class="op" id="3128782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3128785">if</span>&nbsp;<span class="ident" id="3128788"><a href="/image/jpeg/huffman.go.html#3128755">h</a></span><span class="op" id="3128789">.</span><span class="ident" id="3128790">nCodes</span>&nbsp;<span class="op" id="3128797">==</span>&nbsp;<span class="num" id="3128800">0</span>&nbsp;<span class="op" id="3128802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3128806">return</span>&nbsp;<span class="num" id="3128813">0</span><span class="op" id="3128814">,</span>&nbsp;<span class="ident" id="3128816"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3128827">(</span><span class="string" id="3128828">&#34;uninitialized&nbsp;Huffman&nbsp;table&#34;</span><span class="op" id="3128857">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3128860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3128864">if</span>&nbsp;<span class="ident" id="3128867"><a href="/image/jpeg/huffman.go.html#3128729">d</a></span><span class="op" id="3128868">.</span><span class="ident" id="3128869">bits</span><span class="op" id="3128873">.</span><span class="ident" id="3128874">n</span>&nbsp;<span class="op" id="3128876">&lt;</span>&nbsp;<span class="num" id="3128878">8</span>&nbsp;<span class="op" id="3128880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3128884">if</span>&nbsp;<span class="ident" id="3128887">err</span>&nbsp;<span class="op" id="3128891">:=</span>&nbsp;<span class="ident" id="3128894"><a href="/image/jpeg/huffman.go.html#3128729">d</a></span><span class="op" id="3128895">.</span><span class="ident" id="3128896">ensureNBits</span><span class="op" id="3128907">(</span><span class="num" id="3128908">8</span><span class="op" id="3128909">)</span><span class="op" id="3128910">;</span>&nbsp;<span class="ident" id="3128912"><a href="/image/jpeg/huffman.go.html#3128887">err</a></span>&nbsp;<span class="op" id="3128916">!=</span>&nbsp;<span class="ident" id="3128919">nil</span>&nbsp;<span class="op" id="3128923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3128928">if</span>&nbsp;<span class="ident" id="3128931"><a href="/image/jpeg/huffman.go.html#3128887">err</a></span>&nbsp;<span class="op" id="3128935">!=</span>&nbsp;<span class="ident" id="3128938"><a href="/image/jpeg/reader.go.html#3141315">errMissingFF00</a></span>&nbsp;<span class="op" id="3128953">&amp;&amp;</span>&nbsp;<span class="ident" id="3128956"><a href="/image/jpeg/huffman.go.html#3128887">err</a></span>&nbsp;<span class="op" id="3128960">!=</span>&nbsp;<span class="ident" id="3128963"><a href="/image/jpeg/huffman.go.html#3125379">errShortHuffmanData</a></span>&nbsp;<span class="op" id="3128983">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3128989">return</span>&nbsp;<span class="num" id="3128996">0</span><span class="op" id="3128997">,</span>&nbsp;<span class="ident" id="3128999"><a href="/image/jpeg/huffman.go.html#3128887">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3129011">//&nbsp;There&nbsp;are&nbsp;no&nbsp;more&nbsp;bytes&nbsp;of&nbsp;data&nbsp;in&nbsp;this&nbsp;segment,&nbsp;but&nbsp;we&nbsp;may&nbsp;still</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3129083">//&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;the&nbsp;next&nbsp;symbol&nbsp;out&nbsp;of&nbsp;the&nbsp;previously&nbsp;read&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3129154">//&nbsp;First,&nbsp;undo&nbsp;the&nbsp;readByte&nbsp;that&nbsp;the&nbsp;ensureNBits&nbsp;call&nbsp;made.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129217"><a href="/image/jpeg/huffman.go.html#3128729">d</a></span><span class="op" id="3129218">.</span><span class="ident" id="3129219">unreadByteStuffedByte</span><span class="op" id="3129240">(</span><span class="op" id="3129241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129246">goto</span>&nbsp;<span class="ident" id="3129251">slowPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129268">if</span>&nbsp;<span class="ident" id="3129271">v</span>&nbsp;<span class="op" id="3129273">:=</span>&nbsp;<span class="ident" id="3129276"><a href="/image/jpeg/huffman.go.html#3128755">h</a></span><span class="op" id="3129277">.</span><span class="ident" id="3129278">lut</span><span class="op" id="3129281">[</span><span class="op" id="3129282">(</span><span class="ident" id="3129283"><a href="/image/jpeg/huffman.go.html#3128729">d</a></span><span class="op" id="3129284">.</span><span class="ident" id="3129285">bits</span><span class="op" id="3129289">.</span><span class="ident" id="3129290">a</span><span class="op" id="3129291">&gt;&gt;</span><span class="builtintype" id="3129293">uint32</span><span class="op" id="3129299">(</span><span class="ident" id="3129300"><a href="/image/jpeg/huffman.go.html#3128729">d</a></span><span class="op" id="3129301">.</span><span class="ident" id="3129302">bits</span><span class="op" id="3129306">.</span><span class="ident" id="3129307">n</span><span class="op" id="3129308">-</span><span class="ident" id="3129309"><a href="/image/jpeg/huffman.go.html#3124433">lutSize</a></span><span class="op" id="3129316">)</span><span class="op" id="3129317">)</span><span class="op" id="3129318">&amp;</span><span class="num" id="3129319">0xff</span><span class="op" id="3129323">]</span><span class="op" id="3129324">;</span>&nbsp;<span class="ident" id="3129326"><a href="/image/jpeg/huffman.go.html#3129271">v</a></span>&nbsp;<span class="op" id="3129328">!=</span>&nbsp;<span class="num" id="3129331">0</span>&nbsp;<span class="op" id="3129333">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129337">n</span>&nbsp;<span class="op" id="3129339">:=</span>&nbsp;<span class="op" id="3129342">(</span><span class="ident" id="3129343"><a href="/image/jpeg/huffman.go.html#3129271">v</a></span>&nbsp;<span class="op" id="3129345">&amp;</span>&nbsp;<span class="num" id="3129347">0xff</span><span class="op" id="3129351">)</span>&nbsp;<span class="op" id="3129353">-</span>&nbsp;<span class="num" id="3129355">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129359"><a href="/image/jpeg/huffman.go.html#3128729">d</a></span><span class="op" id="3129360">.</span><span class="ident" id="3129361">bits</span><span class="op" id="3129365">.</span><span class="ident" id="3129366">n</span>&nbsp;<span class="op" id="3129368">-=</span>&nbsp;<span class="builtintype" id="3129371">int32</span><span class="op" id="3129376">(</span><span class="ident" id="3129377"><a href="/image/jpeg/huffman.go.html#3129337">n</a></span><span class="op" id="3129378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129382"><a href="/image/jpeg/huffman.go.html#3128729">d</a></span><span class="op" id="3129383">.</span><span class="ident" id="3129384">bits</span><span class="op" id="3129388">.</span><span class="ident" id="3129389">m</span>&nbsp;<span class="op" id="3129391">&gt;&gt;=</span>&nbsp;<span class="ident" id="3129395"><a href="/image/jpeg/huffman.go.html#3129337">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129399">return</span>&nbsp;<span class="builtintype" id="3129406">uint8</span><span class="op" id="3129411">(</span><span class="ident" id="3129412"><a href="/image/jpeg/huffman.go.html#3129271">v</a></span>&nbsp;<span class="op" id="3129414">&gt;&gt;</span>&nbsp;<span class="num" id="3129417">8</span><span class="op" id="3129418">)</span><span class="op" id="3129419">,</span>&nbsp;<span class="ident" id="3129421">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129426">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="ident" id="3129429">slowPath</span><span class="op" id="3129437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129440">for</span>&nbsp;<span class="ident" id="3129444">i</span><span class="op" id="3129445">,</span>&nbsp;<span class="ident" id="3129447">code</span>&nbsp;<span class="op" id="3129452">:=</span>&nbsp;<span class="num" id="3129455">0</span><span class="op" id="3129456">,</span>&nbsp;<span class="builtintype" id="3129458">int32</span><span class="op" id="3129463">(</span><span class="num" id="3129464">0</span><span class="op" id="3129465">)</span><span class="op" id="3129466">;</span>&nbsp;<span class="ident" id="3129468"><a href="/image/jpeg/huffman.go.html#3129444">i</a></span>&nbsp;<span class="op" id="3129470">&lt;</span>&nbsp;<span class="ident" id="3129472"><a href="/image/jpeg/huffman.go.html#3124240">maxCodeLength</a></span><span class="op" id="3129485">;</span>&nbsp;<span class="ident" id="3129487"><a href="/image/jpeg/huffman.go.html#3129444">i</a></span><span class="op" id="3129488">++</span>&nbsp;<span class="op" id="3129491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129495">if</span>&nbsp;<span class="ident" id="3129498"><a href="/image/jpeg/huffman.go.html#3128729">d</a></span><span class="op" id="3129499">.</span><span class="ident" id="3129500">bits</span><span class="op" id="3129504">.</span><span class="ident" id="3129505">n</span>&nbsp;<span class="op" id="3129507">==</span>&nbsp;<span class="num" id="3129510">0</span>&nbsp;<span class="op" id="3129512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129517">if</span>&nbsp;<span class="ident" id="3129520">err</span>&nbsp;<span class="op" id="3129524">:=</span>&nbsp;<span class="ident" id="3129527"><a href="/image/jpeg/huffman.go.html#3128729">d</a></span><span class="op" id="3129528">.</span><span class="ident" id="3129529">ensureNBits</span><span class="op" id="3129540">(</span><span class="num" id="3129541">1</span><span class="op" id="3129542">)</span><span class="op" id="3129543">;</span>&nbsp;<span class="ident" id="3129545"><a href="/image/jpeg/huffman.go.html#3129520">err</a></span>&nbsp;<span class="op" id="3129549">!=</span>&nbsp;<span class="ident" id="3129552">nil</span>&nbsp;<span class="op" id="3129556">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129562">return</span>&nbsp;<span class="num" id="3129569">0</span><span class="op" id="3129570">,</span>&nbsp;<span class="ident" id="3129572"><a href="/image/jpeg/huffman.go.html#3129520">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129587">if</span>&nbsp;<span class="ident" id="3129590"><a href="/image/jpeg/huffman.go.html#3128729">d</a></span><span class="op" id="3129591">.</span><span class="ident" id="3129592">bits</span><span class="op" id="3129596">.</span><span class="ident" id="3129597">a</span><span class="op" id="3129598">&amp;</span><span class="ident" id="3129599"><a href="/image/jpeg/huffman.go.html#3128729">d</a></span><span class="op" id="3129600">.</span><span class="ident" id="3129601">bits</span><span class="op" id="3129605">.</span><span class="ident" id="3129606">m</span>&nbsp;<span class="op" id="3129608">!=</span>&nbsp;<span class="num" id="3129611">0</span>&nbsp;<span class="op" id="3129613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129618"><a href="/image/jpeg/huffman.go.html#3129447">code</a></span>&nbsp;<span class="op" id="3129623">|=</span>&nbsp;<span class="num" id="3129626">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129634"><a href="/image/jpeg/huffman.go.html#3128729">d</a></span><span class="op" id="3129635">.</span><span class="ident" id="3129636">bits</span><span class="op" id="3129640">.</span><span class="ident" id="3129641">n</span><span class="op" id="3129642">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129647"><a href="/image/jpeg/huffman.go.html#3128729">d</a></span><span class="op" id="3129648">.</span><span class="ident" id="3129649">bits</span><span class="op" id="3129653">.</span><span class="ident" id="3129654">m</span>&nbsp;<span class="op" id="3129656">&gt;&gt;=</span>&nbsp;<span class="num" id="3129660">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129664">if</span>&nbsp;<span class="ident" id="3129667"><a href="/image/jpeg/huffman.go.html#3129447">code</a></span>&nbsp;<span class="op" id="3129672">&lt;=</span>&nbsp;<span class="ident" id="3129675"><a href="/image/jpeg/huffman.go.html#3128755">h</a></span><span class="op" id="3129676">.</span><span class="ident" id="3129677">maxCodes</span><span class="op" id="3129685">[</span><span class="ident" id="3129686"><a href="/image/jpeg/huffman.go.html#3129444">i</a></span><span class="op" id="3129687">]</span>&nbsp;<span class="op" id="3129689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129694">return</span>&nbsp;<span class="ident" id="3129701"><a href="/image/jpeg/huffman.go.html#3128755">h</a></span><span class="op" id="3129702">.</span><span class="ident" id="3129703">vals</span><span class="op" id="3129707">[</span><span class="ident" id="3129708"><a href="/image/jpeg/huffman.go.html#3128755">h</a></span><span class="op" id="3129709">.</span><span class="ident" id="3129710">valsIndices</span><span class="op" id="3129721">[</span><span class="ident" id="3129722"><a href="/image/jpeg/huffman.go.html#3129444">i</a></span><span class="op" id="3129723">]</span><span class="op" id="3129724">+</span><span class="ident" id="3129725"><a href="/image/jpeg/huffman.go.html#3129447">code</a></span><span class="op" id="3129729">-</span><span class="ident" id="3129730"><a href="/image/jpeg/huffman.go.html#3128755">h</a></span><span class="op" id="3129731">.</span><span class="ident" id="3129732">minCodes</span><span class="op" id="3129740">[</span><span class="ident" id="3129741"><a href="/image/jpeg/huffman.go.html#3129444">i</a></span><span class="op" id="3129742">]</span><span class="op" id="3129743">]</span><span class="op" id="3129744">,</span>&nbsp;<span class="ident" id="3129746">nil</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129756"><a href="/image/jpeg/huffman.go.html#3129447">code</a></span>&nbsp;<span class="op" id="3129761">&lt;&lt;=</span>&nbsp;<span class="num" id="3129765">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129771">return</span>&nbsp;<span class="num" id="3129778">0</span><span class="op" id="3129779">,</span>&nbsp;<span class="ident" id="3129781"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3129792">(</span><span class="string" id="3129793">&#34;bad&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="3129811">)</span><br>
<span class="lineno"></span><span class="op" id="3129813">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="3129816">func</span>&nbsp;<span class="op" id="3129821">(</span><span class="ident" id="3129822">d</span>&nbsp;<span class="op" id="3129824">*</span><span class="ident" id="3129825"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3129832">)</span>&nbsp;<span class="ident" id="3129834">decodeBit</span><span class="op" id="3129843">(</span><span class="op" id="3129844">)</span>&nbsp;<span class="op" id="3129846">(</span><span class="builtintype" id="3129847">bool</span><span class="op" id="3129851">,</span>&nbsp;<span class="builtintype" id="3129853">error</span><span class="op" id="3129858">)</span>&nbsp;<span class="op" id="3129860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129863">if</span>&nbsp;<span class="ident" id="3129866"><a href="/image/jpeg/huffman.go.html#3129822">d</a></span><span class="op" id="3129867">.</span><span class="ident" id="3129868">bits</span><span class="op" id="3129872">.</span><span class="ident" id="3129873">n</span>&nbsp;<span class="op" id="3129875">==</span>&nbsp;<span class="num" id="3129878">0</span>&nbsp;<span class="op" id="3129880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129884">if</span>&nbsp;<span class="ident" id="3129887">err</span>&nbsp;<span class="op" id="3129891">:=</span>&nbsp;<span class="ident" id="3129894"><a href="/image/jpeg/huffman.go.html#3129822">d</a></span><span class="op" id="3129895">.</span><span class="ident" id="3129896">ensureNBits</span><span class="op" id="3129907">(</span><span class="num" id="3129908">1</span><span class="op" id="3129909">)</span><span class="op" id="3129910">;</span>&nbsp;<span class="ident" id="3129912"><a href="/image/jpeg/huffman.go.html#3129887">err</a></span>&nbsp;<span class="op" id="3129916">!=</span>&nbsp;<span class="ident" id="3129919">nil</span>&nbsp;<span class="op" id="3129923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3129928">return</span>&nbsp;<span class="builtintype" id="3129935">false</span><span class="op" id="3129940">,</span>&nbsp;<span class="ident" id="3129942"><a href="/image/jpeg/huffman.go.html#3129887">err</a></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3129951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129954">ret</span>&nbsp;<span class="op" id="3129958">:=</span>&nbsp;<span class="ident" id="3129961"><a href="/image/jpeg/huffman.go.html#3129822">d</a></span><span class="op" id="3129962">.</span><span class="ident" id="3129963">bits</span><span class="op" id="3129967">.</span><span class="ident" id="3129968">a</span><span class="op" id="3129969">&amp;</span><span class="ident" id="3129970"><a href="/image/jpeg/huffman.go.html#3129822">d</a></span><span class="op" id="3129971">.</span><span class="ident" id="3129972">bits</span><span class="op" id="3129976">.</span><span class="ident" id="3129977">m</span>&nbsp;<span class="op" id="3129979">!=</span>&nbsp;<span class="num" id="3129982">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129985"><a href="/image/jpeg/huffman.go.html#3129822">d</a></span><span class="op" id="3129986">.</span><span class="ident" id="3129987">bits</span><span class="op" id="3129991">.</span><span class="ident" id="3129992">n</span><span class="op" id="3129993">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3129997"><a href="/image/jpeg/huffman.go.html#3129822">d</a></span><span class="op" id="3129998">.</span><span class="ident" id="3129999">bits</span><span class="op" id="3130003">.</span><span class="ident" id="3130004">m</span>&nbsp;<span class="op" id="3130006">&gt;&gt;=</span>&nbsp;<span class="num" id="3130010">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3130013">return</span>&nbsp;<span class="ident" id="3130020"><a href="/image/jpeg/huffman.go.html#3129954">ret</a></span><span class="op" id="3130023">,</span>&nbsp;<span class="ident" id="3130025">nil</span><br>
<span class="lineno"></span><span class="op" id="3130029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3130032">func</span>&nbsp;<span class="op" id="3130037">(</span><span class="ident" id="3130038">d</span>&nbsp;<span class="op" id="3130040">*</span><span class="ident" id="3130041"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3130048">)</span>&nbsp;<span class="ident" id="3130050">decodeBits</span><span class="op" id="3130060">(</span><span class="ident" id="3130061">n</span>&nbsp;<span class="builtintype" id="3130063">int32</span><span class="op" id="3130068">)</span>&nbsp;<span class="op" id="3130070">(</span><span class="builtintype" id="3130071">uint32</span><span class="op" id="3130077">,</span>&nbsp;<span class="builtintype" id="3130079">error</span><span class="op" id="3130084">)</span>&nbsp;<span class="op" id="3130086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3130089">if</span>&nbsp;<span class="ident" id="3130092"><a href="/image/jpeg/huffman.go.html#3130038">d</a></span><span class="op" id="3130093">.</span><span class="ident" id="3130094">bits</span><span class="op" id="3130098">.</span><span class="ident" id="3130099">n</span>&nbsp;<span class="op" id="3130101">&lt;</span>&nbsp;<span class="ident" id="3130103"><a href="/image/jpeg/huffman.go.html#3130061">n</a></span>&nbsp;<span class="op" id="3130105">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3130109">if</span>&nbsp;<span class="ident" id="3130112">err</span>&nbsp;<span class="op" id="3130116">:=</span>&nbsp;<span class="ident" id="3130119"><a href="/image/jpeg/huffman.go.html#3130038">d</a></span><span class="op" id="3130120">.</span><span class="ident" id="3130121">ensureNBits</span><span class="op" id="3130132">(</span><span class="ident" id="3130133"><a href="/image/jpeg/huffman.go.html#3130061">n</a></span><span class="op" id="3130134">)</span><span class="op" id="3130135">;</span>&nbsp;<span class="ident" id="3130137"><a href="/image/jpeg/huffman.go.html#3130112">err</a></span>&nbsp;<span class="op" id="3130141">!=</span>&nbsp;<span class="ident" id="3130144">nil</span>&nbsp;<span class="op" id="3130148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3130153">return</span>&nbsp;<span class="num" id="3130160">0</span><span class="op" id="3130161">,</span>&nbsp;<span class="ident" id="3130163"><a href="/image/jpeg/huffman.go.html#3130112">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3130169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3130172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3130175">ret</span>&nbsp;<span class="op" id="3130179">:=</span>&nbsp;<span class="ident" id="3130182"><a href="/image/jpeg/huffman.go.html#3130038">d</a></span><span class="op" id="3130183">.</span><span class="ident" id="3130184">bits</span><span class="op" id="3130188">.</span><span class="ident" id="3130189">a</span>&nbsp;<span class="op" id="3130191">&gt;&gt;</span>&nbsp;<span class="builtintype" id="3130194">uint32</span><span class="op" id="3130200">(</span><span class="ident" id="3130201"><a href="/image/jpeg/huffman.go.html#3130038">d</a></span><span class="op" id="3130202">.</span><span class="ident" id="3130203">bits</span><span class="op" id="3130207">.</span><span class="ident" id="3130208">n</span><span class="op" id="3130209">-</span><span class="ident" id="3130210"><a href="/image/jpeg/huffman.go.html#3130061">n</a></span><span class="op" id="3130211">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3130214"><a href="/image/jpeg/huffman.go.html#3130175">ret</a></span>&nbsp;<span class="op" id="3130218">&amp;=</span>&nbsp;<span class="op" id="3130221">(</span><span class="num" id="3130222">1</span>&nbsp;<span class="op" id="3130224">&lt;&lt;</span>&nbsp;<span class="builtintype" id="3130227">uint32</span><span class="op" id="3130233">(</span><span class="ident" id="3130234"><a href="/image/jpeg/huffman.go.html#3130061">n</a></span><span class="op" id="3130235">)</span><span class="op" id="3130236">)</span>&nbsp;<span class="op" id="3130238">-</span>&nbsp;<span class="num" id="3130240">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3130243"><a href="/image/jpeg/huffman.go.html#3130038">d</a></span><span class="op" id="3130244">.</span><span class="ident" id="3130245">bits</span><span class="op" id="3130249">.</span><span class="ident" id="3130250">n</span>&nbsp;<span class="op" id="3130252">-=</span>&nbsp;<span class="ident" id="3130255"><a href="/image/jpeg/huffman.go.html#3130061">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3130258"><a href="/image/jpeg/huffman.go.html#3130038">d</a></span><span class="op" id="3130259">.</span><span class="ident" id="3130260">bits</span><span class="op" id="3130264">.</span><span class="ident" id="3130265">m</span>&nbsp;<span class="op" id="3130267">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="3130271">uint32</span><span class="op" id="3130277">(</span><span class="ident" id="3130278"><a href="/image/jpeg/huffman.go.html#3130061">n</a></span><span class="op" id="3130279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3130282">return</span>&nbsp;<span class="ident" id="3130289"><a href="/image/jpeg/huffman.go.html#3130175">ret</a></span><span class="op" id="3130292">,</span>&nbsp;<span class="ident" id="3130294">nil</span><br>
<span class="lineno"></span><span class="op" id="3130298">}</span>
</div>
</body>
</html>
