<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6444466">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6444521">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6444575">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6444626">//&nbsp;Tests&nbsp;for&nbsp;CGI&nbsp;(the&nbsp;child&nbsp;process&nbsp;perspective)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6444676">package</span>&nbsp;<span class="ident" id="6444684">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6444689">import</span>&nbsp;<span class="op" id="6444696">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6444699">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6444709">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6444712">func</span>&nbsp;<span class="ident" id="6444717">TestRequest</span><span class="op" id="6444728">(</span><span class="ident" id="6444729">t</span>&nbsp;<span class="op" id="6444731">*</span><span class="ident" id="6444732">testing</span><span class="op" id="6444739">.</span><span class="ident" id="6444740">T</span><span class="op" id="6444741">)</span>&nbsp;<span class="op" id="6444743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444746">env</span>&nbsp;<span class="op" id="6444750">:=</span>&nbsp;<span class="keyword" id="6444753">map</span><span class="op" id="6444756">[</span><span class="builtintype" id="6444757">string</span><span class="op" id="6444763">]</span><span class="builtintype" id="6444764">string</span><span class="op" id="6444770">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6444774">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6444791">:</span>&nbsp;<span class="string" id="6444793">&#34;HTTP/1.1&#34;</span><span class="op" id="6444803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6444807">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6444823">:</span>&nbsp;&nbsp;<span class="string" id="6444826">&#34;GET&#34;</span><span class="op" id="6444831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6444835">&#34;HTTP_HOST&#34;</span><span class="op" id="6444846">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6444854">&#34;example.com&#34;</span><span class="op" id="6444867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6444871">&#34;HTTP_REFERER&#34;</span><span class="op" id="6444885">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6444890">&#34;elsewhere&#34;</span><span class="op" id="6444901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6444905">&#34;HTTP_USER_AGENT&#34;</span><span class="op" id="6444922">:</span>&nbsp;<span class="string" id="6444924">&#34;goclient&#34;</span><span class="op" id="6444934">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6444938">&#34;HTTP_FOO_BAR&#34;</span><span class="op" id="6444952">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6444957">&#34;baz&#34;</span><span class="op" id="6444962">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6444966">&#34;REQUEST_URI&#34;</span><span class="op" id="6444979">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6444985">&#34;/path?a=b&#34;</span><span class="op" id="6444996">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6445000">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6445016">:</span>&nbsp;&nbsp;<span class="string" id="6445019">&#34;123&#34;</span><span class="op" id="6445024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6445028">&#34;CONTENT_TYPE&#34;</span><span class="op" id="6445042">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6445047">&#34;text/xml&#34;</span><span class="op" id="6445057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6445061">&#34;REMOTE_ADDR&#34;</span><span class="op" id="6445074">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6445080">&#34;5.6.7.8&#34;</span><span class="op" id="6445089">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445095">req</span><span class="op" id="6445098">,</span>&nbsp;<span class="ident" id="6445100">err</span>&nbsp;<span class="op" id="6445104">:=</span>&nbsp;<span class="ident" id="6445107">RequestFromMap</span><span class="op" id="6445121">(</span><span class="ident" id="6445122">env</span><span class="op" id="6445125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445128">if</span>&nbsp;<span class="ident" id="6445131">err</span>&nbsp;<span class="op" id="6445135">!=</span>&nbsp;<span class="ident" id="6445138">nil</span>&nbsp;<span class="op" id="6445142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445146">t</span><span class="op" id="6445147">.</span><span class="ident" id="6445148">Fatalf</span><span class="op" id="6445154">(</span><span class="string" id="6445155">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6445175">,</span>&nbsp;<span class="ident" id="6445177">err</span><span class="op" id="6445180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445183">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445186">if</span>&nbsp;<span class="ident" id="6445189">g</span><span class="op" id="6445190">,</span>&nbsp;<span class="ident" id="6445192">e</span>&nbsp;<span class="op" id="6445194">:=</span>&nbsp;<span class="ident" id="6445197">req</span><span class="op" id="6445200">.</span><span class="ident" id="6445201">UserAgent</span><span class="op" id="6445210">(</span><span class="op" id="6445211">)</span><span class="op" id="6445212">,</span>&nbsp;<span class="string" id="6445214">&#34;goclient&#34;</span><span class="op" id="6445224">;</span>&nbsp;<span class="ident" id="6445226">e</span>&nbsp;<span class="op" id="6445228">!=</span>&nbsp;<span class="ident" id="6445231">g</span>&nbsp;<span class="op" id="6445233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445237">t</span><span class="op" id="6445238">.</span><span class="ident" id="6445239">Errorf</span><span class="op" id="6445245">(</span><span class="string" id="6445246">&#34;expected&nbsp;UserAgent&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6445277">,</span>&nbsp;<span class="ident" id="6445279">e</span><span class="op" id="6445280">,</span>&nbsp;<span class="ident" id="6445282">g</span><span class="op" id="6445283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445289">if</span>&nbsp;<span class="ident" id="6445292">g</span><span class="op" id="6445293">,</span>&nbsp;<span class="ident" id="6445295">e</span>&nbsp;<span class="op" id="6445297">:=</span>&nbsp;<span class="ident" id="6445300">req</span><span class="op" id="6445303">.</span><span class="ident" id="6445304">Method</span><span class="op" id="6445310">,</span>&nbsp;<span class="string" id="6445312">&#34;GET&#34;</span><span class="op" id="6445317">;</span>&nbsp;<span class="ident" id="6445319">e</span>&nbsp;<span class="op" id="6445321">!=</span>&nbsp;<span class="ident" id="6445324">g</span>&nbsp;<span class="op" id="6445326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445330">t</span><span class="op" id="6445331">.</span><span class="ident" id="6445332">Errorf</span><span class="op" id="6445338">(</span><span class="string" id="6445339">&#34;expected&nbsp;Method&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6445367">,</span>&nbsp;<span class="ident" id="6445369">e</span><span class="op" id="6445370">,</span>&nbsp;<span class="ident" id="6445372">g</span><span class="op" id="6445373">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445379">if</span>&nbsp;<span class="ident" id="6445382">g</span><span class="op" id="6445383">,</span>&nbsp;<span class="ident" id="6445385">e</span>&nbsp;<span class="op" id="6445387">:=</span>&nbsp;<span class="ident" id="6445390">req</span><span class="op" id="6445393">.</span><span class="ident" id="6445394">Header</span><span class="op" id="6445400">.</span><span class="ident" id="6445401">Get</span><span class="op" id="6445404">(</span><span class="string" id="6445405">&#34;Content-Type&#34;</span><span class="op" id="6445419">)</span><span class="op" id="6445420">,</span>&nbsp;<span class="string" id="6445422">&#34;text/xml&#34;</span><span class="op" id="6445432">;</span>&nbsp;<span class="ident" id="6445434">e</span>&nbsp;<span class="op" id="6445436">!=</span>&nbsp;<span class="ident" id="6445439">g</span>&nbsp;<span class="op" id="6445441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445445">t</span><span class="op" id="6445446">.</span><span class="ident" id="6445447">Errorf</span><span class="op" id="6445453">(</span><span class="string" id="6445454">&#34;expected&nbsp;Content-Type&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6445488">,</span>&nbsp;<span class="ident" id="6445490">e</span><span class="op" id="6445491">,</span>&nbsp;<span class="ident" id="6445493">g</span><span class="op" id="6445494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445500">if</span>&nbsp;<span class="ident" id="6445503">g</span><span class="op" id="6445504">,</span>&nbsp;<span class="ident" id="6445506">e</span>&nbsp;<span class="op" id="6445508">:=</span>&nbsp;<span class="ident" id="6445511">req</span><span class="op" id="6445514">.</span><span class="ident" id="6445515">ContentLength</span><span class="op" id="6445528">,</span>&nbsp;<span class="ident" id="6445530">int64</span><span class="op" id="6445535">(</span><span class="num" id="6445536">123</span><span class="op" id="6445539">)</span><span class="op" id="6445540">;</span>&nbsp;<span class="ident" id="6445542">e</span>&nbsp;<span class="op" id="6445544">!=</span>&nbsp;<span class="ident" id="6445547">g</span>&nbsp;<span class="op" id="6445549">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445553">t</span><span class="op" id="6445554">.</span><span class="ident" id="6445555">Errorf</span><span class="op" id="6445561">(</span><span class="string" id="6445562">&#34;expected&nbsp;ContentLength&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6445597">,</span>&nbsp;<span class="ident" id="6445599">e</span><span class="op" id="6445600">,</span>&nbsp;<span class="ident" id="6445602">g</span><span class="op" id="6445603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445609">if</span>&nbsp;<span class="ident" id="6445612">g</span><span class="op" id="6445613">,</span>&nbsp;<span class="ident" id="6445615">e</span>&nbsp;<span class="op" id="6445617">:=</span>&nbsp;<span class="ident" id="6445620">req</span><span class="op" id="6445623">.</span><span class="ident" id="6445624">Referer</span><span class="op" id="6445631">(</span><span class="op" id="6445632">)</span><span class="op" id="6445633">,</span>&nbsp;<span class="string" id="6445635">&#34;elsewhere&#34;</span><span class="op" id="6445646">;</span>&nbsp;<span class="ident" id="6445648">e</span>&nbsp;<span class="op" id="6445650">!=</span>&nbsp;<span class="ident" id="6445653">g</span>&nbsp;<span class="op" id="6445655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445659">t</span><span class="op" id="6445660">.</span><span class="ident" id="6445661">Errorf</span><span class="op" id="6445667">(</span><span class="string" id="6445668">&#34;expected&nbsp;Referer&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6445697">,</span>&nbsp;<span class="ident" id="6445699">e</span><span class="op" id="6445700">,</span>&nbsp;<span class="ident" id="6445702">g</span><span class="op" id="6445703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445706">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445709">if</span>&nbsp;<span class="ident" id="6445712">req</span><span class="op" id="6445715">.</span><span class="ident" id="6445716">Header</span>&nbsp;<span class="op" id="6445723">==</span>&nbsp;<span class="ident" id="6445726">nil</span>&nbsp;<span class="op" id="6445730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445734">t</span><span class="op" id="6445735">.</span><span class="ident" id="6445736">Fatalf</span><span class="op" id="6445742">(</span><span class="string" id="6445743">&#34;unexpected&nbsp;nil&nbsp;Header&#34;</span><span class="op" id="6445766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445772">if</span>&nbsp;<span class="ident" id="6445775">g</span><span class="op" id="6445776">,</span>&nbsp;<span class="ident" id="6445778">e</span>&nbsp;<span class="op" id="6445780">:=</span>&nbsp;<span class="ident" id="6445783">req</span><span class="op" id="6445786">.</span><span class="ident" id="6445787">Header</span><span class="op" id="6445793">.</span><span class="ident" id="6445794">Get</span><span class="op" id="6445797">(</span><span class="string" id="6445798">&#34;Foo-Bar&#34;</span><span class="op" id="6445807">)</span><span class="op" id="6445808">,</span>&nbsp;<span class="string" id="6445810">&#34;baz&#34;</span><span class="op" id="6445815">;</span>&nbsp;<span class="ident" id="6445817">e</span>&nbsp;<span class="op" id="6445819">!=</span>&nbsp;<span class="ident" id="6445822">g</span>&nbsp;<span class="op" id="6445824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445828">t</span><span class="op" id="6445829">.</span><span class="ident" id="6445830">Errorf</span><span class="op" id="6445836">(</span><span class="string" id="6445837">&#34;expected&nbsp;Foo-Bar&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6445866">,</span>&nbsp;<span class="ident" id="6445868">e</span><span class="op" id="6445869">,</span>&nbsp;<span class="ident" id="6445871">g</span><span class="op" id="6445872">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445878">if</span>&nbsp;<span class="ident" id="6445881">g</span><span class="op" id="6445882">,</span>&nbsp;<span class="ident" id="6445884">e</span>&nbsp;<span class="op" id="6445886">:=</span>&nbsp;<span class="ident" id="6445889">req</span><span class="op" id="6445892">.</span><span class="ident" id="6445893">URL</span><span class="op" id="6445896">.</span><span class="ident" id="6445897">String</span><span class="op" id="6445903">(</span><span class="op" id="6445904">)</span><span class="op" id="6445905">,</span>&nbsp;<span class="string" id="6445907">&#34;http://example.com/path?a=b&#34;</span><span class="op" id="6445936">;</span>&nbsp;<span class="ident" id="6445938">e</span>&nbsp;<span class="op" id="6445940">!=</span>&nbsp;<span class="ident" id="6445943">g</span>&nbsp;<span class="op" id="6445945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445949">t</span><span class="op" id="6445950">.</span><span class="ident" id="6445951">Errorf</span><span class="op" id="6445957">(</span><span class="string" id="6445958">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6445983">,</span>&nbsp;<span class="ident" id="6445985">e</span><span class="op" id="6445986">,</span>&nbsp;<span class="ident" id="6445988">g</span><span class="op" id="6445989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445995">if</span>&nbsp;<span class="ident" id="6445998">g</span><span class="op" id="6445999">,</span>&nbsp;<span class="ident" id="6446001">e</span>&nbsp;<span class="op" id="6446003">:=</span>&nbsp;<span class="ident" id="6446006">req</span><span class="op" id="6446009">.</span><span class="ident" id="6446010">FormValue</span><span class="op" id="6446019">(</span><span class="string" id="6446020">&#34;a&#34;</span><span class="op" id="6446023">)</span><span class="op" id="6446024">,</span>&nbsp;<span class="string" id="6446026">&#34;b&#34;</span><span class="op" id="6446029">;</span>&nbsp;<span class="ident" id="6446031">e</span>&nbsp;<span class="op" id="6446033">!=</span>&nbsp;<span class="ident" id="6446036">g</span>&nbsp;<span class="op" id="6446038">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446042">t</span><span class="op" id="6446043">.</span><span class="ident" id="6446044">Errorf</span><span class="op" id="6446050">(</span><span class="string" id="6446051">&#34;expected&nbsp;FormValue(a)&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6446085">,</span>&nbsp;<span class="ident" id="6446087">e</span><span class="op" id="6446088">,</span>&nbsp;<span class="ident" id="6446090">g</span><span class="op" id="6446091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6446094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6446097">if</span>&nbsp;<span class="ident" id="6446100">req</span><span class="op" id="6446103">.</span><span class="ident" id="6446104">Trailer</span>&nbsp;<span class="op" id="6446112">==</span>&nbsp;<span class="ident" id="6446115">nil</span>&nbsp;<span class="op" id="6446119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446123">t</span><span class="op" id="6446124">.</span><span class="ident" id="6446125">Errorf</span><span class="op" id="6446131">(</span><span class="string" id="6446132">&#34;unexpected&nbsp;nil&nbsp;Trailer&#34;</span><span class="op" id="6446156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6446159">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6446162">if</span>&nbsp;<span class="ident" id="6446165">req</span><span class="op" id="6446168">.</span><span class="ident" id="6446169">TLS</span>&nbsp;<span class="op" id="6446173">!=</span>&nbsp;<span class="ident" id="6446176">nil</span>&nbsp;<span class="op" id="6446180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446184">t</span><span class="op" id="6446185">.</span><span class="ident" id="6446186">Errorf</span><span class="op" id="6446192">(</span><span class="string" id="6446193">&#34;expected&nbsp;nil&nbsp;TLS&#34;</span><span class="op" id="6446211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6446214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6446217">if</span>&nbsp;<span class="ident" id="6446220">e</span><span class="op" id="6446221">,</span>&nbsp;<span class="ident" id="6446223">g</span>&nbsp;<span class="op" id="6446225">:=</span>&nbsp;<span class="string" id="6446228">&#34;5.6.7.8:0&#34;</span><span class="op" id="6446239">,</span>&nbsp;<span class="ident" id="6446241">req</span><span class="op" id="6446244">.</span><span class="ident" id="6446245">RemoteAddr</span><span class="op" id="6446255">;</span>&nbsp;<span class="ident" id="6446257">e</span>&nbsp;<span class="op" id="6446259">!=</span>&nbsp;<span class="ident" id="6446262">g</span>&nbsp;<span class="op" id="6446264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446268">t</span><span class="op" id="6446269">.</span><span class="ident" id="6446270">Errorf</span><span class="op" id="6446276">(</span><span class="string" id="6446277">&#34;RemoteAddr:&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6446306">,</span>&nbsp;<span class="ident" id="6446308">g</span><span class="op" id="6446309">,</span>&nbsp;<span class="ident" id="6446311">e</span><span class="op" id="6446312">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6446315">}</span><br>
<span class="lineno"></span><span class="op" id="6446317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6446320">func</span>&nbsp;<span class="ident" id="6446325">TestRequestWithTLS</span><span class="op" id="6446343">(</span><span class="ident" id="6446344">t</span>&nbsp;<span class="op" id="6446346">*</span><span class="ident" id="6446347">testing</span><span class="op" id="6446354">.</span><span class="ident" id="6446355">T</span><span class="op" id="6446356">)</span>&nbsp;<span class="op" id="6446358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446361">env</span>&nbsp;<span class="op" id="6446365">:=</span>&nbsp;<span class="keyword" id="6446368">map</span><span class="op" id="6446371">[</span><span class="builtintype" id="6446372">string</span><span class="op" id="6446378">]</span><span class="builtintype" id="6446379">string</span><span class="op" id="6446385">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6446389">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6446406">:</span>&nbsp;<span class="string" id="6446408">&#34;HTTP/1.1&#34;</span><span class="op" id="6446418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6446422">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6446438">:</span>&nbsp;&nbsp;<span class="string" id="6446441">&#34;GET&#34;</span><span class="op" id="6446446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6446450">&#34;HTTP_HOST&#34;</span><span class="op" id="6446461">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6446469">&#34;example.com&#34;</span><span class="op" id="6446482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6446486">&#34;HTTP_REFERER&#34;</span><span class="op" id="6446500">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6446505">&#34;elsewhere&#34;</span><span class="op" id="6446516">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6446520">&#34;REQUEST_URI&#34;</span><span class="op" id="6446533">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6446539">&#34;/path?a=b&#34;</span><span class="op" id="6446550">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6446554">&#34;CONTENT_TYPE&#34;</span><span class="op" id="6446568">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6446573">&#34;text/xml&#34;</span><span class="op" id="6446583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6446587">&#34;HTTPS&#34;</span><span class="op" id="6446594">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6446606">&#34;1&#34;</span><span class="op" id="6446609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6446613">&#34;REMOTE_ADDR&#34;</span><span class="op" id="6446626">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6446632">&#34;5.6.7.8&#34;</span><span class="op" id="6446641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6446644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446647">req</span><span class="op" id="6446650">,</span>&nbsp;<span class="ident" id="6446652">err</span>&nbsp;<span class="op" id="6446656">:=</span>&nbsp;<span class="ident" id="6446659">RequestFromMap</span><span class="op" id="6446673">(</span><span class="ident" id="6446674">env</span><span class="op" id="6446677">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6446680">if</span>&nbsp;<span class="ident" id="6446683">err</span>&nbsp;<span class="op" id="6446687">!=</span>&nbsp;<span class="ident" id="6446690">nil</span>&nbsp;<span class="op" id="6446694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446698">t</span><span class="op" id="6446699">.</span><span class="ident" id="6446700">Fatalf</span><span class="op" id="6446706">(</span><span class="string" id="6446707">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6446727">,</span>&nbsp;<span class="ident" id="6446729">err</span><span class="op" id="6446732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6446735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6446738">if</span>&nbsp;<span class="ident" id="6446741">g</span><span class="op" id="6446742">,</span>&nbsp;<span class="ident" id="6446744">e</span>&nbsp;<span class="op" id="6446746">:=</span>&nbsp;<span class="ident" id="6446749">req</span><span class="op" id="6446752">.</span><span class="ident" id="6446753">URL</span><span class="op" id="6446756">.</span><span class="ident" id="6446757">String</span><span class="op" id="6446763">(</span><span class="op" id="6446764">)</span><span class="op" id="6446765">,</span>&nbsp;<span class="string" id="6446767">&#34;https://example.com/path?a=b&#34;</span><span class="op" id="6446797">;</span>&nbsp;<span class="ident" id="6446799">e</span>&nbsp;<span class="op" id="6446801">!=</span>&nbsp;<span class="ident" id="6446804">g</span>&nbsp;<span class="op" id="6446806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446810">t</span><span class="op" id="6446811">.</span><span class="ident" id="6446812">Errorf</span><span class="op" id="6446818">(</span><span class="string" id="6446819">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6446844">,</span>&nbsp;<span class="ident" id="6446846">e</span><span class="op" id="6446847">,</span>&nbsp;<span class="ident" id="6446849">g</span><span class="op" id="6446850">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6446853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6446856">if</span>&nbsp;<span class="ident" id="6446859">req</span><span class="op" id="6446862">.</span><span class="ident" id="6446863">TLS</span>&nbsp;<span class="op" id="6446867">==</span>&nbsp;<span class="ident" id="6446870">nil</span>&nbsp;<span class="op" id="6446874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446878">t</span><span class="op" id="6446879">.</span><span class="ident" id="6446880">Errorf</span><span class="op" id="6446886">(</span><span class="string" id="6446887">&#34;expected&nbsp;non-nil&nbsp;TLS&#34;</span><span class="op" id="6446909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6446912">}</span><br>
<span class="lineno"></span><span class="op" id="6446914">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="6446917">func</span>&nbsp;<span class="ident" id="6446922">TestRequestWithoutHost</span><span class="op" id="6446944">(</span><span class="ident" id="6446945">t</span>&nbsp;<span class="op" id="6446947">*</span><span class="ident" id="6446948">testing</span><span class="op" id="6446955">.</span><span class="ident" id="6446956">T</span><span class="op" id="6446957">)</span>&nbsp;<span class="op" id="6446959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446962">env</span>&nbsp;<span class="op" id="6446966">:=</span>&nbsp;<span class="keyword" id="6446969">map</span><span class="op" id="6446972">[</span><span class="builtintype" id="6446973">string</span><span class="op" id="6446979">]</span><span class="builtintype" id="6446980">string</span><span class="op" id="6446986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6446990">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6447007">:</span>&nbsp;<span class="string" id="6447009">&#34;HTTP/1.1&#34;</span><span class="op" id="6447019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6447023">&#34;HTTP_HOST&#34;</span><span class="op" id="6447034">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6447042">&#34;&#34;</span><span class="op" id="6447044">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6447048">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6447064">:</span>&nbsp;&nbsp;<span class="string" id="6447067">&#34;GET&#34;</span><span class="op" id="6447072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6447076">&#34;REQUEST_URI&#34;</span><span class="op" id="6447089">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6447095">&#34;/path?a=b&#34;</span><span class="op" id="6447106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6447110">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6447126">:</span>&nbsp;&nbsp;<span class="string" id="6447129">&#34;123&#34;</span><span class="op" id="6447134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6447137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447140">req</span><span class="op" id="6447143">,</span>&nbsp;<span class="ident" id="6447145">err</span>&nbsp;<span class="op" id="6447149">:=</span>&nbsp;<span class="ident" id="6447152">RequestFromMap</span><span class="op" id="6447166">(</span><span class="ident" id="6447167">env</span><span class="op" id="6447170">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6447173">if</span>&nbsp;<span class="ident" id="6447176">err</span>&nbsp;<span class="op" id="6447180">!=</span>&nbsp;<span class="ident" id="6447183">nil</span>&nbsp;<span class="op" id="6447187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447191">t</span><span class="op" id="6447192">.</span><span class="ident" id="6447193">Fatalf</span><span class="op" id="6447199">(</span><span class="string" id="6447200">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6447220">,</span>&nbsp;<span class="ident" id="6447222">err</span><span class="op" id="6447225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6447228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6447231">if</span>&nbsp;<span class="ident" id="6447234">req</span><span class="op" id="6447237">.</span><span class="ident" id="6447238">URL</span>&nbsp;<span class="op" id="6447242">==</span>&nbsp;<span class="ident" id="6447245">nil</span>&nbsp;<span class="op" id="6447249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447253">t</span><span class="op" id="6447254">.</span><span class="ident" id="6447255">Fatalf</span><span class="op" id="6447261">(</span><span class="string" id="6447262">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="6447282">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6447285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6447288">if</span>&nbsp;<span class="ident" id="6447291">g</span><span class="op" id="6447292">,</span>&nbsp;<span class="ident" id="6447294">e</span>&nbsp;<span class="op" id="6447296">:=</span>&nbsp;<span class="ident" id="6447299">req</span><span class="op" id="6447302">.</span><span class="ident" id="6447303">URL</span><span class="op" id="6447306">.</span><span class="ident" id="6447307">String</span><span class="op" id="6447313">(</span><span class="op" id="6447314">)</span><span class="op" id="6447315">,</span>&nbsp;<span class="string" id="6447317">&#34;/path?a=b&#34;</span><span class="op" id="6447328">;</span>&nbsp;<span class="ident" id="6447330">e</span>&nbsp;<span class="op" id="6447332">!=</span>&nbsp;<span class="ident" id="6447335">g</span>&nbsp;<span class="op" id="6447337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447341">t</span><span class="op" id="6447342">.</span><span class="ident" id="6447343">Errorf</span><span class="op" id="6447349">(</span><span class="string" id="6447350">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6447369">,</span>&nbsp;<span class="ident" id="6447371">g</span><span class="op" id="6447372">,</span>&nbsp;<span class="ident" id="6447374">e</span><span class="op" id="6447375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6447378">}</span><br>
<span class="lineno"></span><span class="op" id="6447380">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="6447383">func</span>&nbsp;<span class="ident" id="6447388">TestRequestWithoutRequestURI</span><span class="op" id="6447416">(</span><span class="ident" id="6447417">t</span>&nbsp;<span class="op" id="6447419">*</span><span class="ident" id="6447420">testing</span><span class="op" id="6447427">.</span><span class="ident" id="6447428">T</span><span class="op" id="6447429">)</span>&nbsp;<span class="op" id="6447431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447434">env</span>&nbsp;<span class="op" id="6447438">:=</span>&nbsp;<span class="keyword" id="6447441">map</span><span class="op" id="6447444">[</span><span class="builtintype" id="6447445">string</span><span class="op" id="6447451">]</span><span class="builtintype" id="6447452">string</span><span class="op" id="6447458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6447462">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6447479">:</span>&nbsp;<span class="string" id="6447481">&#34;HTTP/1.1&#34;</span><span class="op" id="6447491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6447495">&#34;HTTP_HOST&#34;</span><span class="op" id="6447506">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6447514">&#34;example.com&#34;</span><span class="op" id="6447527">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6447531">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6447547">:</span>&nbsp;&nbsp;<span class="string" id="6447550">&#34;GET&#34;</span><span class="op" id="6447555">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6447559">&#34;SCRIPT_NAME&#34;</span><span class="op" id="6447572">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6447578">&#34;/dir/scriptname&#34;</span><span class="op" id="6447595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6447599">&#34;PATH_INFO&#34;</span><span class="op" id="6447610">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6447618">&#34;/p1/p2&#34;</span><span class="op" id="6447626">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6447630">&#34;QUERY_STRING&#34;</span><span class="op" id="6447644">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6447649">&#34;a=1&amp;b=2&#34;</span><span class="op" id="6447658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6447662">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6447678">:</span>&nbsp;&nbsp;<span class="string" id="6447681">&#34;123&#34;</span><span class="op" id="6447686">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6447689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447692">req</span><span class="op" id="6447695">,</span>&nbsp;<span class="ident" id="6447697">err</span>&nbsp;<span class="op" id="6447701">:=</span>&nbsp;<span class="ident" id="6447704">RequestFromMap</span><span class="op" id="6447718">(</span><span class="ident" id="6447719">env</span><span class="op" id="6447722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6447725">if</span>&nbsp;<span class="ident" id="6447728">err</span>&nbsp;<span class="op" id="6447732">!=</span>&nbsp;<span class="ident" id="6447735">nil</span>&nbsp;<span class="op" id="6447739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447743">t</span><span class="op" id="6447744">.</span><span class="ident" id="6447745">Fatalf</span><span class="op" id="6447751">(</span><span class="string" id="6447752">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6447772">,</span>&nbsp;<span class="ident" id="6447774">err</span><span class="op" id="6447777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6447780">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6447783">if</span>&nbsp;<span class="ident" id="6447786">req</span><span class="op" id="6447789">.</span><span class="ident" id="6447790">URL</span>&nbsp;<span class="op" id="6447794">==</span>&nbsp;<span class="ident" id="6447797">nil</span>&nbsp;<span class="op" id="6447801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447805">t</span><span class="op" id="6447806">.</span><span class="ident" id="6447807">Fatalf</span><span class="op" id="6447813">(</span><span class="string" id="6447814">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="6447834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6447837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6447840">if</span>&nbsp;<span class="ident" id="6447843">g</span><span class="op" id="6447844">,</span>&nbsp;<span class="ident" id="6447846">e</span>&nbsp;<span class="op" id="6447848">:=</span>&nbsp;<span class="ident" id="6447851">req</span><span class="op" id="6447854">.</span><span class="ident" id="6447855">URL</span><span class="op" id="6447858">.</span><span class="ident" id="6447859">String</span><span class="op" id="6447865">(</span><span class="op" id="6447866">)</span><span class="op" id="6447867">,</span>&nbsp;<span class="string" id="6447869">&#34;http://example.com/dir/scriptname/p1/p2?a=1&amp;b=2&#34;</span><span class="op" id="6447918">;</span>&nbsp;<span class="ident" id="6447920">e</span>&nbsp;<span class="op" id="6447922">!=</span>&nbsp;<span class="ident" id="6447925">g</span>&nbsp;<span class="op" id="6447927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6447931">t</span><span class="op" id="6447932">.</span><span class="ident" id="6447933">Errorf</span><span class="op" id="6447939">(</span><span class="string" id="6447940">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6447959">,</span>&nbsp;<span class="ident" id="6447961">g</span><span class="op" id="6447962">,</span>&nbsp;<span class="ident" id="6447964">e</span><span class="op" id="6447965">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6447968">}</span><br>
<span class="lineno"></span><span class="op" id="6447970">}</span>
</div>
</body>
</html>
