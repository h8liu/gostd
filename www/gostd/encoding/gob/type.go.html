<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html" class="current">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5933247">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5933302">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5933356">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5933407">package</span>&nbsp;<span class="ident" id="5933415">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5933420">import</span>&nbsp;<span class="op" id="5933427">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5933430">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5933442">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5933452">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5933459">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5933465">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5933476">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5933484">&#34;sync/atomic&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5933499">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5933510">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5933525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5933528">//&nbsp;userTypeInfo&nbsp;stores&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;a&nbsp;type&nbsp;the&nbsp;user&nbsp;has&nbsp;handed</span><br>
<span class="lineno">20</span><span class="comment" id="5933610">//&nbsp;to&nbsp;the&nbsp;package.&nbsp;&nbsp;It&#39;s&nbsp;computed&nbsp;once&nbsp;and&nbsp;stored&nbsp;in&nbsp;a&nbsp;map&nbsp;keyed&nbsp;by&nbsp;reflection</span><br>
<span class="lineno"></span><span class="comment" id="5933689">//&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5933698">type</span>&nbsp;<span class="ident" id="5933703">userTypeInfo</span>&nbsp;<span class="keyword" id="5933716">struct</span>&nbsp;<span class="op" id="5933723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5933726">user</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5933738">reflect</span><span class="op" id="5933745">.</span><span class="ident" id="5933746">Type</span>&nbsp;<span class="comment" id="5933751">//&nbsp;the&nbsp;type&nbsp;the&nbsp;user&nbsp;handed&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5933783">base</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5933795">reflect</span><span class="op" id="5933802">.</span><span class="ident" id="5933803">Type</span>&nbsp;<span class="comment" id="5933808">//&nbsp;the&nbsp;base&nbsp;type&nbsp;after&nbsp;all&nbsp;indirections</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5933849">indir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5933861">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5933874">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5933924">externalEnc</span>&nbsp;<span class="builtintype" id="5933936">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5933949">//&nbsp;xGob,&nbsp;xBinary,&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5933977">externalDec</span>&nbsp;<span class="builtintype" id="5933989">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5934002">//&nbsp;xGob,&nbsp;xBinary&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5934029">encIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5934041">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5934054">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5934125">decIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5934137">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5934150">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno">30</span><span class="op" id="5934220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5934223">//&nbsp;externalEncoding&nbsp;bits</span><br>
<span class="lineno"></span><span class="keyword" id="5934248">const</span>&nbsp;<span class="op" id="5934254">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5934257">xGob</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5934265">=</span>&nbsp;<span class="num" id="5934267">1</span>&nbsp;<span class="op" id="5934269">+</span>&nbsp;<span class="ident" id="5934271">iota</span>&nbsp;<span class="comment" id="5934276">//&nbsp;GobEncoder&nbsp;or&nbsp;GobDecoder</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5934305">xBinary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5934324">//&nbsp;encoding.BinaryMarshaler&nbsp;or&nbsp;encoding.BinaryUnmarshaler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5934383">xText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5934402">//&nbsp;encoding.TextMarshaler&nbsp;or&nbsp;encoding.TextUnmarshaler</span><br>
<span class="lineno"></span><span class="op" id="5934456">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5934459">var</span>&nbsp;<span class="op" id="5934463">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5934466">//&nbsp;Protected&nbsp;by&nbsp;an&nbsp;RWMutex&nbsp;because&nbsp;we&nbsp;read&nbsp;it&nbsp;a&nbsp;lot&nbsp;and&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5934529">//&nbsp;it&nbsp;only&nbsp;when&nbsp;we&nbsp;see&nbsp;a&nbsp;new&nbsp;type,&nbsp;typically&nbsp;when&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5934591">userTypeLock</span>&nbsp;&nbsp;<span class="ident" id="5934605">sync</span><span class="op" id="5934609">.</span><span class="ident" id="5934610">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5934619">userTypeCache</span>&nbsp;<span class="op" id="5934633">=</span>&nbsp;<span class="builtinfunc" id="5934635">make</span><span class="op" id="5934639">(</span><span class="keyword" id="5934640">map</span><span class="op" id="5934643">[</span><span class="ident" id="5934644">reflect</span><span class="op" id="5934651">.</span><span class="ident" id="5934652">Type</span><span class="op" id="5934656">]</span><span class="op" id="5934657">*</span><span class="ident" id="5934658">userTypeInfo</span><span class="op" id="5934670">)</span><br>
<span class="lineno"></span><span class="op" id="5934672">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5934675">//&nbsp;validType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="5934763">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;err&nbsp;will&nbsp;be&nbsp;non-nil.&nbsp;&nbsp;To&nbsp;be&nbsp;used&nbsp;when&nbsp;the&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span><span class="comment" id="5934853">//&nbsp;is&nbsp;not&nbsp;set&nbsp;up.</span><br>
<span class="lineno"></span><span class="keyword" id="5934871">func</span>&nbsp;<span class="ident" id="5934876">validUserType</span><span class="op" id="5934889">(</span><span class="ident" id="5934890">rt</span>&nbsp;<span class="ident" id="5934893">reflect</span><span class="op" id="5934900">.</span><span class="ident" id="5934901">Type</span><span class="op" id="5934905">)</span>&nbsp;<span class="op" id="5934907">(</span><span class="ident" id="5934908">ut</span>&nbsp;<span class="op" id="5934911">*</span><span class="ident" id="5934912">userTypeInfo</span><span class="op" id="5934924">,</span>&nbsp;<span class="ident" id="5934926">err</span>&nbsp;<span class="builtintype" id="5934930">error</span><span class="op" id="5934935">)</span>&nbsp;<span class="op" id="5934937">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5934940">userTypeLock</span><span class="op" id="5934952">.</span><span class="ident" id="5934953">RLock</span><span class="op" id="5934958">(</span><span class="op" id="5934959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5934962">ut</span>&nbsp;<span class="op" id="5934965">=</span>&nbsp;<span class="ident" id="5934967">userTypeCache</span><span class="op" id="5934980">[</span><span class="ident" id="5934981">rt</span><span class="op" id="5934983">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5934986">userTypeLock</span><span class="op" id="5934998">.</span><span class="ident" id="5934999">RUnlock</span><span class="op" id="5935006">(</span><span class="op" id="5935007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5935010">if</span>&nbsp;<span class="ident" id="5935013">ut</span>&nbsp;<span class="op" id="5935016">!=</span>&nbsp;<span class="builtintype" id="5935019">nil</span>&nbsp;<span class="op" id="5935023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5935027">return</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5935035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5935038">//&nbsp;Now&nbsp;set&nbsp;the&nbsp;value&nbsp;under&nbsp;the&nbsp;write&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5935082">userTypeLock</span><span class="op" id="5935094">.</span><span class="ident" id="5935095">Lock</span><span class="op" id="5935099">(</span><span class="op" id="5935100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5935103">defer</span>&nbsp;<span class="ident" id="5935109">userTypeLock</span><span class="op" id="5935121">.</span><span class="ident" id="5935122">Unlock</span><span class="op" id="5935128">(</span><span class="op" id="5935129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5935132">if</span>&nbsp;<span class="ident" id="5935135">ut</span>&nbsp;<span class="op" id="5935138">=</span>&nbsp;<span class="ident" id="5935140">userTypeCache</span><span class="op" id="5935153">[</span><span class="ident" id="5935154">rt</span><span class="op" id="5935156">]</span><span class="op" id="5935157">;</span>&nbsp;<span class="ident" id="5935159">ut</span>&nbsp;<span class="op" id="5935162">!=</span>&nbsp;<span class="builtintype" id="5935165">nil</span>&nbsp;<span class="op" id="5935169">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5935173">//&nbsp;Lost&nbsp;the&nbsp;race;&nbsp;not&nbsp;a&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5935208">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5935216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5935219">ut</span>&nbsp;<span class="op" id="5935222">=</span>&nbsp;<span class="builtinfunc" id="5935224">new</span><span class="op" id="5935227">(</span><span class="ident" id="5935228">userTypeInfo</span><span class="op" id="5935240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5935243">ut</span><span class="op" id="5935245">.</span><span class="ident" id="5935246">base</span>&nbsp;<span class="op" id="5935251">=</span>&nbsp;<span class="ident" id="5935253">rt</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5935257">ut</span><span class="op" id="5935259">.</span><span class="ident" id="5935260">user</span>&nbsp;<span class="op" id="5935265">=</span>&nbsp;<span class="ident" id="5935267">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5935271">//&nbsp;A&nbsp;type&nbsp;that&nbsp;is&nbsp;just&nbsp;a&nbsp;cycle&nbsp;of&nbsp;pointers&nbsp;(such&nbsp;as&nbsp;type&nbsp;T&nbsp;*T)&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5935342">//&nbsp;be&nbsp;represented&nbsp;in&nbsp;gobs,&nbsp;which&nbsp;need&nbsp;some&nbsp;concrete&nbsp;data.&nbsp;&nbsp;We&nbsp;use&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5935411">//&nbsp;cycle&nbsp;detection&nbsp;algorithm&nbsp;from&nbsp;Knuth,&nbsp;Vol&nbsp;2,&nbsp;Section&nbsp;3.1,&nbsp;Ex&nbsp;6,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5935479">//&nbsp;pp&nbsp;539-540.&nbsp;&nbsp;As&nbsp;we&nbsp;step&nbsp;through&nbsp;indirections,&nbsp;run&nbsp;another&nbsp;type&nbsp;at</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5935549">//&nbsp;half&nbsp;speed.&nbsp;If&nbsp;they&nbsp;meet&nbsp;up,&nbsp;there&#39;s&nbsp;a&nbsp;cycle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5935599">slowpoke</span>&nbsp;<span class="op" id="5935608">:=</span>&nbsp;<span class="ident" id="5935611">ut</span><span class="op" id="5935613">.</span><span class="ident" id="5935614">base</span>&nbsp;<span class="comment" id="5935619">//&nbsp;walks&nbsp;half&nbsp;as&nbsp;fast&nbsp;as&nbsp;ut.base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5935653">for</span>&nbsp;<span class="op" id="5935657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5935661">pt</span>&nbsp;<span class="op" id="5935664">:=</span>&nbsp;<span class="ident" id="5935667">ut</span><span class="op" id="5935669">.</span><span class="ident" id="5935670">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5935677">if</span>&nbsp;<span class="ident" id="5935680">pt</span><span class="op" id="5935682">.</span><span class="ident" id="5935683">Kind</span><span class="op" id="5935687">(</span><span class="op" id="5935688">)</span>&nbsp;<span class="op" id="5935690">!=</span>&nbsp;<span class="ident" id="5935693">reflect</span><span class="op" id="5935700">.</span><span class="ident" id="5935701">Ptr</span>&nbsp;<span class="op" id="5935705">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5935710">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5935718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5935722">ut</span><span class="op" id="5935724">.</span><span class="ident" id="5935725">base</span>&nbsp;<span class="op" id="5935730">=</span>&nbsp;<span class="ident" id="5935732">pt</span><span class="op" id="5935734">.</span><span class="ident" id="5935735">Elem</span><span class="op" id="5935739">(</span><span class="op" id="5935740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5935744">if</span>&nbsp;<span class="ident" id="5935747">ut</span><span class="op" id="5935749">.</span><span class="ident" id="5935750">base</span>&nbsp;<span class="op" id="5935755">==</span>&nbsp;<span class="ident" id="5935758">slowpoke</span>&nbsp;<span class="op" id="5935767">{</span>&nbsp;<span class="comment" id="5935769">//&nbsp;ut.base&nbsp;lapped&nbsp;slowpoke</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5935799">//&nbsp;recursive&nbsp;pointer&nbsp;type.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5935829">return</span>&nbsp;<span class="builtintype" id="5935836">nil</span><span class="op" id="5935839">,</span>&nbsp;<span class="ident" id="5935841">errors</span><span class="op" id="5935847">.</span><span class="ident" id="5935848">New</span><span class="op" id="5935851">(</span><span class="string" id="5935852">&#34;can&#39;t&nbsp;represent&nbsp;recursive&nbsp;pointer&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5935894">+</span>&nbsp;<span class="ident" id="5935896">ut</span><span class="op" id="5935898">.</span><span class="ident" id="5935899">base</span><span class="op" id="5935903">.</span><span class="ident" id="5935904">String</span><span class="op" id="5935910">(</span><span class="op" id="5935911">)</span><span class="op" id="5935912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5935916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5935920">if</span>&nbsp;<span class="ident" id="5935923">ut</span><span class="op" id="5935925">.</span><span class="ident" id="5935926">indir</span><span class="op" id="5935931">%</span><span class="num" id="5935932">2</span>&nbsp;<span class="op" id="5935934">==</span>&nbsp;<span class="num" id="5935937">0</span>&nbsp;<span class="op" id="5935939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5935944">slowpoke</span>&nbsp;<span class="op" id="5935953">=</span>&nbsp;<span class="ident" id="5935955">slowpoke</span><span class="op" id="5935963">.</span><span class="ident" id="5935964">Elem</span><span class="op" id="5935968">(</span><span class="op" id="5935969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5935973">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5935977">ut</span><span class="op" id="5935979">.</span><span class="ident" id="5935980">indir</span><span class="op" id="5935985">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5935989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5935993">if</span>&nbsp;<span class="ident" id="5935996">ok</span><span class="op" id="5935998">,</span>&nbsp;<span class="ident" id="5936000">indir</span>&nbsp;<span class="op" id="5936006">:=</span>&nbsp;<span class="ident" id="5936009">implementsInterface</span><span class="op" id="5936028">(</span><span class="ident" id="5936029">ut</span><span class="op" id="5936031">.</span><span class="ident" id="5936032">user</span><span class="op" id="5936036">,</span>&nbsp;<span class="ident" id="5936038">gobEncoderInterfaceType</span><span class="op" id="5936061">)</span><span class="op" id="5936062">;</span>&nbsp;<span class="ident" id="5936064">ok</span>&nbsp;<span class="op" id="5936067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5936071">ut</span><span class="op" id="5936073">.</span><span class="ident" id="5936074">externalEnc</span><span class="op" id="5936085">,</span>&nbsp;<span class="ident" id="5936087">ut</span><span class="op" id="5936089">.</span><span class="ident" id="5936090">encIndir</span>&nbsp;<span class="op" id="5936099">=</span>&nbsp;<span class="ident" id="5936101">xGob</span><span class="op" id="5936105">,</span>&nbsp;<span class="ident" id="5936107">indir</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5936114">}</span>&nbsp;<span class="keyword" id="5936116">else</span>&nbsp;<span class="keyword" id="5936121">if</span>&nbsp;<span class="ident" id="5936124">ok</span><span class="op" id="5936126">,</span>&nbsp;<span class="ident" id="5936128">indir</span>&nbsp;<span class="op" id="5936134">:=</span>&nbsp;<span class="ident" id="5936137">implementsInterface</span><span class="op" id="5936156">(</span><span class="ident" id="5936157">ut</span><span class="op" id="5936159">.</span><span class="ident" id="5936160">user</span><span class="op" id="5936164">,</span>&nbsp;<span class="ident" id="5936166">binaryMarshalerInterfaceType</span><span class="op" id="5936194">)</span><span class="op" id="5936195">;</span>&nbsp;<span class="ident" id="5936197">ok</span>&nbsp;<span class="op" id="5936200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5936204">ut</span><span class="op" id="5936206">.</span><span class="ident" id="5936207">externalEnc</span><span class="op" id="5936218">,</span>&nbsp;<span class="ident" id="5936220">ut</span><span class="op" id="5936222">.</span><span class="ident" id="5936223">encIndir</span>&nbsp;<span class="op" id="5936232">=</span>&nbsp;<span class="ident" id="5936234">xBinary</span><span class="op" id="5936241">,</span>&nbsp;<span class="ident" id="5936243">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5936250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5936254">//&nbsp;NOTE(rsc):&nbsp;Would&nbsp;like&nbsp;to&nbsp;allow&nbsp;MarshalText&nbsp;here,&nbsp;but&nbsp;results&nbsp;in&nbsp;incompatibility</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5936338">//&nbsp;with&nbsp;older&nbsp;encodings&nbsp;for&nbsp;net.IP.&nbsp;See&nbsp;golang.org/issue/6760.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5936402">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textMarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5936492">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ut.externalEnc,&nbsp;ut.encIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5936540">//&nbsp;}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5936547">if</span>&nbsp;<span class="ident" id="5936550">ok</span><span class="op" id="5936552">,</span>&nbsp;<span class="ident" id="5936554">indir</span>&nbsp;<span class="op" id="5936560">:=</span>&nbsp;<span class="ident" id="5936563">implementsInterface</span><span class="op" id="5936582">(</span><span class="ident" id="5936583">ut</span><span class="op" id="5936585">.</span><span class="ident" id="5936586">user</span><span class="op" id="5936590">,</span>&nbsp;<span class="ident" id="5936592">gobDecoderInterfaceType</span><span class="op" id="5936615">)</span><span class="op" id="5936616">;</span>&nbsp;<span class="ident" id="5936618">ok</span>&nbsp;<span class="op" id="5936621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5936625">ut</span><span class="op" id="5936627">.</span><span class="ident" id="5936628">externalDec</span><span class="op" id="5936639">,</span>&nbsp;<span class="ident" id="5936641">ut</span><span class="op" id="5936643">.</span><span class="ident" id="5936644">decIndir</span>&nbsp;<span class="op" id="5936653">=</span>&nbsp;<span class="ident" id="5936655">xGob</span><span class="op" id="5936659">,</span>&nbsp;<span class="ident" id="5936661">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5936668">}</span>&nbsp;<span class="keyword" id="5936670">else</span>&nbsp;<span class="keyword" id="5936675">if</span>&nbsp;<span class="ident" id="5936678">ok</span><span class="op" id="5936680">,</span>&nbsp;<span class="ident" id="5936682">indir</span>&nbsp;<span class="op" id="5936688">:=</span>&nbsp;<span class="ident" id="5936691">implementsInterface</span><span class="op" id="5936710">(</span><span class="ident" id="5936711">ut</span><span class="op" id="5936713">.</span><span class="ident" id="5936714">user</span><span class="op" id="5936718">,</span>&nbsp;<span class="ident" id="5936720">binaryUnmarshalerInterfaceType</span><span class="op" id="5936750">)</span><span class="op" id="5936751">;</span>&nbsp;<span class="ident" id="5936753">ok</span>&nbsp;<span class="op" id="5936756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5936760">ut</span><span class="op" id="5936762">.</span><span class="ident" id="5936763">externalDec</span><span class="op" id="5936774">,</span>&nbsp;<span class="ident" id="5936776">ut</span><span class="op" id="5936778">.</span><span class="ident" id="5936779">decIndir</span>&nbsp;<span class="op" id="5936788">=</span>&nbsp;<span class="ident" id="5936790">xBinary</span><span class="op" id="5936797">,</span>&nbsp;<span class="ident" id="5936799">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5936806">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5936810">//&nbsp;See&nbsp;note&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5936830">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textUnmarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5936922">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ut.externalDec,&nbsp;ut.decIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5936970">//&nbsp;}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5936977">userTypeCache</span><span class="op" id="5936990">[</span><span class="ident" id="5936991">rt</span><span class="op" id="5936993">]</span>&nbsp;<span class="op" id="5936995">=</span>&nbsp;<span class="ident" id="5936997">ut</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5937001">return</span><br>
<span class="lineno"></span><span class="op" id="5937008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="5937011">var</span>&nbsp;<span class="op" id="5937015">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5937018">gobEncoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5937049">=</span>&nbsp;<span class="ident" id="5937051">reflect</span><span class="op" id="5937058">.</span><span class="ident" id="5937059">TypeOf</span><span class="op" id="5937065">(</span><span class="op" id="5937066">(</span><span class="op" id="5937067">*</span><span class="ident" id="5937068">GobEncoder</span><span class="op" id="5937078">)</span><span class="op" id="5937079">(</span><span class="builtintype" id="5937080">nil</span><span class="op" id="5937083">)</span><span class="op" id="5937084">)</span><span class="op" id="5937085">.</span><span class="ident" id="5937086">Elem</span><span class="op" id="5937090">(</span><span class="op" id="5937091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5937094">gobDecoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5937125">=</span>&nbsp;<span class="ident" id="5937127">reflect</span><span class="op" id="5937134">.</span><span class="ident" id="5937135">TypeOf</span><span class="op" id="5937141">(</span><span class="op" id="5937142">(</span><span class="op" id="5937143">*</span><span class="ident" id="5937144">GobDecoder</span><span class="op" id="5937154">)</span><span class="op" id="5937155">(</span><span class="builtintype" id="5937156">nil</span><span class="op" id="5937159">)</span><span class="op" id="5937160">)</span><span class="op" id="5937161">.</span><span class="ident" id="5937162">Elem</span><span class="op" id="5937166">(</span><span class="op" id="5937167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5937170">binaryMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5937201">=</span>&nbsp;<span class="ident" id="5937203">reflect</span><span class="op" id="5937210">.</span><span class="ident" id="5937211">TypeOf</span><span class="op" id="5937217">(</span><span class="op" id="5937218">(</span><span class="op" id="5937219">*</span><span class="ident" id="5937220">encoding</span><span class="op" id="5937228">.</span><span class="ident" id="5937229">BinaryMarshaler</span><span class="op" id="5937244">)</span><span class="op" id="5937245">(</span><span class="builtintype" id="5937246">nil</span><span class="op" id="5937249">)</span><span class="op" id="5937250">)</span><span class="op" id="5937251">.</span><span class="ident" id="5937252">Elem</span><span class="op" id="5937256">(</span><span class="op" id="5937257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5937260">binaryUnmarshalerInterfaceType</span>&nbsp;<span class="op" id="5937291">=</span>&nbsp;<span class="ident" id="5937293">reflect</span><span class="op" id="5937300">.</span><span class="ident" id="5937301">TypeOf</span><span class="op" id="5937307">(</span><span class="op" id="5937308">(</span><span class="op" id="5937309">*</span><span class="ident" id="5937310">encoding</span><span class="op" id="5937318">.</span><span class="ident" id="5937319">BinaryUnmarshaler</span><span class="op" id="5937336">)</span><span class="op" id="5937337">(</span><span class="builtintype" id="5937338">nil</span><span class="op" id="5937341">)</span><span class="op" id="5937342">)</span><span class="op" id="5937343">.</span><span class="ident" id="5937344">Elem</span><span class="op" id="5937348">(</span><span class="op" id="5937349">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5937352">textMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5937383">=</span>&nbsp;<span class="ident" id="5937385">reflect</span><span class="op" id="5937392">.</span><span class="ident" id="5937393">TypeOf</span><span class="op" id="5937399">(</span><span class="op" id="5937400">(</span><span class="op" id="5937401">*</span><span class="ident" id="5937402">encoding</span><span class="op" id="5937410">.</span><span class="ident" id="5937411">TextMarshaler</span><span class="op" id="5937424">)</span><span class="op" id="5937425">(</span><span class="builtintype" id="5937426">nil</span><span class="op" id="5937429">)</span><span class="op" id="5937430">)</span><span class="op" id="5937431">.</span><span class="ident" id="5937432">Elem</span><span class="op" id="5937436">(</span><span class="op" id="5937437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5937440">textUnmarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5937471">=</span>&nbsp;<span class="ident" id="5937473">reflect</span><span class="op" id="5937480">.</span><span class="ident" id="5937481">TypeOf</span><span class="op" id="5937487">(</span><span class="op" id="5937488">(</span><span class="op" id="5937489">*</span><span class="ident" id="5937490">encoding</span><span class="op" id="5937498">.</span><span class="ident" id="5937499">TextUnmarshaler</span><span class="op" id="5937514">)</span><span class="op" id="5937515">(</span><span class="builtintype" id="5937516">nil</span><span class="op" id="5937519">)</span><span class="op" id="5937520">)</span><span class="op" id="5937521">.</span><span class="ident" id="5937522">Elem</span><span class="op" id="5937526">(</span><span class="op" id="5937527">)</span><br>
<span class="lineno"></span><span class="op" id="5937529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5937532">//&nbsp;implementsInterface&nbsp;reports&nbsp;whether&nbsp;the&nbsp;type&nbsp;implements&nbsp;the</span><br>
<span class="lineno">125</span><span class="comment" id="5937595">//&nbsp;gobEncoder/gobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5937631">//&nbsp;It&nbsp;also&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;indirections&nbsp;required&nbsp;to&nbsp;get&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5937700">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="5937719">func</span>&nbsp;<span class="ident" id="5937724">implementsInterface</span><span class="op" id="5937743">(</span><span class="ident" id="5937744">typ</span><span class="op" id="5937747">,</span>&nbsp;<span class="ident" id="5937749">gobEncDecType</span>&nbsp;<span class="ident" id="5937763">reflect</span><span class="op" id="5937770">.</span><span class="ident" id="5937771">Type</span><span class="op" id="5937775">)</span>&nbsp;<span class="op" id="5937777">(</span><span class="ident" id="5937778">success</span>&nbsp;<span class="builtintype" id="5937786">bool</span><span class="op" id="5937790">,</span>&nbsp;<span class="ident" id="5937792">indir</span>&nbsp;<span class="builtintype" id="5937798">int8</span><span class="op" id="5937802">)</span>&nbsp;<span class="op" id="5937804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5937807">if</span>&nbsp;<span class="ident" id="5937810">typ</span>&nbsp;<span class="op" id="5937814">==</span>&nbsp;<span class="builtintype" id="5937817">nil</span>&nbsp;<span class="op" id="5937821">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5937825">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5937833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5937836">rt</span>&nbsp;<span class="op" id="5937839">:=</span>&nbsp;<span class="ident" id="5937842">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5937847">//&nbsp;The&nbsp;type&nbsp;might&nbsp;be&nbsp;a&nbsp;pointer&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;keep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5937899">//&nbsp;dereferencing&nbsp;to&nbsp;the&nbsp;base&nbsp;type&nbsp;until&nbsp;we&nbsp;find&nbsp;an&nbsp;implementation.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5937967">for</span>&nbsp;<span class="op" id="5937971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5937975">if</span>&nbsp;<span class="ident" id="5937978">rt</span><span class="op" id="5937980">.</span><span class="ident" id="5937981">Implements</span><span class="op" id="5937991">(</span><span class="ident" id="5937992">gobEncDecType</span><span class="op" id="5938005">)</span>&nbsp;<span class="op" id="5938007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5938012">return</span>&nbsp;<span class="builtintype" id="5938019">true</span><span class="op" id="5938023">,</span>&nbsp;<span class="ident" id="5938025">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5938033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5938037">if</span>&nbsp;<span class="ident" id="5938040">p</span>&nbsp;<span class="op" id="5938042">:=</span>&nbsp;<span class="ident" id="5938045">rt</span><span class="op" id="5938047">;</span>&nbsp;<span class="ident" id="5938049">p</span><span class="op" id="5938050">.</span><span class="ident" id="5938051">Kind</span><span class="op" id="5938055">(</span><span class="op" id="5938056">)</span>&nbsp;<span class="op" id="5938058">==</span>&nbsp;<span class="ident" id="5938061">reflect</span><span class="op" id="5938068">.</span><span class="ident" id="5938069">Ptr</span>&nbsp;<span class="op" id="5938073">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5938078">indir</span><span class="op" id="5938083">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5938089">if</span>&nbsp;<span class="ident" id="5938092">indir</span>&nbsp;<span class="op" id="5938098">&gt;</span>&nbsp;<span class="num" id="5938100">100</span>&nbsp;<span class="op" id="5938104">{</span>&nbsp;<span class="comment" id="5938106">//&nbsp;insane&nbsp;number&nbsp;of&nbsp;indirections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5938143">return</span>&nbsp;<span class="builtintype" id="5938150">false</span><span class="op" id="5938155">,</span>&nbsp;<span class="num" id="5938157">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5938162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5938167">rt</span>&nbsp;<span class="op" id="5938170">=</span>&nbsp;<span class="ident" id="5938172">p</span><span class="op" id="5938173">.</span><span class="ident" id="5938174">Elem</span><span class="op" id="5938178">(</span><span class="op" id="5938179">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5938184">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5938195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5938199">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5938206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5938209">//&nbsp;No&nbsp;luck&nbsp;yet,&nbsp;but&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;base&nbsp;type&nbsp;(non-pointer),&nbsp;the&nbsp;pointer&nbsp;might&nbsp;satisfy.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5938295">if</span>&nbsp;<span class="ident" id="5938298">typ</span><span class="op" id="5938301">.</span><span class="ident" id="5938302">Kind</span><span class="op" id="5938306">(</span><span class="op" id="5938307">)</span>&nbsp;<span class="op" id="5938309">!=</span>&nbsp;<span class="ident" id="5938312">reflect</span><span class="op" id="5938319">.</span><span class="ident" id="5938320">Ptr</span>&nbsp;<span class="op" id="5938324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5938328">//&nbsp;Not&nbsp;a&nbsp;pointer,&nbsp;but&nbsp;does&nbsp;the&nbsp;pointer&nbsp;work?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5938375">if</span>&nbsp;<span class="ident" id="5938378">reflect</span><span class="op" id="5938385">.</span><span class="ident" id="5938386">PtrTo</span><span class="op" id="5938391">(</span><span class="ident" id="5938392">typ</span><span class="op" id="5938395">)</span><span class="op" id="5938396">.</span><span class="ident" id="5938397">Implements</span><span class="op" id="5938407">(</span><span class="ident" id="5938408">gobEncDecType</span><span class="op" id="5938421">)</span>&nbsp;<span class="op" id="5938423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5938428">return</span>&nbsp;<span class="builtintype" id="5938435">true</span><span class="op" id="5938439">,</span>&nbsp;<span class="op" id="5938441">-</span><span class="num" id="5938442">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5938446">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5938449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5938452">return</span>&nbsp;<span class="builtintype" id="5938459">false</span><span class="op" id="5938464">,</span>&nbsp;<span class="num" id="5938466">0</span><br>
<span class="lineno"></span><span class="op" id="5938468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5938471">//&nbsp;userType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno">160</span><span class="comment" id="5938558">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;it&nbsp;calls&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="5938608">func</span>&nbsp;<span class="ident" id="5938613">userType</span><span class="op" id="5938621">(</span><span class="ident" id="5938622">rt</span>&nbsp;<span class="ident" id="5938625">reflect</span><span class="op" id="5938632">.</span><span class="ident" id="5938633">Type</span><span class="op" id="5938637">)</span>&nbsp;<span class="op" id="5938639">*</span><span class="ident" id="5938640">userTypeInfo</span>&nbsp;<span class="op" id="5938653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5938656">ut</span><span class="op" id="5938658">,</span>&nbsp;<span class="ident" id="5938660">err</span>&nbsp;<span class="op" id="5938664">:=</span>&nbsp;<span class="ident" id="5938667">validUserType</span><span class="op" id="5938680">(</span><span class="ident" id="5938681">rt</span><span class="op" id="5938683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5938686">if</span>&nbsp;<span class="ident" id="5938689">err</span>&nbsp;<span class="op" id="5938693">!=</span>&nbsp;<span class="builtintype" id="5938696">nil</span>&nbsp;<span class="op" id="5938700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5938704">error_</span><span class="op" id="5938710">(</span><span class="ident" id="5938711">err</span><span class="op" id="5938714">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5938717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5938720">return</span>&nbsp;<span class="ident" id="5938727">ut</span><br>
<span class="lineno"></span><span class="op" id="5938730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5938733">//&nbsp;A&nbsp;typeId&nbsp;represents&nbsp;a&nbsp;gob&nbsp;Type&nbsp;as&nbsp;an&nbsp;integer&nbsp;that&nbsp;can&nbsp;be&nbsp;passed&nbsp;on&nbsp;the&nbsp;wire.</span><br>
<span class="lineno">170</span><span class="comment" id="5938813">//&nbsp;Internally,&nbsp;typeIds&nbsp;are&nbsp;used&nbsp;as&nbsp;keys&nbsp;to&nbsp;a&nbsp;map&nbsp;to&nbsp;recover&nbsp;the&nbsp;underlying&nbsp;type&nbsp;info.</span><br>
<span class="lineno"></span><span class="keyword" id="5938899">type</span>&nbsp;<span class="ident" id="5938904">typeId</span>&nbsp;<span class="builtintype" id="5938911">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5938918">var</span>&nbsp;<span class="ident" id="5938922">nextId</span>&nbsp;<span class="ident" id="5938929">typeId</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5938942">//&nbsp;incremented&nbsp;for&nbsp;each&nbsp;new&nbsp;type&nbsp;we&nbsp;build</span><br>
<span class="lineno"></span><span class="keyword" id="5938984">var</span>&nbsp;<span class="ident" id="5938988">typeLock</span>&nbsp;<span class="ident" id="5938997">sync</span><span class="op" id="5939001">.</span><span class="ident" id="5939002">Mutex</span>&nbsp;<span class="comment" id="5939008">//&nbsp;set&nbsp;while&nbsp;building&nbsp;a&nbsp;type</span><br>
<span class="lineno">175</span><span class="keyword" id="5939037">const</span>&nbsp;<span class="ident" id="5939043">firstUserId</span>&nbsp;<span class="op" id="5939055">=</span>&nbsp;<span class="num" id="5939057">64</span>&nbsp;&nbsp;<span class="comment" id="5939061">//&nbsp;lowest&nbsp;id&nbsp;number&nbsp;granted&nbsp;to&nbsp;user</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5939098">type</span>&nbsp;<span class="ident" id="5939103">gobType</span>&nbsp;<span class="keyword" id="5939111">interface</span>&nbsp;<span class="op" id="5939121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5939124">id</span><span class="op" id="5939126">(</span><span class="op" id="5939127">)</span>&nbsp;<span class="ident" id="5939129">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5939137">setId</span><span class="op" id="5939142">(</span><span class="ident" id="5939143">id</span>&nbsp;<span class="ident" id="5939146">typeId</span><span class="op" id="5939152">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5939155">name</span><span class="op" id="5939159">(</span><span class="op" id="5939160">)</span>&nbsp;<span class="builtintype" id="5939162">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5939170">string</span><span class="op" id="5939176">(</span><span class="op" id="5939177">)</span>&nbsp;<span class="builtintype" id="5939179">string</span>&nbsp;<span class="comment" id="5939186">//&nbsp;not&nbsp;public;&nbsp;only&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5939221">safeString</span><span class="op" id="5939231">(</span><span class="ident" id="5939232">seen</span>&nbsp;<span class="keyword" id="5939237">map</span><span class="op" id="5939240">[</span><span class="ident" id="5939241">typeId</span><span class="op" id="5939247">]</span><span class="builtintype" id="5939248">bool</span><span class="op" id="5939252">)</span>&nbsp;<span class="builtintype" id="5939254">string</span><br>
<span class="lineno"></span><span class="op" id="5939261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="5939264">var</span>&nbsp;<span class="ident" id="5939268">types</span>&nbsp;<span class="op" id="5939274">=</span>&nbsp;<span class="builtinfunc" id="5939276">make</span><span class="op" id="5939280">(</span><span class="keyword" id="5939281">map</span><span class="op" id="5939284">[</span><span class="ident" id="5939285">reflect</span><span class="op" id="5939292">.</span><span class="ident" id="5939293">Type</span><span class="op" id="5939297">]</span><span class="ident" id="5939298">gobType</span><span class="op" id="5939305">)</span><br>
<span class="lineno"></span><span class="keyword" id="5939307">var</span>&nbsp;<span class="ident" id="5939311">idToType</span>&nbsp;<span class="op" id="5939320">=</span>&nbsp;<span class="builtinfunc" id="5939322">make</span><span class="op" id="5939326">(</span><span class="keyword" id="5939327">map</span><span class="op" id="5939330">[</span><span class="ident" id="5939331">typeId</span><span class="op" id="5939337">]</span><span class="ident" id="5939338">gobType</span><span class="op" id="5939345">)</span><br>
<span class="lineno"></span><span class="keyword" id="5939347">var</span>&nbsp;<span class="ident" id="5939351">builtinIdToType</span>&nbsp;<span class="keyword" id="5939367">map</span><span class="op" id="5939370">[</span><span class="ident" id="5939371">typeId</span><span class="op" id="5939377">]</span><span class="ident" id="5939378">gobType</span>&nbsp;<span class="comment" id="5939386">//&nbsp;set&nbsp;in&nbsp;init()&nbsp;after&nbsp;builtins&nbsp;are&nbsp;established</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5939435">func</span>&nbsp;<span class="ident" id="5939440">setTypeId</span><span class="op" id="5939449">(</span><span class="ident" id="5939450">typ</span>&nbsp;<span class="ident" id="5939454">gobType</span><span class="op" id="5939461">)</span>&nbsp;<span class="op" id="5939463">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5939466">//&nbsp;When&nbsp;building&nbsp;recursive&nbsp;types,&nbsp;someone&nbsp;may&nbsp;get&nbsp;there&nbsp;before&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5939534">if</span>&nbsp;<span class="ident" id="5939537">typ</span><span class="op" id="5939540">.</span><span class="ident" id="5939541">id</span><span class="op" id="5939543">(</span><span class="op" id="5939544">)</span>&nbsp;<span class="op" id="5939546">!=</span>&nbsp;<span class="num" id="5939549">0</span>&nbsp;<span class="op" id="5939551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5939555">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5939563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5939566">nextId</span><span class="op" id="5939572">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5939576">typ</span><span class="op" id="5939579">.</span><span class="ident" id="5939580">setId</span><span class="op" id="5939585">(</span><span class="ident" id="5939586">nextId</span><span class="op" id="5939592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5939595">idToType</span><span class="op" id="5939603">[</span><span class="ident" id="5939604">nextId</span><span class="op" id="5939610">]</span>&nbsp;<span class="op" id="5939612">=</span>&nbsp;<span class="ident" id="5939614">typ</span><br>
<span class="lineno"></span><span class="op" id="5939618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5939621">func</span>&nbsp;<span class="op" id="5939626">(</span><span class="ident" id="5939627">t</span>&nbsp;<span class="ident" id="5939629">typeId</span><span class="op" id="5939635">)</span>&nbsp;<span class="ident" id="5939637">gobType</span><span class="op" id="5939644">(</span><span class="op" id="5939645">)</span>&nbsp;<span class="ident" id="5939647">gobType</span>&nbsp;<span class="op" id="5939655">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5939658">if</span>&nbsp;<span class="ident" id="5939661">t</span>&nbsp;<span class="op" id="5939663">==</span>&nbsp;<span class="num" id="5939666">0</span>&nbsp;<span class="op" id="5939668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5939672">return</span>&nbsp;<span class="builtintype" id="5939679">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5939684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5939687">return</span>&nbsp;<span class="ident" id="5939694">idToType</span><span class="op" id="5939702">[</span><span class="ident" id="5939703">t</span><span class="op" id="5939704">]</span><br>
<span class="lineno"></span><span class="op" id="5939706">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="5939709">//&nbsp;string&nbsp;returns&nbsp;the&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno"></span><span class="keyword" id="5939793">func</span>&nbsp;<span class="op" id="5939798">(</span><span class="ident" id="5939799">t</span>&nbsp;<span class="ident" id="5939801">typeId</span><span class="op" id="5939807">)</span>&nbsp;<span class="builtintype" id="5939809">string</span><span class="op" id="5939815">(</span><span class="op" id="5939816">)</span>&nbsp;<span class="builtintype" id="5939818">string</span>&nbsp;<span class="op" id="5939825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5939828">if</span>&nbsp;<span class="ident" id="5939831">t</span><span class="op" id="5939832">.</span><span class="ident" id="5939833">gobType</span><span class="op" id="5939840">(</span><span class="op" id="5939841">)</span>&nbsp;<span class="op" id="5939843">==</span>&nbsp;<span class="builtintype" id="5939846">nil</span>&nbsp;<span class="op" id="5939850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5939854">return</span>&nbsp;<span class="string" id="5939861">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5939870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5939873">return</span>&nbsp;<span class="ident" id="5939880">t</span><span class="op" id="5939881">.</span><span class="ident" id="5939882">gobType</span><span class="op" id="5939889">(</span><span class="op" id="5939890">)</span><span class="op" id="5939891">.</span><span class="builtintype" id="5939892">string</span><span class="op" id="5939898">(</span><span class="op" id="5939899">)</span><br>
<span class="lineno"></span><span class="op" id="5939901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5939904">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno">215</span><span class="keyword" id="5939969">func</span>&nbsp;<span class="op" id="5939974">(</span><span class="ident" id="5939975">t</span>&nbsp;<span class="ident" id="5939977">typeId</span><span class="op" id="5939983">)</span>&nbsp;<span class="ident" id="5939985">name</span><span class="op" id="5939989">(</span><span class="op" id="5939990">)</span>&nbsp;<span class="builtintype" id="5939992">string</span>&nbsp;<span class="op" id="5939999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5940002">if</span>&nbsp;<span class="ident" id="5940005">t</span><span class="op" id="5940006">.</span><span class="ident" id="5940007">gobType</span><span class="op" id="5940014">(</span><span class="op" id="5940015">)</span>&nbsp;<span class="op" id="5940017">==</span>&nbsp;<span class="builtintype" id="5940020">nil</span>&nbsp;<span class="op" id="5940024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5940028">return</span>&nbsp;<span class="string" id="5940035">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5940044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5940047">return</span>&nbsp;<span class="ident" id="5940054">t</span><span class="op" id="5940055">.</span><span class="ident" id="5940056">gobType</span><span class="op" id="5940063">(</span><span class="op" id="5940064">)</span><span class="op" id="5940065">.</span><span class="ident" id="5940066">name</span><span class="op" id="5940070">(</span><span class="op" id="5940071">)</span><br>
<span class="lineno">220</span><span class="op" id="5940073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5940076">//&nbsp;CommonType&nbsp;holds&nbsp;elements&nbsp;of&nbsp;all&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="5940119">//&nbsp;It&nbsp;is&nbsp;a&nbsp;historical&nbsp;artifact,&nbsp;kept&nbsp;for&nbsp;binary&nbsp;compatibility&nbsp;and&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="5940194">//&nbsp;only&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;the&nbsp;package&#39;s&nbsp;encoding&nbsp;of&nbsp;type&nbsp;descriptors.&nbsp;It&nbsp;is</span><br>
<span class="lineno">225</span><span class="comment" id="5940271">//&nbsp;not&nbsp;intended&nbsp;for&nbsp;direct&nbsp;use&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="5940314">type</span>&nbsp;<span class="ident" id="5940319">CommonType</span>&nbsp;<span class="keyword" id="5940330">struct</span>&nbsp;<span class="op" id="5940337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5940340">Name</span>&nbsp;<span class="builtintype" id="5940345">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5940353">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5940358">typeId</span><br>
<span class="lineno"></span><span class="op" id="5940365">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="5940368">func</span>&nbsp;<span class="op" id="5940373">(</span><span class="ident" id="5940374">t</span>&nbsp;<span class="op" id="5940376">*</span><span class="ident" id="5940377">CommonType</span><span class="op" id="5940387">)</span>&nbsp;<span class="ident" id="5940389">id</span><span class="op" id="5940391">(</span><span class="op" id="5940392">)</span>&nbsp;<span class="ident" id="5940394">typeId</span>&nbsp;<span class="op" id="5940401">{</span>&nbsp;<span class="keyword" id="5940403">return</span>&nbsp;<span class="ident" id="5940410">t</span><span class="op" id="5940411">.</span><span class="ident" id="5940412">Id</span>&nbsp;<span class="op" id="5940415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5940418">func</span>&nbsp;<span class="op" id="5940423">(</span><span class="ident" id="5940424">t</span>&nbsp;<span class="op" id="5940426">*</span><span class="ident" id="5940427">CommonType</span><span class="op" id="5940437">)</span>&nbsp;<span class="ident" id="5940439">setId</span><span class="op" id="5940444">(</span><span class="ident" id="5940445">id</span>&nbsp;<span class="ident" id="5940448">typeId</span><span class="op" id="5940454">)</span>&nbsp;<span class="op" id="5940456">{</span>&nbsp;<span class="ident" id="5940458">t</span><span class="op" id="5940459">.</span><span class="ident" id="5940460">Id</span>&nbsp;<span class="op" id="5940463">=</span>&nbsp;<span class="ident" id="5940465">id</span>&nbsp;<span class="op" id="5940468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="5940471">func</span>&nbsp;<span class="op" id="5940476">(</span><span class="ident" id="5940477">t</span>&nbsp;<span class="op" id="5940479">*</span><span class="ident" id="5940480">CommonType</span><span class="op" id="5940490">)</span>&nbsp;<span class="builtintype" id="5940492">string</span><span class="op" id="5940498">(</span><span class="op" id="5940499">)</span>&nbsp;<span class="builtintype" id="5940501">string</span>&nbsp;<span class="op" id="5940508">{</span>&nbsp;<span class="keyword" id="5940510">return</span>&nbsp;<span class="ident" id="5940517">t</span><span class="op" id="5940518">.</span><span class="ident" id="5940519">Name</span>&nbsp;<span class="op" id="5940524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5940527">func</span>&nbsp;<span class="op" id="5940532">(</span><span class="ident" id="5940533">t</span>&nbsp;<span class="op" id="5940535">*</span><span class="ident" id="5940536">CommonType</span><span class="op" id="5940546">)</span>&nbsp;<span class="ident" id="5940548">safeString</span><span class="op" id="5940558">(</span><span class="ident" id="5940559">seen</span>&nbsp;<span class="keyword" id="5940564">map</span><span class="op" id="5940567">[</span><span class="ident" id="5940568">typeId</span><span class="op" id="5940574">]</span><span class="builtintype" id="5940575">bool</span><span class="op" id="5940579">)</span>&nbsp;<span class="builtintype" id="5940581">string</span>&nbsp;<span class="op" id="5940588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5940591">return</span>&nbsp;<span class="ident" id="5940598">t</span><span class="op" id="5940599">.</span><span class="ident" id="5940600">Name</span><br>
<span class="lineno"></span><span class="op" id="5940605">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5940608">func</span>&nbsp;<span class="op" id="5940613">(</span><span class="ident" id="5940614">t</span>&nbsp;<span class="op" id="5940616">*</span><span class="ident" id="5940617">CommonType</span><span class="op" id="5940627">)</span>&nbsp;<span class="ident" id="5940629">name</span><span class="op" id="5940633">(</span><span class="op" id="5940634">)</span>&nbsp;<span class="builtintype" id="5940636">string</span>&nbsp;<span class="op" id="5940643">{</span>&nbsp;<span class="keyword" id="5940645">return</span>&nbsp;<span class="ident" id="5940652">t</span><span class="op" id="5940653">.</span><span class="ident" id="5940654">Name</span>&nbsp;<span class="op" id="5940659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5940662">//&nbsp;Create&nbsp;and&nbsp;check&nbsp;predefined&nbsp;types</span><br>
<span class="lineno"></span><span class="comment" id="5940699">//&nbsp;The&nbsp;string&nbsp;for&nbsp;tBytes&nbsp;is&nbsp;&#34;bytes&#34;&nbsp;not&nbsp;&#34;[]byte&#34;&nbsp;to&nbsp;signify&nbsp;its&nbsp;specialness.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="5940777">var</span>&nbsp;<span class="op" id="5940781">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5940784">//&nbsp;Primordial&nbsp;types,&nbsp;needed&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5940836">//&nbsp;Always&nbsp;passed&nbsp;as&nbsp;pointers&nbsp;so&nbsp;the&nbsp;interface{}&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5940890">//&nbsp;goes&nbsp;through&nbsp;without&nbsp;losing&nbsp;its&nbsp;interfaceness.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5940941">tBool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5940952">=</span>&nbsp;<span class="ident" id="5940954">bootstrapType</span><span class="op" id="5940967">(</span><span class="string" id="5940968">&#34;bool&#34;</span><span class="op" id="5940974">,</span>&nbsp;<span class="op" id="5940976">(</span><span class="op" id="5940977">*</span><span class="builtintype" id="5940978">bool</span><span class="op" id="5940982">)</span><span class="op" id="5940983">(</span><span class="builtintype" id="5940984">nil</span><span class="op" id="5940987">)</span><span class="op" id="5940988">,</span>&nbsp;<span class="num" id="5940990">1</span><span class="op" id="5940991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5940994">tInt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5941005">=</span>&nbsp;<span class="ident" id="5941007">bootstrapType</span><span class="op" id="5941020">(</span><span class="string" id="5941021">&#34;int&#34;</span><span class="op" id="5941026">,</span>&nbsp;<span class="op" id="5941028">(</span><span class="op" id="5941029">*</span><span class="builtintype" id="5941030">int</span><span class="op" id="5941033">)</span><span class="op" id="5941034">(</span><span class="builtintype" id="5941035">nil</span><span class="op" id="5941038">)</span><span class="op" id="5941039">,</span>&nbsp;<span class="num" id="5941041">2</span><span class="op" id="5941042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941045">tUint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5941056">=</span>&nbsp;<span class="ident" id="5941058">bootstrapType</span><span class="op" id="5941071">(</span><span class="string" id="5941072">&#34;uint&#34;</span><span class="op" id="5941078">,</span>&nbsp;<span class="op" id="5941080">(</span><span class="op" id="5941081">*</span><span class="builtintype" id="5941082">uint</span><span class="op" id="5941086">)</span><span class="op" id="5941087">(</span><span class="builtintype" id="5941088">nil</span><span class="op" id="5941091">)</span><span class="op" id="5941092">,</span>&nbsp;<span class="num" id="5941094">3</span><span class="op" id="5941095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941098">tFloat</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5941109">=</span>&nbsp;<span class="ident" id="5941111">bootstrapType</span><span class="op" id="5941124">(</span><span class="string" id="5941125">&#34;float&#34;</span><span class="op" id="5941132">,</span>&nbsp;<span class="op" id="5941134">(</span><span class="op" id="5941135">*</span><span class="builtintype" id="5941136">float64</span><span class="op" id="5941143">)</span><span class="op" id="5941144">(</span><span class="builtintype" id="5941145">nil</span><span class="op" id="5941148">)</span><span class="op" id="5941149">,</span>&nbsp;<span class="num" id="5941151">4</span><span class="op" id="5941152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941155">tBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5941166">=</span>&nbsp;<span class="ident" id="5941168">bootstrapType</span><span class="op" id="5941181">(</span><span class="string" id="5941182">&#34;bytes&#34;</span><span class="op" id="5941189">,</span>&nbsp;<span class="op" id="5941191">(</span><span class="op" id="5941192">*</span><span class="op" id="5941193">[</span><span class="op" id="5941194">]</span><span class="builtintype" id="5941195">byte</span><span class="op" id="5941199">)</span><span class="op" id="5941200">(</span><span class="builtintype" id="5941201">nil</span><span class="op" id="5941204">)</span><span class="op" id="5941205">,</span>&nbsp;<span class="num" id="5941207">5</span><span class="op" id="5941208">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941211">tString</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5941222">=</span>&nbsp;<span class="ident" id="5941224">bootstrapType</span><span class="op" id="5941237">(</span><span class="string" id="5941238">&#34;string&#34;</span><span class="op" id="5941246">,</span>&nbsp;<span class="op" id="5941248">(</span><span class="op" id="5941249">*</span><span class="builtintype" id="5941250">string</span><span class="op" id="5941256">)</span><span class="op" id="5941257">(</span><span class="builtintype" id="5941258">nil</span><span class="op" id="5941261">)</span><span class="op" id="5941262">,</span>&nbsp;<span class="num" id="5941264">6</span><span class="op" id="5941265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941268">tComplex</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5941279">=</span>&nbsp;<span class="ident" id="5941281">bootstrapType</span><span class="op" id="5941294">(</span><span class="string" id="5941295">&#34;complex&#34;</span><span class="op" id="5941304">,</span>&nbsp;<span class="op" id="5941306">(</span><span class="op" id="5941307">*</span><span class="builtintype" id="5941308">complex128</span><span class="op" id="5941318">)</span><span class="op" id="5941319">(</span><span class="builtintype" id="5941320">nil</span><span class="op" id="5941323">)</span><span class="op" id="5941324">,</span>&nbsp;<span class="num" id="5941326">7</span><span class="op" id="5941327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941330">tInterface</span>&nbsp;<span class="op" id="5941341">=</span>&nbsp;<span class="ident" id="5941343">bootstrapType</span><span class="op" id="5941356">(</span><span class="string" id="5941357">&#34;interface&#34;</span><span class="op" id="5941368">,</span>&nbsp;<span class="op" id="5941370">(</span><span class="op" id="5941371">*</span><span class="keyword" id="5941372">interface</span><span class="op" id="5941381">{</span><span class="op" id="5941382">}</span><span class="op" id="5941383">)</span><span class="op" id="5941384">(</span><span class="builtintype" id="5941385">nil</span><span class="op" id="5941388">)</span><span class="op" id="5941389">,</span>&nbsp;<span class="num" id="5941391">8</span><span class="op" id="5941392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5941395">//&nbsp;Reserve&nbsp;some&nbsp;Ids&nbsp;for&nbsp;compatible&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941441">tReserved7</span>&nbsp;<span class="op" id="5941452">=</span>&nbsp;<span class="ident" id="5941454">bootstrapType</span><span class="op" id="5941467">(</span><span class="string" id="5941468">&#34;_reserved1&#34;</span><span class="op" id="5941480">,</span>&nbsp;<span class="op" id="5941482">(</span><span class="op" id="5941483">*</span><span class="keyword" id="5941484">struct</span><span class="op" id="5941490">{</span>&nbsp;<span class="ident" id="5941492">r7</span>&nbsp;<span class="builtintype" id="5941495">int</span>&nbsp;<span class="op" id="5941499">}</span><span class="op" id="5941500">)</span><span class="op" id="5941501">(</span><span class="builtintype" id="5941502">nil</span><span class="op" id="5941505">)</span><span class="op" id="5941506">,</span>&nbsp;<span class="num" id="5941508">9</span><span class="op" id="5941509">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941512">tReserved6</span>&nbsp;<span class="op" id="5941523">=</span>&nbsp;<span class="ident" id="5941525">bootstrapType</span><span class="op" id="5941538">(</span><span class="string" id="5941539">&#34;_reserved1&#34;</span><span class="op" id="5941551">,</span>&nbsp;<span class="op" id="5941553">(</span><span class="op" id="5941554">*</span><span class="keyword" id="5941555">struct</span><span class="op" id="5941561">{</span>&nbsp;<span class="ident" id="5941563">r6</span>&nbsp;<span class="builtintype" id="5941566">int</span>&nbsp;<span class="op" id="5941570">}</span><span class="op" id="5941571">)</span><span class="op" id="5941572">(</span><span class="builtintype" id="5941573">nil</span><span class="op" id="5941576">)</span><span class="op" id="5941577">,</span>&nbsp;<span class="num" id="5941579">10</span><span class="op" id="5941581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941584">tReserved5</span>&nbsp;<span class="op" id="5941595">=</span>&nbsp;<span class="ident" id="5941597">bootstrapType</span><span class="op" id="5941610">(</span><span class="string" id="5941611">&#34;_reserved1&#34;</span><span class="op" id="5941623">,</span>&nbsp;<span class="op" id="5941625">(</span><span class="op" id="5941626">*</span><span class="keyword" id="5941627">struct</span><span class="op" id="5941633">{</span>&nbsp;<span class="ident" id="5941635">r5</span>&nbsp;<span class="builtintype" id="5941638">int</span>&nbsp;<span class="op" id="5941642">}</span><span class="op" id="5941643">)</span><span class="op" id="5941644">(</span><span class="builtintype" id="5941645">nil</span><span class="op" id="5941648">)</span><span class="op" id="5941649">,</span>&nbsp;<span class="num" id="5941651">11</span><span class="op" id="5941653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941656">tReserved4</span>&nbsp;<span class="op" id="5941667">=</span>&nbsp;<span class="ident" id="5941669">bootstrapType</span><span class="op" id="5941682">(</span><span class="string" id="5941683">&#34;_reserved1&#34;</span><span class="op" id="5941695">,</span>&nbsp;<span class="op" id="5941697">(</span><span class="op" id="5941698">*</span><span class="keyword" id="5941699">struct</span><span class="op" id="5941705">{</span>&nbsp;<span class="ident" id="5941707">r4</span>&nbsp;<span class="builtintype" id="5941710">int</span>&nbsp;<span class="op" id="5941714">}</span><span class="op" id="5941715">)</span><span class="op" id="5941716">(</span><span class="builtintype" id="5941717">nil</span><span class="op" id="5941720">)</span><span class="op" id="5941721">,</span>&nbsp;<span class="num" id="5941723">12</span><span class="op" id="5941725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941728">tReserved3</span>&nbsp;<span class="op" id="5941739">=</span>&nbsp;<span class="ident" id="5941741">bootstrapType</span><span class="op" id="5941754">(</span><span class="string" id="5941755">&#34;_reserved1&#34;</span><span class="op" id="5941767">,</span>&nbsp;<span class="op" id="5941769">(</span><span class="op" id="5941770">*</span><span class="keyword" id="5941771">struct</span><span class="op" id="5941777">{</span>&nbsp;<span class="ident" id="5941779">r3</span>&nbsp;<span class="builtintype" id="5941782">int</span>&nbsp;<span class="op" id="5941786">}</span><span class="op" id="5941787">)</span><span class="op" id="5941788">(</span><span class="builtintype" id="5941789">nil</span><span class="op" id="5941792">)</span><span class="op" id="5941793">,</span>&nbsp;<span class="num" id="5941795">13</span><span class="op" id="5941797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941800">tReserved2</span>&nbsp;<span class="op" id="5941811">=</span>&nbsp;<span class="ident" id="5941813">bootstrapType</span><span class="op" id="5941826">(</span><span class="string" id="5941827">&#34;_reserved1&#34;</span><span class="op" id="5941839">,</span>&nbsp;<span class="op" id="5941841">(</span><span class="op" id="5941842">*</span><span class="keyword" id="5941843">struct</span><span class="op" id="5941849">{</span>&nbsp;<span class="ident" id="5941851">r2</span>&nbsp;<span class="builtintype" id="5941854">int</span>&nbsp;<span class="op" id="5941858">}</span><span class="op" id="5941859">)</span><span class="op" id="5941860">(</span><span class="builtintype" id="5941861">nil</span><span class="op" id="5941864">)</span><span class="op" id="5941865">,</span>&nbsp;<span class="num" id="5941867">14</span><span class="op" id="5941869">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941872">tReserved1</span>&nbsp;<span class="op" id="5941883">=</span>&nbsp;<span class="ident" id="5941885">bootstrapType</span><span class="op" id="5941898">(</span><span class="string" id="5941899">&#34;_reserved1&#34;</span><span class="op" id="5941911">,</span>&nbsp;<span class="op" id="5941913">(</span><span class="op" id="5941914">*</span><span class="keyword" id="5941915">struct</span><span class="op" id="5941921">{</span>&nbsp;<span class="ident" id="5941923">r1</span>&nbsp;<span class="builtintype" id="5941926">int</span>&nbsp;<span class="op" id="5941930">}</span><span class="op" id="5941931">)</span><span class="op" id="5941932">(</span><span class="builtintype" id="5941933">nil</span><span class="op" id="5941936">)</span><span class="op" id="5941937">,</span>&nbsp;<span class="num" id="5941939">15</span><span class="op" id="5941941">)</span><br>
<span class="lineno"></span><span class="op" id="5941943">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5941946">//&nbsp;Predefined&nbsp;because&nbsp;it&#39;s&nbsp;needed&nbsp;by&nbsp;the&nbsp;Decoder</span><br>
<span class="lineno"></span><span class="keyword" id="5941995">var</span>&nbsp;<span class="ident" id="5941999">tWireType</span>&nbsp;<span class="op" id="5942009">=</span>&nbsp;<span class="ident" id="5942011">mustGetTypeInfo</span><span class="op" id="5942026">(</span><span class="ident" id="5942027">reflect</span><span class="op" id="5942034">.</span><span class="ident" id="5942035">TypeOf</span><span class="op" id="5942041">(</span><span class="ident" id="5942042">wireType</span><span class="op" id="5942050">{</span><span class="op" id="5942051">}</span><span class="op" id="5942052">)</span><span class="op" id="5942053">)</span><span class="op" id="5942054">.</span><span class="ident" id="5942055">id</span><br>
<span class="lineno">270</span><span class="keyword" id="5942058">var</span>&nbsp;<span class="ident" id="5942062">wireTypeUserInfo</span>&nbsp;<span class="op" id="5942079">*</span><span class="ident" id="5942080">userTypeInfo</span>&nbsp;<span class="comment" id="5942093">//&nbsp;userTypeInfo&nbsp;of&nbsp;(*wireType)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5942125">func</span>&nbsp;<span class="ident" id="5942130">init</span><span class="op" id="5942134">(</span><span class="op" id="5942135">)</span>&nbsp;<span class="op" id="5942137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5942140">//&nbsp;Some&nbsp;magic&nbsp;numbers&nbsp;to&nbsp;make&nbsp;sure&nbsp;there&nbsp;are&nbsp;no&nbsp;surprises.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942200">checkId</span><span class="op" id="5942207">(</span><span class="num" id="5942208">16</span><span class="op" id="5942210">,</span>&nbsp;<span class="ident" id="5942212">tWireType</span><span class="op" id="5942221">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942224">checkId</span><span class="op" id="5942231">(</span><span class="num" id="5942232">17</span><span class="op" id="5942234">,</span>&nbsp;<span class="ident" id="5942236">mustGetTypeInfo</span><span class="op" id="5942251">(</span><span class="ident" id="5942252">reflect</span><span class="op" id="5942259">.</span><span class="ident" id="5942260">TypeOf</span><span class="op" id="5942266">(</span><span class="ident" id="5942267">arrayType</span><span class="op" id="5942276">{</span><span class="op" id="5942277">}</span><span class="op" id="5942278">)</span><span class="op" id="5942279">)</span><span class="op" id="5942280">.</span><span class="ident" id="5942281">id</span><span class="op" id="5942283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942286">checkId</span><span class="op" id="5942293">(</span><span class="num" id="5942294">18</span><span class="op" id="5942296">,</span>&nbsp;<span class="ident" id="5942298">mustGetTypeInfo</span><span class="op" id="5942313">(</span><span class="ident" id="5942314">reflect</span><span class="op" id="5942321">.</span><span class="ident" id="5942322">TypeOf</span><span class="op" id="5942328">(</span><span class="ident" id="5942329">CommonType</span><span class="op" id="5942339">{</span><span class="op" id="5942340">}</span><span class="op" id="5942341">)</span><span class="op" id="5942342">)</span><span class="op" id="5942343">.</span><span class="ident" id="5942344">id</span><span class="op" id="5942346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942349">checkId</span><span class="op" id="5942356">(</span><span class="num" id="5942357">19</span><span class="op" id="5942359">,</span>&nbsp;<span class="ident" id="5942361">mustGetTypeInfo</span><span class="op" id="5942376">(</span><span class="ident" id="5942377">reflect</span><span class="op" id="5942384">.</span><span class="ident" id="5942385">TypeOf</span><span class="op" id="5942391">(</span><span class="ident" id="5942392">sliceType</span><span class="op" id="5942401">{</span><span class="op" id="5942402">}</span><span class="op" id="5942403">)</span><span class="op" id="5942404">)</span><span class="op" id="5942405">.</span><span class="ident" id="5942406">id</span><span class="op" id="5942408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942411">checkId</span><span class="op" id="5942418">(</span><span class="num" id="5942419">20</span><span class="op" id="5942421">,</span>&nbsp;<span class="ident" id="5942423">mustGetTypeInfo</span><span class="op" id="5942438">(</span><span class="ident" id="5942439">reflect</span><span class="op" id="5942446">.</span><span class="ident" id="5942447">TypeOf</span><span class="op" id="5942453">(</span><span class="ident" id="5942454">structType</span><span class="op" id="5942464">{</span><span class="op" id="5942465">}</span><span class="op" id="5942466">)</span><span class="op" id="5942467">)</span><span class="op" id="5942468">.</span><span class="ident" id="5942469">id</span><span class="op" id="5942471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942474">checkId</span><span class="op" id="5942481">(</span><span class="num" id="5942482">21</span><span class="op" id="5942484">,</span>&nbsp;<span class="ident" id="5942486">mustGetTypeInfo</span><span class="op" id="5942501">(</span><span class="ident" id="5942502">reflect</span><span class="op" id="5942509">.</span><span class="ident" id="5942510">TypeOf</span><span class="op" id="5942516">(</span><span class="ident" id="5942517">fieldType</span><span class="op" id="5942526">{</span><span class="op" id="5942527">}</span><span class="op" id="5942528">)</span><span class="op" id="5942529">)</span><span class="op" id="5942530">.</span><span class="ident" id="5942531">id</span><span class="op" id="5942533">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942536">checkId</span><span class="op" id="5942543">(</span><span class="num" id="5942544">23</span><span class="op" id="5942546">,</span>&nbsp;<span class="ident" id="5942548">mustGetTypeInfo</span><span class="op" id="5942563">(</span><span class="ident" id="5942564">reflect</span><span class="op" id="5942571">.</span><span class="ident" id="5942572">TypeOf</span><span class="op" id="5942578">(</span><span class="ident" id="5942579">mapType</span><span class="op" id="5942586">{</span><span class="op" id="5942587">}</span><span class="op" id="5942588">)</span><span class="op" id="5942589">)</span><span class="op" id="5942590">.</span><span class="ident" id="5942591">id</span><span class="op" id="5942593">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942597">builtinIdToType</span>&nbsp;<span class="op" id="5942613">=</span>&nbsp;<span class="builtinfunc" id="5942615">make</span><span class="op" id="5942619">(</span><span class="keyword" id="5942620">map</span><span class="op" id="5942623">[</span><span class="ident" id="5942624">typeId</span><span class="op" id="5942630">]</span><span class="ident" id="5942631">gobType</span><span class="op" id="5942638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5942641">for</span>&nbsp;<span class="ident" id="5942645">k</span><span class="op" id="5942646">,</span>&nbsp;<span class="ident" id="5942648">v</span>&nbsp;<span class="op" id="5942650">:=</span>&nbsp;<span class="keyword" id="5942653">range</span>&nbsp;<span class="ident" id="5942659">idToType</span>&nbsp;<span class="op" id="5942668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942672">builtinIdToType</span><span class="op" id="5942687">[</span><span class="ident" id="5942688">k</span><span class="op" id="5942689">]</span>&nbsp;<span class="op" id="5942691">=</span>&nbsp;<span class="ident" id="5942693">v</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5942696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5942700">//&nbsp;Move&nbsp;the&nbsp;id&nbsp;space&nbsp;upwards&nbsp;to&nbsp;allow&nbsp;for&nbsp;growth&nbsp;in&nbsp;the&nbsp;predefined&nbsp;world</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5942774">//&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5942811">if</span>&nbsp;<span class="ident" id="5942814">nextId</span>&nbsp;<span class="op" id="5942821">&gt;</span>&nbsp;<span class="ident" id="5942823">firstUserId</span>&nbsp;<span class="op" id="5942835">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5942839">panic</span><span class="op" id="5942844">(</span><span class="ident" id="5942845">fmt</span><span class="op" id="5942848">.</span><span class="ident" id="5942849">Sprintln</span><span class="op" id="5942857">(</span><span class="string" id="5942858">&#34;nextId&nbsp;too&nbsp;large:&#34;</span><span class="op" id="5942877">,</span>&nbsp;<span class="ident" id="5942879">nextId</span><span class="op" id="5942885">)</span><span class="op" id="5942886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5942889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942892">nextId</span>&nbsp;<span class="op" id="5942899">=</span>&nbsp;<span class="ident" id="5942901">firstUserId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942914">registerBasics</span><span class="op" id="5942928">(</span><span class="op" id="5942929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942932">wireTypeUserInfo</span>&nbsp;<span class="op" id="5942949">=</span>&nbsp;<span class="ident" id="5942951">userType</span><span class="op" id="5942959">(</span><span class="ident" id="5942960">reflect</span><span class="op" id="5942967">.</span><span class="ident" id="5942968">TypeOf</span><span class="op" id="5942974">(</span><span class="op" id="5942975">(</span><span class="op" id="5942976">*</span><span class="ident" id="5942977">wireType</span><span class="op" id="5942985">)</span><span class="op" id="5942986">(</span><span class="builtintype" id="5942987">nil</span><span class="op" id="5942990">)</span><span class="op" id="5942991">)</span><span class="op" id="5942992">)</span><br>
<span class="lineno">295</span><span class="op" id="5942994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5942997">//&nbsp;Array&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="5943011">type</span>&nbsp;<span class="ident" id="5943016">arrayType</span>&nbsp;<span class="keyword" id="5943026">struct</span>&nbsp;<span class="op" id="5943033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943036">CommonType</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943048">Elem</span>&nbsp;<span class="ident" id="5943053">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943061">Len</span>&nbsp;&nbsp;<span class="builtintype" id="5943066">int</span><br>
<span class="lineno"></span><span class="op" id="5943070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5943073">func</span>&nbsp;<span class="ident" id="5943078">newArrayType</span><span class="op" id="5943090">(</span><span class="ident" id="5943091">name</span>&nbsp;<span class="builtintype" id="5943096">string</span><span class="op" id="5943102">)</span>&nbsp;<span class="op" id="5943104">*</span><span class="ident" id="5943105">arrayType</span>&nbsp;<span class="op" id="5943115">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943118">a</span>&nbsp;<span class="op" id="5943120">:=</span>&nbsp;<span class="op" id="5943123">&amp;</span><span class="ident" id="5943124">arrayType</span><span class="op" id="5943133">{</span><span class="ident" id="5943134">CommonType</span><span class="op" id="5943144">{</span><span class="ident" id="5943145">Name</span><span class="op" id="5943149">:</span>&nbsp;<span class="ident" id="5943151">name</span><span class="op" id="5943155">}</span><span class="op" id="5943156">,</span>&nbsp;<span class="num" id="5943158">0</span><span class="op" id="5943159">,</span>&nbsp;<span class="num" id="5943161">0</span><span class="op" id="5943162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5943165">return</span>&nbsp;<span class="ident" id="5943172">a</span><br>
<span class="lineno"></span><span class="op" id="5943174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5943177">func</span>&nbsp;<span class="op" id="5943182">(</span><span class="ident" id="5943183">a</span>&nbsp;<span class="op" id="5943185">*</span><span class="ident" id="5943186">arrayType</span><span class="op" id="5943195">)</span>&nbsp;<span class="ident" id="5943197">init</span><span class="op" id="5943201">(</span><span class="ident" id="5943202">elem</span>&nbsp;<span class="ident" id="5943207">gobType</span><span class="op" id="5943214">,</span>&nbsp;<span class="builtinfunc" id="5943216">len</span>&nbsp;<span class="builtintype" id="5943220">int</span><span class="op" id="5943223">)</span>&nbsp;<span class="op" id="5943225">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5943228">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943303">setTypeId</span><span class="op" id="5943312">(</span><span class="ident" id="5943313">a</span><span class="op" id="5943314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943317">a</span><span class="op" id="5943318">.</span><span class="ident" id="5943319">Elem</span>&nbsp;<span class="op" id="5943324">=</span>&nbsp;<span class="ident" id="5943326">elem</span><span class="op" id="5943330">.</span><span class="ident" id="5943331">id</span><span class="op" id="5943333">(</span><span class="op" id="5943334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943337">a</span><span class="op" id="5943338">.</span><span class="ident" id="5943339">Len</span>&nbsp;<span class="op" id="5943343">=</span>&nbsp;<span class="builtinfunc" id="5943345">len</span><br>
<span class="lineno"></span><span class="op" id="5943349">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="5943352">func</span>&nbsp;<span class="op" id="5943357">(</span><span class="ident" id="5943358">a</span>&nbsp;<span class="op" id="5943360">*</span><span class="ident" id="5943361">arrayType</span><span class="op" id="5943370">)</span>&nbsp;<span class="ident" id="5943372">safeString</span><span class="op" id="5943382">(</span><span class="ident" id="5943383">seen</span>&nbsp;<span class="keyword" id="5943388">map</span><span class="op" id="5943391">[</span><span class="ident" id="5943392">typeId</span><span class="op" id="5943398">]</span><span class="builtintype" id="5943399">bool</span><span class="op" id="5943403">)</span>&nbsp;<span class="builtintype" id="5943405">string</span>&nbsp;<span class="op" id="5943412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5943415">if</span>&nbsp;<span class="ident" id="5943418">seen</span><span class="op" id="5943422">[</span><span class="ident" id="5943423">a</span><span class="op" id="5943424">.</span><span class="ident" id="5943425">Id</span><span class="op" id="5943427">]</span>&nbsp;<span class="op" id="5943429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5943433">return</span>&nbsp;<span class="ident" id="5943440">a</span><span class="op" id="5943441">.</span><span class="ident" id="5943442">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5943448">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943451">seen</span><span class="op" id="5943455">[</span><span class="ident" id="5943456">a</span><span class="op" id="5943457">.</span><span class="ident" id="5943458">Id</span><span class="op" id="5943460">]</span>&nbsp;<span class="op" id="5943462">=</span>&nbsp;<span class="builtintype" id="5943464">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5943470">return</span>&nbsp;<span class="ident" id="5943477">fmt</span><span class="op" id="5943480">.</span><span class="ident" id="5943481">Sprintf</span><span class="op" id="5943488">(</span><span class="string" id="5943489">&#34;[%d]%s&#34;</span><span class="op" id="5943497">,</span>&nbsp;<span class="ident" id="5943499">a</span><span class="op" id="5943500">.</span><span class="ident" id="5943501">Len</span><span class="op" id="5943504">,</span>&nbsp;<span class="ident" id="5943506">a</span><span class="op" id="5943507">.</span><span class="ident" id="5943508">Elem</span><span class="op" id="5943512">.</span><span class="ident" id="5943513">gobType</span><span class="op" id="5943520">(</span><span class="op" id="5943521">)</span><span class="op" id="5943522">.</span><span class="ident" id="5943523">safeString</span><span class="op" id="5943533">(</span><span class="ident" id="5943534">seen</span><span class="op" id="5943538">)</span><span class="op" id="5943539">)</span><br>
<span class="lineno"></span><span class="op" id="5943541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5943544">func</span>&nbsp;<span class="op" id="5943549">(</span><span class="ident" id="5943550">a</span>&nbsp;<span class="op" id="5943552">*</span><span class="ident" id="5943553">arrayType</span><span class="op" id="5943562">)</span>&nbsp;<span class="builtintype" id="5943564">string</span><span class="op" id="5943570">(</span><span class="op" id="5943571">)</span>&nbsp;<span class="builtintype" id="5943573">string</span>&nbsp;<span class="op" id="5943580">{</span>&nbsp;<span class="keyword" id="5943582">return</span>&nbsp;<span class="ident" id="5943589">a</span><span class="op" id="5943590">.</span><span class="ident" id="5943591">safeString</span><span class="op" id="5943601">(</span><span class="builtinfunc" id="5943602">make</span><span class="op" id="5943606">(</span><span class="keyword" id="5943607">map</span><span class="op" id="5943610">[</span><span class="ident" id="5943611">typeId</span><span class="op" id="5943617">]</span><span class="builtintype" id="5943618">bool</span><span class="op" id="5943622">)</span><span class="op" id="5943623">)</span>&nbsp;<span class="op" id="5943625">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="5943628">//&nbsp;GobEncoder&nbsp;type&nbsp;(something&nbsp;that&nbsp;implements&nbsp;the&nbsp;GobEncoder&nbsp;interface)</span><br>
<span class="lineno"></span><span class="keyword" id="5943700">type</span>&nbsp;<span class="ident" id="5943705">gobEncoderType</span>&nbsp;<span class="keyword" id="5943720">struct</span>&nbsp;<span class="op" id="5943727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943730">CommonType</span><br>
<span class="lineno"></span><span class="op" id="5943741">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="5943744">func</span>&nbsp;<span class="ident" id="5943749">newGobEncoderType</span><span class="op" id="5943766">(</span><span class="ident" id="5943767">name</span>&nbsp;<span class="builtintype" id="5943772">string</span><span class="op" id="5943778">)</span>&nbsp;<span class="op" id="5943780">*</span><span class="ident" id="5943781">gobEncoderType</span>&nbsp;<span class="op" id="5943796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943799">g</span>&nbsp;<span class="op" id="5943801">:=</span>&nbsp;<span class="op" id="5943804">&amp;</span><span class="ident" id="5943805">gobEncoderType</span><span class="op" id="5943819">{</span><span class="ident" id="5943820">CommonType</span><span class="op" id="5943830">{</span><span class="ident" id="5943831">Name</span><span class="op" id="5943835">:</span>&nbsp;<span class="ident" id="5943837">name</span><span class="op" id="5943841">}</span><span class="op" id="5943842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943845">setTypeId</span><span class="op" id="5943854">(</span><span class="ident" id="5943855">g</span><span class="op" id="5943856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5943859">return</span>&nbsp;<span class="ident" id="5943866">g</span><br>
<span class="lineno">335</span><span class="op" id="5943868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5943871">func</span>&nbsp;<span class="op" id="5943876">(</span><span class="ident" id="5943877">g</span>&nbsp;<span class="op" id="5943879">*</span><span class="ident" id="5943880">gobEncoderType</span><span class="op" id="5943894">)</span>&nbsp;<span class="ident" id="5943896">safeString</span><span class="op" id="5943906">(</span><span class="ident" id="5943907">seen</span>&nbsp;<span class="keyword" id="5943912">map</span><span class="op" id="5943915">[</span><span class="ident" id="5943916">typeId</span><span class="op" id="5943922">]</span><span class="builtintype" id="5943923">bool</span><span class="op" id="5943927">)</span>&nbsp;<span class="builtintype" id="5943929">string</span>&nbsp;<span class="op" id="5943936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5943939">return</span>&nbsp;<span class="ident" id="5943946">g</span><span class="op" id="5943947">.</span><span class="ident" id="5943948">Name</span><br>
<span class="lineno"></span><span class="op" id="5943953">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="keyword" id="5943956">func</span>&nbsp;<span class="op" id="5943961">(</span><span class="ident" id="5943962">g</span>&nbsp;<span class="op" id="5943964">*</span><span class="ident" id="5943965">gobEncoderType</span><span class="op" id="5943979">)</span>&nbsp;<span class="builtintype" id="5943981">string</span><span class="op" id="5943987">(</span><span class="op" id="5943988">)</span>&nbsp;<span class="builtintype" id="5943990">string</span>&nbsp;<span class="op" id="5943997">{</span>&nbsp;<span class="keyword" id="5943999">return</span>&nbsp;<span class="ident" id="5944006">g</span><span class="op" id="5944007">.</span><span class="ident" id="5944008">Name</span>&nbsp;<span class="op" id="5944013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5944016">//&nbsp;Map&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="5944028">type</span>&nbsp;<span class="ident" id="5944033">mapType</span>&nbsp;<span class="keyword" id="5944041">struct</span>&nbsp;<span class="op" id="5944048">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944051">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944063">Key</span>&nbsp;&nbsp;<span class="ident" id="5944068">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944076">Elem</span>&nbsp;<span class="ident" id="5944081">typeId</span><br>
<span class="lineno"></span><span class="op" id="5944088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="5944091">func</span>&nbsp;<span class="ident" id="5944096">newMapType</span><span class="op" id="5944106">(</span><span class="ident" id="5944107">name</span>&nbsp;<span class="builtintype" id="5944112">string</span><span class="op" id="5944118">)</span>&nbsp;<span class="op" id="5944120">*</span><span class="ident" id="5944121">mapType</span>&nbsp;<span class="op" id="5944129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944132">m</span>&nbsp;<span class="op" id="5944134">:=</span>&nbsp;<span class="op" id="5944137">&amp;</span><span class="ident" id="5944138">mapType</span><span class="op" id="5944145">{</span><span class="ident" id="5944146">CommonType</span><span class="op" id="5944156">{</span><span class="ident" id="5944157">Name</span><span class="op" id="5944161">:</span>&nbsp;<span class="ident" id="5944163">name</span><span class="op" id="5944167">}</span><span class="op" id="5944168">,</span>&nbsp;<span class="num" id="5944170">0</span><span class="op" id="5944171">,</span>&nbsp;<span class="num" id="5944173">0</span><span class="op" id="5944174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944177">return</span>&nbsp;<span class="ident" id="5944184">m</span><br>
<span class="lineno"></span><span class="op" id="5944186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="5944189">func</span>&nbsp;<span class="op" id="5944194">(</span><span class="ident" id="5944195">m</span>&nbsp;<span class="op" id="5944197">*</span><span class="ident" id="5944198">mapType</span><span class="op" id="5944205">)</span>&nbsp;<span class="ident" id="5944207">init</span><span class="op" id="5944211">(</span><span class="ident" id="5944212">key</span><span class="op" id="5944215">,</span>&nbsp;<span class="ident" id="5944217">elem</span>&nbsp;<span class="ident" id="5944222">gobType</span><span class="op" id="5944229">)</span>&nbsp;<span class="op" id="5944231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5944234">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944309">setTypeId</span><span class="op" id="5944318">(</span><span class="ident" id="5944319">m</span><span class="op" id="5944320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944323">m</span><span class="op" id="5944324">.</span><span class="ident" id="5944325">Key</span>&nbsp;<span class="op" id="5944329">=</span>&nbsp;<span class="ident" id="5944331">key</span><span class="op" id="5944334">.</span><span class="ident" id="5944335">id</span><span class="op" id="5944337">(</span><span class="op" id="5944338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944341">m</span><span class="op" id="5944342">.</span><span class="ident" id="5944343">Elem</span>&nbsp;<span class="op" id="5944348">=</span>&nbsp;<span class="ident" id="5944350">elem</span><span class="op" id="5944354">.</span><span class="ident" id="5944355">id</span><span class="op" id="5944357">(</span><span class="op" id="5944358">)</span><br>
<span class="lineno">360</span><span class="op" id="5944360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5944363">func</span>&nbsp;<span class="op" id="5944368">(</span><span class="ident" id="5944369">m</span>&nbsp;<span class="op" id="5944371">*</span><span class="ident" id="5944372">mapType</span><span class="op" id="5944379">)</span>&nbsp;<span class="ident" id="5944381">safeString</span><span class="op" id="5944391">(</span><span class="ident" id="5944392">seen</span>&nbsp;<span class="keyword" id="5944397">map</span><span class="op" id="5944400">[</span><span class="ident" id="5944401">typeId</span><span class="op" id="5944407">]</span><span class="builtintype" id="5944408">bool</span><span class="op" id="5944412">)</span>&nbsp;<span class="builtintype" id="5944414">string</span>&nbsp;<span class="op" id="5944421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944424">if</span>&nbsp;<span class="ident" id="5944427">seen</span><span class="op" id="5944431">[</span><span class="ident" id="5944432">m</span><span class="op" id="5944433">.</span><span class="ident" id="5944434">Id</span><span class="op" id="5944436">]</span>&nbsp;<span class="op" id="5944438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944442">return</span>&nbsp;<span class="ident" id="5944449">m</span><span class="op" id="5944450">.</span><span class="ident" id="5944451">Name</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5944457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944460">seen</span><span class="op" id="5944464">[</span><span class="ident" id="5944465">m</span><span class="op" id="5944466">.</span><span class="ident" id="5944467">Id</span><span class="op" id="5944469">]</span>&nbsp;<span class="op" id="5944471">=</span>&nbsp;<span class="builtintype" id="5944473">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944479">key</span>&nbsp;<span class="op" id="5944483">:=</span>&nbsp;<span class="ident" id="5944486">m</span><span class="op" id="5944487">.</span><span class="ident" id="5944488">Key</span><span class="op" id="5944491">.</span><span class="ident" id="5944492">gobType</span><span class="op" id="5944499">(</span><span class="op" id="5944500">)</span><span class="op" id="5944501">.</span><span class="ident" id="5944502">safeString</span><span class="op" id="5944512">(</span><span class="ident" id="5944513">seen</span><span class="op" id="5944517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944520">elem</span>&nbsp;<span class="op" id="5944525">:=</span>&nbsp;<span class="ident" id="5944528">m</span><span class="op" id="5944529">.</span><span class="ident" id="5944530">Elem</span><span class="op" id="5944534">.</span><span class="ident" id="5944535">gobType</span><span class="op" id="5944542">(</span><span class="op" id="5944543">)</span><span class="op" id="5944544">.</span><span class="ident" id="5944545">safeString</span><span class="op" id="5944555">(</span><span class="ident" id="5944556">seen</span><span class="op" id="5944560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944563">return</span>&nbsp;<span class="ident" id="5944570">fmt</span><span class="op" id="5944573">.</span><span class="ident" id="5944574">Sprintf</span><span class="op" id="5944581">(</span><span class="string" id="5944582">&#34;map[%s]%s&#34;</span><span class="op" id="5944593">,</span>&nbsp;<span class="ident" id="5944595">key</span><span class="op" id="5944598">,</span>&nbsp;<span class="ident" id="5944600">elem</span><span class="op" id="5944604">)</span><br>
<span class="lineno">370</span><span class="op" id="5944606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5944609">func</span>&nbsp;<span class="op" id="5944614">(</span><span class="ident" id="5944615">m</span>&nbsp;<span class="op" id="5944617">*</span><span class="ident" id="5944618">mapType</span><span class="op" id="5944625">)</span>&nbsp;<span class="builtintype" id="5944627">string</span><span class="op" id="5944633">(</span><span class="op" id="5944634">)</span>&nbsp;<span class="builtintype" id="5944636">string</span>&nbsp;<span class="op" id="5944643">{</span>&nbsp;<span class="keyword" id="5944645">return</span>&nbsp;<span class="ident" id="5944652">m</span><span class="op" id="5944653">.</span><span class="ident" id="5944654">safeString</span><span class="op" id="5944664">(</span><span class="builtinfunc" id="5944665">make</span><span class="op" id="5944669">(</span><span class="keyword" id="5944670">map</span><span class="op" id="5944673">[</span><span class="ident" id="5944674">typeId</span><span class="op" id="5944680">]</span><span class="builtintype" id="5944681">bool</span><span class="op" id="5944685">)</span><span class="op" id="5944686">)</span>&nbsp;<span class="op" id="5944688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5944691">//&nbsp;Slice&nbsp;type</span><br>
<span class="lineno">375</span><span class="keyword" id="5944705">type</span>&nbsp;<span class="ident" id="5944710">sliceType</span>&nbsp;<span class="keyword" id="5944720">struct</span>&nbsp;<span class="op" id="5944727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944730">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944742">Elem</span>&nbsp;<span class="ident" id="5944747">typeId</span><br>
<span class="lineno"></span><span class="op" id="5944754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="5944757">func</span>&nbsp;<span class="ident" id="5944762">newSliceType</span><span class="op" id="5944774">(</span><span class="ident" id="5944775">name</span>&nbsp;<span class="builtintype" id="5944780">string</span><span class="op" id="5944786">)</span>&nbsp;<span class="op" id="5944788">*</span><span class="ident" id="5944789">sliceType</span>&nbsp;<span class="op" id="5944799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944802">s</span>&nbsp;<span class="op" id="5944804">:=</span>&nbsp;<span class="op" id="5944807">&amp;</span><span class="ident" id="5944808">sliceType</span><span class="op" id="5944817">{</span><span class="ident" id="5944818">CommonType</span><span class="op" id="5944828">{</span><span class="ident" id="5944829">Name</span><span class="op" id="5944833">:</span>&nbsp;<span class="ident" id="5944835">name</span><span class="op" id="5944839">}</span><span class="op" id="5944840">,</span>&nbsp;<span class="num" id="5944842">0</span><span class="op" id="5944843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944846">return</span>&nbsp;<span class="ident" id="5944853">s</span><br>
<span class="lineno"></span><span class="op" id="5944855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="5944858">func</span>&nbsp;<span class="op" id="5944863">(</span><span class="ident" id="5944864">s</span>&nbsp;<span class="op" id="5944866">*</span><span class="ident" id="5944867">sliceType</span><span class="op" id="5944876">)</span>&nbsp;<span class="ident" id="5944878">init</span><span class="op" id="5944882">(</span><span class="ident" id="5944883">elem</span>&nbsp;<span class="ident" id="5944888">gobType</span><span class="op" id="5944895">)</span>&nbsp;<span class="op" id="5944897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5944900">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944975">setTypeId</span><span class="op" id="5944984">(</span><span class="ident" id="5944985">s</span><span class="op" id="5944986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5944989">//&nbsp;See&nbsp;the&nbsp;comments&nbsp;about&nbsp;ids&nbsp;in&nbsp;newTypeObject.&nbsp;Only&nbsp;slices&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5945054">//&nbsp;structs&nbsp;have&nbsp;mutual&nbsp;recursion.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945089">if</span>&nbsp;<span class="ident" id="5945092">elem</span><span class="op" id="5945096">.</span><span class="ident" id="5945097">id</span><span class="op" id="5945099">(</span><span class="op" id="5945100">)</span>&nbsp;<span class="op" id="5945102">==</span>&nbsp;<span class="num" id="5945105">0</span>&nbsp;<span class="op" id="5945107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945111">setTypeId</span><span class="op" id="5945120">(</span><span class="ident" id="5945121">elem</span><span class="op" id="5945125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5945128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945131">s</span><span class="op" id="5945132">.</span><span class="ident" id="5945133">Elem</span>&nbsp;<span class="op" id="5945138">=</span>&nbsp;<span class="ident" id="5945140">elem</span><span class="op" id="5945144">.</span><span class="ident" id="5945145">id</span><span class="op" id="5945147">(</span><span class="op" id="5945148">)</span><br>
<span class="lineno"></span><span class="op" id="5945150">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="5945153">func</span>&nbsp;<span class="op" id="5945158">(</span><span class="ident" id="5945159">s</span>&nbsp;<span class="op" id="5945161">*</span><span class="ident" id="5945162">sliceType</span><span class="op" id="5945171">)</span>&nbsp;<span class="ident" id="5945173">safeString</span><span class="op" id="5945183">(</span><span class="ident" id="5945184">seen</span>&nbsp;<span class="keyword" id="5945189">map</span><span class="op" id="5945192">[</span><span class="ident" id="5945193">typeId</span><span class="op" id="5945199">]</span><span class="builtintype" id="5945200">bool</span><span class="op" id="5945204">)</span>&nbsp;<span class="builtintype" id="5945206">string</span>&nbsp;<span class="op" id="5945213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945216">if</span>&nbsp;<span class="ident" id="5945219">seen</span><span class="op" id="5945223">[</span><span class="ident" id="5945224">s</span><span class="op" id="5945225">.</span><span class="ident" id="5945226">Id</span><span class="op" id="5945228">]</span>&nbsp;<span class="op" id="5945230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945234">return</span>&nbsp;<span class="ident" id="5945241">s</span><span class="op" id="5945242">.</span><span class="ident" id="5945243">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5945249">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945252">seen</span><span class="op" id="5945256">[</span><span class="ident" id="5945257">s</span><span class="op" id="5945258">.</span><span class="ident" id="5945259">Id</span><span class="op" id="5945261">]</span>&nbsp;<span class="op" id="5945263">=</span>&nbsp;<span class="builtintype" id="5945265">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945271">return</span>&nbsp;<span class="ident" id="5945278">fmt</span><span class="op" id="5945281">.</span><span class="ident" id="5945282">Sprintf</span><span class="op" id="5945289">(</span><span class="string" id="5945290">&#34;[]%s&#34;</span><span class="op" id="5945296">,</span>&nbsp;<span class="ident" id="5945298">s</span><span class="op" id="5945299">.</span><span class="ident" id="5945300">Elem</span><span class="op" id="5945304">.</span><span class="ident" id="5945305">gobType</span><span class="op" id="5945312">(</span><span class="op" id="5945313">)</span><span class="op" id="5945314">.</span><span class="ident" id="5945315">safeString</span><span class="op" id="5945325">(</span><span class="ident" id="5945326">seen</span><span class="op" id="5945330">)</span><span class="op" id="5945331">)</span><br>
<span class="lineno"></span><span class="op" id="5945333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5945336">func</span>&nbsp;<span class="op" id="5945341">(</span><span class="ident" id="5945342">s</span>&nbsp;<span class="op" id="5945344">*</span><span class="ident" id="5945345">sliceType</span><span class="op" id="5945354">)</span>&nbsp;<span class="builtintype" id="5945356">string</span><span class="op" id="5945362">(</span><span class="op" id="5945363">)</span>&nbsp;<span class="builtintype" id="5945365">string</span>&nbsp;<span class="op" id="5945372">{</span>&nbsp;<span class="keyword" id="5945374">return</span>&nbsp;<span class="ident" id="5945381">s</span><span class="op" id="5945382">.</span><span class="ident" id="5945383">safeString</span><span class="op" id="5945393">(</span><span class="builtinfunc" id="5945394">make</span><span class="op" id="5945398">(</span><span class="keyword" id="5945399">map</span><span class="op" id="5945402">[</span><span class="ident" id="5945403">typeId</span><span class="op" id="5945409">]</span><span class="builtintype" id="5945410">bool</span><span class="op" id="5945414">)</span><span class="op" id="5945415">)</span>&nbsp;<span class="op" id="5945417">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="5945420">//&nbsp;Struct&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="5945435">type</span>&nbsp;<span class="ident" id="5945440">fieldType</span>&nbsp;<span class="keyword" id="5945450">struct</span>&nbsp;<span class="op" id="5945457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945460">Name</span>&nbsp;<span class="builtintype" id="5945465">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945473">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5945478">typeId</span><br>
<span class="lineno">410</span><span class="op" id="5945485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5945488">type</span>&nbsp;<span class="ident" id="5945493">structType</span>&nbsp;<span class="keyword" id="5945504">struct</span>&nbsp;<span class="op" id="5945511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945514">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945526">Field</span>&nbsp;<span class="op" id="5945532">[</span><span class="op" id="5945533">]</span><span class="op" id="5945534">*</span><span class="ident" id="5945535">fieldType</span><br>
<span class="lineno">415</span><span class="op" id="5945545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5945548">func</span>&nbsp;<span class="op" id="5945553">(</span><span class="ident" id="5945554">s</span>&nbsp;<span class="op" id="5945556">*</span><span class="ident" id="5945557">structType</span><span class="op" id="5945567">)</span>&nbsp;<span class="ident" id="5945569">safeString</span><span class="op" id="5945579">(</span><span class="ident" id="5945580">seen</span>&nbsp;<span class="keyword" id="5945585">map</span><span class="op" id="5945588">[</span><span class="ident" id="5945589">typeId</span><span class="op" id="5945595">]</span><span class="builtintype" id="5945596">bool</span><span class="op" id="5945600">)</span>&nbsp;<span class="builtintype" id="5945602">string</span>&nbsp;<span class="op" id="5945609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945612">if</span>&nbsp;<span class="ident" id="5945615">s</span>&nbsp;<span class="op" id="5945617">==</span>&nbsp;<span class="builtintype" id="5945620">nil</span>&nbsp;<span class="op" id="5945624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945628">return</span>&nbsp;<span class="string" id="5945635">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5945644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945647">if</span>&nbsp;<span class="ident" id="5945650">_</span><span class="op" id="5945651">,</span>&nbsp;<span class="ident" id="5945653">ok</span>&nbsp;<span class="op" id="5945656">:=</span>&nbsp;<span class="ident" id="5945659">seen</span><span class="op" id="5945663">[</span><span class="ident" id="5945664">s</span><span class="op" id="5945665">.</span><span class="ident" id="5945666">Id</span><span class="op" id="5945668">]</span><span class="op" id="5945669">;</span>&nbsp;<span class="ident" id="5945671">ok</span>&nbsp;<span class="op" id="5945674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945678">return</span>&nbsp;<span class="ident" id="5945685">s</span><span class="op" id="5945686">.</span><span class="ident" id="5945687">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5945693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945696">seen</span><span class="op" id="5945700">[</span><span class="ident" id="5945701">s</span><span class="op" id="5945702">.</span><span class="ident" id="5945703">Id</span><span class="op" id="5945705">]</span>&nbsp;<span class="op" id="5945707">=</span>&nbsp;<span class="builtintype" id="5945709">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945715">str</span>&nbsp;<span class="op" id="5945719">:=</span>&nbsp;<span class="ident" id="5945722">s</span><span class="op" id="5945723">.</span><span class="ident" id="5945724">Name</span>&nbsp;<span class="op" id="5945729">+</span>&nbsp;<span class="string" id="5945731">&#34;&nbsp;=&nbsp;struct&nbsp;{&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945747">for</span>&nbsp;<span class="ident" id="5945751">_</span><span class="op" id="5945752">,</span>&nbsp;<span class="ident" id="5945754">f</span>&nbsp;<span class="op" id="5945756">:=</span>&nbsp;<span class="keyword" id="5945759">range</span>&nbsp;<span class="ident" id="5945765">s</span><span class="op" id="5945766">.</span><span class="ident" id="5945767">Field</span>&nbsp;<span class="op" id="5945773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945777">str</span>&nbsp;<span class="op" id="5945781">+=</span>&nbsp;<span class="ident" id="5945784">fmt</span><span class="op" id="5945787">.</span><span class="ident" id="5945788">Sprintf</span><span class="op" id="5945795">(</span><span class="string" id="5945796">&#34;%s&nbsp;%s;&nbsp;&#34;</span><span class="op" id="5945805">,</span>&nbsp;<span class="ident" id="5945807">f</span><span class="op" id="5945808">.</span><span class="ident" id="5945809">Name</span><span class="op" id="5945813">,</span>&nbsp;<span class="ident" id="5945815">f</span><span class="op" id="5945816">.</span><span class="ident" id="5945817">Id</span><span class="op" id="5945819">.</span><span class="ident" id="5945820">gobType</span><span class="op" id="5945827">(</span><span class="op" id="5945828">)</span><span class="op" id="5945829">.</span><span class="ident" id="5945830">safeString</span><span class="op" id="5945840">(</span><span class="ident" id="5945841">seen</span><span class="op" id="5945845">)</span><span class="op" id="5945846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5945849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945852">str</span>&nbsp;<span class="op" id="5945856">+=</span>&nbsp;<span class="string" id="5945859">&#34;}&#34;</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945864">return</span>&nbsp;<span class="ident" id="5945871">str</span><br>
<span class="lineno"></span><span class="op" id="5945875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5945878">func</span>&nbsp;<span class="op" id="5945883">(</span><span class="ident" id="5945884">s</span>&nbsp;<span class="op" id="5945886">*</span><span class="ident" id="5945887">structType</span><span class="op" id="5945897">)</span>&nbsp;<span class="builtintype" id="5945899">string</span><span class="op" id="5945905">(</span><span class="op" id="5945906">)</span>&nbsp;<span class="builtintype" id="5945908">string</span>&nbsp;<span class="op" id="5945915">{</span>&nbsp;<span class="keyword" id="5945917">return</span>&nbsp;<span class="ident" id="5945924">s</span><span class="op" id="5945925">.</span><span class="ident" id="5945926">safeString</span><span class="op" id="5945936">(</span><span class="builtinfunc" id="5945937">make</span><span class="op" id="5945941">(</span><span class="keyword" id="5945942">map</span><span class="op" id="5945945">[</span><span class="ident" id="5945946">typeId</span><span class="op" id="5945952">]</span><span class="builtintype" id="5945953">bool</span><span class="op" id="5945957">)</span><span class="op" id="5945958">)</span>&nbsp;<span class="op" id="5945960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="5945963">func</span>&nbsp;<span class="ident" id="5945968">newStructType</span><span class="op" id="5945981">(</span><span class="ident" id="5945982">name</span>&nbsp;<span class="builtintype" id="5945987">string</span><span class="op" id="5945993">)</span>&nbsp;<span class="op" id="5945995">*</span><span class="ident" id="5945996">structType</span>&nbsp;<span class="op" id="5946007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5946010">s</span>&nbsp;<span class="op" id="5946012">:=</span>&nbsp;<span class="op" id="5946015">&amp;</span><span class="ident" id="5946016">structType</span><span class="op" id="5946026">{</span><span class="ident" id="5946027">CommonType</span><span class="op" id="5946037">{</span><span class="ident" id="5946038">Name</span><span class="op" id="5946042">:</span>&nbsp;<span class="ident" id="5946044">name</span><span class="op" id="5946048">}</span><span class="op" id="5946049">,</span>&nbsp;<span class="builtintype" id="5946051">nil</span><span class="op" id="5946054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5946057">//&nbsp;For&nbsp;historical&nbsp;reasons&nbsp;we&nbsp;set&nbsp;the&nbsp;id&nbsp;here&nbsp;rather&nbsp;than&nbsp;init.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5946121">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;newTypeObject&nbsp;for&nbsp;details.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5946171">setTypeId</span><span class="op" id="5946180">(</span><span class="ident" id="5946181">s</span><span class="op" id="5946182">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946185">return</span>&nbsp;<span class="ident" id="5946192">s</span><br>
<span class="lineno"></span><span class="op" id="5946194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5946197">//&nbsp;newTypeObject&nbsp;allocates&nbsp;a&nbsp;gobType&nbsp;for&nbsp;the&nbsp;reflection&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="5946262">//&nbsp;Unless&nbsp;ut&nbsp;represents&nbsp;a&nbsp;GobEncoder,&nbsp;rt&nbsp;should&nbsp;be&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno">445</span><span class="comment" id="5946327">//&nbsp;of&nbsp;ut.</span><br>
<span class="lineno"></span><span class="comment" id="5946337">//&nbsp;This&nbsp;is&nbsp;only&nbsp;called&nbsp;from&nbsp;the&nbsp;encoding&nbsp;side.&nbsp;The&nbsp;decoding&nbsp;side</span><br>
<span class="lineno"></span><span class="comment" id="5946402">//&nbsp;works&nbsp;through&nbsp;typeIds&nbsp;and&nbsp;userTypeInfos&nbsp;alone.</span><br>
<span class="lineno"></span><span class="keyword" id="5946452">func</span>&nbsp;<span class="ident" id="5946457">newTypeObject</span><span class="op" id="5946470">(</span><span class="ident" id="5946471">name</span>&nbsp;<span class="builtintype" id="5946476">string</span><span class="op" id="5946482">,</span>&nbsp;<span class="ident" id="5946484">ut</span>&nbsp;<span class="op" id="5946487">*</span><span class="ident" id="5946488">userTypeInfo</span><span class="op" id="5946500">,</span>&nbsp;<span class="ident" id="5946502">rt</span>&nbsp;<span class="ident" id="5946505">reflect</span><span class="op" id="5946512">.</span><span class="ident" id="5946513">Type</span><span class="op" id="5946517">)</span>&nbsp;<span class="op" id="5946519">(</span><span class="ident" id="5946520">gobType</span><span class="op" id="5946527">,</span>&nbsp;<span class="builtintype" id="5946529">error</span><span class="op" id="5946534">)</span>&nbsp;<span class="op" id="5946536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5946539">//&nbsp;Does&nbsp;this&nbsp;type&nbsp;implement&nbsp;GobEncoder?</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946580">if</span>&nbsp;<span class="ident" id="5946583">ut</span><span class="op" id="5946585">.</span><span class="ident" id="5946586">externalEnc</span>&nbsp;<span class="op" id="5946598">!=</span>&nbsp;<span class="num" id="5946601">0</span>&nbsp;<span class="op" id="5946603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946607">return</span>&nbsp;<span class="ident" id="5946614">newGobEncoderType</span><span class="op" id="5946631">(</span><span class="ident" id="5946632">name</span><span class="op" id="5946636">)</span><span class="op" id="5946637">,</span>&nbsp;<span class="builtintype" id="5946639">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5946644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946647">var</span>&nbsp;<span class="ident" id="5946651">err</span>&nbsp;<span class="builtintype" id="5946655">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946662">var</span>&nbsp;<span class="ident" id="5946666">type0</span><span class="op" id="5946671">,</span>&nbsp;<span class="ident" id="5946673">type1</span>&nbsp;<span class="ident" id="5946679">gobType</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946688">defer</span>&nbsp;<span class="keyword" id="5946694">func</span><span class="op" id="5946698">(</span><span class="op" id="5946699">)</span>&nbsp;<span class="op" id="5946701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946705">if</span>&nbsp;<span class="ident" id="5946708">err</span>&nbsp;<span class="op" id="5946712">!=</span>&nbsp;<span class="builtintype" id="5946715">nil</span>&nbsp;<span class="op" id="5946719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5946724">delete</span><span class="op" id="5946730">(</span><span class="ident" id="5946731">types</span><span class="op" id="5946736">,</span>&nbsp;<span class="ident" id="5946738">rt</span><span class="op" id="5946740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5946744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5946747">}</span><span class="op" id="5946748">(</span><span class="op" id="5946749">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5946752">//&nbsp;Install&nbsp;the&nbsp;top-level&nbsp;type&nbsp;before&nbsp;the&nbsp;subtypes&nbsp;(e.g.&nbsp;struct&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5946823">//&nbsp;fields)&nbsp;so&nbsp;recursive&nbsp;types&nbsp;can&nbsp;be&nbsp;constructed&nbsp;safely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946881">switch</span>&nbsp;<span class="ident" id="5946888">t</span>&nbsp;<span class="op" id="5946890">:=</span>&nbsp;<span class="ident" id="5946893">rt</span><span class="op" id="5946895">;</span>&nbsp;<span class="ident" id="5946897">t</span><span class="op" id="5946898">.</span><span class="ident" id="5946899">Kind</span><span class="op" id="5946903">(</span><span class="op" id="5946904">)</span>&nbsp;<span class="op" id="5946906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5946909">//&nbsp;All&nbsp;basic&nbsp;types&nbsp;are&nbsp;easy:&nbsp;they&nbsp;are&nbsp;predefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946960">case</span>&nbsp;<span class="ident" id="5946965">reflect</span><span class="op" id="5946972">.</span><span class="ident" id="5946973">Bool</span><span class="op" id="5946977">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946981">return</span>&nbsp;<span class="ident" id="5946988">tBool</span><span class="op" id="5946993">.</span><span class="ident" id="5946994">gobType</span><span class="op" id="5947001">(</span><span class="op" id="5947002">)</span><span class="op" id="5947003">,</span>&nbsp;<span class="builtintype" id="5947005">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947011">case</span>&nbsp;<span class="ident" id="5947016">reflect</span><span class="op" id="5947023">.</span><span class="ident" id="5947024">Int</span><span class="op" id="5947027">,</span>&nbsp;<span class="ident" id="5947029">reflect</span><span class="op" id="5947036">.</span><span class="ident" id="5947037">Int8</span><span class="op" id="5947041">,</span>&nbsp;<span class="ident" id="5947043">reflect</span><span class="op" id="5947050">.</span><span class="ident" id="5947051">Int16</span><span class="op" id="5947056">,</span>&nbsp;<span class="ident" id="5947058">reflect</span><span class="op" id="5947065">.</span><span class="ident" id="5947066">Int32</span><span class="op" id="5947071">,</span>&nbsp;<span class="ident" id="5947073">reflect</span><span class="op" id="5947080">.</span><span class="ident" id="5947081">Int64</span><span class="op" id="5947086">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947090">return</span>&nbsp;<span class="ident" id="5947097">tInt</span><span class="op" id="5947101">.</span><span class="ident" id="5947102">gobType</span><span class="op" id="5947109">(</span><span class="op" id="5947110">)</span><span class="op" id="5947111">,</span>&nbsp;<span class="builtintype" id="5947113">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947119">case</span>&nbsp;<span class="ident" id="5947124">reflect</span><span class="op" id="5947131">.</span><span class="ident" id="5947132">Uint</span><span class="op" id="5947136">,</span>&nbsp;<span class="ident" id="5947138">reflect</span><span class="op" id="5947145">.</span><span class="ident" id="5947146">Uint8</span><span class="op" id="5947151">,</span>&nbsp;<span class="ident" id="5947153">reflect</span><span class="op" id="5947160">.</span><span class="ident" id="5947161">Uint16</span><span class="op" id="5947167">,</span>&nbsp;<span class="ident" id="5947169">reflect</span><span class="op" id="5947176">.</span><span class="ident" id="5947177">Uint32</span><span class="op" id="5947183">,</span>&nbsp;<span class="ident" id="5947185">reflect</span><span class="op" id="5947192">.</span><span class="ident" id="5947193">Uint64</span><span class="op" id="5947199">,</span>&nbsp;<span class="ident" id="5947201">reflect</span><span class="op" id="5947208">.</span><span class="ident" id="5947209">Uintptr</span><span class="op" id="5947216">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947220">return</span>&nbsp;<span class="ident" id="5947227">tUint</span><span class="op" id="5947232">.</span><span class="ident" id="5947233">gobType</span><span class="op" id="5947240">(</span><span class="op" id="5947241">)</span><span class="op" id="5947242">,</span>&nbsp;<span class="builtintype" id="5947244">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947250">case</span>&nbsp;<span class="ident" id="5947255">reflect</span><span class="op" id="5947262">.</span><span class="ident" id="5947263">Float32</span><span class="op" id="5947270">,</span>&nbsp;<span class="ident" id="5947272">reflect</span><span class="op" id="5947279">.</span><span class="ident" id="5947280">Float64</span><span class="op" id="5947287">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947291">return</span>&nbsp;<span class="ident" id="5947298">tFloat</span><span class="op" id="5947304">.</span><span class="ident" id="5947305">gobType</span><span class="op" id="5947312">(</span><span class="op" id="5947313">)</span><span class="op" id="5947314">,</span>&nbsp;<span class="builtintype" id="5947316">nil</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947322">case</span>&nbsp;<span class="ident" id="5947327">reflect</span><span class="op" id="5947334">.</span><span class="ident" id="5947335">Complex64</span><span class="op" id="5947344">,</span>&nbsp;<span class="ident" id="5947346">reflect</span><span class="op" id="5947353">.</span><span class="ident" id="5947354">Complex128</span><span class="op" id="5947364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947368">return</span>&nbsp;<span class="ident" id="5947375">tComplex</span><span class="op" id="5947383">.</span><span class="ident" id="5947384">gobType</span><span class="op" id="5947391">(</span><span class="op" id="5947392">)</span><span class="op" id="5947393">,</span>&nbsp;<span class="builtintype" id="5947395">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947401">case</span>&nbsp;<span class="ident" id="5947406">reflect</span><span class="op" id="5947413">.</span><span class="ident" id="5947414">String</span><span class="op" id="5947420">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947424">return</span>&nbsp;<span class="ident" id="5947431">tString</span><span class="op" id="5947438">.</span><span class="ident" id="5947439">gobType</span><span class="op" id="5947446">(</span><span class="op" id="5947447">)</span><span class="op" id="5947448">,</span>&nbsp;<span class="builtintype" id="5947450">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947456">case</span>&nbsp;<span class="ident" id="5947461">reflect</span><span class="op" id="5947468">.</span><span class="ident" id="5947469">Interface</span><span class="op" id="5947478">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947482">return</span>&nbsp;<span class="ident" id="5947489">tInterface</span><span class="op" id="5947499">.</span><span class="ident" id="5947500">gobType</span><span class="op" id="5947507">(</span><span class="op" id="5947508">)</span><span class="op" id="5947509">,</span>&nbsp;<span class="builtintype" id="5947511">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947517">case</span>&nbsp;<span class="ident" id="5947522">reflect</span><span class="op" id="5947529">.</span><span class="ident" id="5947530">Array</span><span class="op" id="5947535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5947539">at</span>&nbsp;<span class="op" id="5947542">:=</span>&nbsp;<span class="ident" id="5947545">newArrayType</span><span class="op" id="5947557">(</span><span class="ident" id="5947558">name</span><span class="op" id="5947562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5947566">types</span><span class="op" id="5947571">[</span><span class="ident" id="5947572">rt</span><span class="op" id="5947574">]</span>&nbsp;<span class="op" id="5947576">=</span>&nbsp;<span class="ident" id="5947578">at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5947583">type0</span><span class="op" id="5947588">,</span>&nbsp;<span class="ident" id="5947590">err</span>&nbsp;<span class="op" id="5947594">=</span>&nbsp;<span class="ident" id="5947596">getBaseType</span><span class="op" id="5947607">(</span><span class="string" id="5947608">&#34;&#34;</span><span class="op" id="5947610">,</span>&nbsp;<span class="ident" id="5947612">t</span><span class="op" id="5947613">.</span><span class="ident" id="5947614">Elem</span><span class="op" id="5947618">(</span><span class="op" id="5947619">)</span><span class="op" id="5947620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947624">if</span>&nbsp;<span class="ident" id="5947627">err</span>&nbsp;<span class="op" id="5947631">!=</span>&nbsp;<span class="builtintype" id="5947634">nil</span>&nbsp;<span class="op" id="5947638">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947643">return</span>&nbsp;<span class="builtintype" id="5947650">nil</span><span class="op" id="5947653">,</span>&nbsp;<span class="ident" id="5947655">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5947661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5947665">//&nbsp;Historical&nbsp;aside:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5947688">//&nbsp;For&nbsp;arrays,&nbsp;maps,&nbsp;and&nbsp;slices,&nbsp;we&nbsp;set&nbsp;the&nbsp;type&nbsp;id&nbsp;after&nbsp;the&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5947761">//&nbsp;are&nbsp;constructed.&nbsp;This&nbsp;is&nbsp;to&nbsp;retain&nbsp;the&nbsp;order&nbsp;of&nbsp;type&nbsp;id&nbsp;allocation&nbsp;after</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5947839">//&nbsp;a&nbsp;fix&nbsp;made&nbsp;to&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;which&nbsp;changed&nbsp;the&nbsp;order&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5947909">//&nbsp;which&nbsp;types&nbsp;are&nbsp;built.&nbsp;&nbsp;Delaying&nbsp;the&nbsp;setting&nbsp;in&nbsp;this&nbsp;way&nbsp;preserves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5947981">//&nbsp;type&nbsp;ids&nbsp;while&nbsp;allowing&nbsp;recursive&nbsp;types&nbsp;to&nbsp;be&nbsp;described.&nbsp;Structs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5948052">//&nbsp;done&nbsp;below,&nbsp;were&nbsp;already&nbsp;handling&nbsp;recursion&nbsp;correctly&nbsp;so&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5948119">//&nbsp;assign&nbsp;the&nbsp;top-level&nbsp;id&nbsp;before&nbsp;those&nbsp;of&nbsp;the&nbsp;field.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948175">at</span><span class="op" id="5948177">.</span><span class="ident" id="5948178">init</span><span class="op" id="5948182">(</span><span class="ident" id="5948183">type0</span><span class="op" id="5948188">,</span>&nbsp;<span class="ident" id="5948190">t</span><span class="op" id="5948191">.</span><span class="ident" id="5948192">Len</span><span class="op" id="5948195">(</span><span class="op" id="5948196">)</span><span class="op" id="5948197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948201">return</span>&nbsp;<span class="ident" id="5948208">at</span><span class="op" id="5948210">,</span>&nbsp;<span class="builtintype" id="5948212">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948218">case</span>&nbsp;<span class="ident" id="5948223">reflect</span><span class="op" id="5948230">.</span><span class="ident" id="5948231">Map</span><span class="op" id="5948234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948238">mt</span>&nbsp;<span class="op" id="5948241">:=</span>&nbsp;<span class="ident" id="5948244">newMapType</span><span class="op" id="5948254">(</span><span class="ident" id="5948255">name</span><span class="op" id="5948259">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948263">types</span><span class="op" id="5948268">[</span><span class="ident" id="5948269">rt</span><span class="op" id="5948271">]</span>&nbsp;<span class="op" id="5948273">=</span>&nbsp;<span class="ident" id="5948275">mt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948280">type0</span><span class="op" id="5948285">,</span>&nbsp;<span class="ident" id="5948287">err</span>&nbsp;<span class="op" id="5948291">=</span>&nbsp;<span class="ident" id="5948293">getBaseType</span><span class="op" id="5948304">(</span><span class="string" id="5948305">&#34;&#34;</span><span class="op" id="5948307">,</span>&nbsp;<span class="ident" id="5948309">t</span><span class="op" id="5948310">.</span><span class="ident" id="5948311">Key</span><span class="op" id="5948314">(</span><span class="op" id="5948315">)</span><span class="op" id="5948316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948320">if</span>&nbsp;<span class="ident" id="5948323">err</span>&nbsp;<span class="op" id="5948327">!=</span>&nbsp;<span class="builtintype" id="5948330">nil</span>&nbsp;<span class="op" id="5948334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948339">return</span>&nbsp;<span class="builtintype" id="5948346">nil</span><span class="op" id="5948349">,</span>&nbsp;<span class="ident" id="5948351">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5948357">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948361">type1</span><span class="op" id="5948366">,</span>&nbsp;<span class="ident" id="5948368">err</span>&nbsp;<span class="op" id="5948372">=</span>&nbsp;<span class="ident" id="5948374">getBaseType</span><span class="op" id="5948385">(</span><span class="string" id="5948386">&#34;&#34;</span><span class="op" id="5948388">,</span>&nbsp;<span class="ident" id="5948390">t</span><span class="op" id="5948391">.</span><span class="ident" id="5948392">Elem</span><span class="op" id="5948396">(</span><span class="op" id="5948397">)</span><span class="op" id="5948398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948402">if</span>&nbsp;<span class="ident" id="5948405">err</span>&nbsp;<span class="op" id="5948409">!=</span>&nbsp;<span class="builtintype" id="5948412">nil</span>&nbsp;<span class="op" id="5948416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948421">return</span>&nbsp;<span class="builtintype" id="5948428">nil</span><span class="op" id="5948431">,</span>&nbsp;<span class="ident" id="5948433">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5948439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948443">mt</span><span class="op" id="5948445">.</span><span class="ident" id="5948446">init</span><span class="op" id="5948450">(</span><span class="ident" id="5948451">type0</span><span class="op" id="5948456">,</span>&nbsp;<span class="ident" id="5948458">type1</span><span class="op" id="5948463">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948467">return</span>&nbsp;<span class="ident" id="5948474">mt</span><span class="op" id="5948476">,</span>&nbsp;<span class="builtintype" id="5948478">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948484">case</span>&nbsp;<span class="ident" id="5948489">reflect</span><span class="op" id="5948496">.</span><span class="ident" id="5948497">Slice</span><span class="op" id="5948502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5948506">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948547">if</span>&nbsp;<span class="ident" id="5948550">t</span><span class="op" id="5948551">.</span><span class="ident" id="5948552">Elem</span><span class="op" id="5948556">(</span><span class="op" id="5948557">)</span><span class="op" id="5948558">.</span><span class="ident" id="5948559">Kind</span><span class="op" id="5948563">(</span><span class="op" id="5948564">)</span>&nbsp;<span class="op" id="5948566">==</span>&nbsp;<span class="ident" id="5948569">reflect</span><span class="op" id="5948576">.</span><span class="ident" id="5948577">Uint8</span>&nbsp;<span class="op" id="5948583">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948588">return</span>&nbsp;<span class="ident" id="5948595">tBytes</span><span class="op" id="5948601">.</span><span class="ident" id="5948602">gobType</span><span class="op" id="5948609">(</span><span class="op" id="5948610">)</span><span class="op" id="5948611">,</span>&nbsp;<span class="builtintype" id="5948613">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5948619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948623">st</span>&nbsp;<span class="op" id="5948626">:=</span>&nbsp;<span class="ident" id="5948629">newSliceType</span><span class="op" id="5948641">(</span><span class="ident" id="5948642">name</span><span class="op" id="5948646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948650">types</span><span class="op" id="5948655">[</span><span class="ident" id="5948656">rt</span><span class="op" id="5948658">]</span>&nbsp;<span class="op" id="5948660">=</span>&nbsp;<span class="ident" id="5948662">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948667">type0</span><span class="op" id="5948672">,</span>&nbsp;<span class="ident" id="5948674">err</span>&nbsp;<span class="op" id="5948678">=</span>&nbsp;<span class="ident" id="5948680">getBaseType</span><span class="op" id="5948691">(</span><span class="ident" id="5948692">t</span><span class="op" id="5948693">.</span><span class="ident" id="5948694">Elem</span><span class="op" id="5948698">(</span><span class="op" id="5948699">)</span><span class="op" id="5948700">.</span><span class="ident" id="5948701">Name</span><span class="op" id="5948705">(</span><span class="op" id="5948706">)</span><span class="op" id="5948707">,</span>&nbsp;<span class="ident" id="5948709">t</span><span class="op" id="5948710">.</span><span class="ident" id="5948711">Elem</span><span class="op" id="5948715">(</span><span class="op" id="5948716">)</span><span class="op" id="5948717">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948721">if</span>&nbsp;<span class="ident" id="5948724">err</span>&nbsp;<span class="op" id="5948728">!=</span>&nbsp;<span class="builtintype" id="5948731">nil</span>&nbsp;<span class="op" id="5948735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948740">return</span>&nbsp;<span class="builtintype" id="5948747">nil</span><span class="op" id="5948750">,</span>&nbsp;<span class="ident" id="5948752">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5948758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948762">st</span><span class="op" id="5948764">.</span><span class="ident" id="5948765">init</span><span class="op" id="5948769">(</span><span class="ident" id="5948770">type0</span><span class="op" id="5948775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948779">return</span>&nbsp;<span class="ident" id="5948786">st</span><span class="op" id="5948788">,</span>&nbsp;<span class="builtintype" id="5948790">nil</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948796">case</span>&nbsp;<span class="ident" id="5948801">reflect</span><span class="op" id="5948808">.</span><span class="ident" id="5948809">Struct</span><span class="op" id="5948815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948819">st</span>&nbsp;<span class="op" id="5948822">:=</span>&nbsp;<span class="ident" id="5948825">newStructType</span><span class="op" id="5948838">(</span><span class="ident" id="5948839">name</span><span class="op" id="5948843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948847">types</span><span class="op" id="5948852">[</span><span class="ident" id="5948853">rt</span><span class="op" id="5948855">]</span>&nbsp;<span class="op" id="5948857">=</span>&nbsp;<span class="ident" id="5948859">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948864">idToType</span><span class="op" id="5948872">[</span><span class="ident" id="5948873">st</span><span class="op" id="5948875">.</span><span class="ident" id="5948876">id</span><span class="op" id="5948878">(</span><span class="op" id="5948879">)</span><span class="op" id="5948880">]</span>&nbsp;<span class="op" id="5948882">=</span>&nbsp;<span class="ident" id="5948884">st</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948889">for</span>&nbsp;<span class="ident" id="5948893">i</span>&nbsp;<span class="op" id="5948895">:=</span>&nbsp;<span class="num" id="5948898">0</span><span class="op" id="5948899">;</span>&nbsp;<span class="ident" id="5948901">i</span>&nbsp;<span class="op" id="5948903">&lt;</span>&nbsp;<span class="ident" id="5948905">t</span><span class="op" id="5948906">.</span><span class="ident" id="5948907">NumField</span><span class="op" id="5948915">(</span><span class="op" id="5948916">)</span><span class="op" id="5948917">;</span>&nbsp;<span class="ident" id="5948919">i</span><span class="op" id="5948920">++</span>&nbsp;<span class="op" id="5948923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948928">f</span>&nbsp;<span class="op" id="5948930">:=</span>&nbsp;<span class="ident" id="5948933">t</span><span class="op" id="5948934">.</span><span class="ident" id="5948935">Field</span><span class="op" id="5948940">(</span><span class="ident" id="5948941">i</span><span class="op" id="5948942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948947">if</span>&nbsp;<span class="op" id="5948950">!</span><span class="ident" id="5948951">isSent</span><span class="op" id="5948957">(</span><span class="op" id="5948958">&amp;</span><span class="ident" id="5948959">f</span><span class="op" id="5948960">)</span>&nbsp;<span class="op" id="5948962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948968">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5948980">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948985">typ</span>&nbsp;<span class="op" id="5948989">:=</span>&nbsp;<span class="ident" id="5948992">userType</span><span class="op" id="5949000">(</span><span class="ident" id="5949001">f</span><span class="op" id="5949002">.</span><span class="ident" id="5949003">Type</span><span class="op" id="5949007">)</span><span class="op" id="5949008">.</span><span class="ident" id="5949009">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949017">tname</span>&nbsp;<span class="op" id="5949023">:=</span>&nbsp;<span class="ident" id="5949026">typ</span><span class="op" id="5949029">.</span><span class="ident" id="5949030">Name</span><span class="op" id="5949034">(</span><span class="op" id="5949035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949040">if</span>&nbsp;<span class="ident" id="5949043">tname</span>&nbsp;<span class="op" id="5949049">==</span>&nbsp;<span class="string" id="5949052">&#34;&#34;</span>&nbsp;<span class="op" id="5949055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949061">t</span>&nbsp;<span class="op" id="5949063">:=</span>&nbsp;<span class="ident" id="5949066">userType</span><span class="op" id="5949074">(</span><span class="ident" id="5949075">f</span><span class="op" id="5949076">.</span><span class="ident" id="5949077">Type</span><span class="op" id="5949081">)</span><span class="op" id="5949082">.</span><span class="ident" id="5949083">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949092">tname</span>&nbsp;<span class="op" id="5949098">=</span>&nbsp;<span class="ident" id="5949100">t</span><span class="op" id="5949101">.</span><span class="ident" id="5949102">String</span><span class="op" id="5949108">(</span><span class="op" id="5949109">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5949114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949119">gt</span><span class="op" id="5949121">,</span>&nbsp;<span class="ident" id="5949123">err</span>&nbsp;<span class="op" id="5949127">:=</span>&nbsp;<span class="ident" id="5949130">getBaseType</span><span class="op" id="5949141">(</span><span class="ident" id="5949142">tname</span><span class="op" id="5949147">,</span>&nbsp;<span class="ident" id="5949149">f</span><span class="op" id="5949150">.</span><span class="ident" id="5949151">Type</span><span class="op" id="5949155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949160">if</span>&nbsp;<span class="ident" id="5949163">err</span>&nbsp;<span class="op" id="5949167">!=</span>&nbsp;<span class="builtintype" id="5949170">nil</span>&nbsp;<span class="op" id="5949174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949180">return</span>&nbsp;<span class="builtintype" id="5949187">nil</span><span class="op" id="5949190">,</span>&nbsp;<span class="ident" id="5949192">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5949199">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5949204">//&nbsp;Some&nbsp;mutually&nbsp;recursive&nbsp;types&nbsp;can&nbsp;cause&nbsp;us&nbsp;to&nbsp;be&nbsp;here&nbsp;while</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5949270">//&nbsp;still&nbsp;defining&nbsp;the&nbsp;element.&nbsp;Fix&nbsp;the&nbsp;element&nbsp;type&nbsp;id&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5949334">//&nbsp;We&nbsp;could&nbsp;do&nbsp;this&nbsp;more&nbsp;neatly&nbsp;by&nbsp;setting&nbsp;the&nbsp;id&nbsp;at&nbsp;the&nbsp;start&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5949403">//&nbsp;building&nbsp;every&nbsp;type,&nbsp;but&nbsp;that&nbsp;would&nbsp;break&nbsp;binary&nbsp;compatibility.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949473">if</span>&nbsp;<span class="ident" id="5949476">gt</span><span class="op" id="5949478">.</span><span class="ident" id="5949479">id</span><span class="op" id="5949481">(</span><span class="op" id="5949482">)</span>&nbsp;<span class="op" id="5949484">==</span>&nbsp;<span class="num" id="5949487">0</span>&nbsp;<span class="op" id="5949489">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949495">setTypeId</span><span class="op" id="5949504">(</span><span class="ident" id="5949505">gt</span><span class="op" id="5949507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5949512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949517">st</span><span class="op" id="5949519">.</span><span class="ident" id="5949520">Field</span>&nbsp;<span class="op" id="5949526">=</span>&nbsp;<span class="builtinfunc" id="5949528">append</span><span class="op" id="5949534">(</span><span class="ident" id="5949535">st</span><span class="op" id="5949537">.</span><span class="ident" id="5949538">Field</span><span class="op" id="5949543">,</span>&nbsp;<span class="op" id="5949545">&amp;</span><span class="ident" id="5949546">fieldType</span><span class="op" id="5949555">{</span><span class="ident" id="5949556">f</span><span class="op" id="5949557">.</span><span class="ident" id="5949558">Name</span><span class="op" id="5949562">,</span>&nbsp;<span class="ident" id="5949564">gt</span><span class="op" id="5949566">.</span><span class="ident" id="5949567">id</span><span class="op" id="5949569">(</span><span class="op" id="5949570">)</span><span class="op" id="5949571">}</span><span class="op" id="5949572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5949576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949580">return</span>&nbsp;<span class="ident" id="5949587">st</span><span class="op" id="5949589">,</span>&nbsp;<span class="builtintype" id="5949591">nil</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949597">default</span><span class="op" id="5949604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949608">return</span>&nbsp;<span class="builtintype" id="5949615">nil</span><span class="op" id="5949618">,</span>&nbsp;<span class="ident" id="5949620">errors</span><span class="op" id="5949626">.</span><span class="ident" id="5949627">New</span><span class="op" id="5949630">(</span><span class="string" id="5949631">&#34;gob&nbsp;NewTypeObject&nbsp;can&#39;t&nbsp;handle&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="5949671">+</span>&nbsp;<span class="ident" id="5949673">rt</span><span class="op" id="5949675">.</span><span class="ident" id="5949676">String</span><span class="op" id="5949682">(</span><span class="op" id="5949683">)</span><span class="op" id="5949684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5949687">}</span><br>
<span class="lineno"></span><span class="op" id="5949689">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="5949692">//&nbsp;isExported&nbsp;reports&nbsp;whether&nbsp;this&nbsp;is&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5949763">func</span>&nbsp;<span class="ident" id="5949768">isExported</span><span class="op" id="5949778">(</span><span class="ident" id="5949779">name</span>&nbsp;<span class="builtintype" id="5949784">string</span><span class="op" id="5949790">)</span>&nbsp;<span class="builtintype" id="5949792">bool</span>&nbsp;<span class="op" id="5949797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5949800">rune</span><span class="op" id="5949804">,</span>&nbsp;<span class="ident" id="5949806">_</span>&nbsp;<span class="op" id="5949808">:=</span>&nbsp;<span class="ident" id="5949811">utf8</span><span class="op" id="5949815">.</span><span class="ident" id="5949816">DecodeRuneInString</span><span class="op" id="5949834">(</span><span class="ident" id="5949835">name</span><span class="op" id="5949839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949842">return</span>&nbsp;<span class="ident" id="5949849">unicode</span><span class="op" id="5949856">.</span><span class="ident" id="5949857">IsUpper</span><span class="op" id="5949864">(</span><span class="builtintype" id="5949865">rune</span><span class="op" id="5949869">)</span><br>
<span class="lineno">570</span><span class="op" id="5949871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5949874">//&nbsp;isSent&nbsp;reports&nbsp;whether&nbsp;this&nbsp;struct&nbsp;field&nbsp;is&nbsp;to&nbsp;be&nbsp;transmitted.</span><br>
<span class="lineno"></span><span class="comment" id="5949940">//&nbsp;It&nbsp;will&nbsp;be&nbsp;transmitted&nbsp;only&nbsp;if&nbsp;it&nbsp;is&nbsp;exported&nbsp;and&nbsp;not&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5950018">//&nbsp;or&nbsp;pointer&nbsp;to&nbsp;chan&nbsp;or&nbsp;func.</span><br>
<span class="lineno">575</span><span class="keyword" id="5950049">func</span>&nbsp;<span class="ident" id="5950054">isSent</span><span class="op" id="5950060">(</span><span class="ident" id="5950061">field</span>&nbsp;<span class="op" id="5950067">*</span><span class="ident" id="5950068">reflect</span><span class="op" id="5950075">.</span><span class="ident" id="5950076">StructField</span><span class="op" id="5950087">)</span>&nbsp;<span class="builtintype" id="5950089">bool</span>&nbsp;<span class="op" id="5950094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5950097">if</span>&nbsp;<span class="op" id="5950100">!</span><span class="ident" id="5950101">isExported</span><span class="op" id="5950111">(</span><span class="ident" id="5950112">field</span><span class="op" id="5950117">.</span><span class="ident" id="5950118">Name</span><span class="op" id="5950122">)</span>&nbsp;<span class="op" id="5950124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5950128">return</span>&nbsp;<span class="builtintype" id="5950135">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5950142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5950145">//&nbsp;If&nbsp;the&nbsp;field&nbsp;is&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;or&nbsp;pointer&nbsp;thereto,&nbsp;don&#39;t&nbsp;send&nbsp;it.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5950215">//&nbsp;That&nbsp;is,&nbsp;treat&nbsp;it&nbsp;like&nbsp;an&nbsp;unexported&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950263">typ</span>&nbsp;<span class="op" id="5950267">:=</span>&nbsp;<span class="ident" id="5950270">field</span><span class="op" id="5950275">.</span><span class="ident" id="5950276">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5950282">for</span>&nbsp;<span class="ident" id="5950286">typ</span><span class="op" id="5950289">.</span><span class="ident" id="5950290">Kind</span><span class="op" id="5950294">(</span><span class="op" id="5950295">)</span>&nbsp;<span class="op" id="5950297">==</span>&nbsp;<span class="ident" id="5950300">reflect</span><span class="op" id="5950307">.</span><span class="ident" id="5950308">Ptr</span>&nbsp;<span class="op" id="5950312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950316">typ</span>&nbsp;<span class="op" id="5950320">=</span>&nbsp;<span class="ident" id="5950322">typ</span><span class="op" id="5950325">.</span><span class="ident" id="5950326">Elem</span><span class="op" id="5950330">(</span><span class="op" id="5950331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5950334">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5950337">if</span>&nbsp;<span class="ident" id="5950340">typ</span><span class="op" id="5950343">.</span><span class="ident" id="5950344">Kind</span><span class="op" id="5950348">(</span><span class="op" id="5950349">)</span>&nbsp;<span class="op" id="5950351">==</span>&nbsp;<span class="ident" id="5950354">reflect</span><span class="op" id="5950361">.</span><span class="ident" id="5950362">Chan</span>&nbsp;<span class="op" id="5950367">||</span>&nbsp;<span class="ident" id="5950370">typ</span><span class="op" id="5950373">.</span><span class="ident" id="5950374">Kind</span><span class="op" id="5950378">(</span><span class="op" id="5950379">)</span>&nbsp;<span class="op" id="5950381">==</span>&nbsp;<span class="ident" id="5950384">reflect</span><span class="op" id="5950391">.</span><span class="ident" id="5950392">Func</span>&nbsp;<span class="op" id="5950397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5950401">return</span>&nbsp;<span class="builtintype" id="5950408">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5950415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5950418">return</span>&nbsp;<span class="builtintype" id="5950425">true</span><br>
<span class="lineno"></span><span class="op" id="5950430">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="5950433">//&nbsp;getBaseType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type&#39;s&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5950516">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5950542">func</span>&nbsp;<span class="ident" id="5950547">getBaseType</span><span class="op" id="5950558">(</span><span class="ident" id="5950559">name</span>&nbsp;<span class="builtintype" id="5950564">string</span><span class="op" id="5950570">,</span>&nbsp;<span class="ident" id="5950572">rt</span>&nbsp;<span class="ident" id="5950575">reflect</span><span class="op" id="5950582">.</span><span class="ident" id="5950583">Type</span><span class="op" id="5950587">)</span>&nbsp;<span class="op" id="5950589">(</span><span class="ident" id="5950590">gobType</span><span class="op" id="5950597">,</span>&nbsp;<span class="builtintype" id="5950599">error</span><span class="op" id="5950604">)</span>&nbsp;<span class="op" id="5950606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950609">ut</span>&nbsp;<span class="op" id="5950612">:=</span>&nbsp;<span class="ident" id="5950615">userType</span><span class="op" id="5950623">(</span><span class="ident" id="5950624">rt</span><span class="op" id="5950626">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5950629">return</span>&nbsp;<span class="ident" id="5950636">getType</span><span class="op" id="5950643">(</span><span class="ident" id="5950644">name</span><span class="op" id="5950648">,</span>&nbsp;<span class="ident" id="5950650">ut</span><span class="op" id="5950652">,</span>&nbsp;<span class="ident" id="5950654">ut</span><span class="op" id="5950656">.</span><span class="ident" id="5950657">base</span><span class="op" id="5950661">)</span><br>
<span class="lineno"></span><span class="op" id="5950663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5950666">//&nbsp;getType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type.</span><br>
<span class="lineno"></span><span class="comment" id="5950733">//&nbsp;Should&nbsp;be&nbsp;called&nbsp;only&nbsp;when&nbsp;handling&nbsp;GobEncoders/Decoders,</span><br>
<span class="lineno">600</span><span class="comment" id="5950794">//&nbsp;which&nbsp;may&nbsp;be&nbsp;pointers.&nbsp;&nbsp;All&nbsp;other&nbsp;types&nbsp;are&nbsp;handled&nbsp;through&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5950861">//&nbsp;base&nbsp;type,&nbsp;never&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="comment" id="5950892">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5950918">func</span>&nbsp;<span class="ident" id="5950923">getType</span><span class="op" id="5950930">(</span><span class="ident" id="5950931">name</span>&nbsp;<span class="builtintype" id="5950936">string</span><span class="op" id="5950942">,</span>&nbsp;<span class="ident" id="5950944">ut</span>&nbsp;<span class="op" id="5950947">*</span><span class="ident" id="5950948">userTypeInfo</span><span class="op" id="5950960">,</span>&nbsp;<span class="ident" id="5950962">rt</span>&nbsp;<span class="ident" id="5950965">reflect</span><span class="op" id="5950972">.</span><span class="ident" id="5950973">Type</span><span class="op" id="5950977">)</span>&nbsp;<span class="op" id="5950979">(</span><span class="ident" id="5950980">gobType</span><span class="op" id="5950987">,</span>&nbsp;<span class="builtintype" id="5950989">error</span><span class="op" id="5950994">)</span>&nbsp;<span class="op" id="5950996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950999">typ</span><span class="op" id="5951002">,</span>&nbsp;<span class="ident" id="5951004">present</span>&nbsp;<span class="op" id="5951012">:=</span>&nbsp;<span class="ident" id="5951015">types</span><span class="op" id="5951020">[</span><span class="ident" id="5951021">rt</span><span class="op" id="5951023">]</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951026">if</span>&nbsp;<span class="ident" id="5951029">present</span>&nbsp;<span class="op" id="5951037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951041">return</span>&nbsp;<span class="ident" id="5951048">typ</span><span class="op" id="5951051">,</span>&nbsp;<span class="builtintype" id="5951053">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5951058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951061">typ</span><span class="op" id="5951064">,</span>&nbsp;<span class="ident" id="5951066">err</span>&nbsp;<span class="op" id="5951070">:=</span>&nbsp;<span class="ident" id="5951073">newTypeObject</span><span class="op" id="5951086">(</span><span class="ident" id="5951087">name</span><span class="op" id="5951091">,</span>&nbsp;<span class="ident" id="5951093">ut</span><span class="op" id="5951095">,</span>&nbsp;<span class="ident" id="5951097">rt</span><span class="op" id="5951099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951102">if</span>&nbsp;<span class="ident" id="5951105">err</span>&nbsp;<span class="op" id="5951109">==</span>&nbsp;<span class="builtintype" id="5951112">nil</span>&nbsp;<span class="op" id="5951116">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951120">types</span><span class="op" id="5951125">[</span><span class="ident" id="5951126">rt</span><span class="op" id="5951128">]</span>&nbsp;<span class="op" id="5951130">=</span>&nbsp;<span class="ident" id="5951132">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5951137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951140">return</span>&nbsp;<span class="ident" id="5951147">typ</span><span class="op" id="5951150">,</span>&nbsp;<span class="ident" id="5951152">err</span><br>
<span class="lineno"></span><span class="op" id="5951156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="keyword" id="5951159">func</span>&nbsp;<span class="ident" id="5951164">checkId</span><span class="op" id="5951171">(</span><span class="ident" id="5951172">want</span><span class="op" id="5951176">,</span>&nbsp;<span class="ident" id="5951178">got</span>&nbsp;<span class="ident" id="5951182">typeId</span><span class="op" id="5951188">)</span>&nbsp;<span class="op" id="5951190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951193">if</span>&nbsp;<span class="ident" id="5951196">want</span>&nbsp;<span class="op" id="5951201">!=</span>&nbsp;<span class="ident" id="5951204">got</span>&nbsp;<span class="op" id="5951208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951212">fmt</span><span class="op" id="5951215">.</span><span class="ident" id="5951216">Fprintf</span><span class="op" id="5951223">(</span><span class="ident" id="5951224">os</span><span class="op" id="5951226">.</span><span class="ident" id="5951227">Stderr</span><span class="op" id="5951233">,</span>&nbsp;<span class="string" id="5951235">&#34;checkId:&nbsp;%d&nbsp;should&nbsp;be&nbsp;%d\n&#34;</span><span class="op" id="5951263">,</span>&nbsp;<span class="builtintype" id="5951265">int</span><span class="op" id="5951268">(</span><span class="ident" id="5951269">got</span><span class="op" id="5951272">)</span><span class="op" id="5951273">,</span>&nbsp;<span class="builtintype" id="5951275">int</span><span class="op" id="5951278">(</span><span class="ident" id="5951279">want</span><span class="op" id="5951283">)</span><span class="op" id="5951284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5951288">panic</span><span class="op" id="5951293">(</span><span class="string" id="5951294">&#34;bootstrap&nbsp;type&nbsp;wrong&nbsp;id:&nbsp;&#34;</span>&nbsp;<span class="op" id="5951322">+</span>&nbsp;<span class="ident" id="5951324">got</span><span class="op" id="5951327">.</span><span class="ident" id="5951328">name</span><span class="op" id="5951332">(</span><span class="op" id="5951333">)</span>&nbsp;<span class="op" id="5951335">+</span>&nbsp;<span class="string" id="5951337">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5951341">+</span>&nbsp;<span class="ident" id="5951343">got</span><span class="op" id="5951346">.</span><span class="builtintype" id="5951347">string</span><span class="op" id="5951353">(</span><span class="op" id="5951354">)</span>&nbsp;<span class="op" id="5951356">+</span>&nbsp;<span class="string" id="5951358">&#34;&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="5951366">+</span>&nbsp;<span class="ident" id="5951368">want</span><span class="op" id="5951372">.</span><span class="builtintype" id="5951373">string</span><span class="op" id="5951379">(</span><span class="op" id="5951380">)</span><span class="op" id="5951381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5951384">}</span><br>
<span class="lineno">620</span><span class="op" id="5951386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5951389">//&nbsp;used&nbsp;for&nbsp;building&nbsp;the&nbsp;basic&nbsp;types;&nbsp;called&nbsp;only&nbsp;from&nbsp;init().&nbsp;&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5951466">//&nbsp;interface&nbsp;always&nbsp;refers&nbsp;to&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="keyword" id="5951507">func</span>&nbsp;<span class="ident" id="5951512">bootstrapType</span><span class="op" id="5951525">(</span><span class="ident" id="5951526">name</span>&nbsp;<span class="builtintype" id="5951531">string</span><span class="op" id="5951537">,</span>&nbsp;<span class="ident" id="5951539">e</span>&nbsp;<span class="keyword" id="5951541">interface</span><span class="op" id="5951550">{</span><span class="op" id="5951551">}</span><span class="op" id="5951552">,</span>&nbsp;<span class="ident" id="5951554">expect</span>&nbsp;<span class="ident" id="5951561">typeId</span><span class="op" id="5951567">)</span>&nbsp;<span class="ident" id="5951569">typeId</span>&nbsp;<span class="op" id="5951576">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951579">rt</span>&nbsp;<span class="op" id="5951582">:=</span>&nbsp;<span class="ident" id="5951585">reflect</span><span class="op" id="5951592">.</span><span class="ident" id="5951593">TypeOf</span><span class="op" id="5951599">(</span><span class="ident" id="5951600">e</span><span class="op" id="5951601">)</span><span class="op" id="5951602">.</span><span class="ident" id="5951603">Elem</span><span class="op" id="5951607">(</span><span class="op" id="5951608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951611">_</span><span class="op" id="5951612">,</span>&nbsp;<span class="ident" id="5951614">present</span>&nbsp;<span class="op" id="5951622">:=</span>&nbsp;<span class="ident" id="5951625">types</span><span class="op" id="5951630">[</span><span class="ident" id="5951631">rt</span><span class="op" id="5951633">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951636">if</span>&nbsp;<span class="ident" id="5951639">present</span>&nbsp;<span class="op" id="5951647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5951651">panic</span><span class="op" id="5951656">(</span><span class="string" id="5951657">&#34;bootstrap&nbsp;type&nbsp;already&nbsp;present:&nbsp;&#34;</span>&nbsp;<span class="op" id="5951692">+</span>&nbsp;<span class="ident" id="5951694">name</span>&nbsp;<span class="op" id="5951699">+</span>&nbsp;<span class="string" id="5951701">&#34;,&nbsp;&#34;</span>&nbsp;<span class="op" id="5951706">+</span>&nbsp;<span class="ident" id="5951708">rt</span><span class="op" id="5951710">.</span><span class="ident" id="5951711">String</span><span class="op" id="5951717">(</span><span class="op" id="5951718">)</span><span class="op" id="5951719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5951722">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951725">typ</span>&nbsp;<span class="op" id="5951729">:=</span>&nbsp;<span class="op" id="5951732">&amp;</span><span class="ident" id="5951733">CommonType</span><span class="op" id="5951743">{</span><span class="ident" id="5951744">Name</span><span class="op" id="5951748">:</span>&nbsp;<span class="ident" id="5951750">name</span><span class="op" id="5951754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951757">types</span><span class="op" id="5951762">[</span><span class="ident" id="5951763">rt</span><span class="op" id="5951765">]</span>&nbsp;<span class="op" id="5951767">=</span>&nbsp;<span class="ident" id="5951769">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951774">setTypeId</span><span class="op" id="5951783">(</span><span class="ident" id="5951784">typ</span><span class="op" id="5951787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951790">checkId</span><span class="op" id="5951797">(</span><span class="ident" id="5951798">expect</span><span class="op" id="5951804">,</span>&nbsp;<span class="ident" id="5951806">nextId</span><span class="op" id="5951812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951815">userType</span><span class="op" id="5951823">(</span><span class="ident" id="5951824">rt</span><span class="op" id="5951826">)</span>&nbsp;<span class="comment" id="5951828">//&nbsp;might&nbsp;as&nbsp;well&nbsp;cache&nbsp;it&nbsp;now</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951859">return</span>&nbsp;<span class="ident" id="5951866">nextId</span><br>
<span class="lineno"></span><span class="op" id="5951873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5951876">//&nbsp;Representation&nbsp;of&nbsp;the&nbsp;information&nbsp;we&nbsp;send&nbsp;and&nbsp;receive&nbsp;about&nbsp;this&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5951950">//&nbsp;Each&nbsp;value&nbsp;we&nbsp;send&nbsp;is&nbsp;preceded&nbsp;by&nbsp;its&nbsp;type&nbsp;definition:&nbsp;an&nbsp;encoded&nbsp;int.</span><br>
<span class="lineno">640</span><span class="comment" id="5952024">//&nbsp;However,&nbsp;the&nbsp;very&nbsp;first&nbsp;time&nbsp;we&nbsp;send&nbsp;the&nbsp;value,&nbsp;we&nbsp;first&nbsp;send&nbsp;the&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="5952098">//&nbsp;(-id,&nbsp;wireType).</span><br>
<span class="lineno"></span><span class="comment" id="5952118">//&nbsp;For&nbsp;bootstrapping&nbsp;purposes,&nbsp;we&nbsp;assume&nbsp;that&nbsp;the&nbsp;recipient&nbsp;knows&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="5952188">//&nbsp;to&nbsp;decode&nbsp;a&nbsp;wireType;&nbsp;it&nbsp;is&nbsp;exactly&nbsp;the&nbsp;wireType&nbsp;struct&nbsp;here,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="5952265">//&nbsp;using&nbsp;the&nbsp;gob&nbsp;rules&nbsp;for&nbsp;sending&nbsp;a&nbsp;structure,&nbsp;except&nbsp;that&nbsp;we&nbsp;assume&nbsp;the</span><br>
<span class="lineno">645</span><span class="comment" id="5952339">//&nbsp;ids&nbsp;for&nbsp;wireType&nbsp;and&nbsp;structType&nbsp;etc.&nbsp;are&nbsp;known.&nbsp;&nbsp;The&nbsp;relevant&nbsp;pieces</span><br>
<span class="lineno"></span><span class="comment" id="5952411">//&nbsp;are&nbsp;built&nbsp;in&nbsp;encode.go&#39;s&nbsp;init()&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5952456">//&nbsp;To&nbsp;maintain&nbsp;binary&nbsp;compatibility,&nbsp;if&nbsp;you&nbsp;extend&nbsp;this&nbsp;type,&nbsp;always&nbsp;put</span><br>
<span class="lineno"></span><span class="comment" id="5952529">//&nbsp;the&nbsp;new&nbsp;fields&nbsp;last.</span><br>
<span class="lineno"></span><span class="keyword" id="5952553">type</span>&nbsp;<span class="ident" id="5952558">wireType</span>&nbsp;<span class="keyword" id="5952567">struct</span>&nbsp;<span class="op" id="5952574">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952577">ArrayT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952594">*</span><span class="ident" id="5952595">arrayType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952606">SliceT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952623">*</span><span class="ident" id="5952624">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952635">StructT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952652">*</span><span class="ident" id="5952653">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952665">MapT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952682">*</span><span class="ident" id="5952683">mapType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952692">GobEncoderT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952709">*</span><span class="ident" id="5952710">gobEncoderType</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952726">BinaryMarshalerT</span>&nbsp;<span class="op" id="5952743">*</span><span class="ident" id="5952744">gobEncoderType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952760">TextMarshalerT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5952777">*</span><span class="ident" id="5952778">gobEncoderType</span><br>
<span class="lineno"></span><span class="op" id="5952793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5952796">func</span>&nbsp;<span class="op" id="5952801">(</span><span class="ident" id="5952802">w</span>&nbsp;<span class="op" id="5952804">*</span><span class="ident" id="5952805">wireType</span><span class="op" id="5952813">)</span>&nbsp;<span class="builtintype" id="5952815">string</span><span class="op" id="5952821">(</span><span class="op" id="5952822">)</span>&nbsp;<span class="builtintype" id="5952824">string</span>&nbsp;<span class="op" id="5952831">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952834">const</span>&nbsp;<span class="ident" id="5952840">unknown</span>&nbsp;<span class="op" id="5952848">=</span>&nbsp;<span class="string" id="5952850">&#34;unknown&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952866">if</span>&nbsp;<span class="ident" id="5952869">w</span>&nbsp;<span class="op" id="5952871">==</span>&nbsp;<span class="builtintype" id="5952874">nil</span>&nbsp;<span class="op" id="5952878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952882">return</span>&nbsp;<span class="ident" id="5952889">unknown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952901">switch</span>&nbsp;<span class="op" id="5952908">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952911">case</span>&nbsp;<span class="ident" id="5952916">w</span><span class="op" id="5952917">.</span><span class="ident" id="5952918">ArrayT</span>&nbsp;<span class="op" id="5952925">!=</span>&nbsp;<span class="builtintype" id="5952928">nil</span><span class="op" id="5952931">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952935">return</span>&nbsp;<span class="ident" id="5952942">w</span><span class="op" id="5952943">.</span><span class="ident" id="5952944">ArrayT</span><span class="op" id="5952950">.</span><span class="ident" id="5952951">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952957">case</span>&nbsp;<span class="ident" id="5952962">w</span><span class="op" id="5952963">.</span><span class="ident" id="5952964">SliceT</span>&nbsp;<span class="op" id="5952971">!=</span>&nbsp;<span class="builtintype" id="5952974">nil</span><span class="op" id="5952977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952981">return</span>&nbsp;<span class="ident" id="5952988">w</span><span class="op" id="5952989">.</span><span class="ident" id="5952990">SliceT</span><span class="op" id="5952996">.</span><span class="ident" id="5952997">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953003">case</span>&nbsp;<span class="ident" id="5953008">w</span><span class="op" id="5953009">.</span><span class="ident" id="5953010">StructT</span>&nbsp;<span class="op" id="5953018">!=</span>&nbsp;<span class="builtintype" id="5953021">nil</span><span class="op" id="5953024">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953028">return</span>&nbsp;<span class="ident" id="5953035">w</span><span class="op" id="5953036">.</span><span class="ident" id="5953037">StructT</span><span class="op" id="5953044">.</span><span class="ident" id="5953045">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953051">case</span>&nbsp;<span class="ident" id="5953056">w</span><span class="op" id="5953057">.</span><span class="ident" id="5953058">MapT</span>&nbsp;<span class="op" id="5953063">!=</span>&nbsp;<span class="builtintype" id="5953066">nil</span><span class="op" id="5953069">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953073">return</span>&nbsp;<span class="ident" id="5953080">w</span><span class="op" id="5953081">.</span><span class="ident" id="5953082">MapT</span><span class="op" id="5953086">.</span><span class="ident" id="5953087">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953093">case</span>&nbsp;<span class="ident" id="5953098">w</span><span class="op" id="5953099">.</span><span class="ident" id="5953100">GobEncoderT</span>&nbsp;<span class="op" id="5953112">!=</span>&nbsp;<span class="builtintype" id="5953115">nil</span><span class="op" id="5953118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953122">return</span>&nbsp;<span class="ident" id="5953129">w</span><span class="op" id="5953130">.</span><span class="ident" id="5953131">GobEncoderT</span><span class="op" id="5953142">.</span><span class="ident" id="5953143">Name</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953149">case</span>&nbsp;<span class="ident" id="5953154">w</span><span class="op" id="5953155">.</span><span class="ident" id="5953156">BinaryMarshalerT</span>&nbsp;<span class="op" id="5953173">!=</span>&nbsp;<span class="builtintype" id="5953176">nil</span><span class="op" id="5953179">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953183">return</span>&nbsp;<span class="ident" id="5953190">w</span><span class="op" id="5953191">.</span><span class="ident" id="5953192">BinaryMarshalerT</span><span class="op" id="5953208">.</span><span class="ident" id="5953209">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953215">case</span>&nbsp;<span class="ident" id="5953220">w</span><span class="op" id="5953221">.</span><span class="ident" id="5953222">TextMarshalerT</span>&nbsp;<span class="op" id="5953237">!=</span>&nbsp;<span class="builtintype" id="5953240">nil</span><span class="op" id="5953243">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953247">return</span>&nbsp;<span class="ident" id="5953254">w</span><span class="op" id="5953255">.</span><span class="ident" id="5953256">TextMarshalerT</span><span class="op" id="5953270">.</span><span class="ident" id="5953271">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5953277">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953280">return</span>&nbsp;<span class="ident" id="5953287">unknown</span><br>
<span class="lineno"></span><span class="op" id="5953295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5953298">type</span>&nbsp;<span class="ident" id="5953303">typeInfo</span>&nbsp;<span class="keyword" id="5953312">struct</span>&nbsp;<span class="op" id="5953319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953322">id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953330">typeId</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953338">encInit</span>&nbsp;<span class="ident" id="5953346">sync</span><span class="op" id="5953350">.</span><span class="ident" id="5953351">Mutex</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5953359">//&nbsp;protects&nbsp;creation&nbsp;of&nbsp;encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953392">encoder</span>&nbsp;<span class="ident" id="5953400">atomic</span><span class="op" id="5953406">.</span><span class="ident" id="5953407">Value</span>&nbsp;<span class="comment" id="5953413">//&nbsp;*encEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953428">wire</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5953436">*</span><span class="ident" id="5953437">wireType</span><br>
<span class="lineno"></span><span class="op" id="5953446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">690</span><span class="comment" id="5953449">//&nbsp;typeInfoMap&nbsp;is&nbsp;an&nbsp;atomic&nbsp;pointer&nbsp;to&nbsp;map[reflect.Type]*typeInfo.</span><br>
<span class="lineno"></span><span class="comment" id="5953516">//&nbsp;It&#39;s&nbsp;updated&nbsp;copy-on-write.&nbsp;Readers&nbsp;just&nbsp;do&nbsp;an&nbsp;atomic&nbsp;load</span><br>
<span class="lineno"></span><span class="comment" id="5953578">//&nbsp;to&nbsp;get&nbsp;the&nbsp;current&nbsp;version&nbsp;of&nbsp;the&nbsp;map.&nbsp;Writers&nbsp;make&nbsp;a&nbsp;full&nbsp;copy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5953648">//&nbsp;the&nbsp;map&nbsp;and&nbsp;atomically&nbsp;update&nbsp;the&nbsp;pointer&nbsp;to&nbsp;point&nbsp;to&nbsp;the&nbsp;new&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="5953718">//&nbsp;Under&nbsp;heavy&nbsp;read&nbsp;contention,&nbsp;this&nbsp;is&nbsp;significantly&nbsp;faster&nbsp;than&nbsp;a&nbsp;map</span><br>
<span class="lineno">695</span><span class="comment" id="5953790">//&nbsp;protected&nbsp;by&nbsp;a&nbsp;mutex.</span><br>
<span class="lineno"></span><span class="keyword" id="5953815">var</span>&nbsp;<span class="ident" id="5953819">typeInfoMap</span>&nbsp;<span class="ident" id="5953831">atomic</span><span class="op" id="5953837">.</span><span class="ident" id="5953838">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5953845">func</span>&nbsp;<span class="ident" id="5953850">lookupTypeInfo</span><span class="op" id="5953864">(</span><span class="ident" id="5953865">rt</span>&nbsp;<span class="ident" id="5953868">reflect</span><span class="op" id="5953875">.</span><span class="ident" id="5953876">Type</span><span class="op" id="5953880">)</span>&nbsp;<span class="op" id="5953882">*</span><span class="ident" id="5953883">typeInfo</span>&nbsp;<span class="op" id="5953892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953895">m</span><span class="op" id="5953896">,</span>&nbsp;<span class="ident" id="5953898">_</span>&nbsp;<span class="op" id="5953900">:=</span>&nbsp;<span class="ident" id="5953903">typeInfoMap</span><span class="op" id="5953914">.</span><span class="ident" id="5953915">Load</span><span class="op" id="5953919">(</span><span class="op" id="5953920">)</span><span class="op" id="5953921">.</span><span class="op" id="5953922">(</span><span class="keyword" id="5953923">map</span><span class="op" id="5953926">[</span><span class="ident" id="5953927">reflect</span><span class="op" id="5953934">.</span><span class="ident" id="5953935">Type</span><span class="op" id="5953939">]</span><span class="op" id="5953940">*</span><span class="ident" id="5953941">typeInfo</span><span class="op" id="5953949">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953952">return</span>&nbsp;<span class="ident" id="5953959">m</span><span class="op" id="5953960">[</span><span class="ident" id="5953961">rt</span><span class="op" id="5953963">]</span><br>
<span class="lineno"></span><span class="op" id="5953965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5953968">func</span>&nbsp;<span class="ident" id="5953973">getTypeInfo</span><span class="op" id="5953984">(</span><span class="ident" id="5953985">ut</span>&nbsp;<span class="op" id="5953988">*</span><span class="ident" id="5953989">userTypeInfo</span><span class="op" id="5954001">)</span>&nbsp;<span class="op" id="5954003">(</span><span class="op" id="5954004">*</span><span class="ident" id="5954005">typeInfo</span><span class="op" id="5954013">,</span>&nbsp;<span class="builtintype" id="5954015">error</span><span class="op" id="5954020">)</span>&nbsp;<span class="op" id="5954022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954025">rt</span>&nbsp;<span class="op" id="5954028">:=</span>&nbsp;<span class="ident" id="5954031">ut</span><span class="op" id="5954033">.</span><span class="ident" id="5954034">base</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954040">if</span>&nbsp;<span class="ident" id="5954043">ut</span><span class="op" id="5954045">.</span><span class="ident" id="5954046">externalEnc</span>&nbsp;<span class="op" id="5954058">!=</span>&nbsp;<span class="num" id="5954061">0</span>&nbsp;<span class="op" id="5954063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5954067">//&nbsp;We&nbsp;want&nbsp;the&nbsp;user&nbsp;type,&nbsp;not&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954114">rt</span>&nbsp;<span class="op" id="5954117">=</span>&nbsp;<span class="ident" id="5954119">ut</span><span class="op" id="5954121">.</span><span class="ident" id="5954122">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5954128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954131">if</span>&nbsp;<span class="ident" id="5954134">info</span>&nbsp;<span class="op" id="5954139">:=</span>&nbsp;<span class="ident" id="5954142">lookupTypeInfo</span><span class="op" id="5954156">(</span><span class="ident" id="5954157">rt</span><span class="op" id="5954159">)</span><span class="op" id="5954160">;</span>&nbsp;<span class="ident" id="5954162">info</span>&nbsp;<span class="op" id="5954167">!=</span>&nbsp;<span class="builtintype" id="5954170">nil</span>&nbsp;<span class="op" id="5954174">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954178">return</span>&nbsp;<span class="ident" id="5954185">info</span><span class="op" id="5954189">,</span>&nbsp;<span class="builtintype" id="5954191">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5954196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954199">return</span>&nbsp;<span class="ident" id="5954206">buildTypeInfo</span><span class="op" id="5954219">(</span><span class="ident" id="5954220">ut</span><span class="op" id="5954222">,</span>&nbsp;<span class="ident" id="5954224">rt</span><span class="op" id="5954226">)</span><br>
<span class="lineno"></span><span class="op" id="5954228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">715</span><span class="comment" id="5954231">//&nbsp;buildTypeInfo&nbsp;constructs&nbsp;the&nbsp;type&nbsp;information&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5954293">//&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;type&nbsp;info&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="5954332">func</span>&nbsp;<span class="ident" id="5954337">buildTypeInfo</span><span class="op" id="5954350">(</span><span class="ident" id="5954351">ut</span>&nbsp;<span class="op" id="5954354">*</span><span class="ident" id="5954355">userTypeInfo</span><span class="op" id="5954367">,</span>&nbsp;<span class="ident" id="5954369">rt</span>&nbsp;<span class="ident" id="5954372">reflect</span><span class="op" id="5954379">.</span><span class="ident" id="5954380">Type</span><span class="op" id="5954384">)</span>&nbsp;<span class="op" id="5954386">(</span><span class="op" id="5954387">*</span><span class="ident" id="5954388">typeInfo</span><span class="op" id="5954396">,</span>&nbsp;<span class="builtintype" id="5954398">error</span><span class="op" id="5954403">)</span>&nbsp;<span class="op" id="5954405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954408">typeLock</span><span class="op" id="5954416">.</span><span class="ident" id="5954417">Lock</span><span class="op" id="5954421">(</span><span class="op" id="5954422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954425">defer</span>&nbsp;<span class="ident" id="5954431">typeLock</span><span class="op" id="5954439">.</span><span class="ident" id="5954440">Unlock</span><span class="op" id="5954446">(</span><span class="op" id="5954447">)</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954451">if</span>&nbsp;<span class="ident" id="5954454">info</span>&nbsp;<span class="op" id="5954459">:=</span>&nbsp;<span class="ident" id="5954462">lookupTypeInfo</span><span class="op" id="5954476">(</span><span class="ident" id="5954477">rt</span><span class="op" id="5954479">)</span><span class="op" id="5954480">;</span>&nbsp;<span class="ident" id="5954482">info</span>&nbsp;<span class="op" id="5954487">!=</span>&nbsp;<span class="builtintype" id="5954490">nil</span>&nbsp;<span class="op" id="5954494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954498">return</span>&nbsp;<span class="ident" id="5954505">info</span><span class="op" id="5954509">,</span>&nbsp;<span class="builtintype" id="5954511">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5954516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954520">gt</span><span class="op" id="5954522">,</span>&nbsp;<span class="ident" id="5954524">err</span>&nbsp;<span class="op" id="5954528">:=</span>&nbsp;<span class="ident" id="5954531">getBaseType</span><span class="op" id="5954542">(</span><span class="ident" id="5954543">rt</span><span class="op" id="5954545">.</span><span class="ident" id="5954546">Name</span><span class="op" id="5954550">(</span><span class="op" id="5954551">)</span><span class="op" id="5954552">,</span>&nbsp;<span class="ident" id="5954554">rt</span><span class="op" id="5954556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954559">if</span>&nbsp;<span class="ident" id="5954562">err</span>&nbsp;<span class="op" id="5954566">!=</span>&nbsp;<span class="builtintype" id="5954569">nil</span>&nbsp;<span class="op" id="5954573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954577">return</span>&nbsp;<span class="builtintype" id="5954584">nil</span><span class="op" id="5954587">,</span>&nbsp;<span class="ident" id="5954589">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5954594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954597">info</span>&nbsp;<span class="op" id="5954602">:=</span>&nbsp;<span class="op" id="5954605">&amp;</span><span class="ident" id="5954606">typeInfo</span><span class="op" id="5954614">{</span><span class="ident" id="5954615">id</span><span class="op" id="5954617">:</span>&nbsp;<span class="ident" id="5954619">gt</span><span class="op" id="5954621">.</span><span class="ident" id="5954622">id</span><span class="op" id="5954624">(</span><span class="op" id="5954625">)</span><span class="op" id="5954626">}</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954630">if</span>&nbsp;<span class="ident" id="5954633">ut</span><span class="op" id="5954635">.</span><span class="ident" id="5954636">externalEnc</span>&nbsp;<span class="op" id="5954648">!=</span>&nbsp;<span class="num" id="5954651">0</span>&nbsp;<span class="op" id="5954653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954657">userType</span><span class="op" id="5954665">,</span>&nbsp;<span class="ident" id="5954667">err</span>&nbsp;<span class="op" id="5954671">:=</span>&nbsp;<span class="ident" id="5954674">getType</span><span class="op" id="5954681">(</span><span class="ident" id="5954682">rt</span><span class="op" id="5954684">.</span><span class="ident" id="5954685">Name</span><span class="op" id="5954689">(</span><span class="op" id="5954690">)</span><span class="op" id="5954691">,</span>&nbsp;<span class="ident" id="5954693">ut</span><span class="op" id="5954695">,</span>&nbsp;<span class="ident" id="5954697">rt</span><span class="op" id="5954699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954703">if</span>&nbsp;<span class="ident" id="5954706">err</span>&nbsp;<span class="op" id="5954710">!=</span>&nbsp;<span class="builtintype" id="5954713">nil</span>&nbsp;<span class="op" id="5954717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954722">return</span>&nbsp;<span class="builtintype" id="5954729">nil</span><span class="op" id="5954732">,</span>&nbsp;<span class="ident" id="5954734">err</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5954740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954744">gt</span>&nbsp;<span class="op" id="5954747">:=</span>&nbsp;<span class="ident" id="5954750">userType</span><span class="op" id="5954758">.</span><span class="ident" id="5954759">id</span><span class="op" id="5954761">(</span><span class="op" id="5954762">)</span><span class="op" id="5954763">.</span><span class="ident" id="5954764">gobType</span><span class="op" id="5954771">(</span><span class="op" id="5954772">)</span><span class="op" id="5954773">.</span><span class="op" id="5954774">(</span><span class="op" id="5954775">*</span><span class="ident" id="5954776">gobEncoderType</span><span class="op" id="5954790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954794">switch</span>&nbsp;<span class="ident" id="5954801">ut</span><span class="op" id="5954803">.</span><span class="ident" id="5954804">externalEnc</span>&nbsp;<span class="op" id="5954816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954820">case</span>&nbsp;<span class="ident" id="5954825">xGob</span><span class="op" id="5954829">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954834">info</span><span class="op" id="5954838">.</span><span class="ident" id="5954839">wire</span>&nbsp;<span class="op" id="5954844">=</span>&nbsp;<span class="op" id="5954846">&amp;</span><span class="ident" id="5954847">wireType</span><span class="op" id="5954855">{</span><span class="ident" id="5954856">GobEncoderT</span><span class="op" id="5954867">:</span>&nbsp;<span class="ident" id="5954869">gt</span><span class="op" id="5954871">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954875">case</span>&nbsp;<span class="ident" id="5954880">xBinary</span><span class="op" id="5954887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954892">info</span><span class="op" id="5954896">.</span><span class="ident" id="5954897">wire</span>&nbsp;<span class="op" id="5954902">=</span>&nbsp;<span class="op" id="5954904">&amp;</span><span class="ident" id="5954905">wireType</span><span class="op" id="5954913">{</span><span class="ident" id="5954914">BinaryMarshalerT</span><span class="op" id="5954930">:</span>&nbsp;<span class="ident" id="5954932">gt</span><span class="op" id="5954934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954938">case</span>&nbsp;<span class="ident" id="5954943">xText</span><span class="op" id="5954948">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954953">info</span><span class="op" id="5954957">.</span><span class="ident" id="5954958">wire</span>&nbsp;<span class="op" id="5954963">=</span>&nbsp;<span class="op" id="5954965">&amp;</span><span class="ident" id="5954966">wireType</span><span class="op" id="5954974">{</span><span class="ident" id="5954975">TextMarshalerT</span><span class="op" id="5954989">:</span>&nbsp;<span class="ident" id="5954991">gt</span><span class="op" id="5954993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5954997">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955001">rt</span>&nbsp;<span class="op" id="5955004">=</span>&nbsp;<span class="ident" id="5955006">ut</span><span class="op" id="5955008">.</span><span class="ident" id="5955009">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5955015">}</span>&nbsp;<span class="keyword" id="5955017">else</span>&nbsp;<span class="op" id="5955022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955026">t</span>&nbsp;<span class="op" id="5955028">:=</span>&nbsp;<span class="ident" id="5955031">info</span><span class="op" id="5955035">.</span><span class="ident" id="5955036">id</span><span class="op" id="5955038">.</span><span class="ident" id="5955039">gobType</span><span class="op" id="5955046">(</span><span class="op" id="5955047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955051">switch</span>&nbsp;<span class="ident" id="5955058">typ</span>&nbsp;<span class="op" id="5955062">:=</span>&nbsp;<span class="ident" id="5955065">rt</span><span class="op" id="5955067">;</span>&nbsp;<span class="ident" id="5955069">typ</span><span class="op" id="5955072">.</span><span class="ident" id="5955073">Kind</span><span class="op" id="5955077">(</span><span class="op" id="5955078">)</span>&nbsp;<span class="op" id="5955080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955084">case</span>&nbsp;<span class="ident" id="5955089">reflect</span><span class="op" id="5955096">.</span><span class="ident" id="5955097">Array</span><span class="op" id="5955102">:</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955107">info</span><span class="op" id="5955111">.</span><span class="ident" id="5955112">wire</span>&nbsp;<span class="op" id="5955117">=</span>&nbsp;<span class="op" id="5955119">&amp;</span><span class="ident" id="5955120">wireType</span><span class="op" id="5955128">{</span><span class="ident" id="5955129">ArrayT</span><span class="op" id="5955135">:</span>&nbsp;<span class="ident" id="5955137">t</span><span class="op" id="5955138">.</span><span class="op" id="5955139">(</span><span class="op" id="5955140">*</span><span class="ident" id="5955141">arrayType</span><span class="op" id="5955150">)</span><span class="op" id="5955151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955155">case</span>&nbsp;<span class="ident" id="5955160">reflect</span><span class="op" id="5955167">.</span><span class="ident" id="5955168">Map</span><span class="op" id="5955171">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955176">info</span><span class="op" id="5955180">.</span><span class="ident" id="5955181">wire</span>&nbsp;<span class="op" id="5955186">=</span>&nbsp;<span class="op" id="5955188">&amp;</span><span class="ident" id="5955189">wireType</span><span class="op" id="5955197">{</span><span class="ident" id="5955198">MapT</span><span class="op" id="5955202">:</span>&nbsp;<span class="ident" id="5955204">t</span><span class="op" id="5955205">.</span><span class="op" id="5955206">(</span><span class="op" id="5955207">*</span><span class="ident" id="5955208">mapType</span><span class="op" id="5955215">)</span><span class="op" id="5955216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955220">case</span>&nbsp;<span class="ident" id="5955225">reflect</span><span class="op" id="5955232">.</span><span class="ident" id="5955233">Slice</span><span class="op" id="5955238">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5955243">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;handled&nbsp;separately</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955304">if</span>&nbsp;<span class="ident" id="5955307">typ</span><span class="op" id="5955310">.</span><span class="ident" id="5955311">Elem</span><span class="op" id="5955315">(</span><span class="op" id="5955316">)</span><span class="op" id="5955317">.</span><span class="ident" id="5955318">Kind</span><span class="op" id="5955322">(</span><span class="op" id="5955323">)</span>&nbsp;<span class="op" id="5955325">!=</span>&nbsp;<span class="ident" id="5955328">reflect</span><span class="op" id="5955335">.</span><span class="ident" id="5955336">Uint8</span>&nbsp;<span class="op" id="5955342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955348">info</span><span class="op" id="5955352">.</span><span class="ident" id="5955353">wire</span>&nbsp;<span class="op" id="5955358">=</span>&nbsp;<span class="op" id="5955360">&amp;</span><span class="ident" id="5955361">wireType</span><span class="op" id="5955369">{</span><span class="ident" id="5955370">SliceT</span><span class="op" id="5955376">:</span>&nbsp;<span class="ident" id="5955378">t</span><span class="op" id="5955379">.</span><span class="op" id="5955380">(</span><span class="op" id="5955381">*</span><span class="ident" id="5955382">sliceType</span><span class="op" id="5955391">)</span><span class="op" id="5955392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5955397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955401">case</span>&nbsp;<span class="ident" id="5955406">reflect</span><span class="op" id="5955413">.</span><span class="ident" id="5955414">Struct</span><span class="op" id="5955420">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955425">info</span><span class="op" id="5955429">.</span><span class="ident" id="5955430">wire</span>&nbsp;<span class="op" id="5955435">=</span>&nbsp;<span class="op" id="5955437">&amp;</span><span class="ident" id="5955438">wireType</span><span class="op" id="5955446">{</span><span class="ident" id="5955447">StructT</span><span class="op" id="5955454">:</span>&nbsp;<span class="ident" id="5955456">t</span><span class="op" id="5955457">.</span><span class="op" id="5955458">(</span><span class="op" id="5955459">*</span><span class="ident" id="5955460">structType</span><span class="op" id="5955470">)</span><span class="op" id="5955471">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5955475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5955478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5955482">//&nbsp;Create&nbsp;new&nbsp;map&nbsp;with&nbsp;old&nbsp;contents&nbsp;plus&nbsp;new&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955535">newm</span>&nbsp;<span class="op" id="5955540">:=</span>&nbsp;<span class="builtinfunc" id="5955543">make</span><span class="op" id="5955547">(</span><span class="keyword" id="5955548">map</span><span class="op" id="5955551">[</span><span class="ident" id="5955552">reflect</span><span class="op" id="5955559">.</span><span class="ident" id="5955560">Type</span><span class="op" id="5955564">]</span><span class="op" id="5955565">*</span><span class="ident" id="5955566">typeInfo</span><span class="op" id="5955574">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955577">m</span><span class="op" id="5955578">,</span>&nbsp;<span class="ident" id="5955580">_</span>&nbsp;<span class="op" id="5955582">:=</span>&nbsp;<span class="ident" id="5955585">typeInfoMap</span><span class="op" id="5955596">.</span><span class="ident" id="5955597">Load</span><span class="op" id="5955601">(</span><span class="op" id="5955602">)</span><span class="op" id="5955603">.</span><span class="op" id="5955604">(</span><span class="keyword" id="5955605">map</span><span class="op" id="5955608">[</span><span class="ident" id="5955609">reflect</span><span class="op" id="5955616">.</span><span class="ident" id="5955617">Type</span><span class="op" id="5955621">]</span><span class="op" id="5955622">*</span><span class="ident" id="5955623">typeInfo</span><span class="op" id="5955631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955634">for</span>&nbsp;<span class="ident" id="5955638">k</span><span class="op" id="5955639">,</span>&nbsp;<span class="ident" id="5955641">v</span>&nbsp;<span class="op" id="5955643">:=</span>&nbsp;<span class="keyword" id="5955646">range</span>&nbsp;<span class="ident" id="5955652">m</span>&nbsp;<span class="op" id="5955654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955658">newm</span><span class="op" id="5955662">[</span><span class="ident" id="5955663">k</span><span class="op" id="5955664">]</span>&nbsp;<span class="op" id="5955666">=</span>&nbsp;<span class="ident" id="5955668">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5955671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955674">newm</span><span class="op" id="5955678">[</span><span class="ident" id="5955679">rt</span><span class="op" id="5955681">]</span>&nbsp;<span class="op" id="5955683">=</span>&nbsp;<span class="ident" id="5955685">info</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955691">typeInfoMap</span><span class="op" id="5955702">.</span><span class="ident" id="5955703">Store</span><span class="op" id="5955708">(</span><span class="ident" id="5955709">newm</span><span class="op" id="5955713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955716">return</span>&nbsp;<span class="ident" id="5955723">info</span><span class="op" id="5955727">,</span>&nbsp;<span class="builtintype" id="5955729">nil</span><br>
<span class="lineno"></span><span class="op" id="5955733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5955736">//&nbsp;Called&nbsp;only&nbsp;when&nbsp;a&nbsp;panic&nbsp;is&nbsp;acceptable&nbsp;and&nbsp;unexpected.</span><br>
<span class="lineno">775</span><span class="keyword" id="5955794">func</span>&nbsp;<span class="ident" id="5955799">mustGetTypeInfo</span><span class="op" id="5955814">(</span><span class="ident" id="5955815">rt</span>&nbsp;<span class="ident" id="5955818">reflect</span><span class="op" id="5955825">.</span><span class="ident" id="5955826">Type</span><span class="op" id="5955830">)</span>&nbsp;<span class="op" id="5955832">*</span><span class="ident" id="5955833">typeInfo</span>&nbsp;<span class="op" id="5955842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955845">t</span><span class="op" id="5955846">,</span>&nbsp;<span class="ident" id="5955848">err</span>&nbsp;<span class="op" id="5955852">:=</span>&nbsp;<span class="ident" id="5955855">getTypeInfo</span><span class="op" id="5955866">(</span><span class="ident" id="5955867">userType</span><span class="op" id="5955875">(</span><span class="ident" id="5955876">rt</span><span class="op" id="5955878">)</span><span class="op" id="5955879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955882">if</span>&nbsp;<span class="ident" id="5955885">err</span>&nbsp;<span class="op" id="5955889">!=</span>&nbsp;<span class="builtintype" id="5955892">nil</span>&nbsp;<span class="op" id="5955896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5955900">panic</span><span class="op" id="5955905">(</span><span class="string" id="5955906">&#34;getTypeInfo:&nbsp;&#34;</span>&nbsp;<span class="op" id="5955922">+</span>&nbsp;<span class="ident" id="5955924">err</span><span class="op" id="5955927">.</span><span class="ident" id="5955928">Error</span><span class="op" id="5955933">(</span><span class="op" id="5955934">)</span><span class="op" id="5955935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5955938">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955941">return</span>&nbsp;<span class="ident" id="5955948">t</span><br>
<span class="lineno"></span><span class="op" id="5955950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5955953">//&nbsp;GobEncoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="5956022">//&nbsp;representation&nbsp;for&nbsp;encoding&nbsp;values&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder.</span><br>
<span class="lineno">785</span><span class="comment" id="5956094">//&nbsp;A&nbsp;type&nbsp;that&nbsp;implements&nbsp;GobEncoder&nbsp;and&nbsp;GobDecoder&nbsp;has&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="5956159">//&nbsp;control&nbsp;over&nbsp;the&nbsp;representation&nbsp;of&nbsp;its&nbsp;data&nbsp;and&nbsp;may&nbsp;therefore</span><br>
<span class="lineno"></span><span class="comment" id="5956224">//&nbsp;contain&nbsp;things&nbsp;such&nbsp;as&nbsp;private&nbsp;fields,&nbsp;channels,&nbsp;and&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="5956291">//&nbsp;which&nbsp;are&nbsp;not&nbsp;usually&nbsp;transmissible&nbsp;in&nbsp;gob&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="5956346">//</span><br>
<span class="lineno">790</span><span class="comment" id="5956349">//&nbsp;Note:&nbsp;Since&nbsp;gobs&nbsp;can&nbsp;be&nbsp;stored&nbsp;permanently,&nbsp;It&nbsp;is&nbsp;good&nbsp;design</span><br>
<span class="lineno"></span><span class="comment" id="5956414">//&nbsp;to&nbsp;guarantee&nbsp;the&nbsp;encoding&nbsp;used&nbsp;by&nbsp;a&nbsp;GobEncoder&nbsp;is&nbsp;stable&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5956481">//&nbsp;software&nbsp;evolves.&nbsp;&nbsp;For&nbsp;instance,&nbsp;it&nbsp;might&nbsp;make&nbsp;sense&nbsp;for&nbsp;GobEncode</span><br>
<span class="lineno"></span><span class="comment" id="5956551">//&nbsp;to&nbsp;include&nbsp;a&nbsp;version&nbsp;number&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5956599">type</span>&nbsp;<span class="ident" id="5956604">GobEncoder</span>&nbsp;<span class="keyword" id="5956615">interface</span>&nbsp;<span class="op" id="5956625">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5956628">//&nbsp;GobEncode&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;representing&nbsp;the&nbsp;encoding&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5956696">//&nbsp;receiver&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder,&nbsp;usually&nbsp;of&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5956763">//&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956782">GobEncode</span><span class="op" id="5956791">(</span><span class="op" id="5956792">)</span>&nbsp;<span class="op" id="5956794">(</span><span class="op" id="5956795">[</span><span class="op" id="5956796">]</span><span class="builtintype" id="5956797">byte</span><span class="op" id="5956801">,</span>&nbsp;<span class="builtintype" id="5956803">error</span><span class="op" id="5956808">)</span><br>
<span class="lineno"></span><span class="op" id="5956810">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="5956813">//&nbsp;GobDecoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="5956882">//&nbsp;routine&nbsp;for&nbsp;decoding&nbsp;transmitted&nbsp;values&nbsp;sent&nbsp;by&nbsp;a&nbsp;GobEncoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5956947">type</span>&nbsp;<span class="ident" id="5956952">GobDecoder</span>&nbsp;<span class="keyword" id="5956963">interface</span>&nbsp;<span class="op" id="5956973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5956976">//&nbsp;GobDecode&nbsp;overwrites&nbsp;the&nbsp;receiver,&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer,</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5957040">//&nbsp;with&nbsp;the&nbsp;value&nbsp;represented&nbsp;by&nbsp;the&nbsp;byte&nbsp;slice,&nbsp;which&nbsp;was&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5957108">//&nbsp;by&nbsp;GobEncode,&nbsp;usually&nbsp;for&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957162">GobDecode</span><span class="op" id="5957171">(</span><span class="op" id="5957172">[</span><span class="op" id="5957173">]</span><span class="builtintype" id="5957174">byte</span><span class="op" id="5957178">)</span>&nbsp;<span class="builtintype" id="5957180">error</span><br>
<span class="lineno"></span><span class="op" id="5957186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="5957189">var</span>&nbsp;<span class="op" id="5957193">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957196">registerLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957215">sync</span><span class="op" id="5957219">.</span><span class="ident" id="5957220">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957229">nameToConcreteType</span>&nbsp;<span class="op" id="5957248">=</span>&nbsp;<span class="builtinfunc" id="5957250">make</span><span class="op" id="5957254">(</span><span class="keyword" id="5957255">map</span><span class="op" id="5957258">[</span><span class="builtintype" id="5957259">string</span><span class="op" id="5957265">]</span><span class="ident" id="5957266">reflect</span><span class="op" id="5957273">.</span><span class="ident" id="5957274">Type</span><span class="op" id="5957278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957281">concreteTypeToName</span>&nbsp;<span class="op" id="5957300">=</span>&nbsp;<span class="builtinfunc" id="5957302">make</span><span class="op" id="5957306">(</span><span class="keyword" id="5957307">map</span><span class="op" id="5957310">[</span><span class="ident" id="5957311">reflect</span><span class="op" id="5957318">.</span><span class="ident" id="5957319">Type</span><span class="op" id="5957323">]</span><span class="builtintype" id="5957324">string</span><span class="op" id="5957330">)</span><br>
<span class="lineno"></span><span class="op" id="5957332">)</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="5957335">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;rather&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5957411">//&nbsp;type&#39;s&nbsp;default.</span><br>
<span class="lineno"></span><span class="keyword" id="5957430">func</span>&nbsp;<span class="ident" id="5957435">RegisterName</span><span class="op" id="5957447">(</span><span class="ident" id="5957448">name</span>&nbsp;<span class="builtintype" id="5957453">string</span><span class="op" id="5957459">,</span>&nbsp;<span class="ident" id="5957461">value</span>&nbsp;<span class="keyword" id="5957467">interface</span><span class="op" id="5957476">{</span><span class="op" id="5957477">}</span><span class="op" id="5957478">)</span>&nbsp;<span class="op" id="5957480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957483">if</span>&nbsp;<span class="ident" id="5957486">name</span>&nbsp;<span class="op" id="5957491">==</span>&nbsp;<span class="string" id="5957494">&#34;&#34;</span>&nbsp;<span class="op" id="5957497">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5957501">//&nbsp;reserved&nbsp;for&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5957523">panic</span><span class="op" id="5957528">(</span><span class="string" id="5957529">&#34;attempt&nbsp;to&nbsp;register&nbsp;empty&nbsp;name&#34;</span><span class="op" id="5957561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5957564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957567">registerLock</span><span class="op" id="5957579">.</span><span class="ident" id="5957580">Lock</span><span class="op" id="5957584">(</span><span class="op" id="5957585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957588">defer</span>&nbsp;<span class="ident" id="5957594">registerLock</span><span class="op" id="5957606">.</span><span class="ident" id="5957607">Unlock</span><span class="op" id="5957613">(</span><span class="op" id="5957614">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957617">ut</span>&nbsp;<span class="op" id="5957620">:=</span>&nbsp;<span class="ident" id="5957623">userType</span><span class="op" id="5957631">(</span><span class="ident" id="5957632">reflect</span><span class="op" id="5957639">.</span><span class="ident" id="5957640">TypeOf</span><span class="op" id="5957646">(</span><span class="ident" id="5957647">value</span><span class="op" id="5957652">)</span><span class="op" id="5957653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5957656">//&nbsp;Check&nbsp;for&nbsp;incompatible&nbsp;duplicates.&nbsp;The&nbsp;name&nbsp;must&nbsp;refer&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5957722">//&nbsp;same&nbsp;user&nbsp;type,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957758">if</span>&nbsp;<span class="ident" id="5957761">t</span><span class="op" id="5957762">,</span>&nbsp;<span class="ident" id="5957764">ok</span>&nbsp;<span class="op" id="5957767">:=</span>&nbsp;<span class="ident" id="5957770">nameToConcreteType</span><span class="op" id="5957788">[</span><span class="ident" id="5957789">name</span><span class="op" id="5957793">]</span><span class="op" id="5957794">;</span>&nbsp;<span class="ident" id="5957796">ok</span>&nbsp;<span class="op" id="5957799">&amp;&amp;</span>&nbsp;<span class="ident" id="5957802">t</span>&nbsp;<span class="op" id="5957804">!=</span>&nbsp;<span class="ident" id="5957807">ut</span><span class="op" id="5957809">.</span><span class="ident" id="5957810">user</span>&nbsp;<span class="op" id="5957815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5957819">panic</span><span class="op" id="5957824">(</span><span class="ident" id="5957825">fmt</span><span class="op" id="5957828">.</span><span class="ident" id="5957829">Sprintf</span><span class="op" id="5957836">(</span><span class="string" id="5957837">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;types&nbsp;for&nbsp;%q:&nbsp;%s&nbsp;!=&nbsp;%s&#34;</span><span class="op" id="5957888">,</span>&nbsp;<span class="ident" id="5957890">name</span><span class="op" id="5957894">,</span>&nbsp;<span class="ident" id="5957896">t</span><span class="op" id="5957897">,</span>&nbsp;<span class="ident" id="5957899">ut</span><span class="op" id="5957901">.</span><span class="ident" id="5957902">user</span><span class="op" id="5957906">)</span><span class="op" id="5957907">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5957910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957913">if</span>&nbsp;<span class="ident" id="5957916">n</span><span class="op" id="5957917">,</span>&nbsp;<span class="ident" id="5957919">ok</span>&nbsp;<span class="op" id="5957922">:=</span>&nbsp;<span class="ident" id="5957925">concreteTypeToName</span><span class="op" id="5957943">[</span><span class="ident" id="5957944">ut</span><span class="op" id="5957946">.</span><span class="ident" id="5957947">base</span><span class="op" id="5957951">]</span><span class="op" id="5957952">;</span>&nbsp;<span class="ident" id="5957954">ok</span>&nbsp;<span class="op" id="5957957">&amp;&amp;</span>&nbsp;<span class="ident" id="5957960">n</span>&nbsp;<span class="op" id="5957962">!=</span>&nbsp;<span class="ident" id="5957965">name</span>&nbsp;<span class="op" id="5957970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5957974">panic</span><span class="op" id="5957979">(</span><span class="ident" id="5957980">fmt</span><span class="op" id="5957983">.</span><span class="ident" id="5957984">Sprintf</span><span class="op" id="5957991">(</span><span class="string" id="5957992">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;names&nbsp;for&nbsp;%s:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="5958043">,</span>&nbsp;<span class="ident" id="5958045">ut</span><span class="op" id="5958047">.</span><span class="ident" id="5958048">user</span><span class="op" id="5958052">,</span>&nbsp;<span class="ident" id="5958054">n</span><span class="op" id="5958055">,</span>&nbsp;<span class="ident" id="5958057">name</span><span class="op" id="5958061">)</span><span class="op" id="5958062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5958068">//&nbsp;Store&nbsp;the&nbsp;name&nbsp;and&nbsp;type&nbsp;provided&nbsp;by&nbsp;the&nbsp;user....</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958121">nameToConcreteType</span><span class="op" id="5958139">[</span><span class="ident" id="5958140">name</span><span class="op" id="5958144">]</span>&nbsp;<span class="op" id="5958146">=</span>&nbsp;<span class="ident" id="5958148">reflect</span><span class="op" id="5958155">.</span><span class="ident" id="5958156">TypeOf</span><span class="op" id="5958162">(</span><span class="ident" id="5958163">value</span><span class="op" id="5958168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5958171">//&nbsp;but&nbsp;the&nbsp;flattened&nbsp;type&nbsp;in&nbsp;the&nbsp;type&nbsp;table,&nbsp;since&nbsp;that&#39;s&nbsp;what&nbsp;decode&nbsp;needs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958249">concreteTypeToName</span><span class="op" id="5958267">[</span><span class="ident" id="5958268">ut</span><span class="op" id="5958270">.</span><span class="ident" id="5958271">base</span><span class="op" id="5958275">]</span>&nbsp;<span class="op" id="5958277">=</span>&nbsp;<span class="ident" id="5958279">name</span><br>
<span class="lineno"></span><span class="op" id="5958284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="5958287">//&nbsp;Register&nbsp;records&nbsp;a&nbsp;type,&nbsp;identified&nbsp;by&nbsp;a&nbsp;value&nbsp;for&nbsp;that&nbsp;type,&nbsp;under&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5958362">//&nbsp;internal&nbsp;type&nbsp;name.&nbsp;&nbsp;That&nbsp;name&nbsp;will&nbsp;identify&nbsp;the&nbsp;concrete&nbsp;type&nbsp;of&nbsp;a&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5958439">//&nbsp;sent&nbsp;or&nbsp;received&nbsp;as&nbsp;an&nbsp;interface&nbsp;variable.&nbsp;&nbsp;Only&nbsp;types&nbsp;that&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5958510">//&nbsp;transferred&nbsp;as&nbsp;implementations&nbsp;of&nbsp;interface&nbsp;values&nbsp;need&nbsp;to&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span><span class="comment" id="5958587">//&nbsp;Expecting&nbsp;to&nbsp;be&nbsp;used&nbsp;only&nbsp;during&nbsp;initialization,&nbsp;it&nbsp;panics&nbsp;if&nbsp;the&nbsp;mapping</span><br>
<span class="lineno">845</span><span class="comment" id="5958664">//&nbsp;between&nbsp;types&nbsp;and&nbsp;names&nbsp;is&nbsp;not&nbsp;a&nbsp;bijection.</span><br>
<span class="lineno"></span><span class="keyword" id="5958711">func</span>&nbsp;<span class="ident" id="5958716">Register</span><span class="op" id="5958724">(</span><span class="ident" id="5958725">value</span>&nbsp;<span class="keyword" id="5958731">interface</span><span class="op" id="5958740">{</span><span class="op" id="5958741">}</span><span class="op" id="5958742">)</span>&nbsp;<span class="op" id="5958744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5958747">//&nbsp;Default&nbsp;to&nbsp;printed&nbsp;representation&nbsp;for&nbsp;unnamed&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958803">rt</span>&nbsp;<span class="op" id="5958806">:=</span>&nbsp;<span class="ident" id="5958809">reflect</span><span class="op" id="5958816">.</span><span class="ident" id="5958817">TypeOf</span><span class="op" id="5958823">(</span><span class="ident" id="5958824">value</span><span class="op" id="5958829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958832">name</span>&nbsp;<span class="op" id="5958837">:=</span>&nbsp;<span class="ident" id="5958840">rt</span><span class="op" id="5958842">.</span><span class="ident" id="5958843">String</span><span class="op" id="5958849">(</span><span class="op" id="5958850">)</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5958854">//&nbsp;But&nbsp;for&nbsp;named&nbsp;types&nbsp;(or&nbsp;pointers&nbsp;to&nbsp;them),&nbsp;qualify&nbsp;with&nbsp;import&nbsp;path&nbsp;(but&nbsp;see&nbsp;inner&nbsp;comment).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5958951">//&nbsp;Dereference&nbsp;one&nbsp;pointer&nbsp;looking&nbsp;for&nbsp;a&nbsp;named&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959005">star</span>&nbsp;<span class="op" id="5959010">:=</span>&nbsp;<span class="string" id="5959013">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959017">if</span>&nbsp;<span class="ident" id="5959020">rt</span><span class="op" id="5959022">.</span><span class="ident" id="5959023">Name</span><span class="op" id="5959027">(</span><span class="op" id="5959028">)</span>&nbsp;<span class="op" id="5959030">==</span>&nbsp;<span class="string" id="5959033">&#34;&#34;</span>&nbsp;<span class="op" id="5959036">{</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959040">if</span>&nbsp;<span class="ident" id="5959043">pt</span>&nbsp;<span class="op" id="5959046">:=</span>&nbsp;<span class="ident" id="5959049">rt</span><span class="op" id="5959051">;</span>&nbsp;<span class="ident" id="5959053">pt</span><span class="op" id="5959055">.</span><span class="ident" id="5959056">Kind</span><span class="op" id="5959060">(</span><span class="op" id="5959061">)</span>&nbsp;<span class="op" id="5959063">==</span>&nbsp;<span class="ident" id="5959066">reflect</span><span class="op" id="5959073">.</span><span class="ident" id="5959074">Ptr</span>&nbsp;<span class="op" id="5959078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959083">star</span>&nbsp;<span class="op" id="5959088">=</span>&nbsp;<span class="string" id="5959090">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959097">//&nbsp;NOTE:&nbsp;The&nbsp;following&nbsp;line&nbsp;should&nbsp;be&nbsp;rt&nbsp;=&nbsp;pt.Elem()&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959166">//&nbsp;what&nbsp;the&nbsp;comment&nbsp;above&nbsp;claims,&nbsp;but&nbsp;fixing&nbsp;it&nbsp;would&nbsp;break&nbsp;compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959243">//&nbsp;with&nbsp;existing&nbsp;gobs.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959269">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959275">//&nbsp;Given&nbsp;package&nbsp;p&nbsp;imported&nbsp;as&nbsp;&#34;full/p&#34;&nbsp;with&nbsp;these&nbsp;definitions:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959342">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959362">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;T1&nbsp;struct&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959395">//&nbsp;this&nbsp;table&nbsp;shows&nbsp;the&nbsp;intended&nbsp;and&nbsp;actual&nbsp;strings&nbsp;used&nbsp;by&nbsp;gob&nbsp;to</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959465">//&nbsp;name&nbsp;the&nbsp;types:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959487">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959493">//&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Correct&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actual&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959542">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959548">//&nbsp;T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959593">//&nbsp;*T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p.T1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959634">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959640">//&nbsp;The&nbsp;missing&nbsp;full&nbsp;path&nbsp;cannot&nbsp;be&nbsp;fixed&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;gob&nbsp;decoders.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959724">rt</span>&nbsp;<span class="op" id="5959727">=</span>&nbsp;<span class="ident" id="5959729">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959734">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959740">if</span>&nbsp;<span class="ident" id="5959743">rt</span><span class="op" id="5959745">.</span><span class="ident" id="5959746">Name</span><span class="op" id="5959750">(</span><span class="op" id="5959751">)</span>&nbsp;<span class="op" id="5959753">!=</span>&nbsp;<span class="string" id="5959756">&#34;&#34;</span>&nbsp;<span class="op" id="5959759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959763">if</span>&nbsp;<span class="ident" id="5959766">rt</span><span class="op" id="5959768">.</span><span class="ident" id="5959769">PkgPath</span><span class="op" id="5959776">(</span><span class="op" id="5959777">)</span>&nbsp;<span class="op" id="5959779">==</span>&nbsp;<span class="string" id="5959782">&#34;&#34;</span>&nbsp;<span class="op" id="5959785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959790">name</span>&nbsp;<span class="op" id="5959795">=</span>&nbsp;<span class="ident" id="5959797">star</span>&nbsp;<span class="op" id="5959802">+</span>&nbsp;<span class="ident" id="5959804">rt</span><span class="op" id="5959806">.</span><span class="ident" id="5959807">Name</span><span class="op" id="5959811">(</span><span class="op" id="5959812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959816">}</span>&nbsp;<span class="keyword" id="5959818">else</span>&nbsp;<span class="op" id="5959823">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959828">name</span>&nbsp;<span class="op" id="5959833">=</span>&nbsp;<span class="ident" id="5959835">star</span>&nbsp;<span class="op" id="5959840">+</span>&nbsp;<span class="ident" id="5959842">rt</span><span class="op" id="5959844">.</span><span class="ident" id="5959845">PkgPath</span><span class="op" id="5959852">(</span><span class="op" id="5959853">)</span>&nbsp;<span class="op" id="5959855">+</span>&nbsp;<span class="string" id="5959857">&#34;.&#34;</span>&nbsp;<span class="op" id="5959861">+</span>&nbsp;<span class="ident" id="5959863">rt</span><span class="op" id="5959865">.</span><span class="ident" id="5959866">Name</span><span class="op" id="5959870">(</span><span class="op" id="5959871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959882">RegisterName</span><span class="op" id="5959894">(</span><span class="ident" id="5959895">name</span><span class="op" id="5959899">,</span>&nbsp;<span class="ident" id="5959901">value</span><span class="op" id="5959906">)</span><br>
<span class="lineno">885</span><span class="op" id="5959908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5959911">func</span>&nbsp;<span class="ident" id="5959916">registerBasics</span><span class="op" id="5959930">(</span><span class="op" id="5959931">)</span>&nbsp;<span class="op" id="5959933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959936">Register</span><span class="op" id="5959944">(</span><span class="builtintype" id="5959945">int</span><span class="op" id="5959948">(</span><span class="num" id="5959949">0</span><span class="op" id="5959950">)</span><span class="op" id="5959951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959954">Register</span><span class="op" id="5959962">(</span><span class="builtintype" id="5959963">int8</span><span class="op" id="5959967">(</span><span class="num" id="5959968">0</span><span class="op" id="5959969">)</span><span class="op" id="5959970">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959973">Register</span><span class="op" id="5959981">(</span><span class="builtintype" id="5959982">int16</span><span class="op" id="5959987">(</span><span class="num" id="5959988">0</span><span class="op" id="5959989">)</span><span class="op" id="5959990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959993">Register</span><span class="op" id="5960001">(</span><span class="builtintype" id="5960002">int32</span><span class="op" id="5960007">(</span><span class="num" id="5960008">0</span><span class="op" id="5960009">)</span><span class="op" id="5960010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960013">Register</span><span class="op" id="5960021">(</span><span class="ident" id="5960022">int64</span><span class="op" id="5960027">(</span><span class="num" id="5960028">0</span><span class="op" id="5960029">)</span><span class="op" id="5960030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960033">Register</span><span class="op" id="5960041">(</span><span class="builtintype" id="5960042">uint</span><span class="op" id="5960046">(</span><span class="num" id="5960047">0</span><span class="op" id="5960048">)</span><span class="op" id="5960049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960052">Register</span><span class="op" id="5960060">(</span><span class="builtintype" id="5960061">uint8</span><span class="op" id="5960066">(</span><span class="num" id="5960067">0</span><span class="op" id="5960068">)</span><span class="op" id="5960069">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960072">Register</span><span class="op" id="5960080">(</span><span class="builtintype" id="5960081">uint16</span><span class="op" id="5960087">(</span><span class="num" id="5960088">0</span><span class="op" id="5960089">)</span><span class="op" id="5960090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960093">Register</span><span class="op" id="5960101">(</span><span class="builtintype" id="5960102">uint32</span><span class="op" id="5960108">(</span><span class="num" id="5960109">0</span><span class="op" id="5960110">)</span><span class="op" id="5960111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960114">Register</span><span class="op" id="5960122">(</span><span class="ident" id="5960123">uint64</span><span class="op" id="5960129">(</span><span class="num" id="5960130">0</span><span class="op" id="5960131">)</span><span class="op" id="5960132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960135">Register</span><span class="op" id="5960143">(</span><span class="builtintype" id="5960144">float32</span><span class="op" id="5960151">(</span><span class="num" id="5960152">0</span><span class="op" id="5960153">)</span><span class="op" id="5960154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960157">Register</span><span class="op" id="5960165">(</span><span class="builtintype" id="5960166">float64</span><span class="op" id="5960173">(</span><span class="num" id="5960174">0</span><span class="op" id="5960175">)</span><span class="op" id="5960176">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960179">Register</span><span class="op" id="5960187">(</span><span class="builtintype" id="5960188">complex64</span><span class="op" id="5960197">(</span><span class="num" id="5960198">0i</span><span class="op" id="5960200">)</span><span class="op" id="5960201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960204">Register</span><span class="op" id="5960212">(</span><span class="builtintype" id="5960213">complex128</span><span class="op" id="5960223">(</span><span class="num" id="5960224">0i</span><span class="op" id="5960226">)</span><span class="op" id="5960227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960230">Register</span><span class="op" id="5960238">(</span><span class="builtintype" id="5960239">uintptr</span><span class="op" id="5960246">(</span><span class="num" id="5960247">0</span><span class="op" id="5960248">)</span><span class="op" id="5960249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960252">Register</span><span class="op" id="5960260">(</span><span class="builtintype" id="5960261">false</span><span class="op" id="5960266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960269">Register</span><span class="op" id="5960277">(</span><span class="string" id="5960278">&#34;&#34;</span><span class="op" id="5960280">)</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960283">Register</span><span class="op" id="5960291">(</span><span class="op" id="5960292">[</span><span class="op" id="5960293">]</span><span class="builtintype" id="5960294">byte</span><span class="op" id="5960298">(</span><span class="builtintype" id="5960299">nil</span><span class="op" id="5960302">)</span><span class="op" id="5960303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960306">Register</span><span class="op" id="5960314">(</span><span class="op" id="5960315">[</span><span class="op" id="5960316">]</span><span class="builtintype" id="5960317">int</span><span class="op" id="5960320">(</span><span class="builtintype" id="5960321">nil</span><span class="op" id="5960324">)</span><span class="op" id="5960325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960328">Register</span><span class="op" id="5960336">(</span><span class="op" id="5960337">[</span><span class="op" id="5960338">]</span><span class="builtintype" id="5960339">int8</span><span class="op" id="5960343">(</span><span class="builtintype" id="5960344">nil</span><span class="op" id="5960347">)</span><span class="op" id="5960348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960351">Register</span><span class="op" id="5960359">(</span><span class="op" id="5960360">[</span><span class="op" id="5960361">]</span><span class="builtintype" id="5960362">int16</span><span class="op" id="5960367">(</span><span class="builtintype" id="5960368">nil</span><span class="op" id="5960371">)</span><span class="op" id="5960372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960375">Register</span><span class="op" id="5960383">(</span><span class="op" id="5960384">[</span><span class="op" id="5960385">]</span><span class="builtintype" id="5960386">int32</span><span class="op" id="5960391">(</span><span class="builtintype" id="5960392">nil</span><span class="op" id="5960395">)</span><span class="op" id="5960396">)</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960399">Register</span><span class="op" id="5960407">(</span><span class="op" id="5960408">[</span><span class="op" id="5960409">]</span><span class="ident" id="5960410">int64</span><span class="op" id="5960415">(</span><span class="builtintype" id="5960416">nil</span><span class="op" id="5960419">)</span><span class="op" id="5960420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960423">Register</span><span class="op" id="5960431">(</span><span class="op" id="5960432">[</span><span class="op" id="5960433">]</span><span class="builtintype" id="5960434">uint</span><span class="op" id="5960438">(</span><span class="builtintype" id="5960439">nil</span><span class="op" id="5960442">)</span><span class="op" id="5960443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960446">Register</span><span class="op" id="5960454">(</span><span class="op" id="5960455">[</span><span class="op" id="5960456">]</span><span class="builtintype" id="5960457">uint8</span><span class="op" id="5960462">(</span><span class="builtintype" id="5960463">nil</span><span class="op" id="5960466">)</span><span class="op" id="5960467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960470">Register</span><span class="op" id="5960478">(</span><span class="op" id="5960479">[</span><span class="op" id="5960480">]</span><span class="builtintype" id="5960481">uint16</span><span class="op" id="5960487">(</span><span class="builtintype" id="5960488">nil</span><span class="op" id="5960491">)</span><span class="op" id="5960492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960495">Register</span><span class="op" id="5960503">(</span><span class="op" id="5960504">[</span><span class="op" id="5960505">]</span><span class="builtintype" id="5960506">uint32</span><span class="op" id="5960512">(</span><span class="builtintype" id="5960513">nil</span><span class="op" id="5960516">)</span><span class="op" id="5960517">)</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960520">Register</span><span class="op" id="5960528">(</span><span class="op" id="5960529">[</span><span class="op" id="5960530">]</span><span class="ident" id="5960531">uint64</span><span class="op" id="5960537">(</span><span class="builtintype" id="5960538">nil</span><span class="op" id="5960541">)</span><span class="op" id="5960542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960545">Register</span><span class="op" id="5960553">(</span><span class="op" id="5960554">[</span><span class="op" id="5960555">]</span><span class="builtintype" id="5960556">float32</span><span class="op" id="5960563">(</span><span class="builtintype" id="5960564">nil</span><span class="op" id="5960567">)</span><span class="op" id="5960568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960571">Register</span><span class="op" id="5960579">(</span><span class="op" id="5960580">[</span><span class="op" id="5960581">]</span><span class="builtintype" id="5960582">float64</span><span class="op" id="5960589">(</span><span class="builtintype" id="5960590">nil</span><span class="op" id="5960593">)</span><span class="op" id="5960594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960597">Register</span><span class="op" id="5960605">(</span><span class="op" id="5960606">[</span><span class="op" id="5960607">]</span><span class="builtintype" id="5960608">complex64</span><span class="op" id="5960617">(</span><span class="builtintype" id="5960618">nil</span><span class="op" id="5960621">)</span><span class="op" id="5960622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960625">Register</span><span class="op" id="5960633">(</span><span class="op" id="5960634">[</span><span class="op" id="5960635">]</span><span class="builtintype" id="5960636">complex128</span><span class="op" id="5960646">(</span><span class="builtintype" id="5960647">nil</span><span class="op" id="5960650">)</span><span class="op" id="5960651">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960654">Register</span><span class="op" id="5960662">(</span><span class="op" id="5960663">[</span><span class="op" id="5960664">]</span><span class="builtintype" id="5960665">uintptr</span><span class="op" id="5960672">(</span><span class="builtintype" id="5960673">nil</span><span class="op" id="5960676">)</span><span class="op" id="5960677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960680">Register</span><span class="op" id="5960688">(</span><span class="op" id="5960689">[</span><span class="op" id="5960690">]</span><span class="builtintype" id="5960691">bool</span><span class="op" id="5960695">(</span><span class="builtintype" id="5960696">nil</span><span class="op" id="5960699">)</span><span class="op" id="5960700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960703">Register</span><span class="op" id="5960711">(</span><span class="op" id="5960712">[</span><span class="op" id="5960713">]</span><span class="builtintype" id="5960714">string</span><span class="op" id="5960720">(</span><span class="builtintype" id="5960721">nil</span><span class="op" id="5960724">)</span><span class="op" id="5960725">)</span><br>
<span class="lineno"></span><span class="op" id="5960727">}</span>
</div>
</body>
</html>
