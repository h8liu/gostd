<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5816233">package</span>&nbsp;<span class="ident" id="5816241">asm8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5816247">import</span>&nbsp;<span class="op" id="5816254">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5816257">&#34;lonnie.io/e8vm/lex8&#34;</span><br>
<span class="lineno">5</span><span class="op" id="5816279">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5816282">var</span>&nbsp;<span class="op" id="5816286">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5816289">//&nbsp;op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816296">opSysMap</span>&nbsp;<span class="op" id="5816305">=</span>&nbsp;<span class="keyword" id="5816307">map</span><span class="op" id="5816310">[</span><span class="builtintype" id="5816311">string</span><span class="op" id="5816317">]</span><span class="builtintype" id="5816318">uint32</span><span class="op" id="5816324">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5816328">&#34;halt&#34;</span><span class="op" id="5816334">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5816339">64</span><span class="op" id="5816341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5816345">&#34;syscall&#34;</span><span class="op" id="5816354">:</span>&nbsp;<span class="num" id="5816356">65</span><span class="op" id="5816358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5816362">&#34;usermod&#34;</span><span class="op" id="5816371">:</span>&nbsp;<span class="num" id="5816373">66</span><span class="op" id="5816375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5816379">&#34;iret&#34;</span><span class="op" id="5816385">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5816390">68</span><span class="op" id="5816392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816395">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5816399">//&nbsp;op&nbsp;reg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816410">opSys1Map</span>&nbsp;<span class="op" id="5816420">=</span>&nbsp;<span class="keyword" id="5816422">map</span><span class="op" id="5816425">[</span><span class="builtintype" id="5816426">string</span><span class="op" id="5816432">]</span><span class="builtintype" id="5816433">uint32</span><span class="op" id="5816439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5816443">&#34;vtable&#34;</span><span class="op" id="5816451">:</span>&nbsp;<span class="num" id="5816453">67</span><span class="op" id="5816455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5816459">&#34;cpuid&#34;</span><span class="op" id="5816466">:</span>&nbsp;&nbsp;<span class="num" id="5816469">69</span><span class="op" id="5816471">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816474">}</span><br>
<span class="lineno"></span><span class="op" id="5816476">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5816479">func</span>&nbsp;<span class="ident" id="5816484">makeInstSys</span><span class="op" id="5816495">(</span><span class="ident" id="5816496">op</span><span class="op" id="5816498">,</span>&nbsp;<span class="ident" id="5816500">reg</span>&nbsp;<span class="builtintype" id="5816504">uint32</span><span class="op" id="5816510">)</span>&nbsp;<span class="op" id="5816512">*</span><span class="ident" id="5816513">inst</span>&nbsp;<span class="op" id="5816518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816521">ret</span>&nbsp;<span class="op" id="5816525">:=</span>&nbsp;<span class="op" id="5816528">(</span><span class="op" id="5816529">(</span><span class="ident" id="5816530">op</span>&nbsp;<span class="op" id="5816533">&amp;</span>&nbsp;<span class="num" id="5816535">0xff</span><span class="op" id="5816539">)</span>&nbsp;<span class="op" id="5816541">&lt;&lt;</span>&nbsp;<span class="num" id="5816544">24</span><span class="op" id="5816546">)</span>&nbsp;<span class="op" id="5816548">|</span>&nbsp;<span class="op" id="5816550">(</span><span class="op" id="5816551">(</span><span class="ident" id="5816552">reg</span>&nbsp;<span class="op" id="5816556">&amp;</span>&nbsp;<span class="num" id="5816558">0x7</span><span class="op" id="5816561">)</span>&nbsp;<span class="op" id="5816563">&lt;&lt;</span>&nbsp;<span class="num" id="5816566">21</span><span class="op" id="5816568">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816571">return</span>&nbsp;<span class="op" id="5816578">&amp;</span><span class="ident" id="5816579">inst</span><span class="op" id="5816583">{</span><span class="ident" id="5816584">inst</span><span class="op" id="5816588">:</span>&nbsp;<span class="ident" id="5816590">ret</span><span class="op" id="5816593">}</span><br>
<span class="lineno"></span><span class="op" id="5816595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5816598">func</span>&nbsp;<span class="ident" id="5816603">parseInstSys</span><span class="op" id="5816615">(</span><span class="ident" id="5816616">p</span>&nbsp;<span class="op" id="5816618">*</span><span class="ident" id="5816619">parser</span><span class="op" id="5816625">,</span>&nbsp;<span class="ident" id="5816627">ops</span>&nbsp;<span class="op" id="5816631">[</span><span class="op" id="5816632">]</span><span class="op" id="5816633">*</span><span class="ident" id="5816634">lex8</span><span class="op" id="5816638">.</span><span class="ident" id="5816639">Token</span><span class="op" id="5816644">)</span>&nbsp;<span class="op" id="5816646">(</span><span class="op" id="5816647">*</span><span class="ident" id="5816648">inst</span><span class="op" id="5816652">,</span>&nbsp;<span class="builtintype" id="5816654">bool</span><span class="op" id="5816658">)</span>&nbsp;<span class="op" id="5816660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816663">op0</span>&nbsp;<span class="op" id="5816667">:=</span>&nbsp;<span class="ident" id="5816670">ops</span><span class="op" id="5816673">[</span><span class="num" id="5816674">0</span><span class="op" id="5816675">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816678">opName</span>&nbsp;<span class="op" id="5816685">:=</span>&nbsp;<span class="ident" id="5816688">op0</span><span class="op" id="5816691">.</span><span class="ident" id="5816692">Lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816697">args</span>&nbsp;<span class="op" id="5816702">:=</span>&nbsp;<span class="ident" id="5816705">ops</span><span class="op" id="5816708">[</span><span class="num" id="5816709">1</span><span class="op" id="5816710">:</span><span class="op" id="5816711">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816714">var</span>&nbsp;<span class="ident" id="5816718">op</span><span class="op" id="5816720">,</span>&nbsp;<span class="ident" id="5816722">reg</span>&nbsp;<span class="builtintype" id="5816726">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816735">argCount</span>&nbsp;<span class="op" id="5816744">:=</span>&nbsp;<span class="keyword" id="5816747">func</span><span class="op" id="5816751">(</span><span class="ident" id="5816752">n</span>&nbsp;<span class="builtintype" id="5816754">int</span><span class="op" id="5816757">)</span>&nbsp;<span class="builtintype" id="5816759">bool</span>&nbsp;<span class="op" id="5816764">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816768">if</span>&nbsp;<span class="op" id="5816771">!</span><span class="ident" id="5816772">argCount</span><span class="op" id="5816780">(</span><span class="ident" id="5816781">p</span><span class="op" id="5816782">,</span>&nbsp;<span class="ident" id="5816784">ops</span><span class="op" id="5816787">,</span>&nbsp;<span class="ident" id="5816789">n</span><span class="op" id="5816790">)</span>&nbsp;<span class="op" id="5816792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816797">return</span>&nbsp;<span class="ident" id="5816804">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816817">if</span>&nbsp;<span class="ident" id="5816820">n</span>&nbsp;<span class="op" id="5816822">&gt;=</span>&nbsp;<span class="num" id="5816825">1</span>&nbsp;<span class="op" id="5816827">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816832">reg</span>&nbsp;<span class="op" id="5816836">=</span>&nbsp;<span class="ident" id="5816838">parseReg</span><span class="op" id="5816846">(</span><span class="ident" id="5816847">p</span><span class="op" id="5816848">,</span>&nbsp;<span class="ident" id="5816850">args</span><span class="op" id="5816854">[</span><span class="num" id="5816855">0</span><span class="op" id="5816856">]</span><span class="op" id="5816857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816865">return</span>&nbsp;<span class="ident" id="5816872">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816882">var</span>&nbsp;<span class="ident" id="5816886">found</span>&nbsp;<span class="builtintype" id="5816892">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5816898">if</span>&nbsp;<span class="ident" id="5816901">op</span><span class="op" id="5816903">,</span>&nbsp;<span class="ident" id="5816905">found</span>&nbsp;<span class="op" id="5816911">=</span>&nbsp;<span class="ident" id="5816913">opSysMap</span><span class="op" id="5816921">[</span><span class="ident" id="5816922">opName</span><span class="op" id="5816928">]</span><span class="op" id="5816929">;</span>&nbsp;<span class="ident" id="5816931">found</span>&nbsp;<span class="op" id="5816937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5816941">//&nbsp;op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5816949">argCount</span><span class="op" id="5816957">(</span><span class="num" id="5816958">0</span><span class="op" id="5816959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5816962">}</span>&nbsp;<span class="keyword" id="5816964">else</span>&nbsp;<span class="keyword" id="5816969">if</span>&nbsp;<span class="ident" id="5816972">op</span><span class="op" id="5816974">,</span>&nbsp;<span class="ident" id="5816976">found</span>&nbsp;<span class="op" id="5816982">=</span>&nbsp;<span class="ident" id="5816984">opSys1Map</span><span class="op" id="5816993">[</span><span class="ident" id="5816994">opName</span><span class="op" id="5817000">]</span><span class="op" id="5817001">;</span>&nbsp;<span class="ident" id="5817003">found</span>&nbsp;<span class="op" id="5817009">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5817013">//&nbsp;op&nbsp;reg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5817025">argCount</span><span class="op" id="5817033">(</span><span class="num" id="5817034">1</span><span class="op" id="5817035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817038">}</span>&nbsp;<span class="keyword" id="5817040">else</span>&nbsp;<span class="op" id="5817045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817049">return</span>&nbsp;<span class="ident" id="5817056">nil</span><span class="op" id="5817059">,</span>&nbsp;<span class="ident" id="5817061">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5817068">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5817072">return</span>&nbsp;<span class="ident" id="5817079">makeInstSys</span><span class="op" id="5817090">(</span><span class="ident" id="5817091">op</span><span class="op" id="5817093">,</span>&nbsp;<span class="ident" id="5817095">reg</span><span class="op" id="5817098">)</span><span class="op" id="5817099">,</span>&nbsp;<span class="ident" id="5817101">true</span><br>
<span class="lineno"></span><span class="op" id="5817106">}</span>
</div>
</body>
</html>
