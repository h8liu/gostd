<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3244086">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3244142">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3244196">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3244247">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3244325">package</span>&nbsp;<span class="ident" id="3244333">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3244338">import</span>&nbsp;<span class="op" id="3244345">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3244348">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3244354">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3244365">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3244372">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3244375">//&nbsp;A&nbsp;sockaddr&nbsp;represents&nbsp;a&nbsp;TCP,&nbsp;UDP,&nbsp;IP&nbsp;or&nbsp;Unix&nbsp;network&nbsp;endpoint</span><br>
<span class="lineno"></span><span class="comment" id="3244440">//&nbsp;address&nbsp;that&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall.Sockaddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3244498">type</span>&nbsp;<span class="ident" id="3244503">sockaddr</span>&nbsp;<span class="keyword" id="3244512">interface</span>&nbsp;<span class="op" id="3244522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244525">Addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244532">netaddr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3244542">//&nbsp;family&nbsp;returns&nbsp;the&nbsp;platform-dependent&nbsp;address&nbsp;family</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3244599">//&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244615">family</span><span class="op" id="3244621">(</span><span class="op" id="3244622">)</span>&nbsp;<span class="builtintype" id="3244624">int</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3244630">//&nbsp;isWildcard&nbsp;reports&nbsp;whether&nbsp;the&nbsp;address&nbsp;is&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3244687">//&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244700">isWildcard</span><span class="op" id="3244710">(</span><span class="op" id="3244711">)</span>&nbsp;<span class="builtintype" id="3244713">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3244720">//&nbsp;sockaddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3244778">//&nbsp;sockaddr&nbsp;type&nbsp;that&nbsp;implements&nbsp;syscall.Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3244829">//&nbsp;interface.&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3244891">//&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244900">sockaddr</span><span class="op" id="3244908">(</span><span class="ident" id="3244909">family</span>&nbsp;<span class="builtintype" id="3244916">int</span><span class="op" id="3244919">)</span>&nbsp;<span class="op" id="3244921">(</span><span class="ident" id="3244922">syscall</span><span class="op" id="3244929">.</span><span class="ident" id="3244930">Sockaddr</span><span class="op" id="3244938">,</span>&nbsp;<span class="builtintype" id="3244940">error</span><span class="op" id="3244945">)</span><br>
<span class="lineno">35</span><span class="op" id="3244947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3244950">//&nbsp;socket&nbsp;returns&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;that&nbsp;is&nbsp;ready&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3245012">//&nbsp;asynchronous&nbsp;I/O&nbsp;using&nbsp;the&nbsp;network&nbsp;poller.</span><br>
<span class="lineno"></span><span class="keyword" id="3245058">func</span>&nbsp;<span class="ident" id="3245063">socket</span><span class="op" id="3245069">(</span><span class="ident" id="3245070">net</span>&nbsp;<span class="builtintype" id="3245074">string</span><span class="op" id="3245080">,</span>&nbsp;<span class="ident" id="3245082">family</span><span class="op" id="3245088">,</span>&nbsp;<span class="ident" id="3245090">sotype</span><span class="op" id="3245096">,</span>&nbsp;<span class="ident" id="3245098">proto</span>&nbsp;<span class="builtintype" id="3245104">int</span><span class="op" id="3245107">,</span>&nbsp;<span class="ident" id="3245109">ipv6only</span>&nbsp;<span class="builtintype" id="3245118">bool</span><span class="op" id="3245122">,</span>&nbsp;<span class="ident" id="3245124">laddr</span><span class="op" id="3245129">,</span>&nbsp;<span class="ident" id="3245131">raddr</span>&nbsp;<span class="ident" id="3245137">sockaddr</span><span class="op" id="3245145">,</span>&nbsp;<span class="ident" id="3245147">deadline</span>&nbsp;<span class="ident" id="3245156">time</span><span class="op" id="3245160">.</span><span class="ident" id="3245161">Time</span><span class="op" id="3245165">)</span>&nbsp;<span class="op" id="3245167">(</span><span class="ident" id="3245168">fd</span>&nbsp;<span class="op" id="3245171">*</span><span class="ident" id="3245172">netFD</span><span class="op" id="3245177">,</span>&nbsp;<span class="ident" id="3245179">err</span>&nbsp;<span class="builtintype" id="3245183">error</span><span class="op" id="3245188">)</span>&nbsp;<span class="op" id="3245190">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245193">s</span><span class="op" id="3245194">,</span>&nbsp;<span class="ident" id="3245196">err</span>&nbsp;<span class="op" id="3245200">:=</span>&nbsp;<span class="ident" id="3245203">sysSocket</span><span class="op" id="3245212">(</span><span class="ident" id="3245213">family</span><span class="op" id="3245219">,</span>&nbsp;<span class="ident" id="3245221">sotype</span><span class="op" id="3245227">,</span>&nbsp;<span class="ident" id="3245229">proto</span><span class="op" id="3245234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3245237">if</span>&nbsp;<span class="ident" id="3245240">err</span>&nbsp;<span class="op" id="3245244">!=</span>&nbsp;<span class="ident" id="3245247">nil</span>&nbsp;<span class="op" id="3245251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3245255">return</span>&nbsp;<span class="ident" id="3245262">nil</span><span class="op" id="3245265">,</span>&nbsp;<span class="ident" id="3245267">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3245272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3245275">if</span>&nbsp;<span class="ident" id="3245278">err</span>&nbsp;<span class="op" id="3245282">=</span>&nbsp;<span class="ident" id="3245284">setDefaultSockopts</span><span class="op" id="3245302">(</span><span class="ident" id="3245303">s</span><span class="op" id="3245304">,</span>&nbsp;<span class="ident" id="3245306">family</span><span class="op" id="3245312">,</span>&nbsp;<span class="ident" id="3245314">sotype</span><span class="op" id="3245320">,</span>&nbsp;<span class="ident" id="3245322">ipv6only</span><span class="op" id="3245330">)</span><span class="op" id="3245331">;</span>&nbsp;<span class="ident" id="3245333">err</span>&nbsp;<span class="op" id="3245337">!=</span>&nbsp;<span class="ident" id="3245340">nil</span>&nbsp;<span class="op" id="3245344">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245348">closesocket</span><span class="op" id="3245359">(</span><span class="ident" id="3245360">s</span><span class="op" id="3245361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3245365">return</span>&nbsp;<span class="ident" id="3245372">nil</span><span class="op" id="3245375">,</span>&nbsp;<span class="ident" id="3245377">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3245382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3245385">if</span>&nbsp;<span class="ident" id="3245388">fd</span><span class="op" id="3245390">,</span>&nbsp;<span class="ident" id="3245392">err</span>&nbsp;<span class="op" id="3245396">=</span>&nbsp;<span class="ident" id="3245398">newFD</span><span class="op" id="3245403">(</span><span class="ident" id="3245404">s</span><span class="op" id="3245405">,</span>&nbsp;<span class="ident" id="3245407">family</span><span class="op" id="3245413">,</span>&nbsp;<span class="ident" id="3245415">sotype</span><span class="op" id="3245421">,</span>&nbsp;<span class="ident" id="3245423">net</span><span class="op" id="3245426">)</span><span class="op" id="3245427">;</span>&nbsp;<span class="ident" id="3245429">err</span>&nbsp;<span class="op" id="3245433">!=</span>&nbsp;<span class="ident" id="3245436">nil</span>&nbsp;<span class="op" id="3245440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245444">closesocket</span><span class="op" id="3245455">(</span><span class="ident" id="3245456">s</span><span class="op" id="3245457">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3245461">return</span>&nbsp;<span class="ident" id="3245468">nil</span><span class="op" id="3245471">,</span>&nbsp;<span class="ident" id="3245473">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3245478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245482">//&nbsp;This&nbsp;function&nbsp;makes&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245540">//&nbsp;following&nbsp;applications:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245568">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245572">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;passive&nbsp;stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245625">//&nbsp;&nbsp;&nbsp;connenction,&nbsp;known&nbsp;as&nbsp;a&nbsp;stream&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245671">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245675">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;destination-unspecific</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245736">//&nbsp;&nbsp;&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a&nbsp;datagram&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245792">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245796">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;an&nbsp;active&nbsp;stream&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245854">//&nbsp;&nbsp;&nbsp;destination-specific&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245913">//&nbsp;&nbsp;&nbsp;dialer</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245926">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245930">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;the&nbsp;other&nbsp;connection,&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3245993">//&nbsp;&nbsp;&nbsp;as&nbsp;talking&nbsp;to&nbsp;the&nbsp;protocol&nbsp;stack&nbsp;inside&nbsp;the&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3246050">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3246054">//&nbsp;For&nbsp;stream&nbsp;and&nbsp;datagram&nbsp;listeners,&nbsp;they&nbsp;will&nbsp;only&nbsp;require</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3246116">//&nbsp;named&nbsp;sockets,&nbsp;so&nbsp;we&nbsp;can&nbsp;assume&nbsp;that&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3246177">//&nbsp;from&nbsp;stream&nbsp;or&nbsp;datagram&nbsp;listeners&nbsp;when&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3246241">//&nbsp;raddr&nbsp;is&nbsp;nil.&nbsp;Otherwise&nbsp;we&nbsp;assume&nbsp;it&#39;s&nbsp;just&nbsp;for&nbsp;dialers&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3246304">//&nbsp;the&nbsp;other&nbsp;connection&nbsp;holders.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246339">if</span>&nbsp;<span class="ident" id="3246342">laddr</span>&nbsp;<span class="op" id="3246348">!=</span>&nbsp;<span class="ident" id="3246351">nil</span>&nbsp;<span class="op" id="3246355">&amp;&amp;</span>&nbsp;<span class="ident" id="3246358">raddr</span>&nbsp;<span class="op" id="3246364">==</span>&nbsp;<span class="ident" id="3246367">nil</span>&nbsp;<span class="op" id="3246371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246375">switch</span>&nbsp;<span class="ident" id="3246382">sotype</span>&nbsp;<span class="op" id="3246389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246393">case</span>&nbsp;<span class="ident" id="3246398">syscall</span><span class="op" id="3246405">.</span><span class="ident" id="3246406">SOCK_STREAM</span><span class="op" id="3246417">,</span>&nbsp;<span class="ident" id="3246419">syscall</span><span class="op" id="3246426">.</span><span class="ident" id="3246427">SOCK_SEQPACKET</span><span class="op" id="3246441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246446">if</span>&nbsp;<span class="ident" id="3246449">err</span>&nbsp;<span class="op" id="3246453">:=</span>&nbsp;<span class="ident" id="3246456">fd</span><span class="op" id="3246458">.</span><span class="ident" id="3246459">listenStream</span><span class="op" id="3246471">(</span><span class="ident" id="3246472">laddr</span><span class="op" id="3246477">,</span>&nbsp;<span class="ident" id="3246479">listenerBacklog</span><span class="op" id="3246494">)</span><span class="op" id="3246495">;</span>&nbsp;<span class="ident" id="3246497">err</span>&nbsp;<span class="op" id="3246501">!=</span>&nbsp;<span class="ident" id="3246504">nil</span>&nbsp;<span class="op" id="3246508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246514">fd</span><span class="op" id="3246516">.</span><span class="ident" id="3246517">Close</span><span class="op" id="3246522">(</span><span class="op" id="3246523">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246529">return</span>&nbsp;<span class="ident" id="3246536">nil</span><span class="op" id="3246539">,</span>&nbsp;<span class="ident" id="3246541">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3246548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246553">return</span>&nbsp;<span class="ident" id="3246560">fd</span><span class="op" id="3246562">,</span>&nbsp;<span class="ident" id="3246564">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246570">case</span>&nbsp;<span class="ident" id="3246575">syscall</span><span class="op" id="3246582">.</span><span class="ident" id="3246583">SOCK_DGRAM</span><span class="op" id="3246593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246598">if</span>&nbsp;<span class="ident" id="3246601">err</span>&nbsp;<span class="op" id="3246605">:=</span>&nbsp;<span class="ident" id="3246608">fd</span><span class="op" id="3246610">.</span><span class="ident" id="3246611">listenDatagram</span><span class="op" id="3246625">(</span><span class="ident" id="3246626">laddr</span><span class="op" id="3246631">)</span><span class="op" id="3246632">;</span>&nbsp;<span class="ident" id="3246634">err</span>&nbsp;<span class="op" id="3246638">!=</span>&nbsp;<span class="ident" id="3246641">nil</span>&nbsp;<span class="op" id="3246645">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246651">fd</span><span class="op" id="3246653">.</span><span class="ident" id="3246654">Close</span><span class="op" id="3246659">(</span><span class="op" id="3246660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246666">return</span>&nbsp;<span class="ident" id="3246673">nil</span><span class="op" id="3246676">,</span>&nbsp;<span class="ident" id="3246678">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3246685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246690">return</span>&nbsp;<span class="ident" id="3246697">fd</span><span class="op" id="3246699">,</span>&nbsp;<span class="ident" id="3246701">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3246707">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3246710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246713">if</span>&nbsp;<span class="ident" id="3246716">err</span>&nbsp;<span class="op" id="3246720">:=</span>&nbsp;<span class="ident" id="3246723">fd</span><span class="op" id="3246725">.</span><span class="ident" id="3246726">dial</span><span class="op" id="3246730">(</span><span class="ident" id="3246731">laddr</span><span class="op" id="3246736">,</span>&nbsp;<span class="ident" id="3246738">raddr</span><span class="op" id="3246743">,</span>&nbsp;<span class="ident" id="3246745">deadline</span><span class="op" id="3246753">)</span><span class="op" id="3246754">;</span>&nbsp;<span class="ident" id="3246756">err</span>&nbsp;<span class="op" id="3246760">!=</span>&nbsp;<span class="ident" id="3246763">nil</span>&nbsp;<span class="op" id="3246767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246771">fd</span><span class="op" id="3246773">.</span><span class="ident" id="3246774">Close</span><span class="op" id="3246779">(</span><span class="op" id="3246780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246784">return</span>&nbsp;<span class="ident" id="3246791">nil</span><span class="op" id="3246794">,</span>&nbsp;<span class="ident" id="3246796">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3246801">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246804">return</span>&nbsp;<span class="ident" id="3246811">fd</span><span class="op" id="3246813">,</span>&nbsp;<span class="ident" id="3246815">nil</span><br>
<span class="lineno"></span><span class="op" id="3246819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3246822">func</span>&nbsp;<span class="op" id="3246827">(</span><span class="ident" id="3246828">fd</span>&nbsp;<span class="op" id="3246831">*</span><span class="ident" id="3246832">netFD</span><span class="op" id="3246837">)</span>&nbsp;<span class="ident" id="3246839">addrFunc</span><span class="op" id="3246847">(</span><span class="op" id="3246848">)</span>&nbsp;<span class="keyword" id="3246850">func</span><span class="op" id="3246854">(</span><span class="ident" id="3246855">syscall</span><span class="op" id="3246862">.</span><span class="ident" id="3246863">Sockaddr</span><span class="op" id="3246871">)</span>&nbsp;<span class="ident" id="3246873">Addr</span>&nbsp;<span class="op" id="3246878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246881">switch</span>&nbsp;<span class="ident" id="3246888">fd</span><span class="op" id="3246890">.</span><span class="ident" id="3246891">family</span>&nbsp;<span class="op" id="3246898">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246901">case</span>&nbsp;<span class="ident" id="3246906">syscall</span><span class="op" id="3246913">.</span><span class="ident" id="3246914">AF_INET</span><span class="op" id="3246921">,</span>&nbsp;<span class="ident" id="3246923">syscall</span><span class="op" id="3246930">.</span><span class="ident" id="3246931">AF_INET6</span><span class="op" id="3246939">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246943">switch</span>&nbsp;<span class="ident" id="3246950">fd</span><span class="op" id="3246952">.</span><span class="ident" id="3246953">sotype</span>&nbsp;<span class="op" id="3246960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246964">case</span>&nbsp;<span class="ident" id="3246969">syscall</span><span class="op" id="3246976">.</span><span class="ident" id="3246977">SOCK_STREAM</span><span class="op" id="3246988">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246993">return</span>&nbsp;<span class="ident" id="3247000">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247016">case</span>&nbsp;<span class="ident" id="3247021">syscall</span><span class="op" id="3247028">.</span><span class="ident" id="3247029">SOCK_DGRAM</span><span class="op" id="3247039">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247044">return</span>&nbsp;<span class="ident" id="3247051">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247067">case</span>&nbsp;<span class="ident" id="3247072">syscall</span><span class="op" id="3247079">.</span><span class="ident" id="3247080">SOCK_RAW</span><span class="op" id="3247088">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247093">return</span>&nbsp;<span class="ident" id="3247100">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3247115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247118">case</span>&nbsp;<span class="ident" id="3247123">syscall</span><span class="op" id="3247130">.</span><span class="ident" id="3247131">AF_UNIX</span><span class="op" id="3247138">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247142">switch</span>&nbsp;<span class="ident" id="3247149">fd</span><span class="op" id="3247151">.</span><span class="ident" id="3247152">sotype</span>&nbsp;<span class="op" id="3247159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247163">case</span>&nbsp;<span class="ident" id="3247168">syscall</span><span class="op" id="3247175">.</span><span class="ident" id="3247176">SOCK_STREAM</span><span class="op" id="3247187">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247192">return</span>&nbsp;<span class="ident" id="3247199">sockaddrToUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247216">case</span>&nbsp;<span class="ident" id="3247221">syscall</span><span class="op" id="3247228">.</span><span class="ident" id="3247229">SOCK_DGRAM</span><span class="op" id="3247239">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247244">return</span>&nbsp;<span class="ident" id="3247251">sockaddrToUnixgram</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247272">case</span>&nbsp;<span class="ident" id="3247277">syscall</span><span class="op" id="3247284">.</span><span class="ident" id="3247285">SOCK_SEQPACKET</span><span class="op" id="3247299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247304">return</span>&nbsp;<span class="ident" id="3247311">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3247334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3247337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247340">return</span>&nbsp;<span class="keyword" id="3247347">func</span><span class="op" id="3247351">(</span><span class="ident" id="3247352">syscall</span><span class="op" id="3247359">.</span><span class="ident" id="3247360">Sockaddr</span><span class="op" id="3247368">)</span>&nbsp;<span class="ident" id="3247370">Addr</span>&nbsp;<span class="op" id="3247375">{</span>&nbsp;<span class="keyword" id="3247377">return</span>&nbsp;<span class="ident" id="3247384">nil</span>&nbsp;<span class="op" id="3247388">}</span><br>
<span class="lineno">120</span><span class="op" id="3247390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3247393">func</span>&nbsp;<span class="op" id="3247398">(</span><span class="ident" id="3247399">fd</span>&nbsp;<span class="op" id="3247402">*</span><span class="ident" id="3247403">netFD</span><span class="op" id="3247408">)</span>&nbsp;<span class="ident" id="3247410">dial</span><span class="op" id="3247414">(</span><span class="ident" id="3247415">laddr</span><span class="op" id="3247420">,</span>&nbsp;<span class="ident" id="3247422">raddr</span>&nbsp;<span class="ident" id="3247428">sockaddr</span><span class="op" id="3247436">,</span>&nbsp;<span class="ident" id="3247438">deadline</span>&nbsp;<span class="ident" id="3247447">time</span><span class="op" id="3247451">.</span><span class="ident" id="3247452">Time</span><span class="op" id="3247456">)</span>&nbsp;<span class="builtintype" id="3247458">error</span>&nbsp;<span class="op" id="3247464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247467">var</span>&nbsp;<span class="ident" id="3247471">err</span>&nbsp;<span class="builtintype" id="3247475">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247482">var</span>&nbsp;<span class="ident" id="3247486">lsa</span>&nbsp;<span class="ident" id="3247490">syscall</span><span class="op" id="3247497">.</span><span class="ident" id="3247498">Sockaddr</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247508">if</span>&nbsp;<span class="ident" id="3247511">laddr</span>&nbsp;<span class="op" id="3247517">!=</span>&nbsp;<span class="ident" id="3247520">nil</span>&nbsp;<span class="op" id="3247524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247528">if</span>&nbsp;<span class="ident" id="3247531">lsa</span><span class="op" id="3247534">,</span>&nbsp;<span class="ident" id="3247536">err</span>&nbsp;<span class="op" id="3247540">=</span>&nbsp;<span class="ident" id="3247542">laddr</span><span class="op" id="3247547">.</span><span class="ident" id="3247548">sockaddr</span><span class="op" id="3247556">(</span><span class="ident" id="3247557">fd</span><span class="op" id="3247559">.</span><span class="ident" id="3247560">family</span><span class="op" id="3247566">)</span><span class="op" id="3247567">;</span>&nbsp;<span class="ident" id="3247569">err</span>&nbsp;<span class="op" id="3247573">!=</span>&nbsp;<span class="ident" id="3247576">nil</span>&nbsp;<span class="op" id="3247580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247585">return</span>&nbsp;<span class="ident" id="3247592">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3247598">}</span>&nbsp;<span class="keyword" id="3247600">else</span>&nbsp;<span class="keyword" id="3247605">if</span>&nbsp;<span class="ident" id="3247608">lsa</span>&nbsp;<span class="op" id="3247612">!=</span>&nbsp;<span class="ident" id="3247615">nil</span>&nbsp;<span class="op" id="3247619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247624">if</span>&nbsp;<span class="ident" id="3247627">err</span>&nbsp;<span class="op" id="3247631">:=</span>&nbsp;<span class="ident" id="3247634">syscall</span><span class="op" id="3247641">.</span><span class="ident" id="3247642">Bind</span><span class="op" id="3247646">(</span><span class="ident" id="3247647">fd</span><span class="op" id="3247649">.</span><span class="ident" id="3247650">sysfd</span><span class="op" id="3247655">,</span>&nbsp;<span class="ident" id="3247657">lsa</span><span class="op" id="3247660">)</span><span class="op" id="3247661">;</span>&nbsp;<span class="ident" id="3247663">err</span>&nbsp;<span class="op" id="3247667">!=</span>&nbsp;<span class="ident" id="3247670">nil</span>&nbsp;<span class="op" id="3247674">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247680">return</span>&nbsp;<span class="ident" id="3247687">os</span><span class="op" id="3247689">.</span><span class="ident" id="3247690">NewSyscallError</span><span class="op" id="3247705">(</span><span class="string" id="3247706">&#34;bind&#34;</span><span class="op" id="3247712">,</span>&nbsp;<span class="ident" id="3247714">err</span><span class="op" id="3247717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3247722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3247726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3247729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247732">var</span>&nbsp;<span class="ident" id="3247736">rsa</span>&nbsp;<span class="ident" id="3247740">syscall</span><span class="op" id="3247747">.</span><span class="ident" id="3247748">Sockaddr</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247758">if</span>&nbsp;<span class="ident" id="3247761">raddr</span>&nbsp;<span class="op" id="3247767">!=</span>&nbsp;<span class="ident" id="3247770">nil</span>&nbsp;<span class="op" id="3247774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247778">if</span>&nbsp;<span class="ident" id="3247781">rsa</span><span class="op" id="3247784">,</span>&nbsp;<span class="ident" id="3247786">err</span>&nbsp;<span class="op" id="3247790">=</span>&nbsp;<span class="ident" id="3247792">raddr</span><span class="op" id="3247797">.</span><span class="ident" id="3247798">sockaddr</span><span class="op" id="3247806">(</span><span class="ident" id="3247807">fd</span><span class="op" id="3247809">.</span><span class="ident" id="3247810">family</span><span class="op" id="3247816">)</span><span class="op" id="3247817">;</span>&nbsp;<span class="ident" id="3247819">err</span>&nbsp;<span class="op" id="3247823">!=</span>&nbsp;<span class="ident" id="3247826">nil</span>&nbsp;<span class="op" id="3247830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247835">return</span>&nbsp;<span class="ident" id="3247842">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3247848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247852">if</span>&nbsp;<span class="ident" id="3247855">err</span>&nbsp;<span class="op" id="3247859">:=</span>&nbsp;<span class="ident" id="3247862">fd</span><span class="op" id="3247864">.</span><span class="ident" id="3247865">connect</span><span class="op" id="3247872">(</span><span class="ident" id="3247873">lsa</span><span class="op" id="3247876">,</span>&nbsp;<span class="ident" id="3247878">rsa</span><span class="op" id="3247881">,</span>&nbsp;<span class="ident" id="3247883">deadline</span><span class="op" id="3247891">)</span><span class="op" id="3247892">;</span>&nbsp;<span class="ident" id="3247894">err</span>&nbsp;<span class="op" id="3247898">!=</span>&nbsp;<span class="ident" id="3247901">nil</span>&nbsp;<span class="op" id="3247905">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247910">return</span>&nbsp;<span class="ident" id="3247917">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3247923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247927">fd</span><span class="op" id="3247929">.</span><span class="ident" id="3247930">isConnected</span>&nbsp;<span class="op" id="3247942">=</span>&nbsp;<span class="builtintype" id="3247944">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3247950">}</span>&nbsp;<span class="keyword" id="3247952">else</span>&nbsp;<span class="op" id="3247957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247961">if</span>&nbsp;<span class="ident" id="3247964">err</span>&nbsp;<span class="op" id="3247968">:=</span>&nbsp;<span class="ident" id="3247971">fd</span><span class="op" id="3247973">.</span><span class="ident" id="3247974">init</span><span class="op" id="3247978">(</span><span class="op" id="3247979">)</span><span class="op" id="3247980">;</span>&nbsp;<span class="ident" id="3247982">err</span>&nbsp;<span class="op" id="3247986">!=</span>&nbsp;<span class="ident" id="3247989">nil</span>&nbsp;<span class="op" id="3247993">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247998">return</span>&nbsp;<span class="ident" id="3248005">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3248011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3248014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248017">lsa</span><span class="op" id="3248020">,</span>&nbsp;<span class="ident" id="3248022">_</span>&nbsp;<span class="op" id="3248024">=</span>&nbsp;<span class="ident" id="3248026">syscall</span><span class="op" id="3248033">.</span><span class="ident" id="3248034">Getsockname</span><span class="op" id="3248045">(</span><span class="ident" id="3248046">fd</span><span class="op" id="3248048">.</span><span class="ident" id="3248049">sysfd</span><span class="op" id="3248054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248057">if</span>&nbsp;<span class="ident" id="3248060">rsa</span><span class="op" id="3248063">,</span>&nbsp;<span class="ident" id="3248065">_</span>&nbsp;<span class="op" id="3248067">=</span>&nbsp;<span class="ident" id="3248069">syscall</span><span class="op" id="3248076">.</span><span class="ident" id="3248077">Getpeername</span><span class="op" id="3248088">(</span><span class="ident" id="3248089">fd</span><span class="op" id="3248091">.</span><span class="ident" id="3248092">sysfd</span><span class="op" id="3248097">)</span><span class="op" id="3248098">;</span>&nbsp;<span class="ident" id="3248100">rsa</span>&nbsp;<span class="op" id="3248104">!=</span>&nbsp;<span class="ident" id="3248107">nil</span>&nbsp;<span class="op" id="3248111">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248115">fd</span><span class="op" id="3248117">.</span><span class="ident" id="3248118">setAddr</span><span class="op" id="3248125">(</span><span class="ident" id="3248126">fd</span><span class="op" id="3248128">.</span><span class="ident" id="3248129">addrFunc</span><span class="op" id="3248137">(</span><span class="op" id="3248138">)</span><span class="op" id="3248139">(</span><span class="ident" id="3248140">lsa</span><span class="op" id="3248143">)</span><span class="op" id="3248144">,</span>&nbsp;<span class="ident" id="3248146">fd</span><span class="op" id="3248148">.</span><span class="ident" id="3248149">addrFunc</span><span class="op" id="3248157">(</span><span class="op" id="3248158">)</span><span class="op" id="3248159">(</span><span class="ident" id="3248160">rsa</span><span class="op" id="3248163">)</span><span class="op" id="3248164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3248167">}</span>&nbsp;<span class="keyword" id="3248169">else</span>&nbsp;<span class="op" id="3248174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248178">fd</span><span class="op" id="3248180">.</span><span class="ident" id="3248181">setAddr</span><span class="op" id="3248188">(</span><span class="ident" id="3248189">fd</span><span class="op" id="3248191">.</span><span class="ident" id="3248192">addrFunc</span><span class="op" id="3248200">(</span><span class="op" id="3248201">)</span><span class="op" id="3248202">(</span><span class="ident" id="3248203">lsa</span><span class="op" id="3248206">)</span><span class="op" id="3248207">,</span>&nbsp;<span class="ident" id="3248209">raddr</span><span class="op" id="3248214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3248217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248220">return</span>&nbsp;<span class="ident" id="3248227">nil</span><br>
<span class="lineno">155</span><span class="op" id="3248231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3248234">func</span>&nbsp;<span class="op" id="3248239">(</span><span class="ident" id="3248240">fd</span>&nbsp;<span class="op" id="3248243">*</span><span class="ident" id="3248244">netFD</span><span class="op" id="3248249">)</span>&nbsp;<span class="ident" id="3248251">listenStream</span><span class="op" id="3248263">(</span><span class="ident" id="3248264">laddr</span>&nbsp;<span class="ident" id="3248270">sockaddr</span><span class="op" id="3248278">,</span>&nbsp;<span class="ident" id="3248280">backlog</span>&nbsp;<span class="builtintype" id="3248288">int</span><span class="op" id="3248291">)</span>&nbsp;<span class="builtintype" id="3248293">error</span>&nbsp;<span class="op" id="3248299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248302">if</span>&nbsp;<span class="ident" id="3248305">err</span>&nbsp;<span class="op" id="3248309">:=</span>&nbsp;<span class="ident" id="3248312">setDefaultListenerSockopts</span><span class="op" id="3248338">(</span><span class="ident" id="3248339">fd</span><span class="op" id="3248341">.</span><span class="ident" id="3248342">sysfd</span><span class="op" id="3248347">)</span><span class="op" id="3248348">;</span>&nbsp;<span class="ident" id="3248350">err</span>&nbsp;<span class="op" id="3248354">!=</span>&nbsp;<span class="ident" id="3248357">nil</span>&nbsp;<span class="op" id="3248361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248365">return</span>&nbsp;<span class="ident" id="3248372">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3248377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248380">if</span>&nbsp;<span class="ident" id="3248383">lsa</span><span class="op" id="3248386">,</span>&nbsp;<span class="ident" id="3248388">err</span>&nbsp;<span class="op" id="3248392">:=</span>&nbsp;<span class="ident" id="3248395">laddr</span><span class="op" id="3248400">.</span><span class="ident" id="3248401">sockaddr</span><span class="op" id="3248409">(</span><span class="ident" id="3248410">fd</span><span class="op" id="3248412">.</span><span class="ident" id="3248413">family</span><span class="op" id="3248419">)</span><span class="op" id="3248420">;</span>&nbsp;<span class="ident" id="3248422">err</span>&nbsp;<span class="op" id="3248426">!=</span>&nbsp;<span class="ident" id="3248429">nil</span>&nbsp;<span class="op" id="3248433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248437">return</span>&nbsp;<span class="ident" id="3248444">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3248449">}</span>&nbsp;<span class="keyword" id="3248451">else</span>&nbsp;<span class="keyword" id="3248456">if</span>&nbsp;<span class="ident" id="3248459">lsa</span>&nbsp;<span class="op" id="3248463">!=</span>&nbsp;<span class="ident" id="3248466">nil</span>&nbsp;<span class="op" id="3248470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248474">if</span>&nbsp;<span class="ident" id="3248477">err</span>&nbsp;<span class="op" id="3248481">:=</span>&nbsp;<span class="ident" id="3248484">syscall</span><span class="op" id="3248491">.</span><span class="ident" id="3248492">Bind</span><span class="op" id="3248496">(</span><span class="ident" id="3248497">fd</span><span class="op" id="3248499">.</span><span class="ident" id="3248500">sysfd</span><span class="op" id="3248505">,</span>&nbsp;<span class="ident" id="3248507">lsa</span><span class="op" id="3248510">)</span><span class="op" id="3248511">;</span>&nbsp;<span class="ident" id="3248513">err</span>&nbsp;<span class="op" id="3248517">!=</span>&nbsp;<span class="ident" id="3248520">nil</span>&nbsp;<span class="op" id="3248524">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248529">return</span>&nbsp;<span class="ident" id="3248536">os</span><span class="op" id="3248538">.</span><span class="ident" id="3248539">NewSyscallError</span><span class="op" id="3248554">(</span><span class="string" id="3248555">&#34;bind&#34;</span><span class="op" id="3248561">,</span>&nbsp;<span class="ident" id="3248563">err</span><span class="op" id="3248566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3248570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3248573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248576">if</span>&nbsp;<span class="ident" id="3248579">err</span>&nbsp;<span class="op" id="3248583">:=</span>&nbsp;<span class="ident" id="3248586">syscall</span><span class="op" id="3248593">.</span><span class="ident" id="3248594">Listen</span><span class="op" id="3248600">(</span><span class="ident" id="3248601">fd</span><span class="op" id="3248603">.</span><span class="ident" id="3248604">sysfd</span><span class="op" id="3248609">,</span>&nbsp;<span class="ident" id="3248611">backlog</span><span class="op" id="3248618">)</span><span class="op" id="3248619">;</span>&nbsp;<span class="ident" id="3248621">err</span>&nbsp;<span class="op" id="3248625">!=</span>&nbsp;<span class="ident" id="3248628">nil</span>&nbsp;<span class="op" id="3248632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248636">return</span>&nbsp;<span class="ident" id="3248643">os</span><span class="op" id="3248645">.</span><span class="ident" id="3248646">NewSyscallError</span><span class="op" id="3248661">(</span><span class="string" id="3248662">&#34;listen&#34;</span><span class="op" id="3248670">,</span>&nbsp;<span class="ident" id="3248672">err</span><span class="op" id="3248675">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3248678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248681">if</span>&nbsp;<span class="ident" id="3248684">err</span>&nbsp;<span class="op" id="3248688">:=</span>&nbsp;<span class="ident" id="3248691">fd</span><span class="op" id="3248693">.</span><span class="ident" id="3248694">init</span><span class="op" id="3248698">(</span><span class="op" id="3248699">)</span><span class="op" id="3248700">;</span>&nbsp;<span class="ident" id="3248702">err</span>&nbsp;<span class="op" id="3248706">!=</span>&nbsp;<span class="ident" id="3248709">nil</span>&nbsp;<span class="op" id="3248713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248717">return</span>&nbsp;<span class="ident" id="3248724">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3248729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248732">lsa</span><span class="op" id="3248735">,</span>&nbsp;<span class="ident" id="3248737">_</span>&nbsp;<span class="op" id="3248739">:=</span>&nbsp;<span class="ident" id="3248742">syscall</span><span class="op" id="3248749">.</span><span class="ident" id="3248750">Getsockname</span><span class="op" id="3248761">(</span><span class="ident" id="3248762">fd</span><span class="op" id="3248764">.</span><span class="ident" id="3248765">sysfd</span><span class="op" id="3248770">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248773">fd</span><span class="op" id="3248775">.</span><span class="ident" id="3248776">setAddr</span><span class="op" id="3248783">(</span><span class="ident" id="3248784">fd</span><span class="op" id="3248786">.</span><span class="ident" id="3248787">addrFunc</span><span class="op" id="3248795">(</span><span class="op" id="3248796">)</span><span class="op" id="3248797">(</span><span class="ident" id="3248798">lsa</span><span class="op" id="3248801">)</span><span class="op" id="3248802">,</span>&nbsp;<span class="ident" id="3248804">nil</span><span class="op" id="3248807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248810">return</span>&nbsp;<span class="ident" id="3248817">nil</span><br>
<span class="lineno"></span><span class="op" id="3248821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3248824">func</span>&nbsp;<span class="op" id="3248829">(</span><span class="ident" id="3248830">fd</span>&nbsp;<span class="op" id="3248833">*</span><span class="ident" id="3248834">netFD</span><span class="op" id="3248839">)</span>&nbsp;<span class="ident" id="3248841">listenDatagram</span><span class="op" id="3248855">(</span><span class="ident" id="3248856">laddr</span>&nbsp;<span class="ident" id="3248862">sockaddr</span><span class="op" id="3248870">)</span>&nbsp;<span class="builtintype" id="3248872">error</span>&nbsp;<span class="op" id="3248878">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248881">switch</span>&nbsp;<span class="ident" id="3248888">addr</span>&nbsp;<span class="op" id="3248893">:=</span>&nbsp;<span class="ident" id="3248896">laddr</span><span class="op" id="3248901">.</span><span class="op" id="3248902">(</span><span class="keyword" id="3248903">type</span><span class="op" id="3248907">)</span>&nbsp;<span class="op" id="3248909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248912">case</span>&nbsp;<span class="op" id="3248917">*</span><span class="ident" id="3248918">UDPAddr</span><span class="op" id="3248925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3248929">//&nbsp;We&nbsp;provide&nbsp;a&nbsp;socket&nbsp;that&nbsp;listens&nbsp;to&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3248981">//&nbsp;address&nbsp;with&nbsp;reusable&nbsp;UDP&nbsp;port&nbsp;when&nbsp;the&nbsp;given&nbsp;laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3249038">//&nbsp;is&nbsp;an&nbsp;appropriate&nbsp;UDP&nbsp;multicast&nbsp;address&nbsp;prefix.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3249091">//&nbsp;This&nbsp;makes&nbsp;it&nbsp;possible&nbsp;for&nbsp;a&nbsp;single&nbsp;UDP&nbsp;listener&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3249148">//&nbsp;join&nbsp;multiple&nbsp;different&nbsp;group&nbsp;addresses,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3249198">//&nbsp;multiple&nbsp;UDP&nbsp;listeners&nbsp;that&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;UDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3249254">//&nbsp;port&nbsp;to&nbsp;join&nbsp;the&nbsp;same&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249296">if</span>&nbsp;<span class="ident" id="3249299">addr</span><span class="op" id="3249303">.</span><span class="ident" id="3249304">IP</span>&nbsp;<span class="op" id="3249307">!=</span>&nbsp;<span class="ident" id="3249310">nil</span>&nbsp;<span class="op" id="3249314">&amp;&amp;</span>&nbsp;<span class="ident" id="3249317">addr</span><span class="op" id="3249321">.</span><span class="ident" id="3249322">IP</span><span class="op" id="3249324">.</span><span class="ident" id="3249325">IsMulticast</span><span class="op" id="3249336">(</span><span class="op" id="3249337">)</span>&nbsp;<span class="op" id="3249339">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249344">if</span>&nbsp;<span class="ident" id="3249347">err</span>&nbsp;<span class="op" id="3249351">:=</span>&nbsp;<span class="ident" id="3249354">setDefaultMulticastSockopts</span><span class="op" id="3249381">(</span><span class="ident" id="3249382">fd</span><span class="op" id="3249384">.</span><span class="ident" id="3249385">sysfd</span><span class="op" id="3249390">)</span><span class="op" id="3249391">;</span>&nbsp;<span class="ident" id="3249393">err</span>&nbsp;<span class="op" id="3249397">!=</span>&nbsp;<span class="ident" id="3249400">nil</span>&nbsp;<span class="op" id="3249404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249410">return</span>&nbsp;<span class="ident" id="3249417">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3249429">addr</span>&nbsp;<span class="op" id="3249434">:=</span>&nbsp;<span class="op" id="3249437">*</span><span class="ident" id="3249438">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249446">switch</span>&nbsp;<span class="ident" id="3249453">fd</span><span class="op" id="3249455">.</span><span class="ident" id="3249456">family</span>&nbsp;<span class="op" id="3249463">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249468">case</span>&nbsp;<span class="ident" id="3249473">syscall</span><span class="op" id="3249480">.</span><span class="ident" id="3249481">AF_INET</span><span class="op" id="3249488">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3249494">addr</span><span class="op" id="3249498">.</span><span class="ident" id="3249499">IP</span>&nbsp;<span class="op" id="3249502">=</span>&nbsp;<span class="ident" id="3249504">IPv4zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249516">case</span>&nbsp;<span class="ident" id="3249521">syscall</span><span class="op" id="3249528">.</span><span class="ident" id="3249529">AF_INET6</span><span class="op" id="3249537">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3249543">addr</span><span class="op" id="3249547">.</span><span class="ident" id="3249548">IP</span>&nbsp;<span class="op" id="3249551">=</span>&nbsp;<span class="ident" id="3249553">IPv6unspecified</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249572">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3249577">laddr</span>&nbsp;<span class="op" id="3249583">=</span>&nbsp;<span class="op" id="3249585">&amp;</span><span class="ident" id="3249586">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249599">if</span>&nbsp;<span class="ident" id="3249602">lsa</span><span class="op" id="3249605">,</span>&nbsp;<span class="ident" id="3249607">err</span>&nbsp;<span class="op" id="3249611">:=</span>&nbsp;<span class="ident" id="3249614">laddr</span><span class="op" id="3249619">.</span><span class="ident" id="3249620">sockaddr</span><span class="op" id="3249628">(</span><span class="ident" id="3249629">fd</span><span class="op" id="3249631">.</span><span class="ident" id="3249632">family</span><span class="op" id="3249638">)</span><span class="op" id="3249639">;</span>&nbsp;<span class="ident" id="3249641">err</span>&nbsp;<span class="op" id="3249645">!=</span>&nbsp;<span class="ident" id="3249648">nil</span>&nbsp;<span class="op" id="3249652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249656">return</span>&nbsp;<span class="ident" id="3249663">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249668">}</span>&nbsp;<span class="keyword" id="3249670">else</span>&nbsp;<span class="keyword" id="3249675">if</span>&nbsp;<span class="ident" id="3249678">lsa</span>&nbsp;<span class="op" id="3249682">!=</span>&nbsp;<span class="ident" id="3249685">nil</span>&nbsp;<span class="op" id="3249689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249693">if</span>&nbsp;<span class="ident" id="3249696">err</span>&nbsp;<span class="op" id="3249700">:=</span>&nbsp;<span class="ident" id="3249703">syscall</span><span class="op" id="3249710">.</span><span class="ident" id="3249711">Bind</span><span class="op" id="3249715">(</span><span class="ident" id="3249716">fd</span><span class="op" id="3249718">.</span><span class="ident" id="3249719">sysfd</span><span class="op" id="3249724">,</span>&nbsp;<span class="ident" id="3249726">lsa</span><span class="op" id="3249729">)</span><span class="op" id="3249730">;</span>&nbsp;<span class="ident" id="3249732">err</span>&nbsp;<span class="op" id="3249736">!=</span>&nbsp;<span class="ident" id="3249739">nil</span>&nbsp;<span class="op" id="3249743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249748">return</span>&nbsp;<span class="ident" id="3249755">os</span><span class="op" id="3249757">.</span><span class="ident" id="3249758">NewSyscallError</span><span class="op" id="3249773">(</span><span class="string" id="3249774">&#34;bind&#34;</span><span class="op" id="3249780">,</span>&nbsp;<span class="ident" id="3249782">err</span><span class="op" id="3249785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249792">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249795">if</span>&nbsp;<span class="ident" id="3249798">err</span>&nbsp;<span class="op" id="3249802">:=</span>&nbsp;<span class="ident" id="3249805">fd</span><span class="op" id="3249807">.</span><span class="ident" id="3249808">init</span><span class="op" id="3249812">(</span><span class="op" id="3249813">)</span><span class="op" id="3249814">;</span>&nbsp;<span class="ident" id="3249816">err</span>&nbsp;<span class="op" id="3249820">!=</span>&nbsp;<span class="ident" id="3249823">nil</span>&nbsp;<span class="op" id="3249827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249831">return</span>&nbsp;<span class="ident" id="3249838">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3249846">lsa</span><span class="op" id="3249849">,</span>&nbsp;<span class="ident" id="3249851">_</span>&nbsp;<span class="op" id="3249853">:=</span>&nbsp;<span class="ident" id="3249856">syscall</span><span class="op" id="3249863">.</span><span class="ident" id="3249864">Getsockname</span><span class="op" id="3249875">(</span><span class="ident" id="3249876">fd</span><span class="op" id="3249878">.</span><span class="ident" id="3249879">sysfd</span><span class="op" id="3249884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3249887">fd</span><span class="op" id="3249889">.</span><span class="ident" id="3249890">setAddr</span><span class="op" id="3249897">(</span><span class="ident" id="3249898">fd</span><span class="op" id="3249900">.</span><span class="ident" id="3249901">addrFunc</span><span class="op" id="3249909">(</span><span class="op" id="3249910">)</span><span class="op" id="3249911">(</span><span class="ident" id="3249912">lsa</span><span class="op" id="3249915">)</span><span class="op" id="3249916">,</span>&nbsp;<span class="ident" id="3249918">nil</span><span class="op" id="3249921">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249924">return</span>&nbsp;<span class="ident" id="3249931">nil</span><br>
<span class="lineno"></span><span class="op" id="3249935">}</span>
</div>
</body>
</html>
