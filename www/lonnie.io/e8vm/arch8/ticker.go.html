<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5315886">package</span>&nbsp;<span class="ident" id="5315894">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5315901">import</span>&nbsp;<span class="op" id="5315908">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5315911">&#34;math/rand&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5315924">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5315931">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5315934">//&nbsp;Ticker&nbsp;is&nbsp;a&nbsp;device&nbsp;that&nbsp;generates&nbsp;time&nbsp;interrupts.</span><br>
<span class="lineno"></span><span class="keyword" id="5315988">type</span>&nbsp;<span class="ident" id="5315993">ticker</span>&nbsp;<span class="keyword" id="5316000">struct</span>&nbsp;<span class="op" id="5316007">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316010">intBus</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5316019"><a href="/lonnie.io/e8vm/arch8/int_bus.go.html#5297167">intBus</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316027">nextTick</span>&nbsp;<span class="builtintype" id="5316036">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316044">Interval</span>&nbsp;<span class="builtintype" id="5316053">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316060">Noise</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5316069">int32</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316076">Rand</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5316085">*</span><span class="ident" id="5316086"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5315911">rand</a></span><span class="op" id="5316090">.</span><span class="ident" id="5316091">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316097">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5316106">byte</span><br>
<span class="lineno"></span><span class="op" id="5316111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5316114">//&nbsp;NewTicker&nbsp;creates&nbsp;a&nbsp;new&nbsp;time&nbsp;interrupt&nbsp;generator.</span><br>
<span class="lineno">20</span><span class="keyword" id="5316167">func</span>&nbsp;<span class="ident" id="5316172">newTicker</span><span class="op" id="5316181">(</span><span class="ident" id="5316182">bus</span>&nbsp;<span class="ident" id="5316186"><a href="/lonnie.io/e8vm/arch8/int_bus.go.html#5297167">intBus</a></span><span class="op" id="5316192">)</span>&nbsp;<span class="op" id="5316194">*</span><span class="ident" id="5316195"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5315993">ticker</a></span>&nbsp;<span class="op" id="5316202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316205">ret</span>&nbsp;<span class="op" id="5316209">:=</span>&nbsp;<span class="builtinfunc" id="5316212">new</span><span class="op" id="5316215">(</span><span class="ident" id="5316216"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5315993">ticker</a></span><span class="op" id="5316222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316225"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316205">ret</a></span><span class="op" id="5316228">.</span><span class="ident" id="5316229">intBus</span>&nbsp;<span class="op" id="5316236">=</span>&nbsp;<span class="ident" id="5316238"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316182">bus</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316244"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316205">ret</a></span><span class="op" id="5316247">.</span><span class="ident" id="5316248">Interval</span>&nbsp;<span class="op" id="5316257">=</span>&nbsp;<span class="num" id="5316259">1000</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316265"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316205">ret</a></span><span class="op" id="5316268">.</span><span class="ident" id="5316269">Noise</span>&nbsp;<span class="op" id="5316275">=</span>&nbsp;<span class="num" id="5316277">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316281"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316205">ret</a></span><span class="op" id="5316284">.</span><span class="ident" id="5316285">Rand</span>&nbsp;<span class="op" id="5316290">=</span>&nbsp;<span class="ident" id="5316292"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5315911">rand</a></span><span class="op" id="5316296">.</span><span class="ident" id="5316297">New</span><span class="op" id="5316300">(</span><span class="ident" id="5316301"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5315911">rand</a></span><span class="op" id="5316305">.</span><span class="ident" id="5316306">NewSource</span><span class="op" id="5316315">(</span><span class="ident" id="5316316"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5315924">time</a></span><span class="op" id="5316320">.</span><span class="ident" id="5316321">Now</span><span class="op" id="5316324">(</span><span class="op" id="5316325">)</span><span class="op" id="5316326">.</span><span class="ident" id="5316327">UnixNano</span><span class="op" id="5316335">(</span><span class="op" id="5316336">)</span><span class="op" id="5316337">)</span><span class="op" id="5316338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316341"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316205">ret</a></span><span class="op" id="5316344">.</span><span class="ident" id="5316345">Code</span>&nbsp;<span class="op" id="5316350">=</span>&nbsp;<span class="num" id="5316352">2</span>&nbsp;<span class="comment" id="5316354">//&nbsp;time&nbsp;interrupt&nbsp;code</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316379"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316205">ret</a></span><span class="op" id="5316382">.</span><span class="ident" id="5316383">reset</span><span class="op" id="5316388">(</span><span class="op" id="5316389">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316393">return</span>&nbsp;<span class="ident" id="5316400"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316205">ret</a></span><br>
<span class="lineno"></span><span class="op" id="5316404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5316407">func</span>&nbsp;<span class="op" id="5316412">(</span><span class="ident" id="5316413">t</span>&nbsp;<span class="op" id="5316415">*</span><span class="ident" id="5316416"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5315993">ticker</a></span><span class="op" id="5316422">)</span>&nbsp;<span class="ident" id="5316424">reset</span><span class="op" id="5316429">(</span><span class="op" id="5316430">)</span>&nbsp;<span class="op" id="5316432">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316435">if</span>&nbsp;<span class="ident" id="5316438"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316413">t</a></span><span class="op" id="5316439">.</span><span class="ident" id="5316440">Noise</span>&nbsp;<span class="op" id="5316446">&lt;</span>&nbsp;<span class="num" id="5316448">0</span>&nbsp;<span class="op" id="5316450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5316454">panic</span><span class="op" id="5316459">(</span><span class="string" id="5316460">&#34;negative&nbsp;ticker&nbsp;noise&#34;</span><span class="op" id="5316483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5316486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316489">if</span>&nbsp;<span class="ident" id="5316492"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316413">t</a></span><span class="op" id="5316493">.</span><span class="ident" id="5316494">Interval</span>&nbsp;<span class="op" id="5316503">&lt;</span>&nbsp;<span class="num" id="5316505">0</span>&nbsp;<span class="op" id="5316507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5316511">panic</span><span class="op" id="5316516">(</span><span class="string" id="5316517">&#34;negative&nbsp;ticker&nbsp;interval&#34;</span><span class="op" id="5316543">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5316546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316550">noise</span>&nbsp;<span class="op" id="5316556">:=</span>&nbsp;<span class="builtintype" id="5316559">int32</span><span class="op" id="5316564">(</span><span class="num" id="5316565">0</span><span class="op" id="5316566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316569">if</span>&nbsp;<span class="ident" id="5316572"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316413">t</a></span><span class="op" id="5316573">.</span><span class="ident" id="5316574">Noise</span>&nbsp;<span class="op" id="5316580">&gt;</span>&nbsp;<span class="num" id="5316582">0</span>&nbsp;<span class="op" id="5316584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316588"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316550">noise</a></span>&nbsp;<span class="op" id="5316594">=</span>&nbsp;<span class="ident" id="5316596"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316413">t</a></span><span class="op" id="5316597">.</span><span class="ident" id="5316598">Rand</span><span class="op" id="5316602">.</span><span class="ident" id="5316603">Int31n</span><span class="op" id="5316609">(</span><span class="ident" id="5316610"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316413">t</a></span><span class="op" id="5316611">.</span><span class="ident" id="5316612">Noise</span><span class="op" id="5316617">)</span>&nbsp;<span class="op" id="5316619">-</span>&nbsp;<span class="ident" id="5316621"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316413">t</a></span><span class="op" id="5316622">.</span><span class="ident" id="5316623">Noise</span><span class="op" id="5316628">/</span><span class="num" id="5316629">2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5316632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316636">next</span>&nbsp;<span class="op" id="5316641">:=</span>&nbsp;<span class="ident" id="5316644"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316413">t</a></span><span class="op" id="5316645">.</span><span class="ident" id="5316646">Interval</span>&nbsp;<span class="op" id="5316655">+</span>&nbsp;<span class="ident" id="5316657"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316550">noise</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316664">if</span>&nbsp;<span class="ident" id="5316667"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316636">next</a></span>&nbsp;<span class="op" id="5316672">&lt;</span>&nbsp;<span class="num" id="5316674">0</span>&nbsp;<span class="op" id="5316676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316680"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316636">next</a></span>&nbsp;<span class="op" id="5316685">=</span>&nbsp;<span class="num" id="5316687">0</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5316690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316694"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316413">t</a></span><span class="op" id="5316695">.</span><span class="ident" id="5316696">nextTick</span>&nbsp;<span class="op" id="5316705">=</span>&nbsp;<span class="ident" id="5316707"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316636">next</a></span><br>
<span class="lineno"></span><span class="op" id="5316712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="5316715">//&nbsp;Tick&nbsp;decreases&nbsp;the&nbsp;ticking&nbsp;counter.&nbsp;If&nbsp;the&nbsp;counter&nbsp;reaches&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="5316780">//&nbsp;it&nbsp;will&nbsp;issue&nbsp;interrupts&nbsp;to&nbsp;all&nbsp;cores&nbsp;and&nbsp;reset&nbsp;the&nbsp;counter.</span><br>
<span class="lineno"></span><span class="keyword" id="5316844">func</span>&nbsp;<span class="op" id="5316849">(</span><span class="ident" id="5316850">t</span>&nbsp;<span class="op" id="5316852">*</span><span class="ident" id="5316853"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5315993">ticker</a></span><span class="op" id="5316859">)</span>&nbsp;<span class="ident" id="5316861">Tick</span><span class="op" id="5316865">(</span><span class="op" id="5316866">)</span>&nbsp;<span class="op" id="5316868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316871">if</span>&nbsp;<span class="ident" id="5316874"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316850">t</a></span><span class="op" id="5316875">.</span><span class="ident" id="5316876">nextTick</span>&nbsp;<span class="op" id="5316885">&lt;</span>&nbsp;<span class="num" id="5316887">0</span>&nbsp;<span class="op" id="5316889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5316893">panic</span><span class="op" id="5316898">(</span><span class="string" id="5316899">&#34;bug&#34;</span><span class="op" id="5316904">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5316907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5316911">if</span>&nbsp;<span class="ident" id="5316914"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316850">t</a></span><span class="op" id="5316915">.</span><span class="ident" id="5316916">nextTick</span>&nbsp;<span class="op" id="5316925">==</span>&nbsp;<span class="num" id="5316928">0</span>&nbsp;<span class="op" id="5316930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316934"><a href="/lonnie.io/e8vm/arch8/int_bus.go.html#5297303">intAllCores</a></span><span class="op" id="5316945">(</span><span class="ident" id="5316946"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316850">t</a></span><span class="op" id="5316947">.</span><span class="ident" id="5316948">intBus</span><span class="op" id="5316954">,</span>&nbsp;<span class="ident" id="5316956"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316850">t</a></span><span class="op" id="5316957">.</span><span class="ident" id="5316958">Code</span><span class="op" id="5316962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316966"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316850">t</a></span><span class="op" id="5316967">.</span><span class="ident" id="5316968">reset</span><span class="op" id="5316973">(</span><span class="op" id="5316974">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5316977">}</span>&nbsp;<span class="keyword" id="5316979">else</span>&nbsp;<span class="op" id="5316984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5316988"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5316850">t</a></span><span class="op" id="5316989">.</span><span class="ident" id="5316990">nextTick</span><span class="op" id="5316998">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5317002">}</span><br>
<span class="lineno"></span><span class="op" id="5317004">}</span>
</div>
</body>
</html>
