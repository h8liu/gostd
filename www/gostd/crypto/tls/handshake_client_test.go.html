<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html" class="current">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6494341">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6494396">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6494450">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6494501">package</span>&nbsp;<span class="ident" id="6494509">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6494514">import</span>&nbsp;<span class="op" id="6494521">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6494524">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6494533">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6494549">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6494563">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6494578">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6494594">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6494601">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6494607">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6494614">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6494620">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6494631">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6494648">&#34;strconv&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6494659">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6494670">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6494677">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6494680">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno">25</span><span class="comment" id="6494755">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6494771">//&nbsp;blockingSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;blocks&nbsp;a&nbsp;Read&nbsp;call&nbsp;until&nbsp;it&#39;s&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="6494848">type</span>&nbsp;<span class="ident" id="6494853">blockingSource</span>&nbsp;<span class="keyword" id="6494868">chan</span>&nbsp;<span class="builtintype" id="6494873">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6494879">func</span>&nbsp;<span class="op" id="6494884">(</span><span class="ident" id="6494885">b</span>&nbsp;<span class="ident" id="6494887">blockingSource</span><span class="op" id="6494901">)</span>&nbsp;<span class="ident" id="6494903">Read</span><span class="op" id="6494907">(</span><span class="op" id="6494908">[</span><span class="op" id="6494909">]</span><span class="builtintype" id="6494910">byte</span><span class="op" id="6494914">)</span>&nbsp;<span class="op" id="6494916">(</span><span class="ident" id="6494917">n</span>&nbsp;<span class="builtintype" id="6494919">int</span><span class="op" id="6494922">,</span>&nbsp;<span class="ident" id="6494924">err</span>&nbsp;<span class="builtintype" id="6494928">error</span><span class="op" id="6494933">)</span>&nbsp;<span class="op" id="6494935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6494938">&lt;-</span><span class="ident" id="6494940">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6494943">return</span>&nbsp;<span class="num" id="6494950">0</span><span class="op" id="6494951">,</span>&nbsp;<span class="ident" id="6494953">io</span><span class="op" id="6494955">.</span><span class="ident" id="6494956">EOF</span><br>
<span class="lineno"></span><span class="op" id="6494960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6494963">//&nbsp;clientTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;client&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="6495043">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="6495062">type</span>&nbsp;<span class="ident" id="6495067">clientTest</span>&nbsp;<span class="keyword" id="6495078">struct</span>&nbsp;<span class="op" id="6495085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6495088">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6495161">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6495202">name</span>&nbsp;<span class="builtintype" id="6495207">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6495215">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6495281">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6495326">command</span>&nbsp;<span class="op" id="6495334">[</span><span class="op" id="6495335">]</span><span class="builtintype" id="6495336">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6495344">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6495415">config</span>&nbsp;<span class="op" id="6495422">*</span><span class="ident" id="6495423">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6495431">//&nbsp;cert,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;DER-encoded&nbsp;certificate&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6495498">//&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6495520">cert</span>&nbsp;<span class="op" id="6495525">[</span><span class="op" id="6495526">]</span><span class="builtintype" id="6495527">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6495533">//&nbsp;key,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;either&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6495591">//&nbsp;*ecdsa.PrivateKey&nbsp;which&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6495664">key</span>&nbsp;<span class="keyword" id="6495668">interface</span><span class="op" id="6495677">{</span><span class="op" id="6495678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6495681">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6495750">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;a&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6495820">//&nbsp;error&nbsp;if&nbsp;the&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6495870">validate</span>&nbsp;<span class="keyword" id="6495879">func</span><span class="op" id="6495883">(</span><span class="ident" id="6495884">ConnectionState</span><span class="op" id="6495899">)</span>&nbsp;<span class="builtintype" id="6495901">error</span><br>
<span class="lineno"></span><span class="op" id="6495907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6495910">var</span>&nbsp;<span class="ident" id="6495914">defaultServerCommand</span>&nbsp;<span class="op" id="6495935">=</span>&nbsp;<span class="op" id="6495937">[</span><span class="op" id="6495938">]</span><span class="builtintype" id="6495939">string</span><span class="op" id="6495945">{</span><span class="string" id="6495946">&#34;openssl&#34;</span><span class="op" id="6495955">,</span>&nbsp;<span class="string" id="6495957">&#34;s_server&#34;</span><span class="op" id="6495967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6495970">//&nbsp;connFromCommand&nbsp;starts&nbsp;the&nbsp;reference&nbsp;server&nbsp;process,&nbsp;connects&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6496045">//&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;for&nbsp;the&nbsp;connection.&nbsp;The&nbsp;stdin&nbsp;return&nbsp;value&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6496120">//&nbsp;blockingSource&nbsp;for&nbsp;the&nbsp;stdin&nbsp;of&nbsp;the&nbsp;child&nbsp;process.&nbsp;It&nbsp;must&nbsp;be&nbsp;closed&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="6496199">//&nbsp;Waiting&nbsp;for&nbsp;child.</span><br>
<span class="lineno"></span><span class="keyword" id="6496221">func</span>&nbsp;<span class="op" id="6496226">(</span><span class="ident" id="6496227">test</span>&nbsp;<span class="op" id="6496232">*</span><span class="ident" id="6496233">clientTest</span><span class="op" id="6496243">)</span>&nbsp;<span class="ident" id="6496245">connFromCommand</span><span class="op" id="6496260">(</span><span class="op" id="6496261">)</span>&nbsp;<span class="op" id="6496263">(</span><span class="ident" id="6496264">conn</span>&nbsp;<span class="op" id="6496269">*</span><span class="ident" id="6496270">recordingConn</span><span class="op" id="6496283">,</span>&nbsp;<span class="ident" id="6496285">child</span>&nbsp;<span class="op" id="6496291">*</span><span class="ident" id="6496292">exec</span><span class="op" id="6496296">.</span><span class="ident" id="6496297">Cmd</span><span class="op" id="6496300">,</span>&nbsp;<span class="ident" id="6496302">stdin</span>&nbsp;<span class="ident" id="6496308">blockingSource</span><span class="op" id="6496322">,</span>&nbsp;<span class="ident" id="6496324">err</span>&nbsp;<span class="builtintype" id="6496328">error</span><span class="op" id="6496333">)</span>&nbsp;<span class="op" id="6496335">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496338">cert</span>&nbsp;<span class="op" id="6496343">:=</span>&nbsp;<span class="ident" id="6496346">testRSACertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496366">if</span>&nbsp;<span class="builtinfunc" id="6496369">len</span><span class="op" id="6496372">(</span><span class="ident" id="6496373">test</span><span class="op" id="6496377">.</span><span class="ident" id="6496378">cert</span><span class="op" id="6496382">)</span>&nbsp;<span class="op" id="6496384">&gt;</span>&nbsp;<span class="num" id="6496386">0</span>&nbsp;<span class="op" id="6496388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496392">cert</span>&nbsp;<span class="op" id="6496397">=</span>&nbsp;<span class="ident" id="6496399">test</span><span class="op" id="6496403">.</span><span class="ident" id="6496404">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6496410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496413">certPath</span>&nbsp;<span class="op" id="6496422">:=</span>&nbsp;<span class="ident" id="6496425">tempFile</span><span class="op" id="6496433">(</span><span class="builtintype" id="6496434">string</span><span class="op" id="6496440">(</span><span class="ident" id="6496441">cert</span><span class="op" id="6496445">)</span><span class="op" id="6496446">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496449">defer</span>&nbsp;<span class="ident" id="6496455">os</span><span class="op" id="6496457">.</span><span class="ident" id="6496458">Remove</span><span class="op" id="6496464">(</span><span class="ident" id="6496465">certPath</span><span class="op" id="6496473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496477">var</span>&nbsp;<span class="ident" id="6496481">key</span>&nbsp;<span class="keyword" id="6496485">interface</span><span class="op" id="6496494">{</span><span class="op" id="6496495">}</span>&nbsp;<span class="op" id="6496497">=</span>&nbsp;<span class="ident" id="6496499">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496518">if</span>&nbsp;<span class="ident" id="6496521">test</span><span class="op" id="6496525">.</span><span class="ident" id="6496526">key</span>&nbsp;<span class="op" id="6496530">!=</span>&nbsp;<span class="ident" id="6496533">nil</span>&nbsp;<span class="op" id="6496537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496541">key</span>&nbsp;<span class="op" id="6496545">=</span>&nbsp;<span class="ident" id="6496547">test</span><span class="op" id="6496551">.</span><span class="ident" id="6496552">key</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6496557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496560">var</span>&nbsp;<span class="ident" id="6496564">pemType</span>&nbsp;<span class="builtintype" id="6496572">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496580">var</span>&nbsp;<span class="ident" id="6496584">derBytes</span>&nbsp;<span class="op" id="6496593">[</span><span class="op" id="6496594">]</span><span class="builtintype" id="6496595">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496601">switch</span>&nbsp;<span class="ident" id="6496608">key</span>&nbsp;<span class="op" id="6496612">:=</span>&nbsp;<span class="ident" id="6496615">key</span><span class="op" id="6496618">.</span><span class="op" id="6496619">(</span><span class="keyword" id="6496620">type</span><span class="op" id="6496624">)</span>&nbsp;<span class="op" id="6496626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496629">case</span>&nbsp;<span class="op" id="6496634">*</span><span class="ident" id="6496635">rsa</span><span class="op" id="6496638">.</span><span class="ident" id="6496639">PrivateKey</span><span class="op" id="6496649">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496653">pemType</span>&nbsp;<span class="op" id="6496661">=</span>&nbsp;<span class="string" id="6496663">&#34;RSA&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496671">derBytes</span>&nbsp;<span class="op" id="6496680">=</span>&nbsp;<span class="ident" id="6496682">x509</span><span class="op" id="6496686">.</span><span class="ident" id="6496687">MarshalPKCS1PrivateKey</span><span class="op" id="6496709">(</span><span class="ident" id="6496710">key</span><span class="op" id="6496713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496716">case</span>&nbsp;<span class="op" id="6496721">*</span><span class="ident" id="6496722">ecdsa</span><span class="op" id="6496727">.</span><span class="ident" id="6496728">PrivateKey</span><span class="op" id="6496738">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496742">pemType</span>&nbsp;<span class="op" id="6496750">=</span>&nbsp;<span class="string" id="6496752">&#34;EC&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496759">var</span>&nbsp;<span class="ident" id="6496763">err</span>&nbsp;<span class="builtintype" id="6496767">error</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496775">derBytes</span><span class="op" id="6496783">,</span>&nbsp;<span class="ident" id="6496785">err</span>&nbsp;<span class="op" id="6496789">=</span>&nbsp;<span class="ident" id="6496791">x509</span><span class="op" id="6496795">.</span><span class="ident" id="6496796">MarshalECPrivateKey</span><span class="op" id="6496815">(</span><span class="ident" id="6496816">key</span><span class="op" id="6496819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496823">if</span>&nbsp;<span class="ident" id="6496826">err</span>&nbsp;<span class="op" id="6496830">!=</span>&nbsp;<span class="ident" id="6496833">nil</span>&nbsp;<span class="op" id="6496837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6496842">panic</span><span class="op" id="6496847">(</span><span class="ident" id="6496848">err</span><span class="op" id="6496851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6496855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496858">default</span><span class="op" id="6496865">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6496869">panic</span><span class="op" id="6496874">(</span><span class="string" id="6496875">&#34;unknown&nbsp;key&nbsp;type&#34;</span><span class="op" id="6496893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6496896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6496900">var</span>&nbsp;<span class="ident" id="6496904">pemOut</span>&nbsp;<span class="ident" id="6496911">bytes</span><span class="op" id="6496916">.</span><span class="ident" id="6496917">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6496925">pem</span><span class="op" id="6496928">.</span><span class="ident" id="6496929">Encode</span><span class="op" id="6496935">(</span><span class="op" id="6496936">&amp;</span><span class="ident" id="6496937">pemOut</span><span class="op" id="6496943">,</span>&nbsp;<span class="op" id="6496945">&amp;</span><span class="ident" id="6496946">pem</span><span class="op" id="6496949">.</span><span class="ident" id="6496950">Block</span><span class="op" id="6496955">{</span><span class="ident" id="6496956">Type</span><span class="op" id="6496960">:</span>&nbsp;<span class="ident" id="6496962">pemType</span>&nbsp;<span class="op" id="6496970">+</span>&nbsp;<span class="string" id="6496972">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="6496986">,</span>&nbsp;<span class="ident" id="6496988">Bytes</span><span class="op" id="6496993">:</span>&nbsp;<span class="ident" id="6496995">derBytes</span><span class="op" id="6497003">}</span><span class="op" id="6497004">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497008">keyPath</span>&nbsp;<span class="op" id="6497016">:=</span>&nbsp;<span class="ident" id="6497019">tempFile</span><span class="op" id="6497027">(</span><span class="builtintype" id="6497028">string</span><span class="op" id="6497034">(</span><span class="ident" id="6497035">pemOut</span><span class="op" id="6497041">.</span><span class="ident" id="6497042">Bytes</span><span class="op" id="6497047">(</span><span class="op" id="6497048">)</span><span class="op" id="6497049">)</span><span class="op" id="6497050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6497053">defer</span>&nbsp;<span class="ident" id="6497059">os</span><span class="op" id="6497061">.</span><span class="ident" id="6497062">Remove</span><span class="op" id="6497068">(</span><span class="ident" id="6497069">keyPath</span><span class="op" id="6497076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6497080">var</span>&nbsp;<span class="ident" id="6497084">command</span>&nbsp;<span class="op" id="6497092">[</span><span class="op" id="6497093">]</span><span class="builtintype" id="6497094">string</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6497102">if</span>&nbsp;<span class="builtinfunc" id="6497105">len</span><span class="op" id="6497108">(</span><span class="ident" id="6497109">test</span><span class="op" id="6497113">.</span><span class="ident" id="6497114">command</span><span class="op" id="6497121">)</span>&nbsp;<span class="op" id="6497123">&gt;</span>&nbsp;<span class="num" id="6497125">0</span>&nbsp;<span class="op" id="6497127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497131">command</span>&nbsp;<span class="op" id="6497139">=</span>&nbsp;<span class="builtinfunc" id="6497141">append</span><span class="op" id="6497147">(</span><span class="ident" id="6497148">command</span><span class="op" id="6497155">,</span>&nbsp;<span class="ident" id="6497157">test</span><span class="op" id="6497161">.</span><span class="ident" id="6497162">command</span><span class="op" id="6497169">...</span><span class="op" id="6497172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6497175">}</span>&nbsp;<span class="keyword" id="6497177">else</span>&nbsp;<span class="op" id="6497182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497186">command</span>&nbsp;<span class="op" id="6497194">=</span>&nbsp;<span class="builtinfunc" id="6497196">append</span><span class="op" id="6497202">(</span><span class="ident" id="6497203">command</span><span class="op" id="6497210">,</span>&nbsp;<span class="ident" id="6497212">defaultServerCommand</span><span class="op" id="6497232">...</span><span class="op" id="6497235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6497238">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497241">command</span>&nbsp;<span class="op" id="6497249">=</span>&nbsp;<span class="builtinfunc" id="6497251">append</span><span class="op" id="6497257">(</span><span class="ident" id="6497258">command</span><span class="op" id="6497265">,</span>&nbsp;<span class="string" id="6497267">&#34;-cert&#34;</span><span class="op" id="6497274">,</span>&nbsp;<span class="ident" id="6497276">certPath</span><span class="op" id="6497284">,</span>&nbsp;<span class="string" id="6497286">&#34;-certform&#34;</span><span class="op" id="6497297">,</span>&nbsp;<span class="string" id="6497299">&#34;DER&#34;</span><span class="op" id="6497304">,</span>&nbsp;<span class="string" id="6497306">&#34;-key&#34;</span><span class="op" id="6497312">,</span>&nbsp;<span class="ident" id="6497314">keyPath</span><span class="op" id="6497321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6497324">//&nbsp;serverPort&nbsp;contains&nbsp;the&nbsp;port&nbsp;that&nbsp;OpenSSL&nbsp;will&nbsp;listen&nbsp;on.&nbsp;OpenSSL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6497394">//&nbsp;can&#39;t&nbsp;take&nbsp;&#34;0&#34;&nbsp;as&nbsp;an&nbsp;argument&nbsp;here&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;pick&nbsp;a&nbsp;number&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6497465">//&nbsp;hope&nbsp;that&nbsp;it&#39;s&nbsp;not&nbsp;in&nbsp;use&nbsp;on&nbsp;the&nbsp;machine.&nbsp;Since&nbsp;this&nbsp;only&nbsp;occurs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6497534">//&nbsp;when&nbsp;-update&nbsp;is&nbsp;given&nbsp;and&nbsp;thus&nbsp;when&nbsp;there&#39;s&nbsp;a&nbsp;human&nbsp;watching&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6497603">//&nbsp;test,&nbsp;this&nbsp;isn&#39;t&nbsp;too&nbsp;bad.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6497633">const</span>&nbsp;<span class="ident" id="6497639">serverPort</span>&nbsp;<span class="op" id="6497650">=</span>&nbsp;<span class="num" id="6497652">24323</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497659">command</span>&nbsp;<span class="op" id="6497667">=</span>&nbsp;<span class="builtinfunc" id="6497669">append</span><span class="op" id="6497675">(</span><span class="ident" id="6497676">command</span><span class="op" id="6497683">,</span>&nbsp;<span class="string" id="6497685">&#34;-accept&#34;</span><span class="op" id="6497694">,</span>&nbsp;<span class="ident" id="6497696">strconv</span><span class="op" id="6497703">.</span><span class="ident" id="6497704">Itoa</span><span class="op" id="6497708">(</span><span class="ident" id="6497709">serverPort</span><span class="op" id="6497719">)</span><span class="op" id="6497720">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497724">cmd</span>&nbsp;<span class="op" id="6497728">:=</span>&nbsp;<span class="ident" id="6497731">exec</span><span class="op" id="6497735">.</span><span class="ident" id="6497736">Command</span><span class="op" id="6497743">(</span><span class="ident" id="6497744">command</span><span class="op" id="6497751">[</span><span class="num" id="6497752">0</span><span class="op" id="6497753">]</span><span class="op" id="6497754">,</span>&nbsp;<span class="ident" id="6497756">command</span><span class="op" id="6497763">[</span><span class="num" id="6497764">1</span><span class="op" id="6497765">:</span><span class="op" id="6497766">]</span><span class="op" id="6497767">...</span><span class="op" id="6497770">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497773">stdin</span>&nbsp;<span class="op" id="6497779">=</span>&nbsp;<span class="ident" id="6497781">blockingSource</span><span class="op" id="6497795">(</span><span class="builtinfunc" id="6497796">make</span><span class="op" id="6497800">(</span><span class="keyword" id="6497801">chan</span>&nbsp;<span class="builtintype" id="6497806">bool</span><span class="op" id="6497810">)</span><span class="op" id="6497811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497814">cmd</span><span class="op" id="6497817">.</span><span class="ident" id="6497818">Stdin</span>&nbsp;<span class="op" id="6497824">=</span>&nbsp;<span class="ident" id="6497826">stdin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6497833">var</span>&nbsp;<span class="ident" id="6497837">out</span>&nbsp;<span class="ident" id="6497841">bytes</span><span class="op" id="6497846">.</span><span class="ident" id="6497847">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497855">cmd</span><span class="op" id="6497858">.</span><span class="ident" id="6497859">Stdout</span>&nbsp;<span class="op" id="6497866">=</span>&nbsp;<span class="op" id="6497868">&amp;</span><span class="ident" id="6497869">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497874">cmd</span><span class="op" id="6497877">.</span><span class="ident" id="6497878">Stderr</span>&nbsp;<span class="op" id="6497885">=</span>&nbsp;<span class="op" id="6497887">&amp;</span><span class="ident" id="6497888">out</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6497893">if</span>&nbsp;<span class="ident" id="6497896">err</span>&nbsp;<span class="op" id="6497900">:=</span>&nbsp;<span class="ident" id="6497903">cmd</span><span class="op" id="6497906">.</span><span class="ident" id="6497907">Start</span><span class="op" id="6497912">(</span><span class="op" id="6497913">)</span><span class="op" id="6497914">;</span>&nbsp;<span class="ident" id="6497916">err</span>&nbsp;<span class="op" id="6497920">!=</span>&nbsp;<span class="ident" id="6497923">nil</span>&nbsp;<span class="op" id="6497927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6497931">return</span>&nbsp;<span class="ident" id="6497938">nil</span><span class="op" id="6497941">,</span>&nbsp;<span class="ident" id="6497943">nil</span><span class="op" id="6497946">,</span>&nbsp;<span class="ident" id="6497948">nil</span><span class="op" id="6497951">,</span>&nbsp;<span class="ident" id="6497953">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6497958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6497962">//&nbsp;OpenSSL&nbsp;does&nbsp;print&nbsp;an&nbsp;&#34;ACCEPT&#34;&nbsp;banner,&nbsp;but&nbsp;it&nbsp;does&nbsp;so&nbsp;*before*</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6498029">//&nbsp;opening&nbsp;the&nbsp;listening&nbsp;socket,&nbsp;so&nbsp;we&nbsp;can&#39;t&nbsp;use&nbsp;that&nbsp;to&nbsp;wait&nbsp;until&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6498101">//&nbsp;has&nbsp;started&nbsp;listening.&nbsp;Thus&nbsp;we&nbsp;are&nbsp;forced&nbsp;to&nbsp;poll&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6498170">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498186">var</span>&nbsp;<span class="ident" id="6498190">tcpConn</span>&nbsp;<span class="ident" id="6498198">net</span><span class="op" id="6498201">.</span><span class="ident" id="6498202">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498208">for</span>&nbsp;<span class="ident" id="6498212">i</span>&nbsp;<span class="op" id="6498214">:=</span>&nbsp;<span class="builtintype" id="6498217">uint</span><span class="op" id="6498221">(</span><span class="num" id="6498222">0</span><span class="op" id="6498223">)</span><span class="op" id="6498224">;</span>&nbsp;<span class="ident" id="6498226">i</span>&nbsp;<span class="op" id="6498228">&lt;</span>&nbsp;<span class="num" id="6498230">5</span><span class="op" id="6498231">;</span>&nbsp;<span class="ident" id="6498233">i</span><span class="op" id="6498234">++</span>&nbsp;<span class="op" id="6498237">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498241">var</span>&nbsp;<span class="ident" id="6498245">err</span>&nbsp;<span class="builtintype" id="6498249">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498257">tcpConn</span><span class="op" id="6498264">,</span>&nbsp;<span class="ident" id="6498266">err</span>&nbsp;<span class="op" id="6498270">=</span>&nbsp;<span class="ident" id="6498272">net</span><span class="op" id="6498275">.</span><span class="ident" id="6498276">DialTCP</span><span class="op" id="6498283">(</span><span class="string" id="6498284">&#34;tcp&#34;</span><span class="op" id="6498289">,</span>&nbsp;<span class="ident" id="6498291">nil</span><span class="op" id="6498294">,</span>&nbsp;<span class="op" id="6498296">&amp;</span><span class="ident" id="6498297">net</span><span class="op" id="6498300">.</span><span class="ident" id="6498301">TCPAddr</span><span class="op" id="6498308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498313">IP</span><span class="op" id="6498315">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6498319">net</span><span class="op" id="6498322">.</span><span class="ident" id="6498323">IPv4</span><span class="op" id="6498327">(</span><span class="num" id="6498328">127</span><span class="op" id="6498331">,</span>&nbsp;<span class="num" id="6498333">0</span><span class="op" id="6498334">,</span>&nbsp;<span class="num" id="6498336">0</span><span class="op" id="6498337">,</span>&nbsp;<span class="num" id="6498339">1</span><span class="op" id="6498340">)</span><span class="op" id="6498341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498346">Port</span><span class="op" id="6498350">:</span>&nbsp;<span class="ident" id="6498352">serverPort</span><span class="op" id="6498362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6498366">}</span><span class="op" id="6498367">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498371">if</span>&nbsp;<span class="ident" id="6498374">err</span>&nbsp;<span class="op" id="6498378">==</span>&nbsp;<span class="ident" id="6498381">nil</span>&nbsp;<span class="op" id="6498385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498390">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6498398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498402">time</span><span class="op" id="6498406">.</span><span class="ident" id="6498407">Sleep</span><span class="op" id="6498412">(</span><span class="op" id="6498413">(</span><span class="num" id="6498414">1</span>&nbsp;<span class="op" id="6498416">&lt;&lt;</span>&nbsp;<span class="ident" id="6498419">i</span><span class="op" id="6498420">)</span>&nbsp;<span class="op" id="6498422">*</span>&nbsp;<span class="num" id="6498424">5</span>&nbsp;<span class="op" id="6498426">*</span>&nbsp;<span class="ident" id="6498428">time</span><span class="op" id="6498432">.</span><span class="ident" id="6498433">Millisecond</span><span class="op" id="6498444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6498447">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498450">if</span>&nbsp;<span class="ident" id="6498453">tcpConn</span>&nbsp;<span class="op" id="6498461">==</span>&nbsp;<span class="ident" id="6498464">nil</span>&nbsp;<span class="op" id="6498468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6498472">close</span><span class="op" id="6498477">(</span><span class="ident" id="6498478">stdin</span><span class="op" id="6498483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498487">out</span><span class="op" id="6498490">.</span><span class="ident" id="6498491">WriteTo</span><span class="op" id="6498498">(</span><span class="ident" id="6498499">os</span><span class="op" id="6498501">.</span><span class="ident" id="6498502">Stdout</span><span class="op" id="6498508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498512">cmd</span><span class="op" id="6498515">.</span><span class="ident" id="6498516">Process</span><span class="op" id="6498523">.</span><span class="ident" id="6498524">Kill</span><span class="op" id="6498528">(</span><span class="op" id="6498529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498533">return</span>&nbsp;<span class="ident" id="6498540">nil</span><span class="op" id="6498543">,</span>&nbsp;<span class="ident" id="6498545">nil</span><span class="op" id="6498548">,</span>&nbsp;<span class="ident" id="6498550">nil</span><span class="op" id="6498553">,</span>&nbsp;<span class="ident" id="6498555">cmd</span><span class="op" id="6498558">.</span><span class="ident" id="6498559">Wait</span><span class="op" id="6498563">(</span><span class="op" id="6498564">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6498567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498571">record</span>&nbsp;<span class="op" id="6498578">:=</span>&nbsp;<span class="op" id="6498581">&amp;</span><span class="ident" id="6498582">recordingConn</span><span class="op" id="6498595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498599">Conn</span><span class="op" id="6498603">:</span>&nbsp;<span class="ident" id="6498605">tcpConn</span><span class="op" id="6498612">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6498615">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498619">return</span>&nbsp;<span class="ident" id="6498626">record</span><span class="op" id="6498632">,</span>&nbsp;<span class="ident" id="6498634">cmd</span><span class="op" id="6498637">,</span>&nbsp;<span class="ident" id="6498639">stdin</span><span class="op" id="6498644">,</span>&nbsp;<span class="ident" id="6498646">nil</span><br>
<span class="lineno"></span><span class="op" id="6498650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6498653">func</span>&nbsp;<span class="op" id="6498658">(</span><span class="ident" id="6498659">test</span>&nbsp;<span class="op" id="6498664">*</span><span class="ident" id="6498665">clientTest</span><span class="op" id="6498675">)</span>&nbsp;<span class="ident" id="6498677">dataPath</span><span class="op" id="6498685">(</span><span class="op" id="6498686">)</span>&nbsp;<span class="builtintype" id="6498688">string</span>&nbsp;<span class="op" id="6498695">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498698">return</span>&nbsp;<span class="ident" id="6498705">filepath</span><span class="op" id="6498713">.</span><span class="ident" id="6498714">Join</span><span class="op" id="6498718">(</span><span class="string" id="6498719">&#34;testdata&#34;</span><span class="op" id="6498729">,</span>&nbsp;<span class="string" id="6498731">&#34;Client-&#34;</span><span class="op" id="6498740">+</span><span class="ident" id="6498741">test</span><span class="op" id="6498745">.</span><span class="ident" id="6498746">name</span><span class="op" id="6498750">)</span><br>
<span class="lineno"></span><span class="op" id="6498752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6498755">func</span>&nbsp;<span class="op" id="6498760">(</span><span class="ident" id="6498761">test</span>&nbsp;<span class="op" id="6498766">*</span><span class="ident" id="6498767">clientTest</span><span class="op" id="6498777">)</span>&nbsp;<span class="ident" id="6498779">loadData</span><span class="op" id="6498787">(</span><span class="op" id="6498788">)</span>&nbsp;<span class="op" id="6498790">(</span><span class="ident" id="6498791">flows</span>&nbsp;<span class="op" id="6498797">[</span><span class="op" id="6498798">]</span><span class="op" id="6498799">[</span><span class="op" id="6498800">]</span><span class="builtintype" id="6498801">byte</span><span class="op" id="6498805">,</span>&nbsp;<span class="ident" id="6498807">err</span>&nbsp;<span class="builtintype" id="6498811">error</span><span class="op" id="6498816">)</span>&nbsp;<span class="op" id="6498818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6498821">in</span><span class="op" id="6498823">,</span>&nbsp;<span class="ident" id="6498825">err</span>&nbsp;<span class="op" id="6498829">:=</span>&nbsp;<span class="ident" id="6498832">os</span><span class="op" id="6498834">.</span><span class="ident" id="6498835">Open</span><span class="op" id="6498839">(</span><span class="ident" id="6498840">test</span><span class="op" id="6498844">.</span><span class="ident" id="6498845">dataPath</span><span class="op" id="6498853">(</span><span class="op" id="6498854">)</span><span class="op" id="6498855">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498858">if</span>&nbsp;<span class="ident" id="6498861">err</span>&nbsp;<span class="op" id="6498865">!=</span>&nbsp;<span class="ident" id="6498868">nil</span>&nbsp;<span class="op" id="6498872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498876">return</span>&nbsp;<span class="ident" id="6498883">nil</span><span class="op" id="6498886">,</span>&nbsp;<span class="ident" id="6498888">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6498893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498896">defer</span>&nbsp;<span class="ident" id="6498902">in</span><span class="op" id="6498904">.</span><span class="ident" id="6498905">Close</span><span class="op" id="6498910">(</span><span class="op" id="6498911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498914">return</span>&nbsp;<span class="ident" id="6498921">parseTestData</span><span class="op" id="6498934">(</span><span class="ident" id="6498935">in</span><span class="op" id="6498937">)</span><br>
<span class="lineno">165</span><span class="op" id="6498939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6498942">func</span>&nbsp;<span class="op" id="6498947">(</span><span class="ident" id="6498948">test</span>&nbsp;<span class="op" id="6498953">*</span><span class="ident" id="6498954">clientTest</span><span class="op" id="6498964">)</span>&nbsp;<span class="ident" id="6498966">run</span><span class="op" id="6498969">(</span><span class="ident" id="6498970">t</span>&nbsp;<span class="op" id="6498972">*</span><span class="ident" id="6498973">testing</span><span class="op" id="6498980">.</span><span class="ident" id="6498981">T</span><span class="op" id="6498982">,</span>&nbsp;<span class="ident" id="6498984">write</span>&nbsp;<span class="builtintype" id="6498990">bool</span><span class="op" id="6498994">)</span>&nbsp;<span class="op" id="6498996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6498999">var</span>&nbsp;<span class="ident" id="6499003">clientConn</span><span class="op" id="6499013">,</span>&nbsp;<span class="ident" id="6499015">serverConn</span>&nbsp;<span class="ident" id="6499026">net</span><span class="op" id="6499029">.</span><span class="ident" id="6499030">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499036">var</span>&nbsp;<span class="ident" id="6499040">recordingConn</span>&nbsp;<span class="op" id="6499054">*</span><span class="ident" id="6499055">recordingConn</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499070">var</span>&nbsp;<span class="ident" id="6499074">childProcess</span>&nbsp;<span class="op" id="6499087">*</span><span class="ident" id="6499088">exec</span><span class="op" id="6499092">.</span><span class="ident" id="6499093">Cmd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499098">var</span>&nbsp;<span class="ident" id="6499102">stdin</span>&nbsp;<span class="ident" id="6499108">blockingSource</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499125">if</span>&nbsp;<span class="ident" id="6499128">write</span>&nbsp;<span class="op" id="6499134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499138">var</span>&nbsp;<span class="ident" id="6499142">err</span>&nbsp;<span class="builtintype" id="6499146">error</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499154">recordingConn</span><span class="op" id="6499167">,</span>&nbsp;<span class="ident" id="6499169">childProcess</span><span class="op" id="6499181">,</span>&nbsp;<span class="ident" id="6499183">stdin</span><span class="op" id="6499188">,</span>&nbsp;<span class="ident" id="6499190">err</span>&nbsp;<span class="op" id="6499194">=</span>&nbsp;<span class="ident" id="6499196">test</span><span class="op" id="6499200">.</span><span class="ident" id="6499201">connFromCommand</span><span class="op" id="6499216">(</span><span class="op" id="6499217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499221">if</span>&nbsp;<span class="ident" id="6499224">err</span>&nbsp;<span class="op" id="6499228">!=</span>&nbsp;<span class="ident" id="6499231">nil</span>&nbsp;<span class="op" id="6499235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499240">t</span><span class="op" id="6499241">.</span><span class="ident" id="6499242">Fatalf</span><span class="op" id="6499248">(</span><span class="string" id="6499249">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="6499281">,</span>&nbsp;<span class="ident" id="6499283">err</span><span class="op" id="6499286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6499290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499294">clientConn</span>&nbsp;<span class="op" id="6499305">=</span>&nbsp;<span class="ident" id="6499307">recordingConn</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6499322">}</span>&nbsp;<span class="keyword" id="6499324">else</span>&nbsp;<span class="op" id="6499329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499333">clientConn</span><span class="op" id="6499343">,</span>&nbsp;<span class="ident" id="6499345">serverConn</span>&nbsp;<span class="op" id="6499356">=</span>&nbsp;<span class="ident" id="6499358">net</span><span class="op" id="6499361">.</span><span class="ident" id="6499362">Pipe</span><span class="op" id="6499366">(</span><span class="op" id="6499367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6499370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499374">config</span>&nbsp;<span class="op" id="6499381">:=</span>&nbsp;<span class="ident" id="6499384">test</span><span class="op" id="6499388">.</span><span class="ident" id="6499389">config</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499397">if</span>&nbsp;<span class="ident" id="6499400">config</span>&nbsp;<span class="op" id="6499407">==</span>&nbsp;<span class="ident" id="6499410">nil</span>&nbsp;<span class="op" id="6499414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499418">config</span>&nbsp;<span class="op" id="6499425">=</span>&nbsp;<span class="ident" id="6499427">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6499439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499442">client</span>&nbsp;<span class="op" id="6499449">:=</span>&nbsp;<span class="ident" id="6499452">Client</span><span class="op" id="6499458">(</span><span class="ident" id="6499459">clientConn</span><span class="op" id="6499469">,</span>&nbsp;<span class="ident" id="6499471">config</span><span class="op" id="6499477">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499481">doneChan</span>&nbsp;<span class="op" id="6499490">:=</span>&nbsp;<span class="builtinfunc" id="6499493">make</span><span class="op" id="6499497">(</span><span class="keyword" id="6499498">chan</span>&nbsp;<span class="builtintype" id="6499503">bool</span><span class="op" id="6499507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499510">go</span>&nbsp;<span class="keyword" id="6499513">func</span><span class="op" id="6499517">(</span><span class="op" id="6499518">)</span>&nbsp;<span class="op" id="6499520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499524">if</span>&nbsp;<span class="ident" id="6499527">_</span><span class="op" id="6499528">,</span>&nbsp;<span class="ident" id="6499530">err</span>&nbsp;<span class="op" id="6499534">:=</span>&nbsp;<span class="ident" id="6499537">client</span><span class="op" id="6499543">.</span><span class="ident" id="6499544">Write</span><span class="op" id="6499549">(</span><span class="op" id="6499550">[</span><span class="op" id="6499551">]</span><span class="builtintype" id="6499552">byte</span><span class="op" id="6499556">(</span><span class="string" id="6499557">&#34;hello\n&#34;</span><span class="op" id="6499566">)</span><span class="op" id="6499567">)</span><span class="op" id="6499568">;</span>&nbsp;<span class="ident" id="6499570">err</span>&nbsp;<span class="op" id="6499574">!=</span>&nbsp;<span class="ident" id="6499577">nil</span>&nbsp;<span class="op" id="6499581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499586">t</span><span class="op" id="6499587">.</span><span class="ident" id="6499588">Logf</span><span class="op" id="6499592">(</span><span class="string" id="6499593">&#34;Client.Write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="6499618">,</span>&nbsp;<span class="ident" id="6499620">err</span><span class="op" id="6499623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6499627">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499631">if</span>&nbsp;<span class="ident" id="6499634">test</span><span class="op" id="6499638">.</span><span class="ident" id="6499639">validate</span>&nbsp;<span class="op" id="6499648">!=</span>&nbsp;<span class="ident" id="6499651">nil</span>&nbsp;<span class="op" id="6499655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499660">if</span>&nbsp;<span class="ident" id="6499663">err</span>&nbsp;<span class="op" id="6499667">:=</span>&nbsp;<span class="ident" id="6499670">test</span><span class="op" id="6499674">.</span><span class="ident" id="6499675">validate</span><span class="op" id="6499683">(</span><span class="ident" id="6499684">client</span><span class="op" id="6499690">.</span><span class="ident" id="6499691">ConnectionState</span><span class="op" id="6499706">(</span><span class="op" id="6499707">)</span><span class="op" id="6499708">)</span><span class="op" id="6499709">;</span>&nbsp;<span class="ident" id="6499711">err</span>&nbsp;<span class="op" id="6499715">!=</span>&nbsp;<span class="ident" id="6499718">nil</span>&nbsp;<span class="op" id="6499722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499728">t</span><span class="op" id="6499729">.</span><span class="ident" id="6499730">Logf</span><span class="op" id="6499734">(</span><span class="string" id="6499735">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="6499773">,</span>&nbsp;<span class="ident" id="6499775">err</span><span class="op" id="6499778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6499783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6499787">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499791">client</span><span class="op" id="6499797">.</span><span class="ident" id="6499798">Close</span><span class="op" id="6499803">(</span><span class="op" id="6499804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499808">clientConn</span><span class="op" id="6499818">.</span><span class="ident" id="6499819">Close</span><span class="op" id="6499824">(</span><span class="op" id="6499825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499829">doneChan</span>&nbsp;<span class="op" id="6499838">&lt;-</span>&nbsp;<span class="builtintype" id="6499841">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6499847">}</span><span class="op" id="6499848">(</span><span class="op" id="6499849">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499853">if</span>&nbsp;<span class="op" id="6499856">!</span><span class="ident" id="6499857">write</span>&nbsp;<span class="op" id="6499863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499867">flows</span><span class="op" id="6499872">,</span>&nbsp;<span class="ident" id="6499874">err</span>&nbsp;<span class="op" id="6499878">:=</span>&nbsp;<span class="ident" id="6499881">test</span><span class="op" id="6499885">.</span><span class="ident" id="6499886">loadData</span><span class="op" id="6499894">(</span><span class="op" id="6499895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6499899">if</span>&nbsp;<span class="ident" id="6499902">err</span>&nbsp;<span class="op" id="6499906">!=</span>&nbsp;<span class="ident" id="6499909">nil</span>&nbsp;<span class="op" id="6499913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6499918">t</span><span class="op" id="6499919">.</span><span class="ident" id="6499920">Fatalf</span><span class="op" id="6499926">(</span><span class="string" id="6499927">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="6499964">,</span>&nbsp;<span class="ident" id="6499966">test</span><span class="op" id="6499970">.</span><span class="ident" id="6499971">name</span><span class="op" id="6499975">,</span>&nbsp;<span class="ident" id="6499977">test</span><span class="op" id="6499981">.</span><span class="ident" id="6499982">dataPath</span><span class="op" id="6499990">(</span><span class="op" id="6499991">)</span><span class="op" id="6499992">,</span>&nbsp;<span class="ident" id="6499994">err</span><span class="op" id="6499997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500001">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6500005">for</span>&nbsp;<span class="ident" id="6500009">i</span><span class="op" id="6500010">,</span>&nbsp;<span class="ident" id="6500012">b</span>&nbsp;<span class="op" id="6500014">:=</span>&nbsp;<span class="keyword" id="6500017">range</span>&nbsp;<span class="ident" id="6500023">flows</span>&nbsp;<span class="op" id="6500029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6500034">if</span>&nbsp;<span class="ident" id="6500037">i</span><span class="op" id="6500038">%</span><span class="num" id="6500039">2</span>&nbsp;<span class="op" id="6500041">==</span>&nbsp;<span class="num" id="6500044">1</span>&nbsp;<span class="op" id="6500046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500052">serverConn</span><span class="op" id="6500062">.</span><span class="ident" id="6500063">Write</span><span class="op" id="6500068">(</span><span class="ident" id="6500069">b</span><span class="op" id="6500070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6500076">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500088">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500093">bb</span>&nbsp;<span class="op" id="6500096">:=</span>&nbsp;<span class="builtinfunc" id="6500099">make</span><span class="op" id="6500103">(</span><span class="op" id="6500104">[</span><span class="op" id="6500105">]</span><span class="builtintype" id="6500106">byte</span><span class="op" id="6500110">,</span>&nbsp;<span class="builtinfunc" id="6500112">len</span><span class="op" id="6500115">(</span><span class="ident" id="6500116">b</span><span class="op" id="6500117">)</span><span class="op" id="6500118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500123">_</span><span class="op" id="6500124">,</span>&nbsp;<span class="ident" id="6500126">err</span>&nbsp;<span class="op" id="6500130">:=</span>&nbsp;<span class="ident" id="6500133">io</span><span class="op" id="6500135">.</span><span class="ident" id="6500136">ReadFull</span><span class="op" id="6500144">(</span><span class="ident" id="6500145">serverConn</span><span class="op" id="6500155">,</span>&nbsp;<span class="ident" id="6500157">bb</span><span class="op" id="6500159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6500164">if</span>&nbsp;<span class="ident" id="6500167">err</span>&nbsp;<span class="op" id="6500171">!=</span>&nbsp;<span class="ident" id="6500174">nil</span>&nbsp;<span class="op" id="6500178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500184">t</span><span class="op" id="6500185">.</span><span class="ident" id="6500186">Fatalf</span><span class="op" id="6500192">(</span><span class="string" id="6500193">&#34;%s&nbsp;#%d:&nbsp;%s&#34;</span><span class="op" id="6500205">,</span>&nbsp;<span class="ident" id="6500207">test</span><span class="op" id="6500211">.</span><span class="ident" id="6500212">name</span><span class="op" id="6500216">,</span>&nbsp;<span class="ident" id="6500218">i</span><span class="op" id="6500219">,</span>&nbsp;<span class="ident" id="6500221">err</span><span class="op" id="6500224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500229">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6500234">if</span>&nbsp;<span class="op" id="6500237">!</span><span class="ident" id="6500238">bytes</span><span class="op" id="6500243">.</span><span class="ident" id="6500244">Equal</span><span class="op" id="6500249">(</span><span class="ident" id="6500250">b</span><span class="op" id="6500251">,</span>&nbsp;<span class="ident" id="6500253">bb</span><span class="op" id="6500255">)</span>&nbsp;<span class="op" id="6500257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500263">t</span><span class="op" id="6500264">.</span><span class="ident" id="6500265">Fatalf</span><span class="op" id="6500271">(</span><span class="string" id="6500272">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="6500314">,</span>&nbsp;<span class="ident" id="6500316">test</span><span class="op" id="6500320">.</span><span class="ident" id="6500321">name</span><span class="op" id="6500325">,</span>&nbsp;<span class="ident" id="6500327">i</span><span class="op" id="6500328">,</span>&nbsp;<span class="ident" id="6500330">bb</span><span class="op" id="6500332">,</span>&nbsp;<span class="ident" id="6500334">b</span><span class="op" id="6500335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500348">serverConn</span><span class="op" id="6500358">.</span><span class="ident" id="6500359">Close</span><span class="op" id="6500364">(</span><span class="op" id="6500365">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500372">&lt;-</span><span class="ident" id="6500374">doneChan</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6500385">if</span>&nbsp;<span class="ident" id="6500388">write</span>&nbsp;<span class="op" id="6500394">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500398">path</span>&nbsp;<span class="op" id="6500403">:=</span>&nbsp;<span class="ident" id="6500406">test</span><span class="op" id="6500410">.</span><span class="ident" id="6500411">dataPath</span><span class="op" id="6500419">(</span><span class="op" id="6500420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500424">out</span><span class="op" id="6500427">,</span>&nbsp;<span class="ident" id="6500429">err</span>&nbsp;<span class="op" id="6500433">:=</span>&nbsp;<span class="ident" id="6500436">os</span><span class="op" id="6500438">.</span><span class="ident" id="6500439">OpenFile</span><span class="op" id="6500447">(</span><span class="ident" id="6500448">path</span><span class="op" id="6500452">,</span>&nbsp;<span class="ident" id="6500454">os</span><span class="op" id="6500456">.</span><span class="ident" id="6500457">O_WRONLY</span><span class="op" id="6500465">|</span><span class="ident" id="6500466">os</span><span class="op" id="6500468">.</span><span class="ident" id="6500469">O_CREATE</span><span class="op" id="6500477">|</span><span class="ident" id="6500478">os</span><span class="op" id="6500480">.</span><span class="ident" id="6500481">O_TRUNC</span><span class="op" id="6500488">,</span>&nbsp;<span class="num" id="6500490">0644</span><span class="op" id="6500494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6500498">if</span>&nbsp;<span class="ident" id="6500501">err</span>&nbsp;<span class="op" id="6500505">!=</span>&nbsp;<span class="ident" id="6500508">nil</span>&nbsp;<span class="op" id="6500512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500517">t</span><span class="op" id="6500518">.</span><span class="ident" id="6500519">Fatalf</span><span class="op" id="6500525">(</span><span class="string" id="6500526">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="6500560">,</span>&nbsp;<span class="ident" id="6500562">err</span><span class="op" id="6500565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500569">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6500573">defer</span>&nbsp;<span class="ident" id="6500579">out</span><span class="op" id="6500582">.</span><span class="ident" id="6500583">Close</span><span class="op" id="6500588">(</span><span class="op" id="6500589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500593">recordingConn</span><span class="op" id="6500606">.</span><span class="ident" id="6500607">Close</span><span class="op" id="6500612">(</span><span class="op" id="6500613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6500617">close</span><span class="op" id="6500622">(</span><span class="ident" id="6500623">stdin</span><span class="op" id="6500628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500632">childProcess</span><span class="op" id="6500644">.</span><span class="ident" id="6500645">Process</span><span class="op" id="6500652">.</span><span class="ident" id="6500653">Kill</span><span class="op" id="6500657">(</span><span class="op" id="6500658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500662">childProcess</span><span class="op" id="6500674">.</span><span class="ident" id="6500675">Wait</span><span class="op" id="6500679">(</span><span class="op" id="6500680">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6500684">if</span>&nbsp;<span class="builtinfunc" id="6500687">len</span><span class="op" id="6500690">(</span><span class="ident" id="6500691">recordingConn</span><span class="op" id="6500704">.</span><span class="ident" id="6500705">flows</span><span class="op" id="6500710">)</span>&nbsp;<span class="op" id="6500712">&lt;</span>&nbsp;<span class="num" id="6500714">3</span>&nbsp;<span class="op" id="6500716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500721">childProcess</span><span class="op" id="6500733">.</span><span class="ident" id="6500734">Stdout</span><span class="op" id="6500740">.</span><span class="op" id="6500741">(</span><span class="op" id="6500742">*</span><span class="ident" id="6500743">bytes</span><span class="op" id="6500748">.</span><span class="ident" id="6500749">Buffer</span><span class="op" id="6500755">)</span><span class="op" id="6500756">.</span><span class="ident" id="6500757">WriteTo</span><span class="op" id="6500764">(</span><span class="ident" id="6500765">os</span><span class="op" id="6500767">.</span><span class="ident" id="6500768">Stdout</span><span class="op" id="6500774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500779">t</span><span class="op" id="6500780">.</span><span class="ident" id="6500781">Fatalf</span><span class="op" id="6500787">(</span><span class="string" id="6500788">&#34;Client&nbsp;connection&nbsp;didn&#39;t&nbsp;work&#34;</span><span class="op" id="6500819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500827">recordingConn</span><span class="op" id="6500840">.</span><span class="ident" id="6500841">WriteTo</span><span class="op" id="6500848">(</span><span class="ident" id="6500849">out</span><span class="op" id="6500852">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500856">fmt</span><span class="op" id="6500859">.</span><span class="ident" id="6500860">Printf</span><span class="op" id="6500866">(</span><span class="string" id="6500867">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="6500879">,</span>&nbsp;<span class="ident" id="6500881">path</span><span class="op" id="6500885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500888">}</span><br>
<span class="lineno"></span><span class="op" id="6500890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6500893">func</span>&nbsp;<span class="ident" id="6500898">runClientTestForVersion</span><span class="op" id="6500921">(</span><span class="ident" id="6500922">t</span>&nbsp;<span class="op" id="6500924">*</span><span class="ident" id="6500925">testing</span><span class="op" id="6500932">.</span><span class="ident" id="6500933">T</span><span class="op" id="6500934">,</span>&nbsp;<span class="ident" id="6500936">template</span>&nbsp;<span class="op" id="6500945">*</span><span class="ident" id="6500946">clientTest</span><span class="op" id="6500956">,</span>&nbsp;<span class="ident" id="6500958">prefix</span><span class="op" id="6500964">,</span>&nbsp;<span class="ident" id="6500966">option</span>&nbsp;<span class="builtintype" id="6500973">string</span><span class="op" id="6500979">)</span>&nbsp;<span class="op" id="6500981">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6500984">test</span>&nbsp;<span class="op" id="6500989">:=</span>&nbsp;<span class="op" id="6500992">*</span><span class="ident" id="6500993">template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501003">test</span><span class="op" id="6501007">.</span><span class="ident" id="6501008">name</span>&nbsp;<span class="op" id="6501013">=</span>&nbsp;<span class="ident" id="6501015">prefix</span>&nbsp;<span class="op" id="6501022">+</span>&nbsp;<span class="ident" id="6501024">test</span><span class="op" id="6501028">.</span><span class="ident" id="6501029">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6501035">if</span>&nbsp;<span class="builtinfunc" id="6501038">len</span><span class="op" id="6501041">(</span><span class="ident" id="6501042">test</span><span class="op" id="6501046">.</span><span class="ident" id="6501047">command</span><span class="op" id="6501054">)</span>&nbsp;<span class="op" id="6501056">==</span>&nbsp;<span class="num" id="6501059">0</span>&nbsp;<span class="op" id="6501061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501065">test</span><span class="op" id="6501069">.</span><span class="ident" id="6501070">command</span>&nbsp;<span class="op" id="6501078">=</span>&nbsp;<span class="ident" id="6501080">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6501102">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501105">test</span><span class="op" id="6501109">.</span><span class="ident" id="6501110">command</span>&nbsp;<span class="op" id="6501118">=</span>&nbsp;<span class="builtinfunc" id="6501120">append</span><span class="op" id="6501126">(</span><span class="op" id="6501127">[</span><span class="op" id="6501128">]</span><span class="builtintype" id="6501129">string</span><span class="op" id="6501135">(</span><span class="ident" id="6501136">nil</span><span class="op" id="6501139">)</span><span class="op" id="6501140">,</span>&nbsp;<span class="ident" id="6501142">test</span><span class="op" id="6501146">.</span><span class="ident" id="6501147">command</span><span class="op" id="6501154">...</span><span class="op" id="6501157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501160">test</span><span class="op" id="6501164">.</span><span class="ident" id="6501165">command</span>&nbsp;<span class="op" id="6501173">=</span>&nbsp;<span class="builtinfunc" id="6501175">append</span><span class="op" id="6501181">(</span><span class="ident" id="6501182">test</span><span class="op" id="6501186">.</span><span class="ident" id="6501187">command</span><span class="op" id="6501194">,</span>&nbsp;<span class="ident" id="6501196">option</span><span class="op" id="6501202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501205">test</span><span class="op" id="6501209">.</span><span class="ident" id="6501210">run</span><span class="op" id="6501213">(</span><span class="ident" id="6501214">t</span><span class="op" id="6501215">,</span>&nbsp;<span class="op" id="6501217">*</span><span class="ident" id="6501218">update</span><span class="op" id="6501224">)</span><br>
<span class="lineno"></span><span class="op" id="6501226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="6501229">func</span>&nbsp;<span class="ident" id="6501234">runClientTestTLS10</span><span class="op" id="6501252">(</span><span class="ident" id="6501253">t</span>&nbsp;<span class="op" id="6501255">*</span><span class="ident" id="6501256">testing</span><span class="op" id="6501263">.</span><span class="ident" id="6501264">T</span><span class="op" id="6501265">,</span>&nbsp;<span class="ident" id="6501267">template</span>&nbsp;<span class="op" id="6501276">*</span><span class="ident" id="6501277">clientTest</span><span class="op" id="6501287">)</span>&nbsp;<span class="op" id="6501289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501292">runClientTestForVersion</span><span class="op" id="6501315">(</span><span class="ident" id="6501316">t</span><span class="op" id="6501317">,</span>&nbsp;<span class="ident" id="6501319">template</span><span class="op" id="6501327">,</span>&nbsp;<span class="string" id="6501329">&#34;TLSv10-&#34;</span><span class="op" id="6501338">,</span>&nbsp;<span class="string" id="6501340">&#34;-tls1&#34;</span><span class="op" id="6501347">)</span><br>
<span class="lineno"></span><span class="op" id="6501349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6501352">func</span>&nbsp;<span class="ident" id="6501357">runClientTestTLS11</span><span class="op" id="6501375">(</span><span class="ident" id="6501376">t</span>&nbsp;<span class="op" id="6501378">*</span><span class="ident" id="6501379">testing</span><span class="op" id="6501386">.</span><span class="ident" id="6501387">T</span><span class="op" id="6501388">,</span>&nbsp;<span class="ident" id="6501390">template</span>&nbsp;<span class="op" id="6501399">*</span><span class="ident" id="6501400">clientTest</span><span class="op" id="6501410">)</span>&nbsp;<span class="op" id="6501412">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501415">runClientTestForVersion</span><span class="op" id="6501438">(</span><span class="ident" id="6501439">t</span><span class="op" id="6501440">,</span>&nbsp;<span class="ident" id="6501442">template</span><span class="op" id="6501450">,</span>&nbsp;<span class="string" id="6501452">&#34;TLSv11-&#34;</span><span class="op" id="6501461">,</span>&nbsp;<span class="string" id="6501463">&#34;-tls1_1&#34;</span><span class="op" id="6501472">)</span><br>
<span class="lineno"></span><span class="op" id="6501474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6501477">func</span>&nbsp;<span class="ident" id="6501482">runClientTestTLS12</span><span class="op" id="6501500">(</span><span class="ident" id="6501501">t</span>&nbsp;<span class="op" id="6501503">*</span><span class="ident" id="6501504">testing</span><span class="op" id="6501511">.</span><span class="ident" id="6501512">T</span><span class="op" id="6501513">,</span>&nbsp;<span class="ident" id="6501515">template</span>&nbsp;<span class="op" id="6501524">*</span><span class="ident" id="6501525">clientTest</span><span class="op" id="6501535">)</span>&nbsp;<span class="op" id="6501537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501540">runClientTestForVersion</span><span class="op" id="6501563">(</span><span class="ident" id="6501564">t</span><span class="op" id="6501565">,</span>&nbsp;<span class="ident" id="6501567">template</span><span class="op" id="6501575">,</span>&nbsp;<span class="string" id="6501577">&#34;TLSv12-&#34;</span><span class="op" id="6501586">,</span>&nbsp;<span class="string" id="6501588">&#34;-tls1_2&#34;</span><span class="op" id="6501597">)</span><br>
<span class="lineno">270</span><span class="op" id="6501599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6501602">func</span>&nbsp;<span class="ident" id="6501607">TestHandshakeClientRSARC4</span><span class="op" id="6501632">(</span><span class="ident" id="6501633">t</span>&nbsp;<span class="op" id="6501635">*</span><span class="ident" id="6501636">testing</span><span class="op" id="6501643">.</span><span class="ident" id="6501644">T</span><span class="op" id="6501645">)</span>&nbsp;<span class="op" id="6501647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501650">test</span>&nbsp;<span class="op" id="6501655">:=</span>&nbsp;<span class="op" id="6501658">&amp;</span><span class="ident" id="6501659">clientTest</span><span class="op" id="6501669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501673">name</span><span class="op" id="6501677">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6501682">&#34;RSA-RC4&#34;</span><span class="op" id="6501691">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501695">command</span><span class="op" id="6501702">:</span>&nbsp;<span class="op" id="6501704">[</span><span class="op" id="6501705">]</span><span class="builtintype" id="6501706">string</span><span class="op" id="6501712">{</span><span class="string" id="6501713">&#34;openssl&#34;</span><span class="op" id="6501722">,</span>&nbsp;<span class="string" id="6501724">&#34;s_server&#34;</span><span class="op" id="6501734">,</span>&nbsp;<span class="string" id="6501736">&#34;-cipher&#34;</span><span class="op" id="6501745">,</span>&nbsp;<span class="string" id="6501747">&#34;RC4-SHA&#34;</span><span class="op" id="6501756">}</span><span class="op" id="6501757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6501760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501763">runClientTestTLS10</span><span class="op" id="6501781">(</span><span class="ident" id="6501782">t</span><span class="op" id="6501783">,</span>&nbsp;<span class="ident" id="6501785">test</span><span class="op" id="6501789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501792">runClientTestTLS11</span><span class="op" id="6501810">(</span><span class="ident" id="6501811">t</span><span class="op" id="6501812">,</span>&nbsp;<span class="ident" id="6501814">test</span><span class="op" id="6501818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501821">runClientTestTLS12</span><span class="op" id="6501839">(</span><span class="ident" id="6501840">t</span><span class="op" id="6501841">,</span>&nbsp;<span class="ident" id="6501843">test</span><span class="op" id="6501847">)</span><br>
<span class="lineno">280</span><span class="op" id="6501849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6501852">func</span>&nbsp;<span class="ident" id="6501857">TestHandshakeClientECDHERSAAES</span><span class="op" id="6501887">(</span><span class="ident" id="6501888">t</span>&nbsp;<span class="op" id="6501890">*</span><span class="ident" id="6501891">testing</span><span class="op" id="6501898">.</span><span class="ident" id="6501899">T</span><span class="op" id="6501900">)</span>&nbsp;<span class="op" id="6501902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501905">test</span>&nbsp;<span class="op" id="6501910">:=</span>&nbsp;<span class="op" id="6501913">&amp;</span><span class="ident" id="6501914">clientTest</span><span class="op" id="6501924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501928">name</span><span class="op" id="6501932">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6501937">&#34;ECDHE-RSA-AES&#34;</span><span class="op" id="6501952">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6501956">command</span><span class="op" id="6501963">:</span>&nbsp;<span class="op" id="6501965">[</span><span class="op" id="6501966">]</span><span class="builtintype" id="6501967">string</span><span class="op" id="6501973">{</span><span class="string" id="6501974">&#34;openssl&#34;</span><span class="op" id="6501983">,</span>&nbsp;<span class="string" id="6501985">&#34;s_server&#34;</span><span class="op" id="6501995">,</span>&nbsp;<span class="string" id="6501997">&#34;-cipher&#34;</span><span class="op" id="6502006">,</span>&nbsp;<span class="string" id="6502008">&#34;ECDHE-RSA-AES128-SHA&#34;</span><span class="op" id="6502030">}</span><span class="op" id="6502031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6502034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502037">runClientTestTLS10</span><span class="op" id="6502055">(</span><span class="ident" id="6502056">t</span><span class="op" id="6502057">,</span>&nbsp;<span class="ident" id="6502059">test</span><span class="op" id="6502063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502066">runClientTestTLS11</span><span class="op" id="6502084">(</span><span class="ident" id="6502085">t</span><span class="op" id="6502086">,</span>&nbsp;<span class="ident" id="6502088">test</span><span class="op" id="6502092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502095">runClientTestTLS12</span><span class="op" id="6502113">(</span><span class="ident" id="6502114">t</span><span class="op" id="6502115">,</span>&nbsp;<span class="ident" id="6502117">test</span><span class="op" id="6502121">)</span><br>
<span class="lineno">290</span><span class="op" id="6502123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6502126">func</span>&nbsp;<span class="ident" id="6502131">TestHandshakeClientECDHEECDSAAES</span><span class="op" id="6502163">(</span><span class="ident" id="6502164">t</span>&nbsp;<span class="op" id="6502166">*</span><span class="ident" id="6502167">testing</span><span class="op" id="6502174">.</span><span class="ident" id="6502175">T</span><span class="op" id="6502176">)</span>&nbsp;<span class="op" id="6502178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502181">test</span>&nbsp;<span class="op" id="6502186">:=</span>&nbsp;<span class="op" id="6502189">&amp;</span><span class="ident" id="6502190">clientTest</span><span class="op" id="6502200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502204">name</span><span class="op" id="6502208">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6502213">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="6502230">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502234">command</span><span class="op" id="6502241">:</span>&nbsp;<span class="op" id="6502243">[</span><span class="op" id="6502244">]</span><span class="builtintype" id="6502245">string</span><span class="op" id="6502251">{</span><span class="string" id="6502252">&#34;openssl&#34;</span><span class="op" id="6502261">,</span>&nbsp;<span class="string" id="6502263">&#34;s_server&#34;</span><span class="op" id="6502273">,</span>&nbsp;<span class="string" id="6502275">&#34;-cipher&#34;</span><span class="op" id="6502284">,</span>&nbsp;<span class="string" id="6502286">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="6502310">}</span><span class="op" id="6502311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502315">cert</span><span class="op" id="6502319">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502324">testECDSACertificate</span><span class="op" id="6502344">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502348">key</span><span class="op" id="6502351">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502357">testECDSAPrivateKey</span><span class="op" id="6502376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6502379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502382">runClientTestTLS10</span><span class="op" id="6502400">(</span><span class="ident" id="6502401">t</span><span class="op" id="6502402">,</span>&nbsp;<span class="ident" id="6502404">test</span><span class="op" id="6502408">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502411">runClientTestTLS11</span><span class="op" id="6502429">(</span><span class="ident" id="6502430">t</span><span class="op" id="6502431">,</span>&nbsp;<span class="ident" id="6502433">test</span><span class="op" id="6502437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502440">runClientTestTLS12</span><span class="op" id="6502458">(</span><span class="ident" id="6502459">t</span><span class="op" id="6502460">,</span>&nbsp;<span class="ident" id="6502462">test</span><span class="op" id="6502466">)</span><br>
<span class="lineno"></span><span class="op" id="6502468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6502471">func</span>&nbsp;<span class="ident" id="6502476">TestHandshakeClientECDHEECDSAAESGCM</span><span class="op" id="6502511">(</span><span class="ident" id="6502512">t</span>&nbsp;<span class="op" id="6502514">*</span><span class="ident" id="6502515">testing</span><span class="op" id="6502522">.</span><span class="ident" id="6502523">T</span><span class="op" id="6502524">)</span>&nbsp;<span class="op" id="6502526">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502529">test</span>&nbsp;<span class="op" id="6502534">:=</span>&nbsp;<span class="op" id="6502537">&amp;</span><span class="ident" id="6502538">clientTest</span><span class="op" id="6502548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502552">name</span><span class="op" id="6502556">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6502561">&#34;ECDHE-ECDSA-AES-GCM&#34;</span><span class="op" id="6502582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502586">command</span><span class="op" id="6502593">:</span>&nbsp;<span class="op" id="6502595">[</span><span class="op" id="6502596">]</span><span class="builtintype" id="6502597">string</span><span class="op" id="6502603">{</span><span class="string" id="6502604">&#34;openssl&#34;</span><span class="op" id="6502613">,</span>&nbsp;<span class="string" id="6502615">&#34;s_server&#34;</span><span class="op" id="6502625">,</span>&nbsp;<span class="string" id="6502627">&#34;-cipher&#34;</span><span class="op" id="6502636">,</span>&nbsp;<span class="string" id="6502638">&#34;ECDHE-ECDSA-AES128-GCM-SHA256&#34;</span><span class="op" id="6502669">}</span><span class="op" id="6502670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502674">cert</span><span class="op" id="6502678">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502683">testECDSACertificate</span><span class="op" id="6502703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502707">key</span><span class="op" id="6502710">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502716">testECDSAPrivateKey</span><span class="op" id="6502735">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6502738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502741">runClientTestTLS12</span><span class="op" id="6502759">(</span><span class="ident" id="6502760">t</span><span class="op" id="6502761">,</span>&nbsp;<span class="ident" id="6502763">test</span><span class="op" id="6502767">)</span><br>
<span class="lineno"></span><span class="op" id="6502769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6502772">func</span>&nbsp;<span class="ident" id="6502777">TestHandshakeClientCertRSA</span><span class="op" id="6502803">(</span><span class="ident" id="6502804">t</span>&nbsp;<span class="op" id="6502806">*</span><span class="ident" id="6502807">testing</span><span class="op" id="6502814">.</span><span class="ident" id="6502815">T</span><span class="op" id="6502816">)</span>&nbsp;<span class="op" id="6502818">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502821">config</span>&nbsp;<span class="op" id="6502828">:=</span>&nbsp;<span class="op" id="6502831">*</span><span class="ident" id="6502832">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502844">cert</span><span class="op" id="6502848">,</span>&nbsp;<span class="ident" id="6502850">_</span>&nbsp;<span class="op" id="6502852">:=</span>&nbsp;<span class="ident" id="6502855">X509KeyPair</span><span class="op" id="6502866">(</span><span class="op" id="6502867">[</span><span class="op" id="6502868">]</span><span class="builtintype" id="6502869">byte</span><span class="op" id="6502873">(</span><span class="ident" id="6502874">clientCertificatePEM</span><span class="op" id="6502894">)</span><span class="op" id="6502895">,</span>&nbsp;<span class="op" id="6502897">[</span><span class="op" id="6502898">]</span><span class="builtintype" id="6502899">byte</span><span class="op" id="6502903">(</span><span class="ident" id="6502904">clientKeyPEM</span><span class="op" id="6502916">)</span><span class="op" id="6502917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502920">config</span><span class="op" id="6502926">.</span><span class="ident" id="6502927">Certificates</span>&nbsp;<span class="op" id="6502940">=</span>&nbsp;<span class="op" id="6502942">[</span><span class="op" id="6502943">]</span><span class="ident" id="6502944">Certificate</span><span class="op" id="6502955">{</span><span class="ident" id="6502956">cert</span><span class="op" id="6502960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502964">test</span>&nbsp;<span class="op" id="6502969">:=</span>&nbsp;<span class="op" id="6502972">&amp;</span><span class="ident" id="6502973">clientTest</span><span class="op" id="6502983">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6502987">name</span><span class="op" id="6502991">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6502996">&#34;ClientCert-RSA-RSA&#34;</span><span class="op" id="6503016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503020">command</span><span class="op" id="6503027">:</span>&nbsp;<span class="op" id="6503029">[</span><span class="op" id="6503030">]</span><span class="builtintype" id="6503031">string</span><span class="op" id="6503037">{</span><span class="string" id="6503038">&#34;openssl&#34;</span><span class="op" id="6503047">,</span>&nbsp;<span class="string" id="6503049">&#34;s_server&#34;</span><span class="op" id="6503059">,</span>&nbsp;<span class="string" id="6503061">&#34;-cipher&#34;</span><span class="op" id="6503070">,</span>&nbsp;<span class="string" id="6503072">&#34;RC4-SHA&#34;</span><span class="op" id="6503081">,</span>&nbsp;<span class="string" id="6503083">&#34;-verify&#34;</span><span class="op" id="6503092">,</span>&nbsp;<span class="string" id="6503094">&#34;1&#34;</span><span class="op" id="6503097">}</span><span class="op" id="6503098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503102">config</span><span class="op" id="6503108">:</span>&nbsp;&nbsp;<span class="op" id="6503111">&amp;</span><span class="ident" id="6503112">config</span><span class="op" id="6503118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6503121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503125">runClientTestTLS10</span><span class="op" id="6503143">(</span><span class="ident" id="6503144">t</span><span class="op" id="6503145">,</span>&nbsp;<span class="ident" id="6503147">test</span><span class="op" id="6503151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503154">runClientTestTLS12</span><span class="op" id="6503172">(</span><span class="ident" id="6503173">t</span><span class="op" id="6503174">,</span>&nbsp;<span class="ident" id="6503176">test</span><span class="op" id="6503180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503184">test</span>&nbsp;<span class="op" id="6503189">=</span>&nbsp;<span class="op" id="6503191">&amp;</span><span class="ident" id="6503192">clientTest</span><span class="op" id="6503202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503206">name</span><span class="op" id="6503210">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6503215">&#34;ClientCert-RSA-ECDSA&#34;</span><span class="op" id="6503237">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503241">command</span><span class="op" id="6503248">:</span>&nbsp;<span class="op" id="6503250">[</span><span class="op" id="6503251">]</span><span class="builtintype" id="6503252">string</span><span class="op" id="6503258">{</span><span class="string" id="6503259">&#34;openssl&#34;</span><span class="op" id="6503268">,</span>&nbsp;<span class="string" id="6503270">&#34;s_server&#34;</span><span class="op" id="6503280">,</span>&nbsp;<span class="string" id="6503282">&#34;-cipher&#34;</span><span class="op" id="6503291">,</span>&nbsp;<span class="string" id="6503293">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="6503317">,</span>&nbsp;<span class="string" id="6503319">&#34;-verify&#34;</span><span class="op" id="6503328">,</span>&nbsp;<span class="string" id="6503330">&#34;1&#34;</span><span class="op" id="6503333">}</span><span class="op" id="6503334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503338">config</span><span class="op" id="6503344">:</span>&nbsp;&nbsp;<span class="op" id="6503347">&amp;</span><span class="ident" id="6503348">config</span><span class="op" id="6503354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503358">cert</span><span class="op" id="6503362">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503367">testECDSACertificate</span><span class="op" id="6503387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503391">key</span><span class="op" id="6503394">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503400">testECDSAPrivateKey</span><span class="op" id="6503419">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6503422">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503426">runClientTestTLS10</span><span class="op" id="6503444">(</span><span class="ident" id="6503445">t</span><span class="op" id="6503446">,</span>&nbsp;<span class="ident" id="6503448">test</span><span class="op" id="6503452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503455">runClientTestTLS12</span><span class="op" id="6503473">(</span><span class="ident" id="6503474">t</span><span class="op" id="6503475">,</span>&nbsp;<span class="ident" id="6503477">test</span><span class="op" id="6503481">)</span><br>
<span class="lineno"></span><span class="op" id="6503483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="6503486">func</span>&nbsp;<span class="ident" id="6503491">TestHandshakeClientCertECDSA</span><span class="op" id="6503519">(</span><span class="ident" id="6503520">t</span>&nbsp;<span class="op" id="6503522">*</span><span class="ident" id="6503523">testing</span><span class="op" id="6503530">.</span><span class="ident" id="6503531">T</span><span class="op" id="6503532">)</span>&nbsp;<span class="op" id="6503534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503537">config</span>&nbsp;<span class="op" id="6503544">:=</span>&nbsp;<span class="op" id="6503547">*</span><span class="ident" id="6503548">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503560">cert</span><span class="op" id="6503564">,</span>&nbsp;<span class="ident" id="6503566">_</span>&nbsp;<span class="op" id="6503568">:=</span>&nbsp;<span class="ident" id="6503571">X509KeyPair</span><span class="op" id="6503582">(</span><span class="op" id="6503583">[</span><span class="op" id="6503584">]</span><span class="builtintype" id="6503585">byte</span><span class="op" id="6503589">(</span><span class="ident" id="6503590">clientECDSACertificatePEM</span><span class="op" id="6503615">)</span><span class="op" id="6503616">,</span>&nbsp;<span class="op" id="6503618">[</span><span class="op" id="6503619">]</span><span class="builtintype" id="6503620">byte</span><span class="op" id="6503624">(</span><span class="ident" id="6503625">clientECDSAKeyPEM</span><span class="op" id="6503642">)</span><span class="op" id="6503643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503646">config</span><span class="op" id="6503652">.</span><span class="ident" id="6503653">Certificates</span>&nbsp;<span class="op" id="6503666">=</span>&nbsp;<span class="op" id="6503668">[</span><span class="op" id="6503669">]</span><span class="ident" id="6503670">Certificate</span><span class="op" id="6503681">{</span><span class="ident" id="6503682">cert</span><span class="op" id="6503686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503690">test</span>&nbsp;<span class="op" id="6503695">:=</span>&nbsp;<span class="op" id="6503698">&amp;</span><span class="ident" id="6503699">clientTest</span><span class="op" id="6503709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503713">name</span><span class="op" id="6503717">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6503722">&#34;ClientCert-ECDSA-RSA&#34;</span><span class="op" id="6503744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503748">command</span><span class="op" id="6503755">:</span>&nbsp;<span class="op" id="6503757">[</span><span class="op" id="6503758">]</span><span class="builtintype" id="6503759">string</span><span class="op" id="6503765">{</span><span class="string" id="6503766">&#34;openssl&#34;</span><span class="op" id="6503775">,</span>&nbsp;<span class="string" id="6503777">&#34;s_server&#34;</span><span class="op" id="6503787">,</span>&nbsp;<span class="string" id="6503789">&#34;-cipher&#34;</span><span class="op" id="6503798">,</span>&nbsp;<span class="string" id="6503800">&#34;RC4-SHA&#34;</span><span class="op" id="6503809">,</span>&nbsp;<span class="string" id="6503811">&#34;-verify&#34;</span><span class="op" id="6503820">,</span>&nbsp;<span class="string" id="6503822">&#34;1&#34;</span><span class="op" id="6503825">}</span><span class="op" id="6503826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503830">config</span><span class="op" id="6503836">:</span>&nbsp;&nbsp;<span class="op" id="6503839">&amp;</span><span class="ident" id="6503840">config</span><span class="op" id="6503846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6503849">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503853">runClientTestTLS10</span><span class="op" id="6503871">(</span><span class="ident" id="6503872">t</span><span class="op" id="6503873">,</span>&nbsp;<span class="ident" id="6503875">test</span><span class="op" id="6503879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503882">runClientTestTLS12</span><span class="op" id="6503900">(</span><span class="ident" id="6503901">t</span><span class="op" id="6503902">,</span>&nbsp;<span class="ident" id="6503904">test</span><span class="op" id="6503908">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503912">test</span>&nbsp;<span class="op" id="6503917">=</span>&nbsp;<span class="op" id="6503919">&amp;</span><span class="ident" id="6503920">clientTest</span><span class="op" id="6503930">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503934">name</span><span class="op" id="6503938">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6503943">&#34;ClientCert-ECDSA-ECDSA&#34;</span><span class="op" id="6503967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6503971">command</span><span class="op" id="6503978">:</span>&nbsp;<span class="op" id="6503980">[</span><span class="op" id="6503981">]</span><span class="builtintype" id="6503982">string</span><span class="op" id="6503988">{</span><span class="string" id="6503989">&#34;openssl&#34;</span><span class="op" id="6503998">,</span>&nbsp;<span class="string" id="6504000">&#34;s_server&#34;</span><span class="op" id="6504010">,</span>&nbsp;<span class="string" id="6504012">&#34;-cipher&#34;</span><span class="op" id="6504021">,</span>&nbsp;<span class="string" id="6504023">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="6504047">,</span>&nbsp;<span class="string" id="6504049">&#34;-verify&#34;</span><span class="op" id="6504058">,</span>&nbsp;<span class="string" id="6504060">&#34;1&#34;</span><span class="op" id="6504063">}</span><span class="op" id="6504064">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504068">config</span><span class="op" id="6504074">:</span>&nbsp;&nbsp;<span class="op" id="6504077">&amp;</span><span class="ident" id="6504078">config</span><span class="op" id="6504084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504088">cert</span><span class="op" id="6504092">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504097">testECDSACertificate</span><span class="op" id="6504117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504121">key</span><span class="op" id="6504124">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504130">testECDSAPrivateKey</span><span class="op" id="6504149">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6504152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504156">runClientTestTLS10</span><span class="op" id="6504174">(</span><span class="ident" id="6504175">t</span><span class="op" id="6504176">,</span>&nbsp;<span class="ident" id="6504178">test</span><span class="op" id="6504182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504185">runClientTestTLS12</span><span class="op" id="6504203">(</span><span class="ident" id="6504204">t</span><span class="op" id="6504205">,</span>&nbsp;<span class="ident" id="6504207">test</span><span class="op" id="6504211">)</span><br>
<span class="lineno"></span><span class="op" id="6504213">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="6504216">func</span>&nbsp;<span class="ident" id="6504221">TestClientResumption</span><span class="op" id="6504241">(</span><span class="ident" id="6504242">t</span>&nbsp;<span class="op" id="6504244">*</span><span class="ident" id="6504245">testing</span><span class="op" id="6504252">.</span><span class="ident" id="6504253">T</span><span class="op" id="6504254">)</span>&nbsp;<span class="op" id="6504256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504259">serverConfig</span>&nbsp;<span class="op" id="6504272">:=</span>&nbsp;<span class="op" id="6504275">&amp;</span><span class="ident" id="6504276">Config</span><span class="op" id="6504282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504286">CipherSuites</span><span class="op" id="6504298">:</span>&nbsp;<span class="op" id="6504300">[</span><span class="op" id="6504301">]</span><span class="builtintype" id="6504302">uint16</span><span class="op" id="6504308">{</span><span class="ident" id="6504309">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6504333">,</span>&nbsp;<span class="ident" id="6504335">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="6504365">}</span><span class="op" id="6504366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504370">Certificates</span><span class="op" id="6504382">:</span>&nbsp;<span class="ident" id="6504384">testConfig</span><span class="op" id="6504394">.</span><span class="ident" id="6504395">Certificates</span><span class="op" id="6504407">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6504410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504413">clientConfig</span>&nbsp;<span class="op" id="6504426">:=</span>&nbsp;<span class="op" id="6504429">&amp;</span><span class="ident" id="6504430">Config</span><span class="op" id="6504436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504440">CipherSuites</span><span class="op" id="6504452">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6504460">[</span><span class="op" id="6504461">]</span><span class="builtintype" id="6504462">uint16</span><span class="op" id="6504468">{</span><span class="ident" id="6504469">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6504493">}</span><span class="op" id="6504494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504498">InsecureSkipVerify</span><span class="op" id="6504516">:</span>&nbsp;<span class="builtintype" id="6504518">true</span><span class="op" id="6504522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504526">ClientSessionCache</span><span class="op" id="6504544">:</span>&nbsp;<span class="ident" id="6504546">NewLRUClientSessionCache</span><span class="op" id="6504570">(</span><span class="num" id="6504571">32</span><span class="op" id="6504573">)</span><span class="op" id="6504574">,</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6504577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504581">testResumeState</span>&nbsp;<span class="op" id="6504597">:=</span>&nbsp;<span class="keyword" id="6504600">func</span><span class="op" id="6504604">(</span><span class="ident" id="6504605">test</span>&nbsp;<span class="builtintype" id="6504610">string</span><span class="op" id="6504616">,</span>&nbsp;<span class="ident" id="6504618">didResume</span>&nbsp;<span class="builtintype" id="6504628">bool</span><span class="op" id="6504632">)</span>&nbsp;<span class="op" id="6504634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504638">hs</span><span class="op" id="6504640">,</span>&nbsp;<span class="ident" id="6504642">err</span>&nbsp;<span class="op" id="6504646">:=</span>&nbsp;<span class="ident" id="6504649">testHandshake</span><span class="op" id="6504662">(</span><span class="ident" id="6504663">clientConfig</span><span class="op" id="6504675">,</span>&nbsp;<span class="ident" id="6504677">serverConfig</span><span class="op" id="6504689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6504693">if</span>&nbsp;<span class="ident" id="6504696">err</span>&nbsp;<span class="op" id="6504700">!=</span>&nbsp;<span class="ident" id="6504703">nil</span>&nbsp;<span class="op" id="6504707">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504712">t</span><span class="op" id="6504713">.</span><span class="ident" id="6504714">Fatalf</span><span class="op" id="6504720">(</span><span class="string" id="6504721">&#34;%s:&nbsp;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="6504747">,</span>&nbsp;<span class="ident" id="6504749">test</span><span class="op" id="6504753">,</span>&nbsp;<span class="ident" id="6504755">err</span><span class="op" id="6504758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6504762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6504766">if</span>&nbsp;<span class="ident" id="6504769">hs</span><span class="op" id="6504771">.</span><span class="ident" id="6504772">DidResume</span>&nbsp;<span class="op" id="6504782">!=</span>&nbsp;<span class="ident" id="6504785">didResume</span>&nbsp;<span class="op" id="6504795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504800">t</span><span class="op" id="6504801">.</span><span class="ident" id="6504802">Fatalf</span><span class="op" id="6504808">(</span><span class="string" id="6504809">&#34;%s&nbsp;resumed:&nbsp;%v,&nbsp;expected:&nbsp;%v&#34;</span><span class="op" id="6504839">,</span>&nbsp;<span class="ident" id="6504841">test</span><span class="op" id="6504845">,</span>&nbsp;<span class="ident" id="6504847">hs</span><span class="op" id="6504849">.</span><span class="ident" id="6504850">DidResume</span><span class="op" id="6504859">,</span>&nbsp;<span class="ident" id="6504861">didResume</span><span class="op" id="6504870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6504874">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6504877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504881">testResumeState</span><span class="op" id="6504896">(</span><span class="string" id="6504897">&#34;Handshake&#34;</span><span class="op" id="6504908">,</span>&nbsp;<span class="builtintype" id="6504910">false</span><span class="op" id="6504915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6504918">testResumeState</span><span class="op" id="6504933">(</span><span class="string" id="6504934">&#34;Resume&#34;</span><span class="op" id="6504942">,</span>&nbsp;<span class="builtintype" id="6504944">true</span><span class="op" id="6504948">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6504952">if</span>&nbsp;<span class="ident" id="6504955">_</span><span class="op" id="6504956">,</span>&nbsp;<span class="ident" id="6504958">err</span>&nbsp;<span class="op" id="6504962">:=</span>&nbsp;<span class="ident" id="6504965">io</span><span class="op" id="6504967">.</span><span class="ident" id="6504968">ReadFull</span><span class="op" id="6504976">(</span><span class="ident" id="6504977">serverConfig</span><span class="op" id="6504989">.</span><span class="ident" id="6504990">rand</span><span class="op" id="6504994">(</span><span class="op" id="6504995">)</span><span class="op" id="6504996">,</span>&nbsp;<span class="ident" id="6504998">serverConfig</span><span class="op" id="6505010">.</span><span class="ident" id="6505011">SessionTicketKey</span><span class="op" id="6505027">[</span><span class="op" id="6505028">:</span><span class="op" id="6505029">]</span><span class="op" id="6505030">)</span><span class="op" id="6505031">;</span>&nbsp;<span class="ident" id="6505033">err</span>&nbsp;<span class="op" id="6505037">!=</span>&nbsp;<span class="ident" id="6505040">nil</span>&nbsp;<span class="op" id="6505044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505048">t</span><span class="op" id="6505049">.</span><span class="ident" id="6505050">Fatalf</span><span class="op" id="6505056">(</span><span class="string" id="6505057">&#34;Failed&nbsp;to&nbsp;invalidate&nbsp;SessionTicketKey&#34;</span><span class="op" id="6505096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6505099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505102">testResumeState</span><span class="op" id="6505117">(</span><span class="string" id="6505118">&#34;InvalidSessionTicketKey&#34;</span><span class="op" id="6505143">,</span>&nbsp;<span class="builtintype" id="6505145">false</span><span class="op" id="6505150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505153">testResumeState</span><span class="op" id="6505168">(</span><span class="string" id="6505169">&#34;ResumeAfterInvalidSessionTicketKey&#34;</span><span class="op" id="6505205">,</span>&nbsp;<span class="builtintype" id="6505207">true</span><span class="op" id="6505211">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505215">clientConfig</span><span class="op" id="6505227">.</span><span class="ident" id="6505228">CipherSuites</span>&nbsp;<span class="op" id="6505241">=</span>&nbsp;<span class="op" id="6505243">[</span><span class="op" id="6505244">]</span><span class="builtintype" id="6505245">uint16</span><span class="op" id="6505251">{</span><span class="ident" id="6505252">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="6505282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505285">testResumeState</span><span class="op" id="6505300">(</span><span class="string" id="6505301">&#34;DifferentCipherSuite&#34;</span><span class="op" id="6505323">,</span>&nbsp;<span class="builtintype" id="6505325">false</span><span class="op" id="6505330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505333">testResumeState</span><span class="op" id="6505348">(</span><span class="string" id="6505349">&#34;DifferentCipherSuiteRecovers&#34;</span><span class="op" id="6505379">,</span>&nbsp;<span class="builtintype" id="6505381">true</span><span class="op" id="6505385">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505389">clientConfig</span><span class="op" id="6505401">.</span><span class="ident" id="6505402">ClientSessionCache</span>&nbsp;<span class="op" id="6505421">=</span>&nbsp;<span class="ident" id="6505423">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505428">testResumeState</span><span class="op" id="6505443">(</span><span class="string" id="6505444">&#34;WithoutSessionCache&#34;</span><span class="op" id="6505465">,</span>&nbsp;<span class="builtintype" id="6505467">false</span><span class="op" id="6505472">)</span><br>
<span class="lineno"></span><span class="op" id="6505474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6505477">func</span>&nbsp;<span class="ident" id="6505482">TestLRUClientSessionCache</span><span class="op" id="6505507">(</span><span class="ident" id="6505508">t</span>&nbsp;<span class="op" id="6505510">*</span><span class="ident" id="6505511">testing</span><span class="op" id="6505518">.</span><span class="ident" id="6505519">T</span><span class="op" id="6505520">)</span>&nbsp;<span class="op" id="6505522">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6505525">//&nbsp;Initialize&nbsp;cache&nbsp;of&nbsp;capacity&nbsp;4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505561">cache</span>&nbsp;<span class="op" id="6505567">:=</span>&nbsp;<span class="ident" id="6505570">NewLRUClientSessionCache</span><span class="op" id="6505594">(</span><span class="num" id="6505595">4</span><span class="op" id="6505596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505599">cs</span>&nbsp;<span class="op" id="6505602">:=</span>&nbsp;<span class="builtinfunc" id="6505605">make</span><span class="op" id="6505609">(</span><span class="op" id="6505610">[</span><span class="op" id="6505611">]</span><span class="ident" id="6505612">ClientSessionState</span><span class="op" id="6505630">,</span>&nbsp;<span class="num" id="6505632">6</span><span class="op" id="6505633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505636">keys</span>&nbsp;<span class="op" id="6505641">:=</span>&nbsp;<span class="op" id="6505644">[</span><span class="op" id="6505645">]</span><span class="builtintype" id="6505646">string</span><span class="op" id="6505652">{</span><span class="string" id="6505653">&#34;0&#34;</span><span class="op" id="6505656">,</span>&nbsp;<span class="string" id="6505658">&#34;1&#34;</span><span class="op" id="6505661">,</span>&nbsp;<span class="string" id="6505663">&#34;2&#34;</span><span class="op" id="6505666">,</span>&nbsp;<span class="string" id="6505668">&#34;3&#34;</span><span class="op" id="6505671">,</span>&nbsp;<span class="string" id="6505673">&#34;4&#34;</span><span class="op" id="6505676">,</span>&nbsp;<span class="string" id="6505678">&#34;5&#34;</span><span class="op" id="6505681">,</span>&nbsp;<span class="string" id="6505683">&#34;6&#34;</span><span class="op" id="6505686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6505690">//&nbsp;Add&nbsp;4&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache&nbsp;and&nbsp;look&nbsp;them&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6505739">for</span>&nbsp;<span class="ident" id="6505743">i</span>&nbsp;<span class="op" id="6505745">:=</span>&nbsp;<span class="num" id="6505748">0</span><span class="op" id="6505749">;</span>&nbsp;<span class="ident" id="6505751">i</span>&nbsp;<span class="op" id="6505753">&lt;</span>&nbsp;<span class="num" id="6505755">4</span><span class="op" id="6505756">;</span>&nbsp;<span class="ident" id="6505758">i</span><span class="op" id="6505759">++</span>&nbsp;<span class="op" id="6505762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505766">cache</span><span class="op" id="6505771">.</span><span class="ident" id="6505772">Put</span><span class="op" id="6505775">(</span><span class="ident" id="6505776">keys</span><span class="op" id="6505780">[</span><span class="ident" id="6505781">i</span><span class="op" id="6505782">]</span><span class="op" id="6505783">,</span>&nbsp;<span class="op" id="6505785">&amp;</span><span class="ident" id="6505786">cs</span><span class="op" id="6505788">[</span><span class="ident" id="6505789">i</span><span class="op" id="6505790">]</span><span class="op" id="6505791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6505794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6505797">for</span>&nbsp;<span class="ident" id="6505801">i</span>&nbsp;<span class="op" id="6505803">:=</span>&nbsp;<span class="num" id="6505806">0</span><span class="op" id="6505807">;</span>&nbsp;<span class="ident" id="6505809">i</span>&nbsp;<span class="op" id="6505811">&lt;</span>&nbsp;<span class="num" id="6505813">4</span><span class="op" id="6505814">;</span>&nbsp;<span class="ident" id="6505816">i</span><span class="op" id="6505817">++</span>&nbsp;<span class="op" id="6505820">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6505824">if</span>&nbsp;<span class="ident" id="6505827">s</span><span class="op" id="6505828">,</span>&nbsp;<span class="ident" id="6505830">ok</span>&nbsp;<span class="op" id="6505833">:=</span>&nbsp;<span class="ident" id="6505836">cache</span><span class="op" id="6505841">.</span><span class="ident" id="6505842">Get</span><span class="op" id="6505845">(</span><span class="ident" id="6505846">keys</span><span class="op" id="6505850">[</span><span class="ident" id="6505851">i</span><span class="op" id="6505852">]</span><span class="op" id="6505853">)</span><span class="op" id="6505854">;</span>&nbsp;<span class="op" id="6505856">!</span><span class="ident" id="6505857">ok</span>&nbsp;<span class="op" id="6505860">||</span>&nbsp;<span class="ident" id="6505863">s</span>&nbsp;<span class="op" id="6505865">!=</span>&nbsp;<span class="op" id="6505868">&amp;</span><span class="ident" id="6505869">cs</span><span class="op" id="6505871">[</span><span class="ident" id="6505872">i</span><span class="op" id="6505873">]</span>&nbsp;<span class="op" id="6505875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6505880">t</span><span class="op" id="6505881">.</span><span class="ident" id="6505882">Fatalf</span><span class="op" id="6505888">(</span><span class="string" id="6505889">&#34;session&nbsp;cache&nbsp;failed&nbsp;lookup&nbsp;for&nbsp;added&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="6505936">,</span>&nbsp;<span class="ident" id="6505938">keys</span><span class="op" id="6505942">[</span><span class="ident" id="6505943">i</span><span class="op" id="6505944">]</span><span class="op" id="6505945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6505949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6505952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6505956">//&nbsp;Add&nbsp;2&nbsp;more&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache.&nbsp;First&nbsp;2&nbsp;should&nbsp;be&nbsp;evicted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6506020">for</span>&nbsp;<span class="ident" id="6506024">i</span>&nbsp;<span class="op" id="6506026">:=</span>&nbsp;<span class="num" id="6506029">4</span><span class="op" id="6506030">;</span>&nbsp;<span class="ident" id="6506032">i</span>&nbsp;<span class="op" id="6506034">&lt;</span>&nbsp;<span class="num" id="6506036">6</span><span class="op" id="6506037">;</span>&nbsp;<span class="ident" id="6506039">i</span><span class="op" id="6506040">++</span>&nbsp;<span class="op" id="6506043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506047">cache</span><span class="op" id="6506052">.</span><span class="ident" id="6506053">Put</span><span class="op" id="6506056">(</span><span class="ident" id="6506057">keys</span><span class="op" id="6506061">[</span><span class="ident" id="6506062">i</span><span class="op" id="6506063">]</span><span class="op" id="6506064">,</span>&nbsp;<span class="op" id="6506066">&amp;</span><span class="ident" id="6506067">cs</span><span class="op" id="6506069">[</span><span class="ident" id="6506070">i</span><span class="op" id="6506071">]</span><span class="op" id="6506072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6506075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6506078">for</span>&nbsp;<span class="ident" id="6506082">i</span>&nbsp;<span class="op" id="6506084">:=</span>&nbsp;<span class="num" id="6506087">0</span><span class="op" id="6506088">;</span>&nbsp;<span class="ident" id="6506090">i</span>&nbsp;<span class="op" id="6506092">&lt;</span>&nbsp;<span class="num" id="6506094">2</span><span class="op" id="6506095">;</span>&nbsp;<span class="ident" id="6506097">i</span><span class="op" id="6506098">++</span>&nbsp;<span class="op" id="6506101">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6506105">if</span>&nbsp;<span class="ident" id="6506108">s</span><span class="op" id="6506109">,</span>&nbsp;<span class="ident" id="6506111">ok</span>&nbsp;<span class="op" id="6506114">:=</span>&nbsp;<span class="ident" id="6506117">cache</span><span class="op" id="6506122">.</span><span class="ident" id="6506123">Get</span><span class="op" id="6506126">(</span><span class="ident" id="6506127">keys</span><span class="op" id="6506131">[</span><span class="ident" id="6506132">i</span><span class="op" id="6506133">]</span><span class="op" id="6506134">)</span><span class="op" id="6506135">;</span>&nbsp;<span class="ident" id="6506137">ok</span>&nbsp;<span class="op" id="6506140">||</span>&nbsp;<span class="ident" id="6506143">s</span>&nbsp;<span class="op" id="6506145">!=</span>&nbsp;<span class="ident" id="6506148">nil</span>&nbsp;<span class="op" id="6506152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506157">t</span><span class="op" id="6506158">.</span><span class="ident" id="6506159">Fatalf</span><span class="op" id="6506165">(</span><span class="string" id="6506166">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="6506209">,</span>&nbsp;<span class="ident" id="6506211">keys</span><span class="op" id="6506215">[</span><span class="ident" id="6506216">i</span><span class="op" id="6506217">]</span><span class="op" id="6506218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6506222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6506225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6506229">//&nbsp;Touch&nbsp;entry&nbsp;2.&nbsp;LRU&nbsp;should&nbsp;evict&nbsp;3&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506273">cache</span><span class="op" id="6506278">.</span><span class="ident" id="6506279">Get</span><span class="op" id="6506282">(</span><span class="ident" id="6506283">keys</span><span class="op" id="6506287">[</span><span class="num" id="6506288">2</span><span class="op" id="6506289">]</span><span class="op" id="6506290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506293">cache</span><span class="op" id="6506298">.</span><span class="ident" id="6506299">Put</span><span class="op" id="6506302">(</span><span class="ident" id="6506303">keys</span><span class="op" id="6506307">[</span><span class="num" id="6506308">0</span><span class="op" id="6506309">]</span><span class="op" id="6506310">,</span>&nbsp;<span class="op" id="6506312">&amp;</span><span class="ident" id="6506313">cs</span><span class="op" id="6506315">[</span><span class="num" id="6506316">0</span><span class="op" id="6506317">]</span><span class="op" id="6506318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6506321">if</span>&nbsp;<span class="ident" id="6506324">s</span><span class="op" id="6506325">,</span>&nbsp;<span class="ident" id="6506327">ok</span>&nbsp;<span class="op" id="6506330">:=</span>&nbsp;<span class="ident" id="6506333">cache</span><span class="op" id="6506338">.</span><span class="ident" id="6506339">Get</span><span class="op" id="6506342">(</span><span class="ident" id="6506343">keys</span><span class="op" id="6506347">[</span><span class="num" id="6506348">3</span><span class="op" id="6506349">]</span><span class="op" id="6506350">)</span><span class="op" id="6506351">;</span>&nbsp;<span class="ident" id="6506353">ok</span>&nbsp;<span class="op" id="6506356">||</span>&nbsp;<span class="ident" id="6506359">s</span>&nbsp;<span class="op" id="6506361">!=</span>&nbsp;<span class="ident" id="6506364">nil</span>&nbsp;<span class="op" id="6506368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506372">t</span><span class="op" id="6506373">.</span><span class="ident" id="6506374">Fatalf</span><span class="op" id="6506380">(</span><span class="string" id="6506381">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key&nbsp;3&#34;</span><span class="op" id="6506422">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6506425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6506429">//&nbsp;Update&nbsp;entry&nbsp;0&nbsp;in&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506458">cache</span><span class="op" id="6506463">.</span><span class="ident" id="6506464">Put</span><span class="op" id="6506467">(</span><span class="ident" id="6506468">keys</span><span class="op" id="6506472">[</span><span class="num" id="6506473">0</span><span class="op" id="6506474">]</span><span class="op" id="6506475">,</span>&nbsp;<span class="op" id="6506477">&amp;</span><span class="ident" id="6506478">cs</span><span class="op" id="6506480">[</span><span class="num" id="6506481">3</span><span class="op" id="6506482">]</span><span class="op" id="6506483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6506486">if</span>&nbsp;<span class="ident" id="6506489">s</span><span class="op" id="6506490">,</span>&nbsp;<span class="ident" id="6506492">ok</span>&nbsp;<span class="op" id="6506495">:=</span>&nbsp;<span class="ident" id="6506498">cache</span><span class="op" id="6506503">.</span><span class="ident" id="6506504">Get</span><span class="op" id="6506507">(</span><span class="ident" id="6506508">keys</span><span class="op" id="6506512">[</span><span class="num" id="6506513">0</span><span class="op" id="6506514">]</span><span class="op" id="6506515">)</span><span class="op" id="6506516">;</span>&nbsp;<span class="op" id="6506518">!</span><span class="ident" id="6506519">ok</span>&nbsp;<span class="op" id="6506522">||</span>&nbsp;<span class="ident" id="6506525">s</span>&nbsp;<span class="op" id="6506527">!=</span>&nbsp;<span class="op" id="6506530">&amp;</span><span class="ident" id="6506531">cs</span><span class="op" id="6506533">[</span><span class="num" id="6506534">3</span><span class="op" id="6506535">]</span>&nbsp;<span class="op" id="6506537">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506541">t</span><span class="op" id="6506542">.</span><span class="ident" id="6506543">Fatalf</span><span class="op" id="6506549">(</span><span class="string" id="6506550">&#34;session&nbsp;cache&nbsp;failed&nbsp;update&nbsp;for&nbsp;key&nbsp;0&#34;</span><span class="op" id="6506589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6506592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6506596">//&nbsp;Adding&nbsp;a&nbsp;nil&nbsp;entry&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506629">cache</span><span class="op" id="6506634">.</span><span class="ident" id="6506635">Put</span><span class="op" id="6506638">(</span><span class="ident" id="6506639">keys</span><span class="op" id="6506643">[</span><span class="num" id="6506644">0</span><span class="op" id="6506645">]</span><span class="op" id="6506646">,</span>&nbsp;<span class="ident" id="6506648">nil</span><span class="op" id="6506651">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6506654">if</span>&nbsp;<span class="ident" id="6506657">s</span><span class="op" id="6506658">,</span>&nbsp;<span class="ident" id="6506660">ok</span>&nbsp;<span class="op" id="6506663">:=</span>&nbsp;<span class="ident" id="6506666">cache</span><span class="op" id="6506671">.</span><span class="ident" id="6506672">Get</span><span class="op" id="6506675">(</span><span class="ident" id="6506676">keys</span><span class="op" id="6506680">[</span><span class="num" id="6506681">0</span><span class="op" id="6506682">]</span><span class="op" id="6506683">)</span><span class="op" id="6506684">;</span>&nbsp;<span class="op" id="6506686">!</span><span class="ident" id="6506687">ok</span>&nbsp;<span class="op" id="6506690">||</span>&nbsp;<span class="ident" id="6506693">s</span>&nbsp;<span class="op" id="6506695">!=</span>&nbsp;<span class="ident" id="6506698">nil</span>&nbsp;<span class="op" id="6506702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506706">t</span><span class="op" id="6506707">.</span><span class="ident" id="6506708">Fatalf</span><span class="op" id="6506714">(</span><span class="string" id="6506715">&#34;failed&nbsp;to&nbsp;add&nbsp;nil&nbsp;entry&nbsp;to&nbsp;cache&#34;</span><span class="op" id="6506749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6506752">}</span><br>
<span class="lineno"></span><span class="op" id="6506754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="6506757">func</span>&nbsp;<span class="ident" id="6506762">TestHandshakeClientALPNMatch</span><span class="op" id="6506790">(</span><span class="ident" id="6506791">t</span>&nbsp;<span class="op" id="6506793">*</span><span class="ident" id="6506794">testing</span><span class="op" id="6506801">.</span><span class="ident" id="6506802">T</span><span class="op" id="6506803">)</span>&nbsp;<span class="op" id="6506805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506808">config</span>&nbsp;<span class="op" id="6506815">:=</span>&nbsp;<span class="op" id="6506818">*</span><span class="ident" id="6506819">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506831">config</span><span class="op" id="6506837">.</span><span class="ident" id="6506838">NextProtos</span>&nbsp;<span class="op" id="6506849">=</span>&nbsp;<span class="op" id="6506851">[</span><span class="op" id="6506852">]</span><span class="builtintype" id="6506853">string</span><span class="op" id="6506859">{</span><span class="string" id="6506860">&#34;proto2&#34;</span><span class="op" id="6506868">,</span>&nbsp;<span class="string" id="6506870">&#34;proto1&#34;</span><span class="op" id="6506878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506882">test</span>&nbsp;<span class="op" id="6506887">:=</span>&nbsp;<span class="op" id="6506890">&amp;</span><span class="ident" id="6506891">clientTest</span><span class="op" id="6506901">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6506905">name</span><span class="op" id="6506909">:</span>&nbsp;<span class="string" id="6506911">&#34;ALPN&#34;</span><span class="op" id="6506917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6506921">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6506987">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6507030">command</span><span class="op" id="6507037">:</span>&nbsp;<span class="op" id="6507039">[</span><span class="op" id="6507040">]</span><span class="builtintype" id="6507041">string</span><span class="op" id="6507047">{</span><span class="string" id="6507048">&#34;openssl&#34;</span><span class="op" id="6507057">,</span>&nbsp;<span class="string" id="6507059">&#34;s_server&#34;</span><span class="op" id="6507069">,</span>&nbsp;<span class="string" id="6507071">&#34;-alpn&#34;</span><span class="op" id="6507078">,</span>&nbsp;<span class="string" id="6507080">&#34;proto1,proto2&#34;</span><span class="op" id="6507095">}</span><span class="op" id="6507096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6507100">config</span><span class="op" id="6507106">:</span>&nbsp;&nbsp;<span class="op" id="6507109">&amp;</span><span class="ident" id="6507110">config</span><span class="op" id="6507116">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6507120">validate</span><span class="op" id="6507128">:</span>&nbsp;<span class="keyword" id="6507130">func</span><span class="op" id="6507134">(</span><span class="ident" id="6507135">state</span>&nbsp;<span class="ident" id="6507141">ConnectionState</span><span class="op" id="6507156">)</span>&nbsp;<span class="builtintype" id="6507158">error</span>&nbsp;<span class="op" id="6507164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6507169">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6507228">if</span>&nbsp;<span class="ident" id="6507231">state</span><span class="op" id="6507236">.</span><span class="ident" id="6507237">NegotiatedProtocol</span>&nbsp;<span class="op" id="6507256">!=</span>&nbsp;<span class="string" id="6507259">&#34;proto1&#34;</span>&nbsp;<span class="op" id="6507268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6507274">return</span>&nbsp;<span class="ident" id="6507281">fmt</span><span class="op" id="6507284">.</span><span class="ident" id="6507285">Errorf</span><span class="op" id="6507291">(</span><span class="string" id="6507292">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="6507324">,</span>&nbsp;<span class="ident" id="6507326">state</span><span class="op" id="6507331">.</span><span class="ident" id="6507332">NegotiatedProtocol</span><span class="op" id="6507350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6507355">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6507360">return</span>&nbsp;<span class="ident" id="6507367">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6507373">}</span><span class="op" id="6507374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6507377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6507380">runClientTestTLS12</span><span class="op" id="6507398">(</span><span class="ident" id="6507399">t</span><span class="op" id="6507400">,</span>&nbsp;<span class="ident" id="6507402">test</span><span class="op" id="6507406">)</span><br>
<span class="lineno"></span><span class="op" id="6507408">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="6507411">func</span>&nbsp;<span class="ident" id="6507416">TestHandshakeClientALPNNoMatch</span><span class="op" id="6507446">(</span><span class="ident" id="6507447">t</span>&nbsp;<span class="op" id="6507449">*</span><span class="ident" id="6507450">testing</span><span class="op" id="6507457">.</span><span class="ident" id="6507458">T</span><span class="op" id="6507459">)</span>&nbsp;<span class="op" id="6507461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6507464">config</span>&nbsp;<span class="op" id="6507471">:=</span>&nbsp;<span class="op" id="6507474">*</span><span class="ident" id="6507475">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6507487">config</span><span class="op" id="6507493">.</span><span class="ident" id="6507494">NextProtos</span>&nbsp;<span class="op" id="6507505">=</span>&nbsp;<span class="op" id="6507507">[</span><span class="op" id="6507508">]</span><span class="builtintype" id="6507509">string</span><span class="op" id="6507515">{</span><span class="string" id="6507516">&#34;proto3&#34;</span><span class="op" id="6507524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6507528">test</span>&nbsp;<span class="op" id="6507533">:=</span>&nbsp;<span class="op" id="6507536">&amp;</span><span class="ident" id="6507537">clientTest</span><span class="op" id="6507547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6507551">name</span><span class="op" id="6507555">:</span>&nbsp;<span class="string" id="6507557">&#34;ALPN-NoMatch&#34;</span><span class="op" id="6507571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6507575">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6507641">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6507684">command</span><span class="op" id="6507691">:</span>&nbsp;<span class="op" id="6507693">[</span><span class="op" id="6507694">]</span><span class="builtintype" id="6507695">string</span><span class="op" id="6507701">{</span><span class="string" id="6507702">&#34;openssl&#34;</span><span class="op" id="6507711">,</span>&nbsp;<span class="string" id="6507713">&#34;s_server&#34;</span><span class="op" id="6507723">,</span>&nbsp;<span class="string" id="6507725">&#34;-alpn&#34;</span><span class="op" id="6507732">,</span>&nbsp;<span class="string" id="6507734">&#34;proto1,proto2&#34;</span><span class="op" id="6507749">}</span><span class="op" id="6507750">,</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6507754">config</span><span class="op" id="6507760">:</span>&nbsp;&nbsp;<span class="op" id="6507763">&amp;</span><span class="ident" id="6507764">config</span><span class="op" id="6507770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6507774">validate</span><span class="op" id="6507782">:</span>&nbsp;<span class="keyword" id="6507784">func</span><span class="op" id="6507788">(</span><span class="ident" id="6507789">state</span>&nbsp;<span class="ident" id="6507795">ConnectionState</span><span class="op" id="6507810">)</span>&nbsp;<span class="builtintype" id="6507812">error</span>&nbsp;<span class="op" id="6507818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6507823">//&nbsp;There&#39;s&nbsp;no&nbsp;overlap&nbsp;so&nbsp;OpenSSL&nbsp;will&nbsp;not&nbsp;select&nbsp;a&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6507887">if</span>&nbsp;<span class="ident" id="6507890">state</span><span class="op" id="6507895">.</span><span class="ident" id="6507896">NegotiatedProtocol</span>&nbsp;<span class="op" id="6507915">!=</span>&nbsp;<span class="string" id="6507918">&#34;&#34;</span>&nbsp;<span class="op" id="6507921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6507927">return</span>&nbsp;<span class="ident" id="6507934">fmt</span><span class="op" id="6507937">.</span><span class="ident" id="6507938">Errorf</span><span class="op" id="6507944">(</span><span class="string" id="6507945">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="6507973">,</span>&nbsp;<span class="ident" id="6507975">state</span><span class="op" id="6507980">.</span><span class="ident" id="6507981">NegotiatedProtocol</span><span class="op" id="6507999">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6508004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6508009">return</span>&nbsp;<span class="ident" id="6508016">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6508022">}</span><span class="op" id="6508023">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6508026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6508029">runClientTestTLS12</span><span class="op" id="6508047">(</span><span class="ident" id="6508048">t</span><span class="op" id="6508049">,</span>&nbsp;<span class="ident" id="6508051">test</span><span class="op" id="6508055">)</span><br>
<span class="lineno">490</span><span class="op" id="6508057">}</span>
</div>
</body>
</html>
