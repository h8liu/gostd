<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1644532">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1644587">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1644641">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1644692">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1644757">//&nbsp;Fork,&nbsp;exec,&nbsp;wait,&nbsp;etc.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1644784">package</span>&nbsp;<span class="ident" id="1644792">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1644801">import</span>&nbsp;<span class="op" id="1644808">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1644811">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1644822">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1644830">&#34;unsafe&#34;</span><br>
<span class="lineno">15</span><span class="op" id="1644839">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1644842">//&nbsp;Lock&nbsp;synchronizing&nbsp;creation&nbsp;of&nbsp;new&nbsp;file&nbsp;descriptors&nbsp;with&nbsp;fork.</span><br>
<span class="lineno"></span><span class="comment" id="1644908">//</span><br>
<span class="lineno"></span><span class="comment" id="1644911">//&nbsp;We&nbsp;want&nbsp;the&nbsp;child&nbsp;in&nbsp;a&nbsp;fork/exec&nbsp;sequence&nbsp;to&nbsp;inherit&nbsp;only&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="1644976">//&nbsp;file&nbsp;descriptors&nbsp;we&nbsp;intend.&nbsp;&nbsp;To&nbsp;do&nbsp;that,&nbsp;we&nbsp;mark&nbsp;all&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="1645037">//&nbsp;descriptors&nbsp;close-on-exec&nbsp;and&nbsp;then,&nbsp;in&nbsp;the&nbsp;child,&nbsp;explicitly</span><br>
<span class="lineno"></span><span class="comment" id="1645101">//&nbsp;unmark&nbsp;the&nbsp;ones&nbsp;we&nbsp;want&nbsp;the&nbsp;exec&#39;ed&nbsp;program&nbsp;to&nbsp;keep.</span><br>
<span class="lineno"></span><span class="comment" id="1645157">//&nbsp;Unix&nbsp;doesn&#39;t&nbsp;make&nbsp;this&nbsp;easy:&nbsp;there&nbsp;is,&nbsp;in&nbsp;general,&nbsp;no&nbsp;way&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1645221">//&nbsp;allocate&nbsp;a&nbsp;new&nbsp;file&nbsp;descriptor&nbsp;close-on-exec.&nbsp;&nbsp;Instead&nbsp;you</span><br>
<span class="lineno">25</span><span class="comment" id="1645283">//&nbsp;have&nbsp;to&nbsp;allocate&nbsp;the&nbsp;descriptor&nbsp;and&nbsp;then&nbsp;mark&nbsp;it&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="comment" id="1645350">//&nbsp;If&nbsp;a&nbsp;fork&nbsp;happens&nbsp;between&nbsp;those&nbsp;two&nbsp;events,&nbsp;the&nbsp;child&#39;s&nbsp;exec</span><br>
<span class="lineno"></span><span class="comment" id="1645414">//&nbsp;will&nbsp;inherit&nbsp;an&nbsp;unwanted&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="comment" id="1645459">//</span><br>
<span class="lineno"></span><span class="comment" id="1645462">//&nbsp;This&nbsp;lock&nbsp;solves&nbsp;that&nbsp;race:&nbsp;the&nbsp;create&nbsp;new&nbsp;fd/mark&nbsp;close-on-exec</span><br>
<span class="lineno">30</span><span class="comment" id="1645530">//&nbsp;operation&nbsp;is&nbsp;done&nbsp;holding&nbsp;ForkLock&nbsp;for&nbsp;reading,&nbsp;and&nbsp;the&nbsp;fork&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="1645601">//&nbsp;is&nbsp;done&nbsp;holding&nbsp;ForkLock&nbsp;for&nbsp;writing.&nbsp;&nbsp;At&nbsp;least,&nbsp;that&#39;s&nbsp;the&nbsp;idea.</span><br>
<span class="lineno"></span><span class="comment" id="1645670">//&nbsp;There&nbsp;are&nbsp;some&nbsp;complications.</span><br>
<span class="lineno"></span><span class="comment" id="1645703">//</span><br>
<span class="lineno"></span><span class="comment" id="1645706">//&nbsp;Some&nbsp;system&nbsp;calls&nbsp;that&nbsp;create&nbsp;new&nbsp;file&nbsp;descriptors&nbsp;can&nbsp;block</span><br>
<span class="lineno">35</span><span class="comment" id="1645770">//&nbsp;for&nbsp;arbitrarily&nbsp;long&nbsp;times:&nbsp;open&nbsp;on&nbsp;a&nbsp;hung&nbsp;NFS&nbsp;server&nbsp;or&nbsp;named</span><br>
<span class="lineno"></span><span class="comment" id="1645836">//&nbsp;pipe,&nbsp;accept&nbsp;on&nbsp;a&nbsp;socket,&nbsp;and&nbsp;so&nbsp;on.&nbsp;&nbsp;We&nbsp;can&#39;t&nbsp;reasonably&nbsp;grab</span><br>
<span class="lineno"></span><span class="comment" id="1645902">//&nbsp;the&nbsp;lock&nbsp;across&nbsp;those&nbsp;operations.</span><br>
<span class="lineno"></span><span class="comment" id="1645939">//</span><br>
<span class="lineno"></span><span class="comment" id="1645942">//&nbsp;It&nbsp;is&nbsp;worse&nbsp;to&nbsp;inherit&nbsp;some&nbsp;file&nbsp;descriptors&nbsp;than&nbsp;others.</span><br>
<span class="lineno">40</span><span class="comment" id="1646003">//&nbsp;If&nbsp;a&nbsp;non-malicious&nbsp;child&nbsp;accidentally&nbsp;inherits&nbsp;an&nbsp;open&nbsp;ordinary&nbsp;file,</span><br>
<span class="lineno"></span><span class="comment" id="1646076">//&nbsp;that&#39;s&nbsp;not&nbsp;a&nbsp;big&nbsp;deal.&nbsp;&nbsp;On&nbsp;the&nbsp;other&nbsp;hand,&nbsp;if&nbsp;a&nbsp;long-lived&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="1646144">//&nbsp;accidentally&nbsp;inherits&nbsp;the&nbsp;write&nbsp;end&nbsp;of&nbsp;a&nbsp;pipe,&nbsp;then&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="1646210">//&nbsp;of&nbsp;that&nbsp;pipe&nbsp;will&nbsp;not&nbsp;see&nbsp;EOF&nbsp;until&nbsp;that&nbsp;child&nbsp;exits,&nbsp;potentially</span><br>
<span class="lineno"></span><span class="comment" id="1646279">//&nbsp;causing&nbsp;the&nbsp;parent&nbsp;program&nbsp;to&nbsp;hang.&nbsp;&nbsp;This&nbsp;is&nbsp;a&nbsp;common&nbsp;problem</span><br>
<span class="lineno">45</span><span class="comment" id="1646344">//&nbsp;in&nbsp;threaded&nbsp;C&nbsp;programs&nbsp;that&nbsp;use&nbsp;popen.</span><br>
<span class="lineno"></span><span class="comment" id="1646386">//</span><br>
<span class="lineno"></span><span class="comment" id="1646389">//&nbsp;Luckily,&nbsp;the&nbsp;file&nbsp;descriptors&nbsp;that&nbsp;are&nbsp;most&nbsp;important&nbsp;not&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1646453">//&nbsp;inherit&nbsp;are&nbsp;not&nbsp;the&nbsp;ones&nbsp;that&nbsp;can&nbsp;take&nbsp;an&nbsp;arbitrarily&nbsp;long&nbsp;time</span><br>
<span class="lineno"></span><span class="comment" id="1646520">//&nbsp;to&nbsp;create:&nbsp;pipe&nbsp;returns&nbsp;instantly,&nbsp;and&nbsp;the&nbsp;net&nbsp;package&nbsp;uses</span><br>
<span class="lineno">50</span><span class="comment" id="1646583">//&nbsp;non-blocking&nbsp;I/O&nbsp;to&nbsp;accept&nbsp;on&nbsp;a&nbsp;listening&nbsp;socket.</span><br>
<span class="lineno"></span><span class="comment" id="1646636">//&nbsp;The&nbsp;rules&nbsp;for&nbsp;which&nbsp;file&nbsp;descriptor-creating&nbsp;operations&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1646703">//&nbsp;ForkLock&nbsp;are&nbsp;as&nbsp;follows:</span><br>
<span class="lineno"></span><span class="comment" id="1646731">//</span><br>
<span class="lineno"></span><span class="comment" id="1646734">//&nbsp;1)&nbsp;Pipe.&nbsp;&nbsp;&nbsp;&nbsp;Does&nbsp;not&nbsp;block.&nbsp;&nbsp;Use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno">55</span><span class="comment" id="1646784">//&nbsp;2)&nbsp;Socket.&nbsp;&nbsp;Does&nbsp;not&nbsp;block.&nbsp;&nbsp;Use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno"></span><span class="comment" id="1646834">//&nbsp;3)&nbsp;Accept.&nbsp;&nbsp;If&nbsp;using&nbsp;non-blocking&nbsp;mode,&nbsp;use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno"></span><span class="comment" id="1646895">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Otherwise,&nbsp;live&nbsp;with&nbsp;the&nbsp;race.</span><br>
<span class="lineno"></span><span class="comment" id="1646941">//&nbsp;4)&nbsp;Open.&nbsp;&nbsp;&nbsp;&nbsp;Can&nbsp;block.&nbsp;&nbsp;Use&nbsp;O_CLOEXEC&nbsp;if&nbsp;available&nbsp;(Linux).</span><br>
<span class="lineno"></span><span class="comment" id="1647004">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Otherwise,&nbsp;live&nbsp;with&nbsp;the&nbsp;race.</span><br>
<span class="lineno">60</span><span class="comment" id="1647050">//&nbsp;5)&nbsp;Dup.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Does&nbsp;not&nbsp;block.&nbsp;&nbsp;Use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno"></span><span class="comment" id="1647100">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;Linux,&nbsp;could&nbsp;use&nbsp;fcntl&nbsp;F_DUPFD_CLOEXEC</span><br>
<span class="lineno"></span><span class="comment" id="1647157">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instead&nbsp;of&nbsp;the&nbsp;ForkLock,&nbsp;but&nbsp;only&nbsp;for&nbsp;dup(fd,&nbsp;-1).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1647224">var</span>&nbsp;<span class="ident" id="1647228">ForkLock</span>&nbsp;<span class="ident" id="1647237"><a href="/syscall/exec_unix.go.html#1644822">sync</a></span><span class="op" id="1647241">.</span><span class="ident" id="1647242">RWMutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="1647251">//&nbsp;StringSlicePtr&nbsp;is&nbsp;deprecated.&nbsp;Use&nbsp;SlicePtrFromStrings&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="1647317">//&nbsp;If&nbsp;any&nbsp;string&nbsp;contains&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;this&nbsp;function&nbsp;panics&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="1647383">//&nbsp;of&nbsp;returning&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="1647409">func</span>&nbsp;<span class="ident" id="1647414">StringSlicePtr</span><span class="op" id="1647428">(</span><span class="ident" id="1647429">ss</span>&nbsp;<span class="op" id="1647432">[</span><span class="op" id="1647433">]</span><span class="builtintype" id="1647434">string</span><span class="op" id="1647440">)</span>&nbsp;<span class="op" id="1647442">[</span><span class="op" id="1647443">]</span><span class="op" id="1647444">*</span><span class="builtintype" id="1647445">byte</span>&nbsp;<span class="op" id="1647450">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647453">bb</span>&nbsp;<span class="op" id="1647456">:=</span>&nbsp;<span class="builtinfunc" id="1647459">make</span><span class="op" id="1647463">(</span><span class="op" id="1647464">[</span><span class="op" id="1647465">]</span><span class="op" id="1647466">*</span><span class="builtintype" id="1647467">byte</span><span class="op" id="1647471">,</span>&nbsp;<span class="builtinfunc" id="1647473">len</span><span class="op" id="1647476">(</span><span class="ident" id="1647477"><a href="/syscall/exec_unix.go.html#1647429">ss</a></span><span class="op" id="1647479">)</span><span class="op" id="1647480">+</span><span class="num" id="1647481">1</span><span class="op" id="1647482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647485">for</span>&nbsp;<span class="ident" id="1647489">i</span>&nbsp;<span class="op" id="1647491">:=</span>&nbsp;<span class="num" id="1647494">0</span><span class="op" id="1647495">;</span>&nbsp;<span class="ident" id="1647497"><a href="/syscall/exec_unix.go.html#1647489">i</a></span>&nbsp;<span class="op" id="1647499">&lt;</span>&nbsp;<span class="builtinfunc" id="1647501">len</span><span class="op" id="1647504">(</span><span class="ident" id="1647505"><a href="/syscall/exec_unix.go.html#1647429">ss</a></span><span class="op" id="1647507">)</span><span class="op" id="1647508">;</span>&nbsp;<span class="ident" id="1647510"><a href="/syscall/exec_unix.go.html#1647489">i</a></span><span class="op" id="1647511">++</span>&nbsp;<span class="op" id="1647514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647518"><a href="/syscall/exec_unix.go.html#1647453">bb</a></span><span class="op" id="1647520">[</span><span class="ident" id="1647521"><a href="/syscall/exec_unix.go.html#1647489">i</a></span><span class="op" id="1647522">]</span>&nbsp;<span class="op" id="1647524">=</span>&nbsp;<span class="ident" id="1647526"><a href="/syscall/syscall.go.html#1666362">StringBytePtr</a></span><span class="op" id="1647539">(</span><span class="ident" id="1647540"><a href="/syscall/exec_unix.go.html#1647429">ss</a></span><span class="op" id="1647542">[</span><span class="ident" id="1647543"><a href="/syscall/exec_unix.go.html#1647489">i</a></span><span class="op" id="1647544">]</span><span class="op" id="1647545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1647548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647551"><a href="/syscall/exec_unix.go.html#1647453">bb</a></span><span class="op" id="1647553">[</span><span class="builtinfunc" id="1647554">len</span><span class="op" id="1647557">(</span><span class="ident" id="1647558"><a href="/syscall/exec_unix.go.html#1647429">ss</a></span><span class="op" id="1647560">)</span><span class="op" id="1647561">]</span>&nbsp;<span class="op" id="1647563">=</span>&nbsp;<span class="ident" id="1647565">nil</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647570">return</span>&nbsp;<span class="ident" id="1647577"><a href="/syscall/exec_unix.go.html#1647453">bb</a></span><br>
<span class="lineno"></span><span class="op" id="1647580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1647583">//&nbsp;SlicePtrFromStrings&nbsp;converts&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;to&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1647648">//&nbsp;pointers&nbsp;to&nbsp;NUL-terminated&nbsp;byte&nbsp;slices.&nbsp;If&nbsp;any&nbsp;string&nbsp;contains</span><br>
<span class="lineno">80</span><span class="comment" id="1647714">//&nbsp;a&nbsp;NUL&nbsp;byte,&nbsp;it&nbsp;returns&nbsp;(nil,&nbsp;EINVAL).</span><br>
<span class="lineno"></span><span class="keyword" id="1647755">func</span>&nbsp;<span class="ident" id="1647760">SlicePtrFromStrings</span><span class="op" id="1647779">(</span><span class="ident" id="1647780">ss</span>&nbsp;<span class="op" id="1647783">[</span><span class="op" id="1647784">]</span><span class="builtintype" id="1647785">string</span><span class="op" id="1647791">)</span>&nbsp;<span class="op" id="1647793">(</span><span class="op" id="1647794">[</span><span class="op" id="1647795">]</span><span class="op" id="1647796">*</span><span class="builtintype" id="1647797">byte</span><span class="op" id="1647801">,</span>&nbsp;<span class="builtintype" id="1647803">error</span><span class="op" id="1647808">)</span>&nbsp;<span class="op" id="1647810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647813">var</span>&nbsp;<span class="ident" id="1647817">err</span>&nbsp;<span class="builtintype" id="1647821">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647828">bb</span>&nbsp;<span class="op" id="1647831">:=</span>&nbsp;<span class="builtinfunc" id="1647834">make</span><span class="op" id="1647838">(</span><span class="op" id="1647839">[</span><span class="op" id="1647840">]</span><span class="op" id="1647841">*</span><span class="builtintype" id="1647842">byte</span><span class="op" id="1647846">,</span>&nbsp;<span class="builtinfunc" id="1647848">len</span><span class="op" id="1647851">(</span><span class="ident" id="1647852"><a href="/syscall/exec_unix.go.html#1647780">ss</a></span><span class="op" id="1647854">)</span><span class="op" id="1647855">+</span><span class="num" id="1647856">1</span><span class="op" id="1647857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647860">for</span>&nbsp;<span class="ident" id="1647864">i</span>&nbsp;<span class="op" id="1647866">:=</span>&nbsp;<span class="num" id="1647869">0</span><span class="op" id="1647870">;</span>&nbsp;<span class="ident" id="1647872"><a href="/syscall/exec_unix.go.html#1647864">i</a></span>&nbsp;<span class="op" id="1647874">&lt;</span>&nbsp;<span class="builtinfunc" id="1647876">len</span><span class="op" id="1647879">(</span><span class="ident" id="1647880"><a href="/syscall/exec_unix.go.html#1647780">ss</a></span><span class="op" id="1647882">)</span><span class="op" id="1647883">;</span>&nbsp;<span class="ident" id="1647885"><a href="/syscall/exec_unix.go.html#1647864">i</a></span><span class="op" id="1647886">++</span>&nbsp;<span class="op" id="1647889">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647893"><a href="/syscall/exec_unix.go.html#1647828">bb</a></span><span class="op" id="1647895">[</span><span class="ident" id="1647896"><a href="/syscall/exec_unix.go.html#1647864">i</a></span><span class="op" id="1647897">]</span><span class="op" id="1647898">,</span>&nbsp;<span class="ident" id="1647900"><a href="/syscall/exec_unix.go.html#1647817">err</a></span>&nbsp;<span class="op" id="1647904">=</span>&nbsp;<span class="ident" id="1647906"><a href="/syscall/syscall.go.html#1666606">BytePtrFromString</a></span><span class="op" id="1647923">(</span><span class="ident" id="1647924"><a href="/syscall/exec_unix.go.html#1647780">ss</a></span><span class="op" id="1647926">[</span><span class="ident" id="1647927"><a href="/syscall/exec_unix.go.html#1647864">i</a></span><span class="op" id="1647928">]</span><span class="op" id="1647929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647933">if</span>&nbsp;<span class="ident" id="1647936"><a href="/syscall/exec_unix.go.html#1647817">err</a></span>&nbsp;<span class="op" id="1647940">!=</span>&nbsp;<span class="ident" id="1647943">nil</span>&nbsp;<span class="op" id="1647947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647952">return</span>&nbsp;<span class="ident" id="1647959">nil</span><span class="op" id="1647962">,</span>&nbsp;<span class="ident" id="1647964"><a href="/syscall/exec_unix.go.html#1647817">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1647970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1647973">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1647976"><a href="/syscall/exec_unix.go.html#1647828">bb</a></span><span class="op" id="1647978">[</span><span class="builtinfunc" id="1647979">len</span><span class="op" id="1647982">(</span><span class="ident" id="1647983"><a href="/syscall/exec_unix.go.html#1647780">ss</a></span><span class="op" id="1647985">)</span><span class="op" id="1647986">]</span>&nbsp;<span class="op" id="1647988">=</span>&nbsp;<span class="ident" id="1647990">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1647995">return</span>&nbsp;<span class="ident" id="1648002"><a href="/syscall/exec_unix.go.html#1647828">bb</a></span><span class="op" id="1648004">,</span>&nbsp;<span class="ident" id="1648006">nil</span><br>
<span class="lineno"></span><span class="op" id="1648010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1648013">func</span>&nbsp;<span class="ident" id="1648018">CloseOnExec</span><span class="op" id="1648029">(</span><span class="ident" id="1648030">fd</span>&nbsp;<span class="builtintype" id="1648033">int</span><span class="op" id="1648036">)</span>&nbsp;<span class="op" id="1648038">{</span>&nbsp;<span class="ident" id="1648040"><a href="/syscall/zsyscall_linux_amd64.go.html#1776566">fcntl</a></span><span class="op" id="1648045">(</span><span class="ident" id="1648046"><a href="/syscall/exec_unix.go.html#1648030">fd</a></span><span class="op" id="1648048">,</span>&nbsp;<span class="ident" id="1648050"><a href="/syscall/zerrors_linux_amd64.go.html#1717234">F_SETFD</a></span><span class="op" id="1648057">,</span>&nbsp;<span class="ident" id="1648059"><a href="/syscall/zerrors_linux_amd64.go.html#1716503">FD_CLOEXEC</a></span><span class="op" id="1648069">)</span>&nbsp;<span class="op" id="1648071">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="1648074">func</span>&nbsp;<span class="ident" id="1648079">SetNonblock</span><span class="op" id="1648090">(</span><span class="ident" id="1648091">fd</span>&nbsp;<span class="builtintype" id="1648094">int</span><span class="op" id="1648097">,</span>&nbsp;<span class="ident" id="1648099">nonblocking</span>&nbsp;<span class="builtintype" id="1648111">bool</span><span class="op" id="1648115">)</span>&nbsp;<span class="op" id="1648117">(</span><span class="ident" id="1648118">err</span>&nbsp;<span class="builtintype" id="1648122">error</span><span class="op" id="1648127">)</span>&nbsp;<span class="op" id="1648129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648132">flag</span><span class="op" id="1648136">,</span>&nbsp;<span class="ident" id="1648138"><a href="/syscall/exec_unix.go.html#1648118">err</a></span>&nbsp;<span class="op" id="1648142">:=</span>&nbsp;<span class="ident" id="1648145"><a href="/syscall/zsyscall_linux_amd64.go.html#1776566">fcntl</a></span><span class="op" id="1648150">(</span><span class="ident" id="1648151"><a href="/syscall/exec_unix.go.html#1648091">fd</a></span><span class="op" id="1648153">,</span>&nbsp;<span class="ident" id="1648155"><a href="/syscall/zerrors_linux_amd64.go.html#1716747">F_GETFL</a></span><span class="op" id="1648162">,</span>&nbsp;<span class="num" id="1648164">0</span><span class="op" id="1648165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1648168">if</span>&nbsp;<span class="ident" id="1648171"><a href="/syscall/exec_unix.go.html#1648118">err</a></span>&nbsp;<span class="op" id="1648175">!=</span>&nbsp;<span class="ident" id="1648178">nil</span>&nbsp;<span class="op" id="1648182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1648186">return</span>&nbsp;<span class="ident" id="1648193"><a href="/syscall/exec_unix.go.html#1648118">err</a></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1648198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1648201">if</span>&nbsp;<span class="ident" id="1648204"><a href="/syscall/exec_unix.go.html#1648099">nonblocking</a></span>&nbsp;<span class="op" id="1648216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648220"><a href="/syscall/exec_unix.go.html#1648132">flag</a></span>&nbsp;<span class="op" id="1648225">|=</span>&nbsp;<span class="ident" id="1648228"><a href="/syscall/zerrors_linux_amd64.go.html#1732854">O_NONBLOCK</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1648240">}</span>&nbsp;<span class="keyword" id="1648242">else</span>&nbsp;<span class="op" id="1648247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648251"><a href="/syscall/exec_unix.go.html#1648132">flag</a></span>&nbsp;<span class="op" id="1648256">&amp;=</span>&nbsp;<span class="op" id="1648259">^</span><span class="ident" id="1648260"><a href="/syscall/zerrors_linux_amd64.go.html#1732854">O_NONBLOCK</a></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1648272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648275">_</span><span class="op" id="1648276">,</span>&nbsp;<span class="ident" id="1648278"><a href="/syscall/exec_unix.go.html#1648118">err</a></span>&nbsp;<span class="op" id="1648282">=</span>&nbsp;<span class="ident" id="1648284"><a href="/syscall/zsyscall_linux_amd64.go.html#1776566">fcntl</a></span><span class="op" id="1648289">(</span><span class="ident" id="1648290"><a href="/syscall/exec_unix.go.html#1648091">fd</a></span><span class="op" id="1648292">,</span>&nbsp;<span class="ident" id="1648294"><a href="/syscall/zerrors_linux_amd64.go.html#1717274">F_SETFL</a></span><span class="op" id="1648301">,</span>&nbsp;<span class="ident" id="1648303"><a href="/syscall/exec_unix.go.html#1648132">flag</a></span><span class="op" id="1648307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1648310">return</span>&nbsp;<span class="ident" id="1648317"><a href="/syscall/exec_unix.go.html#1648118">err</a></span><br>
<span class="lineno"></span><span class="op" id="1648321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1648324">//&nbsp;Credential&nbsp;holds&nbsp;user&nbsp;and&nbsp;group&nbsp;identities&nbsp;to&nbsp;be&nbsp;assumed</span><br>
<span class="lineno"></span><span class="comment" id="1648384">//&nbsp;by&nbsp;a&nbsp;child&nbsp;process&nbsp;started&nbsp;by&nbsp;StartProcess.</span><br>
<span class="lineno"></span><span class="keyword" id="1648431">type</span>&nbsp;<span class="ident" id="1648436">Credential</span>&nbsp;<span class="keyword" id="1648447">struct</span>&nbsp;<span class="op" id="1648454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648457">Uid</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1648464">uint32</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1648473">//&nbsp;User&nbsp;ID.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648486">Gid</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1648493">uint32</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1648502">//&nbsp;Group&nbsp;ID.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648516">Groups</span>&nbsp;<span class="op" id="1648523">[</span><span class="op" id="1648524">]</span><span class="builtintype" id="1648525">uint32</span>&nbsp;<span class="comment" id="1648532">//&nbsp;Supplementary&nbsp;group&nbsp;IDs.</span><br>
<span class="lineno"></span><span class="op" id="1648560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1648563">//&nbsp;ProcAttr&nbsp;holds&nbsp;attributes&nbsp;that&nbsp;will&nbsp;be&nbsp;applied&nbsp;to&nbsp;a&nbsp;new&nbsp;process&nbsp;started</span><br>
<span class="lineno"></span><span class="comment" id="1648638">//&nbsp;by&nbsp;StartProcess.</span><br>
<span class="lineno">120</span><span class="keyword" id="1648658">type</span>&nbsp;<span class="ident" id="1648663">ProcAttr</span>&nbsp;<span class="keyword" id="1648672">struct</span>&nbsp;<span class="op" id="1648679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648682">Dir</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1648688">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1648698">//&nbsp;Current&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648729">Env</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1648735">[</span><span class="op" id="1648736">]</span><span class="builtintype" id="1648737">string</span>&nbsp;&nbsp;<span class="comment" id="1648745">//&nbsp;Environment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648762">Files</span>&nbsp;<span class="op" id="1648768">[</span><span class="op" id="1648769">]</span><span class="builtintype" id="1648770">uintptr</span>&nbsp;<span class="comment" id="1648778">//&nbsp;File&nbsp;descriptors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1648800">Sys</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1648806">*</span><span class="ident" id="1648807"><a href="/syscall/exec_linux.go.html#1635392">SysProcAttr</a></span><br>
<span class="lineno">125</span><span class="op" id="1648819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1648822">var</span>&nbsp;<span class="ident" id="1648826">zeroProcAttr</span>&nbsp;<span class="ident" id="1648839"><a href="/syscall/exec_unix.go.html#1648663">ProcAttr</a></span><br>
<span class="lineno"></span><span class="keyword" id="1648848">var</span>&nbsp;<span class="ident" id="1648852">zeroSysProcAttr</span>&nbsp;<span class="ident" id="1648868"><a href="/syscall/exec_linux.go.html#1635392">SysProcAttr</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="1648881">func</span>&nbsp;<span class="ident" id="1648886">forkExec</span><span class="op" id="1648894">(</span><span class="ident" id="1648895">argv0</span>&nbsp;<span class="builtintype" id="1648901">string</span><span class="op" id="1648907">,</span>&nbsp;<span class="ident" id="1648909">argv</span>&nbsp;<span class="op" id="1648914">[</span><span class="op" id="1648915">]</span><span class="builtintype" id="1648916">string</span><span class="op" id="1648922">,</span>&nbsp;<span class="ident" id="1648924">attr</span>&nbsp;<span class="op" id="1648929">*</span><span class="ident" id="1648930"><a href="/syscall/exec_unix.go.html#1648663">ProcAttr</a></span><span class="op" id="1648938">)</span>&nbsp;<span class="op" id="1648940">(</span><span class="ident" id="1648941">pid</span>&nbsp;<span class="builtintype" id="1648945">int</span><span class="op" id="1648948">,</span>&nbsp;<span class="ident" id="1648950">err</span>&nbsp;<span class="builtintype" id="1648954">error</span><span class="op" id="1648959">)</span>&nbsp;<span class="op" id="1648961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1648964">var</span>&nbsp;<span class="ident" id="1648968">p</span>&nbsp;<span class="op" id="1648970">[</span><span class="num" id="1648971">2</span><span class="op" id="1648972">]</span><span class="builtintype" id="1648973">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1648978">var</span>&nbsp;<span class="ident" id="1648982">n</span>&nbsp;<span class="builtintype" id="1648984">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1648989">var</span>&nbsp;<span class="ident" id="1648993">err1</span>&nbsp;<span class="ident" id="1648998"><a href="/syscall/syscall_unix.go.html#1701140">Errno</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649005">var</span>&nbsp;<span class="ident" id="1649009">wstatus</span>&nbsp;<span class="ident" id="1649017"><a href="/syscall/syscall_linux.go.html#1671051">WaitStatus</a></span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649030">if</span>&nbsp;<span class="ident" id="1649033"><a href="/syscall/exec_unix.go.html#1648924">attr</a></span>&nbsp;<span class="op" id="1649038">==</span>&nbsp;<span class="ident" id="1649041">nil</span>&nbsp;<span class="op" id="1649045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649049"><a href="/syscall/exec_unix.go.html#1648924">attr</a></span>&nbsp;<span class="op" id="1649054">=</span>&nbsp;<span class="op" id="1649056">&amp;</span><span class="ident" id="1649057"><a href="/syscall/exec_unix.go.html#1648826">zeroProcAttr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649074">sys</span>&nbsp;<span class="op" id="1649078">:=</span>&nbsp;<span class="ident" id="1649081"><a href="/syscall/exec_unix.go.html#1648924">attr</a></span><span class="op" id="1649085">.</span><span class="ident" id="1649086">Sys</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649091">if</span>&nbsp;<span class="ident" id="1649094"><a href="/syscall/exec_unix.go.html#1649074">sys</a></span>&nbsp;<span class="op" id="1649098">==</span>&nbsp;<span class="ident" id="1649101">nil</span>&nbsp;<span class="op" id="1649105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649109"><a href="/syscall/exec_unix.go.html#1649074">sys</a></span>&nbsp;<span class="op" id="1649113">=</span>&nbsp;<span class="op" id="1649115">&amp;</span><span class="ident" id="1649116"><a href="/syscall/exec_unix.go.html#1648852">zeroSysProcAttr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649137"><a href="/syscall/exec_unix.go.html#1648968">p</a></span><span class="op" id="1649138">[</span><span class="num" id="1649139">0</span><span class="op" id="1649140">]</span>&nbsp;<span class="op" id="1649142">=</span>&nbsp;<span class="op" id="1649144">-</span><span class="num" id="1649145">1</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649148"><a href="/syscall/exec_unix.go.html#1648968">p</a></span><span class="op" id="1649149">[</span><span class="num" id="1649150">1</span><span class="op" id="1649151">]</span>&nbsp;<span class="op" id="1649153">=</span>&nbsp;<span class="op" id="1649155">-</span><span class="num" id="1649156">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1649160">//&nbsp;Convert&nbsp;args&nbsp;to&nbsp;C&nbsp;form.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649188">argv0p</span><span class="op" id="1649194">,</span>&nbsp;<span class="ident" id="1649196"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1649200">:=</span>&nbsp;<span class="ident" id="1649203"><a href="/syscall/syscall.go.html#1666606">BytePtrFromString</a></span><span class="op" id="1649220">(</span><span class="ident" id="1649221"><a href="/syscall/exec_unix.go.html#1648895">argv0</a></span><span class="op" id="1649226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649229">if</span>&nbsp;<span class="ident" id="1649232"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1649236">!=</span>&nbsp;<span class="ident" id="1649239">nil</span>&nbsp;<span class="op" id="1649243">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649247">return</span>&nbsp;<span class="num" id="1649254">0</span><span class="op" id="1649255">,</span>&nbsp;<span class="ident" id="1649257"><a href="/syscall/exec_unix.go.html#1648950">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649265">argvp</span><span class="op" id="1649270">,</span>&nbsp;<span class="ident" id="1649272"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1649276">:=</span>&nbsp;<span class="ident" id="1649279"><a href="/syscall/exec_unix.go.html#1647760">SlicePtrFromStrings</a></span><span class="op" id="1649298">(</span><span class="ident" id="1649299"><a href="/syscall/exec_unix.go.html#1648909">argv</a></span><span class="op" id="1649303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649306">if</span>&nbsp;<span class="ident" id="1649309"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1649313">!=</span>&nbsp;<span class="ident" id="1649316">nil</span>&nbsp;<span class="op" id="1649320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649324">return</span>&nbsp;<span class="num" id="1649331">0</span><span class="op" id="1649332">,</span>&nbsp;<span class="ident" id="1649334"><a href="/syscall/exec_unix.go.html#1648950">err</a></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649342">envvp</span><span class="op" id="1649347">,</span>&nbsp;<span class="ident" id="1649349"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1649353">:=</span>&nbsp;<span class="ident" id="1649356"><a href="/syscall/exec_unix.go.html#1647760">SlicePtrFromStrings</a></span><span class="op" id="1649375">(</span><span class="ident" id="1649376"><a href="/syscall/exec_unix.go.html#1648924">attr</a></span><span class="op" id="1649380">.</span><span class="ident" id="1649381">Env</span><span class="op" id="1649384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649387">if</span>&nbsp;<span class="ident" id="1649390"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1649394">!=</span>&nbsp;<span class="ident" id="1649397">nil</span>&nbsp;<span class="op" id="1649401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649405">return</span>&nbsp;<span class="num" id="1649412">0</span><span class="op" id="1649413">,</span>&nbsp;<span class="ident" id="1649415"><a href="/syscall/exec_unix.go.html#1648950">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649420">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649424">if</span>&nbsp;<span class="op" id="1649427">(</span><span class="ident" id="1649428"><a href="/syscall/exec_unix.go.html#1644811">runtime</a></span><span class="op" id="1649435">.</span><span class="ident" id="1649436">GOOS</span>&nbsp;<span class="op" id="1649441">==</span>&nbsp;<span class="string" id="1649444">&#34;freebsd&#34;</span>&nbsp;<span class="op" id="1649454">||</span>&nbsp;<span class="ident" id="1649457"><a href="/syscall/exec_unix.go.html#1644811">runtime</a></span><span class="op" id="1649464">.</span><span class="ident" id="1649465">GOOS</span>&nbsp;<span class="op" id="1649470">==</span>&nbsp;<span class="string" id="1649473">&#34;dragonfly&#34;</span><span class="op" id="1649484">)</span>&nbsp;<span class="op" id="1649486">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1649489">len</span><span class="op" id="1649492">(</span><span class="ident" id="1649493"><a href="/syscall/exec_unix.go.html#1648909">argv</a></span><span class="op" id="1649497">[</span><span class="num" id="1649498">0</span><span class="op" id="1649499">]</span><span class="op" id="1649500">)</span>&nbsp;<span class="op" id="1649502">&gt;</span>&nbsp;<span class="builtinfunc" id="1649504">len</span><span class="op" id="1649507">(</span><span class="ident" id="1649508"><a href="/syscall/exec_unix.go.html#1648895">argv0</a></span><span class="op" id="1649513">)</span>&nbsp;<span class="op" id="1649515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649519"><a href="/syscall/exec_unix.go.html#1649265">argvp</a></span><span class="op" id="1649524">[</span><span class="num" id="1649525">0</span><span class="op" id="1649526">]</span>&nbsp;<span class="op" id="1649528">=</span>&nbsp;<span class="ident" id="1649530"><a href="/syscall/exec_unix.go.html#1649188">argv0p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649542">var</span>&nbsp;<span class="ident" id="1649546">chroot</span>&nbsp;<span class="op" id="1649553">*</span><span class="builtintype" id="1649554">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649560">if</span>&nbsp;<span class="ident" id="1649563"><a href="/syscall/exec_unix.go.html#1649074">sys</a></span><span class="op" id="1649566">.</span><span class="ident" id="1649567">Chroot</span>&nbsp;<span class="op" id="1649574">!=</span>&nbsp;<span class="string" id="1649577">&#34;&#34;</span>&nbsp;<span class="op" id="1649580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649584"><a href="/syscall/exec_unix.go.html#1649546">chroot</a></span><span class="op" id="1649590">,</span>&nbsp;<span class="ident" id="1649592"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1649596">=</span>&nbsp;<span class="ident" id="1649598"><a href="/syscall/syscall.go.html#1666606">BytePtrFromString</a></span><span class="op" id="1649615">(</span><span class="ident" id="1649616"><a href="/syscall/exec_unix.go.html#1649074">sys</a></span><span class="op" id="1649619">.</span><span class="ident" id="1649620">Chroot</span><span class="op" id="1649626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649630">if</span>&nbsp;<span class="ident" id="1649633"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1649637">!=</span>&nbsp;<span class="ident" id="1649640">nil</span>&nbsp;<span class="op" id="1649644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649649">return</span>&nbsp;<span class="num" id="1649656">0</span><span class="op" id="1649657">,</span>&nbsp;<span class="ident" id="1649659"><a href="/syscall/exec_unix.go.html#1648950">err</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649671">var</span>&nbsp;<span class="ident" id="1649675">dir</span>&nbsp;<span class="op" id="1649679">*</span><span class="builtintype" id="1649680">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649686">if</span>&nbsp;<span class="ident" id="1649689"><a href="/syscall/exec_unix.go.html#1648924">attr</a></span><span class="op" id="1649693">.</span><span class="ident" id="1649694">Dir</span>&nbsp;<span class="op" id="1649698">!=</span>&nbsp;<span class="string" id="1649701">&#34;&#34;</span>&nbsp;<span class="op" id="1649704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649708"><a href="/syscall/exec_unix.go.html#1649675">dir</a></span><span class="op" id="1649711">,</span>&nbsp;<span class="ident" id="1649713"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1649717">=</span>&nbsp;<span class="ident" id="1649719"><a href="/syscall/syscall.go.html#1666606">BytePtrFromString</a></span><span class="op" id="1649736">(</span><span class="ident" id="1649737"><a href="/syscall/exec_unix.go.html#1648924">attr</a></span><span class="op" id="1649741">.</span><span class="ident" id="1649742">Dir</span><span class="op" id="1649745">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649749">if</span>&nbsp;<span class="ident" id="1649752"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1649756">!=</span>&nbsp;<span class="ident" id="1649759">nil</span>&nbsp;<span class="op" id="1649763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649768">return</span>&nbsp;<span class="num" id="1649775">0</span><span class="op" id="1649776">,</span>&nbsp;<span class="ident" id="1649778"><a href="/syscall/exec_unix.go.html#1648950">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1649787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1649791">//&nbsp;Acquire&nbsp;the&nbsp;fork&nbsp;lock&nbsp;so&nbsp;that&nbsp;no&nbsp;other&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1649842">//&nbsp;create&nbsp;new&nbsp;fds&nbsp;that&nbsp;are&nbsp;not&nbsp;yet&nbsp;close-on-exec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1649892">//&nbsp;before&nbsp;we&nbsp;fork.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1649912"><a href="/syscall/exec_unix.go.html#1647228">ForkLock</a></span><span class="op" id="1649920">.</span><span class="ident" id="1649921">Lock</span><span class="op" id="1649925">(</span><span class="op" id="1649926">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1649930">//&nbsp;Allocate&nbsp;child&nbsp;status&nbsp;pipe&nbsp;close&nbsp;on&nbsp;exec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1649976">if</span>&nbsp;<span class="ident" id="1649979"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1649983">=</span>&nbsp;<span class="ident" id="1649985"><a href="/syscall/exec_linux.go.html#1643039">forkExecPipe</a></span><span class="op" id="1649997">(</span><span class="ident" id="1649998"><a href="/syscall/exec_unix.go.html#1648968">p</a></span><span class="op" id="1649999">[</span><span class="op" id="1650000">:</span><span class="op" id="1650001">]</span><span class="op" id="1650002">)</span><span class="op" id="1650003">;</span>&nbsp;<span class="ident" id="1650005"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1650009">!=</span>&nbsp;<span class="ident" id="1650012">nil</span>&nbsp;<span class="op" id="1650016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650020">goto</span>&nbsp;<span class="builtintype" id="1650025">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1650032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650036">//&nbsp;Kick&nbsp;off&nbsp;child.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650056"><a href="/syscall/exec_unix.go.html#1648941">pid</a></span><span class="op" id="1650059">,</span>&nbsp;<span class="ident" id="1650061"><a href="/syscall/exec_unix.go.html#1648993">err1</a></span>&nbsp;<span class="op" id="1650066">=</span>&nbsp;<span class="ident" id="1650068"><a href="/syscall/exec_linux.go.html#1636859">forkAndExecInChild</a></span><span class="op" id="1650086">(</span><span class="ident" id="1650087"><a href="/syscall/exec_unix.go.html#1649188">argv0p</a></span><span class="op" id="1650093">,</span>&nbsp;<span class="ident" id="1650095"><a href="/syscall/exec_unix.go.html#1649265">argvp</a></span><span class="op" id="1650100">,</span>&nbsp;<span class="ident" id="1650102"><a href="/syscall/exec_unix.go.html#1649342">envvp</a></span><span class="op" id="1650107">,</span>&nbsp;<span class="ident" id="1650109"><a href="/syscall/exec_unix.go.html#1649546">chroot</a></span><span class="op" id="1650115">,</span>&nbsp;<span class="ident" id="1650117"><a href="/syscall/exec_unix.go.html#1649675">dir</a></span><span class="op" id="1650120">,</span>&nbsp;<span class="ident" id="1650122"><a href="/syscall/exec_unix.go.html#1648924">attr</a></span><span class="op" id="1650126">,</span>&nbsp;<span class="ident" id="1650128"><a href="/syscall/exec_unix.go.html#1649074">sys</a></span><span class="op" id="1650131">,</span>&nbsp;<span class="ident" id="1650133"><a href="/syscall/exec_unix.go.html#1648968">p</a></span><span class="op" id="1650134">[</span><span class="num" id="1650135">1</span><span class="op" id="1650136">]</span><span class="op" id="1650137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650140">if</span>&nbsp;<span class="ident" id="1650143"><a href="/syscall/exec_unix.go.html#1648993">err1</a></span>&nbsp;<span class="op" id="1650148">!=</span>&nbsp;<span class="num" id="1650151">0</span>&nbsp;<span class="op" id="1650153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650157"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1650161">=</span>&nbsp;<span class="ident" id="1650163"><a href="/syscall/syscall_unix.go.html#1701140">Errno</a></span><span class="op" id="1650168">(</span><span class="ident" id="1650169"><a href="/syscall/exec_unix.go.html#1648993">err1</a></span><span class="op" id="1650173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650177">goto</span>&nbsp;<span class="builtintype" id="1650182">error</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1650189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650192"><a href="/syscall/exec_unix.go.html#1647228">ForkLock</a></span><span class="op" id="1650200">.</span><span class="ident" id="1650201">Unlock</span><span class="op" id="1650207">(</span><span class="op" id="1650208">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650212">//&nbsp;Read&nbsp;child&nbsp;error&nbsp;status&nbsp;from&nbsp;pipe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650251"><a href="/syscall/zsyscall_linux_amd64.go.html#1772074">Close</a></span><span class="op" id="1650256">(</span><span class="ident" id="1650257"><a href="/syscall/exec_unix.go.html#1648968">p</a></span><span class="op" id="1650258">[</span><span class="num" id="1650259">1</span><span class="op" id="1650260">]</span><span class="op" id="1650261">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650264"><a href="/syscall/exec_unix.go.html#1648982">n</a></span><span class="op" id="1650265">,</span>&nbsp;<span class="ident" id="1650267"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1650271">=</span>&nbsp;<span class="ident" id="1650273"><a href="/syscall/zsyscall_linux_amd64.go.html#1794577">readlen</a></span><span class="op" id="1650280">(</span><span class="ident" id="1650281"><a href="/syscall/exec_unix.go.html#1648968">p</a></span><span class="op" id="1650282">[</span><span class="num" id="1650283">0</span><span class="op" id="1650284">]</span><span class="op" id="1650285">,</span>&nbsp;<span class="op" id="1650287">(</span><span class="op" id="1650288">*</span><span class="builtintype" id="1650289">byte</span><span class="op" id="1650293">)</span><span class="op" id="1650294">(</span><span class="ident" id="1650295"><a href="/syscall/exec_unix.go.html#1644830">unsafe</a></span><span class="op" id="1650301">.</span><span class="ident" id="1650302">Pointer</span><span class="op" id="1650309">(</span><span class="op" id="1650310">&amp;</span><span class="ident" id="1650311"><a href="/syscall/exec_unix.go.html#1648993">err1</a></span><span class="op" id="1650315">)</span><span class="op" id="1650316">)</span><span class="op" id="1650317">,</span>&nbsp;<span class="builtintype" id="1650319">int</span><span class="op" id="1650322">(</span><span class="ident" id="1650323"><a href="/syscall/exec_unix.go.html#1644830">unsafe</a></span><span class="op" id="1650329">.</span><span class="ident" id="1650330">Sizeof</span><span class="op" id="1650336">(</span><span class="ident" id="1650337"><a href="/syscall/exec_unix.go.html#1648993">err1</a></span><span class="op" id="1650341">)</span><span class="op" id="1650342">)</span><span class="op" id="1650343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650346"><a href="/syscall/zsyscall_linux_amd64.go.html#1772074">Close</a></span><span class="op" id="1650351">(</span><span class="ident" id="1650352"><a href="/syscall/exec_unix.go.html#1648968">p</a></span><span class="op" id="1650353">[</span><span class="num" id="1650354">0</span><span class="op" id="1650355">]</span><span class="op" id="1650356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650359">if</span>&nbsp;<span class="ident" id="1650362"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1650366">!=</span>&nbsp;<span class="ident" id="1650369">nil</span>&nbsp;<span class="op" id="1650373">||</span>&nbsp;<span class="ident" id="1650376"><a href="/syscall/exec_unix.go.html#1648982">n</a></span>&nbsp;<span class="op" id="1650378">!=</span>&nbsp;<span class="num" id="1650381">0</span>&nbsp;<span class="op" id="1650383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650387">if</span>&nbsp;<span class="ident" id="1650390"><a href="/syscall/exec_unix.go.html#1648982">n</a></span>&nbsp;<span class="op" id="1650392">==</span>&nbsp;<span class="builtintype" id="1650395">int</span><span class="op" id="1650398">(</span><span class="ident" id="1650399"><a href="/syscall/exec_unix.go.html#1644830">unsafe</a></span><span class="op" id="1650405">.</span><span class="ident" id="1650406">Sizeof</span><span class="op" id="1650412">(</span><span class="ident" id="1650413"><a href="/syscall/exec_unix.go.html#1648993">err1</a></span><span class="op" id="1650417">)</span><span class="op" id="1650418">)</span>&nbsp;<span class="op" id="1650420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650425"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1650429">=</span>&nbsp;<span class="ident" id="1650431"><a href="/syscall/syscall_unix.go.html#1701140">Errno</a></span><span class="op" id="1650436">(</span><span class="ident" id="1650437"><a href="/syscall/exec_unix.go.html#1648993">err1</a></span><span class="op" id="1650441">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1650445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650449">if</span>&nbsp;<span class="ident" id="1650452"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1650456">==</span>&nbsp;<span class="ident" id="1650459">nil</span>&nbsp;<span class="op" id="1650463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650468"><a href="/syscall/exec_unix.go.html#1648950">err</a></span>&nbsp;<span class="op" id="1650472">=</span>&nbsp;<span class="ident" id="1650474"><a href="/syscall/zerrors_linux_amd64.go.html#1758719">EPIPE</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1650482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650487">//&nbsp;Child&nbsp;failed;&nbsp;wait&nbsp;for&nbsp;it&nbsp;to&nbsp;exit,&nbsp;to&nbsp;make&nbsp;sure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650540">//&nbsp;the&nbsp;zombies&nbsp;don&#39;t&nbsp;accumulate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650575">_</span><span class="op" id="1650576">,</span>&nbsp;<span class="ident" id="1650578">err1</span>&nbsp;<span class="op" id="1650583">:=</span>&nbsp;<span class="ident" id="1650586"><a href="/syscall/syscall_linux.go.html#1672454">Wait4</a></span><span class="op" id="1650591">(</span><span class="ident" id="1650592"><a href="/syscall/exec_unix.go.html#1648941">pid</a></span><span class="op" id="1650595">,</span>&nbsp;<span class="op" id="1650597">&amp;</span><span class="ident" id="1650598"><a href="/syscall/exec_unix.go.html#1649009">wstatus</a></span><span class="op" id="1650605">,</span>&nbsp;<span class="num" id="1650607">0</span><span class="op" id="1650608">,</span>&nbsp;<span class="ident" id="1650610">nil</span><span class="op" id="1650613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650617">for</span>&nbsp;<span class="ident" id="1650621"><a href="/syscall/exec_unix.go.html#1650578">err1</a></span>&nbsp;<span class="op" id="1650626">==</span>&nbsp;<span class="ident" id="1650629"><a href="/syscall/zerrors_linux_amd64.go.html#1756650">EINTR</a></span>&nbsp;<span class="op" id="1650635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650640">_</span><span class="op" id="1650641">,</span>&nbsp;<span class="ident" id="1650643"><a href="/syscall/exec_unix.go.html#1650578">err1</a></span>&nbsp;<span class="op" id="1650648">=</span>&nbsp;<span class="ident" id="1650650"><a href="/syscall/syscall_linux.go.html#1672454">Wait4</a></span><span class="op" id="1650655">(</span><span class="ident" id="1650656"><a href="/syscall/exec_unix.go.html#1648941">pid</a></span><span class="op" id="1650659">,</span>&nbsp;<span class="op" id="1650661">&amp;</span><span class="ident" id="1650662"><a href="/syscall/exec_unix.go.html#1649009">wstatus</a></span><span class="op" id="1650669">,</span>&nbsp;<span class="num" id="1650671">0</span><span class="op" id="1650672">,</span>&nbsp;<span class="ident" id="1650674">nil</span><span class="op" id="1650677">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1650681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650685">return</span>&nbsp;<span class="num" id="1650692">0</span><span class="op" id="1650693">,</span>&nbsp;<span class="ident" id="1650695"><a href="/syscall/exec_unix.go.html#1648950">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1650700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1650704">//&nbsp;Read&nbsp;got&nbsp;EOF,&nbsp;so&nbsp;pipe&nbsp;closed&nbsp;on&nbsp;exec,&nbsp;so&nbsp;exec&nbsp;succeeded.</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650765">return</span>&nbsp;<span class="ident" id="1650772"><a href="/syscall/exec_unix.go.html#1648941">pid</a></span><span class="op" id="1650775">,</span>&nbsp;<span class="ident" id="1650777">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="builtintype" id="1650782">error</span><span class="op" id="1650787">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650790">if</span>&nbsp;<span class="ident" id="1650793"><a href="/syscall/exec_unix.go.html#1648968">p</a></span><span class="op" id="1650794">[</span><span class="num" id="1650795">0</span><span class="op" id="1650796">]</span>&nbsp;<span class="op" id="1650798">&gt;=</span>&nbsp;<span class="num" id="1650801">0</span>&nbsp;<span class="op" id="1650803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650807"><a href="/syscall/zsyscall_linux_amd64.go.html#1772074">Close</a></span><span class="op" id="1650812">(</span><span class="ident" id="1650813"><a href="/syscall/exec_unix.go.html#1648968">p</a></span><span class="op" id="1650814">[</span><span class="num" id="1650815">0</span><span class="op" id="1650816">]</span><span class="op" id="1650817">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650821"><a href="/syscall/zsyscall_linux_amd64.go.html#1772074">Close</a></span><span class="op" id="1650826">(</span><span class="ident" id="1650827"><a href="/syscall/exec_unix.go.html#1648968">p</a></span><span class="op" id="1650828">[</span><span class="num" id="1650829">1</span><span class="op" id="1650830">]</span><span class="op" id="1650831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1650834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1650837"><a href="/syscall/exec_unix.go.html#1647228">ForkLock</a></span><span class="op" id="1650845">.</span><span class="ident" id="1650846">Unlock</span><span class="op" id="1650852">(</span><span class="op" id="1650853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1650856">return</span>&nbsp;<span class="num" id="1650863">0</span><span class="op" id="1650864">,</span>&nbsp;<span class="ident" id="1650866"><a href="/syscall/exec_unix.go.html#1648950">err</a></span><br>
<span class="lineno"></span><span class="op" id="1650870">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="1650873">//&nbsp;Combination&nbsp;of&nbsp;fork&nbsp;and&nbsp;exec,&nbsp;careful&nbsp;to&nbsp;be&nbsp;thread&nbsp;safe.</span><br>
<span class="lineno"></span><span class="keyword" id="1650933">func</span>&nbsp;<span class="ident" id="1650938">ForkExec</span><span class="op" id="1650946">(</span><span class="ident" id="1650947">argv0</span>&nbsp;<span class="builtintype" id="1650953">string</span><span class="op" id="1650959">,</span>&nbsp;<span class="ident" id="1650961">argv</span>&nbsp;<span class="op" id="1650966">[</span><span class="op" id="1650967">]</span><span class="builtintype" id="1650968">string</span><span class="op" id="1650974">,</span>&nbsp;<span class="ident" id="1650976">attr</span>&nbsp;<span class="op" id="1650981">*</span><span class="ident" id="1650982"><a href="/syscall/exec_unix.go.html#1648663">ProcAttr</a></span><span class="op" id="1650990">)</span>&nbsp;<span class="op" id="1650992">(</span><span class="ident" id="1650993">pid</span>&nbsp;<span class="builtintype" id="1650997">int</span><span class="op" id="1651000">,</span>&nbsp;<span class="ident" id="1651002">err</span>&nbsp;<span class="builtintype" id="1651006">error</span><span class="op" id="1651011">)</span>&nbsp;<span class="op" id="1651013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651016">return</span>&nbsp;<span class="ident" id="1651023"><a href="/syscall/exec_unix.go.html#1648886">forkExec</a></span><span class="op" id="1651031">(</span><span class="ident" id="1651032"><a href="/syscall/exec_unix.go.html#1650947">argv0</a></span><span class="op" id="1651037">,</span>&nbsp;<span class="ident" id="1651039"><a href="/syscall/exec_unix.go.html#1650961">argv</a></span><span class="op" id="1651043">,</span>&nbsp;<span class="ident" id="1651045"><a href="/syscall/exec_unix.go.html#1650976">attr</a></span><span class="op" id="1651049">)</span><br>
<span class="lineno"></span><span class="op" id="1651051">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="1651054">//&nbsp;StartProcess&nbsp;wraps&nbsp;ForkExec&nbsp;for&nbsp;package&nbsp;os.</span><br>
<span class="lineno"></span><span class="keyword" id="1651101">func</span>&nbsp;<span class="ident" id="1651106">StartProcess</span><span class="op" id="1651118">(</span><span class="ident" id="1651119">argv0</span>&nbsp;<span class="builtintype" id="1651125">string</span><span class="op" id="1651131">,</span>&nbsp;<span class="ident" id="1651133">argv</span>&nbsp;<span class="op" id="1651138">[</span><span class="op" id="1651139">]</span><span class="builtintype" id="1651140">string</span><span class="op" id="1651146">,</span>&nbsp;<span class="ident" id="1651148">attr</span>&nbsp;<span class="op" id="1651153">*</span><span class="ident" id="1651154"><a href="/syscall/exec_unix.go.html#1648663">ProcAttr</a></span><span class="op" id="1651162">)</span>&nbsp;<span class="op" id="1651164">(</span><span class="ident" id="1651165">pid</span>&nbsp;<span class="builtintype" id="1651169">int</span><span class="op" id="1651172">,</span>&nbsp;<span class="ident" id="1651174">handle</span>&nbsp;<span class="builtintype" id="1651181">uintptr</span><span class="op" id="1651188">,</span>&nbsp;<span class="ident" id="1651190">err</span>&nbsp;<span class="builtintype" id="1651194">error</span><span class="op" id="1651199">)</span>&nbsp;<span class="op" id="1651201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651204"><a href="/syscall/exec_unix.go.html#1651165">pid</a></span><span class="op" id="1651207">,</span>&nbsp;<span class="ident" id="1651209"><a href="/syscall/exec_unix.go.html#1651190">err</a></span>&nbsp;<span class="op" id="1651213">=</span>&nbsp;<span class="ident" id="1651215"><a href="/syscall/exec_unix.go.html#1648886">forkExec</a></span><span class="op" id="1651223">(</span><span class="ident" id="1651224"><a href="/syscall/exec_unix.go.html#1651119">argv0</a></span><span class="op" id="1651229">,</span>&nbsp;<span class="ident" id="1651231"><a href="/syscall/exec_unix.go.html#1651133">argv</a></span><span class="op" id="1651235">,</span>&nbsp;<span class="ident" id="1651237"><a href="/syscall/exec_unix.go.html#1651148">attr</a></span><span class="op" id="1651241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651244">return</span>&nbsp;<span class="ident" id="1651251"><a href="/syscall/exec_unix.go.html#1651165">pid</a></span><span class="op" id="1651254">,</span>&nbsp;<span class="num" id="1651256">0</span><span class="op" id="1651257">,</span>&nbsp;<span class="ident" id="1651259"><a href="/syscall/exec_unix.go.html#1651190">err</a></span><br>
<span class="lineno">240</span><span class="op" id="1651263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1651266">//&nbsp;Ordinary&nbsp;exec.</span><br>
<span class="lineno"></span><span class="keyword" id="1651284">func</span>&nbsp;<span class="ident" id="1651289">Exec</span><span class="op" id="1651293">(</span><span class="ident" id="1651294">argv0</span>&nbsp;<span class="builtintype" id="1651300">string</span><span class="op" id="1651306">,</span>&nbsp;<span class="ident" id="1651308">argv</span>&nbsp;<span class="op" id="1651313">[</span><span class="op" id="1651314">]</span><span class="builtintype" id="1651315">string</span><span class="op" id="1651321">,</span>&nbsp;<span class="ident" id="1651323">envv</span>&nbsp;<span class="op" id="1651328">[</span><span class="op" id="1651329">]</span><span class="builtintype" id="1651330">string</span><span class="op" id="1651336">)</span>&nbsp;<span class="op" id="1651338">(</span><span class="ident" id="1651339">err</span>&nbsp;<span class="builtintype" id="1651343">error</span><span class="op" id="1651348">)</span>&nbsp;<span class="op" id="1651350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651353">argv0p</span><span class="op" id="1651359">,</span>&nbsp;<span class="ident" id="1651361"><a href="/syscall/exec_unix.go.html#1651339">err</a></span>&nbsp;<span class="op" id="1651365">:=</span>&nbsp;<span class="ident" id="1651368"><a href="/syscall/syscall.go.html#1666606">BytePtrFromString</a></span><span class="op" id="1651385">(</span><span class="ident" id="1651386"><a href="/syscall/exec_unix.go.html#1651294">argv0</a></span><span class="op" id="1651391">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651394">if</span>&nbsp;<span class="ident" id="1651397"><a href="/syscall/exec_unix.go.html#1651339">err</a></span>&nbsp;<span class="op" id="1651401">!=</span>&nbsp;<span class="ident" id="1651404">nil</span>&nbsp;<span class="op" id="1651408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651412">return</span>&nbsp;<span class="ident" id="1651419"><a href="/syscall/exec_unix.go.html#1651339">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1651424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651427">argvp</span><span class="op" id="1651432">,</span>&nbsp;<span class="ident" id="1651434"><a href="/syscall/exec_unix.go.html#1651339">err</a></span>&nbsp;<span class="op" id="1651438">:=</span>&nbsp;<span class="ident" id="1651441"><a href="/syscall/exec_unix.go.html#1647760">SlicePtrFromStrings</a></span><span class="op" id="1651460">(</span><span class="ident" id="1651461"><a href="/syscall/exec_unix.go.html#1651308">argv</a></span><span class="op" id="1651465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651468">if</span>&nbsp;<span class="ident" id="1651471"><a href="/syscall/exec_unix.go.html#1651339">err</a></span>&nbsp;<span class="op" id="1651475">!=</span>&nbsp;<span class="ident" id="1651478">nil</span>&nbsp;<span class="op" id="1651482">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651486">return</span>&nbsp;<span class="ident" id="1651493"><a href="/syscall/exec_unix.go.html#1651339">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1651498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651501">envvp</span><span class="op" id="1651506">,</span>&nbsp;<span class="ident" id="1651508"><a href="/syscall/exec_unix.go.html#1651339">err</a></span>&nbsp;<span class="op" id="1651512">:=</span>&nbsp;<span class="ident" id="1651515"><a href="/syscall/exec_unix.go.html#1647760">SlicePtrFromStrings</a></span><span class="op" id="1651534">(</span><span class="ident" id="1651535"><a href="/syscall/exec_unix.go.html#1651323">envv</a></span><span class="op" id="1651539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651542">if</span>&nbsp;<span class="ident" id="1651545"><a href="/syscall/exec_unix.go.html#1651339">err</a></span>&nbsp;<span class="op" id="1651549">!=</span>&nbsp;<span class="ident" id="1651552">nil</span>&nbsp;<span class="op" id="1651556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651560">return</span>&nbsp;<span class="ident" id="1651567"><a href="/syscall/exec_unix.go.html#1651339">err</a></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1651572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1651575">_</span><span class="op" id="1651576">,</span>&nbsp;<span class="ident" id="1651578">_</span><span class="op" id="1651579">,</span>&nbsp;<span class="ident" id="1651581">err1</span>&nbsp;<span class="op" id="1651586">:=</span>&nbsp;<span class="ident" id="1651589"><a href="/syscall/syscall_unix.go.html#1699358">RawSyscall</a></span><span class="op" id="1651599">(</span><span class="ident" id="1651600"><a href="/syscall/zsysnum_linux_amd64.go.html#1813270">SYS_EXECVE</a></span><span class="op" id="1651610">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="1651614">uintptr</span><span class="op" id="1651621">(</span><span class="ident" id="1651622"><a href="/syscall/exec_unix.go.html#1644830">unsafe</a></span><span class="op" id="1651628">.</span><span class="ident" id="1651629">Pointer</span><span class="op" id="1651636">(</span><span class="ident" id="1651637"><a href="/syscall/exec_unix.go.html#1651353">argv0p</a></span><span class="op" id="1651643">)</span><span class="op" id="1651644">)</span><span class="op" id="1651645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="1651649">uintptr</span><span class="op" id="1651656">(</span><span class="ident" id="1651657"><a href="/syscall/exec_unix.go.html#1644830">unsafe</a></span><span class="op" id="1651663">.</span><span class="ident" id="1651664">Pointer</span><span class="op" id="1651671">(</span><span class="op" id="1651672">&amp;</span><span class="ident" id="1651673"><a href="/syscall/exec_unix.go.html#1651427">argvp</a></span><span class="op" id="1651678">[</span><span class="num" id="1651679">0</span><span class="op" id="1651680">]</span><span class="op" id="1651681">)</span><span class="op" id="1651682">)</span><span class="op" id="1651683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="1651687">uintptr</span><span class="op" id="1651694">(</span><span class="ident" id="1651695"><a href="/syscall/exec_unix.go.html#1644830">unsafe</a></span><span class="op" id="1651701">.</span><span class="ident" id="1651702">Pointer</span><span class="op" id="1651709">(</span><span class="op" id="1651710">&amp;</span><span class="ident" id="1651711"><a href="/syscall/exec_unix.go.html#1651501">envvp</a></span><span class="op" id="1651716">[</span><span class="num" id="1651717">0</span><span class="op" id="1651718">]</span><span class="op" id="1651719">)</span><span class="op" id="1651720">)</span><span class="op" id="1651721">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1651724">return</span>&nbsp;<span class="ident" id="1651731"><a href="/syscall/syscall_unix.go.html#1701140">Errno</a></span><span class="op" id="1651736">(</span><span class="ident" id="1651737"><a href="/syscall/exec_unix.go.html#1651581">err1</a></span><span class="op" id="1651741">)</span><br>
<span class="lineno"></span><span class="op" id="1651743">}</span>
</div>
</body>
</html>
