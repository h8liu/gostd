<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io</h2>
<ul>
<li><a href="/gostd/io/io.go.html">io.go</a></li>
<li><a href="/gostd/io/io_test.go.html">io_test.go</a></li>
<li><a href="/gostd/io/multi.go.html" class="current">multi.go</a></li>
<li><a href="/gostd/io/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/io/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/io/pipe_test.go.html">pipe_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1381116">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1381171">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1381225">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1381276">package</span>&nbsp;<span class="ident" id="1381284">io</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1381288">type</span>&nbsp;<span class="ident" id="1381293">multiReader</span>&nbsp;<span class="keyword" id="1381305">struct</span>&nbsp;<span class="op" id="1381312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1381315">readers</span>&nbsp;<span class="op" id="1381323">[</span><span class="op" id="1381324">]</span><span class="ident" id="1381325">Reader</span><br>
<span class="lineno"></span><span class="op" id="1381332">}</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1381335">func</span>&nbsp;<span class="op" id="1381340">(</span><span class="ident" id="1381341">mr</span>&nbsp;<span class="op" id="1381344">*</span><span class="ident" id="1381345">multiReader</span><span class="op" id="1381356">)</span>&nbsp;<span class="ident" id="1381358">Read</span><span class="op" id="1381362">(</span><span class="ident" id="1381363">p</span>&nbsp;<span class="op" id="1381365">[</span><span class="op" id="1381366">]</span><span class="builtintype" id="1381367">byte</span><span class="op" id="1381371">)</span>&nbsp;<span class="op" id="1381373">(</span><span class="ident" id="1381374">n</span>&nbsp;<span class="builtintype" id="1381376">int</span><span class="op" id="1381379">,</span>&nbsp;<span class="ident" id="1381381">err</span>&nbsp;<span class="builtintype" id="1381385">error</span><span class="op" id="1381390">)</span>&nbsp;<span class="op" id="1381392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1381395">for</span>&nbsp;<span class="builtinfunc" id="1381399">len</span><span class="op" id="1381402">(</span><span class="ident" id="1381403">mr</span><span class="op" id="1381405">.</span><span class="ident" id="1381406">readers</span><span class="op" id="1381413">)</span>&nbsp;<span class="op" id="1381415">&gt;</span>&nbsp;<span class="num" id="1381417">0</span>&nbsp;<span class="op" id="1381419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1381423">n</span><span class="op" id="1381424">,</span>&nbsp;<span class="ident" id="1381426">err</span>&nbsp;<span class="op" id="1381430">=</span>&nbsp;<span class="ident" id="1381432">mr</span><span class="op" id="1381434">.</span><span class="ident" id="1381435">readers</span><span class="op" id="1381442">[</span><span class="num" id="1381443">0</span><span class="op" id="1381444">]</span><span class="op" id="1381445">.</span><span class="ident" id="1381446">Read</span><span class="op" id="1381450">(</span><span class="ident" id="1381451">p</span><span class="op" id="1381452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1381456">if</span>&nbsp;<span class="ident" id="1381459">n</span>&nbsp;<span class="op" id="1381461">&gt;</span>&nbsp;<span class="num" id="1381463">0</span>&nbsp;<span class="op" id="1381465">||</span>&nbsp;<span class="ident" id="1381468">err</span>&nbsp;<span class="op" id="1381472">!=</span>&nbsp;<span class="ident" id="1381475">EOF</span>&nbsp;<span class="op" id="1381479">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1381484">if</span>&nbsp;<span class="ident" id="1381487">err</span>&nbsp;<span class="op" id="1381491">==</span>&nbsp;<span class="ident" id="1381494">EOF</span>&nbsp;<span class="op" id="1381498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1381504">//&nbsp;Don&#39;t&nbsp;return&nbsp;EOF&nbsp;yet.&nbsp;There&nbsp;may&nbsp;be&nbsp;more&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1381557">//&nbsp;in&nbsp;the&nbsp;remaining&nbsp;readers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1381590">err</span>&nbsp;<span class="op" id="1381594">=</span>&nbsp;<span class="ident" id="1381596">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1381603">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1381608">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1381617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1381621">mr</span><span class="op" id="1381623">.</span><span class="ident" id="1381624">readers</span>&nbsp;<span class="op" id="1381632">=</span>&nbsp;<span class="ident" id="1381634">mr</span><span class="op" id="1381636">.</span><span class="ident" id="1381637">readers</span><span class="op" id="1381644">[</span><span class="num" id="1381645">1</span><span class="op" id="1381646">:</span><span class="op" id="1381647">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1381650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1381653">return</span>&nbsp;<span class="num" id="1381660">0</span><span class="op" id="1381661">,</span>&nbsp;<span class="ident" id="1381663">EOF</span><br>
<span class="lineno">25</span><span class="op" id="1381667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1381670">//&nbsp;MultiReader&nbsp;returns&nbsp;a&nbsp;Reader&nbsp;that&#39;s&nbsp;the&nbsp;logical&nbsp;concatenation&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1381738">//&nbsp;the&nbsp;provided&nbsp;input&nbsp;readers.&nbsp;&nbsp;They&#39;re&nbsp;read&nbsp;sequentially.&nbsp;&nbsp;Once&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="1381807">//&nbsp;inputs&nbsp;have&nbsp;returned&nbsp;EOF,&nbsp;Read&nbsp;will&nbsp;return&nbsp;EOF.&nbsp;&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;readers</span><br>
<span class="lineno">30</span><span class="comment" id="1381881">//&nbsp;return&nbsp;a&nbsp;non-nil,&nbsp;non-EOF&nbsp;error,&nbsp;Read&nbsp;will&nbsp;return&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="1381946">func</span>&nbsp;<span class="ident" id="1381951">MultiReader</span><span class="op" id="1381962">(</span><span class="ident" id="1381963">readers</span>&nbsp;<span class="op" id="1381971">...</span><span class="ident" id="1381974">Reader</span><span class="op" id="1381980">)</span>&nbsp;<span class="ident" id="1381982">Reader</span>&nbsp;<span class="op" id="1381989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1381992">r</span>&nbsp;<span class="op" id="1381994">:=</span>&nbsp;<span class="builtinfunc" id="1381997">make</span><span class="op" id="1382001">(</span><span class="op" id="1382002">[</span><span class="op" id="1382003">]</span><span class="ident" id="1382004">Reader</span><span class="op" id="1382010">,</span>&nbsp;<span class="builtinfunc" id="1382012">len</span><span class="op" id="1382015">(</span><span class="ident" id="1382016">readers</span><span class="op" id="1382023">)</span><span class="op" id="1382024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1382027">copy</span><span class="op" id="1382031">(</span><span class="ident" id="1382032">r</span><span class="op" id="1382033">,</span>&nbsp;<span class="ident" id="1382035">readers</span><span class="op" id="1382042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1382045">return</span>&nbsp;<span class="op" id="1382052">&amp;</span><span class="ident" id="1382053">multiReader</span><span class="op" id="1382064">{</span><span class="ident" id="1382065">r</span><span class="op" id="1382066">}</span><br>
<span class="lineno">35</span><span class="op" id="1382068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1382071">type</span>&nbsp;<span class="ident" id="1382076">multiWriter</span>&nbsp;<span class="keyword" id="1382088">struct</span>&nbsp;<span class="op" id="1382095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1382098">writers</span>&nbsp;<span class="op" id="1382106">[</span><span class="op" id="1382107">]</span><span class="ident" id="1382108">Writer</span><br>
<span class="lineno"></span><span class="op" id="1382115">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1382118">func</span>&nbsp;<span class="op" id="1382123">(</span><span class="ident" id="1382124">t</span>&nbsp;<span class="op" id="1382126">*</span><span class="ident" id="1382127">multiWriter</span><span class="op" id="1382138">)</span>&nbsp;<span class="ident" id="1382140">Write</span><span class="op" id="1382145">(</span><span class="ident" id="1382146">p</span>&nbsp;<span class="op" id="1382148">[</span><span class="op" id="1382149">]</span><span class="builtintype" id="1382150">byte</span><span class="op" id="1382154">)</span>&nbsp;<span class="op" id="1382156">(</span><span class="ident" id="1382157">n</span>&nbsp;<span class="builtintype" id="1382159">int</span><span class="op" id="1382162">,</span>&nbsp;<span class="ident" id="1382164">err</span>&nbsp;<span class="builtintype" id="1382168">error</span><span class="op" id="1382173">)</span>&nbsp;<span class="op" id="1382175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1382178">for</span>&nbsp;<span class="ident" id="1382182">_</span><span class="op" id="1382183">,</span>&nbsp;<span class="ident" id="1382185">w</span>&nbsp;<span class="op" id="1382187">:=</span>&nbsp;<span class="keyword" id="1382190">range</span>&nbsp;<span class="ident" id="1382196">t</span><span class="op" id="1382197">.</span><span class="ident" id="1382198">writers</span>&nbsp;<span class="op" id="1382206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1382210">n</span><span class="op" id="1382211">,</span>&nbsp;<span class="ident" id="1382213">err</span>&nbsp;<span class="op" id="1382217">=</span>&nbsp;<span class="ident" id="1382219">w</span><span class="op" id="1382220">.</span><span class="ident" id="1382221">Write</span><span class="op" id="1382226">(</span><span class="ident" id="1382227">p</span><span class="op" id="1382228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1382232">if</span>&nbsp;<span class="ident" id="1382235">err</span>&nbsp;<span class="op" id="1382239">!=</span>&nbsp;<span class="ident" id="1382242">nil</span>&nbsp;<span class="op" id="1382246">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1382251">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1382260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1382264">if</span>&nbsp;<span class="ident" id="1382267">n</span>&nbsp;<span class="op" id="1382269">!=</span>&nbsp;<span class="builtinfunc" id="1382272">len</span><span class="op" id="1382275">(</span><span class="ident" id="1382276">p</span><span class="op" id="1382277">)</span>&nbsp;<span class="op" id="1382279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1382284">err</span>&nbsp;<span class="op" id="1382288">=</span>&nbsp;<span class="ident" id="1382290">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1382307">return</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1382316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1382319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1382322">return</span>&nbsp;<span class="builtinfunc" id="1382329">len</span><span class="op" id="1382332">(</span><span class="ident" id="1382333">p</span><span class="op" id="1382334">)</span><span class="op" id="1382335">,</span>&nbsp;<span class="ident" id="1382337">nil</span><br>
<span class="lineno"></span><span class="op" id="1382341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1382344">//&nbsp;MultiWriter&nbsp;creates&nbsp;a&nbsp;writer&nbsp;that&nbsp;duplicates&nbsp;its&nbsp;writes&nbsp;to&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1382414">//&nbsp;provided&nbsp;writers,&nbsp;similar&nbsp;to&nbsp;the&nbsp;Unix&nbsp;tee(1)&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="1382471">func</span>&nbsp;<span class="ident" id="1382476">MultiWriter</span><span class="op" id="1382487">(</span><span class="ident" id="1382488">writers</span>&nbsp;<span class="op" id="1382496">...</span><span class="ident" id="1382499">Writer</span><span class="op" id="1382505">)</span>&nbsp;<span class="ident" id="1382507">Writer</span>&nbsp;<span class="op" id="1382514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1382517">w</span>&nbsp;<span class="op" id="1382519">:=</span>&nbsp;<span class="builtinfunc" id="1382522">make</span><span class="op" id="1382526">(</span><span class="op" id="1382527">[</span><span class="op" id="1382528">]</span><span class="ident" id="1382529">Writer</span><span class="op" id="1382535">,</span>&nbsp;<span class="builtinfunc" id="1382537">len</span><span class="op" id="1382540">(</span><span class="ident" id="1382541">writers</span><span class="op" id="1382548">)</span><span class="op" id="1382549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1382552">copy</span><span class="op" id="1382556">(</span><span class="ident" id="1382557">w</span><span class="op" id="1382558">,</span>&nbsp;<span class="ident" id="1382560">writers</span><span class="op" id="1382567">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1382570">return</span>&nbsp;<span class="op" id="1382577">&amp;</span><span class="ident" id="1382578">multiWriter</span><span class="op" id="1382589">{</span><span class="ident" id="1382590">w</span><span class="op" id="1382591">}</span><br>
<span class="lineno"></span><span class="op" id="1382593">}</span>
</div>
</body>
</html>
