<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html" class="current">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2556030">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2556086">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2556140">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2556191">//&nbsp;Netlink&nbsp;sockets&nbsp;and&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2556224">package</span>&nbsp;<span class="ident" id="2556232">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2556241">import</span>&nbsp;<span class="string" id="2556248">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2556258">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;message&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2556324">func</span>&nbsp;<span class="ident" id="2556329">nlmAlignOf</span><span class="op" id="2556339">(</span><span class="ident" id="2556340">msglen</span>&nbsp;<span class="builtintype" id="2556347">int</span><span class="op" id="2556350">)</span>&nbsp;<span class="builtintype" id="2556352">int</span>&nbsp;<span class="op" id="2556356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2556359">return</span>&nbsp;<span class="op" id="2556366">(</span><span class="ident" id="2556367">msglen</span>&nbsp;<span class="op" id="2556374">+</span>&nbsp;<span class="ident" id="2556376">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2556390">-</span>&nbsp;<span class="num" id="2556392">1</span><span class="op" id="2556393">)</span>&nbsp;<span class="op" id="2556395">&amp;</span>&nbsp;<span class="op" id="2556397">^</span><span class="op" id="2556398">(</span><span class="ident" id="2556399">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2556413">-</span>&nbsp;<span class="num" id="2556415">1</span><span class="op" id="2556416">)</span><br>
<span class="lineno"></span><span class="op" id="2556418">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2556421">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute&nbsp;up&nbsp;to&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2556485">//&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2556498">func</span>&nbsp;<span class="ident" id="2556503">rtaAlignOf</span><span class="op" id="2556513">(</span><span class="ident" id="2556514">attrlen</span>&nbsp;<span class="builtintype" id="2556522">int</span><span class="op" id="2556525">)</span>&nbsp;<span class="builtintype" id="2556527">int</span>&nbsp;<span class="op" id="2556531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2556534">return</span>&nbsp;<span class="op" id="2556541">(</span><span class="ident" id="2556542">attrlen</span>&nbsp;<span class="op" id="2556550">+</span>&nbsp;<span class="ident" id="2556552">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2556564">-</span>&nbsp;<span class="num" id="2556566">1</span><span class="op" id="2556567">)</span>&nbsp;<span class="op" id="2556569">&amp;</span>&nbsp;<span class="op" id="2556571">^</span><span class="op" id="2556572">(</span><span class="ident" id="2556573">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2556585">-</span>&nbsp;<span class="num" id="2556587">1</span><span class="op" id="2556588">)</span><br>
<span class="lineno">20</span><span class="op" id="2556590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2556593">//&nbsp;NetlinkRouteRequest&nbsp;represents&nbsp;a&nbsp;request&nbsp;message&nbsp;to&nbsp;receive&nbsp;routing</span><br>
<span class="lineno"></span><span class="comment" id="2556664">//&nbsp;and&nbsp;link&nbsp;states&nbsp;from&nbsp;the&nbsp;kernel.</span><br>
<span class="lineno"></span><span class="keyword" id="2556700">type</span>&nbsp;<span class="ident" id="2556705">NetlinkRouteRequest</span>&nbsp;<span class="keyword" id="2556725">struct</span>&nbsp;<span class="op" id="2556732">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2556735">Header</span>&nbsp;<span class="ident" id="2556742">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2556752">Data</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2556759">RtGenmsg</span><br>
<span class="lineno"></span><span class="op" id="2556768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2556771">func</span>&nbsp;<span class="op" id="2556776">(</span><span class="ident" id="2556777">rr</span>&nbsp;<span class="op" id="2556780">*</span><span class="ident" id="2556781">NetlinkRouteRequest</span><span class="op" id="2556800">)</span>&nbsp;<span class="ident" id="2556802">toWireFormat</span><span class="op" id="2556814">(</span><span class="op" id="2556815">)</span>&nbsp;<span class="op" id="2556817">[</span><span class="op" id="2556818">]</span><span class="builtintype" id="2556819">byte</span>&nbsp;<span class="op" id="2556824">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2556827">b</span>&nbsp;<span class="op" id="2556829">:=</span>&nbsp;<span class="builtinfunc" id="2556832">make</span><span class="op" id="2556836">(</span><span class="op" id="2556837">[</span><span class="op" id="2556838">]</span><span class="builtintype" id="2556839">byte</span><span class="op" id="2556843">,</span>&nbsp;<span class="ident" id="2556845">rr</span><span class="op" id="2556847">.</span><span class="ident" id="2556848">Header</span><span class="op" id="2556854">.</span><span class="ident" id="2556855">Len</span><span class="op" id="2556858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2556861">*</span><span class="op" id="2556862">(</span><span class="op" id="2556863">*</span><span class="builtintype" id="2556864">uint32</span><span class="op" id="2556870">)</span><span class="op" id="2556871">(</span><span class="ident" id="2556872">unsafe</span><span class="op" id="2556878">.</span><span class="ident" id="2556879">Pointer</span><span class="op" id="2556886">(</span><span class="op" id="2556887">&amp;</span><span class="ident" id="2556888">b</span><span class="op" id="2556889">[</span><span class="num" id="2556890">0</span><span class="op" id="2556891">:</span><span class="num" id="2556892">4</span><span class="op" id="2556893">]</span><span class="op" id="2556894">[</span><span class="num" id="2556895">0</span><span class="op" id="2556896">]</span><span class="op" id="2556897">)</span><span class="op" id="2556898">)</span>&nbsp;<span class="op" id="2556900">=</span>&nbsp;<span class="ident" id="2556902">rr</span><span class="op" id="2556904">.</span><span class="ident" id="2556905">Header</span><span class="op" id="2556911">.</span><span class="ident" id="2556912">Len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2556917">*</span><span class="op" id="2556918">(</span><span class="op" id="2556919">*</span><span class="builtintype" id="2556920">uint16</span><span class="op" id="2556926">)</span><span class="op" id="2556927">(</span><span class="ident" id="2556928">unsafe</span><span class="op" id="2556934">.</span><span class="ident" id="2556935">Pointer</span><span class="op" id="2556942">(</span><span class="op" id="2556943">&amp;</span><span class="ident" id="2556944">b</span><span class="op" id="2556945">[</span><span class="num" id="2556946">4</span><span class="op" id="2556947">:</span><span class="num" id="2556948">6</span><span class="op" id="2556949">]</span><span class="op" id="2556950">[</span><span class="num" id="2556951">0</span><span class="op" id="2556952">]</span><span class="op" id="2556953">)</span><span class="op" id="2556954">)</span>&nbsp;<span class="op" id="2556956">=</span>&nbsp;<span class="ident" id="2556958">rr</span><span class="op" id="2556960">.</span><span class="ident" id="2556961">Header</span><span class="op" id="2556967">.</span><span class="ident" id="2556968">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2556974">*</span><span class="op" id="2556975">(</span><span class="op" id="2556976">*</span><span class="builtintype" id="2556977">uint16</span><span class="op" id="2556983">)</span><span class="op" id="2556984">(</span><span class="ident" id="2556985">unsafe</span><span class="op" id="2556991">.</span><span class="ident" id="2556992">Pointer</span><span class="op" id="2556999">(</span><span class="op" id="2557000">&amp;</span><span class="ident" id="2557001">b</span><span class="op" id="2557002">[</span><span class="num" id="2557003">6</span><span class="op" id="2557004">:</span><span class="num" id="2557005">8</span><span class="op" id="2557006">]</span><span class="op" id="2557007">[</span><span class="num" id="2557008">0</span><span class="op" id="2557009">]</span><span class="op" id="2557010">)</span><span class="op" id="2557011">)</span>&nbsp;<span class="op" id="2557013">=</span>&nbsp;<span class="ident" id="2557015">rr</span><span class="op" id="2557017">.</span><span class="ident" id="2557018">Header</span><span class="op" id="2557024">.</span><span class="ident" id="2557025">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2557032">*</span><span class="op" id="2557033">(</span><span class="op" id="2557034">*</span><span class="builtintype" id="2557035">uint32</span><span class="op" id="2557041">)</span><span class="op" id="2557042">(</span><span class="ident" id="2557043">unsafe</span><span class="op" id="2557049">.</span><span class="ident" id="2557050">Pointer</span><span class="op" id="2557057">(</span><span class="op" id="2557058">&amp;</span><span class="ident" id="2557059">b</span><span class="op" id="2557060">[</span><span class="num" id="2557061">8</span><span class="op" id="2557062">:</span><span class="num" id="2557063">12</span><span class="op" id="2557065">]</span><span class="op" id="2557066">[</span><span class="num" id="2557067">0</span><span class="op" id="2557068">]</span><span class="op" id="2557069">)</span><span class="op" id="2557070">)</span>&nbsp;<span class="op" id="2557072">=</span>&nbsp;<span class="ident" id="2557074">rr</span><span class="op" id="2557076">.</span><span class="ident" id="2557077">Header</span><span class="op" id="2557083">.</span><span class="ident" id="2557084">Seq</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2557089">*</span><span class="op" id="2557090">(</span><span class="op" id="2557091">*</span><span class="builtintype" id="2557092">uint32</span><span class="op" id="2557098">)</span><span class="op" id="2557099">(</span><span class="ident" id="2557100">unsafe</span><span class="op" id="2557106">.</span><span class="ident" id="2557107">Pointer</span><span class="op" id="2557114">(</span><span class="op" id="2557115">&amp;</span><span class="ident" id="2557116">b</span><span class="op" id="2557117">[</span><span class="num" id="2557118">12</span><span class="op" id="2557120">:</span><span class="num" id="2557121">16</span><span class="op" id="2557123">]</span><span class="op" id="2557124">[</span><span class="num" id="2557125">0</span><span class="op" id="2557126">]</span><span class="op" id="2557127">)</span><span class="op" id="2557128">)</span>&nbsp;<span class="op" id="2557130">=</span>&nbsp;<span class="ident" id="2557132">rr</span><span class="op" id="2557134">.</span><span class="ident" id="2557135">Header</span><span class="op" id="2557141">.</span><span class="ident" id="2557142">Pid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2557147">b</span><span class="op" id="2557148">[</span><span class="num" id="2557149">16</span><span class="op" id="2557151">]</span>&nbsp;<span class="op" id="2557153">=</span>&nbsp;<span class="builtintype" id="2557155">byte</span><span class="op" id="2557159">(</span><span class="ident" id="2557160">rr</span><span class="op" id="2557162">.</span><span class="ident" id="2557163">Data</span><span class="op" id="2557167">.</span><span class="ident" id="2557168">Family</span><span class="op" id="2557174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2557177">return</span>&nbsp;<span class="ident" id="2557184">b</span><br>
<span class="lineno"></span><span class="op" id="2557186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2557189">func</span>&nbsp;<span class="ident" id="2557194">newNetlinkRouteRequest</span><span class="op" id="2557216">(</span><span class="ident" id="2557217">proto</span><span class="op" id="2557222">,</span>&nbsp;<span class="ident" id="2557224">seq</span><span class="op" id="2557227">,</span>&nbsp;<span class="ident" id="2557229">family</span>&nbsp;<span class="builtintype" id="2557236">int</span><span class="op" id="2557239">)</span>&nbsp;<span class="op" id="2557241">[</span><span class="op" id="2557242">]</span><span class="builtintype" id="2557243">byte</span>&nbsp;<span class="op" id="2557248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2557251">rr</span>&nbsp;<span class="op" id="2557254">:=</span>&nbsp;<span class="op" id="2557257">&amp;</span><span class="ident" id="2557258">NetlinkRouteRequest</span><span class="op" id="2557277">{</span><span class="op" id="2557278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2557281">rr</span><span class="op" id="2557283">.</span><span class="ident" id="2557284">Header</span><span class="op" id="2557290">.</span><span class="ident" id="2557291">Len</span>&nbsp;<span class="op" id="2557295">=</span>&nbsp;<span class="builtintype" id="2557297">uint32</span><span class="op" id="2557303">(</span><span class="ident" id="2557304">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2557317">+</span>&nbsp;<span class="ident" id="2557319">SizeofRtGenmsg</span><span class="op" id="2557333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2557336">rr</span><span class="op" id="2557338">.</span><span class="ident" id="2557339">Header</span><span class="op" id="2557345">.</span><span class="ident" id="2557346">Type</span>&nbsp;<span class="op" id="2557351">=</span>&nbsp;<span class="builtintype" id="2557353">uint16</span><span class="op" id="2557359">(</span><span class="ident" id="2557360">proto</span><span class="op" id="2557365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2557368">rr</span><span class="op" id="2557370">.</span><span class="ident" id="2557371">Header</span><span class="op" id="2557377">.</span><span class="ident" id="2557378">Flags</span>&nbsp;<span class="op" id="2557384">=</span>&nbsp;<span class="ident" id="2557386">NLM_F_DUMP</span>&nbsp;<span class="op" id="2557397">|</span>&nbsp;<span class="ident" id="2557399">NLM_F_REQUEST</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2557414">rr</span><span class="op" id="2557416">.</span><span class="ident" id="2557417">Header</span><span class="op" id="2557423">.</span><span class="ident" id="2557424">Seq</span>&nbsp;<span class="op" id="2557428">=</span>&nbsp;<span class="builtintype" id="2557430">uint32</span><span class="op" id="2557436">(</span><span class="ident" id="2557437">seq</span><span class="op" id="2557440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2557443">rr</span><span class="op" id="2557445">.</span><span class="ident" id="2557446">Data</span><span class="op" id="2557450">.</span><span class="ident" id="2557451">Family</span>&nbsp;<span class="op" id="2557458">=</span>&nbsp;<span class="builtintype" id="2557460">uint8</span><span class="op" id="2557465">(</span><span class="ident" id="2557466">family</span><span class="op" id="2557472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2557475">return</span>&nbsp;<span class="ident" id="2557482">rr</span><span class="op" id="2557484">.</span><span class="ident" id="2557485">toWireFormat</span><span class="op" id="2557497">(</span><span class="op" id="2557498">)</span><br>
<span class="lineno"></span><span class="op" id="2557500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="2557503">//&nbsp;NetlinkRIB&nbsp;returns&nbsp;routing&nbsp;information&nbsp;base,&nbsp;as&nbsp;known&nbsp;as&nbsp;RIB,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="2557574">//&nbsp;consists&nbsp;of&nbsp;network&nbsp;facility&nbsp;information,&nbsp;states&nbsp;and&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="2557642">func</span>&nbsp;<span class="ident" id="2557647">NetlinkRIB</span><span class="op" id="2557657">(</span><span class="ident" id="2557658">proto</span><span class="op" id="2557663">,</span>&nbsp;<span class="ident" id="2557665">family</span>&nbsp;<span class="builtintype" id="2557672">int</span><span class="op" id="2557675">)</span>&nbsp;<span class="op" id="2557677">(</span><span class="op" id="2557678">[</span><span class="op" id="2557679">]</span><span class="builtintype" id="2557680">byte</span><span class="op" id="2557684">,</span>&nbsp;<span class="builtintype" id="2557686">error</span><span class="op" id="2557691">)</span>&nbsp;<span class="op" id="2557693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2557696">s</span><span class="op" id="2557697">,</span>&nbsp;<span class="ident" id="2557699">err</span>&nbsp;<span class="op" id="2557703">:=</span>&nbsp;<span class="ident" id="2557706">Socket</span><span class="op" id="2557712">(</span><span class="ident" id="2557713">AF_NETLINK</span><span class="op" id="2557723">,</span>&nbsp;<span class="ident" id="2557725">SOCK_RAW</span><span class="op" id="2557733">,</span>&nbsp;<span class="ident" id="2557735">NETLINK_ROUTE</span><span class="op" id="2557748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2557751">if</span>&nbsp;<span class="ident" id="2557754">err</span>&nbsp;<span class="op" id="2557758">!=</span>&nbsp;<span class="ident" id="2557761">nil</span>&nbsp;<span class="op" id="2557765">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2557769">return</span>&nbsp;<span class="ident" id="2557776">nil</span><span class="op" id="2557779">,</span>&nbsp;<span class="ident" id="2557781">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2557786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2557789">defer</span>&nbsp;<span class="ident" id="2557795">Close</span><span class="op" id="2557800">(</span><span class="ident" id="2557801">s</span><span class="op" id="2557802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2557805">lsa</span>&nbsp;<span class="op" id="2557809">:=</span>&nbsp;<span class="op" id="2557812">&amp;</span><span class="ident" id="2557813">SockaddrNetlink</span><span class="op" id="2557828">{</span><span class="ident" id="2557829">Family</span><span class="op" id="2557835">:</span>&nbsp;<span class="ident" id="2557837">AF_NETLINK</span><span class="op" id="2557847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2557850">if</span>&nbsp;<span class="ident" id="2557853">err</span>&nbsp;<span class="op" id="2557857">:=</span>&nbsp;<span class="ident" id="2557860">Bind</span><span class="op" id="2557864">(</span><span class="ident" id="2557865">s</span><span class="op" id="2557866">,</span>&nbsp;<span class="ident" id="2557868">lsa</span><span class="op" id="2557871">)</span><span class="op" id="2557872">;</span>&nbsp;<span class="ident" id="2557874">err</span>&nbsp;<span class="op" id="2557878">!=</span>&nbsp;<span class="ident" id="2557881">nil</span>&nbsp;<span class="op" id="2557885">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2557889">return</span>&nbsp;<span class="ident" id="2557896">nil</span><span class="op" id="2557899">,</span>&nbsp;<span class="ident" id="2557901">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2557906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2557909">wb</span>&nbsp;<span class="op" id="2557912">:=</span>&nbsp;<span class="ident" id="2557915">newNetlinkRouteRequest</span><span class="op" id="2557937">(</span><span class="ident" id="2557938">proto</span><span class="op" id="2557943">,</span>&nbsp;<span class="num" id="2557945">1</span><span class="op" id="2557946">,</span>&nbsp;<span class="ident" id="2557948">family</span><span class="op" id="2557954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2557957">if</span>&nbsp;<span class="ident" id="2557960">err</span>&nbsp;<span class="op" id="2557964">:=</span>&nbsp;<span class="ident" id="2557967">Sendto</span><span class="op" id="2557973">(</span><span class="ident" id="2557974">s</span><span class="op" id="2557975">,</span>&nbsp;<span class="ident" id="2557977">wb</span><span class="op" id="2557979">,</span>&nbsp;<span class="num" id="2557981">0</span><span class="op" id="2557982">,</span>&nbsp;<span class="ident" id="2557984">lsa</span><span class="op" id="2557987">)</span><span class="op" id="2557988">;</span>&nbsp;<span class="ident" id="2557990">err</span>&nbsp;<span class="op" id="2557994">!=</span>&nbsp;<span class="ident" id="2557997">nil</span>&nbsp;<span class="op" id="2558001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558005">return</span>&nbsp;<span class="ident" id="2558012">nil</span><span class="op" id="2558015">,</span>&nbsp;<span class="ident" id="2558017">err</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2558022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558025">var</span>&nbsp;<span class="ident" id="2558029">tab</span>&nbsp;<span class="op" id="2558033">[</span><span class="op" id="2558034">]</span><span class="builtintype" id="2558035">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2558041">rbNew</span>&nbsp;<span class="op" id="2558047">:=</span>&nbsp;<span class="builtinfunc" id="2558050">make</span><span class="op" id="2558054">(</span><span class="op" id="2558055">[</span><span class="op" id="2558056">]</span><span class="builtintype" id="2558057">byte</span><span class="op" id="2558061">,</span>&nbsp;<span class="ident" id="2558063">Getpagesize</span><span class="op" id="2558074">(</span><span class="op" id="2558075">)</span><span class="op" id="2558076">)</span><br>
<span class="lineno"></span><span class="ident" id="2558078">done</span><span class="op" id="2558082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558085">for</span>&nbsp;<span class="op" id="2558089">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2558093">rb</span>&nbsp;<span class="op" id="2558096">:=</span>&nbsp;<span class="ident" id="2558099">rbNew</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2558107">nr</span><span class="op" id="2558109">,</span>&nbsp;<span class="ident" id="2558111">_</span><span class="op" id="2558112">,</span>&nbsp;<span class="ident" id="2558114">err</span>&nbsp;<span class="op" id="2558118">:=</span>&nbsp;<span class="ident" id="2558121">Recvfrom</span><span class="op" id="2558129">(</span><span class="ident" id="2558130">s</span><span class="op" id="2558131">,</span>&nbsp;<span class="ident" id="2558133">rb</span><span class="op" id="2558135">,</span>&nbsp;<span class="num" id="2558137">0</span><span class="op" id="2558138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558142">if</span>&nbsp;<span class="ident" id="2558145">err</span>&nbsp;<span class="op" id="2558149">!=</span>&nbsp;<span class="ident" id="2558152">nil</span>&nbsp;<span class="op" id="2558156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558161">return</span>&nbsp;<span class="ident" id="2558168">nil</span><span class="op" id="2558171">,</span>&nbsp;<span class="ident" id="2558173">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2558179">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558183">if</span>&nbsp;<span class="ident" id="2558186">nr</span>&nbsp;<span class="op" id="2558189">&lt;</span>&nbsp;<span class="ident" id="2558191">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2558204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558209">return</span>&nbsp;<span class="ident" id="2558216">nil</span><span class="op" id="2558219">,</span>&nbsp;<span class="ident" id="2558221">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2558230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2558234">rb</span>&nbsp;<span class="op" id="2558237">=</span>&nbsp;<span class="ident" id="2558239">rb</span><span class="op" id="2558241">[</span><span class="op" id="2558242">:</span><span class="ident" id="2558243">nr</span><span class="op" id="2558245">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2558249">tab</span>&nbsp;<span class="op" id="2558253">=</span>&nbsp;<span class="builtinfunc" id="2558255">append</span><span class="op" id="2558261">(</span><span class="ident" id="2558262">tab</span><span class="op" id="2558265">,</span>&nbsp;<span class="ident" id="2558267">rb</span><span class="op" id="2558269">...</span><span class="op" id="2558272">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2558276">msgs</span><span class="op" id="2558280">,</span>&nbsp;<span class="ident" id="2558282">err</span>&nbsp;<span class="op" id="2558286">:=</span>&nbsp;<span class="ident" id="2558289">ParseNetlinkMessage</span><span class="op" id="2558308">(</span><span class="ident" id="2558309">rb</span><span class="op" id="2558311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558315">if</span>&nbsp;<span class="ident" id="2558318">err</span>&nbsp;<span class="op" id="2558322">!=</span>&nbsp;<span class="ident" id="2558325">nil</span>&nbsp;<span class="op" id="2558329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558334">return</span>&nbsp;<span class="ident" id="2558341">nil</span><span class="op" id="2558344">,</span>&nbsp;<span class="ident" id="2558346">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2558352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558356">for</span>&nbsp;<span class="ident" id="2558360">_</span><span class="op" id="2558361">,</span>&nbsp;<span class="ident" id="2558363">m</span>&nbsp;<span class="op" id="2558365">:=</span>&nbsp;<span class="keyword" id="2558368">range</span>&nbsp;<span class="ident" id="2558374">msgs</span>&nbsp;<span class="op" id="2558379">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2558384">lsa</span><span class="op" id="2558387">,</span>&nbsp;<span class="ident" id="2558389">err</span>&nbsp;<span class="op" id="2558393">:=</span>&nbsp;<span class="ident" id="2558396">Getsockname</span><span class="op" id="2558407">(</span><span class="ident" id="2558408">s</span><span class="op" id="2558409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558414">if</span>&nbsp;<span class="ident" id="2558417">err</span>&nbsp;<span class="op" id="2558421">!=</span>&nbsp;<span class="ident" id="2558424">nil</span>&nbsp;<span class="op" id="2558428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558434">return</span>&nbsp;<span class="ident" id="2558441">nil</span><span class="op" id="2558444">,</span>&nbsp;<span class="ident" id="2558446">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2558453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558458">switch</span>&nbsp;<span class="ident" id="2558465">v</span>&nbsp;<span class="op" id="2558467">:=</span>&nbsp;<span class="ident" id="2558470">lsa</span><span class="op" id="2558473">.</span><span class="op" id="2558474">(</span><span class="keyword" id="2558475">type</span><span class="op" id="2558479">)</span>&nbsp;<span class="op" id="2558481">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558486">case</span>&nbsp;<span class="op" id="2558491">*</span><span class="ident" id="2558492">SockaddrNetlink</span><span class="op" id="2558507">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558513">if</span>&nbsp;<span class="ident" id="2558516">m</span><span class="op" id="2558517">.</span><span class="ident" id="2558518">Header</span><span class="op" id="2558524">.</span><span class="ident" id="2558525">Seq</span>&nbsp;<span class="op" id="2558529">!=</span>&nbsp;<span class="num" id="2558532">1</span>&nbsp;<span class="op" id="2558534">||</span>&nbsp;<span class="ident" id="2558537">m</span><span class="op" id="2558538">.</span><span class="ident" id="2558539">Header</span><span class="op" id="2558545">.</span><span class="ident" id="2558546">Pid</span>&nbsp;<span class="op" id="2558550">!=</span>&nbsp;<span class="ident" id="2558553">v</span><span class="op" id="2558554">.</span><span class="ident" id="2558555">Pid</span>&nbsp;<span class="op" id="2558559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558566">return</span>&nbsp;<span class="ident" id="2558573">nil</span><span class="op" id="2558576">,</span>&nbsp;<span class="ident" id="2558578">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2558589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558594">default</span><span class="op" id="2558601">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558607">return</span>&nbsp;<span class="ident" id="2558614">nil</span><span class="op" id="2558617">,</span>&nbsp;<span class="ident" id="2558619">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2558629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558634">if</span>&nbsp;<span class="ident" id="2558637">m</span><span class="op" id="2558638">.</span><span class="ident" id="2558639">Header</span><span class="op" id="2558645">.</span><span class="ident" id="2558646">Type</span>&nbsp;<span class="op" id="2558651">==</span>&nbsp;<span class="ident" id="2558654">NLMSG_DONE</span>&nbsp;<span class="op" id="2558665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558671">break</span>&nbsp;<span class="ident" id="2558677">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2558685">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558690">if</span>&nbsp;<span class="ident" id="2558693">m</span><span class="op" id="2558694">.</span><span class="ident" id="2558695">Header</span><span class="op" id="2558701">.</span><span class="ident" id="2558702">Type</span>&nbsp;<span class="op" id="2558707">==</span>&nbsp;<span class="ident" id="2558710">NLMSG_ERROR</span>&nbsp;<span class="op" id="2558722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558728">return</span>&nbsp;<span class="ident" id="2558735">nil</span><span class="op" id="2558738">,</span>&nbsp;<span class="ident" id="2558740">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2558750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2558754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2558757">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2558760">return</span>&nbsp;<span class="ident" id="2558767">tab</span><span class="op" id="2558770">,</span>&nbsp;<span class="ident" id="2558772">nil</span><br>
<span class="lineno"></span><span class="op" id="2558776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2558779">//&nbsp;NetlinkMessage&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2558827">type</span>&nbsp;<span class="ident" id="2558832">NetlinkMessage</span>&nbsp;<span class="keyword" id="2558847">struct</span>&nbsp;<span class="op" id="2558854">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2558857">Header</span>&nbsp;<span class="ident" id="2558864">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2558874">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2558881">[</span><span class="op" id="2558882">]</span><span class="builtintype" id="2558883">byte</span><br>
<span class="lineno"></span><span class="op" id="2558888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2558891">//&nbsp;ParseNetlinkMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink&nbsp;messages&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="2558959">//&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the&nbsp;NetlinkMessage&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2559022">func</span>&nbsp;<span class="ident" id="2559027">ParseNetlinkMessage</span><span class="op" id="2559046">(</span><span class="ident" id="2559047">b</span>&nbsp;<span class="op" id="2559049">[</span><span class="op" id="2559050">]</span><span class="builtintype" id="2559051">byte</span><span class="op" id="2559055">)</span>&nbsp;<span class="op" id="2559057">(</span><span class="op" id="2559058">[</span><span class="op" id="2559059">]</span><span class="ident" id="2559060">NetlinkMessage</span><span class="op" id="2559074">,</span>&nbsp;<span class="builtintype" id="2559076">error</span><span class="op" id="2559081">)</span>&nbsp;<span class="op" id="2559083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2559086">var</span>&nbsp;<span class="ident" id="2559090">msgs</span>&nbsp;<span class="op" id="2559095">[</span><span class="op" id="2559096">]</span><span class="ident" id="2559097">NetlinkMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2559113">for</span>&nbsp;<span class="builtinfunc" id="2559117">len</span><span class="op" id="2559120">(</span><span class="ident" id="2559121">b</span><span class="op" id="2559122">)</span>&nbsp;<span class="op" id="2559124">&gt;=</span>&nbsp;<span class="ident" id="2559127">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2559140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2559144">h</span><span class="op" id="2559145">,</span>&nbsp;<span class="ident" id="2559147">dbuf</span><span class="op" id="2559151">,</span>&nbsp;<span class="ident" id="2559153">dlen</span><span class="op" id="2559157">,</span>&nbsp;<span class="ident" id="2559159">err</span>&nbsp;<span class="op" id="2559163">:=</span>&nbsp;<span class="ident" id="2559166">netlinkMessageHeaderAndData</span><span class="op" id="2559193">(</span><span class="ident" id="2559194">b</span><span class="op" id="2559195">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2559199">if</span>&nbsp;<span class="ident" id="2559202">err</span>&nbsp;<span class="op" id="2559206">!=</span>&nbsp;<span class="ident" id="2559209">nil</span>&nbsp;<span class="op" id="2559213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2559218">return</span>&nbsp;<span class="ident" id="2559225">nil</span><span class="op" id="2559228">,</span>&nbsp;<span class="ident" id="2559230">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2559236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2559240">m</span>&nbsp;<span class="op" id="2559242">:=</span>&nbsp;<span class="ident" id="2559245">NetlinkMessage</span><span class="op" id="2559259">{</span><span class="ident" id="2559260">Header</span><span class="op" id="2559266">:</span>&nbsp;<span class="op" id="2559268">*</span><span class="ident" id="2559269">h</span><span class="op" id="2559270">,</span>&nbsp;<span class="ident" id="2559272">Data</span><span class="op" id="2559276">:</span>&nbsp;<span class="ident" id="2559278">dbuf</span><span class="op" id="2559282">[</span><span class="op" id="2559283">:</span><span class="builtintype" id="2559284">int</span><span class="op" id="2559287">(</span><span class="ident" id="2559288">h</span><span class="op" id="2559289">.</span><span class="ident" id="2559290">Len</span><span class="op" id="2559293">)</span><span class="op" id="2559294">-</span><span class="ident" id="2559295">NLMSG_HDRLEN</span><span class="op" id="2559307">]</span><span class="op" id="2559308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2559312">msgs</span>&nbsp;<span class="op" id="2559317">=</span>&nbsp;<span class="builtinfunc" id="2559319">append</span><span class="op" id="2559325">(</span><span class="ident" id="2559326">msgs</span><span class="op" id="2559330">,</span>&nbsp;<span class="ident" id="2559332">m</span><span class="op" id="2559333">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2559337">b</span>&nbsp;<span class="op" id="2559339">=</span>&nbsp;<span class="ident" id="2559341">b</span><span class="op" id="2559342">[</span><span class="ident" id="2559343">dlen</span><span class="op" id="2559347">:</span><span class="op" id="2559348">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2559351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2559354">return</span>&nbsp;<span class="ident" id="2559361">msgs</span><span class="op" id="2559365">,</span>&nbsp;<span class="ident" id="2559367">nil</span><br>
<span class="lineno"></span><span class="op" id="2559371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2559374">func</span>&nbsp;<span class="ident" id="2559379">netlinkMessageHeaderAndData</span><span class="op" id="2559406">(</span><span class="ident" id="2559407">b</span>&nbsp;<span class="op" id="2559409">[</span><span class="op" id="2559410">]</span><span class="builtintype" id="2559411">byte</span><span class="op" id="2559415">)</span>&nbsp;<span class="op" id="2559417">(</span><span class="op" id="2559418">*</span><span class="ident" id="2559419">NlMsghdr</span><span class="op" id="2559427">,</span>&nbsp;<span class="op" id="2559429">[</span><span class="op" id="2559430">]</span><span class="builtintype" id="2559431">byte</span><span class="op" id="2559435">,</span>&nbsp;<span class="builtintype" id="2559437">int</span><span class="op" id="2559440">,</span>&nbsp;<span class="builtintype" id="2559442">error</span><span class="op" id="2559447">)</span>&nbsp;<span class="op" id="2559449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2559452">h</span>&nbsp;<span class="op" id="2559454">:=</span>&nbsp;<span class="op" id="2559457">(</span><span class="op" id="2559458">*</span><span class="ident" id="2559459">NlMsghdr</span><span class="op" id="2559467">)</span><span class="op" id="2559468">(</span><span class="ident" id="2559469">unsafe</span><span class="op" id="2559475">.</span><span class="ident" id="2559476">Pointer</span><span class="op" id="2559483">(</span><span class="op" id="2559484">&amp;</span><span class="ident" id="2559485">b</span><span class="op" id="2559486">[</span><span class="num" id="2559487">0</span><span class="op" id="2559488">]</span><span class="op" id="2559489">)</span><span class="op" id="2559490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2559493">if</span>&nbsp;<span class="builtintype" id="2559496">int</span><span class="op" id="2559499">(</span><span class="ident" id="2559500">h</span><span class="op" id="2559501">.</span><span class="ident" id="2559502">Len</span><span class="op" id="2559505">)</span>&nbsp;<span class="op" id="2559507">&lt;</span>&nbsp;<span class="ident" id="2559509">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2559522">||</span>&nbsp;<span class="builtintype" id="2559525">int</span><span class="op" id="2559528">(</span><span class="ident" id="2559529">h</span><span class="op" id="2559530">.</span><span class="ident" id="2559531">Len</span><span class="op" id="2559534">)</span>&nbsp;<span class="op" id="2559536">&gt;</span>&nbsp;<span class="builtinfunc" id="2559538">len</span><span class="op" id="2559541">(</span><span class="ident" id="2559542">b</span><span class="op" id="2559543">)</span>&nbsp;<span class="op" id="2559545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2559549">return</span>&nbsp;<span class="ident" id="2559556">nil</span><span class="op" id="2559559">,</span>&nbsp;<span class="ident" id="2559561">nil</span><span class="op" id="2559564">,</span>&nbsp;<span class="num" id="2559566">0</span><span class="op" id="2559567">,</span>&nbsp;<span class="ident" id="2559569">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2559577">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2559580">return</span>&nbsp;<span class="ident" id="2559587">h</span><span class="op" id="2559588">,</span>&nbsp;<span class="ident" id="2559590">b</span><span class="op" id="2559591">[</span><span class="ident" id="2559592">NLMSG_HDRLEN</span><span class="op" id="2559604">:</span><span class="op" id="2559605">]</span><span class="op" id="2559606">,</span>&nbsp;<span class="ident" id="2559608">nlmAlignOf</span><span class="op" id="2559618">(</span><span class="builtintype" id="2559619">int</span><span class="op" id="2559622">(</span><span class="ident" id="2559623">h</span><span class="op" id="2559624">.</span><span class="ident" id="2559625">Len</span><span class="op" id="2559628">)</span><span class="op" id="2559629">)</span><span class="op" id="2559630">,</span>&nbsp;<span class="ident" id="2559632">nil</span><br>
<span class="lineno"></span><span class="op" id="2559636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2559639">//&nbsp;NetlinkRouteAttr&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="2559697">type</span>&nbsp;<span class="ident" id="2559702">NetlinkRouteAttr</span>&nbsp;<span class="keyword" id="2559719">struct</span>&nbsp;<span class="op" id="2559726">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2559729">Attr</span>&nbsp;&nbsp;<span class="ident" id="2559735">RtAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2559743">Value</span>&nbsp;<span class="op" id="2559749">[</span><span class="op" id="2559750">]</span><span class="builtintype" id="2559751">byte</span><br>
<span class="lineno"></span><span class="op" id="2559756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2559759">//&nbsp;ParseNetlinkRouteAttr&nbsp;parses&nbsp;m&#39;s&nbsp;payload&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink</span><br>
<span class="lineno">145</span><span class="comment" id="2559826">//&nbsp;route&nbsp;attributes&nbsp;and&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2559883">//&nbsp;NetlinkRouteAttr&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2559915">func</span>&nbsp;<span class="ident" id="2559920">ParseNetlinkRouteAttr</span><span class="op" id="2559941">(</span><span class="ident" id="2559942">m</span>&nbsp;<span class="op" id="2559944">*</span><span class="ident" id="2559945">NetlinkMessage</span><span class="op" id="2559959">)</span>&nbsp;<span class="op" id="2559961">(</span><span class="op" id="2559962">[</span><span class="op" id="2559963">]</span><span class="ident" id="2559964">NetlinkRouteAttr</span><span class="op" id="2559980">,</span>&nbsp;<span class="builtintype" id="2559982">error</span><span class="op" id="2559987">)</span>&nbsp;<span class="op" id="2559989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2559992">var</span>&nbsp;<span class="ident" id="2559996">b</span>&nbsp;<span class="op" id="2559998">[</span><span class="op" id="2559999">]</span><span class="builtintype" id="2560000">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2560006">switch</span>&nbsp;<span class="ident" id="2560013">m</span><span class="op" id="2560014">.</span><span class="ident" id="2560015">Header</span><span class="op" id="2560021">.</span><span class="ident" id="2560022">Type</span>&nbsp;<span class="op" id="2560027">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2560030">case</span>&nbsp;<span class="ident" id="2560035">RTM_NEWLINK</span><span class="op" id="2560046">,</span>&nbsp;<span class="ident" id="2560048">RTM_DELLINK</span><span class="op" id="2560059">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2560063">b</span>&nbsp;<span class="op" id="2560065">=</span>&nbsp;<span class="ident" id="2560067">m</span><span class="op" id="2560068">.</span><span class="ident" id="2560069">Data</span><span class="op" id="2560073">[</span><span class="ident" id="2560074">SizeofIfInfomsg</span><span class="op" id="2560089">:</span><span class="op" id="2560090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2560093">case</span>&nbsp;<span class="ident" id="2560098">RTM_NEWADDR</span><span class="op" id="2560109">,</span>&nbsp;<span class="ident" id="2560111">RTM_DELADDR</span><span class="op" id="2560122">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2560126">b</span>&nbsp;<span class="op" id="2560128">=</span>&nbsp;<span class="ident" id="2560130">m</span><span class="op" id="2560131">.</span><span class="ident" id="2560132">Data</span><span class="op" id="2560136">[</span><span class="ident" id="2560137">SizeofIfAddrmsg</span><span class="op" id="2560152">:</span><span class="op" id="2560153">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2560156">case</span>&nbsp;<span class="ident" id="2560161">RTM_NEWROUTE</span><span class="op" id="2560173">,</span>&nbsp;<span class="ident" id="2560175">RTM_DELROUTE</span><span class="op" id="2560187">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2560191">b</span>&nbsp;<span class="op" id="2560193">=</span>&nbsp;<span class="ident" id="2560195">m</span><span class="op" id="2560196">.</span><span class="ident" id="2560197">Data</span><span class="op" id="2560201">[</span><span class="ident" id="2560202">SizeofRtMsg</span><span class="op" id="2560213">:</span><span class="op" id="2560214">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2560217">default</span><span class="op" id="2560224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2560228">return</span>&nbsp;<span class="ident" id="2560235">nil</span><span class="op" id="2560238">,</span>&nbsp;<span class="ident" id="2560240">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2560248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2560251">var</span>&nbsp;<span class="ident" id="2560255">attrs</span>&nbsp;<span class="op" id="2560261">[</span><span class="op" id="2560262">]</span><span class="ident" id="2560263">NetlinkRouteAttr</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2560281">for</span>&nbsp;<span class="builtinfunc" id="2560285">len</span><span class="op" id="2560288">(</span><span class="ident" id="2560289">b</span><span class="op" id="2560290">)</span>&nbsp;<span class="op" id="2560292">&gt;=</span>&nbsp;<span class="ident" id="2560295">SizeofRtAttr</span>&nbsp;<span class="op" id="2560308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2560312">a</span><span class="op" id="2560313">,</span>&nbsp;<span class="ident" id="2560315">vbuf</span><span class="op" id="2560319">,</span>&nbsp;<span class="ident" id="2560321">alen</span><span class="op" id="2560325">,</span>&nbsp;<span class="ident" id="2560327">err</span>&nbsp;<span class="op" id="2560331">:=</span>&nbsp;<span class="ident" id="2560334">netlinkRouteAttrAndValue</span><span class="op" id="2560358">(</span><span class="ident" id="2560359">b</span><span class="op" id="2560360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2560364">if</span>&nbsp;<span class="ident" id="2560367">err</span>&nbsp;<span class="op" id="2560371">!=</span>&nbsp;<span class="ident" id="2560374">nil</span>&nbsp;<span class="op" id="2560378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2560383">return</span>&nbsp;<span class="ident" id="2560390">nil</span><span class="op" id="2560393">,</span>&nbsp;<span class="ident" id="2560395">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2560401">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2560405">ra</span>&nbsp;<span class="op" id="2560408">:=</span>&nbsp;<span class="ident" id="2560411">NetlinkRouteAttr</span><span class="op" id="2560427">{</span><span class="ident" id="2560428">Attr</span><span class="op" id="2560432">:</span>&nbsp;<span class="op" id="2560434">*</span><span class="ident" id="2560435">a</span><span class="op" id="2560436">,</span>&nbsp;<span class="ident" id="2560438">Value</span><span class="op" id="2560443">:</span>&nbsp;<span class="ident" id="2560445">vbuf</span><span class="op" id="2560449">[</span><span class="op" id="2560450">:</span><span class="builtintype" id="2560451">int</span><span class="op" id="2560454">(</span><span class="ident" id="2560455">a</span><span class="op" id="2560456">.</span><span class="ident" id="2560457">Len</span><span class="op" id="2560460">)</span><span class="op" id="2560461">-</span><span class="ident" id="2560462">SizeofRtAttr</span><span class="op" id="2560474">]</span><span class="op" id="2560475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2560479">attrs</span>&nbsp;<span class="op" id="2560485">=</span>&nbsp;<span class="builtinfunc" id="2560487">append</span><span class="op" id="2560493">(</span><span class="ident" id="2560494">attrs</span><span class="op" id="2560499">,</span>&nbsp;<span class="ident" id="2560501">ra</span><span class="op" id="2560503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2560507">b</span>&nbsp;<span class="op" id="2560509">=</span>&nbsp;<span class="ident" id="2560511">b</span><span class="op" id="2560512">[</span><span class="ident" id="2560513">alen</span><span class="op" id="2560517">:</span><span class="op" id="2560518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2560521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2560524">return</span>&nbsp;<span class="ident" id="2560531">attrs</span><span class="op" id="2560536">,</span>&nbsp;<span class="ident" id="2560538">nil</span><br>
<span class="lineno">170</span><span class="op" id="2560542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2560545">func</span>&nbsp;<span class="ident" id="2560550">netlinkRouteAttrAndValue</span><span class="op" id="2560574">(</span><span class="ident" id="2560575">b</span>&nbsp;<span class="op" id="2560577">[</span><span class="op" id="2560578">]</span><span class="builtintype" id="2560579">byte</span><span class="op" id="2560583">)</span>&nbsp;<span class="op" id="2560585">(</span><span class="op" id="2560586">*</span><span class="ident" id="2560587">RtAttr</span><span class="op" id="2560593">,</span>&nbsp;<span class="op" id="2560595">[</span><span class="op" id="2560596">]</span><span class="builtintype" id="2560597">byte</span><span class="op" id="2560601">,</span>&nbsp;<span class="builtintype" id="2560603">int</span><span class="op" id="2560606">,</span>&nbsp;<span class="builtintype" id="2560608">error</span><span class="op" id="2560613">)</span>&nbsp;<span class="op" id="2560615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2560618">a</span>&nbsp;<span class="op" id="2560620">:=</span>&nbsp;<span class="op" id="2560623">(</span><span class="op" id="2560624">*</span><span class="ident" id="2560625">RtAttr</span><span class="op" id="2560631">)</span><span class="op" id="2560632">(</span><span class="ident" id="2560633">unsafe</span><span class="op" id="2560639">.</span><span class="ident" id="2560640">Pointer</span><span class="op" id="2560647">(</span><span class="op" id="2560648">&amp;</span><span class="ident" id="2560649">b</span><span class="op" id="2560650">[</span><span class="num" id="2560651">0</span><span class="op" id="2560652">]</span><span class="op" id="2560653">)</span><span class="op" id="2560654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2560657">if</span>&nbsp;<span class="builtintype" id="2560660">int</span><span class="op" id="2560663">(</span><span class="ident" id="2560664">a</span><span class="op" id="2560665">.</span><span class="ident" id="2560666">Len</span><span class="op" id="2560669">)</span>&nbsp;<span class="op" id="2560671">&lt;</span>&nbsp;<span class="ident" id="2560673">SizeofRtAttr</span>&nbsp;<span class="op" id="2560686">||</span>&nbsp;<span class="builtintype" id="2560689">int</span><span class="op" id="2560692">(</span><span class="ident" id="2560693">a</span><span class="op" id="2560694">.</span><span class="ident" id="2560695">Len</span><span class="op" id="2560698">)</span>&nbsp;<span class="op" id="2560700">&gt;</span>&nbsp;<span class="builtinfunc" id="2560702">len</span><span class="op" id="2560705">(</span><span class="ident" id="2560706">b</span><span class="op" id="2560707">)</span>&nbsp;<span class="op" id="2560709">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2560713">return</span>&nbsp;<span class="ident" id="2560720">nil</span><span class="op" id="2560723">,</span>&nbsp;<span class="ident" id="2560725">nil</span><span class="op" id="2560728">,</span>&nbsp;<span class="num" id="2560730">0</span><span class="op" id="2560731">,</span>&nbsp;<span class="ident" id="2560733">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2560741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2560744">return</span>&nbsp;<span class="ident" id="2560751">a</span><span class="op" id="2560752">,</span>&nbsp;<span class="ident" id="2560754">b</span><span class="op" id="2560755">[</span><span class="ident" id="2560756">SizeofRtAttr</span><span class="op" id="2560768">:</span><span class="op" id="2560769">]</span><span class="op" id="2560770">,</span>&nbsp;<span class="ident" id="2560772">rtaAlignOf</span><span class="op" id="2560782">(</span><span class="builtintype" id="2560783">int</span><span class="op" id="2560786">(</span><span class="ident" id="2560787">a</span><span class="op" id="2560788">.</span><span class="ident" id="2560789">Len</span><span class="op" id="2560792">)</span><span class="op" id="2560793">)</span><span class="op" id="2560794">,</span>&nbsp;<span class="ident" id="2560796">nil</span><br>
<span class="lineno"></span><span class="op" id="2560800">}</span>
</div>
</body>
</html>
