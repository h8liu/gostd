<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5920379">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5920434">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5920488">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5920539">//&nbsp;Package&nbsp;ascii85&nbsp;implements&nbsp;the&nbsp;ascii85&nbsp;data&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="5920595">//&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;btoa&nbsp;tool&nbsp;and&nbsp;Adobe&#39;s&nbsp;PostScript&nbsp;and&nbsp;PDF&nbsp;document&nbsp;formats.</span><br>
<span class="lineno"></span><span class="keyword" id="5920672">package</span>&nbsp;<span class="ident" id="5920680">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5920689">import</span>&nbsp;<span class="op" id="5920696">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5920699">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5920705">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="5920715">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5920718">/*<br>
<span class="lineno">15</span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5920737">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;into&nbsp;at&nbsp;most&nbsp;MaxEncodedLen(len(src))</span><br>
<span class="lineno"></span><span class="comment" id="5920796">//&nbsp;bytes&nbsp;of&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;actual&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">20</span><span class="comment" id="5920859">//</span><br>
<span class="lineno"></span><span class="comment" id="5920862">//&nbsp;The&nbsp;encoding&nbsp;handles&nbsp;4-byte&nbsp;chunks,&nbsp;using&nbsp;a&nbsp;special&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="5920926">//&nbsp;for&nbsp;the&nbsp;last&nbsp;fragment,&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="5920992">//&nbsp;individual&nbsp;blocks&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5921064">//</span><br>
<span class="lineno">25</span><span class="comment" id="5921067">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="5921131">//&nbsp;Encode&nbsp;does&nbsp;not&nbsp;add&nbsp;these.</span><br>
<span class="lineno"></span><span class="keyword" id="5921161">func</span>&nbsp;<span class="ident" id="5921166">Encode</span><span class="op" id="5921172">(</span><span class="ident" id="5921173">dst</span><span class="op" id="5921176">,</span>&nbsp;<span class="ident" id="5921178">src</span>&nbsp;<span class="op" id="5921182">[</span><span class="op" id="5921183">]</span><span class="builtintype" id="5921184">byte</span><span class="op" id="5921188">)</span>&nbsp;<span class="builtintype" id="5921190">int</span>&nbsp;<span class="op" id="5921194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921197">if</span>&nbsp;<span class="builtinfunc" id="5921200">len</span><span class="op" id="5921203">(</span><span class="ident" id="5921204">src</span><span class="op" id="5921207">)</span>&nbsp;<span class="op" id="5921209">==</span>&nbsp;<span class="num" id="5921212">0</span>&nbsp;<span class="op" id="5921214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921218">return</span>&nbsp;<span class="num" id="5921225">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921232">n</span>&nbsp;<span class="op" id="5921234">:=</span>&nbsp;<span class="num" id="5921237">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921240">for</span>&nbsp;<span class="builtinfunc" id="5921244">len</span><span class="op" id="5921247">(</span><span class="ident" id="5921248">src</span><span class="op" id="5921251">)</span>&nbsp;<span class="op" id="5921253">&gt;</span>&nbsp;<span class="num" id="5921255">0</span>&nbsp;<span class="op" id="5921257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921261">dst</span><span class="op" id="5921264">[</span><span class="num" id="5921265">0</span><span class="op" id="5921266">]</span>&nbsp;<span class="op" id="5921268">=</span>&nbsp;<span class="num" id="5921270">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921274">dst</span><span class="op" id="5921277">[</span><span class="num" id="5921278">1</span><span class="op" id="5921279">]</span>&nbsp;<span class="op" id="5921281">=</span>&nbsp;<span class="num" id="5921283">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921287">dst</span><span class="op" id="5921290">[</span><span class="num" id="5921291">2</span><span class="op" id="5921292">]</span>&nbsp;<span class="op" id="5921294">=</span>&nbsp;<span class="num" id="5921296">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921300">dst</span><span class="op" id="5921303">[</span><span class="num" id="5921304">3</span><span class="op" id="5921305">]</span>&nbsp;<span class="op" id="5921307">=</span>&nbsp;<span class="num" id="5921309">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921313">dst</span><span class="op" id="5921316">[</span><span class="num" id="5921317">4</span><span class="op" id="5921318">]</span>&nbsp;<span class="op" id="5921320">=</span>&nbsp;<span class="num" id="5921322">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921327">//&nbsp;Unpack&nbsp;4&nbsp;bytes&nbsp;into&nbsp;uint32&nbsp;to&nbsp;repack&nbsp;into&nbsp;base&nbsp;85&nbsp;5-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921390">var</span>&nbsp;<span class="ident" id="5921394">v</span>&nbsp;<span class="builtintype" id="5921396">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921405">switch</span>&nbsp;<span class="builtinfunc" id="5921412">len</span><span class="op" id="5921415">(</span><span class="ident" id="5921416">src</span><span class="op" id="5921419">)</span>&nbsp;<span class="op" id="5921421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921425">default</span><span class="op" id="5921432">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921437">v</span>&nbsp;<span class="op" id="5921439">|=</span>&nbsp;<span class="builtintype" id="5921442">uint32</span><span class="op" id="5921448">(</span><span class="ident" id="5921449">src</span><span class="op" id="5921452">[</span><span class="num" id="5921453">3</span><span class="op" id="5921454">]</span><span class="op" id="5921455">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921460">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921474">case</span>&nbsp;<span class="num" id="5921479">3</span><span class="op" id="5921480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921485">v</span>&nbsp;<span class="op" id="5921487">|=</span>&nbsp;<span class="builtintype" id="5921490">uint32</span><span class="op" id="5921496">(</span><span class="ident" id="5921497">src</span><span class="op" id="5921500">[</span><span class="num" id="5921501">2</span><span class="op" id="5921502">]</span><span class="op" id="5921503">)</span>&nbsp;<span class="op" id="5921505">&lt;&lt;</span>&nbsp;<span class="num" id="5921508">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921513">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921527">case</span>&nbsp;<span class="num" id="5921532">2</span><span class="op" id="5921533">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921538">v</span>&nbsp;<span class="op" id="5921540">|=</span>&nbsp;<span class="builtintype" id="5921543">uint32</span><span class="op" id="5921549">(</span><span class="ident" id="5921550">src</span><span class="op" id="5921553">[</span><span class="num" id="5921554">1</span><span class="op" id="5921555">]</span><span class="op" id="5921556">)</span>&nbsp;<span class="op" id="5921558">&lt;&lt;</span>&nbsp;<span class="num" id="5921561">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921567">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921581">case</span>&nbsp;<span class="num" id="5921586">1</span><span class="op" id="5921587">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921592">v</span>&nbsp;<span class="op" id="5921594">|=</span>&nbsp;<span class="builtintype" id="5921597">uint32</span><span class="op" id="5921603">(</span><span class="ident" id="5921604">src</span><span class="op" id="5921607">[</span><span class="num" id="5921608">0</span><span class="op" id="5921609">]</span><span class="op" id="5921610">)</span>&nbsp;<span class="op" id="5921612">&lt;&lt;</span>&nbsp;<span class="num" id="5921615">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921620">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921625">//&nbsp;Special&nbsp;case:&nbsp;zero&nbsp;(!!!!!)&nbsp;shortens&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921672">if</span>&nbsp;<span class="ident" id="5921675">v</span>&nbsp;<span class="op" id="5921677">==</span>&nbsp;<span class="num" id="5921680">0</span>&nbsp;<span class="op" id="5921682">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5921685">len</span><span class="op" id="5921688">(</span><span class="ident" id="5921689">src</span><span class="op" id="5921692">)</span>&nbsp;<span class="op" id="5921694">&gt;=</span>&nbsp;<span class="num" id="5921697">4</span>&nbsp;<span class="op" id="5921699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921704">dst</span><span class="op" id="5921707">[</span><span class="num" id="5921708">0</span><span class="op" id="5921709">]</span>&nbsp;<span class="op" id="5921711">=</span>&nbsp;<span class="string" id="5921713">&#39;z&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921720">dst</span>&nbsp;<span class="op" id="5921724">=</span>&nbsp;<span class="ident" id="5921726">dst</span><span class="op" id="5921729">[</span><span class="num" id="5921730">1</span><span class="op" id="5921731">:</span><span class="op" id="5921732">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921737">src</span>&nbsp;<span class="op" id="5921741">=</span>&nbsp;<span class="ident" id="5921743">src</span><span class="op" id="5921746">[</span><span class="num" id="5921747">4</span><span class="op" id="5921748">:</span><span class="op" id="5921749">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921754">n</span><span class="op" id="5921755">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921761">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921777">//&nbsp;Otherwise,&nbsp;5&nbsp;base&nbsp;85&nbsp;digits&nbsp;starting&nbsp;at&nbsp;!.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921825">for</span>&nbsp;<span class="ident" id="5921829">i</span>&nbsp;<span class="op" id="5921831">:=</span>&nbsp;<span class="num" id="5921834">4</span><span class="op" id="5921835">;</span>&nbsp;<span class="ident" id="5921837">i</span>&nbsp;<span class="op" id="5921839">&gt;=</span>&nbsp;<span class="num" id="5921842">0</span><span class="op" id="5921843">;</span>&nbsp;<span class="ident" id="5921845">i</span><span class="op" id="5921846">--</span>&nbsp;<span class="op" id="5921849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921854">dst</span><span class="op" id="5921857">[</span><span class="ident" id="5921858">i</span><span class="op" id="5921859">]</span>&nbsp;<span class="op" id="5921861">=</span>&nbsp;<span class="string" id="5921863">&#39;!&#39;</span>&nbsp;<span class="op" id="5921867">+</span>&nbsp;<span class="builtintype" id="5921869">byte</span><span class="op" id="5921873">(</span><span class="ident" id="5921874">v</span><span class="op" id="5921875">%</span><span class="num" id="5921876">85</span><span class="op" id="5921878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921883">v</span>&nbsp;<span class="op" id="5921885">/=</span>&nbsp;<span class="num" id="5921888">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5921893">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5921898">//&nbsp;If&nbsp;src&nbsp;was&nbsp;short,&nbsp;discard&nbsp;the&nbsp;low&nbsp;destination&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921956">m</span>&nbsp;<span class="op" id="5921958">:=</span>&nbsp;<span class="num" id="5921961">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5921965">if</span>&nbsp;<span class="builtinfunc" id="5921968">len</span><span class="op" id="5921971">(</span><span class="ident" id="5921972">src</span><span class="op" id="5921975">)</span>&nbsp;<span class="op" id="5921977">&lt;</span>&nbsp;<span class="num" id="5921979">4</span>&nbsp;<span class="op" id="5921981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5921986">m</span>&nbsp;<span class="op" id="5921988">-=</span>&nbsp;<span class="num" id="5921991">4</span>&nbsp;<span class="op" id="5921993">-</span>&nbsp;<span class="builtinfunc" id="5921995">len</span><span class="op" id="5921998">(</span><span class="ident" id="5921999">src</span><span class="op" id="5922002">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922007">src</span>&nbsp;<span class="op" id="5922011">=</span>&nbsp;<span class="ident" id="5922013">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922019">}</span>&nbsp;<span class="keyword" id="5922021">else</span>&nbsp;<span class="op" id="5922026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922031">src</span>&nbsp;<span class="op" id="5922035">=</span>&nbsp;<span class="ident" id="5922037">src</span><span class="op" id="5922040">[</span><span class="num" id="5922041">4</span><span class="op" id="5922042">:</span><span class="op" id="5922043">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922051">dst</span>&nbsp;<span class="op" id="5922055">=</span>&nbsp;<span class="ident" id="5922057">dst</span><span class="op" id="5922060">[</span><span class="ident" id="5922061">m</span><span class="op" id="5922062">:</span><span class="op" id="5922063">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922067">n</span>&nbsp;<span class="op" id="5922069">+=</span>&nbsp;<span class="ident" id="5922072">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922078">return</span>&nbsp;<span class="ident" id="5922085">n</span><br>
<span class="lineno"></span><span class="op" id="5922087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5922090">//&nbsp;MaxEncodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;an&nbsp;encoding&nbsp;of&nbsp;n&nbsp;source&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5922168">func</span>&nbsp;<span class="ident" id="5922173">MaxEncodedLen</span><span class="op" id="5922186">(</span><span class="ident" id="5922187">n</span>&nbsp;<span class="builtintype" id="5922189">int</span><span class="op" id="5922192">)</span>&nbsp;<span class="builtintype" id="5922194">int</span>&nbsp;<span class="op" id="5922198">{</span>&nbsp;<span class="keyword" id="5922200">return</span>&nbsp;<span class="op" id="5922207">(</span><span class="ident" id="5922208">n</span>&nbsp;<span class="op" id="5922210">+</span>&nbsp;<span class="num" id="5922212">3</span><span class="op" id="5922213">)</span>&nbsp;<span class="op" id="5922215">/</span>&nbsp;<span class="num" id="5922217">4</span>&nbsp;<span class="op" id="5922219">*</span>&nbsp;<span class="num" id="5922221">5</span>&nbsp;<span class="op" id="5922223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5922226">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5922295">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">90</span><span class="comment" id="5922357">//&nbsp;Ascii85&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;32-bit&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="5922418">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5922486">//&nbsp;trailing&nbsp;partial&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="5922513">func</span>&nbsp;<span class="ident" id="5922518">NewEncoder</span><span class="op" id="5922528">(</span><span class="ident" id="5922529">w</span>&nbsp;<span class="ident" id="5922531">io</span><span class="op" id="5922533">.</span><span class="ident" id="5922534">Writer</span><span class="op" id="5922540">)</span>&nbsp;<span class="ident" id="5922542">io</span><span class="op" id="5922544">.</span><span class="ident" id="5922545">WriteCloser</span>&nbsp;<span class="op" id="5922557">{</span>&nbsp;<span class="keyword" id="5922559">return</span>&nbsp;<span class="op" id="5922566">&amp;</span><span class="ident" id="5922567">encoder</span><span class="op" id="5922574">{</span><span class="ident" id="5922575">w</span><span class="op" id="5922576">:</span>&nbsp;<span class="ident" id="5922578">w</span><span class="op" id="5922579">}</span>&nbsp;<span class="op" id="5922581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5922584">type</span>&nbsp;<span class="ident" id="5922589">encoder</span>&nbsp;<span class="keyword" id="5922597">struct</span>&nbsp;<span class="op" id="5922604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922607">err</span>&nbsp;&nbsp;<span class="builtintype" id="5922612">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922619">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5922624">io</span><span class="op" id="5922626">.</span><span class="ident" id="5922627">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922635">buf</span>&nbsp;&nbsp;<span class="op" id="5922640">[</span><span class="num" id="5922641">4</span><span class="op" id="5922642">]</span><span class="builtintype" id="5922643">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922651">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922691">nbuf</span>&nbsp;<span class="builtintype" id="5922696">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5922707">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922734">out</span>&nbsp;&nbsp;<span class="op" id="5922739">[</span><span class="num" id="5922740">1024</span><span class="op" id="5922744">]</span><span class="builtintype" id="5922745">byte</span>&nbsp;<span class="comment" id="5922750">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="5922767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5922770">func</span>&nbsp;<span class="op" id="5922775">(</span><span class="ident" id="5922776">e</span>&nbsp;<span class="op" id="5922778">*</span><span class="ident" id="5922779">encoder</span><span class="op" id="5922786">)</span>&nbsp;<span class="ident" id="5922788">Write</span><span class="op" id="5922793">(</span><span class="ident" id="5922794">p</span>&nbsp;<span class="op" id="5922796">[</span><span class="op" id="5922797">]</span><span class="builtintype" id="5922798">byte</span><span class="op" id="5922802">)</span>&nbsp;<span class="op" id="5922804">(</span><span class="ident" id="5922805">n</span>&nbsp;<span class="builtintype" id="5922807">int</span><span class="op" id="5922810">,</span>&nbsp;<span class="ident" id="5922812">err</span>&nbsp;<span class="builtintype" id="5922816">error</span><span class="op" id="5922821">)</span>&nbsp;<span class="op" id="5922823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922826">if</span>&nbsp;<span class="ident" id="5922829">e</span><span class="op" id="5922830">.</span><span class="ident" id="5922831">err</span>&nbsp;<span class="op" id="5922835">!=</span>&nbsp;<span class="ident" id="5922838">nil</span>&nbsp;<span class="op" id="5922842">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922846">return</span>&nbsp;<span class="num" id="5922853">0</span><span class="op" id="5922854">,</span>&nbsp;<span class="ident" id="5922856">e</span><span class="op" id="5922857">.</span><span class="ident" id="5922858">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5922867">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922887">if</span>&nbsp;<span class="ident" id="5922890">e</span><span class="op" id="5922891">.</span><span class="ident" id="5922892">nbuf</span>&nbsp;<span class="op" id="5922897">&gt;</span>&nbsp;<span class="num" id="5922899">0</span>&nbsp;<span class="op" id="5922901">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922905">var</span>&nbsp;<span class="ident" id="5922909">i</span>&nbsp;<span class="builtintype" id="5922911">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5922917">for</span>&nbsp;<span class="ident" id="5922921">i</span>&nbsp;<span class="op" id="5922923">=</span>&nbsp;<span class="num" id="5922925">0</span><span class="op" id="5922926">;</span>&nbsp;<span class="ident" id="5922928">i</span>&nbsp;<span class="op" id="5922930">&lt;</span>&nbsp;<span class="builtinfunc" id="5922932">len</span><span class="op" id="5922935">(</span><span class="ident" id="5922936">p</span><span class="op" id="5922937">)</span>&nbsp;<span class="op" id="5922939">&amp;&amp;</span>&nbsp;<span class="ident" id="5922942">e</span><span class="op" id="5922943">.</span><span class="ident" id="5922944">nbuf</span>&nbsp;<span class="op" id="5922949">&lt;</span>&nbsp;<span class="num" id="5922951">4</span><span class="op" id="5922952">;</span>&nbsp;<span class="ident" id="5922954">i</span><span class="op" id="5922955">++</span>&nbsp;<span class="op" id="5922958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922963">e</span><span class="op" id="5922964">.</span><span class="ident" id="5922965">buf</span><span class="op" id="5922968">[</span><span class="ident" id="5922969">e</span><span class="op" id="5922970">.</span><span class="ident" id="5922971">nbuf</span><span class="op" id="5922975">]</span>&nbsp;<span class="op" id="5922977">=</span>&nbsp;<span class="ident" id="5922979">p</span><span class="op" id="5922980">[</span><span class="ident" id="5922981">i</span><span class="op" id="5922982">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5922987">e</span><span class="op" id="5922988">.</span><span class="ident" id="5922989">nbuf</span><span class="op" id="5922993">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5922998">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923002">n</span>&nbsp;<span class="op" id="5923004">+=</span>&nbsp;<span class="ident" id="5923007">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923011">p</span>&nbsp;<span class="op" id="5923013">=</span>&nbsp;<span class="ident" id="5923015">p</span><span class="op" id="5923016">[</span><span class="ident" id="5923017">i</span><span class="op" id="5923018">:</span><span class="op" id="5923019">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923023">if</span>&nbsp;<span class="ident" id="5923026">e</span><span class="op" id="5923027">.</span><span class="ident" id="5923028">nbuf</span>&nbsp;<span class="op" id="5923033">&lt;</span>&nbsp;<span class="num" id="5923035">4</span>&nbsp;<span class="op" id="5923037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923042">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923051">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923055">nout</span>&nbsp;<span class="op" id="5923060">:=</span>&nbsp;<span class="ident" id="5923063">Encode</span><span class="op" id="5923069">(</span><span class="ident" id="5923070">e</span><span class="op" id="5923071">.</span><span class="ident" id="5923072">out</span><span class="op" id="5923075">[</span><span class="num" id="5923076">0</span><span class="op" id="5923077">:</span><span class="op" id="5923078">]</span><span class="op" id="5923079">,</span>&nbsp;<span class="ident" id="5923081">e</span><span class="op" id="5923082">.</span><span class="ident" id="5923083">buf</span><span class="op" id="5923086">[</span><span class="num" id="5923087">0</span><span class="op" id="5923088">:</span><span class="op" id="5923089">]</span><span class="op" id="5923090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923094">if</span>&nbsp;<span class="ident" id="5923097">_</span><span class="op" id="5923098">,</span>&nbsp;<span class="ident" id="5923100">e</span><span class="op" id="5923101">.</span><span class="ident" id="5923102">err</span>&nbsp;<span class="op" id="5923106">=</span>&nbsp;<span class="ident" id="5923108">e</span><span class="op" id="5923109">.</span><span class="ident" id="5923110">w</span><span class="op" id="5923111">.</span><span class="ident" id="5923112">Write</span><span class="op" id="5923117">(</span><span class="ident" id="5923118">e</span><span class="op" id="5923119">.</span><span class="ident" id="5923120">out</span><span class="op" id="5923123">[</span><span class="num" id="5923124">0</span><span class="op" id="5923125">:</span><span class="ident" id="5923126">nout</span><span class="op" id="5923130">]</span><span class="op" id="5923131">)</span><span class="op" id="5923132">;</span>&nbsp;<span class="ident" id="5923134">e</span><span class="op" id="5923135">.</span><span class="ident" id="5923136">err</span>&nbsp;<span class="op" id="5923140">!=</span>&nbsp;<span class="ident" id="5923143">nil</span>&nbsp;<span class="op" id="5923147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923152">return</span>&nbsp;<span class="ident" id="5923159">n</span><span class="op" id="5923160">,</span>&nbsp;<span class="ident" id="5923162">e</span><span class="op" id="5923163">.</span><span class="ident" id="5923164">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923174">e</span><span class="op" id="5923175">.</span><span class="ident" id="5923176">nbuf</span>&nbsp;<span class="op" id="5923181">=</span>&nbsp;<span class="num" id="5923183">0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923190">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923217">for</span>&nbsp;<span class="builtinfunc" id="5923221">len</span><span class="op" id="5923224">(</span><span class="ident" id="5923225">p</span><span class="op" id="5923226">)</span>&nbsp;<span class="op" id="5923228">&gt;=</span>&nbsp;<span class="num" id="5923231">4</span>&nbsp;<span class="op" id="5923233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923237">nn</span>&nbsp;<span class="op" id="5923240">:=</span>&nbsp;<span class="builtinfunc" id="5923243">len</span><span class="op" id="5923246">(</span><span class="ident" id="5923247">e</span><span class="op" id="5923248">.</span><span class="ident" id="5923249">out</span><span class="op" id="5923252">)</span>&nbsp;<span class="op" id="5923254">/</span>&nbsp;<span class="num" id="5923256">5</span>&nbsp;<span class="op" id="5923258">*</span>&nbsp;<span class="num" id="5923260">4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923264">if</span>&nbsp;<span class="ident" id="5923267">nn</span>&nbsp;<span class="op" id="5923270">&gt;</span>&nbsp;<span class="builtinfunc" id="5923272">len</span><span class="op" id="5923275">(</span><span class="ident" id="5923276">p</span><span class="op" id="5923277">)</span>&nbsp;<span class="op" id="5923279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923284">nn</span>&nbsp;<span class="op" id="5923287">=</span>&nbsp;<span class="builtinfunc" id="5923289">len</span><span class="op" id="5923292">(</span><span class="ident" id="5923293">p</span><span class="op" id="5923294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923302">nn</span>&nbsp;<span class="op" id="5923305">-=</span>&nbsp;<span class="ident" id="5923308">nn</span>&nbsp;<span class="op" id="5923311">%</span>&nbsp;<span class="num" id="5923313">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923317">if</span>&nbsp;<span class="ident" id="5923320">nn</span>&nbsp;<span class="op" id="5923323">&gt;</span>&nbsp;<span class="num" id="5923325">0</span>&nbsp;<span class="op" id="5923327">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923332">nout</span>&nbsp;<span class="op" id="5923337">:=</span>&nbsp;<span class="ident" id="5923340">Encode</span><span class="op" id="5923346">(</span><span class="ident" id="5923347">e</span><span class="op" id="5923348">.</span><span class="ident" id="5923349">out</span><span class="op" id="5923352">[</span><span class="num" id="5923353">0</span><span class="op" id="5923354">:</span><span class="op" id="5923355">]</span><span class="op" id="5923356">,</span>&nbsp;<span class="ident" id="5923358">p</span><span class="op" id="5923359">[</span><span class="num" id="5923360">0</span><span class="op" id="5923361">:</span><span class="ident" id="5923362">nn</span><span class="op" id="5923364">]</span><span class="op" id="5923365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923370">if</span>&nbsp;<span class="ident" id="5923373">_</span><span class="op" id="5923374">,</span>&nbsp;<span class="ident" id="5923376">e</span><span class="op" id="5923377">.</span><span class="ident" id="5923378">err</span>&nbsp;<span class="op" id="5923382">=</span>&nbsp;<span class="ident" id="5923384">e</span><span class="op" id="5923385">.</span><span class="ident" id="5923386">w</span><span class="op" id="5923387">.</span><span class="ident" id="5923388">Write</span><span class="op" id="5923393">(</span><span class="ident" id="5923394">e</span><span class="op" id="5923395">.</span><span class="ident" id="5923396">out</span><span class="op" id="5923399">[</span><span class="num" id="5923400">0</span><span class="op" id="5923401">:</span><span class="ident" id="5923402">nout</span><span class="op" id="5923406">]</span><span class="op" id="5923407">)</span><span class="op" id="5923408">;</span>&nbsp;<span class="ident" id="5923410">e</span><span class="op" id="5923411">.</span><span class="ident" id="5923412">err</span>&nbsp;<span class="op" id="5923416">!=</span>&nbsp;<span class="ident" id="5923419">nil</span>&nbsp;<span class="op" id="5923423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923429">return</span>&nbsp;<span class="ident" id="5923436">n</span><span class="op" id="5923437">,</span>&nbsp;<span class="ident" id="5923439">e</span><span class="op" id="5923440">.</span><span class="ident" id="5923441">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923452">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923456">n</span>&nbsp;<span class="op" id="5923458">+=</span>&nbsp;<span class="ident" id="5923461">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923466">p</span>&nbsp;<span class="op" id="5923468">=</span>&nbsp;<span class="ident" id="5923470">p</span><span class="op" id="5923471">[</span><span class="ident" id="5923472">nn</span><span class="op" id="5923474">:</span><span class="op" id="5923475">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923482">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923503">for</span>&nbsp;<span class="ident" id="5923507">i</span>&nbsp;<span class="op" id="5923509">:=</span>&nbsp;<span class="num" id="5923512">0</span><span class="op" id="5923513">;</span>&nbsp;<span class="ident" id="5923515">i</span>&nbsp;<span class="op" id="5923517">&lt;</span>&nbsp;<span class="builtinfunc" id="5923519">len</span><span class="op" id="5923522">(</span><span class="ident" id="5923523">p</span><span class="op" id="5923524">)</span><span class="op" id="5923525">;</span>&nbsp;<span class="ident" id="5923527">i</span><span class="op" id="5923528">++</span>&nbsp;<span class="op" id="5923531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923535">e</span><span class="op" id="5923536">.</span><span class="ident" id="5923537">buf</span><span class="op" id="5923540">[</span><span class="ident" id="5923541">i</span><span class="op" id="5923542">]</span>&nbsp;<span class="op" id="5923544">=</span>&nbsp;<span class="ident" id="5923546">p</span><span class="op" id="5923547">[</span><span class="ident" id="5923548">i</span><span class="op" id="5923549">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923555">e</span><span class="op" id="5923556">.</span><span class="ident" id="5923557">nbuf</span>&nbsp;<span class="op" id="5923562">=</span>&nbsp;<span class="builtinfunc" id="5923564">len</span><span class="op" id="5923567">(</span><span class="ident" id="5923568">p</span><span class="op" id="5923569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923572">n</span>&nbsp;<span class="op" id="5923574">+=</span>&nbsp;<span class="builtinfunc" id="5923577">len</span><span class="op" id="5923580">(</span><span class="ident" id="5923581">p</span><span class="op" id="5923582">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923585">return</span><br>
<span class="lineno"></span><span class="op" id="5923592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5923595">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5923649">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno">155</span><span class="keyword" id="5923702">func</span>&nbsp;<span class="op" id="5923707">(</span><span class="ident" id="5923708">e</span>&nbsp;<span class="op" id="5923710">*</span><span class="ident" id="5923711">encoder</span><span class="op" id="5923718">)</span>&nbsp;<span class="ident" id="5923720">Close</span><span class="op" id="5923725">(</span><span class="op" id="5923726">)</span>&nbsp;<span class="builtintype" id="5923728">error</span>&nbsp;<span class="op" id="5923734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5923737">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923794">if</span>&nbsp;<span class="ident" id="5923797">e</span><span class="op" id="5923798">.</span><span class="ident" id="5923799">err</span>&nbsp;<span class="op" id="5923803">==</span>&nbsp;<span class="ident" id="5923806">nil</span>&nbsp;<span class="op" id="5923810">&amp;&amp;</span>&nbsp;<span class="ident" id="5923813">e</span><span class="op" id="5923814">.</span><span class="ident" id="5923815">nbuf</span>&nbsp;<span class="op" id="5923820">&gt;</span>&nbsp;<span class="num" id="5923822">0</span>&nbsp;<span class="op" id="5923824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923828">nout</span>&nbsp;<span class="op" id="5923833">:=</span>&nbsp;<span class="ident" id="5923836">Encode</span><span class="op" id="5923842">(</span><span class="ident" id="5923843">e</span><span class="op" id="5923844">.</span><span class="ident" id="5923845">out</span><span class="op" id="5923848">[</span><span class="num" id="5923849">0</span><span class="op" id="5923850">:</span><span class="op" id="5923851">]</span><span class="op" id="5923852">,</span>&nbsp;<span class="ident" id="5923854">e</span><span class="op" id="5923855">.</span><span class="ident" id="5923856">buf</span><span class="op" id="5923859">[</span><span class="num" id="5923860">0</span><span class="op" id="5923861">:</span><span class="ident" id="5923862">e</span><span class="op" id="5923863">.</span><span class="ident" id="5923864">nbuf</span><span class="op" id="5923868">]</span><span class="op" id="5923869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923873">e</span><span class="op" id="5923874">.</span><span class="ident" id="5923875">nbuf</span>&nbsp;<span class="op" id="5923880">=</span>&nbsp;<span class="num" id="5923882">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5923886">_</span><span class="op" id="5923887">,</span>&nbsp;<span class="ident" id="5923889">e</span><span class="op" id="5923890">.</span><span class="ident" id="5923891">err</span>&nbsp;<span class="op" id="5923895">=</span>&nbsp;<span class="ident" id="5923897">e</span><span class="op" id="5923898">.</span><span class="ident" id="5923899">w</span><span class="op" id="5923900">.</span><span class="ident" id="5923901">Write</span><span class="op" id="5923906">(</span><span class="ident" id="5923907">e</span><span class="op" id="5923908">.</span><span class="ident" id="5923909">out</span><span class="op" id="5923912">[</span><span class="num" id="5923913">0</span><span class="op" id="5923914">:</span><span class="ident" id="5923915">nout</span><span class="op" id="5923919">]</span><span class="op" id="5923920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5923923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5923926">return</span>&nbsp;<span class="ident" id="5923933">e</span><span class="op" id="5923934">.</span><span class="ident" id="5923935">err</span><br>
<span class="lineno"></span><span class="op" id="5923939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5923942">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5923961">type</span>&nbsp;<span class="ident" id="5923966">CorruptInputError</span>&nbsp;<span class="ident" id="5923984">int64</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5923991">func</span>&nbsp;<span class="op" id="5923996">(</span><span class="ident" id="5923997">e</span>&nbsp;<span class="ident" id="5923999">CorruptInputError</span><span class="op" id="5924016">)</span>&nbsp;<span class="ident" id="5924018">Error</span><span class="op" id="5924023">(</span><span class="op" id="5924024">)</span>&nbsp;<span class="builtintype" id="5924026">string</span>&nbsp;<span class="op" id="5924033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924036">return</span>&nbsp;<span class="string" id="5924043">&#34;illegal&nbsp;ascii85&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="5924081">+</span>&nbsp;<span class="ident" id="5924083">strconv</span><span class="op" id="5924090">.</span><span class="ident" id="5924091">FormatInt</span><span class="op" id="5924100">(</span><span class="ident" id="5924101">int64</span><span class="op" id="5924106">(</span><span class="ident" id="5924107">e</span><span class="op" id="5924108">)</span><span class="op" id="5924109">,</span>&nbsp;<span class="num" id="5924111">10</span><span class="op" id="5924113">)</span><br>
<span class="lineno"></span><span class="op" id="5924115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5924118">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;into&nbsp;dst,&nbsp;returning&nbsp;both&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="5924176">//&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;dst&nbsp;and&nbsp;the&nbsp;number&nbsp;consumed&nbsp;from&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="5924237">//&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;ascii85&nbsp;data,&nbsp;Decode&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5924301">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;a&nbsp;CorruptInputError.</span><br>
<span class="lineno"></span><span class="comment" id="5924366">//&nbsp;Decode&nbsp;ignores&nbsp;space&nbsp;and&nbsp;control&nbsp;characters&nbsp;in&nbsp;src.</span><br>
<span class="lineno">180</span><span class="comment" id="5924421">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="5924485">//&nbsp;Decode&nbsp;expects&nbsp;these&nbsp;to&nbsp;have&nbsp;been&nbsp;stripped&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="5924546">//</span><br>
<span class="lineno"></span><span class="comment" id="5924549">//&nbsp;If&nbsp;flush&nbsp;is&nbsp;true,&nbsp;Decode&nbsp;assumes&nbsp;that&nbsp;src&nbsp;represents&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5924609">//&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;stream&nbsp;and&nbsp;processes&nbsp;it&nbsp;completely&nbsp;rather</span><br>
<span class="lineno">185</span><span class="comment" id="5924671">//&nbsp;than&nbsp;wait&nbsp;for&nbsp;the&nbsp;completion&nbsp;of&nbsp;another&nbsp;32-bit&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="5924728">//</span><br>
<span class="lineno"></span><span class="comment" id="5924731">//&nbsp;NewDecoder&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;interface&nbsp;around&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="comment" id="5924789">//</span><br>
<span class="lineno"></span><span class="keyword" id="5924792">func</span>&nbsp;<span class="ident" id="5924797">Decode</span><span class="op" id="5924803">(</span><span class="ident" id="5924804">dst</span><span class="op" id="5924807">,</span>&nbsp;<span class="ident" id="5924809">src</span>&nbsp;<span class="op" id="5924813">[</span><span class="op" id="5924814">]</span><span class="builtintype" id="5924815">byte</span><span class="op" id="5924819">,</span>&nbsp;<span class="ident" id="5924821">flush</span>&nbsp;<span class="builtintype" id="5924827">bool</span><span class="op" id="5924831">)</span>&nbsp;<span class="op" id="5924833">(</span><span class="ident" id="5924834">ndst</span><span class="op" id="5924838">,</span>&nbsp;<span class="ident" id="5924840">nsrc</span>&nbsp;<span class="builtintype" id="5924845">int</span><span class="op" id="5924848">,</span>&nbsp;<span class="ident" id="5924850">err</span>&nbsp;<span class="builtintype" id="5924854">error</span><span class="op" id="5924859">)</span>&nbsp;<span class="op" id="5924861">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924864">var</span>&nbsp;<span class="ident" id="5924868">v</span>&nbsp;<span class="builtintype" id="5924870">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924878">var</span>&nbsp;<span class="ident" id="5924882">nb</span>&nbsp;<span class="builtintype" id="5924885">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924890">for</span>&nbsp;<span class="ident" id="5924894">i</span><span class="op" id="5924895">,</span>&nbsp;<span class="ident" id="5924897">b</span>&nbsp;<span class="op" id="5924899">:=</span>&nbsp;<span class="keyword" id="5924902">range</span>&nbsp;<span class="ident" id="5924908">src</span>&nbsp;<span class="op" id="5924912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924916">if</span>&nbsp;<span class="builtinfunc" id="5924919">len</span><span class="op" id="5924922">(</span><span class="ident" id="5924923">dst</span><span class="op" id="5924926">)</span><span class="op" id="5924927">-</span><span class="ident" id="5924928">ndst</span>&nbsp;<span class="op" id="5924933">&lt;</span>&nbsp;<span class="num" id="5924935">4</span>&nbsp;<span class="op" id="5924937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924942">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5924951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924955">switch</span>&nbsp;<span class="op" id="5924962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924966">case</span>&nbsp;<span class="ident" id="5924971">b</span>&nbsp;<span class="op" id="5924973">&lt;=</span>&nbsp;<span class="string" id="5924976">&#39;&nbsp;&#39;</span><span class="op" id="5924979">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924984">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5924995">case</span>&nbsp;<span class="ident" id="5925000">b</span>&nbsp;<span class="op" id="5925002">==</span>&nbsp;<span class="string" id="5925005">&#39;z&#39;</span>&nbsp;<span class="op" id="5925009">&amp;&amp;</span>&nbsp;<span class="ident" id="5925012">nb</span>&nbsp;<span class="op" id="5925015">==</span>&nbsp;<span class="num" id="5925018">0</span><span class="op" id="5925019">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925024">nb</span>&nbsp;<span class="op" id="5925027">=</span>&nbsp;<span class="num" id="5925029">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925034">v</span>&nbsp;<span class="op" id="5925036">=</span>&nbsp;<span class="num" id="5925038">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925042">case</span>&nbsp;<span class="string" id="5925047">&#39;!&#39;</span>&nbsp;<span class="op" id="5925051">&lt;=</span>&nbsp;<span class="ident" id="5925054">b</span>&nbsp;<span class="op" id="5925056">&amp;&amp;</span>&nbsp;<span class="ident" id="5925059">b</span>&nbsp;<span class="op" id="5925061">&lt;=</span>&nbsp;<span class="string" id="5925064">&#39;u&#39;</span><span class="op" id="5925067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925072">v</span>&nbsp;<span class="op" id="5925074">=</span>&nbsp;<span class="ident" id="5925076">v</span><span class="op" id="5925077">*</span><span class="num" id="5925078">85</span>&nbsp;<span class="op" id="5925081">+</span>&nbsp;<span class="builtintype" id="5925083">uint32</span><span class="op" id="5925089">(</span><span class="ident" id="5925090">b</span><span class="op" id="5925091">-</span><span class="string" id="5925092">&#39;!&#39;</span><span class="op" id="5925095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925100">nb</span><span class="op" id="5925102">++</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925107">default</span><span class="op" id="5925114">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925119">return</span>&nbsp;<span class="num" id="5925126">0</span><span class="op" id="5925127">,</span>&nbsp;<span class="num" id="5925129">0</span><span class="op" id="5925130">,</span>&nbsp;<span class="ident" id="5925132">CorruptInputError</span><span class="op" id="5925149">(</span><span class="ident" id="5925150">i</span><span class="op" id="5925151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925159">if</span>&nbsp;<span class="ident" id="5925162">nb</span>&nbsp;<span class="op" id="5925165">==</span>&nbsp;<span class="num" id="5925168">5</span>&nbsp;<span class="op" id="5925170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925175">nsrc</span>&nbsp;<span class="op" id="5925180">=</span>&nbsp;<span class="ident" id="5925182">i</span>&nbsp;<span class="op" id="5925184">+</span>&nbsp;<span class="num" id="5925186">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925191">dst</span><span class="op" id="5925194">[</span><span class="ident" id="5925195">ndst</span><span class="op" id="5925199">]</span>&nbsp;<span class="op" id="5925201">=</span>&nbsp;<span class="builtintype" id="5925203">byte</span><span class="op" id="5925207">(</span><span class="ident" id="5925208">v</span>&nbsp;<span class="op" id="5925210">&gt;&gt;</span>&nbsp;<span class="num" id="5925213">24</span><span class="op" id="5925215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925220">dst</span><span class="op" id="5925223">[</span><span class="ident" id="5925224">ndst</span><span class="op" id="5925228">+</span><span class="num" id="5925229">1</span><span class="op" id="5925230">]</span>&nbsp;<span class="op" id="5925232">=</span>&nbsp;<span class="builtintype" id="5925234">byte</span><span class="op" id="5925238">(</span><span class="ident" id="5925239">v</span>&nbsp;<span class="op" id="5925241">&gt;&gt;</span>&nbsp;<span class="num" id="5925244">16</span><span class="op" id="5925246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925251">dst</span><span class="op" id="5925254">[</span><span class="ident" id="5925255">ndst</span><span class="op" id="5925259">+</span><span class="num" id="5925260">2</span><span class="op" id="5925261">]</span>&nbsp;<span class="op" id="5925263">=</span>&nbsp;<span class="builtintype" id="5925265">byte</span><span class="op" id="5925269">(</span><span class="ident" id="5925270">v</span>&nbsp;<span class="op" id="5925272">&gt;&gt;</span>&nbsp;<span class="num" id="5925275">8</span><span class="op" id="5925276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925281">dst</span><span class="op" id="5925284">[</span><span class="ident" id="5925285">ndst</span><span class="op" id="5925289">+</span><span class="num" id="5925290">3</span><span class="op" id="5925291">]</span>&nbsp;<span class="op" id="5925293">=</span>&nbsp;<span class="builtintype" id="5925295">byte</span><span class="op" id="5925299">(</span><span class="ident" id="5925300">v</span><span class="op" id="5925301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925306">ndst</span>&nbsp;<span class="op" id="5925311">+=</span>&nbsp;<span class="num" id="5925314">4</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925319">nb</span>&nbsp;<span class="op" id="5925322">=</span>&nbsp;<span class="num" id="5925324">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925329">v</span>&nbsp;<span class="op" id="5925331">=</span>&nbsp;<span class="num" id="5925333">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925343">if</span>&nbsp;<span class="ident" id="5925346">flush</span>&nbsp;<span class="op" id="5925352">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925356">nsrc</span>&nbsp;<span class="op" id="5925361">=</span>&nbsp;<span class="builtinfunc" id="5925363">len</span><span class="op" id="5925366">(</span><span class="ident" id="5925367">src</span><span class="op" id="5925370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925374">if</span>&nbsp;<span class="ident" id="5925377">nb</span>&nbsp;<span class="op" id="5925380">&gt;</span>&nbsp;<span class="num" id="5925382">0</span>&nbsp;<span class="op" id="5925384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925389">//&nbsp;The&nbsp;number&nbsp;of&nbsp;output&nbsp;bytes&nbsp;in&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925443">//&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;leftover&nbsp;input&nbsp;bytes&nbsp;-&nbsp;1:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925492">//&nbsp;the&nbsp;extra&nbsp;byte&nbsp;provides&nbsp;enough&nbsp;bits&nbsp;to&nbsp;cover</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925543">//&nbsp;the&nbsp;inefficiency&nbsp;of&nbsp;the&nbsp;encoding&nbsp;for&nbsp;the&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925597">if</span>&nbsp;<span class="ident" id="5925600">nb</span>&nbsp;<span class="op" id="5925603">==</span>&nbsp;<span class="num" id="5925606">1</span>&nbsp;<span class="op" id="5925608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925614">return</span>&nbsp;<span class="num" id="5925621">0</span><span class="op" id="5925622">,</span>&nbsp;<span class="num" id="5925624">0</span><span class="op" id="5925625">,</span>&nbsp;<span class="ident" id="5925627">CorruptInputError</span><span class="op" id="5925644">(</span><span class="builtinfunc" id="5925645">len</span><span class="op" id="5925648">(</span><span class="ident" id="5925649">src</span><span class="op" id="5925652">)</span><span class="op" id="5925653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925663">for</span>&nbsp;<span class="ident" id="5925667">i</span>&nbsp;<span class="op" id="5925669">:=</span>&nbsp;<span class="ident" id="5925672">nb</span><span class="op" id="5925674">;</span>&nbsp;<span class="ident" id="5925676">i</span>&nbsp;<span class="op" id="5925678">&lt;</span>&nbsp;<span class="num" id="5925680">5</span><span class="op" id="5925681">;</span>&nbsp;<span class="ident" id="5925683">i</span><span class="op" id="5925684">++</span>&nbsp;<span class="op" id="5925687">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925693">//&nbsp;The&nbsp;short&nbsp;encoding&nbsp;truncated&nbsp;the&nbsp;output&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925747">//&nbsp;We&nbsp;have&nbsp;to&nbsp;assume&nbsp;the&nbsp;worst&nbsp;case&nbsp;values&nbsp;(digit&nbsp;84)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5925805">//&nbsp;in&nbsp;order&nbsp;to&nbsp;ensure&nbsp;that&nbsp;the&nbsp;top&nbsp;bits&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925862">v</span>&nbsp;<span class="op" id="5925864">=</span>&nbsp;<span class="ident" id="5925866">v</span><span class="op" id="5925867">*</span><span class="num" id="5925868">85</span>&nbsp;<span class="op" id="5925871">+</span>&nbsp;<span class="num" id="5925873">84</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925879">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925884">for</span>&nbsp;<span class="ident" id="5925888">i</span>&nbsp;<span class="op" id="5925890">:=</span>&nbsp;<span class="num" id="5925893">0</span><span class="op" id="5925894">;</span>&nbsp;<span class="ident" id="5925896">i</span>&nbsp;<span class="op" id="5925898">&lt;</span>&nbsp;<span class="ident" id="5925900">nb</span><span class="op" id="5925902">-</span><span class="num" id="5925903">1</span><span class="op" id="5925904">;</span>&nbsp;<span class="ident" id="5925906">i</span><span class="op" id="5925907">++</span>&nbsp;<span class="op" id="5925910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925916">dst</span><span class="op" id="5925919">[</span><span class="ident" id="5925920">ndst</span><span class="op" id="5925924">]</span>&nbsp;<span class="op" id="5925926">=</span>&nbsp;<span class="builtintype" id="5925928">byte</span><span class="op" id="5925932">(</span><span class="ident" id="5925933">v</span>&nbsp;<span class="op" id="5925935">&gt;&gt;</span>&nbsp;<span class="num" id="5925938">24</span><span class="op" id="5925940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925946">v</span>&nbsp;<span class="op" id="5925948">&lt;&lt;=</span>&nbsp;<span class="num" id="5925952">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5925958">ndst</span><span class="op" id="5925962">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925968">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5925975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5925978">return</span><br>
<span class="lineno"></span><span class="op" id="5925985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="5925988">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5926043">func</span>&nbsp;<span class="ident" id="5926048">NewDecoder</span><span class="op" id="5926058">(</span><span class="ident" id="5926059">r</span>&nbsp;<span class="ident" id="5926061">io</span><span class="op" id="5926063">.</span><span class="ident" id="5926064">Reader</span><span class="op" id="5926070">)</span>&nbsp;<span class="ident" id="5926072">io</span><span class="op" id="5926074">.</span><span class="ident" id="5926075">Reader</span>&nbsp;<span class="op" id="5926082">{</span>&nbsp;<span class="keyword" id="5926084">return</span>&nbsp;<span class="op" id="5926091">&amp;</span><span class="ident" id="5926092">decoder</span><span class="op" id="5926099">{</span><span class="ident" id="5926100">r</span><span class="op" id="5926101">:</span>&nbsp;<span class="ident" id="5926103">r</span><span class="op" id="5926104">}</span>&nbsp;<span class="op" id="5926106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5926109">type</span>&nbsp;<span class="ident" id="5926114">decoder</span>&nbsp;<span class="keyword" id="5926122">struct</span>&nbsp;<span class="op" id="5926129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926132">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5926140">error</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926147">readErr</span>&nbsp;<span class="builtintype" id="5926155">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926162">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5926170">io</span><span class="op" id="5926172">.</span><span class="ident" id="5926173">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926181">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5926189">[</span><span class="num" id="5926190">1024</span><span class="op" id="5926194">]</span><span class="builtintype" id="5926195">byte</span>&nbsp;<span class="comment" id="5926200">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926219">nbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5926227">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926232">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5926240">[</span><span class="op" id="5926241">]</span><span class="builtintype" id="5926242">byte</span>&nbsp;<span class="comment" id="5926247">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926275">outbuf</span>&nbsp;&nbsp;<span class="op" id="5926283">[</span><span class="num" id="5926284">1024</span><span class="op" id="5926288">]</span><span class="builtintype" id="5926289">byte</span><br>
<span class="lineno"></span><span class="op" id="5926294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5926297">func</span>&nbsp;<span class="op" id="5926302">(</span><span class="ident" id="5926303">d</span>&nbsp;<span class="op" id="5926305">*</span><span class="ident" id="5926306">decoder</span><span class="op" id="5926313">)</span>&nbsp;<span class="ident" id="5926315">Read</span><span class="op" id="5926319">(</span><span class="ident" id="5926320">p</span>&nbsp;<span class="op" id="5926322">[</span><span class="op" id="5926323">]</span><span class="builtintype" id="5926324">byte</span><span class="op" id="5926328">)</span>&nbsp;<span class="op" id="5926330">(</span><span class="ident" id="5926331">n</span>&nbsp;<span class="builtintype" id="5926333">int</span><span class="op" id="5926336">,</span>&nbsp;<span class="ident" id="5926338">err</span>&nbsp;<span class="builtintype" id="5926342">error</span><span class="op" id="5926347">)</span>&nbsp;<span class="op" id="5926349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926352">if</span>&nbsp;<span class="builtinfunc" id="5926355">len</span><span class="op" id="5926358">(</span><span class="ident" id="5926359">p</span><span class="op" id="5926360">)</span>&nbsp;<span class="op" id="5926362">==</span>&nbsp;<span class="num" id="5926365">0</span>&nbsp;<span class="op" id="5926367">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926371">return</span>&nbsp;<span class="num" id="5926378">0</span><span class="op" id="5926379">,</span>&nbsp;<span class="ident" id="5926381">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926389">if</span>&nbsp;<span class="ident" id="5926392">d</span><span class="op" id="5926393">.</span><span class="ident" id="5926394">err</span>&nbsp;<span class="op" id="5926398">!=</span>&nbsp;<span class="ident" id="5926401">nil</span>&nbsp;<span class="op" id="5926405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926409">return</span>&nbsp;<span class="num" id="5926416">0</span><span class="op" id="5926417">,</span>&nbsp;<span class="ident" id="5926419">d</span><span class="op" id="5926420">.</span><span class="ident" id="5926421">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926426">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926430">for</span>&nbsp;<span class="op" id="5926434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926438">//&nbsp;Copy&nbsp;leftover&nbsp;output&nbsp;from&nbsp;last&nbsp;decode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926482">if</span>&nbsp;<span class="builtinfunc" id="5926485">len</span><span class="op" id="5926488">(</span><span class="ident" id="5926489">d</span><span class="op" id="5926490">.</span><span class="ident" id="5926491">out</span><span class="op" id="5926494">)</span>&nbsp;<span class="op" id="5926496">&gt;</span>&nbsp;<span class="num" id="5926498">0</span>&nbsp;<span class="op" id="5926500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926505">n</span>&nbsp;<span class="op" id="5926507">=</span>&nbsp;<span class="builtinfunc" id="5926509">copy</span><span class="op" id="5926513">(</span><span class="ident" id="5926514">p</span><span class="op" id="5926515">,</span>&nbsp;<span class="ident" id="5926517">d</span><span class="op" id="5926518">.</span><span class="ident" id="5926519">out</span><span class="op" id="5926522">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926527">d</span><span class="op" id="5926528">.</span><span class="ident" id="5926529">out</span>&nbsp;<span class="op" id="5926533">=</span>&nbsp;<span class="ident" id="5926535">d</span><span class="op" id="5926536">.</span><span class="ident" id="5926537">out</span><span class="op" id="5926540">[</span><span class="ident" id="5926541">n</span><span class="op" id="5926542">:</span><span class="op" id="5926543">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926548">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926562">//&nbsp;Decode&nbsp;leftover&nbsp;input&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926605">var</span>&nbsp;<span class="ident" id="5926609">nn</span><span class="op" id="5926611">,</span>&nbsp;<span class="ident" id="5926613">nsrc</span><span class="op" id="5926617">,</span>&nbsp;<span class="ident" id="5926619">ndst</span>&nbsp;<span class="builtintype" id="5926624">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926630">if</span>&nbsp;<span class="ident" id="5926633">d</span><span class="op" id="5926634">.</span><span class="ident" id="5926635">nbuf</span>&nbsp;<span class="op" id="5926640">&gt;</span>&nbsp;<span class="num" id="5926642">0</span>&nbsp;<span class="op" id="5926644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926649">ndst</span><span class="op" id="5926653">,</span>&nbsp;<span class="ident" id="5926655">nsrc</span><span class="op" id="5926659">,</span>&nbsp;<span class="ident" id="5926661">d</span><span class="op" id="5926662">.</span><span class="ident" id="5926663">err</span>&nbsp;<span class="op" id="5926667">=</span>&nbsp;<span class="ident" id="5926669">Decode</span><span class="op" id="5926675">(</span><span class="ident" id="5926676">d</span><span class="op" id="5926677">.</span><span class="ident" id="5926678">outbuf</span><span class="op" id="5926684">[</span><span class="num" id="5926685">0</span><span class="op" id="5926686">:</span><span class="op" id="5926687">]</span><span class="op" id="5926688">,</span>&nbsp;<span class="ident" id="5926690">d</span><span class="op" id="5926691">.</span><span class="ident" id="5926692">buf</span><span class="op" id="5926695">[</span><span class="num" id="5926696">0</span><span class="op" id="5926697">:</span><span class="ident" id="5926698">d</span><span class="op" id="5926699">.</span><span class="ident" id="5926700">nbuf</span><span class="op" id="5926704">]</span><span class="op" id="5926705">,</span>&nbsp;<span class="ident" id="5926707">d</span><span class="op" id="5926708">.</span><span class="ident" id="5926709">readErr</span>&nbsp;<span class="op" id="5926717">!=</span>&nbsp;<span class="ident" id="5926720">nil</span><span class="op" id="5926723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926728">if</span>&nbsp;<span class="ident" id="5926731">ndst</span>&nbsp;<span class="op" id="5926736">&gt;</span>&nbsp;<span class="num" id="5926738">0</span>&nbsp;<span class="op" id="5926740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926746">d</span><span class="op" id="5926747">.</span><span class="ident" id="5926748">out</span>&nbsp;<span class="op" id="5926752">=</span>&nbsp;<span class="ident" id="5926754">d</span><span class="op" id="5926755">.</span><span class="ident" id="5926756">outbuf</span><span class="op" id="5926762">[</span><span class="num" id="5926763">0</span><span class="op" id="5926764">:</span><span class="ident" id="5926765">ndst</span><span class="op" id="5926769">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5926775">d</span><span class="op" id="5926776">.</span><span class="ident" id="5926777">nbuf</span>&nbsp;<span class="op" id="5926782">=</span>&nbsp;<span class="builtinfunc" id="5926784">copy</span><span class="op" id="5926788">(</span><span class="ident" id="5926789">d</span><span class="op" id="5926790">.</span><span class="ident" id="5926791">buf</span><span class="op" id="5926794">[</span><span class="num" id="5926795">0</span><span class="op" id="5926796">:</span><span class="op" id="5926797">]</span><span class="op" id="5926798">,</span>&nbsp;<span class="ident" id="5926800">d</span><span class="op" id="5926801">.</span><span class="ident" id="5926802">buf</span><span class="op" id="5926805">[</span><span class="ident" id="5926806">nsrc</span><span class="op" id="5926810">:</span><span class="ident" id="5926811">d</span><span class="op" id="5926812">.</span><span class="ident" id="5926813">nbuf</span><span class="op" id="5926817">]</span><span class="op" id="5926818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926824">continue</span>&nbsp;<span class="comment" id="5926833">//&nbsp;copy&nbsp;out&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5926859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5926864">if</span>&nbsp;<span class="ident" id="5926867">ndst</span>&nbsp;<span class="op" id="5926872">==</span>&nbsp;<span class="num" id="5926875">0</span>&nbsp;<span class="op" id="5926877">&amp;&amp;</span>&nbsp;<span class="ident" id="5926880">d</span><span class="op" id="5926881">.</span><span class="ident" id="5926882">err</span>&nbsp;<span class="op" id="5926886">==</span>&nbsp;<span class="ident" id="5926889">nil</span>&nbsp;<span class="op" id="5926893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926899">//&nbsp;Special&nbsp;case:&nbsp;input&nbsp;buffer&nbsp;is&nbsp;mostly&nbsp;filled&nbsp;with&nbsp;non-data&nbsp;bytes.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5926971">//&nbsp;Filter&nbsp;out&nbsp;such&nbsp;bytes&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;more&nbsp;input.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927029">off</span>&nbsp;<span class="op" id="5927033">:=</span>&nbsp;<span class="num" id="5927036">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927042">for</span>&nbsp;<span class="ident" id="5927046">i</span>&nbsp;<span class="op" id="5927048">:=</span>&nbsp;<span class="num" id="5927051">0</span><span class="op" id="5927052">;</span>&nbsp;<span class="ident" id="5927054">i</span>&nbsp;<span class="op" id="5927056">&lt;</span>&nbsp;<span class="ident" id="5927058">d</span><span class="op" id="5927059">.</span><span class="ident" id="5927060">nbuf</span><span class="op" id="5927064">;</span>&nbsp;<span class="ident" id="5927066">i</span><span class="op" id="5927067">++</span>&nbsp;<span class="op" id="5927070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927077">if</span>&nbsp;<span class="ident" id="5927080">d</span><span class="op" id="5927081">.</span><span class="ident" id="5927082">buf</span><span class="op" id="5927085">[</span><span class="ident" id="5927086">i</span><span class="op" id="5927087">]</span>&nbsp;<span class="op" id="5927089">&gt;</span>&nbsp;<span class="string" id="5927091">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5927095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927103">d</span><span class="op" id="5927104">.</span><span class="ident" id="5927105">buf</span><span class="op" id="5927108">[</span><span class="ident" id="5927109">off</span><span class="op" id="5927112">]</span>&nbsp;<span class="op" id="5927114">=</span>&nbsp;<span class="ident" id="5927116">d</span><span class="op" id="5927117">.</span><span class="ident" id="5927118">buf</span><span class="op" id="5927121">[</span><span class="ident" id="5927122">i</span><span class="op" id="5927123">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927131">off</span><span class="op" id="5927134">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927154">d</span><span class="op" id="5927155">.</span><span class="ident" id="5927156">nbuf</span>&nbsp;<span class="op" id="5927161">=</span>&nbsp;<span class="ident" id="5927163">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927170">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5927179">//&nbsp;Out&nbsp;of&nbsp;input,&nbsp;out&nbsp;of&nbsp;decoded&nbsp;output.&nbsp;&nbsp;Check&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927236">if</span>&nbsp;<span class="ident" id="5927239">d</span><span class="op" id="5927240">.</span><span class="ident" id="5927241">err</span>&nbsp;<span class="op" id="5927245">!=</span>&nbsp;<span class="ident" id="5927248">nil</span>&nbsp;<span class="op" id="5927252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927257">return</span>&nbsp;<span class="num" id="5927264">0</span><span class="op" id="5927265">,</span>&nbsp;<span class="ident" id="5927267">d</span><span class="op" id="5927268">.</span><span class="ident" id="5927269">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927279">if</span>&nbsp;<span class="ident" id="5927282">d</span><span class="op" id="5927283">.</span><span class="ident" id="5927284">readErr</span>&nbsp;<span class="op" id="5927292">!=</span>&nbsp;<span class="ident" id="5927295">nil</span>&nbsp;<span class="op" id="5927299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927304">d</span><span class="op" id="5927305">.</span><span class="ident" id="5927306">err</span>&nbsp;<span class="op" id="5927310">=</span>&nbsp;<span class="ident" id="5927312">d</span><span class="op" id="5927313">.</span><span class="ident" id="5927314">readErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5927325">return</span>&nbsp;<span class="num" id="5927332">0</span><span class="op" id="5927333">,</span>&nbsp;<span class="ident" id="5927335">d</span><span class="op" id="5927336">.</span><span class="ident" id="5927337">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927343">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5927348">//&nbsp;Read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927369">nn</span><span class="op" id="5927371">,</span>&nbsp;<span class="ident" id="5927373">d</span><span class="op" id="5927374">.</span><span class="ident" id="5927375">readErr</span>&nbsp;<span class="op" id="5927383">=</span>&nbsp;<span class="ident" id="5927385">d</span><span class="op" id="5927386">.</span><span class="ident" id="5927387">r</span><span class="op" id="5927388">.</span><span class="ident" id="5927389">Read</span><span class="op" id="5927393">(</span><span class="ident" id="5927394">d</span><span class="op" id="5927395">.</span><span class="ident" id="5927396">buf</span><span class="op" id="5927399">[</span><span class="ident" id="5927400">d</span><span class="op" id="5927401">.</span><span class="ident" id="5927402">nbuf</span><span class="op" id="5927406">:</span><span class="op" id="5927407">]</span><span class="op" id="5927408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5927412">d</span><span class="op" id="5927413">.</span><span class="ident" id="5927414">nbuf</span>&nbsp;<span class="op" id="5927419">+=</span>&nbsp;<span class="ident" id="5927422">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5927426">}</span><br>
<span class="lineno">310</span><span class="op" id="5927428">}</span>
</div>
</body>
</html>
