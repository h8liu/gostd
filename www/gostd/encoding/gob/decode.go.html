<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3053846">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3053901">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3053955">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3054006">//go:generate&nbsp;go&nbsp;run&nbsp;decgen.go&nbsp;-output&nbsp;dec_helpers.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3054061">package</span>&nbsp;<span class="ident" id="3054069">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3054074">import</span>&nbsp;<span class="op" id="3054081">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3054084">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3054096">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3054106">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3054112">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3054120">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3054130">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3054133">var</span>&nbsp;<span class="op" id="3054137">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054140">errBadUint</span>&nbsp;<span class="op" id="3054151">=</span>&nbsp;<span class="ident" id="3054153">errors</span><span class="op" id="3054159">.</span><span class="ident" id="3054160">New</span><span class="op" id="3054163">(</span><span class="string" id="3054164">&#34;gob:&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="3054208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054211">errBadType</span>&nbsp;<span class="op" id="3054222">=</span>&nbsp;<span class="ident" id="3054224">errors</span><span class="op" id="3054230">.</span><span class="ident" id="3054231">New</span><span class="op" id="3054234">(</span><span class="string" id="3054235">&#34;gob:&nbsp;unknown&nbsp;type&nbsp;id&nbsp;or&nbsp;corrupted&nbsp;data&#34;</span><span class="op" id="3054275">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054278">errRange</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3054289">=</span>&nbsp;<span class="ident" id="3054291">errors</span><span class="op" id="3054297">.</span><span class="ident" id="3054298">New</span><span class="op" id="3054301">(</span><span class="string" id="3054302">&#34;gob:&nbsp;bad&nbsp;data:&nbsp;field&nbsp;numbers&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="3054346">)</span><br>
<span class="lineno"></span><span class="op" id="3054348">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3054351">type</span>&nbsp;<span class="ident" id="3054356">decHelper</span>&nbsp;<span class="keyword" id="3054366">func</span><span class="op" id="3054370">(</span><span class="ident" id="3054371">state</span>&nbsp;<span class="op" id="3054377">*</span><span class="ident" id="3054378">decoderState</span><span class="op" id="3054390">,</span>&nbsp;<span class="ident" id="3054392">v</span>&nbsp;<span class="ident" id="3054394">reflect</span><span class="op" id="3054401">.</span><span class="ident" id="3054402">Value</span><span class="op" id="3054407">,</span>&nbsp;<span class="ident" id="3054409">length</span>&nbsp;<span class="builtintype" id="3054416">int</span><span class="op" id="3054419">,</span>&nbsp;<span class="ident" id="3054421">ovfl</span>&nbsp;<span class="builtintype" id="3054426">error</span><span class="op" id="3054431">)</span>&nbsp;<span class="builtintype" id="3054433">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3054439">//&nbsp;decoderState&nbsp;is&nbsp;the&nbsp;execution&nbsp;state&nbsp;of&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;decoder.&nbsp;A&nbsp;new&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="3054521">//&nbsp;is&nbsp;created&nbsp;for&nbsp;nested&nbsp;objects.</span><br>
<span class="lineno"></span><span class="keyword" id="3054555">type</span>&nbsp;<span class="ident" id="3054560">decoderState</span>&nbsp;<span class="keyword" id="3054573">struct</span>&nbsp;<span class="op" id="3054580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054583">dec</span>&nbsp;<span class="op" id="3054587">*</span><span class="ident" id="3054588">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3054597">//&nbsp;The&nbsp;buffer&nbsp;is&nbsp;stored&nbsp;with&nbsp;an&nbsp;extra&nbsp;indirection&nbsp;because&nbsp;it&nbsp;may&nbsp;be&nbsp;replaced</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3054675">//&nbsp;if&nbsp;we&nbsp;load&nbsp;a&nbsp;type&nbsp;during&nbsp;decode&nbsp;(when&nbsp;reading&nbsp;an&nbsp;interface&nbsp;value).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054746">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3054755">*</span><span class="ident" id="3054756">decBuffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054767">fieldnum</span>&nbsp;<span class="builtintype" id="3054776">int</span>&nbsp;<span class="comment" id="3054780">//&nbsp;the&nbsp;last&nbsp;field&nbsp;number&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054812">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3054821">[</span><span class="op" id="3054822">]</span><span class="builtintype" id="3054823">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3054829">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3054838">*</span><span class="ident" id="3054839">decoderState</span>&nbsp;<span class="comment" id="3054852">//&nbsp;for&nbsp;free&nbsp;list</span><br>
<span class="lineno">35</span><span class="op" id="3054869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3054872">//&nbsp;decBuffer&nbsp;is&nbsp;an&nbsp;extremely&nbsp;simple,&nbsp;fast&nbsp;implementation&nbsp;of&nbsp;a&nbsp;read-only&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3054957">//&nbsp;It&nbsp;is&nbsp;initialized&nbsp;by&nbsp;calling&nbsp;Size&nbsp;and&nbsp;then&nbsp;copying&nbsp;the&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;Bytes().</span><br>
<span class="lineno"></span><span class="keyword" id="3055056">type</span>&nbsp;<span class="ident" id="3055061">decBuffer</span>&nbsp;<span class="keyword" id="3055071">struct</span>&nbsp;<span class="op" id="3055078">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055081">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3055088">[</span><span class="op" id="3055089">]</span><span class="builtintype" id="3055090">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055096">offset</span>&nbsp;<span class="builtintype" id="3055103">int</span>&nbsp;<span class="comment" id="3055107">//&nbsp;Read&nbsp;offset.</span><br>
<span class="lineno"></span><span class="op" id="3055123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3055126">func</span>&nbsp;<span class="op" id="3055131">(</span><span class="ident" id="3055132">d</span>&nbsp;<span class="op" id="3055134">*</span><span class="ident" id="3055135">decBuffer</span><span class="op" id="3055144">)</span>&nbsp;<span class="ident" id="3055146">Read</span><span class="op" id="3055150">(</span><span class="ident" id="3055151">p</span>&nbsp;<span class="op" id="3055153">[</span><span class="op" id="3055154">]</span><span class="builtintype" id="3055155">byte</span><span class="op" id="3055159">)</span>&nbsp;<span class="op" id="3055161">(</span><span class="builtintype" id="3055162">int</span><span class="op" id="3055165">,</span>&nbsp;<span class="builtintype" id="3055167">error</span><span class="op" id="3055172">)</span>&nbsp;<span class="op" id="3055174">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055177">n</span>&nbsp;<span class="op" id="3055179">:=</span>&nbsp;<span class="builtinfunc" id="3055182">copy</span><span class="op" id="3055186">(</span><span class="ident" id="3055187">p</span><span class="op" id="3055188">,</span>&nbsp;<span class="ident" id="3055190">d</span><span class="op" id="3055191">.</span><span class="ident" id="3055192">data</span><span class="op" id="3055196">[</span><span class="ident" id="3055197">d</span><span class="op" id="3055198">.</span><span class="ident" id="3055199">offset</span><span class="op" id="3055205">:</span><span class="op" id="3055206">]</span><span class="op" id="3055207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055210">if</span>&nbsp;<span class="ident" id="3055213">n</span>&nbsp;<span class="op" id="3055215">==</span>&nbsp;<span class="num" id="3055218">0</span>&nbsp;<span class="op" id="3055220">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3055223">len</span><span class="op" id="3055226">(</span><span class="ident" id="3055227">p</span><span class="op" id="3055228">)</span>&nbsp;<span class="op" id="3055230">!=</span>&nbsp;<span class="num" id="3055233">0</span>&nbsp;<span class="op" id="3055235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055239">return</span>&nbsp;<span class="num" id="3055246">0</span><span class="op" id="3055247">,</span>&nbsp;<span class="ident" id="3055249">io</span><span class="op" id="3055251">.</span><span class="ident" id="3055252">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055260">d</span><span class="op" id="3055261">.</span><span class="ident" id="3055262">offset</span>&nbsp;<span class="op" id="3055269">+=</span>&nbsp;<span class="ident" id="3055272">n</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055275">return</span>&nbsp;<span class="ident" id="3055282">n</span><span class="op" id="3055283">,</span>&nbsp;<span class="ident" id="3055285">nil</span><br>
<span class="lineno"></span><span class="op" id="3055289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3055292">func</span>&nbsp;<span class="op" id="3055297">(</span><span class="ident" id="3055298">d</span>&nbsp;<span class="op" id="3055300">*</span><span class="ident" id="3055301">decBuffer</span><span class="op" id="3055310">)</span>&nbsp;<span class="ident" id="3055312">Drop</span><span class="op" id="3055316">(</span><span class="ident" id="3055317">n</span>&nbsp;<span class="builtintype" id="3055319">int</span><span class="op" id="3055322">)</span>&nbsp;<span class="op" id="3055324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055327">if</span>&nbsp;<span class="ident" id="3055330">n</span>&nbsp;<span class="op" id="3055332">&gt;</span>&nbsp;<span class="ident" id="3055334">d</span><span class="op" id="3055335">.</span><span class="ident" id="3055336">Len</span><span class="op" id="3055339">(</span><span class="op" id="3055340">)</span>&nbsp;<span class="op" id="3055342">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3055346">panic</span><span class="op" id="3055351">(</span><span class="string" id="3055352">&#34;drop&#34;</span><span class="op" id="3055358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055364">d</span><span class="op" id="3055365">.</span><span class="ident" id="3055366">offset</span>&nbsp;<span class="op" id="3055373">+=</span>&nbsp;<span class="ident" id="3055376">n</span><br>
<span class="lineno"></span><span class="op" id="3055378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3055381">//&nbsp;Size&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;exactly&nbsp;n&nbsp;bytes,&nbsp;so&nbsp;d.Bytes()&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="3055444">//&nbsp;return&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n.&nbsp;Existing&nbsp;data&nbsp;is&nbsp;first&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="3055509">func</span>&nbsp;<span class="op" id="3055514">(</span><span class="ident" id="3055515">d</span>&nbsp;<span class="op" id="3055517">*</span><span class="ident" id="3055518">decBuffer</span><span class="op" id="3055527">)</span>&nbsp;<span class="ident" id="3055529">Size</span><span class="op" id="3055533">(</span><span class="ident" id="3055534">n</span>&nbsp;<span class="builtintype" id="3055536">int</span><span class="op" id="3055539">)</span>&nbsp;<span class="op" id="3055541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055544">d</span><span class="op" id="3055545">.</span><span class="ident" id="3055546">Reset</span><span class="op" id="3055551">(</span><span class="op" id="3055552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055555">if</span>&nbsp;<span class="builtinfunc" id="3055558">cap</span><span class="op" id="3055561">(</span><span class="ident" id="3055562">d</span><span class="op" id="3055563">.</span><span class="ident" id="3055564">data</span><span class="op" id="3055568">)</span>&nbsp;<span class="op" id="3055570">&lt;</span>&nbsp;<span class="ident" id="3055572">n</span>&nbsp;<span class="op" id="3055574">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055578">d</span><span class="op" id="3055579">.</span><span class="ident" id="3055580">data</span>&nbsp;<span class="op" id="3055585">=</span>&nbsp;<span class="builtinfunc" id="3055587">make</span><span class="op" id="3055591">(</span><span class="op" id="3055592">[</span><span class="op" id="3055593">]</span><span class="builtintype" id="3055594">byte</span><span class="op" id="3055598">,</span>&nbsp;<span class="ident" id="3055600">n</span><span class="op" id="3055601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055604">}</span>&nbsp;<span class="keyword" id="3055606">else</span>&nbsp;<span class="op" id="3055611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055615">d</span><span class="op" id="3055616">.</span><span class="ident" id="3055617">data</span>&nbsp;<span class="op" id="3055622">=</span>&nbsp;<span class="ident" id="3055624">d</span><span class="op" id="3055625">.</span><span class="ident" id="3055626">data</span><span class="op" id="3055630">[</span><span class="num" id="3055631">0</span><span class="op" id="3055632">:</span><span class="ident" id="3055633">n</span><span class="op" id="3055634">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055637">}</span><br>
<span class="lineno"></span><span class="op" id="3055639">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3055642">func</span>&nbsp;<span class="op" id="3055647">(</span><span class="ident" id="3055648">d</span>&nbsp;<span class="op" id="3055650">*</span><span class="ident" id="3055651">decBuffer</span><span class="op" id="3055660">)</span>&nbsp;<span class="ident" id="3055662">ReadByte</span><span class="op" id="3055670">(</span><span class="op" id="3055671">)</span>&nbsp;<span class="op" id="3055673">(</span><span class="builtintype" id="3055674">byte</span><span class="op" id="3055678">,</span>&nbsp;<span class="builtintype" id="3055680">error</span><span class="op" id="3055685">)</span>&nbsp;<span class="op" id="3055687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055690">if</span>&nbsp;<span class="ident" id="3055693">d</span><span class="op" id="3055694">.</span><span class="ident" id="3055695">offset</span>&nbsp;<span class="op" id="3055702">&gt;=</span>&nbsp;<span class="builtinfunc" id="3055705">len</span><span class="op" id="3055708">(</span><span class="ident" id="3055709">d</span><span class="op" id="3055710">.</span><span class="ident" id="3055711">data</span><span class="op" id="3055715">)</span>&nbsp;<span class="op" id="3055717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055721">return</span>&nbsp;<span class="num" id="3055728">0</span><span class="op" id="3055729">,</span>&nbsp;<span class="ident" id="3055731">io</span><span class="op" id="3055733">.</span><span class="ident" id="3055734">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055739">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055742">c</span>&nbsp;<span class="op" id="3055744">:=</span>&nbsp;<span class="ident" id="3055747">d</span><span class="op" id="3055748">.</span><span class="ident" id="3055749">data</span><span class="op" id="3055753">[</span><span class="ident" id="3055754">d</span><span class="op" id="3055755">.</span><span class="ident" id="3055756">offset</span><span class="op" id="3055762">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055765">d</span><span class="op" id="3055766">.</span><span class="ident" id="3055767">offset</span><span class="op" id="3055773">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055777">return</span>&nbsp;<span class="ident" id="3055784">c</span><span class="op" id="3055785">,</span>&nbsp;<span class="ident" id="3055787">nil</span><br>
<span class="lineno"></span><span class="op" id="3055791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="3055794">func</span>&nbsp;<span class="op" id="3055799">(</span><span class="ident" id="3055800">d</span>&nbsp;<span class="op" id="3055802">*</span><span class="ident" id="3055803">decBuffer</span><span class="op" id="3055812">)</span>&nbsp;<span class="ident" id="3055814">Len</span><span class="op" id="3055817">(</span><span class="op" id="3055818">)</span>&nbsp;<span class="builtintype" id="3055820">int</span>&nbsp;<span class="op" id="3055824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055827">return</span>&nbsp;<span class="builtinfunc" id="3055834">len</span><span class="op" id="3055837">(</span><span class="ident" id="3055838">d</span><span class="op" id="3055839">.</span><span class="ident" id="3055840">data</span><span class="op" id="3055844">)</span>&nbsp;<span class="op" id="3055846">-</span>&nbsp;<span class="ident" id="3055848">d</span><span class="op" id="3055849">.</span><span class="ident" id="3055850">offset</span><br>
<span class="lineno"></span><span class="op" id="3055857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3055860">func</span>&nbsp;<span class="op" id="3055865">(</span><span class="ident" id="3055866">d</span>&nbsp;<span class="op" id="3055868">*</span><span class="ident" id="3055869">decBuffer</span><span class="op" id="3055878">)</span>&nbsp;<span class="ident" id="3055880">Bytes</span><span class="op" id="3055885">(</span><span class="op" id="3055886">)</span>&nbsp;<span class="op" id="3055888">[</span><span class="op" id="3055889">]</span><span class="builtintype" id="3055890">byte</span>&nbsp;<span class="op" id="3055895">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055898">return</span>&nbsp;<span class="ident" id="3055905">d</span><span class="op" id="3055906">.</span><span class="ident" id="3055907">data</span><span class="op" id="3055911">[</span><span class="ident" id="3055912">d</span><span class="op" id="3055913">.</span><span class="ident" id="3055914">offset</span><span class="op" id="3055920">:</span><span class="op" id="3055921">]</span><br>
<span class="lineno"></span><span class="op" id="3055923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3055926">func</span>&nbsp;<span class="op" id="3055931">(</span><span class="ident" id="3055932">d</span>&nbsp;<span class="op" id="3055934">*</span><span class="ident" id="3055935">decBuffer</span><span class="op" id="3055944">)</span>&nbsp;<span class="ident" id="3055946">Reset</span><span class="op" id="3055951">(</span><span class="op" id="3055952">)</span>&nbsp;<span class="op" id="3055954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055957">d</span><span class="op" id="3055958">.</span><span class="ident" id="3055959">data</span>&nbsp;<span class="op" id="3055964">=</span>&nbsp;<span class="ident" id="3055966">d</span><span class="op" id="3055967">.</span><span class="ident" id="3055968">data</span><span class="op" id="3055972">[</span><span class="num" id="3055973">0</span><span class="op" id="3055974">:</span><span class="num" id="3055975">0</span><span class="op" id="3055976">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055979">d</span><span class="op" id="3055980">.</span><span class="ident" id="3055981">offset</span>&nbsp;<span class="op" id="3055988">=</span>&nbsp;<span class="num" id="3055990">0</span><br>
<span class="lineno"></span><span class="op" id="3055992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3055995">//&nbsp;We&nbsp;pass&nbsp;the&nbsp;bytes.Buffer&nbsp;separately&nbsp;for&nbsp;easier&nbsp;testing&nbsp;of&nbsp;the&nbsp;infrastructure</span><br>
<span class="lineno"></span><span class="comment" id="3056075">//&nbsp;without&nbsp;requiring&nbsp;a&nbsp;full&nbsp;Decoder.</span><br>
<span class="lineno">95</span><span class="keyword" id="3056112">func</span>&nbsp;<span class="op" id="3056117">(</span><span class="ident" id="3056118">dec</span>&nbsp;<span class="op" id="3056122">*</span><span class="ident" id="3056123">Decoder</span><span class="op" id="3056130">)</span>&nbsp;<span class="ident" id="3056132">newDecoderState</span><span class="op" id="3056147">(</span><span class="ident" id="3056148">buf</span>&nbsp;<span class="op" id="3056152">*</span><span class="ident" id="3056153">decBuffer</span><span class="op" id="3056162">)</span>&nbsp;<span class="op" id="3056164">*</span><span class="ident" id="3056165">decoderState</span>&nbsp;<span class="op" id="3056178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056181">d</span>&nbsp;<span class="op" id="3056183">:=</span>&nbsp;<span class="ident" id="3056186">dec</span><span class="op" id="3056189">.</span><span class="ident" id="3056190">freeList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056200">if</span>&nbsp;<span class="ident" id="3056203">d</span>&nbsp;<span class="op" id="3056205">==</span>&nbsp;<span class="ident" id="3056208">nil</span>&nbsp;<span class="op" id="3056212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056216">d</span>&nbsp;<span class="op" id="3056218">=</span>&nbsp;<span class="builtinfunc" id="3056220">new</span><span class="op" id="3056223">(</span><span class="ident" id="3056224">decoderState</span><span class="op" id="3056236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056240">d</span><span class="op" id="3056241">.</span><span class="ident" id="3056242">dec</span>&nbsp;<span class="op" id="3056246">=</span>&nbsp;<span class="ident" id="3056248">dec</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056254">d</span><span class="op" id="3056255">.</span><span class="ident" id="3056256">buf</span>&nbsp;<span class="op" id="3056260">=</span>&nbsp;<span class="builtinfunc" id="3056262">make</span><span class="op" id="3056266">(</span><span class="op" id="3056267">[</span><span class="op" id="3056268">]</span><span class="builtintype" id="3056269">byte</span><span class="op" id="3056273">,</span>&nbsp;<span class="ident" id="3056275">uint64Size</span><span class="op" id="3056285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056288">}</span>&nbsp;<span class="keyword" id="3056290">else</span>&nbsp;<span class="op" id="3056295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056299">dec</span><span class="op" id="3056302">.</span><span class="ident" id="3056303">freeList</span>&nbsp;<span class="op" id="3056312">=</span>&nbsp;<span class="ident" id="3056314">d</span><span class="op" id="3056315">.</span><span class="ident" id="3056316">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056325">d</span><span class="op" id="3056326">.</span><span class="ident" id="3056327">b</span>&nbsp;<span class="op" id="3056329">=</span>&nbsp;<span class="ident" id="3056331">buf</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056336">return</span>&nbsp;<span class="ident" id="3056343">d</span><br>
<span class="lineno"></span><span class="op" id="3056345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3056348">func</span>&nbsp;<span class="op" id="3056353">(</span><span class="ident" id="3056354">dec</span>&nbsp;<span class="op" id="3056358">*</span><span class="ident" id="3056359">Decoder</span><span class="op" id="3056366">)</span>&nbsp;<span class="ident" id="3056368">freeDecoderState</span><span class="op" id="3056384">(</span><span class="ident" id="3056385">d</span>&nbsp;<span class="op" id="3056387">*</span><span class="ident" id="3056388">decoderState</span><span class="op" id="3056400">)</span>&nbsp;<span class="op" id="3056402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056405">d</span><span class="op" id="3056406">.</span><span class="ident" id="3056407">next</span>&nbsp;<span class="op" id="3056412">=</span>&nbsp;<span class="ident" id="3056414">dec</span><span class="op" id="3056417">.</span><span class="ident" id="3056418">freeList</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056428">dec</span><span class="op" id="3056431">.</span><span class="ident" id="3056432">freeList</span>&nbsp;<span class="op" id="3056441">=</span>&nbsp;<span class="ident" id="3056443">d</span><br>
<span class="lineno"></span><span class="op" id="3056445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3056448">func</span>&nbsp;<span class="ident" id="3056453">overflow</span><span class="op" id="3056461">(</span><span class="ident" id="3056462">name</span>&nbsp;<span class="builtintype" id="3056467">string</span><span class="op" id="3056473">)</span>&nbsp;<span class="builtintype" id="3056475">error</span>&nbsp;<span class="op" id="3056481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056484">return</span>&nbsp;<span class="ident" id="3056491">errors</span><span class="op" id="3056497">.</span><span class="ident" id="3056498">New</span><span class="op" id="3056501">(</span><span class="string" id="3056502">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="3056516">+</span>&nbsp;<span class="ident" id="3056518">name</span>&nbsp;<span class="op" id="3056523">+</span>&nbsp;<span class="string" id="3056525">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="3056541">)</span><br>
<span class="lineno">115</span><span class="op" id="3056543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3056546">//&nbsp;decodeUintReader&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;an&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="3056619">//&nbsp;Used&nbsp;only&nbsp;by&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;read&nbsp;the&nbsp;message&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="3056675">func</span>&nbsp;<span class="ident" id="3056680">decodeUintReader</span><span class="op" id="3056696">(</span><span class="ident" id="3056697">r</span>&nbsp;<span class="ident" id="3056699">io</span><span class="op" id="3056701">.</span><span class="ident" id="3056702">Reader</span><span class="op" id="3056708">,</span>&nbsp;<span class="ident" id="3056710">buf</span>&nbsp;<span class="op" id="3056714">[</span><span class="op" id="3056715">]</span><span class="builtintype" id="3056716">byte</span><span class="op" id="3056720">)</span>&nbsp;<span class="op" id="3056722">(</span><span class="ident" id="3056723">x</span>&nbsp;<span class="ident" id="3056725">uint64</span><span class="op" id="3056731">,</span>&nbsp;<span class="ident" id="3056733">width</span>&nbsp;<span class="builtintype" id="3056739">int</span><span class="op" id="3056742">,</span>&nbsp;<span class="ident" id="3056744">err</span>&nbsp;<span class="builtintype" id="3056748">error</span><span class="op" id="3056753">)</span>&nbsp;<span class="op" id="3056755">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056758">width</span>&nbsp;<span class="op" id="3056764">=</span>&nbsp;<span class="num" id="3056766">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056769">n</span><span class="op" id="3056770">,</span>&nbsp;<span class="ident" id="3056772">err</span>&nbsp;<span class="op" id="3056776">:=</span>&nbsp;<span class="ident" id="3056779">io</span><span class="op" id="3056781">.</span><span class="ident" id="3056782">ReadFull</span><span class="op" id="3056790">(</span><span class="ident" id="3056791">r</span><span class="op" id="3056792">,</span>&nbsp;<span class="ident" id="3056794">buf</span><span class="op" id="3056797">[</span><span class="num" id="3056798">0</span><span class="op" id="3056799">:</span><span class="ident" id="3056800">width</span><span class="op" id="3056805">]</span><span class="op" id="3056806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056809">if</span>&nbsp;<span class="ident" id="3056812">n</span>&nbsp;<span class="op" id="3056814">==</span>&nbsp;<span class="num" id="3056817">0</span>&nbsp;<span class="op" id="3056819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056823">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056831">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056834">b</span>&nbsp;<span class="op" id="3056836">:=</span>&nbsp;<span class="ident" id="3056839">buf</span><span class="op" id="3056842">[</span><span class="num" id="3056843">0</span><span class="op" id="3056844">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056847">if</span>&nbsp;<span class="ident" id="3056850">b</span>&nbsp;<span class="op" id="3056852">&lt;=</span>&nbsp;<span class="num" id="3056855">0x7f</span>&nbsp;<span class="op" id="3056860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056864">return</span>&nbsp;<span class="ident" id="3056871">uint64</span><span class="op" id="3056877">(</span><span class="ident" id="3056878">b</span><span class="op" id="3056879">)</span><span class="op" id="3056880">,</span>&nbsp;<span class="ident" id="3056882">width</span><span class="op" id="3056887">,</span>&nbsp;<span class="ident" id="3056889">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056897">n</span>&nbsp;<span class="op" id="3056899">=</span>&nbsp;<span class="op" id="3056901">-</span><span class="builtintype" id="3056902">int</span><span class="op" id="3056905">(</span><span class="builtintype" id="3056906">int8</span><span class="op" id="3056910">(</span><span class="ident" id="3056911">b</span><span class="op" id="3056912">)</span><span class="op" id="3056913">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056916">if</span>&nbsp;<span class="ident" id="3056919">n</span>&nbsp;<span class="op" id="3056921">&gt;</span>&nbsp;<span class="ident" id="3056923">uint64Size</span>&nbsp;<span class="op" id="3056934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056938">err</span>&nbsp;<span class="op" id="3056942">=</span>&nbsp;<span class="ident" id="3056944">errBadUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056957">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056968">width</span><span class="op" id="3056973">,</span>&nbsp;<span class="ident" id="3056975">err</span>&nbsp;<span class="op" id="3056979">=</span>&nbsp;<span class="ident" id="3056981">io</span><span class="op" id="3056983">.</span><span class="ident" id="3056984">ReadFull</span><span class="op" id="3056992">(</span><span class="ident" id="3056993">r</span><span class="op" id="3056994">,</span>&nbsp;<span class="ident" id="3056996">buf</span><span class="op" id="3056999">[</span><span class="num" id="3057000">0</span><span class="op" id="3057001">:</span><span class="ident" id="3057002">n</span><span class="op" id="3057003">]</span><span class="op" id="3057004">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057007">if</span>&nbsp;<span class="ident" id="3057010">err</span>&nbsp;<span class="op" id="3057014">!=</span>&nbsp;<span class="ident" id="3057017">nil</span>&nbsp;<span class="op" id="3057021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057025">if</span>&nbsp;<span class="ident" id="3057028">err</span>&nbsp;<span class="op" id="3057032">==</span>&nbsp;<span class="ident" id="3057035">io</span><span class="op" id="3057037">.</span><span class="ident" id="3057038">EOF</span>&nbsp;<span class="op" id="3057042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057047">err</span>&nbsp;<span class="op" id="3057051">=</span>&nbsp;<span class="ident" id="3057053">io</span><span class="op" id="3057055">.</span><span class="ident" id="3057056">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057079">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3057090">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057156">for</span>&nbsp;<span class="ident" id="3057160">_</span><span class="op" id="3057161">,</span>&nbsp;<span class="ident" id="3057163">b</span>&nbsp;<span class="op" id="3057165">:=</span>&nbsp;<span class="keyword" id="3057168">range</span>&nbsp;<span class="ident" id="3057174">buf</span><span class="op" id="3057177">[</span><span class="num" id="3057178">0</span><span class="op" id="3057179">:</span><span class="ident" id="3057180">width</span><span class="op" id="3057185">]</span>&nbsp;<span class="op" id="3057187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057191">x</span>&nbsp;<span class="op" id="3057193">=</span>&nbsp;<span class="ident" id="3057195">x</span><span class="op" id="3057196">&lt;&lt;</span><span class="num" id="3057198">8</span>&nbsp;<span class="op" id="3057200">|</span>&nbsp;<span class="ident" id="3057202">uint64</span><span class="op" id="3057208">(</span><span class="ident" id="3057209">b</span><span class="op" id="3057210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057213">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057216">width</span><span class="op" id="3057221">++</span>&nbsp;<span class="comment" id="3057224">//&nbsp;+1&nbsp;for&nbsp;length&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057247">return</span><br>
<span class="lineno"></span><span class="op" id="3057254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3057257">//&nbsp;decodeUint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno">150</span><span class="comment" id="3057319">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="3057351">func</span>&nbsp;<span class="op" id="3057356">(</span><span class="ident" id="3057357">state</span>&nbsp;<span class="op" id="3057363">*</span><span class="ident" id="3057364">decoderState</span><span class="op" id="3057376">)</span>&nbsp;<span class="ident" id="3057378">decodeUint</span><span class="op" id="3057388">(</span><span class="op" id="3057389">)</span>&nbsp;<span class="op" id="3057391">(</span><span class="ident" id="3057392">x</span>&nbsp;<span class="ident" id="3057394">uint64</span><span class="op" id="3057400">)</span>&nbsp;<span class="op" id="3057402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057405">b</span><span class="op" id="3057406">,</span>&nbsp;<span class="ident" id="3057408">err</span>&nbsp;<span class="op" id="3057412">:=</span>&nbsp;<span class="ident" id="3057415">state</span><span class="op" id="3057420">.</span><span class="ident" id="3057421">b</span><span class="op" id="3057422">.</span><span class="ident" id="3057423">ReadByte</span><span class="op" id="3057431">(</span><span class="op" id="3057432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057435">if</span>&nbsp;<span class="ident" id="3057438">err</span>&nbsp;<span class="op" id="3057442">!=</span>&nbsp;<span class="ident" id="3057445">nil</span>&nbsp;<span class="op" id="3057449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057453">error_</span><span class="op" id="3057459">(</span><span class="ident" id="3057460">err</span><span class="op" id="3057463">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057469">if</span>&nbsp;<span class="ident" id="3057472">b</span>&nbsp;<span class="op" id="3057474">&lt;=</span>&nbsp;<span class="num" id="3057477">0x7f</span>&nbsp;<span class="op" id="3057482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057486">return</span>&nbsp;<span class="ident" id="3057493">uint64</span><span class="op" id="3057499">(</span><span class="ident" id="3057500">b</span><span class="op" id="3057501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057507">n</span>&nbsp;<span class="op" id="3057509">:=</span>&nbsp;<span class="op" id="3057512">-</span><span class="builtintype" id="3057513">int</span><span class="op" id="3057516">(</span><span class="builtintype" id="3057517">int8</span><span class="op" id="3057521">(</span><span class="ident" id="3057522">b</span><span class="op" id="3057523">)</span><span class="op" id="3057524">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057527">if</span>&nbsp;<span class="ident" id="3057530">n</span>&nbsp;<span class="op" id="3057532">&gt;</span>&nbsp;<span class="ident" id="3057534">uint64Size</span>&nbsp;<span class="op" id="3057545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057549">error_</span><span class="op" id="3057555">(</span><span class="ident" id="3057556">errBadUint</span><span class="op" id="3057566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057572">width</span><span class="op" id="3057577">,</span>&nbsp;<span class="ident" id="3057579">err</span>&nbsp;<span class="op" id="3057583">:=</span>&nbsp;<span class="ident" id="3057586">state</span><span class="op" id="3057591">.</span><span class="ident" id="3057592">b</span><span class="op" id="3057593">.</span><span class="ident" id="3057594">Read</span><span class="op" id="3057598">(</span><span class="ident" id="3057599">state</span><span class="op" id="3057604">.</span><span class="ident" id="3057605">buf</span><span class="op" id="3057608">[</span><span class="num" id="3057609">0</span><span class="op" id="3057610">:</span><span class="ident" id="3057611">n</span><span class="op" id="3057612">]</span><span class="op" id="3057613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057616">if</span>&nbsp;<span class="ident" id="3057619">err</span>&nbsp;<span class="op" id="3057623">!=</span>&nbsp;<span class="ident" id="3057626">nil</span>&nbsp;<span class="op" id="3057630">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057634">error_</span><span class="op" id="3057640">(</span><span class="ident" id="3057641">err</span><span class="op" id="3057644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3057650">//&nbsp;Don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;error;&nbsp;it&#39;s&nbsp;safe&nbsp;to&nbsp;loop&nbsp;regardless.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3057711">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057777">for</span>&nbsp;<span class="ident" id="3057781">_</span><span class="op" id="3057782">,</span>&nbsp;<span class="ident" id="3057784">b</span>&nbsp;<span class="op" id="3057786">:=</span>&nbsp;<span class="keyword" id="3057789">range</span>&nbsp;<span class="ident" id="3057795">state</span><span class="op" id="3057800">.</span><span class="ident" id="3057801">buf</span><span class="op" id="3057804">[</span><span class="num" id="3057805">0</span><span class="op" id="3057806">:</span><span class="ident" id="3057807">width</span><span class="op" id="3057812">]</span>&nbsp;<span class="op" id="3057814">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057818">x</span>&nbsp;<span class="op" id="3057820">=</span>&nbsp;<span class="ident" id="3057822">x</span><span class="op" id="3057823">&lt;&lt;</span><span class="num" id="3057825">8</span>&nbsp;<span class="op" id="3057827">|</span>&nbsp;<span class="ident" id="3057829">uint64</span><span class="op" id="3057835">(</span><span class="ident" id="3057836">b</span><span class="op" id="3057837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057843">return</span>&nbsp;<span class="ident" id="3057850">x</span><br>
<span class="lineno"></span><span class="op" id="3057852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="3057855">//&nbsp;decodeInt&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno"></span><span class="comment" id="3057914">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="3057946">func</span>&nbsp;<span class="op" id="3057951">(</span><span class="ident" id="3057952">state</span>&nbsp;<span class="op" id="3057958">*</span><span class="ident" id="3057959">decoderState</span><span class="op" id="3057971">)</span>&nbsp;<span class="ident" id="3057973">decodeInt</span><span class="op" id="3057982">(</span><span class="op" id="3057983">)</span>&nbsp;<span class="ident" id="3057985">int64</span>&nbsp;<span class="op" id="3057991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057994">x</span>&nbsp;<span class="op" id="3057996">:=</span>&nbsp;<span class="ident" id="3057999">state</span><span class="op" id="3058004">.</span><span class="ident" id="3058005">decodeUint</span><span class="op" id="3058015">(</span><span class="op" id="3058016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058019">if</span>&nbsp;<span class="ident" id="3058022">x</span><span class="op" id="3058023">&amp;</span><span class="num" id="3058024">1</span>&nbsp;<span class="op" id="3058026">!=</span>&nbsp;<span class="num" id="3058029">0</span>&nbsp;<span class="op" id="3058031">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058035">return</span>&nbsp;<span class="op" id="3058042">^</span><span class="ident" id="3058043">int64</span><span class="op" id="3058048">(</span><span class="ident" id="3058049">x</span>&nbsp;<span class="op" id="3058051">&gt;&gt;</span>&nbsp;<span class="num" id="3058054">1</span><span class="op" id="3058055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3058058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058061">return</span>&nbsp;<span class="ident" id="3058068">int64</span><span class="op" id="3058073">(</span><span class="ident" id="3058074">x</span>&nbsp;<span class="op" id="3058076">&gt;&gt;</span>&nbsp;<span class="num" id="3058079">1</span><span class="op" id="3058080">)</span><br>
<span class="lineno"></span><span class="op" id="3058082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3058085">//&nbsp;decOp&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;a&nbsp;decoding&nbsp;operator&nbsp;for&nbsp;a&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="3058152">type</span>&nbsp;<span class="ident" id="3058157">decOp</span>&nbsp;<span class="keyword" id="3058163">func</span><span class="op" id="3058167">(</span><span class="ident" id="3058168">i</span>&nbsp;<span class="op" id="3058170">*</span><span class="ident" id="3058171">decInstr</span><span class="op" id="3058179">,</span>&nbsp;<span class="ident" id="3058181">state</span>&nbsp;<span class="op" id="3058187">*</span><span class="ident" id="3058188">decoderState</span><span class="op" id="3058200">,</span>&nbsp;<span class="ident" id="3058202">v</span>&nbsp;<span class="ident" id="3058204">reflect</span><span class="op" id="3058211">.</span><span class="ident" id="3058212">Value</span><span class="op" id="3058217">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3058220">//&nbsp;The&nbsp;&#39;instructions&#39;&nbsp;of&nbsp;the&nbsp;decoding&nbsp;machine</span><br>
<span class="lineno"></span><span class="keyword" id="3058266">type</span>&nbsp;<span class="ident" id="3058271">decInstr</span>&nbsp;<span class="keyword" id="3058280">struct</span>&nbsp;<span class="op" id="3058287">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058290">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3058296">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058303">field</span>&nbsp;<span class="builtintype" id="3058309">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3058315">//&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;wire&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058349">index</span>&nbsp;<span class="op" id="3058355">[</span><span class="op" id="3058356">]</span><span class="builtintype" id="3058357">int</span>&nbsp;<span class="comment" id="3058361">//&nbsp;field&nbsp;access&nbsp;indices&nbsp;for&nbsp;destination&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058407">ovfl</span>&nbsp;&nbsp;<span class="builtintype" id="3058413">error</span>&nbsp;<span class="comment" id="3058419">//&nbsp;error&nbsp;message&nbsp;for&nbsp;overflow/underflow&nbsp;(for&nbsp;arrays,&nbsp;of&nbsp;the&nbsp;elements)</span><br>
<span class="lineno"></span><span class="op" id="3058489">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="3058492">//&nbsp;ignoreUint&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3058549">func</span>&nbsp;<span class="ident" id="3058554">ignoreUint</span><span class="op" id="3058564">(</span><span class="ident" id="3058565">i</span>&nbsp;<span class="op" id="3058567">*</span><span class="ident" id="3058568">decInstr</span><span class="op" id="3058576">,</span>&nbsp;<span class="ident" id="3058578">state</span>&nbsp;<span class="op" id="3058584">*</span><span class="ident" id="3058585">decoderState</span><span class="op" id="3058597">,</span>&nbsp;<span class="ident" id="3058599">v</span>&nbsp;<span class="ident" id="3058601">reflect</span><span class="op" id="3058608">.</span><span class="ident" id="3058609">Value</span><span class="op" id="3058614">)</span>&nbsp;<span class="op" id="3058616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058619">state</span><span class="op" id="3058624">.</span><span class="ident" id="3058625">decodeUint</span><span class="op" id="3058635">(</span><span class="op" id="3058636">)</span><br>
<span class="lineno"></span><span class="op" id="3058638">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="3058641">//&nbsp;ignoreTwoUints&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;to&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="3058720">//&nbsp;complex&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3058739">func</span>&nbsp;<span class="ident" id="3058744">ignoreTwoUints</span><span class="op" id="3058758">(</span><span class="ident" id="3058759">i</span>&nbsp;<span class="op" id="3058761">*</span><span class="ident" id="3058762">decInstr</span><span class="op" id="3058770">,</span>&nbsp;<span class="ident" id="3058772">state</span>&nbsp;<span class="op" id="3058778">*</span><span class="ident" id="3058779">decoderState</span><span class="op" id="3058791">,</span>&nbsp;<span class="ident" id="3058793">v</span>&nbsp;<span class="ident" id="3058795">reflect</span><span class="op" id="3058802">.</span><span class="ident" id="3058803">Value</span><span class="op" id="3058808">)</span>&nbsp;<span class="op" id="3058810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058813">state</span><span class="op" id="3058818">.</span><span class="ident" id="3058819">decodeUint</span><span class="op" id="3058829">(</span><span class="op" id="3058830">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3058833">state</span><span class="op" id="3058838">.</span><span class="ident" id="3058839">decodeUint</span><span class="op" id="3058849">(</span><span class="op" id="3058850">)</span><br>
<span class="lineno"></span><span class="op" id="3058852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3058855">//&nbsp;Since&nbsp;the&nbsp;encoder&nbsp;writes&nbsp;no&nbsp;zeros,&nbsp;if&nbsp;we&nbsp;arrive&nbsp;at&nbsp;a&nbsp;decoder&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="3058927">//&nbsp;a&nbsp;value&nbsp;to&nbsp;extract&nbsp;and&nbsp;store.&nbsp;&nbsp;The&nbsp;field&nbsp;number&nbsp;has&nbsp;already&nbsp;been&nbsp;read</span><br>
<span class="lineno">210</span><span class="comment" id="3059000">//&nbsp;(it&#39;s&nbsp;how&nbsp;we&nbsp;knew&nbsp;to&nbsp;call&nbsp;this&nbsp;decoder).</span><br>
<span class="lineno"></span><span class="comment" id="3059044">//&nbsp;Each&nbsp;decoder&nbsp;is&nbsp;responsible&nbsp;for&nbsp;handling&nbsp;any&nbsp;indirections&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3059116">//&nbsp;with&nbsp;the&nbsp;data&nbsp;structure.&nbsp;&nbsp;If&nbsp;any&nbsp;pointer&nbsp;so&nbsp;reached&nbsp;is&nbsp;nil,&nbsp;allocation&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="3059195">//&nbsp;be&nbsp;done.</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3059208">//&nbsp;decAlloc&nbsp;takes&nbsp;a&nbsp;value&nbsp;and&nbsp;returns&nbsp;a&nbsp;settable&nbsp;value&nbsp;that&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="3059272">//&nbsp;be&nbsp;assigned&nbsp;to.&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer,&nbsp;decAlloc&nbsp;guarantees&nbsp;it&nbsp;points&nbsp;to&nbsp;storage.</span><br>
<span class="lineno"></span><span class="comment" id="3059360">//&nbsp;The&nbsp;callers&nbsp;to&nbsp;the&nbsp;individual&nbsp;decoders&nbsp;are&nbsp;expected&nbsp;to&nbsp;have&nbsp;used&nbsp;decAlloc.</span><br>
<span class="lineno"></span><span class="comment" id="3059438">//&nbsp;The&nbsp;individual&nbsp;decoders&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3059483">func</span>&nbsp;<span class="ident" id="3059488">decAlloc</span><span class="op" id="3059496">(</span><span class="ident" id="3059497">v</span>&nbsp;<span class="ident" id="3059499">reflect</span><span class="op" id="3059506">.</span><span class="ident" id="3059507">Value</span><span class="op" id="3059512">)</span>&nbsp;<span class="ident" id="3059514">reflect</span><span class="op" id="3059521">.</span><span class="ident" id="3059522">Value</span>&nbsp;<span class="op" id="3059528">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059531">for</span>&nbsp;<span class="ident" id="3059535">v</span><span class="op" id="3059536">.</span><span class="ident" id="3059537">Kind</span><span class="op" id="3059541">(</span><span class="op" id="3059542">)</span>&nbsp;<span class="op" id="3059544">==</span>&nbsp;<span class="ident" id="3059547">reflect</span><span class="op" id="3059554">.</span><span class="ident" id="3059555">Ptr</span>&nbsp;<span class="op" id="3059559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059563">if</span>&nbsp;<span class="ident" id="3059566">v</span><span class="op" id="3059567">.</span><span class="ident" id="3059568">IsNil</span><span class="op" id="3059573">(</span><span class="op" id="3059574">)</span>&nbsp;<span class="op" id="3059576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059581">v</span><span class="op" id="3059582">.</span><span class="ident" id="3059583">Set</span><span class="op" id="3059586">(</span><span class="ident" id="3059587">reflect</span><span class="op" id="3059594">.</span><span class="ident" id="3059595">New</span><span class="op" id="3059598">(</span><span class="ident" id="3059599">v</span><span class="op" id="3059600">.</span><span class="ident" id="3059601">Type</span><span class="op" id="3059605">(</span><span class="op" id="3059606">)</span><span class="op" id="3059607">.</span><span class="ident" id="3059608">Elem</span><span class="op" id="3059612">(</span><span class="op" id="3059613">)</span><span class="op" id="3059614">)</span><span class="op" id="3059615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059623">v</span>&nbsp;<span class="op" id="3059625">=</span>&nbsp;<span class="ident" id="3059627">v</span><span class="op" id="3059628">.</span><span class="ident" id="3059629">Elem</span><span class="op" id="3059633">(</span><span class="op" id="3059634">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3059637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059640">return</span>&nbsp;<span class="ident" id="3059647">v</span><br>
<span class="lineno"></span><span class="op" id="3059649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3059652">//&nbsp;decBool&nbsp;decodes&nbsp;a&nbsp;uint&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;boolean&nbsp;in&nbsp;value.</span><br>
<span class="lineno">230</span><span class="keyword" id="3059715">func</span>&nbsp;<span class="ident" id="3059720">decBool</span><span class="op" id="3059727">(</span><span class="ident" id="3059728">i</span>&nbsp;<span class="op" id="3059730">*</span><span class="ident" id="3059731">decInstr</span><span class="op" id="3059739">,</span>&nbsp;<span class="ident" id="3059741">state</span>&nbsp;<span class="op" id="3059747">*</span><span class="ident" id="3059748">decoderState</span><span class="op" id="3059760">,</span>&nbsp;<span class="ident" id="3059762">value</span>&nbsp;<span class="ident" id="3059768">reflect</span><span class="op" id="3059775">.</span><span class="ident" id="3059776">Value</span><span class="op" id="3059781">)</span>&nbsp;<span class="op" id="3059783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059786">value</span><span class="op" id="3059791">.</span><span class="ident" id="3059792">SetBool</span><span class="op" id="3059799">(</span><span class="ident" id="3059800">state</span><span class="op" id="3059805">.</span><span class="ident" id="3059806">decodeUint</span><span class="op" id="3059816">(</span><span class="op" id="3059817">)</span>&nbsp;<span class="op" id="3059819">!=</span>&nbsp;<span class="num" id="3059822">0</span><span class="op" id="3059823">)</span><br>
<span class="lineno"></span><span class="op" id="3059825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3059828">//&nbsp;decInt8&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int8&nbsp;in&nbsp;value.</span><br>
<span class="lineno">235</span><span class="keyword" id="3059893">func</span>&nbsp;<span class="ident" id="3059898">decInt8</span><span class="op" id="3059905">(</span><span class="ident" id="3059906">i</span>&nbsp;<span class="op" id="3059908">*</span><span class="ident" id="3059909">decInstr</span><span class="op" id="3059917">,</span>&nbsp;<span class="ident" id="3059919">state</span>&nbsp;<span class="op" id="3059925">*</span><span class="ident" id="3059926">decoderState</span><span class="op" id="3059938">,</span>&nbsp;<span class="ident" id="3059940">value</span>&nbsp;<span class="ident" id="3059946">reflect</span><span class="op" id="3059953">.</span><span class="ident" id="3059954">Value</span><span class="op" id="3059959">)</span>&nbsp;<span class="op" id="3059961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3059964">v</span>&nbsp;<span class="op" id="3059966">:=</span>&nbsp;<span class="ident" id="3059969">state</span><span class="op" id="3059974">.</span><span class="ident" id="3059975">decodeInt</span><span class="op" id="3059984">(</span><span class="op" id="3059985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3059988">if</span>&nbsp;<span class="ident" id="3059991">v</span>&nbsp;<span class="op" id="3059993">&lt;</span>&nbsp;<span class="ident" id="3059995">math</span><span class="op" id="3059999">.</span><span class="ident" id="3060000">MinInt8</span>&nbsp;<span class="op" id="3060008">||</span>&nbsp;<span class="ident" id="3060011">math</span><span class="op" id="3060015">.</span><span class="ident" id="3060016">MaxInt8</span>&nbsp;<span class="op" id="3060024">&lt;</span>&nbsp;<span class="ident" id="3060026">v</span>&nbsp;<span class="op" id="3060028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060032">error_</span><span class="op" id="3060038">(</span><span class="ident" id="3060039">i</span><span class="op" id="3060040">.</span><span class="ident" id="3060041">ovfl</span><span class="op" id="3060045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060048">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060051">value</span><span class="op" id="3060056">.</span><span class="ident" id="3060057">SetInt</span><span class="op" id="3060063">(</span><span class="ident" id="3060064">v</span><span class="op" id="3060065">)</span><br>
<span class="lineno"></span><span class="op" id="3060067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3060070">//&nbsp;decUint8&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint8&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3060145">func</span>&nbsp;<span class="ident" id="3060150">decUint8</span><span class="op" id="3060158">(</span><span class="ident" id="3060159">i</span>&nbsp;<span class="op" id="3060161">*</span><span class="ident" id="3060162">decInstr</span><span class="op" id="3060170">,</span>&nbsp;<span class="ident" id="3060172">state</span>&nbsp;<span class="op" id="3060178">*</span><span class="ident" id="3060179">decoderState</span><span class="op" id="3060191">,</span>&nbsp;<span class="ident" id="3060193">value</span>&nbsp;<span class="ident" id="3060199">reflect</span><span class="op" id="3060206">.</span><span class="ident" id="3060207">Value</span><span class="op" id="3060212">)</span>&nbsp;<span class="op" id="3060214">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060217">v</span>&nbsp;<span class="op" id="3060219">:=</span>&nbsp;<span class="ident" id="3060222">state</span><span class="op" id="3060227">.</span><span class="ident" id="3060228">decodeUint</span><span class="op" id="3060238">(</span><span class="op" id="3060239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060242">if</span>&nbsp;<span class="ident" id="3060245">math</span><span class="op" id="3060249">.</span><span class="ident" id="3060250">MaxUint8</span>&nbsp;<span class="op" id="3060259">&lt;</span>&nbsp;<span class="ident" id="3060261">v</span>&nbsp;<span class="op" id="3060263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060267">error_</span><span class="op" id="3060273">(</span><span class="ident" id="3060274">i</span><span class="op" id="3060275">.</span><span class="ident" id="3060276">ovfl</span><span class="op" id="3060280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060286">value</span><span class="op" id="3060291">.</span><span class="ident" id="3060292">SetUint</span><span class="op" id="3060299">(</span><span class="ident" id="3060300">v</span><span class="op" id="3060301">)</span><br>
<span class="lineno">250</span><span class="op" id="3060303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3060306">//&nbsp;decInt16&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3060373">func</span>&nbsp;<span class="ident" id="3060378">decInt16</span><span class="op" id="3060386">(</span><span class="ident" id="3060387">i</span>&nbsp;<span class="op" id="3060389">*</span><span class="ident" id="3060390">decInstr</span><span class="op" id="3060398">,</span>&nbsp;<span class="ident" id="3060400">state</span>&nbsp;<span class="op" id="3060406">*</span><span class="ident" id="3060407">decoderState</span><span class="op" id="3060419">,</span>&nbsp;<span class="ident" id="3060421">value</span>&nbsp;<span class="ident" id="3060427">reflect</span><span class="op" id="3060434">.</span><span class="ident" id="3060435">Value</span><span class="op" id="3060440">)</span>&nbsp;<span class="op" id="3060442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060445">v</span>&nbsp;<span class="op" id="3060447">:=</span>&nbsp;<span class="ident" id="3060450">state</span><span class="op" id="3060455">.</span><span class="ident" id="3060456">decodeInt</span><span class="op" id="3060465">(</span><span class="op" id="3060466">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060469">if</span>&nbsp;<span class="ident" id="3060472">v</span>&nbsp;<span class="op" id="3060474">&lt;</span>&nbsp;<span class="ident" id="3060476">math</span><span class="op" id="3060480">.</span><span class="ident" id="3060481">MinInt16</span>&nbsp;<span class="op" id="3060490">||</span>&nbsp;<span class="ident" id="3060493">math</span><span class="op" id="3060497">.</span><span class="ident" id="3060498">MaxInt16</span>&nbsp;<span class="op" id="3060507">&lt;</span>&nbsp;<span class="ident" id="3060509">v</span>&nbsp;<span class="op" id="3060511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060515">error_</span><span class="op" id="3060521">(</span><span class="ident" id="3060522">i</span><span class="op" id="3060523">.</span><span class="ident" id="3060524">ovfl</span><span class="op" id="3060528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060534">value</span><span class="op" id="3060539">.</span><span class="ident" id="3060540">SetInt</span><span class="op" id="3060546">(</span><span class="ident" id="3060547">v</span><span class="op" id="3060548">)</span><br>
<span class="lineno"></span><span class="op" id="3060550">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="3060553">//&nbsp;decUint16&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3060630">func</span>&nbsp;<span class="ident" id="3060635">decUint16</span><span class="op" id="3060644">(</span><span class="ident" id="3060645">i</span>&nbsp;<span class="op" id="3060647">*</span><span class="ident" id="3060648">decInstr</span><span class="op" id="3060656">,</span>&nbsp;<span class="ident" id="3060658">state</span>&nbsp;<span class="op" id="3060664">*</span><span class="ident" id="3060665">decoderState</span><span class="op" id="3060677">,</span>&nbsp;<span class="ident" id="3060679">value</span>&nbsp;<span class="ident" id="3060685">reflect</span><span class="op" id="3060692">.</span><span class="ident" id="3060693">Value</span><span class="op" id="3060698">)</span>&nbsp;<span class="op" id="3060700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060703">v</span>&nbsp;<span class="op" id="3060705">:=</span>&nbsp;<span class="ident" id="3060708">state</span><span class="op" id="3060713">.</span><span class="ident" id="3060714">decodeUint</span><span class="op" id="3060724">(</span><span class="op" id="3060725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060728">if</span>&nbsp;<span class="ident" id="3060731">math</span><span class="op" id="3060735">.</span><span class="ident" id="3060736">MaxUint16</span>&nbsp;<span class="op" id="3060746">&lt;</span>&nbsp;<span class="ident" id="3060748">v</span>&nbsp;<span class="op" id="3060750">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060754">error_</span><span class="op" id="3060760">(</span><span class="ident" id="3060761">i</span><span class="op" id="3060762">.</span><span class="ident" id="3060763">ovfl</span><span class="op" id="3060767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3060770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060773">value</span><span class="op" id="3060778">.</span><span class="ident" id="3060779">SetUint</span><span class="op" id="3060786">(</span><span class="ident" id="3060787">v</span><span class="op" id="3060788">)</span><br>
<span class="lineno"></span><span class="op" id="3060790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3060793">//&nbsp;decInt32&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int32&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3060860">func</span>&nbsp;<span class="ident" id="3060865">decInt32</span><span class="op" id="3060873">(</span><span class="ident" id="3060874">i</span>&nbsp;<span class="op" id="3060876">*</span><span class="ident" id="3060877">decInstr</span><span class="op" id="3060885">,</span>&nbsp;<span class="ident" id="3060887">state</span>&nbsp;<span class="op" id="3060893">*</span><span class="ident" id="3060894">decoderState</span><span class="op" id="3060906">,</span>&nbsp;<span class="ident" id="3060908">value</span>&nbsp;<span class="ident" id="3060914">reflect</span><span class="op" id="3060921">.</span><span class="ident" id="3060922">Value</span><span class="op" id="3060927">)</span>&nbsp;<span class="op" id="3060929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3060932">v</span>&nbsp;<span class="op" id="3060934">:=</span>&nbsp;<span class="ident" id="3060937">state</span><span class="op" id="3060942">.</span><span class="ident" id="3060943">decodeInt</span><span class="op" id="3060952">(</span><span class="op" id="3060953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3060956">if</span>&nbsp;<span class="ident" id="3060959">v</span>&nbsp;<span class="op" id="3060961">&lt;</span>&nbsp;<span class="ident" id="3060963">math</span><span class="op" id="3060967">.</span><span class="ident" id="3060968">MinInt32</span>&nbsp;<span class="op" id="3060977">||</span>&nbsp;<span class="ident" id="3060980">math</span><span class="op" id="3060984">.</span><span class="ident" id="3060985">MaxInt32</span>&nbsp;<span class="op" id="3060994">&lt;</span>&nbsp;<span class="ident" id="3060996">v</span>&nbsp;<span class="op" id="3060998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061002">error_</span><span class="op" id="3061008">(</span><span class="ident" id="3061009">i</span><span class="op" id="3061010">.</span><span class="ident" id="3061011">ovfl</span><span class="op" id="3061015">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061021">value</span><span class="op" id="3061026">.</span><span class="ident" id="3061027">SetInt</span><span class="op" id="3061033">(</span><span class="ident" id="3061034">v</span><span class="op" id="3061035">)</span><br>
<span class="lineno"></span><span class="op" id="3061037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3061040">//&nbsp;decUint32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint32&nbsp;in&nbsp;value.</span><br>
<span class="lineno">280</span><span class="keyword" id="3061117">func</span>&nbsp;<span class="ident" id="3061122">decUint32</span><span class="op" id="3061131">(</span><span class="ident" id="3061132">i</span>&nbsp;<span class="op" id="3061134">*</span><span class="ident" id="3061135">decInstr</span><span class="op" id="3061143">,</span>&nbsp;<span class="ident" id="3061145">state</span>&nbsp;<span class="op" id="3061151">*</span><span class="ident" id="3061152">decoderState</span><span class="op" id="3061164">,</span>&nbsp;<span class="ident" id="3061166">value</span>&nbsp;<span class="ident" id="3061172">reflect</span><span class="op" id="3061179">.</span><span class="ident" id="3061180">Value</span><span class="op" id="3061185">)</span>&nbsp;<span class="op" id="3061187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061190">v</span>&nbsp;<span class="op" id="3061192">:=</span>&nbsp;<span class="ident" id="3061195">state</span><span class="op" id="3061200">.</span><span class="ident" id="3061201">decodeUint</span><span class="op" id="3061211">(</span><span class="op" id="3061212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061215">if</span>&nbsp;<span class="ident" id="3061218">math</span><span class="op" id="3061222">.</span><span class="ident" id="3061223">MaxUint32</span>&nbsp;<span class="op" id="3061233">&lt;</span>&nbsp;<span class="ident" id="3061235">v</span>&nbsp;<span class="op" id="3061237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061241">error_</span><span class="op" id="3061247">(</span><span class="ident" id="3061248">i</span><span class="op" id="3061249">.</span><span class="ident" id="3061250">ovfl</span><span class="op" id="3061254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3061257">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061260">value</span><span class="op" id="3061265">.</span><span class="ident" id="3061266">SetUint</span><span class="op" id="3061273">(</span><span class="ident" id="3061274">v</span><span class="op" id="3061275">)</span><br>
<span class="lineno"></span><span class="op" id="3061277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3061280">//&nbsp;decInt64&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3061347">func</span>&nbsp;<span class="ident" id="3061352">decInt64</span><span class="op" id="3061360">(</span><span class="ident" id="3061361">i</span>&nbsp;<span class="op" id="3061363">*</span><span class="ident" id="3061364">decInstr</span><span class="op" id="3061372">,</span>&nbsp;<span class="ident" id="3061374">state</span>&nbsp;<span class="op" id="3061380">*</span><span class="ident" id="3061381">decoderState</span><span class="op" id="3061393">,</span>&nbsp;<span class="ident" id="3061395">value</span>&nbsp;<span class="ident" id="3061401">reflect</span><span class="op" id="3061408">.</span><span class="ident" id="3061409">Value</span><span class="op" id="3061414">)</span>&nbsp;<span class="op" id="3061416">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061419">v</span>&nbsp;<span class="op" id="3061421">:=</span>&nbsp;<span class="ident" id="3061424">state</span><span class="op" id="3061429">.</span><span class="ident" id="3061430">decodeInt</span><span class="op" id="3061439">(</span><span class="op" id="3061440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061443">value</span><span class="op" id="3061448">.</span><span class="ident" id="3061449">SetInt</span><span class="op" id="3061455">(</span><span class="ident" id="3061456">v</span><span class="op" id="3061457">)</span><br>
<span class="lineno"></span><span class="op" id="3061459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3061462">//&nbsp;decUint64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64&nbsp;in&nbsp;value.</span><br>
<span class="lineno">295</span><span class="keyword" id="3061539">func</span>&nbsp;<span class="ident" id="3061544">decUint64</span><span class="op" id="3061553">(</span><span class="ident" id="3061554">i</span>&nbsp;<span class="op" id="3061556">*</span><span class="ident" id="3061557">decInstr</span><span class="op" id="3061565">,</span>&nbsp;<span class="ident" id="3061567">state</span>&nbsp;<span class="op" id="3061573">*</span><span class="ident" id="3061574">decoderState</span><span class="op" id="3061586">,</span>&nbsp;<span class="ident" id="3061588">value</span>&nbsp;<span class="ident" id="3061594">reflect</span><span class="op" id="3061601">.</span><span class="ident" id="3061602">Value</span><span class="op" id="3061607">)</span>&nbsp;<span class="op" id="3061609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061612">v</span>&nbsp;<span class="op" id="3061614">:=</span>&nbsp;<span class="ident" id="3061617">state</span><span class="op" id="3061622">.</span><span class="ident" id="3061623">decodeUint</span><span class="op" id="3061633">(</span><span class="op" id="3061634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3061637">value</span><span class="op" id="3061642">.</span><span class="ident" id="3061643">SetUint</span><span class="op" id="3061650">(</span><span class="ident" id="3061651">v</span><span class="op" id="3061652">)</span><br>
<span class="lineno"></span><span class="op" id="3061654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="3061657">//&nbsp;Floating-point&nbsp;numbers&nbsp;are&nbsp;transmitted&nbsp;as&nbsp;uint64s&nbsp;holding&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3061727">//&nbsp;of&nbsp;the&nbsp;underlying&nbsp;representation.&nbsp;&nbsp;They&nbsp;are&nbsp;sent&nbsp;byte-reversed,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3061799">//&nbsp;the&nbsp;exponent&nbsp;end&nbsp;coming&nbsp;out&nbsp;first,&nbsp;so&nbsp;integer&nbsp;floating&nbsp;point&nbsp;numbers</span><br>
<span class="lineno"></span><span class="comment" id="3061871">//&nbsp;(for&nbsp;example)&nbsp;transmit&nbsp;more&nbsp;compactly.&nbsp;&nbsp;This&nbsp;routine&nbsp;does&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3061936">//&nbsp;unswizzling.</span><br>
<span class="lineno">305</span><span class="keyword" id="3061952">func</span>&nbsp;<span class="ident" id="3061957">float64FromBits</span><span class="op" id="3061972">(</span><span class="ident" id="3061973">u</span>&nbsp;<span class="ident" id="3061975">uint64</span><span class="op" id="3061981">)</span>&nbsp;<span class="builtintype" id="3061983">float64</span>&nbsp;<span class="op" id="3061991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3061994">var</span>&nbsp;<span class="ident" id="3061998">v</span>&nbsp;<span class="ident" id="3062000">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062008">for</span>&nbsp;<span class="ident" id="3062012">i</span>&nbsp;<span class="op" id="3062014">:=</span>&nbsp;<span class="num" id="3062017">0</span><span class="op" id="3062018">;</span>&nbsp;<span class="ident" id="3062020">i</span>&nbsp;<span class="op" id="3062022">&lt;</span>&nbsp;<span class="num" id="3062024">8</span><span class="op" id="3062025">;</span>&nbsp;<span class="ident" id="3062027">i</span><span class="op" id="3062028">++</span>&nbsp;<span class="op" id="3062031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062035">v</span>&nbsp;<span class="op" id="3062037">&lt;&lt;=</span>&nbsp;<span class="num" id="3062041">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062045">v</span>&nbsp;<span class="op" id="3062047">|=</span>&nbsp;<span class="ident" id="3062050">u</span>&nbsp;<span class="op" id="3062052">&amp;</span>&nbsp;<span class="num" id="3062054">0xFF</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062061">u</span>&nbsp;<span class="op" id="3062063">&gt;&gt;=</span>&nbsp;<span class="num" id="3062067">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3062070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062073">return</span>&nbsp;<span class="ident" id="3062080">math</span><span class="op" id="3062084">.</span><span class="ident" id="3062085">Float64frombits</span><span class="op" id="3062100">(</span><span class="ident" id="3062101">v</span><span class="op" id="3062102">)</span><br>
<span class="lineno"></span><span class="op" id="3062104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="3062107">//&nbsp;float32FromBits&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="3062192">//&nbsp;number,&nbsp;and&nbsp;returns&nbsp;it.&nbsp;It&#39;s&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;float32&nbsp;and&nbsp;complex64.</span><br>
<span class="lineno"></span><span class="comment" id="3062269">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;float64&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;reflection&nbsp;needs,&nbsp;but&nbsp;its&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3062346">//&nbsp;value&nbsp;is&nbsp;known&nbsp;to&nbsp;be&nbsp;accurately&nbsp;representable&nbsp;in&nbsp;a&nbsp;float32.</span><br>
<span class="lineno"></span><span class="keyword" id="3062409">func</span>&nbsp;<span class="ident" id="3062414">float32FromBits</span><span class="op" id="3062429">(</span><span class="ident" id="3062430">u</span>&nbsp;<span class="ident" id="3062432">uint64</span><span class="op" id="3062438">,</span>&nbsp;<span class="ident" id="3062440">ovfl</span>&nbsp;<span class="builtintype" id="3062445">error</span><span class="op" id="3062450">)</span>&nbsp;<span class="builtintype" id="3062452">float64</span>&nbsp;<span class="op" id="3062460">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062463">v</span>&nbsp;<span class="op" id="3062465">:=</span>&nbsp;<span class="ident" id="3062468">float64FromBits</span><span class="op" id="3062483">(</span><span class="ident" id="3062484">u</span><span class="op" id="3062485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062488">av</span>&nbsp;<span class="op" id="3062491">:=</span>&nbsp;<span class="ident" id="3062494">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062497">if</span>&nbsp;<span class="ident" id="3062500">av</span>&nbsp;<span class="op" id="3062503">&lt;</span>&nbsp;<span class="num" id="3062505">0</span>&nbsp;<span class="op" id="3062507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062511">av</span>&nbsp;<span class="op" id="3062514">=</span>&nbsp;<span class="op" id="3062516">-</span><span class="ident" id="3062517">av</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3062521">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3062524">//&nbsp;+Inf&nbsp;is&nbsp;OK&nbsp;in&nbsp;both&nbsp;32-&nbsp;and&nbsp;64-bit&nbsp;floats.&nbsp;&nbsp;Underflow&nbsp;is&nbsp;always&nbsp;OK.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062595">if</span>&nbsp;<span class="ident" id="3062598">math</span><span class="op" id="3062602">.</span><span class="ident" id="3062603">MaxFloat32</span>&nbsp;<span class="op" id="3062614">&lt;</span>&nbsp;<span class="ident" id="3062616">av</span>&nbsp;<span class="op" id="3062619">&amp;&amp;</span>&nbsp;<span class="ident" id="3062622">av</span>&nbsp;<span class="op" id="3062625">&lt;=</span>&nbsp;<span class="ident" id="3062628">math</span><span class="op" id="3062632">.</span><span class="ident" id="3062633">MaxFloat64</span>&nbsp;<span class="op" id="3062644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062648">error_</span><span class="op" id="3062654">(</span><span class="ident" id="3062655">ovfl</span><span class="op" id="3062659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3062662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3062665">return</span>&nbsp;<span class="ident" id="3062672">v</span><br>
<span class="lineno">330</span><span class="op" id="3062674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3062677">//&nbsp;decFloat32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="3062757">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3062792">func</span>&nbsp;<span class="ident" id="3062797">decFloat32</span><span class="op" id="3062807">(</span><span class="ident" id="3062808">i</span>&nbsp;<span class="op" id="3062810">*</span><span class="ident" id="3062811">decInstr</span><span class="op" id="3062819">,</span>&nbsp;<span class="ident" id="3062821">state</span>&nbsp;<span class="op" id="3062827">*</span><span class="ident" id="3062828">decoderState</span><span class="op" id="3062840">,</span>&nbsp;<span class="ident" id="3062842">value</span>&nbsp;<span class="ident" id="3062848">reflect</span><span class="op" id="3062855">.</span><span class="ident" id="3062856">Value</span><span class="op" id="3062861">)</span>&nbsp;<span class="op" id="3062863">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3062866">value</span><span class="op" id="3062871">.</span><span class="ident" id="3062872">SetFloat</span><span class="op" id="3062880">(</span><span class="ident" id="3062881">float32FromBits</span><span class="op" id="3062896">(</span><span class="ident" id="3062897">state</span><span class="op" id="3062902">.</span><span class="ident" id="3062903">decodeUint</span><span class="op" id="3062913">(</span><span class="op" id="3062914">)</span><span class="op" id="3062915">,</span>&nbsp;<span class="ident" id="3062917">i</span><span class="op" id="3062918">.</span><span class="ident" id="3062919">ovfl</span><span class="op" id="3062923">)</span><span class="op" id="3062924">)</span><br>
<span class="lineno"></span><span class="op" id="3062926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3062929">//&nbsp;decFloat64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;64-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="3063009">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">340</span><span class="keyword" id="3063044">func</span>&nbsp;<span class="ident" id="3063049">decFloat64</span><span class="op" id="3063059">(</span><span class="ident" id="3063060">i</span>&nbsp;<span class="op" id="3063062">*</span><span class="ident" id="3063063">decInstr</span><span class="op" id="3063071">,</span>&nbsp;<span class="ident" id="3063073">state</span>&nbsp;<span class="op" id="3063079">*</span><span class="ident" id="3063080">decoderState</span><span class="op" id="3063092">,</span>&nbsp;<span class="ident" id="3063094">value</span>&nbsp;<span class="ident" id="3063100">reflect</span><span class="op" id="3063107">.</span><span class="ident" id="3063108">Value</span><span class="op" id="3063113">)</span>&nbsp;<span class="op" id="3063115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063118">value</span><span class="op" id="3063123">.</span><span class="ident" id="3063124">SetFloat</span><span class="op" id="3063132">(</span><span class="ident" id="3063133">float64FromBits</span><span class="op" id="3063148">(</span><span class="ident" id="3063149">state</span><span class="op" id="3063154">.</span><span class="ident" id="3063155">decodeUint</span><span class="op" id="3063165">(</span><span class="op" id="3063166">)</span><span class="op" id="3063167">)</span><span class="op" id="3063168">)</span><br>
<span class="lineno"></span><span class="op" id="3063170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3063173">//&nbsp;decComplex64&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno">345</span><span class="comment" id="3063243">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3063319">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="3063349">func</span>&nbsp;<span class="ident" id="3063354">decComplex64</span><span class="op" id="3063366">(</span><span class="ident" id="3063367">i</span>&nbsp;<span class="op" id="3063369">*</span><span class="ident" id="3063370">decInstr</span><span class="op" id="3063378">,</span>&nbsp;<span class="ident" id="3063380">state</span>&nbsp;<span class="op" id="3063386">*</span><span class="ident" id="3063387">decoderState</span><span class="op" id="3063399">,</span>&nbsp;<span class="ident" id="3063401">value</span>&nbsp;<span class="ident" id="3063407">reflect</span><span class="op" id="3063414">.</span><span class="ident" id="3063415">Value</span><span class="op" id="3063420">)</span>&nbsp;<span class="op" id="3063422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3063425">real</span>&nbsp;<span class="op" id="3063430">:=</span>&nbsp;<span class="ident" id="3063433">float32FromBits</span><span class="op" id="3063448">(</span><span class="ident" id="3063449">state</span><span class="op" id="3063454">.</span><span class="ident" id="3063455">decodeUint</span><span class="op" id="3063465">(</span><span class="op" id="3063466">)</span><span class="op" id="3063467">,</span>&nbsp;<span class="ident" id="3063469">i</span><span class="op" id="3063470">.</span><span class="ident" id="3063471">ovfl</span><span class="op" id="3063475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3063478">imag</span>&nbsp;<span class="op" id="3063483">:=</span>&nbsp;<span class="ident" id="3063486">float32FromBits</span><span class="op" id="3063501">(</span><span class="ident" id="3063502">state</span><span class="op" id="3063507">.</span><span class="ident" id="3063508">decodeUint</span><span class="op" id="3063518">(</span><span class="op" id="3063519">)</span><span class="op" id="3063520">,</span>&nbsp;<span class="ident" id="3063522">i</span><span class="op" id="3063523">.</span><span class="ident" id="3063524">ovfl</span><span class="op" id="3063528">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063531">value</span><span class="op" id="3063536">.</span><span class="ident" id="3063537">SetComplex</span><span class="op" id="3063547">(</span><span class="builtinfunc" id="3063548">complex</span><span class="op" id="3063555">(</span><span class="builtinfunc" id="3063556">real</span><span class="op" id="3063560">,</span>&nbsp;<span class="builtinfunc" id="3063562">imag</span><span class="op" id="3063566">)</span><span class="op" id="3063567">)</span><br>
<span class="lineno"></span><span class="op" id="3063569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3063572">//&nbsp;decComplex128&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3063643">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex128&nbsp;in&nbsp;value.</span><br>
<span class="lineno">355</span><span class="comment" id="3063720">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="3063750">func</span>&nbsp;<span class="ident" id="3063755">decComplex128</span><span class="op" id="3063768">(</span><span class="ident" id="3063769">i</span>&nbsp;<span class="op" id="3063771">*</span><span class="ident" id="3063772">decInstr</span><span class="op" id="3063780">,</span>&nbsp;<span class="ident" id="3063782">state</span>&nbsp;<span class="op" id="3063788">*</span><span class="ident" id="3063789">decoderState</span><span class="op" id="3063801">,</span>&nbsp;<span class="ident" id="3063803">value</span>&nbsp;<span class="ident" id="3063809">reflect</span><span class="op" id="3063816">.</span><span class="ident" id="3063817">Value</span><span class="op" id="3063822">)</span>&nbsp;<span class="op" id="3063824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3063827">real</span>&nbsp;<span class="op" id="3063832">:=</span>&nbsp;<span class="ident" id="3063835">float64FromBits</span><span class="op" id="3063850">(</span><span class="ident" id="3063851">state</span><span class="op" id="3063856">.</span><span class="ident" id="3063857">decodeUint</span><span class="op" id="3063867">(</span><span class="op" id="3063868">)</span><span class="op" id="3063869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3063872">imag</span>&nbsp;<span class="op" id="3063877">:=</span>&nbsp;<span class="ident" id="3063880">float64FromBits</span><span class="op" id="3063895">(</span><span class="ident" id="3063896">state</span><span class="op" id="3063901">.</span><span class="ident" id="3063902">decodeUint</span><span class="op" id="3063912">(</span><span class="op" id="3063913">)</span><span class="op" id="3063914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3063917">value</span><span class="op" id="3063922">.</span><span class="ident" id="3063923">SetComplex</span><span class="op" id="3063933">(</span><span class="builtinfunc" id="3063934">complex</span><span class="op" id="3063941">(</span><span class="builtinfunc" id="3063942">real</span><span class="op" id="3063946">,</span>&nbsp;<span class="builtinfunc" id="3063948">imag</span><span class="op" id="3063952">)</span><span class="op" id="3063953">)</span><br>
<span class="lineno">360</span><span class="op" id="3063955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3063958">//&nbsp;decUint8Slice&nbsp;decodes&nbsp;a&nbsp;byte&nbsp;slice&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;slice&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="3064031">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="3064055">//&nbsp;uint8&nbsp;slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">365</span><span class="keyword" id="3064131">func</span>&nbsp;<span class="ident" id="3064136">decUint8Slice</span><span class="op" id="3064149">(</span><span class="ident" id="3064150">i</span>&nbsp;<span class="op" id="3064152">*</span><span class="ident" id="3064153">decInstr</span><span class="op" id="3064161">,</span>&nbsp;<span class="ident" id="3064163">state</span>&nbsp;<span class="op" id="3064169">*</span><span class="ident" id="3064170">decoderState</span><span class="op" id="3064182">,</span>&nbsp;<span class="ident" id="3064184">value</span>&nbsp;<span class="ident" id="3064190">reflect</span><span class="op" id="3064197">.</span><span class="ident" id="3064198">Value</span><span class="op" id="3064203">)</span>&nbsp;<span class="op" id="3064205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064208">u</span>&nbsp;<span class="op" id="3064210">:=</span>&nbsp;<span class="ident" id="3064213">state</span><span class="op" id="3064218">.</span><span class="ident" id="3064219">decodeUint</span><span class="op" id="3064229">(</span><span class="op" id="3064230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064233">n</span>&nbsp;<span class="op" id="3064235">:=</span>&nbsp;<span class="builtintype" id="3064238">int</span><span class="op" id="3064241">(</span><span class="ident" id="3064242">u</span><span class="op" id="3064243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064246">if</span>&nbsp;<span class="ident" id="3064249">n</span>&nbsp;<span class="op" id="3064251">&lt;</span>&nbsp;<span class="num" id="3064253">0</span>&nbsp;<span class="op" id="3064255">||</span>&nbsp;<span class="ident" id="3064258">uint64</span><span class="op" id="3064264">(</span><span class="ident" id="3064265">n</span><span class="op" id="3064266">)</span>&nbsp;<span class="op" id="3064268">!=</span>&nbsp;<span class="ident" id="3064271">u</span>&nbsp;<span class="op" id="3064273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064277">errorf</span><span class="op" id="3064283">(</span><span class="string" id="3064284">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="3064328">,</span>&nbsp;<span class="ident" id="3064330">value</span><span class="op" id="3064335">.</span><span class="ident" id="3064336">Type</span><span class="op" id="3064340">(</span><span class="op" id="3064341">)</span><span class="op" id="3064342">,</span>&nbsp;<span class="ident" id="3064344">u</span><span class="op" id="3064345">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064351">if</span>&nbsp;<span class="ident" id="3064354">n</span>&nbsp;<span class="op" id="3064356">&gt;</span>&nbsp;<span class="ident" id="3064358">state</span><span class="op" id="3064363">.</span><span class="ident" id="3064364">b</span><span class="op" id="3064365">.</span><span class="ident" id="3064366">Len</span><span class="op" id="3064369">(</span><span class="op" id="3064370">)</span>&nbsp;<span class="op" id="3064372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064376">errorf</span><span class="op" id="3064382">(</span><span class="string" id="3064383">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="3064416">,</span>&nbsp;<span class="ident" id="3064418">value</span><span class="op" id="3064423">.</span><span class="ident" id="3064424">Type</span><span class="op" id="3064428">(</span><span class="op" id="3064429">)</span><span class="op" id="3064430">,</span>&nbsp;<span class="ident" id="3064432">n</span><span class="op" id="3064433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064439">if</span>&nbsp;<span class="ident" id="3064442">n</span>&nbsp;<span class="op" id="3064444">&gt;</span>&nbsp;<span class="ident" id="3064446">tooBig</span>&nbsp;<span class="op" id="3064453">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064457">errorf</span><span class="op" id="3064463">(</span><span class="string" id="3064464">&#34;byte&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&#34;</span><span class="op" id="3064488">,</span>&nbsp;<span class="ident" id="3064490">n</span><span class="op" id="3064491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064497">if</span>&nbsp;<span class="ident" id="3064500">value</span><span class="op" id="3064505">.</span><span class="ident" id="3064506">Cap</span><span class="op" id="3064509">(</span><span class="op" id="3064510">)</span>&nbsp;<span class="op" id="3064512">&lt;</span>&nbsp;<span class="ident" id="3064514">n</span>&nbsp;<span class="op" id="3064516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064520">value</span><span class="op" id="3064525">.</span><span class="ident" id="3064526">Set</span><span class="op" id="3064529">(</span><span class="ident" id="3064530">reflect</span><span class="op" id="3064537">.</span><span class="ident" id="3064538">MakeSlice</span><span class="op" id="3064547">(</span><span class="ident" id="3064548">value</span><span class="op" id="3064553">.</span><span class="ident" id="3064554">Type</span><span class="op" id="3064558">(</span><span class="op" id="3064559">)</span><span class="op" id="3064560">,</span>&nbsp;<span class="ident" id="3064562">n</span><span class="op" id="3064563">,</span>&nbsp;<span class="ident" id="3064565">n</span><span class="op" id="3064566">)</span><span class="op" id="3064567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064570">}</span>&nbsp;<span class="keyword" id="3064572">else</span>&nbsp;<span class="op" id="3064577">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064581">value</span><span class="op" id="3064586">.</span><span class="ident" id="3064587">Set</span><span class="op" id="3064590">(</span><span class="ident" id="3064591">value</span><span class="op" id="3064596">.</span><span class="ident" id="3064597">Slice</span><span class="op" id="3064602">(</span><span class="num" id="3064603">0</span><span class="op" id="3064604">,</span>&nbsp;<span class="ident" id="3064606">n</span><span class="op" id="3064607">)</span><span class="op" id="3064608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064614">if</span>&nbsp;<span class="ident" id="3064617">_</span><span class="op" id="3064618">,</span>&nbsp;<span class="ident" id="3064620">err</span>&nbsp;<span class="op" id="3064624">:=</span>&nbsp;<span class="ident" id="3064627">state</span><span class="op" id="3064632">.</span><span class="ident" id="3064633">b</span><span class="op" id="3064634">.</span><span class="ident" id="3064635">Read</span><span class="op" id="3064639">(</span><span class="ident" id="3064640">value</span><span class="op" id="3064645">.</span><span class="ident" id="3064646">Bytes</span><span class="op" id="3064651">(</span><span class="op" id="3064652">)</span><span class="op" id="3064653">)</span><span class="op" id="3064654">;</span>&nbsp;<span class="ident" id="3064656">err</span>&nbsp;<span class="op" id="3064660">!=</span>&nbsp;<span class="ident" id="3064663">nil</span>&nbsp;<span class="op" id="3064667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064671">errorf</span><span class="op" id="3064677">(</span><span class="string" id="3064678">&#34;error&nbsp;decoding&nbsp;[]byte:&nbsp;%s&#34;</span><span class="op" id="3064705">,</span>&nbsp;<span class="ident" id="3064707">err</span><span class="op" id="3064710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3064713">}</span><br>
<span class="lineno">385</span><span class="op" id="3064715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3064718">//&nbsp;decString&nbsp;decodes&nbsp;byte&nbsp;array&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;string&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="3064786">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="3064810">//&nbsp;Strings&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">390</span><span class="keyword" id="3064881">func</span>&nbsp;<span class="ident" id="3064886">decString</span><span class="op" id="3064895">(</span><span class="ident" id="3064896">i</span>&nbsp;<span class="op" id="3064898">*</span><span class="ident" id="3064899">decInstr</span><span class="op" id="3064907">,</span>&nbsp;<span class="ident" id="3064909">state</span>&nbsp;<span class="op" id="3064915">*</span><span class="ident" id="3064916">decoderState</span><span class="op" id="3064928">,</span>&nbsp;<span class="ident" id="3064930">value</span>&nbsp;<span class="ident" id="3064936">reflect</span><span class="op" id="3064943">.</span><span class="ident" id="3064944">Value</span><span class="op" id="3064949">)</span>&nbsp;<span class="op" id="3064951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064954">u</span>&nbsp;<span class="op" id="3064956">:=</span>&nbsp;<span class="ident" id="3064959">state</span><span class="op" id="3064964">.</span><span class="ident" id="3064965">decodeUint</span><span class="op" id="3064975">(</span><span class="op" id="3064976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3064979">n</span>&nbsp;<span class="op" id="3064981">:=</span>&nbsp;<span class="builtintype" id="3064984">int</span><span class="op" id="3064987">(</span><span class="ident" id="3064988">u</span><span class="op" id="3064989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3064992">if</span>&nbsp;<span class="ident" id="3064995">n</span>&nbsp;<span class="op" id="3064997">&lt;</span>&nbsp;<span class="num" id="3064999">0</span>&nbsp;<span class="op" id="3065001">||</span>&nbsp;<span class="ident" id="3065004">uint64</span><span class="op" id="3065010">(</span><span class="ident" id="3065011">n</span><span class="op" id="3065012">)</span>&nbsp;<span class="op" id="3065014">!=</span>&nbsp;<span class="ident" id="3065017">u</span>&nbsp;<span class="op" id="3065019">||</span>&nbsp;<span class="ident" id="3065022">n</span>&nbsp;<span class="op" id="3065024">&gt;</span>&nbsp;<span class="ident" id="3065026">state</span><span class="op" id="3065031">.</span><span class="ident" id="3065032">b</span><span class="op" id="3065033">.</span><span class="ident" id="3065034">Len</span><span class="op" id="3065037">(</span><span class="op" id="3065038">)</span>&nbsp;<span class="op" id="3065040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065044">errorf</span><span class="op" id="3065050">(</span><span class="string" id="3065051">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="3065095">,</span>&nbsp;<span class="ident" id="3065097">value</span><span class="op" id="3065102">.</span><span class="ident" id="3065103">Type</span><span class="op" id="3065107">(</span><span class="op" id="3065108">)</span><span class="op" id="3065109">,</span>&nbsp;<span class="ident" id="3065111">u</span><span class="op" id="3065112">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3065115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065118">if</span>&nbsp;<span class="ident" id="3065121">n</span>&nbsp;<span class="op" id="3065123">&gt;</span>&nbsp;<span class="ident" id="3065125">state</span><span class="op" id="3065130">.</span><span class="ident" id="3065131">b</span><span class="op" id="3065132">.</span><span class="ident" id="3065133">Len</span><span class="op" id="3065136">(</span><span class="op" id="3065137">)</span>&nbsp;<span class="op" id="3065139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065143">errorf</span><span class="op" id="3065149">(</span><span class="string" id="3065150">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="3065183">,</span>&nbsp;<span class="ident" id="3065185">value</span><span class="op" id="3065190">.</span><span class="ident" id="3065191">Type</span><span class="op" id="3065195">(</span><span class="op" id="3065196">)</span><span class="op" id="3065197">,</span>&nbsp;<span class="ident" id="3065199">n</span><span class="op" id="3065200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3065203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3065206">//&nbsp;Read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065225">data</span>&nbsp;<span class="op" id="3065230">:=</span>&nbsp;<span class="builtinfunc" id="3065233">make</span><span class="op" id="3065237">(</span><span class="op" id="3065238">[</span><span class="op" id="3065239">]</span><span class="builtintype" id="3065240">byte</span><span class="op" id="3065244">,</span>&nbsp;<span class="ident" id="3065246">n</span><span class="op" id="3065247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3065250">if</span>&nbsp;<span class="ident" id="3065253">_</span><span class="op" id="3065254">,</span>&nbsp;<span class="ident" id="3065256">err</span>&nbsp;<span class="op" id="3065260">:=</span>&nbsp;<span class="ident" id="3065263">state</span><span class="op" id="3065268">.</span><span class="ident" id="3065269">b</span><span class="op" id="3065270">.</span><span class="ident" id="3065271">Read</span><span class="op" id="3065275">(</span><span class="ident" id="3065276">data</span><span class="op" id="3065280">)</span><span class="op" id="3065281">;</span>&nbsp;<span class="ident" id="3065283">err</span>&nbsp;<span class="op" id="3065287">!=</span>&nbsp;<span class="ident" id="3065290">nil</span>&nbsp;<span class="op" id="3065294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065298">errorf</span><span class="op" id="3065304">(</span><span class="string" id="3065305">&#34;error&nbsp;decoding&nbsp;string:&nbsp;%s&#34;</span><span class="op" id="3065332">,</span>&nbsp;<span class="ident" id="3065334">err</span><span class="op" id="3065337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3065340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065343">value</span><span class="op" id="3065348">.</span><span class="ident" id="3065349">SetString</span><span class="op" id="3065358">(</span><span class="builtintype" id="3065359">string</span><span class="op" id="3065365">(</span><span class="ident" id="3065366">data</span><span class="op" id="3065370">)</span><span class="op" id="3065371">)</span><br>
<span class="lineno">405</span><span class="op" id="3065373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3065376">//&nbsp;ignoreUint8Array&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;byte&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3065460">func</span>&nbsp;<span class="ident" id="3065465">ignoreUint8Array</span><span class="op" id="3065481">(</span><span class="ident" id="3065482">i</span>&nbsp;<span class="op" id="3065484">*</span><span class="ident" id="3065485">decInstr</span><span class="op" id="3065493">,</span>&nbsp;<span class="ident" id="3065495">state</span>&nbsp;<span class="op" id="3065501">*</span><span class="ident" id="3065502">decoderState</span><span class="op" id="3065514">,</span>&nbsp;<span class="ident" id="3065516">value</span>&nbsp;<span class="ident" id="3065522">reflect</span><span class="op" id="3065529">.</span><span class="ident" id="3065530">Value</span><span class="op" id="3065535">)</span>&nbsp;<span class="op" id="3065537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065540">b</span>&nbsp;<span class="op" id="3065542">:=</span>&nbsp;<span class="builtinfunc" id="3065545">make</span><span class="op" id="3065549">(</span><span class="op" id="3065550">[</span><span class="op" id="3065551">]</span><span class="builtintype" id="3065552">byte</span><span class="op" id="3065556">,</span>&nbsp;<span class="ident" id="3065558">state</span><span class="op" id="3065563">.</span><span class="ident" id="3065564">decodeUint</span><span class="op" id="3065574">(</span><span class="op" id="3065575">)</span><span class="op" id="3065576">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065579">state</span><span class="op" id="3065584">.</span><span class="ident" id="3065585">b</span><span class="op" id="3065586">.</span><span class="ident" id="3065587">Read</span><span class="op" id="3065591">(</span><span class="ident" id="3065592">b</span><span class="op" id="3065593">)</span><br>
<span class="lineno"></span><span class="op" id="3065595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3065598">//&nbsp;Execution&nbsp;engine</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="3065619">//&nbsp;The&nbsp;encoder&nbsp;engine&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;instructions&nbsp;indexed&nbsp;by&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="3065709">//&nbsp;decoder.&nbsp;&nbsp;It&nbsp;is&nbsp;executed&nbsp;with&nbsp;random&nbsp;access&nbsp;according&nbsp;to&nbsp;field&nbsp;number.</span><br>
<span class="lineno"></span><span class="keyword" id="3065783">type</span>&nbsp;<span class="ident" id="3065788">decEngine</span>&nbsp;<span class="keyword" id="3065798">struct</span>&nbsp;<span class="op" id="3065805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065808">instr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3065817">[</span><span class="op" id="3065818">]</span><span class="ident" id="3065819">decInstr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3065829">numInstr</span>&nbsp;<span class="builtintype" id="3065838">int</span>&nbsp;<span class="comment" id="3065842">//&nbsp;the&nbsp;number&nbsp;of&nbsp;active&nbsp;instructions</span><br>
<span class="lineno">420</span><span class="op" id="3065879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3065882">//&nbsp;decodeSingle&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;value&nbsp;that&nbsp;is&nbsp;not&nbsp;a&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3065969">//&nbsp;Such&nbsp;values&nbsp;are&nbsp;preceded&nbsp;by&nbsp;a&nbsp;zero,&nbsp;making&nbsp;them&nbsp;have&nbsp;the&nbsp;memory&nbsp;layout&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3066048">//&nbsp;struct&nbsp;field&nbsp;(although&nbsp;with&nbsp;an&nbsp;illegal&nbsp;field&nbsp;number).</span><br>
<span class="lineno">425</span><span class="keyword" id="3066105">func</span>&nbsp;<span class="op" id="3066110">(</span><span class="ident" id="3066111">dec</span>&nbsp;<span class="op" id="3066115">*</span><span class="ident" id="3066116">Decoder</span><span class="op" id="3066123">)</span>&nbsp;<span class="ident" id="3066125">decodeSingle</span><span class="op" id="3066137">(</span><span class="ident" id="3066138">engine</span>&nbsp;<span class="op" id="3066145">*</span><span class="ident" id="3066146">decEngine</span><span class="op" id="3066155">,</span>&nbsp;<span class="ident" id="3066157">ut</span>&nbsp;<span class="op" id="3066160">*</span><span class="ident" id="3066161">userTypeInfo</span><span class="op" id="3066173">,</span>&nbsp;<span class="ident" id="3066175">value</span>&nbsp;<span class="ident" id="3066181">reflect</span><span class="op" id="3066188">.</span><span class="ident" id="3066189">Value</span><span class="op" id="3066194">)</span>&nbsp;<span class="op" id="3066196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066199">state</span>&nbsp;<span class="op" id="3066205">:=</span>&nbsp;<span class="ident" id="3066208">dec</span><span class="op" id="3066211">.</span><span class="ident" id="3066212">newDecoderState</span><span class="op" id="3066227">(</span><span class="op" id="3066228">&amp;</span><span class="ident" id="3066229">dec</span><span class="op" id="3066232">.</span><span class="ident" id="3066233">buf</span><span class="op" id="3066236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066239">defer</span>&nbsp;<span class="ident" id="3066245">dec</span><span class="op" id="3066248">.</span><span class="ident" id="3066249">freeDecoderState</span><span class="op" id="3066265">(</span><span class="ident" id="3066266">state</span><span class="op" id="3066271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066274">state</span><span class="op" id="3066279">.</span><span class="ident" id="3066280">fieldnum</span>&nbsp;<span class="op" id="3066289">=</span>&nbsp;<span class="ident" id="3066291">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066307">if</span>&nbsp;<span class="ident" id="3066310">state</span><span class="op" id="3066315">.</span><span class="ident" id="3066316">decodeUint</span><span class="op" id="3066326">(</span><span class="op" id="3066327">)</span>&nbsp;<span class="op" id="3066329">!=</span>&nbsp;<span class="num" id="3066332">0</span>&nbsp;<span class="op" id="3066334">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066338">errorf</span><span class="op" id="3066344">(</span><span class="string" id="3066345">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="3066399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3066402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066405">instr</span>&nbsp;<span class="op" id="3066411">:=</span>&nbsp;<span class="op" id="3066414">&amp;</span><span class="ident" id="3066415">engine</span><span class="op" id="3066421">.</span><span class="ident" id="3066422">instr</span><span class="op" id="3066427">[</span><span class="ident" id="3066428">singletonField</span><span class="op" id="3066442">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066445">instr</span><span class="op" id="3066450">.</span><span class="ident" id="3066451">op</span><span class="op" id="3066453">(</span><span class="ident" id="3066454">instr</span><span class="op" id="3066459">,</span>&nbsp;<span class="ident" id="3066461">state</span><span class="op" id="3066466">,</span>&nbsp;<span class="ident" id="3066468">value</span><span class="op" id="3066473">)</span><br>
<span class="lineno"></span><span class="op" id="3066475">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="3066478">//&nbsp;decodeStruct&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3066545">//&nbsp;Indir&nbsp;is&nbsp;for&nbsp;the&nbsp;value,&nbsp;not&nbsp;the&nbsp;type.&nbsp;&nbsp;At&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;call&nbsp;it&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="3066618">//&nbsp;differ&nbsp;from&nbsp;ut.indir,&nbsp;which&nbsp;was&nbsp;computed&nbsp;when&nbsp;the&nbsp;engine&nbsp;was&nbsp;built.</span><br>
<span class="lineno"></span><span class="comment" id="3066689">//&nbsp;This&nbsp;state&nbsp;cannot&nbsp;arise&nbsp;for&nbsp;decodeSingle,&nbsp;which&nbsp;is&nbsp;called&nbsp;directly</span><br>
<span class="lineno">440</span><span class="comment" id="3066759">//&nbsp;from&nbsp;the&nbsp;user&#39;s&nbsp;value,&nbsp;not&nbsp;from&nbsp;the&nbsp;innards&nbsp;of&nbsp;an&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="3066820">func</span>&nbsp;<span class="op" id="3066825">(</span><span class="ident" id="3066826">dec</span>&nbsp;<span class="op" id="3066830">*</span><span class="ident" id="3066831">Decoder</span><span class="op" id="3066838">)</span>&nbsp;<span class="ident" id="3066840">decodeStruct</span><span class="op" id="3066852">(</span><span class="ident" id="3066853">engine</span>&nbsp;<span class="op" id="3066860">*</span><span class="ident" id="3066861">decEngine</span><span class="op" id="3066870">,</span>&nbsp;<span class="ident" id="3066872">ut</span>&nbsp;<span class="op" id="3066875">*</span><span class="ident" id="3066876">userTypeInfo</span><span class="op" id="3066888">,</span>&nbsp;<span class="ident" id="3066890">value</span>&nbsp;<span class="ident" id="3066896">reflect</span><span class="op" id="3066903">.</span><span class="ident" id="3066904">Value</span><span class="op" id="3066909">)</span>&nbsp;<span class="op" id="3066911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066914">state</span>&nbsp;<span class="op" id="3066920">:=</span>&nbsp;<span class="ident" id="3066923">dec</span><span class="op" id="3066926">.</span><span class="ident" id="3066927">newDecoderState</span><span class="op" id="3066942">(</span><span class="op" id="3066943">&amp;</span><span class="ident" id="3066944">dec</span><span class="op" id="3066947">.</span><span class="ident" id="3066948">buf</span><span class="op" id="3066951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3066954">defer</span>&nbsp;<span class="ident" id="3066960">dec</span><span class="op" id="3066963">.</span><span class="ident" id="3066964">freeDecoderState</span><span class="op" id="3066980">(</span><span class="ident" id="3066981">state</span><span class="op" id="3066986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3066989">state</span><span class="op" id="3066994">.</span><span class="ident" id="3066995">fieldnum</span>&nbsp;<span class="op" id="3067004">=</span>&nbsp;<span class="op" id="3067006">-</span><span class="num" id="3067007">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067010">for</span>&nbsp;<span class="ident" id="3067014">state</span><span class="op" id="3067019">.</span><span class="ident" id="3067020">b</span><span class="op" id="3067021">.</span><span class="ident" id="3067022">Len</span><span class="op" id="3067025">(</span><span class="op" id="3067026">)</span>&nbsp;<span class="op" id="3067028">&gt;</span>&nbsp;<span class="num" id="3067030">0</span>&nbsp;<span class="op" id="3067032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067036">delta</span>&nbsp;<span class="op" id="3067042">:=</span>&nbsp;<span class="builtintype" id="3067045">int</span><span class="op" id="3067048">(</span><span class="ident" id="3067049">state</span><span class="op" id="3067054">.</span><span class="ident" id="3067055">decodeUint</span><span class="op" id="3067065">(</span><span class="op" id="3067066">)</span><span class="op" id="3067067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067071">if</span>&nbsp;<span class="ident" id="3067074">delta</span>&nbsp;<span class="op" id="3067080">&lt;</span>&nbsp;<span class="num" id="3067082">0</span>&nbsp;<span class="op" id="3067084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067089">errorf</span><span class="op" id="3067095">(</span><span class="string" id="3067096">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="3067136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067140">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067144">if</span>&nbsp;<span class="ident" id="3067147">delta</span>&nbsp;<span class="op" id="3067153">==</span>&nbsp;<span class="num" id="3067156">0</span>&nbsp;<span class="op" id="3067158">{</span>&nbsp;<span class="comment" id="3067160">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067207">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067219">fieldnum</span>&nbsp;<span class="op" id="3067228">:=</span>&nbsp;<span class="ident" id="3067231">state</span><span class="op" id="3067236">.</span><span class="ident" id="3067237">fieldnum</span>&nbsp;<span class="op" id="3067246">+</span>&nbsp;<span class="ident" id="3067248">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067256">if</span>&nbsp;<span class="ident" id="3067259">fieldnum</span>&nbsp;<span class="op" id="3067268">&gt;=</span>&nbsp;<span class="builtinfunc" id="3067271">len</span><span class="op" id="3067274">(</span><span class="ident" id="3067275">engine</span><span class="op" id="3067281">.</span><span class="ident" id="3067282">instr</span><span class="op" id="3067287">)</span>&nbsp;<span class="op" id="3067289">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067294">error_</span><span class="op" id="3067300">(</span><span class="ident" id="3067301">errRange</span><span class="op" id="3067309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067314">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067326">instr</span>&nbsp;<span class="op" id="3067332">:=</span>&nbsp;<span class="op" id="3067335">&amp;</span><span class="ident" id="3067336">engine</span><span class="op" id="3067342">.</span><span class="ident" id="3067343">instr</span><span class="op" id="3067348">[</span><span class="ident" id="3067349">fieldnum</span><span class="op" id="3067357">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067361">var</span>&nbsp;<span class="ident" id="3067365">field</span>&nbsp;<span class="ident" id="3067371">reflect</span><span class="op" id="3067378">.</span><span class="ident" id="3067379">Value</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067387">if</span>&nbsp;<span class="ident" id="3067390">instr</span><span class="op" id="3067395">.</span><span class="ident" id="3067396">index</span>&nbsp;<span class="op" id="3067402">!=</span>&nbsp;<span class="ident" id="3067405">nil</span>&nbsp;<span class="op" id="3067409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3067414">//&nbsp;Otherwise&nbsp;the&nbsp;field&nbsp;is&nbsp;unknown&nbsp;to&nbsp;us&nbsp;and&nbsp;instr.op&nbsp;is&nbsp;an&nbsp;ignore&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067487">field</span>&nbsp;<span class="op" id="3067493">=</span>&nbsp;<span class="ident" id="3067495">value</span><span class="op" id="3067500">.</span><span class="ident" id="3067501">FieldByIndex</span><span class="op" id="3067513">(</span><span class="ident" id="3067514">instr</span><span class="op" id="3067519">.</span><span class="ident" id="3067520">index</span><span class="op" id="3067525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067530">if</span>&nbsp;<span class="ident" id="3067533">field</span><span class="op" id="3067538">.</span><span class="ident" id="3067539">Kind</span><span class="op" id="3067543">(</span><span class="op" id="3067544">)</span>&nbsp;<span class="op" id="3067546">==</span>&nbsp;<span class="ident" id="3067549">reflect</span><span class="op" id="3067556">.</span><span class="ident" id="3067557">Ptr</span>&nbsp;<span class="op" id="3067561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067567">field</span>&nbsp;<span class="op" id="3067573">=</span>&nbsp;<span class="ident" id="3067575">decAlloc</span><span class="op" id="3067583">(</span><span class="ident" id="3067584">field</span><span class="op" id="3067589">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067602">instr</span><span class="op" id="3067607">.</span><span class="ident" id="3067608">op</span><span class="op" id="3067610">(</span><span class="ident" id="3067611">instr</span><span class="op" id="3067616">,</span>&nbsp;<span class="ident" id="3067618">state</span><span class="op" id="3067623">,</span>&nbsp;<span class="ident" id="3067625">field</span><span class="op" id="3067630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067634">state</span><span class="op" id="3067639">.</span><span class="ident" id="3067640">fieldnum</span>&nbsp;<span class="op" id="3067649">=</span>&nbsp;<span class="ident" id="3067651">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3067661">}</span><br>
<span class="lineno">470</span><span class="op" id="3067663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3067666">var</span>&nbsp;<span class="ident" id="3067670">noValue</span>&nbsp;<span class="ident" id="3067678">reflect</span><span class="op" id="3067685">.</span><span class="ident" id="3067686">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3067693">//&nbsp;ignoreStruct&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;struct&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">475</span><span class="keyword" id="3067761">func</span>&nbsp;<span class="op" id="3067766">(</span><span class="ident" id="3067767">dec</span>&nbsp;<span class="op" id="3067771">*</span><span class="ident" id="3067772">Decoder</span><span class="op" id="3067779">)</span>&nbsp;<span class="ident" id="3067781">ignoreStruct</span><span class="op" id="3067793">(</span><span class="ident" id="3067794">engine</span>&nbsp;<span class="op" id="3067801">*</span><span class="ident" id="3067802">decEngine</span><span class="op" id="3067811">)</span>&nbsp;<span class="op" id="3067813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067816">state</span>&nbsp;<span class="op" id="3067822">:=</span>&nbsp;<span class="ident" id="3067825">dec</span><span class="op" id="3067828">.</span><span class="ident" id="3067829">newDecoderState</span><span class="op" id="3067844">(</span><span class="op" id="3067845">&amp;</span><span class="ident" id="3067846">dec</span><span class="op" id="3067849">.</span><span class="ident" id="3067850">buf</span><span class="op" id="3067853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067856">defer</span>&nbsp;<span class="ident" id="3067862">dec</span><span class="op" id="3067865">.</span><span class="ident" id="3067866">freeDecoderState</span><span class="op" id="3067882">(</span><span class="ident" id="3067883">state</span><span class="op" id="3067888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067891">state</span><span class="op" id="3067896">.</span><span class="ident" id="3067897">fieldnum</span>&nbsp;<span class="op" id="3067906">=</span>&nbsp;<span class="op" id="3067908">-</span><span class="num" id="3067909">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067912">for</span>&nbsp;<span class="ident" id="3067916">state</span><span class="op" id="3067921">.</span><span class="ident" id="3067922">b</span><span class="op" id="3067923">.</span><span class="ident" id="3067924">Len</span><span class="op" id="3067927">(</span><span class="op" id="3067928">)</span>&nbsp;<span class="op" id="3067930">&gt;</span>&nbsp;<span class="num" id="3067932">0</span>&nbsp;<span class="op" id="3067934">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067938">delta</span>&nbsp;<span class="op" id="3067944">:=</span>&nbsp;<span class="builtintype" id="3067947">int</span><span class="op" id="3067950">(</span><span class="ident" id="3067951">state</span><span class="op" id="3067956">.</span><span class="ident" id="3067957">decodeUint</span><span class="op" id="3067967">(</span><span class="op" id="3067968">)</span><span class="op" id="3067969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3067973">if</span>&nbsp;<span class="ident" id="3067976">delta</span>&nbsp;<span class="op" id="3067982">&lt;</span>&nbsp;<span class="num" id="3067984">0</span>&nbsp;<span class="op" id="3067986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3067991">errorf</span><span class="op" id="3067997">(</span><span class="string" id="3067998">&#34;ignore&nbsp;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="3068045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3068049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068053">if</span>&nbsp;<span class="ident" id="3068056">delta</span>&nbsp;<span class="op" id="3068062">==</span>&nbsp;<span class="num" id="3068065">0</span>&nbsp;<span class="op" id="3068067">{</span>&nbsp;<span class="comment" id="3068069">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068116">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3068124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068128">fieldnum</span>&nbsp;<span class="op" id="3068137">:=</span>&nbsp;<span class="ident" id="3068140">state</span><span class="op" id="3068145">.</span><span class="ident" id="3068146">fieldnum</span>&nbsp;<span class="op" id="3068155">+</span>&nbsp;<span class="ident" id="3068157">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068165">if</span>&nbsp;<span class="ident" id="3068168">fieldnum</span>&nbsp;<span class="op" id="3068177">&gt;=</span>&nbsp;<span class="builtinfunc" id="3068180">len</span><span class="op" id="3068183">(</span><span class="ident" id="3068184">engine</span><span class="op" id="3068190">.</span><span class="ident" id="3068191">instr</span><span class="op" id="3068196">)</span>&nbsp;<span class="op" id="3068198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068203">error_</span><span class="op" id="3068209">(</span><span class="ident" id="3068210">errRange</span><span class="op" id="3068218">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3068222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068226">instr</span>&nbsp;<span class="op" id="3068232">:=</span>&nbsp;<span class="op" id="3068235">&amp;</span><span class="ident" id="3068236">engine</span><span class="op" id="3068242">.</span><span class="ident" id="3068243">instr</span><span class="op" id="3068248">[</span><span class="ident" id="3068249">fieldnum</span><span class="op" id="3068257">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068261">instr</span><span class="op" id="3068266">.</span><span class="ident" id="3068267">op</span><span class="op" id="3068269">(</span><span class="ident" id="3068270">instr</span><span class="op" id="3068275">,</span>&nbsp;<span class="ident" id="3068277">state</span><span class="op" id="3068282">,</span>&nbsp;<span class="ident" id="3068284">noValue</span><span class="op" id="3068291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068295">state</span><span class="op" id="3068300">.</span><span class="ident" id="3068301">fieldnum</span>&nbsp;<span class="op" id="3068310">=</span>&nbsp;<span class="ident" id="3068312">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3068322">}</span><br>
<span class="lineno">495</span><span class="op" id="3068324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3068327">//&nbsp;ignoreSingle&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;top-level&nbsp;non-struct&nbsp;value&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="3068402">//&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;when&nbsp;calling&nbsp;Decode&nbsp;with&nbsp;a&nbsp;nil&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3068466">func</span>&nbsp;<span class="op" id="3068471">(</span><span class="ident" id="3068472">dec</span>&nbsp;<span class="op" id="3068476">*</span><span class="ident" id="3068477">Decoder</span><span class="op" id="3068484">)</span>&nbsp;<span class="ident" id="3068486">ignoreSingle</span><span class="op" id="3068498">(</span><span class="ident" id="3068499">engine</span>&nbsp;<span class="op" id="3068506">*</span><span class="ident" id="3068507">decEngine</span><span class="op" id="3068516">)</span>&nbsp;<span class="op" id="3068518">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068521">state</span>&nbsp;<span class="op" id="3068527">:=</span>&nbsp;<span class="ident" id="3068530">dec</span><span class="op" id="3068533">.</span><span class="ident" id="3068534">newDecoderState</span><span class="op" id="3068549">(</span><span class="op" id="3068550">&amp;</span><span class="ident" id="3068551">dec</span><span class="op" id="3068554">.</span><span class="ident" id="3068555">buf</span><span class="op" id="3068558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068561">defer</span>&nbsp;<span class="ident" id="3068567">dec</span><span class="op" id="3068570">.</span><span class="ident" id="3068571">freeDecoderState</span><span class="op" id="3068587">(</span><span class="ident" id="3068588">state</span><span class="op" id="3068593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068596">state</span><span class="op" id="3068601">.</span><span class="ident" id="3068602">fieldnum</span>&nbsp;<span class="op" id="3068611">=</span>&nbsp;<span class="ident" id="3068613">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068629">delta</span>&nbsp;<span class="op" id="3068635">:=</span>&nbsp;<span class="builtintype" id="3068638">int</span><span class="op" id="3068641">(</span><span class="ident" id="3068642">state</span><span class="op" id="3068647">.</span><span class="ident" id="3068648">decodeUint</span><span class="op" id="3068658">(</span><span class="op" id="3068659">)</span><span class="op" id="3068660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3068663">if</span>&nbsp;<span class="ident" id="3068666">delta</span>&nbsp;<span class="op" id="3068672">!=</span>&nbsp;<span class="num" id="3068675">0</span>&nbsp;<span class="op" id="3068677">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068681">errorf</span><span class="op" id="3068687">(</span><span class="string" id="3068688">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="3068742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3068745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068748">instr</span>&nbsp;<span class="op" id="3068754">:=</span>&nbsp;<span class="op" id="3068757">&amp;</span><span class="ident" id="3068758">engine</span><span class="op" id="3068764">.</span><span class="ident" id="3068765">instr</span><span class="op" id="3068770">[</span><span class="ident" id="3068771">singletonField</span><span class="op" id="3068785">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3068788">instr</span><span class="op" id="3068793">.</span><span class="ident" id="3068794">op</span><span class="op" id="3068796">(</span><span class="ident" id="3068797">instr</span><span class="op" id="3068802">,</span>&nbsp;<span class="ident" id="3068804">state</span><span class="op" id="3068809">,</span>&nbsp;<span class="ident" id="3068811">noValue</span><span class="op" id="3068818">)</span><br>
<span class="lineno"></span><span class="op" id="3068820">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="comment" id="3068823">//&nbsp;decodeArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;decoding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="3068890">func</span>&nbsp;<span class="op" id="3068895">(</span><span class="ident" id="3068896">dec</span>&nbsp;<span class="op" id="3068900">*</span><span class="ident" id="3068901">Decoder</span><span class="op" id="3068908">)</span>&nbsp;<span class="ident" id="3068910">decodeArrayHelper</span><span class="op" id="3068927">(</span><span class="ident" id="3068928">state</span>&nbsp;<span class="op" id="3068934">*</span><span class="ident" id="3068935">decoderState</span><span class="op" id="3068947">,</span>&nbsp;<span class="ident" id="3068949">value</span>&nbsp;<span class="ident" id="3068955">reflect</span><span class="op" id="3068962">.</span><span class="ident" id="3068963">Value</span><span class="op" id="3068968">,</span>&nbsp;<span class="ident" id="3068970">elemOp</span>&nbsp;<span class="ident" id="3068977">decOp</span><span class="op" id="3068982">,</span>&nbsp;<span class="ident" id="3068984">length</span>&nbsp;<span class="builtintype" id="3068991">int</span><span class="op" id="3068994">,</span>&nbsp;<span class="ident" id="3068996">ovfl</span>&nbsp;<span class="builtintype" id="3069001">error</span><span class="op" id="3069006">,</span>&nbsp;<span class="ident" id="3069008">helper</span>&nbsp;<span class="ident" id="3069015">decHelper</span><span class="op" id="3069024">)</span>&nbsp;<span class="op" id="3069026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069029">if</span>&nbsp;<span class="ident" id="3069032">helper</span>&nbsp;<span class="op" id="3069039">!=</span>&nbsp;<span class="ident" id="3069042">nil</span>&nbsp;<span class="op" id="3069046">&amp;&amp;</span>&nbsp;<span class="ident" id="3069049">helper</span><span class="op" id="3069055">(</span><span class="ident" id="3069056">state</span><span class="op" id="3069061">,</span>&nbsp;<span class="ident" id="3069063">value</span><span class="op" id="3069068">,</span>&nbsp;<span class="ident" id="3069070">length</span><span class="op" id="3069076">,</span>&nbsp;<span class="ident" id="3069078">ovfl</span><span class="op" id="3069082">)</span>&nbsp;<span class="op" id="3069084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069088">return</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3069096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069099">instr</span>&nbsp;<span class="op" id="3069105">:=</span>&nbsp;<span class="op" id="3069108">&amp;</span><span class="ident" id="3069109">decInstr</span><span class="op" id="3069117">{</span><span class="ident" id="3069118">elemOp</span><span class="op" id="3069124">,</span>&nbsp;<span class="num" id="3069126">0</span><span class="op" id="3069127">,</span>&nbsp;<span class="ident" id="3069129">nil</span><span class="op" id="3069132">,</span>&nbsp;<span class="ident" id="3069134">ovfl</span><span class="op" id="3069138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069141">isPtr</span>&nbsp;<span class="op" id="3069147">:=</span>&nbsp;<span class="ident" id="3069150">value</span><span class="op" id="3069155">.</span><span class="ident" id="3069156">Type</span><span class="op" id="3069160">(</span><span class="op" id="3069161">)</span><span class="op" id="3069162">.</span><span class="ident" id="3069163">Elem</span><span class="op" id="3069167">(</span><span class="op" id="3069168">)</span><span class="op" id="3069169">.</span><span class="ident" id="3069170">Kind</span><span class="op" id="3069174">(</span><span class="op" id="3069175">)</span>&nbsp;<span class="op" id="3069177">==</span>&nbsp;<span class="ident" id="3069180">reflect</span><span class="op" id="3069187">.</span><span class="ident" id="3069188">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069193">for</span>&nbsp;<span class="ident" id="3069197">i</span>&nbsp;<span class="op" id="3069199">:=</span>&nbsp;<span class="num" id="3069202">0</span><span class="op" id="3069203">;</span>&nbsp;<span class="ident" id="3069205">i</span>&nbsp;<span class="op" id="3069207">&lt;</span>&nbsp;<span class="ident" id="3069209">length</span><span class="op" id="3069215">;</span>&nbsp;<span class="ident" id="3069217">i</span><span class="op" id="3069218">++</span>&nbsp;<span class="op" id="3069221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069225">if</span>&nbsp;<span class="ident" id="3069228">state</span><span class="op" id="3069233">.</span><span class="ident" id="3069234">b</span><span class="op" id="3069235">.</span><span class="ident" id="3069236">Len</span><span class="op" id="3069239">(</span><span class="op" id="3069240">)</span>&nbsp;<span class="op" id="3069242">==</span>&nbsp;<span class="num" id="3069245">0</span>&nbsp;<span class="op" id="3069247">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069252">errorf</span><span class="op" id="3069258">(</span><span class="string" id="3069259">&#34;decoding&nbsp;array&nbsp;or&nbsp;slice:&nbsp;length&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;elements)&#34;</span><span class="op" id="3069325">,</span>&nbsp;<span class="ident" id="3069327">length</span><span class="op" id="3069333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3069337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069341">v</span>&nbsp;<span class="op" id="3069343">:=</span>&nbsp;<span class="ident" id="3069346">value</span><span class="op" id="3069351">.</span><span class="ident" id="3069352">Index</span><span class="op" id="3069357">(</span><span class="ident" id="3069358">i</span><span class="op" id="3069359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069363">if</span>&nbsp;<span class="ident" id="3069366">isPtr</span>&nbsp;<span class="op" id="3069372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069377">v</span>&nbsp;<span class="op" id="3069379">=</span>&nbsp;<span class="ident" id="3069381">decAlloc</span><span class="op" id="3069389">(</span><span class="ident" id="3069390">v</span><span class="op" id="3069391">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3069395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069399">elemOp</span><span class="op" id="3069405">(</span><span class="ident" id="3069406">instr</span><span class="op" id="3069411">,</span>&nbsp;<span class="ident" id="3069413">state</span><span class="op" id="3069418">,</span>&nbsp;<span class="ident" id="3069420">v</span><span class="op" id="3069421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3069424">}</span><br>
<span class="lineno"></span><span class="op" id="3069426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3069429">//&nbsp;decodeArray&nbsp;decodes&nbsp;an&nbsp;array&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3069485">//&nbsp;The&nbsp;length&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;preceding&nbsp;the&nbsp;elements.&nbsp;&nbsp;Even&nbsp;though&nbsp;the&nbsp;length&nbsp;is&nbsp;redundant</span><br>
<span class="lineno"></span><span class="comment" id="3069583">//&nbsp;(it&#39;s&nbsp;part&nbsp;of&nbsp;the&nbsp;type),&nbsp;it&#39;s&nbsp;a&nbsp;useful&nbsp;check&nbsp;and&nbsp;is&nbsp;included&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3069664">func</span>&nbsp;<span class="op" id="3069669">(</span><span class="ident" id="3069670">dec</span>&nbsp;<span class="op" id="3069674">*</span><span class="ident" id="3069675">Decoder</span><span class="op" id="3069682">)</span>&nbsp;<span class="ident" id="3069684">decodeArray</span><span class="op" id="3069695">(</span><span class="ident" id="3069696">atyp</span>&nbsp;<span class="ident" id="3069701">reflect</span><span class="op" id="3069708">.</span><span class="ident" id="3069709">Type</span><span class="op" id="3069713">,</span>&nbsp;<span class="ident" id="3069715">state</span>&nbsp;<span class="op" id="3069721">*</span><span class="ident" id="3069722">decoderState</span><span class="op" id="3069734">,</span>&nbsp;<span class="ident" id="3069736">value</span>&nbsp;<span class="ident" id="3069742">reflect</span><span class="op" id="3069749">.</span><span class="ident" id="3069750">Value</span><span class="op" id="3069755">,</span>&nbsp;<span class="ident" id="3069757">elemOp</span>&nbsp;<span class="ident" id="3069764">decOp</span><span class="op" id="3069769">,</span>&nbsp;<span class="ident" id="3069771">length</span>&nbsp;<span class="builtintype" id="3069778">int</span><span class="op" id="3069781">,</span>&nbsp;<span class="ident" id="3069783">ovfl</span>&nbsp;<span class="builtintype" id="3069788">error</span><span class="op" id="3069793">,</span>&nbsp;<span class="ident" id="3069795">helper</span>&nbsp;<span class="ident" id="3069802">decHelper</span><span class="op" id="3069811">)</span>&nbsp;<span class="op" id="3069813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3069816">if</span>&nbsp;<span class="ident" id="3069819">n</span>&nbsp;<span class="op" id="3069821">:=</span>&nbsp;<span class="ident" id="3069824">state</span><span class="op" id="3069829">.</span><span class="ident" id="3069830">decodeUint</span><span class="op" id="3069840">(</span><span class="op" id="3069841">)</span><span class="op" id="3069842">;</span>&nbsp;<span class="ident" id="3069844">n</span>&nbsp;<span class="op" id="3069846">!=</span>&nbsp;<span class="ident" id="3069849">uint64</span><span class="op" id="3069855">(</span><span class="ident" id="3069856">length</span><span class="op" id="3069862">)</span>&nbsp;<span class="op" id="3069864">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069868">errorf</span><span class="op" id="3069874">(</span><span class="string" id="3069875">&#34;length&nbsp;mismatch&nbsp;in&nbsp;decodeArray&#34;</span><span class="op" id="3069907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3069910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3069913">dec</span><span class="op" id="3069916">.</span><span class="ident" id="3069917">decodeArrayHelper</span><span class="op" id="3069934">(</span><span class="ident" id="3069935">state</span><span class="op" id="3069940">,</span>&nbsp;<span class="ident" id="3069942">value</span><span class="op" id="3069947">,</span>&nbsp;<span class="ident" id="3069949">elemOp</span><span class="op" id="3069955">,</span>&nbsp;<span class="ident" id="3069957">length</span><span class="op" id="3069963">,</span>&nbsp;<span class="ident" id="3069965">ovfl</span><span class="op" id="3069969">,</span>&nbsp;<span class="ident" id="3069971">helper</span><span class="op" id="3069977">)</span><br>
<span class="lineno"></span><span class="op" id="3069979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="3069982">//&nbsp;decodeIntoValue&nbsp;is&nbsp;a&nbsp;helper&nbsp;for&nbsp;map&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3070031">func</span>&nbsp;<span class="ident" id="3070036">decodeIntoValue</span><span class="op" id="3070051">(</span><span class="ident" id="3070052">state</span>&nbsp;<span class="op" id="3070058">*</span><span class="ident" id="3070059">decoderState</span><span class="op" id="3070071">,</span>&nbsp;<span class="ident" id="3070073">op</span>&nbsp;<span class="ident" id="3070076">decOp</span><span class="op" id="3070081">,</span>&nbsp;<span class="ident" id="3070083">isPtr</span>&nbsp;<span class="builtintype" id="3070089">bool</span><span class="op" id="3070093">,</span>&nbsp;<span class="ident" id="3070095">value</span>&nbsp;<span class="ident" id="3070101">reflect</span><span class="op" id="3070108">.</span><span class="ident" id="3070109">Value</span><span class="op" id="3070114">,</span>&nbsp;<span class="ident" id="3070116">ovfl</span>&nbsp;<span class="builtintype" id="3070121">error</span><span class="op" id="3070126">)</span>&nbsp;<span class="ident" id="3070128">reflect</span><span class="op" id="3070135">.</span><span class="ident" id="3070136">Value</span>&nbsp;<span class="op" id="3070142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070145">instr</span>&nbsp;<span class="op" id="3070151">:=</span>&nbsp;<span class="op" id="3070154">&amp;</span><span class="ident" id="3070155">decInstr</span><span class="op" id="3070163">{</span><span class="ident" id="3070164">op</span><span class="op" id="3070166">,</span>&nbsp;<span class="num" id="3070168">0</span><span class="op" id="3070169">,</span>&nbsp;<span class="ident" id="3070171">nil</span><span class="op" id="3070174">,</span>&nbsp;<span class="ident" id="3070176">ovfl</span><span class="op" id="3070180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070183">v</span>&nbsp;<span class="op" id="3070185">:=</span>&nbsp;<span class="ident" id="3070188">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070195">if</span>&nbsp;<span class="ident" id="3070198">isPtr</span>&nbsp;<span class="op" id="3070204">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070208">v</span>&nbsp;<span class="op" id="3070210">=</span>&nbsp;<span class="ident" id="3070212">decAlloc</span><span class="op" id="3070220">(</span><span class="ident" id="3070221">value</span><span class="op" id="3070226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3070229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070232">op</span><span class="op" id="3070234">(</span><span class="ident" id="3070235">instr</span><span class="op" id="3070240">,</span>&nbsp;<span class="ident" id="3070242">state</span><span class="op" id="3070247">,</span>&nbsp;<span class="ident" id="3070249">v</span><span class="op" id="3070250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070253">return</span>&nbsp;<span class="ident" id="3070260">value</span><br>
<span class="lineno"></span><span class="op" id="3070266">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="3070269">//&nbsp;decodeMap&nbsp;decodes&nbsp;a&nbsp;map&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3070320">//&nbsp;Maps&nbsp;are&nbsp;encoded&nbsp;as&nbsp;a&nbsp;length&nbsp;followed&nbsp;by&nbsp;key:value&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="3070381">//&nbsp;Because&nbsp;the&nbsp;internals&nbsp;of&nbsp;maps&nbsp;are&nbsp;not&nbsp;visible&nbsp;to&nbsp;us,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="3070445">//&nbsp;use&nbsp;reflection&nbsp;rather&nbsp;than&nbsp;pointer&nbsp;magic.</span><br>
<span class="lineno">555</span><span class="keyword" id="3070490">func</span>&nbsp;<span class="op" id="3070495">(</span><span class="ident" id="3070496">dec</span>&nbsp;<span class="op" id="3070500">*</span><span class="ident" id="3070501">Decoder</span><span class="op" id="3070508">)</span>&nbsp;<span class="ident" id="3070510">decodeMap</span><span class="op" id="3070519">(</span><span class="ident" id="3070520">mtyp</span>&nbsp;<span class="ident" id="3070525">reflect</span><span class="op" id="3070532">.</span><span class="ident" id="3070533">Type</span><span class="op" id="3070537">,</span>&nbsp;<span class="ident" id="3070539">state</span>&nbsp;<span class="op" id="3070545">*</span><span class="ident" id="3070546">decoderState</span><span class="op" id="3070558">,</span>&nbsp;<span class="ident" id="3070560">value</span>&nbsp;<span class="ident" id="3070566">reflect</span><span class="op" id="3070573">.</span><span class="ident" id="3070574">Value</span><span class="op" id="3070579">,</span>&nbsp;<span class="ident" id="3070581">keyOp</span><span class="op" id="3070586">,</span>&nbsp;<span class="ident" id="3070588">elemOp</span>&nbsp;<span class="ident" id="3070595">decOp</span><span class="op" id="3070600">,</span>&nbsp;<span class="ident" id="3070602">ovfl</span>&nbsp;<span class="builtintype" id="3070607">error</span><span class="op" id="3070612">)</span>&nbsp;<span class="op" id="3070614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070617">if</span>&nbsp;<span class="ident" id="3070620">value</span><span class="op" id="3070625">.</span><span class="ident" id="3070626">IsNil</span><span class="op" id="3070631">(</span><span class="op" id="3070632">)</span>&nbsp;<span class="op" id="3070634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3070638">//&nbsp;Allocate&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070657">value</span><span class="op" id="3070662">.</span><span class="ident" id="3070663">Set</span><span class="op" id="3070666">(</span><span class="ident" id="3070667">reflect</span><span class="op" id="3070674">.</span><span class="ident" id="3070675">MakeMap</span><span class="op" id="3070682">(</span><span class="ident" id="3070683">mtyp</span><span class="op" id="3070687">)</span><span class="op" id="3070688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3070691">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070694">n</span>&nbsp;<span class="op" id="3070696">:=</span>&nbsp;<span class="builtintype" id="3070699">int</span><span class="op" id="3070702">(</span><span class="ident" id="3070703">state</span><span class="op" id="3070708">.</span><span class="ident" id="3070709">decodeUint</span><span class="op" id="3070719">(</span><span class="op" id="3070720">)</span><span class="op" id="3070721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070724">keyIsPtr</span>&nbsp;<span class="op" id="3070733">:=</span>&nbsp;<span class="ident" id="3070736">mtyp</span><span class="op" id="3070740">.</span><span class="ident" id="3070741">Key</span><span class="op" id="3070744">(</span><span class="op" id="3070745">)</span><span class="op" id="3070746">.</span><span class="ident" id="3070747">Kind</span><span class="op" id="3070751">(</span><span class="op" id="3070752">)</span>&nbsp;<span class="op" id="3070754">==</span>&nbsp;<span class="ident" id="3070757">reflect</span><span class="op" id="3070764">.</span><span class="ident" id="3070765">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070770">elemIsPtr</span>&nbsp;<span class="op" id="3070780">:=</span>&nbsp;<span class="ident" id="3070783">mtyp</span><span class="op" id="3070787">.</span><span class="ident" id="3070788">Elem</span><span class="op" id="3070792">(</span><span class="op" id="3070793">)</span><span class="op" id="3070794">.</span><span class="ident" id="3070795">Kind</span><span class="op" id="3070799">(</span><span class="op" id="3070800">)</span>&nbsp;<span class="op" id="3070802">==</span>&nbsp;<span class="ident" id="3070805">reflect</span><span class="op" id="3070812">.</span><span class="ident" id="3070813">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3070818">for</span>&nbsp;<span class="ident" id="3070822">i</span>&nbsp;<span class="op" id="3070824">:=</span>&nbsp;<span class="num" id="3070827">0</span><span class="op" id="3070828">;</span>&nbsp;<span class="ident" id="3070830">i</span>&nbsp;<span class="op" id="3070832">&lt;</span>&nbsp;<span class="ident" id="3070834">n</span><span class="op" id="3070835">;</span>&nbsp;<span class="ident" id="3070837">i</span><span class="op" id="3070838">++</span>&nbsp;<span class="op" id="3070841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070845">key</span>&nbsp;<span class="op" id="3070849">:=</span>&nbsp;<span class="ident" id="3070852">decodeIntoValue</span><span class="op" id="3070867">(</span><span class="ident" id="3070868">state</span><span class="op" id="3070873">,</span>&nbsp;<span class="ident" id="3070875">keyOp</span><span class="op" id="3070880">,</span>&nbsp;<span class="ident" id="3070882">keyIsPtr</span><span class="op" id="3070890">,</span>&nbsp;<span class="ident" id="3070892">allocValue</span><span class="op" id="3070902">(</span><span class="ident" id="3070903">mtyp</span><span class="op" id="3070907">.</span><span class="ident" id="3070908">Key</span><span class="op" id="3070911">(</span><span class="op" id="3070912">)</span><span class="op" id="3070913">)</span><span class="op" id="3070914">,</span>&nbsp;<span class="ident" id="3070916">ovfl</span><span class="op" id="3070920">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3070924">elem</span>&nbsp;<span class="op" id="3070929">:=</span>&nbsp;<span class="ident" id="3070932">decodeIntoValue</span><span class="op" id="3070947">(</span><span class="ident" id="3070948">state</span><span class="op" id="3070953">,</span>&nbsp;<span class="ident" id="3070955">elemOp</span><span class="op" id="3070961">,</span>&nbsp;<span class="ident" id="3070963">elemIsPtr</span><span class="op" id="3070972">,</span>&nbsp;<span class="ident" id="3070974">allocValue</span><span class="op" id="3070984">(</span><span class="ident" id="3070985">mtyp</span><span class="op" id="3070989">.</span><span class="ident" id="3070990">Elem</span><span class="op" id="3070994">(</span><span class="op" id="3070995">)</span><span class="op" id="3070996">)</span><span class="op" id="3070997">,</span>&nbsp;<span class="ident" id="3070999">ovfl</span><span class="op" id="3071003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071007">value</span><span class="op" id="3071012">.</span><span class="ident" id="3071013">SetMapIndex</span><span class="op" id="3071024">(</span><span class="ident" id="3071025">key</span><span class="op" id="3071028">,</span>&nbsp;<span class="ident" id="3071030">elem</span><span class="op" id="3071034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3071037">}</span><br>
<span class="lineno"></span><span class="op" id="3071039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="3071042">//&nbsp;ignoreArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;discarding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="3071111">func</span>&nbsp;<span class="op" id="3071116">(</span><span class="ident" id="3071117">dec</span>&nbsp;<span class="op" id="3071121">*</span><span class="ident" id="3071122">Decoder</span><span class="op" id="3071129">)</span>&nbsp;<span class="ident" id="3071131">ignoreArrayHelper</span><span class="op" id="3071148">(</span><span class="ident" id="3071149">state</span>&nbsp;<span class="op" id="3071155">*</span><span class="ident" id="3071156">decoderState</span><span class="op" id="3071168">,</span>&nbsp;<span class="ident" id="3071170">elemOp</span>&nbsp;<span class="ident" id="3071177">decOp</span><span class="op" id="3071182">,</span>&nbsp;<span class="ident" id="3071184">length</span>&nbsp;<span class="builtintype" id="3071191">int</span><span class="op" id="3071194">)</span>&nbsp;<span class="op" id="3071196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071199">instr</span>&nbsp;<span class="op" id="3071205">:=</span>&nbsp;<span class="op" id="3071208">&amp;</span><span class="ident" id="3071209">decInstr</span><span class="op" id="3071217">{</span><span class="ident" id="3071218">elemOp</span><span class="op" id="3071224">,</span>&nbsp;<span class="num" id="3071226">0</span><span class="op" id="3071227">,</span>&nbsp;<span class="ident" id="3071229">nil</span><span class="op" id="3071232">,</span>&nbsp;<span class="ident" id="3071234">errors</span><span class="op" id="3071240">.</span><span class="ident" id="3071241">New</span><span class="op" id="3071244">(</span><span class="string" id="3071245">&#34;no&nbsp;error&#34;</span><span class="op" id="3071255">)</span><span class="op" id="3071256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071259">for</span>&nbsp;<span class="ident" id="3071263">i</span>&nbsp;<span class="op" id="3071265">:=</span>&nbsp;<span class="num" id="3071268">0</span><span class="op" id="3071269">;</span>&nbsp;<span class="ident" id="3071271">i</span>&nbsp;<span class="op" id="3071273">&lt;</span>&nbsp;<span class="ident" id="3071275">length</span><span class="op" id="3071281">;</span>&nbsp;<span class="ident" id="3071283">i</span><span class="op" id="3071284">++</span>&nbsp;<span class="op" id="3071287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071291">elemOp</span><span class="op" id="3071297">(</span><span class="ident" id="3071298">instr</span><span class="op" id="3071303">,</span>&nbsp;<span class="ident" id="3071305">state</span><span class="op" id="3071310">,</span>&nbsp;<span class="ident" id="3071312">noValue</span><span class="op" id="3071319">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3071322">}</span><br>
<span class="lineno"></span><span class="op" id="3071324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3071327">//&nbsp;ignoreArray&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;array&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3071400">func</span>&nbsp;<span class="op" id="3071405">(</span><span class="ident" id="3071406">dec</span>&nbsp;<span class="op" id="3071410">*</span><span class="ident" id="3071411">Decoder</span><span class="op" id="3071418">)</span>&nbsp;<span class="ident" id="3071420">ignoreArray</span><span class="op" id="3071431">(</span><span class="ident" id="3071432">state</span>&nbsp;<span class="op" id="3071438">*</span><span class="ident" id="3071439">decoderState</span><span class="op" id="3071451">,</span>&nbsp;<span class="ident" id="3071453">elemOp</span>&nbsp;<span class="ident" id="3071460">decOp</span><span class="op" id="3071465">,</span>&nbsp;<span class="ident" id="3071467">length</span>&nbsp;<span class="builtintype" id="3071474">int</span><span class="op" id="3071477">)</span>&nbsp;<span class="op" id="3071479">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071482">if</span>&nbsp;<span class="ident" id="3071485">n</span>&nbsp;<span class="op" id="3071487">:=</span>&nbsp;<span class="ident" id="3071490">state</span><span class="op" id="3071495">.</span><span class="ident" id="3071496">decodeUint</span><span class="op" id="3071506">(</span><span class="op" id="3071507">)</span><span class="op" id="3071508">;</span>&nbsp;<span class="ident" id="3071510">n</span>&nbsp;<span class="op" id="3071512">!=</span>&nbsp;<span class="ident" id="3071515">uint64</span><span class="op" id="3071521">(</span><span class="ident" id="3071522">length</span><span class="op" id="3071528">)</span>&nbsp;<span class="op" id="3071530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071534">errorf</span><span class="op" id="3071540">(</span><span class="string" id="3071541">&#34;length&nbsp;mismatch&nbsp;in&nbsp;ignoreArray&#34;</span><span class="op" id="3071573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3071576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071579">dec</span><span class="op" id="3071582">.</span><span class="ident" id="3071583">ignoreArrayHelper</span><span class="op" id="3071600">(</span><span class="ident" id="3071601">state</span><span class="op" id="3071606">,</span>&nbsp;<span class="ident" id="3071608">elemOp</span><span class="op" id="3071614">,</span>&nbsp;<span class="ident" id="3071616">length</span><span class="op" id="3071622">)</span><br>
<span class="lineno"></span><span class="op" id="3071624">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="comment" id="3071627">//&nbsp;ignoreMap&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;map&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3071695">func</span>&nbsp;<span class="op" id="3071700">(</span><span class="ident" id="3071701">dec</span>&nbsp;<span class="op" id="3071705">*</span><span class="ident" id="3071706">Decoder</span><span class="op" id="3071713">)</span>&nbsp;<span class="ident" id="3071715">ignoreMap</span><span class="op" id="3071724">(</span><span class="ident" id="3071725">state</span>&nbsp;<span class="op" id="3071731">*</span><span class="ident" id="3071732">decoderState</span><span class="op" id="3071744">,</span>&nbsp;<span class="ident" id="3071746">keyOp</span><span class="op" id="3071751">,</span>&nbsp;<span class="ident" id="3071753">elemOp</span>&nbsp;<span class="ident" id="3071760">decOp</span><span class="op" id="3071765">)</span>&nbsp;<span class="op" id="3071767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071770">n</span>&nbsp;<span class="op" id="3071772">:=</span>&nbsp;<span class="builtintype" id="3071775">int</span><span class="op" id="3071778">(</span><span class="ident" id="3071779">state</span><span class="op" id="3071784">.</span><span class="ident" id="3071785">decodeUint</span><span class="op" id="3071795">(</span><span class="op" id="3071796">)</span><span class="op" id="3071797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071800">keyInstr</span>&nbsp;<span class="op" id="3071809">:=</span>&nbsp;<span class="op" id="3071812">&amp;</span><span class="ident" id="3071813">decInstr</span><span class="op" id="3071821">{</span><span class="ident" id="3071822">keyOp</span><span class="op" id="3071827">,</span>&nbsp;<span class="num" id="3071829">0</span><span class="op" id="3071830">,</span>&nbsp;<span class="ident" id="3071832">nil</span><span class="op" id="3071835">,</span>&nbsp;<span class="ident" id="3071837">errors</span><span class="op" id="3071843">.</span><span class="ident" id="3071844">New</span><span class="op" id="3071847">(</span><span class="string" id="3071848">&#34;no&nbsp;error&#34;</span><span class="op" id="3071858">)</span><span class="op" id="3071859">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071862">elemInstr</span>&nbsp;<span class="op" id="3071872">:=</span>&nbsp;<span class="op" id="3071875">&amp;</span><span class="ident" id="3071876">decInstr</span><span class="op" id="3071884">{</span><span class="ident" id="3071885">elemOp</span><span class="op" id="3071891">,</span>&nbsp;<span class="num" id="3071893">0</span><span class="op" id="3071894">,</span>&nbsp;<span class="ident" id="3071896">nil</span><span class="op" id="3071899">,</span>&nbsp;<span class="ident" id="3071901">errors</span><span class="op" id="3071907">.</span><span class="ident" id="3071908">New</span><span class="op" id="3071911">(</span><span class="string" id="3071912">&#34;no&nbsp;error&#34;</span><span class="op" id="3071922">)</span><span class="op" id="3071923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3071926">for</span>&nbsp;<span class="ident" id="3071930">i</span>&nbsp;<span class="op" id="3071932">:=</span>&nbsp;<span class="num" id="3071935">0</span><span class="op" id="3071936">;</span>&nbsp;<span class="ident" id="3071938">i</span>&nbsp;<span class="op" id="3071940">&lt;</span>&nbsp;<span class="ident" id="3071942">n</span><span class="op" id="3071943">;</span>&nbsp;<span class="ident" id="3071945">i</span><span class="op" id="3071946">++</span>&nbsp;<span class="op" id="3071949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071953">keyOp</span><span class="op" id="3071958">(</span><span class="ident" id="3071959">keyInstr</span><span class="op" id="3071967">,</span>&nbsp;<span class="ident" id="3071969">state</span><span class="op" id="3071974">,</span>&nbsp;<span class="ident" id="3071976">noValue</span><span class="op" id="3071983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3071987">elemOp</span><span class="op" id="3071993">(</span><span class="ident" id="3071994">elemInstr</span><span class="op" id="3072003">,</span>&nbsp;<span class="ident" id="3072005">state</span><span class="op" id="3072010">,</span>&nbsp;<span class="ident" id="3072012">noValue</span><span class="op" id="3072019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3072022">}</span><br>
<span class="lineno">595</span><span class="op" id="3072024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3072027">//&nbsp;decodeSlice&nbsp;decodes&nbsp;a&nbsp;slice&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3072082">//&nbsp;Slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;length&nbsp;followed&nbsp;by&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="3072152">func</span>&nbsp;<span class="op" id="3072157">(</span><span class="ident" id="3072158">dec</span>&nbsp;<span class="op" id="3072162">*</span><span class="ident" id="3072163">Decoder</span><span class="op" id="3072170">)</span>&nbsp;<span class="ident" id="3072172">decodeSlice</span><span class="op" id="3072183">(</span><span class="ident" id="3072184">state</span>&nbsp;<span class="op" id="3072190">*</span><span class="ident" id="3072191">decoderState</span><span class="op" id="3072203">,</span>&nbsp;<span class="ident" id="3072205">value</span>&nbsp;<span class="ident" id="3072211">reflect</span><span class="op" id="3072218">.</span><span class="ident" id="3072219">Value</span><span class="op" id="3072224">,</span>&nbsp;<span class="ident" id="3072226">elemOp</span>&nbsp;<span class="ident" id="3072233">decOp</span><span class="op" id="3072238">,</span>&nbsp;<span class="ident" id="3072240">ovfl</span>&nbsp;<span class="builtintype" id="3072245">error</span><span class="op" id="3072250">,</span>&nbsp;<span class="ident" id="3072252">helper</span>&nbsp;<span class="ident" id="3072259">decHelper</span><span class="op" id="3072268">)</span>&nbsp;<span class="op" id="3072270">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3072273">u</span>&nbsp;<span class="op" id="3072275">:=</span>&nbsp;<span class="ident" id="3072278">state</span><span class="op" id="3072283">.</span><span class="ident" id="3072284">decodeUint</span><span class="op" id="3072294">(</span><span class="op" id="3072295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3072298">typ</span>&nbsp;<span class="op" id="3072302">:=</span>&nbsp;<span class="ident" id="3072305">value</span><span class="op" id="3072310">.</span><span class="ident" id="3072311">Type</span><span class="op" id="3072315">(</span><span class="op" id="3072316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3072319">size</span>&nbsp;<span class="op" id="3072324">:=</span>&nbsp;<span class="ident" id="3072327">uint64</span><span class="op" id="3072333">(</span><span class="ident" id="3072334">typ</span><span class="op" id="3072337">.</span><span class="ident" id="3072338">Elem</span><span class="op" id="3072342">(</span><span class="op" id="3072343">)</span><span class="op" id="3072344">.</span><span class="ident" id="3072345">Size</span><span class="op" id="3072349">(</span><span class="op" id="3072350">)</span><span class="op" id="3072351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3072354">nBytes</span>&nbsp;<span class="op" id="3072361">:=</span>&nbsp;<span class="ident" id="3072364">u</span>&nbsp;<span class="op" id="3072366">*</span>&nbsp;<span class="ident" id="3072368">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3072374">n</span>&nbsp;<span class="op" id="3072376">:=</span>&nbsp;<span class="builtintype" id="3072379">int</span><span class="op" id="3072382">(</span><span class="ident" id="3072383">u</span><span class="op" id="3072384">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3072387">//&nbsp;Take&nbsp;care&nbsp;with&nbsp;overflow&nbsp;in&nbsp;this&nbsp;calculation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3072436">if</span>&nbsp;<span class="ident" id="3072439">n</span>&nbsp;<span class="op" id="3072441">&lt;</span>&nbsp;<span class="num" id="3072443">0</span>&nbsp;<span class="op" id="3072445">||</span>&nbsp;<span class="ident" id="3072448">uint64</span><span class="op" id="3072454">(</span><span class="ident" id="3072455">n</span><span class="op" id="3072456">)</span>&nbsp;<span class="op" id="3072458">!=</span>&nbsp;<span class="ident" id="3072461">u</span>&nbsp;<span class="op" id="3072463">||</span>&nbsp;<span class="ident" id="3072466">nBytes</span>&nbsp;<span class="op" id="3072473">&gt;</span>&nbsp;<span class="ident" id="3072475">tooBig</span>&nbsp;<span class="op" id="3072482">||</span>&nbsp;<span class="op" id="3072485">(</span><span class="ident" id="3072486">size</span>&nbsp;<span class="op" id="3072491">&gt;</span>&nbsp;<span class="num" id="3072493">0</span>&nbsp;<span class="op" id="3072495">&amp;&amp;</span>&nbsp;<span class="ident" id="3072498">nBytes</span><span class="op" id="3072504">/</span><span class="ident" id="3072505">size</span>&nbsp;<span class="op" id="3072510">!=</span>&nbsp;<span class="ident" id="3072513">u</span><span class="op" id="3072514">)</span>&nbsp;<span class="op" id="3072516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3072520">//&nbsp;We&nbsp;don&#39;t&nbsp;check&nbsp;n&nbsp;against&nbsp;buffer&nbsp;length&nbsp;here&nbsp;because&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3072593">//&nbsp;of&nbsp;interfaces,&nbsp;there&nbsp;will&nbsp;be&nbsp;buffer&nbsp;reloads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3072643">errorf</span><span class="op" id="3072649">(</span><span class="string" id="3072650">&#34;%s&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&nbsp;elements&nbsp;of&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="3072693">,</span>&nbsp;<span class="ident" id="3072695">typ</span><span class="op" id="3072698">.</span><span class="ident" id="3072699">Elem</span><span class="op" id="3072703">(</span><span class="op" id="3072704">)</span><span class="op" id="3072705">,</span>&nbsp;<span class="ident" id="3072707">u</span><span class="op" id="3072708">,</span>&nbsp;<span class="ident" id="3072710">size</span><span class="op" id="3072714">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3072717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3072720">if</span>&nbsp;<span class="ident" id="3072723">value</span><span class="op" id="3072728">.</span><span class="ident" id="3072729">Cap</span><span class="op" id="3072732">(</span><span class="op" id="3072733">)</span>&nbsp;<span class="op" id="3072735">&lt;</span>&nbsp;<span class="ident" id="3072737">n</span>&nbsp;<span class="op" id="3072739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3072743">value</span><span class="op" id="3072748">.</span><span class="ident" id="3072749">Set</span><span class="op" id="3072752">(</span><span class="ident" id="3072753">reflect</span><span class="op" id="3072760">.</span><span class="ident" id="3072761">MakeSlice</span><span class="op" id="3072770">(</span><span class="ident" id="3072771">typ</span><span class="op" id="3072774">,</span>&nbsp;<span class="ident" id="3072776">n</span><span class="op" id="3072777">,</span>&nbsp;<span class="ident" id="3072779">n</span><span class="op" id="3072780">)</span><span class="op" id="3072781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3072784">}</span>&nbsp;<span class="keyword" id="3072786">else</span>&nbsp;<span class="op" id="3072791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3072795">value</span><span class="op" id="3072800">.</span><span class="ident" id="3072801">Set</span><span class="op" id="3072804">(</span><span class="ident" id="3072805">value</span><span class="op" id="3072810">.</span><span class="ident" id="3072811">Slice</span><span class="op" id="3072816">(</span><span class="num" id="3072817">0</span><span class="op" id="3072818">,</span>&nbsp;<span class="ident" id="3072820">n</span><span class="op" id="3072821">)</span><span class="op" id="3072822">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3072825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3072828">dec</span><span class="op" id="3072831">.</span><span class="ident" id="3072832">decodeArrayHelper</span><span class="op" id="3072849">(</span><span class="ident" id="3072850">state</span><span class="op" id="3072855">,</span>&nbsp;<span class="ident" id="3072857">value</span><span class="op" id="3072862">,</span>&nbsp;<span class="ident" id="3072864">elemOp</span><span class="op" id="3072870">,</span>&nbsp;<span class="ident" id="3072872">n</span><span class="op" id="3072873">,</span>&nbsp;<span class="ident" id="3072875">ovfl</span><span class="op" id="3072879">,</span>&nbsp;<span class="ident" id="3072881">helper</span><span class="op" id="3072887">)</span><br>
<span class="lineno"></span><span class="op" id="3072889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3072892">//&nbsp;ignoreSlice&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">620</span><span class="keyword" id="3072966">func</span>&nbsp;<span class="op" id="3072971">(</span><span class="ident" id="3072972">dec</span>&nbsp;<span class="op" id="3072976">*</span><span class="ident" id="3072977">Decoder</span><span class="op" id="3072984">)</span>&nbsp;<span class="ident" id="3072986">ignoreSlice</span><span class="op" id="3072997">(</span><span class="ident" id="3072998">state</span>&nbsp;<span class="op" id="3073004">*</span><span class="ident" id="3073005">decoderState</span><span class="op" id="3073017">,</span>&nbsp;<span class="ident" id="3073019">elemOp</span>&nbsp;<span class="ident" id="3073026">decOp</span><span class="op" id="3073031">)</span>&nbsp;<span class="op" id="3073033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073036">dec</span><span class="op" id="3073039">.</span><span class="ident" id="3073040">ignoreArrayHelper</span><span class="op" id="3073057">(</span><span class="ident" id="3073058">state</span><span class="op" id="3073063">,</span>&nbsp;<span class="ident" id="3073065">elemOp</span><span class="op" id="3073071">,</span>&nbsp;<span class="builtintype" id="3073073">int</span><span class="op" id="3073076">(</span><span class="ident" id="3073077">state</span><span class="op" id="3073082">.</span><span class="ident" id="3073083">decodeUint</span><span class="op" id="3073093">(</span><span class="op" id="3073094">)</span><span class="op" id="3073095">)</span><span class="op" id="3073096">)</span><br>
<span class="lineno"></span><span class="op" id="3073098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3073101">//&nbsp;decodeInterface&nbsp;decodes&nbsp;an&nbsp;interface&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">625</span><span class="comment" id="3073171">//&nbsp;Interfaces&nbsp;are&nbsp;encoded&nbsp;as&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;concrete&nbsp;type&nbsp;followed&nbsp;by&nbsp;a&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3073249">//&nbsp;If&nbsp;the&nbsp;name&nbsp;is&nbsp;empty,&nbsp;the&nbsp;value&nbsp;is&nbsp;nil&nbsp;and&nbsp;no&nbsp;value&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="3073313">func</span>&nbsp;<span class="op" id="3073318">(</span><span class="ident" id="3073319">dec</span>&nbsp;<span class="op" id="3073323">*</span><span class="ident" id="3073324">Decoder</span><span class="op" id="3073331">)</span>&nbsp;<span class="ident" id="3073333">decodeInterface</span><span class="op" id="3073348">(</span><span class="ident" id="3073349">ityp</span>&nbsp;<span class="ident" id="3073354">reflect</span><span class="op" id="3073361">.</span><span class="ident" id="3073362">Type</span><span class="op" id="3073366">,</span>&nbsp;<span class="ident" id="3073368">state</span>&nbsp;<span class="op" id="3073374">*</span><span class="ident" id="3073375">decoderState</span><span class="op" id="3073387">,</span>&nbsp;<span class="ident" id="3073389">value</span>&nbsp;<span class="ident" id="3073395">reflect</span><span class="op" id="3073402">.</span><span class="ident" id="3073403">Value</span><span class="op" id="3073408">)</span>&nbsp;<span class="op" id="3073410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3073413">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073453">nr</span>&nbsp;<span class="op" id="3073456">:=</span>&nbsp;<span class="ident" id="3073459">state</span><span class="op" id="3073464">.</span><span class="ident" id="3073465">decodeUint</span><span class="op" id="3073475">(</span><span class="op" id="3073476">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073479">if</span>&nbsp;<span class="ident" id="3073482">nr</span>&nbsp;<span class="op" id="3073485">&lt;</span>&nbsp;<span class="num" id="3073487">0</span>&nbsp;<span class="op" id="3073489">||</span>&nbsp;<span class="ident" id="3073492">nr</span>&nbsp;<span class="op" id="3073495">&gt;</span>&nbsp;<span class="num" id="3073497">1</span><span class="op" id="3073498">&lt;&lt;</span><span class="num" id="3073500">31</span>&nbsp;<span class="op" id="3073503">{</span>&nbsp;<span class="comment" id="3073505">//&nbsp;zero&nbsp;is&nbsp;permissible&nbsp;for&nbsp;anonymous&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073550">errorf</span><span class="op" id="3073556">(</span><span class="string" id="3073557">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d&#34;</span><span class="op" id="3073586">,</span>&nbsp;<span class="ident" id="3073588">nr</span><span class="op" id="3073590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3073593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073596">if</span>&nbsp;<span class="ident" id="3073599">nr</span>&nbsp;<span class="op" id="3073602">&gt;</span>&nbsp;<span class="ident" id="3073604">uint64</span><span class="op" id="3073610">(</span><span class="ident" id="3073611">state</span><span class="op" id="3073616">.</span><span class="ident" id="3073617">b</span><span class="op" id="3073618">.</span><span class="ident" id="3073619">Len</span><span class="op" id="3073622">(</span><span class="op" id="3073623">)</span><span class="op" id="3073624">)</span>&nbsp;<span class="op" id="3073626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073630">errorf</span><span class="op" id="3073636">(</span><span class="string" id="3073637">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d:&nbsp;exceeds&nbsp;input&nbsp;size&#34;</span><span class="op" id="3073686">,</span>&nbsp;<span class="ident" id="3073688">nr</span><span class="op" id="3073690">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3073693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073696">b</span>&nbsp;<span class="op" id="3073698">:=</span>&nbsp;<span class="builtinfunc" id="3073701">make</span><span class="op" id="3073705">(</span><span class="op" id="3073706">[</span><span class="op" id="3073707">]</span><span class="builtintype" id="3073708">byte</span><span class="op" id="3073712">,</span>&nbsp;<span class="ident" id="3073714">nr</span><span class="op" id="3073716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073719">state</span><span class="op" id="3073724">.</span><span class="ident" id="3073725">b</span><span class="op" id="3073726">.</span><span class="ident" id="3073727">Read</span><span class="op" id="3073731">(</span><span class="ident" id="3073732">b</span><span class="op" id="3073733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073736">name</span>&nbsp;<span class="op" id="3073741">:=</span>&nbsp;<span class="builtintype" id="3073744">string</span><span class="op" id="3073750">(</span><span class="ident" id="3073751">b</span><span class="op" id="3073752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3073755">//&nbsp;Allocate&nbsp;the&nbsp;destination&nbsp;interface&nbsp;value.</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073801">if</span>&nbsp;<span class="ident" id="3073804">name</span>&nbsp;<span class="op" id="3073809">==</span>&nbsp;<span class="string" id="3073812">&#34;&#34;</span>&nbsp;<span class="op" id="3073815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3073819">//&nbsp;Copy&nbsp;the&nbsp;nil&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073868">value</span><span class="op" id="3073873">.</span><span class="ident" id="3073874">Set</span><span class="op" id="3073877">(</span><span class="ident" id="3073878">reflect</span><span class="op" id="3073885">.</span><span class="ident" id="3073886">Zero</span><span class="op" id="3073890">(</span><span class="ident" id="3073891">value</span><span class="op" id="3073896">.</span><span class="ident" id="3073897">Type</span><span class="op" id="3073901">(</span><span class="op" id="3073902">)</span><span class="op" id="3073903">)</span><span class="op" id="3073904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073908">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3073916">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3073919">if</span>&nbsp;<span class="builtinfunc" id="3073922">len</span><span class="op" id="3073925">(</span><span class="ident" id="3073926">name</span><span class="op" id="3073930">)</span>&nbsp;<span class="op" id="3073932">&gt;</span>&nbsp;<span class="num" id="3073934">1024</span>&nbsp;<span class="op" id="3073939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3073943">errorf</span><span class="op" id="3073949">(</span><span class="string" id="3073950">&#34;name&nbsp;too&nbsp;long&nbsp;(%d&nbsp;bytes):&nbsp;%.20q...&#34;</span><span class="op" id="3073986">,</span>&nbsp;<span class="builtinfunc" id="3073988">len</span><span class="op" id="3073991">(</span><span class="ident" id="3073992">name</span><span class="op" id="3073996">)</span><span class="op" id="3073997">,</span>&nbsp;<span class="ident" id="3073999">name</span><span class="op" id="3074003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3074006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3074009">//&nbsp;The&nbsp;concrete&nbsp;type&nbsp;must&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074051">registerLock</span><span class="op" id="3074063">.</span><span class="ident" id="3074064">RLock</span><span class="op" id="3074069">(</span><span class="op" id="3074070">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074073">typ</span><span class="op" id="3074076">,</span>&nbsp;<span class="ident" id="3074078">ok</span>&nbsp;<span class="op" id="3074081">:=</span>&nbsp;<span class="ident" id="3074084">nameToConcreteType</span><span class="op" id="3074102">[</span><span class="ident" id="3074103">name</span><span class="op" id="3074107">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074110">registerLock</span><span class="op" id="3074122">.</span><span class="ident" id="3074123">RUnlock</span><span class="op" id="3074130">(</span><span class="op" id="3074131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074134">if</span>&nbsp;<span class="op" id="3074137">!</span><span class="ident" id="3074138">ok</span>&nbsp;<span class="op" id="3074141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074145">errorf</span><span class="op" id="3074151">(</span><span class="string" id="3074152">&#34;name&nbsp;not&nbsp;registered&nbsp;for&nbsp;interface:&nbsp;%q&#34;</span><span class="op" id="3074191">,</span>&nbsp;<span class="ident" id="3074193">name</span><span class="op" id="3074197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3074200">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3074203">//&nbsp;Read&nbsp;the&nbsp;type&nbsp;id&nbsp;of&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074247">concreteId</span>&nbsp;<span class="op" id="3074258">:=</span>&nbsp;<span class="ident" id="3074261">dec</span><span class="op" id="3074264">.</span><span class="ident" id="3074265">decodeTypeSequence</span><span class="op" id="3074283">(</span><span class="builtintype" id="3074284">true</span><span class="op" id="3074288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074291">if</span>&nbsp;<span class="ident" id="3074294">concreteId</span>&nbsp;<span class="op" id="3074305">&lt;</span>&nbsp;<span class="num" id="3074307">0</span>&nbsp;<span class="op" id="3074309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074313">error_</span><span class="op" id="3074319">(</span><span class="ident" id="3074320">dec</span><span class="op" id="3074323">.</span><span class="ident" id="3074324">err</span><span class="op" id="3074327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3074330">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3074333">//&nbsp;Byte&nbsp;count&nbsp;of&nbsp;value&nbsp;is&nbsp;next;&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;what&nbsp;it&nbsp;is&nbsp;(it&#39;s&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3074403">//&nbsp;in&nbsp;case&nbsp;we&nbsp;want&nbsp;to&nbsp;ignore&nbsp;the&nbsp;value&nbsp;by&nbsp;skipping&nbsp;it&nbsp;completely).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074471">state</span><span class="op" id="3074476">.</span><span class="ident" id="3074477">decodeUint</span><span class="op" id="3074487">(</span><span class="op" id="3074488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3074491">//&nbsp;Read&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074520">v</span>&nbsp;<span class="op" id="3074522">:=</span>&nbsp;<span class="ident" id="3074525">allocValue</span><span class="op" id="3074535">(</span><span class="ident" id="3074536">typ</span><span class="op" id="3074539">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074542">dec</span><span class="op" id="3074545">.</span><span class="ident" id="3074546">decodeValue</span><span class="op" id="3074557">(</span><span class="ident" id="3074558">concreteId</span><span class="op" id="3074568">,</span>&nbsp;<span class="ident" id="3074570">v</span><span class="op" id="3074571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074574">if</span>&nbsp;<span class="ident" id="3074577">dec</span><span class="op" id="3074580">.</span><span class="ident" id="3074581">err</span>&nbsp;<span class="op" id="3074585">!=</span>&nbsp;<span class="ident" id="3074588">nil</span>&nbsp;<span class="op" id="3074592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074596">error_</span><span class="op" id="3074602">(</span><span class="ident" id="3074603">dec</span><span class="op" id="3074606">.</span><span class="ident" id="3074607">err</span><span class="op" id="3074610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3074613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3074616">//&nbsp;Assign&nbsp;the&nbsp;concrete&nbsp;value&nbsp;to&nbsp;the&nbsp;interface.</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3074664">//&nbsp;Tread&nbsp;carefully;&nbsp;it&nbsp;might&nbsp;not&nbsp;satisfy&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3074721">if</span>&nbsp;<span class="op" id="3074724">!</span><span class="ident" id="3074725">typ</span><span class="op" id="3074728">.</span><span class="ident" id="3074729">AssignableTo</span><span class="op" id="3074741">(</span><span class="ident" id="3074742">ityp</span><span class="op" id="3074746">)</span>&nbsp;<span class="op" id="3074748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074752">errorf</span><span class="op" id="3074758">(</span><span class="string" id="3074759">&#34;%s&nbsp;is&nbsp;not&nbsp;assignable&nbsp;to&nbsp;type&nbsp;%s&#34;</span><span class="op" id="3074792">,</span>&nbsp;<span class="ident" id="3074794">typ</span><span class="op" id="3074797">,</span>&nbsp;<span class="ident" id="3074799">ityp</span><span class="op" id="3074803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3074806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3074809">//&nbsp;Copy&nbsp;the&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3074853">value</span><span class="op" id="3074858">.</span><span class="ident" id="3074859">Set</span><span class="op" id="3074862">(</span><span class="ident" id="3074863">v</span><span class="op" id="3074864">)</span><br>
<span class="lineno"></span><span class="op" id="3074866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3074869">//&nbsp;ignoreInterface&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;interface&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3074950">func</span>&nbsp;<span class="op" id="3074955">(</span><span class="ident" id="3074956">dec</span>&nbsp;<span class="op" id="3074960">*</span><span class="ident" id="3074961">Decoder</span><span class="op" id="3074968">)</span>&nbsp;<span class="ident" id="3074970">ignoreInterface</span><span class="op" id="3074985">(</span><span class="ident" id="3074986">state</span>&nbsp;<span class="op" id="3074992">*</span><span class="ident" id="3074993">decoderState</span><span class="op" id="3075005">)</span>&nbsp;<span class="op" id="3075007">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3075010">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3075050">b</span>&nbsp;<span class="op" id="3075052">:=</span>&nbsp;<span class="builtinfunc" id="3075055">make</span><span class="op" id="3075059">(</span><span class="op" id="3075060">[</span><span class="op" id="3075061">]</span><span class="builtintype" id="3075062">byte</span><span class="op" id="3075066">,</span>&nbsp;<span class="ident" id="3075068">state</span><span class="op" id="3075073">.</span><span class="ident" id="3075074">decodeUint</span><span class="op" id="3075084">(</span><span class="op" id="3075085">)</span><span class="op" id="3075086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3075089">_</span><span class="op" id="3075090">,</span>&nbsp;<span class="ident" id="3075092">err</span>&nbsp;<span class="op" id="3075096">:=</span>&nbsp;<span class="ident" id="3075099">state</span><span class="op" id="3075104">.</span><span class="ident" id="3075105">b</span><span class="op" id="3075106">.</span><span class="ident" id="3075107">Read</span><span class="op" id="3075111">(</span><span class="ident" id="3075112">b</span><span class="op" id="3075113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3075116">if</span>&nbsp;<span class="ident" id="3075119">err</span>&nbsp;<span class="op" id="3075123">!=</span>&nbsp;<span class="ident" id="3075126">nil</span>&nbsp;<span class="op" id="3075130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3075134">error_</span><span class="op" id="3075140">(</span><span class="ident" id="3075141">err</span><span class="op" id="3075144">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3075147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3075150">id</span>&nbsp;<span class="op" id="3075153">:=</span>&nbsp;<span class="ident" id="3075156">dec</span><span class="op" id="3075159">.</span><span class="ident" id="3075160">decodeTypeSequence</span><span class="op" id="3075178">(</span><span class="builtintype" id="3075179">true</span><span class="op" id="3075183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3075186">if</span>&nbsp;<span class="ident" id="3075189">id</span>&nbsp;<span class="op" id="3075192">&lt;</span>&nbsp;<span class="num" id="3075194">0</span>&nbsp;<span class="op" id="3075196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3075200">error_</span><span class="op" id="3075206">(</span><span class="ident" id="3075207">dec</span><span class="op" id="3075210">.</span><span class="ident" id="3075211">err</span><span class="op" id="3075214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3075217">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3075220">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;the&nbsp;decoder&nbsp;buffer&nbsp;contains&nbsp;a&nbsp;delimited&nbsp;value.&nbsp;Just&nbsp;toss&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3075300">state</span><span class="op" id="3075305">.</span><span class="ident" id="3075306">b</span><span class="op" id="3075307">.</span><span class="ident" id="3075308">Drop</span><span class="op" id="3075312">(</span><span class="builtintype" id="3075313">int</span><span class="op" id="3075316">(</span><span class="ident" id="3075317">state</span><span class="op" id="3075322">.</span><span class="ident" id="3075323">decodeUint</span><span class="op" id="3075333">(</span><span class="op" id="3075334">)</span><span class="op" id="3075335">)</span><span class="op" id="3075336">)</span><br>
<span class="lineno"></span><span class="op" id="3075338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3075341">//&nbsp;decodeGobDecoder&nbsp;decodes&nbsp;something&nbsp;implementing&nbsp;the&nbsp;GobDecoder&nbsp;interface.</span><br>
<span class="lineno">695</span><span class="comment" id="3075418">//&nbsp;The&nbsp;data&nbsp;is&nbsp;encoded&nbsp;as&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="3075458">func</span>&nbsp;<span class="op" id="3075463">(</span><span class="ident" id="3075464">dec</span>&nbsp;<span class="op" id="3075468">*</span><span class="ident" id="3075469">Decoder</span><span class="op" id="3075476">)</span>&nbsp;<span class="ident" id="3075478">decodeGobDecoder</span><span class="op" id="3075494">(</span><span class="ident" id="3075495">ut</span>&nbsp;<span class="op" id="3075498">*</span><span class="ident" id="3075499">userTypeInfo</span><span class="op" id="3075511">,</span>&nbsp;<span class="ident" id="3075513">state</span>&nbsp;<span class="op" id="3075519">*</span><span class="ident" id="3075520">decoderState</span><span class="op" id="3075532">,</span>&nbsp;<span class="ident" id="3075534">value</span>&nbsp;<span class="ident" id="3075540">reflect</span><span class="op" id="3075547">.</span><span class="ident" id="3075548">Value</span><span class="op" id="3075553">)</span>&nbsp;<span class="op" id="3075555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3075558">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3075592">b</span>&nbsp;<span class="op" id="3075594">:=</span>&nbsp;<span class="builtinfunc" id="3075597">make</span><span class="op" id="3075601">(</span><span class="op" id="3075602">[</span><span class="op" id="3075603">]</span><span class="builtintype" id="3075604">byte</span><span class="op" id="3075608">,</span>&nbsp;<span class="ident" id="3075610">state</span><span class="op" id="3075615">.</span><span class="ident" id="3075616">decodeUint</span><span class="op" id="3075626">(</span><span class="op" id="3075627">)</span><span class="op" id="3075628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3075631">_</span><span class="op" id="3075632">,</span>&nbsp;<span class="ident" id="3075634">err</span>&nbsp;<span class="op" id="3075638">:=</span>&nbsp;<span class="ident" id="3075641">state</span><span class="op" id="3075646">.</span><span class="ident" id="3075647">b</span><span class="op" id="3075648">.</span><span class="ident" id="3075649">Read</span><span class="op" id="3075653">(</span><span class="ident" id="3075654">b</span><span class="op" id="3075655">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3075658">if</span>&nbsp;<span class="ident" id="3075661">err</span>&nbsp;<span class="op" id="3075665">!=</span>&nbsp;<span class="ident" id="3075668">nil</span>&nbsp;<span class="op" id="3075672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3075676">error_</span><span class="op" id="3075682">(</span><span class="ident" id="3075683">err</span><span class="op" id="3075686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3075689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3075692">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;one&nbsp;of&nbsp;these.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3075723">switch</span>&nbsp;<span class="ident" id="3075730">ut</span><span class="op" id="3075732">.</span><span class="ident" id="3075733">externalDec</span>&nbsp;<span class="op" id="3075745">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3075748">case</span>&nbsp;<span class="ident" id="3075753">xGob</span><span class="op" id="3075757">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3075761">err</span>&nbsp;<span class="op" id="3075765">=</span>&nbsp;<span class="ident" id="3075767">value</span><span class="op" id="3075772">.</span><span class="ident" id="3075773">Interface</span><span class="op" id="3075782">(</span><span class="op" id="3075783">)</span><span class="op" id="3075784">.</span><span class="op" id="3075785">(</span><span class="ident" id="3075786">GobDecoder</span><span class="op" id="3075796">)</span><span class="op" id="3075797">.</span><span class="ident" id="3075798">GobDecode</span><span class="op" id="3075807">(</span><span class="ident" id="3075808">b</span><span class="op" id="3075809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3075812">case</span>&nbsp;<span class="ident" id="3075817">xBinary</span><span class="op" id="3075824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3075828">err</span>&nbsp;<span class="op" id="3075832">=</span>&nbsp;<span class="ident" id="3075834">value</span><span class="op" id="3075839">.</span><span class="ident" id="3075840">Interface</span><span class="op" id="3075849">(</span><span class="op" id="3075850">)</span><span class="op" id="3075851">.</span><span class="op" id="3075852">(</span><span class="ident" id="3075853">encoding</span><span class="op" id="3075861">.</span><span class="ident" id="3075862">BinaryUnmarshaler</span><span class="op" id="3075879">)</span><span class="op" id="3075880">.</span><span class="ident" id="3075881">UnmarshalBinary</span><span class="op" id="3075896">(</span><span class="ident" id="3075897">b</span><span class="op" id="3075898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3075901">case</span>&nbsp;<span class="ident" id="3075906">xText</span><span class="op" id="3075911">:</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3075915">err</span>&nbsp;<span class="op" id="3075919">=</span>&nbsp;<span class="ident" id="3075921">value</span><span class="op" id="3075926">.</span><span class="ident" id="3075927">Interface</span><span class="op" id="3075936">(</span><span class="op" id="3075937">)</span><span class="op" id="3075938">.</span><span class="op" id="3075939">(</span><span class="ident" id="3075940">encoding</span><span class="op" id="3075948">.</span><span class="ident" id="3075949">TextUnmarshaler</span><span class="op" id="3075964">)</span><span class="op" id="3075965">.</span><span class="ident" id="3075966">UnmarshalText</span><span class="op" id="3075979">(</span><span class="ident" id="3075980">b</span><span class="op" id="3075981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3075984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3075987">if</span>&nbsp;<span class="ident" id="3075990">err</span>&nbsp;<span class="op" id="3075994">!=</span>&nbsp;<span class="ident" id="3075997">nil</span>&nbsp;<span class="op" id="3076001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076005">error_</span><span class="op" id="3076011">(</span><span class="ident" id="3076012">err</span><span class="op" id="3076015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3076018">}</span><br>
<span class="lineno">715</span><span class="op" id="3076020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3076023">//&nbsp;ignoreGobDecoder&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;GobDecoder&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3076105">func</span>&nbsp;<span class="op" id="3076110">(</span><span class="ident" id="3076111">dec</span>&nbsp;<span class="op" id="3076115">*</span><span class="ident" id="3076116">Decoder</span><span class="op" id="3076123">)</span>&nbsp;<span class="ident" id="3076125">ignoreGobDecoder</span><span class="op" id="3076141">(</span><span class="ident" id="3076142">state</span>&nbsp;<span class="op" id="3076148">*</span><span class="ident" id="3076149">decoderState</span><span class="op" id="3076161">)</span>&nbsp;<span class="op" id="3076163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3076166">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076200">b</span>&nbsp;<span class="op" id="3076202">:=</span>&nbsp;<span class="builtinfunc" id="3076205">make</span><span class="op" id="3076209">(</span><span class="op" id="3076210">[</span><span class="op" id="3076211">]</span><span class="builtintype" id="3076212">byte</span><span class="op" id="3076216">,</span>&nbsp;<span class="ident" id="3076218">state</span><span class="op" id="3076223">.</span><span class="ident" id="3076224">decodeUint</span><span class="op" id="3076234">(</span><span class="op" id="3076235">)</span><span class="op" id="3076236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076239">_</span><span class="op" id="3076240">,</span>&nbsp;<span class="ident" id="3076242">err</span>&nbsp;<span class="op" id="3076246">:=</span>&nbsp;<span class="ident" id="3076249">state</span><span class="op" id="3076254">.</span><span class="ident" id="3076255">b</span><span class="op" id="3076256">.</span><span class="ident" id="3076257">Read</span><span class="op" id="3076261">(</span><span class="ident" id="3076262">b</span><span class="op" id="3076263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3076266">if</span>&nbsp;<span class="ident" id="3076269">err</span>&nbsp;<span class="op" id="3076273">!=</span>&nbsp;<span class="ident" id="3076276">nil</span>&nbsp;<span class="op" id="3076280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076284">error_</span><span class="op" id="3076290">(</span><span class="ident" id="3076291">err</span><span class="op" id="3076294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3076297">}</span><br>
<span class="lineno">725</span><span class="op" id="3076299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3076302">//&nbsp;Index&nbsp;by&nbsp;Go&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3076324">var</span>&nbsp;<span class="ident" id="3076328">decOpTable</span>&nbsp;<span class="op" id="3076339">=</span>&nbsp;<span class="op" id="3076341">[</span><span class="op" id="3076342">...</span><span class="op" id="3076345">]</span><span class="ident" id="3076346">decOp</span><span class="op" id="3076351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076354">reflect</span><span class="op" id="3076361">.</span><span class="ident" id="3076362">Bool</span><span class="op" id="3076366">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076374">decBool</span><span class="op" id="3076381">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076384">reflect</span><span class="op" id="3076391">.</span><span class="ident" id="3076392">Int8</span><span class="op" id="3076396">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076404">decInt8</span><span class="op" id="3076411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076414">reflect</span><span class="op" id="3076421">.</span><span class="ident" id="3076422">Int16</span><span class="op" id="3076427">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076434">decInt16</span><span class="op" id="3076442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076445">reflect</span><span class="op" id="3076452">.</span><span class="ident" id="3076453">Int32</span><span class="op" id="3076458">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076465">decInt32</span><span class="op" id="3076473">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076476">reflect</span><span class="op" id="3076483">.</span><span class="ident" id="3076484">Int64</span><span class="op" id="3076489">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076496">decInt64</span><span class="op" id="3076504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076507">reflect</span><span class="op" id="3076514">.</span><span class="ident" id="3076515">Uint8</span><span class="op" id="3076520">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076527">decUint8</span><span class="op" id="3076535">,</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076538">reflect</span><span class="op" id="3076545">.</span><span class="ident" id="3076546">Uint16</span><span class="op" id="3076552">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076558">decUint16</span><span class="op" id="3076567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076570">reflect</span><span class="op" id="3076577">.</span><span class="ident" id="3076578">Uint32</span><span class="op" id="3076584">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076590">decUint32</span><span class="op" id="3076599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076602">reflect</span><span class="op" id="3076609">.</span><span class="ident" id="3076610">Uint64</span><span class="op" id="3076616">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076622">decUint64</span><span class="op" id="3076631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076634">reflect</span><span class="op" id="3076641">.</span><span class="ident" id="3076642">Float32</span><span class="op" id="3076649">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076654">decFloat32</span><span class="op" id="3076664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076667">reflect</span><span class="op" id="3076674">.</span><span class="ident" id="3076675">Float64</span><span class="op" id="3076682">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076687">decFloat64</span><span class="op" id="3076697">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076700">reflect</span><span class="op" id="3076707">.</span><span class="ident" id="3076708">Complex64</span><span class="op" id="3076717">:</span>&nbsp;&nbsp;<span class="ident" id="3076720">decComplex64</span><span class="op" id="3076732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076735">reflect</span><span class="op" id="3076742">.</span><span class="ident" id="3076743">Complex128</span><span class="op" id="3076753">:</span>&nbsp;<span class="ident" id="3076755">decComplex128</span><span class="op" id="3076768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076771">reflect</span><span class="op" id="3076778">.</span><span class="ident" id="3076779">String</span><span class="op" id="3076785">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076791">decString</span><span class="op" id="3076800">,</span><br>
<span class="lineno"></span><span class="op" id="3076802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="3076805">//&nbsp;Indexed&nbsp;by&nbsp;gob&nbsp;types.&nbsp;&nbsp;tComplex&nbsp;will&nbsp;be&nbsp;added&nbsp;during&nbsp;type.init().</span><br>
<span class="lineno"></span><span class="keyword" id="3076874">var</span>&nbsp;<span class="ident" id="3076878">decIgnoreOpMap</span>&nbsp;<span class="op" id="3076893">=</span>&nbsp;<span class="keyword" id="3076895">map</span><span class="op" id="3076898">[</span><span class="ident" id="3076899">typeId</span><span class="op" id="3076905">]</span><span class="ident" id="3076906">decOp</span><span class="op" id="3076911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076914">tBool</span><span class="op" id="3076919">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076924">ignoreUint</span><span class="op" id="3076934">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076937">tInt</span><span class="op" id="3076941">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076947">ignoreUint</span><span class="op" id="3076957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076960">tUint</span><span class="op" id="3076965">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076970">ignoreUint</span><span class="op" id="3076980">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3076983">tFloat</span><span class="op" id="3076989">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3076993">ignoreUint</span><span class="op" id="3077003">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077006">tBytes</span><span class="op" id="3077012">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3077016">ignoreUint8Array</span><span class="op" id="3077032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077035">tString</span><span class="op" id="3077042">:</span>&nbsp;&nbsp;<span class="ident" id="3077045">ignoreUint8Array</span><span class="op" id="3077061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077064">tComplex</span><span class="op" id="3077072">:</span>&nbsp;<span class="ident" id="3077074">ignoreTwoUints</span><span class="op" id="3077088">,</span><br>
<span class="lineno"></span><span class="op" id="3077090">}</span><br>
<span class="lineno">755</span><br>
<span class="lineno"></span><span class="comment" id="3077093">//&nbsp;decOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;the&nbsp;base&nbsp;type&nbsp;under&nbsp;rt&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3077160">//&nbsp;the&nbsp;indirection&nbsp;count&nbsp;to&nbsp;reach&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3077198">func</span>&nbsp;<span class="op" id="3077203">(</span><span class="ident" id="3077204">dec</span>&nbsp;<span class="op" id="3077208">*</span><span class="ident" id="3077209">Decoder</span><span class="op" id="3077216">)</span>&nbsp;<span class="ident" id="3077218">decOpFor</span><span class="op" id="3077226">(</span><span class="ident" id="3077227">wireId</span>&nbsp;<span class="ident" id="3077234">typeId</span><span class="op" id="3077240">,</span>&nbsp;<span class="ident" id="3077242">rt</span>&nbsp;<span class="ident" id="3077245">reflect</span><span class="op" id="3077252">.</span><span class="ident" id="3077253">Type</span><span class="op" id="3077257">,</span>&nbsp;<span class="ident" id="3077259">name</span>&nbsp;<span class="builtintype" id="3077264">string</span><span class="op" id="3077270">,</span>&nbsp;<span class="ident" id="3077272">inProgress</span>&nbsp;<span class="keyword" id="3077283">map</span><span class="op" id="3077286">[</span><span class="ident" id="3077287">reflect</span><span class="op" id="3077294">.</span><span class="ident" id="3077295">Type</span><span class="op" id="3077299">]</span><span class="op" id="3077300">*</span><span class="ident" id="3077301">decOp</span><span class="op" id="3077306">)</span>&nbsp;<span class="op" id="3077308">*</span><span class="ident" id="3077309">decOp</span>&nbsp;<span class="op" id="3077315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077318">ut</span>&nbsp;<span class="op" id="3077321">:=</span>&nbsp;<span class="ident" id="3077324">userType</span><span class="op" id="3077332">(</span><span class="ident" id="3077333">rt</span><span class="op" id="3077335">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3077338">//&nbsp;If&nbsp;the&nbsp;type&nbsp;implements&nbsp;GobEncoder,&nbsp;we&nbsp;handle&nbsp;it&nbsp;without&nbsp;further&nbsp;processing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077418">if</span>&nbsp;<span class="ident" id="3077421">ut</span><span class="op" id="3077423">.</span><span class="ident" id="3077424">externalDec</span>&nbsp;<span class="op" id="3077436">!=</span>&nbsp;<span class="num" id="3077439">0</span>&nbsp;<span class="op" id="3077441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077445">return</span>&nbsp;<span class="ident" id="3077452">dec</span><span class="op" id="3077455">.</span><span class="ident" id="3077456">gobDecodeOpFor</span><span class="op" id="3077470">(</span><span class="ident" id="3077471">ut</span><span class="op" id="3077473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3077476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3077480">//&nbsp;If&nbsp;this&nbsp;type&nbsp;is&nbsp;already&nbsp;in&nbsp;progress,&nbsp;it&#39;s&nbsp;a&nbsp;recursive&nbsp;type&nbsp;(e.g.&nbsp;map[string]*T).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3077565">//&nbsp;Return&nbsp;the&nbsp;pointer&nbsp;to&nbsp;the&nbsp;op&nbsp;we&#39;re&nbsp;already&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077622">if</span>&nbsp;<span class="ident" id="3077625">opPtr</span>&nbsp;<span class="op" id="3077631">:=</span>&nbsp;<span class="ident" id="3077634">inProgress</span><span class="op" id="3077644">[</span><span class="ident" id="3077645">rt</span><span class="op" id="3077647">]</span><span class="op" id="3077648">;</span>&nbsp;<span class="ident" id="3077650">opPtr</span>&nbsp;<span class="op" id="3077656">!=</span>&nbsp;<span class="ident" id="3077659">nil</span>&nbsp;<span class="op" id="3077663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077667">return</span>&nbsp;<span class="ident" id="3077674">opPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3077681">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077684">typ</span>&nbsp;<span class="op" id="3077688">:=</span>&nbsp;<span class="ident" id="3077691">ut</span><span class="op" id="3077693">.</span><span class="ident" id="3077694">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077700">var</span>&nbsp;<span class="ident" id="3077704">op</span>&nbsp;<span class="ident" id="3077707">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077714">k</span>&nbsp;<span class="op" id="3077716">:=</span>&nbsp;<span class="ident" id="3077719">typ</span><span class="op" id="3077722">.</span><span class="ident" id="3077723">Kind</span><span class="op" id="3077727">(</span><span class="op" id="3077728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077731">if</span>&nbsp;<span class="builtintype" id="3077734">int</span><span class="op" id="3077737">(</span><span class="ident" id="3077738">k</span><span class="op" id="3077739">)</span>&nbsp;<span class="op" id="3077741">&lt;</span>&nbsp;<span class="builtinfunc" id="3077743">len</span><span class="op" id="3077746">(</span><span class="ident" id="3077747">decOpTable</span><span class="op" id="3077757">)</span>&nbsp;<span class="op" id="3077759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077763">op</span>&nbsp;<span class="op" id="3077766">=</span>&nbsp;<span class="ident" id="3077768">decOpTable</span><span class="op" id="3077778">[</span><span class="ident" id="3077779">k</span><span class="op" id="3077780">]</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3077783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077786">if</span>&nbsp;<span class="ident" id="3077789">op</span>&nbsp;<span class="op" id="3077792">==</span>&nbsp;<span class="ident" id="3077795">nil</span>&nbsp;<span class="op" id="3077799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077803">inProgress</span><span class="op" id="3077813">[</span><span class="ident" id="3077814">rt</span><span class="op" id="3077816">]</span>&nbsp;<span class="op" id="3077818">=</span>&nbsp;<span class="op" id="3077820">&amp;</span><span class="ident" id="3077821">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3077826">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077845">switch</span>&nbsp;<span class="ident" id="3077852">t</span>&nbsp;<span class="op" id="3077854">:=</span>&nbsp;<span class="ident" id="3077857">typ</span><span class="op" id="3077860">;</span>&nbsp;<span class="ident" id="3077862">t</span><span class="op" id="3077863">.</span><span class="ident" id="3077864">Kind</span><span class="op" id="3077868">(</span><span class="op" id="3077869">)</span>&nbsp;<span class="op" id="3077871">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3077875">case</span>&nbsp;<span class="ident" id="3077880">reflect</span><span class="op" id="3077887">.</span><span class="ident" id="3077888">Array</span><span class="op" id="3077893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077898">name</span>&nbsp;<span class="op" id="3077903">=</span>&nbsp;<span class="string" id="3077905">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="3077919">+</span>&nbsp;<span class="ident" id="3077921">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077929">elemId</span>&nbsp;<span class="op" id="3077936">:=</span>&nbsp;<span class="ident" id="3077939">dec</span><span class="op" id="3077942">.</span><span class="ident" id="3077943">wireType</span><span class="op" id="3077951">[</span><span class="ident" id="3077952">wireId</span><span class="op" id="3077958">]</span><span class="op" id="3077959">.</span><span class="ident" id="3077960">ArrayT</span><span class="op" id="3077966">.</span><span class="ident" id="3077967">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3077975">elemOp</span>&nbsp;<span class="op" id="3077982">:=</span>&nbsp;<span class="ident" id="3077985">dec</span><span class="op" id="3077988">.</span><span class="ident" id="3077989">decOpFor</span><span class="op" id="3077997">(</span><span class="ident" id="3077998">elemId</span><span class="op" id="3078004">,</span>&nbsp;<span class="ident" id="3078006">t</span><span class="op" id="3078007">.</span><span class="ident" id="3078008">Elem</span><span class="op" id="3078012">(</span><span class="op" id="3078013">)</span><span class="op" id="3078014">,</span>&nbsp;<span class="ident" id="3078016">name</span><span class="op" id="3078020">,</span>&nbsp;<span class="ident" id="3078022">inProgress</span><span class="op" id="3078032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078037">ovfl</span>&nbsp;<span class="op" id="3078042">:=</span>&nbsp;<span class="ident" id="3078045">overflow</span><span class="op" id="3078053">(</span><span class="ident" id="3078054">name</span><span class="op" id="3078058">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078063">helper</span>&nbsp;<span class="op" id="3078070">:=</span>&nbsp;<span class="ident" id="3078073">decArrayHelper</span><span class="op" id="3078087">[</span><span class="ident" id="3078088">t</span><span class="op" id="3078089">.</span><span class="ident" id="3078090">Elem</span><span class="op" id="3078094">(</span><span class="op" id="3078095">)</span><span class="op" id="3078096">.</span><span class="ident" id="3078097">Kind</span><span class="op" id="3078101">(</span><span class="op" id="3078102">)</span><span class="op" id="3078103">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078108">op</span>&nbsp;<span class="op" id="3078111">=</span>&nbsp;<span class="keyword" id="3078113">func</span><span class="op" id="3078117">(</span><span class="ident" id="3078118">i</span>&nbsp;<span class="op" id="3078120">*</span><span class="ident" id="3078121">decInstr</span><span class="op" id="3078129">,</span>&nbsp;<span class="ident" id="3078131">state</span>&nbsp;<span class="op" id="3078137">*</span><span class="ident" id="3078138">decoderState</span><span class="op" id="3078150">,</span>&nbsp;<span class="ident" id="3078152">value</span>&nbsp;<span class="ident" id="3078158">reflect</span><span class="op" id="3078165">.</span><span class="ident" id="3078166">Value</span><span class="op" id="3078171">)</span>&nbsp;<span class="op" id="3078173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078179">state</span><span class="op" id="3078184">.</span><span class="ident" id="3078185">dec</span><span class="op" id="3078188">.</span><span class="ident" id="3078189">decodeArray</span><span class="op" id="3078200">(</span><span class="ident" id="3078201">t</span><span class="op" id="3078202">,</span>&nbsp;<span class="ident" id="3078204">state</span><span class="op" id="3078209">,</span>&nbsp;<span class="ident" id="3078211">value</span><span class="op" id="3078216">,</span>&nbsp;<span class="op" id="3078218">*</span><span class="ident" id="3078219">elemOp</span><span class="op" id="3078225">,</span>&nbsp;<span class="ident" id="3078227">t</span><span class="op" id="3078228">.</span><span class="ident" id="3078229">Len</span><span class="op" id="3078232">(</span><span class="op" id="3078233">)</span><span class="op" id="3078234">,</span>&nbsp;<span class="ident" id="3078236">ovfl</span><span class="op" id="3078240">,</span>&nbsp;<span class="ident" id="3078242">helper</span><span class="op" id="3078248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078258">case</span>&nbsp;<span class="ident" id="3078263">reflect</span><span class="op" id="3078270">.</span><span class="ident" id="3078271">Map</span><span class="op" id="3078274">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078279">keyId</span>&nbsp;<span class="op" id="3078285">:=</span>&nbsp;<span class="ident" id="3078288">dec</span><span class="op" id="3078291">.</span><span class="ident" id="3078292">wireType</span><span class="op" id="3078300">[</span><span class="ident" id="3078301">wireId</span><span class="op" id="3078307">]</span><span class="op" id="3078308">.</span><span class="ident" id="3078309">MapT</span><span class="op" id="3078313">.</span><span class="ident" id="3078314">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078321">elemId</span>&nbsp;<span class="op" id="3078328">:=</span>&nbsp;<span class="ident" id="3078331">dec</span><span class="op" id="3078334">.</span><span class="ident" id="3078335">wireType</span><span class="op" id="3078343">[</span><span class="ident" id="3078344">wireId</span><span class="op" id="3078350">]</span><span class="op" id="3078351">.</span><span class="ident" id="3078352">MapT</span><span class="op" id="3078356">.</span><span class="ident" id="3078357">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078365">keyOp</span>&nbsp;<span class="op" id="3078371">:=</span>&nbsp;<span class="ident" id="3078374">dec</span><span class="op" id="3078377">.</span><span class="ident" id="3078378">decOpFor</span><span class="op" id="3078386">(</span><span class="ident" id="3078387">keyId</span><span class="op" id="3078392">,</span>&nbsp;<span class="ident" id="3078394">t</span><span class="op" id="3078395">.</span><span class="ident" id="3078396">Key</span><span class="op" id="3078399">(</span><span class="op" id="3078400">)</span><span class="op" id="3078401">,</span>&nbsp;<span class="string" id="3078403">&#34;key&nbsp;of&nbsp;&#34;</span><span class="op" id="3078412">+</span><span class="ident" id="3078413">name</span><span class="op" id="3078417">,</span>&nbsp;<span class="ident" id="3078419">inProgress</span><span class="op" id="3078429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078434">elemOp</span>&nbsp;<span class="op" id="3078441">:=</span>&nbsp;<span class="ident" id="3078444">dec</span><span class="op" id="3078447">.</span><span class="ident" id="3078448">decOpFor</span><span class="op" id="3078456">(</span><span class="ident" id="3078457">elemId</span><span class="op" id="3078463">,</span>&nbsp;<span class="ident" id="3078465">t</span><span class="op" id="3078466">.</span><span class="ident" id="3078467">Elem</span><span class="op" id="3078471">(</span><span class="op" id="3078472">)</span><span class="op" id="3078473">,</span>&nbsp;<span class="string" id="3078475">&#34;element&nbsp;of&nbsp;&#34;</span><span class="op" id="3078488">+</span><span class="ident" id="3078489">name</span><span class="op" id="3078493">,</span>&nbsp;<span class="ident" id="3078495">inProgress</span><span class="op" id="3078505">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078510">ovfl</span>&nbsp;<span class="op" id="3078515">:=</span>&nbsp;<span class="ident" id="3078518">overflow</span><span class="op" id="3078526">(</span><span class="ident" id="3078527">name</span><span class="op" id="3078531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078536">op</span>&nbsp;<span class="op" id="3078539">=</span>&nbsp;<span class="keyword" id="3078541">func</span><span class="op" id="3078545">(</span><span class="ident" id="3078546">i</span>&nbsp;<span class="op" id="3078548">*</span><span class="ident" id="3078549">decInstr</span><span class="op" id="3078557">,</span>&nbsp;<span class="ident" id="3078559">state</span>&nbsp;<span class="op" id="3078565">*</span><span class="ident" id="3078566">decoderState</span><span class="op" id="3078578">,</span>&nbsp;<span class="ident" id="3078580">value</span>&nbsp;<span class="ident" id="3078586">reflect</span><span class="op" id="3078593">.</span><span class="ident" id="3078594">Value</span><span class="op" id="3078599">)</span>&nbsp;<span class="op" id="3078601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078607">state</span><span class="op" id="3078612">.</span><span class="ident" id="3078613">dec</span><span class="op" id="3078616">.</span><span class="ident" id="3078617">decodeMap</span><span class="op" id="3078626">(</span><span class="ident" id="3078627">t</span><span class="op" id="3078628">,</span>&nbsp;<span class="ident" id="3078630">state</span><span class="op" id="3078635">,</span>&nbsp;<span class="ident" id="3078637">value</span><span class="op" id="3078642">,</span>&nbsp;<span class="op" id="3078644">*</span><span class="ident" id="3078645">keyOp</span><span class="op" id="3078650">,</span>&nbsp;<span class="op" id="3078652">*</span><span class="ident" id="3078653">elemOp</span><span class="op" id="3078659">,</span>&nbsp;<span class="ident" id="3078661">ovfl</span><span class="op" id="3078665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078675">case</span>&nbsp;<span class="ident" id="3078680">reflect</span><span class="op" id="3078687">.</span><span class="ident" id="3078688">Slice</span><span class="op" id="3078693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078698">name</span>&nbsp;<span class="op" id="3078703">=</span>&nbsp;<span class="string" id="3078705">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="3078719">+</span>&nbsp;<span class="ident" id="3078721">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078729">if</span>&nbsp;<span class="ident" id="3078732">t</span><span class="op" id="3078733">.</span><span class="ident" id="3078734">Elem</span><span class="op" id="3078738">(</span><span class="op" id="3078739">)</span><span class="op" id="3078740">.</span><span class="ident" id="3078741">Kind</span><span class="op" id="3078745">(</span><span class="op" id="3078746">)</span>&nbsp;<span class="op" id="3078748">==</span>&nbsp;<span class="ident" id="3078751">reflect</span><span class="op" id="3078758">.</span><span class="ident" id="3078759">Uint8</span>&nbsp;<span class="op" id="3078765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078771">op</span>&nbsp;<span class="op" id="3078774">=</span>&nbsp;<span class="ident" id="3078776">decUint8Slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078794">break</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078808">var</span>&nbsp;<span class="ident" id="3078812">elemId</span>&nbsp;<span class="ident" id="3078819">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3078829">if</span>&nbsp;<span class="ident" id="3078832">tt</span><span class="op" id="3078834">,</span>&nbsp;<span class="ident" id="3078836">ok</span>&nbsp;<span class="op" id="3078839">:=</span>&nbsp;<span class="ident" id="3078842">builtinIdToType</span><span class="op" id="3078857">[</span><span class="ident" id="3078858">wireId</span><span class="op" id="3078864">]</span><span class="op" id="3078865">;</span>&nbsp;<span class="ident" id="3078867">ok</span>&nbsp;<span class="op" id="3078870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078876">elemId</span>&nbsp;<span class="op" id="3078883">=</span>&nbsp;<span class="ident" id="3078885">tt</span><span class="op" id="3078887">.</span><span class="op" id="3078888">(</span><span class="op" id="3078889">*</span><span class="ident" id="3078890">sliceType</span><span class="op" id="3078899">)</span><span class="op" id="3078900">.</span><span class="ident" id="3078901">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078909">}</span>&nbsp;<span class="keyword" id="3078911">else</span>&nbsp;<span class="op" id="3078916">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078922">elemId</span>&nbsp;<span class="op" id="3078929">=</span>&nbsp;<span class="ident" id="3078931">dec</span><span class="op" id="3078934">.</span><span class="ident" id="3078935">wireType</span><span class="op" id="3078943">[</span><span class="ident" id="3078944">wireId</span><span class="op" id="3078950">]</span><span class="op" id="3078951">.</span><span class="ident" id="3078952">SliceT</span><span class="op" id="3078958">.</span><span class="ident" id="3078959">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3078967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3078972">elemOp</span>&nbsp;<span class="op" id="3078979">:=</span>&nbsp;<span class="ident" id="3078982">dec</span><span class="op" id="3078985">.</span><span class="ident" id="3078986">decOpFor</span><span class="op" id="3078994">(</span><span class="ident" id="3078995">elemId</span><span class="op" id="3079001">,</span>&nbsp;<span class="ident" id="3079003">t</span><span class="op" id="3079004">.</span><span class="ident" id="3079005">Elem</span><span class="op" id="3079009">(</span><span class="op" id="3079010">)</span><span class="op" id="3079011">,</span>&nbsp;<span class="ident" id="3079013">name</span><span class="op" id="3079017">,</span>&nbsp;<span class="ident" id="3079019">inProgress</span><span class="op" id="3079029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079034">ovfl</span>&nbsp;<span class="op" id="3079039">:=</span>&nbsp;<span class="ident" id="3079042">overflow</span><span class="op" id="3079050">(</span><span class="ident" id="3079051">name</span><span class="op" id="3079055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079060">helper</span>&nbsp;<span class="op" id="3079067">:=</span>&nbsp;<span class="ident" id="3079070">decSliceHelper</span><span class="op" id="3079084">[</span><span class="ident" id="3079085">t</span><span class="op" id="3079086">.</span><span class="ident" id="3079087">Elem</span><span class="op" id="3079091">(</span><span class="op" id="3079092">)</span><span class="op" id="3079093">.</span><span class="ident" id="3079094">Kind</span><span class="op" id="3079098">(</span><span class="op" id="3079099">)</span><span class="op" id="3079100">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079105">op</span>&nbsp;<span class="op" id="3079108">=</span>&nbsp;<span class="keyword" id="3079110">func</span><span class="op" id="3079114">(</span><span class="ident" id="3079115">i</span>&nbsp;<span class="op" id="3079117">*</span><span class="ident" id="3079118">decInstr</span><span class="op" id="3079126">,</span>&nbsp;<span class="ident" id="3079128">state</span>&nbsp;<span class="op" id="3079134">*</span><span class="ident" id="3079135">decoderState</span><span class="op" id="3079147">,</span>&nbsp;<span class="ident" id="3079149">value</span>&nbsp;<span class="ident" id="3079155">reflect</span><span class="op" id="3079162">.</span><span class="ident" id="3079163">Value</span><span class="op" id="3079168">)</span>&nbsp;<span class="op" id="3079170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079176">state</span><span class="op" id="3079181">.</span><span class="ident" id="3079182">dec</span><span class="op" id="3079185">.</span><span class="ident" id="3079186">decodeSlice</span><span class="op" id="3079197">(</span><span class="ident" id="3079198">state</span><span class="op" id="3079203">,</span>&nbsp;<span class="ident" id="3079205">value</span><span class="op" id="3079210">,</span>&nbsp;<span class="op" id="3079212">*</span><span class="ident" id="3079213">elemOp</span><span class="op" id="3079219">,</span>&nbsp;<span class="ident" id="3079221">ovfl</span><span class="op" id="3079225">,</span>&nbsp;<span class="ident" id="3079227">helper</span><span class="op" id="3079233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079243">case</span>&nbsp;<span class="ident" id="3079248">reflect</span><span class="op" id="3079255">.</span><span class="ident" id="3079256">Struct</span><span class="op" id="3079262">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3079267">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079342">ut</span>&nbsp;<span class="op" id="3079345">:=</span>&nbsp;<span class="ident" id="3079348">userType</span><span class="op" id="3079356">(</span><span class="ident" id="3079357">typ</span><span class="op" id="3079360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079365">enginePtr</span><span class="op" id="3079374">,</span>&nbsp;<span class="ident" id="3079376">err</span>&nbsp;<span class="op" id="3079380">:=</span>&nbsp;<span class="ident" id="3079383">dec</span><span class="op" id="3079386">.</span><span class="ident" id="3079387">getDecEnginePtr</span><span class="op" id="3079402">(</span><span class="ident" id="3079403">wireId</span><span class="op" id="3079409">,</span>&nbsp;<span class="ident" id="3079411">ut</span><span class="op" id="3079413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079418">if</span>&nbsp;<span class="ident" id="3079421">err</span>&nbsp;<span class="op" id="3079425">!=</span>&nbsp;<span class="ident" id="3079428">nil</span>&nbsp;<span class="op" id="3079432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079438">error_</span><span class="op" id="3079444">(</span><span class="ident" id="3079445">err</span><span class="op" id="3079448">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079458">op</span>&nbsp;<span class="op" id="3079461">=</span>&nbsp;<span class="keyword" id="3079463">func</span><span class="op" id="3079467">(</span><span class="ident" id="3079468">i</span>&nbsp;<span class="op" id="3079470">*</span><span class="ident" id="3079471">decInstr</span><span class="op" id="3079479">,</span>&nbsp;<span class="ident" id="3079481">state</span>&nbsp;<span class="op" id="3079487">*</span><span class="ident" id="3079488">decoderState</span><span class="op" id="3079500">,</span>&nbsp;<span class="ident" id="3079502">value</span>&nbsp;<span class="ident" id="3079508">reflect</span><span class="op" id="3079515">.</span><span class="ident" id="3079516">Value</span><span class="op" id="3079521">)</span>&nbsp;<span class="op" id="3079523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3079529">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079606">dec</span><span class="op" id="3079609">.</span><span class="ident" id="3079610">decodeStruct</span><span class="op" id="3079622">(</span><span class="op" id="3079623">*</span><span class="ident" id="3079624">enginePtr</span><span class="op" id="3079633">,</span>&nbsp;<span class="ident" id="3079635">ut</span><span class="op" id="3079637">,</span>&nbsp;<span class="ident" id="3079639">value</span><span class="op" id="3079644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079649">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079653">case</span>&nbsp;<span class="ident" id="3079658">reflect</span><span class="op" id="3079665">.</span><span class="ident" id="3079666">Interface</span><span class="op" id="3079675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079680">op</span>&nbsp;<span class="op" id="3079683">=</span>&nbsp;<span class="keyword" id="3079685">func</span><span class="op" id="3079689">(</span><span class="ident" id="3079690">i</span>&nbsp;<span class="op" id="3079692">*</span><span class="ident" id="3079693">decInstr</span><span class="op" id="3079701">,</span>&nbsp;<span class="ident" id="3079703">state</span>&nbsp;<span class="op" id="3079709">*</span><span class="ident" id="3079710">decoderState</span><span class="op" id="3079722">,</span>&nbsp;<span class="ident" id="3079724">value</span>&nbsp;<span class="ident" id="3079730">reflect</span><span class="op" id="3079737">.</span><span class="ident" id="3079738">Value</span><span class="op" id="3079743">)</span>&nbsp;<span class="op" id="3079745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079751">state</span><span class="op" id="3079756">.</span><span class="ident" id="3079757">dec</span><span class="op" id="3079760">.</span><span class="ident" id="3079761">decodeInterface</span><span class="op" id="3079776">(</span><span class="ident" id="3079777">t</span><span class="op" id="3079778">,</span>&nbsp;<span class="ident" id="3079780">state</span><span class="op" id="3079785">,</span>&nbsp;<span class="ident" id="3079787">value</span><span class="op" id="3079792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079801">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079807">if</span>&nbsp;<span class="ident" id="3079810">op</span>&nbsp;<span class="op" id="3079813">==</span>&nbsp;<span class="ident" id="3079816">nil</span>&nbsp;<span class="op" id="3079820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3079824">errorf</span><span class="op" id="3079830">(</span><span class="string" id="3079831">&#34;decode&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="3079860">,</span>&nbsp;<span class="ident" id="3079862">rt</span><span class="op" id="3079864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3079867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3079870">return</span>&nbsp;<span class="op" id="3079877">&amp;</span><span class="ident" id="3079878">op</span><br>
<span class="lineno">840</span><span class="op" id="3079881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3079884">//&nbsp;decIgnoreOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;a&nbsp;field&nbsp;that&nbsp;has&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="3079963">func</span>&nbsp;<span class="op" id="3079968">(</span><span class="ident" id="3079969">dec</span>&nbsp;<span class="op" id="3079973">*</span><span class="ident" id="3079974">Decoder</span><span class="op" id="3079981">)</span>&nbsp;<span class="ident" id="3079983">decIgnoreOpFor</span><span class="op" id="3079997">(</span><span class="ident" id="3079998">wireId</span>&nbsp;<span class="ident" id="3080005">typeId</span><span class="op" id="3080011">)</span>&nbsp;<span class="ident" id="3080013">decOp</span>&nbsp;<span class="op" id="3080019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080022">op</span><span class="op" id="3080024">,</span>&nbsp;<span class="ident" id="3080026">ok</span>&nbsp;<span class="op" id="3080029">:=</span>&nbsp;<span class="ident" id="3080032">decIgnoreOpMap</span><span class="op" id="3080046">[</span><span class="ident" id="3080047">wireId</span><span class="op" id="3080053">]</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3080056">if</span>&nbsp;<span class="op" id="3080059">!</span><span class="ident" id="3080060">ok</span>&nbsp;<span class="op" id="3080063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3080067">if</span>&nbsp;<span class="ident" id="3080070">wireId</span>&nbsp;<span class="op" id="3080077">==</span>&nbsp;<span class="ident" id="3080080">tInterface</span>&nbsp;<span class="op" id="3080091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3080096">//&nbsp;Special&nbsp;case&nbsp;because&nbsp;it&#39;s&nbsp;a&nbsp;method:&nbsp;the&nbsp;ignored&nbsp;item&nbsp;might</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3080161">//&nbsp;define&nbsp;types&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;record&nbsp;their&nbsp;state&nbsp;in&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080230">op</span>&nbsp;<span class="op" id="3080233">=</span>&nbsp;<span class="keyword" id="3080235">func</span><span class="op" id="3080239">(</span><span class="ident" id="3080240">i</span>&nbsp;<span class="op" id="3080242">*</span><span class="ident" id="3080243">decInstr</span><span class="op" id="3080251">,</span>&nbsp;<span class="ident" id="3080253">state</span>&nbsp;<span class="op" id="3080259">*</span><span class="ident" id="3080260">decoderState</span><span class="op" id="3080272">,</span>&nbsp;<span class="ident" id="3080274">value</span>&nbsp;<span class="ident" id="3080280">reflect</span><span class="op" id="3080287">.</span><span class="ident" id="3080288">Value</span><span class="op" id="3080293">)</span>&nbsp;<span class="op" id="3080295">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080301">state</span><span class="op" id="3080306">.</span><span class="ident" id="3080307">dec</span><span class="op" id="3080310">.</span><span class="ident" id="3080311">ignoreInterface</span><span class="op" id="3080326">(</span><span class="ident" id="3080327">state</span><span class="op" id="3080332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3080337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3080342">return</span>&nbsp;<span class="ident" id="3080349">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3080354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3080358">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080377">wire</span>&nbsp;<span class="op" id="3080382">:=</span>&nbsp;<span class="ident" id="3080385">dec</span><span class="op" id="3080388">.</span><span class="ident" id="3080389">wireType</span><span class="op" id="3080397">[</span><span class="ident" id="3080398">wireId</span><span class="op" id="3080404">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3080408">switch</span>&nbsp;<span class="op" id="3080415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3080419">case</span>&nbsp;<span class="ident" id="3080424">wire</span>&nbsp;<span class="op" id="3080429">==</span>&nbsp;<span class="ident" id="3080432">nil</span><span class="op" id="3080435">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080440">errorf</span><span class="op" id="3080446">(</span><span class="string" id="3080447">&#34;bad&nbsp;data:&nbsp;undefined&nbsp;type&nbsp;%s&#34;</span><span class="op" id="3080476">,</span>&nbsp;<span class="ident" id="3080478">wireId</span><span class="op" id="3080484">.</span><span class="builtintype" id="3080485">string</span><span class="op" id="3080491">(</span><span class="op" id="3080492">)</span><span class="op" id="3080493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3080497">case</span>&nbsp;<span class="ident" id="3080502">wire</span><span class="op" id="3080506">.</span><span class="ident" id="3080507">ArrayT</span>&nbsp;<span class="op" id="3080514">!=</span>&nbsp;<span class="ident" id="3080517">nil</span><span class="op" id="3080520">:</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080525">elemId</span>&nbsp;<span class="op" id="3080532">:=</span>&nbsp;<span class="ident" id="3080535">wire</span><span class="op" id="3080539">.</span><span class="ident" id="3080540">ArrayT</span><span class="op" id="3080546">.</span><span class="ident" id="3080547">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080555">elemOp</span>&nbsp;<span class="op" id="3080562">:=</span>&nbsp;<span class="ident" id="3080565">dec</span><span class="op" id="3080568">.</span><span class="ident" id="3080569">decIgnoreOpFor</span><span class="op" id="3080583">(</span><span class="ident" id="3080584">elemId</span><span class="op" id="3080590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080595">op</span>&nbsp;<span class="op" id="3080598">=</span>&nbsp;<span class="keyword" id="3080600">func</span><span class="op" id="3080604">(</span><span class="ident" id="3080605">i</span>&nbsp;<span class="op" id="3080607">*</span><span class="ident" id="3080608">decInstr</span><span class="op" id="3080616">,</span>&nbsp;<span class="ident" id="3080618">state</span>&nbsp;<span class="op" id="3080624">*</span><span class="ident" id="3080625">decoderState</span><span class="op" id="3080637">,</span>&nbsp;<span class="ident" id="3080639">value</span>&nbsp;<span class="ident" id="3080645">reflect</span><span class="op" id="3080652">.</span><span class="ident" id="3080653">Value</span><span class="op" id="3080658">)</span>&nbsp;<span class="op" id="3080660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080666">state</span><span class="op" id="3080671">.</span><span class="ident" id="3080672">dec</span><span class="op" id="3080675">.</span><span class="ident" id="3080676">ignoreArray</span><span class="op" id="3080687">(</span><span class="ident" id="3080688">state</span><span class="op" id="3080693">,</span>&nbsp;<span class="ident" id="3080695">elemOp</span><span class="op" id="3080701">,</span>&nbsp;<span class="ident" id="3080703">wire</span><span class="op" id="3080707">.</span><span class="ident" id="3080708">ArrayT</span><span class="op" id="3080714">.</span><span class="ident" id="3080715">Len</span><span class="op" id="3080718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3080723">}</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3080728">case</span>&nbsp;<span class="ident" id="3080733">wire</span><span class="op" id="3080737">.</span><span class="ident" id="3080738">MapT</span>&nbsp;<span class="op" id="3080743">!=</span>&nbsp;<span class="ident" id="3080746">nil</span><span class="op" id="3080749">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080754">keyId</span>&nbsp;<span class="op" id="3080760">:=</span>&nbsp;<span class="ident" id="3080763">dec</span><span class="op" id="3080766">.</span><span class="ident" id="3080767">wireType</span><span class="op" id="3080775">[</span><span class="ident" id="3080776">wireId</span><span class="op" id="3080782">]</span><span class="op" id="3080783">.</span><span class="ident" id="3080784">MapT</span><span class="op" id="3080788">.</span><span class="ident" id="3080789">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080796">elemId</span>&nbsp;<span class="op" id="3080803">:=</span>&nbsp;<span class="ident" id="3080806">dec</span><span class="op" id="3080809">.</span><span class="ident" id="3080810">wireType</span><span class="op" id="3080818">[</span><span class="ident" id="3080819">wireId</span><span class="op" id="3080825">]</span><span class="op" id="3080826">.</span><span class="ident" id="3080827">MapT</span><span class="op" id="3080831">.</span><span class="ident" id="3080832">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080840">keyOp</span>&nbsp;<span class="op" id="3080846">:=</span>&nbsp;<span class="ident" id="3080849">dec</span><span class="op" id="3080852">.</span><span class="ident" id="3080853">decIgnoreOpFor</span><span class="op" id="3080867">(</span><span class="ident" id="3080868">keyId</span><span class="op" id="3080873">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080878">elemOp</span>&nbsp;<span class="op" id="3080885">:=</span>&nbsp;<span class="ident" id="3080888">dec</span><span class="op" id="3080891">.</span><span class="ident" id="3080892">decIgnoreOpFor</span><span class="op" id="3080906">(</span><span class="ident" id="3080907">elemId</span><span class="op" id="3080913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080918">op</span>&nbsp;<span class="op" id="3080921">=</span>&nbsp;<span class="keyword" id="3080923">func</span><span class="op" id="3080927">(</span><span class="ident" id="3080928">i</span>&nbsp;<span class="op" id="3080930">*</span><span class="ident" id="3080931">decInstr</span><span class="op" id="3080939">,</span>&nbsp;<span class="ident" id="3080941">state</span>&nbsp;<span class="op" id="3080947">*</span><span class="ident" id="3080948">decoderState</span><span class="op" id="3080960">,</span>&nbsp;<span class="ident" id="3080962">value</span>&nbsp;<span class="ident" id="3080968">reflect</span><span class="op" id="3080975">.</span><span class="ident" id="3080976">Value</span><span class="op" id="3080981">)</span>&nbsp;<span class="op" id="3080983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3080989">state</span><span class="op" id="3080994">.</span><span class="ident" id="3080995">dec</span><span class="op" id="3080998">.</span><span class="ident" id="3080999">ignoreMap</span><span class="op" id="3081008">(</span><span class="ident" id="3081009">state</span><span class="op" id="3081014">,</span>&nbsp;<span class="ident" id="3081016">keyOp</span><span class="op" id="3081021">,</span>&nbsp;<span class="ident" id="3081023">elemOp</span><span class="op" id="3081029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081039">case</span>&nbsp;<span class="ident" id="3081044">wire</span><span class="op" id="3081048">.</span><span class="ident" id="3081049">SliceT</span>&nbsp;<span class="op" id="3081056">!=</span>&nbsp;<span class="ident" id="3081059">nil</span><span class="op" id="3081062">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081067">elemId</span>&nbsp;<span class="op" id="3081074">:=</span>&nbsp;<span class="ident" id="3081077">wire</span><span class="op" id="3081081">.</span><span class="ident" id="3081082">SliceT</span><span class="op" id="3081088">.</span><span class="ident" id="3081089">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081097">elemOp</span>&nbsp;<span class="op" id="3081104">:=</span>&nbsp;<span class="ident" id="3081107">dec</span><span class="op" id="3081110">.</span><span class="ident" id="3081111">decIgnoreOpFor</span><span class="op" id="3081125">(</span><span class="ident" id="3081126">elemId</span><span class="op" id="3081132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081137">op</span>&nbsp;<span class="op" id="3081140">=</span>&nbsp;<span class="keyword" id="3081142">func</span><span class="op" id="3081146">(</span><span class="ident" id="3081147">i</span>&nbsp;<span class="op" id="3081149">*</span><span class="ident" id="3081150">decInstr</span><span class="op" id="3081158">,</span>&nbsp;<span class="ident" id="3081160">state</span>&nbsp;<span class="op" id="3081166">*</span><span class="ident" id="3081167">decoderState</span><span class="op" id="3081179">,</span>&nbsp;<span class="ident" id="3081181">value</span>&nbsp;<span class="ident" id="3081187">reflect</span><span class="op" id="3081194">.</span><span class="ident" id="3081195">Value</span><span class="op" id="3081200">)</span>&nbsp;<span class="op" id="3081202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081208">state</span><span class="op" id="3081213">.</span><span class="ident" id="3081214">dec</span><span class="op" id="3081217">.</span><span class="ident" id="3081218">ignoreSlice</span><span class="op" id="3081229">(</span><span class="ident" id="3081230">state</span><span class="op" id="3081235">,</span>&nbsp;<span class="ident" id="3081237">elemOp</span><span class="op" id="3081243">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081253">case</span>&nbsp;<span class="ident" id="3081258">wire</span><span class="op" id="3081262">.</span><span class="ident" id="3081263">StructT</span>&nbsp;<span class="op" id="3081271">!=</span>&nbsp;<span class="ident" id="3081274">nil</span><span class="op" id="3081277">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3081282">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081357">enginePtr</span><span class="op" id="3081366">,</span>&nbsp;<span class="ident" id="3081368">err</span>&nbsp;<span class="op" id="3081372">:=</span>&nbsp;<span class="ident" id="3081375">dec</span><span class="op" id="3081378">.</span><span class="ident" id="3081379">getIgnoreEnginePtr</span><span class="op" id="3081397">(</span><span class="ident" id="3081398">wireId</span><span class="op" id="3081404">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081409">if</span>&nbsp;<span class="ident" id="3081412">err</span>&nbsp;<span class="op" id="3081416">!=</span>&nbsp;<span class="ident" id="3081419">nil</span>&nbsp;<span class="op" id="3081423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081429">error_</span><span class="op" id="3081435">(</span><span class="ident" id="3081436">err</span><span class="op" id="3081439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081449">op</span>&nbsp;<span class="op" id="3081452">=</span>&nbsp;<span class="keyword" id="3081454">func</span><span class="op" id="3081458">(</span><span class="ident" id="3081459">i</span>&nbsp;<span class="op" id="3081461">*</span><span class="ident" id="3081462">decInstr</span><span class="op" id="3081470">,</span>&nbsp;<span class="ident" id="3081472">state</span>&nbsp;<span class="op" id="3081478">*</span><span class="ident" id="3081479">decoderState</span><span class="op" id="3081491">,</span>&nbsp;<span class="ident" id="3081493">value</span>&nbsp;<span class="ident" id="3081499">reflect</span><span class="op" id="3081506">.</span><span class="ident" id="3081507">Value</span><span class="op" id="3081512">)</span>&nbsp;<span class="op" id="3081514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3081520">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081596">state</span><span class="op" id="3081601">.</span><span class="ident" id="3081602">dec</span><span class="op" id="3081605">.</span><span class="ident" id="3081606">ignoreStruct</span><span class="op" id="3081618">(</span><span class="op" id="3081619">*</span><span class="ident" id="3081620">enginePtr</span><span class="op" id="3081629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081639">case</span>&nbsp;<span class="ident" id="3081644">wire</span><span class="op" id="3081648">.</span><span class="ident" id="3081649">GobEncoderT</span>&nbsp;<span class="op" id="3081661">!=</span>&nbsp;<span class="ident" id="3081664">nil</span><span class="op" id="3081667">,</span>&nbsp;<span class="ident" id="3081669">wire</span><span class="op" id="3081673">.</span><span class="ident" id="3081674">BinaryMarshalerT</span>&nbsp;<span class="op" id="3081691">!=</span>&nbsp;<span class="ident" id="3081694">nil</span><span class="op" id="3081697">,</span>&nbsp;<span class="ident" id="3081699">wire</span><span class="op" id="3081703">.</span><span class="ident" id="3081704">TextMarshalerT</span>&nbsp;<span class="op" id="3081719">!=</span>&nbsp;<span class="ident" id="3081722">nil</span><span class="op" id="3081725">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081730">op</span>&nbsp;<span class="op" id="3081733">=</span>&nbsp;<span class="keyword" id="3081735">func</span><span class="op" id="3081739">(</span><span class="ident" id="3081740">i</span>&nbsp;<span class="op" id="3081742">*</span><span class="ident" id="3081743">decInstr</span><span class="op" id="3081751">,</span>&nbsp;<span class="ident" id="3081753">state</span>&nbsp;<span class="op" id="3081759">*</span><span class="ident" id="3081760">decoderState</span><span class="op" id="3081772">,</span>&nbsp;<span class="ident" id="3081774">value</span>&nbsp;<span class="ident" id="3081780">reflect</span><span class="op" id="3081787">.</span><span class="ident" id="3081788">Value</span><span class="op" id="3081793">)</span>&nbsp;<span class="op" id="3081795">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081801">state</span><span class="op" id="3081806">.</span><span class="ident" id="3081807">dec</span><span class="op" id="3081810">.</span><span class="ident" id="3081811">ignoreGobDecoder</span><span class="op" id="3081827">(</span><span class="ident" id="3081828">state</span><span class="op" id="3081833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081848">if</span>&nbsp;<span class="ident" id="3081851">op</span>&nbsp;<span class="op" id="3081854">==</span>&nbsp;<span class="ident" id="3081857">nil</span>&nbsp;<span class="op" id="3081861">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3081865">errorf</span><span class="op" id="3081871">(</span><span class="string" id="3081872">&#34;bad&nbsp;data:&nbsp;ignore&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="3081911">,</span>&nbsp;<span class="ident" id="3081913">wireId</span><span class="op" id="3081919">.</span><span class="builtintype" id="3081920">string</span><span class="op" id="3081926">(</span><span class="op" id="3081927">)</span><span class="op" id="3081928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3081931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3081934">return</span>&nbsp;<span class="ident" id="3081941">op</span><br>
<span class="lineno"></span><span class="op" id="3081944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="3081947">//&nbsp;gobDecodeOpFor&nbsp;returns&nbsp;the&nbsp;op&nbsp;for&nbsp;a&nbsp;type&nbsp;that&nbsp;is&nbsp;known&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="3082018">//&nbsp;GobDecoder.</span><br>
<span class="lineno"></span><span class="keyword" id="3082033">func</span>&nbsp;<span class="op" id="3082038">(</span><span class="ident" id="3082039">dec</span>&nbsp;<span class="op" id="3082043">*</span><span class="ident" id="3082044">Decoder</span><span class="op" id="3082051">)</span>&nbsp;<span class="ident" id="3082053">gobDecodeOpFor</span><span class="op" id="3082067">(</span><span class="ident" id="3082068">ut</span>&nbsp;<span class="op" id="3082071">*</span><span class="ident" id="3082072">userTypeInfo</span><span class="op" id="3082084">)</span>&nbsp;<span class="op" id="3082086">*</span><span class="ident" id="3082087">decOp</span>&nbsp;<span class="op" id="3082093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3082096">rcvrType</span>&nbsp;<span class="op" id="3082105">:=</span>&nbsp;<span class="ident" id="3082108">ut</span><span class="op" id="3082110">.</span><span class="ident" id="3082111">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3082117">if</span>&nbsp;<span class="ident" id="3082120">ut</span><span class="op" id="3082122">.</span><span class="ident" id="3082123">decIndir</span>&nbsp;<span class="op" id="3082132">==</span>&nbsp;<span class="op" id="3082135">-</span><span class="num" id="3082136">1</span>&nbsp;<span class="op" id="3082138">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3082142">rcvrType</span>&nbsp;<span class="op" id="3082151">=</span>&nbsp;<span class="ident" id="3082153">reflect</span><span class="op" id="3082160">.</span><span class="ident" id="3082161">PtrTo</span><span class="op" id="3082166">(</span><span class="ident" id="3082167">rcvrType</span><span class="op" id="3082175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3082178">}</span>&nbsp;<span class="keyword" id="3082180">else</span>&nbsp;<span class="keyword" id="3082185">if</span>&nbsp;<span class="ident" id="3082188">ut</span><span class="op" id="3082190">.</span><span class="ident" id="3082191">decIndir</span>&nbsp;<span class="op" id="3082200">&gt;</span>&nbsp;<span class="num" id="3082202">0</span>&nbsp;<span class="op" id="3082204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3082208">for</span>&nbsp;<span class="ident" id="3082212">i</span>&nbsp;<span class="op" id="3082214">:=</span>&nbsp;<span class="builtintype" id="3082217">int8</span><span class="op" id="3082221">(</span><span class="num" id="3082222">0</span><span class="op" id="3082223">)</span><span class="op" id="3082224">;</span>&nbsp;<span class="ident" id="3082226">i</span>&nbsp;<span class="op" id="3082228">&lt;</span>&nbsp;<span class="ident" id="3082230">ut</span><span class="op" id="3082232">.</span><span class="ident" id="3082233">decIndir</span><span class="op" id="3082241">;</span>&nbsp;<span class="ident" id="3082243">i</span><span class="op" id="3082244">++</span>&nbsp;<span class="op" id="3082247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3082252">rcvrType</span>&nbsp;<span class="op" id="3082261">=</span>&nbsp;<span class="ident" id="3082263">rcvrType</span><span class="op" id="3082271">.</span><span class="ident" id="3082272">Elem</span><span class="op" id="3082276">(</span><span class="op" id="3082277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3082281">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3082284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3082287">var</span>&nbsp;<span class="ident" id="3082291">op</span>&nbsp;<span class="ident" id="3082294">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3082301">op</span>&nbsp;<span class="op" id="3082304">=</span>&nbsp;<span class="keyword" id="3082306">func</span><span class="op" id="3082310">(</span><span class="ident" id="3082311">i</span>&nbsp;<span class="op" id="3082313">*</span><span class="ident" id="3082314">decInstr</span><span class="op" id="3082322">,</span>&nbsp;<span class="ident" id="3082324">state</span>&nbsp;<span class="op" id="3082330">*</span><span class="ident" id="3082331">decoderState</span><span class="op" id="3082343">,</span>&nbsp;<span class="ident" id="3082345">value</span>&nbsp;<span class="ident" id="3082351">reflect</span><span class="op" id="3082358">.</span><span class="ident" id="3082359">Value</span><span class="op" id="3082364">)</span>&nbsp;<span class="op" id="3082366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3082370">//&nbsp;We&nbsp;now&nbsp;have&nbsp;the&nbsp;base&nbsp;type.&nbsp;We&nbsp;need&nbsp;its&nbsp;address&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3082452">if</span>&nbsp;<span class="ident" id="3082455">value</span><span class="op" id="3082460">.</span><span class="ident" id="3082461">Kind</span><span class="op" id="3082465">(</span><span class="op" id="3082466">)</span>&nbsp;<span class="op" id="3082468">!=</span>&nbsp;<span class="ident" id="3082471">reflect</span><span class="op" id="3082478">.</span><span class="ident" id="3082479">Ptr</span>&nbsp;<span class="op" id="3082483">&amp;&amp;</span>&nbsp;<span class="ident" id="3082486">rcvrType</span><span class="op" id="3082494">.</span><span class="ident" id="3082495">Kind</span><span class="op" id="3082499">(</span><span class="op" id="3082500">)</span>&nbsp;<span class="op" id="3082502">==</span>&nbsp;<span class="ident" id="3082505">reflect</span><span class="op" id="3082512">.</span><span class="ident" id="3082513">Ptr</span>&nbsp;<span class="op" id="3082517">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3082522">value</span>&nbsp;<span class="op" id="3082528">=</span>&nbsp;<span class="ident" id="3082530">value</span><span class="op" id="3082535">.</span><span class="ident" id="3082536">Addr</span><span class="op" id="3082540">(</span><span class="op" id="3082541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3082545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3082549">state</span><span class="op" id="3082554">.</span><span class="ident" id="3082555">dec</span><span class="op" id="3082558">.</span><span class="ident" id="3082559">decodeGobDecoder</span><span class="op" id="3082575">(</span><span class="ident" id="3082576">ut</span><span class="op" id="3082578">,</span>&nbsp;<span class="ident" id="3082580">state</span><span class="op" id="3082585">,</span>&nbsp;<span class="ident" id="3082587">value</span><span class="op" id="3082592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3082595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3082598">return</span>&nbsp;<span class="op" id="3082605">&amp;</span><span class="ident" id="3082606">op</span><br>
<span class="lineno">925</span><span class="op" id="3082609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3082612">//&nbsp;compatibleType&nbsp;asks:&nbsp;Are&nbsp;these&nbsp;two&nbsp;gob&nbsp;Types&nbsp;compatible?</span><br>
<span class="lineno"></span><span class="comment" id="3082672">//&nbsp;Answers&nbsp;the&nbsp;question&nbsp;for&nbsp;basic&nbsp;types,&nbsp;arrays,&nbsp;maps&nbsp;and&nbsp;slices,&nbsp;plus</span><br>
<span class="lineno"></span><span class="comment" id="3082743">//&nbsp;GobEncoder/Decoder&nbsp;pairs.</span><br>
<span class="lineno">930</span><span class="comment" id="3082772">//&nbsp;Structs&nbsp;are&nbsp;considered&nbsp;ok;&nbsp;fields&nbsp;will&nbsp;be&nbsp;checked&nbsp;later.</span><br>
<span class="lineno"></span><span class="keyword" id="3082832">func</span>&nbsp;<span class="op" id="3082837">(</span><span class="ident" id="3082838">dec</span>&nbsp;<span class="op" id="3082842">*</span><span class="ident" id="3082843">Decoder</span><span class="op" id="3082850">)</span>&nbsp;<span class="ident" id="3082852">compatibleType</span><span class="op" id="3082866">(</span><span class="ident" id="3082867">fr</span>&nbsp;<span class="ident" id="3082870">reflect</span><span class="op" id="3082877">.</span><span class="ident" id="3082878">Type</span><span class="op" id="3082882">,</span>&nbsp;<span class="ident" id="3082884">fw</span>&nbsp;<span class="ident" id="3082887">typeId</span><span class="op" id="3082893">,</span>&nbsp;<span class="ident" id="3082895">inProgress</span>&nbsp;<span class="keyword" id="3082906">map</span><span class="op" id="3082909">[</span><span class="ident" id="3082910">reflect</span><span class="op" id="3082917">.</span><span class="ident" id="3082918">Type</span><span class="op" id="3082922">]</span><span class="ident" id="3082923">typeId</span><span class="op" id="3082929">)</span>&nbsp;<span class="builtintype" id="3082931">bool</span>&nbsp;<span class="op" id="3082936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3082939">if</span>&nbsp;<span class="ident" id="3082942">rhs</span><span class="op" id="3082945">,</span>&nbsp;<span class="ident" id="3082947">ok</span>&nbsp;<span class="op" id="3082950">:=</span>&nbsp;<span class="ident" id="3082953">inProgress</span><span class="op" id="3082963">[</span><span class="ident" id="3082964">fr</span><span class="op" id="3082966">]</span><span class="op" id="3082967">;</span>&nbsp;<span class="ident" id="3082969">ok</span>&nbsp;<span class="op" id="3082972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3082976">return</span>&nbsp;<span class="ident" id="3082983">rhs</span>&nbsp;<span class="op" id="3082987">==</span>&nbsp;<span class="ident" id="3082990">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3082994">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3082997">inProgress</span><span class="op" id="3083007">[</span><span class="ident" id="3083008">fr</span><span class="op" id="3083010">]</span>&nbsp;<span class="op" id="3083012">=</span>&nbsp;<span class="ident" id="3083014">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3083018">ut</span>&nbsp;<span class="op" id="3083021">:=</span>&nbsp;<span class="ident" id="3083024">userType</span><span class="op" id="3083032">(</span><span class="ident" id="3083033">fr</span><span class="op" id="3083035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3083038">wire</span><span class="op" id="3083042">,</span>&nbsp;<span class="ident" id="3083044">ok</span>&nbsp;<span class="op" id="3083047">:=</span>&nbsp;<span class="ident" id="3083050">dec</span><span class="op" id="3083053">.</span><span class="ident" id="3083054">wireType</span><span class="op" id="3083062">[</span><span class="ident" id="3083063">fw</span><span class="op" id="3083065">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083068">//&nbsp;If&nbsp;wire&nbsp;was&nbsp;encoded&nbsp;with&nbsp;an&nbsp;encoding&nbsp;method,&nbsp;fr&nbsp;must&nbsp;have&nbsp;that&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083143">//&nbsp;And&nbsp;if&nbsp;not,&nbsp;it&nbsp;must&nbsp;not.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083172">//&nbsp;At&nbsp;most&nbsp;one&nbsp;of&nbsp;the&nbsp;booleans&nbsp;in&nbsp;ut&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083218">//&nbsp;We&nbsp;could&nbsp;possibly&nbsp;relax&nbsp;this&nbsp;constraint&nbsp;in&nbsp;the&nbsp;future&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083288">//&nbsp;choose&nbsp;the&nbsp;decoding&nbsp;method&nbsp;using&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;wireType.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083351">//&nbsp;The&nbsp;parentheses&nbsp;look&nbsp;odd&nbsp;but&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3083397">if</span>&nbsp;<span class="op" id="3083400">(</span><span class="ident" id="3083401">ut</span><span class="op" id="3083403">.</span><span class="ident" id="3083404">externalDec</span>&nbsp;<span class="op" id="3083416">==</span>&nbsp;<span class="ident" id="3083419">xGob</span><span class="op" id="3083423">)</span>&nbsp;<span class="op" id="3083425">!=</span>&nbsp;<span class="op" id="3083428">(</span><span class="ident" id="3083429">ok</span>&nbsp;<span class="op" id="3083432">&amp;&amp;</span>&nbsp;<span class="ident" id="3083435">wire</span><span class="op" id="3083439">.</span><span class="ident" id="3083440">GobEncoderT</span>&nbsp;<span class="op" id="3083452">!=</span>&nbsp;<span class="ident" id="3083455">nil</span><span class="op" id="3083458">)</span>&nbsp;<span class="op" id="3083460">||</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3083465">(</span><span class="ident" id="3083466">ut</span><span class="op" id="3083468">.</span><span class="ident" id="3083469">externalDec</span>&nbsp;<span class="op" id="3083481">==</span>&nbsp;<span class="ident" id="3083484">xBinary</span><span class="op" id="3083491">)</span>&nbsp;<span class="op" id="3083493">!=</span>&nbsp;<span class="op" id="3083496">(</span><span class="ident" id="3083497">ok</span>&nbsp;<span class="op" id="3083500">&amp;&amp;</span>&nbsp;<span class="ident" id="3083503">wire</span><span class="op" id="3083507">.</span><span class="ident" id="3083508">BinaryMarshalerT</span>&nbsp;<span class="op" id="3083525">!=</span>&nbsp;<span class="ident" id="3083528">nil</span><span class="op" id="3083531">)</span>&nbsp;<span class="op" id="3083533">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3083538">(</span><span class="ident" id="3083539">ut</span><span class="op" id="3083541">.</span><span class="ident" id="3083542">externalDec</span>&nbsp;<span class="op" id="3083554">==</span>&nbsp;<span class="ident" id="3083557">xText</span><span class="op" id="3083562">)</span>&nbsp;<span class="op" id="3083564">!=</span>&nbsp;<span class="op" id="3083567">(</span><span class="ident" id="3083568">ok</span>&nbsp;<span class="op" id="3083571">&amp;&amp;</span>&nbsp;<span class="ident" id="3083574">wire</span><span class="op" id="3083578">.</span><span class="ident" id="3083579">TextMarshalerT</span>&nbsp;<span class="op" id="3083594">!=</span>&nbsp;<span class="ident" id="3083597">nil</span><span class="op" id="3083600">)</span>&nbsp;<span class="op" id="3083602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3083606">return</span>&nbsp;<span class="builtintype" id="3083613">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3083620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3083623">if</span>&nbsp;<span class="ident" id="3083626">ut</span><span class="op" id="3083628">.</span><span class="ident" id="3083629">externalDec</span>&nbsp;<span class="op" id="3083641">!=</span>&nbsp;<span class="num" id="3083644">0</span>&nbsp;<span class="op" id="3083646">{</span>&nbsp;<span class="comment" id="3083648">//&nbsp;This&nbsp;test&nbsp;trumps&nbsp;all&nbsp;others.</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3083682">return</span>&nbsp;<span class="builtintype" id="3083689">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3083695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3083698">switch</span>&nbsp;<span class="ident" id="3083705">t</span>&nbsp;<span class="op" id="3083707">:=</span>&nbsp;<span class="ident" id="3083710">ut</span><span class="op" id="3083712">.</span><span class="ident" id="3083713">base</span><span class="op" id="3083717">;</span>&nbsp;<span class="ident" id="3083719">t</span><span class="op" id="3083720">.</span><span class="ident" id="3083721">Kind</span><span class="op" id="3083725">(</span><span class="op" id="3083726">)</span>&nbsp;<span class="op" id="3083728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3083731">default</span><span class="op" id="3083738">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083742">//&nbsp;chan,&nbsp;etc:&nbsp;cannot&nbsp;handle.</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3083773">return</span>&nbsp;<span class="builtintype" id="3083780">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3083787">case</span>&nbsp;<span class="ident" id="3083792">reflect</span><span class="op" id="3083799">.</span><span class="ident" id="3083800">Bool</span><span class="op" id="3083804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3083808">return</span>&nbsp;<span class="ident" id="3083815">fw</span>&nbsp;<span class="op" id="3083818">==</span>&nbsp;<span class="ident" id="3083821">tBool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3083828">case</span>&nbsp;<span class="ident" id="3083833">reflect</span><span class="op" id="3083840">.</span><span class="ident" id="3083841">Int</span><span class="op" id="3083844">,</span>&nbsp;<span class="ident" id="3083846">reflect</span><span class="op" id="3083853">.</span><span class="ident" id="3083854">Int8</span><span class="op" id="3083858">,</span>&nbsp;<span class="ident" id="3083860">reflect</span><span class="op" id="3083867">.</span><span class="ident" id="3083868">Int16</span><span class="op" id="3083873">,</span>&nbsp;<span class="ident" id="3083875">reflect</span><span class="op" id="3083882">.</span><span class="ident" id="3083883">Int32</span><span class="op" id="3083888">,</span>&nbsp;<span class="ident" id="3083890">reflect</span><span class="op" id="3083897">.</span><span class="ident" id="3083898">Int64</span><span class="op" id="3083903">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3083907">return</span>&nbsp;<span class="ident" id="3083914">fw</span>&nbsp;<span class="op" id="3083917">==</span>&nbsp;<span class="ident" id="3083920">tInt</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3083926">case</span>&nbsp;<span class="ident" id="3083931">reflect</span><span class="op" id="3083938">.</span><span class="ident" id="3083939">Uint</span><span class="op" id="3083943">,</span>&nbsp;<span class="ident" id="3083945">reflect</span><span class="op" id="3083952">.</span><span class="ident" id="3083953">Uint8</span><span class="op" id="3083958">,</span>&nbsp;<span class="ident" id="3083960">reflect</span><span class="op" id="3083967">.</span><span class="ident" id="3083968">Uint16</span><span class="op" id="3083974">,</span>&nbsp;<span class="ident" id="3083976">reflect</span><span class="op" id="3083983">.</span><span class="ident" id="3083984">Uint32</span><span class="op" id="3083990">,</span>&nbsp;<span class="ident" id="3083992">reflect</span><span class="op" id="3083999">.</span><span class="ident" id="3084000">Uint64</span><span class="op" id="3084006">,</span>&nbsp;<span class="ident" id="3084008">reflect</span><span class="op" id="3084015">.</span><span class="ident" id="3084016">Uintptr</span><span class="op" id="3084023">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084027">return</span>&nbsp;<span class="ident" id="3084034">fw</span>&nbsp;<span class="op" id="3084037">==</span>&nbsp;<span class="ident" id="3084040">tUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084047">case</span>&nbsp;<span class="ident" id="3084052">reflect</span><span class="op" id="3084059">.</span><span class="ident" id="3084060">Float32</span><span class="op" id="3084067">,</span>&nbsp;<span class="ident" id="3084069">reflect</span><span class="op" id="3084076">.</span><span class="ident" id="3084077">Float64</span><span class="op" id="3084084">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084088">return</span>&nbsp;<span class="ident" id="3084095">fw</span>&nbsp;<span class="op" id="3084098">==</span>&nbsp;<span class="ident" id="3084101">tFloat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084109">case</span>&nbsp;<span class="ident" id="3084114">reflect</span><span class="op" id="3084121">.</span><span class="ident" id="3084122">Complex64</span><span class="op" id="3084131">,</span>&nbsp;<span class="ident" id="3084133">reflect</span><span class="op" id="3084140">.</span><span class="ident" id="3084141">Complex128</span><span class="op" id="3084151">:</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084155">return</span>&nbsp;<span class="ident" id="3084162">fw</span>&nbsp;<span class="op" id="3084165">==</span>&nbsp;<span class="ident" id="3084168">tComplex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084178">case</span>&nbsp;<span class="ident" id="3084183">reflect</span><span class="op" id="3084190">.</span><span class="ident" id="3084191">String</span><span class="op" id="3084197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084201">return</span>&nbsp;<span class="ident" id="3084208">fw</span>&nbsp;<span class="op" id="3084211">==</span>&nbsp;<span class="ident" id="3084214">tString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084223">case</span>&nbsp;<span class="ident" id="3084228">reflect</span><span class="op" id="3084235">.</span><span class="ident" id="3084236">Interface</span><span class="op" id="3084245">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084249">return</span>&nbsp;<span class="ident" id="3084256">fw</span>&nbsp;<span class="op" id="3084259">==</span>&nbsp;<span class="ident" id="3084262">tInterface</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084274">case</span>&nbsp;<span class="ident" id="3084279">reflect</span><span class="op" id="3084286">.</span><span class="ident" id="3084287">Array</span><span class="op" id="3084292">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084296">if</span>&nbsp;<span class="op" id="3084299">!</span><span class="ident" id="3084300">ok</span>&nbsp;<span class="op" id="3084303">||</span>&nbsp;<span class="ident" id="3084306">wire</span><span class="op" id="3084310">.</span><span class="ident" id="3084311">ArrayT</span>&nbsp;<span class="op" id="3084318">==</span>&nbsp;<span class="ident" id="3084321">nil</span>&nbsp;<span class="op" id="3084325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084330">return</span>&nbsp;<span class="builtintype" id="3084337">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3084345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3084349">array</span>&nbsp;<span class="op" id="3084355">:=</span>&nbsp;<span class="ident" id="3084358">wire</span><span class="op" id="3084362">.</span><span class="ident" id="3084363">ArrayT</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084372">return</span>&nbsp;<span class="ident" id="3084379">t</span><span class="op" id="3084380">.</span><span class="ident" id="3084381">Len</span><span class="op" id="3084384">(</span><span class="op" id="3084385">)</span>&nbsp;<span class="op" id="3084387">==</span>&nbsp;<span class="ident" id="3084390">array</span><span class="op" id="3084395">.</span><span class="ident" id="3084396">Len</span>&nbsp;<span class="op" id="3084400">&amp;&amp;</span>&nbsp;<span class="ident" id="3084403">dec</span><span class="op" id="3084406">.</span><span class="ident" id="3084407">compatibleType</span><span class="op" id="3084421">(</span><span class="ident" id="3084422">t</span><span class="op" id="3084423">.</span><span class="ident" id="3084424">Elem</span><span class="op" id="3084428">(</span><span class="op" id="3084429">)</span><span class="op" id="3084430">,</span>&nbsp;<span class="ident" id="3084432">array</span><span class="op" id="3084437">.</span><span class="ident" id="3084438">Elem</span><span class="op" id="3084442">,</span>&nbsp;<span class="ident" id="3084444">inProgress</span><span class="op" id="3084454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084457">case</span>&nbsp;<span class="ident" id="3084462">reflect</span><span class="op" id="3084469">.</span><span class="ident" id="3084470">Map</span><span class="op" id="3084473">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084477">if</span>&nbsp;<span class="op" id="3084480">!</span><span class="ident" id="3084481">ok</span>&nbsp;<span class="op" id="3084484">||</span>&nbsp;<span class="ident" id="3084487">wire</span><span class="op" id="3084491">.</span><span class="ident" id="3084492">MapT</span>&nbsp;<span class="op" id="3084497">==</span>&nbsp;<span class="ident" id="3084500">nil</span>&nbsp;<span class="op" id="3084504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084509">return</span>&nbsp;<span class="builtintype" id="3084516">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3084524">}</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3084528">MapType</span>&nbsp;<span class="op" id="3084536">:=</span>&nbsp;<span class="ident" id="3084539">wire</span><span class="op" id="3084543">.</span><span class="ident" id="3084544">MapT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084551">return</span>&nbsp;<span class="ident" id="3084558">dec</span><span class="op" id="3084561">.</span><span class="ident" id="3084562">compatibleType</span><span class="op" id="3084576">(</span><span class="ident" id="3084577">t</span><span class="op" id="3084578">.</span><span class="ident" id="3084579">Key</span><span class="op" id="3084582">(</span><span class="op" id="3084583">)</span><span class="op" id="3084584">,</span>&nbsp;<span class="ident" id="3084586">MapType</span><span class="op" id="3084593">.</span><span class="ident" id="3084594">Key</span><span class="op" id="3084597">,</span>&nbsp;<span class="ident" id="3084599">inProgress</span><span class="op" id="3084609">)</span>&nbsp;<span class="op" id="3084611">&amp;&amp;</span>&nbsp;<span class="ident" id="3084614">dec</span><span class="op" id="3084617">.</span><span class="ident" id="3084618">compatibleType</span><span class="op" id="3084632">(</span><span class="ident" id="3084633">t</span><span class="op" id="3084634">.</span><span class="ident" id="3084635">Elem</span><span class="op" id="3084639">(</span><span class="op" id="3084640">)</span><span class="op" id="3084641">,</span>&nbsp;<span class="ident" id="3084643">MapType</span><span class="op" id="3084650">.</span><span class="ident" id="3084651">Elem</span><span class="op" id="3084655">,</span>&nbsp;<span class="ident" id="3084657">inProgress</span><span class="op" id="3084667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084670">case</span>&nbsp;<span class="ident" id="3084675">reflect</span><span class="op" id="3084682">.</span><span class="ident" id="3084683">Slice</span><span class="op" id="3084688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3084692">//&nbsp;Is&nbsp;it&nbsp;an&nbsp;array&nbsp;of&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084722">if</span>&nbsp;<span class="ident" id="3084725">t</span><span class="op" id="3084726">.</span><span class="ident" id="3084727">Elem</span><span class="op" id="3084731">(</span><span class="op" id="3084732">)</span><span class="op" id="3084733">.</span><span class="ident" id="3084734">Kind</span><span class="op" id="3084738">(</span><span class="op" id="3084739">)</span>&nbsp;<span class="op" id="3084741">==</span>&nbsp;<span class="ident" id="3084744">reflect</span><span class="op" id="3084751">.</span><span class="ident" id="3084752">Uint8</span>&nbsp;<span class="op" id="3084758">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084763">return</span>&nbsp;<span class="ident" id="3084770">fw</span>&nbsp;<span class="op" id="3084773">==</span>&nbsp;<span class="ident" id="3084776">tBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3084785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3084789">//&nbsp;Extract&nbsp;and&nbsp;compare&nbsp;element&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084829">var</span>&nbsp;<span class="ident" id="3084833">sw</span>&nbsp;<span class="op" id="3084836">*</span><span class="ident" id="3084837">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084849">if</span>&nbsp;<span class="ident" id="3084852">tt</span><span class="op" id="3084854">,</span>&nbsp;<span class="ident" id="3084856">ok</span>&nbsp;<span class="op" id="3084859">:=</span>&nbsp;<span class="ident" id="3084862">builtinIdToType</span><span class="op" id="3084877">[</span><span class="ident" id="3084878">fw</span><span class="op" id="3084880">]</span><span class="op" id="3084881">;</span>&nbsp;<span class="ident" id="3084883">ok</span>&nbsp;<span class="op" id="3084886">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3084891">sw</span><span class="op" id="3084893">,</span>&nbsp;<span class="ident" id="3084895">_</span>&nbsp;<span class="op" id="3084897">=</span>&nbsp;<span class="ident" id="3084899">tt</span><span class="op" id="3084901">.</span><span class="op" id="3084902">(</span><span class="op" id="3084903">*</span><span class="ident" id="3084904">sliceType</span><span class="op" id="3084913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3084917">}</span>&nbsp;<span class="keyword" id="3084919">else</span>&nbsp;<span class="keyword" id="3084924">if</span>&nbsp;<span class="ident" id="3084927">wire</span>&nbsp;<span class="op" id="3084932">!=</span>&nbsp;<span class="ident" id="3084935">nil</span>&nbsp;<span class="op" id="3084939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3084944">sw</span>&nbsp;<span class="op" id="3084947">=</span>&nbsp;<span class="ident" id="3084949">wire</span><span class="op" id="3084953">.</span><span class="ident" id="3084954">SliceT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3084963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3084967">elem</span>&nbsp;<span class="op" id="3084972">:=</span>&nbsp;<span class="ident" id="3084975">userType</span><span class="op" id="3084983">(</span><span class="ident" id="3084984">t</span><span class="op" id="3084985">.</span><span class="ident" id="3084986">Elem</span><span class="op" id="3084990">(</span><span class="op" id="3084991">)</span><span class="op" id="3084992">)</span><span class="op" id="3084993">.</span><span class="ident" id="3084994">base</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085001">return</span>&nbsp;<span class="ident" id="3085008">sw</span>&nbsp;<span class="op" id="3085011">!=</span>&nbsp;<span class="ident" id="3085014">nil</span>&nbsp;<span class="op" id="3085018">&amp;&amp;</span>&nbsp;<span class="ident" id="3085021">dec</span><span class="op" id="3085024">.</span><span class="ident" id="3085025">compatibleType</span><span class="op" id="3085039">(</span><span class="ident" id="3085040">elem</span><span class="op" id="3085044">,</span>&nbsp;<span class="ident" id="3085046">sw</span><span class="op" id="3085048">.</span><span class="ident" id="3085049">Elem</span><span class="op" id="3085053">,</span>&nbsp;<span class="ident" id="3085055">inProgress</span><span class="op" id="3085065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085068">case</span>&nbsp;<span class="ident" id="3085073">reflect</span><span class="op" id="3085080">.</span><span class="ident" id="3085081">Struct</span><span class="op" id="3085087">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085091">return</span>&nbsp;<span class="builtintype" id="3085098">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3085104">}</span><br>
<span class="lineno"></span><span class="op" id="3085106">}</span><br>
<span class="lineno">1000</span><br>
<span class="lineno"></span><span class="comment" id="3085109">//&nbsp;typeString&nbsp;returns&nbsp;a&nbsp;human-readable&nbsp;description&nbsp;of&nbsp;the&nbsp;type&nbsp;identified&nbsp;by&nbsp;remoteId.</span><br>
<span class="lineno"></span><span class="keyword" id="3085196">func</span>&nbsp;<span class="op" id="3085201">(</span><span class="ident" id="3085202">dec</span>&nbsp;<span class="op" id="3085206">*</span><span class="ident" id="3085207">Decoder</span><span class="op" id="3085214">)</span>&nbsp;<span class="ident" id="3085216">typeString</span><span class="op" id="3085226">(</span><span class="ident" id="3085227">remoteId</span>&nbsp;<span class="ident" id="3085236">typeId</span><span class="op" id="3085242">)</span>&nbsp;<span class="builtintype" id="3085244">string</span>&nbsp;<span class="op" id="3085251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085254">if</span>&nbsp;<span class="ident" id="3085257">t</span>&nbsp;<span class="op" id="3085259">:=</span>&nbsp;<span class="ident" id="3085262">idToType</span><span class="op" id="3085270">[</span><span class="ident" id="3085271">remoteId</span><span class="op" id="3085279">]</span><span class="op" id="3085280">;</span>&nbsp;<span class="ident" id="3085282">t</span>&nbsp;<span class="op" id="3085284">!=</span>&nbsp;<span class="ident" id="3085287">nil</span>&nbsp;<span class="op" id="3085291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3085295">//&nbsp;globally&nbsp;known&nbsp;type.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085321">return</span>&nbsp;<span class="ident" id="3085328">t</span><span class="op" id="3085329">.</span><span class="builtintype" id="3085330">string</span><span class="op" id="3085336">(</span><span class="op" id="3085337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3085340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085343">return</span>&nbsp;<span class="ident" id="3085350">dec</span><span class="op" id="3085353">.</span><span class="ident" id="3085354">wireType</span><span class="op" id="3085362">[</span><span class="ident" id="3085363">remoteId</span><span class="op" id="3085371">]</span><span class="op" id="3085372">.</span><span class="builtintype" id="3085373">string</span><span class="op" id="3085379">(</span><span class="op" id="3085380">)</span><br>
<span class="lineno"></span><span class="op" id="3085382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="3085385">//&nbsp;compileSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value,&nbsp;including</span><br>
<span class="lineno"></span><span class="comment" id="3085474">//&nbsp;GobDecoders.</span><br>
<span class="lineno"></span><span class="keyword" id="3085490">func</span>&nbsp;<span class="op" id="3085495">(</span><span class="ident" id="3085496">dec</span>&nbsp;<span class="op" id="3085500">*</span><span class="ident" id="3085501">Decoder</span><span class="op" id="3085508">)</span>&nbsp;<span class="ident" id="3085510">compileSingle</span><span class="op" id="3085523">(</span><span class="ident" id="3085524">remoteId</span>&nbsp;<span class="ident" id="3085533">typeId</span><span class="op" id="3085539">,</span>&nbsp;<span class="ident" id="3085541">ut</span>&nbsp;<span class="op" id="3085544">*</span><span class="ident" id="3085545">userTypeInfo</span><span class="op" id="3085557">)</span>&nbsp;<span class="op" id="3085559">(</span><span class="ident" id="3085560">engine</span>&nbsp;<span class="op" id="3085567">*</span><span class="ident" id="3085568">decEngine</span><span class="op" id="3085577">,</span>&nbsp;<span class="ident" id="3085579">err</span>&nbsp;<span class="builtintype" id="3085583">error</span><span class="op" id="3085588">)</span>&nbsp;<span class="op" id="3085590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3085593">rt</span>&nbsp;<span class="op" id="3085596">:=</span>&nbsp;<span class="ident" id="3085599">ut</span><span class="op" id="3085601">.</span><span class="ident" id="3085602">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3085608">engine</span>&nbsp;<span class="op" id="3085615">=</span>&nbsp;<span class="builtinfunc" id="3085617">new</span><span class="op" id="3085620">(</span><span class="ident" id="3085621">decEngine</span><span class="op" id="3085630">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3085633">engine</span><span class="op" id="3085639">.</span><span class="ident" id="3085640">instr</span>&nbsp;<span class="op" id="3085646">=</span>&nbsp;<span class="builtinfunc" id="3085648">make</span><span class="op" id="3085652">(</span><span class="op" id="3085653">[</span><span class="op" id="3085654">]</span><span class="ident" id="3085655">decInstr</span><span class="op" id="3085663">,</span>&nbsp;<span class="num" id="3085665">1</span><span class="op" id="3085666">)</span>&nbsp;<span class="comment" id="3085668">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3085681">name</span>&nbsp;<span class="op" id="3085686">:=</span>&nbsp;<span class="ident" id="3085689">rt</span><span class="op" id="3085691">.</span><span class="ident" id="3085692">String</span><span class="op" id="3085698">(</span><span class="op" id="3085699">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3085716">//&nbsp;best&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085735">if</span>&nbsp;<span class="op" id="3085738">!</span><span class="ident" id="3085739">dec</span><span class="op" id="3085742">.</span><span class="ident" id="3085743">compatibleType</span><span class="op" id="3085757">(</span><span class="ident" id="3085758">rt</span><span class="op" id="3085760">,</span>&nbsp;<span class="ident" id="3085762">remoteId</span><span class="op" id="3085770">,</span>&nbsp;<span class="builtinfunc" id="3085772">make</span><span class="op" id="3085776">(</span><span class="keyword" id="3085777">map</span><span class="op" id="3085780">[</span><span class="ident" id="3085781">reflect</span><span class="op" id="3085788">.</span><span class="ident" id="3085789">Type</span><span class="op" id="3085793">]</span><span class="ident" id="3085794">typeId</span><span class="op" id="3085800">)</span><span class="op" id="3085801">)</span>&nbsp;<span class="op" id="3085803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3085807">remoteType</span>&nbsp;<span class="op" id="3085818">:=</span>&nbsp;<span class="ident" id="3085821">dec</span><span class="op" id="3085824">.</span><span class="ident" id="3085825">typeString</span><span class="op" id="3085835">(</span><span class="ident" id="3085836">remoteId</span><span class="op" id="3085844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3085848">//&nbsp;Common&nbsp;confusing&nbsp;case:&nbsp;local&nbsp;interface&nbsp;type,&nbsp;remote&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085920">if</span>&nbsp;<span class="ident" id="3085923">ut</span><span class="op" id="3085925">.</span><span class="ident" id="3085926">base</span><span class="op" id="3085930">.</span><span class="ident" id="3085931">Kind</span><span class="op" id="3085935">(</span><span class="op" id="3085936">)</span>&nbsp;<span class="op" id="3085938">==</span>&nbsp;<span class="ident" id="3085941">reflect</span><span class="op" id="3085948">.</span><span class="ident" id="3085949">Interface</span>&nbsp;<span class="op" id="3085959">&amp;&amp;</span>&nbsp;<span class="ident" id="3085962">remoteId</span>&nbsp;<span class="op" id="3085971">!=</span>&nbsp;<span class="ident" id="3085974">tInterface</span>&nbsp;<span class="op" id="3085985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085990">return</span>&nbsp;<span class="ident" id="3085997">nil</span><span class="op" id="3086000">,</span>&nbsp;<span class="ident" id="3086002">errors</span><span class="op" id="3086008">.</span><span class="ident" id="3086009">New</span><span class="op" id="3086012">(</span><span class="string" id="3086013">&#34;gob:&nbsp;local&nbsp;interface&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3086042">+</span>&nbsp;<span class="ident" id="3086044">name</span>&nbsp;<span class="op" id="3086049">+</span>&nbsp;<span class="string" id="3086051">&#34;&nbsp;can&nbsp;only&nbsp;be&nbsp;decoded&nbsp;from&nbsp;remote&nbsp;interface&nbsp;type;&nbsp;received&nbsp;concrete&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3086126">+</span>&nbsp;<span class="ident" id="3086128">remoteType</span><span class="op" id="3086138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3086142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3086146">return</span>&nbsp;<span class="ident" id="3086153">nil</span><span class="op" id="3086156">,</span>&nbsp;<span class="ident" id="3086158">errors</span><span class="op" id="3086164">.</span><span class="ident" id="3086165">New</span><span class="op" id="3086168">(</span><span class="string" id="3086169">&#34;gob:&nbsp;decoding&nbsp;into&nbsp;local&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3086202">+</span>&nbsp;<span class="ident" id="3086204">name</span>&nbsp;<span class="op" id="3086209">+</span>&nbsp;<span class="string" id="3086211">&#34;,&nbsp;received&nbsp;remote&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3086237">+</span>&nbsp;<span class="ident" id="3086239">remoteType</span><span class="op" id="3086249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3086252">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086255">op</span>&nbsp;<span class="op" id="3086258">:=</span>&nbsp;<span class="ident" id="3086261">dec</span><span class="op" id="3086264">.</span><span class="ident" id="3086265">decOpFor</span><span class="op" id="3086273">(</span><span class="ident" id="3086274">remoteId</span><span class="op" id="3086282">,</span>&nbsp;<span class="ident" id="3086284">rt</span><span class="op" id="3086286">,</span>&nbsp;<span class="ident" id="3086288">name</span><span class="op" id="3086292">,</span>&nbsp;<span class="builtinfunc" id="3086294">make</span><span class="op" id="3086298">(</span><span class="keyword" id="3086299">map</span><span class="op" id="3086302">[</span><span class="ident" id="3086303">reflect</span><span class="op" id="3086310">.</span><span class="ident" id="3086311">Type</span><span class="op" id="3086315">]</span><span class="op" id="3086316">*</span><span class="ident" id="3086317">decOp</span><span class="op" id="3086322">)</span><span class="op" id="3086323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086326">ovfl</span>&nbsp;<span class="op" id="3086331">:=</span>&nbsp;<span class="ident" id="3086334">errors</span><span class="op" id="3086340">.</span><span class="ident" id="3086341">New</span><span class="op" id="3086344">(</span><span class="string" id="3086345">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="3086359">+</span>&nbsp;<span class="ident" id="3086361">name</span>&nbsp;<span class="op" id="3086366">+</span>&nbsp;<span class="string" id="3086368">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="3086384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086387">engine</span><span class="op" id="3086393">.</span><span class="ident" id="3086394">instr</span><span class="op" id="3086399">[</span><span class="ident" id="3086400">singletonField</span><span class="op" id="3086414">]</span>&nbsp;<span class="op" id="3086416">=</span>&nbsp;<span class="ident" id="3086418">decInstr</span><span class="op" id="3086426">{</span><span class="op" id="3086427">*</span><span class="ident" id="3086428">op</span><span class="op" id="3086430">,</span>&nbsp;<span class="ident" id="3086432">singletonField</span><span class="op" id="3086446">,</span>&nbsp;<span class="ident" id="3086448">nil</span><span class="op" id="3086451">,</span>&nbsp;<span class="ident" id="3086453">ovfl</span><span class="op" id="3086457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086460">engine</span><span class="op" id="3086466">.</span><span class="ident" id="3086467">numInstr</span>&nbsp;<span class="op" id="3086476">=</span>&nbsp;<span class="num" id="3086478">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3086481">return</span><br>
<span class="lineno">1030</span><span class="op" id="3086488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3086491">//&nbsp;compileIgnoreSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value&nbsp;that&nbsp;will&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="3086599">func</span>&nbsp;<span class="op" id="3086604">(</span><span class="ident" id="3086605">dec</span>&nbsp;<span class="op" id="3086609">*</span><span class="ident" id="3086610">Decoder</span><span class="op" id="3086617">)</span>&nbsp;<span class="ident" id="3086619">compileIgnoreSingle</span><span class="op" id="3086638">(</span><span class="ident" id="3086639">remoteId</span>&nbsp;<span class="ident" id="3086648">typeId</span><span class="op" id="3086654">)</span>&nbsp;<span class="op" id="3086656">(</span><span class="ident" id="3086657">engine</span>&nbsp;<span class="op" id="3086664">*</span><span class="ident" id="3086665">decEngine</span><span class="op" id="3086674">,</span>&nbsp;<span class="ident" id="3086676">err</span>&nbsp;<span class="builtintype" id="3086680">error</span><span class="op" id="3086685">)</span>&nbsp;<span class="op" id="3086687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086690">engine</span>&nbsp;<span class="op" id="3086697">=</span>&nbsp;<span class="builtinfunc" id="3086699">new</span><span class="op" id="3086702">(</span><span class="ident" id="3086703">decEngine</span><span class="op" id="3086712">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086715">engine</span><span class="op" id="3086721">.</span><span class="ident" id="3086722">instr</span>&nbsp;<span class="op" id="3086728">=</span>&nbsp;<span class="builtinfunc" id="3086730">make</span><span class="op" id="3086734">(</span><span class="op" id="3086735">[</span><span class="op" id="3086736">]</span><span class="ident" id="3086737">decInstr</span><span class="op" id="3086745">,</span>&nbsp;<span class="num" id="3086747">1</span><span class="op" id="3086748">)</span>&nbsp;<span class="comment" id="3086750">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086763">op</span>&nbsp;<span class="op" id="3086766">:=</span>&nbsp;<span class="ident" id="3086769">dec</span><span class="op" id="3086772">.</span><span class="ident" id="3086773">decIgnoreOpFor</span><span class="op" id="3086787">(</span><span class="ident" id="3086788">remoteId</span><span class="op" id="3086796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086799">ovfl</span>&nbsp;<span class="op" id="3086804">:=</span>&nbsp;<span class="ident" id="3086807">overflow</span><span class="op" id="3086815">(</span><span class="ident" id="3086816">dec</span><span class="op" id="3086819">.</span><span class="ident" id="3086820">typeString</span><span class="op" id="3086830">(</span><span class="ident" id="3086831">remoteId</span><span class="op" id="3086839">)</span><span class="op" id="3086840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086843">engine</span><span class="op" id="3086849">.</span><span class="ident" id="3086850">instr</span><span class="op" id="3086855">[</span><span class="num" id="3086856">0</span><span class="op" id="3086857">]</span>&nbsp;<span class="op" id="3086859">=</span>&nbsp;<span class="ident" id="3086861">decInstr</span><span class="op" id="3086869">{</span><span class="ident" id="3086870">op</span><span class="op" id="3086872">,</span>&nbsp;<span class="num" id="3086874">0</span><span class="op" id="3086875">,</span>&nbsp;<span class="ident" id="3086877">nil</span><span class="op" id="3086880">,</span>&nbsp;<span class="ident" id="3086882">ovfl</span><span class="op" id="3086886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086889">engine</span><span class="op" id="3086895">.</span><span class="ident" id="3086896">numInstr</span>&nbsp;<span class="op" id="3086905">=</span>&nbsp;<span class="num" id="3086907">1</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3086910">return</span><br>
<span class="lineno"></span><span class="op" id="3086917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3086920">//&nbsp;compileDec&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;value.&nbsp;&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;a&nbsp;struct,</span><br>
<span class="lineno"></span><span class="comment" id="3087006">//&nbsp;it&nbsp;calls&nbsp;out&nbsp;to&nbsp;compileSingle.</span><br>
<span class="lineno">1045</span><span class="keyword" id="3087040">func</span>&nbsp;<span class="op" id="3087045">(</span><span class="ident" id="3087046">dec</span>&nbsp;<span class="op" id="3087050">*</span><span class="ident" id="3087051">Decoder</span><span class="op" id="3087058">)</span>&nbsp;<span class="ident" id="3087060">compileDec</span><span class="op" id="3087070">(</span><span class="ident" id="3087071">remoteId</span>&nbsp;<span class="ident" id="3087080">typeId</span><span class="op" id="3087086">,</span>&nbsp;<span class="ident" id="3087088">ut</span>&nbsp;<span class="op" id="3087091">*</span><span class="ident" id="3087092">userTypeInfo</span><span class="op" id="3087104">)</span>&nbsp;<span class="op" id="3087106">(</span><span class="ident" id="3087107">engine</span>&nbsp;<span class="op" id="3087114">*</span><span class="ident" id="3087115">decEngine</span><span class="op" id="3087124">,</span>&nbsp;<span class="ident" id="3087126">err</span>&nbsp;<span class="builtintype" id="3087130">error</span><span class="op" id="3087135">)</span>&nbsp;<span class="op" id="3087137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087140">rt</span>&nbsp;<span class="op" id="3087143">:=</span>&nbsp;<span class="ident" id="3087146">ut</span><span class="op" id="3087148">.</span><span class="ident" id="3087149">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087155">srt</span>&nbsp;<span class="op" id="3087159">:=</span>&nbsp;<span class="ident" id="3087162">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087166">if</span>&nbsp;<span class="ident" id="3087169">srt</span><span class="op" id="3087172">.</span><span class="ident" id="3087173">Kind</span><span class="op" id="3087177">(</span><span class="op" id="3087178">)</span>&nbsp;<span class="op" id="3087180">!=</span>&nbsp;<span class="ident" id="3087183">reflect</span><span class="op" id="3087190">.</span><span class="ident" id="3087191">Struct</span>&nbsp;<span class="op" id="3087198">||</span>&nbsp;<span class="ident" id="3087201">ut</span><span class="op" id="3087203">.</span><span class="ident" id="3087204">externalDec</span>&nbsp;<span class="op" id="3087216">!=</span>&nbsp;<span class="num" id="3087219">0</span>&nbsp;<span class="op" id="3087221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087225">return</span>&nbsp;<span class="ident" id="3087232">dec</span><span class="op" id="3087235">.</span><span class="ident" id="3087236">compileSingle</span><span class="op" id="3087249">(</span><span class="ident" id="3087250">remoteId</span><span class="op" id="3087258">,</span>&nbsp;<span class="ident" id="3087260">ut</span><span class="op" id="3087262">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087268">var</span>&nbsp;<span class="ident" id="3087272">wireStruct</span>&nbsp;<span class="op" id="3087283">*</span><span class="ident" id="3087284">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3087296">//&nbsp;Builtin&nbsp;types&nbsp;can&nbsp;come&nbsp;from&nbsp;global&nbsp;pool;&nbsp;the&nbsp;rest&nbsp;must&nbsp;be&nbsp;defined&nbsp;by&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3087382">//&nbsp;Also&nbsp;we&nbsp;know&nbsp;we&#39;re&nbsp;decoding&nbsp;a&nbsp;struct&nbsp;now,&nbsp;so&nbsp;the&nbsp;client&nbsp;must&nbsp;have&nbsp;sent&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087462">if</span>&nbsp;<span class="ident" id="3087465">t</span><span class="op" id="3087466">,</span>&nbsp;<span class="ident" id="3087468">ok</span>&nbsp;<span class="op" id="3087471">:=</span>&nbsp;<span class="ident" id="3087474">builtinIdToType</span><span class="op" id="3087489">[</span><span class="ident" id="3087490">remoteId</span><span class="op" id="3087498">]</span><span class="op" id="3087499">;</span>&nbsp;<span class="ident" id="3087501">ok</span>&nbsp;<span class="op" id="3087504">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087508">wireStruct</span><span class="op" id="3087518">,</span>&nbsp;<span class="ident" id="3087520">_</span>&nbsp;<span class="op" id="3087522">=</span>&nbsp;<span class="ident" id="3087524">t</span><span class="op" id="3087525">.</span><span class="op" id="3087526">(</span><span class="op" id="3087527">*</span><span class="ident" id="3087528">structType</span><span class="op" id="3087538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087541">}</span>&nbsp;<span class="keyword" id="3087543">else</span>&nbsp;<span class="op" id="3087548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087552">wire</span>&nbsp;<span class="op" id="3087557">:=</span>&nbsp;<span class="ident" id="3087560">dec</span><span class="op" id="3087563">.</span><span class="ident" id="3087564">wireType</span><span class="op" id="3087572">[</span><span class="ident" id="3087573">remoteId</span><span class="op" id="3087581">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087585">if</span>&nbsp;<span class="ident" id="3087588">wire</span>&nbsp;<span class="op" id="3087593">==</span>&nbsp;<span class="ident" id="3087596">nil</span>&nbsp;<span class="op" id="3087600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087605">error_</span><span class="op" id="3087611">(</span><span class="ident" id="3087612">errBadType</span><span class="op" id="3087622">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087630">wireStruct</span>&nbsp;<span class="op" id="3087641">=</span>&nbsp;<span class="ident" id="3087643">wire</span><span class="op" id="3087647">.</span><span class="ident" id="3087648">StructT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087660">if</span>&nbsp;<span class="ident" id="3087663">wireStruct</span>&nbsp;<span class="op" id="3087674">==</span>&nbsp;<span class="ident" id="3087677">nil</span>&nbsp;<span class="op" id="3087681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087685">errorf</span><span class="op" id="3087691">(</span><span class="string" id="3087692">&#34;type&nbsp;mismatch&nbsp;in&nbsp;decoder:&nbsp;want&nbsp;struct&nbsp;type&nbsp;%s;&nbsp;got&nbsp;non-struct&#34;</span><span class="op" id="3087755">,</span>&nbsp;<span class="ident" id="3087757">rt</span><span class="op" id="3087759">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087765">engine</span>&nbsp;<span class="op" id="3087772">=</span>&nbsp;<span class="builtinfunc" id="3087774">new</span><span class="op" id="3087777">(</span><span class="ident" id="3087778">decEngine</span><span class="op" id="3087787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087790">engine</span><span class="op" id="3087796">.</span><span class="ident" id="3087797">instr</span>&nbsp;<span class="op" id="3087803">=</span>&nbsp;<span class="builtinfunc" id="3087805">make</span><span class="op" id="3087809">(</span><span class="op" id="3087810">[</span><span class="op" id="3087811">]</span><span class="ident" id="3087812">decInstr</span><span class="op" id="3087820">,</span>&nbsp;<span class="builtinfunc" id="3087822">len</span><span class="op" id="3087825">(</span><span class="ident" id="3087826">wireStruct</span><span class="op" id="3087836">.</span><span class="ident" id="3087837">Field</span><span class="op" id="3087842">)</span><span class="op" id="3087843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087846">seen</span>&nbsp;<span class="op" id="3087851">:=</span>&nbsp;<span class="builtinfunc" id="3087854">make</span><span class="op" id="3087858">(</span><span class="keyword" id="3087859">map</span><span class="op" id="3087862">[</span><span class="ident" id="3087863">reflect</span><span class="op" id="3087870">.</span><span class="ident" id="3087871">Type</span><span class="op" id="3087875">]</span><span class="op" id="3087876">*</span><span class="ident" id="3087877">decOp</span><span class="op" id="3087882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3087885">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;wire&nbsp;type.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087928">for</span>&nbsp;<span class="ident" id="3087932">fieldnum</span>&nbsp;<span class="op" id="3087941">:=</span>&nbsp;<span class="num" id="3087944">0</span><span class="op" id="3087945">;</span>&nbsp;<span class="ident" id="3087947">fieldnum</span>&nbsp;<span class="op" id="3087956">&lt;</span>&nbsp;<span class="builtinfunc" id="3087958">len</span><span class="op" id="3087961">(</span><span class="ident" id="3087962">wireStruct</span><span class="op" id="3087972">.</span><span class="ident" id="3087973">Field</span><span class="op" id="3087978">)</span><span class="op" id="3087979">;</span>&nbsp;<span class="ident" id="3087981">fieldnum</span><span class="op" id="3087989">++</span>&nbsp;<span class="op" id="3087992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087996">wireField</span>&nbsp;<span class="op" id="3088006">:=</span>&nbsp;<span class="ident" id="3088009">wireStruct</span><span class="op" id="3088019">.</span><span class="ident" id="3088020">Field</span><span class="op" id="3088025">[</span><span class="ident" id="3088026">fieldnum</span><span class="op" id="3088034">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3088038">if</span>&nbsp;<span class="ident" id="3088041">wireField</span><span class="op" id="3088050">.</span><span class="ident" id="3088051">Name</span>&nbsp;<span class="op" id="3088056">==</span>&nbsp;<span class="string" id="3088059">&#34;&#34;</span>&nbsp;<span class="op" id="3088062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088067">errorf</span><span class="op" id="3088073">(</span><span class="string" id="3088074">&#34;empty&nbsp;name&nbsp;for&nbsp;remote&nbsp;field&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="3088114">,</span>&nbsp;<span class="ident" id="3088116">wireStruct</span><span class="op" id="3088126">.</span><span class="ident" id="3088127">Name</span><span class="op" id="3088131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3088135">}</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088139">ovfl</span>&nbsp;<span class="op" id="3088144">:=</span>&nbsp;<span class="ident" id="3088147">overflow</span><span class="op" id="3088155">(</span><span class="ident" id="3088156">wireField</span><span class="op" id="3088165">.</span><span class="ident" id="3088166">Name</span><span class="op" id="3088170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3088174">//&nbsp;Find&nbsp;the&nbsp;field&nbsp;of&nbsp;the&nbsp;local&nbsp;type&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088232">localField</span><span class="op" id="3088242">,</span>&nbsp;<span class="ident" id="3088244">present</span>&nbsp;<span class="op" id="3088252">:=</span>&nbsp;<span class="ident" id="3088255">srt</span><span class="op" id="3088258">.</span><span class="ident" id="3088259">FieldByName</span><span class="op" id="3088270">(</span><span class="ident" id="3088271">wireField</span><span class="op" id="3088280">.</span><span class="ident" id="3088281">Name</span><span class="op" id="3088285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3088289">//&nbsp;TODO(r):&nbsp;anonymous&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3088319">if</span>&nbsp;<span class="op" id="3088322">!</span><span class="ident" id="3088323">present</span>&nbsp;<span class="op" id="3088331">||</span>&nbsp;<span class="op" id="3088334">!</span><span class="ident" id="3088335">isExported</span><span class="op" id="3088345">(</span><span class="ident" id="3088346">wireField</span><span class="op" id="3088355">.</span><span class="ident" id="3088356">Name</span><span class="op" id="3088360">)</span>&nbsp;<span class="op" id="3088362">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088367">op</span>&nbsp;<span class="op" id="3088370">:=</span>&nbsp;<span class="ident" id="3088373">dec</span><span class="op" id="3088376">.</span><span class="ident" id="3088377">decIgnoreOpFor</span><span class="op" id="3088391">(</span><span class="ident" id="3088392">wireField</span><span class="op" id="3088401">.</span><span class="ident" id="3088402">Id</span><span class="op" id="3088404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088409">engine</span><span class="op" id="3088415">.</span><span class="ident" id="3088416">instr</span><span class="op" id="3088421">[</span><span class="ident" id="3088422">fieldnum</span><span class="op" id="3088430">]</span>&nbsp;<span class="op" id="3088432">=</span>&nbsp;<span class="ident" id="3088434">decInstr</span><span class="op" id="3088442">{</span><span class="ident" id="3088443">op</span><span class="op" id="3088445">,</span>&nbsp;<span class="ident" id="3088447">fieldnum</span><span class="op" id="3088455">,</span>&nbsp;<span class="ident" id="3088457">nil</span><span class="op" id="3088460">,</span>&nbsp;<span class="ident" id="3088462">ovfl</span><span class="op" id="3088466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3088471">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3088482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3088486">if</span>&nbsp;<span class="op" id="3088489">!</span><span class="ident" id="3088490">dec</span><span class="op" id="3088493">.</span><span class="ident" id="3088494">compatibleType</span><span class="op" id="3088508">(</span><span class="ident" id="3088509">localField</span><span class="op" id="3088519">.</span><span class="ident" id="3088520">Type</span><span class="op" id="3088524">,</span>&nbsp;<span class="ident" id="3088526">wireField</span><span class="op" id="3088535">.</span><span class="ident" id="3088536">Id</span><span class="op" id="3088538">,</span>&nbsp;<span class="builtinfunc" id="3088540">make</span><span class="op" id="3088544">(</span><span class="keyword" id="3088545">map</span><span class="op" id="3088548">[</span><span class="ident" id="3088549">reflect</span><span class="op" id="3088556">.</span><span class="ident" id="3088557">Type</span><span class="op" id="3088561">]</span><span class="ident" id="3088562">typeId</span><span class="op" id="3088568">)</span><span class="op" id="3088569">)</span>&nbsp;<span class="op" id="3088571">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088576">errorf</span><span class="op" id="3088582">(</span><span class="string" id="3088583">&#34;wrong&nbsp;type&nbsp;(%s)&nbsp;for&nbsp;received&nbsp;field&nbsp;%s.%s&#34;</span><span class="op" id="3088625">,</span>&nbsp;<span class="ident" id="3088627">localField</span><span class="op" id="3088637">.</span><span class="ident" id="3088638">Type</span><span class="op" id="3088642">,</span>&nbsp;<span class="ident" id="3088644">wireStruct</span><span class="op" id="3088654">.</span><span class="ident" id="3088655">Name</span><span class="op" id="3088659">,</span>&nbsp;<span class="ident" id="3088661">wireField</span><span class="op" id="3088670">.</span><span class="ident" id="3088671">Name</span><span class="op" id="3088675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3088679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088683">op</span>&nbsp;<span class="op" id="3088686">:=</span>&nbsp;<span class="ident" id="3088689">dec</span><span class="op" id="3088692">.</span><span class="ident" id="3088693">decOpFor</span><span class="op" id="3088701">(</span><span class="ident" id="3088702">wireField</span><span class="op" id="3088711">.</span><span class="ident" id="3088712">Id</span><span class="op" id="3088714">,</span>&nbsp;<span class="ident" id="3088716">localField</span><span class="op" id="3088726">.</span><span class="ident" id="3088727">Type</span><span class="op" id="3088731">,</span>&nbsp;<span class="ident" id="3088733">localField</span><span class="op" id="3088743">.</span><span class="ident" id="3088744">Name</span><span class="op" id="3088748">,</span>&nbsp;<span class="ident" id="3088750">seen</span><span class="op" id="3088754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088758">engine</span><span class="op" id="3088764">.</span><span class="ident" id="3088765">instr</span><span class="op" id="3088770">[</span><span class="ident" id="3088771">fieldnum</span><span class="op" id="3088779">]</span>&nbsp;<span class="op" id="3088781">=</span>&nbsp;<span class="ident" id="3088783">decInstr</span><span class="op" id="3088791">{</span><span class="op" id="3088792">*</span><span class="ident" id="3088793">op</span><span class="op" id="3088795">,</span>&nbsp;<span class="ident" id="3088797">fieldnum</span><span class="op" id="3088805">,</span>&nbsp;<span class="ident" id="3088807">localField</span><span class="op" id="3088817">.</span><span class="ident" id="3088818">Index</span><span class="op" id="3088823">,</span>&nbsp;<span class="ident" id="3088825">ovfl</span><span class="op" id="3088829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088833">engine</span><span class="op" id="3088839">.</span><span class="ident" id="3088840">numInstr</span><span class="op" id="3088848">++</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3088852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3088855">return</span><br>
<span class="lineno"></span><span class="op" id="3088862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3088865">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type.</span><br>
<span class="lineno">1095</span><span class="keyword" id="3088927">func</span>&nbsp;<span class="op" id="3088932">(</span><span class="ident" id="3088933">dec</span>&nbsp;<span class="op" id="3088937">*</span><span class="ident" id="3088938">Decoder</span><span class="op" id="3088945">)</span>&nbsp;<span class="ident" id="3088947">getDecEnginePtr</span><span class="op" id="3088962">(</span><span class="ident" id="3088963">remoteId</span>&nbsp;<span class="ident" id="3088972">typeId</span><span class="op" id="3088978">,</span>&nbsp;<span class="ident" id="3088980">ut</span>&nbsp;<span class="op" id="3088983">*</span><span class="ident" id="3088984">userTypeInfo</span><span class="op" id="3088996">)</span>&nbsp;<span class="op" id="3088998">(</span><span class="ident" id="3088999">enginePtr</span>&nbsp;<span class="op" id="3089009">*</span><span class="op" id="3089010">*</span><span class="ident" id="3089011">decEngine</span><span class="op" id="3089020">,</span>&nbsp;<span class="ident" id="3089022">err</span>&nbsp;<span class="builtintype" id="3089026">error</span><span class="op" id="3089031">)</span>&nbsp;<span class="op" id="3089033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089036">rt</span>&nbsp;<span class="op" id="3089039">:=</span>&nbsp;<span class="ident" id="3089042">ut</span><span class="op" id="3089044">.</span><span class="ident" id="3089045">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089051">decoderMap</span><span class="op" id="3089061">,</span>&nbsp;<span class="ident" id="3089063">ok</span>&nbsp;<span class="op" id="3089066">:=</span>&nbsp;<span class="ident" id="3089069">dec</span><span class="op" id="3089072">.</span><span class="ident" id="3089073">decoderCache</span><span class="op" id="3089085">[</span><span class="ident" id="3089086">rt</span><span class="op" id="3089088">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089091">if</span>&nbsp;<span class="op" id="3089094">!</span><span class="ident" id="3089095">ok</span>&nbsp;<span class="op" id="3089098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089102">decoderMap</span>&nbsp;<span class="op" id="3089113">=</span>&nbsp;<span class="builtinfunc" id="3089115">make</span><span class="op" id="3089119">(</span><span class="keyword" id="3089120">map</span><span class="op" id="3089123">[</span><span class="ident" id="3089124">typeId</span><span class="op" id="3089130">]</span><span class="op" id="3089131">*</span><span class="op" id="3089132">*</span><span class="ident" id="3089133">decEngine</span><span class="op" id="3089142">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089146">dec</span><span class="op" id="3089149">.</span><span class="ident" id="3089150">decoderCache</span><span class="op" id="3089162">[</span><span class="ident" id="3089163">rt</span><span class="op" id="3089165">]</span>&nbsp;<span class="op" id="3089167">=</span>&nbsp;<span class="ident" id="3089169">decoderMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3089181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089184">if</span>&nbsp;<span class="ident" id="3089187">enginePtr</span><span class="op" id="3089196">,</span>&nbsp;<span class="ident" id="3089198">ok</span>&nbsp;<span class="op" id="3089201">=</span>&nbsp;<span class="ident" id="3089203">decoderMap</span><span class="op" id="3089213">[</span><span class="ident" id="3089214">remoteId</span><span class="op" id="3089222">]</span><span class="op" id="3089223">;</span>&nbsp;<span class="op" id="3089225">!</span><span class="ident" id="3089226">ok</span>&nbsp;<span class="op" id="3089229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3089233">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089312">enginePtr</span>&nbsp;<span class="op" id="3089322">=</span>&nbsp;<span class="builtinfunc" id="3089324">new</span><span class="op" id="3089327">(</span><span class="op" id="3089328">*</span><span class="ident" id="3089329">decEngine</span><span class="op" id="3089338">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089342">decoderMap</span><span class="op" id="3089352">[</span><span class="ident" id="3089353">remoteId</span><span class="op" id="3089361">]</span>&nbsp;<span class="op" id="3089363">=</span>&nbsp;<span class="ident" id="3089365">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3089377">*</span><span class="ident" id="3089378">enginePtr</span><span class="op" id="3089387">,</span>&nbsp;<span class="ident" id="3089389">err</span>&nbsp;<span class="op" id="3089393">=</span>&nbsp;<span class="ident" id="3089395">dec</span><span class="op" id="3089398">.</span><span class="ident" id="3089399">compileDec</span><span class="op" id="3089409">(</span><span class="ident" id="3089410">remoteId</span><span class="op" id="3089418">,</span>&nbsp;<span class="ident" id="3089420">ut</span><span class="op" id="3089422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089426">if</span>&nbsp;<span class="ident" id="3089429">err</span>&nbsp;<span class="op" id="3089433">!=</span>&nbsp;<span class="ident" id="3089436">nil</span>&nbsp;<span class="op" id="3089440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3089445">delete</span><span class="op" id="3089451">(</span><span class="ident" id="3089452">decoderMap</span><span class="op" id="3089462">,</span>&nbsp;<span class="ident" id="3089464">remoteId</span><span class="op" id="3089472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3089476">}</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3089479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089482">return</span><br>
<span class="lineno"></span><span class="op" id="3089489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3089492">//&nbsp;emptyStruct&nbsp;is&nbsp;the&nbsp;type&nbsp;we&nbsp;compile&nbsp;into&nbsp;when&nbsp;ignoring&nbsp;a&nbsp;struct&nbsp;value.</span><br>
<span class="lineno">1115</span><span class="keyword" id="3089565">type</span>&nbsp;<span class="ident" id="3089570">emptyStruct</span>&nbsp;<span class="keyword" id="3089582">struct</span><span class="op" id="3089588">{</span><span class="op" id="3089589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3089592">var</span>&nbsp;<span class="ident" id="3089596">emptyStructType</span>&nbsp;<span class="op" id="3089612">=</span>&nbsp;<span class="ident" id="3089614">reflect</span><span class="op" id="3089621">.</span><span class="ident" id="3089622">TypeOf</span><span class="op" id="3089628">(</span><span class="ident" id="3089629">emptyStruct</span><span class="op" id="3089640">{</span><span class="op" id="3089641">}</span><span class="op" id="3089642">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3089645">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type&nbsp;when&nbsp;the&nbsp;value&nbsp;is&nbsp;to&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">1120</span><span class="keyword" id="3089741">func</span>&nbsp;<span class="op" id="3089746">(</span><span class="ident" id="3089747">dec</span>&nbsp;<span class="op" id="3089751">*</span><span class="ident" id="3089752">Decoder</span><span class="op" id="3089759">)</span>&nbsp;<span class="ident" id="3089761">getIgnoreEnginePtr</span><span class="op" id="3089779">(</span><span class="ident" id="3089780">wireId</span>&nbsp;<span class="ident" id="3089787">typeId</span><span class="op" id="3089793">)</span>&nbsp;<span class="op" id="3089795">(</span><span class="ident" id="3089796">enginePtr</span>&nbsp;<span class="op" id="3089806">*</span><span class="op" id="3089807">*</span><span class="ident" id="3089808">decEngine</span><span class="op" id="3089817">,</span>&nbsp;<span class="ident" id="3089819">err</span>&nbsp;<span class="builtintype" id="3089823">error</span><span class="op" id="3089828">)</span>&nbsp;<span class="op" id="3089830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089833">var</span>&nbsp;<span class="ident" id="3089837">ok</span>&nbsp;<span class="builtintype" id="3089840">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089846">if</span>&nbsp;<span class="ident" id="3089849">enginePtr</span><span class="op" id="3089858">,</span>&nbsp;<span class="ident" id="3089860">ok</span>&nbsp;<span class="op" id="3089863">=</span>&nbsp;<span class="ident" id="3089865">dec</span><span class="op" id="3089868">.</span><span class="ident" id="3089869">ignorerCache</span><span class="op" id="3089881">[</span><span class="ident" id="3089882">wireId</span><span class="op" id="3089888">]</span><span class="op" id="3089889">;</span>&nbsp;<span class="op" id="3089891">!</span><span class="ident" id="3089892">ok</span>&nbsp;<span class="op" id="3089895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3089899">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089978">enginePtr</span>&nbsp;<span class="op" id="3089988">=</span>&nbsp;<span class="builtinfunc" id="3089990">new</span><span class="op" id="3089993">(</span><span class="op" id="3089994">*</span><span class="ident" id="3089995">decEngine</span><span class="op" id="3090004">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090008">dec</span><span class="op" id="3090011">.</span><span class="ident" id="3090012">ignorerCache</span><span class="op" id="3090024">[</span><span class="ident" id="3090025">wireId</span><span class="op" id="3090031">]</span>&nbsp;<span class="op" id="3090033">=</span>&nbsp;<span class="ident" id="3090035">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090047">wire</span>&nbsp;<span class="op" id="3090052">:=</span>&nbsp;<span class="ident" id="3090055">dec</span><span class="op" id="3090058">.</span><span class="ident" id="3090059">wireType</span><span class="op" id="3090067">[</span><span class="ident" id="3090068">wireId</span><span class="op" id="3090074">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090078">if</span>&nbsp;<span class="ident" id="3090081">wire</span>&nbsp;<span class="op" id="3090086">!=</span>&nbsp;<span class="ident" id="3090089">nil</span>&nbsp;<span class="op" id="3090093">&amp;&amp;</span>&nbsp;<span class="ident" id="3090096">wire</span><span class="op" id="3090100">.</span><span class="ident" id="3090101">StructT</span>&nbsp;<span class="op" id="3090109">!=</span>&nbsp;<span class="ident" id="3090112">nil</span>&nbsp;<span class="op" id="3090116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090121">*</span><span class="ident" id="3090122">enginePtr</span><span class="op" id="3090131">,</span>&nbsp;<span class="ident" id="3090133">err</span>&nbsp;<span class="op" id="3090137">=</span>&nbsp;<span class="ident" id="3090139">dec</span><span class="op" id="3090142">.</span><span class="ident" id="3090143">compileDec</span><span class="op" id="3090153">(</span><span class="ident" id="3090154">wireId</span><span class="op" id="3090160">,</span>&nbsp;<span class="ident" id="3090162">userType</span><span class="op" id="3090170">(</span><span class="ident" id="3090171">emptyStructType</span><span class="op" id="3090186">)</span><span class="op" id="3090187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090191">}</span>&nbsp;<span class="keyword" id="3090193">else</span>&nbsp;<span class="op" id="3090198">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090203">*</span><span class="ident" id="3090204">enginePtr</span><span class="op" id="3090213">,</span>&nbsp;<span class="ident" id="3090215">err</span>&nbsp;<span class="op" id="3090219">=</span>&nbsp;<span class="ident" id="3090221">dec</span><span class="op" id="3090224">.</span><span class="ident" id="3090225">compileIgnoreSingle</span><span class="op" id="3090244">(</span><span class="ident" id="3090245">wireId</span><span class="op" id="3090251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090259">if</span>&nbsp;<span class="ident" id="3090262">err</span>&nbsp;<span class="op" id="3090266">!=</span>&nbsp;<span class="ident" id="3090269">nil</span>&nbsp;<span class="op" id="3090273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3090278">delete</span><span class="op" id="3090284">(</span><span class="ident" id="3090285">dec</span><span class="op" id="3090288">.</span><span class="ident" id="3090289">ignorerCache</span><span class="op" id="3090301">,</span>&nbsp;<span class="ident" id="3090303">wireId</span><span class="op" id="3090309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090313">}</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090319">return</span><br>
<span class="lineno"></span><span class="op" id="3090326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3090329">//&nbsp;decodeValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">1140</span><span class="keyword" id="3090413">func</span>&nbsp;<span class="op" id="3090418">(</span><span class="ident" id="3090419">dec</span>&nbsp;<span class="op" id="3090423">*</span><span class="ident" id="3090424">Decoder</span><span class="op" id="3090431">)</span>&nbsp;<span class="ident" id="3090433">decodeValue</span><span class="op" id="3090444">(</span><span class="ident" id="3090445">wireId</span>&nbsp;<span class="ident" id="3090452">typeId</span><span class="op" id="3090458">,</span>&nbsp;<span class="ident" id="3090460">value</span>&nbsp;<span class="ident" id="3090466">reflect</span><span class="op" id="3090473">.</span><span class="ident" id="3090474">Value</span><span class="op" id="3090479">)</span>&nbsp;<span class="op" id="3090481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090484">defer</span>&nbsp;<span class="ident" id="3090490">catchError</span><span class="op" id="3090500">(</span><span class="op" id="3090501">&amp;</span><span class="ident" id="3090502">dec</span><span class="op" id="3090505">.</span><span class="ident" id="3090506">err</span><span class="op" id="3090509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3090512">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;nil,&nbsp;it&nbsp;means&nbsp;we&nbsp;should&nbsp;just&nbsp;ignore&nbsp;this&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090579">if</span>&nbsp;<span class="op" id="3090582">!</span><span class="ident" id="3090583">value</span><span class="op" id="3090588">.</span><span class="ident" id="3090589">IsValid</span><span class="op" id="3090596">(</span><span class="op" id="3090597">)</span>&nbsp;<span class="op" id="3090599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090603">dec</span><span class="op" id="3090606">.</span><span class="ident" id="3090607">decodeIgnoredValue</span><span class="op" id="3090625">(</span><span class="ident" id="3090626">wireId</span><span class="op" id="3090632">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090636">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3090647">//&nbsp;Dereference&nbsp;down&nbsp;to&nbsp;the&nbsp;underlying&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090692">ut</span>&nbsp;<span class="op" id="3090695">:=</span>&nbsp;<span class="ident" id="3090698">userType</span><span class="op" id="3090706">(</span><span class="ident" id="3090707">value</span><span class="op" id="3090712">.</span><span class="ident" id="3090713">Type</span><span class="op" id="3090717">(</span><span class="op" id="3090718">)</span><span class="op" id="3090719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090722">base</span>&nbsp;<span class="op" id="3090727">:=</span>&nbsp;<span class="ident" id="3090730">ut</span><span class="op" id="3090732">.</span><span class="ident" id="3090733">base</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090739">var</span>&nbsp;<span class="ident" id="3090743">enginePtr</span>&nbsp;<span class="op" id="3090753">*</span><span class="op" id="3090754">*</span><span class="ident" id="3090755">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090766">enginePtr</span><span class="op" id="3090775">,</span>&nbsp;<span class="ident" id="3090777">dec</span><span class="op" id="3090780">.</span><span class="ident" id="3090781">err</span>&nbsp;<span class="op" id="3090785">=</span>&nbsp;<span class="ident" id="3090787">dec</span><span class="op" id="3090790">.</span><span class="ident" id="3090791">getDecEnginePtr</span><span class="op" id="3090806">(</span><span class="ident" id="3090807">wireId</span><span class="op" id="3090813">,</span>&nbsp;<span class="ident" id="3090815">ut</span><span class="op" id="3090817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090820">if</span>&nbsp;<span class="ident" id="3090823">dec</span><span class="op" id="3090826">.</span><span class="ident" id="3090827">err</span>&nbsp;<span class="op" id="3090831">!=</span>&nbsp;<span class="ident" id="3090834">nil</span>&nbsp;<span class="op" id="3090838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090842">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090850">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090853">value</span>&nbsp;<span class="op" id="3090859">=</span>&nbsp;<span class="ident" id="3090861">decAlloc</span><span class="op" id="3090869">(</span><span class="ident" id="3090870">value</span><span class="op" id="3090875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090878">engine</span>&nbsp;<span class="op" id="3090885">:=</span>&nbsp;<span class="op" id="3090888">*</span><span class="ident" id="3090889">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090900">if</span>&nbsp;<span class="ident" id="3090903">st</span>&nbsp;<span class="op" id="3090906">:=</span>&nbsp;<span class="ident" id="3090909">base</span><span class="op" id="3090913">;</span>&nbsp;<span class="ident" id="3090915">st</span><span class="op" id="3090917">.</span><span class="ident" id="3090918">Kind</span><span class="op" id="3090922">(</span><span class="op" id="3090923">)</span>&nbsp;<span class="op" id="3090925">==</span>&nbsp;<span class="ident" id="3090928">reflect</span><span class="op" id="3090935">.</span><span class="ident" id="3090936">Struct</span>&nbsp;<span class="op" id="3090943">&amp;&amp;</span>&nbsp;<span class="ident" id="3090946">ut</span><span class="op" id="3090948">.</span><span class="ident" id="3090949">externalDec</span>&nbsp;<span class="op" id="3090961">==</span>&nbsp;<span class="num" id="3090964">0</span>&nbsp;<span class="op" id="3090966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090970">if</span>&nbsp;<span class="ident" id="3090973">engine</span><span class="op" id="3090979">.</span><span class="ident" id="3090980">numInstr</span>&nbsp;<span class="op" id="3090989">==</span>&nbsp;<span class="num" id="3090992">0</span>&nbsp;<span class="op" id="3090994">&amp;&amp;</span>&nbsp;<span class="ident" id="3090997">st</span><span class="op" id="3090999">.</span><span class="ident" id="3091000">NumField</span><span class="op" id="3091008">(</span><span class="op" id="3091009">)</span>&nbsp;<span class="op" id="3091011">&gt;</span>&nbsp;<span class="num" id="3091013">0</span>&nbsp;<span class="op" id="3091015">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091021">dec</span><span class="op" id="3091024">.</span><span class="ident" id="3091025">wireType</span><span class="op" id="3091033">[</span><span class="ident" id="3091034">wireId</span><span class="op" id="3091040">]</span>&nbsp;<span class="op" id="3091042">!=</span>&nbsp;<span class="ident" id="3091045">nil</span>&nbsp;<span class="op" id="3091049">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3091052">len</span><span class="op" id="3091055">(</span><span class="ident" id="3091056">dec</span><span class="op" id="3091059">.</span><span class="ident" id="3091060">wireType</span><span class="op" id="3091068">[</span><span class="ident" id="3091069">wireId</span><span class="op" id="3091075">]</span><span class="op" id="3091076">.</span><span class="ident" id="3091077">StructT</span><span class="op" id="3091084">.</span><span class="ident" id="3091085">Field</span><span class="op" id="3091090">)</span>&nbsp;<span class="op" id="3091092">&gt;</span>&nbsp;<span class="num" id="3091094">0</span>&nbsp;<span class="op" id="3091096">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091101">name</span>&nbsp;<span class="op" id="3091106">:=</span>&nbsp;<span class="ident" id="3091109">base</span><span class="op" id="3091113">.</span><span class="ident" id="3091114">Name</span><span class="op" id="3091118">(</span><span class="op" id="3091119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091124">errorf</span><span class="op" id="3091130">(</span><span class="string" id="3091131">&#34;type&nbsp;mismatch:&nbsp;no&nbsp;fields&nbsp;matched&nbsp;compiling&nbsp;decoder&nbsp;for&nbsp;%s&#34;</span><span class="op" id="3091190">,</span>&nbsp;<span class="ident" id="3091192">name</span><span class="op" id="3091196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091204">dec</span><span class="op" id="3091207">.</span><span class="ident" id="3091208">decodeStruct</span><span class="op" id="3091220">(</span><span class="ident" id="3091221">engine</span><span class="op" id="3091227">,</span>&nbsp;<span class="ident" id="3091229">ut</span><span class="op" id="3091231">,</span>&nbsp;<span class="ident" id="3091233">value</span><span class="op" id="3091238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091241">}</span>&nbsp;<span class="keyword" id="3091243">else</span>&nbsp;<span class="op" id="3091248">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091252">dec</span><span class="op" id="3091255">.</span><span class="ident" id="3091256">decodeSingle</span><span class="op" id="3091268">(</span><span class="ident" id="3091269">engine</span><span class="op" id="3091275">,</span>&nbsp;<span class="ident" id="3091277">ut</span><span class="op" id="3091279">,</span>&nbsp;<span class="ident" id="3091281">value</span><span class="op" id="3091286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091289">}</span><br>
<span class="lineno"></span><span class="op" id="3091291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3091294">//&nbsp;decodeIgnoredValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;and&nbsp;discards&nbsp;it.</span><br>
<span class="lineno">1170</span><span class="keyword" id="3091400">func</span>&nbsp;<span class="op" id="3091405">(</span><span class="ident" id="3091406">dec</span>&nbsp;<span class="op" id="3091410">*</span><span class="ident" id="3091411">Decoder</span><span class="op" id="3091418">)</span>&nbsp;<span class="ident" id="3091420">decodeIgnoredValue</span><span class="op" id="3091438">(</span><span class="ident" id="3091439">wireId</span>&nbsp;<span class="ident" id="3091446">typeId</span><span class="op" id="3091452">)</span>&nbsp;<span class="op" id="3091454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091457">var</span>&nbsp;<span class="ident" id="3091461">enginePtr</span>&nbsp;<span class="op" id="3091471">*</span><span class="op" id="3091472">*</span><span class="ident" id="3091473">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091484">enginePtr</span><span class="op" id="3091493">,</span>&nbsp;<span class="ident" id="3091495">dec</span><span class="op" id="3091498">.</span><span class="ident" id="3091499">err</span>&nbsp;<span class="op" id="3091503">=</span>&nbsp;<span class="ident" id="3091505">dec</span><span class="op" id="3091508">.</span><span class="ident" id="3091509">getIgnoreEnginePtr</span><span class="op" id="3091527">(</span><span class="ident" id="3091528">wireId</span><span class="op" id="3091534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091537">if</span>&nbsp;<span class="ident" id="3091540">dec</span><span class="op" id="3091543">.</span><span class="ident" id="3091544">err</span>&nbsp;<span class="op" id="3091548">!=</span>&nbsp;<span class="ident" id="3091551">nil</span>&nbsp;<span class="op" id="3091555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091559">return</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091570">wire</span>&nbsp;<span class="op" id="3091575">:=</span>&nbsp;<span class="ident" id="3091578">dec</span><span class="op" id="3091581">.</span><span class="ident" id="3091582">wireType</span><span class="op" id="3091590">[</span><span class="ident" id="3091591">wireId</span><span class="op" id="3091597">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091600">if</span>&nbsp;<span class="ident" id="3091603">wire</span>&nbsp;<span class="op" id="3091608">!=</span>&nbsp;<span class="ident" id="3091611">nil</span>&nbsp;<span class="op" id="3091615">&amp;&amp;</span>&nbsp;<span class="ident" id="3091618">wire</span><span class="op" id="3091622">.</span><span class="ident" id="3091623">StructT</span>&nbsp;<span class="op" id="3091631">!=</span>&nbsp;<span class="ident" id="3091634">nil</span>&nbsp;<span class="op" id="3091638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091642">dec</span><span class="op" id="3091645">.</span><span class="ident" id="3091646">ignoreStruct</span><span class="op" id="3091658">(</span><span class="op" id="3091659">*</span><span class="ident" id="3091660">enginePtr</span><span class="op" id="3091669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091672">}</span>&nbsp;<span class="keyword" id="3091674">else</span>&nbsp;<span class="op" id="3091679">{</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091683">dec</span><span class="op" id="3091686">.</span><span class="ident" id="3091687">ignoreSingle</span><span class="op" id="3091699">(</span><span class="op" id="3091700">*</span><span class="ident" id="3091701">enginePtr</span><span class="op" id="3091710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091713">}</span><br>
<span class="lineno"></span><span class="op" id="3091715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3091718">func</span>&nbsp;<span class="ident" id="3091723">init</span><span class="op" id="3091727">(</span><span class="op" id="3091728">)</span>&nbsp;<span class="op" id="3091730">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091733">var</span>&nbsp;<span class="ident" id="3091737">iop</span><span class="op" id="3091740">,</span>&nbsp;<span class="ident" id="3091742">uop</span>&nbsp;<span class="ident" id="3091746">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091753">switch</span>&nbsp;<span class="ident" id="3091760">reflect</span><span class="op" id="3091767">.</span><span class="ident" id="3091768">TypeOf</span><span class="op" id="3091774">(</span><span class="builtintype" id="3091775">int</span><span class="op" id="3091778">(</span><span class="num" id="3091779">0</span><span class="op" id="3091780">)</span><span class="op" id="3091781">)</span><span class="op" id="3091782">.</span><span class="ident" id="3091783">Bits</span><span class="op" id="3091787">(</span><span class="op" id="3091788">)</span>&nbsp;<span class="op" id="3091790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091793">case</span>&nbsp;<span class="num" id="3091798">32</span><span class="op" id="3091800">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091804">iop</span>&nbsp;<span class="op" id="3091808">=</span>&nbsp;<span class="ident" id="3091810">decInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091821">uop</span>&nbsp;<span class="op" id="3091825">=</span>&nbsp;<span class="ident" id="3091827">decUint32</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091838">case</span>&nbsp;<span class="num" id="3091843">64</span><span class="op" id="3091845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091849">iop</span>&nbsp;<span class="op" id="3091853">=</span>&nbsp;<span class="ident" id="3091855">decInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091866">uop</span>&nbsp;<span class="op" id="3091870">=</span>&nbsp;<span class="ident" id="3091872">decUint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091883">default</span><span class="op" id="3091890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3091894">panic</span><span class="op" id="3091899">(</span><span class="string" id="3091900">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;int/uint&#34;</span><span class="op" id="3091931">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091937">decOpTable</span><span class="op" id="3091947">[</span><span class="ident" id="3091948">reflect</span><span class="op" id="3091955">.</span><span class="ident" id="3091956">Int</span><span class="op" id="3091959">]</span>&nbsp;<span class="op" id="3091961">=</span>&nbsp;<span class="ident" id="3091963">iop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091968">decOpTable</span><span class="op" id="3091978">[</span><span class="ident" id="3091979">reflect</span><span class="op" id="3091986">.</span><span class="ident" id="3091987">Uint</span><span class="op" id="3091991">]</span>&nbsp;<span class="op" id="3091993">=</span>&nbsp;<span class="ident" id="3091995">uop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3092001">//&nbsp;Finally&nbsp;uintptr</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3092021">switch</span>&nbsp;<span class="ident" id="3092028">reflect</span><span class="op" id="3092035">.</span><span class="ident" id="3092036">TypeOf</span><span class="op" id="3092042">(</span><span class="builtintype" id="3092043">uintptr</span><span class="op" id="3092050">(</span><span class="num" id="3092051">0</span><span class="op" id="3092052">)</span><span class="op" id="3092053">)</span><span class="op" id="3092054">.</span><span class="ident" id="3092055">Bits</span><span class="op" id="3092059">(</span><span class="op" id="3092060">)</span>&nbsp;<span class="op" id="3092062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3092065">case</span>&nbsp;<span class="num" id="3092070">32</span><span class="op" id="3092072">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3092076">uop</span>&nbsp;<span class="op" id="3092080">=</span>&nbsp;<span class="ident" id="3092082">decUint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3092093">case</span>&nbsp;<span class="num" id="3092098">64</span><span class="op" id="3092100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3092104">uop</span>&nbsp;<span class="op" id="3092108">=</span>&nbsp;<span class="ident" id="3092110">decUint64</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3092121">default</span><span class="op" id="3092128">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3092132">panic</span><span class="op" id="3092137">(</span><span class="string" id="3092138">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;uintptr&#34;</span><span class="op" id="3092168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3092171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3092174">decOpTable</span><span class="op" id="3092184">[</span><span class="ident" id="3092185">reflect</span><span class="op" id="3092192">.</span><span class="ident" id="3092193">Uintptr</span><span class="op" id="3092200">]</span>&nbsp;<span class="op" id="3092202">=</span>&nbsp;<span class="ident" id="3092204">uop</span><br>
<span class="lineno"></span><span class="op" id="3092208">}</span><br>
<span class="lineno">1210</span><br>
<span class="lineno"></span><span class="comment" id="3092211">//&nbsp;Gob&nbsp;depends&nbsp;on&nbsp;being&nbsp;able&nbsp;to&nbsp;take&nbsp;the&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3092260">//&nbsp;of&nbsp;zeroed&nbsp;Values&nbsp;it&nbsp;creates,&nbsp;so&nbsp;use&nbsp;this&nbsp;wrapper&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="3092320">//&nbsp;of&nbsp;the&nbsp;standard&nbsp;reflect.Zero.</span><br>
<span class="lineno"></span><span class="comment" id="3092353">//&nbsp;Each&nbsp;call&nbsp;allocates&nbsp;once.</span><br>
<span class="lineno">1215</span><span class="keyword" id="3092382">func</span>&nbsp;<span class="ident" id="3092387">allocValue</span><span class="op" id="3092397">(</span><span class="ident" id="3092398">t</span>&nbsp;<span class="ident" id="3092400">reflect</span><span class="op" id="3092407">.</span><span class="ident" id="3092408">Type</span><span class="op" id="3092412">)</span>&nbsp;<span class="ident" id="3092414">reflect</span><span class="op" id="3092421">.</span><span class="ident" id="3092422">Value</span>&nbsp;<span class="op" id="3092428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3092431">return</span>&nbsp;<span class="ident" id="3092438">reflect</span><span class="op" id="3092445">.</span><span class="ident" id="3092446">New</span><span class="op" id="3092449">(</span><span class="ident" id="3092450">t</span><span class="op" id="3092451">)</span><span class="op" id="3092452">.</span><span class="ident" id="3092453">Elem</span><span class="op" id="3092457">(</span><span class="op" id="3092458">)</span><br>
<span class="lineno"></span><span class="op" id="3092460">}</span>
</div>
</body>
</html>
