<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8335406">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8335461">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8335515">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8335566">package</span>&nbsp;<span class="ident" id="8335574">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8335582">import</span>&nbsp;<span class="op" id="8335589">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8335592">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8335603">&#34;testing/quick&#34;</span><br>
<span class="lineno">10</span><span class="op" id="8335619">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8335622">type</span>&nbsp;<span class="ident" id="8335627">TestConstantTimeCompareStruct</span>&nbsp;<span class="keyword" id="8335657">struct</span>&nbsp;<span class="op" id="8335664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335667">a</span><span class="op" id="8335668">,</span>&nbsp;<span class="ident" id="8335670">b</span>&nbsp;<span class="op" id="8335672">[</span><span class="op" id="8335673">]</span><span class="builtintype" id="8335674">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335680">out</span>&nbsp;&nbsp;<span class="builtintype" id="8335685">int</span><br>
<span class="lineno">15</span><span class="op" id="8335689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8335692">var</span>&nbsp;<span class="ident" id="8335696">testConstantTimeCompareData</span>&nbsp;<span class="op" id="8335724">=</span>&nbsp;<span class="op" id="8335726">[</span><span class="op" id="8335727">]</span><span class="ident" id="8335728">TestConstantTimeCompareStruct</span><span class="op" id="8335757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335760">{</span><span class="op" id="8335761">[</span><span class="op" id="8335762">]</span><span class="builtintype" id="8335763">byte</span><span class="op" id="8335767">{</span><span class="op" id="8335768">}</span><span class="op" id="8335769">,</span>&nbsp;<span class="op" id="8335771">[</span><span class="op" id="8335772">]</span><span class="builtintype" id="8335773">byte</span><span class="op" id="8335777">{</span><span class="op" id="8335778">}</span><span class="op" id="8335779">,</span>&nbsp;<span class="num" id="8335781">1</span><span class="op" id="8335782">}</span><span class="op" id="8335783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335786">{</span><span class="op" id="8335787">[</span><span class="op" id="8335788">]</span><span class="builtintype" id="8335789">byte</span><span class="op" id="8335793">{</span><span class="num" id="8335794">0x11</span><span class="op" id="8335798">}</span><span class="op" id="8335799">,</span>&nbsp;<span class="op" id="8335801">[</span><span class="op" id="8335802">]</span><span class="builtintype" id="8335803">byte</span><span class="op" id="8335807">{</span><span class="num" id="8335808">0x11</span><span class="op" id="8335812">}</span><span class="op" id="8335813">,</span>&nbsp;<span class="num" id="8335815">1</span><span class="op" id="8335816">}</span><span class="op" id="8335817">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335820">{</span><span class="op" id="8335821">[</span><span class="op" id="8335822">]</span><span class="builtintype" id="8335823">byte</span><span class="op" id="8335827">{</span><span class="num" id="8335828">0x12</span><span class="op" id="8335832">}</span><span class="op" id="8335833">,</span>&nbsp;<span class="op" id="8335835">[</span><span class="op" id="8335836">]</span><span class="builtintype" id="8335837">byte</span><span class="op" id="8335841">{</span><span class="num" id="8335842">0x11</span><span class="op" id="8335846">}</span><span class="op" id="8335847">,</span>&nbsp;<span class="num" id="8335849">0</span><span class="op" id="8335850">}</span><span class="op" id="8335851">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335854">{</span><span class="op" id="8335855">[</span><span class="op" id="8335856">]</span><span class="builtintype" id="8335857">byte</span><span class="op" id="8335861">{</span><span class="num" id="8335862">0x11</span><span class="op" id="8335866">}</span><span class="op" id="8335867">,</span>&nbsp;<span class="op" id="8335869">[</span><span class="op" id="8335870">]</span><span class="builtintype" id="8335871">byte</span><span class="op" id="8335875">{</span><span class="num" id="8335876">0x11</span><span class="op" id="8335880">,</span>&nbsp;<span class="num" id="8335882">0x12</span><span class="op" id="8335886">}</span><span class="op" id="8335887">,</span>&nbsp;<span class="num" id="8335889">0</span><span class="op" id="8335890">}</span><span class="op" id="8335891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335894">{</span><span class="op" id="8335895">[</span><span class="op" id="8335896">]</span><span class="builtintype" id="8335897">byte</span><span class="op" id="8335901">{</span><span class="num" id="8335902">0x11</span><span class="op" id="8335906">,</span>&nbsp;<span class="num" id="8335908">0x12</span><span class="op" id="8335912">}</span><span class="op" id="8335913">,</span>&nbsp;<span class="op" id="8335915">[</span><span class="op" id="8335916">]</span><span class="builtintype" id="8335917">byte</span><span class="op" id="8335921">{</span><span class="num" id="8335922">0x11</span><span class="op" id="8335926">}</span><span class="op" id="8335927">,</span>&nbsp;<span class="num" id="8335929">0</span><span class="op" id="8335930">}</span><span class="op" id="8335931">,</span><br>
<span class="lineno"></span><span class="op" id="8335933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8335936">func</span>&nbsp;<span class="ident" id="8335941">TestConstantTimeCompare</span><span class="op" id="8335964">(</span><span class="ident" id="8335965">t</span>&nbsp;<span class="op" id="8335967">*</span><span class="ident" id="8335968">testing</span><span class="op" id="8335975">.</span><span class="ident" id="8335976">T</span><span class="op" id="8335977">)</span>&nbsp;<span class="op" id="8335979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335982">for</span>&nbsp;<span class="ident" id="8335986">i</span><span class="op" id="8335987">,</span>&nbsp;<span class="ident" id="8335989">test</span>&nbsp;<span class="op" id="8335994">:=</span>&nbsp;<span class="keyword" id="8335997">range</span>&nbsp;<span class="ident" id="8336003">testConstantTimeCompareData</span>&nbsp;<span class="op" id="8336031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336035">if</span>&nbsp;<span class="ident" id="8336038">r</span>&nbsp;<span class="op" id="8336040">:=</span>&nbsp;<span class="ident" id="8336043">ConstantTimeCompare</span><span class="op" id="8336062">(</span><span class="ident" id="8336063">test</span><span class="op" id="8336067">.</span><span class="ident" id="8336068">a</span><span class="op" id="8336069">,</span>&nbsp;<span class="ident" id="8336071">test</span><span class="op" id="8336075">.</span><span class="ident" id="8336076">b</span><span class="op" id="8336077">)</span><span class="op" id="8336078">;</span>&nbsp;<span class="ident" id="8336080">r</span>&nbsp;<span class="op" id="8336082">!=</span>&nbsp;<span class="ident" id="8336085">test</span><span class="op" id="8336089">.</span><span class="ident" id="8336090">out</span>&nbsp;<span class="op" id="8336094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336099">t</span><span class="op" id="8336100">.</span><span class="ident" id="8336101">Errorf</span><span class="op" id="8336107">(</span><span class="string" id="8336108">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="8336142">,</span>&nbsp;<span class="ident" id="8336144">i</span><span class="op" id="8336145">,</span>&nbsp;<span class="ident" id="8336147">r</span><span class="op" id="8336148">,</span>&nbsp;<span class="ident" id="8336150">test</span><span class="op" id="8336154">.</span><span class="ident" id="8336155">out</span><span class="op" id="8336158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336162">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336165">}</span><br>
<span class="lineno"></span><span class="op" id="8336167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8336170">type</span>&nbsp;<span class="ident" id="8336175">TestConstantTimeByteEqStruct</span>&nbsp;<span class="keyword" id="8336204">struct</span>&nbsp;<span class="op" id="8336211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336214">a</span><span class="op" id="8336215">,</span>&nbsp;<span class="ident" id="8336217">b</span>&nbsp;<span class="builtintype" id="8336219">uint8</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336226">out</span>&nbsp;&nbsp;<span class="builtintype" id="8336231">int</span><br>
<span class="lineno"></span><span class="op" id="8336235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8336238">var</span>&nbsp;<span class="ident" id="8336242">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="8336269">=</span>&nbsp;<span class="op" id="8336271">[</span><span class="op" id="8336272">]</span><span class="ident" id="8336273">TestConstantTimeByteEqStruct</span><span class="op" id="8336301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336304">{</span><span class="num" id="8336305">0</span><span class="op" id="8336306">,</span>&nbsp;<span class="num" id="8336308">0</span><span class="op" id="8336309">,</span>&nbsp;<span class="num" id="8336311">1</span><span class="op" id="8336312">}</span><span class="op" id="8336313">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336316">{</span><span class="num" id="8336317">0</span><span class="op" id="8336318">,</span>&nbsp;<span class="num" id="8336320">1</span><span class="op" id="8336321">,</span>&nbsp;<span class="num" id="8336323">0</span><span class="op" id="8336324">}</span><span class="op" id="8336325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336328">{</span><span class="num" id="8336329">1</span><span class="op" id="8336330">,</span>&nbsp;<span class="num" id="8336332">0</span><span class="op" id="8336333">,</span>&nbsp;<span class="num" id="8336335">0</span><span class="op" id="8336336">}</span><span class="op" id="8336337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336340">{</span><span class="num" id="8336341">0xff</span><span class="op" id="8336345">,</span>&nbsp;<span class="num" id="8336347">0xff</span><span class="op" id="8336351">,</span>&nbsp;<span class="num" id="8336353">1</span><span class="op" id="8336354">}</span><span class="op" id="8336355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336358">{</span><span class="num" id="8336359">0xff</span><span class="op" id="8336363">,</span>&nbsp;<span class="num" id="8336365">0xfe</span><span class="op" id="8336369">,</span>&nbsp;<span class="num" id="8336371">0</span><span class="op" id="8336372">}</span><span class="op" id="8336373">,</span><br>
<span class="lineno"></span><span class="op" id="8336375">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8336378">func</span>&nbsp;<span class="ident" id="8336383">byteEq</span><span class="op" id="8336389">(</span><span class="ident" id="8336390">a</span><span class="op" id="8336391">,</span>&nbsp;<span class="ident" id="8336393">b</span>&nbsp;<span class="builtintype" id="8336395">uint8</span><span class="op" id="8336400">)</span>&nbsp;<span class="builtintype" id="8336402">int</span>&nbsp;<span class="op" id="8336406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336409">if</span>&nbsp;<span class="ident" id="8336412">a</span>&nbsp;<span class="op" id="8336414">==</span>&nbsp;<span class="ident" id="8336417">b</span>&nbsp;<span class="op" id="8336419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336423">return</span>&nbsp;<span class="num" id="8336430">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336433">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336436">return</span>&nbsp;<span class="num" id="8336443">0</span><br>
<span class="lineno"></span><span class="op" id="8336445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8336448">func</span>&nbsp;<span class="ident" id="8336453">TestConstantTimeByteEq</span><span class="op" id="8336475">(</span><span class="ident" id="8336476">t</span>&nbsp;<span class="op" id="8336478">*</span><span class="ident" id="8336479">testing</span><span class="op" id="8336486">.</span><span class="ident" id="8336487">T</span><span class="op" id="8336488">)</span>&nbsp;<span class="op" id="8336490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336493">for</span>&nbsp;<span class="ident" id="8336497">i</span><span class="op" id="8336498">,</span>&nbsp;<span class="ident" id="8336500">test</span>&nbsp;<span class="op" id="8336505">:=</span>&nbsp;<span class="keyword" id="8336508">range</span>&nbsp;<span class="ident" id="8336514">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="8336541">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336545">if</span>&nbsp;<span class="ident" id="8336548">r</span>&nbsp;<span class="op" id="8336550">:=</span>&nbsp;<span class="ident" id="8336553">ConstantTimeByteEq</span><span class="op" id="8336571">(</span><span class="ident" id="8336572">test</span><span class="op" id="8336576">.</span><span class="ident" id="8336577">a</span><span class="op" id="8336578">,</span>&nbsp;<span class="ident" id="8336580">test</span><span class="op" id="8336584">.</span><span class="ident" id="8336585">b</span><span class="op" id="8336586">)</span><span class="op" id="8336587">;</span>&nbsp;<span class="ident" id="8336589">r</span>&nbsp;<span class="op" id="8336591">!=</span>&nbsp;<span class="ident" id="8336594">test</span><span class="op" id="8336598">.</span><span class="ident" id="8336599">out</span>&nbsp;<span class="op" id="8336603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336608">t</span><span class="op" id="8336609">.</span><span class="ident" id="8336610">Errorf</span><span class="op" id="8336616">(</span><span class="string" id="8336617">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="8336651">,</span>&nbsp;<span class="ident" id="8336653">i</span><span class="op" id="8336654">,</span>&nbsp;<span class="ident" id="8336656">r</span><span class="op" id="8336657">,</span>&nbsp;<span class="ident" id="8336659">test</span><span class="op" id="8336663">.</span><span class="ident" id="8336664">out</span><span class="op" id="8336667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336677">err</span>&nbsp;<span class="op" id="8336681">:=</span>&nbsp;<span class="ident" id="8336684">quick</span><span class="op" id="8336689">.</span><span class="ident" id="8336690">CheckEqual</span><span class="op" id="8336700">(</span><span class="ident" id="8336701">ConstantTimeByteEq</span><span class="op" id="8336719">,</span>&nbsp;<span class="ident" id="8336721">byteEq</span><span class="op" id="8336727">,</span>&nbsp;<span class="ident" id="8336729">nil</span><span class="op" id="8336732">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336735">if</span>&nbsp;<span class="ident" id="8336738">err</span>&nbsp;<span class="op" id="8336742">!=</span>&nbsp;<span class="ident" id="8336745">nil</span>&nbsp;<span class="op" id="8336749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336753">t</span><span class="op" id="8336754">.</span><span class="ident" id="8336755">Error</span><span class="op" id="8336760">(</span><span class="ident" id="8336761">err</span><span class="op" id="8336764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336767">}</span><br>
<span class="lineno"></span><span class="op" id="8336769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="8336772">func</span>&nbsp;<span class="ident" id="8336777">eq</span><span class="op" id="8336779">(</span><span class="ident" id="8336780">a</span><span class="op" id="8336781">,</span>&nbsp;<span class="ident" id="8336783">b</span>&nbsp;<span class="builtintype" id="8336785">int32</span><span class="op" id="8336790">)</span>&nbsp;<span class="builtintype" id="8336792">int</span>&nbsp;<span class="op" id="8336796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336799">if</span>&nbsp;<span class="ident" id="8336802">a</span>&nbsp;<span class="op" id="8336804">==</span>&nbsp;<span class="ident" id="8336807">b</span>&nbsp;<span class="op" id="8336809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336813">return</span>&nbsp;<span class="num" id="8336820">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336826">return</span>&nbsp;<span class="num" id="8336833">0</span><br>
<span class="lineno">70</span><span class="op" id="8336835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8336838">func</span>&nbsp;<span class="ident" id="8336843">TestConstantTimeEq</span><span class="op" id="8336861">(</span><span class="ident" id="8336862">t</span>&nbsp;<span class="op" id="8336864">*</span><span class="ident" id="8336865">testing</span><span class="op" id="8336872">.</span><span class="ident" id="8336873">T</span><span class="op" id="8336874">)</span>&nbsp;<span class="op" id="8336876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336879">err</span>&nbsp;<span class="op" id="8336883">:=</span>&nbsp;<span class="ident" id="8336886">quick</span><span class="op" id="8336891">.</span><span class="ident" id="8336892">CheckEqual</span><span class="op" id="8336902">(</span><span class="ident" id="8336903">ConstantTimeEq</span><span class="op" id="8336917">,</span>&nbsp;<span class="ident" id="8336919">eq</span><span class="op" id="8336921">,</span>&nbsp;<span class="ident" id="8336923">nil</span><span class="op" id="8336926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336929">if</span>&nbsp;<span class="ident" id="8336932">err</span>&nbsp;<span class="op" id="8336936">!=</span>&nbsp;<span class="ident" id="8336939">nil</span>&nbsp;<span class="op" id="8336943">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336947">t</span><span class="op" id="8336948">.</span><span class="ident" id="8336949">Error</span><span class="op" id="8336954">(</span><span class="ident" id="8336955">err</span><span class="op" id="8336958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336961">}</span><br>
<span class="lineno"></span><span class="op" id="8336963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8336966">func</span>&nbsp;<span class="ident" id="8336971">makeCopy</span><span class="op" id="8336979">(</span><span class="ident" id="8336980">v</span>&nbsp;<span class="builtintype" id="8336982">int</span><span class="op" id="8336985">,</span>&nbsp;<span class="ident" id="8336987">x</span><span class="op" id="8336988">,</span>&nbsp;<span class="ident" id="8336990">y</span>&nbsp;<span class="op" id="8336992">[</span><span class="op" id="8336993">]</span><span class="builtintype" id="8336994">byte</span><span class="op" id="8336998">)</span>&nbsp;<span class="op" id="8337000">[</span><span class="op" id="8337001">]</span><span class="builtintype" id="8337002">byte</span>&nbsp;<span class="op" id="8337007">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337010">if</span>&nbsp;<span class="builtinfunc" id="8337013">len</span><span class="op" id="8337016">(</span><span class="ident" id="8337017">x</span><span class="op" id="8337018">)</span>&nbsp;<span class="op" id="8337020">&gt;</span>&nbsp;<span class="builtinfunc" id="8337022">len</span><span class="op" id="8337025">(</span><span class="ident" id="8337026">y</span><span class="op" id="8337027">)</span>&nbsp;<span class="op" id="8337029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337033">x</span>&nbsp;<span class="op" id="8337035">=</span>&nbsp;<span class="ident" id="8337037">x</span><span class="op" id="8337038">[</span><span class="num" id="8337039">0</span><span class="op" id="8337040">:</span><span class="builtinfunc" id="8337041">len</span><span class="op" id="8337044">(</span><span class="ident" id="8337045">y</span><span class="op" id="8337046">)</span><span class="op" id="8337047">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337050">}</span>&nbsp;<span class="keyword" id="8337052">else</span>&nbsp;<span class="op" id="8337057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337061">y</span>&nbsp;<span class="op" id="8337063">=</span>&nbsp;<span class="ident" id="8337065">y</span><span class="op" id="8337066">[</span><span class="num" id="8337067">0</span><span class="op" id="8337068">:</span><span class="builtinfunc" id="8337069">len</span><span class="op" id="8337072">(</span><span class="ident" id="8337073">x</span><span class="op" id="8337074">)</span><span class="op" id="8337075">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337078">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337081">if</span>&nbsp;<span class="ident" id="8337084">v</span>&nbsp;<span class="op" id="8337086">==</span>&nbsp;<span class="num" id="8337089">1</span>&nbsp;<span class="op" id="8337091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8337095">copy</span><span class="op" id="8337099">(</span><span class="ident" id="8337100">x</span><span class="op" id="8337101">,</span>&nbsp;<span class="ident" id="8337103">y</span><span class="op" id="8337104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337110">return</span>&nbsp;<span class="ident" id="8337117">x</span><br>
<span class="lineno"></span><span class="op" id="8337119">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="8337122">func</span>&nbsp;<span class="ident" id="8337127">constantTimeCopyWrapper</span><span class="op" id="8337150">(</span><span class="ident" id="8337151">v</span>&nbsp;<span class="builtintype" id="8337153">int</span><span class="op" id="8337156">,</span>&nbsp;<span class="ident" id="8337158">x</span><span class="op" id="8337159">,</span>&nbsp;<span class="ident" id="8337161">y</span>&nbsp;<span class="op" id="8337163">[</span><span class="op" id="8337164">]</span><span class="builtintype" id="8337165">byte</span><span class="op" id="8337169">)</span>&nbsp;<span class="op" id="8337171">[</span><span class="op" id="8337172">]</span><span class="builtintype" id="8337173">byte</span>&nbsp;<span class="op" id="8337178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337181">if</span>&nbsp;<span class="builtinfunc" id="8337184">len</span><span class="op" id="8337187">(</span><span class="ident" id="8337188">x</span><span class="op" id="8337189">)</span>&nbsp;<span class="op" id="8337191">&gt;</span>&nbsp;<span class="builtinfunc" id="8337193">len</span><span class="op" id="8337196">(</span><span class="ident" id="8337197">y</span><span class="op" id="8337198">)</span>&nbsp;<span class="op" id="8337200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337204">x</span>&nbsp;<span class="op" id="8337206">=</span>&nbsp;<span class="ident" id="8337208">x</span><span class="op" id="8337209">[</span><span class="num" id="8337210">0</span><span class="op" id="8337211">:</span><span class="builtinfunc" id="8337212">len</span><span class="op" id="8337215">(</span><span class="ident" id="8337216">y</span><span class="op" id="8337217">)</span><span class="op" id="8337218">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337221">}</span>&nbsp;<span class="keyword" id="8337223">else</span>&nbsp;<span class="op" id="8337228">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337232">y</span>&nbsp;<span class="op" id="8337234">=</span>&nbsp;<span class="ident" id="8337236">y</span><span class="op" id="8337237">[</span><span class="num" id="8337238">0</span><span class="op" id="8337239">:</span><span class="builtinfunc" id="8337240">len</span><span class="op" id="8337243">(</span><span class="ident" id="8337244">x</span><span class="op" id="8337245">)</span><span class="op" id="8337246">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337252">v</span>&nbsp;<span class="op" id="8337254">&amp;=</span>&nbsp;<span class="num" id="8337257">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337260">ConstantTimeCopy</span><span class="op" id="8337276">(</span><span class="ident" id="8337277">v</span><span class="op" id="8337278">,</span>&nbsp;<span class="ident" id="8337280">x</span><span class="op" id="8337281">,</span>&nbsp;<span class="ident" id="8337283">y</span><span class="op" id="8337284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337287">return</span>&nbsp;<span class="ident" id="8337294">x</span><br>
<span class="lineno">100</span><span class="op" id="8337296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8337299">func</span>&nbsp;<span class="ident" id="8337304">TestConstantTimeCopy</span><span class="op" id="8337324">(</span><span class="ident" id="8337325">t</span>&nbsp;<span class="op" id="8337327">*</span><span class="ident" id="8337328">testing</span><span class="op" id="8337335">.</span><span class="ident" id="8337336">T</span><span class="op" id="8337337">)</span>&nbsp;<span class="op" id="8337339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337342">err</span>&nbsp;<span class="op" id="8337346">:=</span>&nbsp;<span class="ident" id="8337349">quick</span><span class="op" id="8337354">.</span><span class="ident" id="8337355">CheckEqual</span><span class="op" id="8337365">(</span><span class="ident" id="8337366">constantTimeCopyWrapper</span><span class="op" id="8337389">,</span>&nbsp;<span class="ident" id="8337391">makeCopy</span><span class="op" id="8337399">,</span>&nbsp;<span class="ident" id="8337401">nil</span><span class="op" id="8337404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337407">if</span>&nbsp;<span class="ident" id="8337410">err</span>&nbsp;<span class="op" id="8337414">!=</span>&nbsp;<span class="ident" id="8337417">nil</span>&nbsp;<span class="op" id="8337421">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337425">t</span><span class="op" id="8337426">.</span><span class="ident" id="8337427">Error</span><span class="op" id="8337432">(</span><span class="ident" id="8337433">err</span><span class="op" id="8337436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337439">}</span><br>
<span class="lineno"></span><span class="op" id="8337441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8337444">var</span>&nbsp;<span class="ident" id="8337448">lessOrEqTests</span>&nbsp;<span class="op" id="8337462">=</span>&nbsp;<span class="op" id="8337464">[</span><span class="op" id="8337465">]</span><span class="keyword" id="8337466">struct</span>&nbsp;<span class="op" id="8337473">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337476">x</span><span class="op" id="8337477">,</span>&nbsp;<span class="ident" id="8337479">y</span><span class="op" id="8337480">,</span>&nbsp;<span class="ident" id="8337482">result</span>&nbsp;<span class="builtintype" id="8337489">int</span><br>
<span class="lineno"></span><span class="op" id="8337493">}</span><span class="op" id="8337494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337497">{</span><span class="num" id="8337498">0</span><span class="op" id="8337499">,</span>&nbsp;<span class="num" id="8337501">0</span><span class="op" id="8337502">,</span>&nbsp;<span class="num" id="8337504">1</span><span class="op" id="8337505">}</span><span class="op" id="8337506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337509">{</span><span class="num" id="8337510">1</span><span class="op" id="8337511">,</span>&nbsp;<span class="num" id="8337513">0</span><span class="op" id="8337514">,</span>&nbsp;<span class="num" id="8337516">0</span><span class="op" id="8337517">}</span><span class="op" id="8337518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337521">{</span><span class="num" id="8337522">0</span><span class="op" id="8337523">,</span>&nbsp;<span class="num" id="8337525">1</span><span class="op" id="8337526">,</span>&nbsp;<span class="num" id="8337528">1</span><span class="op" id="8337529">}</span><span class="op" id="8337530">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337533">{</span><span class="num" id="8337534">10</span><span class="op" id="8337536">,</span>&nbsp;<span class="num" id="8337538">20</span><span class="op" id="8337540">,</span>&nbsp;<span class="num" id="8337542">1</span><span class="op" id="8337543">}</span><span class="op" id="8337544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337547">{</span><span class="num" id="8337548">20</span><span class="op" id="8337550">,</span>&nbsp;<span class="num" id="8337552">10</span><span class="op" id="8337554">,</span>&nbsp;<span class="num" id="8337556">0</span><span class="op" id="8337557">}</span><span class="op" id="8337558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337561">{</span><span class="num" id="8337562">10</span><span class="op" id="8337564">,</span>&nbsp;<span class="num" id="8337566">10</span><span class="op" id="8337568">,</span>&nbsp;<span class="num" id="8337570">1</span><span class="op" id="8337571">}</span><span class="op" id="8337572">,</span><br>
<span class="lineno"></span><span class="op" id="8337574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8337577">func</span>&nbsp;<span class="ident" id="8337582">TestConstantTimeLessOrEq</span><span class="op" id="8337606">(</span><span class="ident" id="8337607">t</span>&nbsp;<span class="op" id="8337609">*</span><span class="ident" id="8337610">testing</span><span class="op" id="8337617">.</span><span class="ident" id="8337618">T</span><span class="op" id="8337619">)</span>&nbsp;<span class="op" id="8337621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337624">for</span>&nbsp;<span class="ident" id="8337628">i</span><span class="op" id="8337629">,</span>&nbsp;<span class="ident" id="8337631">test</span>&nbsp;<span class="op" id="8337636">:=</span>&nbsp;<span class="keyword" id="8337639">range</span>&nbsp;<span class="ident" id="8337645">lessOrEqTests</span>&nbsp;<span class="op" id="8337659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337663">result</span>&nbsp;<span class="op" id="8337670">:=</span>&nbsp;<span class="ident" id="8337673">ConstantTimeLessOrEq</span><span class="op" id="8337693">(</span><span class="ident" id="8337694">test</span><span class="op" id="8337698">.</span><span class="ident" id="8337699">x</span><span class="op" id="8337700">,</span>&nbsp;<span class="ident" id="8337702">test</span><span class="op" id="8337706">.</span><span class="ident" id="8337707">y</span><span class="op" id="8337708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337712">if</span>&nbsp;<span class="ident" id="8337715">result</span>&nbsp;<span class="op" id="8337722">!=</span>&nbsp;<span class="ident" id="8337725">test</span><span class="op" id="8337729">.</span><span class="ident" id="8337730">result</span>&nbsp;<span class="op" id="8337737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337742">t</span><span class="op" id="8337743">.</span><span class="ident" id="8337744">Errorf</span><span class="op" id="8337750">(</span><span class="string" id="8337751">&#34;#%d:&nbsp;%d&nbsp;&lt;=&nbsp;%d&nbsp;gave&nbsp;%d,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8337787">,</span>&nbsp;<span class="ident" id="8337789">i</span><span class="op" id="8337790">,</span>&nbsp;<span class="ident" id="8337792">test</span><span class="op" id="8337796">.</span><span class="ident" id="8337797">x</span><span class="op" id="8337798">,</span>&nbsp;<span class="ident" id="8337800">test</span><span class="op" id="8337804">.</span><span class="ident" id="8337805">y</span><span class="op" id="8337806">,</span>&nbsp;<span class="ident" id="8337808">result</span><span class="op" id="8337814">,</span>&nbsp;<span class="ident" id="8337816">test</span><span class="op" id="8337820">.</span><span class="ident" id="8337821">result</span><span class="op" id="8337827">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337834">}</span><br>
<span class="lineno"></span><span class="op" id="8337836">}</span>
</div>
</body>
</html>
