<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/sha1</h2>
<ul>
<li><a href="/gostd/crypto/sha1/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1.go.html" class="current">sha1.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1_test.go.html">sha1_test.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1block.go.html">sha1block.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1block_decl.go.html">sha1block_decl.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3788727">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3788782">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3788836">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3788887">//&nbsp;Package&nbsp;sha1&nbsp;implements&nbsp;the&nbsp;SHA1&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;3174.</span><br>
<span class="lineno"></span><span class="keyword" id="3788962">package</span>&nbsp;<span class="ident" id="3788970">sha1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3788976">import</span>&nbsp;<span class="op" id="3788983">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3788986">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3788996">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="3789003">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3789006">func</span>&nbsp;<span class="ident" id="3789011">init</span><span class="op" id="3789015">(</span><span class="op" id="3789016">)</span>&nbsp;<span class="op" id="3789018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789021">crypto</span><span class="op" id="3789027">.</span><span class="ident" id="3789028">RegisterHash</span><span class="op" id="3789040">(</span><span class="ident" id="3789041">crypto</span><span class="op" id="3789047">.</span><span class="ident" id="3789048">SHA1</span><span class="op" id="3789052">,</span>&nbsp;<span class="ident" id="3789054">New</span><span class="op" id="3789057">)</span><br>
<span class="lineno">15</span><span class="op" id="3789059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3789062">//&nbsp;The&nbsp;size&nbsp;of&nbsp;a&nbsp;SHA1&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3789103">const</span>&nbsp;<span class="ident" id="3789109">Size</span>&nbsp;<span class="op" id="3789114">=</span>&nbsp;<span class="num" id="3789116">20</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3789120">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;SHA1&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3789155">const</span>&nbsp;<span class="ident" id="3789161">BlockSize</span>&nbsp;<span class="op" id="3789171">=</span>&nbsp;<span class="num" id="3789173">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3789177">const</span>&nbsp;<span class="op" id="3789183">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789186">chunk</span>&nbsp;<span class="op" id="3789192">=</span>&nbsp;<span class="num" id="3789194">64</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789198">init0</span>&nbsp;<span class="op" id="3789204">=</span>&nbsp;<span class="num" id="3789206">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789218">init1</span>&nbsp;<span class="op" id="3789224">=</span>&nbsp;<span class="num" id="3789226">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789238">init2</span>&nbsp;<span class="op" id="3789244">=</span>&nbsp;<span class="num" id="3789246">0x98BADCFE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789258">init3</span>&nbsp;<span class="op" id="3789264">=</span>&nbsp;<span class="num" id="3789266">0x10325476</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789278">init4</span>&nbsp;<span class="op" id="3789284">=</span>&nbsp;<span class="num" id="3789286">0xC3D2E1F0</span><br>
<span class="lineno">30</span><span class="op" id="3789297">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3789300">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="3789359">type</span>&nbsp;<span class="ident" id="3789364">digest</span>&nbsp;<span class="keyword" id="3789371">struct</span>&nbsp;<span class="op" id="3789378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789381">h</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3789385">[</span><span class="num" id="3789386">5</span><span class="op" id="3789387">]</span><span class="builtintype" id="3789388">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789396">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3789400">[</span><span class="ident" id="3789401">chunk</span><span class="op" id="3789406">]</span><span class="builtintype" id="3789407">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789413">nx</span>&nbsp;&nbsp;<span class="builtintype" id="3789417">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3789422">len</span>&nbsp;<span class="ident" id="3789426">uint64</span><br>
<span class="lineno"></span><span class="op" id="3789433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3789436">func</span>&nbsp;<span class="op" id="3789441">(</span><span class="ident" id="3789442">d</span>&nbsp;<span class="op" id="3789444">*</span><span class="ident" id="3789445">digest</span><span class="op" id="3789451">)</span>&nbsp;<span class="ident" id="3789453">Reset</span><span class="op" id="3789458">(</span><span class="op" id="3789459">)</span>&nbsp;<span class="op" id="3789461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789464">d</span><span class="op" id="3789465">.</span><span class="ident" id="3789466">h</span><span class="op" id="3789467">[</span><span class="num" id="3789468">0</span><span class="op" id="3789469">]</span>&nbsp;<span class="op" id="3789471">=</span>&nbsp;<span class="ident" id="3789473">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789480">d</span><span class="op" id="3789481">.</span><span class="ident" id="3789482">h</span><span class="op" id="3789483">[</span><span class="num" id="3789484">1</span><span class="op" id="3789485">]</span>&nbsp;<span class="op" id="3789487">=</span>&nbsp;<span class="ident" id="3789489">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789496">d</span><span class="op" id="3789497">.</span><span class="ident" id="3789498">h</span><span class="op" id="3789499">[</span><span class="num" id="3789500">2</span><span class="op" id="3789501">]</span>&nbsp;<span class="op" id="3789503">=</span>&nbsp;<span class="ident" id="3789505">init2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789512">d</span><span class="op" id="3789513">.</span><span class="ident" id="3789514">h</span><span class="op" id="3789515">[</span><span class="num" id="3789516">3</span><span class="op" id="3789517">]</span>&nbsp;<span class="op" id="3789519">=</span>&nbsp;<span class="ident" id="3789521">init3</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789528">d</span><span class="op" id="3789529">.</span><span class="ident" id="3789530">h</span><span class="op" id="3789531">[</span><span class="num" id="3789532">4</span><span class="op" id="3789533">]</span>&nbsp;<span class="op" id="3789535">=</span>&nbsp;<span class="ident" id="3789537">init4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789544">d</span><span class="op" id="3789545">.</span><span class="ident" id="3789546">nx</span>&nbsp;<span class="op" id="3789549">=</span>&nbsp;<span class="num" id="3789551">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789554">d</span><span class="op" id="3789555">.</span><span class="builtinfunc" id="3789556">len</span>&nbsp;<span class="op" id="3789560">=</span>&nbsp;<span class="num" id="3789562">0</span><br>
<span class="lineno"></span><span class="op" id="3789564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3789567">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;SHA1&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="3789627">func</span>&nbsp;<span class="ident" id="3789632">New</span><span class="op" id="3789635">(</span><span class="op" id="3789636">)</span>&nbsp;<span class="ident" id="3789638">hash</span><span class="op" id="3789642">.</span><span class="ident" id="3789643">Hash</span>&nbsp;<span class="op" id="3789648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789651">d</span>&nbsp;<span class="op" id="3789653">:=</span>&nbsp;<span class="builtinfunc" id="3789656">new</span><span class="op" id="3789659">(</span><span class="ident" id="3789660">digest</span><span class="op" id="3789666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789669">d</span><span class="op" id="3789670">.</span><span class="ident" id="3789671">Reset</span><span class="op" id="3789676">(</span><span class="op" id="3789677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789680">return</span>&nbsp;<span class="ident" id="3789687">d</span><br>
<span class="lineno">55</span><span class="op" id="3789689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3789692">func</span>&nbsp;<span class="op" id="3789697">(</span><span class="ident" id="3789698">d</span>&nbsp;<span class="op" id="3789700">*</span><span class="ident" id="3789701">digest</span><span class="op" id="3789707">)</span>&nbsp;<span class="ident" id="3789709">Size</span><span class="op" id="3789713">(</span><span class="op" id="3789714">)</span>&nbsp;<span class="builtintype" id="3789716">int</span>&nbsp;<span class="op" id="3789720">{</span>&nbsp;<span class="keyword" id="3789722">return</span>&nbsp;<span class="ident" id="3789729">Size</span>&nbsp;<span class="op" id="3789734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3789737">func</span>&nbsp;<span class="op" id="3789742">(</span><span class="ident" id="3789743">d</span>&nbsp;<span class="op" id="3789745">*</span><span class="ident" id="3789746">digest</span><span class="op" id="3789752">)</span>&nbsp;<span class="ident" id="3789754">BlockSize</span><span class="op" id="3789763">(</span><span class="op" id="3789764">)</span>&nbsp;<span class="builtintype" id="3789766">int</span>&nbsp;<span class="op" id="3789770">{</span>&nbsp;<span class="keyword" id="3789772">return</span>&nbsp;<span class="ident" id="3789779">BlockSize</span>&nbsp;<span class="op" id="3789789">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3789792">func</span>&nbsp;<span class="op" id="3789797">(</span><span class="ident" id="3789798">d</span>&nbsp;<span class="op" id="3789800">*</span><span class="ident" id="3789801">digest</span><span class="op" id="3789807">)</span>&nbsp;<span class="ident" id="3789809">Write</span><span class="op" id="3789814">(</span><span class="ident" id="3789815">p</span>&nbsp;<span class="op" id="3789817">[</span><span class="op" id="3789818">]</span><span class="builtintype" id="3789819">byte</span><span class="op" id="3789823">)</span>&nbsp;<span class="op" id="3789825">(</span><span class="ident" id="3789826">nn</span>&nbsp;<span class="builtintype" id="3789829">int</span><span class="op" id="3789832">,</span>&nbsp;<span class="ident" id="3789834">err</span>&nbsp;<span class="builtintype" id="3789838">error</span><span class="op" id="3789843">)</span>&nbsp;<span class="op" id="3789845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789848">nn</span>&nbsp;<span class="op" id="3789851">=</span>&nbsp;<span class="builtinfunc" id="3789853">len</span><span class="op" id="3789856">(</span><span class="ident" id="3789857">p</span><span class="op" id="3789858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789861">d</span><span class="op" id="3789862">.</span><span class="builtinfunc" id="3789863">len</span>&nbsp;<span class="op" id="3789867">+=</span>&nbsp;<span class="ident" id="3789870">uint64</span><span class="op" id="3789876">(</span><span class="ident" id="3789877">nn</span><span class="op" id="3789879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789882">if</span>&nbsp;<span class="ident" id="3789885">d</span><span class="op" id="3789886">.</span><span class="ident" id="3789887">nx</span>&nbsp;<span class="op" id="3789890">&gt;</span>&nbsp;<span class="num" id="3789892">0</span>&nbsp;<span class="op" id="3789894">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789898">n</span>&nbsp;<span class="op" id="3789900">:=</span>&nbsp;<span class="builtinfunc" id="3789903">copy</span><span class="op" id="3789907">(</span><span class="ident" id="3789908">d</span><span class="op" id="3789909">.</span><span class="ident" id="3789910">x</span><span class="op" id="3789911">[</span><span class="ident" id="3789912">d</span><span class="op" id="3789913">.</span><span class="ident" id="3789914">nx</span><span class="op" id="3789916">:</span><span class="op" id="3789917">]</span><span class="op" id="3789918">,</span>&nbsp;<span class="ident" id="3789920">p</span><span class="op" id="3789921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789925">d</span><span class="op" id="3789926">.</span><span class="ident" id="3789927">nx</span>&nbsp;<span class="op" id="3789930">+=</span>&nbsp;<span class="ident" id="3789933">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789937">if</span>&nbsp;<span class="ident" id="3789940">d</span><span class="op" id="3789941">.</span><span class="ident" id="3789942">nx</span>&nbsp;<span class="op" id="3789945">==</span>&nbsp;<span class="ident" id="3789948">chunk</span>&nbsp;<span class="op" id="3789954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789959">block</span><span class="op" id="3789964">(</span><span class="ident" id="3789965">d</span><span class="op" id="3789966">,</span>&nbsp;<span class="ident" id="3789968">d</span><span class="op" id="3789969">.</span><span class="ident" id="3789970">x</span><span class="op" id="3789971">[</span><span class="op" id="3789972">:</span><span class="op" id="3789973">]</span><span class="op" id="3789974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789979">d</span><span class="op" id="3789980">.</span><span class="ident" id="3789981">nx</span>&nbsp;<span class="op" id="3789984">=</span>&nbsp;<span class="num" id="3789986">0</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789994">p</span>&nbsp;<span class="op" id="3789996">=</span>&nbsp;<span class="ident" id="3789998">p</span><span class="op" id="3789999">[</span><span class="ident" id="3790000">n</span><span class="op" id="3790001">:</span><span class="op" id="3790002">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790008">if</span>&nbsp;<span class="builtinfunc" id="3790011">len</span><span class="op" id="3790014">(</span><span class="ident" id="3790015">p</span><span class="op" id="3790016">)</span>&nbsp;<span class="op" id="3790018">&gt;=</span>&nbsp;<span class="ident" id="3790021">chunk</span>&nbsp;<span class="op" id="3790027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790031">n</span>&nbsp;<span class="op" id="3790033">:=</span>&nbsp;<span class="builtinfunc" id="3790036">len</span><span class="op" id="3790039">(</span><span class="ident" id="3790040">p</span><span class="op" id="3790041">)</span>&nbsp;<span class="op" id="3790043">&amp;^</span>&nbsp;<span class="op" id="3790046">(</span><span class="ident" id="3790047">chunk</span>&nbsp;<span class="op" id="3790053">-</span>&nbsp;<span class="num" id="3790055">1</span><span class="op" id="3790056">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790060">block</span><span class="op" id="3790065">(</span><span class="ident" id="3790066">d</span><span class="op" id="3790067">,</span>&nbsp;<span class="ident" id="3790069">p</span><span class="op" id="3790070">[</span><span class="op" id="3790071">:</span><span class="ident" id="3790072">n</span><span class="op" id="3790073">]</span><span class="op" id="3790074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790078">p</span>&nbsp;<span class="op" id="3790080">=</span>&nbsp;<span class="ident" id="3790082">p</span><span class="op" id="3790083">[</span><span class="ident" id="3790084">n</span><span class="op" id="3790085">:</span><span class="op" id="3790086">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790092">if</span>&nbsp;<span class="builtinfunc" id="3790095">len</span><span class="op" id="3790098">(</span><span class="ident" id="3790099">p</span><span class="op" id="3790100">)</span>&nbsp;<span class="op" id="3790102">&gt;</span>&nbsp;<span class="num" id="3790104">0</span>&nbsp;<span class="op" id="3790106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790110">d</span><span class="op" id="3790111">.</span><span class="ident" id="3790112">nx</span>&nbsp;<span class="op" id="3790115">=</span>&nbsp;<span class="builtinfunc" id="3790117">copy</span><span class="op" id="3790121">(</span><span class="ident" id="3790122">d</span><span class="op" id="3790123">.</span><span class="ident" id="3790124">x</span><span class="op" id="3790125">[</span><span class="op" id="3790126">:</span><span class="op" id="3790127">]</span><span class="op" id="3790128">,</span>&nbsp;<span class="ident" id="3790130">p</span><span class="op" id="3790131">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790137">return</span><br>
<span class="lineno"></span><span class="op" id="3790144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3790147">func</span>&nbsp;<span class="op" id="3790152">(</span><span class="ident" id="3790153">d0</span>&nbsp;<span class="op" id="3790156">*</span><span class="ident" id="3790157">digest</span><span class="op" id="3790163">)</span>&nbsp;<span class="ident" id="3790165">Sum</span><span class="op" id="3790168">(</span><span class="ident" id="3790169">in</span>&nbsp;<span class="op" id="3790172">[</span><span class="op" id="3790173">]</span><span class="builtintype" id="3790174">byte</span><span class="op" id="3790178">)</span>&nbsp;<span class="op" id="3790180">[</span><span class="op" id="3790181">]</span><span class="builtintype" id="3790182">byte</span>&nbsp;<span class="op" id="3790187">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790190">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790257">d</span>&nbsp;<span class="op" id="3790259">:=</span>&nbsp;<span class="op" id="3790262">*</span><span class="ident" id="3790263">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790267">hash</span>&nbsp;<span class="op" id="3790272">:=</span>&nbsp;<span class="ident" id="3790275">d</span><span class="op" id="3790276">.</span><span class="ident" id="3790277">checkSum</span><span class="op" id="3790285">(</span><span class="op" id="3790286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790289">return</span>&nbsp;<span class="builtinfunc" id="3790296">append</span><span class="op" id="3790302">(</span><span class="ident" id="3790303">in</span><span class="op" id="3790305">,</span>&nbsp;<span class="ident" id="3790307">hash</span><span class="op" id="3790311">[</span><span class="op" id="3790312">:</span><span class="op" id="3790313">]</span><span class="op" id="3790314">...</span><span class="op" id="3790317">)</span><br>
<span class="lineno"></span><span class="op" id="3790319">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="3790322">func</span>&nbsp;<span class="op" id="3790327">(</span><span class="ident" id="3790328">d</span>&nbsp;<span class="op" id="3790330">*</span><span class="ident" id="3790331">digest</span><span class="op" id="3790337">)</span>&nbsp;<span class="ident" id="3790339">checkSum</span><span class="op" id="3790347">(</span><span class="op" id="3790348">)</span>&nbsp;<span class="op" id="3790350">[</span><span class="ident" id="3790351">Size</span><span class="op" id="3790355">]</span><span class="builtintype" id="3790356">byte</span>&nbsp;<span class="op" id="3790361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3790364">len</span>&nbsp;<span class="op" id="3790368">:=</span>&nbsp;<span class="ident" id="3790371">d</span><span class="op" id="3790372">.</span><span class="builtinfunc" id="3790373">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790378">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790438">var</span>&nbsp;<span class="ident" id="3790442">tmp</span>&nbsp;<span class="op" id="3790446">[</span><span class="num" id="3790447">64</span><span class="op" id="3790449">]</span><span class="builtintype" id="3790450">byte</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790456">tmp</span><span class="op" id="3790459">[</span><span class="num" id="3790460">0</span><span class="op" id="3790461">]</span>&nbsp;<span class="op" id="3790463">=</span>&nbsp;<span class="num" id="3790465">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790471">if</span>&nbsp;<span class="builtinfunc" id="3790474">len</span><span class="op" id="3790477">%</span><span class="num" id="3790478">64</span>&nbsp;<span class="op" id="3790481">&lt;</span>&nbsp;<span class="num" id="3790483">56</span>&nbsp;<span class="op" id="3790486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790490">d</span><span class="op" id="3790491">.</span><span class="ident" id="3790492">Write</span><span class="op" id="3790497">(</span><span class="ident" id="3790498">tmp</span><span class="op" id="3790501">[</span><span class="num" id="3790502">0</span>&nbsp;<span class="op" id="3790504">:</span>&nbsp;<span class="num" id="3790506">56</span><span class="op" id="3790508">-</span><span class="builtinfunc" id="3790509">len</span><span class="op" id="3790512">%</span><span class="num" id="3790513">64</span><span class="op" id="3790515">]</span><span class="op" id="3790516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790519">}</span>&nbsp;<span class="keyword" id="3790521">else</span>&nbsp;<span class="op" id="3790526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790530">d</span><span class="op" id="3790531">.</span><span class="ident" id="3790532">Write</span><span class="op" id="3790537">(</span><span class="ident" id="3790538">tmp</span><span class="op" id="3790541">[</span><span class="num" id="3790542">0</span>&nbsp;<span class="op" id="3790544">:</span>&nbsp;<span class="num" id="3790546">64</span><span class="op" id="3790548">+</span><span class="num" id="3790549">56</span><span class="op" id="3790551">-</span><span class="builtinfunc" id="3790552">len</span><span class="op" id="3790555">%</span><span class="num" id="3790556">64</span><span class="op" id="3790558">]</span><span class="op" id="3790559">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790566">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3790586">len</span>&nbsp;<span class="op" id="3790590">&lt;&lt;=</span>&nbsp;<span class="num" id="3790594">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790597">for</span>&nbsp;<span class="ident" id="3790601">i</span>&nbsp;<span class="op" id="3790603">:=</span>&nbsp;<span class="builtintype" id="3790606">uint</span><span class="op" id="3790610">(</span><span class="num" id="3790611">0</span><span class="op" id="3790612">)</span><span class="op" id="3790613">;</span>&nbsp;<span class="ident" id="3790615">i</span>&nbsp;<span class="op" id="3790617">&lt;</span>&nbsp;<span class="num" id="3790619">8</span><span class="op" id="3790620">;</span>&nbsp;<span class="ident" id="3790622">i</span><span class="op" id="3790623">++</span>&nbsp;<span class="op" id="3790626">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790630">tmp</span><span class="op" id="3790633">[</span><span class="ident" id="3790634">i</span><span class="op" id="3790635">]</span>&nbsp;<span class="op" id="3790637">=</span>&nbsp;<span class="builtintype" id="3790639">byte</span><span class="op" id="3790643">(</span><span class="builtinfunc" id="3790644">len</span>&nbsp;<span class="op" id="3790648">&gt;&gt;</span>&nbsp;<span class="op" id="3790651">(</span><span class="num" id="3790652">56</span>&nbsp;<span class="op" id="3790655">-</span>&nbsp;<span class="num" id="3790657">8</span><span class="op" id="3790658">*</span><span class="ident" id="3790659">i</span><span class="op" id="3790660">)</span><span class="op" id="3790661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790667">d</span><span class="op" id="3790668">.</span><span class="ident" id="3790669">Write</span><span class="op" id="3790674">(</span><span class="ident" id="3790675">tmp</span><span class="op" id="3790678">[</span><span class="num" id="3790679">0</span><span class="op" id="3790680">:</span><span class="num" id="3790681">8</span><span class="op" id="3790682">]</span><span class="op" id="3790683">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790687">if</span>&nbsp;<span class="ident" id="3790690">d</span><span class="op" id="3790691">.</span><span class="ident" id="3790692">nx</span>&nbsp;<span class="op" id="3790695">!=</span>&nbsp;<span class="num" id="3790698">0</span>&nbsp;<span class="op" id="3790700">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3790704">panic</span><span class="op" id="3790709">(</span><span class="string" id="3790710">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="3790721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790728">var</span>&nbsp;<span class="ident" id="3790732">digest</span>&nbsp;<span class="op" id="3790739">[</span><span class="ident" id="3790740">Size</span><span class="op" id="3790744">]</span><span class="builtintype" id="3790745">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790751">for</span>&nbsp;<span class="ident" id="3790755">i</span><span class="op" id="3790756">,</span>&nbsp;<span class="ident" id="3790758">s</span>&nbsp;<span class="op" id="3790760">:=</span>&nbsp;<span class="keyword" id="3790763">range</span>&nbsp;<span class="ident" id="3790769">d</span><span class="op" id="3790770">.</span><span class="ident" id="3790771">h</span>&nbsp;<span class="op" id="3790773">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790777">digest</span><span class="op" id="3790783">[</span><span class="ident" id="3790784">i</span><span class="op" id="3790785">*</span><span class="num" id="3790786">4</span><span class="op" id="3790787">]</span>&nbsp;<span class="op" id="3790789">=</span>&nbsp;<span class="builtintype" id="3790791">byte</span><span class="op" id="3790795">(</span><span class="ident" id="3790796">s</span>&nbsp;<span class="op" id="3790798">&gt;&gt;</span>&nbsp;<span class="num" id="3790801">24</span><span class="op" id="3790803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790807">digest</span><span class="op" id="3790813">[</span><span class="ident" id="3790814">i</span><span class="op" id="3790815">*</span><span class="num" id="3790816">4</span><span class="op" id="3790817">+</span><span class="num" id="3790818">1</span><span class="op" id="3790819">]</span>&nbsp;<span class="op" id="3790821">=</span>&nbsp;<span class="builtintype" id="3790823">byte</span><span class="op" id="3790827">(</span><span class="ident" id="3790828">s</span>&nbsp;<span class="op" id="3790830">&gt;&gt;</span>&nbsp;<span class="num" id="3790833">16</span><span class="op" id="3790835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790839">digest</span><span class="op" id="3790845">[</span><span class="ident" id="3790846">i</span><span class="op" id="3790847">*</span><span class="num" id="3790848">4</span><span class="op" id="3790849">+</span><span class="num" id="3790850">2</span><span class="op" id="3790851">]</span>&nbsp;<span class="op" id="3790853">=</span>&nbsp;<span class="builtintype" id="3790855">byte</span><span class="op" id="3790859">(</span><span class="ident" id="3790860">s</span>&nbsp;<span class="op" id="3790862">&gt;&gt;</span>&nbsp;<span class="num" id="3790865">8</span><span class="op" id="3790866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790870">digest</span><span class="op" id="3790876">[</span><span class="ident" id="3790877">i</span><span class="op" id="3790878">*</span><span class="num" id="3790879">4</span><span class="op" id="3790880">+</span><span class="num" id="3790881">3</span><span class="op" id="3790882">]</span>&nbsp;<span class="op" id="3790884">=</span>&nbsp;<span class="builtintype" id="3790886">byte</span><span class="op" id="3790890">(</span><span class="ident" id="3790891">s</span><span class="op" id="3790892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790895">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790899">return</span>&nbsp;<span class="ident" id="3790906">digest</span><br>
<span class="lineno"></span><span class="op" id="3790913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3790916">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;SHA1&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno">125</span><span class="keyword" id="3790962">func</span>&nbsp;<span class="ident" id="3790967">Sum</span><span class="op" id="3790970">(</span><span class="ident" id="3790971">data</span>&nbsp;<span class="op" id="3790976">[</span><span class="op" id="3790977">]</span><span class="builtintype" id="3790978">byte</span><span class="op" id="3790982">)</span>&nbsp;<span class="op" id="3790984">[</span><span class="ident" id="3790985">Size</span><span class="op" id="3790989">]</span><span class="builtintype" id="3790990">byte</span>&nbsp;<span class="op" id="3790995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790998">var</span>&nbsp;<span class="ident" id="3791002">d</span>&nbsp;<span class="ident" id="3791004">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791012">d</span><span class="op" id="3791013">.</span><span class="ident" id="3791014">Reset</span><span class="op" id="3791019">(</span><span class="op" id="3791020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791023">d</span><span class="op" id="3791024">.</span><span class="ident" id="3791025">Write</span><span class="op" id="3791030">(</span><span class="ident" id="3791031">data</span><span class="op" id="3791035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791038">return</span>&nbsp;<span class="ident" id="3791045">d</span><span class="op" id="3791046">.</span><span class="ident" id="3791047">checkSum</span><span class="op" id="3791055">(</span><span class="op" id="3791056">)</span><br>
<span class="lineno">130</span><span class="op" id="3791058">}</span>
</div>
</body>
</html>
