<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime</h2>
<ul>
<li><a href="/gostd/mime/grammar.go.html">grammar.go</a></li>
<li><a href="/gostd/mime/mediatype.go.html" class="current">mediatype.go</a></li>
<li><a href="/gostd/mime/mediatype_test.go.html">mediatype_test.go</a></li>
<li><a href="/gostd/mime/type.go.html">type.go</a></li>
<li><a href="/gostd/mime/type_test.go.html">type_test.go</a></li>
<li><a href="/gostd/mime/type_unix.go.html">type_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3332807">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3332862">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3332916">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3332967">package</span>&nbsp;<span class="ident" id="3332975">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3332981">import</span>&nbsp;<span class="op" id="3332988">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3332991">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3333000">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3333010">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3333017">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3333025">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3333036">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="3333046">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3333049">//&nbsp;FormatMediaType&nbsp;serializes&nbsp;mediatype&nbsp;t&nbsp;and&nbsp;the&nbsp;parameters</span><br>
<span class="lineno"></span><span class="comment" id="3333110">//&nbsp;param&nbsp;as&nbsp;a&nbsp;media&nbsp;type&nbsp;conforming&nbsp;to&nbsp;RFC&nbsp;2045&nbsp;and&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="3333172">//&nbsp;The&nbsp;type&nbsp;and&nbsp;parameter&nbsp;names&nbsp;are&nbsp;written&nbsp;in&nbsp;lower-case.</span><br>
<span class="lineno"></span><span class="comment" id="3333231">//&nbsp;When&nbsp;any&nbsp;of&nbsp;the&nbsp;arguments&nbsp;result&nbsp;in&nbsp;a&nbsp;standard&nbsp;violation&nbsp;then</span><br>
<span class="lineno">20</span><span class="comment" id="3333296">//&nbsp;FormatMediaType&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3333341">func</span>&nbsp;<span class="ident" id="3333346">FormatMediaType</span><span class="op" id="3333361">(</span><span class="ident" id="3333362">t</span>&nbsp;<span class="builtintype" id="3333364">string</span><span class="op" id="3333370">,</span>&nbsp;<span class="ident" id="3333372">param</span>&nbsp;<span class="keyword" id="3333378">map</span><span class="op" id="3333381">[</span><span class="builtintype" id="3333382">string</span><span class="op" id="3333388">]</span><span class="builtintype" id="3333389">string</span><span class="op" id="3333395">)</span>&nbsp;<span class="builtintype" id="3333397">string</span>&nbsp;<span class="op" id="3333404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333407">slash</span>&nbsp;<span class="op" id="3333413">:=</span>&nbsp;<span class="ident" id="3333416">strings</span><span class="op" id="3333423">.</span><span class="ident" id="3333424">Index</span><span class="op" id="3333429">(</span><span class="ident" id="3333430">t</span><span class="op" id="3333431">,</span>&nbsp;<span class="string" id="3333433">&#34;/&#34;</span><span class="op" id="3333436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3333439">if</span>&nbsp;<span class="ident" id="3333442">slash</span>&nbsp;<span class="op" id="3333448">==</span>&nbsp;<span class="op" id="3333451">-</span><span class="num" id="3333452">1</span>&nbsp;<span class="op" id="3333454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3333458">return</span>&nbsp;<span class="string" id="3333465">&#34;&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3333469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333472">major</span><span class="op" id="3333477">,</span>&nbsp;<span class="ident" id="3333479">sub</span>&nbsp;<span class="op" id="3333483">:=</span>&nbsp;<span class="ident" id="3333486">t</span><span class="op" id="3333487">[</span><span class="op" id="3333488">:</span><span class="ident" id="3333489">slash</span><span class="op" id="3333494">]</span><span class="op" id="3333495">,</span>&nbsp;<span class="ident" id="3333497">t</span><span class="op" id="3333498">[</span><span class="ident" id="3333499">slash</span><span class="op" id="3333504">+</span><span class="num" id="3333505">1</span><span class="op" id="3333506">:</span><span class="op" id="3333507">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3333510">if</span>&nbsp;<span class="op" id="3333513">!</span><span class="ident" id="3333514">isToken</span><span class="op" id="3333521">(</span><span class="ident" id="3333522">major</span><span class="op" id="3333527">)</span>&nbsp;<span class="op" id="3333529">||</span>&nbsp;<span class="op" id="3333532">!</span><span class="ident" id="3333533">isToken</span><span class="op" id="3333540">(</span><span class="ident" id="3333541">sub</span><span class="op" id="3333544">)</span>&nbsp;<span class="op" id="3333546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3333550">return</span>&nbsp;<span class="string" id="3333557">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3333561">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3333564">var</span>&nbsp;<span class="ident" id="3333568">b</span>&nbsp;<span class="ident" id="3333570">bytes</span><span class="op" id="3333575">.</span><span class="ident" id="3333576">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333584">b</span><span class="op" id="3333585">.</span><span class="ident" id="3333586">WriteString</span><span class="op" id="3333597">(</span><span class="ident" id="3333598">strings</span><span class="op" id="3333605">.</span><span class="ident" id="3333606">ToLower</span><span class="op" id="3333613">(</span><span class="ident" id="3333614">major</span><span class="op" id="3333619">)</span><span class="op" id="3333620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333623">b</span><span class="op" id="3333624">.</span><span class="ident" id="3333625">WriteByte</span><span class="op" id="3333634">(</span><span class="string" id="3333635">&#39;/&#39;</span><span class="op" id="3333638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333641">b</span><span class="op" id="3333642">.</span><span class="ident" id="3333643">WriteString</span><span class="op" id="3333654">(</span><span class="ident" id="3333655">strings</span><span class="op" id="3333662">.</span><span class="ident" id="3333663">ToLower</span><span class="op" id="3333670">(</span><span class="ident" id="3333671">sub</span><span class="op" id="3333674">)</span><span class="op" id="3333675">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333679">attrs</span>&nbsp;<span class="op" id="3333685">:=</span>&nbsp;<span class="builtinfunc" id="3333688">make</span><span class="op" id="3333692">(</span><span class="op" id="3333693">[</span><span class="op" id="3333694">]</span><span class="builtintype" id="3333695">string</span><span class="op" id="3333701">,</span>&nbsp;<span class="num" id="3333703">0</span><span class="op" id="3333704">,</span>&nbsp;<span class="builtinfunc" id="3333706">len</span><span class="op" id="3333709">(</span><span class="ident" id="3333710">param</span><span class="op" id="3333715">)</span><span class="op" id="3333716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3333719">for</span>&nbsp;<span class="ident" id="3333723">a</span>&nbsp;<span class="op" id="3333725">:=</span>&nbsp;<span class="keyword" id="3333728">range</span>&nbsp;<span class="ident" id="3333734">param</span>&nbsp;<span class="op" id="3333740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333744">attrs</span>&nbsp;<span class="op" id="3333750">=</span>&nbsp;<span class="builtinfunc" id="3333752">append</span><span class="op" id="3333758">(</span><span class="ident" id="3333759">attrs</span><span class="op" id="3333764">,</span>&nbsp;<span class="ident" id="3333766">a</span><span class="op" id="3333767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3333770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333773">sort</span><span class="op" id="3333777">.</span><span class="ident" id="3333778">Strings</span><span class="op" id="3333785">(</span><span class="ident" id="3333786">attrs</span><span class="op" id="3333791">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3333795">for</span>&nbsp;<span class="ident" id="3333799">_</span><span class="op" id="3333800">,</span>&nbsp;<span class="ident" id="3333802">attribute</span>&nbsp;<span class="op" id="3333812">:=</span>&nbsp;<span class="keyword" id="3333815">range</span>&nbsp;<span class="ident" id="3333821">attrs</span>&nbsp;<span class="op" id="3333827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333831">value</span>&nbsp;<span class="op" id="3333837">:=</span>&nbsp;<span class="ident" id="3333840">param</span><span class="op" id="3333845">[</span><span class="ident" id="3333846">attribute</span><span class="op" id="3333855">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333859">b</span><span class="op" id="3333860">.</span><span class="ident" id="3333861">WriteByte</span><span class="op" id="3333870">(</span><span class="string" id="3333871">&#39;;&#39;</span><span class="op" id="3333874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333878">b</span><span class="op" id="3333879">.</span><span class="ident" id="3333880">WriteByte</span><span class="op" id="3333889">(</span><span class="string" id="3333890">&#39;&nbsp;&#39;</span><span class="op" id="3333893">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3333897">if</span>&nbsp;<span class="op" id="3333900">!</span><span class="ident" id="3333901">isToken</span><span class="op" id="3333908">(</span><span class="ident" id="3333909">attribute</span><span class="op" id="3333918">)</span>&nbsp;<span class="op" id="3333920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3333925">return</span>&nbsp;<span class="string" id="3333932">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3333937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333941">b</span><span class="op" id="3333942">.</span><span class="ident" id="3333943">WriteString</span><span class="op" id="3333954">(</span><span class="ident" id="3333955">strings</span><span class="op" id="3333962">.</span><span class="ident" id="3333963">ToLower</span><span class="op" id="3333970">(</span><span class="ident" id="3333971">attribute</span><span class="op" id="3333980">)</span><span class="op" id="3333981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3333985">b</span><span class="op" id="3333986">.</span><span class="ident" id="3333987">WriteByte</span><span class="op" id="3333996">(</span><span class="string" id="3333997">&#39;=&#39;</span><span class="op" id="3334000">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334004">if</span>&nbsp;<span class="ident" id="3334007">isToken</span><span class="op" id="3334014">(</span><span class="ident" id="3334015">value</span><span class="op" id="3334020">)</span>&nbsp;<span class="op" id="3334022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334027">b</span><span class="op" id="3334028">.</span><span class="ident" id="3334029">WriteString</span><span class="op" id="3334040">(</span><span class="ident" id="3334041">value</span><span class="op" id="3334046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334051">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334067">b</span><span class="op" id="3334068">.</span><span class="ident" id="3334069">WriteByte</span><span class="op" id="3334078">(</span><span class="string" id="3334079">&#39;&#34;&#39;</span><span class="op" id="3334082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334086">offset</span>&nbsp;<span class="op" id="3334093">:=</span>&nbsp;<span class="num" id="3334096">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334100">for</span>&nbsp;<span class="ident" id="3334104">index</span><span class="op" id="3334109">,</span>&nbsp;<span class="ident" id="3334111">character</span>&nbsp;<span class="op" id="3334121">:=</span>&nbsp;<span class="keyword" id="3334124">range</span>&nbsp;<span class="ident" id="3334130">value</span>&nbsp;<span class="op" id="3334136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334141">if</span>&nbsp;<span class="ident" id="3334144">character</span>&nbsp;<span class="op" id="3334154">==</span>&nbsp;<span class="string" id="3334157">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="3334161">||</span>&nbsp;<span class="ident" id="3334164">character</span>&nbsp;<span class="op" id="3334174">==</span>&nbsp;<span class="string" id="3334177">&#39;\\&#39;</span>&nbsp;<span class="op" id="3334182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334188">b</span><span class="op" id="3334189">.</span><span class="ident" id="3334190">WriteString</span><span class="op" id="3334201">(</span><span class="ident" id="3334202">value</span><span class="op" id="3334207">[</span><span class="ident" id="3334208">offset</span><span class="op" id="3334214">:</span><span class="ident" id="3334215">index</span><span class="op" id="3334220">]</span><span class="op" id="3334221">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334227">offset</span>&nbsp;<span class="op" id="3334234">=</span>&nbsp;<span class="ident" id="3334236">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334246">b</span><span class="op" id="3334247">.</span><span class="ident" id="3334248">WriteByte</span><span class="op" id="3334257">(</span><span class="string" id="3334258">&#39;\\&#39;</span><span class="op" id="3334262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334272">if</span>&nbsp;<span class="ident" id="3334275">character</span><span class="op" id="3334284">&amp;</span><span class="num" id="3334285">0x80</span>&nbsp;<span class="op" id="3334290">!=</span>&nbsp;<span class="num" id="3334293">0</span>&nbsp;<span class="op" id="3334295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334301">return</span>&nbsp;<span class="string" id="3334308">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334322">b</span><span class="op" id="3334323">.</span><span class="ident" id="3334324">WriteString</span><span class="op" id="3334335">(</span><span class="ident" id="3334336">value</span><span class="op" id="3334341">[</span><span class="ident" id="3334342">offset</span><span class="op" id="3334348">:</span><span class="op" id="3334349">]</span><span class="op" id="3334350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334354">b</span><span class="op" id="3334355">.</span><span class="ident" id="3334356">WriteByte</span><span class="op" id="3334365">(</span><span class="string" id="3334366">&#39;&#34;&#39;</span><span class="op" id="3334369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334372">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334375">return</span>&nbsp;<span class="ident" id="3334382">b</span><span class="op" id="3334383">.</span><span class="ident" id="3334384">String</span><span class="op" id="3334390">(</span><span class="op" id="3334391">)</span><br>
<span class="lineno"></span><span class="op" id="3334393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3334396">func</span>&nbsp;<span class="ident" id="3334401">checkMediaTypeDisposition</span><span class="op" id="3334426">(</span><span class="ident" id="3334427">s</span>&nbsp;<span class="builtintype" id="3334429">string</span><span class="op" id="3334435">)</span>&nbsp;<span class="builtintype" id="3334437">error</span>&nbsp;<span class="op" id="3334443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334446">typ</span><span class="op" id="3334449">,</span>&nbsp;<span class="ident" id="3334451">rest</span>&nbsp;<span class="op" id="3334456">:=</span>&nbsp;<span class="ident" id="3334459">consumeToken</span><span class="op" id="3334471">(</span><span class="ident" id="3334472">s</span><span class="op" id="3334473">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334476">if</span>&nbsp;<span class="ident" id="3334479">typ</span>&nbsp;<span class="op" id="3334483">==</span>&nbsp;<span class="string" id="3334486">&#34;&#34;</span>&nbsp;<span class="op" id="3334489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334493">return</span>&nbsp;<span class="ident" id="3334500">errors</span><span class="op" id="3334506">.</span><span class="ident" id="3334507">New</span><span class="op" id="3334510">(</span><span class="string" id="3334511">&#34;mime:&nbsp;no&nbsp;media&nbsp;type&#34;</span><span class="op" id="3334532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334538">if</span>&nbsp;<span class="ident" id="3334541">rest</span>&nbsp;<span class="op" id="3334546">==</span>&nbsp;<span class="string" id="3334549">&#34;&#34;</span>&nbsp;<span class="op" id="3334552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334556">return</span>&nbsp;<span class="ident" id="3334563">nil</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334571">if</span>&nbsp;<span class="op" id="3334574">!</span><span class="ident" id="3334575">strings</span><span class="op" id="3334582">.</span><span class="ident" id="3334583">HasPrefix</span><span class="op" id="3334592">(</span><span class="ident" id="3334593">rest</span><span class="op" id="3334597">,</span>&nbsp;<span class="string" id="3334599">&#34;/&#34;</span><span class="op" id="3334602">)</span>&nbsp;<span class="op" id="3334604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334608">return</span>&nbsp;<span class="ident" id="3334615">errors</span><span class="op" id="3334621">.</span><span class="ident" id="3334622">New</span><span class="op" id="3334625">(</span><span class="string" id="3334626">&#34;mime:&nbsp;expected&nbsp;slash&nbsp;after&nbsp;first&nbsp;token&#34;</span><span class="op" id="3334666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3334672">subtype</span><span class="op" id="3334679">,</span>&nbsp;<span class="ident" id="3334681">rest</span>&nbsp;<span class="op" id="3334686">:=</span>&nbsp;<span class="ident" id="3334689">consumeToken</span><span class="op" id="3334701">(</span><span class="ident" id="3334702">rest</span><span class="op" id="3334706">[</span><span class="num" id="3334707">1</span><span class="op" id="3334708">:</span><span class="op" id="3334709">]</span><span class="op" id="3334710">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334713">if</span>&nbsp;<span class="ident" id="3334716">subtype</span>&nbsp;<span class="op" id="3334724">==</span>&nbsp;<span class="string" id="3334727">&#34;&#34;</span>&nbsp;<span class="op" id="3334730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334734">return</span>&nbsp;<span class="ident" id="3334741">errors</span><span class="op" id="3334747">.</span><span class="ident" id="3334748">New</span><span class="op" id="3334751">(</span><span class="string" id="3334752">&#34;mime:&nbsp;expected&nbsp;token&nbsp;after&nbsp;slash&#34;</span><span class="op" id="3334786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334792">if</span>&nbsp;<span class="ident" id="3334795">rest</span>&nbsp;<span class="op" id="3334800">!=</span>&nbsp;<span class="string" id="3334803">&#34;&#34;</span>&nbsp;<span class="op" id="3334806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334810">return</span>&nbsp;<span class="ident" id="3334817">errors</span><span class="op" id="3334823">.</span><span class="ident" id="3334824">New</span><span class="op" id="3334827">(</span><span class="string" id="3334828">&#34;mime:&nbsp;unexpected&nbsp;content&nbsp;after&nbsp;media&nbsp;subtype&#34;</span><span class="op" id="3334874">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3334877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3334880">return</span>&nbsp;<span class="ident" id="3334887">nil</span><br>
<span class="lineno"></span><span class="op" id="3334891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3334894">//&nbsp;ParseMediaType&nbsp;parses&nbsp;a&nbsp;media&nbsp;type&nbsp;value&nbsp;and&nbsp;any&nbsp;optional</span><br>
<span class="lineno">95</span><span class="comment" id="3334955">//&nbsp;parameters,&nbsp;per&nbsp;RFC&nbsp;1521.&nbsp;&nbsp;Media&nbsp;types&nbsp;are&nbsp;the&nbsp;values&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3335015">//&nbsp;Content-Type&nbsp;and&nbsp;Content-Disposition&nbsp;headers&nbsp;(RFC&nbsp;2183).</span><br>
<span class="lineno"></span><span class="comment" id="3335075">//&nbsp;On&nbsp;success,&nbsp;ParseMediaType&nbsp;returns&nbsp;the&nbsp;media&nbsp;type&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="3335138">//&nbsp;to&nbsp;lowercase&nbsp;and&nbsp;trimmed&nbsp;of&nbsp;white&nbsp;space&nbsp;and&nbsp;a&nbsp;non-nil&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="3335200">//&nbsp;The&nbsp;returned&nbsp;map,&nbsp;params,&nbsp;maps&nbsp;from&nbsp;the&nbsp;lowercase</span><br>
<span class="lineno">100</span><span class="comment" id="3335253">//&nbsp;attribute&nbsp;to&nbsp;the&nbsp;attribute&nbsp;value&nbsp;with&nbsp;its&nbsp;case&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="keyword" id="3335314">func</span>&nbsp;<span class="ident" id="3335319">ParseMediaType</span><span class="op" id="3335333">(</span><span class="ident" id="3335334">v</span>&nbsp;<span class="builtintype" id="3335336">string</span><span class="op" id="3335342">)</span>&nbsp;<span class="op" id="3335344">(</span><span class="ident" id="3335345">mediatype</span>&nbsp;<span class="builtintype" id="3335355">string</span><span class="op" id="3335361">,</span>&nbsp;<span class="ident" id="3335363">params</span>&nbsp;<span class="keyword" id="3335370">map</span><span class="op" id="3335373">[</span><span class="builtintype" id="3335374">string</span><span class="op" id="3335380">]</span><span class="builtintype" id="3335381">string</span><span class="op" id="3335387">,</span>&nbsp;<span class="ident" id="3335389">err</span>&nbsp;<span class="builtintype" id="3335393">error</span><span class="op" id="3335398">)</span>&nbsp;<span class="op" id="3335400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335403">i</span>&nbsp;<span class="op" id="3335405">:=</span>&nbsp;<span class="ident" id="3335408">strings</span><span class="op" id="3335415">.</span><span class="ident" id="3335416">Index</span><span class="op" id="3335421">(</span><span class="ident" id="3335422">v</span><span class="op" id="3335423">,</span>&nbsp;<span class="string" id="3335425">&#34;;&#34;</span><span class="op" id="3335428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335431">if</span>&nbsp;<span class="ident" id="3335434">i</span>&nbsp;<span class="op" id="3335436">==</span>&nbsp;<span class="op" id="3335439">-</span><span class="num" id="3335440">1</span>&nbsp;<span class="op" id="3335442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335446">i</span>&nbsp;<span class="op" id="3335448">=</span>&nbsp;<span class="builtinfunc" id="3335450">len</span><span class="op" id="3335453">(</span><span class="ident" id="3335454">v</span><span class="op" id="3335455">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3335458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335461">mediatype</span>&nbsp;<span class="op" id="3335471">=</span>&nbsp;<span class="ident" id="3335473">strings</span><span class="op" id="3335480">.</span><span class="ident" id="3335481">TrimSpace</span><span class="op" id="3335490">(</span><span class="ident" id="3335491">strings</span><span class="op" id="3335498">.</span><span class="ident" id="3335499">ToLower</span><span class="op" id="3335506">(</span><span class="ident" id="3335507">v</span><span class="op" id="3335508">[</span><span class="num" id="3335509">0</span><span class="op" id="3335510">:</span><span class="ident" id="3335511">i</span><span class="op" id="3335512">]</span><span class="op" id="3335513">)</span><span class="op" id="3335514">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335518">err</span>&nbsp;<span class="op" id="3335522">=</span>&nbsp;<span class="ident" id="3335524">checkMediaTypeDisposition</span><span class="op" id="3335549">(</span><span class="ident" id="3335550">mediatype</span><span class="op" id="3335559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335562">if</span>&nbsp;<span class="ident" id="3335565">err</span>&nbsp;<span class="op" id="3335569">!=</span>&nbsp;<span class="ident" id="3335572">nil</span>&nbsp;<span class="op" id="3335576">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335580">return</span>&nbsp;<span class="string" id="3335587">&#34;&#34;</span><span class="op" id="3335589">,</span>&nbsp;<span class="ident" id="3335591">nil</span><span class="op" id="3335594">,</span>&nbsp;<span class="ident" id="3335596">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3335601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335605">params</span>&nbsp;<span class="op" id="3335612">=</span>&nbsp;<span class="builtinfunc" id="3335614">make</span><span class="op" id="3335618">(</span><span class="keyword" id="3335619">map</span><span class="op" id="3335622">[</span><span class="builtintype" id="3335623">string</span><span class="op" id="3335629">]</span><span class="builtintype" id="3335630">string</span><span class="op" id="3335636">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3335640">//&nbsp;Map&nbsp;of&nbsp;base&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;parameter&nbsp;name&nbsp;-&gt;&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3335698">//&nbsp;for&nbsp;parameters&nbsp;containing&nbsp;a&nbsp;&#39;*&#39;&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3335745">//&nbsp;Lazily&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335769">var</span>&nbsp;<span class="ident" id="3335773">continuation</span>&nbsp;<span class="keyword" id="3335786">map</span><span class="op" id="3335789">[</span><span class="builtintype" id="3335790">string</span><span class="op" id="3335796">]</span><span class="keyword" id="3335797">map</span><span class="op" id="3335800">[</span><span class="builtintype" id="3335801">string</span><span class="op" id="3335807">]</span><span class="builtintype" id="3335808">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335817">v</span>&nbsp;<span class="op" id="3335819">=</span>&nbsp;<span class="ident" id="3335821">v</span><span class="op" id="3335822">[</span><span class="ident" id="3335823">i</span><span class="op" id="3335824">:</span><span class="op" id="3335825">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335828">for</span>&nbsp;<span class="builtinfunc" id="3335832">len</span><span class="op" id="3335835">(</span><span class="ident" id="3335836">v</span><span class="op" id="3335837">)</span>&nbsp;<span class="op" id="3335839">&gt;</span>&nbsp;<span class="num" id="3335841">0</span>&nbsp;<span class="op" id="3335843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335847">v</span>&nbsp;<span class="op" id="3335849">=</span>&nbsp;<span class="ident" id="3335851">strings</span><span class="op" id="3335858">.</span><span class="ident" id="3335859">TrimLeftFunc</span><span class="op" id="3335871">(</span><span class="ident" id="3335872">v</span><span class="op" id="3335873">,</span>&nbsp;<span class="ident" id="3335875">unicode</span><span class="op" id="3335882">.</span><span class="ident" id="3335883">IsSpace</span><span class="op" id="3335890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335894">if</span>&nbsp;<span class="builtinfunc" id="3335897">len</span><span class="op" id="3335900">(</span><span class="ident" id="3335901">v</span><span class="op" id="3335902">)</span>&nbsp;<span class="op" id="3335904">==</span>&nbsp;<span class="num" id="3335907">0</span>&nbsp;<span class="op" id="3335909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335914">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3335922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3335926">key</span><span class="op" id="3335929">,</span>&nbsp;<span class="ident" id="3335931">value</span><span class="op" id="3335936">,</span>&nbsp;<span class="ident" id="3335938">rest</span>&nbsp;<span class="op" id="3335943">:=</span>&nbsp;<span class="ident" id="3335946">consumeMediaParam</span><span class="op" id="3335963">(</span><span class="ident" id="3335964">v</span><span class="op" id="3335965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335969">if</span>&nbsp;<span class="ident" id="3335972">key</span>&nbsp;<span class="op" id="3335976">==</span>&nbsp;<span class="string" id="3335979">&#34;&#34;</span>&nbsp;<span class="op" id="3335982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3335987">if</span>&nbsp;<span class="ident" id="3335990">strings</span><span class="op" id="3335997">.</span><span class="ident" id="3335998">TrimSpace</span><span class="op" id="3336007">(</span><span class="ident" id="3336008">rest</span><span class="op" id="3336012">)</span>&nbsp;<span class="op" id="3336014">==</span>&nbsp;<span class="string" id="3336017">&#34;;&#34;</span>&nbsp;<span class="op" id="3336021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336027">//&nbsp;Ignore&nbsp;trailing&nbsp;semicolons.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336062">//&nbsp;Not&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336083">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336098">//&nbsp;Parse&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336117">return</span>&nbsp;<span class="string" id="3336124">&#34;&#34;</span><span class="op" id="3336126">,</span>&nbsp;<span class="ident" id="3336128">nil</span><span class="op" id="3336131">,</span>&nbsp;<span class="ident" id="3336133">errors</span><span class="op" id="3336139">.</span><span class="ident" id="3336140">New</span><span class="op" id="3336143">(</span><span class="string" id="3336144">&#34;mime:&nbsp;invalid&nbsp;media&nbsp;parameter&#34;</span><span class="op" id="3336175">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336184">pmap</span>&nbsp;<span class="op" id="3336189">:=</span>&nbsp;<span class="ident" id="3336192">params</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336201">if</span>&nbsp;<span class="ident" id="3336204">idx</span>&nbsp;<span class="op" id="3336208">:=</span>&nbsp;<span class="ident" id="3336211">strings</span><span class="op" id="3336218">.</span><span class="ident" id="3336219">Index</span><span class="op" id="3336224">(</span><span class="ident" id="3336225">key</span><span class="op" id="3336228">,</span>&nbsp;<span class="string" id="3336230">&#34;*&#34;</span><span class="op" id="3336233">)</span><span class="op" id="3336234">;</span>&nbsp;<span class="ident" id="3336236">idx</span>&nbsp;<span class="op" id="3336240">!=</span>&nbsp;<span class="op" id="3336243">-</span><span class="num" id="3336244">1</span>&nbsp;<span class="op" id="3336246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336251">baseName</span>&nbsp;<span class="op" id="3336260">:=</span>&nbsp;<span class="ident" id="3336263">key</span><span class="op" id="3336266">[</span><span class="op" id="3336267">:</span><span class="ident" id="3336268">idx</span><span class="op" id="3336271">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336276">if</span>&nbsp;<span class="ident" id="3336279">continuation</span>&nbsp;<span class="op" id="3336292">==</span>&nbsp;<span class="ident" id="3336295">nil</span>&nbsp;<span class="op" id="3336299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336305">continuation</span>&nbsp;<span class="op" id="3336318">=</span>&nbsp;<span class="builtinfunc" id="3336320">make</span><span class="op" id="3336324">(</span><span class="keyword" id="3336325">map</span><span class="op" id="3336328">[</span><span class="builtintype" id="3336329">string</span><span class="op" id="3336335">]</span><span class="keyword" id="3336336">map</span><span class="op" id="3336339">[</span><span class="builtintype" id="3336340">string</span><span class="op" id="3336346">]</span><span class="builtintype" id="3336347">string</span><span class="op" id="3336353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336363">var</span>&nbsp;<span class="ident" id="3336367">ok</span>&nbsp;<span class="builtintype" id="3336370">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336378">if</span>&nbsp;<span class="ident" id="3336381">pmap</span><span class="op" id="3336385">,</span>&nbsp;<span class="ident" id="3336387">ok</span>&nbsp;<span class="op" id="3336390">=</span>&nbsp;<span class="ident" id="3336392">continuation</span><span class="op" id="3336404">[</span><span class="ident" id="3336405">baseName</span><span class="op" id="3336413">]</span><span class="op" id="3336414">;</span>&nbsp;<span class="op" id="3336416">!</span><span class="ident" id="3336417">ok</span>&nbsp;<span class="op" id="3336420">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336426">continuation</span><span class="op" id="3336438">[</span><span class="ident" id="3336439">baseName</span><span class="op" id="3336447">]</span>&nbsp;<span class="op" id="3336449">=</span>&nbsp;<span class="builtinfunc" id="3336451">make</span><span class="op" id="3336455">(</span><span class="keyword" id="3336456">map</span><span class="op" id="3336459">[</span><span class="builtintype" id="3336460">string</span><span class="op" id="3336466">]</span><span class="builtintype" id="3336467">string</span><span class="op" id="3336473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336479">pmap</span>&nbsp;<span class="op" id="3336484">=</span>&nbsp;<span class="ident" id="3336486">continuation</span><span class="op" id="3336498">[</span><span class="ident" id="3336499">baseName</span><span class="op" id="3336507">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336520">if</span>&nbsp;<span class="ident" id="3336523">_</span><span class="op" id="3336524">,</span>&nbsp;<span class="ident" id="3336526">exists</span>&nbsp;<span class="op" id="3336533">:=</span>&nbsp;<span class="ident" id="3336536">pmap</span><span class="op" id="3336540">[</span><span class="ident" id="3336541">key</span><span class="op" id="3336544">]</span><span class="op" id="3336545">;</span>&nbsp;<span class="ident" id="3336547">exists</span>&nbsp;<span class="op" id="3336554">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336559">//&nbsp;Duplicate&nbsp;parameter&nbsp;name&nbsp;is&nbsp;bogus.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336600">return</span>&nbsp;<span class="string" id="3336607">&#34;&#34;</span><span class="op" id="3336609">,</span>&nbsp;<span class="ident" id="3336611">nil</span><span class="op" id="3336614">,</span>&nbsp;<span class="ident" id="3336616">errors</span><span class="op" id="3336622">.</span><span class="ident" id="3336623">New</span><span class="op" id="3336626">(</span><span class="string" id="3336627">&#34;mime:&nbsp;duplicate&nbsp;parameter&nbsp;name&#34;</span><span class="op" id="3336659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336667">pmap</span><span class="op" id="3336671">[</span><span class="ident" id="3336672">key</span><span class="op" id="3336675">]</span>&nbsp;<span class="op" id="3336677">=</span>&nbsp;<span class="ident" id="3336679">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336687">v</span>&nbsp;<span class="op" id="3336689">=</span>&nbsp;<span class="ident" id="3336691">rest</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3336697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336701">//&nbsp;Stitch&nbsp;together&nbsp;any&nbsp;continuations&nbsp;or&nbsp;things&nbsp;with&nbsp;stars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3336760">//&nbsp;(i.e.&nbsp;RFC&nbsp;2231&nbsp;things&nbsp;with&nbsp;stars:&nbsp;&#34;foo*0&#34;&nbsp;or&nbsp;&#34;foo*&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336817">var</span>&nbsp;<span class="ident" id="3336821">buf</span>&nbsp;<span class="ident" id="3336825">bytes</span><span class="op" id="3336830">.</span><span class="ident" id="3336831">Buffer</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336839">for</span>&nbsp;<span class="ident" id="3336843">key</span><span class="op" id="3336846">,</span>&nbsp;<span class="ident" id="3336848">pieceMap</span>&nbsp;<span class="op" id="3336857">:=</span>&nbsp;<span class="keyword" id="3336860">range</span>&nbsp;<span class="ident" id="3336866">continuation</span>&nbsp;<span class="op" id="3336879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336883">singlePartKey</span>&nbsp;<span class="op" id="3336897">:=</span>&nbsp;<span class="ident" id="3336900">key</span>&nbsp;<span class="op" id="3336904">+</span>&nbsp;<span class="string" id="3336906">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3336912">if</span>&nbsp;<span class="ident" id="3336915">v</span><span class="op" id="3336916">,</span>&nbsp;<span class="ident" id="3336918">ok</span>&nbsp;<span class="op" id="3336921">:=</span>&nbsp;<span class="ident" id="3336924">pieceMap</span><span class="op" id="3336932">[</span><span class="ident" id="3336933">singlePartKey</span><span class="op" id="3336946">]</span><span class="op" id="3336947">;</span>&nbsp;<span class="ident" id="3336949">ok</span>&nbsp;<span class="op" id="3336952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336957">decv</span>&nbsp;<span class="op" id="3336962">:=</span>&nbsp;<span class="ident" id="3336965">decode2231Enc</span><span class="op" id="3336978">(</span><span class="ident" id="3336979">v</span><span class="op" id="3336980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3336985">params</span><span class="op" id="3336991">[</span><span class="ident" id="3336992">key</span><span class="op" id="3336995">]</span>&nbsp;<span class="op" id="3336997">=</span>&nbsp;<span class="ident" id="3336999">decv</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337007">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337023">buf</span><span class="op" id="3337026">.</span><span class="ident" id="3337027">Reset</span><span class="op" id="3337032">(</span><span class="op" id="3337033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337037">valid</span>&nbsp;<span class="op" id="3337043">:=</span>&nbsp;<span class="builtintype" id="3337046">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337054">for</span>&nbsp;<span class="ident" id="3337058">n</span>&nbsp;<span class="op" id="3337060">:=</span>&nbsp;<span class="num" id="3337063">0</span><span class="op" id="3337064">;</span>&nbsp;<span class="op" id="3337066">;</span>&nbsp;<span class="ident" id="3337068">n</span><span class="op" id="3337069">++</span>&nbsp;<span class="op" id="3337072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337077">simplePart</span>&nbsp;<span class="op" id="3337088">:=</span>&nbsp;<span class="ident" id="3337091">fmt</span><span class="op" id="3337094">.</span><span class="ident" id="3337095">Sprintf</span><span class="op" id="3337102">(</span><span class="string" id="3337103">&#34;%s*%d&#34;</span><span class="op" id="3337110">,</span>&nbsp;<span class="ident" id="3337112">key</span><span class="op" id="3337115">,</span>&nbsp;<span class="ident" id="3337117">n</span><span class="op" id="3337118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337123">if</span>&nbsp;<span class="ident" id="3337126">v</span><span class="op" id="3337127">,</span>&nbsp;<span class="ident" id="3337129">ok</span>&nbsp;<span class="op" id="3337132">:=</span>&nbsp;<span class="ident" id="3337135">pieceMap</span><span class="op" id="3337143">[</span><span class="ident" id="3337144">simplePart</span><span class="op" id="3337154">]</span><span class="op" id="3337155">;</span>&nbsp;<span class="ident" id="3337157">ok</span>&nbsp;<span class="op" id="3337160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337166">valid</span>&nbsp;<span class="op" id="3337172">=</span>&nbsp;<span class="builtintype" id="3337174">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337183">buf</span><span class="op" id="3337186">.</span><span class="ident" id="3337187">WriteString</span><span class="op" id="3337198">(</span><span class="ident" id="3337199">v</span><span class="op" id="3337200">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337206">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337223">encodedPart</span>&nbsp;<span class="op" id="3337235">:=</span>&nbsp;<span class="ident" id="3337238">simplePart</span>&nbsp;<span class="op" id="3337249">+</span>&nbsp;<span class="string" id="3337251">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337258">if</span>&nbsp;<span class="ident" id="3337261">v</span><span class="op" id="3337262">,</span>&nbsp;<span class="ident" id="3337264">ok</span>&nbsp;<span class="op" id="3337267">:=</span>&nbsp;<span class="ident" id="3337270">pieceMap</span><span class="op" id="3337278">[</span><span class="ident" id="3337279">encodedPart</span><span class="op" id="3337290">]</span><span class="op" id="3337291">;</span>&nbsp;<span class="ident" id="3337293">ok</span>&nbsp;<span class="op" id="3337296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337302">valid</span>&nbsp;<span class="op" id="3337308">=</span>&nbsp;<span class="builtintype" id="3337310">true</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337319">if</span>&nbsp;<span class="ident" id="3337322">n</span>&nbsp;<span class="op" id="3337324">==</span>&nbsp;<span class="num" id="3337327">0</span>&nbsp;<span class="op" id="3337329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337336">buf</span><span class="op" id="3337339">.</span><span class="ident" id="3337340">WriteString</span><span class="op" id="3337351">(</span><span class="ident" id="3337352">decode2231Enc</span><span class="op" id="3337365">(</span><span class="ident" id="3337366">v</span><span class="op" id="3337367">)</span><span class="op" id="3337368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337374">}</span>&nbsp;<span class="keyword" id="3337376">else</span>&nbsp;<span class="op" id="3337381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337388">decv</span><span class="op" id="3337392">,</span>&nbsp;<span class="ident" id="3337394">_</span>&nbsp;<span class="op" id="3337396">:=</span>&nbsp;<span class="ident" id="3337399">percentHexUnescape</span><span class="op" id="3337417">(</span><span class="ident" id="3337418">v</span><span class="op" id="3337419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337426">buf</span><span class="op" id="3337429">.</span><span class="ident" id="3337430">WriteString</span><span class="op" id="3337441">(</span><span class="ident" id="3337442">decv</span><span class="op" id="3337446">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337457">}</span>&nbsp;<span class="keyword" id="3337459">else</span>&nbsp;<span class="op" id="3337464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337470">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337483">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337487">if</span>&nbsp;<span class="ident" id="3337490">valid</span>&nbsp;<span class="op" id="3337496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337501">params</span><span class="op" id="3337507">[</span><span class="ident" id="3337508">key</span><span class="op" id="3337511">]</span>&nbsp;<span class="op" id="3337513">=</span>&nbsp;<span class="ident" id="3337515">buf</span><span class="op" id="3337518">.</span><span class="ident" id="3337519">String</span><span class="op" id="3337525">(</span><span class="op" id="3337526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337537">return</span><br>
<span class="lineno"></span><span class="op" id="3337544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3337547">func</span>&nbsp;<span class="ident" id="3337552">decode2231Enc</span><span class="op" id="3337565">(</span><span class="ident" id="3337566">v</span>&nbsp;<span class="builtintype" id="3337568">string</span><span class="op" id="3337574">)</span>&nbsp;<span class="builtintype" id="3337576">string</span>&nbsp;<span class="op" id="3337583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337586">sv</span>&nbsp;<span class="op" id="3337589">:=</span>&nbsp;<span class="ident" id="3337592">strings</span><span class="op" id="3337599">.</span><span class="ident" id="3337600">SplitN</span><span class="op" id="3337606">(</span><span class="ident" id="3337607">v</span><span class="op" id="3337608">,</span>&nbsp;<span class="string" id="3337610">&#34;&#39;&#34;</span><span class="op" id="3337613">,</span>&nbsp;<span class="num" id="3337615">3</span><span class="op" id="3337616">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337619">if</span>&nbsp;<span class="builtinfunc" id="3337622">len</span><span class="op" id="3337625">(</span><span class="ident" id="3337626">sv</span><span class="op" id="3337628">)</span>&nbsp;<span class="op" id="3337630">!=</span>&nbsp;<span class="num" id="3337633">3</span>&nbsp;<span class="op" id="3337635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337639">return</span>&nbsp;<span class="string" id="3337646">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3337653">//&nbsp;TODO:&nbsp;ignoring&nbsp;lang&nbsp;in&nbsp;sv[1]&nbsp;for&nbsp;now.&nbsp;If&nbsp;anybody&nbsp;needs&nbsp;it&nbsp;we&#39;ll</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3337721">//&nbsp;need&nbsp;to&nbsp;decide&nbsp;how&nbsp;to&nbsp;expose&nbsp;it&nbsp;in&nbsp;the&nbsp;API.&nbsp;But&nbsp;I&#39;m&nbsp;not&nbsp;sure</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3337786">//&nbsp;anybody&nbsp;uses&nbsp;it&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337819">charset</span>&nbsp;<span class="op" id="3337827">:=</span>&nbsp;<span class="ident" id="3337830">strings</span><span class="op" id="3337837">.</span><span class="ident" id="3337838">ToLower</span><span class="op" id="3337845">(</span><span class="ident" id="3337846">sv</span><span class="op" id="3337848">[</span><span class="num" id="3337849">0</span><span class="op" id="3337850">]</span><span class="op" id="3337851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337854">if</span>&nbsp;<span class="ident" id="3337857">charset</span>&nbsp;<span class="op" id="3337865">!=</span>&nbsp;<span class="string" id="3337868">&#34;us-ascii&#34;</span>&nbsp;<span class="op" id="3337879">&amp;&amp;</span>&nbsp;<span class="ident" id="3337882">charset</span>&nbsp;<span class="op" id="3337890">!=</span>&nbsp;<span class="string" id="3337893">&#34;utf-8&#34;</span>&nbsp;<span class="op" id="3337901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3337905">//&nbsp;TODO:&nbsp;unsupported&nbsp;encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337937">return</span>&nbsp;<span class="string" id="3337944">&#34;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3337948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3337951">encv</span><span class="op" id="3337955">,</span>&nbsp;<span class="ident" id="3337957">_</span>&nbsp;<span class="op" id="3337959">:=</span>&nbsp;<span class="ident" id="3337962">percentHexUnescape</span><span class="op" id="3337980">(</span><span class="ident" id="3337981">sv</span><span class="op" id="3337983">[</span><span class="num" id="3337984">2</span><span class="op" id="3337985">]</span><span class="op" id="3337986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3337989">return</span>&nbsp;<span class="ident" id="3337996">encv</span><br>
<span class="lineno"></span><span class="op" id="3338001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="3338004">func</span>&nbsp;<span class="ident" id="3338009">isNotTokenChar</span><span class="op" id="3338023">(</span><span class="ident" id="3338024">r</span>&nbsp;<span class="builtintype" id="3338026">rune</span><span class="op" id="3338030">)</span>&nbsp;<span class="builtintype" id="3338032">bool</span>&nbsp;<span class="op" id="3338037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338040">return</span>&nbsp;<span class="op" id="3338047">!</span><span class="ident" id="3338048">isTokenChar</span><span class="op" id="3338059">(</span><span class="ident" id="3338060">r</span><span class="op" id="3338061">)</span><br>
<span class="lineno"></span><span class="op" id="3338063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3338066">//&nbsp;consumeToken&nbsp;consumes&nbsp;a&nbsp;token&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;provided</span><br>
<span class="lineno">220</span><span class="comment" id="3338130">//&nbsp;string,&nbsp;per&nbsp;RFC&nbsp;2045&nbsp;section&nbsp;5.1&nbsp;(referenced&nbsp;from&nbsp;2183),&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3338201">//&nbsp;the&nbsp;token&nbsp;consumed&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;Returns&nbsp;(&#34;&#34;,&nbsp;v)&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3338271">//&nbsp;failure&nbsp;to&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="3338317">func</span>&nbsp;<span class="ident" id="3338322">consumeToken</span><span class="op" id="3338334">(</span><span class="ident" id="3338335">v</span>&nbsp;<span class="builtintype" id="3338337">string</span><span class="op" id="3338343">)</span>&nbsp;<span class="op" id="3338345">(</span><span class="ident" id="3338346">token</span><span class="op" id="3338351">,</span>&nbsp;<span class="ident" id="3338353">rest</span>&nbsp;<span class="builtintype" id="3338358">string</span><span class="op" id="3338364">)</span>&nbsp;<span class="op" id="3338366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338369">notPos</span>&nbsp;<span class="op" id="3338376">:=</span>&nbsp;<span class="ident" id="3338379">strings</span><span class="op" id="3338386">.</span><span class="ident" id="3338387">IndexFunc</span><span class="op" id="3338396">(</span><span class="ident" id="3338397">v</span><span class="op" id="3338398">,</span>&nbsp;<span class="ident" id="3338400">isNotTokenChar</span><span class="op" id="3338414">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338417">if</span>&nbsp;<span class="ident" id="3338420">notPos</span>&nbsp;<span class="op" id="3338427">==</span>&nbsp;<span class="op" id="3338430">-</span><span class="num" id="3338431">1</span>&nbsp;<span class="op" id="3338433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338437">return</span>&nbsp;<span class="ident" id="3338444">v</span><span class="op" id="3338445">,</span>&nbsp;<span class="string" id="3338447">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338454">if</span>&nbsp;<span class="ident" id="3338457">notPos</span>&nbsp;<span class="op" id="3338464">==</span>&nbsp;<span class="num" id="3338467">0</span>&nbsp;<span class="op" id="3338469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338473">return</span>&nbsp;<span class="string" id="3338480">&#34;&#34;</span><span class="op" id="3338482">,</span>&nbsp;<span class="ident" id="3338484">v</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338490">return</span>&nbsp;<span class="ident" id="3338497">v</span><span class="op" id="3338498">[</span><span class="num" id="3338499">0</span><span class="op" id="3338500">:</span><span class="ident" id="3338501">notPos</span><span class="op" id="3338507">]</span><span class="op" id="3338508">,</span>&nbsp;<span class="ident" id="3338510">v</span><span class="op" id="3338511">[</span><span class="ident" id="3338512">notPos</span><span class="op" id="3338518">:</span><span class="op" id="3338519">]</span><br>
<span class="lineno"></span><span class="op" id="3338521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3338524">//&nbsp;consumeValue&nbsp;consumes&nbsp;a&nbsp;&#34;value&#34;&nbsp;per&nbsp;RFC&nbsp;2045,&nbsp;where&nbsp;a&nbsp;value&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="3338590">//&nbsp;either&nbsp;a&nbsp;&#39;token&#39;&nbsp;or&nbsp;a&nbsp;&#39;quoted-string&#39;.&nbsp;&nbsp;On&nbsp;success,&nbsp;consumeValue</span><br>
<span class="lineno"></span><span class="comment" id="3338658">//&nbsp;returns&nbsp;the&nbsp;value&nbsp;consumed&nbsp;(and&nbsp;de-quoted/escaped,&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3338717">//&nbsp;quoted-string)&nbsp;and&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;string.&nbsp;&nbsp;On&nbsp;failure,&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3338784">//&nbsp;(&#34;&#34;,&nbsp;v).</span><br>
<span class="lineno"></span><span class="keyword" id="3338796">func</span>&nbsp;<span class="ident" id="3338801">consumeValue</span><span class="op" id="3338813">(</span><span class="ident" id="3338814">v</span>&nbsp;<span class="builtintype" id="3338816">string</span><span class="op" id="3338822">)</span>&nbsp;<span class="op" id="3338824">(</span><span class="ident" id="3338825">value</span><span class="op" id="3338830">,</span>&nbsp;<span class="ident" id="3338832">rest</span>&nbsp;<span class="builtintype" id="3338837">string</span><span class="op" id="3338843">)</span>&nbsp;<span class="op" id="3338845">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338848">if</span>&nbsp;<span class="op" id="3338851">!</span><span class="ident" id="3338852">strings</span><span class="op" id="3338859">.</span><span class="ident" id="3338860">HasPrefix</span><span class="op" id="3338869">(</span><span class="ident" id="3338870">v</span><span class="op" id="3338871">,</span>&nbsp;<span class="string" id="3338873">`&#34;`</span><span class="op" id="3338876">)</span>&nbsp;<span class="op" id="3338878">&amp;&amp;</span>&nbsp;<span class="op" id="3338881">!</span><span class="ident" id="3338882">strings</span><span class="op" id="3338889">.</span><span class="ident" id="3338890">HasPrefix</span><span class="op" id="3338899">(</span><span class="ident" id="3338900">v</span><span class="op" id="3338901">,</span>&nbsp;<span class="string" id="3338903">`&#39;`</span><span class="op" id="3338906">)</span>&nbsp;<span class="op" id="3338908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3338912">return</span>&nbsp;<span class="ident" id="3338919">consumeToken</span><span class="op" id="3338931">(</span><span class="ident" id="3338932">v</span><span class="op" id="3338933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3338936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338940">leadQuote</span>&nbsp;<span class="op" id="3338950">:=</span>&nbsp;<span class="builtintype" id="3338953">rune</span><span class="op" id="3338957">(</span><span class="ident" id="3338958">v</span><span class="op" id="3338959">[</span><span class="num" id="3338960">0</span><span class="op" id="3338961">]</span><span class="op" id="3338962">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3338966">//&nbsp;parse&nbsp;a&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3338992">rest</span>&nbsp;<span class="op" id="3338997">=</span>&nbsp;<span class="ident" id="3338999">v</span><span class="op" id="3339000">[</span><span class="num" id="3339001">1</span><span class="op" id="3339002">:</span><span class="op" id="3339003">]</span>&nbsp;<span class="comment" id="3339005">//&nbsp;consume&nbsp;the&nbsp;leading&nbsp;quote</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339035">buffer</span>&nbsp;<span class="op" id="3339042">:=</span>&nbsp;<span class="builtinfunc" id="3339045">new</span><span class="op" id="3339048">(</span><span class="ident" id="3339049">bytes</span><span class="op" id="3339054">.</span><span class="ident" id="3339055">Buffer</span><span class="op" id="3339061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339064">var</span>&nbsp;<span class="ident" id="3339068">idx</span>&nbsp;<span class="builtintype" id="3339072">int</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339077">var</span>&nbsp;<span class="ident" id="3339081">r</span>&nbsp;<span class="builtintype" id="3339083">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339089">var</span>&nbsp;<span class="ident" id="3339093">nextIsLiteral</span>&nbsp;<span class="builtintype" id="3339107">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339113">for</span>&nbsp;<span class="ident" id="3339117">idx</span><span class="op" id="3339120">,</span>&nbsp;<span class="ident" id="3339122">r</span>&nbsp;<span class="op" id="3339124">=</span>&nbsp;<span class="keyword" id="3339126">range</span>&nbsp;<span class="ident" id="3339132">rest</span>&nbsp;<span class="op" id="3339137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339141">switch</span>&nbsp;<span class="op" id="3339148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339152">case</span>&nbsp;<span class="ident" id="3339157">nextIsLiteral</span><span class="op" id="3339170">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339175">buffer</span><span class="op" id="3339181">.</span><span class="ident" id="3339182">WriteRune</span><span class="op" id="3339191">(</span><span class="ident" id="3339192">r</span><span class="op" id="3339193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339198">nextIsLiteral</span>&nbsp;<span class="op" id="3339212">=</span>&nbsp;<span class="builtintype" id="3339214">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339222">case</span>&nbsp;<span class="ident" id="3339227">r</span>&nbsp;<span class="op" id="3339229">==</span>&nbsp;<span class="ident" id="3339232">leadQuote</span><span class="op" id="3339241">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339246">return</span>&nbsp;<span class="ident" id="3339253">buffer</span><span class="op" id="3339259">.</span><span class="ident" id="3339260">String</span><span class="op" id="3339266">(</span><span class="op" id="3339267">)</span><span class="op" id="3339268">,</span>&nbsp;<span class="ident" id="3339270">rest</span><span class="op" id="3339274">[</span><span class="ident" id="3339275">idx</span><span class="op" id="3339278">+</span><span class="num" id="3339279">1</span><span class="op" id="3339280">:</span><span class="op" id="3339281">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339285">case</span>&nbsp;<span class="ident" id="3339290">r</span>&nbsp;<span class="op" id="3339292">==</span>&nbsp;<span class="string" id="3339295">&#39;\\&#39;</span><span class="op" id="3339299">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339304">nextIsLiteral</span>&nbsp;<span class="op" id="3339318">=</span>&nbsp;<span class="builtintype" id="3339320">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339327">case</span>&nbsp;<span class="ident" id="3339332">r</span>&nbsp;<span class="op" id="3339334">!=</span>&nbsp;<span class="string" id="3339337">&#39;\r&#39;</span>&nbsp;<span class="op" id="3339342">&amp;&amp;</span>&nbsp;<span class="ident" id="3339345">r</span>&nbsp;<span class="op" id="3339347">!=</span>&nbsp;<span class="string" id="3339350">&#39;\n&#39;</span><span class="op" id="3339354">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339359">buffer</span><span class="op" id="3339365">.</span><span class="ident" id="3339366">WriteRune</span><span class="op" id="3339375">(</span><span class="ident" id="3339376">r</span><span class="op" id="3339377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339381">default</span><span class="op" id="3339388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339393">return</span>&nbsp;<span class="string" id="3339400">&#34;&#34;</span><span class="op" id="3339402">,</span>&nbsp;<span class="ident" id="3339404">v</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339414">return</span>&nbsp;<span class="string" id="3339421">&#34;&#34;</span><span class="op" id="3339423">,</span>&nbsp;<span class="ident" id="3339425">v</span><br>
<span class="lineno"></span><span class="op" id="3339427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="3339430">func</span>&nbsp;<span class="ident" id="3339435">consumeMediaParam</span><span class="op" id="3339452">(</span><span class="ident" id="3339453">v</span>&nbsp;<span class="builtintype" id="3339455">string</span><span class="op" id="3339461">)</span>&nbsp;<span class="op" id="3339463">(</span><span class="ident" id="3339464">param</span><span class="op" id="3339469">,</span>&nbsp;<span class="ident" id="3339471">value</span><span class="op" id="3339476">,</span>&nbsp;<span class="ident" id="3339478">rest</span>&nbsp;<span class="builtintype" id="3339483">string</span><span class="op" id="3339489">)</span>&nbsp;<span class="op" id="3339491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339494">rest</span>&nbsp;<span class="op" id="3339499">=</span>&nbsp;<span class="ident" id="3339501">strings</span><span class="op" id="3339508">.</span><span class="ident" id="3339509">TrimLeftFunc</span><span class="op" id="3339521">(</span><span class="ident" id="3339522">v</span><span class="op" id="3339523">,</span>&nbsp;<span class="ident" id="3339525">unicode</span><span class="op" id="3339532">.</span><span class="ident" id="3339533">IsSpace</span><span class="op" id="3339540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339543">if</span>&nbsp;<span class="op" id="3339546">!</span><span class="ident" id="3339547">strings</span><span class="op" id="3339554">.</span><span class="ident" id="3339555">HasPrefix</span><span class="op" id="3339564">(</span><span class="ident" id="3339565">rest</span><span class="op" id="3339569">,</span>&nbsp;<span class="string" id="3339571">&#34;;&#34;</span><span class="op" id="3339574">)</span>&nbsp;<span class="op" id="3339576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339580">return</span>&nbsp;<span class="string" id="3339587">&#34;&#34;</span><span class="op" id="3339589">,</span>&nbsp;<span class="string" id="3339591">&#34;&#34;</span><span class="op" id="3339593">,</span>&nbsp;<span class="ident" id="3339595">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339598">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339602">rest</span>&nbsp;<span class="op" id="3339607">=</span>&nbsp;<span class="ident" id="3339609">rest</span><span class="op" id="3339613">[</span><span class="num" id="3339614">1</span><span class="op" id="3339615">:</span><span class="op" id="3339616">]</span>&nbsp;<span class="comment" id="3339618">//&nbsp;consume&nbsp;semicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339640">rest</span>&nbsp;<span class="op" id="3339645">=</span>&nbsp;<span class="ident" id="3339647">strings</span><span class="op" id="3339654">.</span><span class="ident" id="3339655">TrimLeftFunc</span><span class="op" id="3339667">(</span><span class="ident" id="3339668">rest</span><span class="op" id="3339672">,</span>&nbsp;<span class="ident" id="3339674">unicode</span><span class="op" id="3339681">.</span><span class="ident" id="3339682">IsSpace</span><span class="op" id="3339689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339692">param</span><span class="op" id="3339697">,</span>&nbsp;<span class="ident" id="3339699">rest</span>&nbsp;<span class="op" id="3339704">=</span>&nbsp;<span class="ident" id="3339706">consumeToken</span><span class="op" id="3339718">(</span><span class="ident" id="3339719">rest</span><span class="op" id="3339723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339726">param</span>&nbsp;<span class="op" id="3339732">=</span>&nbsp;<span class="ident" id="3339734">strings</span><span class="op" id="3339741">.</span><span class="ident" id="3339742">ToLower</span><span class="op" id="3339749">(</span><span class="ident" id="3339750">param</span><span class="op" id="3339755">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339758">if</span>&nbsp;<span class="ident" id="3339761">param</span>&nbsp;<span class="op" id="3339767">==</span>&nbsp;<span class="string" id="3339770">&#34;&#34;</span>&nbsp;<span class="op" id="3339773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339777">return</span>&nbsp;<span class="string" id="3339784">&#34;&#34;</span><span class="op" id="3339786">,</span>&nbsp;<span class="string" id="3339788">&#34;&#34;</span><span class="op" id="3339790">,</span>&nbsp;<span class="ident" id="3339792">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339799">rest</span>&nbsp;<span class="op" id="3339804">=</span>&nbsp;<span class="ident" id="3339806">strings</span><span class="op" id="3339813">.</span><span class="ident" id="3339814">TrimLeftFunc</span><span class="op" id="3339826">(</span><span class="ident" id="3339827">rest</span><span class="op" id="3339831">,</span>&nbsp;<span class="ident" id="3339833">unicode</span><span class="op" id="3339840">.</span><span class="ident" id="3339841">IsSpace</span><span class="op" id="3339848">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339851">if</span>&nbsp;<span class="op" id="3339854">!</span><span class="ident" id="3339855">strings</span><span class="op" id="3339862">.</span><span class="ident" id="3339863">HasPrefix</span><span class="op" id="3339872">(</span><span class="ident" id="3339873">rest</span><span class="op" id="3339877">,</span>&nbsp;<span class="string" id="3339879">&#34;=&#34;</span><span class="op" id="3339882">)</span>&nbsp;<span class="op" id="3339884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3339888">return</span>&nbsp;<span class="string" id="3339895">&#34;&#34;</span><span class="op" id="3339897">,</span>&nbsp;<span class="string" id="3339899">&#34;&#34;</span><span class="op" id="3339901">,</span>&nbsp;<span class="ident" id="3339903">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3339906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339909">rest</span>&nbsp;<span class="op" id="3339914">=</span>&nbsp;<span class="ident" id="3339916">rest</span><span class="op" id="3339920">[</span><span class="num" id="3339921">1</span><span class="op" id="3339922">:</span><span class="op" id="3339923">]</span>&nbsp;<span class="comment" id="3339925">//&nbsp;consume&nbsp;equals&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3339949">rest</span>&nbsp;<span class="op" id="3339954">=</span>&nbsp;<span class="ident" id="3339956">strings</span><span class="op" id="3339963">.</span><span class="ident" id="3339964">TrimLeftFunc</span><span class="op" id="3339976">(</span><span class="ident" id="3339977">rest</span><span class="op" id="3339981">,</span>&nbsp;<span class="ident" id="3339983">unicode</span><span class="op" id="3339990">.</span><span class="ident" id="3339991">IsSpace</span><span class="op" id="3339998">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340001">value</span><span class="op" id="3340006">,</span>&nbsp;<span class="ident" id="3340008">rest</span>&nbsp;<span class="op" id="3340013">=</span>&nbsp;<span class="ident" id="3340015">consumeValue</span><span class="op" id="3340027">(</span><span class="ident" id="3340028">rest</span><span class="op" id="3340032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340035">if</span>&nbsp;<span class="ident" id="3340038">value</span>&nbsp;<span class="op" id="3340044">==</span>&nbsp;<span class="string" id="3340047">&#34;&#34;</span>&nbsp;<span class="op" id="3340050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340054">return</span>&nbsp;<span class="string" id="3340061">&#34;&#34;</span><span class="op" id="3340063">,</span>&nbsp;<span class="string" id="3340065">&#34;&#34;</span><span class="op" id="3340067">,</span>&nbsp;<span class="ident" id="3340069">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340075">return</span>&nbsp;<span class="ident" id="3340082">param</span><span class="op" id="3340087">,</span>&nbsp;<span class="ident" id="3340089">value</span><span class="op" id="3340094">,</span>&nbsp;<span class="ident" id="3340096">rest</span><br>
<span class="lineno">295</span><span class="op" id="3340101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3340104">func</span>&nbsp;<span class="ident" id="3340109">percentHexUnescape</span><span class="op" id="3340127">(</span><span class="ident" id="3340128">s</span>&nbsp;<span class="builtintype" id="3340130">string</span><span class="op" id="3340136">)</span>&nbsp;<span class="op" id="3340138">(</span><span class="builtintype" id="3340139">string</span><span class="op" id="3340145">,</span>&nbsp;<span class="builtintype" id="3340147">error</span><span class="op" id="3340152">)</span>&nbsp;<span class="op" id="3340154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3340157">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340202">percents</span>&nbsp;<span class="op" id="3340211">:=</span>&nbsp;<span class="num" id="3340214">0</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340217">for</span>&nbsp;<span class="ident" id="3340221">i</span>&nbsp;<span class="op" id="3340223">:=</span>&nbsp;<span class="num" id="3340226">0</span><span class="op" id="3340227">;</span>&nbsp;<span class="ident" id="3340229">i</span>&nbsp;<span class="op" id="3340231">&lt;</span>&nbsp;<span class="builtinfunc" id="3340233">len</span><span class="op" id="3340236">(</span><span class="ident" id="3340237">s</span><span class="op" id="3340238">)</span><span class="op" id="3340239">;</span>&nbsp;<span class="op" id="3340241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340245">if</span>&nbsp;<span class="ident" id="3340248">s</span><span class="op" id="3340249">[</span><span class="ident" id="3340250">i</span><span class="op" id="3340251">]</span>&nbsp;<span class="op" id="3340253">!=</span>&nbsp;<span class="string" id="3340256">&#39;%&#39;</span>&nbsp;<span class="op" id="3340260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340265">i</span><span class="op" id="3340266">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340272">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340283">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340287">percents</span><span class="op" id="3340295">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340300">if</span>&nbsp;<span class="ident" id="3340303">i</span><span class="op" id="3340304">+</span><span class="num" id="3340305">2</span>&nbsp;<span class="op" id="3340307">&gt;=</span>&nbsp;<span class="builtinfunc" id="3340310">len</span><span class="op" id="3340313">(</span><span class="ident" id="3340314">s</span><span class="op" id="3340315">)</span>&nbsp;<span class="op" id="3340317">||</span>&nbsp;<span class="op" id="3340320">!</span><span class="ident" id="3340321">ishex</span><span class="op" id="3340326">(</span><span class="ident" id="3340327">s</span><span class="op" id="3340328">[</span><span class="ident" id="3340329">i</span><span class="op" id="3340330">+</span><span class="num" id="3340331">1</span><span class="op" id="3340332">]</span><span class="op" id="3340333">)</span>&nbsp;<span class="op" id="3340335">||</span>&nbsp;<span class="op" id="3340338">!</span><span class="ident" id="3340339">ishex</span><span class="op" id="3340344">(</span><span class="ident" id="3340345">s</span><span class="op" id="3340346">[</span><span class="ident" id="3340347">i</span><span class="op" id="3340348">+</span><span class="num" id="3340349">2</span><span class="op" id="3340350">]</span><span class="op" id="3340351">)</span>&nbsp;<span class="op" id="3340353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340358">s</span>&nbsp;<span class="op" id="3340360">=</span>&nbsp;<span class="ident" id="3340362">s</span><span class="op" id="3340363">[</span><span class="ident" id="3340364">i</span><span class="op" id="3340365">:</span><span class="op" id="3340366">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340371">if</span>&nbsp;<span class="builtinfunc" id="3340374">len</span><span class="op" id="3340377">(</span><span class="ident" id="3340378">s</span><span class="op" id="3340379">)</span>&nbsp;<span class="op" id="3340381">&gt;</span>&nbsp;<span class="num" id="3340383">3</span>&nbsp;<span class="op" id="3340385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340391">s</span>&nbsp;<span class="op" id="3340393">=</span>&nbsp;<span class="ident" id="3340395">s</span><span class="op" id="3340396">[</span><span class="num" id="3340397">0</span><span class="op" id="3340398">:</span><span class="num" id="3340399">3</span><span class="op" id="3340400">]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340410">return</span>&nbsp;<span class="string" id="3340417">&#34;&#34;</span><span class="op" id="3340419">,</span>&nbsp;<span class="ident" id="3340421">fmt</span><span class="op" id="3340424">.</span><span class="ident" id="3340425">Errorf</span><span class="op" id="3340431">(</span><span class="string" id="3340432">&#34;mime:&nbsp;bogus&nbsp;characters&nbsp;after&nbsp;%%:&nbsp;%q&#34;</span><span class="op" id="3340469">,</span>&nbsp;<span class="ident" id="3340471">s</span><span class="op" id="3340472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340480">i</span>&nbsp;<span class="op" id="3340482">+=</span>&nbsp;<span class="num" id="3340485">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340488">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340491">if</span>&nbsp;<span class="ident" id="3340494">percents</span>&nbsp;<span class="op" id="3340503">==</span>&nbsp;<span class="num" id="3340506">0</span>&nbsp;<span class="op" id="3340508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340512">return</span>&nbsp;<span class="ident" id="3340519">s</span><span class="op" id="3340520">,</span>&nbsp;<span class="ident" id="3340522">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340531">t</span>&nbsp;<span class="op" id="3340533">:=</span>&nbsp;<span class="builtinfunc" id="3340536">make</span><span class="op" id="3340540">(</span><span class="op" id="3340541">[</span><span class="op" id="3340542">]</span><span class="builtintype" id="3340543">byte</span><span class="op" id="3340547">,</span>&nbsp;<span class="builtinfunc" id="3340549">len</span><span class="op" id="3340552">(</span><span class="ident" id="3340553">s</span><span class="op" id="3340554">)</span><span class="op" id="3340555">-</span><span class="num" id="3340556">2</span><span class="op" id="3340557">*</span><span class="ident" id="3340558">percents</span><span class="op" id="3340566">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340569">j</span>&nbsp;<span class="op" id="3340571">:=</span>&nbsp;<span class="num" id="3340574">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340577">for</span>&nbsp;<span class="ident" id="3340581">i</span>&nbsp;<span class="op" id="3340583">:=</span>&nbsp;<span class="num" id="3340586">0</span><span class="op" id="3340587">;</span>&nbsp;<span class="ident" id="3340589">i</span>&nbsp;<span class="op" id="3340591">&lt;</span>&nbsp;<span class="builtinfunc" id="3340593">len</span><span class="op" id="3340596">(</span><span class="ident" id="3340597">s</span><span class="op" id="3340598">)</span><span class="op" id="3340599">;</span>&nbsp;<span class="op" id="3340601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340605">switch</span>&nbsp;<span class="ident" id="3340612">s</span><span class="op" id="3340613">[</span><span class="ident" id="3340614">i</span><span class="op" id="3340615">]</span>&nbsp;<span class="op" id="3340617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340621">case</span>&nbsp;<span class="string" id="3340626">&#39;%&#39;</span><span class="op" id="3340629">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340634">t</span><span class="op" id="3340635">[</span><span class="ident" id="3340636">j</span><span class="op" id="3340637">]</span>&nbsp;<span class="op" id="3340639">=</span>&nbsp;<span class="ident" id="3340641">unhex</span><span class="op" id="3340646">(</span><span class="ident" id="3340647">s</span><span class="op" id="3340648">[</span><span class="ident" id="3340649">i</span><span class="op" id="3340650">+</span><span class="num" id="3340651">1</span><span class="op" id="3340652">]</span><span class="op" id="3340653">)</span><span class="op" id="3340654">&lt;&lt;</span><span class="num" id="3340656">4</span>&nbsp;<span class="op" id="3340658">|</span>&nbsp;<span class="ident" id="3340660">unhex</span><span class="op" id="3340665">(</span><span class="ident" id="3340666">s</span><span class="op" id="3340667">[</span><span class="ident" id="3340668">i</span><span class="op" id="3340669">+</span><span class="num" id="3340670">2</span><span class="op" id="3340671">]</span><span class="op" id="3340672">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340677">j</span><span class="op" id="3340678">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340684">i</span>&nbsp;<span class="op" id="3340686">+=</span>&nbsp;<span class="num" id="3340689">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340693">default</span><span class="op" id="3340700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340705">t</span><span class="op" id="3340706">[</span><span class="ident" id="3340707">j</span><span class="op" id="3340708">]</span>&nbsp;<span class="op" id="3340710">=</span>&nbsp;<span class="ident" id="3340712">s</span><span class="op" id="3340713">[</span><span class="ident" id="3340714">i</span><span class="op" id="3340715">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340720">j</span><span class="op" id="3340721">++</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3340727">i</span><span class="op" id="3340728">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340739">return</span>&nbsp;<span class="builtintype" id="3340746">string</span><span class="op" id="3340752">(</span><span class="ident" id="3340753">t</span><span class="op" id="3340754">)</span><span class="op" id="3340755">,</span>&nbsp;<span class="ident" id="3340757">nil</span><br>
<span class="lineno"></span><span class="op" id="3340761">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="keyword" id="3340764">func</span>&nbsp;<span class="ident" id="3340769">ishex</span><span class="op" id="3340774">(</span><span class="ident" id="3340775">c</span>&nbsp;<span class="builtintype" id="3340777">byte</span><span class="op" id="3340781">)</span>&nbsp;<span class="builtintype" id="3340783">bool</span>&nbsp;<span class="op" id="3340788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340791">switch</span>&nbsp;<span class="op" id="3340798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340801">case</span>&nbsp;<span class="string" id="3340806">&#39;0&#39;</span>&nbsp;<span class="op" id="3340810">&lt;=</span>&nbsp;<span class="ident" id="3340813">c</span>&nbsp;<span class="op" id="3340815">&amp;&amp;</span>&nbsp;<span class="ident" id="3340818">c</span>&nbsp;<span class="op" id="3340820">&lt;=</span>&nbsp;<span class="string" id="3340823">&#39;9&#39;</span><span class="op" id="3340826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340830">return</span>&nbsp;<span class="builtintype" id="3340837">true</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340843">case</span>&nbsp;<span class="string" id="3340848">&#39;a&#39;</span>&nbsp;<span class="op" id="3340852">&lt;=</span>&nbsp;<span class="ident" id="3340855">c</span>&nbsp;<span class="op" id="3340857">&amp;&amp;</span>&nbsp;<span class="ident" id="3340860">c</span>&nbsp;<span class="op" id="3340862">&lt;=</span>&nbsp;<span class="string" id="3340865">&#39;f&#39;</span><span class="op" id="3340868">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340872">return</span>&nbsp;<span class="builtintype" id="3340879">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340885">case</span>&nbsp;<span class="string" id="3340890">&#39;A&#39;</span>&nbsp;<span class="op" id="3340894">&lt;=</span>&nbsp;<span class="ident" id="3340897">c</span>&nbsp;<span class="op" id="3340899">&amp;&amp;</span>&nbsp;<span class="ident" id="3340902">c</span>&nbsp;<span class="op" id="3340904">&lt;=</span>&nbsp;<span class="string" id="3340907">&#39;F&#39;</span><span class="op" id="3340910">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340914">return</span>&nbsp;<span class="builtintype" id="3340921">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3340927">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340930">return</span>&nbsp;<span class="builtintype" id="3340937">false</span><br>
<span class="lineno"></span><span class="op" id="3340943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3340946">func</span>&nbsp;<span class="ident" id="3340951">unhex</span><span class="op" id="3340956">(</span><span class="ident" id="3340957">c</span>&nbsp;<span class="builtintype" id="3340959">byte</span><span class="op" id="3340963">)</span>&nbsp;<span class="builtintype" id="3340965">byte</span>&nbsp;<span class="op" id="3340970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340973">switch</span>&nbsp;<span class="op" id="3340980">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3340983">case</span>&nbsp;<span class="string" id="3340988">&#39;0&#39;</span>&nbsp;<span class="op" id="3340992">&lt;=</span>&nbsp;<span class="ident" id="3340995">c</span>&nbsp;<span class="op" id="3340997">&amp;&amp;</span>&nbsp;<span class="ident" id="3341000">c</span>&nbsp;<span class="op" id="3341002">&lt;=</span>&nbsp;<span class="string" id="3341005">&#39;9&#39;</span><span class="op" id="3341008">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341012">return</span>&nbsp;<span class="ident" id="3341019">c</span>&nbsp;<span class="op" id="3341021">-</span>&nbsp;<span class="string" id="3341023">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341028">case</span>&nbsp;<span class="string" id="3341033">&#39;a&#39;</span>&nbsp;<span class="op" id="3341037">&lt;=</span>&nbsp;<span class="ident" id="3341040">c</span>&nbsp;<span class="op" id="3341042">&amp;&amp;</span>&nbsp;<span class="ident" id="3341045">c</span>&nbsp;<span class="op" id="3341047">&lt;=</span>&nbsp;<span class="string" id="3341050">&#39;f&#39;</span><span class="op" id="3341053">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341057">return</span>&nbsp;<span class="ident" id="3341064">c</span>&nbsp;<span class="op" id="3341066">-</span>&nbsp;<span class="string" id="3341068">&#39;a&#39;</span>&nbsp;<span class="op" id="3341072">+</span>&nbsp;<span class="num" id="3341074">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341078">case</span>&nbsp;<span class="string" id="3341083">&#39;A&#39;</span>&nbsp;<span class="op" id="3341087">&lt;=</span>&nbsp;<span class="ident" id="3341090">c</span>&nbsp;<span class="op" id="3341092">&amp;&amp;</span>&nbsp;<span class="ident" id="3341095">c</span>&nbsp;<span class="op" id="3341097">&lt;=</span>&nbsp;<span class="string" id="3341100">&#39;F&#39;</span><span class="op" id="3341103">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341107">return</span>&nbsp;<span class="ident" id="3341114">c</span>&nbsp;<span class="op" id="3341116">-</span>&nbsp;<span class="string" id="3341118">&#39;A&#39;</span>&nbsp;<span class="op" id="3341122">+</span>&nbsp;<span class="num" id="3341124">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3341128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3341131">return</span>&nbsp;<span class="num" id="3341138">0</span><br>
<span class="lineno"></span><span class="op" id="3341140">}</span>
</div>
</body>
</html>
