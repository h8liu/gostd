<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/ecdsa</h2>
<ul>
<li><a href="/gostd/crypto/ecdsa/ecdsa.go.html">ecdsa.go</a></li>
<li><a href="/gostd/crypto/ecdsa/ecdsa_test.go.html">ecdsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3992580">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3992635">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3992689">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3992740">//&nbsp;Package&nbsp;ecdsa&nbsp;implements&nbsp;the&nbsp;Elliptic&nbsp;Curve&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3992819">//&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="3992845">package</span>&nbsp;<span class="ident" id="3992853">ecdsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3992860">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="3992875">//&nbsp;&nbsp;&nbsp;[NSA]:&nbsp;Suite&nbsp;B&nbsp;implementer&#39;s&nbsp;guide&nbsp;to&nbsp;FIPS&nbsp;186-3,</span><br>
<span class="lineno"></span><span class="comment" id="3992930">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.nsa.gov/ia/_files/ecdsa.pdf</span><br>
<span class="lineno"></span><span class="comment" id="3992976">//&nbsp;&nbsp;&nbsp;[SECG]:&nbsp;SECG,&nbsp;SEC1</span><br>
<span class="lineno"></span><span class="comment" id="3993000">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.secg.org/download/aid-780/sec1-v2.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="3993057">import</span>&nbsp;<span class="op" id="3993064">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3993067">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3993077">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3993096">&#34;encoding/asn1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3993113">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3993119">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="3993130">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3993133">//&nbsp;PublicKey&nbsp;represents&nbsp;an&nbsp;ECDSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3993178">type</span>&nbsp;<span class="ident" id="3993183">PublicKey</span>&nbsp;<span class="keyword" id="3993193">struct</span>&nbsp;<span class="op" id="3993200">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993203">elliptic</span><span class="op" id="3993211">.</span><span class="ident" id="3993212">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993219">X</span><span class="op" id="3993220">,</span>&nbsp;<span class="ident" id="3993222">Y</span>&nbsp;<span class="op" id="3993224">*</span><span class="ident" id="3993225">big</span><span class="op" id="3993228">.</span><span class="ident" id="3993229">Int</span><br>
<span class="lineno"></span><span class="op" id="3993233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3993236">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;ECDSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno">30</span><span class="keyword" id="3993282">type</span>&nbsp;<span class="ident" id="3993287">PrivateKey</span>&nbsp;<span class="keyword" id="3993298">struct</span>&nbsp;<span class="op" id="3993305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993308">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993319">D</span>&nbsp;<span class="op" id="3993321">*</span><span class="ident" id="3993322">big</span><span class="op" id="3993325">.</span><span class="ident" id="3993326">Int</span><br>
<span class="lineno"></span><span class="op" id="3993330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="3993333">type</span>&nbsp;<span class="ident" id="3993338">ecdsaSignature</span>&nbsp;<span class="keyword" id="3993353">struct</span>&nbsp;<span class="op" id="3993360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993363">R</span><span class="op" id="3993364">,</span>&nbsp;<span class="ident" id="3993366">S</span>&nbsp;<span class="op" id="3993368">*</span><span class="ident" id="3993369">big</span><span class="op" id="3993372">.</span><span class="ident" id="3993373">Int</span><br>
<span class="lineno"></span><span class="op" id="3993377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3993380">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno">40</span><span class="keyword" id="3993436">func</span>&nbsp;<span class="op" id="3993441">(</span><span class="ident" id="3993442">priv</span>&nbsp;<span class="op" id="3993447">*</span><span class="ident" id="3993448">PrivateKey</span><span class="op" id="3993458">)</span>&nbsp;<span class="ident" id="3993460">Public</span><span class="op" id="3993466">(</span><span class="op" id="3993467">)</span>&nbsp;<span class="ident" id="3993469">crypto</span><span class="op" id="3993475">.</span><span class="ident" id="3993476">PublicKey</span>&nbsp;<span class="op" id="3993486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993489">return</span>&nbsp;<span class="op" id="3993496">&amp;</span><span class="ident" id="3993497">priv</span><span class="op" id="3993501">.</span><span class="ident" id="3993502">PublicKey</span><br>
<span class="lineno"></span><span class="op" id="3993512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3993515">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;This&nbsp;method&nbsp;is</span><br>
<span class="lineno">45</span><span class="comment" id="3993589">//&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3993667">//&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign&nbsp;function&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="3993744">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3993757">func</span>&nbsp;<span class="op" id="3993762">(</span><span class="ident" id="3993763">priv</span>&nbsp;<span class="op" id="3993768">*</span><span class="ident" id="3993769">PrivateKey</span><span class="op" id="3993779">)</span>&nbsp;<span class="ident" id="3993781">Sign</span><span class="op" id="3993785">(</span><span class="ident" id="3993786">rand</span>&nbsp;<span class="ident" id="3993791">io</span><span class="op" id="3993793">.</span><span class="ident" id="3993794">Reader</span><span class="op" id="3993800">,</span>&nbsp;<span class="ident" id="3993802">msg</span>&nbsp;<span class="op" id="3993806">[</span><span class="op" id="3993807">]</span><span class="builtintype" id="3993808">byte</span><span class="op" id="3993812">,</span>&nbsp;<span class="ident" id="3993814">opts</span>&nbsp;<span class="ident" id="3993819">crypto</span><span class="op" id="3993825">.</span><span class="ident" id="3993826">SignerOpts</span><span class="op" id="3993836">)</span>&nbsp;<span class="op" id="3993838">(</span><span class="op" id="3993839">[</span><span class="op" id="3993840">]</span><span class="builtintype" id="3993841">byte</span><span class="op" id="3993845">,</span>&nbsp;<span class="builtintype" id="3993847">error</span><span class="op" id="3993852">)</span>&nbsp;<span class="op" id="3993854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993857">r</span><span class="op" id="3993858">,</span>&nbsp;<span class="ident" id="3993860">s</span><span class="op" id="3993861">,</span>&nbsp;<span class="ident" id="3993863">err</span>&nbsp;<span class="op" id="3993867">:=</span>&nbsp;<span class="ident" id="3993870">Sign</span><span class="op" id="3993874">(</span><span class="ident" id="3993875">rand</span><span class="op" id="3993879">,</span>&nbsp;<span class="ident" id="3993881">priv</span><span class="op" id="3993885">,</span>&nbsp;<span class="ident" id="3993887">msg</span><span class="op" id="3993890">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993893">if</span>&nbsp;<span class="ident" id="3993896">err</span>&nbsp;<span class="op" id="3993900">!=</span>&nbsp;<span class="ident" id="3993903">nil</span>&nbsp;<span class="op" id="3993907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993911">return</span>&nbsp;<span class="ident" id="3993918">nil</span><span class="op" id="3993921">,</span>&nbsp;<span class="ident" id="3993923">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3993928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993932">return</span>&nbsp;<span class="ident" id="3993939">asn1</span><span class="op" id="3993943">.</span><span class="ident" id="3993944">Marshal</span><span class="op" id="3993951">(</span><span class="ident" id="3993952">ecdsaSignature</span><span class="op" id="3993966">{</span><span class="ident" id="3993967">r</span><span class="op" id="3993968">,</span>&nbsp;<span class="ident" id="3993970">s</span><span class="op" id="3993971">}</span><span class="op" id="3993972">)</span><br>
<span class="lineno">55</span><span class="op" id="3993974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3993977">var</span>&nbsp;<span class="ident" id="3993981">one</span>&nbsp;<span class="op" id="3993985">=</span>&nbsp;<span class="builtinfunc" id="3993987">new</span><span class="op" id="3993990">(</span><span class="ident" id="3993991">big</span><span class="op" id="3993994">.</span><span class="ident" id="3993995">Int</span><span class="op" id="3993998">)</span><span class="op" id="3993999">.</span><span class="ident" id="3994000">SetInt64</span><span class="op" id="3994008">(</span><span class="num" id="3994009">1</span><span class="op" id="3994010">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3994013">//&nbsp;randFieldElement&nbsp;returns&nbsp;a&nbsp;random&nbsp;element&nbsp;of&nbsp;the&nbsp;field&nbsp;underlying&nbsp;the&nbsp;given</span><br>
<span class="lineno">60</span><span class="comment" id="3994092">//&nbsp;curve&nbsp;using&nbsp;the&nbsp;procedure&nbsp;given&nbsp;in&nbsp;[NSA]&nbsp;A.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="3994143">func</span>&nbsp;<span class="ident" id="3994148">randFieldElement</span><span class="op" id="3994164">(</span><span class="ident" id="3994165">c</span>&nbsp;<span class="ident" id="3994167">elliptic</span><span class="op" id="3994175">.</span><span class="ident" id="3994176">Curve</span><span class="op" id="3994181">,</span>&nbsp;<span class="ident" id="3994183">rand</span>&nbsp;<span class="ident" id="3994188">io</span><span class="op" id="3994190">.</span><span class="ident" id="3994191">Reader</span><span class="op" id="3994197">)</span>&nbsp;<span class="op" id="3994199">(</span><span class="ident" id="3994200">k</span>&nbsp;<span class="op" id="3994202">*</span><span class="ident" id="3994203">big</span><span class="op" id="3994206">.</span><span class="ident" id="3994207">Int</span><span class="op" id="3994210">,</span>&nbsp;<span class="ident" id="3994212">err</span>&nbsp;<span class="builtintype" id="3994216">error</span><span class="op" id="3994221">)</span>&nbsp;<span class="op" id="3994223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3994226">params</span>&nbsp;<span class="op" id="3994233">:=</span>&nbsp;<span class="ident" id="3994236">c</span><span class="op" id="3994237">.</span><span class="ident" id="3994238">Params</span><span class="op" id="3994244">(</span><span class="op" id="3994245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3994248">b</span>&nbsp;<span class="op" id="3994250">:=</span>&nbsp;<span class="builtinfunc" id="3994253">make</span><span class="op" id="3994257">(</span><span class="op" id="3994258">[</span><span class="op" id="3994259">]</span><span class="builtintype" id="3994260">byte</span><span class="op" id="3994264">,</span>&nbsp;<span class="ident" id="3994266">params</span><span class="op" id="3994272">.</span><span class="ident" id="3994273">BitSize</span><span class="op" id="3994280">/</span><span class="num" id="3994281">8</span><span class="op" id="3994282">+</span><span class="num" id="3994283">8</span><span class="op" id="3994284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3994287">_</span><span class="op" id="3994288">,</span>&nbsp;<span class="ident" id="3994290">err</span>&nbsp;<span class="op" id="3994294">=</span>&nbsp;<span class="ident" id="3994296">io</span><span class="op" id="3994298">.</span><span class="ident" id="3994299">ReadFull</span><span class="op" id="3994307">(</span><span class="ident" id="3994308">rand</span><span class="op" id="3994312">,</span>&nbsp;<span class="ident" id="3994314">b</span><span class="op" id="3994315">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3994318">if</span>&nbsp;<span class="ident" id="3994321">err</span>&nbsp;<span class="op" id="3994325">!=</span>&nbsp;<span class="ident" id="3994328">nil</span>&nbsp;<span class="op" id="3994332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3994336">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3994344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3994348">k</span>&nbsp;<span class="op" id="3994350">=</span>&nbsp;<span class="builtinfunc" id="3994352">new</span><span class="op" id="3994355">(</span><span class="ident" id="3994356">big</span><span class="op" id="3994359">.</span><span class="ident" id="3994360">Int</span><span class="op" id="3994363">)</span><span class="op" id="3994364">.</span><span class="ident" id="3994365">SetBytes</span><span class="op" id="3994373">(</span><span class="ident" id="3994374">b</span><span class="op" id="3994375">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3994378">n</span>&nbsp;<span class="op" id="3994380">:=</span>&nbsp;<span class="builtinfunc" id="3994383">new</span><span class="op" id="3994386">(</span><span class="ident" id="3994387">big</span><span class="op" id="3994390">.</span><span class="ident" id="3994391">Int</span><span class="op" id="3994394">)</span><span class="op" id="3994395">.</span><span class="ident" id="3994396">Sub</span><span class="op" id="3994399">(</span><span class="ident" id="3994400">params</span><span class="op" id="3994406">.</span><span class="ident" id="3994407">N</span><span class="op" id="3994408">,</span>&nbsp;<span class="ident" id="3994410">one</span><span class="op" id="3994413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3994416">k</span><span class="op" id="3994417">.</span><span class="ident" id="3994418">Mod</span><span class="op" id="3994421">(</span><span class="ident" id="3994422">k</span><span class="op" id="3994423">,</span>&nbsp;<span class="ident" id="3994425">n</span><span class="op" id="3994426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3994429">k</span><span class="op" id="3994430">.</span><span class="ident" id="3994431">Add</span><span class="op" id="3994434">(</span><span class="ident" id="3994435">k</span><span class="op" id="3994436">,</span>&nbsp;<span class="ident" id="3994438">one</span><span class="op" id="3994441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3994444">return</span><br>
<span class="lineno"></span><span class="op" id="3994451">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3994454">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&nbsp;and&nbsp;private&nbsp;key&nbsp;pair.</span><br>
<span class="lineno"></span><span class="keyword" id="3994510">func</span>&nbsp;<span class="ident" id="3994515">GenerateKey</span><span class="op" id="3994526">(</span><span class="ident" id="3994527">c</span>&nbsp;<span class="ident" id="3994529">elliptic</span><span class="op" id="3994537">.</span><span class="ident" id="3994538">Curve</span><span class="op" id="3994543">,</span>&nbsp;<span class="ident" id="3994545">rand</span>&nbsp;<span class="ident" id="3994550">io</span><span class="op" id="3994552">.</span><span class="ident" id="3994553">Reader</span><span class="op" id="3994559">)</span>&nbsp;<span class="op" id="3994561">(</span><span class="ident" id="3994562">priv</span>&nbsp;<span class="op" id="3994567">*</span><span class="ident" id="3994568">PrivateKey</span><span class="op" id="3994578">,</span>&nbsp;<span class="ident" id="3994580">err</span>&nbsp;<span class="builtintype" id="3994584">error</span><span class="op" id="3994589">)</span>&nbsp;<span class="op" id="3994591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3994594">k</span><span class="op" id="3994595">,</span>&nbsp;<span class="ident" id="3994597">err</span>&nbsp;<span class="op" id="3994601">:=</span>&nbsp;<span class="ident" id="3994604">randFieldElement</span><span class="op" id="3994620">(</span><span class="ident" id="3994621">c</span><span class="op" id="3994622">,</span>&nbsp;<span class="ident" id="3994624">rand</span><span class="op" id="3994628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3994631">if</span>&nbsp;<span class="ident" id="3994634">err</span>&nbsp;<span class="op" id="3994638">!=</span>&nbsp;<span class="ident" id="3994641">nil</span>&nbsp;<span class="op" id="3994645">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3994649">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3994657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3994661">priv</span>&nbsp;<span class="op" id="3994666">=</span>&nbsp;<span class="builtinfunc" id="3994668">new</span><span class="op" id="3994671">(</span><span class="ident" id="3994672">PrivateKey</span><span class="op" id="3994682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3994685">priv</span><span class="op" id="3994689">.</span><span class="ident" id="3994690">PublicKey</span><span class="op" id="3994699">.</span><span class="ident" id="3994700">Curve</span>&nbsp;<span class="op" id="3994706">=</span>&nbsp;<span class="ident" id="3994708">c</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3994711">priv</span><span class="op" id="3994715">.</span><span class="ident" id="3994716">D</span>&nbsp;<span class="op" id="3994718">=</span>&nbsp;<span class="ident" id="3994720">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3994723">priv</span><span class="op" id="3994727">.</span><span class="ident" id="3994728">PublicKey</span><span class="op" id="3994737">.</span><span class="ident" id="3994738">X</span><span class="op" id="3994739">,</span>&nbsp;<span class="ident" id="3994741">priv</span><span class="op" id="3994745">.</span><span class="ident" id="3994746">PublicKey</span><span class="op" id="3994755">.</span><span class="ident" id="3994756">Y</span>&nbsp;<span class="op" id="3994758">=</span>&nbsp;<span class="ident" id="3994760">c</span><span class="op" id="3994761">.</span><span class="ident" id="3994762">ScalarBaseMult</span><span class="op" id="3994776">(</span><span class="ident" id="3994777">k</span><span class="op" id="3994778">.</span><span class="ident" id="3994779">Bytes</span><span class="op" id="3994784">(</span><span class="op" id="3994785">)</span><span class="op" id="3994786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3994789">return</span><br>
<span class="lineno"></span><span class="op" id="3994796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="3994799">//&nbsp;hashToInt&nbsp;converts&nbsp;a&nbsp;hash&nbsp;value&nbsp;to&nbsp;an&nbsp;integer.&nbsp;There&nbsp;is&nbsp;some&nbsp;disagreement</span><br>
<span class="lineno"></span><span class="comment" id="3994876">//&nbsp;about&nbsp;how&nbsp;this&nbsp;is&nbsp;done.&nbsp;[NSA]&nbsp;suggests&nbsp;that&nbsp;this&nbsp;is&nbsp;done&nbsp;in&nbsp;the&nbsp;obvious</span><br>
<span class="lineno"></span><span class="comment" id="3994951">//&nbsp;manner,&nbsp;but&nbsp;[SECG]&nbsp;truncates&nbsp;the&nbsp;hash&nbsp;to&nbsp;the&nbsp;bit-length&nbsp;of&nbsp;the&nbsp;curve&nbsp;order</span><br>
<span class="lineno"></span><span class="comment" id="3995029">//&nbsp;first.&nbsp;We&nbsp;follow&nbsp;[SECG]&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;OpenSSL&nbsp;does.&nbsp;Additionally,</span><br>
<span class="lineno"></span><span class="comment" id="3995104">//&nbsp;OpenSSL&nbsp;right&nbsp;shifts&nbsp;excess&nbsp;bits&nbsp;from&nbsp;the&nbsp;number&nbsp;if&nbsp;the&nbsp;hash&nbsp;is&nbsp;too&nbsp;large</span><br>
<span class="lineno">95</span><span class="comment" id="3995181">//&nbsp;and&nbsp;we&nbsp;mirror&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span><span class="keyword" id="3995208">func</span>&nbsp;<span class="ident" id="3995213">hashToInt</span><span class="op" id="3995222">(</span><span class="ident" id="3995223">hash</span>&nbsp;<span class="op" id="3995228">[</span><span class="op" id="3995229">]</span><span class="builtintype" id="3995230">byte</span><span class="op" id="3995234">,</span>&nbsp;<span class="ident" id="3995236">c</span>&nbsp;<span class="ident" id="3995238">elliptic</span><span class="op" id="3995246">.</span><span class="ident" id="3995247">Curve</span><span class="op" id="3995252">)</span>&nbsp;<span class="op" id="3995254">*</span><span class="ident" id="3995255">big</span><span class="op" id="3995258">.</span><span class="ident" id="3995259">Int</span>&nbsp;<span class="op" id="3995263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995266">orderBits</span>&nbsp;<span class="op" id="3995276">:=</span>&nbsp;<span class="ident" id="3995279">c</span><span class="op" id="3995280">.</span><span class="ident" id="3995281">Params</span><span class="op" id="3995287">(</span><span class="op" id="3995288">)</span><span class="op" id="3995289">.</span><span class="ident" id="3995290">N</span><span class="op" id="3995291">.</span><span class="ident" id="3995292">BitLen</span><span class="op" id="3995298">(</span><span class="op" id="3995299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995302">orderBytes</span>&nbsp;<span class="op" id="3995313">:=</span>&nbsp;<span class="op" id="3995316">(</span><span class="ident" id="3995317">orderBits</span>&nbsp;<span class="op" id="3995327">+</span>&nbsp;<span class="num" id="3995329">7</span><span class="op" id="3995330">)</span>&nbsp;<span class="op" id="3995332">/</span>&nbsp;<span class="num" id="3995334">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995337">if</span>&nbsp;<span class="builtinfunc" id="3995340">len</span><span class="op" id="3995343">(</span><span class="ident" id="3995344">hash</span><span class="op" id="3995348">)</span>&nbsp;<span class="op" id="3995350">&gt;</span>&nbsp;<span class="ident" id="3995352">orderBytes</span>&nbsp;<span class="op" id="3995363">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995367">hash</span>&nbsp;<span class="op" id="3995372">=</span>&nbsp;<span class="ident" id="3995374">hash</span><span class="op" id="3995378">[</span><span class="op" id="3995379">:</span><span class="ident" id="3995380">orderBytes</span><span class="op" id="3995390">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3995393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995397">ret</span>&nbsp;<span class="op" id="3995401">:=</span>&nbsp;<span class="builtinfunc" id="3995404">new</span><span class="op" id="3995407">(</span><span class="ident" id="3995408">big</span><span class="op" id="3995411">.</span><span class="ident" id="3995412">Int</span><span class="op" id="3995415">)</span><span class="op" id="3995416">.</span><span class="ident" id="3995417">SetBytes</span><span class="op" id="3995425">(</span><span class="ident" id="3995426">hash</span><span class="op" id="3995430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995433">excess</span>&nbsp;<span class="op" id="3995440">:=</span>&nbsp;<span class="builtinfunc" id="3995443">len</span><span class="op" id="3995446">(</span><span class="ident" id="3995447">hash</span><span class="op" id="3995451">)</span><span class="op" id="3995452">*</span><span class="num" id="3995453">8</span>&nbsp;<span class="op" id="3995455">-</span>&nbsp;<span class="ident" id="3995457">orderBits</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995468">if</span>&nbsp;<span class="ident" id="3995471">excess</span>&nbsp;<span class="op" id="3995478">&gt;</span>&nbsp;<span class="num" id="3995480">0</span>&nbsp;<span class="op" id="3995482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995486">ret</span><span class="op" id="3995489">.</span><span class="ident" id="3995490">Rsh</span><span class="op" id="3995493">(</span><span class="ident" id="3995494">ret</span><span class="op" id="3995497">,</span>&nbsp;<span class="builtintype" id="3995499">uint</span><span class="op" id="3995503">(</span><span class="ident" id="3995504">excess</span><span class="op" id="3995510">)</span><span class="op" id="3995511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3995514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995517">return</span>&nbsp;<span class="ident" id="3995524">ret</span><br>
<span class="lineno"></span><span class="op" id="3995528">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="3995531">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="3995608">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="3995686">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="3995757">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">115</span><span class="keyword" id="3995795">func</span>&nbsp;<span class="ident" id="3995800">fermatInverse</span><span class="op" id="3995813">(</span><span class="ident" id="3995814">k</span><span class="op" id="3995815">,</span>&nbsp;<span class="ident" id="3995817">N</span>&nbsp;<span class="op" id="3995819">*</span><span class="ident" id="3995820">big</span><span class="op" id="3995823">.</span><span class="ident" id="3995824">Int</span><span class="op" id="3995827">)</span>&nbsp;<span class="op" id="3995829">*</span><span class="ident" id="3995830">big</span><span class="op" id="3995833">.</span><span class="ident" id="3995834">Int</span>&nbsp;<span class="op" id="3995838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995841">two</span>&nbsp;<span class="op" id="3995845">:=</span>&nbsp;<span class="ident" id="3995848">big</span><span class="op" id="3995851">.</span><span class="ident" id="3995852">NewInt</span><span class="op" id="3995858">(</span><span class="num" id="3995859">2</span><span class="op" id="3995860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995863">nMinus2</span>&nbsp;<span class="op" id="3995871">:=</span>&nbsp;<span class="builtinfunc" id="3995874">new</span><span class="op" id="3995877">(</span><span class="ident" id="3995878">big</span><span class="op" id="3995881">.</span><span class="ident" id="3995882">Int</span><span class="op" id="3995885">)</span><span class="op" id="3995886">.</span><span class="ident" id="3995887">Sub</span><span class="op" id="3995890">(</span><span class="ident" id="3995891">N</span><span class="op" id="3995892">,</span>&nbsp;<span class="ident" id="3995894">two</span><span class="op" id="3995897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995900">return</span>&nbsp;<span class="builtinfunc" id="3995907">new</span><span class="op" id="3995910">(</span><span class="ident" id="3995911">big</span><span class="op" id="3995914">.</span><span class="ident" id="3995915">Int</span><span class="op" id="3995918">)</span><span class="op" id="3995919">.</span><span class="ident" id="3995920">Exp</span><span class="op" id="3995923">(</span><span class="ident" id="3995924">k</span><span class="op" id="3995925">,</span>&nbsp;<span class="ident" id="3995927">nMinus2</span><span class="op" id="3995934">,</span>&nbsp;<span class="ident" id="3995936">N</span><span class="op" id="3995937">)</span><br>
<span class="lineno"></span><span class="op" id="3995939">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="3995942">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3996022">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3996100">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3996179">//&nbsp;rand.</span><br>
<span class="lineno">125</span><span class="keyword" id="3996188">func</span>&nbsp;<span class="ident" id="3996193">Sign</span><span class="op" id="3996197">(</span><span class="ident" id="3996198">rand</span>&nbsp;<span class="ident" id="3996203">io</span><span class="op" id="3996205">.</span><span class="ident" id="3996206">Reader</span><span class="op" id="3996212">,</span>&nbsp;<span class="ident" id="3996214">priv</span>&nbsp;<span class="op" id="3996219">*</span><span class="ident" id="3996220">PrivateKey</span><span class="op" id="3996230">,</span>&nbsp;<span class="ident" id="3996232">hash</span>&nbsp;<span class="op" id="3996237">[</span><span class="op" id="3996238">]</span><span class="builtintype" id="3996239">byte</span><span class="op" id="3996243">)</span>&nbsp;<span class="op" id="3996245">(</span><span class="ident" id="3996246">r</span><span class="op" id="3996247">,</span>&nbsp;<span class="ident" id="3996249">s</span>&nbsp;<span class="op" id="3996251">*</span><span class="ident" id="3996252">big</span><span class="op" id="3996255">.</span><span class="ident" id="3996256">Int</span><span class="op" id="3996259">,</span>&nbsp;<span class="ident" id="3996261">err</span>&nbsp;<span class="builtintype" id="3996265">error</span><span class="op" id="3996270">)</span>&nbsp;<span class="op" id="3996272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996275">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996295">c</span>&nbsp;<span class="op" id="3996297">:=</span>&nbsp;<span class="ident" id="3996300">priv</span><span class="op" id="3996304">.</span><span class="ident" id="3996305">PublicKey</span><span class="op" id="3996314">.</span><span class="ident" id="3996315">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996322">N</span>&nbsp;<span class="op" id="3996324">:=</span>&nbsp;<span class="ident" id="3996327">c</span><span class="op" id="3996328">.</span><span class="ident" id="3996329">Params</span><span class="op" id="3996335">(</span><span class="op" id="3996336">)</span><span class="op" id="3996337">.</span><span class="ident" id="3996338">N</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996342">var</span>&nbsp;<span class="ident" id="3996346">k</span><span class="op" id="3996347">,</span>&nbsp;<span class="ident" id="3996349">kInv</span>&nbsp;<span class="op" id="3996354">*</span><span class="ident" id="3996355">big</span><span class="op" id="3996358">.</span><span class="ident" id="3996359">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996364">for</span>&nbsp;<span class="op" id="3996368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996372">for</span>&nbsp;<span class="op" id="3996376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996381">k</span><span class="op" id="3996382">,</span>&nbsp;<span class="ident" id="3996384">err</span>&nbsp;<span class="op" id="3996388">=</span>&nbsp;<span class="ident" id="3996390">randFieldElement</span><span class="op" id="3996406">(</span><span class="ident" id="3996407">c</span><span class="op" id="3996408">,</span>&nbsp;<span class="ident" id="3996410">rand</span><span class="op" id="3996414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996419">if</span>&nbsp;<span class="ident" id="3996422">err</span>&nbsp;<span class="op" id="3996426">!=</span>&nbsp;<span class="ident" id="3996429">nil</span>&nbsp;<span class="op" id="3996433">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996439">r</span>&nbsp;<span class="op" id="3996441">=</span>&nbsp;<span class="ident" id="3996443">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996451">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3996461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996467">kInv</span>&nbsp;<span class="op" id="3996472">=</span>&nbsp;<span class="ident" id="3996474">fermatInverse</span><span class="op" id="3996487">(</span><span class="ident" id="3996488">k</span><span class="op" id="3996489">,</span>&nbsp;<span class="ident" id="3996491">N</span><span class="op" id="3996492">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996497">r</span><span class="op" id="3996498">,</span>&nbsp;<span class="ident" id="3996500">_</span>&nbsp;<span class="op" id="3996502">=</span>&nbsp;<span class="ident" id="3996504">priv</span><span class="op" id="3996508">.</span><span class="ident" id="3996509">Curve</span><span class="op" id="3996514">.</span><span class="ident" id="3996515">ScalarBaseMult</span><span class="op" id="3996529">(</span><span class="ident" id="3996530">k</span><span class="op" id="3996531">.</span><span class="ident" id="3996532">Bytes</span><span class="op" id="3996537">(</span><span class="op" id="3996538">)</span><span class="op" id="3996539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996544">r</span><span class="op" id="3996545">.</span><span class="ident" id="3996546">Mod</span><span class="op" id="3996549">(</span><span class="ident" id="3996550">r</span><span class="op" id="3996551">,</span>&nbsp;<span class="ident" id="3996553">N</span><span class="op" id="3996554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996559">if</span>&nbsp;<span class="ident" id="3996562">r</span><span class="op" id="3996563">.</span><span class="ident" id="3996564">Sign</span><span class="op" id="3996568">(</span><span class="op" id="3996569">)</span>&nbsp;<span class="op" id="3996571">!=</span>&nbsp;<span class="num" id="3996574">0</span>&nbsp;<span class="op" id="3996576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996582">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3996591">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3996595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996600">e</span>&nbsp;<span class="op" id="3996602">:=</span>&nbsp;<span class="ident" id="3996605">hashToInt</span><span class="op" id="3996614">(</span><span class="ident" id="3996615">hash</span><span class="op" id="3996619">,</span>&nbsp;<span class="ident" id="3996621">c</span><span class="op" id="3996622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996626">s</span>&nbsp;<span class="op" id="3996628">=</span>&nbsp;<span class="builtinfunc" id="3996630">new</span><span class="op" id="3996633">(</span><span class="ident" id="3996634">big</span><span class="op" id="3996637">.</span><span class="ident" id="3996638">Int</span><span class="op" id="3996641">)</span><span class="op" id="3996642">.</span><span class="ident" id="3996643">Mul</span><span class="op" id="3996646">(</span><span class="ident" id="3996647">priv</span><span class="op" id="3996651">.</span><span class="ident" id="3996652">D</span><span class="op" id="3996653">,</span>&nbsp;<span class="ident" id="3996655">r</span><span class="op" id="3996656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996660">s</span><span class="op" id="3996661">.</span><span class="ident" id="3996662">Add</span><span class="op" id="3996665">(</span><span class="ident" id="3996666">s</span><span class="op" id="3996667">,</span>&nbsp;<span class="ident" id="3996669">e</span><span class="op" id="3996670">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996674">s</span><span class="op" id="3996675">.</span><span class="ident" id="3996676">Mul</span><span class="op" id="3996679">(</span><span class="ident" id="3996680">s</span><span class="op" id="3996681">,</span>&nbsp;<span class="ident" id="3996683">kInv</span><span class="op" id="3996687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996691">s</span><span class="op" id="3996692">.</span><span class="ident" id="3996693">Mod</span><span class="op" id="3996696">(</span><span class="ident" id="3996697">s</span><span class="op" id="3996698">,</span>&nbsp;<span class="ident" id="3996700">N</span><span class="op" id="3996701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996705">if</span>&nbsp;<span class="ident" id="3996708">s</span><span class="op" id="3996709">.</span><span class="ident" id="3996710">Sign</span><span class="op" id="3996714">(</span><span class="op" id="3996715">)</span>&nbsp;<span class="op" id="3996717">!=</span>&nbsp;<span class="num" id="3996720">0</span>&nbsp;<span class="op" id="3996722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996727">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3996735">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3996738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996742">return</span><br>
<span class="lineno"></span><span class="op" id="3996749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="3996752">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;Its</span><br>
<span class="lineno"></span><span class="comment" id="3996832">//&nbsp;return&nbsp;value&nbsp;records&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="3996888">func</span>&nbsp;<span class="ident" id="3996893">Verify</span><span class="op" id="3996899">(</span><span class="ident" id="3996900">pub</span>&nbsp;<span class="op" id="3996904">*</span><span class="ident" id="3996905">PublicKey</span><span class="op" id="3996914">,</span>&nbsp;<span class="ident" id="3996916">hash</span>&nbsp;<span class="op" id="3996921">[</span><span class="op" id="3996922">]</span><span class="builtintype" id="3996923">byte</span><span class="op" id="3996927">,</span>&nbsp;<span class="ident" id="3996929">r</span><span class="op" id="3996930">,</span>&nbsp;<span class="ident" id="3996932">s</span>&nbsp;<span class="op" id="3996934">*</span><span class="ident" id="3996935">big</span><span class="op" id="3996938">.</span><span class="ident" id="3996939">Int</span><span class="op" id="3996942">)</span>&nbsp;<span class="builtintype" id="3996944">bool</span>&nbsp;<span class="op" id="3996949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996952">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996972">c</span>&nbsp;<span class="op" id="3996974">:=</span>&nbsp;<span class="ident" id="3996977">pub</span><span class="op" id="3996980">.</span><span class="ident" id="3996981">Curve</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996988">N</span>&nbsp;<span class="op" id="3996990">:=</span>&nbsp;<span class="ident" id="3996993">c</span><span class="op" id="3996994">.</span><span class="ident" id="3996995">Params</span><span class="op" id="3997001">(</span><span class="op" id="3997002">)</span><span class="op" id="3997003">.</span><span class="ident" id="3997004">N</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997008">if</span>&nbsp;<span class="ident" id="3997011">r</span><span class="op" id="3997012">.</span><span class="ident" id="3997013">Sign</span><span class="op" id="3997017">(</span><span class="op" id="3997018">)</span>&nbsp;<span class="op" id="3997020">==</span>&nbsp;<span class="num" id="3997023">0</span>&nbsp;<span class="op" id="3997025">||</span>&nbsp;<span class="ident" id="3997028">s</span><span class="op" id="3997029">.</span><span class="ident" id="3997030">Sign</span><span class="op" id="3997034">(</span><span class="op" id="3997035">)</span>&nbsp;<span class="op" id="3997037">==</span>&nbsp;<span class="num" id="3997040">0</span>&nbsp;<span class="op" id="3997042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997046">return</span>&nbsp;<span class="builtintype" id="3997053">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997060">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997063">if</span>&nbsp;<span class="ident" id="3997066">r</span><span class="op" id="3997067">.</span><span class="ident" id="3997068">Cmp</span><span class="op" id="3997071">(</span><span class="ident" id="3997072">N</span><span class="op" id="3997073">)</span>&nbsp;<span class="op" id="3997075">&gt;=</span>&nbsp;<span class="num" id="3997078">0</span>&nbsp;<span class="op" id="3997080">||</span>&nbsp;<span class="ident" id="3997083">s</span><span class="op" id="3997084">.</span><span class="ident" id="3997085">Cmp</span><span class="op" id="3997088">(</span><span class="ident" id="3997089">N</span><span class="op" id="3997090">)</span>&nbsp;<span class="op" id="3997092">&gt;=</span>&nbsp;<span class="num" id="3997095">0</span>&nbsp;<span class="op" id="3997097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997101">return</span>&nbsp;<span class="builtintype" id="3997108">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997118">e</span>&nbsp;<span class="op" id="3997120">:=</span>&nbsp;<span class="ident" id="3997123">hashToInt</span><span class="op" id="3997132">(</span><span class="ident" id="3997133">hash</span><span class="op" id="3997137">,</span>&nbsp;<span class="ident" id="3997139">c</span><span class="op" id="3997140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997143">w</span>&nbsp;<span class="op" id="3997145">:=</span>&nbsp;<span class="builtinfunc" id="3997148">new</span><span class="op" id="3997151">(</span><span class="ident" id="3997152">big</span><span class="op" id="3997155">.</span><span class="ident" id="3997156">Int</span><span class="op" id="3997159">)</span><span class="op" id="3997160">.</span><span class="ident" id="3997161">ModInverse</span><span class="op" id="3997171">(</span><span class="ident" id="3997172">s</span><span class="op" id="3997173">,</span>&nbsp;<span class="ident" id="3997175">N</span><span class="op" id="3997176">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997180">u1</span>&nbsp;<span class="op" id="3997183">:=</span>&nbsp;<span class="ident" id="3997186">e</span><span class="op" id="3997187">.</span><span class="ident" id="3997188">Mul</span><span class="op" id="3997191">(</span><span class="ident" id="3997192">e</span><span class="op" id="3997193">,</span>&nbsp;<span class="ident" id="3997195">w</span><span class="op" id="3997196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997199">u1</span><span class="op" id="3997201">.</span><span class="ident" id="3997202">Mod</span><span class="op" id="3997205">(</span><span class="ident" id="3997206">u1</span><span class="op" id="3997208">,</span>&nbsp;<span class="ident" id="3997210">N</span><span class="op" id="3997211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997214">u2</span>&nbsp;<span class="op" id="3997217">:=</span>&nbsp;<span class="ident" id="3997220">w</span><span class="op" id="3997221">.</span><span class="ident" id="3997222">Mul</span><span class="op" id="3997225">(</span><span class="ident" id="3997226">r</span><span class="op" id="3997227">,</span>&nbsp;<span class="ident" id="3997229">w</span><span class="op" id="3997230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997233">u2</span><span class="op" id="3997235">.</span><span class="ident" id="3997236">Mod</span><span class="op" id="3997239">(</span><span class="ident" id="3997240">u2</span><span class="op" id="3997242">,</span>&nbsp;<span class="ident" id="3997244">N</span><span class="op" id="3997245">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997249">x1</span><span class="op" id="3997251">,</span>&nbsp;<span class="ident" id="3997253">y1</span>&nbsp;<span class="op" id="3997256">:=</span>&nbsp;<span class="ident" id="3997259">c</span><span class="op" id="3997260">.</span><span class="ident" id="3997261">ScalarBaseMult</span><span class="op" id="3997275">(</span><span class="ident" id="3997276">u1</span><span class="op" id="3997278">.</span><span class="ident" id="3997279">Bytes</span><span class="op" id="3997284">(</span><span class="op" id="3997285">)</span><span class="op" id="3997286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997289">x2</span><span class="op" id="3997291">,</span>&nbsp;<span class="ident" id="3997293">y2</span>&nbsp;<span class="op" id="3997296">:=</span>&nbsp;<span class="ident" id="3997299">c</span><span class="op" id="3997300">.</span><span class="ident" id="3997301">ScalarMult</span><span class="op" id="3997311">(</span><span class="ident" id="3997312">pub</span><span class="op" id="3997315">.</span><span class="ident" id="3997316">X</span><span class="op" id="3997317">,</span>&nbsp;<span class="ident" id="3997319">pub</span><span class="op" id="3997322">.</span><span class="ident" id="3997323">Y</span><span class="op" id="3997324">,</span>&nbsp;<span class="ident" id="3997326">u2</span><span class="op" id="3997328">.</span><span class="ident" id="3997329">Bytes</span><span class="op" id="3997334">(</span><span class="op" id="3997335">)</span><span class="op" id="3997336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997339">x</span><span class="op" id="3997340">,</span>&nbsp;<span class="ident" id="3997342">y</span>&nbsp;<span class="op" id="3997344">:=</span>&nbsp;<span class="ident" id="3997347">c</span><span class="op" id="3997348">.</span><span class="ident" id="3997349">Add</span><span class="op" id="3997352">(</span><span class="ident" id="3997353">x1</span><span class="op" id="3997355">,</span>&nbsp;<span class="ident" id="3997357">y1</span><span class="op" id="3997359">,</span>&nbsp;<span class="ident" id="3997361">x2</span><span class="op" id="3997363">,</span>&nbsp;<span class="ident" id="3997365">y2</span><span class="op" id="3997367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997370">if</span>&nbsp;<span class="ident" id="3997373">x</span><span class="op" id="3997374">.</span><span class="ident" id="3997375">Sign</span><span class="op" id="3997379">(</span><span class="op" id="3997380">)</span>&nbsp;<span class="op" id="3997382">==</span>&nbsp;<span class="num" id="3997385">0</span>&nbsp;<span class="op" id="3997387">&amp;&amp;</span>&nbsp;<span class="ident" id="3997390">y</span><span class="op" id="3997391">.</span><span class="ident" id="3997392">Sign</span><span class="op" id="3997396">(</span><span class="op" id="3997397">)</span>&nbsp;<span class="op" id="3997399">==</span>&nbsp;<span class="num" id="3997402">0</span>&nbsp;<span class="op" id="3997404">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997408">return</span>&nbsp;<span class="builtintype" id="3997415">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997425">x</span><span class="op" id="3997426">.</span><span class="ident" id="3997427">Mod</span><span class="op" id="3997430">(</span><span class="ident" id="3997431">x</span><span class="op" id="3997432">,</span>&nbsp;<span class="ident" id="3997434">N</span><span class="op" id="3997435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997438">return</span>&nbsp;<span class="ident" id="3997445">x</span><span class="op" id="3997446">.</span><span class="ident" id="3997447">Cmp</span><span class="op" id="3997450">(</span><span class="ident" id="3997451">r</span><span class="op" id="3997452">)</span>&nbsp;<span class="op" id="3997454">==</span>&nbsp;<span class="num" id="3997457">0</span><br>
<span class="lineno"></span><span class="op" id="3997459">}</span>
</div>
</body>
</html>
