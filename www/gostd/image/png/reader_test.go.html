<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8242308">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8242363">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8242417">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8242468">package</span>&nbsp;<span class="ident" id="8242476">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8242481">import</span>&nbsp;<span class="op" id="8242488">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242491">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242500">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242507">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242516">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242531">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242537">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242550">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242556">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242567">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8242577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8242580">var</span>&nbsp;<span class="ident" id="8242584">filenames</span>&nbsp;<span class="op" id="8242594">=</span>&nbsp;<span class="op" id="8242596">[</span><span class="op" id="8242597">]</span><span class="builtintype" id="8242598">string</span><span class="op" id="8242604">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242607">&#34;basn0g01&#34;</span><span class="op" id="8242617">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242620">&#34;basn0g01-30&#34;</span><span class="op" id="8242633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242636">&#34;basn0g02&#34;</span><span class="op" id="8242646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242649">&#34;basn0g02-29&#34;</span><span class="op" id="8242662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242665">&#34;basn0g04&#34;</span><span class="op" id="8242675">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242678">&#34;basn0g04-31&#34;</span><span class="op" id="8242691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242694">&#34;basn0g08&#34;</span><span class="op" id="8242704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242707">&#34;basn0g16&#34;</span><span class="op" id="8242717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242720">&#34;basn2c08&#34;</span><span class="op" id="8242730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242733">&#34;basn2c16&#34;</span><span class="op" id="8242743">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242746">&#34;basn3p01&#34;</span><span class="op" id="8242756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242759">&#34;basn3p02&#34;</span><span class="op" id="8242769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242772">&#34;basn3p04&#34;</span><span class="op" id="8242782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242785">&#34;basn3p04-31i&#34;</span><span class="op" id="8242799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242802">&#34;basn3p08&#34;</span><span class="op" id="8242812">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242815">&#34;basn3p08-trns&#34;</span><span class="op" id="8242830">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242833">&#34;basn4a08&#34;</span><span class="op" id="8242843">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242846">&#34;basn4a16&#34;</span><span class="op" id="8242856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242859">&#34;basn6a08&#34;</span><span class="op" id="8242869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242872">&#34;basn6a16&#34;</span><span class="op" id="8242882">,</span><br>
<span class="lineno">40</span><span class="op" id="8242884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8242887">var</span>&nbsp;<span class="ident" id="8242891">filenamesPaletted</span>&nbsp;<span class="op" id="8242909">=</span>&nbsp;<span class="op" id="8242911">[</span><span class="op" id="8242912">]</span><span class="builtintype" id="8242913">string</span><span class="op" id="8242919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242922">&#34;basn3p01&#34;</span><span class="op" id="8242932">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242935">&#34;basn3p02&#34;</span><span class="op" id="8242945">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242948">&#34;basn3p04&#34;</span><span class="op" id="8242958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242961">&#34;basn3p08&#34;</span><span class="op" id="8242971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8242974">&#34;basn3p08-trns&#34;</span><span class="op" id="8242989">,</span><br>
<span class="lineno"></span><span class="op" id="8242991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="8242994">var</span>&nbsp;<span class="ident" id="8242998">filenamesShort</span>&nbsp;<span class="op" id="8243013">=</span>&nbsp;<span class="op" id="8243015">[</span><span class="op" id="8243016">]</span><span class="builtintype" id="8243017">string</span><span class="op" id="8243023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8243026">&#34;basn0g01&#34;</span><span class="op" id="8243036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8243039">&#34;basn0g04-31&#34;</span><span class="op" id="8243052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8243055">&#34;basn6a16&#34;</span><span class="op" id="8243065">,</span><br>
<span class="lineno"></span><span class="op" id="8243067">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="8243070">func</span>&nbsp;<span class="ident" id="8243075">readPNG</span><span class="op" id="8243082">(</span><span class="ident" id="8243083">filename</span>&nbsp;<span class="builtintype" id="8243092">string</span><span class="op" id="8243098">)</span>&nbsp;<span class="op" id="8243100">(</span><span class="ident" id="8243101">image</span><span class="op" id="8243106">.</span><span class="ident" id="8243107">Image</span><span class="op" id="8243112">,</span>&nbsp;<span class="builtintype" id="8243114">error</span><span class="op" id="8243119">)</span>&nbsp;<span class="op" id="8243121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243124">f</span><span class="op" id="8243125">,</span>&nbsp;<span class="ident" id="8243127">err</span>&nbsp;<span class="op" id="8243131">:=</span>&nbsp;<span class="ident" id="8243134">os</span><span class="op" id="8243136">.</span><span class="ident" id="8243137">Open</span><span class="op" id="8243141">(</span><span class="ident" id="8243142">filename</span><span class="op" id="8243150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243153">if</span>&nbsp;<span class="ident" id="8243156">err</span>&nbsp;<span class="op" id="8243160">!=</span>&nbsp;<span class="ident" id="8243163">nil</span>&nbsp;<span class="op" id="8243167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243171">return</span>&nbsp;<span class="ident" id="8243178">nil</span><span class="op" id="8243181">,</span>&nbsp;<span class="ident" id="8243183">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8243188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243191">defer</span>&nbsp;<span class="ident" id="8243197">f</span><span class="op" id="8243198">.</span><span class="ident" id="8243199">Close</span><span class="op" id="8243204">(</span><span class="op" id="8243205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243208">return</span>&nbsp;<span class="ident" id="8243215">Decode</span><span class="op" id="8243221">(</span><span class="ident" id="8243222">f</span><span class="op" id="8243223">)</span><br>
<span class="lineno"></span><span class="op" id="8243225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="8243228">//&nbsp;An&nbsp;approximation&nbsp;of&nbsp;the&nbsp;sng&nbsp;command-line&nbsp;tool.</span><br>
<span class="lineno"></span><span class="keyword" id="8243278">func</span>&nbsp;<span class="ident" id="8243283">sng</span><span class="op" id="8243286">(</span><span class="ident" id="8243287">w</span>&nbsp;<span class="ident" id="8243289">io</span><span class="op" id="8243291">.</span><span class="ident" id="8243292">WriteCloser</span><span class="op" id="8243303">,</span>&nbsp;<span class="ident" id="8243305">filename</span>&nbsp;<span class="builtintype" id="8243314">string</span><span class="op" id="8243320">,</span>&nbsp;<span class="ident" id="8243322">png</span>&nbsp;<span class="ident" id="8243326">image</span><span class="op" id="8243331">.</span><span class="ident" id="8243332">Image</span><span class="op" id="8243337">)</span>&nbsp;<span class="op" id="8243339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243342">defer</span>&nbsp;<span class="ident" id="8243348">w</span><span class="op" id="8243349">.</span><span class="ident" id="8243350">Close</span><span class="op" id="8243355">(</span><span class="op" id="8243356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243359">bounds</span>&nbsp;<span class="op" id="8243366">:=</span>&nbsp;<span class="ident" id="8243369">png</span><span class="op" id="8243372">.</span><span class="ident" id="8243373">Bounds</span><span class="op" id="8243379">(</span><span class="op" id="8243380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243383">cm</span>&nbsp;<span class="op" id="8243386">:=</span>&nbsp;<span class="ident" id="8243389">png</span><span class="op" id="8243392">.</span><span class="ident" id="8243393">ColorModel</span><span class="op" id="8243403">(</span><span class="op" id="8243404">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243407">var</span>&nbsp;<span class="ident" id="8243411">bitdepth</span>&nbsp;<span class="builtintype" id="8243420">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243425">switch</span>&nbsp;<span class="ident" id="8243432">cm</span>&nbsp;<span class="op" id="8243435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243438">case</span>&nbsp;<span class="ident" id="8243443">color</span><span class="op" id="8243448">.</span><span class="ident" id="8243449">RGBAModel</span><span class="op" id="8243458">,</span>&nbsp;<span class="ident" id="8243460">color</span><span class="op" id="8243465">.</span><span class="ident" id="8243466">NRGBAModel</span><span class="op" id="8243476">,</span>&nbsp;<span class="ident" id="8243478">color</span><span class="op" id="8243483">.</span><span class="ident" id="8243484">AlphaModel</span><span class="op" id="8243494">,</span>&nbsp;<span class="ident" id="8243496">color</span><span class="op" id="8243501">.</span><span class="ident" id="8243502">GrayModel</span><span class="op" id="8243511">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243515">bitdepth</span>&nbsp;<span class="op" id="8243524">=</span>&nbsp;<span class="num" id="8243526">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243529">default</span><span class="op" id="8243536">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243540">bitdepth</span>&nbsp;<span class="op" id="8243549">=</span>&nbsp;<span class="num" id="8243551">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8243555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243558">cpm</span><span class="op" id="8243561">,</span>&nbsp;<span class="ident" id="8243563">_</span>&nbsp;<span class="op" id="8243565">:=</span>&nbsp;<span class="ident" id="8243568">cm</span><span class="op" id="8243570">.</span><span class="op" id="8243571">(</span><span class="ident" id="8243572">color</span><span class="op" id="8243577">.</span><span class="ident" id="8243578">Palette</span><span class="op" id="8243585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243588">var</span>&nbsp;<span class="ident" id="8243592">paletted</span>&nbsp;<span class="op" id="8243601">*</span><span class="ident" id="8243602">image</span><span class="op" id="8243607">.</span><span class="ident" id="8243608">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243618">if</span>&nbsp;<span class="ident" id="8243621">cpm</span>&nbsp;<span class="op" id="8243625">!=</span>&nbsp;<span class="ident" id="8243628">nil</span>&nbsp;<span class="op" id="8243632">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243636">switch</span>&nbsp;<span class="op" id="8243643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243647">case</span>&nbsp;<span class="builtinfunc" id="8243652">len</span><span class="op" id="8243655">(</span><span class="ident" id="8243656">cpm</span><span class="op" id="8243659">)</span>&nbsp;<span class="op" id="8243661">&lt;=</span>&nbsp;<span class="num" id="8243664">2</span><span class="op" id="8243665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243670">bitdepth</span>&nbsp;<span class="op" id="8243679">=</span>&nbsp;<span class="num" id="8243681">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243685">case</span>&nbsp;<span class="builtinfunc" id="8243690">len</span><span class="op" id="8243693">(</span><span class="ident" id="8243694">cpm</span><span class="op" id="8243697">)</span>&nbsp;<span class="op" id="8243699">&lt;=</span>&nbsp;<span class="num" id="8243702">4</span><span class="op" id="8243703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243708">bitdepth</span>&nbsp;<span class="op" id="8243717">=</span>&nbsp;<span class="num" id="8243719">2</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243723">case</span>&nbsp;<span class="builtinfunc" id="8243728">len</span><span class="op" id="8243731">(</span><span class="ident" id="8243732">cpm</span><span class="op" id="8243735">)</span>&nbsp;<span class="op" id="8243737">&lt;=</span>&nbsp;<span class="num" id="8243740">16</span><span class="op" id="8243742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243747">bitdepth</span>&nbsp;<span class="op" id="8243756">=</span>&nbsp;<span class="num" id="8243758">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8243762">default</span><span class="op" id="8243769">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243774">bitdepth</span>&nbsp;<span class="op" id="8243783">=</span>&nbsp;<span class="num" id="8243785">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8243789">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243793">paletted</span>&nbsp;<span class="op" id="8243802">=</span>&nbsp;<span class="ident" id="8243804">png</span><span class="op" id="8243807">.</span><span class="op" id="8243808">(</span><span class="op" id="8243809">*</span><span class="ident" id="8243810">image</span><span class="op" id="8243815">.</span><span class="ident" id="8243816">Paletted</span><span class="op" id="8243824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8243827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8243831">//&nbsp;Write&nbsp;the&nbsp;filename&nbsp;and&nbsp;IHDR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243864">io</span><span class="op" id="8243866">.</span><span class="ident" id="8243867">WriteString</span><span class="op" id="8243878">(</span><span class="ident" id="8243879">w</span><span class="op" id="8243880">,</span>&nbsp;<span class="string" id="8243882">&#34;#SNG:&nbsp;from&nbsp;&#34;</span><span class="op" id="8243895">+</span><span class="ident" id="8243896">filename</span><span class="op" id="8243904">+</span><span class="string" id="8243905">&#34;.png\nIHDR&nbsp;{\n&#34;</span><span class="op" id="8243921">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8243924">fmt</span><span class="op" id="8243927">.</span><span class="ident" id="8243928">Fprintf</span><span class="op" id="8243935">(</span><span class="ident" id="8243936">w</span><span class="op" id="8243937">,</span>&nbsp;<span class="string" id="8243939">&#34;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;%d;&nbsp;height:&nbsp;%d;&nbsp;bitdepth:&nbsp;%d;\n&#34;</span><span class="op" id="8243983">,</span>&nbsp;<span class="ident" id="8243985">bounds</span><span class="op" id="8243991">.</span><span class="ident" id="8243992">Dx</span><span class="op" id="8243994">(</span><span class="op" id="8243995">)</span><span class="op" id="8243996">,</span>&nbsp;<span class="ident" id="8243998">bounds</span><span class="op" id="8244004">.</span><span class="ident" id="8244005">Dy</span><span class="op" id="8244007">(</span><span class="op" id="8244008">)</span><span class="op" id="8244009">,</span>&nbsp;<span class="ident" id="8244011">bitdepth</span><span class="op" id="8244019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244022">switch</span>&nbsp;<span class="op" id="8244029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244032">case</span>&nbsp;<span class="ident" id="8244037">cm</span>&nbsp;<span class="op" id="8244040">==</span>&nbsp;<span class="ident" id="8244043">color</span><span class="op" id="8244048">.</span><span class="ident" id="8244049">RGBAModel</span><span class="op" id="8244058">,</span>&nbsp;<span class="ident" id="8244060">cm</span>&nbsp;<span class="op" id="8244063">==</span>&nbsp;<span class="ident" id="8244066">color</span><span class="op" id="8244071">.</span><span class="ident" id="8244072">RGBA64Model</span><span class="op" id="8244083">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244087">io</span><span class="op" id="8244089">.</span><span class="ident" id="8244090">WriteString</span><span class="op" id="8244101">(</span><span class="ident" id="8244102">w</span><span class="op" id="8244103">,</span>&nbsp;<span class="string" id="8244105">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color;\n&#34;</span><span class="op" id="8244125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244128">case</span>&nbsp;<span class="ident" id="8244133">cm</span>&nbsp;<span class="op" id="8244136">==</span>&nbsp;<span class="ident" id="8244139">color</span><span class="op" id="8244144">.</span><span class="ident" id="8244145">NRGBAModel</span><span class="op" id="8244155">,</span>&nbsp;<span class="ident" id="8244157">cm</span>&nbsp;<span class="op" id="8244160">==</span>&nbsp;<span class="ident" id="8244163">color</span><span class="op" id="8244168">.</span><span class="ident" id="8244169">NRGBA64Model</span><span class="op" id="8244181">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244185">io</span><span class="op" id="8244187">.</span><span class="ident" id="8244188">WriteString</span><span class="op" id="8244199">(</span><span class="ident" id="8244200">w</span><span class="op" id="8244201">,</span>&nbsp;<span class="string" id="8244203">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;alpha;\n&#34;</span><span class="op" id="8244229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244232">case</span>&nbsp;<span class="ident" id="8244237">cm</span>&nbsp;<span class="op" id="8244240">==</span>&nbsp;<span class="ident" id="8244243">color</span><span class="op" id="8244248">.</span><span class="ident" id="8244249">GrayModel</span><span class="op" id="8244258">,</span>&nbsp;<span class="ident" id="8244260">cm</span>&nbsp;<span class="op" id="8244263">==</span>&nbsp;<span class="ident" id="8244266">color</span><span class="op" id="8244271">.</span><span class="ident" id="8244272">Gray16Model</span><span class="op" id="8244283">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244287">io</span><span class="op" id="8244289">.</span><span class="ident" id="8244290">WriteString</span><span class="op" id="8244301">(</span><span class="ident" id="8244302">w</span><span class="op" id="8244303">,</span>&nbsp;<span class="string" id="8244305">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;grayscale;\n&#34;</span><span class="op" id="8244329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244332">case</span>&nbsp;<span class="ident" id="8244337">cpm</span>&nbsp;<span class="op" id="8244341">!=</span>&nbsp;<span class="ident" id="8244344">nil</span><span class="op" id="8244347">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244351">io</span><span class="op" id="8244353">.</span><span class="ident" id="8244354">WriteString</span><span class="op" id="8244365">(</span><span class="ident" id="8244366">w</span><span class="op" id="8244367">,</span>&nbsp;<span class="string" id="8244369">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;palette;\n&#34;</span><span class="op" id="8244397">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244400">default</span><span class="op" id="8244407">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244411">io</span><span class="op" id="8244413">.</span><span class="ident" id="8244414">WriteString</span><span class="op" id="8244425">(</span><span class="ident" id="8244426">w</span><span class="op" id="8244427">,</span>&nbsp;<span class="string" id="8244429">&#34;unknown&nbsp;PNG&nbsp;decoder&nbsp;color&nbsp;model\n&#34;</span><span class="op" id="8244464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8244467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244470">io</span><span class="op" id="8244472">.</span><span class="ident" id="8244473">WriteString</span><span class="op" id="8244484">(</span><span class="ident" id="8244485">w</span><span class="op" id="8244486">,</span>&nbsp;<span class="string" id="8244488">&#34;}\n&#34;</span><span class="op" id="8244493">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8244497">//&nbsp;We&nbsp;fake&nbsp;a&nbsp;gAMA&nbsp;output.&nbsp;The&nbsp;test&nbsp;files&nbsp;have&nbsp;a&nbsp;gAMA&nbsp;chunk&nbsp;but&nbsp;the&nbsp;go&nbsp;PNG&nbsp;parser&nbsp;ignores&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8244590">//&nbsp;(the&nbsp;PNG&nbsp;spec&nbsp;section&nbsp;11.3&nbsp;says&nbsp;&#34;Ancillary&nbsp;chunks&nbsp;may&nbsp;be&nbsp;ignored&nbsp;by&nbsp;a&nbsp;decoder&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244675">io</span><span class="op" id="8244677">.</span><span class="ident" id="8244678">WriteString</span><span class="op" id="8244689">(</span><span class="ident" id="8244690">w</span><span class="op" id="8244691">,</span>&nbsp;<span class="string" id="8244693">&#34;gAMA&nbsp;{1.0000}\n&#34;</span><span class="op" id="8244710">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8244714">//&nbsp;Write&nbsp;the&nbsp;PLTE&nbsp;and&nbsp;tRNS&nbsp;(if&nbsp;applicable).</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244759">if</span>&nbsp;<span class="ident" id="8244762">cpm</span>&nbsp;<span class="op" id="8244766">!=</span>&nbsp;<span class="ident" id="8244769">nil</span>&nbsp;<span class="op" id="8244773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244777">lastAlpha</span>&nbsp;<span class="op" id="8244787">:=</span>&nbsp;<span class="op" id="8244790">-</span><span class="num" id="8244791">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244795">io</span><span class="op" id="8244797">.</span><span class="ident" id="8244798">WriteString</span><span class="op" id="8244809">(</span><span class="ident" id="8244810">w</span><span class="op" id="8244811">,</span>&nbsp;<span class="string" id="8244813">&#34;PLTE&nbsp;{\n&#34;</span><span class="op" id="8244823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244827">for</span>&nbsp;<span class="ident" id="8244831">i</span><span class="op" id="8244832">,</span>&nbsp;<span class="ident" id="8244834">c</span>&nbsp;<span class="op" id="8244836">:=</span>&nbsp;<span class="keyword" id="8244839">range</span>&nbsp;<span class="ident" id="8244845">cpm</span>&nbsp;<span class="op" id="8244849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244854">var</span>&nbsp;<span class="ident" id="8244858">r</span><span class="op" id="8244859">,</span>&nbsp;<span class="ident" id="8244861">g</span><span class="op" id="8244862">,</span>&nbsp;<span class="ident" id="8244864">b</span><span class="op" id="8244865">,</span>&nbsp;<span class="ident" id="8244867">a</span>&nbsp;<span class="builtintype" id="8244869">uint8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244878">switch</span>&nbsp;<span class="ident" id="8244885">c</span>&nbsp;<span class="op" id="8244887">:=</span>&nbsp;<span class="ident" id="8244890">c</span><span class="op" id="8244891">.</span><span class="op" id="8244892">(</span><span class="keyword" id="8244893">type</span><span class="op" id="8244897">)</span>&nbsp;<span class="op" id="8244899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244904">case</span>&nbsp;<span class="ident" id="8244909">color</span><span class="op" id="8244914">.</span><span class="ident" id="8244915">RGBA</span><span class="op" id="8244919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244925">r</span><span class="op" id="8244926">,</span>&nbsp;<span class="ident" id="8244928">g</span><span class="op" id="8244929">,</span>&nbsp;<span class="ident" id="8244931">b</span><span class="op" id="8244932">,</span>&nbsp;<span class="ident" id="8244934">a</span>&nbsp;<span class="op" id="8244936">=</span>&nbsp;<span class="ident" id="8244938">c</span><span class="op" id="8244939">.</span><span class="ident" id="8244940">R</span><span class="op" id="8244941">,</span>&nbsp;<span class="ident" id="8244943">c</span><span class="op" id="8244944">.</span><span class="ident" id="8244945">G</span><span class="op" id="8244946">,</span>&nbsp;<span class="ident" id="8244948">c</span><span class="op" id="8244949">.</span><span class="ident" id="8244950">B</span><span class="op" id="8244951">,</span>&nbsp;<span class="num" id="8244953">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8244961">case</span>&nbsp;<span class="ident" id="8244966">color</span><span class="op" id="8244971">.</span><span class="ident" id="8244972">NRGBA</span><span class="op" id="8244977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8244983">r</span><span class="op" id="8244984">,</span>&nbsp;<span class="ident" id="8244986">g</span><span class="op" id="8244987">,</span>&nbsp;<span class="ident" id="8244989">b</span><span class="op" id="8244990">,</span>&nbsp;<span class="ident" id="8244992">a</span>&nbsp;<span class="op" id="8244994">=</span>&nbsp;<span class="ident" id="8244996">c</span><span class="op" id="8244997">.</span><span class="ident" id="8244998">R</span><span class="op" id="8244999">,</span>&nbsp;<span class="ident" id="8245001">c</span><span class="op" id="8245002">.</span><span class="ident" id="8245003">G</span><span class="op" id="8245004">,</span>&nbsp;<span class="ident" id="8245006">c</span><span class="op" id="8245007">.</span><span class="ident" id="8245008">B</span><span class="op" id="8245009">,</span>&nbsp;<span class="ident" id="8245011">c</span><span class="op" id="8245012">.</span><span class="ident" id="8245013">A</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245018">default</span><span class="op" id="8245025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8245031">panic</span><span class="op" id="8245036">(</span><span class="string" id="8245037">&#34;unknown&nbsp;palette&nbsp;color&nbsp;type&#34;</span><span class="op" id="8245065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245075">if</span>&nbsp;<span class="ident" id="8245078">a</span>&nbsp;<span class="op" id="8245080">!=</span>&nbsp;<span class="num" id="8245083">0xff</span>&nbsp;<span class="op" id="8245088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245094">lastAlpha</span>&nbsp;<span class="op" id="8245104">=</span>&nbsp;<span class="ident" id="8245106">i</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245116">fmt</span><span class="op" id="8245119">.</span><span class="ident" id="8245120">Fprintf</span><span class="op" id="8245127">(</span><span class="ident" id="8245128">w</span><span class="op" id="8245129">,</span>&nbsp;<span class="string" id="8245131">&#34;&nbsp;&nbsp;&nbsp;&nbsp;(%3d,%3d,%3d)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;rgb&nbsp;=&nbsp;(0x%02x,0x%02x,0x%02x)\n&#34;</span><span class="op" id="8245187">,</span>&nbsp;<span class="ident" id="8245189">r</span><span class="op" id="8245190">,</span>&nbsp;<span class="ident" id="8245192">g</span><span class="op" id="8245193">,</span>&nbsp;<span class="ident" id="8245195">b</span><span class="op" id="8245196">,</span>&nbsp;<span class="ident" id="8245198">r</span><span class="op" id="8245199">,</span>&nbsp;<span class="ident" id="8245201">g</span><span class="op" id="8245202">,</span>&nbsp;<span class="ident" id="8245204">b</span><span class="op" id="8245205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245213">io</span><span class="op" id="8245215">.</span><span class="ident" id="8245216">WriteString</span><span class="op" id="8245227">(</span><span class="ident" id="8245228">w</span><span class="op" id="8245229">,</span>&nbsp;<span class="string" id="8245231">&#34;}\n&#34;</span><span class="op" id="8245236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245240">if</span>&nbsp;<span class="ident" id="8245243">lastAlpha</span>&nbsp;<span class="op" id="8245253">!=</span>&nbsp;<span class="op" id="8245256">-</span><span class="num" id="8245257">1</span>&nbsp;<span class="op" id="8245259">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245264">io</span><span class="op" id="8245266">.</span><span class="ident" id="8245267">WriteString</span><span class="op" id="8245278">(</span><span class="ident" id="8245279">w</span><span class="op" id="8245280">,</span>&nbsp;<span class="string" id="8245282">&#34;tRNS&nbsp;{\n&#34;</span><span class="op" id="8245292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245297">for</span>&nbsp;<span class="ident" id="8245301">i</span>&nbsp;<span class="op" id="8245303">:=</span>&nbsp;<span class="num" id="8245306">0</span><span class="op" id="8245307">;</span>&nbsp;<span class="ident" id="8245309">i</span>&nbsp;<span class="op" id="8245311">&lt;=</span>&nbsp;<span class="ident" id="8245314">lastAlpha</span><span class="op" id="8245323">;</span>&nbsp;<span class="ident" id="8245325">i</span><span class="op" id="8245326">++</span>&nbsp;<span class="op" id="8245329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245335">_</span><span class="op" id="8245336">,</span>&nbsp;<span class="ident" id="8245338">_</span><span class="op" id="8245339">,</span>&nbsp;<span class="ident" id="8245341">_</span><span class="op" id="8245342">,</span>&nbsp;<span class="ident" id="8245344">a</span>&nbsp;<span class="op" id="8245346">:=</span>&nbsp;<span class="ident" id="8245349">cpm</span><span class="op" id="8245352">[</span><span class="ident" id="8245353">i</span><span class="op" id="8245354">]</span><span class="op" id="8245355">.</span><span class="ident" id="8245356">RGBA</span><span class="op" id="8245360">(</span><span class="op" id="8245361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245367">a</span>&nbsp;<span class="op" id="8245369">&gt;&gt;=</span>&nbsp;<span class="num" id="8245373">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245379">fmt</span><span class="op" id="8245382">.</span><span class="ident" id="8245383">Fprintf</span><span class="op" id="8245390">(</span><span class="ident" id="8245391">w</span><span class="op" id="8245392">,</span>&nbsp;<span class="string" id="8245394">&#34;&nbsp;%d&#34;</span><span class="op" id="8245399">,</span>&nbsp;<span class="ident" id="8245401">a</span><span class="op" id="8245402">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245412">io</span><span class="op" id="8245414">.</span><span class="ident" id="8245415">WriteString</span><span class="op" id="8245426">(</span><span class="ident" id="8245427">w</span><span class="op" id="8245428">,</span>&nbsp;<span class="string" id="8245430">&#34;}\n&#34;</span><span class="op" id="8245435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8245446">//&nbsp;Write&nbsp;the&nbsp;IMAGE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245467">io</span><span class="op" id="8245469">.</span><span class="ident" id="8245470">WriteString</span><span class="op" id="8245481">(</span><span class="ident" id="8245482">w</span><span class="op" id="8245483">,</span>&nbsp;<span class="string" id="8245485">&#34;IMAGE&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;pixels&nbsp;hex\n&#34;</span><span class="op" id="8245512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245515">for</span>&nbsp;<span class="ident" id="8245519">y</span>&nbsp;<span class="op" id="8245521">:=</span>&nbsp;<span class="ident" id="8245524">bounds</span><span class="op" id="8245530">.</span><span class="ident" id="8245531">Min</span><span class="op" id="8245534">.</span><span class="ident" id="8245535">Y</span><span class="op" id="8245536">;</span>&nbsp;<span class="ident" id="8245538">y</span>&nbsp;<span class="op" id="8245540">&lt;</span>&nbsp;<span class="ident" id="8245542">bounds</span><span class="op" id="8245548">.</span><span class="ident" id="8245549">Max</span><span class="op" id="8245552">.</span><span class="ident" id="8245553">Y</span><span class="op" id="8245554">;</span>&nbsp;<span class="ident" id="8245556">y</span><span class="op" id="8245557">++</span>&nbsp;<span class="op" id="8245560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245564">switch</span>&nbsp;<span class="op" id="8245571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245575">case</span>&nbsp;<span class="ident" id="8245580">cm</span>&nbsp;<span class="op" id="8245583">==</span>&nbsp;<span class="ident" id="8245586">color</span><span class="op" id="8245591">.</span><span class="ident" id="8245592">GrayModel</span><span class="op" id="8245601">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245606">for</span>&nbsp;<span class="ident" id="8245610">x</span>&nbsp;<span class="op" id="8245612">:=</span>&nbsp;<span class="ident" id="8245615">bounds</span><span class="op" id="8245621">.</span><span class="ident" id="8245622">Min</span><span class="op" id="8245625">.</span><span class="ident" id="8245626">X</span><span class="op" id="8245627">;</span>&nbsp;<span class="ident" id="8245629">x</span>&nbsp;<span class="op" id="8245631">&lt;</span>&nbsp;<span class="ident" id="8245633">bounds</span><span class="op" id="8245639">.</span><span class="ident" id="8245640">Max</span><span class="op" id="8245643">.</span><span class="ident" id="8245644">X</span><span class="op" id="8245645">;</span>&nbsp;<span class="ident" id="8245647">x</span><span class="op" id="8245648">++</span>&nbsp;<span class="op" id="8245651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245657">gray</span>&nbsp;<span class="op" id="8245662">:=</span>&nbsp;<span class="ident" id="8245665">png</span><span class="op" id="8245668">.</span><span class="ident" id="8245669">At</span><span class="op" id="8245671">(</span><span class="ident" id="8245672">x</span><span class="op" id="8245673">,</span>&nbsp;<span class="ident" id="8245675">y</span><span class="op" id="8245676">)</span><span class="op" id="8245677">.</span><span class="op" id="8245678">(</span><span class="ident" id="8245679">color</span><span class="op" id="8245684">.</span><span class="ident" id="8245685">Gray</span><span class="op" id="8245689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245695">fmt</span><span class="op" id="8245698">.</span><span class="ident" id="8245699">Fprintf</span><span class="op" id="8245706">(</span><span class="ident" id="8245707">w</span><span class="op" id="8245708">,</span>&nbsp;<span class="string" id="8245710">&#34;%02x&#34;</span><span class="op" id="8245716">,</span>&nbsp;<span class="ident" id="8245718">gray</span><span class="op" id="8245722">.</span><span class="ident" id="8245723">Y</span><span class="op" id="8245724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245733">case</span>&nbsp;<span class="ident" id="8245738">cm</span>&nbsp;<span class="op" id="8245741">==</span>&nbsp;<span class="ident" id="8245744">color</span><span class="op" id="8245749">.</span><span class="ident" id="8245750">Gray16Model</span><span class="op" id="8245761">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245766">for</span>&nbsp;<span class="ident" id="8245770">x</span>&nbsp;<span class="op" id="8245772">:=</span>&nbsp;<span class="ident" id="8245775">bounds</span><span class="op" id="8245781">.</span><span class="ident" id="8245782">Min</span><span class="op" id="8245785">.</span><span class="ident" id="8245786">X</span><span class="op" id="8245787">;</span>&nbsp;<span class="ident" id="8245789">x</span>&nbsp;<span class="op" id="8245791">&lt;</span>&nbsp;<span class="ident" id="8245793">bounds</span><span class="op" id="8245799">.</span><span class="ident" id="8245800">Max</span><span class="op" id="8245803">.</span><span class="ident" id="8245804">X</span><span class="op" id="8245805">;</span>&nbsp;<span class="ident" id="8245807">x</span><span class="op" id="8245808">++</span>&nbsp;<span class="op" id="8245811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245817">gray16</span>&nbsp;<span class="op" id="8245824">:=</span>&nbsp;<span class="ident" id="8245827">png</span><span class="op" id="8245830">.</span><span class="ident" id="8245831">At</span><span class="op" id="8245833">(</span><span class="ident" id="8245834">x</span><span class="op" id="8245835">,</span>&nbsp;<span class="ident" id="8245837">y</span><span class="op" id="8245838">)</span><span class="op" id="8245839">.</span><span class="op" id="8245840">(</span><span class="ident" id="8245841">color</span><span class="op" id="8245846">.</span><span class="ident" id="8245847">Gray16</span><span class="op" id="8245853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245859">fmt</span><span class="op" id="8245862">.</span><span class="ident" id="8245863">Fprintf</span><span class="op" id="8245870">(</span><span class="ident" id="8245871">w</span><span class="op" id="8245872">,</span>&nbsp;<span class="string" id="8245874">&#34;%04x&nbsp;&#34;</span><span class="op" id="8245881">,</span>&nbsp;<span class="ident" id="8245883">gray16</span><span class="op" id="8245889">.</span><span class="ident" id="8245890">Y</span><span class="op" id="8245891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8245896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245900">case</span>&nbsp;<span class="ident" id="8245905">cm</span>&nbsp;<span class="op" id="8245908">==</span>&nbsp;<span class="ident" id="8245911">color</span><span class="op" id="8245916">.</span><span class="ident" id="8245917">RGBAModel</span><span class="op" id="8245926">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8245931">for</span>&nbsp;<span class="ident" id="8245935">x</span>&nbsp;<span class="op" id="8245937">:=</span>&nbsp;<span class="ident" id="8245940">bounds</span><span class="op" id="8245946">.</span><span class="ident" id="8245947">Min</span><span class="op" id="8245950">.</span><span class="ident" id="8245951">X</span><span class="op" id="8245952">;</span>&nbsp;<span class="ident" id="8245954">x</span>&nbsp;<span class="op" id="8245956">&lt;</span>&nbsp;<span class="ident" id="8245958">bounds</span><span class="op" id="8245964">.</span><span class="ident" id="8245965">Max</span><span class="op" id="8245968">.</span><span class="ident" id="8245969">X</span><span class="op" id="8245970">;</span>&nbsp;<span class="ident" id="8245972">x</span><span class="op" id="8245973">++</span>&nbsp;<span class="op" id="8245976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8245982">rgba</span>&nbsp;<span class="op" id="8245987">:=</span>&nbsp;<span class="ident" id="8245990">png</span><span class="op" id="8245993">.</span><span class="ident" id="8245994">At</span><span class="op" id="8245996">(</span><span class="ident" id="8245997">x</span><span class="op" id="8245998">,</span>&nbsp;<span class="ident" id="8246000">y</span><span class="op" id="8246001">)</span><span class="op" id="8246002">.</span><span class="op" id="8246003">(</span><span class="ident" id="8246004">color</span><span class="op" id="8246009">.</span><span class="ident" id="8246010">RGBA</span><span class="op" id="8246014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246020">fmt</span><span class="op" id="8246023">.</span><span class="ident" id="8246024">Fprintf</span><span class="op" id="8246031">(</span><span class="ident" id="8246032">w</span><span class="op" id="8246033">,</span>&nbsp;<span class="string" id="8246035">&#34;%02x%02x%02x&nbsp;&#34;</span><span class="op" id="8246050">,</span>&nbsp;<span class="ident" id="8246052">rgba</span><span class="op" id="8246056">.</span><span class="ident" id="8246057">R</span><span class="op" id="8246058">,</span>&nbsp;<span class="ident" id="8246060">rgba</span><span class="op" id="8246064">.</span><span class="ident" id="8246065">G</span><span class="op" id="8246066">,</span>&nbsp;<span class="ident" id="8246068">rgba</span><span class="op" id="8246072">.</span><span class="ident" id="8246073">B</span><span class="op" id="8246074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246083">case</span>&nbsp;<span class="ident" id="8246088">cm</span>&nbsp;<span class="op" id="8246091">==</span>&nbsp;<span class="ident" id="8246094">color</span><span class="op" id="8246099">.</span><span class="ident" id="8246100">RGBA64Model</span><span class="op" id="8246111">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246116">for</span>&nbsp;<span class="ident" id="8246120">x</span>&nbsp;<span class="op" id="8246122">:=</span>&nbsp;<span class="ident" id="8246125">bounds</span><span class="op" id="8246131">.</span><span class="ident" id="8246132">Min</span><span class="op" id="8246135">.</span><span class="ident" id="8246136">X</span><span class="op" id="8246137">;</span>&nbsp;<span class="ident" id="8246139">x</span>&nbsp;<span class="op" id="8246141">&lt;</span>&nbsp;<span class="ident" id="8246143">bounds</span><span class="op" id="8246149">.</span><span class="ident" id="8246150">Max</span><span class="op" id="8246153">.</span><span class="ident" id="8246154">X</span><span class="op" id="8246155">;</span>&nbsp;<span class="ident" id="8246157">x</span><span class="op" id="8246158">++</span>&nbsp;<span class="op" id="8246161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246167">rgba64</span>&nbsp;<span class="op" id="8246174">:=</span>&nbsp;<span class="ident" id="8246177">png</span><span class="op" id="8246180">.</span><span class="ident" id="8246181">At</span><span class="op" id="8246183">(</span><span class="ident" id="8246184">x</span><span class="op" id="8246185">,</span>&nbsp;<span class="ident" id="8246187">y</span><span class="op" id="8246188">)</span><span class="op" id="8246189">.</span><span class="op" id="8246190">(</span><span class="ident" id="8246191">color</span><span class="op" id="8246196">.</span><span class="ident" id="8246197">RGBA64</span><span class="op" id="8246203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246209">fmt</span><span class="op" id="8246212">.</span><span class="ident" id="8246213">Fprintf</span><span class="op" id="8246220">(</span><span class="ident" id="8246221">w</span><span class="op" id="8246222">,</span>&nbsp;<span class="string" id="8246224">&#34;%04x%04x%04x&nbsp;&#34;</span><span class="op" id="8246239">,</span>&nbsp;<span class="ident" id="8246241">rgba64</span><span class="op" id="8246247">.</span><span class="ident" id="8246248">R</span><span class="op" id="8246249">,</span>&nbsp;<span class="ident" id="8246251">rgba64</span><span class="op" id="8246257">.</span><span class="ident" id="8246258">G</span><span class="op" id="8246259">,</span>&nbsp;<span class="ident" id="8246261">rgba64</span><span class="op" id="8246267">.</span><span class="ident" id="8246268">B</span><span class="op" id="8246269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246278">case</span>&nbsp;<span class="ident" id="8246283">cm</span>&nbsp;<span class="op" id="8246286">==</span>&nbsp;<span class="ident" id="8246289">color</span><span class="op" id="8246294">.</span><span class="ident" id="8246295">NRGBAModel</span><span class="op" id="8246305">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246310">for</span>&nbsp;<span class="ident" id="8246314">x</span>&nbsp;<span class="op" id="8246316">:=</span>&nbsp;<span class="ident" id="8246319">bounds</span><span class="op" id="8246325">.</span><span class="ident" id="8246326">Min</span><span class="op" id="8246329">.</span><span class="ident" id="8246330">X</span><span class="op" id="8246331">;</span>&nbsp;<span class="ident" id="8246333">x</span>&nbsp;<span class="op" id="8246335">&lt;</span>&nbsp;<span class="ident" id="8246337">bounds</span><span class="op" id="8246343">.</span><span class="ident" id="8246344">Max</span><span class="op" id="8246347">.</span><span class="ident" id="8246348">X</span><span class="op" id="8246349">;</span>&nbsp;<span class="ident" id="8246351">x</span><span class="op" id="8246352">++</span>&nbsp;<span class="op" id="8246355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246361">nrgba</span>&nbsp;<span class="op" id="8246367">:=</span>&nbsp;<span class="ident" id="8246370">png</span><span class="op" id="8246373">.</span><span class="ident" id="8246374">At</span><span class="op" id="8246376">(</span><span class="ident" id="8246377">x</span><span class="op" id="8246378">,</span>&nbsp;<span class="ident" id="8246380">y</span><span class="op" id="8246381">)</span><span class="op" id="8246382">.</span><span class="op" id="8246383">(</span><span class="ident" id="8246384">color</span><span class="op" id="8246389">.</span><span class="ident" id="8246390">NRGBA</span><span class="op" id="8246395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246401">fmt</span><span class="op" id="8246404">.</span><span class="ident" id="8246405">Fprintf</span><span class="op" id="8246412">(</span><span class="ident" id="8246413">w</span><span class="op" id="8246414">,</span>&nbsp;<span class="string" id="8246416">&#34;%02x%02x%02x%02x&nbsp;&#34;</span><span class="op" id="8246435">,</span>&nbsp;<span class="ident" id="8246437">nrgba</span><span class="op" id="8246442">.</span><span class="ident" id="8246443">R</span><span class="op" id="8246444">,</span>&nbsp;<span class="ident" id="8246446">nrgba</span><span class="op" id="8246451">.</span><span class="ident" id="8246452">G</span><span class="op" id="8246453">,</span>&nbsp;<span class="ident" id="8246455">nrgba</span><span class="op" id="8246460">.</span><span class="ident" id="8246461">B</span><span class="op" id="8246462">,</span>&nbsp;<span class="ident" id="8246464">nrgba</span><span class="op" id="8246469">.</span><span class="ident" id="8246470">A</span><span class="op" id="8246471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246480">case</span>&nbsp;<span class="ident" id="8246485">cm</span>&nbsp;<span class="op" id="8246488">==</span>&nbsp;<span class="ident" id="8246491">color</span><span class="op" id="8246496">.</span><span class="ident" id="8246497">NRGBA64Model</span><span class="op" id="8246509">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246514">for</span>&nbsp;<span class="ident" id="8246518">x</span>&nbsp;<span class="op" id="8246520">:=</span>&nbsp;<span class="ident" id="8246523">bounds</span><span class="op" id="8246529">.</span><span class="ident" id="8246530">Min</span><span class="op" id="8246533">.</span><span class="ident" id="8246534">X</span><span class="op" id="8246535">;</span>&nbsp;<span class="ident" id="8246537">x</span>&nbsp;<span class="op" id="8246539">&lt;</span>&nbsp;<span class="ident" id="8246541">bounds</span><span class="op" id="8246547">.</span><span class="ident" id="8246548">Max</span><span class="op" id="8246551">.</span><span class="ident" id="8246552">X</span><span class="op" id="8246553">;</span>&nbsp;<span class="ident" id="8246555">x</span><span class="op" id="8246556">++</span>&nbsp;<span class="op" id="8246559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246565">nrgba64</span>&nbsp;<span class="op" id="8246573">:=</span>&nbsp;<span class="ident" id="8246576">png</span><span class="op" id="8246579">.</span><span class="ident" id="8246580">At</span><span class="op" id="8246582">(</span><span class="ident" id="8246583">x</span><span class="op" id="8246584">,</span>&nbsp;<span class="ident" id="8246586">y</span><span class="op" id="8246587">)</span><span class="op" id="8246588">.</span><span class="op" id="8246589">(</span><span class="ident" id="8246590">color</span><span class="op" id="8246595">.</span><span class="ident" id="8246596">NRGBA64</span><span class="op" id="8246603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246609">fmt</span><span class="op" id="8246612">.</span><span class="ident" id="8246613">Fprintf</span><span class="op" id="8246620">(</span><span class="ident" id="8246621">w</span><span class="op" id="8246622">,</span>&nbsp;<span class="string" id="8246624">&#34;%04x%04x%04x%04x&nbsp;&#34;</span><span class="op" id="8246643">,</span>&nbsp;<span class="ident" id="8246645">nrgba64</span><span class="op" id="8246652">.</span><span class="ident" id="8246653">R</span><span class="op" id="8246654">,</span>&nbsp;<span class="ident" id="8246656">nrgba64</span><span class="op" id="8246663">.</span><span class="ident" id="8246664">G</span><span class="op" id="8246665">,</span>&nbsp;<span class="ident" id="8246667">nrgba64</span><span class="op" id="8246674">.</span><span class="ident" id="8246675">B</span><span class="op" id="8246676">,</span>&nbsp;<span class="ident" id="8246678">nrgba64</span><span class="op" id="8246685">.</span><span class="ident" id="8246686">A</span><span class="op" id="8246687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246696">case</span>&nbsp;<span class="ident" id="8246701">cpm</span>&nbsp;<span class="op" id="8246705">!=</span>&nbsp;<span class="ident" id="8246708">nil</span><span class="op" id="8246711">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246716">var</span>&nbsp;<span class="ident" id="8246720">b</span><span class="op" id="8246721">,</span>&nbsp;<span class="ident" id="8246723">c</span>&nbsp;<span class="builtintype" id="8246725">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246732">for</span>&nbsp;<span class="ident" id="8246736">x</span>&nbsp;<span class="op" id="8246738">:=</span>&nbsp;<span class="ident" id="8246741">bounds</span><span class="op" id="8246747">.</span><span class="ident" id="8246748">Min</span><span class="op" id="8246751">.</span><span class="ident" id="8246752">X</span><span class="op" id="8246753">;</span>&nbsp;<span class="ident" id="8246755">x</span>&nbsp;<span class="op" id="8246757">&lt;</span>&nbsp;<span class="ident" id="8246759">bounds</span><span class="op" id="8246765">.</span><span class="ident" id="8246766">Max</span><span class="op" id="8246769">.</span><span class="ident" id="8246770">X</span><span class="op" id="8246771">;</span>&nbsp;<span class="ident" id="8246773">x</span><span class="op" id="8246774">++</span>&nbsp;<span class="op" id="8246777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246783">b</span>&nbsp;<span class="op" id="8246785">=</span>&nbsp;<span class="ident" id="8246787">b</span><span class="op" id="8246788">&lt;&lt;</span><span class="builtintype" id="8246790">uint</span><span class="op" id="8246794">(</span><span class="ident" id="8246795">bitdepth</span><span class="op" id="8246803">)</span>&nbsp;<span class="op" id="8246805">|</span>&nbsp;<span class="builtintype" id="8246807">int</span><span class="op" id="8246810">(</span><span class="ident" id="8246811">paletted</span><span class="op" id="8246819">.</span><span class="ident" id="8246820">ColorIndexAt</span><span class="op" id="8246832">(</span><span class="ident" id="8246833">x</span><span class="op" id="8246834">,</span>&nbsp;<span class="ident" id="8246836">y</span><span class="op" id="8246837">)</span><span class="op" id="8246838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246844">c</span><span class="op" id="8246845">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246852">if</span>&nbsp;<span class="ident" id="8246855">c</span>&nbsp;<span class="op" id="8246857">==</span>&nbsp;<span class="num" id="8246860">8</span><span class="op" id="8246861">/</span><span class="ident" id="8246862">bitdepth</span>&nbsp;<span class="op" id="8246871">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246878">fmt</span><span class="op" id="8246881">.</span><span class="ident" id="8246882">Fprintf</span><span class="op" id="8246889">(</span><span class="ident" id="8246890">w</span><span class="op" id="8246891">,</span>&nbsp;<span class="string" id="8246893">&#34;%02x&#34;</span><span class="op" id="8246899">,</span>&nbsp;<span class="ident" id="8246901">b</span><span class="op" id="8246902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246909">b</span>&nbsp;<span class="op" id="8246911">=</span>&nbsp;<span class="num" id="8246913">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246920">c</span>&nbsp;<span class="op" id="8246922">=</span>&nbsp;<span class="num" id="8246924">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8246935">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246940">if</span>&nbsp;<span class="ident" id="8246943">c</span>&nbsp;<span class="op" id="8246945">!=</span>&nbsp;<span class="num" id="8246948">0</span>&nbsp;<span class="op" id="8246950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8246956">for</span>&nbsp;<span class="ident" id="8246960">c</span>&nbsp;<span class="op" id="8246962">!=</span>&nbsp;<span class="num" id="8246965">8</span><span class="op" id="8246966">/</span><span class="ident" id="8246967">bitdepth</span>&nbsp;<span class="op" id="8246976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8246983">b</span>&nbsp;<span class="op" id="8246985">=</span>&nbsp;<span class="ident" id="8246987">b</span>&nbsp;<span class="op" id="8246989">&lt;&lt;</span>&nbsp;<span class="builtintype" id="8246992">uint</span><span class="op" id="8246996">(</span><span class="ident" id="8246997">bitdepth</span><span class="op" id="8247005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247012">c</span><span class="op" id="8247013">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247020">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247026">fmt</span><span class="op" id="8247029">.</span><span class="ident" id="8247030">Fprintf</span><span class="op" id="8247037">(</span><span class="ident" id="8247038">w</span><span class="op" id="8247039">,</span>&nbsp;<span class="string" id="8247041">&#34;%02x&#34;</span><span class="op" id="8247047">,</span>&nbsp;<span class="ident" id="8247049">b</span><span class="op" id="8247050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247063">io</span><span class="op" id="8247065">.</span><span class="ident" id="8247066">WriteString</span><span class="op" id="8247077">(</span><span class="ident" id="8247078">w</span><span class="op" id="8247079">,</span>&nbsp;<span class="string" id="8247081">&#34;\n&#34;</span><span class="op" id="8247085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247088">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247091">io</span><span class="op" id="8247093">.</span><span class="ident" id="8247094">WriteString</span><span class="op" id="8247105">(</span><span class="ident" id="8247106">w</span><span class="op" id="8247107">,</span>&nbsp;<span class="string" id="8247109">&#34;}\n&#34;</span><span class="op" id="8247114">)</span><br>
<span class="lineno"></span><span class="op" id="8247116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8247119">func</span>&nbsp;<span class="ident" id="8247124">TestReader</span><span class="op" id="8247134">(</span><span class="ident" id="8247135">t</span>&nbsp;<span class="op" id="8247137">*</span><span class="ident" id="8247138">testing</span><span class="op" id="8247145">.</span><span class="ident" id="8247146">T</span><span class="op" id="8247147">)</span>&nbsp;<span class="op" id="8247149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247152">names</span>&nbsp;<span class="op" id="8247158">:=</span>&nbsp;<span class="ident" id="8247161">filenames</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247172">if</span>&nbsp;<span class="ident" id="8247175">testing</span><span class="op" id="8247182">.</span><span class="ident" id="8247183">Short</span><span class="op" id="8247188">(</span><span class="op" id="8247189">)</span>&nbsp;<span class="op" id="8247191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247195">names</span>&nbsp;<span class="op" id="8247201">=</span>&nbsp;<span class="ident" id="8247203">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247222">for</span>&nbsp;<span class="ident" id="8247226">_</span><span class="op" id="8247227">,</span>&nbsp;<span class="ident" id="8247229">fn</span>&nbsp;<span class="op" id="8247232">:=</span>&nbsp;<span class="keyword" id="8247235">range</span>&nbsp;<span class="ident" id="8247241">names</span>&nbsp;<span class="op" id="8247247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8247251">//&nbsp;Read&nbsp;the&nbsp;.png&nbsp;file.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247276">img</span><span class="op" id="8247279">,</span>&nbsp;<span class="ident" id="8247281">err</span>&nbsp;<span class="op" id="8247285">:=</span>&nbsp;<span class="ident" id="8247288">readPNG</span><span class="op" id="8247295">(</span><span class="string" id="8247296">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="8247317">+</span>&nbsp;<span class="ident" id="8247319">fn</span>&nbsp;<span class="op" id="8247322">+</span>&nbsp;<span class="string" id="8247324">&#34;.png&#34;</span><span class="op" id="8247330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247334">if</span>&nbsp;<span class="ident" id="8247337">err</span>&nbsp;<span class="op" id="8247341">!=</span>&nbsp;<span class="ident" id="8247344">nil</span>&nbsp;<span class="op" id="8247348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247353">t</span><span class="op" id="8247354">.</span><span class="ident" id="8247355">Error</span><span class="op" id="8247360">(</span><span class="ident" id="8247361">fn</span><span class="op" id="8247363">,</span>&nbsp;<span class="ident" id="8247365">err</span><span class="op" id="8247368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247373">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247384">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247389">if</span>&nbsp;<span class="ident" id="8247392">fn</span>&nbsp;<span class="op" id="8247395">==</span>&nbsp;<span class="string" id="8247398">&#34;basn4a16&#34;</span>&nbsp;<span class="op" id="8247409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8247414">//&nbsp;basn4a16.sng&nbsp;is&nbsp;gray&nbsp;+&nbsp;alpha&nbsp;but&nbsp;sng()&nbsp;will&nbsp;produce&nbsp;true&nbsp;color&nbsp;+&nbsp;alpha</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8247491">//&nbsp;so&nbsp;we&nbsp;just&nbsp;check&nbsp;a&nbsp;single&nbsp;random&nbsp;pixel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247537">c</span>&nbsp;<span class="op" id="8247539">:=</span>&nbsp;<span class="ident" id="8247542">img</span><span class="op" id="8247545">.</span><span class="ident" id="8247546">At</span><span class="op" id="8247548">(</span><span class="num" id="8247549">2</span><span class="op" id="8247550">,</span>&nbsp;<span class="num" id="8247552">1</span><span class="op" id="8247553">)</span><span class="op" id="8247554">.</span><span class="op" id="8247555">(</span><span class="ident" id="8247556">color</span><span class="op" id="8247561">.</span><span class="ident" id="8247562">NRGBA64</span><span class="op" id="8247569">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247574">if</span>&nbsp;<span class="ident" id="8247577">c</span><span class="op" id="8247578">.</span><span class="ident" id="8247579">R</span>&nbsp;<span class="op" id="8247581">!=</span>&nbsp;<span class="num" id="8247584">0x11a7</span>&nbsp;<span class="op" id="8247591">||</span>&nbsp;<span class="ident" id="8247594">c</span><span class="op" id="8247595">.</span><span class="ident" id="8247596">G</span>&nbsp;<span class="op" id="8247598">!=</span>&nbsp;<span class="num" id="8247601">0x11a7</span>&nbsp;<span class="op" id="8247608">||</span>&nbsp;<span class="ident" id="8247611">c</span><span class="op" id="8247612">.</span><span class="ident" id="8247613">B</span>&nbsp;<span class="op" id="8247615">!=</span>&nbsp;<span class="num" id="8247618">0x11a7</span>&nbsp;<span class="op" id="8247625">||</span>&nbsp;<span class="ident" id="8247628">c</span><span class="op" id="8247629">.</span><span class="ident" id="8247630">A</span>&nbsp;<span class="op" id="8247632">!=</span>&nbsp;<span class="num" id="8247635">0x1085</span>&nbsp;<span class="op" id="8247642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247648">t</span><span class="op" id="8247649">.</span><span class="ident" id="8247650">Error</span><span class="op" id="8247655">(</span><span class="ident" id="8247656">fn</span><span class="op" id="8247658">,</span>&nbsp;<span class="ident" id="8247660">fmt</span><span class="op" id="8247663">.</span><span class="ident" id="8247664">Errorf</span><span class="op" id="8247670">(</span><span class="string" id="8247671">&#34;wrong&nbsp;pixel&nbsp;value&nbsp;at&nbsp;(2,&nbsp;1):&nbsp;%x&#34;</span><span class="op" id="8247704">,</span>&nbsp;<span class="ident" id="8247706">c</span><span class="op" id="8247707">)</span><span class="op" id="8247708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247718">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247729">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247734">piper</span><span class="op" id="8247739">,</span>&nbsp;<span class="ident" id="8247741">pipew</span>&nbsp;<span class="op" id="8247747">:=</span>&nbsp;<span class="ident" id="8247750">io</span><span class="op" id="8247752">.</span><span class="ident" id="8247753">Pipe</span><span class="op" id="8247757">(</span><span class="op" id="8247758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247762">pb</span>&nbsp;<span class="op" id="8247765">:=</span>&nbsp;<span class="ident" id="8247768">bufio</span><span class="op" id="8247773">.</span><span class="ident" id="8247774">NewScanner</span><span class="op" id="8247784">(</span><span class="ident" id="8247785">piper</span><span class="op" id="8247790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247794">go</span>&nbsp;<span class="ident" id="8247797">sng</span><span class="op" id="8247800">(</span><span class="ident" id="8247801">pipew</span><span class="op" id="8247806">,</span>&nbsp;<span class="ident" id="8247808">fn</span><span class="op" id="8247810">,</span>&nbsp;<span class="ident" id="8247812">img</span><span class="op" id="8247815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247819">defer</span>&nbsp;<span class="ident" id="8247825">piper</span><span class="op" id="8247830">.</span><span class="ident" id="8247831">Close</span><span class="op" id="8247836">(</span><span class="op" id="8247837">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8247842">//&nbsp;Read&nbsp;the&nbsp;.sng&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247867">sf</span><span class="op" id="8247869">,</span>&nbsp;<span class="ident" id="8247871">err</span>&nbsp;<span class="op" id="8247875">:=</span>&nbsp;<span class="ident" id="8247878">os</span><span class="op" id="8247880">.</span><span class="ident" id="8247881">Open</span><span class="op" id="8247885">(</span><span class="string" id="8247886">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="8247907">+</span>&nbsp;<span class="ident" id="8247909">fn</span>&nbsp;<span class="op" id="8247912">+</span>&nbsp;<span class="string" id="8247914">&#34;.sng&#34;</span><span class="op" id="8247920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247924">if</span>&nbsp;<span class="ident" id="8247927">err</span>&nbsp;<span class="op" id="8247931">!=</span>&nbsp;<span class="ident" id="8247934">nil</span>&nbsp;<span class="op" id="8247938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247943">t</span><span class="op" id="8247944">.</span><span class="ident" id="8247945">Error</span><span class="op" id="8247950">(</span><span class="ident" id="8247951">fn</span><span class="op" id="8247953">,</span>&nbsp;<span class="ident" id="8247955">err</span><span class="op" id="8247958">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247963">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8247974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8247978">defer</span>&nbsp;<span class="ident" id="8247984">sf</span><span class="op" id="8247986">.</span><span class="ident" id="8247987">Close</span><span class="op" id="8247992">(</span><span class="op" id="8247993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8247997">sb</span>&nbsp;<span class="op" id="8248000">:=</span>&nbsp;<span class="ident" id="8248003">bufio</span><span class="op" id="8248008">.</span><span class="ident" id="8248009">NewScanner</span><span class="op" id="8248019">(</span><span class="ident" id="8248020">sf</span><span class="op" id="8248022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248026">if</span>&nbsp;<span class="ident" id="8248029">err</span>&nbsp;<span class="op" id="8248033">!=</span>&nbsp;<span class="ident" id="8248036">nil</span>&nbsp;<span class="op" id="8248040">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248045">t</span><span class="op" id="8248046">.</span><span class="ident" id="8248047">Error</span><span class="op" id="8248052">(</span><span class="ident" id="8248053">fn</span><span class="op" id="8248055">,</span>&nbsp;<span class="ident" id="8248057">err</span><span class="op" id="8248060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248065">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8248081">//&nbsp;Compare&nbsp;the&nbsp;two,&nbsp;in&nbsp;SNG&nbsp;format,&nbsp;line&nbsp;by&nbsp;line.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248132">for</span>&nbsp;<span class="op" id="8248136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248141">pdone</span>&nbsp;<span class="op" id="8248147">:=</span>&nbsp;<span class="op" id="8248150">!</span><span class="ident" id="8248151">pb</span><span class="op" id="8248153">.</span><span class="ident" id="8248154">Scan</span><span class="op" id="8248158">(</span><span class="op" id="8248159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248164">sdone</span>&nbsp;<span class="op" id="8248170">:=</span>&nbsp;<span class="op" id="8248173">!</span><span class="ident" id="8248174">sb</span><span class="op" id="8248176">.</span><span class="ident" id="8248177">Scan</span><span class="op" id="8248181">(</span><span class="op" id="8248182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248187">if</span>&nbsp;<span class="ident" id="8248190">pdone</span>&nbsp;<span class="op" id="8248196">&amp;&amp;</span>&nbsp;<span class="ident" id="8248199">sdone</span>&nbsp;<span class="op" id="8248205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248211">break</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248225">if</span>&nbsp;<span class="ident" id="8248228">pdone</span>&nbsp;<span class="op" id="8248234">||</span>&nbsp;<span class="ident" id="8248237">sdone</span>&nbsp;<span class="op" id="8248243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248249">t</span><span class="op" id="8248250">.</span><span class="ident" id="8248251">Errorf</span><span class="op" id="8248257">(</span><span class="string" id="8248258">&#34;%s:&nbsp;Different&nbsp;sizes&#34;</span><span class="op" id="8248279">,</span>&nbsp;<span class="ident" id="8248281">fn</span><span class="op" id="8248283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248289">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248298">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248303">ps</span>&nbsp;<span class="op" id="8248306">:=</span>&nbsp;<span class="ident" id="8248309">pb</span><span class="op" id="8248311">.</span><span class="ident" id="8248312">Text</span><span class="op" id="8248316">(</span><span class="op" id="8248317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248322">ss</span>&nbsp;<span class="op" id="8248325">:=</span>&nbsp;<span class="ident" id="8248328">sb</span><span class="op" id="8248330">.</span><span class="ident" id="8248331">Text</span><span class="op" id="8248335">(</span><span class="op" id="8248336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248341">if</span>&nbsp;<span class="ident" id="8248344">ps</span>&nbsp;<span class="op" id="8248347">!=</span>&nbsp;<span class="ident" id="8248350">ss</span>&nbsp;<span class="op" id="8248353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248359">t</span><span class="op" id="8248360">.</span><span class="ident" id="8248361">Errorf</span><span class="op" id="8248367">(</span><span class="string" id="8248368">&#34;%s:&nbsp;Mismatch\n%sversus\n%s\n&#34;</span><span class="op" id="8248398">,</span>&nbsp;<span class="ident" id="8248400">fn</span><span class="op" id="8248402">,</span>&nbsp;<span class="ident" id="8248404">ps</span><span class="op" id="8248406">,</span>&nbsp;<span class="ident" id="8248408">ss</span><span class="op" id="8248410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248416">break</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248433">if</span>&nbsp;<span class="ident" id="8248436">pb</span><span class="op" id="8248438">.</span><span class="ident" id="8248439">Err</span><span class="op" id="8248442">(</span><span class="op" id="8248443">)</span>&nbsp;<span class="op" id="8248445">!=</span>&nbsp;<span class="ident" id="8248448">nil</span>&nbsp;<span class="op" id="8248452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248457">t</span><span class="op" id="8248458">.</span><span class="ident" id="8248459">Error</span><span class="op" id="8248464">(</span><span class="ident" id="8248465">fn</span><span class="op" id="8248467">,</span>&nbsp;<span class="ident" id="8248469">pb</span><span class="op" id="8248471">.</span><span class="ident" id="8248472">Err</span><span class="op" id="8248475">(</span><span class="op" id="8248476">)</span><span class="op" id="8248477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248481">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248485">if</span>&nbsp;<span class="ident" id="8248488">sb</span><span class="op" id="8248490">.</span><span class="ident" id="8248491">Err</span><span class="op" id="8248494">(</span><span class="op" id="8248495">)</span>&nbsp;<span class="op" id="8248497">!=</span>&nbsp;<span class="ident" id="8248500">nil</span>&nbsp;<span class="op" id="8248504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248509">t</span><span class="op" id="8248510">.</span><span class="ident" id="8248511">Error</span><span class="op" id="8248516">(</span><span class="ident" id="8248517">fn</span><span class="op" id="8248519">,</span>&nbsp;<span class="ident" id="8248521">sb</span><span class="op" id="8248523">.</span><span class="ident" id="8248524">Err</span><span class="op" id="8248527">(</span><span class="op" id="8248528">)</span><span class="op" id="8248529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248536">}</span><br>
<span class="lineno"></span><span class="op" id="8248538">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="8248541">var</span>&nbsp;<span class="ident" id="8248545">readerErrors</span>&nbsp;<span class="op" id="8248558">=</span>&nbsp;<span class="op" id="8248560">[</span><span class="op" id="8248561">]</span><span class="keyword" id="8248562">struct</span>&nbsp;<span class="op" id="8248569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248572">file</span>&nbsp;<span class="builtintype" id="8248577">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248585">err</span>&nbsp;&nbsp;<span class="builtintype" id="8248590">string</span><br>
<span class="lineno"></span><span class="op" id="8248597">}</span><span class="op" id="8248598">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248601">{</span><span class="string" id="8248602">&#34;invalid-zlib.png&#34;</span><span class="op" id="8248620">,</span>&nbsp;<span class="string" id="8248622">&#34;zlib:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="8248646">}</span><span class="op" id="8248647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248650">{</span><span class="string" id="8248651">&#34;invalid-crc32.png&#34;</span><span class="op" id="8248670">,</span>&nbsp;<span class="string" id="8248672">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="8248690">}</span><span class="op" id="8248691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248694">{</span><span class="string" id="8248695">&#34;invalid-noend.png&#34;</span><span class="op" id="8248714">,</span>&nbsp;<span class="string" id="8248716">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="8248732">}</span><span class="op" id="8248733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248736">{</span><span class="string" id="8248737">&#34;invalid-trunc.png&#34;</span><span class="op" id="8248756">,</span>&nbsp;<span class="string" id="8248758">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="8248774">}</span><span class="op" id="8248775">,</span><br>
<span class="lineno"></span><span class="op" id="8248777">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="8248780">func</span>&nbsp;<span class="ident" id="8248785">TestReaderError</span><span class="op" id="8248800">(</span><span class="ident" id="8248801">t</span>&nbsp;<span class="op" id="8248803">*</span><span class="ident" id="8248804">testing</span><span class="op" id="8248811">.</span><span class="ident" id="8248812">T</span><span class="op" id="8248813">)</span>&nbsp;<span class="op" id="8248815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248818">for</span>&nbsp;<span class="ident" id="8248822">_</span><span class="op" id="8248823">,</span>&nbsp;<span class="ident" id="8248825">tt</span>&nbsp;<span class="op" id="8248828">:=</span>&nbsp;<span class="keyword" id="8248831">range</span>&nbsp;<span class="ident" id="8248837">readerErrors</span>&nbsp;<span class="op" id="8248850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248854">img</span><span class="op" id="8248857">,</span>&nbsp;<span class="ident" id="8248859">err</span>&nbsp;<span class="op" id="8248863">:=</span>&nbsp;<span class="ident" id="8248866">readPNG</span><span class="op" id="8248873">(</span><span class="string" id="8248874">&#34;testdata/&#34;</span>&nbsp;<span class="op" id="8248886">+</span>&nbsp;<span class="ident" id="8248888">tt</span><span class="op" id="8248890">.</span><span class="ident" id="8248891">file</span><span class="op" id="8248895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248899">if</span>&nbsp;<span class="ident" id="8248902">err</span>&nbsp;<span class="op" id="8248906">==</span>&nbsp;<span class="ident" id="8248909">nil</span>&nbsp;<span class="op" id="8248913">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8248918">t</span><span class="op" id="8248919">.</span><span class="ident" id="8248920">Errorf</span><span class="op" id="8248926">(</span><span class="string" id="8248927">&#34;decoding&nbsp;%s:&nbsp;missing&nbsp;error&#34;</span><span class="op" id="8248955">,</span>&nbsp;<span class="ident" id="8248957">tt</span><span class="op" id="8248959">.</span><span class="ident" id="8248960">file</span><span class="op" id="8248964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248969">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8248980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8248984">if</span>&nbsp;<span class="op" id="8248987">!</span><span class="ident" id="8248988">strings</span><span class="op" id="8248995">.</span><span class="ident" id="8248996">Contains</span><span class="op" id="8249004">(</span><span class="ident" id="8249005">err</span><span class="op" id="8249008">.</span><span class="ident" id="8249009">Error</span><span class="op" id="8249014">(</span><span class="op" id="8249015">)</span><span class="op" id="8249016">,</span>&nbsp;<span class="ident" id="8249018">tt</span><span class="op" id="8249020">.</span><span class="ident" id="8249021">err</span><span class="op" id="8249024">)</span>&nbsp;<span class="op" id="8249026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249031">t</span><span class="op" id="8249032">.</span><span class="ident" id="8249033">Errorf</span><span class="op" id="8249039">(</span><span class="string" id="8249040">&#34;decoding&nbsp;%s:&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8249066">,</span>&nbsp;<span class="ident" id="8249068">tt</span><span class="op" id="8249070">.</span><span class="ident" id="8249071">file</span><span class="op" id="8249075">,</span>&nbsp;<span class="ident" id="8249077">err</span><span class="op" id="8249080">,</span>&nbsp;<span class="ident" id="8249082">tt</span><span class="op" id="8249084">.</span><span class="ident" id="8249085">err</span><span class="op" id="8249088">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249096">if</span>&nbsp;<span class="ident" id="8249099">img</span>&nbsp;<span class="op" id="8249103">!=</span>&nbsp;<span class="ident" id="8249106">nil</span>&nbsp;<span class="op" id="8249110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249115">t</span><span class="op" id="8249116">.</span><span class="ident" id="8249117">Errorf</span><span class="op" id="8249123">(</span><span class="string" id="8249124">&#34;decoding&nbsp;%s:&nbsp;have&nbsp;image&nbsp;+&nbsp;error&#34;</span><span class="op" id="8249157">,</span>&nbsp;<span class="ident" id="8249159">tt</span><span class="op" id="8249161">.</span><span class="ident" id="8249162">file</span><span class="op" id="8249166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249173">}</span><br>
<span class="lineno">295</span><span class="op" id="8249175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8249178">func</span>&nbsp;<span class="ident" id="8249183">TestPalettedDecodeConfig</span><span class="op" id="8249207">(</span><span class="ident" id="8249208">t</span>&nbsp;<span class="op" id="8249210">*</span><span class="ident" id="8249211">testing</span><span class="op" id="8249218">.</span><span class="ident" id="8249219">T</span><span class="op" id="8249220">)</span>&nbsp;<span class="op" id="8249222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249225">for</span>&nbsp;<span class="ident" id="8249229">_</span><span class="op" id="8249230">,</span>&nbsp;<span class="ident" id="8249232">fn</span>&nbsp;<span class="op" id="8249235">:=</span>&nbsp;<span class="keyword" id="8249238">range</span>&nbsp;<span class="ident" id="8249244">filenamesPaletted</span>&nbsp;<span class="op" id="8249262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249266">f</span><span class="op" id="8249267">,</span>&nbsp;<span class="ident" id="8249269">err</span>&nbsp;<span class="op" id="8249273">:=</span>&nbsp;<span class="ident" id="8249276">os</span><span class="op" id="8249278">.</span><span class="ident" id="8249279">Open</span><span class="op" id="8249283">(</span><span class="string" id="8249284">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="8249305">+</span>&nbsp;<span class="ident" id="8249307">fn</span>&nbsp;<span class="op" id="8249310">+</span>&nbsp;<span class="string" id="8249312">&#34;.png&#34;</span><span class="op" id="8249318">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249322">if</span>&nbsp;<span class="ident" id="8249325">err</span>&nbsp;<span class="op" id="8249329">!=</span>&nbsp;<span class="ident" id="8249332">nil</span>&nbsp;<span class="op" id="8249336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249341">t</span><span class="op" id="8249342">.</span><span class="ident" id="8249343">Errorf</span><span class="op" id="8249349">(</span><span class="string" id="8249350">&#34;%s:&nbsp;open&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8249371">,</span>&nbsp;<span class="ident" id="8249373">fn</span><span class="op" id="8249375">,</span>&nbsp;<span class="ident" id="8249377">err</span><span class="op" id="8249380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249385">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249400">defer</span>&nbsp;<span class="ident" id="8249406">f</span><span class="op" id="8249407">.</span><span class="ident" id="8249408">Close</span><span class="op" id="8249413">(</span><span class="op" id="8249414">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249418">cfg</span><span class="op" id="8249421">,</span>&nbsp;<span class="ident" id="8249423">err</span>&nbsp;<span class="op" id="8249427">:=</span>&nbsp;<span class="ident" id="8249430">DecodeConfig</span><span class="op" id="8249442">(</span><span class="ident" id="8249443">f</span><span class="op" id="8249444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249448">if</span>&nbsp;<span class="ident" id="8249451">err</span>&nbsp;<span class="op" id="8249455">!=</span>&nbsp;<span class="ident" id="8249458">nil</span>&nbsp;<span class="op" id="8249462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249467">t</span><span class="op" id="8249468">.</span><span class="ident" id="8249469">Errorf</span><span class="op" id="8249475">(</span><span class="string" id="8249476">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="8249484">,</span>&nbsp;<span class="ident" id="8249486">fn</span><span class="op" id="8249488">,</span>&nbsp;<span class="ident" id="8249490">err</span><span class="op" id="8249493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249498">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249509">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249513">pal</span><span class="op" id="8249516">,</span>&nbsp;<span class="ident" id="8249518">ok</span>&nbsp;<span class="op" id="8249521">:=</span>&nbsp;<span class="ident" id="8249524">cfg</span><span class="op" id="8249527">.</span><span class="ident" id="8249528">ColorModel</span><span class="op" id="8249538">.</span><span class="op" id="8249539">(</span><span class="ident" id="8249540">color</span><span class="op" id="8249545">.</span><span class="ident" id="8249546">Palette</span><span class="op" id="8249553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249557">if</span>&nbsp;<span class="op" id="8249560">!</span><span class="ident" id="8249561">ok</span>&nbsp;<span class="op" id="8249564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249569">t</span><span class="op" id="8249570">.</span><span class="ident" id="8249571">Errorf</span><span class="op" id="8249577">(</span><span class="string" id="8249578">&#34;%s:&nbsp;expected&nbsp;paletted&nbsp;color&nbsp;model&#34;</span><span class="op" id="8249613">,</span>&nbsp;<span class="ident" id="8249615">fn</span><span class="op" id="8249617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249622">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249633">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249637">if</span>&nbsp;<span class="ident" id="8249640">pal</span>&nbsp;<span class="op" id="8249644">==</span>&nbsp;<span class="ident" id="8249647">nil</span>&nbsp;<span class="op" id="8249651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249656">t</span><span class="op" id="8249657">.</span><span class="ident" id="8249658">Errorf</span><span class="op" id="8249664">(</span><span class="string" id="8249665">&#34;%s:&nbsp;palette&nbsp;not&nbsp;initialized&#34;</span><span class="op" id="8249694">,</span>&nbsp;<span class="ident" id="8249696">fn</span><span class="op" id="8249698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249703">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249717">}</span><br>
<span class="lineno">320</span><span class="op" id="8249719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8249722">func</span>&nbsp;<span class="ident" id="8249727">benchmarkDecode</span><span class="op" id="8249742">(</span><span class="ident" id="8249743">b</span>&nbsp;<span class="op" id="8249745">*</span><span class="ident" id="8249746">testing</span><span class="op" id="8249753">.</span><span class="ident" id="8249754">B</span><span class="op" id="8249755">,</span>&nbsp;<span class="ident" id="8249757">filename</span>&nbsp;<span class="builtintype" id="8249766">string</span><span class="op" id="8249772">,</span>&nbsp;<span class="ident" id="8249774">bytesPerPixel</span>&nbsp;<span class="builtintype" id="8249788">int</span><span class="op" id="8249791">)</span>&nbsp;<span class="op" id="8249793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249796">b</span><span class="op" id="8249797">.</span><span class="ident" id="8249798">StopTimer</span><span class="op" id="8249807">(</span><span class="op" id="8249808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249811">data</span><span class="op" id="8249815">,</span>&nbsp;<span class="ident" id="8249817">err</span>&nbsp;<span class="op" id="8249821">:=</span>&nbsp;<span class="ident" id="8249824">ioutil</span><span class="op" id="8249830">.</span><span class="ident" id="8249831">ReadFile</span><span class="op" id="8249839">(</span><span class="ident" id="8249840">filename</span><span class="op" id="8249848">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249851">if</span>&nbsp;<span class="ident" id="8249854">err</span>&nbsp;<span class="op" id="8249858">!=</span>&nbsp;<span class="ident" id="8249861">nil</span>&nbsp;<span class="op" id="8249865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249869">b</span><span class="op" id="8249870">.</span><span class="ident" id="8249871">Fatal</span><span class="op" id="8249876">(</span><span class="ident" id="8249877">err</span><span class="op" id="8249880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249886">s</span>&nbsp;<span class="op" id="8249888">:=</span>&nbsp;<span class="builtintype" id="8249891">string</span><span class="op" id="8249897">(</span><span class="ident" id="8249898">data</span><span class="op" id="8249902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249905">cfg</span><span class="op" id="8249908">,</span>&nbsp;<span class="ident" id="8249910">err</span>&nbsp;<span class="op" id="8249914">:=</span>&nbsp;<span class="ident" id="8249917">DecodeConfig</span><span class="op" id="8249929">(</span><span class="ident" id="8249930">strings</span><span class="op" id="8249937">.</span><span class="ident" id="8249938">NewReader</span><span class="op" id="8249947">(</span><span class="ident" id="8249948">s</span><span class="op" id="8249949">)</span><span class="op" id="8249950">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8249953">if</span>&nbsp;<span class="ident" id="8249956">err</span>&nbsp;<span class="op" id="8249960">!=</span>&nbsp;<span class="ident" id="8249963">nil</span>&nbsp;<span class="op" id="8249967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249971">b</span><span class="op" id="8249972">.</span><span class="ident" id="8249973">Fatal</span><span class="op" id="8249978">(</span><span class="ident" id="8249979">err</span><span class="op" id="8249982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8249985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8249988">b</span><span class="op" id="8249989">.</span><span class="ident" id="8249990">SetBytes</span><span class="op" id="8249998">(</span><span class="ident" id="8249999">int64</span><span class="op" id="8250004">(</span><span class="ident" id="8250005">cfg</span><span class="op" id="8250008">.</span><span class="ident" id="8250009">Width</span>&nbsp;<span class="op" id="8250015">*</span>&nbsp;<span class="ident" id="8250017">cfg</span><span class="op" id="8250020">.</span><span class="ident" id="8250021">Height</span>&nbsp;<span class="op" id="8250028">*</span>&nbsp;<span class="ident" id="8250030">bytesPerPixel</span><span class="op" id="8250043">)</span><span class="op" id="8250044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250047">b</span><span class="op" id="8250048">.</span><span class="ident" id="8250049">StartTimer</span><span class="op" id="8250059">(</span><span class="op" id="8250060">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8250063">for</span>&nbsp;<span class="ident" id="8250067">i</span>&nbsp;<span class="op" id="8250069">:=</span>&nbsp;<span class="num" id="8250072">0</span><span class="op" id="8250073">;</span>&nbsp;<span class="ident" id="8250075">i</span>&nbsp;<span class="op" id="8250077">&lt;</span>&nbsp;<span class="ident" id="8250079">b</span><span class="op" id="8250080">.</span><span class="ident" id="8250081">N</span><span class="op" id="8250082">;</span>&nbsp;<span class="ident" id="8250084">i</span><span class="op" id="8250085">++</span>&nbsp;<span class="op" id="8250088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250092">Decode</span><span class="op" id="8250098">(</span><span class="ident" id="8250099">strings</span><span class="op" id="8250106">.</span><span class="ident" id="8250107">NewReader</span><span class="op" id="8250116">(</span><span class="ident" id="8250117">s</span><span class="op" id="8250118">)</span><span class="op" id="8250119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8250122">}</span><br>
<span class="lineno"></span><span class="op" id="8250124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="8250127">func</span>&nbsp;<span class="ident" id="8250132">BenchmarkDecodeGray</span><span class="op" id="8250151">(</span><span class="ident" id="8250152">b</span>&nbsp;<span class="op" id="8250154">*</span><span class="ident" id="8250155">testing</span><span class="op" id="8250162">.</span><span class="ident" id="8250163">B</span><span class="op" id="8250164">)</span>&nbsp;<span class="op" id="8250166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250169">benchmarkDecode</span><span class="op" id="8250184">(</span><span class="ident" id="8250185">b</span><span class="op" id="8250186">,</span>&nbsp;<span class="string" id="8250188">&#34;testdata/benchGray.png&#34;</span><span class="op" id="8250212">,</span>&nbsp;<span class="num" id="8250214">1</span><span class="op" id="8250215">)</span><br>
<span class="lineno"></span><span class="op" id="8250217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8250220">func</span>&nbsp;<span class="ident" id="8250225">BenchmarkDecodeNRGBAGradient</span><span class="op" id="8250253">(</span><span class="ident" id="8250254">b</span>&nbsp;<span class="op" id="8250256">*</span><span class="ident" id="8250257">testing</span><span class="op" id="8250264">.</span><span class="ident" id="8250265">B</span><span class="op" id="8250266">)</span>&nbsp;<span class="op" id="8250268">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250271">benchmarkDecode</span><span class="op" id="8250286">(</span><span class="ident" id="8250287">b</span><span class="op" id="8250288">,</span>&nbsp;<span class="string" id="8250290">&#34;testdata/benchNRGBA-gradient.png&#34;</span><span class="op" id="8250324">,</span>&nbsp;<span class="num" id="8250326">4</span><span class="op" id="8250327">)</span><br>
<span class="lineno"></span><span class="op" id="8250329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8250332">func</span>&nbsp;<span class="ident" id="8250337">BenchmarkDecodeNRGBAOpaque</span><span class="op" id="8250363">(</span><span class="ident" id="8250364">b</span>&nbsp;<span class="op" id="8250366">*</span><span class="ident" id="8250367">testing</span><span class="op" id="8250374">.</span><span class="ident" id="8250375">B</span><span class="op" id="8250376">)</span>&nbsp;<span class="op" id="8250378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250381">benchmarkDecode</span><span class="op" id="8250396">(</span><span class="ident" id="8250397">b</span><span class="op" id="8250398">,</span>&nbsp;<span class="string" id="8250400">&#34;testdata/benchNRGBA-opaque.png&#34;</span><span class="op" id="8250432">,</span>&nbsp;<span class="num" id="8250434">4</span><span class="op" id="8250435">)</span><br>
<span class="lineno">350</span><span class="op" id="8250437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8250440">func</span>&nbsp;<span class="ident" id="8250445">BenchmarkDecodePaletted</span><span class="op" id="8250468">(</span><span class="ident" id="8250469">b</span>&nbsp;<span class="op" id="8250471">*</span><span class="ident" id="8250472">testing</span><span class="op" id="8250479">.</span><span class="ident" id="8250480">B</span><span class="op" id="8250481">)</span>&nbsp;<span class="op" id="8250483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250486">benchmarkDecode</span><span class="op" id="8250501">(</span><span class="ident" id="8250502">b</span><span class="op" id="8250503">,</span>&nbsp;<span class="string" id="8250505">&#34;testdata/benchPaletted.png&#34;</span><span class="op" id="8250533">,</span>&nbsp;<span class="num" id="8250535">1</span><span class="op" id="8250536">)</span><br>
<span class="lineno"></span><span class="op" id="8250538">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="8250541">func</span>&nbsp;<span class="ident" id="8250546">BenchmarkDecodeRGB</span><span class="op" id="8250564">(</span><span class="ident" id="8250565">b</span>&nbsp;<span class="op" id="8250567">*</span><span class="ident" id="8250568">testing</span><span class="op" id="8250575">.</span><span class="ident" id="8250576">B</span><span class="op" id="8250577">)</span>&nbsp;<span class="op" id="8250579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250582">benchmarkDecode</span><span class="op" id="8250597">(</span><span class="ident" id="8250598">b</span><span class="op" id="8250599">,</span>&nbsp;<span class="string" id="8250601">&#34;testdata/benchRGB.png&#34;</span><span class="op" id="8250624">,</span>&nbsp;<span class="num" id="8250626">4</span><span class="op" id="8250627">)</span><br>
<span class="lineno"></span><span class="op" id="8250629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="8250632">func</span>&nbsp;<span class="ident" id="8250637">BenchmarkDecodeInterlacing</span><span class="op" id="8250663">(</span><span class="ident" id="8250664">b</span>&nbsp;<span class="op" id="8250666">*</span><span class="ident" id="8250667">testing</span><span class="op" id="8250674">.</span><span class="ident" id="8250675">B</span><span class="op" id="8250676">)</span>&nbsp;<span class="op" id="8250678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8250681">benchmarkDecode</span><span class="op" id="8250696">(</span><span class="ident" id="8250697">b</span><span class="op" id="8250698">,</span>&nbsp;<span class="string" id="8250700">&#34;testdata/benchRGB-interlace.png&#34;</span><span class="op" id="8250733">,</span>&nbsp;<span class="num" id="8250735">4</span><span class="op" id="8250736">)</span><br>
<span class="lineno"></span><span class="op" id="8250738">}</span>
</div>
</body>
</html>
