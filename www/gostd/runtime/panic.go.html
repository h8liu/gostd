<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html" class="current">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1616621">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1616676">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1616730">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1616781">package</span>&nbsp;<span class="ident" id="1616789">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1616798">import</span>&nbsp;<span class="string" id="1616805">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1616815">var</span>&nbsp;<span class="ident" id="1616819">indexError</span>&nbsp;<span class="op" id="1616830">=</span>&nbsp;<span class="builtintype" id="1616832">error</span><span class="op" id="1616837">(</span><span class="ident" id="1616838">errorString</span><span class="op" id="1616849">(</span><span class="string" id="1616850">&#34;index&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1616870">)</span><span class="op" id="1616871">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1616874">func</span>&nbsp;<span class="ident" id="1616879">panicindex</span><span class="op" id="1616889">(</span><span class="op" id="1616890">)</span>&nbsp;<span class="op" id="1616892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1616895">panic</span><span class="op" id="1616900">(</span><span class="ident" id="1616901">indexError</span><span class="op" id="1616911">)</span><br>
<span class="lineno"></span><span class="op" id="1616913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="1616916">var</span>&nbsp;<span class="ident" id="1616920">sliceError</span>&nbsp;<span class="op" id="1616931">=</span>&nbsp;<span class="builtintype" id="1616933">error</span><span class="op" id="1616938">(</span><span class="ident" id="1616939">errorString</span><span class="op" id="1616950">(</span><span class="string" id="1616951">&#34;slice&nbsp;bounds&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1616978">)</span><span class="op" id="1616979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1616982">func</span>&nbsp;<span class="ident" id="1616987">panicslice</span><span class="op" id="1616997">(</span><span class="op" id="1616998">)</span>&nbsp;<span class="op" id="1617000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1617003">panic</span><span class="op" id="1617008">(</span><span class="ident" id="1617009">sliceError</span><span class="op" id="1617019">)</span><br>
<span class="lineno"></span><span class="op" id="1617021">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1617024">var</span>&nbsp;<span class="ident" id="1617028">divideError</span>&nbsp;<span class="op" id="1617040">=</span>&nbsp;<span class="builtintype" id="1617042">error</span><span class="op" id="1617047">(</span><span class="ident" id="1617048">errorString</span><span class="op" id="1617059">(</span><span class="string" id="1617060">&#34;integer&nbsp;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="1617084">)</span><span class="op" id="1617085">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1617088">func</span>&nbsp;<span class="ident" id="1617093">panicdivide</span><span class="op" id="1617104">(</span><span class="op" id="1617105">)</span>&nbsp;<span class="op" id="1617107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1617110">panic</span><span class="op" id="1617115">(</span><span class="ident" id="1617116">divideError</span><span class="op" id="1617127">)</span><br>
<span class="lineno">25</span><span class="op" id="1617129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1617132">var</span>&nbsp;<span class="ident" id="1617136">overflowError</span>&nbsp;<span class="op" id="1617150">=</span>&nbsp;<span class="builtintype" id="1617152">error</span><span class="op" id="1617157">(</span><span class="ident" id="1617158">errorString</span><span class="op" id="1617169">(</span><span class="string" id="1617170">&#34;integer&nbsp;overflow&#34;</span><span class="op" id="1617188">)</span><span class="op" id="1617189">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1617192">func</span>&nbsp;<span class="ident" id="1617197">panicoverflow</span><span class="op" id="1617210">(</span><span class="op" id="1617211">)</span>&nbsp;<span class="op" id="1617213">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1617216">panic</span><span class="op" id="1617221">(</span><span class="ident" id="1617222">overflowError</span><span class="op" id="1617235">)</span><br>
<span class="lineno"></span><span class="op" id="1617237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1617240">var</span>&nbsp;<span class="ident" id="1617244">floatError</span>&nbsp;<span class="op" id="1617255">=</span>&nbsp;<span class="builtintype" id="1617257">error</span><span class="op" id="1617262">(</span><span class="ident" id="1617263">errorString</span><span class="op" id="1617274">(</span><span class="string" id="1617275">&#34;floating&nbsp;point&nbsp;error&#34;</span><span class="op" id="1617297">)</span><span class="op" id="1617298">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1617301">func</span>&nbsp;<span class="ident" id="1617306">panicfloat</span><span class="op" id="1617316">(</span><span class="op" id="1617317">)</span>&nbsp;<span class="op" id="1617319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1617322">panic</span><span class="op" id="1617327">(</span><span class="ident" id="1617328">floatError</span><span class="op" id="1617338">)</span><br>
<span class="lineno"></span><span class="op" id="1617340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1617343">var</span>&nbsp;<span class="ident" id="1617347">memoryError</span>&nbsp;<span class="op" id="1617359">=</span>&nbsp;<span class="builtintype" id="1617361">error</span><span class="op" id="1617366">(</span><span class="ident" id="1617367">errorString</span><span class="op" id="1617378">(</span><span class="string" id="1617379">&#34;invalid&nbsp;memory&nbsp;address&nbsp;or&nbsp;nil&nbsp;pointer&nbsp;dereference&#34;</span><span class="op" id="1617430">)</span><span class="op" id="1617431">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1617434">func</span>&nbsp;<span class="ident" id="1617439">panicmem</span><span class="op" id="1617447">(</span><span class="op" id="1617448">)</span>&nbsp;<span class="op" id="1617450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1617453">panic</span><span class="op" id="1617458">(</span><span class="ident" id="1617459">memoryError</span><span class="op" id="1617470">)</span><br>
<span class="lineno"></span><span class="op" id="1617472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1617475">func</span>&nbsp;<span class="ident" id="1617480">throwreturn</span><span class="op" id="1617491">(</span><span class="op" id="1617492">)</span>&nbsp;<span class="op" id="1617494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1617497">gothrow</span><span class="op" id="1617504">(</span><span class="string" id="1617505">&#34;no&nbsp;return&nbsp;at&nbsp;end&nbsp;of&nbsp;a&nbsp;typed&nbsp;function&nbsp;-&nbsp;compiler&nbsp;is&nbsp;broken&#34;</span><span class="op" id="1617564">)</span><br>
<span class="lineno"></span><span class="op" id="1617566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1617569">func</span>&nbsp;<span class="ident" id="1617574">throwinit</span><span class="op" id="1617583">(</span><span class="op" id="1617584">)</span>&nbsp;<span class="op" id="1617586">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1617589">gothrow</span><span class="op" id="1617596">(</span><span class="string" id="1617597">&#34;recursive&nbsp;call&nbsp;during&nbsp;initialization&nbsp;-&nbsp;linker&nbsp;skew&#34;</span><span class="op" id="1617649">)</span><br>
<span class="lineno"></span><span class="op" id="1617651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1617654">//&nbsp;Create&nbsp;a&nbsp;new&nbsp;deferred&nbsp;function&nbsp;fn&nbsp;with&nbsp;siz&nbsp;bytes&nbsp;of&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="1617720">//&nbsp;The&nbsp;compiler&nbsp;turns&nbsp;a&nbsp;defer&nbsp;statement&nbsp;into&nbsp;a&nbsp;call&nbsp;to&nbsp;this.</span><br>
<span class="lineno">55</span><span class="comment" id="1617781">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1617794">func</span>&nbsp;<span class="ident" id="1617799">deferproc</span><span class="op" id="1617808">(</span><span class="ident" id="1617809">siz</span>&nbsp;<span class="builtintype" id="1617813">int32</span><span class="op" id="1617818">,</span>&nbsp;<span class="ident" id="1617820">fn</span>&nbsp;<span class="op" id="1617823">*</span><span class="ident" id="1617824">funcval</span><span class="op" id="1617831">)</span>&nbsp;<span class="op" id="1617833">{</span>&nbsp;<span class="comment" id="1617835">//&nbsp;arguments&nbsp;of&nbsp;fn&nbsp;follow&nbsp;fn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1617865">//&nbsp;the&nbsp;arguments&nbsp;of&nbsp;fn&nbsp;are&nbsp;in&nbsp;a&nbsp;perilous&nbsp;state.&nbsp;&nbsp;The&nbsp;stack&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1617929">//&nbsp;for&nbsp;deferproc&nbsp;does&nbsp;not&nbsp;describe&nbsp;them.&nbsp;&nbsp;So&nbsp;we&nbsp;can&#39;t&nbsp;let&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1617996">//&nbsp;collection&nbsp;or&nbsp;stack&nbsp;copying&nbsp;trigger&nbsp;until&nbsp;we&#39;ve&nbsp;copied&nbsp;them&nbsp;out</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1618064">//&nbsp;to&nbsp;somewhere&nbsp;safe.&nbsp;&nbsp;deferproc_m&nbsp;does&nbsp;that.&nbsp;&nbsp;Until&nbsp;deferproc_m,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1618131">//&nbsp;we&nbsp;can&nbsp;only&nbsp;call&nbsp;nosplit&nbsp;routines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618170">argp</span>&nbsp;<span class="op" id="1618175">:=</span>&nbsp;<span class="builtintype" id="1618178">uintptr</span><span class="op" id="1618185">(</span><span class="ident" id="1618186">unsafe</span><span class="op" id="1618192">.</span><span class="ident" id="1618193">Pointer</span><span class="op" id="1618200">(</span><span class="op" id="1618201">&amp;</span><span class="ident" id="1618202">fn</span><span class="op" id="1618204">)</span><span class="op" id="1618205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618208">argp</span>&nbsp;<span class="op" id="1618213">+=</span>&nbsp;<span class="ident" id="1618216">unsafe</span><span class="op" id="1618222">.</span><span class="ident" id="1618223">Sizeof</span><span class="op" id="1618229">(</span><span class="ident" id="1618230">fn</span><span class="op" id="1618232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1618235">if</span>&nbsp;<span class="ident" id="1618238">GOARCH</span>&nbsp;<span class="op" id="1618245">==</span>&nbsp;<span class="string" id="1618248">&#34;arm&#34;</span>&nbsp;<span class="op" id="1618254">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618258">argp</span>&nbsp;<span class="op" id="1618263">+=</span>&nbsp;<span class="ident" id="1618266">ptrSize</span>&nbsp;<span class="comment" id="1618274">//&nbsp;skip&nbsp;caller&#39;s&nbsp;saved&nbsp;link&nbsp;register</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1618312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618315">mp</span>&nbsp;<span class="op" id="1618318">:=</span>&nbsp;<span class="ident" id="1618321">acquirem</span><span class="op" id="1618329">(</span><span class="op" id="1618330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618333">mp</span><span class="op" id="1618335">.</span><span class="ident" id="1618336">scalararg</span><span class="op" id="1618345">[</span><span class="num" id="1618346">0</span><span class="op" id="1618347">]</span>&nbsp;<span class="op" id="1618349">=</span>&nbsp;<span class="builtintype" id="1618351">uintptr</span><span class="op" id="1618358">(</span><span class="ident" id="1618359">siz</span><span class="op" id="1618362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618365">mp</span><span class="op" id="1618367">.</span><span class="ident" id="1618368">ptrarg</span><span class="op" id="1618374">[</span><span class="num" id="1618375">0</span><span class="op" id="1618376">]</span>&nbsp;<span class="op" id="1618378">=</span>&nbsp;<span class="ident" id="1618380">unsafe</span><span class="op" id="1618386">.</span><span class="ident" id="1618387">Pointer</span><span class="op" id="1618394">(</span><span class="ident" id="1618395">fn</span><span class="op" id="1618397">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618400">mp</span><span class="op" id="1618402">.</span><span class="ident" id="1618403">scalararg</span><span class="op" id="1618412">[</span><span class="num" id="1618413">1</span><span class="op" id="1618414">]</span>&nbsp;<span class="op" id="1618416">=</span>&nbsp;<span class="ident" id="1618418">argp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618424">mp</span><span class="op" id="1618426">.</span><span class="ident" id="1618427">scalararg</span><span class="op" id="1618436">[</span><span class="num" id="1618437">2</span><span class="op" id="1618438">]</span>&nbsp;<span class="op" id="1618440">=</span>&nbsp;<span class="ident" id="1618442">getcallerpc</span><span class="op" id="1618453">(</span><span class="ident" id="1618454">unsafe</span><span class="op" id="1618460">.</span><span class="ident" id="1618461">Pointer</span><span class="op" id="1618468">(</span><span class="op" id="1618469">&amp;</span><span class="ident" id="1618470">siz</span><span class="op" id="1618473">)</span><span class="op" id="1618474">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1618478">if</span>&nbsp;<span class="ident" id="1618481">mp</span><span class="op" id="1618483">.</span><span class="ident" id="1618484">curg</span>&nbsp;<span class="op" id="1618489">!=</span>&nbsp;<span class="ident" id="1618492">getg</span><span class="op" id="1618496">(</span><span class="op" id="1618497">)</span>&nbsp;<span class="op" id="1618499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1618503">//&nbsp;go&nbsp;code&nbsp;on&nbsp;the&nbsp;m&nbsp;stack&nbsp;can&#39;t&nbsp;defer</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618543">gothrow</span><span class="op" id="1618550">(</span><span class="string" id="1618551">&#34;defer&nbsp;on&nbsp;m&#34;</span><span class="op" id="1618563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1618566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618570">onM</span><span class="op" id="1618573">(</span><span class="ident" id="1618574">deferproc_m</span><span class="op" id="1618585">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618589">releasem</span><span class="op" id="1618597">(</span><span class="ident" id="1618598">mp</span><span class="op" id="1618600">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1618604">//&nbsp;deferproc&nbsp;returns&nbsp;0&nbsp;normally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1618638">//&nbsp;a&nbsp;deferred&nbsp;func&nbsp;that&nbsp;stops&nbsp;a&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1618677">//&nbsp;makes&nbsp;the&nbsp;deferproc&nbsp;return&nbsp;1.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1618711">//&nbsp;the&nbsp;code&nbsp;the&nbsp;compiler&nbsp;generates&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1618754">//&nbsp;checks&nbsp;the&nbsp;return&nbsp;value&nbsp;and&nbsp;jumps&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1618799">//&nbsp;end&nbsp;of&nbsp;the&nbsp;function&nbsp;if&nbsp;deferproc&nbsp;returns&nbsp;!=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618850">return0</span><span class="op" id="1618857">(</span><span class="op" id="1618858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1618861">//&nbsp;No&nbsp;code&nbsp;can&nbsp;go&nbsp;here&nbsp;-&nbsp;the&nbsp;C&nbsp;return&nbsp;register&nbsp;has</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1618913">//&nbsp;been&nbsp;set&nbsp;and&nbsp;must&nbsp;not&nbsp;be&nbsp;clobbered.</span><br>
<span class="lineno"></span><span class="op" id="1618952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1618955">//&nbsp;Small&nbsp;malloc&nbsp;size&nbsp;classes&nbsp;&gt;=&nbsp;16&nbsp;are&nbsp;the&nbsp;multiples&nbsp;of&nbsp;16:&nbsp;16,&nbsp;32,&nbsp;48,&nbsp;64,&nbsp;80,&nbsp;96,&nbsp;112,&nbsp;128,&nbsp;144,&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="1619058">//&nbsp;Each&nbsp;P&nbsp;holds&nbsp;a&nbsp;pool&nbsp;for&nbsp;defers&nbsp;with&nbsp;small&nbsp;arg&nbsp;sizes.</span><br>
<span class="lineno">95</span><span class="comment" id="1619114">//&nbsp;Assign&nbsp;defer&nbsp;allocations&nbsp;to&nbsp;pools&nbsp;by&nbsp;rounding&nbsp;to&nbsp;16,&nbsp;to&nbsp;match&nbsp;malloc&nbsp;size&nbsp;classes.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1619201">const</span>&nbsp;<span class="op" id="1619207">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619210">deferHeaderSize</span>&nbsp;<span class="op" id="1619226">=</span>&nbsp;<span class="ident" id="1619228">unsafe</span><span class="op" id="1619234">.</span><span class="ident" id="1619235">Sizeof</span><span class="op" id="1619241">(</span><span class="ident" id="1619242">_defer</span><span class="op" id="1619248">{</span><span class="op" id="1619249">}</span><span class="op" id="1619250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619253">minDeferAlloc</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1619269">=</span>&nbsp;<span class="op" id="1619271">(</span><span class="ident" id="1619272">deferHeaderSize</span>&nbsp;<span class="op" id="1619288">+</span>&nbsp;<span class="num" id="1619290">15</span><span class="op" id="1619292">)</span>&nbsp;<span class="op" id="1619294">&amp;^</span>&nbsp;<span class="num" id="1619297">15</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619301">minDeferArgs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1619317">=</span>&nbsp;<span class="ident" id="1619319">minDeferAlloc</span>&nbsp;<span class="op" id="1619333">-</span>&nbsp;<span class="ident" id="1619335">deferHeaderSize</span><br>
<span class="lineno"></span><span class="op" id="1619351">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1619354">//&nbsp;defer&nbsp;size&nbsp;class&nbsp;for&nbsp;arg&nbsp;size&nbsp;sz</span><br>
<span class="lineno"></span><span class="comment" id="1619390">//go:nosplit</span><br>
<span class="lineno">105</span><span class="keyword" id="1619403">func</span>&nbsp;<span class="ident" id="1619408">deferclass</span><span class="op" id="1619418">(</span><span class="ident" id="1619419">siz</span>&nbsp;<span class="builtintype" id="1619423">uintptr</span><span class="op" id="1619430">)</span>&nbsp;<span class="builtintype" id="1619432">uintptr</span>&nbsp;<span class="op" id="1619440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619443">if</span>&nbsp;<span class="ident" id="1619446">siz</span>&nbsp;<span class="op" id="1619450">&lt;=</span>&nbsp;<span class="ident" id="1619453">minDeferArgs</span>&nbsp;<span class="op" id="1619466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619470">return</span>&nbsp;<span class="num" id="1619477">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1619480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619483">return</span>&nbsp;<span class="op" id="1619490">(</span><span class="ident" id="1619491">siz</span>&nbsp;<span class="op" id="1619495">-</span>&nbsp;<span class="ident" id="1619497">minDeferArgs</span>&nbsp;<span class="op" id="1619510">+</span>&nbsp;<span class="num" id="1619512">15</span><span class="op" id="1619514">)</span>&nbsp;<span class="op" id="1619516">/</span>&nbsp;<span class="num" id="1619518">16</span><br>
<span class="lineno">110</span><span class="op" id="1619521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1619524">//&nbsp;total&nbsp;size&nbsp;of&nbsp;memory&nbsp;block&nbsp;for&nbsp;defer&nbsp;with&nbsp;arg&nbsp;size&nbsp;sz</span><br>
<span class="lineno"></span><span class="keyword" id="1619581">func</span>&nbsp;<span class="ident" id="1619586">totaldefersize</span><span class="op" id="1619600">(</span><span class="ident" id="1619601">siz</span>&nbsp;<span class="builtintype" id="1619605">uintptr</span><span class="op" id="1619612">)</span>&nbsp;<span class="builtintype" id="1619614">uintptr</span>&nbsp;<span class="op" id="1619622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619625">if</span>&nbsp;<span class="ident" id="1619628">siz</span>&nbsp;<span class="op" id="1619632">&lt;=</span>&nbsp;<span class="ident" id="1619635">minDeferArgs</span>&nbsp;<span class="op" id="1619648">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619652">return</span>&nbsp;<span class="ident" id="1619659">minDeferAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1619674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619677">return</span>&nbsp;<span class="ident" id="1619684">deferHeaderSize</span>&nbsp;<span class="op" id="1619700">+</span>&nbsp;<span class="ident" id="1619702">siz</span><br>
<span class="lineno"></span><span class="op" id="1619706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="1619709">//&nbsp;Ensure&nbsp;that&nbsp;defer&nbsp;arg&nbsp;sizes&nbsp;that&nbsp;map&nbsp;to&nbsp;the&nbsp;same&nbsp;defer&nbsp;size&nbsp;class</span><br>
<span class="lineno"></span><span class="comment" id="1619778">//&nbsp;also&nbsp;map&nbsp;to&nbsp;the&nbsp;same&nbsp;malloc&nbsp;size&nbsp;class.</span><br>
<span class="lineno"></span><span class="keyword" id="1619821">func</span>&nbsp;<span class="ident" id="1619826">testdefersizes</span><span class="op" id="1619840">(</span><span class="op" id="1619841">)</span>&nbsp;<span class="op" id="1619843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619846">var</span>&nbsp;<span class="ident" id="1619850">m</span>&nbsp;<span class="op" id="1619852">[</span><span class="builtinfunc" id="1619853">len</span><span class="op" id="1619856">(</span><span class="ident" id="1619857">p</span><span class="op" id="1619858">{</span><span class="op" id="1619859">}</span><span class="op" id="1619860">.</span><span class="ident" id="1619861">deferpool</span><span class="op" id="1619870">)</span><span class="op" id="1619871">]</span><span class="builtintype" id="1619872">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619880">for</span>&nbsp;<span class="ident" id="1619884">i</span>&nbsp;<span class="op" id="1619886">:=</span>&nbsp;<span class="keyword" id="1619889">range</span>&nbsp;<span class="ident" id="1619895">m</span>&nbsp;<span class="op" id="1619897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619901">m</span><span class="op" id="1619902">[</span><span class="ident" id="1619903">i</span><span class="op" id="1619904">]</span>&nbsp;<span class="op" id="1619906">=</span>&nbsp;<span class="op" id="1619908">-</span><span class="num" id="1619909">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1619912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619915">for</span>&nbsp;<span class="ident" id="1619919">i</span>&nbsp;<span class="op" id="1619921">:=</span>&nbsp;<span class="builtintype" id="1619924">uintptr</span><span class="op" id="1619931">(</span><span class="num" id="1619932">0</span><span class="op" id="1619933">)</span><span class="op" id="1619934">;</span>&nbsp;<span class="op" id="1619936">;</span>&nbsp;<span class="ident" id="1619938">i</span><span class="op" id="1619939">++</span>&nbsp;<span class="op" id="1619942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619946">defersc</span>&nbsp;<span class="op" id="1619954">:=</span>&nbsp;<span class="ident" id="1619957">deferclass</span><span class="op" id="1619967">(</span><span class="ident" id="1619968">i</span><span class="op" id="1619969">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619973">if</span>&nbsp;<span class="ident" id="1619976">defersc</span>&nbsp;<span class="op" id="1619984">&gt;=</span>&nbsp;<span class="builtintype" id="1619987">uintptr</span><span class="op" id="1619994">(</span><span class="builtinfunc" id="1619995">len</span><span class="op" id="1619998">(</span><span class="ident" id="1619999">m</span><span class="op" id="1620000">)</span><span class="op" id="1620001">)</span>&nbsp;<span class="op" id="1620003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1620008">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1620016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620020">siz</span>&nbsp;<span class="op" id="1620024">:=</span>&nbsp;<span class="ident" id="1620027">goroundupsize</span><span class="op" id="1620040">(</span><span class="ident" id="1620041">totaldefersize</span><span class="op" id="1620055">(</span><span class="ident" id="1620056">i</span><span class="op" id="1620057">)</span><span class="op" id="1620058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1620062">if</span>&nbsp;<span class="ident" id="1620065">m</span><span class="op" id="1620066">[</span><span class="ident" id="1620067">defersc</span><span class="op" id="1620074">]</span>&nbsp;<span class="op" id="1620076">&lt;</span>&nbsp;<span class="num" id="1620078">0</span>&nbsp;<span class="op" id="1620080">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620085">m</span><span class="op" id="1620086">[</span><span class="ident" id="1620087">defersc</span><span class="op" id="1620094">]</span>&nbsp;<span class="op" id="1620096">=</span>&nbsp;<span class="builtintype" id="1620098">int32</span><span class="op" id="1620103">(</span><span class="ident" id="1620104">siz</span><span class="op" id="1620107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1620112">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1620123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1620127">if</span>&nbsp;<span class="ident" id="1620130">m</span><span class="op" id="1620131">[</span><span class="ident" id="1620132">defersc</span><span class="op" id="1620139">]</span>&nbsp;<span class="op" id="1620141">!=</span>&nbsp;<span class="builtintype" id="1620144">int32</span><span class="op" id="1620149">(</span><span class="ident" id="1620150">siz</span><span class="op" id="1620153">)</span>&nbsp;<span class="op" id="1620155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1620160">print</span><span class="op" id="1620165">(</span><span class="string" id="1620166">&#34;bad&nbsp;defer&nbsp;size&nbsp;class:&nbsp;i=&#34;</span><span class="op" id="1620192">,</span>&nbsp;<span class="ident" id="1620194">i</span><span class="op" id="1620195">,</span>&nbsp;<span class="string" id="1620197">&#34;&nbsp;siz=&#34;</span><span class="op" id="1620204">,</span>&nbsp;<span class="ident" id="1620206">siz</span><span class="op" id="1620209">,</span>&nbsp;<span class="string" id="1620211">&#34;&nbsp;defersc=&#34;</span><span class="op" id="1620222">,</span>&nbsp;<span class="ident" id="1620224">defersc</span><span class="op" id="1620231">,</span>&nbsp;<span class="string" id="1620233">&#34;\n&#34;</span><span class="op" id="1620237">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620242">gothrow</span><span class="op" id="1620249">(</span><span class="string" id="1620250">&#34;bad&nbsp;defer&nbsp;size&nbsp;class&#34;</span><span class="op" id="1620272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1620276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1620279">}</span><br>
<span class="lineno"></span><span class="op" id="1620281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="1620284">//&nbsp;The&nbsp;arguments&nbsp;associated&nbsp;with&nbsp;a&nbsp;deferred&nbsp;call&nbsp;are&nbsp;stored</span><br>
<span class="lineno"></span><span class="comment" id="1620344">//&nbsp;immediately&nbsp;after&nbsp;the&nbsp;_defer&nbsp;header&nbsp;in&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1620394">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1620407">func</span>&nbsp;<span class="ident" id="1620412">deferArgs</span><span class="op" id="1620421">(</span><span class="ident" id="1620422">d</span>&nbsp;<span class="op" id="1620424">*</span><span class="ident" id="1620425">_defer</span><span class="op" id="1620431">)</span>&nbsp;<span class="ident" id="1620433">unsafe</span><span class="op" id="1620439">.</span><span class="ident" id="1620440">Pointer</span>&nbsp;<span class="op" id="1620448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1620451">return</span>&nbsp;<span class="ident" id="1620458">add</span><span class="op" id="1620461">(</span><span class="ident" id="1620462">unsafe</span><span class="op" id="1620468">.</span><span class="ident" id="1620469">Pointer</span><span class="op" id="1620476">(</span><span class="ident" id="1620477">d</span><span class="op" id="1620478">)</span><span class="op" id="1620479">,</span>&nbsp;<span class="ident" id="1620481">unsafe</span><span class="op" id="1620487">.</span><span class="ident" id="1620488">Sizeof</span><span class="op" id="1620494">(</span><span class="op" id="1620495">*</span><span class="ident" id="1620496">d</span><span class="op" id="1620497">)</span><span class="op" id="1620498">)</span><br>
<span class="lineno">150</span><span class="op" id="1620500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1620503">var</span>&nbsp;<span class="ident" id="1620507">deferType</span>&nbsp;<span class="op" id="1620517">*</span><span class="ident" id="1620518">_type</span>&nbsp;<span class="comment" id="1620524">//&nbsp;type&nbsp;of&nbsp;_defer&nbsp;struct</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1620550">func</span>&nbsp;<span class="ident" id="1620555">init</span><span class="op" id="1620559">(</span><span class="op" id="1620560">)</span>&nbsp;<span class="op" id="1620562">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1620565">var</span>&nbsp;<span class="ident" id="1620569">x</span>&nbsp;<span class="keyword" id="1620571">interface</span><span class="op" id="1620580">{</span><span class="op" id="1620581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620584">x</span>&nbsp;<span class="op" id="1620586">=</span>&nbsp;<span class="op" id="1620588">(</span><span class="op" id="1620589">*</span><span class="ident" id="1620590">_defer</span><span class="op" id="1620596">)</span><span class="op" id="1620597">(</span><span class="builtintype" id="1620598">nil</span><span class="op" id="1620601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620604">deferType</span>&nbsp;<span class="op" id="1620614">=</span>&nbsp;<span class="op" id="1620616">(</span><span class="op" id="1620617">*</span><span class="op" id="1620618">(</span><span class="op" id="1620619">*</span><span class="op" id="1620620">*</span><span class="ident" id="1620621">ptrtype</span><span class="op" id="1620628">)</span><span class="op" id="1620629">(</span><span class="ident" id="1620630">unsafe</span><span class="op" id="1620636">.</span><span class="ident" id="1620637">Pointer</span><span class="op" id="1620644">(</span><span class="op" id="1620645">&amp;</span><span class="ident" id="1620646">x</span><span class="op" id="1620647">)</span><span class="op" id="1620648">)</span><span class="op" id="1620649">)</span><span class="op" id="1620650">.</span><span class="ident" id="1620651">elem</span><br>
<span class="lineno"></span><span class="op" id="1620656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="1620659">//&nbsp;Allocate&nbsp;a&nbsp;Defer,&nbsp;usually&nbsp;using&nbsp;per-P&nbsp;pool.</span><br>
<span class="lineno"></span><span class="comment" id="1620706">//&nbsp;Each&nbsp;defer&nbsp;must&nbsp;be&nbsp;released&nbsp;with&nbsp;freedefer.</span><br>
<span class="lineno"></span><span class="comment" id="1620753">//&nbsp;Note:&nbsp;runs&nbsp;on&nbsp;M&nbsp;stack</span><br>
<span class="lineno"></span><span class="keyword" id="1620778">func</span>&nbsp;<span class="ident" id="1620783">newdefer</span><span class="op" id="1620791">(</span><span class="ident" id="1620792">siz</span>&nbsp;<span class="builtintype" id="1620796">int32</span><span class="op" id="1620801">)</span>&nbsp;<span class="op" id="1620803">*</span><span class="ident" id="1620804">_defer</span>&nbsp;<span class="op" id="1620811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1620814">var</span>&nbsp;<span class="ident" id="1620818">d</span>&nbsp;<span class="op" id="1620820">*</span><span class="ident" id="1620821">_defer</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620829">sc</span>&nbsp;<span class="op" id="1620832">:=</span>&nbsp;<span class="ident" id="1620835">deferclass</span><span class="op" id="1620845">(</span><span class="builtintype" id="1620846">uintptr</span><span class="op" id="1620853">(</span><span class="ident" id="1620854">siz</span><span class="op" id="1620857">)</span><span class="op" id="1620858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620861">mp</span>&nbsp;<span class="op" id="1620864">:=</span>&nbsp;<span class="ident" id="1620867">acquirem</span><span class="op" id="1620875">(</span><span class="op" id="1620876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1620879">if</span>&nbsp;<span class="ident" id="1620882">sc</span>&nbsp;<span class="op" id="1620885">&lt;</span>&nbsp;<span class="builtintype" id="1620887">uintptr</span><span class="op" id="1620894">(</span><span class="builtinfunc" id="1620895">len</span><span class="op" id="1620898">(</span><span class="ident" id="1620899">p</span><span class="op" id="1620900">{</span><span class="op" id="1620901">}</span><span class="op" id="1620902">.</span><span class="ident" id="1620903">deferpool</span><span class="op" id="1620912">)</span><span class="op" id="1620913">)</span>&nbsp;<span class="op" id="1620915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620919">pp</span>&nbsp;<span class="op" id="1620922">:=</span>&nbsp;<span class="ident" id="1620925">mp</span><span class="op" id="1620927">.</span><span class="ident" id="1620928">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620932">d</span>&nbsp;<span class="op" id="1620934">=</span>&nbsp;<span class="ident" id="1620936">pp</span><span class="op" id="1620938">.</span><span class="ident" id="1620939">deferpool</span><span class="op" id="1620948">[</span><span class="ident" id="1620949">sc</span><span class="op" id="1620951">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1620955">if</span>&nbsp;<span class="ident" id="1620958">d</span>&nbsp;<span class="op" id="1620960">!=</span>&nbsp;<span class="builtintype" id="1620963">nil</span>&nbsp;<span class="op" id="1620967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620972">pp</span><span class="op" id="1620974">.</span><span class="ident" id="1620975">deferpool</span><span class="op" id="1620984">[</span><span class="ident" id="1620985">sc</span><span class="op" id="1620987">]</span>&nbsp;<span class="op" id="1620989">=</span>&nbsp;<span class="ident" id="1620991">d</span><span class="op" id="1620992">.</span><span class="ident" id="1620993">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1621000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1621003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1621006">if</span>&nbsp;<span class="ident" id="1621009">d</span>&nbsp;<span class="op" id="1621011">==</span>&nbsp;<span class="builtintype" id="1621014">nil</span>&nbsp;<span class="op" id="1621018">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621022">//&nbsp;Allocate&nbsp;new&nbsp;defer+args.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621052">total</span>&nbsp;<span class="op" id="1621058">:=</span>&nbsp;<span class="ident" id="1621061">goroundupsize</span><span class="op" id="1621074">(</span><span class="ident" id="1621075">totaldefersize</span><span class="op" id="1621089">(</span><span class="builtintype" id="1621090">uintptr</span><span class="op" id="1621097">(</span><span class="ident" id="1621098">siz</span><span class="op" id="1621101">)</span><span class="op" id="1621102">)</span><span class="op" id="1621103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621107">d</span>&nbsp;<span class="op" id="1621109">=</span>&nbsp;<span class="op" id="1621111">(</span><span class="op" id="1621112">*</span><span class="ident" id="1621113">_defer</span><span class="op" id="1621119">)</span><span class="op" id="1621120">(</span><span class="ident" id="1621121">mallocgc</span><span class="op" id="1621129">(</span><span class="ident" id="1621130">total</span><span class="op" id="1621135">,</span>&nbsp;<span class="ident" id="1621137">deferType</span><span class="op" id="1621146">,</span>&nbsp;<span class="num" id="1621148">0</span><span class="op" id="1621149">)</span><span class="op" id="1621150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1621153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621156">d</span><span class="op" id="1621157">.</span><span class="ident" id="1621158">siz</span>&nbsp;<span class="op" id="1621162">=</span>&nbsp;<span class="ident" id="1621164">siz</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621169">gp</span>&nbsp;<span class="op" id="1621172">:=</span>&nbsp;<span class="ident" id="1621175">mp</span><span class="op" id="1621177">.</span><span class="ident" id="1621178">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621184">d</span><span class="op" id="1621185">.</span><span class="ident" id="1621186">link</span>&nbsp;<span class="op" id="1621191">=</span>&nbsp;<span class="ident" id="1621193">gp</span><span class="op" id="1621195">.</span><span class="ident" id="1621196">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621204">gp</span><span class="op" id="1621206">.</span><span class="ident" id="1621207">_defer</span>&nbsp;<span class="op" id="1621214">=</span>&nbsp;<span class="ident" id="1621216">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621219">releasem</span><span class="op" id="1621227">(</span><span class="ident" id="1621228">mp</span><span class="op" id="1621230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1621233">return</span>&nbsp;<span class="ident" id="1621240">d</span><br>
<span class="lineno">185</span><span class="op" id="1621242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1621245">//&nbsp;Free&nbsp;the&nbsp;given&nbsp;defer.</span><br>
<span class="lineno"></span><span class="comment" id="1621270">//&nbsp;The&nbsp;defer&nbsp;cannot&nbsp;be&nbsp;used&nbsp;after&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="1621315">//go:nosplit</span><br>
<span class="lineno">190</span><span class="keyword" id="1621328">func</span>&nbsp;<span class="ident" id="1621333">freedefer</span><span class="op" id="1621342">(</span><span class="ident" id="1621343">d</span>&nbsp;<span class="op" id="1621345">*</span><span class="ident" id="1621346">_defer</span><span class="op" id="1621352">)</span>&nbsp;<span class="op" id="1621354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1621357">if</span>&nbsp;<span class="ident" id="1621360">d</span><span class="op" id="1621361">.</span><span class="ident" id="1621362">_panic</span>&nbsp;<span class="op" id="1621369">!=</span>&nbsp;<span class="builtintype" id="1621372">nil</span>&nbsp;<span class="op" id="1621376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621380">freedeferpanic</span><span class="op" id="1621394">(</span><span class="op" id="1621395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1621398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1621401">if</span>&nbsp;<span class="ident" id="1621404">d</span><span class="op" id="1621405">.</span><span class="ident" id="1621406">fn</span>&nbsp;<span class="op" id="1621409">!=</span>&nbsp;<span class="builtintype" id="1621412">nil</span>&nbsp;<span class="op" id="1621416">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621420">freedeferfn</span><span class="op" id="1621431">(</span><span class="op" id="1621432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1621435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621438">sc</span>&nbsp;<span class="op" id="1621441">:=</span>&nbsp;<span class="ident" id="1621444">deferclass</span><span class="op" id="1621454">(</span><span class="builtintype" id="1621455">uintptr</span><span class="op" id="1621462">(</span><span class="ident" id="1621463">d</span><span class="op" id="1621464">.</span><span class="ident" id="1621465">siz</span><span class="op" id="1621468">)</span><span class="op" id="1621469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1621472">if</span>&nbsp;<span class="ident" id="1621475">sc</span>&nbsp;<span class="op" id="1621478">&lt;</span>&nbsp;<span class="builtintype" id="1621480">uintptr</span><span class="op" id="1621487">(</span><span class="builtinfunc" id="1621488">len</span><span class="op" id="1621491">(</span><span class="ident" id="1621492">p</span><span class="op" id="1621493">{</span><span class="op" id="1621494">}</span><span class="op" id="1621495">.</span><span class="ident" id="1621496">deferpool</span><span class="op" id="1621505">)</span><span class="op" id="1621506">)</span>&nbsp;<span class="op" id="1621508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621512">mp</span>&nbsp;<span class="op" id="1621515">:=</span>&nbsp;<span class="ident" id="1621518">acquirem</span><span class="op" id="1621526">(</span><span class="op" id="1621527">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621531">pp</span>&nbsp;<span class="op" id="1621534">:=</span>&nbsp;<span class="ident" id="1621537">mp</span><span class="op" id="1621539">.</span><span class="ident" id="1621540">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1621544">*</span><span class="ident" id="1621545">d</span>&nbsp;<span class="op" id="1621547">=</span>&nbsp;<span class="ident" id="1621549">_defer</span><span class="op" id="1621555">{</span><span class="op" id="1621556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621560">d</span><span class="op" id="1621561">.</span><span class="ident" id="1621562">link</span>&nbsp;<span class="op" id="1621567">=</span>&nbsp;<span class="ident" id="1621569">pp</span><span class="op" id="1621571">.</span><span class="ident" id="1621572">deferpool</span><span class="op" id="1621581">[</span><span class="ident" id="1621582">sc</span><span class="op" id="1621584">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621588">pp</span><span class="op" id="1621590">.</span><span class="ident" id="1621591">deferpool</span><span class="op" id="1621600">[</span><span class="ident" id="1621601">sc</span><span class="op" id="1621603">]</span>&nbsp;<span class="op" id="1621605">=</span>&nbsp;<span class="ident" id="1621607">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621611">releasem</span><span class="op" id="1621619">(</span><span class="ident" id="1621620">mp</span><span class="op" id="1621622">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1621625">}</span><br>
<span class="lineno"></span><span class="op" id="1621627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1621630">//&nbsp;Separate&nbsp;function&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;split&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1621679">//&nbsp;Windows&nbsp;otherwise&nbsp;runs&nbsp;out&nbsp;of&nbsp;stack&nbsp;space.</span><br>
<span class="lineno">210</span><span class="keyword" id="1621725">func</span>&nbsp;<span class="ident" id="1621730">freedeferpanic</span><span class="op" id="1621744">(</span><span class="op" id="1621745">)</span>&nbsp;<span class="op" id="1621747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621750">//&nbsp;_panic&nbsp;must&nbsp;be&nbsp;cleared&nbsp;before&nbsp;d&nbsp;is&nbsp;unlinked&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621807">gothrow</span><span class="op" id="1621814">(</span><span class="string" id="1621815">&#34;freedefer&nbsp;with&nbsp;d._panic&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="1621847">)</span><br>
<span class="lineno"></span><span class="op" id="1621849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1621852">func</span>&nbsp;<span class="ident" id="1621857">freedeferfn</span><span class="op" id="1621868">(</span><span class="op" id="1621869">)</span>&nbsp;<span class="op" id="1621871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621874">//&nbsp;fn&nbsp;must&nbsp;be&nbsp;cleared&nbsp;before&nbsp;d&nbsp;is&nbsp;unlinked&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621927">gothrow</span><span class="op" id="1621934">(</span><span class="string" id="1621935">&#34;freedefer&nbsp;with&nbsp;d.fn&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="1621963">)</span><br>
<span class="lineno"></span><span class="op" id="1621965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="1621968">//&nbsp;Run&nbsp;a&nbsp;deferred&nbsp;function&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span><span class="comment" id="1622012">//&nbsp;The&nbsp;compiler&nbsp;inserts&nbsp;a&nbsp;call&nbsp;to&nbsp;this&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="1622069">//&nbsp;function&nbsp;which&nbsp;calls&nbsp;defer.</span><br>
<span class="lineno"></span><span class="comment" id="1622100">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;deferred&nbsp;function,&nbsp;this&nbsp;will&nbsp;call&nbsp;runtimejmpdefer,</span><br>
<span class="lineno"></span><span class="comment" id="1622170">//&nbsp;which&nbsp;will&nbsp;jump&nbsp;to&nbsp;the&nbsp;deferred&nbsp;function&nbsp;such&nbsp;that&nbsp;it&nbsp;appears</span><br>
<span class="lineno">225</span><span class="comment" id="1622235">//&nbsp;to&nbsp;have&nbsp;been&nbsp;called&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;deferreturn&nbsp;at&nbsp;the&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="1622300">//&nbsp;just&nbsp;before&nbsp;deferreturn&nbsp;was&nbsp;called.&nbsp;&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;deferreturn</span><br>
<span class="lineno"></span><span class="comment" id="1622371">//&nbsp;is&nbsp;called&nbsp;again&nbsp;and&nbsp;again&nbsp;until&nbsp;there&nbsp;are&nbsp;no&nbsp;more&nbsp;deferred&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="1622444">//&nbsp;Cannot&nbsp;split&nbsp;the&nbsp;stack&nbsp;because&nbsp;we&nbsp;reuse&nbsp;the&nbsp;caller&#39;s&nbsp;frame&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1622509">//&nbsp;call&nbsp;the&nbsp;deferred&nbsp;function.</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="1622541">//&nbsp;The&nbsp;single&nbsp;argument&nbsp;isn&#39;t&nbsp;actually&nbsp;used&nbsp;-&nbsp;it&nbsp;just&nbsp;has&nbsp;its&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="1622610">//&nbsp;taken&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;matched&nbsp;against&nbsp;pending&nbsp;defers.</span><br>
<span class="lineno"></span><span class="comment" id="1622664">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1622677">func</span>&nbsp;<span class="ident" id="1622682">deferreturn</span><span class="op" id="1622693">(</span><span class="ident" id="1622694">arg0</span>&nbsp;<span class="builtintype" id="1622699">uintptr</span><span class="op" id="1622706">)</span>&nbsp;<span class="op" id="1622708">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1622711">gp</span>&nbsp;<span class="op" id="1622714">:=</span>&nbsp;<span class="ident" id="1622717">getg</span><span class="op" id="1622721">(</span><span class="op" id="1622722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1622725">d</span>&nbsp;<span class="op" id="1622727">:=</span>&nbsp;<span class="ident" id="1622730">gp</span><span class="op" id="1622732">.</span><span class="ident" id="1622733">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1622741">if</span>&nbsp;<span class="ident" id="1622744">d</span>&nbsp;<span class="op" id="1622746">==</span>&nbsp;<span class="builtintype" id="1622749">nil</span>&nbsp;<span class="op" id="1622753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1622757">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1622765">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1622768">argp</span>&nbsp;<span class="op" id="1622773">:=</span>&nbsp;<span class="builtintype" id="1622776">uintptr</span><span class="op" id="1622783">(</span><span class="ident" id="1622784">unsafe</span><span class="op" id="1622790">.</span><span class="ident" id="1622791">Pointer</span><span class="op" id="1622798">(</span><span class="op" id="1622799">&amp;</span><span class="ident" id="1622800">arg0</span><span class="op" id="1622804">)</span><span class="op" id="1622805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1622808">if</span>&nbsp;<span class="ident" id="1622811">d</span><span class="op" id="1622812">.</span><span class="ident" id="1622813">argp</span>&nbsp;<span class="op" id="1622818">!=</span>&nbsp;<span class="ident" id="1622821">argp</span>&nbsp;<span class="op" id="1622826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1622830">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1622838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1622842">//&nbsp;Moving&nbsp;arguments&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1622871">//&nbsp;Do&nbsp;not&nbsp;allow&nbsp;preemption&nbsp;here,&nbsp;because&nbsp;the&nbsp;garbage&nbsp;collector</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1622935">//&nbsp;won&#39;t&nbsp;know&nbsp;the&nbsp;form&nbsp;of&nbsp;the&nbsp;arguments&nbsp;until&nbsp;the&nbsp;jmpdefer&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1622999">//&nbsp;flip&nbsp;the&nbsp;PC&nbsp;over&nbsp;to&nbsp;fn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623027">mp</span>&nbsp;<span class="op" id="1623030">:=</span>&nbsp;<span class="ident" id="1623033">acquirem</span><span class="op" id="1623041">(</span><span class="op" id="1623042">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623045">memmove</span><span class="op" id="1623052">(</span><span class="ident" id="1623053">unsafe</span><span class="op" id="1623059">.</span><span class="ident" id="1623060">Pointer</span><span class="op" id="1623067">(</span><span class="ident" id="1623068">argp</span><span class="op" id="1623072">)</span><span class="op" id="1623073">,</span>&nbsp;<span class="ident" id="1623075">deferArgs</span><span class="op" id="1623084">(</span><span class="ident" id="1623085">d</span><span class="op" id="1623086">)</span><span class="op" id="1623087">,</span>&nbsp;<span class="builtintype" id="1623089">uintptr</span><span class="op" id="1623096">(</span><span class="ident" id="1623097">d</span><span class="op" id="1623098">.</span><span class="ident" id="1623099">siz</span><span class="op" id="1623102">)</span><span class="op" id="1623103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623106">fn</span>&nbsp;<span class="op" id="1623109">:=</span>&nbsp;<span class="ident" id="1623112">d</span><span class="op" id="1623113">.</span><span class="ident" id="1623114">fn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623118">d</span><span class="op" id="1623119">.</span><span class="ident" id="1623120">fn</span>&nbsp;<span class="op" id="1623123">=</span>&nbsp;<span class="builtintype" id="1623125">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623130">gp</span><span class="op" id="1623132">.</span><span class="ident" id="1623133">_defer</span>&nbsp;<span class="op" id="1623140">=</span>&nbsp;<span class="ident" id="1623142">d</span><span class="op" id="1623143">.</span><span class="ident" id="1623144">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623150">freedefer</span><span class="op" id="1623159">(</span><span class="ident" id="1623160">d</span><span class="op" id="1623161">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623164">releasem</span><span class="op" id="1623172">(</span><span class="ident" id="1623173">mp</span><span class="op" id="1623175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623178">jmpdefer</span><span class="op" id="1623186">(</span><span class="ident" id="1623187">fn</span><span class="op" id="1623189">,</span>&nbsp;<span class="ident" id="1623191">argp</span><span class="op" id="1623195">)</span><br>
<span class="lineno"></span><span class="op" id="1623197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1623200">//&nbsp;Goexit&nbsp;terminates&nbsp;the&nbsp;goroutine&nbsp;that&nbsp;calls&nbsp;it.&nbsp;&nbsp;No&nbsp;other&nbsp;goroutine&nbsp;is&nbsp;affected.</span><br>
<span class="lineno">260</span><span class="comment" id="1623283">//&nbsp;Goexit&nbsp;runs&nbsp;all&nbsp;deferred&nbsp;calls&nbsp;before&nbsp;terminating&nbsp;the&nbsp;goroutine.&nbsp;&nbsp;Because&nbsp;Goexit</span><br>
<span class="lineno"></span><span class="comment" id="1623367">//&nbsp;is&nbsp;not&nbsp;panic,&nbsp;however,&nbsp;any&nbsp;recover&nbsp;calls&nbsp;in&nbsp;those&nbsp;deferred&nbsp;functions&nbsp;will&nbsp;return&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="1623456">//</span><br>
<span class="lineno"></span><span class="comment" id="1623459">//&nbsp;Calling&nbsp;Goexit&nbsp;from&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;terminates&nbsp;that&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1623527">//&nbsp;without&nbsp;func&nbsp;main&nbsp;returning.&nbsp;Since&nbsp;func&nbsp;main&nbsp;has&nbsp;not&nbsp;returned,</span><br>
<span class="lineno">265</span><span class="comment" id="1623593">//&nbsp;the&nbsp;program&nbsp;continues&nbsp;execution&nbsp;of&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="1623649">//&nbsp;If&nbsp;all&nbsp;other&nbsp;goroutines&nbsp;exit,&nbsp;the&nbsp;program&nbsp;crashes.</span><br>
<span class="lineno"></span><span class="keyword" id="1623703">func</span>&nbsp;<span class="ident" id="1623708">Goexit</span><span class="op" id="1623714">(</span><span class="op" id="1623715">)</span>&nbsp;<span class="op" id="1623717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1623720">//&nbsp;Run&nbsp;all&nbsp;deferred&nbsp;functions&nbsp;for&nbsp;the&nbsp;current&nbsp;goroutine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1623778">//&nbsp;This&nbsp;code&nbsp;is&nbsp;similar&nbsp;to&nbsp;gopanic,&nbsp;see&nbsp;that&nbsp;implementation</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1623839">//&nbsp;for&nbsp;detailed&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623866">gp</span>&nbsp;<span class="op" id="1623869">:=</span>&nbsp;<span class="ident" id="1623872">getg</span><span class="op" id="1623876">(</span><span class="op" id="1623877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623880">for</span>&nbsp;<span class="op" id="1623884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623888">d</span>&nbsp;<span class="op" id="1623890">:=</span>&nbsp;<span class="ident" id="1623893">gp</span><span class="op" id="1623895">.</span><span class="ident" id="1623896">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623905">if</span>&nbsp;<span class="ident" id="1623908">d</span>&nbsp;<span class="op" id="1623910">==</span>&nbsp;<span class="builtintype" id="1623913">nil</span>&nbsp;<span class="op" id="1623917">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623922">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1623930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623934">if</span>&nbsp;<span class="ident" id="1623937">d</span><span class="op" id="1623938">.</span><span class="ident" id="1623939">started</span>&nbsp;<span class="op" id="1623947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623952">if</span>&nbsp;<span class="ident" id="1623955">d</span><span class="op" id="1623956">.</span><span class="ident" id="1623957">_panic</span>&nbsp;<span class="op" id="1623964">!=</span>&nbsp;<span class="builtintype" id="1623967">nil</span>&nbsp;<span class="op" id="1623971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623977">d</span><span class="op" id="1623978">.</span><span class="ident" id="1623979">_panic</span><span class="op" id="1623985">.</span><span class="ident" id="1623986">aborted</span>&nbsp;<span class="op" id="1623994">=</span>&nbsp;<span class="builtintype" id="1623996">true</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624005">d</span><span class="op" id="1624006">.</span><span class="ident" id="1624007">_panic</span>&nbsp;<span class="op" id="1624014">=</span>&nbsp;<span class="builtintype" id="1624016">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624028">d</span><span class="op" id="1624029">.</span><span class="ident" id="1624030">fn</span>&nbsp;<span class="op" id="1624033">=</span>&nbsp;<span class="builtintype" id="1624035">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624042">gp</span><span class="op" id="1624044">.</span><span class="ident" id="1624045">_defer</span>&nbsp;<span class="op" id="1624052">=</span>&nbsp;<span class="ident" id="1624054">d</span><span class="op" id="1624055">.</span><span class="ident" id="1624056">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624064">freedefer</span><span class="op" id="1624073">(</span><span class="ident" id="1624074">d</span><span class="op" id="1624075">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624080">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624095">d</span><span class="op" id="1624096">.</span><span class="ident" id="1624097">started</span>&nbsp;<span class="op" id="1624105">=</span>&nbsp;<span class="builtintype" id="1624107">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624114">reflectcall</span><span class="op" id="1624125">(</span><span class="ident" id="1624126">unsafe</span><span class="op" id="1624132">.</span><span class="ident" id="1624133">Pointer</span><span class="op" id="1624140">(</span><span class="ident" id="1624141">d</span><span class="op" id="1624142">.</span><span class="ident" id="1624143">fn</span><span class="op" id="1624145">)</span><span class="op" id="1624146">,</span>&nbsp;<span class="ident" id="1624148">deferArgs</span><span class="op" id="1624157">(</span><span class="ident" id="1624158">d</span><span class="op" id="1624159">)</span><span class="op" id="1624160">,</span>&nbsp;<span class="builtintype" id="1624162">uint32</span><span class="op" id="1624168">(</span><span class="ident" id="1624169">d</span><span class="op" id="1624170">.</span><span class="ident" id="1624171">siz</span><span class="op" id="1624174">)</span><span class="op" id="1624175">,</span>&nbsp;<span class="builtintype" id="1624177">uint32</span><span class="op" id="1624183">(</span><span class="ident" id="1624184">d</span><span class="op" id="1624185">.</span><span class="ident" id="1624186">siz</span><span class="op" id="1624189">)</span><span class="op" id="1624190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624194">if</span>&nbsp;<span class="ident" id="1624197">gp</span><span class="op" id="1624199">.</span><span class="ident" id="1624200">_defer</span>&nbsp;<span class="op" id="1624207">!=</span>&nbsp;<span class="ident" id="1624210">d</span>&nbsp;<span class="op" id="1624212">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624217">gothrow</span><span class="op" id="1624224">(</span><span class="string" id="1624225">&#34;bad&nbsp;defer&nbsp;entry&nbsp;in&nbsp;Goexit&#34;</span><span class="op" id="1624252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624260">d</span><span class="op" id="1624261">.</span><span class="ident" id="1624262">_panic</span>&nbsp;<span class="op" id="1624269">=</span>&nbsp;<span class="builtintype" id="1624271">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624277">d</span><span class="op" id="1624278">.</span><span class="ident" id="1624279">fn</span>&nbsp;<span class="op" id="1624282">=</span>&nbsp;<span class="builtintype" id="1624284">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624290">gp</span><span class="op" id="1624292">.</span><span class="ident" id="1624293">_defer</span>&nbsp;<span class="op" id="1624300">=</span>&nbsp;<span class="ident" id="1624302">d</span><span class="op" id="1624303">.</span><span class="ident" id="1624304">link</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624311">freedefer</span><span class="op" id="1624320">(</span><span class="ident" id="1624321">d</span><span class="op" id="1624322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1624326">//&nbsp;Note:&nbsp;we&nbsp;ignore&nbsp;recovers&nbsp;here&nbsp;because&nbsp;Goexit&nbsp;isn&#39;t&nbsp;a&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624392">goexit</span><span class="op" id="1624398">(</span><span class="op" id="1624399">)</span><br>
<span class="lineno"></span><span class="op" id="1624401">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="keyword" id="1624404">func</span>&nbsp;<span class="ident" id="1624409">canpanic</span><span class="op" id="1624417">(</span><span class="op" id="1624418">*</span><span class="ident" id="1624419">g</span><span class="op" id="1624420">)</span>&nbsp;<span class="builtintype" id="1624422">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1624428">//&nbsp;Print&nbsp;all&nbsp;currently&nbsp;active&nbsp;panics.&nbsp;&nbsp;Used&nbsp;when&nbsp;crashing.</span><br>
<span class="lineno"></span><span class="keyword" id="1624487">func</span>&nbsp;<span class="ident" id="1624492">printpanics</span><span class="op" id="1624503">(</span><span class="ident" id="1624504">p</span>&nbsp;<span class="op" id="1624506">*</span><span class="ident" id="1624507">_panic</span><span class="op" id="1624513">)</span>&nbsp;<span class="op" id="1624515">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624518">if</span>&nbsp;<span class="ident" id="1624521">p</span><span class="op" id="1624522">.</span><span class="ident" id="1624523">link</span>&nbsp;<span class="op" id="1624528">!=</span>&nbsp;<span class="builtintype" id="1624531">nil</span>&nbsp;<span class="op" id="1624535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624539">printpanics</span><span class="op" id="1624550">(</span><span class="ident" id="1624551">p</span><span class="op" id="1624552">.</span><span class="ident" id="1624553">link</span><span class="op" id="1624557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1624561">print</span><span class="op" id="1624566">(</span><span class="string" id="1624567">&#34;\t&#34;</span><span class="op" id="1624571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1624577">print</span><span class="op" id="1624582">(</span><span class="string" id="1624583">&#34;panic:&nbsp;&#34;</span><span class="op" id="1624592">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624595">printany</span><span class="op" id="1624603">(</span><span class="ident" id="1624604">p</span><span class="op" id="1624605">.</span><span class="ident" id="1624606">arg</span><span class="op" id="1624609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624612">if</span>&nbsp;<span class="ident" id="1624615">p</span><span class="op" id="1624616">.</span><span class="ident" id="1624617">recovered</span>&nbsp;<span class="op" id="1624627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1624631">print</span><span class="op" id="1624636">(</span><span class="string" id="1624637">&#34;&nbsp;[recovered]&#34;</span><span class="op" id="1624651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1624657">print</span><span class="op" id="1624662">(</span><span class="string" id="1624663">&#34;\n&#34;</span><span class="op" id="1624667">)</span><br>
<span class="lineno">315</span><span class="op" id="1624669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1624672">//&nbsp;The&nbsp;implementation&nbsp;of&nbsp;the&nbsp;predeclared&nbsp;function&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="1624729">func</span>&nbsp;<span class="ident" id="1624734">gopanic</span><span class="op" id="1624741">(</span><span class="ident" id="1624742">e</span>&nbsp;<span class="keyword" id="1624744">interface</span><span class="op" id="1624753">{</span><span class="op" id="1624754">}</span><span class="op" id="1624755">)</span>&nbsp;<span class="op" id="1624757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624760">gp</span>&nbsp;<span class="op" id="1624763">:=</span>&nbsp;<span class="ident" id="1624766">getg</span><span class="op" id="1624770">(</span><span class="op" id="1624771">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1624774">if</span>&nbsp;<span class="ident" id="1624777">gp</span><span class="op" id="1624779">.</span><span class="ident" id="1624780">m</span><span class="op" id="1624781">.</span><span class="ident" id="1624782">curg</span>&nbsp;<span class="op" id="1624787">!=</span>&nbsp;<span class="ident" id="1624790">gp</span>&nbsp;<span class="op" id="1624793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1624797">gothrow</span><span class="op" id="1624804">(</span><span class="string" id="1624805">&#34;panic&nbsp;on&nbsp;m&nbsp;stack&#34;</span><span class="op" id="1624823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1624826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1624830">//&nbsp;m.softfloat&nbsp;is&nbsp;set&nbsp;during&nbsp;software&nbsp;floating&nbsp;point.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1624885">//&nbsp;It&nbsp;increments&nbsp;m.locks&nbsp;to&nbsp;avoid&nbsp;preemption.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1624932">//&nbsp;We&nbsp;moved&nbsp;the&nbsp;memory&nbsp;loads&nbsp;out,&nbsp;so&nbsp;there&nbsp;shouldn&#39;t&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1624989">//&nbsp;any&nbsp;reason&nbsp;for&nbsp;it&nbsp;to&nbsp;panic&nbsp;anymore.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1625029">if</span>&nbsp;<span class="ident" id="1625032">gp</span><span class="op" id="1625034">.</span><span class="ident" id="1625035">m</span><span class="op" id="1625036">.</span><span class="ident" id="1625037">softfloat</span>&nbsp;<span class="op" id="1625047">!=</span>&nbsp;<span class="num" id="1625050">0</span>&nbsp;<span class="op" id="1625052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625056">gp</span><span class="op" id="1625058">.</span><span class="ident" id="1625059">m</span><span class="op" id="1625060">.</span><span class="ident" id="1625061">locks</span><span class="op" id="1625066">--</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625071">gp</span><span class="op" id="1625073">.</span><span class="ident" id="1625074">m</span><span class="op" id="1625075">.</span><span class="ident" id="1625076">softfloat</span>&nbsp;<span class="op" id="1625086">=</span>&nbsp;<span class="num" id="1625088">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625092">gothrow</span><span class="op" id="1625099">(</span><span class="string" id="1625100">&#34;panic&nbsp;during&nbsp;softfloat&#34;</span><span class="op" id="1625124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1625127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1625130">if</span>&nbsp;<span class="ident" id="1625133">gp</span><span class="op" id="1625135">.</span><span class="ident" id="1625136">m</span><span class="op" id="1625137">.</span><span class="ident" id="1625138">mallocing</span>&nbsp;<span class="op" id="1625148">!=</span>&nbsp;<span class="num" id="1625151">0</span>&nbsp;<span class="op" id="1625153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1625157">print</span><span class="op" id="1625162">(</span><span class="string" id="1625163">&#34;panic:&nbsp;&#34;</span><span class="op" id="1625172">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625176">printany</span><span class="op" id="1625184">(</span><span class="ident" id="1625185">e</span><span class="op" id="1625186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1625190">print</span><span class="op" id="1625195">(</span><span class="string" id="1625196">&#34;\n&#34;</span><span class="op" id="1625200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625204">gothrow</span><span class="op" id="1625211">(</span><span class="string" id="1625212">&#34;panic&nbsp;during&nbsp;malloc&#34;</span><span class="op" id="1625233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1625236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1625239">if</span>&nbsp;<span class="ident" id="1625242">gp</span><span class="op" id="1625244">.</span><span class="ident" id="1625245">m</span><span class="op" id="1625246">.</span><span class="ident" id="1625247">gcing</span>&nbsp;<span class="op" id="1625253">!=</span>&nbsp;<span class="num" id="1625256">0</span>&nbsp;<span class="op" id="1625258">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1625262">print</span><span class="op" id="1625267">(</span><span class="string" id="1625268">&#34;panic:&nbsp;&#34;</span><span class="op" id="1625277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625281">printany</span><span class="op" id="1625289">(</span><span class="ident" id="1625290">e</span><span class="op" id="1625291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1625295">print</span><span class="op" id="1625300">(</span><span class="string" id="1625301">&#34;\n&#34;</span><span class="op" id="1625305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625309">gothrow</span><span class="op" id="1625316">(</span><span class="string" id="1625317">&#34;panic&nbsp;during&nbsp;gc&#34;</span><span class="op" id="1625334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1625337">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1625340">if</span>&nbsp;<span class="ident" id="1625343">gp</span><span class="op" id="1625345">.</span><span class="ident" id="1625346">m</span><span class="op" id="1625347">.</span><span class="ident" id="1625348">locks</span>&nbsp;<span class="op" id="1625354">!=</span>&nbsp;<span class="num" id="1625357">0</span>&nbsp;<span class="op" id="1625359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1625363">print</span><span class="op" id="1625368">(</span><span class="string" id="1625369">&#34;panic:&nbsp;&#34;</span><span class="op" id="1625378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625382">printany</span><span class="op" id="1625390">(</span><span class="ident" id="1625391">e</span><span class="op" id="1625392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1625396">print</span><span class="op" id="1625401">(</span><span class="string" id="1625402">&#34;\n&#34;</span><span class="op" id="1625406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625410">gothrow</span><span class="op" id="1625417">(</span><span class="string" id="1625418">&#34;panic&nbsp;holding&nbsp;locks&#34;</span><span class="op" id="1625439">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1625442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1625446">var</span>&nbsp;<span class="ident" id="1625450">p</span>&nbsp;<span class="ident" id="1625452">_panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625460">p</span><span class="op" id="1625461">.</span><span class="ident" id="1625462">arg</span>&nbsp;<span class="op" id="1625466">=</span>&nbsp;<span class="ident" id="1625468">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625471">p</span><span class="op" id="1625472">.</span><span class="ident" id="1625473">link</span>&nbsp;<span class="op" id="1625478">=</span>&nbsp;<span class="ident" id="1625480">gp</span><span class="op" id="1625482">.</span><span class="ident" id="1625483">_panic</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625491">gp</span><span class="op" id="1625493">.</span><span class="ident" id="1625494">_panic</span>&nbsp;<span class="op" id="1625501">=</span>&nbsp;<span class="op" id="1625503">(</span><span class="op" id="1625504">*</span><span class="ident" id="1625505">_panic</span><span class="op" id="1625511">)</span><span class="op" id="1625512">(</span><span class="ident" id="1625513">noescape</span><span class="op" id="1625521">(</span><span class="ident" id="1625522">unsafe</span><span class="op" id="1625528">.</span><span class="ident" id="1625529">Pointer</span><span class="op" id="1625536">(</span><span class="op" id="1625537">&amp;</span><span class="ident" id="1625538">p</span><span class="op" id="1625539">)</span><span class="op" id="1625540">)</span><span class="op" id="1625541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1625545">for</span>&nbsp;<span class="op" id="1625549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625553">d</span>&nbsp;<span class="op" id="1625555">:=</span>&nbsp;<span class="ident" id="1625558">gp</span><span class="op" id="1625560">.</span><span class="ident" id="1625561">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1625570">if</span>&nbsp;<span class="ident" id="1625573">d</span>&nbsp;<span class="op" id="1625575">==</span>&nbsp;<span class="builtintype" id="1625578">nil</span>&nbsp;<span class="op" id="1625582">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1625587">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1625595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1625600">//&nbsp;If&nbsp;defer&nbsp;was&nbsp;started&nbsp;by&nbsp;earlier&nbsp;panic&nbsp;or&nbsp;Goexit&nbsp;(and,&nbsp;since&nbsp;we&#39;re&nbsp;back&nbsp;here,&nbsp;that&nbsp;triggered&nbsp;a&nbsp;new&nbsp;panic),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1625711">//&nbsp;take&nbsp;defer&nbsp;off&nbsp;list.&nbsp;The&nbsp;earlier&nbsp;panic&nbsp;or&nbsp;Goexit&nbsp;will&nbsp;not&nbsp;continue&nbsp;running.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1625792">if</span>&nbsp;<span class="ident" id="1625795">d</span><span class="op" id="1625796">.</span><span class="ident" id="1625797">started</span>&nbsp;<span class="op" id="1625805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1625810">if</span>&nbsp;<span class="ident" id="1625813">d</span><span class="op" id="1625814">.</span><span class="ident" id="1625815">_panic</span>&nbsp;<span class="op" id="1625822">!=</span>&nbsp;<span class="builtintype" id="1625825">nil</span>&nbsp;<span class="op" id="1625829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625835">d</span><span class="op" id="1625836">.</span><span class="ident" id="1625837">_panic</span><span class="op" id="1625843">.</span><span class="ident" id="1625844">aborted</span>&nbsp;<span class="op" id="1625852">=</span>&nbsp;<span class="builtintype" id="1625854">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1625862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625867">d</span><span class="op" id="1625868">.</span><span class="ident" id="1625869">_panic</span>&nbsp;<span class="op" id="1625876">=</span>&nbsp;<span class="builtintype" id="1625878">nil</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625885">d</span><span class="op" id="1625886">.</span><span class="ident" id="1625887">fn</span>&nbsp;<span class="op" id="1625890">=</span>&nbsp;<span class="builtintype" id="1625892">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625899">gp</span><span class="op" id="1625901">.</span><span class="ident" id="1625902">_defer</span>&nbsp;<span class="op" id="1625909">=</span>&nbsp;<span class="ident" id="1625911">d</span><span class="op" id="1625912">.</span><span class="ident" id="1625913">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1625921">freedefer</span><span class="op" id="1625930">(</span><span class="ident" id="1625931">d</span><span class="op" id="1625932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1625937">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1625948">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1625953">//&nbsp;Mark&nbsp;defer&nbsp;as&nbsp;started,&nbsp;but&nbsp;keep&nbsp;on&nbsp;list,&nbsp;so&nbsp;that&nbsp;traceback</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1626017">//&nbsp;can&nbsp;find&nbsp;and&nbsp;update&nbsp;the&nbsp;defer&#39;s&nbsp;argument&nbsp;frame&nbsp;if&nbsp;stack&nbsp;growth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1626085">//&nbsp;or&nbsp;a&nbsp;garbage&nbsp;collection&nbsp;hapens&nbsp;before&nbsp;reflectcall&nbsp;starts&nbsp;executing&nbsp;d.fn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626163">d</span><span class="op" id="1626164">.</span><span class="ident" id="1626165">started</span>&nbsp;<span class="op" id="1626173">=</span>&nbsp;<span class="builtintype" id="1626175">true</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1626183">//&nbsp;Record&nbsp;the&nbsp;panic&nbsp;that&nbsp;is&nbsp;running&nbsp;the&nbsp;defer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1626232">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;new&nbsp;panic&nbsp;during&nbsp;the&nbsp;deferred&nbsp;call,&nbsp;that&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1626298">//&nbsp;will&nbsp;find&nbsp;d&nbsp;in&nbsp;the&nbsp;list&nbsp;and&nbsp;will&nbsp;mark&nbsp;d._panic&nbsp;(this&nbsp;panic)&nbsp;aborted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626372">d</span><span class="op" id="1626373">.</span><span class="ident" id="1626374">_panic</span>&nbsp;<span class="op" id="1626381">=</span>&nbsp;<span class="op" id="1626383">(</span><span class="op" id="1626384">*</span><span class="ident" id="1626385">_panic</span><span class="op" id="1626391">)</span><span class="op" id="1626392">(</span><span class="ident" id="1626393">noescape</span><span class="op" id="1626401">(</span><span class="op" id="1626402">(</span><span class="ident" id="1626403">unsafe</span><span class="op" id="1626409">.</span><span class="ident" id="1626410">Pointer</span><span class="op" id="1626417">)</span><span class="op" id="1626418">(</span><span class="op" id="1626419">&amp;</span><span class="ident" id="1626420">p</span><span class="op" id="1626421">)</span><span class="op" id="1626422">)</span><span class="op" id="1626423">)</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626428">p</span><span class="op" id="1626429">.</span><span class="ident" id="1626430">argp</span>&nbsp;<span class="op" id="1626435">=</span>&nbsp;<span class="ident" id="1626437">unsafe</span><span class="op" id="1626443">.</span><span class="ident" id="1626444">Pointer</span><span class="op" id="1626451">(</span><span class="ident" id="1626452">getargp</span><span class="op" id="1626459">(</span><span class="num" id="1626460">0</span><span class="op" id="1626461">)</span><span class="op" id="1626462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626466">reflectcall</span><span class="op" id="1626477">(</span><span class="ident" id="1626478">unsafe</span><span class="op" id="1626484">.</span><span class="ident" id="1626485">Pointer</span><span class="op" id="1626492">(</span><span class="ident" id="1626493">d</span><span class="op" id="1626494">.</span><span class="ident" id="1626495">fn</span><span class="op" id="1626497">)</span><span class="op" id="1626498">,</span>&nbsp;<span class="ident" id="1626500">deferArgs</span><span class="op" id="1626509">(</span><span class="ident" id="1626510">d</span><span class="op" id="1626511">)</span><span class="op" id="1626512">,</span>&nbsp;<span class="builtintype" id="1626514">uint32</span><span class="op" id="1626520">(</span><span class="ident" id="1626521">d</span><span class="op" id="1626522">.</span><span class="ident" id="1626523">siz</span><span class="op" id="1626526">)</span><span class="op" id="1626527">,</span>&nbsp;<span class="builtintype" id="1626529">uint32</span><span class="op" id="1626535">(</span><span class="ident" id="1626536">d</span><span class="op" id="1626537">.</span><span class="ident" id="1626538">siz</span><span class="op" id="1626541">)</span><span class="op" id="1626542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626546">p</span><span class="op" id="1626547">.</span><span class="ident" id="1626548">argp</span>&nbsp;<span class="op" id="1626553">=</span>&nbsp;<span class="builtintype" id="1626555">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1626562">//&nbsp;reflectcall&nbsp;did&nbsp;not&nbsp;panic.&nbsp;Remove&nbsp;d.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1626604">if</span>&nbsp;<span class="ident" id="1626607">gp</span><span class="op" id="1626609">.</span><span class="ident" id="1626610">_defer</span>&nbsp;<span class="op" id="1626617">!=</span>&nbsp;<span class="ident" id="1626620">d</span>&nbsp;<span class="op" id="1626622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626627">gothrow</span><span class="op" id="1626634">(</span><span class="string" id="1626635">&#34;bad&nbsp;defer&nbsp;entry&nbsp;in&nbsp;panic&#34;</span><span class="op" id="1626661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1626665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626669">d</span><span class="op" id="1626670">.</span><span class="ident" id="1626671">_panic</span>&nbsp;<span class="op" id="1626678">=</span>&nbsp;<span class="builtintype" id="1626680">nil</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626686">d</span><span class="op" id="1626687">.</span><span class="ident" id="1626688">fn</span>&nbsp;<span class="op" id="1626691">=</span>&nbsp;<span class="builtintype" id="1626693">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626699">gp</span><span class="op" id="1626701">.</span><span class="ident" id="1626702">_defer</span>&nbsp;<span class="op" id="1626709">=</span>&nbsp;<span class="ident" id="1626711">d</span><span class="op" id="1626712">.</span><span class="ident" id="1626713">link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1626721">//&nbsp;trigger&nbsp;shrinkage&nbsp;to&nbsp;test&nbsp;stack&nbsp;copy.&nbsp;&nbsp;See&nbsp;stack_test.go:TestStackPanic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1626798">//GC()</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626808">pc</span>&nbsp;<span class="op" id="1626811">:=</span>&nbsp;<span class="ident" id="1626814">d</span><span class="op" id="1626815">.</span><span class="ident" id="1626816">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626821">argp</span>&nbsp;<span class="op" id="1626826">:=</span>&nbsp;<span class="ident" id="1626829">unsafe</span><span class="op" id="1626835">.</span><span class="ident" id="1626836">Pointer</span><span class="op" id="1626843">(</span><span class="ident" id="1626844">d</span><span class="op" id="1626845">.</span><span class="ident" id="1626846">argp</span><span class="op" id="1626850">)</span>&nbsp;<span class="comment" id="1626852">//&nbsp;must&nbsp;be&nbsp;pointer&nbsp;so&nbsp;it&nbsp;gets&nbsp;adjusted&nbsp;during&nbsp;stack&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626911">freedefer</span><span class="op" id="1626920">(</span><span class="ident" id="1626921">d</span><span class="op" id="1626922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1626926">if</span>&nbsp;<span class="ident" id="1626929">p</span><span class="op" id="1626930">.</span><span class="ident" id="1626931">recovered</span>&nbsp;<span class="op" id="1626941">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1626946">gp</span><span class="op" id="1626948">.</span><span class="ident" id="1626949">_panic</span>&nbsp;<span class="op" id="1626956">=</span>&nbsp;<span class="ident" id="1626958">p</span><span class="op" id="1626959">.</span><span class="ident" id="1626960">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1626968">//&nbsp;Aborted&nbsp;panics&nbsp;are&nbsp;marked&nbsp;but&nbsp;remain&nbsp;on&nbsp;the&nbsp;g.panic&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1627032">//&nbsp;Remove&nbsp;them&nbsp;from&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627065">for</span>&nbsp;<span class="ident" id="1627069">gp</span><span class="op" id="1627071">.</span><span class="ident" id="1627072">_panic</span>&nbsp;<span class="op" id="1627079">!=</span>&nbsp;<span class="builtintype" id="1627082">nil</span>&nbsp;<span class="op" id="1627086">&amp;&amp;</span>&nbsp;<span class="ident" id="1627089">gp</span><span class="op" id="1627091">.</span><span class="ident" id="1627092">_panic</span><span class="op" id="1627098">.</span><span class="ident" id="1627099">aborted</span>&nbsp;<span class="op" id="1627107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627113">gp</span><span class="op" id="1627115">.</span><span class="ident" id="1627116">_panic</span>&nbsp;<span class="op" id="1627123">=</span>&nbsp;<span class="ident" id="1627125">gp</span><span class="op" id="1627127">.</span><span class="ident" id="1627128">_panic</span><span class="op" id="1627134">.</span><span class="ident" id="1627135">link</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1627148">if</span>&nbsp;<span class="ident" id="1627151">gp</span><span class="op" id="1627153">.</span><span class="ident" id="1627154">_panic</span>&nbsp;<span class="op" id="1627161">==</span>&nbsp;<span class="builtintype" id="1627164">nil</span>&nbsp;<span class="op" id="1627168">{</span>&nbsp;<span class="comment" id="1627170">//&nbsp;must&nbsp;be&nbsp;done&nbsp;with&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627202">gp</span><span class="op" id="1627204">.</span><span class="ident" id="1627205">sig</span>&nbsp;<span class="op" id="1627209">=</span>&nbsp;<span class="num" id="1627211">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1627221">//&nbsp;Pass&nbsp;information&nbsp;about&nbsp;recovering&nbsp;frame&nbsp;to&nbsp;recovery.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627280">gp</span><span class="op" id="1627282">.</span><span class="ident" id="1627283">sigcode0</span>&nbsp;<span class="op" id="1627292">=</span>&nbsp;<span class="builtintype" id="1627294">uintptr</span><span class="op" id="1627301">(</span><span class="ident" id="1627302">argp</span><span class="op" id="1627306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627311">gp</span><span class="op" id="1627313">.</span><span class="ident" id="1627314">sigcode1</span>&nbsp;<span class="op" id="1627323">=</span>&nbsp;<span class="ident" id="1627325">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627331">mcall</span><span class="op" id="1627336">(</span><span class="ident" id="1627337">recovery_m</span><span class="op" id="1627347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627352">gothrow</span><span class="op" id="1627359">(</span><span class="string" id="1627360">&#34;recovery&nbsp;failed&#34;</span><span class="op" id="1627377">)</span>&nbsp;<span class="comment" id="1627379">//&nbsp;mcall&nbsp;should&nbsp;not&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627408">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1627415">//&nbsp;ran&nbsp;out&nbsp;of&nbsp;deferred&nbsp;calls&nbsp;-&nbsp;old-school&nbsp;panic&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627468">startpanic</span><span class="op" id="1627478">(</span><span class="op" id="1627479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627482">printpanics</span><span class="op" id="1627493">(</span><span class="ident" id="1627494">gp</span><span class="op" id="1627496">.</span><span class="ident" id="1627497">_panic</span><span class="op" id="1627503">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1627506">dopanic</span><span class="op" id="1627513">(</span><span class="num" id="1627514">0</span><span class="op" id="1627515">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1627523">//&nbsp;should&nbsp;not&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1627545">*</span><span class="op" id="1627546">(</span><span class="op" id="1627547">*</span><span class="builtintype" id="1627548">int</span><span class="op" id="1627551">)</span><span class="op" id="1627552">(</span><span class="builtintype" id="1627553">nil</span><span class="op" id="1627556">)</span>&nbsp;<span class="op" id="1627558">=</span>&nbsp;<span class="num" id="1627560">0</span>&nbsp;<span class="comment" id="1627562">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno"></span><span class="op" id="1627577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1627580">//&nbsp;getargp&nbsp;returns&nbsp;the&nbsp;location&nbsp;where&nbsp;the&nbsp;caller</span><br>
<span class="lineno">430</span><span class="comment" id="1627629">//&nbsp;writes&nbsp;outgoing&nbsp;function&nbsp;call&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="1627673">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1627686">func</span>&nbsp;<span class="ident" id="1627691">getargp</span><span class="op" id="1627698">(</span><span class="ident" id="1627699">x</span>&nbsp;<span class="builtintype" id="1627701">int</span><span class="op" id="1627704">)</span>&nbsp;<span class="builtintype" id="1627706">uintptr</span>&nbsp;<span class="op" id="1627714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1627717">//&nbsp;x&nbsp;is&nbsp;an&nbsp;argument&nbsp;mainly&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;return&nbsp;its&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1627780">//&nbsp;However,&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;the&nbsp;function&nbsp;complex&nbsp;enough</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1627837">//&nbsp;that&nbsp;it&nbsp;won&#39;t&nbsp;be&nbsp;inlined.&nbsp;We&nbsp;always&nbsp;pass&nbsp;x&nbsp;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1627902">//&nbsp;does&nbsp;nothing&nbsp;other&nbsp;than&nbsp;keep&nbsp;the&nbsp;compiler&nbsp;from&nbsp;thinking</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1627962">//&nbsp;the&nbsp;function&nbsp;is&nbsp;simple&nbsp;enough&nbsp;to&nbsp;inline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1628007">if</span>&nbsp;<span class="ident" id="1628010">x</span>&nbsp;<span class="op" id="1628012">&gt;</span>&nbsp;<span class="num" id="1628014">0</span>&nbsp;<span class="op" id="1628016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1628020">return</span>&nbsp;<span class="ident" id="1628027">getcallersp</span><span class="op" id="1628038">(</span><span class="ident" id="1628039">unsafe</span><span class="op" id="1628045">.</span><span class="ident" id="1628046">Pointer</span><span class="op" id="1628053">(</span><span class="op" id="1628054">&amp;</span><span class="ident" id="1628055">x</span><span class="op" id="1628056">)</span><span class="op" id="1628057">)</span>&nbsp;<span class="op" id="1628059">*</span>&nbsp;<span class="num" id="1628061">0</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1628064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1628067">return</span>&nbsp;<span class="builtintype" id="1628074">uintptr</span><span class="op" id="1628081">(</span><span class="ident" id="1628082">noescape</span><span class="op" id="1628090">(</span><span class="ident" id="1628091">unsafe</span><span class="op" id="1628097">.</span><span class="ident" id="1628098">Pointer</span><span class="op" id="1628105">(</span><span class="op" id="1628106">&amp;</span><span class="ident" id="1628107">x</span><span class="op" id="1628108">)</span><span class="op" id="1628109">)</span><span class="op" id="1628110">)</span><br>
<span class="lineno"></span><span class="op" id="1628112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1628115">//&nbsp;The&nbsp;implementation&nbsp;of&nbsp;the&nbsp;predeclared&nbsp;function&nbsp;recover.</span><br>
<span class="lineno">445</span><span class="comment" id="1628174">//&nbsp;Cannot&nbsp;split&nbsp;the&nbsp;stack&nbsp;because&nbsp;it&nbsp;needs&nbsp;to&nbsp;reliably</span><br>
<span class="lineno"></span><span class="comment" id="1628229">//&nbsp;find&nbsp;the&nbsp;stack&nbsp;segment&nbsp;of&nbsp;its&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="1628270">//</span><br>
<span class="lineno"></span><span class="comment" id="1628273">//&nbsp;TODO(rsc):&nbsp;Once&nbsp;we&nbsp;commit&nbsp;to&nbsp;CopyStackAlways,</span><br>
<span class="lineno"></span><span class="comment" id="1628322">//&nbsp;this&nbsp;doesn&#39;t&nbsp;need&nbsp;to&nbsp;be&nbsp;nosplit.</span><br>
<span class="lineno">450</span><span class="comment" id="1628358">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1628371">func</span>&nbsp;<span class="ident" id="1628376">gorecover</span><span class="op" id="1628385">(</span><span class="ident" id="1628386">argp</span>&nbsp;<span class="builtintype" id="1628391">uintptr</span><span class="op" id="1628398">)</span>&nbsp;<span class="keyword" id="1628400">interface</span><span class="op" id="1628409">{</span><span class="op" id="1628410">}</span>&nbsp;<span class="op" id="1628412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1628415">//&nbsp;Must&nbsp;be&nbsp;in&nbsp;a&nbsp;function&nbsp;running&nbsp;as&nbsp;part&nbsp;of&nbsp;a&nbsp;deferred&nbsp;call&nbsp;during&nbsp;the&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1628494">//&nbsp;Must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;topmost&nbsp;function&nbsp;of&nbsp;the&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1628551">//&nbsp;(the&nbsp;function&nbsp;used&nbsp;in&nbsp;the&nbsp;defer&nbsp;statement).</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1628599">//&nbsp;p.argp&nbsp;is&nbsp;the&nbsp;argument&nbsp;pointer&nbsp;of&nbsp;that&nbsp;topmost&nbsp;deferred&nbsp;function&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1628674">//&nbsp;Compare&nbsp;against&nbsp;argp&nbsp;reported&nbsp;by&nbsp;caller.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1628719">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;the&nbsp;caller&nbsp;is&nbsp;the&nbsp;one&nbsp;who&nbsp;can&nbsp;recover.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628777">gp</span>&nbsp;<span class="op" id="1628780">:=</span>&nbsp;<span class="ident" id="1628783">getg</span><span class="op" id="1628787">(</span><span class="op" id="1628788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628791">p</span>&nbsp;<span class="op" id="1628793">:=</span>&nbsp;<span class="ident" id="1628796">gp</span><span class="op" id="1628798">.</span><span class="ident" id="1628799">_panic</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1628807">if</span>&nbsp;<span class="ident" id="1628810">p</span>&nbsp;<span class="op" id="1628812">!=</span>&nbsp;<span class="builtintype" id="1628815">nil</span>&nbsp;<span class="op" id="1628819">&amp;&amp;</span>&nbsp;<span class="op" id="1628822">!</span><span class="ident" id="1628823">p</span><span class="op" id="1628824">.</span><span class="ident" id="1628825">recovered</span>&nbsp;<span class="op" id="1628835">&amp;&amp;</span>&nbsp;<span class="ident" id="1628838">argp</span>&nbsp;<span class="op" id="1628843">==</span>&nbsp;<span class="builtintype" id="1628846">uintptr</span><span class="op" id="1628853">(</span><span class="ident" id="1628854">p</span><span class="op" id="1628855">.</span><span class="ident" id="1628856">argp</span><span class="op" id="1628860">)</span>&nbsp;<span class="op" id="1628862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628866">p</span><span class="op" id="1628867">.</span><span class="ident" id="1628868">recovered</span>&nbsp;<span class="op" id="1628878">=</span>&nbsp;<span class="builtintype" id="1628880">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1628887">return</span>&nbsp;<span class="ident" id="1628894">p</span><span class="op" id="1628895">.</span><span class="ident" id="1628896">arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1628901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1628904">return</span>&nbsp;<span class="builtintype" id="1628911">nil</span><br>
<span class="lineno">465</span><span class="op" id="1628915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1628918">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1628931">func</span>&nbsp;<span class="ident" id="1628936">startpanic</span><span class="op" id="1628946">(</span><span class="op" id="1628947">)</span>&nbsp;<span class="op" id="1628949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1628952">onM_signalok</span><span class="op" id="1628964">(</span><span class="ident" id="1628965">startpanic_m</span><span class="op" id="1628977">)</span><br>
<span class="lineno">470</span><span class="op" id="1628979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1628982">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1628995">func</span>&nbsp;<span class="ident" id="1629000">dopanic</span><span class="op" id="1629007">(</span><span class="ident" id="1629008">unused</span>&nbsp;<span class="builtintype" id="1629015">int</span><span class="op" id="1629018">)</span>&nbsp;<span class="op" id="1629020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629023">gp</span>&nbsp;<span class="op" id="1629026">:=</span>&nbsp;<span class="ident" id="1629029">getg</span><span class="op" id="1629033">(</span><span class="op" id="1629034">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629037">mp</span>&nbsp;<span class="op" id="1629040">:=</span>&nbsp;<span class="ident" id="1629043">acquirem</span><span class="op" id="1629051">(</span><span class="op" id="1629052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629055">mp</span><span class="op" id="1629057">.</span><span class="ident" id="1629058">ptrarg</span><span class="op" id="1629064">[</span><span class="num" id="1629065">0</span><span class="op" id="1629066">]</span>&nbsp;<span class="op" id="1629068">=</span>&nbsp;<span class="ident" id="1629070">unsafe</span><span class="op" id="1629076">.</span><span class="ident" id="1629077">Pointer</span><span class="op" id="1629084">(</span><span class="ident" id="1629085">gp</span><span class="op" id="1629087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629090">mp</span><span class="op" id="1629092">.</span><span class="ident" id="1629093">scalararg</span><span class="op" id="1629102">[</span><span class="num" id="1629103">0</span><span class="op" id="1629104">]</span>&nbsp;<span class="op" id="1629106">=</span>&nbsp;<span class="ident" id="1629108">getcallerpc</span><span class="op" id="1629119">(</span><span class="op" id="1629120">(</span><span class="ident" id="1629121">unsafe</span><span class="op" id="1629127">.</span><span class="ident" id="1629128">Pointer</span><span class="op" id="1629135">)</span><span class="op" id="1629136">(</span><span class="op" id="1629137">&amp;</span><span class="ident" id="1629138">unused</span><span class="op" id="1629144">)</span><span class="op" id="1629145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629148">mp</span><span class="op" id="1629150">.</span><span class="ident" id="1629151">scalararg</span><span class="op" id="1629160">[</span><span class="num" id="1629161">1</span><span class="op" id="1629162">]</span>&nbsp;<span class="op" id="1629164">=</span>&nbsp;<span class="ident" id="1629166">getcallersp</span><span class="op" id="1629177">(</span><span class="op" id="1629178">(</span><span class="ident" id="1629179">unsafe</span><span class="op" id="1629185">.</span><span class="ident" id="1629186">Pointer</span><span class="op" id="1629193">)</span><span class="op" id="1629194">(</span><span class="op" id="1629195">&amp;</span><span class="ident" id="1629196">unused</span><span class="op" id="1629202">)</span><span class="op" id="1629203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629206">onM_signalok</span><span class="op" id="1629218">(</span><span class="ident" id="1629219">dopanic_m</span><span class="op" id="1629228">)</span>&nbsp;<span class="comment" id="1629230">//&nbsp;should&nbsp;never&nbsp;return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1629254">*</span><span class="op" id="1629255">(</span><span class="op" id="1629256">*</span><span class="builtintype" id="1629257">int</span><span class="op" id="1629260">)</span><span class="op" id="1629261">(</span><span class="builtintype" id="1629262">nil</span><span class="op" id="1629265">)</span>&nbsp;<span class="op" id="1629267">=</span>&nbsp;<span class="num" id="1629269">0</span><br>
<span class="lineno"></span><span class="op" id="1629271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1629274">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1629287">func</span>&nbsp;<span class="ident" id="1629292">throw</span><span class="op" id="1629297">(</span><span class="ident" id="1629298">s</span>&nbsp;<span class="op" id="1629300">*</span><span class="builtintype" id="1629301">byte</span><span class="op" id="1629305">)</span>&nbsp;<span class="op" id="1629307">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629310">gp</span>&nbsp;<span class="op" id="1629313">:=</span>&nbsp;<span class="ident" id="1629316">getg</span><span class="op" id="1629320">(</span><span class="op" id="1629321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1629324">if</span>&nbsp;<span class="ident" id="1629327">gp</span><span class="op" id="1629329">.</span><span class="ident" id="1629330">m</span><span class="op" id="1629331">.</span><span class="ident" id="1629332">throwing</span>&nbsp;<span class="op" id="1629341">==</span>&nbsp;<span class="num" id="1629344">0</span>&nbsp;<span class="op" id="1629346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629350">gp</span><span class="op" id="1629352">.</span><span class="ident" id="1629353">m</span><span class="op" id="1629354">.</span><span class="ident" id="1629355">throwing</span>&nbsp;<span class="op" id="1629364">=</span>&nbsp;<span class="num" id="1629366">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1629369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629372">startpanic</span><span class="op" id="1629382">(</span><span class="op" id="1629383">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1629386">print</span><span class="op" id="1629391">(</span><span class="string" id="1629392">&#34;fatal&nbsp;error:&nbsp;&#34;</span><span class="op" id="1629407">,</span>&nbsp;<span class="ident" id="1629409">gostringnocopy</span><span class="op" id="1629423">(</span><span class="ident" id="1629424">s</span><span class="op" id="1629425">)</span><span class="op" id="1629426">,</span>&nbsp;<span class="string" id="1629428">&#34;\n&#34;</span><span class="op" id="1629432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629435">dopanic</span><span class="op" id="1629442">(</span><span class="num" id="1629443">0</span><span class="op" id="1629444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1629447">*</span><span class="op" id="1629448">(</span><span class="op" id="1629449">*</span><span class="builtintype" id="1629450">int</span><span class="op" id="1629453">)</span><span class="op" id="1629454">(</span><span class="builtintype" id="1629455">nil</span><span class="op" id="1629458">)</span>&nbsp;<span class="op" id="1629460">=</span>&nbsp;<span class="num" id="1629462">0</span>&nbsp;<span class="comment" id="1629464">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno"></span><span class="op" id="1629479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="1629482">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1629495">func</span>&nbsp;<span class="ident" id="1629500">gothrow</span><span class="op" id="1629507">(</span><span class="ident" id="1629508">s</span>&nbsp;<span class="builtintype" id="1629510">string</span><span class="op" id="1629516">)</span>&nbsp;<span class="op" id="1629518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629521">gp</span>&nbsp;<span class="op" id="1629524">:=</span>&nbsp;<span class="ident" id="1629527">getg</span><span class="op" id="1629531">(</span><span class="op" id="1629532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1629535">if</span>&nbsp;<span class="ident" id="1629538">gp</span><span class="op" id="1629540">.</span><span class="ident" id="1629541">m</span><span class="op" id="1629542">.</span><span class="ident" id="1629543">throwing</span>&nbsp;<span class="op" id="1629552">==</span>&nbsp;<span class="num" id="1629555">0</span>&nbsp;<span class="op" id="1629557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629561">gp</span><span class="op" id="1629563">.</span><span class="ident" id="1629564">m</span><span class="op" id="1629565">.</span><span class="ident" id="1629566">throwing</span>&nbsp;<span class="op" id="1629575">=</span>&nbsp;<span class="num" id="1629577">1</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1629580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629583">startpanic</span><span class="op" id="1629593">(</span><span class="op" id="1629594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1629597">print</span><span class="op" id="1629602">(</span><span class="string" id="1629603">&#34;fatal&nbsp;error:&nbsp;&#34;</span><span class="op" id="1629618">,</span>&nbsp;<span class="ident" id="1629620">s</span><span class="op" id="1629621">,</span>&nbsp;<span class="string" id="1629623">&#34;\n&#34;</span><span class="op" id="1629627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1629630">dopanic</span><span class="op" id="1629637">(</span><span class="num" id="1629638">0</span><span class="op" id="1629639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1629642">*</span><span class="op" id="1629643">(</span><span class="op" id="1629644">*</span><span class="builtintype" id="1629645">int</span><span class="op" id="1629648">)</span><span class="op" id="1629649">(</span><span class="builtintype" id="1629650">nil</span><span class="op" id="1629653">)</span>&nbsp;<span class="op" id="1629655">=</span>&nbsp;<span class="num" id="1629657">0</span>&nbsp;<span class="comment" id="1629659">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno">505</span><span class="op" id="1629674">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
