<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="8569609">package</span>&nbsp;<span class="ident" id="8569617">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8569624">import</span>&nbsp;<span class="op" id="8569631">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8569634">&#34;testing&#34;</span><br>
<span class="lineno">5</span><span class="op" id="8569644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8569647">func</span>&nbsp;<span class="ident" id="8569652">TestInstBr</span><span class="op" id="8569662">(</span><span class="ident" id="8569663">t</span>&nbsp;<span class="op" id="8569665">*</span><span class="ident" id="8569666">testing</span><span class="op" id="8569673">.</span><span class="ident" id="8569674">T</span><span class="op" id="8569675">)</span>&nbsp;<span class="op" id="8569677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569680">m</span>&nbsp;<span class="op" id="8569682">:=</span>&nbsp;<span class="ident" id="8569685">newPhyMemory</span><span class="op" id="8569697">(</span><span class="ident" id="8569698">PageSize</span>&nbsp;<span class="op" id="8569707">*</span>&nbsp;<span class="num" id="8569709">16</span><span class="op" id="8569711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569714">cpu</span>&nbsp;<span class="op" id="8569718">:=</span>&nbsp;<span class="ident" id="8569721">newCPU</span><span class="op" id="8569727">(</span><span class="ident" id="8569728">m</span><span class="op" id="8569729">,</span>&nbsp;<span class="builtinfunc" id="8569731">new</span><span class="op" id="8569734">(</span><span class="ident" id="8569735">instBr</span><span class="op" id="8569741">)</span><span class="op" id="8569742">,</span>&nbsp;<span class="num" id="8569744">0</span><span class="op" id="8569745">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8569749">for</span>&nbsp;<span class="ident" id="8569753">i</span>&nbsp;<span class="op" id="8569755">:=</span>&nbsp;<span class="num" id="8569758">0</span><span class="op" id="8569759">;</span>&nbsp;<span class="ident" id="8569761">i</span>&nbsp;<span class="op" id="8569763">&lt;</span>&nbsp;<span class="num" id="8569765">4</span><span class="op" id="8569766">;</span>&nbsp;<span class="ident" id="8569768">i</span><span class="op" id="8569769">++</span>&nbsp;<span class="op" id="8569772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569776">cpu</span><span class="op" id="8569779">.</span><span class="ident" id="8569780">regs</span><span class="op" id="8569784">[</span><span class="ident" id="8569785">i</span><span class="op" id="8569786">]</span>&nbsp;<span class="op" id="8569788">=</span>&nbsp;<span class="builtintype" id="8569790">uint32</span><span class="op" id="8569796">(</span><span class="ident" id="8569797">i</span><span class="op" id="8569798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8569801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569805">bne</span>&nbsp;<span class="op" id="8569809">:=</span>&nbsp;<span class="keyword" id="8569812">func</span><span class="op" id="8569816">(</span><span class="ident" id="8569817">s1</span><span class="op" id="8569819">,</span>&nbsp;<span class="ident" id="8569821">s2</span>&nbsp;<span class="builtintype" id="8569824">uint32</span><span class="op" id="8569830">,</span>&nbsp;<span class="ident" id="8569832">off</span>&nbsp;<span class="builtintype" id="8569836">int32</span><span class="op" id="8569841">)</span>&nbsp;<span class="builtintype" id="8569843">uint32</span>&nbsp;<span class="op" id="8569850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569854">in</span>&nbsp;<span class="op" id="8569857">:=</span>&nbsp;<span class="builtintype" id="8569860">uint32</span><span class="op" id="8569866">(</span><span class="num" id="8569867">32</span><span class="op" id="8569869">)</span>&nbsp;<span class="op" id="8569871">&lt;&lt;</span>&nbsp;<span class="num" id="8569874">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569879">in</span>&nbsp;<span class="op" id="8569882">|=</span>&nbsp;<span class="op" id="8569885">(</span><span class="ident" id="8569886">s1</span>&nbsp;<span class="op" id="8569889">&amp;</span>&nbsp;<span class="num" id="8569891">0x7</span><span class="op" id="8569894">)</span>&nbsp;<span class="op" id="8569896">&lt;&lt;</span>&nbsp;<span class="num" id="8569899">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569904">in</span>&nbsp;<span class="op" id="8569907">|=</span>&nbsp;<span class="op" id="8569910">(</span><span class="ident" id="8569911">s2</span>&nbsp;<span class="op" id="8569914">&amp;</span>&nbsp;<span class="num" id="8569916">0x7</span><span class="op" id="8569919">)</span>&nbsp;<span class="op" id="8569921">&lt;&lt;</span>&nbsp;<span class="num" id="8569924">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569929">in</span>&nbsp;<span class="op" id="8569932">|=</span>&nbsp;<span class="builtintype" id="8569935">uint32</span><span class="op" id="8569941">(</span><span class="ident" id="8569942">off</span><span class="op" id="8569945">)</span>&nbsp;<span class="op" id="8569947">&amp;</span>&nbsp;<span class="num" id="8569949">0x3ffff</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8569959">return</span>&nbsp;<span class="ident" id="8569966">in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8569970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569974">beq</span>&nbsp;<span class="op" id="8569978">:=</span>&nbsp;<span class="keyword" id="8569981">func</span><span class="op" id="8569985">(</span><span class="ident" id="8569986">s1</span><span class="op" id="8569988">,</span>&nbsp;<span class="ident" id="8569990">s2</span>&nbsp;<span class="builtintype" id="8569993">uint32</span><span class="op" id="8569999">,</span>&nbsp;<span class="ident" id="8570001">off</span>&nbsp;<span class="builtintype" id="8570005">int32</span><span class="op" id="8570010">)</span>&nbsp;<span class="builtintype" id="8570012">uint32</span>&nbsp;<span class="op" id="8570019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570023">in</span>&nbsp;<span class="op" id="8570026">:=</span>&nbsp;<span class="builtintype" id="8570029">uint32</span><span class="op" id="8570035">(</span><span class="num" id="8570036">33</span><span class="op" id="8570038">)</span>&nbsp;<span class="op" id="8570040">&lt;&lt;</span>&nbsp;<span class="num" id="8570043">24</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570048">in</span>&nbsp;<span class="op" id="8570051">|=</span>&nbsp;<span class="op" id="8570054">(</span><span class="ident" id="8570055">s1</span>&nbsp;<span class="op" id="8570058">&amp;</span>&nbsp;<span class="num" id="8570060">0x7</span><span class="op" id="8570063">)</span>&nbsp;<span class="op" id="8570065">&lt;&lt;</span>&nbsp;<span class="num" id="8570068">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570073">in</span>&nbsp;<span class="op" id="8570076">|=</span>&nbsp;<span class="op" id="8570079">(</span><span class="ident" id="8570080">s2</span>&nbsp;<span class="op" id="8570083">&amp;</span>&nbsp;<span class="num" id="8570085">0x7</span><span class="op" id="8570088">)</span>&nbsp;<span class="op" id="8570090">&lt;&lt;</span>&nbsp;<span class="num" id="8570093">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570098">in</span>&nbsp;<span class="op" id="8570101">|=</span>&nbsp;<span class="builtintype" id="8570104">uint32</span><span class="op" id="8570110">(</span><span class="ident" id="8570111">off</span><span class="op" id="8570114">)</span>&nbsp;<span class="op" id="8570116">&amp;</span>&nbsp;<span class="num" id="8570118">0x3ffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8570128">return</span>&nbsp;<span class="ident" id="8570135">in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8570139">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570143">wr</span>&nbsp;<span class="op" id="8570146">:=</span>&nbsp;<span class="keyword" id="8570149">func</span><span class="op" id="8570153">(</span><span class="ident" id="8570154">addr</span><span class="op" id="8570158">,</span>&nbsp;<span class="ident" id="8570160">w</span>&nbsp;<span class="builtintype" id="8570162">uint32</span><span class="op" id="8570168">)</span>&nbsp;<span class="op" id="8570170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570174">e</span>&nbsp;<span class="op" id="8570176">:=</span>&nbsp;<span class="ident" id="8570179">m</span><span class="op" id="8570180">.</span><span class="ident" id="8570181">WriteWord</span><span class="op" id="8570190">(</span><span class="ident" id="8570191">addr</span><span class="op" id="8570195">,</span>&nbsp;<span class="ident" id="8570197">w</span><span class="op" id="8570198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8570202">if</span>&nbsp;<span class="ident" id="8570205">e</span>&nbsp;<span class="op" id="8570207">!=</span>&nbsp;<span class="ident" id="8570210">nil</span>&nbsp;<span class="op" id="8570214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570219">t</span><span class="op" id="8570220">.</span><span class="ident" id="8570221">Fatal</span><span class="op" id="8570226">(</span><span class="ident" id="8570227">e</span><span class="op" id="8570228">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8570232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8570235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570239">wr</span><span class="op" id="8570241">(</span><span class="ident" id="8570242">InitPC</span><span class="op" id="8570248">,</span>&nbsp;<span class="ident" id="8570250">beq</span><span class="op" id="8570253">(</span><span class="num" id="8570254">0</span><span class="op" id="8570255">,</span>&nbsp;<span class="num" id="8570257">0</span><span class="op" id="8570258">,</span>&nbsp;<span class="num" id="8570260">1</span><span class="op" id="8570261">)</span><span class="op" id="8570262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570265">wr</span><span class="op" id="8570267">(</span><span class="ident" id="8570268">InitPC</span><span class="op" id="8570274">+</span><span class="num" id="8570275">4</span><span class="op" id="8570276">,</span>&nbsp;<span class="ident" id="8570278">beq</span><span class="op" id="8570281">(</span><span class="num" id="8570282">3</span><span class="op" id="8570283">,</span>&nbsp;<span class="num" id="8570285">3</span><span class="op" id="8570286">,</span>&nbsp;<span class="op" id="8570288">-</span><span class="num" id="8570289">1</span><span class="op" id="8570290">)</span><span class="op" id="8570291">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570294">wr</span><span class="op" id="8570296">(</span><span class="ident" id="8570297">InitPC</span><span class="op" id="8570303">+</span><span class="num" id="8570304">8</span><span class="op" id="8570305">,</span>&nbsp;<span class="ident" id="8570307">bne</span><span class="op" id="8570310">(</span><span class="num" id="8570311">1</span><span class="op" id="8570312">,</span>&nbsp;<span class="num" id="8570314">2</span><span class="op" id="8570315">,</span>&nbsp;<span class="op" id="8570317">-</span><span class="num" id="8570318">2</span><span class="op" id="8570319">)</span><span class="op" id="8570320">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570324">tick</span>&nbsp;<span class="op" id="8570329">:=</span>&nbsp;<span class="keyword" id="8570332">func</span><span class="op" id="8570336">(</span><span class="ident" id="8570337">exp</span>&nbsp;<span class="builtintype" id="8570341">uint32</span><span class="op" id="8570347">)</span>&nbsp;<span class="op" id="8570349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570353">e</span>&nbsp;<span class="op" id="8570355">:=</span>&nbsp;<span class="ident" id="8570358">cpu</span><span class="op" id="8570361">.</span><span class="ident" id="8570362">Tick</span><span class="op" id="8570366">(</span><span class="op" id="8570367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8570371">if</span>&nbsp;<span class="ident" id="8570374">e</span>&nbsp;<span class="op" id="8570376">!=</span>&nbsp;<span class="ident" id="8570379">nil</span>&nbsp;<span class="op" id="8570383">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570388">t</span><span class="op" id="8570389">.</span><span class="ident" id="8570390">Fatal</span><span class="op" id="8570395">(</span><span class="string" id="8570396">&#34;unexpected&nbsp;exception&#34;</span><span class="op" id="8570418">,</span>&nbsp;<span class="ident" id="8570420">e</span><span class="op" id="8570421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8570425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570430">pc</span>&nbsp;<span class="op" id="8570433">:=</span>&nbsp;<span class="ident" id="8570436">cpu</span><span class="op" id="8570439">.</span><span class="ident" id="8570440">regs</span><span class="op" id="8570444">[</span><span class="ident" id="8570445">PC</span><span class="op" id="8570447">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8570451">if</span>&nbsp;<span class="ident" id="8570454">pc</span>&nbsp;<span class="op" id="8570457">!=</span>&nbsp;<span class="ident" id="8570460">exp</span>&nbsp;<span class="op" id="8570464">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570469">t</span><span class="op" id="8570470">.</span><span class="ident" id="8570471">Fatalf</span><span class="op" id="8570477">(</span><span class="string" id="8570478">&#34;expect&nbsp;pc&nbsp;0x%08x,&nbsp;got&nbsp;0x%08x&#34;</span><span class="op" id="8570508">,</span>&nbsp;<span class="ident" id="8570510">exp</span><span class="op" id="8570513">,</span>&nbsp;<span class="ident" id="8570515">pc</span><span class="op" id="8570517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8570521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8570524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570528">tick</span><span class="op" id="8570532">(</span><span class="ident" id="8570533">InitPC</span>&nbsp;<span class="op" id="8570540">+</span>&nbsp;<span class="num" id="8570542">8</span><span class="op" id="8570543">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570546">tick</span><span class="op" id="8570550">(</span><span class="ident" id="8570551">InitPC</span>&nbsp;<span class="op" id="8570558">+</span>&nbsp;<span class="num" id="8570560">4</span><span class="op" id="8570561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570564">tick</span><span class="op" id="8570568">(</span><span class="ident" id="8570569">InitPC</span>&nbsp;<span class="op" id="8570576">+</span>&nbsp;<span class="num" id="8570578">4</span><span class="op" id="8570579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8570582">tick</span><span class="op" id="8570586">(</span><span class="ident" id="8570587">InitPC</span>&nbsp;<span class="op" id="8570594">+</span>&nbsp;<span class="num" id="8570596">4</span><span class="op" id="8570597">)</span><br>
<span class="lineno"></span><span class="op" id="8570599">}</span>
</div>
</body>
</html>
