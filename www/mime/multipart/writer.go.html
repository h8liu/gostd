<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3979168">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3979223">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3979277">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3979328">package</span>&nbsp;<span class="ident" id="3979336">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3979347">import</span>&nbsp;<span class="op" id="3979354">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3979357">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3979366">&#34;crypto/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3979381">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3979391">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3979398">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3979404">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3979421">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3979431">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3979434">//&nbsp;A&nbsp;Writer&nbsp;generates&nbsp;multipart&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="3979476">type</span>&nbsp;<span class="ident" id="3979481">Writer</span>&nbsp;<span class="keyword" id="3979488">struct</span>&nbsp;<span class="op" id="3979495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979498">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3979507"><a href="/mime/multipart/writer.go.html#3979398">io</a></span><span class="op" id="3979509">.</span><span class="ident" id="3979510">Writer</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979518">boundary</span>&nbsp;<span class="builtintype" id="3979527">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979535">lastpart</span>&nbsp;<span class="op" id="3979544">*</span><span class="ident" id="3979545"><a href="/mime/multipart/writer.go.html#3983457">part</a></span><br>
<span class="lineno"></span><span class="op" id="3979550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3979553">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;multipart&nbsp;Writer&nbsp;with&nbsp;a&nbsp;random&nbsp;boundary,</span><br>
<span class="lineno">25</span><span class="comment" id="3979621">//&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3979638">func</span>&nbsp;<span class="ident" id="3979643">NewWriter</span><span class="op" id="3979652">(</span><span class="ident" id="3979653">w</span>&nbsp;<span class="ident" id="3979655"><a href="/mime/multipart/writer.go.html#3979398">io</a></span><span class="op" id="3979657">.</span><span class="ident" id="3979658">Writer</span><span class="op" id="3979664">)</span>&nbsp;<span class="op" id="3979666">*</span><span class="ident" id="3979667"><a href="/mime/multipart/writer.go.html#3979481">Writer</a></span>&nbsp;<span class="op" id="3979674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979677">return</span>&nbsp;<span class="op" id="3979684">&amp;</span><span class="ident" id="3979685"><a href="/mime/multipart/writer.go.html#3979481">Writer</a></span><span class="op" id="3979691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979695">w</span><span class="op" id="3979696">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3979705"><a href="/mime/multipart/writer.go.html#3979653">w</a></span><span class="op" id="3979706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3979710">boundary</span><span class="op" id="3979718">:</span>&nbsp;<span class="ident" id="3979720"><a href="/mime/multipart/writer.go.html#3980902">randomBoundary</a></span><span class="op" id="3979734">(</span><span class="op" id="3979735">)</span><span class="op" id="3979736">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3979739">}</span><br>
<span class="lineno"></span><span class="op" id="3979741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3979744">//&nbsp;Boundary&nbsp;returns&nbsp;the&nbsp;Writer&#39;s&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="3979787">func</span>&nbsp;<span class="op" id="3979792">(</span><span class="ident" id="3979793">w</span>&nbsp;<span class="op" id="3979795">*</span><span class="ident" id="3979796"><a href="/mime/multipart/writer.go.html#3979481">Writer</a></span><span class="op" id="3979802">)</span>&nbsp;<span class="ident" id="3979804">Boundary</span><span class="op" id="3979812">(</span><span class="op" id="3979813">)</span>&nbsp;<span class="builtintype" id="3979815">string</span>&nbsp;<span class="op" id="3979822">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3979825">return</span>&nbsp;<span class="ident" id="3979832"><a href="/mime/multipart/writer.go.html#3979793">w</a></span><span class="op" id="3979833">.</span><span class="ident" id="3979834">boundary</span><br>
<span class="lineno"></span><span class="op" id="3979843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3979846">//&nbsp;SetBoundary&nbsp;overrides&nbsp;the&nbsp;Writer&#39;s&nbsp;default&nbsp;randomly-generated</span><br>
<span class="lineno"></span><span class="comment" id="3979911">//&nbsp;boundary&nbsp;separator&nbsp;with&nbsp;an&nbsp;explicit&nbsp;value.</span><br>
<span class="lineno">40</span><span class="comment" id="3979957">//</span><br>
<span class="lineno"></span><span class="comment" id="3979960">//&nbsp;SetBoundary&nbsp;must&nbsp;be&nbsp;called&nbsp;before&nbsp;any&nbsp;parts&nbsp;are&nbsp;created,&nbsp;may&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="3980029">//&nbsp;contain&nbsp;certain&nbsp;ASCII&nbsp;characters,&nbsp;and&nbsp;must&nbsp;be&nbsp;1-69&nbsp;bytes&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="3980095">func</span>&nbsp;<span class="op" id="3980100">(</span><span class="ident" id="3980101">w</span>&nbsp;<span class="op" id="3980103">*</span><span class="ident" id="3980104"><a href="/mime/multipart/writer.go.html#3979481">Writer</a></span><span class="op" id="3980110">)</span>&nbsp;<span class="ident" id="3980112">SetBoundary</span><span class="op" id="3980123">(</span><span class="ident" id="3980124">boundary</span>&nbsp;<span class="builtintype" id="3980133">string</span><span class="op" id="3980139">)</span>&nbsp;<span class="builtintype" id="3980141">error</span>&nbsp;<span class="op" id="3980147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980150">if</span>&nbsp;<span class="ident" id="3980153"><a href="/mime/multipart/writer.go.html#3980101">w</a></span><span class="op" id="3980154">.</span><span class="ident" id="3980155">lastpart</span>&nbsp;<span class="op" id="3980164">!=</span>&nbsp;<span class="ident" id="3980167">nil</span>&nbsp;<span class="op" id="3980171">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980175">return</span>&nbsp;<span class="ident" id="3980182"><a href="/mime/multipart/writer.go.html#3979381">errors</a></span><span class="op" id="3980188">.</span><span class="ident" id="3980189">New</span><span class="op" id="3980192">(</span><span class="string" id="3980193">&#34;mime:&nbsp;SetBoundary&nbsp;called&nbsp;after&nbsp;write&#34;</span><span class="op" id="3980231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3980234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3980237">//&nbsp;rfc2046#section-5.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980263">if</span>&nbsp;<span class="builtinfunc" id="3980266">len</span><span class="op" id="3980269">(</span><span class="ident" id="3980270"><a href="/mime/multipart/writer.go.html#3980124">boundary</a></span><span class="op" id="3980278">)</span>&nbsp;<span class="op" id="3980280">&lt;</span>&nbsp;<span class="num" id="3980282">1</span>&nbsp;<span class="op" id="3980284">||</span>&nbsp;<span class="builtinfunc" id="3980287">len</span><span class="op" id="3980290">(</span><span class="ident" id="3980291"><a href="/mime/multipart/writer.go.html#3980124">boundary</a></span><span class="op" id="3980299">)</span>&nbsp;<span class="op" id="3980301">&gt;</span>&nbsp;<span class="num" id="3980303">69</span>&nbsp;<span class="op" id="3980306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980310">return</span>&nbsp;<span class="ident" id="3980317"><a href="/mime/multipart/writer.go.html#3979381">errors</a></span><span class="op" id="3980323">.</span><span class="ident" id="3980324">New</span><span class="op" id="3980327">(</span><span class="string" id="3980328">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;length&#34;</span><span class="op" id="3980359">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3980362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980365">for</span>&nbsp;<span class="ident" id="3980369">_</span><span class="op" id="3980370">,</span>&nbsp;<span class="ident" id="3980372">b</span>&nbsp;<span class="op" id="3980374">:=</span>&nbsp;<span class="keyword" id="3980377">range</span>&nbsp;<span class="ident" id="3980383"><a href="/mime/multipart/writer.go.html#3980124">boundary</a></span>&nbsp;<span class="op" id="3980392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980396">if</span>&nbsp;<span class="string" id="3980399">&#39;A&#39;</span>&nbsp;<span class="op" id="3980403">&lt;=</span>&nbsp;<span class="ident" id="3980406"><a href="/mime/multipart/writer.go.html#3980372">b</a></span>&nbsp;<span class="op" id="3980408">&amp;&amp;</span>&nbsp;<span class="ident" id="3980411"><a href="/mime/multipart/writer.go.html#3980372">b</a></span>&nbsp;<span class="op" id="3980413">&lt;=</span>&nbsp;<span class="string" id="3980416">&#39;Z&#39;</span>&nbsp;<span class="op" id="3980420">||</span>&nbsp;<span class="string" id="3980423">&#39;a&#39;</span>&nbsp;<span class="op" id="3980427">&lt;=</span>&nbsp;<span class="ident" id="3980430"><a href="/mime/multipart/writer.go.html#3980372">b</a></span>&nbsp;<span class="op" id="3980432">&amp;&amp;</span>&nbsp;<span class="ident" id="3980435"><a href="/mime/multipart/writer.go.html#3980372">b</a></span>&nbsp;<span class="op" id="3980437">&lt;=</span>&nbsp;<span class="string" id="3980440">&#39;z&#39;</span>&nbsp;<span class="op" id="3980444">||</span>&nbsp;<span class="string" id="3980447">&#39;0&#39;</span>&nbsp;<span class="op" id="3980451">&lt;=</span>&nbsp;<span class="ident" id="3980454"><a href="/mime/multipart/writer.go.html#3980372">b</a></span>&nbsp;<span class="op" id="3980456">&amp;&amp;</span>&nbsp;<span class="ident" id="3980459"><a href="/mime/multipart/writer.go.html#3980372">b</a></span>&nbsp;<span class="op" id="3980461">&lt;=</span>&nbsp;<span class="string" id="3980464">&#39;9&#39;</span>&nbsp;<span class="op" id="3980468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980473">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3980484">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980488">switch</span>&nbsp;<span class="ident" id="3980495"><a href="/mime/multipart/writer.go.html#3980372">b</a></span>&nbsp;<span class="op" id="3980497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980501">case</span>&nbsp;<span class="string" id="3980506">&#39;\&#39;&#39;</span><span class="op" id="3980510">,</span>&nbsp;<span class="string" id="3980512">&#39;(&#39;</span><span class="op" id="3980515">,</span>&nbsp;<span class="string" id="3980517">&#39;)&#39;</span><span class="op" id="3980520">,</span>&nbsp;<span class="string" id="3980522">&#39;+&#39;</span><span class="op" id="3980525">,</span>&nbsp;<span class="string" id="3980527">&#39;_&#39;</span><span class="op" id="3980530">,</span>&nbsp;<span class="string" id="3980532">&#39;,&#39;</span><span class="op" id="3980535">,</span>&nbsp;<span class="string" id="3980537">&#39;-&#39;</span><span class="op" id="3980540">,</span>&nbsp;<span class="string" id="3980542">&#39;.&#39;</span><span class="op" id="3980545">,</span>&nbsp;<span class="string" id="3980547">&#39;/&#39;</span><span class="op" id="3980550">,</span>&nbsp;<span class="string" id="3980552">&#39;:&#39;</span><span class="op" id="3980555">,</span>&nbsp;<span class="string" id="3980557">&#39;=&#39;</span><span class="op" id="3980560">,</span>&nbsp;<span class="string" id="3980562">&#39;?&#39;</span><span class="op" id="3980565">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980570">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3980581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980585">return</span>&nbsp;<span class="ident" id="3980592"><a href="/mime/multipart/writer.go.html#3979381">errors</a></span><span class="op" id="3980598">.</span><span class="ident" id="3980599">New</span><span class="op" id="3980602">(</span><span class="string" id="3980603">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;character&#34;</span><span class="op" id="3980637">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3980640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980643"><a href="/mime/multipart/writer.go.html#3980101">w</a></span><span class="op" id="3980644">.</span><span class="ident" id="3980645">boundary</span>&nbsp;<span class="op" id="3980654">=</span>&nbsp;<span class="ident" id="3980656"><a href="/mime/multipart/writer.go.html#3980124">boundary</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980666">return</span>&nbsp;<span class="ident" id="3980673">nil</span><br>
<span class="lineno"></span><span class="op" id="3980677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3980680">//&nbsp;FormDataContentType&nbsp;returns&nbsp;the&nbsp;Content-Type&nbsp;for&nbsp;an&nbsp;HTTP</span><br>
<span class="lineno"></span><span class="comment" id="3980740">//&nbsp;multipart/form-data&nbsp;with&nbsp;this&nbsp;Writer&#39;s&nbsp;Boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="3980792">func</span>&nbsp;<span class="op" id="3980797">(</span><span class="ident" id="3980798">w</span>&nbsp;<span class="op" id="3980800">*</span><span class="ident" id="3980801"><a href="/mime/multipart/writer.go.html#3979481">Writer</a></span><span class="op" id="3980807">)</span>&nbsp;<span class="ident" id="3980809">FormDataContentType</span><span class="op" id="3980828">(</span><span class="op" id="3980829">)</span>&nbsp;<span class="builtintype" id="3980831">string</span>&nbsp;<span class="op" id="3980838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980841">return</span>&nbsp;<span class="string" id="3980848">&#34;multipart/form-data;&nbsp;boundary=&#34;</span>&nbsp;<span class="op" id="3980881">+</span>&nbsp;<span class="ident" id="3980883"><a href="/mime/multipart/writer.go.html#3980798">w</a></span><span class="op" id="3980884">.</span><span class="ident" id="3980885">boundary</span><br>
<span class="lineno"></span><span class="op" id="3980894">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3980897">func</span>&nbsp;<span class="ident" id="3980902">randomBoundary</span><span class="op" id="3980916">(</span><span class="op" id="3980917">)</span>&nbsp;<span class="builtintype" id="3980919">string</span>&nbsp;<span class="op" id="3980926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980929">var</span>&nbsp;<span class="ident" id="3980933">buf</span>&nbsp;<span class="op" id="3980937">[</span><span class="num" id="3980938">30</span><span class="op" id="3980940">]</span><span class="builtintype" id="3980941">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3980947">_</span><span class="op" id="3980948">,</span>&nbsp;<span class="ident" id="3980950">err</span>&nbsp;<span class="op" id="3980954">:=</span>&nbsp;<span class="ident" id="3980957"><a href="/mime/multipart/writer.go.html#3979398">io</a></span><span class="op" id="3980959">.</span><span class="ident" id="3980960">ReadFull</span><span class="op" id="3980968">(</span><span class="ident" id="3980969"><a href="/mime/multipart/writer.go.html#3979366">rand</a></span><span class="op" id="3980973">.</span><span class="ident" id="3980974">Reader</span><span class="op" id="3980980">,</span>&nbsp;<span class="ident" id="3980982"><a href="/mime/multipart/writer.go.html#3980933">buf</a></span><span class="op" id="3980985">[</span><span class="op" id="3980986">:</span><span class="op" id="3980987">]</span><span class="op" id="3980988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3980991">if</span>&nbsp;<span class="ident" id="3980994"><a href="/mime/multipart/writer.go.html#3980950">err</a></span>&nbsp;<span class="op" id="3980998">!=</span>&nbsp;<span class="ident" id="3981001">nil</span>&nbsp;<span class="op" id="3981005">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3981009">panic</span><span class="op" id="3981014">(</span><span class="ident" id="3981015"><a href="/mime/multipart/writer.go.html#3980950">err</a></span><span class="op" id="3981018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981024">return</span>&nbsp;<span class="ident" id="3981031"><a href="/mime/multipart/writer.go.html#3979391">fmt</a></span><span class="op" id="3981034">.</span><span class="ident" id="3981035">Sprintf</span><span class="op" id="3981042">(</span><span class="string" id="3981043">&#34;%x&#34;</span><span class="op" id="3981047">,</span>&nbsp;<span class="ident" id="3981049"><a href="/mime/multipart/writer.go.html#3980933">buf</a></span><span class="op" id="3981052">[</span><span class="op" id="3981053">:</span><span class="op" id="3981054">]</span><span class="op" id="3981055">)</span><br>
<span class="lineno"></span><span class="op" id="3981057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3981060">//&nbsp;CreatePart&nbsp;creates&nbsp;a&nbsp;new&nbsp;multipart&nbsp;section&nbsp;with&nbsp;the&nbsp;provided</span><br>
<span class="lineno"></span><span class="comment" id="3981124">//&nbsp;header.&nbsp;The&nbsp;body&nbsp;of&nbsp;the&nbsp;part&nbsp;should&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="3981190">//&nbsp;Writer.&nbsp;After&nbsp;calling&nbsp;CreatePart,&nbsp;any&nbsp;previous&nbsp;part&nbsp;may&nbsp;no&nbsp;longer</span><br>
<span class="lineno"></span><span class="comment" id="3981259">//&nbsp;be&nbsp;written&nbsp;to.</span><br>
<span class="lineno"></span><span class="keyword" id="3981277">func</span>&nbsp;<span class="op" id="3981282">(</span><span class="ident" id="3981283">w</span>&nbsp;<span class="op" id="3981285">*</span><span class="ident" id="3981286"><a href="/mime/multipart/writer.go.html#3979481">Writer</a></span><span class="op" id="3981292">)</span>&nbsp;<span class="ident" id="3981294">CreatePart</span><span class="op" id="3981304">(</span><span class="ident" id="3981305">header</span>&nbsp;<span class="ident" id="3981312"><a href="/mime/multipart/writer.go.html#3979404">textproto</a></span><span class="op" id="3981321">.</span><span class="ident" id="3981322">MIMEHeader</span><span class="op" id="3981332">)</span>&nbsp;<span class="op" id="3981334">(</span><span class="ident" id="3981335"><a href="/mime/multipart/writer.go.html#3979398">io</a></span><span class="op" id="3981337">.</span><span class="ident" id="3981338">Writer</span><span class="op" id="3981344">,</span>&nbsp;<span class="builtintype" id="3981346">error</span><span class="op" id="3981351">)</span>&nbsp;<span class="op" id="3981353">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981356">if</span>&nbsp;<span class="ident" id="3981359"><a href="/mime/multipart/writer.go.html#3981283">w</a></span><span class="op" id="3981360">.</span><span class="ident" id="3981361">lastpart</span>&nbsp;<span class="op" id="3981370">!=</span>&nbsp;<span class="ident" id="3981373">nil</span>&nbsp;<span class="op" id="3981377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981381">if</span>&nbsp;<span class="ident" id="3981384">err</span>&nbsp;<span class="op" id="3981388">:=</span>&nbsp;<span class="ident" id="3981391"><a href="/mime/multipart/writer.go.html#3981283">w</a></span><span class="op" id="3981392">.</span><span class="ident" id="3981393">lastpart</span><span class="op" id="3981401">.</span><span class="builtinfunc" id="3981402">close</span><span class="op" id="3981407">(</span><span class="op" id="3981408">)</span><span class="op" id="3981409">;</span>&nbsp;<span class="ident" id="3981411"><a href="/mime/multipart/writer.go.html#3981384">err</a></span>&nbsp;<span class="op" id="3981415">!=</span>&nbsp;<span class="ident" id="3981418">nil</span>&nbsp;<span class="op" id="3981422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981427">return</span>&nbsp;<span class="ident" id="3981434">nil</span><span class="op" id="3981437">,</span>&nbsp;<span class="ident" id="3981439"><a href="/mime/multipart/writer.go.html#3981384">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981448">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981451">var</span>&nbsp;<span class="ident" id="3981455">b</span>&nbsp;<span class="ident" id="3981457"><a href="/mime/multipart/writer.go.html#3979357">bytes</a></span><span class="op" id="3981462">.</span><span class="ident" id="3981463">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981471">if</span>&nbsp;<span class="ident" id="3981474"><a href="/mime/multipart/writer.go.html#3981283">w</a></span><span class="op" id="3981475">.</span><span class="ident" id="3981476">lastpart</span>&nbsp;<span class="op" id="3981485">!=</span>&nbsp;<span class="ident" id="3981488">nil</span>&nbsp;<span class="op" id="3981492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981496"><a href="/mime/multipart/writer.go.html#3979391">fmt</a></span><span class="op" id="3981499">.</span><span class="ident" id="3981500">Fprintf</span><span class="op" id="3981507">(</span><span class="op" id="3981508">&amp;</span><span class="ident" id="3981509"><a href="/mime/multipart/writer.go.html#3981455">b</a></span><span class="op" id="3981510">,</span>&nbsp;<span class="string" id="3981512">&#34;\r\n--%s\r\n&#34;</span><span class="op" id="3981526">,</span>&nbsp;<span class="ident" id="3981528"><a href="/mime/multipart/writer.go.html#3981283">w</a></span><span class="op" id="3981529">.</span><span class="ident" id="3981530">boundary</span><span class="op" id="3981538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981541">}</span>&nbsp;<span class="keyword" id="3981543">else</span>&nbsp;<span class="op" id="3981548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981552"><a href="/mime/multipart/writer.go.html#3979391">fmt</a></span><span class="op" id="3981555">.</span><span class="ident" id="3981556">Fprintf</span><span class="op" id="3981563">(</span><span class="op" id="3981564">&amp;</span><span class="ident" id="3981565"><a href="/mime/multipart/writer.go.html#3981455">b</a></span><span class="op" id="3981566">,</span>&nbsp;<span class="string" id="3981568">&#34;--%s\r\n&#34;</span><span class="op" id="3981578">,</span>&nbsp;<span class="ident" id="3981580"><a href="/mime/multipart/writer.go.html#3981283">w</a></span><span class="op" id="3981581">.</span><span class="ident" id="3981582">boundary</span><span class="op" id="3981590">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981596">//&nbsp;TODO(bradfitz):&nbsp;move&nbsp;this&nbsp;to&nbsp;textproto.MimeHeader.Write(w),&nbsp;have&nbsp;it&nbsp;sort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3981673">//&nbsp;and&nbsp;clean,&nbsp;like&nbsp;http.Header.Write(w)&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981720">for</span>&nbsp;<span class="ident" id="3981724">k</span><span class="op" id="3981725">,</span>&nbsp;<span class="ident" id="3981727">vv</span>&nbsp;<span class="op" id="3981730">:=</span>&nbsp;<span class="keyword" id="3981733">range</span>&nbsp;<span class="ident" id="3981739"><a href="/mime/multipart/writer.go.html#3981305">header</a></span>&nbsp;<span class="op" id="3981746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981750">for</span>&nbsp;<span class="ident" id="3981754">_</span><span class="op" id="3981755">,</span>&nbsp;<span class="ident" id="3981757">v</span>&nbsp;<span class="op" id="3981759">:=</span>&nbsp;<span class="keyword" id="3981762">range</span>&nbsp;<span class="ident" id="3981768"><a href="/mime/multipart/writer.go.html#3981727">vv</a></span>&nbsp;<span class="op" id="3981771">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981776"><a href="/mime/multipart/writer.go.html#3979391">fmt</a></span><span class="op" id="3981779">.</span><span class="ident" id="3981780">Fprintf</span><span class="op" id="3981787">(</span><span class="op" id="3981788">&amp;</span><span class="ident" id="3981789"><a href="/mime/multipart/writer.go.html#3981455">b</a></span><span class="op" id="3981790">,</span>&nbsp;<span class="string" id="3981792">&#34;%s:&nbsp;%s\r\n&#34;</span><span class="op" id="3981804">,</span>&nbsp;<span class="ident" id="3981806"><a href="/mime/multipart/writer.go.html#3981724">k</a></span><span class="op" id="3981807">,</span>&nbsp;<span class="ident" id="3981809"><a href="/mime/multipart/writer.go.html#3981757">v</a></span><span class="op" id="3981810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981820"><a href="/mime/multipart/writer.go.html#3979391">fmt</a></span><span class="op" id="3981823">.</span><span class="ident" id="3981824">Fprintf</span><span class="op" id="3981831">(</span><span class="op" id="3981832">&amp;</span><span class="ident" id="3981833"><a href="/mime/multipart/writer.go.html#3981455">b</a></span><span class="op" id="3981834">,</span>&nbsp;<span class="string" id="3981836">&#34;\r\n&#34;</span><span class="op" id="3981842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981845">_</span><span class="op" id="3981846">,</span>&nbsp;<span class="ident" id="3981848">err</span>&nbsp;<span class="op" id="3981852">:=</span>&nbsp;<span class="ident" id="3981855"><a href="/mime/multipart/writer.go.html#3979398">io</a></span><span class="op" id="3981857">.</span><span class="ident" id="3981858">Copy</span><span class="op" id="3981862">(</span><span class="ident" id="3981863"><a href="/mime/multipart/writer.go.html#3981283">w</a></span><span class="op" id="3981864">.</span><span class="ident" id="3981865">w</span><span class="op" id="3981866">,</span>&nbsp;<span class="op" id="3981868">&amp;</span><span class="ident" id="3981869"><a href="/mime/multipart/writer.go.html#3981455">b</a></span><span class="op" id="3981870">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981873">if</span>&nbsp;<span class="ident" id="3981876"><a href="/mime/multipart/writer.go.html#3981848">err</a></span>&nbsp;<span class="op" id="3981880">!=</span>&nbsp;<span class="ident" id="3981883">nil</span>&nbsp;<span class="op" id="3981887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981891">return</span>&nbsp;<span class="ident" id="3981898">nil</span><span class="op" id="3981901">,</span>&nbsp;<span class="ident" id="3981903"><a href="/mime/multipart/writer.go.html#3981848">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981911">p</span>&nbsp;<span class="op" id="3981913">:=</span>&nbsp;<span class="op" id="3981916">&amp;</span><span class="ident" id="3981917"><a href="/mime/multipart/writer.go.html#3983457">part</a></span><span class="op" id="3981921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981925">mw</span><span class="op" id="3981927">:</span>&nbsp;<span class="ident" id="3981929"><a href="/mime/multipart/writer.go.html#3981283">w</a></span><span class="op" id="3981930">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3981933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3981936"><a href="/mime/multipart/writer.go.html#3981283">w</a></span><span class="op" id="3981937">.</span><span class="ident" id="3981938">lastpart</span>&nbsp;<span class="op" id="3981947">=</span>&nbsp;<span class="ident" id="3981949"><a href="/mime/multipart/writer.go.html#3981911">p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3981952">return</span>&nbsp;<span class="ident" id="3981959"><a href="/mime/multipart/writer.go.html#3981911">p</a></span><span class="op" id="3981960">,</span>&nbsp;<span class="ident" id="3981962">nil</span><br>
<span class="lineno"></span><span class="op" id="3981966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="3981969">var</span>&nbsp;<span class="ident" id="3981973">quoteEscaper</span>&nbsp;<span class="op" id="3981986">=</span>&nbsp;<span class="ident" id="3981988"><a href="/mime/multipart/writer.go.html#3979421">strings</a></span><span class="op" id="3981995">.</span><span class="ident" id="3981996">NewReplacer</span><span class="op" id="3982007">(</span><span class="string" id="3982008">&#34;\\&#34;</span><span class="op" id="3982012">,</span>&nbsp;<span class="string" id="3982014">&#34;\\\\&#34;</span><span class="op" id="3982020">,</span>&nbsp;<span class="string" id="3982022">`&#34;`</span><span class="op" id="3982025">,</span>&nbsp;<span class="string" id="3982027">&#34;\\\&#34;&#34;</span><span class="op" id="3982033">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3982036">func</span>&nbsp;<span class="ident" id="3982041">escapeQuotes</span><span class="op" id="3982053">(</span><span class="ident" id="3982054">s</span>&nbsp;<span class="builtintype" id="3982056">string</span><span class="op" id="3982062">)</span>&nbsp;<span class="builtintype" id="3982064">string</span>&nbsp;<span class="op" id="3982071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982074">return</span>&nbsp;<span class="ident" id="3982081"><a href="/mime/multipart/writer.go.html#3981973">quoteEscaper</a></span><span class="op" id="3982093">.</span><span class="ident" id="3982094">Replace</span><span class="op" id="3982101">(</span><span class="ident" id="3982102"><a href="/mime/multipart/writer.go.html#3982054">s</a></span><span class="op" id="3982103">)</span><br>
<span class="lineno"></span><span class="op" id="3982105">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="3982108">//&nbsp;CreateFormFile&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;around&nbsp;CreatePart.&nbsp;It&nbsp;creates</span><br>
<span class="lineno"></span><span class="comment" id="3982181">//&nbsp;a&nbsp;new&nbsp;form-data&nbsp;header&nbsp;with&nbsp;the&nbsp;provided&nbsp;field&nbsp;name&nbsp;and&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3982251">func</span>&nbsp;<span class="op" id="3982256">(</span><span class="ident" id="3982257">w</span>&nbsp;<span class="op" id="3982259">*</span><span class="ident" id="3982260"><a href="/mime/multipart/writer.go.html#3979481">Writer</a></span><span class="op" id="3982266">)</span>&nbsp;<span class="ident" id="3982268">CreateFormFile</span><span class="op" id="3982282">(</span><span class="ident" id="3982283">fieldname</span><span class="op" id="3982292">,</span>&nbsp;<span class="ident" id="3982294">filename</span>&nbsp;<span class="builtintype" id="3982303">string</span><span class="op" id="3982309">)</span>&nbsp;<span class="op" id="3982311">(</span><span class="ident" id="3982312"><a href="/mime/multipart/writer.go.html#3979398">io</a></span><span class="op" id="3982314">.</span><span class="ident" id="3982315">Writer</span><span class="op" id="3982321">,</span>&nbsp;<span class="builtintype" id="3982323">error</span><span class="op" id="3982328">)</span>&nbsp;<span class="op" id="3982330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982333">h</span>&nbsp;<span class="op" id="3982335">:=</span>&nbsp;<span class="builtinfunc" id="3982338">make</span><span class="op" id="3982342">(</span><span class="ident" id="3982343"><a href="/mime/multipart/writer.go.html#3979404">textproto</a></span><span class="op" id="3982352">.</span><span class="ident" id="3982353">MIMEHeader</span><span class="op" id="3982363">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982366"><a href="/mime/multipart/writer.go.html#3982333">h</a></span><span class="op" id="3982367">.</span><span class="ident" id="3982368">Set</span><span class="op" id="3982371">(</span><span class="string" id="3982372">&#34;Content-Disposition&#34;</span><span class="op" id="3982393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982397"><a href="/mime/multipart/writer.go.html#3979391">fmt</a></span><span class="op" id="3982400">.</span><span class="ident" id="3982401">Sprintf</span><span class="op" id="3982408">(</span><span class="string" id="3982409">`form-data;&nbsp;name=&#34;%s&#34;;&nbsp;filename=&#34;%s&#34;`</span><span class="op" id="3982446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982451"><a href="/mime/multipart/writer.go.html#3982041">escapeQuotes</a></span><span class="op" id="3982463">(</span><span class="ident" id="3982464"><a href="/mime/multipart/writer.go.html#3982283">fieldname</a></span><span class="op" id="3982473">)</span><span class="op" id="3982474">,</span>&nbsp;<span class="ident" id="3982476"><a href="/mime/multipart/writer.go.html#3982041">escapeQuotes</a></span><span class="op" id="3982488">(</span><span class="ident" id="3982489"><a href="/mime/multipart/writer.go.html#3982294">filename</a></span><span class="op" id="3982497">)</span><span class="op" id="3982498">)</span><span class="op" id="3982499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982502"><a href="/mime/multipart/writer.go.html#3982333">h</a></span><span class="op" id="3982503">.</span><span class="ident" id="3982504">Set</span><span class="op" id="3982507">(</span><span class="string" id="3982508">&#34;Content-Type&#34;</span><span class="op" id="3982522">,</span>&nbsp;<span class="string" id="3982524">&#34;application/octet-stream&#34;</span><span class="op" id="3982550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982553">return</span>&nbsp;<span class="ident" id="3982560"><a href="/mime/multipart/writer.go.html#3982257">w</a></span><span class="op" id="3982561">.</span><span class="ident" id="3982562">CreatePart</span><span class="op" id="3982572">(</span><span class="ident" id="3982573"><a href="/mime/multipart/writer.go.html#3982333">h</a></span><span class="op" id="3982574">)</span><br>
<span class="lineno">130</span><span class="op" id="3982576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3982579">//&nbsp;CreateFormField&nbsp;calls&nbsp;CreatePart&nbsp;with&nbsp;a&nbsp;header&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3982639">//&nbsp;given&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3982660">func</span>&nbsp;<span class="op" id="3982665">(</span><span class="ident" id="3982666">w</span>&nbsp;<span class="op" id="3982668">*</span><span class="ident" id="3982669"><a href="/mime/multipart/writer.go.html#3979481">Writer</a></span><span class="op" id="3982675">)</span>&nbsp;<span class="ident" id="3982677">CreateFormField</span><span class="op" id="3982692">(</span><span class="ident" id="3982693">fieldname</span>&nbsp;<span class="builtintype" id="3982703">string</span><span class="op" id="3982709">)</span>&nbsp;<span class="op" id="3982711">(</span><span class="ident" id="3982712"><a href="/mime/multipart/writer.go.html#3979398">io</a></span><span class="op" id="3982714">.</span><span class="ident" id="3982715">Writer</span><span class="op" id="3982721">,</span>&nbsp;<span class="builtintype" id="3982723">error</span><span class="op" id="3982728">)</span>&nbsp;<span class="op" id="3982730">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982733">h</span>&nbsp;<span class="op" id="3982735">:=</span>&nbsp;<span class="builtinfunc" id="3982738">make</span><span class="op" id="3982742">(</span><span class="ident" id="3982743"><a href="/mime/multipart/writer.go.html#3979404">textproto</a></span><span class="op" id="3982752">.</span><span class="ident" id="3982753">MIMEHeader</span><span class="op" id="3982763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982766"><a href="/mime/multipart/writer.go.html#3982733">h</a></span><span class="op" id="3982767">.</span><span class="ident" id="3982768">Set</span><span class="op" id="3982771">(</span><span class="string" id="3982772">&#34;Content-Disposition&#34;</span><span class="op" id="3982793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3982797"><a href="/mime/multipart/writer.go.html#3979391">fmt</a></span><span class="op" id="3982800">.</span><span class="ident" id="3982801">Sprintf</span><span class="op" id="3982808">(</span><span class="string" id="3982809">`form-data;&nbsp;name=&#34;%s&#34;`</span><span class="op" id="3982831">,</span>&nbsp;<span class="ident" id="3982833"><a href="/mime/multipart/writer.go.html#3982041">escapeQuotes</a></span><span class="op" id="3982845">(</span><span class="ident" id="3982846"><a href="/mime/multipart/writer.go.html#3982693">fieldname</a></span><span class="op" id="3982855">)</span><span class="op" id="3982856">)</span><span class="op" id="3982857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3982860">return</span>&nbsp;<span class="ident" id="3982867"><a href="/mime/multipart/writer.go.html#3982666">w</a></span><span class="op" id="3982868">.</span><span class="ident" id="3982869">CreatePart</span><span class="op" id="3982879">(</span><span class="ident" id="3982880"><a href="/mime/multipart/writer.go.html#3982733">h</a></span><span class="op" id="3982881">)</span><br>
<span class="lineno"></span><span class="op" id="3982883">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="3982886">//&nbsp;WriteField&nbsp;calls&nbsp;CreateFormField&nbsp;and&nbsp;then&nbsp;writes&nbsp;the&nbsp;given&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3982955">func</span>&nbsp;<span class="op" id="3982960">(</span><span class="ident" id="3982961">w</span>&nbsp;<span class="op" id="3982963">*</span><span class="ident" id="3982964"><a href="/mime/multipart/writer.go.html#3979481">Writer</a></span><span class="op" id="3982970">)</span>&nbsp;<span class="ident" id="3982972">WriteField</span><span class="op" id="3982982">(</span><span class="ident" id="3982983">fieldname</span><span class="op" id="3982992">,</span>&nbsp;<span class="ident" id="3982994">value</span>&nbsp;<span class="builtintype" id="3983000">string</span><span class="op" id="3983006">)</span>&nbsp;<span class="builtintype" id="3983008">error</span>&nbsp;<span class="op" id="3983014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983017">p</span><span class="op" id="3983018">,</span>&nbsp;<span class="ident" id="3983020">err</span>&nbsp;<span class="op" id="3983024">:=</span>&nbsp;<span class="ident" id="3983027"><a href="/mime/multipart/writer.go.html#3982961">w</a></span><span class="op" id="3983028">.</span><span class="ident" id="3983029">CreateFormField</span><span class="op" id="3983044">(</span><span class="ident" id="3983045"><a href="/mime/multipart/writer.go.html#3982983">fieldname</a></span><span class="op" id="3983054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983057">if</span>&nbsp;<span class="ident" id="3983060"><a href="/mime/multipart/writer.go.html#3983020">err</a></span>&nbsp;<span class="op" id="3983064">!=</span>&nbsp;<span class="ident" id="3983067">nil</span>&nbsp;<span class="op" id="3983071">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983075">return</span>&nbsp;<span class="ident" id="3983082"><a href="/mime/multipart/writer.go.html#3983020">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983090">_</span><span class="op" id="3983091">,</span>&nbsp;<span class="ident" id="3983093"><a href="/mime/multipart/writer.go.html#3983020">err</a></span>&nbsp;<span class="op" id="3983097">=</span>&nbsp;<span class="ident" id="3983099"><a href="/mime/multipart/writer.go.html#3983017">p</a></span><span class="op" id="3983100">.</span><span class="ident" id="3983101">Write</span><span class="op" id="3983106">(</span><span class="op" id="3983107">[</span><span class="op" id="3983108">]</span><span class="builtintype" id="3983109">byte</span><span class="op" id="3983113">(</span><span class="ident" id="3983114"><a href="/mime/multipart/writer.go.html#3982994">value</a></span><span class="op" id="3983119">)</span><span class="op" id="3983120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983123">return</span>&nbsp;<span class="ident" id="3983130"><a href="/mime/multipart/writer.go.html#3983020">err</a></span><br>
<span class="lineno"></span><span class="op" id="3983134">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="3983137">//&nbsp;Close&nbsp;finishes&nbsp;the&nbsp;multipart&nbsp;message&nbsp;and&nbsp;writes&nbsp;the&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="3983201">//&nbsp;boundary&nbsp;end&nbsp;line&nbsp;to&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="3983237">func</span>&nbsp;<span class="op" id="3983242">(</span><span class="ident" id="3983243">w</span>&nbsp;<span class="op" id="3983245">*</span><span class="ident" id="3983246"><a href="/mime/multipart/writer.go.html#3979481">Writer</a></span><span class="op" id="3983252">)</span>&nbsp;<span class="ident" id="3983254">Close</span><span class="op" id="3983259">(</span><span class="op" id="3983260">)</span>&nbsp;<span class="builtintype" id="3983262">error</span>&nbsp;<span class="op" id="3983268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983271">if</span>&nbsp;<span class="ident" id="3983274"><a href="/mime/multipart/writer.go.html#3983243">w</a></span><span class="op" id="3983275">.</span><span class="ident" id="3983276">lastpart</span>&nbsp;<span class="op" id="3983285">!=</span>&nbsp;<span class="ident" id="3983288">nil</span>&nbsp;<span class="op" id="3983292">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983296">if</span>&nbsp;<span class="ident" id="3983299">err</span>&nbsp;<span class="op" id="3983303">:=</span>&nbsp;<span class="ident" id="3983306"><a href="/mime/multipart/writer.go.html#3983243">w</a></span><span class="op" id="3983307">.</span><span class="ident" id="3983308">lastpart</span><span class="op" id="3983316">.</span><span class="builtinfunc" id="3983317">close</span><span class="op" id="3983322">(</span><span class="op" id="3983323">)</span><span class="op" id="3983324">;</span>&nbsp;<span class="ident" id="3983326"><a href="/mime/multipart/writer.go.html#3983299">err</a></span>&nbsp;<span class="op" id="3983330">!=</span>&nbsp;<span class="ident" id="3983333">nil</span>&nbsp;<span class="op" id="3983337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983342">return</span>&nbsp;<span class="ident" id="3983349"><a href="/mime/multipart/writer.go.html#3983299">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983359"><a href="/mime/multipart/writer.go.html#3983243">w</a></span><span class="op" id="3983360">.</span><span class="ident" id="3983361">lastpart</span>&nbsp;<span class="op" id="3983370">=</span>&nbsp;<span class="ident" id="3983372">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983377">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983380">_</span><span class="op" id="3983381">,</span>&nbsp;<span class="ident" id="3983383">err</span>&nbsp;<span class="op" id="3983387">:=</span>&nbsp;<span class="ident" id="3983390"><a href="/mime/multipart/writer.go.html#3979391">fmt</a></span><span class="op" id="3983393">.</span><span class="ident" id="3983394">Fprintf</span><span class="op" id="3983401">(</span><span class="ident" id="3983402"><a href="/mime/multipart/writer.go.html#3983243">w</a></span><span class="op" id="3983403">.</span><span class="ident" id="3983404">w</span><span class="op" id="3983405">,</span>&nbsp;<span class="string" id="3983407">&#34;\r\n--%s--\r\n&#34;</span><span class="op" id="3983423">,</span>&nbsp;<span class="ident" id="3983425"><a href="/mime/multipart/writer.go.html#3983243">w</a></span><span class="op" id="3983426">.</span><span class="ident" id="3983427">boundary</span><span class="op" id="3983435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983438">return</span>&nbsp;<span class="ident" id="3983445"><a href="/mime/multipart/writer.go.html#3983383">err</a></span><br>
<span class="lineno"></span><span class="op" id="3983449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3983452">type</span>&nbsp;<span class="ident" id="3983457">part</span>&nbsp;<span class="keyword" id="3983462">struct</span>&nbsp;<span class="op" id="3983469">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983472">mw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3983479">*</span><span class="ident" id="3983480"><a href="/mime/multipart/writer.go.html#3979481">Writer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983488">closed</span>&nbsp;<span class="builtintype" id="3983495">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983501">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3983508">error</span>&nbsp;<span class="comment" id="3983514">//&nbsp;last&nbsp;error&nbsp;that&nbsp;occurred&nbsp;writing</span><br>
<span class="lineno"></span><span class="op" id="3983550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3983553">func</span>&nbsp;<span class="op" id="3983558">(</span><span class="ident" id="3983559">p</span>&nbsp;<span class="op" id="3983561">*</span><span class="ident" id="3983562"><a href="/mime/multipart/writer.go.html#3983457">part</a></span><span class="op" id="3983566">)</span>&nbsp;<span class="builtinfunc" id="3983568">close</span><span class="op" id="3983573">(</span><span class="op" id="3983574">)</span>&nbsp;<span class="builtintype" id="3983576">error</span>&nbsp;<span class="op" id="3983582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983585"><a href="/mime/multipart/writer.go.html#3983559">p</a></span><span class="op" id="3983586">.</span><span class="ident" id="3983587">closed</span>&nbsp;<span class="op" id="3983594">=</span>&nbsp;<span class="ident" id="3983596">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983602">return</span>&nbsp;<span class="ident" id="3983609"><a href="/mime/multipart/writer.go.html#3983559">p</a></span><span class="op" id="3983610">.</span><span class="ident" id="3983611">we</span><br>
<span class="lineno"></span><span class="op" id="3983614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="3983617">func</span>&nbsp;<span class="op" id="3983622">(</span><span class="ident" id="3983623">p</span>&nbsp;<span class="op" id="3983625">*</span><span class="ident" id="3983626"><a href="/mime/multipart/writer.go.html#3983457">part</a></span><span class="op" id="3983630">)</span>&nbsp;<span class="ident" id="3983632">Write</span><span class="op" id="3983637">(</span><span class="ident" id="3983638">d</span>&nbsp;<span class="op" id="3983640">[</span><span class="op" id="3983641">]</span><span class="builtintype" id="3983642">byte</span><span class="op" id="3983646">)</span>&nbsp;<span class="op" id="3983648">(</span><span class="ident" id="3983649">n</span>&nbsp;<span class="builtintype" id="3983651">int</span><span class="op" id="3983654">,</span>&nbsp;<span class="ident" id="3983656">err</span>&nbsp;<span class="builtintype" id="3983660">error</span><span class="op" id="3983665">)</span>&nbsp;<span class="op" id="3983667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983670">if</span>&nbsp;<span class="ident" id="3983673"><a href="/mime/multipart/writer.go.html#3983623">p</a></span><span class="op" id="3983674">.</span><span class="ident" id="3983675">closed</span>&nbsp;<span class="op" id="3983682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983686">return</span>&nbsp;<span class="num" id="3983693">0</span><span class="op" id="3983694">,</span>&nbsp;<span class="ident" id="3983696"><a href="/mime/multipart/writer.go.html#3979381">errors</a></span><span class="op" id="3983702">.</span><span class="ident" id="3983703">New</span><span class="op" id="3983706">(</span><span class="string" id="3983707">&#34;multipart:&nbsp;can&#39;t&nbsp;write&nbsp;to&nbsp;finished&nbsp;part&#34;</span><span class="op" id="3983748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983754"><a href="/mime/multipart/writer.go.html#3983649">n</a></span><span class="op" id="3983755">,</span>&nbsp;<span class="ident" id="3983757"><a href="/mime/multipart/writer.go.html#3983656">err</a></span>&nbsp;<span class="op" id="3983761">=</span>&nbsp;<span class="ident" id="3983763"><a href="/mime/multipart/writer.go.html#3983623">p</a></span><span class="op" id="3983764">.</span><span class="ident" id="3983765">mw</span><span class="op" id="3983767">.</span><span class="ident" id="3983768">w</span><span class="op" id="3983769">.</span><span class="ident" id="3983770">Write</span><span class="op" id="3983775">(</span><span class="ident" id="3983776"><a href="/mime/multipart/writer.go.html#3983638">d</a></span><span class="op" id="3983777">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983780">if</span>&nbsp;<span class="ident" id="3983783"><a href="/mime/multipart/writer.go.html#3983656">err</a></span>&nbsp;<span class="op" id="3983787">!=</span>&nbsp;<span class="ident" id="3983790">nil</span>&nbsp;<span class="op" id="3983794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3983798"><a href="/mime/multipart/writer.go.html#3983623">p</a></span><span class="op" id="3983799">.</span><span class="ident" id="3983800">we</span>&nbsp;<span class="op" id="3983803">=</span>&nbsp;<span class="ident" id="3983805"><a href="/mime/multipart/writer.go.html#3983656">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3983810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3983813">return</span><br>
<span class="lineno"></span><span class="op" id="3983820">}</span>
</div>
</body>
</html>
