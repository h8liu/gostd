<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1604583">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1604638">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1604692">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1604743">//&nbsp;+build&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1604760">package</span>&nbsp;<span class="ident" id="1604768">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1604777">import</span>&nbsp;<span class="string" id="1604784">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1604794">func</span>&nbsp;<span class="ident" id="1604799">epollcreate</span><span class="op" id="1604810">(</span><span class="ident" id="1604811">size</span>&nbsp;<span class="builtintype" id="1604816">int32</span><span class="op" id="1604821">)</span>&nbsp;<span class="builtintype" id="1604823">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1604829">func</span>&nbsp;<span class="ident" id="1604834">epollcreate1</span><span class="op" id="1604846">(</span><span class="ident" id="1604847">flags</span>&nbsp;<span class="builtintype" id="1604853">int32</span><span class="op" id="1604858">)</span>&nbsp;<span class="builtintype" id="1604860">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1604867">//go:noescape</span><br>
<span class="lineno">15</span><span class="keyword" id="1604881">func</span>&nbsp;<span class="ident" id="1604886">epollctl</span><span class="op" id="1604894">(</span><span class="ident" id="1604895">epfd</span><span class="op" id="1604899">,</span>&nbsp;<span class="ident" id="1604901">op</span><span class="op" id="1604903">,</span>&nbsp;<span class="ident" id="1604905">fd</span>&nbsp;<span class="builtintype" id="1604908">int32</span><span class="op" id="1604913">,</span>&nbsp;<span class="ident" id="1604915">ev</span>&nbsp;<span class="op" id="1604918">*</span><span class="ident" id="1604919">epollevent</span><span class="op" id="1604929">)</span>&nbsp;<span class="builtintype" id="1604931">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1604938">//go:noescape</span><br>
<span class="lineno"></span><span class="keyword" id="1604952">func</span>&nbsp;<span class="ident" id="1604957">epollwait</span><span class="op" id="1604966">(</span><span class="ident" id="1604967">epfd</span>&nbsp;<span class="builtintype" id="1604972">int32</span><span class="op" id="1604977">,</span>&nbsp;<span class="ident" id="1604979">ev</span>&nbsp;<span class="op" id="1604982">*</span><span class="ident" id="1604983">epollevent</span><span class="op" id="1604993">,</span>&nbsp;<span class="ident" id="1604995">nev</span><span class="op" id="1604998">,</span>&nbsp;<span class="ident" id="1605000">timeout</span>&nbsp;<span class="builtintype" id="1605008">int32</span><span class="op" id="1605013">)</span>&nbsp;<span class="builtintype" id="1605015">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1605021">func</span>&nbsp;<span class="ident" id="1605026">closeonexec</span><span class="op" id="1605037">(</span><span class="ident" id="1605038">fd</span>&nbsp;<span class="builtintype" id="1605041">int32</span><span class="op" id="1605046">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1605049">var</span>&nbsp;<span class="op" id="1605053">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605056">epfd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1605071">int32</span>&nbsp;<span class="op" id="1605077">=</span>&nbsp;<span class="op" id="1605079">-</span><span class="num" id="1605080">1</span>&nbsp;<span class="comment" id="1605082">//&nbsp;epoll&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605103">netpolllasterr</span>&nbsp;<span class="builtintype" id="1605118">int32</span><br>
<span class="lineno"></span><span class="op" id="1605124">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="1605127">func</span>&nbsp;<span class="ident" id="1605132">netpollinit</span><span class="op" id="1605143">(</span><span class="op" id="1605144">)</span>&nbsp;<span class="op" id="1605146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605149">epfd</span>&nbsp;<span class="op" id="1605154">=</span>&nbsp;<span class="ident" id="1605156">epollcreate1</span><span class="op" id="1605168">(</span><span class="ident" id="1605169">_EPOLL_CLOEXEC</span><span class="op" id="1605183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605186">if</span>&nbsp;<span class="ident" id="1605189">epfd</span>&nbsp;<span class="op" id="1605194">&gt;=</span>&nbsp;<span class="num" id="1605197">0</span>&nbsp;<span class="op" id="1605199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605203">return</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1605211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605214">epfd</span>&nbsp;<span class="op" id="1605219">=</span>&nbsp;<span class="ident" id="1605221">epollcreate</span><span class="op" id="1605232">(</span><span class="num" id="1605233">1024</span><span class="op" id="1605237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605240">if</span>&nbsp;<span class="ident" id="1605243">epfd</span>&nbsp;<span class="op" id="1605248">&gt;=</span>&nbsp;<span class="num" id="1605251">0</span>&nbsp;<span class="op" id="1605253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605257">closeonexec</span><span class="op" id="1605268">(</span><span class="ident" id="1605269">epfd</span><span class="op" id="1605273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605277">return</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1605285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1605288">println</span><span class="op" id="1605295">(</span><span class="string" id="1605296">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;epoll&nbsp;descriptor&#34;</span><span class="op" id="1605344">,</span>&nbsp;<span class="op" id="1605346">-</span><span class="ident" id="1605347">epfd</span><span class="op" id="1605351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605354">gothrow</span><span class="op" id="1605361">(</span><span class="string" id="1605362">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;descriptor&#34;</span><span class="op" id="1605404">)</span><br>
<span class="lineno"></span><span class="op" id="1605406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1605409">func</span>&nbsp;<span class="ident" id="1605414">netpollopen</span><span class="op" id="1605425">(</span><span class="ident" id="1605426">fd</span>&nbsp;<span class="builtintype" id="1605429">uintptr</span><span class="op" id="1605436">,</span>&nbsp;<span class="ident" id="1605438">pd</span>&nbsp;<span class="op" id="1605441">*</span><span class="ident" id="1605442">pollDesc</span><span class="op" id="1605450">)</span>&nbsp;<span class="builtintype" id="1605452">int32</span>&nbsp;<span class="op" id="1605458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605461">var</span>&nbsp;<span class="ident" id="1605465">ev</span>&nbsp;<span class="ident" id="1605468">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605480">ev</span><span class="op" id="1605482">.</span><span class="ident" id="1605483">events</span>&nbsp;<span class="op" id="1605490">=</span>&nbsp;<span class="ident" id="1605492">_EPOLLIN</span>&nbsp;<span class="op" id="1605501">|</span>&nbsp;<span class="ident" id="1605503">_EPOLLOUT</span>&nbsp;<span class="op" id="1605513">|</span>&nbsp;<span class="ident" id="1605515">_EPOLLRDHUP</span>&nbsp;<span class="op" id="1605527">|</span>&nbsp;<span class="ident" id="1605529">_EPOLLET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1605539">*</span><span class="op" id="1605540">(</span><span class="op" id="1605541">*</span><span class="op" id="1605542">*</span><span class="ident" id="1605543">pollDesc</span><span class="op" id="1605551">)</span><span class="op" id="1605552">(</span><span class="ident" id="1605553">unsafe</span><span class="op" id="1605559">.</span><span class="ident" id="1605560">Pointer</span><span class="op" id="1605567">(</span><span class="op" id="1605568">&amp;</span><span class="ident" id="1605569">ev</span><span class="op" id="1605571">.</span><span class="ident" id="1605572">data</span><span class="op" id="1605576">)</span><span class="op" id="1605577">)</span>&nbsp;<span class="op" id="1605579">=</span>&nbsp;<span class="ident" id="1605581">pd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605585">return</span>&nbsp;<span class="op" id="1605592">-</span><span class="ident" id="1605593">epollctl</span><span class="op" id="1605601">(</span><span class="ident" id="1605602">epfd</span><span class="op" id="1605606">,</span>&nbsp;<span class="ident" id="1605608">_EPOLL_CTL_ADD</span><span class="op" id="1605622">,</span>&nbsp;<span class="builtintype" id="1605624">int32</span><span class="op" id="1605629">(</span><span class="ident" id="1605630">fd</span><span class="op" id="1605632">)</span><span class="op" id="1605633">,</span>&nbsp;<span class="op" id="1605635">&amp;</span><span class="ident" id="1605636">ev</span><span class="op" id="1605638">)</span><br>
<span class="lineno">45</span><span class="op" id="1605640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1605643">func</span>&nbsp;<span class="ident" id="1605648">netpollclose</span><span class="op" id="1605660">(</span><span class="ident" id="1605661">fd</span>&nbsp;<span class="builtintype" id="1605664">uintptr</span><span class="op" id="1605671">)</span>&nbsp;<span class="builtintype" id="1605673">int32</span>&nbsp;<span class="op" id="1605679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605682">var</span>&nbsp;<span class="ident" id="1605686">ev</span>&nbsp;<span class="ident" id="1605689">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605701">return</span>&nbsp;<span class="op" id="1605708">-</span><span class="ident" id="1605709">epollctl</span><span class="op" id="1605717">(</span><span class="ident" id="1605718">epfd</span><span class="op" id="1605722">,</span>&nbsp;<span class="ident" id="1605724">_EPOLL_CTL_DEL</span><span class="op" id="1605738">,</span>&nbsp;<span class="builtintype" id="1605740">int32</span><span class="op" id="1605745">(</span><span class="ident" id="1605746">fd</span><span class="op" id="1605748">)</span><span class="op" id="1605749">,</span>&nbsp;<span class="op" id="1605751">&amp;</span><span class="ident" id="1605752">ev</span><span class="op" id="1605754">)</span><br>
<span class="lineno">50</span><span class="op" id="1605756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1605759">func</span>&nbsp;<span class="ident" id="1605764">netpollarm</span><span class="op" id="1605774">(</span><span class="ident" id="1605775">pd</span>&nbsp;<span class="op" id="1605778">*</span><span class="ident" id="1605779">pollDesc</span><span class="op" id="1605787">,</span>&nbsp;<span class="ident" id="1605789">mode</span>&nbsp;<span class="builtintype" id="1605794">int</span><span class="op" id="1605797">)</span>&nbsp;<span class="op" id="1605799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605802">gothrow</span><span class="op" id="1605809">(</span><span class="string" id="1605810">&#34;unused&#34;</span><span class="op" id="1605818">)</span><br>
<span class="lineno"></span><span class="op" id="1605820">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1605823">//&nbsp;polls&nbsp;for&nbsp;ready&nbsp;network&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="1605862">//&nbsp;returns&nbsp;list&nbsp;of&nbsp;goroutines&nbsp;that&nbsp;become&nbsp;runnable</span><br>
<span class="lineno"></span><span class="keyword" id="1605913">func</span>&nbsp;<span class="ident" id="1605918">netpoll</span><span class="op" id="1605925">(</span><span class="ident" id="1605926">block</span>&nbsp;<span class="builtintype" id="1605932">bool</span><span class="op" id="1605936">)</span>&nbsp;<span class="op" id="1605938">(</span><span class="ident" id="1605939">gp</span>&nbsp;<span class="op" id="1605942">*</span><span class="ident" id="1605943">g</span><span class="op" id="1605944">)</span>&nbsp;<span class="op" id="1605946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605949">if</span>&nbsp;<span class="ident" id="1605952">epfd</span>&nbsp;<span class="op" id="1605957">==</span>&nbsp;<span class="op" id="1605960">-</span><span class="num" id="1605961">1</span>&nbsp;<span class="op" id="1605963">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605967">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1605975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605978">waitms</span>&nbsp;<span class="op" id="1605985">:=</span>&nbsp;<span class="builtintype" id="1605988">int32</span><span class="op" id="1605993">(</span><span class="op" id="1605994">-</span><span class="num" id="1605995">1</span><span class="op" id="1605996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605999">if</span>&nbsp;<span class="op" id="1606002">!</span><span class="ident" id="1606003">block</span>&nbsp;<span class="op" id="1606009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606013">waitms</span>&nbsp;<span class="op" id="1606020">=</span>&nbsp;<span class="num" id="1606022">0</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1606025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606028">var</span>&nbsp;<span class="ident" id="1606032">events</span>&nbsp;<span class="op" id="1606039">[</span><span class="num" id="1606040">128</span><span class="op" id="1606043">]</span><span class="ident" id="1606044">epollevent</span><br>
<span class="lineno"></span><span class="ident" id="1606055">retry</span><span class="op" id="1606060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606063">n</span>&nbsp;<span class="op" id="1606065">:=</span>&nbsp;<span class="ident" id="1606068">epollwait</span><span class="op" id="1606077">(</span><span class="ident" id="1606078">epfd</span><span class="op" id="1606082">,</span>&nbsp;<span class="op" id="1606084">&amp;</span><span class="ident" id="1606085">events</span><span class="op" id="1606091">[</span><span class="num" id="1606092">0</span><span class="op" id="1606093">]</span><span class="op" id="1606094">,</span>&nbsp;<span class="builtintype" id="1606096">int32</span><span class="op" id="1606101">(</span><span class="builtinfunc" id="1606102">len</span><span class="op" id="1606105">(</span><span class="ident" id="1606106">events</span><span class="op" id="1606112">)</span><span class="op" id="1606113">)</span><span class="op" id="1606114">,</span>&nbsp;<span class="ident" id="1606116">waitms</span><span class="op" id="1606122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606125">if</span>&nbsp;<span class="ident" id="1606128">n</span>&nbsp;<span class="op" id="1606130">&lt;</span>&nbsp;<span class="num" id="1606132">0</span>&nbsp;<span class="op" id="1606134">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606138">if</span>&nbsp;<span class="ident" id="1606141">n</span>&nbsp;<span class="op" id="1606143">!=</span>&nbsp;<span class="op" id="1606146">-</span><span class="ident" id="1606147">_EINTR</span>&nbsp;<span class="op" id="1606154">&amp;&amp;</span>&nbsp;<span class="ident" id="1606157">n</span>&nbsp;<span class="op" id="1606159">!=</span>&nbsp;<span class="ident" id="1606162">netpolllasterr</span>&nbsp;<span class="op" id="1606177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606182">netpolllasterr</span>&nbsp;<span class="op" id="1606197">=</span>&nbsp;<span class="ident" id="1606199">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1606204">println</span><span class="op" id="1606211">(</span><span class="string" id="1606212">&#34;runtime:&nbsp;epollwait&nbsp;on&nbsp;fd&#34;</span><span class="op" id="1606238">,</span>&nbsp;<span class="ident" id="1606240">epfd</span><span class="op" id="1606244">,</span>&nbsp;<span class="string" id="1606246">&#34;failed&nbsp;with&#34;</span><span class="op" id="1606259">,</span>&nbsp;<span class="op" id="1606261">-</span><span class="ident" id="1606262">n</span><span class="op" id="1606263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1606267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606271">goto</span>&nbsp;<span class="ident" id="1606276">retry</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1606283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606286">for</span>&nbsp;<span class="ident" id="1606290">i</span>&nbsp;<span class="op" id="1606292">:=</span>&nbsp;<span class="builtintype" id="1606295">int32</span><span class="op" id="1606300">(</span><span class="num" id="1606301">0</span><span class="op" id="1606302">)</span><span class="op" id="1606303">;</span>&nbsp;<span class="ident" id="1606305">i</span>&nbsp;<span class="op" id="1606307">&lt;</span>&nbsp;<span class="ident" id="1606309">n</span><span class="op" id="1606310">;</span>&nbsp;<span class="ident" id="1606312">i</span><span class="op" id="1606313">++</span>&nbsp;<span class="op" id="1606316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606320">ev</span>&nbsp;<span class="op" id="1606323">:=</span>&nbsp;<span class="op" id="1606326">&amp;</span><span class="ident" id="1606327">events</span><span class="op" id="1606333">[</span><span class="ident" id="1606334">i</span><span class="op" id="1606335">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606339">if</span>&nbsp;<span class="ident" id="1606342">ev</span><span class="op" id="1606344">.</span><span class="ident" id="1606345">events</span>&nbsp;<span class="op" id="1606352">==</span>&nbsp;<span class="num" id="1606355">0</span>&nbsp;<span class="op" id="1606357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606362">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1606373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606377">var</span>&nbsp;<span class="ident" id="1606381">mode</span>&nbsp;<span class="builtintype" id="1606386">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606394">if</span>&nbsp;<span class="ident" id="1606397">ev</span><span class="op" id="1606399">.</span><span class="ident" id="1606400">events</span><span class="op" id="1606406">&amp;</span><span class="op" id="1606407">(</span><span class="ident" id="1606408">_EPOLLIN</span><span class="op" id="1606416">|</span><span class="ident" id="1606417">_EPOLLRDHUP</span><span class="op" id="1606428">|</span><span class="ident" id="1606429">_EPOLLHUP</span><span class="op" id="1606438">|</span><span class="ident" id="1606439">_EPOLLERR</span><span class="op" id="1606448">)</span>&nbsp;<span class="op" id="1606450">!=</span>&nbsp;<span class="num" id="1606453">0</span>&nbsp;<span class="op" id="1606455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606460">mode</span>&nbsp;<span class="op" id="1606465">+=</span>&nbsp;<span class="string" id="1606468">&#39;r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1606474">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606478">if</span>&nbsp;<span class="ident" id="1606481">ev</span><span class="op" id="1606483">.</span><span class="ident" id="1606484">events</span><span class="op" id="1606490">&amp;</span><span class="op" id="1606491">(</span><span class="ident" id="1606492">_EPOLLOUT</span><span class="op" id="1606501">|</span><span class="ident" id="1606502">_EPOLLHUP</span><span class="op" id="1606511">|</span><span class="ident" id="1606512">_EPOLLERR</span><span class="op" id="1606521">)</span>&nbsp;<span class="op" id="1606523">!=</span>&nbsp;<span class="num" id="1606526">0</span>&nbsp;<span class="op" id="1606528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606533">mode</span>&nbsp;<span class="op" id="1606538">+=</span>&nbsp;<span class="string" id="1606541">&#39;w&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1606547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606551">if</span>&nbsp;<span class="ident" id="1606554">mode</span>&nbsp;<span class="op" id="1606559">!=</span>&nbsp;<span class="num" id="1606562">0</span>&nbsp;<span class="op" id="1606564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606569">pd</span>&nbsp;<span class="op" id="1606572">:=</span>&nbsp;<span class="op" id="1606575">*</span><span class="op" id="1606576">(</span><span class="op" id="1606577">*</span><span class="op" id="1606578">*</span><span class="ident" id="1606579">pollDesc</span><span class="op" id="1606587">)</span><span class="op" id="1606588">(</span><span class="ident" id="1606589">unsafe</span><span class="op" id="1606595">.</span><span class="ident" id="1606596">Pointer</span><span class="op" id="1606603">(</span><span class="op" id="1606604">&amp;</span><span class="ident" id="1606605">ev</span><span class="op" id="1606607">.</span><span class="ident" id="1606608">data</span><span class="op" id="1606612">)</span><span class="op" id="1606613">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1606618">netpollready</span><span class="op" id="1606630">(</span><span class="op" id="1606631">(</span><span class="op" id="1606632">*</span><span class="op" id="1606633">*</span><span class="ident" id="1606634">g</span><span class="op" id="1606635">)</span><span class="op" id="1606636">(</span><span class="ident" id="1606637">noescape</span><span class="op" id="1606645">(</span><span class="ident" id="1606646">unsafe</span><span class="op" id="1606652">.</span><span class="ident" id="1606653">Pointer</span><span class="op" id="1606660">(</span><span class="op" id="1606661">&amp;</span><span class="ident" id="1606662">gp</span><span class="op" id="1606664">)</span><span class="op" id="1606665">)</span><span class="op" id="1606666">)</span><span class="op" id="1606667">,</span>&nbsp;<span class="ident" id="1606669">pd</span><span class="op" id="1606671">,</span>&nbsp;<span class="ident" id="1606673">mode</span><span class="op" id="1606677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1606681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1606684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606687">if</span>&nbsp;<span class="ident" id="1606690">block</span>&nbsp;<span class="op" id="1606696">&amp;&amp;</span>&nbsp;<span class="ident" id="1606699">gp</span>&nbsp;<span class="op" id="1606702">==</span>&nbsp;<span class="ident" id="1606705">nil</span>&nbsp;<span class="op" id="1606709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606713">goto</span>&nbsp;<span class="ident" id="1606718">retry</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1606725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1606728">return</span>&nbsp;<span class="ident" id="1606735">gp</span><br>
<span class="lineno"></span><span class="op" id="1606738">}</span>
</div>
</body>
</html>
