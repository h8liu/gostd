<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7867462">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7867517">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7867571">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7867622">package</span>&nbsp;<span class="ident" id="7867630">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7867635">import</span>&nbsp;<span class="op" id="7867642">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7867645">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7867654">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7867661">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7867667">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7867674">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7867685">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7867696">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7867703">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7867706">var</span>&nbsp;<span class="ident" id="7867710">rsaCertPEM</span>&nbsp;<span class="op" id="7867721">=</span>&nbsp;<span class="string" id="7867723">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB0zCCAX2gAwIBAgIJAI/M7BYjwB+uMA0GCSqGSIb3DQEBBQUAMEUxCzAJBgNV<br>
<span class="lineno"></span>BAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBX<br>
<span class="lineno">20</span>aWRnaXRzIFB0eSBMdGQwHhcNMTIwOTEyMjE1MjAyWhcNMTUwOTEyMjE1MjAyWjBF<br>
<span class="lineno"></span>MQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50<br>
<span class="lineno"></span>ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBANLJ<br>
<span class="lineno"></span>hPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wok/4xIA+ui35/MmNa<br>
<span class="lineno"></span>rtNuC+BdZ1tMuVCPFZcCAwEAAaNQME4wHQYDVR0OBBYEFJvKs8RfJaXTH08W+SGv<br>
<span class="lineno">25</span>zQyKn0H8MB8GA1UdIwQYMBaAFJvKs8RfJaXTH08W+SGvzQyKn0H8MAwGA1UdEwQF<br>
<span class="lineno"></span>MAMBAf8wDQYJKoZIhvcNAQEFBQADQQBJlffJHybjDGxRMqaRmDhX0+6v02TUKZsW<br>
<span class="lineno"></span>r5QuVbpQhH6u+0UgcW0jp9QwpxoPTLTWGXEWBBBurxFwiCBhkQ+V<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="7868419">var</span>&nbsp;<span class="ident" id="7868423">rsaKeyPEM</span>&nbsp;<span class="op" id="7868433">=</span>&nbsp;<span class="string" id="7868435">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno">35</span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno"></span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">40</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7868936">//&nbsp;keyPEM&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;rsaKeyPEM,&nbsp;but&nbsp;declares&nbsp;itself&nbsp;as&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="7869000">//&nbsp;&#34;PRIVATE&nbsp;KEY&#34;,&nbsp;not&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;.&nbsp;&nbsp;http://golang.org/issue/4477</span><br>
<span class="lineno"></span><span class="keyword" id="7869071">var</span>&nbsp;<span class="ident" id="7869075">keyPEM</span>&nbsp;<span class="op" id="7869082">=</span>&nbsp;<span class="string" id="7869084">`-----BEGIN&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">45</span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno"></span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno">50</span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7869577">var</span>&nbsp;<span class="ident" id="7869581">ecdsaCertPEM</span>&nbsp;<span class="op" id="7869594">=</span>&nbsp;<span class="string" id="7869596">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/jCCAWICCQDscdUxw16XFDAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTI0MDQ4WhcNMTUxMTE0MTI0MDQ4WjBFMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTETMBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lk<br>
<span class="lineno">60</span>Z2l0cyBQdHkgTHRkMIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQBY9+my9OoeSUR<br>
<span class="lineno"></span>lDQdV/x8LsOuLilthhiS1Tz4aGDHIPwC1mlvnf7fg5lecYpMCrLLhauAc1UJXcgl<br>
<span class="lineno"></span>01xoLuzgtAEAgv2P/jgytzRSpUYvgLBt1UA0leLYBy6mQQbrNEuqT3INapKIcUv8<br>
<span class="lineno"></span>XxYP0xMEUksLPq6Ca+CRSqTtrd/23uTnapkwCQYHKoZIzj0EAQOBigAwgYYCQXJo<br>
<span class="lineno"></span>A7Sl2nLVf+4Iu/tAX/IF4MavARKC4PPHK3zfuGfPR3oCCcsAoz3kAzOeijvd0iXb<br>
<span class="lineno">65</span>H5jBImIxPL4WxQNiBTexAkF8D1EtpYuWdlVQ80/h/f4pBcGiXPqX5h2PQSQY7hP1<br>
<span class="lineno"></span>+jwM1FGS4fREIOvlBYr/SzzQRtwrvrzGYxDEDbsC0ZGRnA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7870353">var</span>&nbsp;<span class="ident" id="7870357">ecdsaKeyPEM</span>&nbsp;<span class="op" id="7870369">=</span>&nbsp;<span class="string" id="7870371">`-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBrsoKp0oqcv6/JovJJDoDVSGWdirrkgCWxrprGlzB9o0X8fV675X0<br>
<span class="lineno">75</span>NwuBenXFfeZvVcwluO7/Q9wkYoPd/t3jGImgBwYFK4EEACOhgYkDgYYABAFj36bL<br>
<span class="lineno"></span>06h5JRGUNB1X/Hwuw64uKW2GGJLVPPhoYMcg/ALWaW+d/t+DmV5xikwKssuFq4Bz<br>
<span class="lineno"></span>VQldyCXTXGgu7OC0AQCC/Y/+ODK3NFKlRi+AsG3VQDSV4tgHLqZBBus0S6pPcg1q<br>
<span class="lineno"></span>kohxS/xfFg/TEwRSSws+roJr4JFKpO2t3/be5OdqmQ==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">80</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7870811">var</span>&nbsp;<span class="ident" id="7870815">keyPairTests</span>&nbsp;<span class="op" id="7870828">=</span>&nbsp;<span class="op" id="7870830">[</span><span class="op" id="7870831">]</span><span class="keyword" id="7870832">struct</span>&nbsp;<span class="op" id="7870839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870842">algo</span>&nbsp;<span class="builtintype" id="7870847">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870855">cert</span>&nbsp;<span class="builtintype" id="7870860">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7870868">key</span>&nbsp;&nbsp;<span class="builtintype" id="7870873">string</span><br>
<span class="lineno"></span><span class="op" id="7870880">}</span><span class="op" id="7870881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870884">{</span><span class="string" id="7870885">&#34;ECDSA&#34;</span><span class="op" id="7870892">,</span>&nbsp;<span class="ident" id="7870894">ecdsaCertPEM</span><span class="op" id="7870906">,</span>&nbsp;<span class="ident" id="7870908">ecdsaKeyPEM</span><span class="op" id="7870919">}</span><span class="op" id="7870920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870923">{</span><span class="string" id="7870924">&#34;RSA&#34;</span><span class="op" id="7870929">,</span>&nbsp;<span class="ident" id="7870931">rsaCertPEM</span><span class="op" id="7870941">,</span>&nbsp;<span class="ident" id="7870943">rsaKeyPEM</span><span class="op" id="7870952">}</span><span class="op" id="7870953">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7870956">{</span><span class="string" id="7870957">&#34;RSA-untyped&#34;</span><span class="op" id="7870970">,</span>&nbsp;<span class="ident" id="7870972">rsaCertPEM</span><span class="op" id="7870982">,</span>&nbsp;<span class="ident" id="7870984">keyPEM</span><span class="op" id="7870990">}</span><span class="op" id="7870991">,</span>&nbsp;<span class="comment" id="7870993">//&nbsp;golang.org/issue/4477</span><br>
<span class="lineno">90</span><span class="op" id="7871018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7871021">func</span>&nbsp;<span class="ident" id="7871026">TestX509KeyPair</span><span class="op" id="7871041">(</span><span class="ident" id="7871042">t</span>&nbsp;<span class="op" id="7871044">*</span><span class="ident" id="7871045">testing</span><span class="op" id="7871052">.</span><span class="ident" id="7871053">T</span><span class="op" id="7871054">)</span>&nbsp;<span class="op" id="7871056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871059">var</span>&nbsp;<span class="ident" id="7871063">pem</span>&nbsp;<span class="op" id="7871067">[</span><span class="op" id="7871068">]</span><span class="builtintype" id="7871069">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871075">for</span>&nbsp;<span class="ident" id="7871079">_</span><span class="op" id="7871080">,</span>&nbsp;<span class="ident" id="7871082">test</span>&nbsp;<span class="op" id="7871087">:=</span>&nbsp;<span class="keyword" id="7871090">range</span>&nbsp;<span class="ident" id="7871096">keyPairTests</span>&nbsp;<span class="op" id="7871109">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871113">pem</span>&nbsp;<span class="op" id="7871117">=</span>&nbsp;<span class="op" id="7871119">[</span><span class="op" id="7871120">]</span><span class="builtintype" id="7871121">byte</span><span class="op" id="7871125">(</span><span class="ident" id="7871126">test</span><span class="op" id="7871130">.</span><span class="ident" id="7871131">cert</span>&nbsp;<span class="op" id="7871136">+</span>&nbsp;<span class="ident" id="7871138">test</span><span class="op" id="7871142">.</span><span class="ident" id="7871143">key</span><span class="op" id="7871146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871150">if</span>&nbsp;<span class="ident" id="7871153">_</span><span class="op" id="7871154">,</span>&nbsp;<span class="ident" id="7871156">err</span>&nbsp;<span class="op" id="7871160">:=</span>&nbsp;<span class="ident" id="7871163">X509KeyPair</span><span class="op" id="7871174">(</span><span class="ident" id="7871175">pem</span><span class="op" id="7871178">,</span>&nbsp;<span class="ident" id="7871180">pem</span><span class="op" id="7871183">)</span><span class="op" id="7871184">;</span>&nbsp;<span class="ident" id="7871186">err</span>&nbsp;<span class="op" id="7871190">!=</span>&nbsp;<span class="ident" id="7871193">nil</span>&nbsp;<span class="op" id="7871197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871202">t</span><span class="op" id="7871203">.</span><span class="ident" id="7871204">Errorf</span><span class="op" id="7871210">(</span><span class="string" id="7871211">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;cert&nbsp;followed&nbsp;by&nbsp;%s&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7871258">,</span>&nbsp;<span class="ident" id="7871260">test</span><span class="op" id="7871264">.</span><span class="ident" id="7871265">algo</span><span class="op" id="7871269">,</span>&nbsp;<span class="ident" id="7871271">test</span><span class="op" id="7871275">.</span><span class="ident" id="7871276">algo</span><span class="op" id="7871280">,</span>&nbsp;<span class="ident" id="7871282">err</span><span class="op" id="7871285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871293">pem</span>&nbsp;<span class="op" id="7871297">=</span>&nbsp;<span class="op" id="7871299">[</span><span class="op" id="7871300">]</span><span class="builtintype" id="7871301">byte</span><span class="op" id="7871305">(</span><span class="ident" id="7871306">test</span><span class="op" id="7871310">.</span><span class="ident" id="7871311">key</span>&nbsp;<span class="op" id="7871315">+</span>&nbsp;<span class="ident" id="7871317">test</span><span class="op" id="7871321">.</span><span class="ident" id="7871322">cert</span><span class="op" id="7871326">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871330">if</span>&nbsp;<span class="ident" id="7871333">_</span><span class="op" id="7871334">,</span>&nbsp;<span class="ident" id="7871336">err</span>&nbsp;<span class="op" id="7871340">:=</span>&nbsp;<span class="ident" id="7871343">X509KeyPair</span><span class="op" id="7871354">(</span><span class="ident" id="7871355">pem</span><span class="op" id="7871358">,</span>&nbsp;<span class="ident" id="7871360">pem</span><span class="op" id="7871363">)</span><span class="op" id="7871364">;</span>&nbsp;<span class="ident" id="7871366">err</span>&nbsp;<span class="op" id="7871370">!=</span>&nbsp;<span class="ident" id="7871373">nil</span>&nbsp;<span class="op" id="7871377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871382">t</span><span class="op" id="7871383">.</span><span class="ident" id="7871384">Errorf</span><span class="op" id="7871390">(</span><span class="string" id="7871391">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;key&nbsp;followed&nbsp;by&nbsp;%s&nbsp;cert:&nbsp;%s&#34;</span><span class="op" id="7871438">,</span>&nbsp;<span class="ident" id="7871440">test</span><span class="op" id="7871444">.</span><span class="ident" id="7871445">algo</span><span class="op" id="7871449">,</span>&nbsp;<span class="ident" id="7871451">test</span><span class="op" id="7871455">.</span><span class="ident" id="7871456">algo</span><span class="op" id="7871460">,</span>&nbsp;<span class="ident" id="7871462">err</span><span class="op" id="7871465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871472">}</span><br>
<span class="lineno"></span><span class="op" id="7871474">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7871477">func</span>&nbsp;<span class="ident" id="7871482">TestX509MixedKeyPair</span><span class="op" id="7871502">(</span><span class="ident" id="7871503">t</span>&nbsp;<span class="op" id="7871505">*</span><span class="ident" id="7871506">testing</span><span class="op" id="7871513">.</span><span class="ident" id="7871514">T</span><span class="op" id="7871515">)</span>&nbsp;<span class="op" id="7871517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871520">if</span>&nbsp;<span class="ident" id="7871523">_</span><span class="op" id="7871524">,</span>&nbsp;<span class="ident" id="7871526">err</span>&nbsp;<span class="op" id="7871530">:=</span>&nbsp;<span class="ident" id="7871533">X509KeyPair</span><span class="op" id="7871544">(</span><span class="op" id="7871545">[</span><span class="op" id="7871546">]</span><span class="builtintype" id="7871547">byte</span><span class="op" id="7871551">(</span><span class="ident" id="7871552">rsaCertPEM</span><span class="op" id="7871562">)</span><span class="op" id="7871563">,</span>&nbsp;<span class="op" id="7871565">[</span><span class="op" id="7871566">]</span><span class="builtintype" id="7871567">byte</span><span class="op" id="7871571">(</span><span class="ident" id="7871572">ecdsaKeyPEM</span><span class="op" id="7871583">)</span><span class="op" id="7871584">)</span><span class="op" id="7871585">;</span>&nbsp;<span class="ident" id="7871587">err</span>&nbsp;<span class="op" id="7871591">==</span>&nbsp;<span class="ident" id="7871594">nil</span>&nbsp;<span class="op" id="7871598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871602">t</span><span class="op" id="7871603">.</span><span class="ident" id="7871604">Error</span><span class="op" id="7871609">(</span><span class="string" id="7871610">&#34;Load&nbsp;of&nbsp;RSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;ECDSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="7871668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871671">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871674">if</span>&nbsp;<span class="ident" id="7871677">_</span><span class="op" id="7871678">,</span>&nbsp;<span class="ident" id="7871680">err</span>&nbsp;<span class="op" id="7871684">:=</span>&nbsp;<span class="ident" id="7871687">X509KeyPair</span><span class="op" id="7871698">(</span><span class="op" id="7871699">[</span><span class="op" id="7871700">]</span><span class="builtintype" id="7871701">byte</span><span class="op" id="7871705">(</span><span class="ident" id="7871706">ecdsaCertPEM</span><span class="op" id="7871718">)</span><span class="op" id="7871719">,</span>&nbsp;<span class="op" id="7871721">[</span><span class="op" id="7871722">]</span><span class="builtintype" id="7871723">byte</span><span class="op" id="7871727">(</span><span class="ident" id="7871728">rsaKeyPEM</span><span class="op" id="7871737">)</span><span class="op" id="7871738">)</span><span class="op" id="7871739">;</span>&nbsp;<span class="ident" id="7871741">err</span>&nbsp;<span class="op" id="7871745">==</span>&nbsp;<span class="ident" id="7871748">nil</span>&nbsp;<span class="op" id="7871752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871756">t</span><span class="op" id="7871757">.</span><span class="ident" id="7871758">Error</span><span class="op" id="7871763">(</span><span class="string" id="7871764">&#34;Load&nbsp;of&nbsp;ECDSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;RSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="7871822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871825">}</span><br>
<span class="lineno"></span><span class="op" id="7871827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="7871830">func</span>&nbsp;<span class="ident" id="7871835">newLocalListener</span><span class="op" id="7871851">(</span><span class="ident" id="7871852">t</span>&nbsp;<span class="op" id="7871854">*</span><span class="ident" id="7871855">testing</span><span class="op" id="7871862">.</span><span class="ident" id="7871863">T</span><span class="op" id="7871864">)</span>&nbsp;<span class="ident" id="7871866">net</span><span class="op" id="7871869">.</span><span class="ident" id="7871870">Listener</span>&nbsp;<span class="op" id="7871879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871882">ln</span><span class="op" id="7871884">,</span>&nbsp;<span class="ident" id="7871886">err</span>&nbsp;<span class="op" id="7871890">:=</span>&nbsp;<span class="ident" id="7871893">net</span><span class="op" id="7871896">.</span><span class="ident" id="7871897">Listen</span><span class="op" id="7871903">(</span><span class="string" id="7871904">&#34;tcp&#34;</span><span class="op" id="7871909">,</span>&nbsp;<span class="string" id="7871911">&#34;127.0.0.1:0&#34;</span><span class="op" id="7871924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871927">if</span>&nbsp;<span class="ident" id="7871930">err</span>&nbsp;<span class="op" id="7871934">!=</span>&nbsp;<span class="ident" id="7871937">nil</span>&nbsp;<span class="op" id="7871941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7871945">ln</span><span class="op" id="7871947">,</span>&nbsp;<span class="ident" id="7871949">err</span>&nbsp;<span class="op" id="7871953">=</span>&nbsp;<span class="ident" id="7871955">net</span><span class="op" id="7871958">.</span><span class="ident" id="7871959">Listen</span><span class="op" id="7871965">(</span><span class="string" id="7871966">&#34;tcp6&#34;</span><span class="op" id="7871972">,</span>&nbsp;<span class="string" id="7871974">&#34;[::1]:0&#34;</span><span class="op" id="7871983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7871986">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7871989">if</span>&nbsp;<span class="ident" id="7871992">err</span>&nbsp;<span class="op" id="7871996">!=</span>&nbsp;<span class="ident" id="7871999">nil</span>&nbsp;<span class="op" id="7872003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872007">t</span><span class="op" id="7872008">.</span><span class="ident" id="7872009">Fatal</span><span class="op" id="7872014">(</span><span class="ident" id="7872015">err</span><span class="op" id="7872018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872024">return</span>&nbsp;<span class="ident" id="7872031">ln</span><br>
<span class="lineno"></span><span class="op" id="7872034">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7872037">func</span>&nbsp;<span class="ident" id="7872042">TestDialTimeout</span><span class="op" id="7872057">(</span><span class="ident" id="7872058">t</span>&nbsp;<span class="op" id="7872060">*</span><span class="ident" id="7872061">testing</span><span class="op" id="7872068">.</span><span class="ident" id="7872069">T</span><span class="op" id="7872070">)</span>&nbsp;<span class="op" id="7872072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872075">if</span>&nbsp;<span class="ident" id="7872078">testing</span><span class="op" id="7872085">.</span><span class="ident" id="7872086">Short</span><span class="op" id="7872091">(</span><span class="op" id="7872092">)</span>&nbsp;<span class="op" id="7872094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872098">t</span><span class="op" id="7872099">.</span><span class="ident" id="7872100">Skip</span><span class="op" id="7872104">(</span><span class="string" id="7872105">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7872129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872132">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872135">listener</span>&nbsp;<span class="op" id="7872144">:=</span>&nbsp;<span class="ident" id="7872147">newLocalListener</span><span class="op" id="7872163">(</span><span class="ident" id="7872164">t</span><span class="op" id="7872165">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872169">addr</span>&nbsp;<span class="op" id="7872174">:=</span>&nbsp;<span class="ident" id="7872177">listener</span><span class="op" id="7872185">.</span><span class="ident" id="7872186">Addr</span><span class="op" id="7872190">(</span><span class="op" id="7872191">)</span><span class="op" id="7872192">.</span><span class="ident" id="7872193">String</span><span class="op" id="7872199">(</span><span class="op" id="7872200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872203">defer</span>&nbsp;<span class="ident" id="7872209">listener</span><span class="op" id="7872217">.</span><span class="ident" id="7872218">Close</span><span class="op" id="7872223">(</span><span class="op" id="7872224">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872228">complete</span>&nbsp;<span class="op" id="7872237">:=</span>&nbsp;<span class="builtinfunc" id="7872240">make</span><span class="op" id="7872244">(</span><span class="keyword" id="7872245">chan</span>&nbsp;<span class="builtintype" id="7872250">bool</span><span class="op" id="7872254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872257">defer</span>&nbsp;<span class="builtinfunc" id="7872263">close</span><span class="op" id="7872268">(</span><span class="ident" id="7872269">complete</span><span class="op" id="7872277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872281">go</span>&nbsp;<span class="keyword" id="7872284">func</span><span class="op" id="7872288">(</span><span class="op" id="7872289">)</span>&nbsp;<span class="op" id="7872291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872295">conn</span><span class="op" id="7872299">,</span>&nbsp;<span class="ident" id="7872301">err</span>&nbsp;<span class="op" id="7872305">:=</span>&nbsp;<span class="ident" id="7872308">listener</span><span class="op" id="7872316">.</span><span class="ident" id="7872317">Accept</span><span class="op" id="7872323">(</span><span class="op" id="7872324">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872328">if</span>&nbsp;<span class="ident" id="7872331">err</span>&nbsp;<span class="op" id="7872335">!=</span>&nbsp;<span class="ident" id="7872338">nil</span>&nbsp;<span class="op" id="7872342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872347">t</span><span class="op" id="7872348">.</span><span class="ident" id="7872349">Error</span><span class="op" id="7872354">(</span><span class="ident" id="7872355">err</span><span class="op" id="7872358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872363">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872376">&lt;-</span><span class="ident" id="7872378">complete</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872389">conn</span><span class="op" id="7872393">.</span><span class="ident" id="7872394">Close</span><span class="op" id="7872399">(</span><span class="op" id="7872400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872403">}</span><span class="op" id="7872404">(</span><span class="op" id="7872405">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872409">dialer</span>&nbsp;<span class="op" id="7872416">:=</span>&nbsp;<span class="op" id="7872419">&amp;</span><span class="ident" id="7872420">net</span><span class="op" id="7872423">.</span><span class="ident" id="7872424">Dialer</span><span class="op" id="7872430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872434">Timeout</span><span class="op" id="7872441">:</span>&nbsp;<span class="num" id="7872443">10</span>&nbsp;<span class="op" id="7872446">*</span>&nbsp;<span class="ident" id="7872448">time</span><span class="op" id="7872452">.</span><span class="ident" id="7872453">Millisecond</span><span class="op" id="7872464">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872471">var</span>&nbsp;<span class="ident" id="7872475">err</span>&nbsp;<span class="builtintype" id="7872479">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872486">if</span>&nbsp;<span class="ident" id="7872489">_</span><span class="op" id="7872490">,</span>&nbsp;<span class="ident" id="7872492">err</span>&nbsp;<span class="op" id="7872496">=</span>&nbsp;<span class="ident" id="7872498">DialWithDialer</span><span class="op" id="7872512">(</span><span class="ident" id="7872513">dialer</span><span class="op" id="7872519">,</span>&nbsp;<span class="string" id="7872521">&#34;tcp&#34;</span><span class="op" id="7872526">,</span>&nbsp;<span class="ident" id="7872528">addr</span><span class="op" id="7872532">,</span>&nbsp;<span class="ident" id="7872534">nil</span><span class="op" id="7872537">)</span><span class="op" id="7872538">;</span>&nbsp;<span class="ident" id="7872540">err</span>&nbsp;<span class="op" id="7872544">==</span>&nbsp;<span class="ident" id="7872547">nil</span>&nbsp;<span class="op" id="7872551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872555">t</span><span class="op" id="7872556">.</span><span class="ident" id="7872557">Fatal</span><span class="op" id="7872562">(</span><span class="string" id="7872563">&#34;DialWithTimeout&nbsp;completed&nbsp;successfully&#34;</span><span class="op" id="7872603">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7872610">if</span>&nbsp;<span class="op" id="7872613">!</span><span class="ident" id="7872614">strings</span><span class="op" id="7872621">.</span><span class="ident" id="7872622">Contains</span><span class="op" id="7872630">(</span><span class="ident" id="7872631">err</span><span class="op" id="7872634">.</span><span class="ident" id="7872635">Error</span><span class="op" id="7872640">(</span><span class="op" id="7872641">)</span><span class="op" id="7872642">,</span>&nbsp;<span class="string" id="7872644">&#34;timed&nbsp;out&#34;</span><span class="op" id="7872655">)</span>&nbsp;<span class="op" id="7872657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7872661">t</span><span class="op" id="7872662">.</span><span class="ident" id="7872663">Errorf</span><span class="op" id="7872669">(</span><span class="string" id="7872670">&#34;resulting&nbsp;error&nbsp;not&nbsp;a&nbsp;timeout:&nbsp;%s&#34;</span><span class="op" id="7872705">,</span>&nbsp;<span class="ident" id="7872707">err</span><span class="op" id="7872710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7872713">}</span><br>
<span class="lineno">160</span><span class="op" id="7872715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7872718">//&nbsp;tests&nbsp;that&nbsp;Conn.Read&nbsp;returns&nbsp;(non-zero,&nbsp;io.EOF)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="7872780">//&nbsp;(non-zero,&nbsp;nil)&nbsp;when&nbsp;a&nbsp;Close&nbsp;(alertCloseNotify)&nbsp;is&nbsp;sitting&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="7872848">//&nbsp;behind&nbsp;the&nbsp;application&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">165</span><span class="keyword" id="7872894">func</span>&nbsp;<span class="ident" id="7872899">TestConnReadNonzeroAndEOF</span><span class="op" id="7872924">(</span><span class="ident" id="7872925">t</span>&nbsp;<span class="op" id="7872927">*</span><span class="ident" id="7872928">testing</span><span class="op" id="7872935">.</span><span class="ident" id="7872936">T</span><span class="op" id="7872937">)</span>&nbsp;<span class="op" id="7872939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7872942">//&nbsp;This&nbsp;test&nbsp;is&nbsp;racy:&nbsp;it&nbsp;assumes&nbsp;that&nbsp;after&nbsp;a&nbsp;write&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7873000">//&nbsp;localhost&nbsp;TCP&nbsp;connection,&nbsp;the&nbsp;peer&nbsp;TCP&nbsp;connection&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7873058">//&nbsp;immediately&nbsp;read&nbsp;it.&nbsp;&nbsp;Because&nbsp;it&#39;s&nbsp;racy,&nbsp;we&nbsp;skip&nbsp;this&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7873121">//&nbsp;in&nbsp;short&nbsp;mode,&nbsp;and&nbsp;then&nbsp;retry&nbsp;it&nbsp;several&nbsp;times&nbsp;with&nbsp;an</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7873180">//&nbsp;increasing&nbsp;sleep&nbsp;in&nbsp;between&nbsp;our&nbsp;final&nbsp;write&nbsp;(via&nbsp;srv.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7873243">//&nbsp;below)&nbsp;and&nbsp;the&nbsp;following&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873278">if</span>&nbsp;<span class="ident" id="7873281">testing</span><span class="op" id="7873288">.</span><span class="ident" id="7873289">Short</span><span class="op" id="7873294">(</span><span class="op" id="7873295">)</span>&nbsp;<span class="op" id="7873297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873301">t</span><span class="op" id="7873302">.</span><span class="ident" id="7873303">Skip</span><span class="op" id="7873307">(</span><span class="string" id="7873308">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7873332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873335">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873338">var</span>&nbsp;<span class="ident" id="7873342">err</span>&nbsp;<span class="builtintype" id="7873346">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873353">for</span>&nbsp;<span class="ident" id="7873357">delay</span>&nbsp;<span class="op" id="7873363">:=</span>&nbsp;<span class="ident" id="7873366">time</span><span class="op" id="7873370">.</span><span class="ident" id="7873371">Millisecond</span><span class="op" id="7873382">;</span>&nbsp;<span class="ident" id="7873384">delay</span>&nbsp;<span class="op" id="7873390">&lt;=</span>&nbsp;<span class="num" id="7873393">64</span><span class="op" id="7873395">*</span><span class="ident" id="7873396">time</span><span class="op" id="7873400">.</span><span class="ident" id="7873401">Millisecond</span><span class="op" id="7873412">;</span>&nbsp;<span class="ident" id="7873414">delay</span>&nbsp;<span class="op" id="7873420">*=</span>&nbsp;<span class="num" id="7873423">2</span>&nbsp;<span class="op" id="7873425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873429">if</span>&nbsp;<span class="ident" id="7873432">err</span>&nbsp;<span class="op" id="7873436">=</span>&nbsp;<span class="ident" id="7873438">testConnReadNonzeroAndEOF</span><span class="op" id="7873463">(</span><span class="ident" id="7873464">t</span><span class="op" id="7873465">,</span>&nbsp;<span class="ident" id="7873467">delay</span><span class="op" id="7873472">)</span><span class="op" id="7873473">;</span>&nbsp;<span class="ident" id="7873475">err</span>&nbsp;<span class="op" id="7873479">==</span>&nbsp;<span class="ident" id="7873482">nil</span>&nbsp;<span class="op" id="7873486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873491">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873500">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873506">t</span><span class="op" id="7873507">.</span><span class="ident" id="7873508">Error</span><span class="op" id="7873513">(</span><span class="ident" id="7873514">err</span><span class="op" id="7873517">)</span><br>
<span class="lineno"></span><span class="op" id="7873519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7873522">func</span>&nbsp;<span class="ident" id="7873527">testConnReadNonzeroAndEOF</span><span class="op" id="7873552">(</span><span class="ident" id="7873553">t</span>&nbsp;<span class="op" id="7873555">*</span><span class="ident" id="7873556">testing</span><span class="op" id="7873563">.</span><span class="ident" id="7873564">T</span><span class="op" id="7873565">,</span>&nbsp;<span class="ident" id="7873567">delay</span>&nbsp;<span class="ident" id="7873573">time</span><span class="op" id="7873577">.</span><span class="ident" id="7873578">Duration</span><span class="op" id="7873586">)</span>&nbsp;<span class="builtintype" id="7873588">error</span>&nbsp;<span class="op" id="7873594">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873597">ln</span>&nbsp;<span class="op" id="7873600">:=</span>&nbsp;<span class="ident" id="7873603">newLocalListener</span><span class="op" id="7873619">(</span><span class="ident" id="7873620">t</span><span class="op" id="7873621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873624">defer</span>&nbsp;<span class="ident" id="7873630">ln</span><span class="op" id="7873632">.</span><span class="ident" id="7873633">Close</span><span class="op" id="7873638">(</span><span class="op" id="7873639">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873643">srvCh</span>&nbsp;<span class="op" id="7873649">:=</span>&nbsp;<span class="builtinfunc" id="7873652">make</span><span class="op" id="7873656">(</span><span class="keyword" id="7873657">chan</span>&nbsp;<span class="op" id="7873662">*</span><span class="ident" id="7873663">Conn</span><span class="op" id="7873667">,</span>&nbsp;<span class="num" id="7873669">1</span><span class="op" id="7873670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873673">var</span>&nbsp;<span class="ident" id="7873677">serr</span>&nbsp;<span class="builtintype" id="7873682">error</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873689">go</span>&nbsp;<span class="keyword" id="7873692">func</span><span class="op" id="7873696">(</span><span class="op" id="7873697">)</span>&nbsp;<span class="op" id="7873699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873703">sconn</span><span class="op" id="7873708">,</span>&nbsp;<span class="ident" id="7873710">err</span>&nbsp;<span class="op" id="7873714">:=</span>&nbsp;<span class="ident" id="7873717">ln</span><span class="op" id="7873719">.</span><span class="ident" id="7873720">Accept</span><span class="op" id="7873726">(</span><span class="op" id="7873727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873731">if</span>&nbsp;<span class="ident" id="7873734">err</span>&nbsp;<span class="op" id="7873738">!=</span>&nbsp;<span class="ident" id="7873741">nil</span>&nbsp;<span class="op" id="7873745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873750">serr</span>&nbsp;<span class="op" id="7873755">=</span>&nbsp;<span class="ident" id="7873757">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873764">srvCh</span>&nbsp;<span class="op" id="7873770">&lt;-</span>&nbsp;<span class="ident" id="7873773">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873780">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873793">serverConfig</span>&nbsp;<span class="op" id="7873806">:=</span>&nbsp;<span class="op" id="7873809">*</span><span class="ident" id="7873810">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873823">srv</span>&nbsp;<span class="op" id="7873827">:=</span>&nbsp;<span class="ident" id="7873830">Server</span><span class="op" id="7873836">(</span><span class="ident" id="7873837">sconn</span><span class="op" id="7873842">,</span>&nbsp;<span class="op" id="7873844">&amp;</span><span class="ident" id="7873845">serverConfig</span><span class="op" id="7873857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873861">if</span>&nbsp;<span class="ident" id="7873864">err</span>&nbsp;<span class="op" id="7873868">:=</span>&nbsp;<span class="ident" id="7873871">srv</span><span class="op" id="7873874">.</span><span class="ident" id="7873875">Handshake</span><span class="op" id="7873884">(</span><span class="op" id="7873885">)</span><span class="op" id="7873886">;</span>&nbsp;<span class="ident" id="7873888">err</span>&nbsp;<span class="op" id="7873892">!=</span>&nbsp;<span class="ident" id="7873895">nil</span>&nbsp;<span class="op" id="7873899">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873904">serr</span>&nbsp;<span class="op" id="7873909">=</span>&nbsp;<span class="ident" id="7873911">fmt</span><span class="op" id="7873914">.</span><span class="ident" id="7873915">Errorf</span><span class="op" id="7873921">(</span><span class="string" id="7873922">&#34;handshake:&nbsp;%v&#34;</span><span class="op" id="7873937">,</span>&nbsp;<span class="ident" id="7873939">err</span><span class="op" id="7873942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873947">srvCh</span>&nbsp;<span class="op" id="7873953">&lt;-</span>&nbsp;<span class="ident" id="7873956">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7873963">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873976">srvCh</span>&nbsp;<span class="op" id="7873982">&lt;-</span>&nbsp;<span class="ident" id="7873985">srv</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7873990">}</span><span class="op" id="7873991">(</span><span class="op" id="7873992">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7873996">clientConfig</span>&nbsp;<span class="op" id="7874009">:=</span>&nbsp;<span class="op" id="7874012">*</span><span class="ident" id="7874013">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874025">conn</span><span class="op" id="7874029">,</span>&nbsp;<span class="ident" id="7874031">err</span>&nbsp;<span class="op" id="7874035">:=</span>&nbsp;<span class="ident" id="7874038">Dial</span><span class="op" id="7874042">(</span><span class="string" id="7874043">&#34;tcp&#34;</span><span class="op" id="7874048">,</span>&nbsp;<span class="ident" id="7874050">ln</span><span class="op" id="7874052">.</span><span class="ident" id="7874053">Addr</span><span class="op" id="7874057">(</span><span class="op" id="7874058">)</span><span class="op" id="7874059">.</span><span class="ident" id="7874060">String</span><span class="op" id="7874066">(</span><span class="op" id="7874067">)</span><span class="op" id="7874068">,</span>&nbsp;<span class="op" id="7874070">&amp;</span><span class="ident" id="7874071">clientConfig</span><span class="op" id="7874083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874086">if</span>&nbsp;<span class="ident" id="7874089">err</span>&nbsp;<span class="op" id="7874093">!=</span>&nbsp;<span class="ident" id="7874096">nil</span>&nbsp;<span class="op" id="7874100">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874104">t</span><span class="op" id="7874105">.</span><span class="ident" id="7874106">Fatal</span><span class="op" id="7874111">(</span><span class="ident" id="7874112">err</span><span class="op" id="7874115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874121">defer</span>&nbsp;<span class="ident" id="7874127">conn</span><span class="op" id="7874131">.</span><span class="ident" id="7874132">Close</span><span class="op" id="7874137">(</span><span class="op" id="7874138">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874142">srv</span>&nbsp;<span class="op" id="7874146">:=</span>&nbsp;<span class="op" id="7874149">&lt;-</span><span class="ident" id="7874151">srvCh</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874158">if</span>&nbsp;<span class="ident" id="7874161">srv</span>&nbsp;<span class="op" id="7874165">==</span>&nbsp;<span class="ident" id="7874168">nil</span>&nbsp;<span class="op" id="7874172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874176">return</span>&nbsp;<span class="ident" id="7874183">serr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874193">buf</span>&nbsp;<span class="op" id="7874197">:=</span>&nbsp;<span class="builtinfunc" id="7874200">make</span><span class="op" id="7874204">(</span><span class="op" id="7874205">[</span><span class="op" id="7874206">]</span><span class="builtintype" id="7874207">byte</span><span class="op" id="7874211">,</span>&nbsp;<span class="num" id="7874213">6</span><span class="op" id="7874214">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874218">srv</span><span class="op" id="7874221">.</span><span class="ident" id="7874222">Write</span><span class="op" id="7874227">(</span><span class="op" id="7874228">[</span><span class="op" id="7874229">]</span><span class="builtintype" id="7874230">byte</span><span class="op" id="7874234">(</span><span class="string" id="7874235">&#34;foobar&#34;</span><span class="op" id="7874243">)</span><span class="op" id="7874244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874247">n</span><span class="op" id="7874248">,</span>&nbsp;<span class="ident" id="7874250">err</span>&nbsp;<span class="op" id="7874254">:=</span>&nbsp;<span class="ident" id="7874257">conn</span><span class="op" id="7874261">.</span><span class="ident" id="7874262">Read</span><span class="op" id="7874266">(</span><span class="ident" id="7874267">buf</span><span class="op" id="7874270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874273">if</span>&nbsp;<span class="ident" id="7874276">n</span>&nbsp;<span class="op" id="7874278">!=</span>&nbsp;<span class="num" id="7874281">6</span>&nbsp;<span class="op" id="7874283">||</span>&nbsp;<span class="ident" id="7874286">err</span>&nbsp;<span class="op" id="7874290">!=</span>&nbsp;<span class="ident" id="7874293">nil</span>&nbsp;<span class="op" id="7874297">||</span>&nbsp;<span class="builtintype" id="7874300">string</span><span class="op" id="7874306">(</span><span class="ident" id="7874307">buf</span><span class="op" id="7874310">)</span>&nbsp;<span class="op" id="7874312">!=</span>&nbsp;<span class="string" id="7874315">&#34;foobar&#34;</span>&nbsp;<span class="op" id="7874324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874328">return</span>&nbsp;<span class="ident" id="7874335">fmt</span><span class="op" id="7874338">.</span><span class="ident" id="7874339">Errorf</span><span class="op" id="7874345">(</span><span class="string" id="7874346">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;data&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;nil,&nbsp;foobar&#34;</span><span class="op" id="7874391">,</span>&nbsp;<span class="ident" id="7874393">n</span><span class="op" id="7874394">,</span>&nbsp;<span class="ident" id="7874396">err</span><span class="op" id="7874399">,</span>&nbsp;<span class="ident" id="7874401">buf</span><span class="op" id="7874404">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874411">srv</span><span class="op" id="7874414">.</span><span class="ident" id="7874415">Write</span><span class="op" id="7874420">(</span><span class="op" id="7874421">[</span><span class="op" id="7874422">]</span><span class="builtintype" id="7874423">byte</span><span class="op" id="7874427">(</span><span class="string" id="7874428">&#34;abcdef&#34;</span><span class="op" id="7874436">)</span><span class="op" id="7874437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874440">srv</span><span class="op" id="7874443">.</span><span class="ident" id="7874444">Close</span><span class="op" id="7874449">(</span><span class="op" id="7874450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874453">time</span><span class="op" id="7874457">.</span><span class="ident" id="7874458">Sleep</span><span class="op" id="7874463">(</span><span class="ident" id="7874464">delay</span><span class="op" id="7874469">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874472">n</span><span class="op" id="7874473">,</span>&nbsp;<span class="ident" id="7874475">err</span>&nbsp;<span class="op" id="7874479">=</span>&nbsp;<span class="ident" id="7874481">conn</span><span class="op" id="7874485">.</span><span class="ident" id="7874486">Read</span><span class="op" id="7874490">(</span><span class="ident" id="7874491">buf</span><span class="op" id="7874494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874497">if</span>&nbsp;<span class="ident" id="7874500">n</span>&nbsp;<span class="op" id="7874502">!=</span>&nbsp;<span class="num" id="7874505">6</span>&nbsp;<span class="op" id="7874507">||</span>&nbsp;<span class="builtintype" id="7874510">string</span><span class="op" id="7874516">(</span><span class="ident" id="7874517">buf</span><span class="op" id="7874520">)</span>&nbsp;<span class="op" id="7874522">!=</span>&nbsp;<span class="string" id="7874525">&#34;abcdef&#34;</span>&nbsp;<span class="op" id="7874534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874538">return</span>&nbsp;<span class="ident" id="7874545">fmt</span><span class="op" id="7874548">.</span><span class="ident" id="7874549">Errorf</span><span class="op" id="7874555">(</span><span class="string" id="7874556">&#34;Read&nbsp;=&nbsp;%d,&nbsp;buf=&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;abcdef&#34;</span><span class="op" id="7874592">,</span>&nbsp;<span class="ident" id="7874594">n</span><span class="op" id="7874595">,</span>&nbsp;<span class="ident" id="7874597">buf</span><span class="op" id="7874600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874606">if</span>&nbsp;<span class="ident" id="7874609">err</span>&nbsp;<span class="op" id="7874613">!=</span>&nbsp;<span class="ident" id="7874616">io</span><span class="op" id="7874618">.</span><span class="ident" id="7874619">EOF</span>&nbsp;<span class="op" id="7874623">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874627">return</span>&nbsp;<span class="ident" id="7874634">fmt</span><span class="op" id="7874637">.</span><span class="ident" id="7874638">Errorf</span><span class="op" id="7874644">(</span><span class="string" id="7874645">&#34;Second&nbsp;Read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7874682">,</span>&nbsp;<span class="ident" id="7874684">err</span><span class="op" id="7874687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874693">return</span>&nbsp;<span class="ident" id="7874700">nil</span><br>
<span class="lineno"></span><span class="op" id="7874704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7874707">func</span>&nbsp;<span class="ident" id="7874712">TestTLSUniqueMatches</span><span class="op" id="7874732">(</span><span class="ident" id="7874733">t</span>&nbsp;<span class="op" id="7874735">*</span><span class="ident" id="7874736">testing</span><span class="op" id="7874743">.</span><span class="ident" id="7874744">T</span><span class="op" id="7874745">)</span>&nbsp;<span class="op" id="7874747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874750">ln</span>&nbsp;<span class="op" id="7874753">:=</span>&nbsp;<span class="ident" id="7874756">newLocalListener</span><span class="op" id="7874772">(</span><span class="ident" id="7874773">t</span><span class="op" id="7874774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874777">defer</span>&nbsp;<span class="ident" id="7874783">ln</span><span class="op" id="7874785">.</span><span class="ident" id="7874786">Close</span><span class="op" id="7874791">(</span><span class="op" id="7874792">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874796">serverTLSUniques</span>&nbsp;<span class="op" id="7874813">:=</span>&nbsp;<span class="builtinfunc" id="7874816">make</span><span class="op" id="7874820">(</span><span class="keyword" id="7874821">chan</span>&nbsp;<span class="op" id="7874826">[</span><span class="op" id="7874827">]</span><span class="builtintype" id="7874828">byte</span><span class="op" id="7874832">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874835">go</span>&nbsp;<span class="keyword" id="7874838">func</span><span class="op" id="7874842">(</span><span class="op" id="7874843">)</span>&nbsp;<span class="op" id="7874845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874849">for</span>&nbsp;<span class="ident" id="7874853">i</span>&nbsp;<span class="op" id="7874855">:=</span>&nbsp;<span class="num" id="7874858">0</span><span class="op" id="7874859">;</span>&nbsp;<span class="ident" id="7874861">i</span>&nbsp;<span class="op" id="7874863">&lt;</span>&nbsp;<span class="num" id="7874865">2</span><span class="op" id="7874866">;</span>&nbsp;<span class="ident" id="7874868">i</span><span class="op" id="7874869">++</span>&nbsp;<span class="op" id="7874872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874877">sconn</span><span class="op" id="7874882">,</span>&nbsp;<span class="ident" id="7874884">err</span>&nbsp;<span class="op" id="7874888">:=</span>&nbsp;<span class="ident" id="7874891">ln</span><span class="op" id="7874893">.</span><span class="ident" id="7874894">Accept</span><span class="op" id="7874900">(</span><span class="op" id="7874901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7874906">if</span>&nbsp;<span class="ident" id="7874909">err</span>&nbsp;<span class="op" id="7874913">!=</span>&nbsp;<span class="ident" id="7874916">nil</span>&nbsp;<span class="op" id="7874920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874926">t</span><span class="op" id="7874927">.</span><span class="ident" id="7874928">Fatal</span><span class="op" id="7874933">(</span><span class="ident" id="7874934">err</span><span class="op" id="7874937">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7874942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874947">serverConfig</span>&nbsp;<span class="op" id="7874960">:=</span>&nbsp;<span class="op" id="7874963">*</span><span class="ident" id="7874964">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7874978">srv</span>&nbsp;<span class="op" id="7874982">:=</span>&nbsp;<span class="ident" id="7874985">Server</span><span class="op" id="7874991">(</span><span class="ident" id="7874992">sconn</span><span class="op" id="7874997">,</span>&nbsp;<span class="op" id="7874999">&amp;</span><span class="ident" id="7875000">serverConfig</span><span class="op" id="7875012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875017">if</span>&nbsp;<span class="ident" id="7875020">err</span>&nbsp;<span class="op" id="7875024">:=</span>&nbsp;<span class="ident" id="7875027">srv</span><span class="op" id="7875030">.</span><span class="ident" id="7875031">Handshake</span><span class="op" id="7875040">(</span><span class="op" id="7875041">)</span><span class="op" id="7875042">;</span>&nbsp;<span class="ident" id="7875044">err</span>&nbsp;<span class="op" id="7875048">!=</span>&nbsp;<span class="ident" id="7875051">nil</span>&nbsp;<span class="op" id="7875055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875061">t</span><span class="op" id="7875062">.</span><span class="ident" id="7875063">Fatal</span><span class="op" id="7875068">(</span><span class="ident" id="7875069">err</span><span class="op" id="7875072">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875082">serverTLSUniques</span>&nbsp;<span class="op" id="7875099">&lt;-</span>&nbsp;<span class="ident" id="7875102">srv</span><span class="op" id="7875105">.</span><span class="ident" id="7875106">ConnectionState</span><span class="op" id="7875121">(</span><span class="op" id="7875122">)</span><span class="op" id="7875123">.</span><span class="ident" id="7875124">TLSUnique</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875139">}</span><span class="op" id="7875140">(</span><span class="op" id="7875141">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875145">clientConfig</span>&nbsp;<span class="op" id="7875158">:=</span>&nbsp;<span class="op" id="7875161">*</span><span class="ident" id="7875162">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875174">clientConfig</span><span class="op" id="7875186">.</span><span class="ident" id="7875187">ClientSessionCache</span>&nbsp;<span class="op" id="7875206">=</span>&nbsp;<span class="ident" id="7875208">NewLRUClientSessionCache</span><span class="op" id="7875232">(</span><span class="num" id="7875233">1</span><span class="op" id="7875234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875237">conn</span><span class="op" id="7875241">,</span>&nbsp;<span class="ident" id="7875243">err</span>&nbsp;<span class="op" id="7875247">:=</span>&nbsp;<span class="ident" id="7875250">Dial</span><span class="op" id="7875254">(</span><span class="string" id="7875255">&#34;tcp&#34;</span><span class="op" id="7875260">,</span>&nbsp;<span class="ident" id="7875262">ln</span><span class="op" id="7875264">.</span><span class="ident" id="7875265">Addr</span><span class="op" id="7875269">(</span><span class="op" id="7875270">)</span><span class="op" id="7875271">.</span><span class="ident" id="7875272">String</span><span class="op" id="7875278">(</span><span class="op" id="7875279">)</span><span class="op" id="7875280">,</span>&nbsp;<span class="op" id="7875282">&amp;</span><span class="ident" id="7875283">clientConfig</span><span class="op" id="7875295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875298">if</span>&nbsp;<span class="ident" id="7875301">err</span>&nbsp;<span class="op" id="7875305">!=</span>&nbsp;<span class="ident" id="7875308">nil</span>&nbsp;<span class="op" id="7875312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875316">t</span><span class="op" id="7875317">.</span><span class="ident" id="7875318">Fatal</span><span class="op" id="7875323">(</span><span class="ident" id="7875324">err</span><span class="op" id="7875327">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875333">if</span>&nbsp;<span class="op" id="7875336">!</span><span class="ident" id="7875337">bytes</span><span class="op" id="7875342">.</span><span class="ident" id="7875343">Equal</span><span class="op" id="7875348">(</span><span class="ident" id="7875349">conn</span><span class="op" id="7875353">.</span><span class="ident" id="7875354">ConnectionState</span><span class="op" id="7875369">(</span><span class="op" id="7875370">)</span><span class="op" id="7875371">.</span><span class="ident" id="7875372">TLSUnique</span><span class="op" id="7875381">,</span>&nbsp;<span class="op" id="7875383">&lt;-</span><span class="ident" id="7875385">serverTLSUniques</span><span class="op" id="7875401">)</span>&nbsp;<span class="op" id="7875403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875407">t</span><span class="op" id="7875408">.</span><span class="ident" id="7875409">Error</span><span class="op" id="7875414">(</span><span class="string" id="7875415">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&#34;</span><span class="op" id="7875458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875464">conn</span><span class="op" id="7875468">.</span><span class="ident" id="7875469">Close</span><span class="op" id="7875474">(</span><span class="op" id="7875475">)</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875479">conn</span><span class="op" id="7875483">,</span>&nbsp;<span class="ident" id="7875485">err</span>&nbsp;<span class="op" id="7875489">=</span>&nbsp;<span class="ident" id="7875491">Dial</span><span class="op" id="7875495">(</span><span class="string" id="7875496">&#34;tcp&#34;</span><span class="op" id="7875501">,</span>&nbsp;<span class="ident" id="7875503">ln</span><span class="op" id="7875505">.</span><span class="ident" id="7875506">Addr</span><span class="op" id="7875510">(</span><span class="op" id="7875511">)</span><span class="op" id="7875512">.</span><span class="ident" id="7875513">String</span><span class="op" id="7875519">(</span><span class="op" id="7875520">)</span><span class="op" id="7875521">,</span>&nbsp;<span class="op" id="7875523">&amp;</span><span class="ident" id="7875524">clientConfig</span><span class="op" id="7875536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875539">if</span>&nbsp;<span class="ident" id="7875542">err</span>&nbsp;<span class="op" id="7875546">!=</span>&nbsp;<span class="ident" id="7875549">nil</span>&nbsp;<span class="op" id="7875553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875557">t</span><span class="op" id="7875558">.</span><span class="ident" id="7875559">Fatal</span><span class="op" id="7875564">(</span><span class="ident" id="7875565">err</span><span class="op" id="7875568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875571">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875574">defer</span>&nbsp;<span class="ident" id="7875580">conn</span><span class="op" id="7875584">.</span><span class="ident" id="7875585">Close</span><span class="op" id="7875590">(</span><span class="op" id="7875591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875594">if</span>&nbsp;<span class="op" id="7875597">!</span><span class="ident" id="7875598">conn</span><span class="op" id="7875602">.</span><span class="ident" id="7875603">ConnectionState</span><span class="op" id="7875618">(</span><span class="op" id="7875619">)</span><span class="op" id="7875620">.</span><span class="ident" id="7875621">DidResume</span>&nbsp;<span class="op" id="7875631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875635">t</span><span class="op" id="7875636">.</span><span class="ident" id="7875637">Error</span><span class="op" id="7875642">(</span><span class="string" id="7875643">&#34;second&nbsp;session&nbsp;did&nbsp;not&nbsp;use&nbsp;resumption&#34;</span><span class="op" id="7875682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7875688">if</span>&nbsp;<span class="op" id="7875691">!</span><span class="ident" id="7875692">bytes</span><span class="op" id="7875697">.</span><span class="ident" id="7875698">Equal</span><span class="op" id="7875703">(</span><span class="ident" id="7875704">conn</span><span class="op" id="7875708">.</span><span class="ident" id="7875709">ConnectionState</span><span class="op" id="7875724">(</span><span class="op" id="7875725">)</span><span class="op" id="7875726">.</span><span class="ident" id="7875727">TLSUnique</span><span class="op" id="7875736">,</span>&nbsp;<span class="op" id="7875738">&lt;-</span><span class="ident" id="7875740">serverTLSUniques</span><span class="op" id="7875756">)</span>&nbsp;<span class="op" id="7875758">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7875762">t</span><span class="op" id="7875763">.</span><span class="ident" id="7875764">Error</span><span class="op" id="7875769">(</span><span class="string" id="7875770">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&nbsp;when&nbsp;session&nbsp;resumption&nbsp;is&nbsp;used&#34;</span><span class="op" id="7875845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7875848">}</span><br>
<span class="lineno"></span><span class="op" id="7875850">}</span>
</div>
</body>
</html>
