<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/zlib</h2>
<ul>
<li><a href="/gostd/compress/zlib/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/compress/zlib/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/zlib/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/zlib/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/zlib/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5987344">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5987399">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5987453">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5987504">package</span>&nbsp;<span class="ident" id="5987512">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5987518">import</span>&nbsp;<span class="op" id="5987525">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987528">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987546">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987553">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987561">&#34;hash/adler32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987577">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5987582">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5987585">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="5987665">//&nbsp;&#34;compress/zlib&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5987731">const</span>&nbsp;<span class="op" id="5987737">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987740">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987759">=</span>&nbsp;<span class="ident" id="5987761">flate</span><span class="op" id="5987766">.</span><span class="ident" id="5987767">NoCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987782">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987801">=</span>&nbsp;<span class="ident" id="5987803">flate</span><span class="op" id="5987808">.</span><span class="ident" id="5987809">BestSpeed</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987820">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987839">=</span>&nbsp;<span class="ident" id="5987841">flate</span><span class="op" id="5987846">.</span><span class="ident" id="5987847">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987864">DefaultCompression</span>&nbsp;<span class="op" id="5987883">=</span>&nbsp;<span class="ident" id="5987885">flate</span><span class="op" id="5987890">.</span><span class="ident" id="5987891">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="5987910">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5987913">//&nbsp;A&nbsp;Writer&nbsp;takes&nbsp;data&nbsp;written&nbsp;to&nbsp;it&nbsp;and&nbsp;writes&nbsp;the&nbsp;compressed</span><br>
<span class="lineno">25</span><span class="comment" id="5987976">//&nbsp;form&nbsp;of&nbsp;that&nbsp;data&nbsp;to&nbsp;an&nbsp;underlying&nbsp;writer&nbsp;(see&nbsp;NewWriter).</span><br>
<span class="lineno"></span><span class="keyword" id="5988038">type</span>&nbsp;<span class="ident" id="5988043">Writer</span>&nbsp;<span class="keyword" id="5988050">struct</span>&nbsp;<span class="op" id="5988057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988060">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988072">io</span><span class="op" id="5988074">.</span><span class="ident" id="5988075">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988083">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5988095">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988100">dict</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5988112">[</span><span class="op" id="5988113">]</span><span class="builtintype" id="5988114">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988120">compressor</span>&nbsp;&nbsp;<span class="op" id="5988132">*</span><span class="ident" id="5988133">flate</span><span class="op" id="5988138">.</span><span class="ident" id="5988139">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988147">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988159">hash</span><span class="op" id="5988163">.</span><span class="ident" id="5988164">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988172">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5988184">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988191">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5988203">[</span><span class="num" id="5988204">4</span><span class="op" id="5988205">]</span><span class="builtintype" id="5988206">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988212">wroteHeader</span>&nbsp;<span class="builtintype" id="5988224">bool</span><br>
<span class="lineno">35</span><span class="op" id="5988229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5988232">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="5988267">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="5988333">//</span><br>
<span class="lineno">40</span><span class="comment" id="5988336">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="5988417">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5988472">func</span>&nbsp;<span class="ident" id="5988477">NewWriter</span><span class="op" id="5988486">(</span><span class="ident" id="5988487">w</span>&nbsp;<span class="ident" id="5988489">io</span><span class="op" id="5988491">.</span><span class="ident" id="5988492">Writer</span><span class="op" id="5988498">)</span>&nbsp;<span class="op" id="5988500">*</span><span class="ident" id="5988501">Writer</span>&nbsp;<span class="op" id="5988508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988511">z</span><span class="op" id="5988512">,</span>&nbsp;<span class="ident" id="5988514">_</span>&nbsp;<span class="op" id="5988516">:=</span>&nbsp;<span class="ident" id="5988519">NewWriterLevelDict</span><span class="op" id="5988537">(</span><span class="ident" id="5988538">w</span><span class="op" id="5988539">,</span>&nbsp;<span class="ident" id="5988541">DefaultCompression</span><span class="op" id="5988559">,</span>&nbsp;<span class="ident" id="5988561">nil</span><span class="op" id="5988564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988567">return</span>&nbsp;<span class="ident" id="5988574">z</span><br>
<span class="lineno">45</span><span class="op" id="5988576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5988579">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="5988659">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="5988694">//</span><br>
<span class="lineno">50</span><span class="comment" id="5988697">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5988771">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5988847">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5988894">func</span>&nbsp;<span class="ident" id="5988899">NewWriterLevel</span><span class="op" id="5988913">(</span><span class="ident" id="5988914">w</span>&nbsp;<span class="ident" id="5988916">io</span><span class="op" id="5988918">.</span><span class="ident" id="5988919">Writer</span><span class="op" id="5988925">,</span>&nbsp;<span class="ident" id="5988927">level</span>&nbsp;<span class="builtintype" id="5988933">int</span><span class="op" id="5988936">)</span>&nbsp;<span class="op" id="5988938">(</span><span class="op" id="5988939">*</span><span class="ident" id="5988940">Writer</span><span class="op" id="5988946">,</span>&nbsp;<span class="builtintype" id="5988948">error</span><span class="op" id="5988953">)</span>&nbsp;<span class="op" id="5988955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988958">return</span>&nbsp;<span class="ident" id="5988965">NewWriterLevelDict</span><span class="op" id="5988983">(</span><span class="ident" id="5988984">w</span><span class="op" id="5988985">,</span>&nbsp;<span class="ident" id="5988987">level</span><span class="op" id="5988992">,</span>&nbsp;<span class="ident" id="5988994">nil</span><span class="op" id="5988997">)</span><br>
<span class="lineno">55</span><span class="op" id="5988999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5989002">//&nbsp;NewWriterLevelDict&nbsp;is&nbsp;like&nbsp;NewWriterLevel&nbsp;but&nbsp;specifies&nbsp;a&nbsp;dictionary&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5989077">//&nbsp;compress&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5989095">//</span><br>
<span class="lineno">60</span><span class="comment" id="5989098">//&nbsp;The&nbsp;dictionary&nbsp;may&nbsp;be&nbsp;nil.&nbsp;If&nbsp;not,&nbsp;its&nbsp;contents&nbsp;should&nbsp;not&nbsp;be&nbsp;modified&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="5989178">//&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="5989203">func</span>&nbsp;<span class="ident" id="5989208">NewWriterLevelDict</span><span class="op" id="5989226">(</span><span class="ident" id="5989227">w</span>&nbsp;<span class="ident" id="5989229">io</span><span class="op" id="5989231">.</span><span class="ident" id="5989232">Writer</span><span class="op" id="5989238">,</span>&nbsp;<span class="ident" id="5989240">level</span>&nbsp;<span class="builtintype" id="5989246">int</span><span class="op" id="5989249">,</span>&nbsp;<span class="ident" id="5989251">dict</span>&nbsp;<span class="op" id="5989256">[</span><span class="op" id="5989257">]</span><span class="builtintype" id="5989258">byte</span><span class="op" id="5989262">)</span>&nbsp;<span class="op" id="5989264">(</span><span class="op" id="5989265">*</span><span class="ident" id="5989266">Writer</span><span class="op" id="5989272">,</span>&nbsp;<span class="builtintype" id="5989274">error</span><span class="op" id="5989279">)</span>&nbsp;<span class="op" id="5989281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989284">if</span>&nbsp;<span class="ident" id="5989287">level</span>&nbsp;<span class="op" id="5989293">&lt;</span>&nbsp;<span class="ident" id="5989295">DefaultCompression</span>&nbsp;<span class="op" id="5989314">||</span>&nbsp;<span class="ident" id="5989317">level</span>&nbsp;<span class="op" id="5989323">&gt;</span>&nbsp;<span class="ident" id="5989325">BestCompression</span>&nbsp;<span class="op" id="5989341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989345">return</span>&nbsp;<span class="ident" id="5989352">nil</span><span class="op" id="5989355">,</span>&nbsp;<span class="ident" id="5989357">fmt</span><span class="op" id="5989360">.</span><span class="ident" id="5989361">Errorf</span><span class="op" id="5989367">(</span><span class="string" id="5989368">&#34;zlib:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="5989405">,</span>&nbsp;<span class="ident" id="5989407">level</span><span class="op" id="5989412">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989418">return</span>&nbsp;<span class="op" id="5989425">&amp;</span><span class="ident" id="5989426">Writer</span><span class="op" id="5989432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989436">w</span><span class="op" id="5989437">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989443">w</span><span class="op" id="5989444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989448">level</span><span class="op" id="5989453">:</span>&nbsp;<span class="ident" id="5989455">level</span><span class="op" id="5989460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989464">dict</span><span class="op" id="5989468">:</span>&nbsp;&nbsp;<span class="ident" id="5989471">dict</span><span class="op" id="5989475">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989478">}</span><span class="op" id="5989479">,</span>&nbsp;<span class="ident" id="5989481">nil</span><br>
<span class="lineno"></span><span class="op" id="5989485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5989488">//&nbsp;Reset&nbsp;clears&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;Writer&nbsp;z&nbsp;such&nbsp;that&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5989564">//&nbsp;initial&nbsp;state&nbsp;from&nbsp;NewWriterLevel&nbsp;or&nbsp;NewWriterLevelDict,&nbsp;but&nbsp;instead&nbsp;writing</span><br>
<span class="lineno">75</span><span class="comment" id="5989644">//&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5989653">func</span>&nbsp;<span class="op" id="5989658">(</span><span class="ident" id="5989659">z</span>&nbsp;<span class="op" id="5989661">*</span><span class="ident" id="5989662">Writer</span><span class="op" id="5989668">)</span>&nbsp;<span class="ident" id="5989670">Reset</span><span class="op" id="5989675">(</span><span class="ident" id="5989676">w</span>&nbsp;<span class="ident" id="5989678">io</span><span class="op" id="5989680">.</span><span class="ident" id="5989681">Writer</span><span class="op" id="5989687">)</span>&nbsp;<span class="op" id="5989689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989692">z</span><span class="op" id="5989693">.</span><span class="ident" id="5989694">w</span>&nbsp;<span class="op" id="5989696">=</span>&nbsp;<span class="ident" id="5989698">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5989701">//&nbsp;z.level&nbsp;and&nbsp;z.dict&nbsp;left&nbsp;unchanged.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989740">if</span>&nbsp;<span class="ident" id="5989743">z</span><span class="op" id="5989744">.</span><span class="ident" id="5989745">compressor</span>&nbsp;<span class="op" id="5989756">!=</span>&nbsp;<span class="ident" id="5989759">nil</span>&nbsp;<span class="op" id="5989763">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989767">z</span><span class="op" id="5989768">.</span><span class="ident" id="5989769">compressor</span><span class="op" id="5989779">.</span><span class="ident" id="5989780">Reset</span><span class="op" id="5989785">(</span><span class="ident" id="5989786">w</span><span class="op" id="5989787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989793">if</span>&nbsp;<span class="ident" id="5989796">z</span><span class="op" id="5989797">.</span><span class="ident" id="5989798">digest</span>&nbsp;<span class="op" id="5989805">!=</span>&nbsp;<span class="ident" id="5989808">nil</span>&nbsp;<span class="op" id="5989812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989816">z</span><span class="op" id="5989817">.</span><span class="ident" id="5989818">digest</span><span class="op" id="5989824">.</span><span class="ident" id="5989825">Reset</span><span class="op" id="5989830">(</span><span class="op" id="5989831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989834">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989837">z</span><span class="op" id="5989838">.</span><span class="ident" id="5989839">err</span>&nbsp;<span class="op" id="5989843">=</span>&nbsp;<span class="ident" id="5989845">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989850">z</span><span class="op" id="5989851">.</span><span class="ident" id="5989852">scratch</span>&nbsp;<span class="op" id="5989860">=</span>&nbsp;<span class="op" id="5989862">[</span><span class="num" id="5989863">4</span><span class="op" id="5989864">]</span><span class="builtintype" id="5989865">byte</span><span class="op" id="5989869">{</span><span class="op" id="5989870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989873">z</span><span class="op" id="5989874">.</span><span class="ident" id="5989875">wroteHeader</span>&nbsp;<span class="op" id="5989887">=</span>&nbsp;<span class="builtintype" id="5989889">false</span><br>
<span class="lineno"></span><span class="op" id="5989895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5989898">//&nbsp;writeHeader&nbsp;writes&nbsp;the&nbsp;ZLIB&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="5989937">func</span>&nbsp;<span class="op" id="5989942">(</span><span class="ident" id="5989943">z</span>&nbsp;<span class="op" id="5989945">*</span><span class="ident" id="5989946">Writer</span><span class="op" id="5989952">)</span>&nbsp;<span class="ident" id="5989954">writeHeader</span><span class="op" id="5989965">(</span><span class="op" id="5989966">)</span>&nbsp;<span class="op" id="5989968">(</span><span class="ident" id="5989969">err</span>&nbsp;<span class="builtintype" id="5989973">error</span><span class="op" id="5989978">)</span>&nbsp;<span class="op" id="5989980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989983">z</span><span class="op" id="5989984">.</span><span class="ident" id="5989985">wroteHeader</span>&nbsp;<span class="op" id="5989997">=</span>&nbsp;<span class="builtintype" id="5989999">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990005">//&nbsp;ZLIB&nbsp;has&nbsp;a&nbsp;two-byte&nbsp;header&nbsp;(as&nbsp;documented&nbsp;in&nbsp;RFC&nbsp;1950).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990065">//&nbsp;The&nbsp;first&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CINFO&nbsp;(compression&nbsp;info),&nbsp;which&nbsp;is&nbsp;7&nbsp;for&nbsp;the&nbsp;default&nbsp;deflate&nbsp;window&nbsp;size.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990170">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CM&nbsp;(compression&nbsp;method),&nbsp;which&nbsp;is&nbsp;8&nbsp;for&nbsp;deflate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990249">z</span><span class="op" id="5990250">.</span><span class="ident" id="5990251">scratch</span><span class="op" id="5990258">[</span><span class="num" id="5990259">0</span><span class="op" id="5990260">]</span>&nbsp;<span class="op" id="5990262">=</span>&nbsp;<span class="num" id="5990264">0x78</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990270">//&nbsp;The&nbsp;next&nbsp;two&nbsp;bits&nbsp;is&nbsp;the&nbsp;FLEVEL&nbsp;(compression&nbsp;level).&nbsp;The&nbsp;four&nbsp;values&nbsp;are:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990348">//&nbsp;0=fastest,&nbsp;1=fast,&nbsp;2=default,&nbsp;3=best.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990390">//&nbsp;The&nbsp;next&nbsp;bit,&nbsp;FDICT,&nbsp;is&nbsp;set&nbsp;if&nbsp;a&nbsp;dictionary&nbsp;is&nbsp;given.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990448">//&nbsp;The&nbsp;final&nbsp;five&nbsp;FCHECK&nbsp;bits&nbsp;form&nbsp;a&nbsp;mod-31&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990503">switch</span>&nbsp;<span class="ident" id="5990510">z</span><span class="op" id="5990511">.</span><span class="ident" id="5990512">level</span>&nbsp;<span class="op" id="5990518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990521">case</span>&nbsp;<span class="num" id="5990526">0</span><span class="op" id="5990527">,</span>&nbsp;<span class="num" id="5990529">1</span><span class="op" id="5990530">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990534">z</span><span class="op" id="5990535">.</span><span class="ident" id="5990536">scratch</span><span class="op" id="5990543">[</span><span class="num" id="5990544">1</span><span class="op" id="5990545">]</span>&nbsp;<span class="op" id="5990547">=</span>&nbsp;<span class="num" id="5990549">0</span>&nbsp;<span class="op" id="5990551">&lt;&lt;</span>&nbsp;<span class="num" id="5990554">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990557">case</span>&nbsp;<span class="num" id="5990562">2</span><span class="op" id="5990563">,</span>&nbsp;<span class="num" id="5990565">3</span><span class="op" id="5990566">,</span>&nbsp;<span class="num" id="5990568">4</span><span class="op" id="5990569">,</span>&nbsp;<span class="num" id="5990571">5</span><span class="op" id="5990572">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990576">z</span><span class="op" id="5990577">.</span><span class="ident" id="5990578">scratch</span><span class="op" id="5990585">[</span><span class="num" id="5990586">1</span><span class="op" id="5990587">]</span>&nbsp;<span class="op" id="5990589">=</span>&nbsp;<span class="num" id="5990591">1</span>&nbsp;<span class="op" id="5990593">&lt;&lt;</span>&nbsp;<span class="num" id="5990596">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990599">case</span>&nbsp;<span class="num" id="5990604">6</span><span class="op" id="5990605">,</span>&nbsp;<span class="op" id="5990607">-</span><span class="num" id="5990608">1</span><span class="op" id="5990609">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990613">z</span><span class="op" id="5990614">.</span><span class="ident" id="5990615">scratch</span><span class="op" id="5990622">[</span><span class="num" id="5990623">1</span><span class="op" id="5990624">]</span>&nbsp;<span class="op" id="5990626">=</span>&nbsp;<span class="num" id="5990628">2</span>&nbsp;<span class="op" id="5990630">&lt;&lt;</span>&nbsp;<span class="num" id="5990633">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990636">case</span>&nbsp;<span class="num" id="5990641">7</span><span class="op" id="5990642">,</span>&nbsp;<span class="num" id="5990644">8</span><span class="op" id="5990645">,</span>&nbsp;<span class="num" id="5990647">9</span><span class="op" id="5990648">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990652">z</span><span class="op" id="5990653">.</span><span class="ident" id="5990654">scratch</span><span class="op" id="5990661">[</span><span class="num" id="5990662">1</span><span class="op" id="5990663">]</span>&nbsp;<span class="op" id="5990665">=</span>&nbsp;<span class="num" id="5990667">3</span>&nbsp;<span class="op" id="5990669">&lt;&lt;</span>&nbsp;<span class="num" id="5990672">6</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990675">default</span><span class="op" id="5990682">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5990686">panic</span><span class="op" id="5990691">(</span><span class="string" id="5990692">&#34;unreachable&#34;</span><span class="op" id="5990705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990711">if</span>&nbsp;<span class="ident" id="5990714">z</span><span class="op" id="5990715">.</span><span class="ident" id="5990716">dict</span>&nbsp;<span class="op" id="5990721">!=</span>&nbsp;<span class="ident" id="5990724">nil</span>&nbsp;<span class="op" id="5990728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990732">z</span><span class="op" id="5990733">.</span><span class="ident" id="5990734">scratch</span><span class="op" id="5990741">[</span><span class="num" id="5990742">1</span><span class="op" id="5990743">]</span>&nbsp;<span class="op" id="5990745">|=</span>&nbsp;<span class="num" id="5990748">1</span>&nbsp;<span class="op" id="5990750">&lt;&lt;</span>&nbsp;<span class="num" id="5990753">5</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990759">z</span><span class="op" id="5990760">.</span><span class="ident" id="5990761">scratch</span><span class="op" id="5990768">[</span><span class="num" id="5990769">1</span><span class="op" id="5990770">]</span>&nbsp;<span class="op" id="5990772">+=</span>&nbsp;<span class="builtintype" id="5990775">uint8</span><span class="op" id="5990780">(</span><span class="num" id="5990781">31</span>&nbsp;<span class="op" id="5990784">-</span>&nbsp;<span class="op" id="5990786">(</span><span class="builtintype" id="5990787">uint16</span><span class="op" id="5990793">(</span><span class="ident" id="5990794">z</span><span class="op" id="5990795">.</span><span class="ident" id="5990796">scratch</span><span class="op" id="5990803">[</span><span class="num" id="5990804">0</span><span class="op" id="5990805">]</span><span class="op" id="5990806">)</span><span class="op" id="5990807">&lt;&lt;</span><span class="num" id="5990809">8</span><span class="op" id="5990810">+</span><span class="builtintype" id="5990811">uint16</span><span class="op" id="5990817">(</span><span class="ident" id="5990818">z</span><span class="op" id="5990819">.</span><span class="ident" id="5990820">scratch</span><span class="op" id="5990827">[</span><span class="num" id="5990828">1</span><span class="op" id="5990829">]</span><span class="op" id="5990830">)</span><span class="op" id="5990831">)</span><span class="op" id="5990832">%</span><span class="num" id="5990833">31</span><span class="op" id="5990835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990838">if</span>&nbsp;<span class="ident" id="5990841">_</span><span class="op" id="5990842">,</span>&nbsp;<span class="ident" id="5990844">err</span>&nbsp;<span class="op" id="5990848">=</span>&nbsp;<span class="ident" id="5990850">z</span><span class="op" id="5990851">.</span><span class="ident" id="5990852">w</span><span class="op" id="5990853">.</span><span class="ident" id="5990854">Write</span><span class="op" id="5990859">(</span><span class="ident" id="5990860">z</span><span class="op" id="5990861">.</span><span class="ident" id="5990862">scratch</span><span class="op" id="5990869">[</span><span class="num" id="5990870">0</span><span class="op" id="5990871">:</span><span class="num" id="5990872">2</span><span class="op" id="5990873">]</span><span class="op" id="5990874">)</span><span class="op" id="5990875">;</span>&nbsp;<span class="ident" id="5990877">err</span>&nbsp;<span class="op" id="5990881">!=</span>&nbsp;<span class="ident" id="5990884">nil</span>&nbsp;<span class="op" id="5990888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990892">return</span>&nbsp;<span class="ident" id="5990899">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990904">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990907">if</span>&nbsp;<span class="ident" id="5990910">z</span><span class="op" id="5990911">.</span><span class="ident" id="5990912">dict</span>&nbsp;<span class="op" id="5990917">!=</span>&nbsp;<span class="ident" id="5990920">nil</span>&nbsp;<span class="op" id="5990924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990928">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bytes&nbsp;are&nbsp;the&nbsp;Adler-32&nbsp;checksum&nbsp;of&nbsp;the&nbsp;dictionary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990998">checksum</span>&nbsp;<span class="op" id="5991007">:=</span>&nbsp;<span class="ident" id="5991010">adler32</span><span class="op" id="5991017">.</span><span class="ident" id="5991018">Checksum</span><span class="op" id="5991026">(</span><span class="ident" id="5991027">z</span><span class="op" id="5991028">.</span><span class="ident" id="5991029">dict</span><span class="op" id="5991033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991037">z</span><span class="op" id="5991038">.</span><span class="ident" id="5991039">scratch</span><span class="op" id="5991046">[</span><span class="num" id="5991047">0</span><span class="op" id="5991048">]</span>&nbsp;<span class="op" id="5991050">=</span>&nbsp;<span class="builtintype" id="5991052">uint8</span><span class="op" id="5991057">(</span><span class="ident" id="5991058">checksum</span>&nbsp;<span class="op" id="5991067">&gt;&gt;</span>&nbsp;<span class="num" id="5991070">24</span><span class="op" id="5991072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991076">z</span><span class="op" id="5991077">.</span><span class="ident" id="5991078">scratch</span><span class="op" id="5991085">[</span><span class="num" id="5991086">1</span><span class="op" id="5991087">]</span>&nbsp;<span class="op" id="5991089">=</span>&nbsp;<span class="builtintype" id="5991091">uint8</span><span class="op" id="5991096">(</span><span class="ident" id="5991097">checksum</span>&nbsp;<span class="op" id="5991106">&gt;&gt;</span>&nbsp;<span class="num" id="5991109">16</span><span class="op" id="5991111">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991115">z</span><span class="op" id="5991116">.</span><span class="ident" id="5991117">scratch</span><span class="op" id="5991124">[</span><span class="num" id="5991125">2</span><span class="op" id="5991126">]</span>&nbsp;<span class="op" id="5991128">=</span>&nbsp;<span class="builtintype" id="5991130">uint8</span><span class="op" id="5991135">(</span><span class="ident" id="5991136">checksum</span>&nbsp;<span class="op" id="5991145">&gt;&gt;</span>&nbsp;<span class="num" id="5991148">8</span><span class="op" id="5991149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991153">z</span><span class="op" id="5991154">.</span><span class="ident" id="5991155">scratch</span><span class="op" id="5991162">[</span><span class="num" id="5991163">3</span><span class="op" id="5991164">]</span>&nbsp;<span class="op" id="5991166">=</span>&nbsp;<span class="builtintype" id="5991168">uint8</span><span class="op" id="5991173">(</span><span class="ident" id="5991174">checksum</span>&nbsp;<span class="op" id="5991183">&gt;&gt;</span>&nbsp;<span class="num" id="5991186">0</span><span class="op" id="5991187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991191">if</span>&nbsp;<span class="ident" id="5991194">_</span><span class="op" id="5991195">,</span>&nbsp;<span class="ident" id="5991197">err</span>&nbsp;<span class="op" id="5991201">=</span>&nbsp;<span class="ident" id="5991203">z</span><span class="op" id="5991204">.</span><span class="ident" id="5991205">w</span><span class="op" id="5991206">.</span><span class="ident" id="5991207">Write</span><span class="op" id="5991212">(</span><span class="ident" id="5991213">z</span><span class="op" id="5991214">.</span><span class="ident" id="5991215">scratch</span><span class="op" id="5991222">[</span><span class="num" id="5991223">0</span><span class="op" id="5991224">:</span><span class="num" id="5991225">4</span><span class="op" id="5991226">]</span><span class="op" id="5991227">)</span><span class="op" id="5991228">;</span>&nbsp;<span class="ident" id="5991230">err</span>&nbsp;<span class="op" id="5991234">!=</span>&nbsp;<span class="ident" id="5991237">nil</span>&nbsp;<span class="op" id="5991241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991246">return</span>&nbsp;<span class="ident" id="5991253">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991259">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991265">if</span>&nbsp;<span class="ident" id="5991268">z</span><span class="op" id="5991269">.</span><span class="ident" id="5991270">compressor</span>&nbsp;<span class="op" id="5991281">==</span>&nbsp;<span class="ident" id="5991284">nil</span>&nbsp;<span class="op" id="5991288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991292">//&nbsp;Initialize&nbsp;deflater&nbsp;unless&nbsp;the&nbsp;Writer&nbsp;is&nbsp;being&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991351">//&nbsp;after&nbsp;a&nbsp;Reset&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991376">z</span><span class="op" id="5991377">.</span><span class="ident" id="5991378">compressor</span><span class="op" id="5991388">,</span>&nbsp;<span class="ident" id="5991390">err</span>&nbsp;<span class="op" id="5991394">=</span>&nbsp;<span class="ident" id="5991396">flate</span><span class="op" id="5991401">.</span><span class="ident" id="5991402">NewWriterDict</span><span class="op" id="5991415">(</span><span class="ident" id="5991416">z</span><span class="op" id="5991417">.</span><span class="ident" id="5991418">w</span><span class="op" id="5991419">,</span>&nbsp;<span class="ident" id="5991421">z</span><span class="op" id="5991422">.</span><span class="ident" id="5991423">level</span><span class="op" id="5991428">,</span>&nbsp;<span class="ident" id="5991430">z</span><span class="op" id="5991431">.</span><span class="ident" id="5991432">dict</span><span class="op" id="5991436">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991440">if</span>&nbsp;<span class="ident" id="5991443">err</span>&nbsp;<span class="op" id="5991447">!=</span>&nbsp;<span class="ident" id="5991450">nil</span>&nbsp;<span class="op" id="5991454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991459">return</span>&nbsp;<span class="ident" id="5991466">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991476">z</span><span class="op" id="5991477">.</span><span class="ident" id="5991478">digest</span>&nbsp;<span class="op" id="5991485">=</span>&nbsp;<span class="ident" id="5991487">adler32</span><span class="op" id="5991494">.</span><span class="ident" id="5991495">New</span><span class="op" id="5991498">(</span><span class="op" id="5991499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991502">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991505">return</span>&nbsp;<span class="ident" id="5991512">nil</span><br>
<span class="lineno"></span><span class="op" id="5991516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5991519">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5991591">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed&nbsp;or</span><br>
<span class="lineno">145</span><span class="comment" id="5991669">//&nbsp;explicitly&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5991692">func</span>&nbsp;<span class="op" id="5991697">(</span><span class="ident" id="5991698">z</span>&nbsp;<span class="op" id="5991700">*</span><span class="ident" id="5991701">Writer</span><span class="op" id="5991707">)</span>&nbsp;<span class="ident" id="5991709">Write</span><span class="op" id="5991714">(</span><span class="ident" id="5991715">p</span>&nbsp;<span class="op" id="5991717">[</span><span class="op" id="5991718">]</span><span class="builtintype" id="5991719">byte</span><span class="op" id="5991723">)</span>&nbsp;<span class="op" id="5991725">(</span><span class="ident" id="5991726">n</span>&nbsp;<span class="builtintype" id="5991728">int</span><span class="op" id="5991731">,</span>&nbsp;<span class="ident" id="5991733">err</span>&nbsp;<span class="builtintype" id="5991737">error</span><span class="op" id="5991742">)</span>&nbsp;<span class="op" id="5991744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991747">if</span>&nbsp;<span class="op" id="5991750">!</span><span class="ident" id="5991751">z</span><span class="op" id="5991752">.</span><span class="ident" id="5991753">wroteHeader</span>&nbsp;<span class="op" id="5991765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991769">z</span><span class="op" id="5991770">.</span><span class="ident" id="5991771">err</span>&nbsp;<span class="op" id="5991775">=</span>&nbsp;<span class="ident" id="5991777">z</span><span class="op" id="5991778">.</span><span class="ident" id="5991779">writeHeader</span><span class="op" id="5991790">(</span><span class="op" id="5991791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991794">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991797">if</span>&nbsp;<span class="ident" id="5991800">z</span><span class="op" id="5991801">.</span><span class="ident" id="5991802">err</span>&nbsp;<span class="op" id="5991806">!=</span>&nbsp;<span class="ident" id="5991809">nil</span>&nbsp;<span class="op" id="5991813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991817">return</span>&nbsp;<span class="num" id="5991824">0</span><span class="op" id="5991825">,</span>&nbsp;<span class="ident" id="5991827">z</span><span class="op" id="5991828">.</span><span class="ident" id="5991829">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991837">if</span>&nbsp;<span class="builtinfunc" id="5991840">len</span><span class="op" id="5991843">(</span><span class="ident" id="5991844">p</span><span class="op" id="5991845">)</span>&nbsp;<span class="op" id="5991847">==</span>&nbsp;<span class="num" id="5991850">0</span>&nbsp;<span class="op" id="5991852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991856">return</span>&nbsp;<span class="num" id="5991863">0</span><span class="op" id="5991864">,</span>&nbsp;<span class="ident" id="5991866">nil</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991874">n</span><span class="op" id="5991875">,</span>&nbsp;<span class="ident" id="5991877">err</span>&nbsp;<span class="op" id="5991881">=</span>&nbsp;<span class="ident" id="5991883">z</span><span class="op" id="5991884">.</span><span class="ident" id="5991885">compressor</span><span class="op" id="5991895">.</span><span class="ident" id="5991896">Write</span><span class="op" id="5991901">(</span><span class="ident" id="5991902">p</span><span class="op" id="5991903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991906">if</span>&nbsp;<span class="ident" id="5991909">err</span>&nbsp;<span class="op" id="5991913">!=</span>&nbsp;<span class="ident" id="5991916">nil</span>&nbsp;<span class="op" id="5991920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991924">z</span><span class="op" id="5991925">.</span><span class="ident" id="5991926">err</span>&nbsp;<span class="op" id="5991930">=</span>&nbsp;<span class="ident" id="5991932">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991938">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991949">z</span><span class="op" id="5991950">.</span><span class="ident" id="5991951">digest</span><span class="op" id="5991957">.</span><span class="ident" id="5991958">Write</span><span class="op" id="5991963">(</span><span class="ident" id="5991964">p</span><span class="op" id="5991965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991968">return</span><br>
<span class="lineno"></span><span class="op" id="5991975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5991978">//&nbsp;Flush&nbsp;flushes&nbsp;the&nbsp;Writer&nbsp;to&nbsp;its&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5992035">func</span>&nbsp;<span class="op" id="5992040">(</span><span class="ident" id="5992041">z</span>&nbsp;<span class="op" id="5992043">*</span><span class="ident" id="5992044">Writer</span><span class="op" id="5992050">)</span>&nbsp;<span class="ident" id="5992052">Flush</span><span class="op" id="5992057">(</span><span class="op" id="5992058">)</span>&nbsp;<span class="builtintype" id="5992060">error</span>&nbsp;<span class="op" id="5992066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992069">if</span>&nbsp;<span class="op" id="5992072">!</span><span class="ident" id="5992073">z</span><span class="op" id="5992074">.</span><span class="ident" id="5992075">wroteHeader</span>&nbsp;<span class="op" id="5992087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992091">z</span><span class="op" id="5992092">.</span><span class="ident" id="5992093">err</span>&nbsp;<span class="op" id="5992097">=</span>&nbsp;<span class="ident" id="5992099">z</span><span class="op" id="5992100">.</span><span class="ident" id="5992101">writeHeader</span><span class="op" id="5992112">(</span><span class="op" id="5992113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992116">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992119">if</span>&nbsp;<span class="ident" id="5992122">z</span><span class="op" id="5992123">.</span><span class="ident" id="5992124">err</span>&nbsp;<span class="op" id="5992128">!=</span>&nbsp;<span class="ident" id="5992131">nil</span>&nbsp;<span class="op" id="5992135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992139">return</span>&nbsp;<span class="ident" id="5992146">z</span><span class="op" id="5992147">.</span><span class="ident" id="5992148">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992156">z</span><span class="op" id="5992157">.</span><span class="ident" id="5992158">err</span>&nbsp;<span class="op" id="5992162">=</span>&nbsp;<span class="ident" id="5992164">z</span><span class="op" id="5992165">.</span><span class="ident" id="5992166">compressor</span><span class="op" id="5992176">.</span><span class="ident" id="5992177">Flush</span><span class="op" id="5992182">(</span><span class="op" id="5992183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992186">return</span>&nbsp;<span class="ident" id="5992193">z</span><span class="op" id="5992194">.</span><span class="ident" id="5992195">err</span><br>
<span class="lineno">175</span><span class="op" id="5992199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5992202">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="5992276">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5992335">func</span>&nbsp;<span class="op" id="5992340">(</span><span class="ident" id="5992341">z</span>&nbsp;<span class="op" id="5992343">*</span><span class="ident" id="5992344">Writer</span><span class="op" id="5992350">)</span>&nbsp;<span class="ident" id="5992352">Close</span><span class="op" id="5992357">(</span><span class="op" id="5992358">)</span>&nbsp;<span class="builtintype" id="5992360">error</span>&nbsp;<span class="op" id="5992366">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992369">if</span>&nbsp;<span class="op" id="5992372">!</span><span class="ident" id="5992373">z</span><span class="op" id="5992374">.</span><span class="ident" id="5992375">wroteHeader</span>&nbsp;<span class="op" id="5992387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992391">z</span><span class="op" id="5992392">.</span><span class="ident" id="5992393">err</span>&nbsp;<span class="op" id="5992397">=</span>&nbsp;<span class="ident" id="5992399">z</span><span class="op" id="5992400">.</span><span class="ident" id="5992401">writeHeader</span><span class="op" id="5992412">(</span><span class="op" id="5992413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992419">if</span>&nbsp;<span class="ident" id="5992422">z</span><span class="op" id="5992423">.</span><span class="ident" id="5992424">err</span>&nbsp;<span class="op" id="5992428">!=</span>&nbsp;<span class="ident" id="5992431">nil</span>&nbsp;<span class="op" id="5992435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992439">return</span>&nbsp;<span class="ident" id="5992446">z</span><span class="op" id="5992447">.</span><span class="ident" id="5992448">err</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992456">z</span><span class="op" id="5992457">.</span><span class="ident" id="5992458">err</span>&nbsp;<span class="op" id="5992462">=</span>&nbsp;<span class="ident" id="5992464">z</span><span class="op" id="5992465">.</span><span class="ident" id="5992466">compressor</span><span class="op" id="5992476">.</span><span class="ident" id="5992477">Close</span><span class="op" id="5992482">(</span><span class="op" id="5992483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992486">if</span>&nbsp;<span class="ident" id="5992489">z</span><span class="op" id="5992490">.</span><span class="ident" id="5992491">err</span>&nbsp;<span class="op" id="5992495">!=</span>&nbsp;<span class="ident" id="5992498">nil</span>&nbsp;<span class="op" id="5992502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992506">return</span>&nbsp;<span class="ident" id="5992513">z</span><span class="op" id="5992514">.</span><span class="ident" id="5992515">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992520">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992523">checksum</span>&nbsp;<span class="op" id="5992532">:=</span>&nbsp;<span class="ident" id="5992535">z</span><span class="op" id="5992536">.</span><span class="ident" id="5992537">digest</span><span class="op" id="5992543">.</span><span class="ident" id="5992544">Sum32</span><span class="op" id="5992549">(</span><span class="op" id="5992550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992553">//&nbsp;ZLIB&nbsp;(RFC&nbsp;1950)&nbsp;is&nbsp;big-endian,&nbsp;unlike&nbsp;GZIP&nbsp;(RFC&nbsp;1952).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992612">z</span><span class="op" id="5992613">.</span><span class="ident" id="5992614">scratch</span><span class="op" id="5992621">[</span><span class="num" id="5992622">0</span><span class="op" id="5992623">]</span>&nbsp;<span class="op" id="5992625">=</span>&nbsp;<span class="builtintype" id="5992627">uint8</span><span class="op" id="5992632">(</span><span class="ident" id="5992633">checksum</span>&nbsp;<span class="op" id="5992642">&gt;&gt;</span>&nbsp;<span class="num" id="5992645">24</span><span class="op" id="5992647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992650">z</span><span class="op" id="5992651">.</span><span class="ident" id="5992652">scratch</span><span class="op" id="5992659">[</span><span class="num" id="5992660">1</span><span class="op" id="5992661">]</span>&nbsp;<span class="op" id="5992663">=</span>&nbsp;<span class="builtintype" id="5992665">uint8</span><span class="op" id="5992670">(</span><span class="ident" id="5992671">checksum</span>&nbsp;<span class="op" id="5992680">&gt;&gt;</span>&nbsp;<span class="num" id="5992683">16</span><span class="op" id="5992685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992688">z</span><span class="op" id="5992689">.</span><span class="ident" id="5992690">scratch</span><span class="op" id="5992697">[</span><span class="num" id="5992698">2</span><span class="op" id="5992699">]</span>&nbsp;<span class="op" id="5992701">=</span>&nbsp;<span class="builtintype" id="5992703">uint8</span><span class="op" id="5992708">(</span><span class="ident" id="5992709">checksum</span>&nbsp;<span class="op" id="5992718">&gt;&gt;</span>&nbsp;<span class="num" id="5992721">8</span><span class="op" id="5992722">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992725">z</span><span class="op" id="5992726">.</span><span class="ident" id="5992727">scratch</span><span class="op" id="5992734">[</span><span class="num" id="5992735">3</span><span class="op" id="5992736">]</span>&nbsp;<span class="op" id="5992738">=</span>&nbsp;<span class="builtintype" id="5992740">uint8</span><span class="op" id="5992745">(</span><span class="ident" id="5992746">checksum</span>&nbsp;<span class="op" id="5992755">&gt;&gt;</span>&nbsp;<span class="num" id="5992758">0</span><span class="op" id="5992759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992762">_</span><span class="op" id="5992763">,</span>&nbsp;<span class="ident" id="5992765">z</span><span class="op" id="5992766">.</span><span class="ident" id="5992767">err</span>&nbsp;<span class="op" id="5992771">=</span>&nbsp;<span class="ident" id="5992773">z</span><span class="op" id="5992774">.</span><span class="ident" id="5992775">w</span><span class="op" id="5992776">.</span><span class="ident" id="5992777">Write</span><span class="op" id="5992782">(</span><span class="ident" id="5992783">z</span><span class="op" id="5992784">.</span><span class="ident" id="5992785">scratch</span><span class="op" id="5992792">[</span><span class="num" id="5992793">0</span><span class="op" id="5992794">:</span><span class="num" id="5992795">4</span><span class="op" id="5992796">]</span><span class="op" id="5992797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992800">return</span>&nbsp;<span class="ident" id="5992807">z</span><span class="op" id="5992808">.</span><span class="ident" id="5992809">err</span><br>
<span class="lineno"></span><span class="op" id="5992813">}</span>
</div>
</body>
</html>
