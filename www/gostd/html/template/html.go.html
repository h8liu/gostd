<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html" class="current">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3535088">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3535143">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3535197">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3535248">package</span>&nbsp;<span class="ident" id="3535256">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3535266">import</span>&nbsp;<span class="op" id="3535273">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3535276">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3535285">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3535292">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3535303">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3535318">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3535321">//&nbsp;htmlNospaceEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;unquoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno">15</span><span class="keyword" id="3535395">func</span>&nbsp;<span class="ident" id="3535400">htmlNospaceEscaper</span><span class="op" id="3535418">(</span><span class="ident" id="3535419">args</span>&nbsp;<span class="op" id="3535424">...</span><span class="keyword" id="3535427">interface</span><span class="op" id="3535436">{</span><span class="op" id="3535437">}</span><span class="op" id="3535438">)</span>&nbsp;<span class="builtintype" id="3535440">string</span>&nbsp;<span class="op" id="3535447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3535450">s</span><span class="op" id="3535451">,</span>&nbsp;<span class="ident" id="3535453">t</span>&nbsp;<span class="op" id="3535455">:=</span>&nbsp;<span class="ident" id="3535458">stringify</span><span class="op" id="3535467">(</span><span class="ident" id="3535468">args</span><span class="op" id="3535472">...</span><span class="op" id="3535475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535478">if</span>&nbsp;<span class="ident" id="3535481">t</span>&nbsp;<span class="op" id="3535483">==</span>&nbsp;<span class="ident" id="3535486">contentTypeHTML</span>&nbsp;<span class="op" id="3535502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535506">return</span>&nbsp;<span class="ident" id="3535513">htmlReplacer</span><span class="op" id="3535525">(</span><span class="ident" id="3535526">stripTags</span><span class="op" id="3535535">(</span><span class="ident" id="3535536">s</span><span class="op" id="3535537">)</span><span class="op" id="3535538">,</span>&nbsp;<span class="ident" id="3535540">htmlNospaceNormReplacementTable</span><span class="op" id="3535571">,</span>&nbsp;<span class="builtintype" id="3535573">false</span><span class="op" id="3535578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3535581">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535584">return</span>&nbsp;<span class="ident" id="3535591">htmlReplacer</span><span class="op" id="3535603">(</span><span class="ident" id="3535604">s</span><span class="op" id="3535605">,</span>&nbsp;<span class="ident" id="3535607">htmlNospaceReplacementTable</span><span class="op" id="3535634">,</span>&nbsp;<span class="builtintype" id="3535636">false</span><span class="op" id="3535641">)</span><br>
<span class="lineno"></span><span class="op" id="3535643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3535646">//&nbsp;attrEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;quoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3535711">func</span>&nbsp;<span class="ident" id="3535716">attrEscaper</span><span class="op" id="3535727">(</span><span class="ident" id="3535728">args</span>&nbsp;<span class="op" id="3535733">...</span><span class="keyword" id="3535736">interface</span><span class="op" id="3535745">{</span><span class="op" id="3535746">}</span><span class="op" id="3535747">)</span>&nbsp;<span class="builtintype" id="3535749">string</span>&nbsp;<span class="op" id="3535756">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3535759">s</span><span class="op" id="3535760">,</span>&nbsp;<span class="ident" id="3535762">t</span>&nbsp;<span class="op" id="3535764">:=</span>&nbsp;<span class="ident" id="3535767">stringify</span><span class="op" id="3535776">(</span><span class="ident" id="3535777">args</span><span class="op" id="3535781">...</span><span class="op" id="3535784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535787">if</span>&nbsp;<span class="ident" id="3535790">t</span>&nbsp;<span class="op" id="3535792">==</span>&nbsp;<span class="ident" id="3535795">contentTypeHTML</span>&nbsp;<span class="op" id="3535811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535815">return</span>&nbsp;<span class="ident" id="3535822">htmlReplacer</span><span class="op" id="3535834">(</span><span class="ident" id="3535835">stripTags</span><span class="op" id="3535844">(</span><span class="ident" id="3535845">s</span><span class="op" id="3535846">)</span><span class="op" id="3535847">,</span>&nbsp;<span class="ident" id="3535849">htmlNormReplacementTable</span><span class="op" id="3535873">,</span>&nbsp;<span class="builtintype" id="3535875">true</span><span class="op" id="3535879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3535882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535885">return</span>&nbsp;<span class="ident" id="3535892">htmlReplacer</span><span class="op" id="3535904">(</span><span class="ident" id="3535905">s</span><span class="op" id="3535906">,</span>&nbsp;<span class="ident" id="3535908">htmlReplacementTable</span><span class="op" id="3535928">,</span>&nbsp;<span class="builtintype" id="3535930">true</span><span class="op" id="3535934">)</span><br>
<span class="lineno">30</span><span class="op" id="3535936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3535939">//&nbsp;rcdataEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="3536005">func</span>&nbsp;<span class="ident" id="3536010">rcdataEscaper</span><span class="op" id="3536023">(</span><span class="ident" id="3536024">args</span>&nbsp;<span class="op" id="3536029">...</span><span class="keyword" id="3536032">interface</span><span class="op" id="3536041">{</span><span class="op" id="3536042">}</span><span class="op" id="3536043">)</span>&nbsp;<span class="builtintype" id="3536045">string</span>&nbsp;<span class="op" id="3536052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3536055">s</span><span class="op" id="3536056">,</span>&nbsp;<span class="ident" id="3536058">t</span>&nbsp;<span class="op" id="3536060">:=</span>&nbsp;<span class="ident" id="3536063">stringify</span><span class="op" id="3536072">(</span><span class="ident" id="3536073">args</span><span class="op" id="3536077">...</span><span class="op" id="3536080">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3536083">if</span>&nbsp;<span class="ident" id="3536086">t</span>&nbsp;<span class="op" id="3536088">==</span>&nbsp;<span class="ident" id="3536091">contentTypeHTML</span>&nbsp;<span class="op" id="3536107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3536111">return</span>&nbsp;<span class="ident" id="3536118">htmlReplacer</span><span class="op" id="3536130">(</span><span class="ident" id="3536131">s</span><span class="op" id="3536132">,</span>&nbsp;<span class="ident" id="3536134">htmlNormReplacementTable</span><span class="op" id="3536158">,</span>&nbsp;<span class="builtintype" id="3536160">true</span><span class="op" id="3536164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3536167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3536170">return</span>&nbsp;<span class="ident" id="3536177">htmlReplacer</span><span class="op" id="3536189">(</span><span class="ident" id="3536190">s</span><span class="op" id="3536191">,</span>&nbsp;<span class="ident" id="3536193">htmlReplacementTable</span><span class="op" id="3536213">,</span>&nbsp;<span class="builtintype" id="3536215">true</span><span class="op" id="3536219">)</span><br>
<span class="lineno"></span><span class="op" id="3536221">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3536224">//&nbsp;htmlEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="3536275">func</span>&nbsp;<span class="ident" id="3536280">htmlEscaper</span><span class="op" id="3536291">(</span><span class="ident" id="3536292">args</span>&nbsp;<span class="op" id="3536297">...</span><span class="keyword" id="3536300">interface</span><span class="op" id="3536309">{</span><span class="op" id="3536310">}</span><span class="op" id="3536311">)</span>&nbsp;<span class="builtintype" id="3536313">string</span>&nbsp;<span class="op" id="3536320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3536323">s</span><span class="op" id="3536324">,</span>&nbsp;<span class="ident" id="3536326">t</span>&nbsp;<span class="op" id="3536328">:=</span>&nbsp;<span class="ident" id="3536331">stringify</span><span class="op" id="3536340">(</span><span class="ident" id="3536341">args</span><span class="op" id="3536345">...</span><span class="op" id="3536348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3536351">if</span>&nbsp;<span class="ident" id="3536354">t</span>&nbsp;<span class="op" id="3536356">==</span>&nbsp;<span class="ident" id="3536359">contentTypeHTML</span>&nbsp;<span class="op" id="3536375">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3536379">return</span>&nbsp;<span class="ident" id="3536386">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3536389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3536392">return</span>&nbsp;<span class="ident" id="3536399">htmlReplacer</span><span class="op" id="3536411">(</span><span class="ident" id="3536412">s</span><span class="op" id="3536413">,</span>&nbsp;<span class="ident" id="3536415">htmlReplacementTable</span><span class="op" id="3536435">,</span>&nbsp;<span class="builtintype" id="3536437">true</span><span class="op" id="3536441">)</span><br>
<span class="lineno"></span><span class="op" id="3536443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3536446">//&nbsp;htmlReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno"></span><span class="comment" id="3536513">//&nbsp;inside&nbsp;a&nbsp;quoted&nbsp;attribute&nbsp;value&nbsp;or&nbsp;in&nbsp;a&nbsp;text&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="3536567">var</span>&nbsp;<span class="ident" id="3536571">htmlReplacementTable</span>&nbsp;<span class="op" id="3536592">=</span>&nbsp;<span class="op" id="3536594">[</span><span class="op" id="3536595">]</span><span class="builtintype" id="3536596">string</span><span class="op" id="3536602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536605">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536681">//&nbsp;U+0000&nbsp;NULL&nbsp;Parse&nbsp;error.&nbsp;Append&nbsp;a&nbsp;U+FFFD&nbsp;REPLACEMENT</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536738">//&nbsp;CHARACTER&nbsp;character&nbsp;to&nbsp;the&nbsp;current&nbsp;attribute&#39;s&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536796">//&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536802">//&nbsp;and&nbsp;similarly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536820">//&nbsp;http://www.w3.org/TR/html5/syntax.html#before-attribute-value-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3536892">0</span><span class="op" id="3536893">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3536898">&#34;\uFFFD&#34;</span><span class="op" id="3536906">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536909">&#39;&#34;&#39;</span><span class="op" id="3536912">:</span>&nbsp;&nbsp;<span class="string" id="3536915">&#34;&amp;#34;&#34;</span><span class="op" id="3536922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536925">&#39;&amp;&#39;</span><span class="op" id="3536928">:</span>&nbsp;&nbsp;<span class="string" id="3536931">&#34;&amp;amp;&#34;</span><span class="op" id="3536938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536941">&#39;\&#39;&#39;</span><span class="op" id="3536945">:</span>&nbsp;<span class="string" id="3536947">&#34;&amp;#39;&#34;</span><span class="op" id="3536954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536957">&#39;+&#39;</span><span class="op" id="3536960">:</span>&nbsp;&nbsp;<span class="string" id="3536963">&#34;&amp;#43;&#34;</span><span class="op" id="3536970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536973">&#39;&lt;&#39;</span><span class="op" id="3536976">:</span>&nbsp;&nbsp;<span class="string" id="3536979">&#34;&amp;lt;&#34;</span><span class="op" id="3536985">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3536988">&#39;&gt;&#39;</span><span class="op" id="3536991">:</span>&nbsp;&nbsp;<span class="string" id="3536994">&#34;&amp;gt;&#34;</span><span class="op" id="3537000">,</span><br>
<span class="lineno"></span><span class="op" id="3537002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3537005">//&nbsp;htmlNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlReplacementTable&nbsp;but&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3537081">//&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno">70</span><span class="keyword" id="3537123">var</span>&nbsp;<span class="ident" id="3537127">htmlNormReplacementTable</span>&nbsp;<span class="op" id="3537152">=</span>&nbsp;<span class="op" id="3537154">[</span><span class="op" id="3537155">]</span><span class="builtintype" id="3537156">string</span><span class="op" id="3537162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3537165">0</span><span class="op" id="3537166">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3537171">&#34;\uFFFD&#34;</span><span class="op" id="3537179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3537182">&#39;&#34;&#39;</span><span class="op" id="3537185">:</span>&nbsp;&nbsp;<span class="string" id="3537188">&#34;&amp;#34;&#34;</span><span class="op" id="3537195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3537198">&#39;\&#39;&#39;</span><span class="op" id="3537202">:</span>&nbsp;<span class="string" id="3537204">&#34;&amp;#39;&#34;</span><span class="op" id="3537211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3537214">&#39;+&#39;</span><span class="op" id="3537217">:</span>&nbsp;&nbsp;<span class="string" id="3537220">&#34;&amp;#43;&#34;</span><span class="op" id="3537227">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3537230">&#39;&lt;&#39;</span><span class="op" id="3537233">:</span>&nbsp;&nbsp;<span class="string" id="3537236">&#34;&amp;lt;&#34;</span><span class="op" id="3537242">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3537245">&#39;&gt;&#39;</span><span class="op" id="3537248">:</span>&nbsp;&nbsp;<span class="string" id="3537251">&#34;&amp;gt;&#34;</span><span class="op" id="3537257">,</span><br>
<span class="lineno"></span><span class="op" id="3537259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3537262">//&nbsp;htmlNospaceReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno">80</span><span class="comment" id="3537336">//&nbsp;inside&nbsp;an&nbsp;unquoted&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3537375">//&nbsp;The&nbsp;set&nbsp;of&nbsp;runes&nbsp;escaped&nbsp;is&nbsp;the&nbsp;union&nbsp;of&nbsp;the&nbsp;HTML&nbsp;specials&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3537441">//&nbsp;those&nbsp;determined&nbsp;by&nbsp;running&nbsp;the&nbsp;JS&nbsp;below&nbsp;in&nbsp;browsers:</span><br>
<span class="lineno"></span><span class="comment" id="3537498">//&nbsp;&lt;div&nbsp;id=d&gt;&lt;/div&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3537518">//&nbsp;&lt;script&gt;(function&nbsp;()&nbsp;{</span><br>
<span class="lineno">85</span><span class="comment" id="3537544">//&nbsp;var&nbsp;a&nbsp;=&nbsp;[],&nbsp;d&nbsp;=&nbsp;document.getElementById(&#34;d&#34;),&nbsp;i,&nbsp;c,&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="3537602">//&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="3537637">//&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;String.fromCharCode(i);</span><br>
<span class="lineno"></span><span class="comment" id="3537670">//&nbsp;&nbsp;&nbsp;d.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;&gt;&lt;/span&gt;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3537732">//&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;d.getElementsByTagName(&#34;SPAN&#34;)[0];</span><br>
<span class="lineno">90</span><span class="comment" id="3537776">//&nbsp;&nbsp;&nbsp;if&nbsp;(!s&nbsp;||&nbsp;s.title&nbsp;!==&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c)&nbsp;{&nbsp;a.push(i.toString(16));&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="3537845">//&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="3537850">//&nbsp;document.write(a.join(&#34;,&nbsp;&#34;));</span><br>
<span class="lineno"></span><span class="comment" id="3537883">//&nbsp;})()&lt;/script&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="3537900">var</span>&nbsp;<span class="ident" id="3537904">htmlNospaceReplacementTable</span>&nbsp;<span class="op" id="3537932">=</span>&nbsp;<span class="op" id="3537934">[</span><span class="op" id="3537935">]</span><span class="builtintype" id="3537936">string</span><span class="op" id="3537942">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3537945">0</span><span class="op" id="3537946">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3537951">&#34;&amp;#xfffd;&#34;</span><span class="op" id="3537961">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3537964">&#39;\t&#39;</span><span class="op" id="3537968">:</span>&nbsp;<span class="string" id="3537970">&#34;&amp;#9;&#34;</span><span class="op" id="3537976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3537979">&#39;\n&#39;</span><span class="op" id="3537983">:</span>&nbsp;<span class="string" id="3537985">&#34;&amp;#10;&#34;</span><span class="op" id="3537992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3537995">&#39;\v&#39;</span><span class="op" id="3537999">:</span>&nbsp;<span class="string" id="3538001">&#34;&amp;#11;&#34;</span><span class="op" id="3538008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538011">&#39;\f&#39;</span><span class="op" id="3538015">:</span>&nbsp;<span class="string" id="3538017">&#34;&amp;#12;&#34;</span><span class="op" id="3538024">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538027">&#39;\r&#39;</span><span class="op" id="3538031">:</span>&nbsp;<span class="string" id="3538033">&#34;&amp;#13;&#34;</span><span class="op" id="3538040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538043">&#39;&nbsp;&#39;</span><span class="op" id="3538046">:</span>&nbsp;&nbsp;<span class="string" id="3538049">&#34;&amp;#32;&#34;</span><span class="op" id="3538056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538059">&#39;&#34;&#39;</span><span class="op" id="3538062">:</span>&nbsp;&nbsp;<span class="string" id="3538065">&#34;&amp;#34;&#34;</span><span class="op" id="3538072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538075">&#39;&amp;&#39;</span><span class="op" id="3538078">:</span>&nbsp;&nbsp;<span class="string" id="3538081">&#34;&amp;amp;&#34;</span><span class="op" id="3538088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538091">&#39;\&#39;&#39;</span><span class="op" id="3538095">:</span>&nbsp;<span class="string" id="3538097">&#34;&amp;#39;&#34;</span><span class="op" id="3538104">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538107">&#39;+&#39;</span><span class="op" id="3538110">:</span>&nbsp;&nbsp;<span class="string" id="3538113">&#34;&amp;#43;&#34;</span><span class="op" id="3538120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538123">&#39;&lt;&#39;</span><span class="op" id="3538126">:</span>&nbsp;&nbsp;<span class="string" id="3538129">&#34;&amp;lt;&#34;</span><span class="op" id="3538135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538138">&#39;=&#39;</span><span class="op" id="3538141">:</span>&nbsp;&nbsp;<span class="string" id="3538144">&#34;&amp;#61;&#34;</span><span class="op" id="3538151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538154">&#39;&gt;&#39;</span><span class="op" id="3538157">:</span>&nbsp;&nbsp;<span class="string" id="3538160">&#34;&amp;gt;&#34;</span><span class="op" id="3538166">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3538169">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3538225">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3538260">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538302">&#39;`&#39;</span><span class="op" id="3538305">:</span>&nbsp;<span class="string" id="3538307">&#34;&amp;#96;&#34;</span><span class="op" id="3538314">,</span><br>
<span class="lineno"></span><span class="op" id="3538316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="3538319">//&nbsp;htmlNospaceNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlNospaceReplacementTable&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="3538394">//&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno"></span><span class="keyword" id="3538451">var</span>&nbsp;<span class="ident" id="3538455">htmlNospaceNormReplacementTable</span>&nbsp;<span class="op" id="3538487">=</span>&nbsp;<span class="op" id="3538489">[</span><span class="op" id="3538490">]</span><span class="builtintype" id="3538491">string</span><span class="op" id="3538497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3538500">0</span><span class="op" id="3538501">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3538506">&#34;&amp;#xfffd;&#34;</span><span class="op" id="3538516">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538519">&#39;\t&#39;</span><span class="op" id="3538523">:</span>&nbsp;<span class="string" id="3538525">&#34;&amp;#9;&#34;</span><span class="op" id="3538531">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538534">&#39;\n&#39;</span><span class="op" id="3538538">:</span>&nbsp;<span class="string" id="3538540">&#34;&amp;#10;&#34;</span><span class="op" id="3538547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538550">&#39;\v&#39;</span><span class="op" id="3538554">:</span>&nbsp;<span class="string" id="3538556">&#34;&amp;#11;&#34;</span><span class="op" id="3538563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538566">&#39;\f&#39;</span><span class="op" id="3538570">:</span>&nbsp;<span class="string" id="3538572">&#34;&amp;#12;&#34;</span><span class="op" id="3538579">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538582">&#39;\r&#39;</span><span class="op" id="3538586">:</span>&nbsp;<span class="string" id="3538588">&#34;&amp;#13;&#34;</span><span class="op" id="3538595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538598">&#39;&nbsp;&#39;</span><span class="op" id="3538601">:</span>&nbsp;&nbsp;<span class="string" id="3538604">&#34;&amp;#32;&#34;</span><span class="op" id="3538611">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538614">&#39;&#34;&#39;</span><span class="op" id="3538617">:</span>&nbsp;&nbsp;<span class="string" id="3538620">&#34;&amp;#34;&#34;</span><span class="op" id="3538627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538630">&#39;\&#39;&#39;</span><span class="op" id="3538634">:</span>&nbsp;<span class="string" id="3538636">&#34;&amp;#39;&#34;</span><span class="op" id="3538643">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538646">&#39;+&#39;</span><span class="op" id="3538649">:</span>&nbsp;&nbsp;<span class="string" id="3538652">&#34;&amp;#43;&#34;</span><span class="op" id="3538659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538662">&#39;&lt;&#39;</span><span class="op" id="3538665">:</span>&nbsp;&nbsp;<span class="string" id="3538668">&#34;&amp;lt;&#34;</span><span class="op" id="3538674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538677">&#39;=&#39;</span><span class="op" id="3538680">:</span>&nbsp;&nbsp;<span class="string" id="3538683">&#34;&amp;#61;&#34;</span><span class="op" id="3538690">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538693">&#39;&gt;&#39;</span><span class="op" id="3538696">:</span>&nbsp;&nbsp;<span class="string" id="3538699">&#34;&amp;gt;&#34;</span><span class="op" id="3538705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3538708">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3538764">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3538799">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3538841">&#39;`&#39;</span><span class="op" id="3538844">:</span>&nbsp;<span class="string" id="3538846">&#34;&amp;#96;&#34;</span><span class="op" id="3538853">,</span><br>
<span class="lineno">135</span><span class="op" id="3538855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3538858">//&nbsp;htmlReplacer&nbsp;returns&nbsp;s&nbsp;with&nbsp;runes&nbsp;replaced&nbsp;according&nbsp;to&nbsp;replacementTable</span><br>
<span class="lineno"></span><span class="comment" id="3538934">//&nbsp;and&nbsp;when&nbsp;badRunes&nbsp;is&nbsp;true,&nbsp;certain&nbsp;bad&nbsp;runes&nbsp;are&nbsp;allowed&nbsp;through&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="3539013">func</span>&nbsp;<span class="ident" id="3539018">htmlReplacer</span><span class="op" id="3539030">(</span><span class="ident" id="3539031">s</span>&nbsp;<span class="builtintype" id="3539033">string</span><span class="op" id="3539039">,</span>&nbsp;<span class="ident" id="3539041">replacementTable</span>&nbsp;<span class="op" id="3539058">[</span><span class="op" id="3539059">]</span><span class="builtintype" id="3539060">string</span><span class="op" id="3539066">,</span>&nbsp;<span class="ident" id="3539068">badRunes</span>&nbsp;<span class="builtintype" id="3539077">bool</span><span class="op" id="3539081">)</span>&nbsp;<span class="builtintype" id="3539083">string</span>&nbsp;<span class="op" id="3539090">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539093">written</span><span class="op" id="3539100">,</span>&nbsp;<span class="ident" id="3539102">b</span>&nbsp;<span class="op" id="3539104">:=</span>&nbsp;<span class="num" id="3539107">0</span><span class="op" id="3539108">,</span>&nbsp;<span class="builtinfunc" id="3539110">new</span><span class="op" id="3539113">(</span><span class="ident" id="3539114">bytes</span><span class="op" id="3539119">.</span><span class="ident" id="3539120">Buffer</span><span class="op" id="3539126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3539129">for</span>&nbsp;<span class="ident" id="3539133">i</span><span class="op" id="3539134">,</span>&nbsp;<span class="ident" id="3539136">r</span>&nbsp;<span class="op" id="3539138">:=</span>&nbsp;<span class="keyword" id="3539141">range</span>&nbsp;<span class="ident" id="3539147">s</span>&nbsp;<span class="op" id="3539149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3539153">if</span>&nbsp;<span class="builtintype" id="3539156">int</span><span class="op" id="3539159">(</span><span class="ident" id="3539160">r</span><span class="op" id="3539161">)</span>&nbsp;<span class="op" id="3539163">&lt;</span>&nbsp;<span class="builtinfunc" id="3539165">len</span><span class="op" id="3539168">(</span><span class="ident" id="3539169">replacementTable</span><span class="op" id="3539185">)</span>&nbsp;<span class="op" id="3539187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3539192">if</span>&nbsp;<span class="ident" id="3539195">repl</span>&nbsp;<span class="op" id="3539200">:=</span>&nbsp;<span class="ident" id="3539203">replacementTable</span><span class="op" id="3539219">[</span><span class="ident" id="3539220">r</span><span class="op" id="3539221">]</span><span class="op" id="3539222">;</span>&nbsp;<span class="builtinfunc" id="3539224">len</span><span class="op" id="3539227">(</span><span class="ident" id="3539228">repl</span><span class="op" id="3539232">)</span>&nbsp;<span class="op" id="3539234">!=</span>&nbsp;<span class="num" id="3539237">0</span>&nbsp;<span class="op" id="3539239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539245">b</span><span class="op" id="3539246">.</span><span class="ident" id="3539247">WriteString</span><span class="op" id="3539258">(</span><span class="ident" id="3539259">s</span><span class="op" id="3539260">[</span><span class="ident" id="3539261">written</span><span class="op" id="3539268">:</span><span class="ident" id="3539269">i</span><span class="op" id="3539270">]</span><span class="op" id="3539271">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539277">b</span><span class="op" id="3539278">.</span><span class="ident" id="3539279">WriteString</span><span class="op" id="3539290">(</span><span class="ident" id="3539291">repl</span><span class="op" id="3539295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539301">//&nbsp;Valid&nbsp;as&nbsp;long&nbsp;as&nbsp;replacementTable&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539350">//&nbsp;include&nbsp;anything&nbsp;above&nbsp;0x7f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539386">written</span>&nbsp;<span class="op" id="3539394">=</span>&nbsp;<span class="ident" id="3539396">i</span>&nbsp;<span class="op" id="3539398">+</span>&nbsp;<span class="ident" id="3539400">utf8</span><span class="op" id="3539404">.</span><span class="ident" id="3539405">RuneLen</span><span class="op" id="3539412">(</span><span class="ident" id="3539413">r</span><span class="op" id="3539414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3539419">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3539423">}</span>&nbsp;<span class="keyword" id="3539425">else</span>&nbsp;<span class="keyword" id="3539430">if</span>&nbsp;<span class="ident" id="3539433">badRunes</span>&nbsp;<span class="op" id="3539442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539447">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539460">//&nbsp;IE&nbsp;does&nbsp;not&nbsp;allow&nbsp;these&nbsp;ranges&nbsp;in&nbsp;unquoted&nbsp;attrs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3539515">}</span>&nbsp;<span class="keyword" id="3539517">else</span>&nbsp;<span class="keyword" id="3539522">if</span>&nbsp;<span class="num" id="3539525">0xfdd0</span>&nbsp;<span class="op" id="3539532">&lt;=</span>&nbsp;<span class="ident" id="3539535">r</span>&nbsp;<span class="op" id="3539537">&amp;&amp;</span>&nbsp;<span class="ident" id="3539540">r</span>&nbsp;<span class="op" id="3539542">&lt;=</span>&nbsp;<span class="num" id="3539545">0xfdef</span>&nbsp;<span class="op" id="3539552">||</span>&nbsp;<span class="num" id="3539555">0xfff0</span>&nbsp;<span class="op" id="3539562">&lt;=</span>&nbsp;<span class="ident" id="3539565">r</span>&nbsp;<span class="op" id="3539567">&amp;&amp;</span>&nbsp;<span class="ident" id="3539570">r</span>&nbsp;<span class="op" id="3539572">&lt;=</span>&nbsp;<span class="num" id="3539575">0xffff</span>&nbsp;<span class="op" id="3539582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539587">fmt</span><span class="op" id="3539590">.</span><span class="ident" id="3539591">Fprintf</span><span class="op" id="3539598">(</span><span class="ident" id="3539599">b</span><span class="op" id="3539600">,</span>&nbsp;<span class="string" id="3539602">&#34;%s&amp;#x%x;&#34;</span><span class="op" id="3539612">,</span>&nbsp;<span class="ident" id="3539614">s</span><span class="op" id="3539615">[</span><span class="ident" id="3539616">written</span><span class="op" id="3539623">:</span><span class="ident" id="3539624">i</span><span class="op" id="3539625">]</span><span class="op" id="3539626">,</span>&nbsp;<span class="ident" id="3539628">r</span><span class="op" id="3539629">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539634">written</span>&nbsp;<span class="op" id="3539642">=</span>&nbsp;<span class="ident" id="3539644">i</span>&nbsp;<span class="op" id="3539646">+</span>&nbsp;<span class="ident" id="3539648">utf8</span><span class="op" id="3539652">.</span><span class="ident" id="3539653">RuneLen</span><span class="op" id="3539660">(</span><span class="ident" id="3539661">r</span><span class="op" id="3539662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3539666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3539669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3539672">if</span>&nbsp;<span class="ident" id="3539675">written</span>&nbsp;<span class="op" id="3539683">==</span>&nbsp;<span class="num" id="3539686">0</span>&nbsp;<span class="op" id="3539688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3539692">return</span>&nbsp;<span class="ident" id="3539699">s</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3539702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539705">b</span><span class="op" id="3539706">.</span><span class="ident" id="3539707">WriteString</span><span class="op" id="3539718">(</span><span class="ident" id="3539719">s</span><span class="op" id="3539720">[</span><span class="ident" id="3539721">written</span><span class="op" id="3539728">:</span><span class="op" id="3539729">]</span><span class="op" id="3539730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3539733">return</span>&nbsp;<span class="ident" id="3539740">b</span><span class="op" id="3539741">.</span><span class="ident" id="3539742">String</span><span class="op" id="3539748">(</span><span class="op" id="3539749">)</span><br>
<span class="lineno"></span><span class="op" id="3539751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3539754">//&nbsp;stripTags&nbsp;takes&nbsp;a&nbsp;snippet&nbsp;of&nbsp;HTML&nbsp;and&nbsp;returns&nbsp;only&nbsp;the&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="3539826">//&nbsp;For&nbsp;example,&nbsp;`&lt;b&gt;&amp;iexcl;Hi!&lt;/b&gt;&nbsp;&lt;script&gt;...&lt;/script&gt;`&nbsp;-&gt;&nbsp;`&amp;iexcl;Hi!&nbsp;`.</span><br>
<span class="lineno"></span><span class="keyword" id="3539901">func</span>&nbsp;<span class="ident" id="3539906">stripTags</span><span class="op" id="3539915">(</span><span class="ident" id="3539916">html</span>&nbsp;<span class="builtintype" id="3539921">string</span><span class="op" id="3539927">)</span>&nbsp;<span class="builtintype" id="3539929">string</span>&nbsp;<span class="op" id="3539936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3539939">var</span>&nbsp;<span class="ident" id="3539943">b</span>&nbsp;<span class="ident" id="3539945">bytes</span><span class="op" id="3539950">.</span><span class="ident" id="3539951">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539959">s</span><span class="op" id="3539960">,</span>&nbsp;<span class="ident" id="3539962">c</span><span class="op" id="3539963">,</span>&nbsp;<span class="ident" id="3539965">i</span><span class="op" id="3539966">,</span>&nbsp;<span class="ident" id="3539968">allText</span>&nbsp;<span class="op" id="3539976">:=</span>&nbsp;<span class="op" id="3539979">[</span><span class="op" id="3539980">]</span><span class="builtintype" id="3539981">byte</span><span class="op" id="3539985">(</span><span class="ident" id="3539986">html</span><span class="op" id="3539990">)</span><span class="op" id="3539991">,</span>&nbsp;<span class="ident" id="3539993">context</span><span class="op" id="3540000">{</span><span class="op" id="3540001">}</span><span class="op" id="3540002">,</span>&nbsp;<span class="num" id="3540004">0</span><span class="op" id="3540005">,</span>&nbsp;<span class="builtintype" id="3540007">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540013">//&nbsp;Using&nbsp;the&nbsp;transition&nbsp;funcs&nbsp;helps&nbsp;us&nbsp;avoid&nbsp;mangling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540068">//&nbsp;`&lt;div&nbsp;title=&#34;1&gt;2&#34;&gt;`&nbsp;or&nbsp;`I&nbsp;&lt;3&nbsp;Ponies!`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540111">for</span>&nbsp;<span class="ident" id="3540115">i</span>&nbsp;<span class="op" id="3540117">!=</span>&nbsp;<span class="builtinfunc" id="3540120">len</span><span class="op" id="3540123">(</span><span class="ident" id="3540124">s</span><span class="op" id="3540125">)</span>&nbsp;<span class="op" id="3540127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540131">if</span>&nbsp;<span class="ident" id="3540134">c</span><span class="op" id="3540135">.</span><span class="ident" id="3540136">delim</span>&nbsp;<span class="op" id="3540142">==</span>&nbsp;<span class="ident" id="3540145">delimNone</span>&nbsp;<span class="op" id="3540155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540160">st</span>&nbsp;<span class="op" id="3540163">:=</span>&nbsp;<span class="ident" id="3540166">c</span><span class="op" id="3540167">.</span><span class="ident" id="3540168">state</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540177">//&nbsp;Use&nbsp;RCDATA&nbsp;instead&nbsp;of&nbsp;parsing&nbsp;into&nbsp;JS&nbsp;or&nbsp;CSS&nbsp;styles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540236">if</span>&nbsp;<span class="ident" id="3540239">c</span><span class="op" id="3540240">.</span><span class="ident" id="3540241">element</span>&nbsp;<span class="op" id="3540249">!=</span>&nbsp;<span class="ident" id="3540252">elementNone</span>&nbsp;<span class="op" id="3540264">&amp;&amp;</span>&nbsp;<span class="op" id="3540267">!</span><span class="ident" id="3540268">isInTag</span><span class="op" id="3540275">(</span><span class="ident" id="3540276">st</span><span class="op" id="3540278">)</span>&nbsp;<span class="op" id="3540280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540286">st</span>&nbsp;<span class="op" id="3540289">=</span>&nbsp;<span class="ident" id="3540291">stateRCDATA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3540306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540311">d</span><span class="op" id="3540312">,</span>&nbsp;<span class="ident" id="3540314">nread</span>&nbsp;<span class="op" id="3540320">:=</span>&nbsp;<span class="ident" id="3540323">transitionFunc</span><span class="op" id="3540337">[</span><span class="ident" id="3540338">st</span><span class="op" id="3540340">]</span><span class="op" id="3540341">(</span><span class="ident" id="3540342">c</span><span class="op" id="3540343">,</span>&nbsp;<span class="ident" id="3540345">s</span><span class="op" id="3540346">[</span><span class="ident" id="3540347">i</span><span class="op" id="3540348">:</span><span class="op" id="3540349">]</span><span class="op" id="3540350">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540355">i1</span>&nbsp;<span class="op" id="3540358">:=</span>&nbsp;<span class="ident" id="3540361">i</span>&nbsp;<span class="op" id="3540363">+</span>&nbsp;<span class="ident" id="3540365">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540374">if</span>&nbsp;<span class="ident" id="3540377">c</span><span class="op" id="3540378">.</span><span class="ident" id="3540379">state</span>&nbsp;<span class="op" id="3540385">==</span>&nbsp;<span class="ident" id="3540388">stateText</span>&nbsp;<span class="op" id="3540398">||</span>&nbsp;<span class="ident" id="3540401">c</span><span class="op" id="3540402">.</span><span class="ident" id="3540403">state</span>&nbsp;<span class="op" id="3540409">==</span>&nbsp;<span class="ident" id="3540412">stateRCDATA</span>&nbsp;<span class="op" id="3540424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540430">//&nbsp;Emit&nbsp;text&nbsp;up&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;tag&nbsp;or&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540486">j</span>&nbsp;<span class="op" id="3540488">:=</span>&nbsp;<span class="ident" id="3540491">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540498">if</span>&nbsp;<span class="ident" id="3540501">d</span><span class="op" id="3540502">.</span><span class="ident" id="3540503">state</span>&nbsp;<span class="op" id="3540509">!=</span>&nbsp;<span class="ident" id="3540512">c</span><span class="op" id="3540513">.</span><span class="ident" id="3540514">state</span>&nbsp;<span class="op" id="3540520">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540527">for</span>&nbsp;<span class="ident" id="3540531">j1</span>&nbsp;<span class="op" id="3540534">:=</span>&nbsp;<span class="ident" id="3540537">j</span>&nbsp;<span class="op" id="3540539">-</span>&nbsp;<span class="num" id="3540541">1</span><span class="op" id="3540542">;</span>&nbsp;<span class="ident" id="3540544">j1</span>&nbsp;<span class="op" id="3540547">&gt;=</span>&nbsp;<span class="ident" id="3540550">i</span><span class="op" id="3540551">;</span>&nbsp;<span class="ident" id="3540553">j1</span><span class="op" id="3540555">--</span>&nbsp;<span class="op" id="3540558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540566">if</span>&nbsp;<span class="ident" id="3540569">s</span><span class="op" id="3540570">[</span><span class="ident" id="3540571">j1</span><span class="op" id="3540573">]</span>&nbsp;<span class="op" id="3540575">==</span>&nbsp;<span class="string" id="3540578">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="3540582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540591">j</span>&nbsp;<span class="op" id="3540593">=</span>&nbsp;<span class="ident" id="3540595">j1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540605">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3540617">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3540624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3540630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540636">b</span><span class="op" id="3540637">.</span><span class="ident" id="3540638">Write</span><span class="op" id="3540643">(</span><span class="ident" id="3540644">s</span><span class="op" id="3540645">[</span><span class="ident" id="3540646">i</span><span class="op" id="3540647">:</span><span class="ident" id="3540648">j</span><span class="op" id="3540649">]</span><span class="op" id="3540650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3540655">}</span>&nbsp;<span class="keyword" id="3540657">else</span>&nbsp;<span class="op" id="3540662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540668">allText</span>&nbsp;<span class="op" id="3540676">=</span>&nbsp;<span class="builtintype" id="3540678">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3540687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540692">c</span><span class="op" id="3540693">,</span>&nbsp;<span class="ident" id="3540695">i</span>&nbsp;<span class="op" id="3540697">=</span>&nbsp;<span class="ident" id="3540699">d</span><span class="op" id="3540700">,</span>&nbsp;<span class="ident" id="3540702">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540708">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3540719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540723">i1</span>&nbsp;<span class="op" id="3540726">:=</span>&nbsp;<span class="ident" id="3540729">i</span>&nbsp;<span class="op" id="3540731">+</span>&nbsp;<span class="ident" id="3540733">bytes</span><span class="op" id="3540738">.</span><span class="ident" id="3540739">IndexAny</span><span class="op" id="3540747">(</span><span class="ident" id="3540748">s</span><span class="op" id="3540749">[</span><span class="ident" id="3540750">i</span><span class="op" id="3540751">:</span><span class="op" id="3540752">]</span><span class="op" id="3540753">,</span>&nbsp;<span class="ident" id="3540755">delimEnds</span><span class="op" id="3540764">[</span><span class="ident" id="3540765">c</span><span class="op" id="3540766">.</span><span class="ident" id="3540767">delim</span><span class="op" id="3540772">]</span><span class="op" id="3540773">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540777">if</span>&nbsp;<span class="ident" id="3540780">i1</span>&nbsp;<span class="op" id="3540783">&lt;</span>&nbsp;<span class="ident" id="3540785">i</span>&nbsp;<span class="op" id="3540787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540792">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3540800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540804">if</span>&nbsp;<span class="ident" id="3540807">c</span><span class="op" id="3540808">.</span><span class="ident" id="3540809">delim</span>&nbsp;<span class="op" id="3540815">!=</span>&nbsp;<span class="ident" id="3540818">delimSpaceOrTagEnd</span>&nbsp;<span class="op" id="3540837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3540842">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540867">i1</span><span class="op" id="3540869">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3540874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540878">c</span><span class="op" id="3540879">,</span>&nbsp;<span class="ident" id="3540881">i</span>&nbsp;<span class="op" id="3540883">=</span>&nbsp;<span class="ident" id="3540885">context</span><span class="op" id="3540892">{</span><span class="ident" id="3540893">state</span><span class="op" id="3540898">:</span>&nbsp;<span class="ident" id="3540900">stateTag</span><span class="op" id="3540908">,</span>&nbsp;<span class="ident" id="3540910">element</span><span class="op" id="3540917">:</span>&nbsp;<span class="ident" id="3540919">c</span><span class="op" id="3540920">.</span><span class="ident" id="3540921">element</span><span class="op" id="3540928">}</span><span class="op" id="3540929">,</span>&nbsp;<span class="ident" id="3540931">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3540935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540938">if</span>&nbsp;<span class="ident" id="3540941">allText</span>&nbsp;<span class="op" id="3540949">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540953">return</span>&nbsp;<span class="ident" id="3540960">html</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3540966">}</span>&nbsp;<span class="keyword" id="3540968">else</span>&nbsp;<span class="keyword" id="3540973">if</span>&nbsp;<span class="ident" id="3540976">c</span><span class="op" id="3540977">.</span><span class="ident" id="3540978">state</span>&nbsp;<span class="op" id="3540984">==</span>&nbsp;<span class="ident" id="3540987">stateText</span>&nbsp;<span class="op" id="3540997">||</span>&nbsp;<span class="ident" id="3541000">c</span><span class="op" id="3541001">.</span><span class="ident" id="3541002">state</span>&nbsp;<span class="op" id="3541008">==</span>&nbsp;<span class="ident" id="3541011">stateRCDATA</span>&nbsp;<span class="op" id="3541023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541027">b</span><span class="op" id="3541028">.</span><span class="ident" id="3541029">Write</span><span class="op" id="3541034">(</span><span class="ident" id="3541035">s</span><span class="op" id="3541036">[</span><span class="ident" id="3541037">i</span><span class="op" id="3541038">:</span><span class="op" id="3541039">]</span><span class="op" id="3541040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3541043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541046">return</span>&nbsp;<span class="ident" id="3541053">b</span><span class="op" id="3541054">.</span><span class="ident" id="3541055">String</span><span class="op" id="3541061">(</span><span class="op" id="3541062">)</span><br>
<span class="lineno">215</span><span class="op" id="3541064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3541067">//&nbsp;htmlNameFilter&nbsp;accepts&nbsp;valid&nbsp;parts&nbsp;of&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;tag&nbsp;name&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3541141">//&nbsp;a&nbsp;known-safe&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="3541173">func</span>&nbsp;<span class="ident" id="3541178">htmlNameFilter</span><span class="op" id="3541192">(</span><span class="ident" id="3541193">args</span>&nbsp;<span class="op" id="3541198">...</span><span class="keyword" id="3541201">interface</span><span class="op" id="3541210">{</span><span class="op" id="3541211">}</span><span class="op" id="3541212">)</span>&nbsp;<span class="builtintype" id="3541214">string</span>&nbsp;<span class="op" id="3541221">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541224">s</span><span class="op" id="3541225">,</span>&nbsp;<span class="ident" id="3541227">t</span>&nbsp;<span class="op" id="3541229">:=</span>&nbsp;<span class="ident" id="3541232">stringify</span><span class="op" id="3541241">(</span><span class="ident" id="3541242">args</span><span class="op" id="3541246">...</span><span class="op" id="3541249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541252">if</span>&nbsp;<span class="ident" id="3541255">t</span>&nbsp;<span class="op" id="3541257">==</span>&nbsp;<span class="ident" id="3541260">contentTypeHTMLAttr</span>&nbsp;<span class="op" id="3541280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541284">return</span>&nbsp;<span class="ident" id="3541291">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3541294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541297">if</span>&nbsp;<span class="builtinfunc" id="3541300">len</span><span class="op" id="3541303">(</span><span class="ident" id="3541304">s</span><span class="op" id="3541305">)</span>&nbsp;<span class="op" id="3541307">==</span>&nbsp;<span class="num" id="3541310">0</span>&nbsp;<span class="op" id="3541312">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541316">//&nbsp;Avoid&nbsp;violation&nbsp;of&nbsp;structure&nbsp;preservation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541364">//&nbsp;&lt;input&nbsp;checked&nbsp;{{.K}}={{.V}}&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541400">//&nbsp;Without&nbsp;this,&nbsp;if&nbsp;.K&nbsp;is&nbsp;empty&nbsp;then&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541458">//&nbsp;checked,&nbsp;but&nbsp;otherwise&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;attribute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541519">//&nbsp;named&nbsp;.K.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541534">return</span>&nbsp;<span class="ident" id="3541541">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3541557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541560">s</span>&nbsp;<span class="op" id="3541562">=</span>&nbsp;<span class="ident" id="3541564">strings</span><span class="op" id="3541571">.</span><span class="ident" id="3541572">ToLower</span><span class="op" id="3541579">(</span><span class="ident" id="3541580">s</span><span class="op" id="3541581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541584">if</span>&nbsp;<span class="ident" id="3541587">t</span>&nbsp;<span class="op" id="3541589">:=</span>&nbsp;<span class="ident" id="3541592">attrType</span><span class="op" id="3541600">(</span><span class="ident" id="3541601">s</span><span class="op" id="3541602">)</span><span class="op" id="3541603">;</span>&nbsp;<span class="ident" id="3541605">t</span>&nbsp;<span class="op" id="3541607">!=</span>&nbsp;<span class="ident" id="3541610">contentTypePlain</span>&nbsp;<span class="op" id="3541627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541631">//&nbsp;TODO:&nbsp;Split&nbsp;attr&nbsp;and&nbsp;element&nbsp;name&nbsp;part&nbsp;filters&nbsp;so&nbsp;we&nbsp;can&nbsp;whitelist</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541703">//&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541720">return</span>&nbsp;<span class="ident" id="3541727">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3541743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541746">for</span>&nbsp;<span class="ident" id="3541750">_</span><span class="op" id="3541751">,</span>&nbsp;<span class="ident" id="3541753">r</span>&nbsp;<span class="op" id="3541755">:=</span>&nbsp;<span class="keyword" id="3541758">range</span>&nbsp;<span class="ident" id="3541764">s</span>&nbsp;<span class="op" id="3541766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541770">switch</span>&nbsp;<span class="op" id="3541777">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541781">case</span>&nbsp;<span class="string" id="3541786">&#39;0&#39;</span>&nbsp;<span class="op" id="3541790">&lt;=</span>&nbsp;<span class="ident" id="3541793">r</span>&nbsp;<span class="op" id="3541795">&amp;&amp;</span>&nbsp;<span class="ident" id="3541798">r</span>&nbsp;<span class="op" id="3541800">&lt;=</span>&nbsp;<span class="string" id="3541803">&#39;9&#39;</span><span class="op" id="3541806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541810">case</span>&nbsp;<span class="string" id="3541815">&#39;a&#39;</span>&nbsp;<span class="op" id="3541819">&lt;=</span>&nbsp;<span class="ident" id="3541822">r</span>&nbsp;<span class="op" id="3541824">&amp;&amp;</span>&nbsp;<span class="ident" id="3541827">r</span>&nbsp;<span class="op" id="3541829">&lt;=</span>&nbsp;<span class="string" id="3541832">&#39;z&#39;</span><span class="op" id="3541835">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541839">default</span><span class="op" id="3541846">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541851">return</span>&nbsp;<span class="ident" id="3541858">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3541875">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3541878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541881">return</span>&nbsp;<span class="ident" id="3541888">s</span><br>
<span class="lineno"></span><span class="op" id="3541890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3541893">//&nbsp;commentEscaper&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string&nbsp;regardless&nbsp;of&nbsp;input.</span><br>
<span class="lineno">250</span><span class="comment" id="3541957">//&nbsp;Comment&nbsp;content&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;any&nbsp;parsed&nbsp;structure&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3542023">//&nbsp;human-readable&nbsp;content,&nbsp;so&nbsp;the&nbsp;simplest&nbsp;and&nbsp;most&nbsp;secure&nbsp;policy&nbsp;is&nbsp;to&nbsp;drop</span><br>
<span class="lineno"></span><span class="comment" id="3542100">//&nbsp;content&nbsp;interpolated&nbsp;into&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="3542139">//&nbsp;This&nbsp;approach&nbsp;is&nbsp;equally&nbsp;valid&nbsp;whether&nbsp;or&nbsp;not&nbsp;static&nbsp;comment&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3542214">//&nbsp;removed&nbsp;from&nbsp;the&nbsp;template.</span><br>
<span class="lineno">255</span><span class="keyword" id="3542244">func</span>&nbsp;<span class="ident" id="3542249">commentEscaper</span><span class="op" id="3542263">(</span><span class="ident" id="3542264">args</span>&nbsp;<span class="op" id="3542269">...</span><span class="keyword" id="3542272">interface</span><span class="op" id="3542281">{</span><span class="op" id="3542282">}</span><span class="op" id="3542283">)</span>&nbsp;<span class="builtintype" id="3542285">string</span>&nbsp;<span class="op" id="3542292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542295">return</span>&nbsp;<span class="string" id="3542302">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3542305">}</span>
</div>
</body>
</html>
