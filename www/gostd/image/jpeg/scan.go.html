<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html" class="current">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1750451">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1750506">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1750560">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1750611">package</span>&nbsp;<span class="ident" id="1750619">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1750625">import</span>&nbsp;<span class="op" id="1750632">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1750635">&#34;image&#34;</span><br>
<span class="lineno"></span><span class="op" id="1750643">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1750646">//&nbsp;makeImg&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;the&nbsp;destination&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="1750706">func</span>&nbsp;<span class="op" id="1750711">(</span><span class="ident" id="1750712">d</span>&nbsp;<span class="op" id="1750714">*</span><span class="ident" id="1750715">decoder</span><span class="op" id="1750722">)</span>&nbsp;<span class="ident" id="1750724">makeImg</span><span class="op" id="1750731">(</span><span class="ident" id="1750732">h0</span><span class="op" id="1750734">,</span>&nbsp;<span class="ident" id="1750736">v0</span><span class="op" id="1750738">,</span>&nbsp;<span class="ident" id="1750740">mxx</span><span class="op" id="1750743">,</span>&nbsp;<span class="ident" id="1750745">myy</span>&nbsp;<span class="builtintype" id="1750749">int</span><span class="op" id="1750752">)</span>&nbsp;<span class="op" id="1750754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1750757">if</span>&nbsp;<span class="ident" id="1750760">d</span><span class="op" id="1750761">.</span><span class="ident" id="1750762">nComp</span>&nbsp;<span class="op" id="1750768">==</span>&nbsp;<span class="ident" id="1750771">nGrayComponent</span>&nbsp;<span class="op" id="1750786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1750790">m</span>&nbsp;<span class="op" id="1750792">:=</span>&nbsp;<span class="ident" id="1750795">image</span><span class="op" id="1750800">.</span><span class="ident" id="1750801">NewGray</span><span class="op" id="1750808">(</span><span class="ident" id="1750809">image</span><span class="op" id="1750814">.</span><span class="ident" id="1750815">Rect</span><span class="op" id="1750819">(</span><span class="num" id="1750820">0</span><span class="op" id="1750821">,</span>&nbsp;<span class="num" id="1750823">0</span><span class="op" id="1750824">,</span>&nbsp;<span class="num" id="1750826">8</span><span class="op" id="1750827">*</span><span class="ident" id="1750828">mxx</span><span class="op" id="1750831">,</span>&nbsp;<span class="num" id="1750833">8</span><span class="op" id="1750834">*</span><span class="ident" id="1750835">myy</span><span class="op" id="1750838">)</span><span class="op" id="1750839">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1750843">d</span><span class="op" id="1750844">.</span><span class="ident" id="1750845">img1</span>&nbsp;<span class="op" id="1750850">=</span>&nbsp;<span class="ident" id="1750852">m</span><span class="op" id="1750853">.</span><span class="ident" id="1750854">SubImage</span><span class="op" id="1750862">(</span><span class="ident" id="1750863">image</span><span class="op" id="1750868">.</span><span class="ident" id="1750869">Rect</span><span class="op" id="1750873">(</span><span class="num" id="1750874">0</span><span class="op" id="1750875">,</span>&nbsp;<span class="num" id="1750877">0</span><span class="op" id="1750878">,</span>&nbsp;<span class="ident" id="1750880">d</span><span class="op" id="1750881">.</span><span class="ident" id="1750882">width</span><span class="op" id="1750887">,</span>&nbsp;<span class="ident" id="1750889">d</span><span class="op" id="1750890">.</span><span class="ident" id="1750891">height</span><span class="op" id="1750897">)</span><span class="op" id="1750898">)</span><span class="op" id="1750899">.</span><span class="op" id="1750900">(</span><span class="op" id="1750901">*</span><span class="ident" id="1750902">image</span><span class="op" id="1750907">.</span><span class="ident" id="1750908">Gray</span><span class="op" id="1750912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1750916">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1750924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1750927">var</span>&nbsp;<span class="ident" id="1750931">subsampleRatio</span>&nbsp;<span class="ident" id="1750946">image</span><span class="op" id="1750951">.</span><span class="ident" id="1750952">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1750973">switch</span>&nbsp;<span class="op" id="1750980">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1750983">case</span>&nbsp;<span class="ident" id="1750988">h0</span>&nbsp;<span class="op" id="1750991">==</span>&nbsp;<span class="num" id="1750994">1</span>&nbsp;<span class="op" id="1750996">&amp;&amp;</span>&nbsp;<span class="ident" id="1750999">v0</span>&nbsp;<span class="op" id="1751002">==</span>&nbsp;<span class="num" id="1751005">1</span><span class="op" id="1751006">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1751010">subsampleRatio</span>&nbsp;<span class="op" id="1751025">=</span>&nbsp;<span class="ident" id="1751027">image</span><span class="op" id="1751032">.</span><span class="ident" id="1751033">YCbCrSubsampleRatio444</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1751057">case</span>&nbsp;<span class="ident" id="1751062">h0</span>&nbsp;<span class="op" id="1751065">==</span>&nbsp;<span class="num" id="1751068">1</span>&nbsp;<span class="op" id="1751070">&amp;&amp;</span>&nbsp;<span class="ident" id="1751073">v0</span>&nbsp;<span class="op" id="1751076">==</span>&nbsp;<span class="num" id="1751079">2</span><span class="op" id="1751080">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1751084">subsampleRatio</span>&nbsp;<span class="op" id="1751099">=</span>&nbsp;<span class="ident" id="1751101">image</span><span class="op" id="1751106">.</span><span class="ident" id="1751107">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1751131">case</span>&nbsp;<span class="ident" id="1751136">h0</span>&nbsp;<span class="op" id="1751139">==</span>&nbsp;<span class="num" id="1751142">2</span>&nbsp;<span class="op" id="1751144">&amp;&amp;</span>&nbsp;<span class="ident" id="1751147">v0</span>&nbsp;<span class="op" id="1751150">==</span>&nbsp;<span class="num" id="1751153">1</span><span class="op" id="1751154">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1751158">subsampleRatio</span>&nbsp;<span class="op" id="1751173">=</span>&nbsp;<span class="ident" id="1751175">image</span><span class="op" id="1751180">.</span><span class="ident" id="1751181">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1751205">case</span>&nbsp;<span class="ident" id="1751210">h0</span>&nbsp;<span class="op" id="1751213">==</span>&nbsp;<span class="num" id="1751216">2</span>&nbsp;<span class="op" id="1751218">&amp;&amp;</span>&nbsp;<span class="ident" id="1751221">v0</span>&nbsp;<span class="op" id="1751224">==</span>&nbsp;<span class="num" id="1751227">2</span><span class="op" id="1751228">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1751232">subsampleRatio</span>&nbsp;<span class="op" id="1751247">=</span>&nbsp;<span class="ident" id="1751249">image</span><span class="op" id="1751254">.</span><span class="ident" id="1751255">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1751279">default</span><span class="op" id="1751286">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1751290">panic</span><span class="op" id="1751295">(</span><span class="string" id="1751296">&#34;unreachable&#34;</span><span class="op" id="1751309">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1751312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1751315">m</span>&nbsp;<span class="op" id="1751317">:=</span>&nbsp;<span class="ident" id="1751320">image</span><span class="op" id="1751325">.</span><span class="ident" id="1751326">NewYCbCr</span><span class="op" id="1751334">(</span><span class="ident" id="1751335">image</span><span class="op" id="1751340">.</span><span class="ident" id="1751341">Rect</span><span class="op" id="1751345">(</span><span class="num" id="1751346">0</span><span class="op" id="1751347">,</span>&nbsp;<span class="num" id="1751349">0</span><span class="op" id="1751350">,</span>&nbsp;<span class="num" id="1751352">8</span><span class="op" id="1751353">*</span><span class="ident" id="1751354">h0</span><span class="op" id="1751356">*</span><span class="ident" id="1751357">mxx</span><span class="op" id="1751360">,</span>&nbsp;<span class="num" id="1751362">8</span><span class="op" id="1751363">*</span><span class="ident" id="1751364">v0</span><span class="op" id="1751366">*</span><span class="ident" id="1751367">myy</span><span class="op" id="1751370">)</span><span class="op" id="1751371">,</span>&nbsp;<span class="ident" id="1751373">subsampleRatio</span><span class="op" id="1751387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1751390">d</span><span class="op" id="1751391">.</span><span class="ident" id="1751392">img3</span>&nbsp;<span class="op" id="1751397">=</span>&nbsp;<span class="ident" id="1751399">m</span><span class="op" id="1751400">.</span><span class="ident" id="1751401">SubImage</span><span class="op" id="1751409">(</span><span class="ident" id="1751410">image</span><span class="op" id="1751415">.</span><span class="ident" id="1751416">Rect</span><span class="op" id="1751420">(</span><span class="num" id="1751421">0</span><span class="op" id="1751422">,</span>&nbsp;<span class="num" id="1751424">0</span><span class="op" id="1751425">,</span>&nbsp;<span class="ident" id="1751427">d</span><span class="op" id="1751428">.</span><span class="ident" id="1751429">width</span><span class="op" id="1751434">,</span>&nbsp;<span class="ident" id="1751436">d</span><span class="op" id="1751437">.</span><span class="ident" id="1751438">height</span><span class="op" id="1751444">)</span><span class="op" id="1751445">)</span><span class="op" id="1751446">.</span><span class="op" id="1751447">(</span><span class="op" id="1751448">*</span><span class="ident" id="1751449">image</span><span class="op" id="1751454">.</span><span class="ident" id="1751455">YCbCr</span><span class="op" id="1751460">)</span><br>
<span class="lineno"></span><span class="op" id="1751462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="1751465">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.3.</span><br>
<span class="lineno"></span><span class="keyword" id="1751496">func</span>&nbsp;<span class="op" id="1751501">(</span><span class="ident" id="1751502">d</span>&nbsp;<span class="op" id="1751504">*</span><span class="ident" id="1751505">decoder</span><span class="op" id="1751512">)</span>&nbsp;<span class="ident" id="1751514">processSOS</span><span class="op" id="1751524">(</span><span class="ident" id="1751525">n</span>&nbsp;<span class="builtintype" id="1751527">int</span><span class="op" id="1751530">)</span>&nbsp;<span class="builtintype" id="1751532">error</span>&nbsp;<span class="op" id="1751538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1751541">if</span>&nbsp;<span class="ident" id="1751544">d</span><span class="op" id="1751545">.</span><span class="ident" id="1751546">nComp</span>&nbsp;<span class="op" id="1751552">==</span>&nbsp;<span class="num" id="1751555">0</span>&nbsp;<span class="op" id="1751557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1751561">return</span>&nbsp;<span class="ident" id="1751568">FormatError</span><span class="op" id="1751579">(</span><span class="string" id="1751580">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="1751600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1751603">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1751606">if</span>&nbsp;<span class="ident" id="1751609">n</span>&nbsp;<span class="op" id="1751611">&lt;</span>&nbsp;<span class="num" id="1751613">6</span>&nbsp;<span class="op" id="1751615">||</span>&nbsp;<span class="num" id="1751618">4</span><span class="op" id="1751619">+</span><span class="num" id="1751620">2</span><span class="op" id="1751621">*</span><span class="ident" id="1751622">d</span><span class="op" id="1751623">.</span><span class="ident" id="1751624">nComp</span>&nbsp;<span class="op" id="1751630">&lt;</span>&nbsp;<span class="ident" id="1751632">n</span>&nbsp;<span class="op" id="1751634">||</span>&nbsp;<span class="ident" id="1751637">n</span><span class="op" id="1751638">%</span><span class="num" id="1751639">2</span>&nbsp;<span class="op" id="1751641">!=</span>&nbsp;<span class="num" id="1751644">0</span>&nbsp;<span class="op" id="1751646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1751650">return</span>&nbsp;<span class="ident" id="1751657">FormatError</span><span class="op" id="1751668">(</span><span class="string" id="1751669">&#34;SOS&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="1751691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1751694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1751697">if</span>&nbsp;<span class="ident" id="1751700">err</span>&nbsp;<span class="op" id="1751704">:=</span>&nbsp;<span class="ident" id="1751707">d</span><span class="op" id="1751708">.</span><span class="ident" id="1751709">readFull</span><span class="op" id="1751717">(</span><span class="ident" id="1751718">d</span><span class="op" id="1751719">.</span><span class="ident" id="1751720">tmp</span><span class="op" id="1751723">[</span><span class="op" id="1751724">:</span><span class="ident" id="1751725">n</span><span class="op" id="1751726">]</span><span class="op" id="1751727">)</span><span class="op" id="1751728">;</span>&nbsp;<span class="ident" id="1751730">err</span>&nbsp;<span class="op" id="1751734">!=</span>&nbsp;<span class="builtintype" id="1751737">nil</span>&nbsp;<span class="op" id="1751741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1751745">return</span>&nbsp;<span class="ident" id="1751752">err</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1751757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1751760">nComp</span>&nbsp;<span class="op" id="1751766">:=</span>&nbsp;<span class="builtintype" id="1751769">int</span><span class="op" id="1751772">(</span><span class="ident" id="1751773">d</span><span class="op" id="1751774">.</span><span class="ident" id="1751775">tmp</span><span class="op" id="1751778">[</span><span class="num" id="1751779">0</span><span class="op" id="1751780">]</span><span class="op" id="1751781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1751784">if</span>&nbsp;<span class="ident" id="1751787">n</span>&nbsp;<span class="op" id="1751789">!=</span>&nbsp;<span class="num" id="1751792">4</span><span class="op" id="1751793">+</span><span class="num" id="1751794">2</span><span class="op" id="1751795">*</span><span class="ident" id="1751796">nComp</span>&nbsp;<span class="op" id="1751802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1751806">return</span>&nbsp;<span class="ident" id="1751813">FormatError</span><span class="op" id="1751824">(</span><span class="string" id="1751825">&#34;SOS&nbsp;length&nbsp;inconsistent&nbsp;with&nbsp;number&nbsp;of&nbsp;components&#34;</span><span class="op" id="1751876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1751879">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1751882">var</span>&nbsp;<span class="ident" id="1751886">scan</span>&nbsp;<span class="op" id="1751891">[</span><span class="ident" id="1751892">nColorComponent</span><span class="op" id="1751907">]</span><span class="keyword" id="1751908">struct</span>&nbsp;<span class="op" id="1751915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1751919">compIndex</span>&nbsp;<span class="builtintype" id="1751929">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1751937">td</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1751947">uint8</span>&nbsp;<span class="comment" id="1751953">//&nbsp;DC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1751977">ta</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1751987">uint8</span>&nbsp;<span class="comment" id="1751993">//&nbsp;AC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1752016">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1752019">for</span>&nbsp;<span class="ident" id="1752023">i</span>&nbsp;<span class="op" id="1752025">:=</span>&nbsp;<span class="num" id="1752028">0</span><span class="op" id="1752029">;</span>&nbsp;<span class="ident" id="1752031">i</span>&nbsp;<span class="op" id="1752033">&lt;</span>&nbsp;<span class="ident" id="1752035">nComp</span><span class="op" id="1752040">;</span>&nbsp;<span class="ident" id="1752042">i</span><span class="op" id="1752043">++</span>&nbsp;<span class="op" id="1752046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752050">cs</span>&nbsp;<span class="op" id="1752053">:=</span>&nbsp;<span class="ident" id="1752056">d</span><span class="op" id="1752057">.</span><span class="ident" id="1752058">tmp</span><span class="op" id="1752061">[</span><span class="num" id="1752062">1</span><span class="op" id="1752063">+</span><span class="num" id="1752064">2</span><span class="op" id="1752065">*</span><span class="ident" id="1752066">i</span><span class="op" id="1752067">]</span>&nbsp;<span class="comment" id="1752069">//&nbsp;Component&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752094">compIndex</span>&nbsp;<span class="op" id="1752104">:=</span>&nbsp;<span class="op" id="1752107">-</span><span class="num" id="1752108">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1752112">for</span>&nbsp;<span class="ident" id="1752116">j</span><span class="op" id="1752117">,</span>&nbsp;<span class="ident" id="1752119">comp</span>&nbsp;<span class="op" id="1752124">:=</span>&nbsp;<span class="keyword" id="1752127">range</span>&nbsp;<span class="ident" id="1752133">d</span><span class="op" id="1752134">.</span><span class="ident" id="1752135">comp</span>&nbsp;<span class="op" id="1752140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1752145">if</span>&nbsp;<span class="ident" id="1752148">cs</span>&nbsp;<span class="op" id="1752151">==</span>&nbsp;<span class="ident" id="1752154">comp</span><span class="op" id="1752158">.</span><span class="ident" id="1752159">c</span>&nbsp;<span class="op" id="1752161">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752167">compIndex</span>&nbsp;<span class="op" id="1752177">=</span>&nbsp;<span class="ident" id="1752179">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1752184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1752188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1752192">if</span>&nbsp;<span class="ident" id="1752195">compIndex</span>&nbsp;<span class="op" id="1752205">&lt;</span>&nbsp;<span class="num" id="1752207">0</span>&nbsp;<span class="op" id="1752209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1752214">return</span>&nbsp;<span class="ident" id="1752221">FormatError</span><span class="op" id="1752232">(</span><span class="string" id="1752233">&#34;unknown&nbsp;component&nbsp;selector&#34;</span><span class="op" id="1752261">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1752265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752269">scan</span><span class="op" id="1752273">[</span><span class="ident" id="1752274">i</span><span class="op" id="1752275">]</span><span class="op" id="1752276">.</span><span class="ident" id="1752277">compIndex</span>&nbsp;<span class="op" id="1752287">=</span>&nbsp;<span class="builtintype" id="1752289">uint8</span><span class="op" id="1752294">(</span><span class="ident" id="1752295">compIndex</span><span class="op" id="1752304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752308">scan</span><span class="op" id="1752312">[</span><span class="ident" id="1752313">i</span><span class="op" id="1752314">]</span><span class="op" id="1752315">.</span><span class="ident" id="1752316">td</span>&nbsp;<span class="op" id="1752319">=</span>&nbsp;<span class="ident" id="1752321">d</span><span class="op" id="1752322">.</span><span class="ident" id="1752323">tmp</span><span class="op" id="1752326">[</span><span class="num" id="1752327">2</span><span class="op" id="1752328">+</span><span class="num" id="1752329">2</span><span class="op" id="1752330">*</span><span class="ident" id="1752331">i</span><span class="op" id="1752332">]</span>&nbsp;<span class="op" id="1752334">&gt;&gt;</span>&nbsp;<span class="num" id="1752337">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1752341">if</span>&nbsp;<span class="ident" id="1752344">scan</span><span class="op" id="1752348">[</span><span class="ident" id="1752349">i</span><span class="op" id="1752350">]</span><span class="op" id="1752351">.</span><span class="ident" id="1752352">td</span>&nbsp;<span class="op" id="1752355">&gt;</span>&nbsp;<span class="ident" id="1752357">maxTh</span>&nbsp;<span class="op" id="1752363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1752368">return</span>&nbsp;<span class="ident" id="1752375">FormatError</span><span class="op" id="1752386">(</span><span class="string" id="1752387">&#34;bad&nbsp;Td&nbsp;value&#34;</span><span class="op" id="1752401">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1752405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1752409">scan</span><span class="op" id="1752413">[</span><span class="ident" id="1752414">i</span><span class="op" id="1752415">]</span><span class="op" id="1752416">.</span><span class="ident" id="1752417">ta</span>&nbsp;<span class="op" id="1752420">=</span>&nbsp;<span class="ident" id="1752422">d</span><span class="op" id="1752423">.</span><span class="ident" id="1752424">tmp</span><span class="op" id="1752427">[</span><span class="num" id="1752428">2</span><span class="op" id="1752429">+</span><span class="num" id="1752430">2</span><span class="op" id="1752431">*</span><span class="ident" id="1752432">i</span><span class="op" id="1752433">]</span>&nbsp;<span class="op" id="1752435">&amp;</span>&nbsp;<span class="num" id="1752437">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1752444">if</span>&nbsp;<span class="ident" id="1752447">scan</span><span class="op" id="1752451">[</span><span class="ident" id="1752452">i</span><span class="op" id="1752453">]</span><span class="op" id="1752454">.</span><span class="ident" id="1752455">ta</span>&nbsp;<span class="op" id="1752458">&gt;</span>&nbsp;<span class="ident" id="1752460">maxTh</span>&nbsp;<span class="op" id="1752466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1752471">return</span>&nbsp;<span class="ident" id="1752478">FormatError</span><span class="op" id="1752489">(</span><span class="string" id="1752490">&#34;bad&nbsp;Ta&nbsp;value&#34;</span><span class="op" id="1752504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1752508">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1752511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1752515">//&nbsp;zigStart&nbsp;and&nbsp;zigEnd&nbsp;are&nbsp;the&nbsp;spectral&nbsp;selection&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1752574">//&nbsp;ah&nbsp;and&nbsp;al&nbsp;are&nbsp;the&nbsp;successive&nbsp;approximation&nbsp;high&nbsp;and&nbsp;low&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1752642">//&nbsp;The&nbsp;spec&nbsp;calls&nbsp;these&nbsp;values&nbsp;Ss,&nbsp;Se,&nbsp;Ah&nbsp;and&nbsp;Al.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1752693">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1752697">//&nbsp;For&nbsp;progressive&nbsp;JPEGs,&nbsp;these&nbsp;are&nbsp;the&nbsp;two&nbsp;more-or-less&nbsp;independent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1752767">//&nbsp;aspects&nbsp;of&nbsp;progression.&nbsp;Spectral&nbsp;selection&nbsp;progression&nbsp;is&nbsp;when&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1752838">//&nbsp;all&nbsp;of&nbsp;a&nbsp;block&#39;s&nbsp;64&nbsp;DCT&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1752908">//&nbsp;For&nbsp;example,&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;coefficient&nbsp;0&nbsp;(the&nbsp;DC</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1752975">//&nbsp;component),&nbsp;coefficients&nbsp;1-5,&nbsp;and&nbsp;coefficients&nbsp;6-63,&nbsp;in&nbsp;zig-zag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1753043">//&nbsp;order.&nbsp;Successive&nbsp;approximation&nbsp;is&nbsp;when&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1753112">//&nbsp;band&nbsp;of&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1753179">//&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;the&nbsp;6&nbsp;most&nbsp;significant&nbsp;bits,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1753249">//&nbsp;by&nbsp;the&nbsp;second-least&nbsp;significant&nbsp;bit,&nbsp;followed&nbsp;by&nbsp;the&nbsp;least</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1753312">//&nbsp;significant&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1753333">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1753337">//&nbsp;For&nbsp;baseline&nbsp;JPEGs,&nbsp;these&nbsp;parameters&nbsp;are&nbsp;hard-coded&nbsp;to&nbsp;0/63/0/0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1753406">zigStart</span><span class="op" id="1753414">,</span>&nbsp;<span class="ident" id="1753416">zigEnd</span><span class="op" id="1753422">,</span>&nbsp;<span class="ident" id="1753424">ah</span><span class="op" id="1753426">,</span>&nbsp;<span class="ident" id="1753428">al</span>&nbsp;<span class="op" id="1753431">:=</span>&nbsp;<span class="builtintype" id="1753434">int32</span><span class="op" id="1753439">(</span><span class="num" id="1753440">0</span><span class="op" id="1753441">)</span><span class="op" id="1753442">,</span>&nbsp;<span class="builtintype" id="1753444">int32</span><span class="op" id="1753449">(</span><span class="ident" id="1753450">blockSize</span><span class="op" id="1753459">-</span><span class="num" id="1753460">1</span><span class="op" id="1753461">)</span><span class="op" id="1753462">,</span>&nbsp;<span class="builtintype" id="1753464">uint32</span><span class="op" id="1753470">(</span><span class="num" id="1753471">0</span><span class="op" id="1753472">)</span><span class="op" id="1753473">,</span>&nbsp;<span class="builtintype" id="1753475">uint32</span><span class="op" id="1753481">(</span><span class="num" id="1753482">0</span><span class="op" id="1753483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753486">if</span>&nbsp;<span class="ident" id="1753489">d</span><span class="op" id="1753490">.</span><span class="ident" id="1753491">progressive</span>&nbsp;<span class="op" id="1753503">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1753507">zigStart</span>&nbsp;<span class="op" id="1753516">=</span>&nbsp;<span class="builtintype" id="1753518">int32</span><span class="op" id="1753523">(</span><span class="ident" id="1753524">d</span><span class="op" id="1753525">.</span><span class="ident" id="1753526">tmp</span><span class="op" id="1753529">[</span><span class="num" id="1753530">1</span><span class="op" id="1753531">+</span><span class="num" id="1753532">2</span><span class="op" id="1753533">*</span><span class="ident" id="1753534">nComp</span><span class="op" id="1753539">]</span><span class="op" id="1753540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1753544">zigEnd</span>&nbsp;<span class="op" id="1753551">=</span>&nbsp;<span class="builtintype" id="1753553">int32</span><span class="op" id="1753558">(</span><span class="ident" id="1753559">d</span><span class="op" id="1753560">.</span><span class="ident" id="1753561">tmp</span><span class="op" id="1753564">[</span><span class="num" id="1753565">2</span><span class="op" id="1753566">+</span><span class="num" id="1753567">2</span><span class="op" id="1753568">*</span><span class="ident" id="1753569">nComp</span><span class="op" id="1753574">]</span><span class="op" id="1753575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1753579">ah</span>&nbsp;<span class="op" id="1753582">=</span>&nbsp;<span class="builtintype" id="1753584">uint32</span><span class="op" id="1753590">(</span><span class="ident" id="1753591">d</span><span class="op" id="1753592">.</span><span class="ident" id="1753593">tmp</span><span class="op" id="1753596">[</span><span class="num" id="1753597">3</span><span class="op" id="1753598">+</span><span class="num" id="1753599">2</span><span class="op" id="1753600">*</span><span class="ident" id="1753601">nComp</span><span class="op" id="1753606">]</span>&nbsp;<span class="op" id="1753608">&gt;&gt;</span>&nbsp;<span class="num" id="1753611">4</span><span class="op" id="1753612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1753616">al</span>&nbsp;<span class="op" id="1753619">=</span>&nbsp;<span class="builtintype" id="1753621">uint32</span><span class="op" id="1753627">(</span><span class="ident" id="1753628">d</span><span class="op" id="1753629">.</span><span class="ident" id="1753630">tmp</span><span class="op" id="1753633">[</span><span class="num" id="1753634">3</span><span class="op" id="1753635">+</span><span class="num" id="1753636">2</span><span class="op" id="1753637">*</span><span class="ident" id="1753638">nComp</span><span class="op" id="1753643">]</span>&nbsp;<span class="op" id="1753645">&amp;</span>&nbsp;<span class="num" id="1753647">0x0f</span><span class="op" id="1753651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753655">if</span>&nbsp;<span class="op" id="1753658">(</span><span class="ident" id="1753659">zigStart</span>&nbsp;<span class="op" id="1753668">==</span>&nbsp;<span class="num" id="1753671">0</span>&nbsp;<span class="op" id="1753673">&amp;&amp;</span>&nbsp;<span class="ident" id="1753676">zigEnd</span>&nbsp;<span class="op" id="1753683">!=</span>&nbsp;<span class="num" id="1753686">0</span><span class="op" id="1753687">)</span>&nbsp;<span class="op" id="1753689">||</span>&nbsp;<span class="ident" id="1753692">zigStart</span>&nbsp;<span class="op" id="1753701">&gt;</span>&nbsp;<span class="ident" id="1753703">zigEnd</span>&nbsp;<span class="op" id="1753710">||</span>&nbsp;<span class="ident" id="1753713">blockSize</span>&nbsp;<span class="op" id="1753723">&lt;=</span>&nbsp;<span class="ident" id="1753726">zigEnd</span>&nbsp;<span class="op" id="1753733">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753738">return</span>&nbsp;<span class="ident" id="1753745">FormatError</span><span class="op" id="1753756">(</span><span class="string" id="1753757">&#34;bad&nbsp;spectral&nbsp;selection&nbsp;bounds&#34;</span><span class="op" id="1753788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1753792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753796">if</span>&nbsp;<span class="ident" id="1753799">zigStart</span>&nbsp;<span class="op" id="1753808">!=</span>&nbsp;<span class="num" id="1753811">0</span>&nbsp;<span class="op" id="1753813">&amp;&amp;</span>&nbsp;<span class="ident" id="1753816">nComp</span>&nbsp;<span class="op" id="1753822">!=</span>&nbsp;<span class="num" id="1753825">1</span>&nbsp;<span class="op" id="1753827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753832">return</span>&nbsp;<span class="ident" id="1753839">FormatError</span><span class="op" id="1753850">(</span><span class="string" id="1753851">&#34;progressive&nbsp;AC&nbsp;coefficients&nbsp;for&nbsp;more&nbsp;than&nbsp;one&nbsp;component&#34;</span><span class="op" id="1753908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1753912">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753916">if</span>&nbsp;<span class="ident" id="1753919">ah</span>&nbsp;<span class="op" id="1753922">!=</span>&nbsp;<span class="num" id="1753925">0</span>&nbsp;<span class="op" id="1753927">&amp;&amp;</span>&nbsp;<span class="ident" id="1753930">ah</span>&nbsp;<span class="op" id="1753933">!=</span>&nbsp;<span class="ident" id="1753936">al</span><span class="op" id="1753938">+</span><span class="num" id="1753939">1</span>&nbsp;<span class="op" id="1753941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1753946">return</span>&nbsp;<span class="ident" id="1753953">FormatError</span><span class="op" id="1753964">(</span><span class="string" id="1753965">&#34;bad&nbsp;successive&nbsp;approximation&nbsp;values&#34;</span><span class="op" id="1754002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1754013">//&nbsp;mxx&nbsp;and&nbsp;myy&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;MCUs&nbsp;(Minimum&nbsp;Coded&nbsp;Units)&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754088">h0</span><span class="op" id="1754090">,</span>&nbsp;<span class="ident" id="1754092">v0</span>&nbsp;<span class="op" id="1754095">:=</span>&nbsp;<span class="ident" id="1754098">d</span><span class="op" id="1754099">.</span><span class="ident" id="1754100">comp</span><span class="op" id="1754104">[</span><span class="num" id="1754105">0</span><span class="op" id="1754106">]</span><span class="op" id="1754107">.</span><span class="ident" id="1754108">h</span><span class="op" id="1754109">,</span>&nbsp;<span class="ident" id="1754111">d</span><span class="op" id="1754112">.</span><span class="ident" id="1754113">comp</span><span class="op" id="1754117">[</span><span class="num" id="1754118">0</span><span class="op" id="1754119">]</span><span class="op" id="1754120">.</span><span class="ident" id="1754121">v</span>&nbsp;<span class="comment" id="1754123">//&nbsp;The&nbsp;h&nbsp;and&nbsp;v&nbsp;values&nbsp;from&nbsp;the&nbsp;Y&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754169">mxx</span>&nbsp;<span class="op" id="1754173">:=</span>&nbsp;<span class="op" id="1754176">(</span><span class="ident" id="1754177">d</span><span class="op" id="1754178">.</span><span class="ident" id="1754179">width</span>&nbsp;<span class="op" id="1754185">+</span>&nbsp;<span class="num" id="1754187">8</span><span class="op" id="1754188">*</span><span class="ident" id="1754189">h0</span>&nbsp;<span class="op" id="1754192">-</span>&nbsp;<span class="num" id="1754194">1</span><span class="op" id="1754195">)</span>&nbsp;<span class="op" id="1754197">/</span>&nbsp;<span class="op" id="1754199">(</span><span class="num" id="1754200">8</span>&nbsp;<span class="op" id="1754202">*</span>&nbsp;<span class="ident" id="1754204">h0</span><span class="op" id="1754206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754209">myy</span>&nbsp;<span class="op" id="1754213">:=</span>&nbsp;<span class="op" id="1754216">(</span><span class="ident" id="1754217">d</span><span class="op" id="1754218">.</span><span class="ident" id="1754219">height</span>&nbsp;<span class="op" id="1754226">+</span>&nbsp;<span class="num" id="1754228">8</span><span class="op" id="1754229">*</span><span class="ident" id="1754230">v0</span>&nbsp;<span class="op" id="1754233">-</span>&nbsp;<span class="num" id="1754235">1</span><span class="op" id="1754236">)</span>&nbsp;<span class="op" id="1754238">/</span>&nbsp;<span class="op" id="1754240">(</span><span class="num" id="1754241">8</span>&nbsp;<span class="op" id="1754243">*</span>&nbsp;<span class="ident" id="1754245">v0</span><span class="op" id="1754247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754250">if</span>&nbsp;<span class="ident" id="1754253">d</span><span class="op" id="1754254">.</span><span class="ident" id="1754255">img1</span>&nbsp;<span class="op" id="1754260">==</span>&nbsp;<span class="builtintype" id="1754263">nil</span>&nbsp;<span class="op" id="1754267">&amp;&amp;</span>&nbsp;<span class="ident" id="1754270">d</span><span class="op" id="1754271">.</span><span class="ident" id="1754272">img3</span>&nbsp;<span class="op" id="1754277">==</span>&nbsp;<span class="builtintype" id="1754280">nil</span>&nbsp;<span class="op" id="1754284">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754288">d</span><span class="op" id="1754289">.</span><span class="ident" id="1754290">makeImg</span><span class="op" id="1754297">(</span><span class="ident" id="1754298">h0</span><span class="op" id="1754300">,</span>&nbsp;<span class="ident" id="1754302">v0</span><span class="op" id="1754304">,</span>&nbsp;<span class="ident" id="1754306">mxx</span><span class="op" id="1754309">,</span>&nbsp;<span class="ident" id="1754311">myy</span><span class="op" id="1754314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754320">if</span>&nbsp;<span class="ident" id="1754323">d</span><span class="op" id="1754324">.</span><span class="ident" id="1754325">progressive</span>&nbsp;<span class="op" id="1754337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754341">for</span>&nbsp;<span class="ident" id="1754345">i</span>&nbsp;<span class="op" id="1754347">:=</span>&nbsp;<span class="num" id="1754350">0</span><span class="op" id="1754351">;</span>&nbsp;<span class="ident" id="1754353">i</span>&nbsp;<span class="op" id="1754355">&lt;</span>&nbsp;<span class="ident" id="1754357">nComp</span><span class="op" id="1754362">;</span>&nbsp;<span class="ident" id="1754364">i</span><span class="op" id="1754365">++</span>&nbsp;<span class="op" id="1754368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754373">compIndex</span>&nbsp;<span class="op" id="1754383">:=</span>&nbsp;<span class="ident" id="1754386">scan</span><span class="op" id="1754390">[</span><span class="ident" id="1754391">i</span><span class="op" id="1754392">]</span><span class="op" id="1754393">.</span><span class="ident" id="1754394">compIndex</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754407">if</span>&nbsp;<span class="ident" id="1754410">d</span><span class="op" id="1754411">.</span><span class="ident" id="1754412">progCoeffs</span><span class="op" id="1754422">[</span><span class="ident" id="1754423">compIndex</span><span class="op" id="1754432">]</span>&nbsp;<span class="op" id="1754434">==</span>&nbsp;<span class="builtintype" id="1754437">nil</span>&nbsp;<span class="op" id="1754441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754447">d</span><span class="op" id="1754448">.</span><span class="ident" id="1754449">progCoeffs</span><span class="op" id="1754459">[</span><span class="ident" id="1754460">compIndex</span><span class="op" id="1754469">]</span>&nbsp;<span class="op" id="1754471">=</span>&nbsp;<span class="builtinfunc" id="1754473">make</span><span class="op" id="1754477">(</span><span class="op" id="1754478">[</span><span class="op" id="1754479">]</span><span class="ident" id="1754480">block</span><span class="op" id="1754485">,</span>&nbsp;<span class="ident" id="1754487">mxx</span><span class="op" id="1754490">*</span><span class="ident" id="1754491">myy</span><span class="op" id="1754494">*</span><span class="ident" id="1754495">d</span><span class="op" id="1754496">.</span><span class="ident" id="1754497">comp</span><span class="op" id="1754501">[</span><span class="ident" id="1754502">compIndex</span><span class="op" id="1754511">]</span><span class="op" id="1754512">.</span><span class="ident" id="1754513">h</span><span class="op" id="1754514">*</span><span class="ident" id="1754515">d</span><span class="op" id="1754516">.</span><span class="ident" id="1754517">comp</span><span class="op" id="1754521">[</span><span class="ident" id="1754522">compIndex</span><span class="op" id="1754531">]</span><span class="op" id="1754532">.</span><span class="ident" id="1754533">v</span><span class="op" id="1754534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1754546">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754550">d</span><span class="op" id="1754551">.</span><span class="ident" id="1754552">bits</span>&nbsp;<span class="op" id="1754557">=</span>&nbsp;<span class="ident" id="1754559">bits</span><span class="op" id="1754563">{</span><span class="op" id="1754564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754567">mcu</span><span class="op" id="1754570">,</span>&nbsp;<span class="ident" id="1754572">expectedRST</span>&nbsp;<span class="op" id="1754584">:=</span>&nbsp;<span class="num" id="1754587">0</span><span class="op" id="1754588">,</span>&nbsp;<span class="builtintype" id="1754590">uint8</span><span class="op" id="1754595">(</span><span class="ident" id="1754596">rst0Marker</span><span class="op" id="1754606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1754609">var</span>&nbsp;<span class="op" id="1754613">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1754617">//&nbsp;b&nbsp;is&nbsp;the&nbsp;decoded&nbsp;coefficients,&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754685">b</span>&nbsp;&nbsp;<span class="ident" id="1754688">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1754696">dc</span>&nbsp;<span class="op" id="1754699">[</span><span class="ident" id="1754700">nColorComponent</span><span class="op" id="1754715">]</span><span class="builtintype" id="1754716">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1754724">//&nbsp;bx&nbsp;and&nbsp;by&nbsp;are&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;current&nbsp;(in&nbsp;terms&nbsp;of&nbsp;8x8&nbsp;blocks).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1754797">//&nbsp;For&nbsp;example,&nbsp;with&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling,&nbsp;the&nbsp;block&nbsp;whose&nbsp;top&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1754871">//&nbsp;pixel&nbsp;co-ordinates&nbsp;are&nbsp;(16,&nbsp;8)&nbsp;is&nbsp;the&nbsp;third&nbsp;block&nbsp;in&nbsp;the&nbsp;first&nbsp;row:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1754944">//&nbsp;bx&nbsp;is&nbsp;2&nbsp;and&nbsp;by&nbsp;is&nbsp;0,&nbsp;even&nbsp;though&nbsp;the&nbsp;pixel&nbsp;is&nbsp;in&nbsp;the&nbsp;second&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1755014">bx</span><span class="op" id="1755016">,</span>&nbsp;<span class="ident" id="1755018">by</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1755025">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1755031">blockCount</span>&nbsp;<span class="builtintype" id="1755042">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1755047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755050">for</span>&nbsp;<span class="ident" id="1755054">my</span>&nbsp;<span class="op" id="1755057">:=</span>&nbsp;<span class="num" id="1755060">0</span><span class="op" id="1755061">;</span>&nbsp;<span class="ident" id="1755063">my</span>&nbsp;<span class="op" id="1755066">&lt;</span>&nbsp;<span class="ident" id="1755068">myy</span><span class="op" id="1755071">;</span>&nbsp;<span class="ident" id="1755073">my</span><span class="op" id="1755075">++</span>&nbsp;<span class="op" id="1755078">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755082">for</span>&nbsp;<span class="ident" id="1755086">mx</span>&nbsp;<span class="op" id="1755089">:=</span>&nbsp;<span class="num" id="1755092">0</span><span class="op" id="1755093">;</span>&nbsp;<span class="ident" id="1755095">mx</span>&nbsp;<span class="op" id="1755098">&lt;</span>&nbsp;<span class="ident" id="1755100">mxx</span><span class="op" id="1755103">;</span>&nbsp;<span class="ident" id="1755105">mx</span><span class="op" id="1755107">++</span>&nbsp;<span class="op" id="1755110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755115">for</span>&nbsp;<span class="ident" id="1755119">i</span>&nbsp;<span class="op" id="1755121">:=</span>&nbsp;<span class="num" id="1755124">0</span><span class="op" id="1755125">;</span>&nbsp;<span class="ident" id="1755127">i</span>&nbsp;<span class="op" id="1755129">&lt;</span>&nbsp;<span class="ident" id="1755131">nComp</span><span class="op" id="1755136">;</span>&nbsp;<span class="ident" id="1755138">i</span><span class="op" id="1755139">++</span>&nbsp;<span class="op" id="1755142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1755148">compIndex</span>&nbsp;<span class="op" id="1755158">:=</span>&nbsp;<span class="ident" id="1755161">scan</span><span class="op" id="1755165">[</span><span class="ident" id="1755166">i</span><span class="op" id="1755167">]</span><span class="op" id="1755168">.</span><span class="ident" id="1755169">compIndex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1755183">qt</span>&nbsp;<span class="op" id="1755186">:=</span>&nbsp;<span class="op" id="1755189">&amp;</span><span class="ident" id="1755190">d</span><span class="op" id="1755191">.</span><span class="ident" id="1755192">quant</span><span class="op" id="1755197">[</span><span class="ident" id="1755198">d</span><span class="op" id="1755199">.</span><span class="ident" id="1755200">comp</span><span class="op" id="1755204">[</span><span class="ident" id="1755205">compIndex</span><span class="op" id="1755214">]</span><span class="op" id="1755215">.</span><span class="ident" id="1755216">tq</span><span class="op" id="1755218">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1755224">for</span>&nbsp;<span class="ident" id="1755228">j</span>&nbsp;<span class="op" id="1755230">:=</span>&nbsp;<span class="num" id="1755233">0</span><span class="op" id="1755234">;</span>&nbsp;<span class="ident" id="1755236">j</span>&nbsp;<span class="op" id="1755238">&lt;</span>&nbsp;<span class="ident" id="1755240">d</span><span class="op" id="1755241">.</span><span class="ident" id="1755242">comp</span><span class="op" id="1755246">[</span><span class="ident" id="1755247">compIndex</span><span class="op" id="1755256">]</span><span class="op" id="1755257">.</span><span class="ident" id="1755258">h</span><span class="op" id="1755259">*</span><span class="ident" id="1755260">d</span><span class="op" id="1755261">.</span><span class="ident" id="1755262">comp</span><span class="op" id="1755266">[</span><span class="ident" id="1755267">compIndex</span><span class="op" id="1755276">]</span><span class="op" id="1755277">.</span><span class="ident" id="1755278">v</span><span class="op" id="1755279">;</span>&nbsp;<span class="ident" id="1755281">j</span><span class="op" id="1755282">++</span>&nbsp;<span class="op" id="1755285">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755292">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;traversed&nbsp;one&nbsp;MCU&nbsp;at&nbsp;a&nbsp;time.&nbsp;For&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755361">//&nbsp;subsampling,&nbsp;there&nbsp;are&nbsp;four&nbsp;Y&nbsp;8x8&nbsp;blocks&nbsp;in&nbsp;every&nbsp;16x16&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755430">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755438">//&nbsp;For&nbsp;a&nbsp;baseline&nbsp;32x16&nbsp;pixel&nbsp;image,&nbsp;the&nbsp;Y&nbsp;blocks&nbsp;visiting&nbsp;order&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755512">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755528">//&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755544">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755552">//&nbsp;For&nbsp;progressive&nbsp;images,&nbsp;the&nbsp;interleaved&nbsp;scans&nbsp;(those&nbsp;with&nbsp;nComp&nbsp;&gt;&nbsp;1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755629">//&nbsp;are&nbsp;traversed&nbsp;as&nbsp;above,&nbsp;but&nbsp;non-interleaved&nbsp;scans&nbsp;are&nbsp;traversed&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755706">//&nbsp;to&nbsp;right,&nbsp;top&nbsp;to&nbsp;bottom:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755739">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;2&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755755">//&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;5&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755771">//&nbsp;Only&nbsp;DC&nbsp;scans&nbsp;(zigStart&nbsp;==&nbsp;0)&nbsp;can&nbsp;be&nbsp;interleaved.&nbsp;AC&nbsp;scans&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755848">//&nbsp;only&nbsp;one&nbsp;component.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755876">//</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755884">//&nbsp;To&nbsp;further&nbsp;complicate&nbsp;matters,&nbsp;for&nbsp;non-interleaved&nbsp;scans,&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1755962">//&nbsp;data&nbsp;for&nbsp;any&nbsp;blocks&nbsp;that&nbsp;are&nbsp;inside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;MCU&nbsp;level&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1756037">//&nbsp;outside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;pixel&nbsp;level.&nbsp;For&nbsp;example,&nbsp;a&nbsp;24x16&nbsp;pixel&nbsp;4:2:0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1756116">//&nbsp;progressive&nbsp;image&nbsp;consists&nbsp;of&nbsp;two&nbsp;16x16&nbsp;MCUs.&nbsp;The&nbsp;interleaved&nbsp;scans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1756192">//&nbsp;will&nbsp;process&nbsp;8&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1756225">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1756241">//&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1756257">//&nbsp;The&nbsp;non-interleaved&nbsp;scans&nbsp;will&nbsp;process&nbsp;only&nbsp;6&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1756321">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1756335">//&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;4&nbsp;5</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1756349">if</span>&nbsp;<span class="ident" id="1756352">nComp</span>&nbsp;<span class="op" id="1756358">!=</span>&nbsp;<span class="num" id="1756361">1</span>&nbsp;<span class="op" id="1756363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1756371">bx</span><span class="op" id="1756373">,</span>&nbsp;<span class="ident" id="1756375">by</span>&nbsp;<span class="op" id="1756378">=</span>&nbsp;<span class="ident" id="1756380">d</span><span class="op" id="1756381">.</span><span class="ident" id="1756382">comp</span><span class="op" id="1756386">[</span><span class="ident" id="1756387">compIndex</span><span class="op" id="1756396">]</span><span class="op" id="1756397">.</span><span class="ident" id="1756398">h</span><span class="op" id="1756399">*</span><span class="ident" id="1756400">mx</span><span class="op" id="1756402">,</span>&nbsp;<span class="ident" id="1756404">d</span><span class="op" id="1756405">.</span><span class="ident" id="1756406">comp</span><span class="op" id="1756410">[</span><span class="ident" id="1756411">compIndex</span><span class="op" id="1756420">]</span><span class="op" id="1756421">.</span><span class="ident" id="1756422">v</span><span class="op" id="1756423">*</span><span class="ident" id="1756424">my</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1756433">if</span>&nbsp;<span class="ident" id="1756436">h0</span>&nbsp;<span class="op" id="1756439">==</span>&nbsp;<span class="num" id="1756442">1</span>&nbsp;<span class="op" id="1756444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1756453">by</span>&nbsp;<span class="op" id="1756456">+=</span>&nbsp;<span class="ident" id="1756459">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1756467">}</span>&nbsp;<span class="keyword" id="1756469">else</span>&nbsp;<span class="op" id="1756474">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1756483">bx</span>&nbsp;<span class="op" id="1756486">+=</span>&nbsp;<span class="ident" id="1756489">j</span>&nbsp;<span class="op" id="1756491">%</span>&nbsp;<span class="num" id="1756493">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1756502">by</span>&nbsp;<span class="op" id="1756505">+=</span>&nbsp;<span class="ident" id="1756508">j</span>&nbsp;<span class="op" id="1756510">/</span>&nbsp;<span class="num" id="1756512">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1756520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1756527">}</span>&nbsp;<span class="keyword" id="1756529">else</span>&nbsp;<span class="op" id="1756534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1756542">q</span>&nbsp;<span class="op" id="1756544">:=</span>&nbsp;<span class="ident" id="1756547">mxx</span>&nbsp;<span class="op" id="1756551">*</span>&nbsp;<span class="ident" id="1756553">d</span><span class="op" id="1756554">.</span><span class="ident" id="1756555">comp</span><span class="op" id="1756559">[</span><span class="ident" id="1756560">compIndex</span><span class="op" id="1756569">]</span><span class="op" id="1756570">.</span><span class="ident" id="1756571">h</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1756579">bx</span>&nbsp;<span class="op" id="1756582">=</span>&nbsp;<span class="ident" id="1756584">blockCount</span>&nbsp;<span class="op" id="1756595">%</span>&nbsp;<span class="ident" id="1756597">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1756605">by</span>&nbsp;<span class="op" id="1756608">=</span>&nbsp;<span class="ident" id="1756610">blockCount</span>&nbsp;<span class="op" id="1756621">/</span>&nbsp;<span class="ident" id="1756623">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1756631">blockCount</span><span class="op" id="1756641">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1756650">if</span>&nbsp;<span class="ident" id="1756653">bx</span><span class="op" id="1756655">*</span><span class="num" id="1756656">8</span>&nbsp;<span class="op" id="1756658">&gt;=</span>&nbsp;<span class="ident" id="1756661">d</span><span class="op" id="1756662">.</span><span class="ident" id="1756663">width</span>&nbsp;<span class="op" id="1756669">||</span>&nbsp;<span class="ident" id="1756672">by</span><span class="op" id="1756674">*</span><span class="num" id="1756675">8</span>&nbsp;<span class="op" id="1756677">&gt;=</span>&nbsp;<span class="ident" id="1756680">d</span><span class="op" id="1756681">.</span><span class="ident" id="1756682">height</span>&nbsp;<span class="op" id="1756689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1756698">continue</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1756713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1756720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1756728">//&nbsp;Load&nbsp;the&nbsp;previous&nbsp;partially&nbsp;decoded&nbsp;coefficients,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1756801">if</span>&nbsp;<span class="ident" id="1756804">d</span><span class="op" id="1756805">.</span><span class="ident" id="1756806">progressive</span>&nbsp;<span class="op" id="1756818">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1756826">b</span>&nbsp;<span class="op" id="1756828">=</span>&nbsp;<span class="ident" id="1756830">d</span><span class="op" id="1756831">.</span><span class="ident" id="1756832">progCoeffs</span><span class="op" id="1756842">[</span><span class="ident" id="1756843">compIndex</span><span class="op" id="1756852">]</span><span class="op" id="1756853">[</span><span class="ident" id="1756854">by</span><span class="op" id="1756856">*</span><span class="ident" id="1756857">mxx</span><span class="op" id="1756860">*</span><span class="ident" id="1756861">d</span><span class="op" id="1756862">.</span><span class="ident" id="1756863">comp</span><span class="op" id="1756867">[</span><span class="ident" id="1756868">compIndex</span><span class="op" id="1756877">]</span><span class="op" id="1756878">.</span><span class="ident" id="1756879">h</span><span class="op" id="1756880">+</span><span class="ident" id="1756881">bx</span><span class="op" id="1756883">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1756890">}</span>&nbsp;<span class="keyword" id="1756892">else</span>&nbsp;<span class="op" id="1756897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1756905">b</span>&nbsp;<span class="op" id="1756907">=</span>&nbsp;<span class="ident" id="1756909">block</span><span class="op" id="1756914">{</span><span class="op" id="1756915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1756922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1756930">if</span>&nbsp;<span class="ident" id="1756933">ah</span>&nbsp;<span class="op" id="1756936">!=</span>&nbsp;<span class="num" id="1756939">0</span>&nbsp;<span class="op" id="1756941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1756949">if</span>&nbsp;<span class="ident" id="1756952">err</span>&nbsp;<span class="op" id="1756956">:=</span>&nbsp;<span class="ident" id="1756959">d</span><span class="op" id="1756960">.</span><span class="ident" id="1756961">refine</span><span class="op" id="1756967">(</span><span class="op" id="1756968">&amp;</span><span class="ident" id="1756969">b</span><span class="op" id="1756970">,</span>&nbsp;<span class="op" id="1756972">&amp;</span><span class="ident" id="1756973">d</span><span class="op" id="1756974">.</span><span class="ident" id="1756975">huff</span><span class="op" id="1756979">[</span><span class="ident" id="1756980">acTable</span><span class="op" id="1756987">]</span><span class="op" id="1756988">[</span><span class="ident" id="1756989">scan</span><span class="op" id="1756993">[</span><span class="ident" id="1756994">i</span><span class="op" id="1756995">]</span><span class="op" id="1756996">.</span><span class="ident" id="1756997">ta</span><span class="op" id="1756999">]</span><span class="op" id="1757000">,</span>&nbsp;<span class="ident" id="1757002">zigStart</span><span class="op" id="1757010">,</span>&nbsp;<span class="ident" id="1757012">zigEnd</span><span class="op" id="1757018">,</span>&nbsp;<span class="num" id="1757020">1</span><span class="op" id="1757021">&lt;&lt;</span><span class="ident" id="1757023">al</span><span class="op" id="1757025">)</span><span class="op" id="1757026">;</span>&nbsp;<span class="ident" id="1757028">err</span>&nbsp;<span class="op" id="1757032">!=</span>&nbsp;<span class="builtintype" id="1757035">nil</span>&nbsp;<span class="op" id="1757039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757048">return</span>&nbsp;<span class="ident" id="1757055">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1757065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1757072">}</span>&nbsp;<span class="keyword" id="1757074">else</span>&nbsp;<span class="op" id="1757079">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757087">zig</span>&nbsp;<span class="op" id="1757091">:=</span>&nbsp;<span class="ident" id="1757094">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757109">if</span>&nbsp;<span class="ident" id="1757112">zig</span>&nbsp;<span class="op" id="1757116">==</span>&nbsp;<span class="num" id="1757119">0</span>&nbsp;<span class="op" id="1757121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757130">zig</span><span class="op" id="1757133">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1757143">//&nbsp;Decode&nbsp;the&nbsp;DC&nbsp;coefficient,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757213">value</span><span class="op" id="1757218">,</span>&nbsp;<span class="ident" id="1757220">err</span>&nbsp;<span class="op" id="1757224">:=</span>&nbsp;<span class="ident" id="1757227">d</span><span class="op" id="1757228">.</span><span class="ident" id="1757229">decodeHuffman</span><span class="op" id="1757242">(</span><span class="op" id="1757243">&amp;</span><span class="ident" id="1757244">d</span><span class="op" id="1757245">.</span><span class="ident" id="1757246">huff</span><span class="op" id="1757250">[</span><span class="ident" id="1757251">dcTable</span><span class="op" id="1757258">]</span><span class="op" id="1757259">[</span><span class="ident" id="1757260">scan</span><span class="op" id="1757264">[</span><span class="ident" id="1757265">i</span><span class="op" id="1757266">]</span><span class="op" id="1757267">.</span><span class="ident" id="1757268">td</span><span class="op" id="1757270">]</span><span class="op" id="1757271">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757280">if</span>&nbsp;<span class="ident" id="1757283">err</span>&nbsp;<span class="op" id="1757287">!=</span>&nbsp;<span class="builtintype" id="1757290">nil</span>&nbsp;<span class="op" id="1757294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757304">return</span>&nbsp;<span class="ident" id="1757311">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1757322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757331">if</span>&nbsp;<span class="ident" id="1757334">value</span>&nbsp;<span class="op" id="1757340">&gt;</span>&nbsp;<span class="num" id="1757342">16</span>&nbsp;<span class="op" id="1757345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757355">return</span>&nbsp;<span class="ident" id="1757362">UnsupportedError</span><span class="op" id="1757378">(</span><span class="string" id="1757379">&#34;excessive&nbsp;DC&nbsp;component&#34;</span><span class="op" id="1757403">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1757412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757421">dcDelta</span><span class="op" id="1757428">,</span>&nbsp;<span class="ident" id="1757430">err</span>&nbsp;<span class="op" id="1757434">:=</span>&nbsp;<span class="ident" id="1757437">d</span><span class="op" id="1757438">.</span><span class="ident" id="1757439">receiveExtend</span><span class="op" id="1757452">(</span><span class="ident" id="1757453">value</span><span class="op" id="1757458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757467">if</span>&nbsp;<span class="ident" id="1757470">err</span>&nbsp;<span class="op" id="1757474">!=</span>&nbsp;<span class="builtintype" id="1757477">nil</span>&nbsp;<span class="op" id="1757481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757491">return</span>&nbsp;<span class="ident" id="1757498">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1757509">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757518">dc</span><span class="op" id="1757520">[</span><span class="ident" id="1757521">compIndex</span><span class="op" id="1757530">]</span>&nbsp;<span class="op" id="1757532">+=</span>&nbsp;<span class="ident" id="1757535">dcDelta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757550">b</span><span class="op" id="1757551">[</span><span class="num" id="1757552">0</span><span class="op" id="1757553">]</span>&nbsp;<span class="op" id="1757555">=</span>&nbsp;<span class="ident" id="1757557">dc</span><span class="op" id="1757559">[</span><span class="ident" id="1757560">compIndex</span><span class="op" id="1757569">]</span>&nbsp;<span class="op" id="1757571">&lt;&lt;</span>&nbsp;<span class="ident" id="1757574">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1757583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757592">if</span>&nbsp;<span class="ident" id="1757595">zig</span>&nbsp;<span class="op" id="1757599">&lt;=</span>&nbsp;<span class="ident" id="1757602">zigEnd</span>&nbsp;<span class="op" id="1757609">&amp;&amp;</span>&nbsp;<span class="ident" id="1757612">d</span><span class="op" id="1757613">.</span><span class="ident" id="1757614">eobRun</span>&nbsp;<span class="op" id="1757621">&gt;</span>&nbsp;<span class="num" id="1757623">0</span>&nbsp;<span class="op" id="1757625">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757634">d</span><span class="op" id="1757635">.</span><span class="ident" id="1757636">eobRun</span><span class="op" id="1757642">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1757651">}</span>&nbsp;<span class="keyword" id="1757653">else</span>&nbsp;<span class="op" id="1757658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1757667">//&nbsp;Decode&nbsp;the&nbsp;AC&nbsp;coefficients,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757738">huff</span>&nbsp;<span class="op" id="1757743">:=</span>&nbsp;<span class="op" id="1757746">&amp;</span><span class="ident" id="1757747">d</span><span class="op" id="1757748">.</span><span class="ident" id="1757749">huff</span><span class="op" id="1757753">[</span><span class="ident" id="1757754">acTable</span><span class="op" id="1757761">]</span><span class="op" id="1757762">[</span><span class="ident" id="1757763">scan</span><span class="op" id="1757767">[</span><span class="ident" id="1757768">i</span><span class="op" id="1757769">]</span><span class="op" id="1757770">.</span><span class="ident" id="1757771">ta</span><span class="op" id="1757773">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757782">for</span>&nbsp;<span class="op" id="1757786">;</span>&nbsp;<span class="ident" id="1757788">zig</span>&nbsp;<span class="op" id="1757792">&lt;=</span>&nbsp;<span class="ident" id="1757795">zigEnd</span><span class="op" id="1757801">;</span>&nbsp;<span class="ident" id="1757803">zig</span><span class="op" id="1757806">++</span>&nbsp;<span class="op" id="1757809">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757819">value</span><span class="op" id="1757824">,</span>&nbsp;<span class="ident" id="1757826">err</span>&nbsp;<span class="op" id="1757830">:=</span>&nbsp;<span class="ident" id="1757833">d</span><span class="op" id="1757834">.</span><span class="ident" id="1757835">decodeHuffman</span><span class="op" id="1757848">(</span><span class="ident" id="1757849">huff</span><span class="op" id="1757853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757863">if</span>&nbsp;<span class="ident" id="1757866">err</span>&nbsp;<span class="op" id="1757870">!=</span>&nbsp;<span class="builtintype" id="1757873">nil</span>&nbsp;<span class="op" id="1757877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757888">return</span>&nbsp;<span class="ident" id="1757895">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1757907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757917">val0</span>&nbsp;<span class="op" id="1757922">:=</span>&nbsp;<span class="ident" id="1757925">value</span>&nbsp;<span class="op" id="1757931">&gt;&gt;</span>&nbsp;<span class="num" id="1757934">4</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757944">val1</span>&nbsp;<span class="op" id="1757949">:=</span>&nbsp;<span class="ident" id="1757952">value</span>&nbsp;<span class="op" id="1757958">&amp;</span>&nbsp;<span class="num" id="1757960">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1757973">if</span>&nbsp;<span class="ident" id="1757976">val1</span>&nbsp;<span class="op" id="1757981">!=</span>&nbsp;<span class="num" id="1757984">0</span>&nbsp;<span class="op" id="1757986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1757997">zig</span>&nbsp;<span class="op" id="1758001">+=</span>&nbsp;<span class="builtintype" id="1758004">int32</span><span class="op" id="1758009">(</span><span class="ident" id="1758010">val0</span><span class="op" id="1758014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758025">if</span>&nbsp;<span class="ident" id="1758028">zig</span>&nbsp;<span class="op" id="1758032">&gt;</span>&nbsp;<span class="ident" id="1758034">zigEnd</span>&nbsp;<span class="op" id="1758041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758053">break</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1758079">ac</span><span class="op" id="1758081">,</span>&nbsp;<span class="ident" id="1758083">err</span>&nbsp;<span class="op" id="1758087">:=</span>&nbsp;<span class="ident" id="1758090">d</span><span class="op" id="1758091">.</span><span class="ident" id="1758092">receiveExtend</span><span class="op" id="1758105">(</span><span class="ident" id="1758106">val1</span><span class="op" id="1758110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758121">if</span>&nbsp;<span class="ident" id="1758124">err</span>&nbsp;<span class="op" id="1758128">!=</span>&nbsp;<span class="builtintype" id="1758131">nil</span>&nbsp;<span class="op" id="1758135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758147">return</span>&nbsp;<span class="ident" id="1758154">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758167">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1758178">b</span><span class="op" id="1758179">[</span><span class="ident" id="1758180">unzig</span><span class="op" id="1758185">[</span><span class="ident" id="1758186">zig</span><span class="op" id="1758189">]</span><span class="op" id="1758190">]</span>&nbsp;<span class="op" id="1758192">=</span>&nbsp;<span class="ident" id="1758194">ac</span>&nbsp;<span class="op" id="1758197">&lt;&lt;</span>&nbsp;<span class="ident" id="1758200">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758211">}</span>&nbsp;<span class="keyword" id="1758213">else</span>&nbsp;<span class="op" id="1758218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758229">if</span>&nbsp;<span class="ident" id="1758232">val0</span>&nbsp;<span class="op" id="1758237">!=</span>&nbsp;<span class="num" id="1758240">0x0f</span>&nbsp;<span class="op" id="1758245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1758257">d</span><span class="op" id="1758258">.</span><span class="ident" id="1758259">eobRun</span>&nbsp;<span class="op" id="1758266">=</span>&nbsp;<span class="builtintype" id="1758268">uint16</span><span class="op" id="1758274">(</span><span class="num" id="1758275">1</span>&nbsp;<span class="op" id="1758277">&lt;&lt;</span>&nbsp;<span class="ident" id="1758280">val0</span><span class="op" id="1758284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758296">if</span>&nbsp;<span class="ident" id="1758299">val0</span>&nbsp;<span class="op" id="1758304">!=</span>&nbsp;<span class="num" id="1758307">0</span>&nbsp;<span class="op" id="1758309">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1758322">bits</span><span class="op" id="1758326">,</span>&nbsp;<span class="ident" id="1758328">err</span>&nbsp;<span class="op" id="1758332">:=</span>&nbsp;<span class="ident" id="1758335">d</span><span class="op" id="1758336">.</span><span class="ident" id="1758337">decodeBits</span><span class="op" id="1758347">(</span><span class="builtintype" id="1758348">int32</span><span class="op" id="1758353">(</span><span class="ident" id="1758354">val0</span><span class="op" id="1758358">)</span><span class="op" id="1758359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758372">if</span>&nbsp;<span class="ident" id="1758375">err</span>&nbsp;<span class="op" id="1758379">!=</span>&nbsp;<span class="builtintype" id="1758382">nil</span>&nbsp;<span class="op" id="1758386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758400">return</span>&nbsp;<span class="ident" id="1758407">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1758435">d</span><span class="op" id="1758436">.</span><span class="ident" id="1758437">eobRun</span>&nbsp;<span class="op" id="1758444">|=</span>&nbsp;<span class="builtintype" id="1758447">uint16</span><span class="op" id="1758453">(</span><span class="ident" id="1758454">bits</span><span class="op" id="1758458">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1758482">d</span><span class="op" id="1758483">.</span><span class="ident" id="1758484">eobRun</span><span class="op" id="1758490">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758503">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1758529">zig</span>&nbsp;<span class="op" id="1758533">+=</span>&nbsp;<span class="num" id="1758536">0x0f</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1758573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758581">if</span>&nbsp;<span class="ident" id="1758584">d</span><span class="op" id="1758585">.</span><span class="ident" id="1758586">progressive</span>&nbsp;<span class="op" id="1758598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1758606">if</span>&nbsp;<span class="ident" id="1758609">zigEnd</span>&nbsp;<span class="op" id="1758616">!=</span>&nbsp;<span class="ident" id="1758619">blockSize</span><span class="op" id="1758628">-</span><span class="num" id="1758629">1</span>&nbsp;<span class="op" id="1758631">||</span>&nbsp;<span class="ident" id="1758634">al</span>&nbsp;<span class="op" id="1758637">!=</span>&nbsp;<span class="num" id="1758640">0</span>&nbsp;<span class="op" id="1758642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1758651">//&nbsp;We&nbsp;haven&#39;t&nbsp;completely&nbsp;decoded&nbsp;this&nbsp;8x8&nbsp;block.&nbsp;Save&nbsp;the&nbsp;coefficients.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1758730">d</span><span class="op" id="1758731">.</span><span class="ident" id="1758732">progCoeffs</span><span class="op" id="1758742">[</span><span class="ident" id="1758743">compIndex</span><span class="op" id="1758752">]</span><span class="op" id="1758753">[</span><span class="ident" id="1758754">by</span><span class="op" id="1758756">*</span><span class="ident" id="1758757">mxx</span><span class="op" id="1758760">*</span><span class="ident" id="1758761">d</span><span class="op" id="1758762">.</span><span class="ident" id="1758763">comp</span><span class="op" id="1758767">[</span><span class="ident" id="1758768">compIndex</span><span class="op" id="1758777">]</span><span class="op" id="1758778">.</span><span class="ident" id="1758779">h</span><span class="op" id="1758780">+</span><span class="ident" id="1758781">bx</span><span class="op" id="1758783">]</span>&nbsp;<span class="op" id="1758785">=</span>&nbsp;<span class="ident" id="1758787">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1758796">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;we&nbsp;could&nbsp;execute&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;loop&nbsp;body&nbsp;to&nbsp;dequantize&nbsp;and</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1758882">//&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT,&nbsp;to&nbsp;save&nbsp;early&nbsp;stages&nbsp;of&nbsp;a&nbsp;progressive&nbsp;image&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1758968">//&nbsp;*image.YCbCr&nbsp;buffers&nbsp;(the&nbsp;whole&nbsp;point&nbsp;of&nbsp;progressive&nbsp;encoding),&nbsp;but&nbsp;in&nbsp;Go,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1759053">//&nbsp;the&nbsp;jpeg.Decode&nbsp;function&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;entire&nbsp;image&nbsp;is&nbsp;decoded,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1759139">//&nbsp;so&nbsp;we&nbsp;&#34;continue&#34;&nbsp;here&nbsp;to&nbsp;avoid&nbsp;wasted&nbsp;computation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759200">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1759215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1759222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1759230">//&nbsp;Dequantize,&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT&nbsp;and&nbsp;store&nbsp;the&nbsp;block&nbsp;to&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759308">for</span>&nbsp;<span class="ident" id="1759312">zig</span>&nbsp;<span class="op" id="1759316">:=</span>&nbsp;<span class="num" id="1759319">0</span><span class="op" id="1759320">;</span>&nbsp;<span class="ident" id="1759322">zig</span>&nbsp;<span class="op" id="1759326">&lt;</span>&nbsp;<span class="ident" id="1759328">blockSize</span><span class="op" id="1759337">;</span>&nbsp;<span class="ident" id="1759339">zig</span><span class="op" id="1759342">++</span>&nbsp;<span class="op" id="1759345">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1759353">b</span><span class="op" id="1759354">[</span><span class="ident" id="1759355">unzig</span><span class="op" id="1759360">[</span><span class="ident" id="1759361">zig</span><span class="op" id="1759364">]</span><span class="op" id="1759365">]</span>&nbsp;<span class="op" id="1759367">*=</span>&nbsp;<span class="ident" id="1759370">qt</span><span class="op" id="1759372">[</span><span class="ident" id="1759373">zig</span><span class="op" id="1759376">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1759383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1759390">idct</span><span class="op" id="1759394">(</span><span class="op" id="1759395">&amp;</span><span class="ident" id="1759396">b</span><span class="op" id="1759397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1759404">dst</span><span class="op" id="1759407">,</span>&nbsp;<span class="ident" id="1759409">stride</span>&nbsp;<span class="op" id="1759416">:=</span>&nbsp;<span class="op" id="1759419">[</span><span class="op" id="1759420">]</span><span class="builtintype" id="1759421">byte</span><span class="op" id="1759425">(</span><span class="builtintype" id="1759426">nil</span><span class="op" id="1759429">)</span><span class="op" id="1759430">,</span>&nbsp;<span class="num" id="1759432">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759439">if</span>&nbsp;<span class="ident" id="1759442">d</span><span class="op" id="1759443">.</span><span class="ident" id="1759444">nComp</span>&nbsp;<span class="op" id="1759450">==</span>&nbsp;<span class="ident" id="1759453">nGrayComponent</span>&nbsp;<span class="op" id="1759468">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1759476">dst</span><span class="op" id="1759479">,</span>&nbsp;<span class="ident" id="1759481">stride</span>&nbsp;<span class="op" id="1759488">=</span>&nbsp;<span class="ident" id="1759490">d</span><span class="op" id="1759491">.</span><span class="ident" id="1759492">img1</span><span class="op" id="1759496">.</span><span class="ident" id="1759497">Pix</span><span class="op" id="1759500">[</span><span class="num" id="1759501">8</span><span class="op" id="1759502">*</span><span class="op" id="1759503">(</span><span class="ident" id="1759504">by</span><span class="op" id="1759506">*</span><span class="ident" id="1759507">d</span><span class="op" id="1759508">.</span><span class="ident" id="1759509">img1</span><span class="op" id="1759513">.</span><span class="ident" id="1759514">Stride</span><span class="op" id="1759520">+</span><span class="ident" id="1759521">bx</span><span class="op" id="1759523">)</span><span class="op" id="1759524">:</span><span class="op" id="1759525">]</span><span class="op" id="1759526">,</span>&nbsp;<span class="ident" id="1759528">d</span><span class="op" id="1759529">.</span><span class="ident" id="1759530">img1</span><span class="op" id="1759534">.</span><span class="ident" id="1759535">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1759547">}</span>&nbsp;<span class="keyword" id="1759549">else</span>&nbsp;<span class="op" id="1759554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759562">switch</span>&nbsp;<span class="ident" id="1759569">compIndex</span>&nbsp;<span class="op" id="1759579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759587">case</span>&nbsp;<span class="num" id="1759592">0</span><span class="op" id="1759593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1759602">dst</span><span class="op" id="1759605">,</span>&nbsp;<span class="ident" id="1759607">stride</span>&nbsp;<span class="op" id="1759614">=</span>&nbsp;<span class="ident" id="1759616">d</span><span class="op" id="1759617">.</span><span class="ident" id="1759618">img3</span><span class="op" id="1759622">.</span><span class="ident" id="1759623">Y</span><span class="op" id="1759624">[</span><span class="num" id="1759625">8</span><span class="op" id="1759626">*</span><span class="op" id="1759627">(</span><span class="ident" id="1759628">by</span><span class="op" id="1759630">*</span><span class="ident" id="1759631">d</span><span class="op" id="1759632">.</span><span class="ident" id="1759633">img3</span><span class="op" id="1759637">.</span><span class="ident" id="1759638">YStride</span><span class="op" id="1759645">+</span><span class="ident" id="1759646">bx</span><span class="op" id="1759648">)</span><span class="op" id="1759649">:</span><span class="op" id="1759650">]</span><span class="op" id="1759651">,</span>&nbsp;<span class="ident" id="1759653">d</span><span class="op" id="1759654">.</span><span class="ident" id="1759655">img3</span><span class="op" id="1759659">.</span><span class="ident" id="1759660">YStride</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759674">case</span>&nbsp;<span class="num" id="1759679">1</span><span class="op" id="1759680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1759689">dst</span><span class="op" id="1759692">,</span>&nbsp;<span class="ident" id="1759694">stride</span>&nbsp;<span class="op" id="1759701">=</span>&nbsp;<span class="ident" id="1759703">d</span><span class="op" id="1759704">.</span><span class="ident" id="1759705">img3</span><span class="op" id="1759709">.</span><span class="ident" id="1759710">Cb</span><span class="op" id="1759712">[</span><span class="num" id="1759713">8</span><span class="op" id="1759714">*</span><span class="op" id="1759715">(</span><span class="ident" id="1759716">by</span><span class="op" id="1759718">*</span><span class="ident" id="1759719">d</span><span class="op" id="1759720">.</span><span class="ident" id="1759721">img3</span><span class="op" id="1759725">.</span><span class="ident" id="1759726">CStride</span><span class="op" id="1759733">+</span><span class="ident" id="1759734">bx</span><span class="op" id="1759736">)</span><span class="op" id="1759737">:</span><span class="op" id="1759738">]</span><span class="op" id="1759739">,</span>&nbsp;<span class="ident" id="1759741">d</span><span class="op" id="1759742">.</span><span class="ident" id="1759743">img3</span><span class="op" id="1759747">.</span><span class="ident" id="1759748">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759762">case</span>&nbsp;<span class="num" id="1759767">2</span><span class="op" id="1759768">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1759777">dst</span><span class="op" id="1759780">,</span>&nbsp;<span class="ident" id="1759782">stride</span>&nbsp;<span class="op" id="1759789">=</span>&nbsp;<span class="ident" id="1759791">d</span><span class="op" id="1759792">.</span><span class="ident" id="1759793">img3</span><span class="op" id="1759797">.</span><span class="ident" id="1759798">Cr</span><span class="op" id="1759800">[</span><span class="num" id="1759801">8</span><span class="op" id="1759802">*</span><span class="op" id="1759803">(</span><span class="ident" id="1759804">by</span><span class="op" id="1759806">*</span><span class="ident" id="1759807">d</span><span class="op" id="1759808">.</span><span class="ident" id="1759809">img3</span><span class="op" id="1759813">.</span><span class="ident" id="1759814">CStride</span><span class="op" id="1759821">+</span><span class="ident" id="1759822">bx</span><span class="op" id="1759824">)</span><span class="op" id="1759825">:</span><span class="op" id="1759826">]</span><span class="op" id="1759827">,</span>&nbsp;<span class="ident" id="1759829">d</span><span class="op" id="1759830">.</span><span class="ident" id="1759831">img3</span><span class="op" id="1759835">.</span><span class="ident" id="1759836">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759850">default</span><span class="op" id="1759857">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759866">return</span>&nbsp;<span class="ident" id="1759873">UnsupportedError</span><span class="op" id="1759889">(</span><span class="string" id="1759890">&#34;too&nbsp;many&nbsp;components&#34;</span><span class="op" id="1759911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1759919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1759926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1759933">//&nbsp;Level&nbsp;shift&nbsp;by&nbsp;+128,&nbsp;clip&nbsp;to&nbsp;[0,&nbsp;255],&nbsp;and&nbsp;write&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1759998">for</span>&nbsp;<span class="ident" id="1760002">y</span>&nbsp;<span class="op" id="1760004">:=</span>&nbsp;<span class="num" id="1760007">0</span><span class="op" id="1760008">;</span>&nbsp;<span class="ident" id="1760010">y</span>&nbsp;<span class="op" id="1760012">&lt;</span>&nbsp;<span class="num" id="1760014">8</span><span class="op" id="1760015">;</span>&nbsp;<span class="ident" id="1760017">y</span><span class="op" id="1760018">++</span>&nbsp;<span class="op" id="1760021">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760029">y8</span>&nbsp;<span class="op" id="1760032">:=</span>&nbsp;<span class="ident" id="1760035">y</span>&nbsp;<span class="op" id="1760037">*</span>&nbsp;<span class="num" id="1760039">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760047">yStride</span>&nbsp;<span class="op" id="1760055">:=</span>&nbsp;<span class="ident" id="1760058">y</span>&nbsp;<span class="op" id="1760060">*</span>&nbsp;<span class="ident" id="1760062">stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760075">for</span>&nbsp;<span class="ident" id="1760079">x</span>&nbsp;<span class="op" id="1760081">:=</span>&nbsp;<span class="num" id="1760084">0</span><span class="op" id="1760085">;</span>&nbsp;<span class="ident" id="1760087">x</span>&nbsp;<span class="op" id="1760089">&lt;</span>&nbsp;<span class="num" id="1760091">8</span><span class="op" id="1760092">;</span>&nbsp;<span class="ident" id="1760094">x</span><span class="op" id="1760095">++</span>&nbsp;<span class="op" id="1760098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760107">c</span>&nbsp;<span class="op" id="1760109">:=</span>&nbsp;<span class="ident" id="1760112">b</span><span class="op" id="1760113">[</span><span class="ident" id="1760114">y8</span><span class="op" id="1760116">+</span><span class="ident" id="1760117">x</span><span class="op" id="1760118">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760127">if</span>&nbsp;<span class="ident" id="1760130">c</span>&nbsp;<span class="op" id="1760132">&lt;</span>&nbsp;<span class="op" id="1760134">-</span><span class="num" id="1760135">128</span>&nbsp;<span class="op" id="1760139">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760149">c</span>&nbsp;<span class="op" id="1760151">=</span>&nbsp;<span class="num" id="1760153">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1760162">}</span>&nbsp;<span class="keyword" id="1760164">else</span>&nbsp;<span class="keyword" id="1760169">if</span>&nbsp;<span class="ident" id="1760172">c</span>&nbsp;<span class="op" id="1760174">&gt;</span>&nbsp;<span class="num" id="1760176">127</span>&nbsp;<span class="op" id="1760180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760190">c</span>&nbsp;<span class="op" id="1760192">=</span>&nbsp;<span class="num" id="1760194">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1760205">}</span>&nbsp;<span class="keyword" id="1760207">else</span>&nbsp;<span class="op" id="1760212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760222">c</span>&nbsp;<span class="op" id="1760224">+=</span>&nbsp;<span class="num" id="1760227">128</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1760238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760247">dst</span><span class="op" id="1760250">[</span><span class="ident" id="1760251">yStride</span><span class="op" id="1760258">+</span><span class="ident" id="1760259">x</span><span class="op" id="1760260">]</span>&nbsp;<span class="op" id="1760262">=</span>&nbsp;<span class="builtintype" id="1760264">uint8</span><span class="op" id="1760269">(</span><span class="ident" id="1760270">c</span><span class="op" id="1760271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1760279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1760286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1760292">}</span>&nbsp;<span class="comment" id="1760294">//&nbsp;for&nbsp;j</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1760306">}</span>&nbsp;<span class="comment" id="1760308">//&nbsp;for&nbsp;i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760320">mcu</span><span class="op" id="1760323">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760329">if</span>&nbsp;<span class="ident" id="1760332">d</span><span class="op" id="1760333">.</span><span class="ident" id="1760334">ri</span>&nbsp;<span class="op" id="1760337">&gt;</span>&nbsp;<span class="num" id="1760339">0</span>&nbsp;<span class="op" id="1760341">&amp;&amp;</span>&nbsp;<span class="ident" id="1760344">mcu</span><span class="op" id="1760347">%</span><span class="ident" id="1760348">d</span><span class="op" id="1760349">.</span><span class="ident" id="1760350">ri</span>&nbsp;<span class="op" id="1760353">==</span>&nbsp;<span class="num" id="1760356">0</span>&nbsp;<span class="op" id="1760358">&amp;&amp;</span>&nbsp;<span class="ident" id="1760361">mcu</span>&nbsp;<span class="op" id="1760365">&lt;</span>&nbsp;<span class="ident" id="1760367">mxx</span><span class="op" id="1760370">*</span><span class="ident" id="1760371">myy</span>&nbsp;<span class="op" id="1760375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1760381">//&nbsp;A&nbsp;more&nbsp;sophisticated&nbsp;decoder&nbsp;could&nbsp;use&nbsp;RST[0-7]&nbsp;markers&nbsp;to&nbsp;resynchronize&nbsp;from&nbsp;corrupt&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1760481">//&nbsp;but&nbsp;this&nbsp;one&nbsp;assumes&nbsp;well-formed&nbsp;input,&nbsp;and&nbsp;hence&nbsp;the&nbsp;restart&nbsp;marker&nbsp;follows&nbsp;immediately.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760578">if</span>&nbsp;<span class="ident" id="1760581">err</span>&nbsp;<span class="op" id="1760585">:=</span>&nbsp;<span class="ident" id="1760588">d</span><span class="op" id="1760589">.</span><span class="ident" id="1760590">readFull</span><span class="op" id="1760598">(</span><span class="ident" id="1760599">d</span><span class="op" id="1760600">.</span><span class="ident" id="1760601">tmp</span><span class="op" id="1760604">[</span><span class="op" id="1760605">:</span><span class="num" id="1760606">2</span><span class="op" id="1760607">]</span><span class="op" id="1760608">)</span><span class="op" id="1760609">;</span>&nbsp;<span class="ident" id="1760611">err</span>&nbsp;<span class="op" id="1760615">!=</span>&nbsp;<span class="builtintype" id="1760618">nil</span>&nbsp;<span class="op" id="1760622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760629">return</span>&nbsp;<span class="ident" id="1760636">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1760644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760650">if</span>&nbsp;<span class="ident" id="1760653">d</span><span class="op" id="1760654">.</span><span class="ident" id="1760655">tmp</span><span class="op" id="1760658">[</span><span class="num" id="1760659">0</span><span class="op" id="1760660">]</span>&nbsp;<span class="op" id="1760662">!=</span>&nbsp;<span class="num" id="1760665">0xff</span>&nbsp;<span class="op" id="1760670">||</span>&nbsp;<span class="ident" id="1760673">d</span><span class="op" id="1760674">.</span><span class="ident" id="1760675">tmp</span><span class="op" id="1760678">[</span><span class="num" id="1760679">1</span><span class="op" id="1760680">]</span>&nbsp;<span class="op" id="1760682">!=</span>&nbsp;<span class="ident" id="1760685">expectedRST</span>&nbsp;<span class="op" id="1760697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760704">return</span>&nbsp;<span class="ident" id="1760711">FormatError</span><span class="op" id="1760722">(</span><span class="string" id="1760723">&#34;bad&nbsp;RST&nbsp;marker&#34;</span><span class="op" id="1760739">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1760745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760751">expectedRST</span><span class="op" id="1760762">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1760769">if</span>&nbsp;<span class="ident" id="1760772">expectedRST</span>&nbsp;<span class="op" id="1760784">==</span>&nbsp;<span class="ident" id="1760787">rst7Marker</span><span class="op" id="1760797">+</span><span class="num" id="1760798">1</span>&nbsp;<span class="op" id="1760800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760807">expectedRST</span>&nbsp;<span class="op" id="1760819">=</span>&nbsp;<span class="ident" id="1760821">rst0Marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1760836">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1760842">//&nbsp;Reset&nbsp;the&nbsp;Huffman&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760876">d</span><span class="op" id="1760877">.</span><span class="ident" id="1760878">bits</span>&nbsp;<span class="op" id="1760883">=</span>&nbsp;<span class="ident" id="1760885">bits</span><span class="op" id="1760889">{</span><span class="op" id="1760890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1760896">//&nbsp;Reset&nbsp;the&nbsp;DC&nbsp;components,&nbsp;as&nbsp;per&nbsp;section&nbsp;F.2.1.3.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1760954">dc</span>&nbsp;<span class="op" id="1760957">=</span>&nbsp;<span class="op" id="1760959">[</span><span class="ident" id="1760960">nColorComponent</span><span class="op" id="1760975">]</span><span class="builtintype" id="1760976">int32</span><span class="op" id="1760981">{</span><span class="op" id="1760982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1760988">//&nbsp;Reset&nbsp;the&nbsp;progressive&nbsp;decoder&nbsp;state,&nbsp;as&nbsp;per&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761056">d</span><span class="op" id="1761057">.</span><span class="ident" id="1761058">eobRun</span>&nbsp;<span class="op" id="1761065">=</span>&nbsp;<span class="num" id="1761067">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761076">}</span>&nbsp;<span class="comment" id="1761078">//&nbsp;for&nbsp;mx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761089">}</span>&nbsp;<span class="comment" id="1761091">//&nbsp;for&nbsp;my</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761103">return</span>&nbsp;<span class="builtintype" id="1761110">nil</span><br>
<span class="lineno"></span><span class="op" id="1761114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1761117">//&nbsp;refine&nbsp;decodes&nbsp;a&nbsp;successive&nbsp;approximation&nbsp;refinement&nbsp;block,&nbsp;as&nbsp;specified&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1761196">//&nbsp;section&nbsp;G.1.2.</span><br>
<span class="lineno">340</span><span class="keyword" id="1761214">func</span>&nbsp;<span class="op" id="1761219">(</span><span class="ident" id="1761220">d</span>&nbsp;<span class="op" id="1761222">*</span><span class="ident" id="1761223">decoder</span><span class="op" id="1761230">)</span>&nbsp;<span class="ident" id="1761232">refine</span><span class="op" id="1761238">(</span><span class="ident" id="1761239">b</span>&nbsp;<span class="op" id="1761241">*</span><span class="ident" id="1761242">block</span><span class="op" id="1761247">,</span>&nbsp;<span class="ident" id="1761249">h</span>&nbsp;<span class="op" id="1761251">*</span><span class="ident" id="1761252">huffman</span><span class="op" id="1761259">,</span>&nbsp;<span class="ident" id="1761261">zigStart</span><span class="op" id="1761269">,</span>&nbsp;<span class="ident" id="1761271">zigEnd</span><span class="op" id="1761277">,</span>&nbsp;<span class="ident" id="1761279">delta</span>&nbsp;<span class="builtintype" id="1761285">int32</span><span class="op" id="1761290">)</span>&nbsp;<span class="builtintype" id="1761292">error</span>&nbsp;<span class="op" id="1761298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1761301">//&nbsp;Refining&nbsp;a&nbsp;DC&nbsp;component&nbsp;is&nbsp;trivial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761341">if</span>&nbsp;<span class="ident" id="1761344">zigStart</span>&nbsp;<span class="op" id="1761353">==</span>&nbsp;<span class="num" id="1761356">0</span>&nbsp;<span class="op" id="1761358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761362">if</span>&nbsp;<span class="ident" id="1761365">zigEnd</span>&nbsp;<span class="op" id="1761372">!=</span>&nbsp;<span class="num" id="1761375">0</span>&nbsp;<span class="op" id="1761377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1761382">panic</span><span class="op" id="1761387">(</span><span class="string" id="1761388">&#34;unreachable&#34;</span><span class="op" id="1761401">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761409">bit</span><span class="op" id="1761412">,</span>&nbsp;<span class="ident" id="1761414">err</span>&nbsp;<span class="op" id="1761418">:=</span>&nbsp;<span class="ident" id="1761421">d</span><span class="op" id="1761422">.</span><span class="ident" id="1761423">decodeBit</span><span class="op" id="1761432">(</span><span class="op" id="1761433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761437">if</span>&nbsp;<span class="ident" id="1761440">err</span>&nbsp;<span class="op" id="1761444">!=</span>&nbsp;<span class="builtintype" id="1761447">nil</span>&nbsp;<span class="op" id="1761451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761456">return</span>&nbsp;<span class="ident" id="1761463">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761469">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761473">if</span>&nbsp;<span class="ident" id="1761476">bit</span>&nbsp;<span class="op" id="1761480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761485">b</span><span class="op" id="1761486">[</span><span class="num" id="1761487">0</span><span class="op" id="1761488">]</span>&nbsp;<span class="op" id="1761490">|=</span>&nbsp;<span class="ident" id="1761493">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761505">return</span>&nbsp;<span class="builtintype" id="1761512">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761517">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1761521">//&nbsp;Refining&nbsp;AC&nbsp;components&nbsp;is&nbsp;more&nbsp;complicated;&nbsp;see&nbsp;sections&nbsp;G.1.2.2&nbsp;and&nbsp;G.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761603">zig</span>&nbsp;<span class="op" id="1761607">:=</span>&nbsp;<span class="ident" id="1761610">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761620">if</span>&nbsp;<span class="ident" id="1761623">d</span><span class="op" id="1761624">.</span><span class="ident" id="1761625">eobRun</span>&nbsp;<span class="op" id="1761632">==</span>&nbsp;<span class="num" id="1761635">0</span>&nbsp;<span class="op" id="1761637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761640">loop</span><span class="op" id="1761644">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761648">for</span>&nbsp;<span class="op" id="1761652">;</span>&nbsp;<span class="ident" id="1761654">zig</span>&nbsp;<span class="op" id="1761658">&lt;=</span>&nbsp;<span class="ident" id="1761661">zigEnd</span><span class="op" id="1761667">;</span>&nbsp;<span class="ident" id="1761669">zig</span><span class="op" id="1761672">++</span>&nbsp;<span class="op" id="1761675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761680">z</span>&nbsp;<span class="op" id="1761682">:=</span>&nbsp;<span class="builtintype" id="1761685">int32</span><span class="op" id="1761690">(</span><span class="num" id="1761691">0</span><span class="op" id="1761692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761697">value</span><span class="op" id="1761702">,</span>&nbsp;<span class="ident" id="1761704">err</span>&nbsp;<span class="op" id="1761708">:=</span>&nbsp;<span class="ident" id="1761711">d</span><span class="op" id="1761712">.</span><span class="ident" id="1761713">decodeHuffman</span><span class="op" id="1761726">(</span><span class="ident" id="1761727">h</span><span class="op" id="1761728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761733">if</span>&nbsp;<span class="ident" id="1761736">err</span>&nbsp;<span class="op" id="1761740">!=</span>&nbsp;<span class="builtintype" id="1761743">nil</span>&nbsp;<span class="op" id="1761747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761753">return</span>&nbsp;<span class="ident" id="1761760">err</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1761767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761772">val0</span>&nbsp;<span class="op" id="1761777">:=</span>&nbsp;<span class="ident" id="1761780">value</span>&nbsp;<span class="op" id="1761786">&gt;&gt;</span>&nbsp;<span class="num" id="1761789">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761794">val1</span>&nbsp;<span class="op" id="1761799">:=</span>&nbsp;<span class="ident" id="1761802">value</span>&nbsp;<span class="op" id="1761808">&amp;</span>&nbsp;<span class="num" id="1761810">0x0f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761819">switch</span>&nbsp;<span class="ident" id="1761826">val1</span>&nbsp;<span class="op" id="1761831">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761836">case</span>&nbsp;<span class="num" id="1761841">0</span><span class="op" id="1761842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761848">if</span>&nbsp;<span class="ident" id="1761851">val0</span>&nbsp;<span class="op" id="1761856">!=</span>&nbsp;<span class="num" id="1761859">0x0f</span>&nbsp;<span class="op" id="1761864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761871">d</span><span class="op" id="1761872">.</span><span class="ident" id="1761873">eobRun</span>&nbsp;<span class="op" id="1761880">=</span>&nbsp;<span class="builtintype" id="1761882">uint16</span><span class="op" id="1761888">(</span><span class="num" id="1761889">1</span>&nbsp;<span class="op" id="1761891">&lt;&lt;</span>&nbsp;<span class="ident" id="1761894">val0</span><span class="op" id="1761898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761905">if</span>&nbsp;<span class="ident" id="1761908">val0</span>&nbsp;<span class="op" id="1761913">!=</span>&nbsp;<span class="num" id="1761916">0</span>&nbsp;<span class="op" id="1761918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1761926">bits</span><span class="op" id="1761930">,</span>&nbsp;<span class="ident" id="1761932">err</span>&nbsp;<span class="op" id="1761936">:=</span>&nbsp;<span class="ident" id="1761939">d</span><span class="op" id="1761940">.</span><span class="ident" id="1761941">decodeBits</span><span class="op" id="1761951">(</span><span class="builtintype" id="1761952">int32</span><span class="op" id="1761957">(</span><span class="ident" id="1761958">val0</span><span class="op" id="1761962">)</span><span class="op" id="1761963">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761971">if</span>&nbsp;<span class="ident" id="1761974">err</span>&nbsp;<span class="op" id="1761978">!=</span>&nbsp;<span class="builtintype" id="1761981">nil</span>&nbsp;<span class="op" id="1761985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1761994">return</span>&nbsp;<span class="ident" id="1762001">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1762019">d</span><span class="op" id="1762020">.</span><span class="ident" id="1762021">eobRun</span>&nbsp;<span class="op" id="1762028">|=</span>&nbsp;<span class="builtintype" id="1762031">uint16</span><span class="op" id="1762037">(</span><span class="ident" id="1762038">bits</span><span class="op" id="1762042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762049">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762056">break</span>&nbsp;<span class="ident" id="1762062">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762076">case</span>&nbsp;<span class="num" id="1762081">1</span><span class="op" id="1762082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1762088">z</span>&nbsp;<span class="op" id="1762090">=</span>&nbsp;<span class="ident" id="1762092">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1762102">bit</span><span class="op" id="1762105">,</span>&nbsp;<span class="ident" id="1762107">err</span>&nbsp;<span class="op" id="1762111">:=</span>&nbsp;<span class="ident" id="1762114">d</span><span class="op" id="1762115">.</span><span class="ident" id="1762116">decodeBit</span><span class="op" id="1762125">(</span><span class="op" id="1762126">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762132">if</span>&nbsp;<span class="ident" id="1762135">err</span>&nbsp;<span class="op" id="1762139">!=</span>&nbsp;<span class="builtintype" id="1762142">nil</span>&nbsp;<span class="op" id="1762146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762153">return</span>&nbsp;<span class="ident" id="1762160">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762174">if</span>&nbsp;<span class="op" id="1762177">!</span><span class="ident" id="1762178">bit</span>&nbsp;<span class="op" id="1762182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1762189">z</span>&nbsp;<span class="op" id="1762191">=</span>&nbsp;<span class="op" id="1762193">-</span><span class="ident" id="1762194">z</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762205">default</span><span class="op" id="1762212">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762218">return</span>&nbsp;<span class="ident" id="1762225">FormatError</span><span class="op" id="1762236">(</span><span class="string" id="1762237">&#34;unexpected&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="1762262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1762273">zig</span><span class="op" id="1762276">,</span>&nbsp;<span class="ident" id="1762278">err</span>&nbsp;<span class="op" id="1762282">=</span>&nbsp;<span class="ident" id="1762284">d</span><span class="op" id="1762285">.</span><span class="ident" id="1762286">refineNonZeroes</span><span class="op" id="1762301">(</span><span class="ident" id="1762302">b</span><span class="op" id="1762303">,</span>&nbsp;<span class="ident" id="1762305">zig</span><span class="op" id="1762308">,</span>&nbsp;<span class="ident" id="1762310">zigEnd</span><span class="op" id="1762316">,</span>&nbsp;<span class="builtintype" id="1762318">int32</span><span class="op" id="1762323">(</span><span class="ident" id="1762324">val0</span><span class="op" id="1762328">)</span><span class="op" id="1762329">,</span>&nbsp;<span class="ident" id="1762331">delta</span><span class="op" id="1762336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762341">if</span>&nbsp;<span class="ident" id="1762344">err</span>&nbsp;<span class="op" id="1762348">!=</span>&nbsp;<span class="builtintype" id="1762351">nil</span>&nbsp;<span class="op" id="1762355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762361">return</span>&nbsp;<span class="ident" id="1762368">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762380">if</span>&nbsp;<span class="ident" id="1762383">zig</span>&nbsp;<span class="op" id="1762387">&gt;</span>&nbsp;<span class="ident" id="1762389">zigEnd</span>&nbsp;<span class="op" id="1762396">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762402">return</span>&nbsp;<span class="ident" id="1762409">FormatError</span><span class="op" id="1762420">(</span><span class="string" id="1762421">&#34;too&nbsp;many&nbsp;coefficients&#34;</span><span class="op" id="1762444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762454">if</span>&nbsp;<span class="ident" id="1762457">z</span>&nbsp;<span class="op" id="1762459">!=</span>&nbsp;<span class="num" id="1762462">0</span>&nbsp;<span class="op" id="1762464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1762470">b</span><span class="op" id="1762471">[</span><span class="ident" id="1762472">unzig</span><span class="op" id="1762477">[</span><span class="ident" id="1762478">zig</span><span class="op" id="1762481">]</span><span class="op" id="1762482">]</span>&nbsp;<span class="op" id="1762484">=</span>&nbsp;<span class="ident" id="1762486">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762491">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762501">if</span>&nbsp;<span class="ident" id="1762504">d</span><span class="op" id="1762505">.</span><span class="ident" id="1762506">eobRun</span>&nbsp;<span class="op" id="1762513">&gt;</span>&nbsp;<span class="num" id="1762515">0</span>&nbsp;<span class="op" id="1762517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1762521">d</span><span class="op" id="1762522">.</span><span class="ident" id="1762523">eobRun</span><span class="op" id="1762529">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762534">if</span>&nbsp;<span class="ident" id="1762537">_</span><span class="op" id="1762538">,</span>&nbsp;<span class="ident" id="1762540">err</span>&nbsp;<span class="op" id="1762544">:=</span>&nbsp;<span class="ident" id="1762547">d</span><span class="op" id="1762548">.</span><span class="ident" id="1762549">refineNonZeroes</span><span class="op" id="1762564">(</span><span class="ident" id="1762565">b</span><span class="op" id="1762566">,</span>&nbsp;<span class="ident" id="1762568">zig</span><span class="op" id="1762571">,</span>&nbsp;<span class="ident" id="1762573">zigEnd</span><span class="op" id="1762579">,</span>&nbsp;<span class="op" id="1762581">-</span><span class="num" id="1762582">1</span><span class="op" id="1762583">,</span>&nbsp;<span class="ident" id="1762585">delta</span><span class="op" id="1762590">)</span><span class="op" id="1762591">;</span>&nbsp;<span class="ident" id="1762593">err</span>&nbsp;<span class="op" id="1762597">!=</span>&nbsp;<span class="builtintype" id="1762600">nil</span>&nbsp;<span class="op" id="1762604">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762609">return</span>&nbsp;<span class="ident" id="1762616">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762628">return</span>&nbsp;<span class="builtintype" id="1762635">nil</span><br>
<span class="lineno"></span><span class="op" id="1762639">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="1762642">//&nbsp;refineNonZeroes&nbsp;refines&nbsp;non-zero&nbsp;entries&nbsp;of&nbsp;b&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;If&nbsp;nz&nbsp;&gt;=&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="1762721">//&nbsp;the&nbsp;first&nbsp;nz&nbsp;zero&nbsp;entries&nbsp;are&nbsp;skipped&nbsp;over.</span><br>
<span class="lineno"></span><span class="keyword" id="1762768">func</span>&nbsp;<span class="op" id="1762773">(</span><span class="ident" id="1762774">d</span>&nbsp;<span class="op" id="1762776">*</span><span class="ident" id="1762777">decoder</span><span class="op" id="1762784">)</span>&nbsp;<span class="ident" id="1762786">refineNonZeroes</span><span class="op" id="1762801">(</span><span class="ident" id="1762802">b</span>&nbsp;<span class="op" id="1762804">*</span><span class="ident" id="1762805">block</span><span class="op" id="1762810">,</span>&nbsp;<span class="ident" id="1762812">zig</span><span class="op" id="1762815">,</span>&nbsp;<span class="ident" id="1762817">zigEnd</span><span class="op" id="1762823">,</span>&nbsp;<span class="ident" id="1762825">nz</span><span class="op" id="1762827">,</span>&nbsp;<span class="ident" id="1762829">delta</span>&nbsp;<span class="builtintype" id="1762835">int32</span><span class="op" id="1762840">)</span>&nbsp;<span class="op" id="1762842">(</span><span class="builtintype" id="1762843">int32</span><span class="op" id="1762848">,</span>&nbsp;<span class="builtintype" id="1762850">error</span><span class="op" id="1762855">)</span>&nbsp;<span class="op" id="1762857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762860">for</span>&nbsp;<span class="op" id="1762864">;</span>&nbsp;<span class="ident" id="1762866">zig</span>&nbsp;<span class="op" id="1762870">&lt;=</span>&nbsp;<span class="ident" id="1762873">zigEnd</span><span class="op" id="1762879">;</span>&nbsp;<span class="ident" id="1762881">zig</span><span class="op" id="1762884">++</span>&nbsp;<span class="op" id="1762887">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1762891">u</span>&nbsp;<span class="op" id="1762893">:=</span>&nbsp;<span class="ident" id="1762896">unzig</span><span class="op" id="1762901">[</span><span class="ident" id="1762902">zig</span><span class="op" id="1762905">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762909">if</span>&nbsp;<span class="ident" id="1762912">b</span><span class="op" id="1762913">[</span><span class="ident" id="1762914">u</span><span class="op" id="1762915">]</span>&nbsp;<span class="op" id="1762917">==</span>&nbsp;<span class="num" id="1762920">0</span>&nbsp;<span class="op" id="1762922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762927">if</span>&nbsp;<span class="ident" id="1762930">nz</span>&nbsp;<span class="op" id="1762933">==</span>&nbsp;<span class="num" id="1762936">0</span>&nbsp;<span class="op" id="1762938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762944">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762953">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1762958">nz</span><span class="op" id="1762960">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1762966">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1762977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1762981">bit</span><span class="op" id="1762984">,</span>&nbsp;<span class="ident" id="1762986">err</span>&nbsp;<span class="op" id="1762990">:=</span>&nbsp;<span class="ident" id="1762993">d</span><span class="op" id="1762994">.</span><span class="ident" id="1762995">decodeBit</span><span class="op" id="1763004">(</span><span class="op" id="1763005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1763009">if</span>&nbsp;<span class="ident" id="1763012">err</span>&nbsp;<span class="op" id="1763016">!=</span>&nbsp;<span class="builtintype" id="1763019">nil</span>&nbsp;<span class="op" id="1763023">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1763028">return</span>&nbsp;<span class="num" id="1763035">0</span><span class="op" id="1763036">,</span>&nbsp;<span class="ident" id="1763038">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1763044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1763048">if</span>&nbsp;<span class="op" id="1763051">!</span><span class="ident" id="1763052">bit</span>&nbsp;<span class="op" id="1763056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1763061">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1763072">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1763076">if</span>&nbsp;<span class="ident" id="1763079">b</span><span class="op" id="1763080">[</span><span class="ident" id="1763081">u</span><span class="op" id="1763082">]</span>&nbsp;<span class="op" id="1763084">&gt;=</span>&nbsp;<span class="num" id="1763087">0</span>&nbsp;<span class="op" id="1763089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1763094">b</span><span class="op" id="1763095">[</span><span class="ident" id="1763096">u</span><span class="op" id="1763097">]</span>&nbsp;<span class="op" id="1763099">+=</span>&nbsp;<span class="ident" id="1763102">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1763110">}</span>&nbsp;<span class="keyword" id="1763112">else</span>&nbsp;<span class="op" id="1763117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1763122">b</span><span class="op" id="1763123">[</span><span class="ident" id="1763124">u</span><span class="op" id="1763125">]</span>&nbsp;<span class="op" id="1763127">-=</span>&nbsp;<span class="ident" id="1763130">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1763138">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1763141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1763144">return</span>&nbsp;<span class="ident" id="1763151">zig</span><span class="op" id="1763154">,</span>&nbsp;<span class="builtintype" id="1763156">nil</span><br>
<span class="lineno"></span><span class="op" id="1763160">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
