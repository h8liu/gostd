<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/ecdsa</h2>
<ul>
<li><a href="/gostd/crypto/ecdsa/ecdsa.go.html">ecdsa.go</a></li>
<li><a href="/gostd/crypto/ecdsa/ecdsa_test.go.html">ecdsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4452809">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4452864">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4452918">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4452969">//&nbsp;Package&nbsp;ecdsa&nbsp;implements&nbsp;the&nbsp;Elliptic&nbsp;Curve&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4453048">//&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4453074">package</span>&nbsp;<span class="ident" id="4453082">ecdsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4453089">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="4453104">//&nbsp;&nbsp;&nbsp;[NSA]:&nbsp;Suite&nbsp;B&nbsp;implementer&#39;s&nbsp;guide&nbsp;to&nbsp;FIPS&nbsp;186-3,</span><br>
<span class="lineno"></span><span class="comment" id="4453159">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.nsa.gov/ia/_files/ecdsa.pdf</span><br>
<span class="lineno"></span><span class="comment" id="4453205">//&nbsp;&nbsp;&nbsp;[SECG]:&nbsp;SECG,&nbsp;SEC1</span><br>
<span class="lineno"></span><span class="comment" id="4453229">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.secg.org/download/aid-780/sec1-v2.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4453286">import</span>&nbsp;<span class="op" id="4453293">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4453296">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4453306">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4453325">&#34;encoding/asn1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4453342">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4453348">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4453359">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4453362">//&nbsp;PublicKey&nbsp;represents&nbsp;an&nbsp;ECDSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4453407">type</span>&nbsp;<span class="ident" id="4453412">PublicKey</span>&nbsp;<span class="keyword" id="4453422">struct</span>&nbsp;<span class="op" id="4453429">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453432">elliptic</span><span class="op" id="4453440">.</span><span class="ident" id="4453441">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453448">X</span><span class="op" id="4453449">,</span>&nbsp;<span class="ident" id="4453451">Y</span>&nbsp;<span class="op" id="4453453">*</span><span class="ident" id="4453454">big</span><span class="op" id="4453457">.</span><span class="ident" id="4453458">Int</span><br>
<span class="lineno"></span><span class="op" id="4453462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4453465">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;ECDSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno">30</span><span class="keyword" id="4453511">type</span>&nbsp;<span class="ident" id="4453516">PrivateKey</span>&nbsp;<span class="keyword" id="4453527">struct</span>&nbsp;<span class="op" id="4453534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453537">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453548">D</span>&nbsp;<span class="op" id="4453550">*</span><span class="ident" id="4453551">big</span><span class="op" id="4453554">.</span><span class="ident" id="4453555">Int</span><br>
<span class="lineno"></span><span class="op" id="4453559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="4453562">type</span>&nbsp;<span class="ident" id="4453567">ecdsaSignature</span>&nbsp;<span class="keyword" id="4453582">struct</span>&nbsp;<span class="op" id="4453589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4453592">R</span><span class="op" id="4453593">,</span>&nbsp;<span class="ident" id="4453595">S</span>&nbsp;<span class="op" id="4453597">*</span><span class="ident" id="4453598">big</span><span class="op" id="4453601">.</span><span class="ident" id="4453602">Int</span><br>
<span class="lineno"></span><span class="op" id="4453606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4453609">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno">40</span><span class="keyword" id="4453665">func</span>&nbsp;<span class="op" id="4453670">(</span><span class="ident" id="4453671">priv</span>&nbsp;<span class="op" id="4453676">*</span><span class="ident" id="4453677">PrivateKey</span><span class="op" id="4453687">)</span>&nbsp;<span class="ident" id="4453689">Public</span><span class="op" id="4453695">(</span><span class="op" id="4453696">)</span>&nbsp;<span class="ident" id="4453698">crypto</span><span class="op" id="4453704">.</span><span class="ident" id="4453705">PublicKey</span>&nbsp;<span class="op" id="4453715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4453718">return</span>&nbsp;<span class="op" id="4453725">&amp;</span><span class="ident" id="4453726">priv</span><span class="op" id="4453730">.</span><span class="ident" id="4453731">PublicKey</span><br>
<span class="lineno"></span><span class="op" id="4453741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4453744">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;This&nbsp;method&nbsp;is</span><br>
<span class="lineno">45</span><span class="comment" id="4453818">//&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4453896">//&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign&nbsp;function&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4453973">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="4453986">func</span>&nbsp;<span class="op" id="4453991">(</span><span class="ident" id="4453992">priv</span>&nbsp;<span class="op" id="4453997">*</span><span class="ident" id="4453998">PrivateKey</span><span class="op" id="4454008">)</span>&nbsp;<span class="ident" id="4454010">Sign</span><span class="op" id="4454014">(</span><span class="ident" id="4454015">rand</span>&nbsp;<span class="ident" id="4454020">io</span><span class="op" id="4454022">.</span><span class="ident" id="4454023">Reader</span><span class="op" id="4454029">,</span>&nbsp;<span class="ident" id="4454031">msg</span>&nbsp;<span class="op" id="4454035">[</span><span class="op" id="4454036">]</span><span class="builtintype" id="4454037">byte</span><span class="op" id="4454041">,</span>&nbsp;<span class="ident" id="4454043">opts</span>&nbsp;<span class="ident" id="4454048">crypto</span><span class="op" id="4454054">.</span><span class="ident" id="4454055">SignerOpts</span><span class="op" id="4454065">)</span>&nbsp;<span class="op" id="4454067">(</span><span class="op" id="4454068">[</span><span class="op" id="4454069">]</span><span class="builtintype" id="4454070">byte</span><span class="op" id="4454074">,</span>&nbsp;<span class="builtintype" id="4454076">error</span><span class="op" id="4454081">)</span>&nbsp;<span class="op" id="4454083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454086">r</span><span class="op" id="4454087">,</span>&nbsp;<span class="ident" id="4454089">s</span><span class="op" id="4454090">,</span>&nbsp;<span class="ident" id="4454092">err</span>&nbsp;<span class="op" id="4454096">:=</span>&nbsp;<span class="ident" id="4454099">Sign</span><span class="op" id="4454103">(</span><span class="ident" id="4454104">rand</span><span class="op" id="4454108">,</span>&nbsp;<span class="ident" id="4454110">priv</span><span class="op" id="4454114">,</span>&nbsp;<span class="ident" id="4454116">msg</span><span class="op" id="4454119">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454122">if</span>&nbsp;<span class="ident" id="4454125">err</span>&nbsp;<span class="op" id="4454129">!=</span>&nbsp;<span class="ident" id="4454132">nil</span>&nbsp;<span class="op" id="4454136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454140">return</span>&nbsp;<span class="ident" id="4454147">nil</span><span class="op" id="4454150">,</span>&nbsp;<span class="ident" id="4454152">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454161">return</span>&nbsp;<span class="ident" id="4454168">asn1</span><span class="op" id="4454172">.</span><span class="ident" id="4454173">Marshal</span><span class="op" id="4454180">(</span><span class="ident" id="4454181">ecdsaSignature</span><span class="op" id="4454195">{</span><span class="ident" id="4454196">r</span><span class="op" id="4454197">,</span>&nbsp;<span class="ident" id="4454199">s</span><span class="op" id="4454200">}</span><span class="op" id="4454201">)</span><br>
<span class="lineno">55</span><span class="op" id="4454203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4454206">var</span>&nbsp;<span class="ident" id="4454210">one</span>&nbsp;<span class="op" id="4454214">=</span>&nbsp;<span class="builtinfunc" id="4454216">new</span><span class="op" id="4454219">(</span><span class="ident" id="4454220">big</span><span class="op" id="4454223">.</span><span class="ident" id="4454224">Int</span><span class="op" id="4454227">)</span><span class="op" id="4454228">.</span><span class="ident" id="4454229">SetInt64</span><span class="op" id="4454237">(</span><span class="num" id="4454238">1</span><span class="op" id="4454239">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4454242">//&nbsp;randFieldElement&nbsp;returns&nbsp;a&nbsp;random&nbsp;element&nbsp;of&nbsp;the&nbsp;field&nbsp;underlying&nbsp;the&nbsp;given</span><br>
<span class="lineno">60</span><span class="comment" id="4454321">//&nbsp;curve&nbsp;using&nbsp;the&nbsp;procedure&nbsp;given&nbsp;in&nbsp;[NSA]&nbsp;A.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4454372">func</span>&nbsp;<span class="ident" id="4454377">randFieldElement</span><span class="op" id="4454393">(</span><span class="ident" id="4454394">c</span>&nbsp;<span class="ident" id="4454396">elliptic</span><span class="op" id="4454404">.</span><span class="ident" id="4454405">Curve</span><span class="op" id="4454410">,</span>&nbsp;<span class="ident" id="4454412">rand</span>&nbsp;<span class="ident" id="4454417">io</span><span class="op" id="4454419">.</span><span class="ident" id="4454420">Reader</span><span class="op" id="4454426">)</span>&nbsp;<span class="op" id="4454428">(</span><span class="ident" id="4454429">k</span>&nbsp;<span class="op" id="4454431">*</span><span class="ident" id="4454432">big</span><span class="op" id="4454435">.</span><span class="ident" id="4454436">Int</span><span class="op" id="4454439">,</span>&nbsp;<span class="ident" id="4454441">err</span>&nbsp;<span class="builtintype" id="4454445">error</span><span class="op" id="4454450">)</span>&nbsp;<span class="op" id="4454452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454455">params</span>&nbsp;<span class="op" id="4454462">:=</span>&nbsp;<span class="ident" id="4454465">c</span><span class="op" id="4454466">.</span><span class="ident" id="4454467">Params</span><span class="op" id="4454473">(</span><span class="op" id="4454474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454477">b</span>&nbsp;<span class="op" id="4454479">:=</span>&nbsp;<span class="builtinfunc" id="4454482">make</span><span class="op" id="4454486">(</span><span class="op" id="4454487">[</span><span class="op" id="4454488">]</span><span class="builtintype" id="4454489">byte</span><span class="op" id="4454493">,</span>&nbsp;<span class="ident" id="4454495">params</span><span class="op" id="4454501">.</span><span class="ident" id="4454502">BitSize</span><span class="op" id="4454509">/</span><span class="num" id="4454510">8</span><span class="op" id="4454511">+</span><span class="num" id="4454512">8</span><span class="op" id="4454513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454516">_</span><span class="op" id="4454517">,</span>&nbsp;<span class="ident" id="4454519">err</span>&nbsp;<span class="op" id="4454523">=</span>&nbsp;<span class="ident" id="4454525">io</span><span class="op" id="4454527">.</span><span class="ident" id="4454528">ReadFull</span><span class="op" id="4454536">(</span><span class="ident" id="4454537">rand</span><span class="op" id="4454541">,</span>&nbsp;<span class="ident" id="4454543">b</span><span class="op" id="4454544">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454547">if</span>&nbsp;<span class="ident" id="4454550">err</span>&nbsp;<span class="op" id="4454554">!=</span>&nbsp;<span class="ident" id="4454557">nil</span>&nbsp;<span class="op" id="4454561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454565">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454577">k</span>&nbsp;<span class="op" id="4454579">=</span>&nbsp;<span class="builtinfunc" id="4454581">new</span><span class="op" id="4454584">(</span><span class="ident" id="4454585">big</span><span class="op" id="4454588">.</span><span class="ident" id="4454589">Int</span><span class="op" id="4454592">)</span><span class="op" id="4454593">.</span><span class="ident" id="4454594">SetBytes</span><span class="op" id="4454602">(</span><span class="ident" id="4454603">b</span><span class="op" id="4454604">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454607">n</span>&nbsp;<span class="op" id="4454609">:=</span>&nbsp;<span class="builtinfunc" id="4454612">new</span><span class="op" id="4454615">(</span><span class="ident" id="4454616">big</span><span class="op" id="4454619">.</span><span class="ident" id="4454620">Int</span><span class="op" id="4454623">)</span><span class="op" id="4454624">.</span><span class="ident" id="4454625">Sub</span><span class="op" id="4454628">(</span><span class="ident" id="4454629">params</span><span class="op" id="4454635">.</span><span class="ident" id="4454636">N</span><span class="op" id="4454637">,</span>&nbsp;<span class="ident" id="4454639">one</span><span class="op" id="4454642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454645">k</span><span class="op" id="4454646">.</span><span class="ident" id="4454647">Mod</span><span class="op" id="4454650">(</span><span class="ident" id="4454651">k</span><span class="op" id="4454652">,</span>&nbsp;<span class="ident" id="4454654">n</span><span class="op" id="4454655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454658">k</span><span class="op" id="4454659">.</span><span class="ident" id="4454660">Add</span><span class="op" id="4454663">(</span><span class="ident" id="4454664">k</span><span class="op" id="4454665">,</span>&nbsp;<span class="ident" id="4454667">one</span><span class="op" id="4454670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454673">return</span><br>
<span class="lineno"></span><span class="op" id="4454680">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4454683">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&nbsp;and&nbsp;private&nbsp;key&nbsp;pair.</span><br>
<span class="lineno"></span><span class="keyword" id="4454739">func</span>&nbsp;<span class="ident" id="4454744">GenerateKey</span><span class="op" id="4454755">(</span><span class="ident" id="4454756">c</span>&nbsp;<span class="ident" id="4454758">elliptic</span><span class="op" id="4454766">.</span><span class="ident" id="4454767">Curve</span><span class="op" id="4454772">,</span>&nbsp;<span class="ident" id="4454774">rand</span>&nbsp;<span class="ident" id="4454779">io</span><span class="op" id="4454781">.</span><span class="ident" id="4454782">Reader</span><span class="op" id="4454788">)</span>&nbsp;<span class="op" id="4454790">(</span><span class="ident" id="4454791">priv</span>&nbsp;<span class="op" id="4454796">*</span><span class="ident" id="4454797">PrivateKey</span><span class="op" id="4454807">,</span>&nbsp;<span class="ident" id="4454809">err</span>&nbsp;<span class="builtintype" id="4454813">error</span><span class="op" id="4454818">)</span>&nbsp;<span class="op" id="4454820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454823">k</span><span class="op" id="4454824">,</span>&nbsp;<span class="ident" id="4454826">err</span>&nbsp;<span class="op" id="4454830">:=</span>&nbsp;<span class="ident" id="4454833">randFieldElement</span><span class="op" id="4454849">(</span><span class="ident" id="4454850">c</span><span class="op" id="4454851">,</span>&nbsp;<span class="ident" id="4454853">rand</span><span class="op" id="4454857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454860">if</span>&nbsp;<span class="ident" id="4454863">err</span>&nbsp;<span class="op" id="4454867">!=</span>&nbsp;<span class="ident" id="4454870">nil</span>&nbsp;<span class="op" id="4454874">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4454878">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4454886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454890">priv</span>&nbsp;<span class="op" id="4454895">=</span>&nbsp;<span class="builtinfunc" id="4454897">new</span><span class="op" id="4454900">(</span><span class="ident" id="4454901">PrivateKey</span><span class="op" id="4454911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454914">priv</span><span class="op" id="4454918">.</span><span class="ident" id="4454919">PublicKey</span><span class="op" id="4454928">.</span><span class="ident" id="4454929">Curve</span>&nbsp;<span class="op" id="4454935">=</span>&nbsp;<span class="ident" id="4454937">c</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454940">priv</span><span class="op" id="4454944">.</span><span class="ident" id="4454945">D</span>&nbsp;<span class="op" id="4454947">=</span>&nbsp;<span class="ident" id="4454949">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4454952">priv</span><span class="op" id="4454956">.</span><span class="ident" id="4454957">PublicKey</span><span class="op" id="4454966">.</span><span class="ident" id="4454967">X</span><span class="op" id="4454968">,</span>&nbsp;<span class="ident" id="4454970">priv</span><span class="op" id="4454974">.</span><span class="ident" id="4454975">PublicKey</span><span class="op" id="4454984">.</span><span class="ident" id="4454985">Y</span>&nbsp;<span class="op" id="4454987">=</span>&nbsp;<span class="ident" id="4454989">c</span><span class="op" id="4454990">.</span><span class="ident" id="4454991">ScalarBaseMult</span><span class="op" id="4455005">(</span><span class="ident" id="4455006">k</span><span class="op" id="4455007">.</span><span class="ident" id="4455008">Bytes</span><span class="op" id="4455013">(</span><span class="op" id="4455014">)</span><span class="op" id="4455015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455018">return</span><br>
<span class="lineno"></span><span class="op" id="4455025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="4455028">//&nbsp;hashToInt&nbsp;converts&nbsp;a&nbsp;hash&nbsp;value&nbsp;to&nbsp;an&nbsp;integer.&nbsp;There&nbsp;is&nbsp;some&nbsp;disagreement</span><br>
<span class="lineno"></span><span class="comment" id="4455105">//&nbsp;about&nbsp;how&nbsp;this&nbsp;is&nbsp;done.&nbsp;[NSA]&nbsp;suggests&nbsp;that&nbsp;this&nbsp;is&nbsp;done&nbsp;in&nbsp;the&nbsp;obvious</span><br>
<span class="lineno"></span><span class="comment" id="4455180">//&nbsp;manner,&nbsp;but&nbsp;[SECG]&nbsp;truncates&nbsp;the&nbsp;hash&nbsp;to&nbsp;the&nbsp;bit-length&nbsp;of&nbsp;the&nbsp;curve&nbsp;order</span><br>
<span class="lineno"></span><span class="comment" id="4455258">//&nbsp;first.&nbsp;We&nbsp;follow&nbsp;[SECG]&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;OpenSSL&nbsp;does.&nbsp;Additionally,</span><br>
<span class="lineno"></span><span class="comment" id="4455333">//&nbsp;OpenSSL&nbsp;right&nbsp;shifts&nbsp;excess&nbsp;bits&nbsp;from&nbsp;the&nbsp;number&nbsp;if&nbsp;the&nbsp;hash&nbsp;is&nbsp;too&nbsp;large</span><br>
<span class="lineno">95</span><span class="comment" id="4455410">//&nbsp;and&nbsp;we&nbsp;mirror&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span><span class="keyword" id="4455437">func</span>&nbsp;<span class="ident" id="4455442">hashToInt</span><span class="op" id="4455451">(</span><span class="ident" id="4455452">hash</span>&nbsp;<span class="op" id="4455457">[</span><span class="op" id="4455458">]</span><span class="builtintype" id="4455459">byte</span><span class="op" id="4455463">,</span>&nbsp;<span class="ident" id="4455465">c</span>&nbsp;<span class="ident" id="4455467">elliptic</span><span class="op" id="4455475">.</span><span class="ident" id="4455476">Curve</span><span class="op" id="4455481">)</span>&nbsp;<span class="op" id="4455483">*</span><span class="ident" id="4455484">big</span><span class="op" id="4455487">.</span><span class="ident" id="4455488">Int</span>&nbsp;<span class="op" id="4455492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455495">orderBits</span>&nbsp;<span class="op" id="4455505">:=</span>&nbsp;<span class="ident" id="4455508">c</span><span class="op" id="4455509">.</span><span class="ident" id="4455510">Params</span><span class="op" id="4455516">(</span><span class="op" id="4455517">)</span><span class="op" id="4455518">.</span><span class="ident" id="4455519">N</span><span class="op" id="4455520">.</span><span class="ident" id="4455521">BitLen</span><span class="op" id="4455527">(</span><span class="op" id="4455528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455531">orderBytes</span>&nbsp;<span class="op" id="4455542">:=</span>&nbsp;<span class="op" id="4455545">(</span><span class="ident" id="4455546">orderBits</span>&nbsp;<span class="op" id="4455556">+</span>&nbsp;<span class="num" id="4455558">7</span><span class="op" id="4455559">)</span>&nbsp;<span class="op" id="4455561">/</span>&nbsp;<span class="num" id="4455563">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455566">if</span>&nbsp;<span class="builtinfunc" id="4455569">len</span><span class="op" id="4455572">(</span><span class="ident" id="4455573">hash</span><span class="op" id="4455577">)</span>&nbsp;<span class="op" id="4455579">&gt;</span>&nbsp;<span class="ident" id="4455581">orderBytes</span>&nbsp;<span class="op" id="4455592">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455596">hash</span>&nbsp;<span class="op" id="4455601">=</span>&nbsp;<span class="ident" id="4455603">hash</span><span class="op" id="4455607">[</span><span class="op" id="4455608">:</span><span class="ident" id="4455609">orderBytes</span><span class="op" id="4455619">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4455622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455626">ret</span>&nbsp;<span class="op" id="4455630">:=</span>&nbsp;<span class="builtinfunc" id="4455633">new</span><span class="op" id="4455636">(</span><span class="ident" id="4455637">big</span><span class="op" id="4455640">.</span><span class="ident" id="4455641">Int</span><span class="op" id="4455644">)</span><span class="op" id="4455645">.</span><span class="ident" id="4455646">SetBytes</span><span class="op" id="4455654">(</span><span class="ident" id="4455655">hash</span><span class="op" id="4455659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455662">excess</span>&nbsp;<span class="op" id="4455669">:=</span>&nbsp;<span class="builtinfunc" id="4455672">len</span><span class="op" id="4455675">(</span><span class="ident" id="4455676">hash</span><span class="op" id="4455680">)</span><span class="op" id="4455681">*</span><span class="num" id="4455682">8</span>&nbsp;<span class="op" id="4455684">-</span>&nbsp;<span class="ident" id="4455686">orderBits</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455697">if</span>&nbsp;<span class="ident" id="4455700">excess</span>&nbsp;<span class="op" id="4455707">&gt;</span>&nbsp;<span class="num" id="4455709">0</span>&nbsp;<span class="op" id="4455711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4455715">ret</span><span class="op" id="4455718">.</span><span class="ident" id="4455719">Rsh</span><span class="op" id="4455722">(</span><span class="ident" id="4455723">ret</span><span class="op" id="4455726">,</span>&nbsp;<span class="builtintype" id="4455728">uint</span><span class="op" id="4455732">(</span><span class="ident" id="4455733">excess</span><span class="op" id="4455739">)</span><span class="op" id="4455740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4455743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4455746">return</span>&nbsp;<span class="ident" id="4455753">ret</span><br>
<span class="lineno"></span><span class="op" id="4455757">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4455760">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4455837">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4455915">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4455986">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">115</span><span class="keyword" id="4456024">func</span>&nbsp;<span class="ident" id="4456029">fermatInverse</span><span class="op" id="4456042">(</span><span class="ident" id="4456043">k</span><span class="op" id="4456044">,</span>&nbsp;<span class="ident" id="4456046">N</span>&nbsp;<span class="op" id="4456048">*</span><span class="ident" id="4456049">big</span><span class="op" id="4456052">.</span><span class="ident" id="4456053">Int</span><span class="op" id="4456056">)</span>&nbsp;<span class="op" id="4456058">*</span><span class="ident" id="4456059">big</span><span class="op" id="4456062">.</span><span class="ident" id="4456063">Int</span>&nbsp;<span class="op" id="4456067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456070">two</span>&nbsp;<span class="op" id="4456074">:=</span>&nbsp;<span class="ident" id="4456077">big</span><span class="op" id="4456080">.</span><span class="ident" id="4456081">NewInt</span><span class="op" id="4456087">(</span><span class="num" id="4456088">2</span><span class="op" id="4456089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456092">nMinus2</span>&nbsp;<span class="op" id="4456100">:=</span>&nbsp;<span class="builtinfunc" id="4456103">new</span><span class="op" id="4456106">(</span><span class="ident" id="4456107">big</span><span class="op" id="4456110">.</span><span class="ident" id="4456111">Int</span><span class="op" id="4456114">)</span><span class="op" id="4456115">.</span><span class="ident" id="4456116">Sub</span><span class="op" id="4456119">(</span><span class="ident" id="4456120">N</span><span class="op" id="4456121">,</span>&nbsp;<span class="ident" id="4456123">two</span><span class="op" id="4456126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456129">return</span>&nbsp;<span class="builtinfunc" id="4456136">new</span><span class="op" id="4456139">(</span><span class="ident" id="4456140">big</span><span class="op" id="4456143">.</span><span class="ident" id="4456144">Int</span><span class="op" id="4456147">)</span><span class="op" id="4456148">.</span><span class="ident" id="4456149">Exp</span><span class="op" id="4456152">(</span><span class="ident" id="4456153">k</span><span class="op" id="4456154">,</span>&nbsp;<span class="ident" id="4456156">nMinus2</span><span class="op" id="4456163">,</span>&nbsp;<span class="ident" id="4456165">N</span><span class="op" id="4456166">)</span><br>
<span class="lineno"></span><span class="op" id="4456168">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="4456171">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4456251">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4456329">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4456408">//&nbsp;rand.</span><br>
<span class="lineno">125</span><span class="keyword" id="4456417">func</span>&nbsp;<span class="ident" id="4456422">Sign</span><span class="op" id="4456426">(</span><span class="ident" id="4456427">rand</span>&nbsp;<span class="ident" id="4456432">io</span><span class="op" id="4456434">.</span><span class="ident" id="4456435">Reader</span><span class="op" id="4456441">,</span>&nbsp;<span class="ident" id="4456443">priv</span>&nbsp;<span class="op" id="4456448">*</span><span class="ident" id="4456449">PrivateKey</span><span class="op" id="4456459">,</span>&nbsp;<span class="ident" id="4456461">hash</span>&nbsp;<span class="op" id="4456466">[</span><span class="op" id="4456467">]</span><span class="builtintype" id="4456468">byte</span><span class="op" id="4456472">)</span>&nbsp;<span class="op" id="4456474">(</span><span class="ident" id="4456475">r</span><span class="op" id="4456476">,</span>&nbsp;<span class="ident" id="4456478">s</span>&nbsp;<span class="op" id="4456480">*</span><span class="ident" id="4456481">big</span><span class="op" id="4456484">.</span><span class="ident" id="4456485">Int</span><span class="op" id="4456488">,</span>&nbsp;<span class="ident" id="4456490">err</span>&nbsp;<span class="builtintype" id="4456494">error</span><span class="op" id="4456499">)</span>&nbsp;<span class="op" id="4456501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4456504">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456524">c</span>&nbsp;<span class="op" id="4456526">:=</span>&nbsp;<span class="ident" id="4456529">priv</span><span class="op" id="4456533">.</span><span class="ident" id="4456534">PublicKey</span><span class="op" id="4456543">.</span><span class="ident" id="4456544">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456551">N</span>&nbsp;<span class="op" id="4456553">:=</span>&nbsp;<span class="ident" id="4456556">c</span><span class="op" id="4456557">.</span><span class="ident" id="4456558">Params</span><span class="op" id="4456564">(</span><span class="op" id="4456565">)</span><span class="op" id="4456566">.</span><span class="ident" id="4456567">N</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456571">var</span>&nbsp;<span class="ident" id="4456575">k</span><span class="op" id="4456576">,</span>&nbsp;<span class="ident" id="4456578">kInv</span>&nbsp;<span class="op" id="4456583">*</span><span class="ident" id="4456584">big</span><span class="op" id="4456587">.</span><span class="ident" id="4456588">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456593">for</span>&nbsp;<span class="op" id="4456597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456601">for</span>&nbsp;<span class="op" id="4456605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456610">k</span><span class="op" id="4456611">,</span>&nbsp;<span class="ident" id="4456613">err</span>&nbsp;<span class="op" id="4456617">=</span>&nbsp;<span class="ident" id="4456619">randFieldElement</span><span class="op" id="4456635">(</span><span class="ident" id="4456636">c</span><span class="op" id="4456637">,</span>&nbsp;<span class="ident" id="4456639">rand</span><span class="op" id="4456643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456648">if</span>&nbsp;<span class="ident" id="4456651">err</span>&nbsp;<span class="op" id="4456655">!=</span>&nbsp;<span class="ident" id="4456658">nil</span>&nbsp;<span class="op" id="4456662">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456668">r</span>&nbsp;<span class="op" id="4456670">=</span>&nbsp;<span class="ident" id="4456672">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456680">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456696">kInv</span>&nbsp;<span class="op" id="4456701">=</span>&nbsp;<span class="ident" id="4456703">fermatInverse</span><span class="op" id="4456716">(</span><span class="ident" id="4456717">k</span><span class="op" id="4456718">,</span>&nbsp;<span class="ident" id="4456720">N</span><span class="op" id="4456721">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456726">r</span><span class="op" id="4456727">,</span>&nbsp;<span class="ident" id="4456729">_</span>&nbsp;<span class="op" id="4456731">=</span>&nbsp;<span class="ident" id="4456733">priv</span><span class="op" id="4456737">.</span><span class="ident" id="4456738">Curve</span><span class="op" id="4456743">.</span><span class="ident" id="4456744">ScalarBaseMult</span><span class="op" id="4456758">(</span><span class="ident" id="4456759">k</span><span class="op" id="4456760">.</span><span class="ident" id="4456761">Bytes</span><span class="op" id="4456766">(</span><span class="op" id="4456767">)</span><span class="op" id="4456768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456773">r</span><span class="op" id="4456774">.</span><span class="ident" id="4456775">Mod</span><span class="op" id="4456778">(</span><span class="ident" id="4456779">r</span><span class="op" id="4456780">,</span>&nbsp;<span class="ident" id="4456782">N</span><span class="op" id="4456783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456788">if</span>&nbsp;<span class="ident" id="4456791">r</span><span class="op" id="4456792">.</span><span class="ident" id="4456793">Sign</span><span class="op" id="4456797">(</span><span class="op" id="4456798">)</span>&nbsp;<span class="op" id="4456800">!=</span>&nbsp;<span class="num" id="4456803">0</span>&nbsp;<span class="op" id="4456805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456811">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456820">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456829">e</span>&nbsp;<span class="op" id="4456831">:=</span>&nbsp;<span class="ident" id="4456834">hashToInt</span><span class="op" id="4456843">(</span><span class="ident" id="4456844">hash</span><span class="op" id="4456848">,</span>&nbsp;<span class="ident" id="4456850">c</span><span class="op" id="4456851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456855">s</span>&nbsp;<span class="op" id="4456857">=</span>&nbsp;<span class="builtinfunc" id="4456859">new</span><span class="op" id="4456862">(</span><span class="ident" id="4456863">big</span><span class="op" id="4456866">.</span><span class="ident" id="4456867">Int</span><span class="op" id="4456870">)</span><span class="op" id="4456871">.</span><span class="ident" id="4456872">Mul</span><span class="op" id="4456875">(</span><span class="ident" id="4456876">priv</span><span class="op" id="4456880">.</span><span class="ident" id="4456881">D</span><span class="op" id="4456882">,</span>&nbsp;<span class="ident" id="4456884">r</span><span class="op" id="4456885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456889">s</span><span class="op" id="4456890">.</span><span class="ident" id="4456891">Add</span><span class="op" id="4456894">(</span><span class="ident" id="4456895">s</span><span class="op" id="4456896">,</span>&nbsp;<span class="ident" id="4456898">e</span><span class="op" id="4456899">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456903">s</span><span class="op" id="4456904">.</span><span class="ident" id="4456905">Mul</span><span class="op" id="4456908">(</span><span class="ident" id="4456909">s</span><span class="op" id="4456910">,</span>&nbsp;<span class="ident" id="4456912">kInv</span><span class="op" id="4456916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4456920">s</span><span class="op" id="4456921">.</span><span class="ident" id="4456922">Mod</span><span class="op" id="4456925">(</span><span class="ident" id="4456926">s</span><span class="op" id="4456927">,</span>&nbsp;<span class="ident" id="4456929">N</span><span class="op" id="4456930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456934">if</span>&nbsp;<span class="ident" id="4456937">s</span><span class="op" id="4456938">.</span><span class="ident" id="4456939">Sign</span><span class="op" id="4456943">(</span><span class="op" id="4456944">)</span>&nbsp;<span class="op" id="4456946">!=</span>&nbsp;<span class="num" id="4456949">0</span>&nbsp;<span class="op" id="4456951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456956">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456964">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4456967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4456971">return</span><br>
<span class="lineno"></span><span class="op" id="4456978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4456981">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;Its</span><br>
<span class="lineno"></span><span class="comment" id="4457061">//&nbsp;return&nbsp;value&nbsp;records&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4457117">func</span>&nbsp;<span class="ident" id="4457122">Verify</span><span class="op" id="4457128">(</span><span class="ident" id="4457129">pub</span>&nbsp;<span class="op" id="4457133">*</span><span class="ident" id="4457134">PublicKey</span><span class="op" id="4457143">,</span>&nbsp;<span class="ident" id="4457145">hash</span>&nbsp;<span class="op" id="4457150">[</span><span class="op" id="4457151">]</span><span class="builtintype" id="4457152">byte</span><span class="op" id="4457156">,</span>&nbsp;<span class="ident" id="4457158">r</span><span class="op" id="4457159">,</span>&nbsp;<span class="ident" id="4457161">s</span>&nbsp;<span class="op" id="4457163">*</span><span class="ident" id="4457164">big</span><span class="op" id="4457167">.</span><span class="ident" id="4457168">Int</span><span class="op" id="4457171">)</span>&nbsp;<span class="builtintype" id="4457173">bool</span>&nbsp;<span class="op" id="4457178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4457181">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457201">c</span>&nbsp;<span class="op" id="4457203">:=</span>&nbsp;<span class="ident" id="4457206">pub</span><span class="op" id="4457209">.</span><span class="ident" id="4457210">Curve</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457217">N</span>&nbsp;<span class="op" id="4457219">:=</span>&nbsp;<span class="ident" id="4457222">c</span><span class="op" id="4457223">.</span><span class="ident" id="4457224">Params</span><span class="op" id="4457230">(</span><span class="op" id="4457231">)</span><span class="op" id="4457232">.</span><span class="ident" id="4457233">N</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457237">if</span>&nbsp;<span class="ident" id="4457240">r</span><span class="op" id="4457241">.</span><span class="ident" id="4457242">Sign</span><span class="op" id="4457246">(</span><span class="op" id="4457247">)</span>&nbsp;<span class="op" id="4457249">==</span>&nbsp;<span class="num" id="4457252">0</span>&nbsp;<span class="op" id="4457254">||</span>&nbsp;<span class="ident" id="4457257">s</span><span class="op" id="4457258">.</span><span class="ident" id="4457259">Sign</span><span class="op" id="4457263">(</span><span class="op" id="4457264">)</span>&nbsp;<span class="op" id="4457266">==</span>&nbsp;<span class="num" id="4457269">0</span>&nbsp;<span class="op" id="4457271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457275">return</span>&nbsp;<span class="builtintype" id="4457282">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4457289">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457292">if</span>&nbsp;<span class="ident" id="4457295">r</span><span class="op" id="4457296">.</span><span class="ident" id="4457297">Cmp</span><span class="op" id="4457300">(</span><span class="ident" id="4457301">N</span><span class="op" id="4457302">)</span>&nbsp;<span class="op" id="4457304">&gt;=</span>&nbsp;<span class="num" id="4457307">0</span>&nbsp;<span class="op" id="4457309">||</span>&nbsp;<span class="ident" id="4457312">s</span><span class="op" id="4457313">.</span><span class="ident" id="4457314">Cmp</span><span class="op" id="4457317">(</span><span class="ident" id="4457318">N</span><span class="op" id="4457319">)</span>&nbsp;<span class="op" id="4457321">&gt;=</span>&nbsp;<span class="num" id="4457324">0</span>&nbsp;<span class="op" id="4457326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457330">return</span>&nbsp;<span class="builtintype" id="4457337">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4457344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457347">e</span>&nbsp;<span class="op" id="4457349">:=</span>&nbsp;<span class="ident" id="4457352">hashToInt</span><span class="op" id="4457361">(</span><span class="ident" id="4457362">hash</span><span class="op" id="4457366">,</span>&nbsp;<span class="ident" id="4457368">c</span><span class="op" id="4457369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457372">w</span>&nbsp;<span class="op" id="4457374">:=</span>&nbsp;<span class="builtinfunc" id="4457377">new</span><span class="op" id="4457380">(</span><span class="ident" id="4457381">big</span><span class="op" id="4457384">.</span><span class="ident" id="4457385">Int</span><span class="op" id="4457388">)</span><span class="op" id="4457389">.</span><span class="ident" id="4457390">ModInverse</span><span class="op" id="4457400">(</span><span class="ident" id="4457401">s</span><span class="op" id="4457402">,</span>&nbsp;<span class="ident" id="4457404">N</span><span class="op" id="4457405">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457409">u1</span>&nbsp;<span class="op" id="4457412">:=</span>&nbsp;<span class="ident" id="4457415">e</span><span class="op" id="4457416">.</span><span class="ident" id="4457417">Mul</span><span class="op" id="4457420">(</span><span class="ident" id="4457421">e</span><span class="op" id="4457422">,</span>&nbsp;<span class="ident" id="4457424">w</span><span class="op" id="4457425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457428">u1</span><span class="op" id="4457430">.</span><span class="ident" id="4457431">Mod</span><span class="op" id="4457434">(</span><span class="ident" id="4457435">u1</span><span class="op" id="4457437">,</span>&nbsp;<span class="ident" id="4457439">N</span><span class="op" id="4457440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457443">u2</span>&nbsp;<span class="op" id="4457446">:=</span>&nbsp;<span class="ident" id="4457449">w</span><span class="op" id="4457450">.</span><span class="ident" id="4457451">Mul</span><span class="op" id="4457454">(</span><span class="ident" id="4457455">r</span><span class="op" id="4457456">,</span>&nbsp;<span class="ident" id="4457458">w</span><span class="op" id="4457459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457462">u2</span><span class="op" id="4457464">.</span><span class="ident" id="4457465">Mod</span><span class="op" id="4457468">(</span><span class="ident" id="4457469">u2</span><span class="op" id="4457471">,</span>&nbsp;<span class="ident" id="4457473">N</span><span class="op" id="4457474">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457478">x1</span><span class="op" id="4457480">,</span>&nbsp;<span class="ident" id="4457482">y1</span>&nbsp;<span class="op" id="4457485">:=</span>&nbsp;<span class="ident" id="4457488">c</span><span class="op" id="4457489">.</span><span class="ident" id="4457490">ScalarBaseMult</span><span class="op" id="4457504">(</span><span class="ident" id="4457505">u1</span><span class="op" id="4457507">.</span><span class="ident" id="4457508">Bytes</span><span class="op" id="4457513">(</span><span class="op" id="4457514">)</span><span class="op" id="4457515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457518">x2</span><span class="op" id="4457520">,</span>&nbsp;<span class="ident" id="4457522">y2</span>&nbsp;<span class="op" id="4457525">:=</span>&nbsp;<span class="ident" id="4457528">c</span><span class="op" id="4457529">.</span><span class="ident" id="4457530">ScalarMult</span><span class="op" id="4457540">(</span><span class="ident" id="4457541">pub</span><span class="op" id="4457544">.</span><span class="ident" id="4457545">X</span><span class="op" id="4457546">,</span>&nbsp;<span class="ident" id="4457548">pub</span><span class="op" id="4457551">.</span><span class="ident" id="4457552">Y</span><span class="op" id="4457553">,</span>&nbsp;<span class="ident" id="4457555">u2</span><span class="op" id="4457557">.</span><span class="ident" id="4457558">Bytes</span><span class="op" id="4457563">(</span><span class="op" id="4457564">)</span><span class="op" id="4457565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457568">x</span><span class="op" id="4457569">,</span>&nbsp;<span class="ident" id="4457571">y</span>&nbsp;<span class="op" id="4457573">:=</span>&nbsp;<span class="ident" id="4457576">c</span><span class="op" id="4457577">.</span><span class="ident" id="4457578">Add</span><span class="op" id="4457581">(</span><span class="ident" id="4457582">x1</span><span class="op" id="4457584">,</span>&nbsp;<span class="ident" id="4457586">y1</span><span class="op" id="4457588">,</span>&nbsp;<span class="ident" id="4457590">x2</span><span class="op" id="4457592">,</span>&nbsp;<span class="ident" id="4457594">y2</span><span class="op" id="4457596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457599">if</span>&nbsp;<span class="ident" id="4457602">x</span><span class="op" id="4457603">.</span><span class="ident" id="4457604">Sign</span><span class="op" id="4457608">(</span><span class="op" id="4457609">)</span>&nbsp;<span class="op" id="4457611">==</span>&nbsp;<span class="num" id="4457614">0</span>&nbsp;<span class="op" id="4457616">&amp;&amp;</span>&nbsp;<span class="ident" id="4457619">y</span><span class="op" id="4457620">.</span><span class="ident" id="4457621">Sign</span><span class="op" id="4457625">(</span><span class="op" id="4457626">)</span>&nbsp;<span class="op" id="4457628">==</span>&nbsp;<span class="num" id="4457631">0</span>&nbsp;<span class="op" id="4457633">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457637">return</span>&nbsp;<span class="builtintype" id="4457644">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4457651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4457654">x</span><span class="op" id="4457655">.</span><span class="ident" id="4457656">Mod</span><span class="op" id="4457659">(</span><span class="ident" id="4457660">x</span><span class="op" id="4457661">,</span>&nbsp;<span class="ident" id="4457663">N</span><span class="op" id="4457664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4457667">return</span>&nbsp;<span class="ident" id="4457674">x</span><span class="op" id="4457675">.</span><span class="ident" id="4457676">Cmp</span><span class="op" id="4457679">(</span><span class="ident" id="4457680">r</span><span class="op" id="4457681">)</span>&nbsp;<span class="op" id="4457683">==</span>&nbsp;<span class="num" id="4457686">0</span><br>
<span class="lineno"></span><span class="op" id="4457688">}</span>
</div>
</body>
</html>
