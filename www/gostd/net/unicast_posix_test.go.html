<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7926514">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7926570">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7926624">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7926675">//&nbsp;+build&nbsp;!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7926693">package</span>&nbsp;<span class="ident" id="7926701">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7926706">import</span>&nbsp;<span class="op" id="7926713">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7926716">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7926727">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7926738">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7926748">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7926751">var</span>&nbsp;<span class="ident" id="7926755">listenerTests</span>&nbsp;<span class="op" id="7926769">=</span>&nbsp;<span class="op" id="7926771">[</span><span class="op" id="7926772">]</span><span class="keyword" id="7926773">struct</span>&nbsp;<span class="op" id="7926780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926783">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7926792">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926800">laddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7926809">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926817">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7926826">bool</span>&nbsp;<span class="comment" id="7926831">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7926872">wildcard</span>&nbsp;<span class="builtintype" id="7926881">bool</span>&nbsp;<span class="comment" id="7926886">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">20</span><span class="op" id="7926916">}</span><span class="op" id="7926917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7926920">{</span><span class="ident" id="7926921">net</span><span class="op" id="7926924">:</span>&nbsp;<span class="string" id="7926926">&#34;tcp&#34;</span><span class="op" id="7926931">,</span>&nbsp;<span class="ident" id="7926933">laddr</span><span class="op" id="7926938">:</span>&nbsp;<span class="string" id="7926940">&#34;&#34;</span><span class="op" id="7926942">,</span>&nbsp;<span class="ident" id="7926944">wildcard</span><span class="op" id="7926952">:</span>&nbsp;<span class="builtintype" id="7926954">true</span><span class="op" id="7926958">}</span><span class="op" id="7926959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7926962">{</span><span class="ident" id="7926963">net</span><span class="op" id="7926966">:</span>&nbsp;<span class="string" id="7926968">&#34;tcp&#34;</span><span class="op" id="7926973">,</span>&nbsp;<span class="ident" id="7926975">laddr</span><span class="op" id="7926980">:</span>&nbsp;<span class="string" id="7926982">&#34;0.0.0.0&#34;</span><span class="op" id="7926991">,</span>&nbsp;<span class="ident" id="7926993">wildcard</span><span class="op" id="7927001">:</span>&nbsp;<span class="builtintype" id="7927003">true</span><span class="op" id="7927007">}</span><span class="op" id="7927008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927011">{</span><span class="ident" id="7927012">net</span><span class="op" id="7927015">:</span>&nbsp;<span class="string" id="7927017">&#34;tcp&#34;</span><span class="op" id="7927022">,</span>&nbsp;<span class="ident" id="7927024">laddr</span><span class="op" id="7927029">:</span>&nbsp;<span class="string" id="7927031">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7927049">,</span>&nbsp;<span class="ident" id="7927051">wildcard</span><span class="op" id="7927059">:</span>&nbsp;<span class="builtintype" id="7927061">true</span><span class="op" id="7927065">}</span><span class="op" id="7927066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927069">{</span><span class="ident" id="7927070">net</span><span class="op" id="7927073">:</span>&nbsp;<span class="string" id="7927075">&#34;tcp&#34;</span><span class="op" id="7927080">,</span>&nbsp;<span class="ident" id="7927082">laddr</span><span class="op" id="7927087">:</span>&nbsp;<span class="string" id="7927089">&#34;[::]&#34;</span><span class="op" id="7927095">,</span>&nbsp;<span class="ident" id="7927097">ipv6</span><span class="op" id="7927101">:</span>&nbsp;<span class="builtintype" id="7927103">true</span><span class="op" id="7927107">,</span>&nbsp;<span class="ident" id="7927109">wildcard</span><span class="op" id="7927117">:</span>&nbsp;<span class="builtintype" id="7927119">true</span><span class="op" id="7927123">}</span><span class="op" id="7927124">,</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927128">{</span><span class="ident" id="7927129">net</span><span class="op" id="7927132">:</span>&nbsp;<span class="string" id="7927134">&#34;tcp&#34;</span><span class="op" id="7927139">,</span>&nbsp;<span class="ident" id="7927141">laddr</span><span class="op" id="7927146">:</span>&nbsp;<span class="string" id="7927148">&#34;127.0.0.1&#34;</span><span class="op" id="7927159">}</span><span class="op" id="7927160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927163">{</span><span class="ident" id="7927164">net</span><span class="op" id="7927167">:</span>&nbsp;<span class="string" id="7927169">&#34;tcp&#34;</span><span class="op" id="7927174">,</span>&nbsp;<span class="ident" id="7927176">laddr</span><span class="op" id="7927181">:</span>&nbsp;<span class="string" id="7927183">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7927203">}</span><span class="op" id="7927204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927207">{</span><span class="ident" id="7927208">net</span><span class="op" id="7927211">:</span>&nbsp;<span class="string" id="7927213">&#34;tcp&#34;</span><span class="op" id="7927218">,</span>&nbsp;<span class="ident" id="7927220">laddr</span><span class="op" id="7927225">:</span>&nbsp;<span class="string" id="7927227">&#34;[::1]&#34;</span><span class="op" id="7927234">,</span>&nbsp;<span class="ident" id="7927236">ipv6</span><span class="op" id="7927240">:</span>&nbsp;<span class="builtintype" id="7927242">true</span><span class="op" id="7927246">}</span><span class="op" id="7927247">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927251">{</span><span class="ident" id="7927252">net</span><span class="op" id="7927255">:</span>&nbsp;<span class="string" id="7927257">&#34;tcp4&#34;</span><span class="op" id="7927263">,</span>&nbsp;<span class="ident" id="7927265">laddr</span><span class="op" id="7927270">:</span>&nbsp;<span class="string" id="7927272">&#34;&#34;</span><span class="op" id="7927274">,</span>&nbsp;<span class="ident" id="7927276">wildcard</span><span class="op" id="7927284">:</span>&nbsp;<span class="builtintype" id="7927286">true</span><span class="op" id="7927290">}</span><span class="op" id="7927291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927294">{</span><span class="ident" id="7927295">net</span><span class="op" id="7927298">:</span>&nbsp;<span class="string" id="7927300">&#34;tcp4&#34;</span><span class="op" id="7927306">,</span>&nbsp;<span class="ident" id="7927308">laddr</span><span class="op" id="7927313">:</span>&nbsp;<span class="string" id="7927315">&#34;0.0.0.0&#34;</span><span class="op" id="7927324">,</span>&nbsp;<span class="ident" id="7927326">wildcard</span><span class="op" id="7927334">:</span>&nbsp;<span class="builtintype" id="7927336">true</span><span class="op" id="7927340">}</span><span class="op" id="7927341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927344">{</span><span class="ident" id="7927345">net</span><span class="op" id="7927348">:</span>&nbsp;<span class="string" id="7927350">&#34;tcp4&#34;</span><span class="op" id="7927356">,</span>&nbsp;<span class="ident" id="7927358">laddr</span><span class="op" id="7927363">:</span>&nbsp;<span class="string" id="7927365">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7927383">,</span>&nbsp;<span class="ident" id="7927385">wildcard</span><span class="op" id="7927393">:</span>&nbsp;<span class="builtintype" id="7927395">true</span><span class="op" id="7927399">}</span><span class="op" id="7927400">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927404">{</span><span class="ident" id="7927405">net</span><span class="op" id="7927408">:</span>&nbsp;<span class="string" id="7927410">&#34;tcp4&#34;</span><span class="op" id="7927416">,</span>&nbsp;<span class="ident" id="7927418">laddr</span><span class="op" id="7927423">:</span>&nbsp;<span class="string" id="7927425">&#34;127.0.0.1&#34;</span><span class="op" id="7927436">}</span><span class="op" id="7927437">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927440">{</span><span class="ident" id="7927441">net</span><span class="op" id="7927444">:</span>&nbsp;<span class="string" id="7927446">&#34;tcp4&#34;</span><span class="op" id="7927452">,</span>&nbsp;<span class="ident" id="7927454">laddr</span><span class="op" id="7927459">:</span>&nbsp;<span class="string" id="7927461">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7927481">}</span><span class="op" id="7927482">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927486">{</span><span class="ident" id="7927487">net</span><span class="op" id="7927490">:</span>&nbsp;<span class="string" id="7927492">&#34;tcp6&#34;</span><span class="op" id="7927498">,</span>&nbsp;<span class="ident" id="7927500">laddr</span><span class="op" id="7927505">:</span>&nbsp;<span class="string" id="7927507">&#34;&#34;</span><span class="op" id="7927509">,</span>&nbsp;<span class="ident" id="7927511">ipv6</span><span class="op" id="7927515">:</span>&nbsp;<span class="builtintype" id="7927517">true</span><span class="op" id="7927521">,</span>&nbsp;<span class="ident" id="7927523">wildcard</span><span class="op" id="7927531">:</span>&nbsp;<span class="builtintype" id="7927533">true</span><span class="op" id="7927537">}</span><span class="op" id="7927538">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927541">{</span><span class="ident" id="7927542">net</span><span class="op" id="7927545">:</span>&nbsp;<span class="string" id="7927547">&#34;tcp6&#34;</span><span class="op" id="7927553">,</span>&nbsp;<span class="ident" id="7927555">laddr</span><span class="op" id="7927560">:</span>&nbsp;<span class="string" id="7927562">&#34;[::]&#34;</span><span class="op" id="7927568">,</span>&nbsp;<span class="ident" id="7927570">ipv6</span><span class="op" id="7927574">:</span>&nbsp;<span class="builtintype" id="7927576">true</span><span class="op" id="7927580">,</span>&nbsp;<span class="ident" id="7927582">wildcard</span><span class="op" id="7927590">:</span>&nbsp;<span class="builtintype" id="7927592">true</span><span class="op" id="7927596">}</span><span class="op" id="7927597">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927601">{</span><span class="ident" id="7927602">net</span><span class="op" id="7927605">:</span>&nbsp;<span class="string" id="7927607">&#34;tcp6&#34;</span><span class="op" id="7927613">,</span>&nbsp;<span class="ident" id="7927615">laddr</span><span class="op" id="7927620">:</span>&nbsp;<span class="string" id="7927622">&#34;[::1]&#34;</span><span class="op" id="7927629">,</span>&nbsp;<span class="ident" id="7927631">ipv6</span><span class="op" id="7927635">:</span>&nbsp;<span class="builtintype" id="7927637">true</span><span class="op" id="7927641">}</span><span class="op" id="7927642">,</span><br>
<span class="lineno"></span><span class="op" id="7927644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7927647">//&nbsp;TestTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="7927712">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno">45</span><span class="comment" id="7927777">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="7927791">func</span>&nbsp;<span class="ident" id="7927796">TestTCPListener</span><span class="op" id="7927811">(</span><span class="ident" id="7927812">t</span>&nbsp;<span class="op" id="7927814">*</span><span class="ident" id="7927815">testing</span><span class="op" id="7927822">.</span><span class="ident" id="7927823">T</span><span class="op" id="7927824">)</span>&nbsp;<span class="op" id="7927826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7927829">switch</span>&nbsp;<span class="ident" id="7927836">runtime</span><span class="op" id="7927843">.</span><span class="ident" id="7927844">GOOS</span>&nbsp;<span class="op" id="7927849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7927852">case</span>&nbsp;<span class="string" id="7927857">&#34;plan9&#34;</span><span class="op" id="7927864">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7927868">t</span><span class="op" id="7927869">.</span><span class="ident" id="7927870">Skipf</span><span class="op" id="7927875">(</span><span class="string" id="7927876">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7927897">,</span>&nbsp;<span class="ident" id="7927899">runtime</span><span class="op" id="7927906">.</span><span class="ident" id="7927907">GOOS</span><span class="op" id="7927911">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7927914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7927918">for</span>&nbsp;<span class="ident" id="7927922">_</span><span class="op" id="7927923">,</span>&nbsp;<span class="ident" id="7927925">tt</span>&nbsp;<span class="op" id="7927928">:=</span>&nbsp;<span class="keyword" id="7927931">range</span>&nbsp;<span class="ident" id="7927937">listenerTests</span>&nbsp;<span class="op" id="7927951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7927955">if</span>&nbsp;<span class="ident" id="7927958">tt</span><span class="op" id="7927960">.</span><span class="ident" id="7927961">wildcard</span>&nbsp;<span class="op" id="7927970">&amp;&amp;</span>&nbsp;<span class="op" id="7927973">(</span><span class="ident" id="7927974">testing</span><span class="op" id="7927981">.</span><span class="ident" id="7927982">Short</span><span class="op" id="7927987">(</span><span class="op" id="7927988">)</span>&nbsp;<span class="op" id="7927990">||</span>&nbsp;<span class="op" id="7927993">!</span><span class="op" id="7927994">*</span><span class="ident" id="7927995">testExternal</span><span class="op" id="7928007">)</span>&nbsp;<span class="op" id="7928009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928014">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928029">if</span>&nbsp;<span class="ident" id="7928032">tt</span><span class="op" id="7928034">.</span><span class="ident" id="7928035">ipv6</span>&nbsp;<span class="op" id="7928040">&amp;&amp;</span>&nbsp;<span class="op" id="7928043">!</span><span class="ident" id="7928044">supportsIPv6</span>&nbsp;<span class="op" id="7928057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928062">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928077">l1</span><span class="op" id="7928079">,</span>&nbsp;<span class="ident" id="7928081">port</span>&nbsp;<span class="op" id="7928086">:=</span>&nbsp;<span class="ident" id="7928089">usableListenPort</span><span class="op" id="7928105">(</span><span class="ident" id="7928106">t</span><span class="op" id="7928107">,</span>&nbsp;<span class="ident" id="7928109">tt</span><span class="op" id="7928111">.</span><span class="ident" id="7928112">net</span><span class="op" id="7928115">,</span>&nbsp;<span class="ident" id="7928117">tt</span><span class="op" id="7928119">.</span><span class="ident" id="7928120">laddr</span><span class="op" id="7928125">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928129">checkFirstListener</span><span class="op" id="7928147">(</span><span class="ident" id="7928148">t</span><span class="op" id="7928149">,</span>&nbsp;<span class="ident" id="7928151">tt</span><span class="op" id="7928153">.</span><span class="ident" id="7928154">net</span><span class="op" id="7928157">,</span>&nbsp;<span class="ident" id="7928159">tt</span><span class="op" id="7928161">.</span><span class="ident" id="7928162">laddr</span><span class="op" id="7928167">+</span><span class="string" id="7928168">&#34;:&#34;</span><span class="op" id="7928171">+</span><span class="ident" id="7928172">port</span><span class="op" id="7928176">,</span>&nbsp;<span class="ident" id="7928178">l1</span><span class="op" id="7928180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928184">l2</span><span class="op" id="7928186">,</span>&nbsp;<span class="ident" id="7928188">err</span>&nbsp;<span class="op" id="7928192">:=</span>&nbsp;<span class="ident" id="7928195">Listen</span><span class="op" id="7928201">(</span><span class="ident" id="7928202">tt</span><span class="op" id="7928204">.</span><span class="ident" id="7928205">net</span><span class="op" id="7928208">,</span>&nbsp;<span class="ident" id="7928210">tt</span><span class="op" id="7928212">.</span><span class="ident" id="7928213">laddr</span><span class="op" id="7928218">+</span><span class="string" id="7928219">&#34;:&#34;</span><span class="op" id="7928222">+</span><span class="ident" id="7928223">port</span><span class="op" id="7928227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928231">checkSecondListener</span><span class="op" id="7928250">(</span><span class="ident" id="7928251">t</span><span class="op" id="7928252">,</span>&nbsp;<span class="ident" id="7928254">tt</span><span class="op" id="7928256">.</span><span class="ident" id="7928257">net</span><span class="op" id="7928260">,</span>&nbsp;<span class="ident" id="7928262">tt</span><span class="op" id="7928264">.</span><span class="ident" id="7928265">laddr</span><span class="op" id="7928270">+</span><span class="string" id="7928271">&#34;:&#34;</span><span class="op" id="7928274">+</span><span class="ident" id="7928275">port</span><span class="op" id="7928279">,</span>&nbsp;<span class="ident" id="7928281">err</span><span class="op" id="7928284">,</span>&nbsp;<span class="ident" id="7928286">l2</span><span class="op" id="7928288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928292">l1</span><span class="op" id="7928294">.</span><span class="ident" id="7928295">Close</span><span class="op" id="7928300">(</span><span class="op" id="7928301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928304">}</span><br>
<span class="lineno">65</span><span class="op" id="7928306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7928309">//&nbsp;TestUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen&nbsp;to&nbsp;a&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="7928374">//&nbsp;listener&nbsp;with&nbsp;same&nbsp;address&nbsp;family,&nbsp;same&nbsp;listening&nbsp;address&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="7928439">//&nbsp;same&nbsp;port.</span><br>
<span class="lineno">70</span><span class="keyword" id="7928453">func</span>&nbsp;<span class="ident" id="7928458">TestUDPListener</span><span class="op" id="7928473">(</span><span class="ident" id="7928474">t</span>&nbsp;<span class="op" id="7928476">*</span><span class="ident" id="7928477">testing</span><span class="op" id="7928484">.</span><span class="ident" id="7928485">T</span><span class="op" id="7928486">)</span>&nbsp;<span class="op" id="7928488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928491">switch</span>&nbsp;<span class="ident" id="7928498">runtime</span><span class="op" id="7928505">.</span><span class="ident" id="7928506">GOOS</span>&nbsp;<span class="op" id="7928511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928514">case</span>&nbsp;<span class="string" id="7928519">&#34;plan9&#34;</span><span class="op" id="7928526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928530">t</span><span class="op" id="7928531">.</span><span class="ident" id="7928532">Skipf</span><span class="op" id="7928537">(</span><span class="string" id="7928538">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7928559">,</span>&nbsp;<span class="ident" id="7928561">runtime</span><span class="op" id="7928568">.</span><span class="ident" id="7928569">GOOS</span><span class="op" id="7928573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928576">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928580">toudpnet</span>&nbsp;<span class="op" id="7928589">:=</span>&nbsp;<span class="keyword" id="7928592">func</span><span class="op" id="7928596">(</span><span class="ident" id="7928597">net</span>&nbsp;<span class="builtintype" id="7928601">string</span><span class="op" id="7928607">)</span>&nbsp;<span class="builtintype" id="7928609">string</span>&nbsp;<span class="op" id="7928616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928620">switch</span>&nbsp;<span class="ident" id="7928627">net</span>&nbsp;<span class="op" id="7928631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928635">case</span>&nbsp;<span class="string" id="7928640">&#34;tcp&#34;</span><span class="op" id="7928645">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928650">return</span>&nbsp;<span class="string" id="7928657">&#34;udp&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928665">case</span>&nbsp;<span class="string" id="7928670">&#34;tcp4&#34;</span><span class="op" id="7928676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928681">return</span>&nbsp;<span class="string" id="7928688">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928697">case</span>&nbsp;<span class="string" id="7928702">&#34;tcp6&#34;</span><span class="op" id="7928708">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928713">return</span>&nbsp;<span class="string" id="7928720">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928729">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928733">return</span>&nbsp;<span class="string" id="7928740">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928753">for</span>&nbsp;<span class="ident" id="7928757">_</span><span class="op" id="7928758">,</span>&nbsp;<span class="ident" id="7928760">tt</span>&nbsp;<span class="op" id="7928763">:=</span>&nbsp;<span class="keyword" id="7928766">range</span>&nbsp;<span class="ident" id="7928772">listenerTests</span>&nbsp;<span class="op" id="7928786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928790">if</span>&nbsp;<span class="ident" id="7928793">tt</span><span class="op" id="7928795">.</span><span class="ident" id="7928796">wildcard</span>&nbsp;<span class="op" id="7928805">&amp;&amp;</span>&nbsp;<span class="op" id="7928808">(</span><span class="ident" id="7928809">testing</span><span class="op" id="7928816">.</span><span class="ident" id="7928817">Short</span><span class="op" id="7928822">(</span><span class="op" id="7928823">)</span>&nbsp;<span class="op" id="7928825">||</span>&nbsp;<span class="op" id="7928828">!</span><span class="op" id="7928829">*</span><span class="ident" id="7928830">testExternal</span><span class="op" id="7928842">)</span>&nbsp;<span class="op" id="7928844">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928849">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928864">if</span>&nbsp;<span class="ident" id="7928867">tt</span><span class="op" id="7928869">.</span><span class="ident" id="7928870">ipv6</span>&nbsp;<span class="op" id="7928875">&amp;&amp;</span>&nbsp;<span class="op" id="7928878">!</span><span class="ident" id="7928879">supportsIPv6</span>&nbsp;<span class="op" id="7928892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7928897">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7928908">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928912">tt</span><span class="op" id="7928914">.</span><span class="ident" id="7928915">net</span>&nbsp;<span class="op" id="7928919">=</span>&nbsp;<span class="ident" id="7928921">toudpnet</span><span class="op" id="7928929">(</span><span class="ident" id="7928930">tt</span><span class="op" id="7928932">.</span><span class="ident" id="7928933">net</span><span class="op" id="7928936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928940">l1</span><span class="op" id="7928942">,</span>&nbsp;<span class="ident" id="7928944">port</span>&nbsp;<span class="op" id="7928949">:=</span>&nbsp;<span class="ident" id="7928952">usableListenPacketPort</span><span class="op" id="7928974">(</span><span class="ident" id="7928975">t</span><span class="op" id="7928976">,</span>&nbsp;<span class="ident" id="7928978">tt</span><span class="op" id="7928980">.</span><span class="ident" id="7928981">net</span><span class="op" id="7928984">,</span>&nbsp;<span class="ident" id="7928986">tt</span><span class="op" id="7928988">.</span><span class="ident" id="7928989">laddr</span><span class="op" id="7928994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7928998">checkFirstListener</span><span class="op" id="7929016">(</span><span class="ident" id="7929017">t</span><span class="op" id="7929018">,</span>&nbsp;<span class="ident" id="7929020">tt</span><span class="op" id="7929022">.</span><span class="ident" id="7929023">net</span><span class="op" id="7929026">,</span>&nbsp;<span class="ident" id="7929028">tt</span><span class="op" id="7929030">.</span><span class="ident" id="7929031">laddr</span><span class="op" id="7929036">+</span><span class="string" id="7929037">&#34;:&#34;</span><span class="op" id="7929040">+</span><span class="ident" id="7929041">port</span><span class="op" id="7929045">,</span>&nbsp;<span class="ident" id="7929047">l1</span><span class="op" id="7929049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929053">l2</span><span class="op" id="7929055">,</span>&nbsp;<span class="ident" id="7929057">err</span>&nbsp;<span class="op" id="7929061">:=</span>&nbsp;<span class="ident" id="7929064">ListenPacket</span><span class="op" id="7929076">(</span><span class="ident" id="7929077">tt</span><span class="op" id="7929079">.</span><span class="ident" id="7929080">net</span><span class="op" id="7929083">,</span>&nbsp;<span class="ident" id="7929085">tt</span><span class="op" id="7929087">.</span><span class="ident" id="7929088">laddr</span><span class="op" id="7929093">+</span><span class="string" id="7929094">&#34;:&#34;</span><span class="op" id="7929097">+</span><span class="ident" id="7929098">port</span><span class="op" id="7929102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929106">checkSecondListener</span><span class="op" id="7929125">(</span><span class="ident" id="7929126">t</span><span class="op" id="7929127">,</span>&nbsp;<span class="ident" id="7929129">tt</span><span class="op" id="7929131">.</span><span class="ident" id="7929132">net</span><span class="op" id="7929135">,</span>&nbsp;<span class="ident" id="7929137">tt</span><span class="op" id="7929139">.</span><span class="ident" id="7929140">laddr</span><span class="op" id="7929145">+</span><span class="string" id="7929146">&#34;:&#34;</span><span class="op" id="7929149">+</span><span class="ident" id="7929150">port</span><span class="op" id="7929154">,</span>&nbsp;<span class="ident" id="7929156">err</span><span class="op" id="7929159">,</span>&nbsp;<span class="ident" id="7929161">l2</span><span class="op" id="7929163">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929167">l1</span><span class="op" id="7929169">.</span><span class="ident" id="7929170">Close</span><span class="op" id="7929175">(</span><span class="op" id="7929176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7929179">}</span><br>
<span class="lineno"></span><span class="op" id="7929181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7929184">var</span>&nbsp;<span class="ident" id="7929188">dualStackListenerTests</span>&nbsp;<span class="op" id="7929211">=</span>&nbsp;<span class="op" id="7929213">[</span><span class="op" id="7929214">]</span><span class="keyword" id="7929215">struct</span>&nbsp;<span class="op" id="7929222">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929225">net1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7929234">string</span>&nbsp;<span class="comment" id="7929241">//&nbsp;first&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929260">laddr1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7929269">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929277">net2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7929286">string</span>&nbsp;<span class="comment" id="7929293">//&nbsp;second&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929313">laddr2</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7929322">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929330">wildcard</span>&nbsp;<span class="builtintype" id="7929339">bool</span>&nbsp;&nbsp;<span class="comment" id="7929345">//&nbsp;test&nbsp;with&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7929376">xerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7929385">error</span>&nbsp;<span class="comment" id="7929391">//&nbsp;expected&nbsp;error&nbsp;value,&nbsp;nil&nbsp;or&nbsp;other</span><br>
<span class="lineno"></span><span class="op" id="7929429">}</span><span class="op" id="7929430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7929433">//&nbsp;Test&nbsp;cases&nbsp;and&nbsp;expected&nbsp;results&nbsp;for&nbsp;the&nbsp;attemping&nbsp;2nd&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7929515">//&nbsp;1st&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2nd&nbsp;listen&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;darwin&nbsp;&nbsp;freebsd&nbsp;&nbsp;linux&nbsp;&nbsp;openbsd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7929604">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7929693">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7929779">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7929865">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7929951">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7930040">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7930127">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7930214">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7930301">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7930388">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7930475">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::ffff:0.0.0.0]&#34;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7930562">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7930651">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7930738">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7930825">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7930912">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;0.0.0.0&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7930999">//&nbsp;------------------------------------------------------------------------------------</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931088">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931175">//&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp&#34;&nbsp;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931262">//&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931349">//&nbsp;&#34;tcp6&#34;&nbsp;&#34;[::1]&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;tcp4&#34;&nbsp;&#34;127.0.0.1&#34;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931436">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931440">//&nbsp;Platform&nbsp;default&nbsp;configurations:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931477">//&nbsp;darwin,&nbsp;kernel&nbsp;version&nbsp;11.3.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931511">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931584">//&nbsp;freebsd,&nbsp;kernel&nbsp;version&nbsp;8.2</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931616">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931689">//&nbsp;linux,&nbsp;kernel&nbsp;version&nbsp;3.0.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931721">//&nbsp;&nbsp;&nbsp;&nbspnet.ipv6.bindv6only=0&nbsp;(overridable&nbsp;by&nbsp;sysctl&nbsp;or&nbsp;IPV6_V6ONLY&nbsp;option)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931793">//&nbsp;openbsd,&nbsp;kernel&nbsp;version&nbsp;5.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7931825">//&nbsp;&nbsp;&nbsp;&nbspnet.inet6.ip6.v6only=1&nbsp;(overriding&nbsp;is&nbsp;prohibited)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7931880">{</span><span class="ident" id="7931881">net1</span><span class="op" id="7931885">:</span>&nbsp;<span class="string" id="7931887">&#34;tcp&#34;</span><span class="op" id="7931892">,</span>&nbsp;<span class="ident" id="7931894">laddr1</span><span class="op" id="7931900">:</span>&nbsp;<span class="string" id="7931902">&#34;&#34;</span><span class="op" id="7931904">,</span>&nbsp;<span class="ident" id="7931906">net2</span><span class="op" id="7931910">:</span>&nbsp;<span class="string" id="7931912">&#34;tcp&#34;</span><span class="op" id="7931917">,</span>&nbsp;<span class="ident" id="7931919">laddr2</span><span class="op" id="7931925">:</span>&nbsp;<span class="string" id="7931927">&#34;&#34;</span><span class="op" id="7931929">,</span>&nbsp;<span class="ident" id="7931931">wildcard</span><span class="op" id="7931939">:</span>&nbsp;<span class="builtintype" id="7931941">true</span><span class="op" id="7931945">,</span>&nbsp;<span class="ident" id="7931947">xerr</span><span class="op" id="7931951">:</span>&nbsp;<span class="ident" id="7931953">syscall</span><span class="op" id="7931960">.</span><span class="ident" id="7931961">EADDRINUSE</span><span class="op" id="7931971">}</span><span class="op" id="7931972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7931975">{</span><span class="ident" id="7931976">net1</span><span class="op" id="7931980">:</span>&nbsp;<span class="string" id="7931982">&#34;tcp&#34;</span><span class="op" id="7931987">,</span>&nbsp;<span class="ident" id="7931989">laddr1</span><span class="op" id="7931995">:</span>&nbsp;<span class="string" id="7931997">&#34;&#34;</span><span class="op" id="7931999">,</span>&nbsp;<span class="ident" id="7932001">net2</span><span class="op" id="7932005">:</span>&nbsp;<span class="string" id="7932007">&#34;tcp&#34;</span><span class="op" id="7932012">,</span>&nbsp;<span class="ident" id="7932014">laddr2</span><span class="op" id="7932020">:</span>&nbsp;<span class="string" id="7932022">&#34;0.0.0.0&#34;</span><span class="op" id="7932031">,</span>&nbsp;<span class="ident" id="7932033">wildcard</span><span class="op" id="7932041">:</span>&nbsp;<span class="builtintype" id="7932043">true</span><span class="op" id="7932047">,</span>&nbsp;<span class="ident" id="7932049">xerr</span><span class="op" id="7932053">:</span>&nbsp;<span class="ident" id="7932055">syscall</span><span class="op" id="7932062">.</span><span class="ident" id="7932063">EADDRINUSE</span><span class="op" id="7932073">}</span><span class="op" id="7932074">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932077">{</span><span class="ident" id="7932078">net1</span><span class="op" id="7932082">:</span>&nbsp;<span class="string" id="7932084">&#34;tcp&#34;</span><span class="op" id="7932089">,</span>&nbsp;<span class="ident" id="7932091">laddr1</span><span class="op" id="7932097">:</span>&nbsp;<span class="string" id="7932099">&#34;0.0.0.0&#34;</span><span class="op" id="7932108">,</span>&nbsp;<span class="ident" id="7932110">net2</span><span class="op" id="7932114">:</span>&nbsp;<span class="string" id="7932116">&#34;tcp&#34;</span><span class="op" id="7932121">,</span>&nbsp;<span class="ident" id="7932123">laddr2</span><span class="op" id="7932129">:</span>&nbsp;<span class="string" id="7932131">&#34;&#34;</span><span class="op" id="7932133">,</span>&nbsp;<span class="ident" id="7932135">wildcard</span><span class="op" id="7932143">:</span>&nbsp;<span class="builtintype" id="7932145">true</span><span class="op" id="7932149">,</span>&nbsp;<span class="ident" id="7932151">xerr</span><span class="op" id="7932155">:</span>&nbsp;<span class="ident" id="7932157">syscall</span><span class="op" id="7932164">.</span><span class="ident" id="7932165">EADDRINUSE</span><span class="op" id="7932175">}</span><span class="op" id="7932176">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932180">{</span><span class="ident" id="7932181">net1</span><span class="op" id="7932185">:</span>&nbsp;<span class="string" id="7932187">&#34;tcp&#34;</span><span class="op" id="7932192">,</span>&nbsp;<span class="ident" id="7932194">laddr1</span><span class="op" id="7932200">:</span>&nbsp;<span class="string" id="7932202">&#34;&#34;</span><span class="op" id="7932204">,</span>&nbsp;<span class="ident" id="7932206">net2</span><span class="op" id="7932210">:</span>&nbsp;<span class="string" id="7932212">&#34;tcp&#34;</span><span class="op" id="7932217">,</span>&nbsp;<span class="ident" id="7932219">laddr2</span><span class="op" id="7932225">:</span>&nbsp;<span class="string" id="7932227">&#34;[::]&#34;</span><span class="op" id="7932233">,</span>&nbsp;<span class="ident" id="7932235">wildcard</span><span class="op" id="7932243">:</span>&nbsp;<span class="builtintype" id="7932245">true</span><span class="op" id="7932249">,</span>&nbsp;<span class="ident" id="7932251">xerr</span><span class="op" id="7932255">:</span>&nbsp;<span class="ident" id="7932257">syscall</span><span class="op" id="7932264">.</span><span class="ident" id="7932265">EADDRINUSE</span><span class="op" id="7932275">}</span><span class="op" id="7932276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932279">{</span><span class="ident" id="7932280">net1</span><span class="op" id="7932284">:</span>&nbsp;<span class="string" id="7932286">&#34;tcp&#34;</span><span class="op" id="7932291">,</span>&nbsp;<span class="ident" id="7932293">laddr1</span><span class="op" id="7932299">:</span>&nbsp;<span class="string" id="7932301">&#34;[::]&#34;</span><span class="op" id="7932307">,</span>&nbsp;<span class="ident" id="7932309">net2</span><span class="op" id="7932313">:</span>&nbsp;<span class="string" id="7932315">&#34;tcp&#34;</span><span class="op" id="7932320">,</span>&nbsp;<span class="ident" id="7932322">laddr2</span><span class="op" id="7932328">:</span>&nbsp;<span class="string" id="7932330">&#34;&#34;</span><span class="op" id="7932332">,</span>&nbsp;<span class="ident" id="7932334">wildcard</span><span class="op" id="7932342">:</span>&nbsp;<span class="builtintype" id="7932344">true</span><span class="op" id="7932348">,</span>&nbsp;<span class="ident" id="7932350">xerr</span><span class="op" id="7932354">:</span>&nbsp;<span class="ident" id="7932356">syscall</span><span class="op" id="7932363">.</span><span class="ident" id="7932364">EADDRINUSE</span><span class="op" id="7932374">}</span><span class="op" id="7932375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932378">{</span><span class="ident" id="7932379">net1</span><span class="op" id="7932383">:</span>&nbsp;<span class="string" id="7932385">&#34;tcp&#34;</span><span class="op" id="7932390">,</span>&nbsp;<span class="ident" id="7932392">laddr1</span><span class="op" id="7932398">:</span>&nbsp;<span class="string" id="7932400">&#34;0.0.0.0&#34;</span><span class="op" id="7932409">,</span>&nbsp;<span class="ident" id="7932411">net2</span><span class="op" id="7932415">:</span>&nbsp;<span class="string" id="7932417">&#34;tcp&#34;</span><span class="op" id="7932422">,</span>&nbsp;<span class="ident" id="7932424">laddr2</span><span class="op" id="7932430">:</span>&nbsp;<span class="string" id="7932432">&#34;[::]&#34;</span><span class="op" id="7932438">,</span>&nbsp;<span class="ident" id="7932440">wildcard</span><span class="op" id="7932448">:</span>&nbsp;<span class="builtintype" id="7932450">true</span><span class="op" id="7932454">,</span>&nbsp;<span class="ident" id="7932456">xerr</span><span class="op" id="7932460">:</span>&nbsp;<span class="ident" id="7932462">syscall</span><span class="op" id="7932469">.</span><span class="ident" id="7932470">EADDRINUSE</span><span class="op" id="7932480">}</span><span class="op" id="7932481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932484">{</span><span class="ident" id="7932485">net1</span><span class="op" id="7932489">:</span>&nbsp;<span class="string" id="7932491">&#34;tcp&#34;</span><span class="op" id="7932496">,</span>&nbsp;<span class="ident" id="7932498">laddr1</span><span class="op" id="7932504">:</span>&nbsp;<span class="string" id="7932506">&#34;[::]&#34;</span><span class="op" id="7932512">,</span>&nbsp;<span class="ident" id="7932514">net2</span><span class="op" id="7932518">:</span>&nbsp;<span class="string" id="7932520">&#34;tcp&#34;</span><span class="op" id="7932525">,</span>&nbsp;<span class="ident" id="7932527">laddr2</span><span class="op" id="7932533">:</span>&nbsp;<span class="string" id="7932535">&#34;0.0.0.0&#34;</span><span class="op" id="7932544">,</span>&nbsp;<span class="ident" id="7932546">wildcard</span><span class="op" id="7932554">:</span>&nbsp;<span class="builtintype" id="7932556">true</span><span class="op" id="7932560">,</span>&nbsp;<span class="ident" id="7932562">xerr</span><span class="op" id="7932566">:</span>&nbsp;<span class="ident" id="7932568">syscall</span><span class="op" id="7932575">.</span><span class="ident" id="7932576">EADDRINUSE</span><span class="op" id="7932586">}</span><span class="op" id="7932587">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932590">{</span><span class="ident" id="7932591">net1</span><span class="op" id="7932595">:</span>&nbsp;<span class="string" id="7932597">&#34;tcp&#34;</span><span class="op" id="7932602">,</span>&nbsp;<span class="ident" id="7932604">laddr1</span><span class="op" id="7932610">:</span>&nbsp;<span class="string" id="7932612">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7932630">,</span>&nbsp;<span class="ident" id="7932632">net2</span><span class="op" id="7932636">:</span>&nbsp;<span class="string" id="7932638">&#34;tcp&#34;</span><span class="op" id="7932643">,</span>&nbsp;<span class="ident" id="7932645">laddr2</span><span class="op" id="7932651">:</span>&nbsp;<span class="string" id="7932653">&#34;[::]&#34;</span><span class="op" id="7932659">,</span>&nbsp;<span class="ident" id="7932661">wildcard</span><span class="op" id="7932669">:</span>&nbsp;<span class="builtintype" id="7932671">true</span><span class="op" id="7932675">,</span>&nbsp;<span class="ident" id="7932677">xerr</span><span class="op" id="7932681">:</span>&nbsp;<span class="ident" id="7932683">syscall</span><span class="op" id="7932690">.</span><span class="ident" id="7932691">EADDRINUSE</span><span class="op" id="7932701">}</span><span class="op" id="7932702">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932705">{</span><span class="ident" id="7932706">net1</span><span class="op" id="7932710">:</span>&nbsp;<span class="string" id="7932712">&#34;tcp&#34;</span><span class="op" id="7932717">,</span>&nbsp;<span class="ident" id="7932719">laddr1</span><span class="op" id="7932725">:</span>&nbsp;<span class="string" id="7932727">&#34;[::]&#34;</span><span class="op" id="7932733">,</span>&nbsp;<span class="ident" id="7932735">net2</span><span class="op" id="7932739">:</span>&nbsp;<span class="string" id="7932741">&#34;tcp&#34;</span><span class="op" id="7932746">,</span>&nbsp;<span class="ident" id="7932748">laddr2</span><span class="op" id="7932754">:</span>&nbsp;<span class="string" id="7932756">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7932774">,</span>&nbsp;<span class="ident" id="7932776">wildcard</span><span class="op" id="7932784">:</span>&nbsp;<span class="builtintype" id="7932786">true</span><span class="op" id="7932790">,</span>&nbsp;<span class="ident" id="7932792">xerr</span><span class="op" id="7932796">:</span>&nbsp;<span class="ident" id="7932798">syscall</span><span class="op" id="7932805">.</span><span class="ident" id="7932806">EADDRINUSE</span><span class="op" id="7932816">}</span><span class="op" id="7932817">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932821">{</span><span class="ident" id="7932822">net1</span><span class="op" id="7932826">:</span>&nbsp;<span class="string" id="7932828">&#34;tcp4&#34;</span><span class="op" id="7932834">,</span>&nbsp;<span class="ident" id="7932836">laddr1</span><span class="op" id="7932842">:</span>&nbsp;<span class="string" id="7932844">&#34;&#34;</span><span class="op" id="7932846">,</span>&nbsp;<span class="ident" id="7932848">net2</span><span class="op" id="7932852">:</span>&nbsp;<span class="string" id="7932854">&#34;tcp6&#34;</span><span class="op" id="7932860">,</span>&nbsp;<span class="ident" id="7932862">laddr2</span><span class="op" id="7932868">:</span>&nbsp;<span class="string" id="7932870">&#34;&#34;</span><span class="op" id="7932872">,</span>&nbsp;<span class="ident" id="7932874">wildcard</span><span class="op" id="7932882">:</span>&nbsp;<span class="builtintype" id="7932884">true</span><span class="op" id="7932888">}</span><span class="op" id="7932889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932892">{</span><span class="ident" id="7932893">net1</span><span class="op" id="7932897">:</span>&nbsp;<span class="string" id="7932899">&#34;tcp6&#34;</span><span class="op" id="7932905">,</span>&nbsp;<span class="ident" id="7932907">laddr1</span><span class="op" id="7932913">:</span>&nbsp;<span class="string" id="7932915">&#34;&#34;</span><span class="op" id="7932917">,</span>&nbsp;<span class="ident" id="7932919">net2</span><span class="op" id="7932923">:</span>&nbsp;<span class="string" id="7932925">&#34;tcp4&#34;</span><span class="op" id="7932931">,</span>&nbsp;<span class="ident" id="7932933">laddr2</span><span class="op" id="7932939">:</span>&nbsp;<span class="string" id="7932941">&#34;&#34;</span><span class="op" id="7932943">,</span>&nbsp;<span class="ident" id="7932945">wildcard</span><span class="op" id="7932953">:</span>&nbsp;<span class="builtintype" id="7932955">true</span><span class="op" id="7932959">}</span><span class="op" id="7932960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7932963">{</span><span class="ident" id="7932964">net1</span><span class="op" id="7932968">:</span>&nbsp;<span class="string" id="7932970">&#34;tcp4&#34;</span><span class="op" id="7932976">,</span>&nbsp;<span class="ident" id="7932978">laddr1</span><span class="op" id="7932984">:</span>&nbsp;<span class="string" id="7932986">&#34;0.0.0.0&#34;</span><span class="op" id="7932995">,</span>&nbsp;<span class="ident" id="7932997">net2</span><span class="op" id="7933001">:</span>&nbsp;<span class="string" id="7933003">&#34;tcp6&#34;</span><span class="op" id="7933009">,</span>&nbsp;<span class="ident" id="7933011">laddr2</span><span class="op" id="7933017">:</span>&nbsp;<span class="string" id="7933019">&#34;[::]&#34;</span><span class="op" id="7933025">,</span>&nbsp;<span class="ident" id="7933027">wildcard</span><span class="op" id="7933035">:</span>&nbsp;<span class="builtintype" id="7933037">true</span><span class="op" id="7933041">}</span><span class="op" id="7933042">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933045">{</span><span class="ident" id="7933046">net1</span><span class="op" id="7933050">:</span>&nbsp;<span class="string" id="7933052">&#34;tcp6&#34;</span><span class="op" id="7933058">,</span>&nbsp;<span class="ident" id="7933060">laddr1</span><span class="op" id="7933066">:</span>&nbsp;<span class="string" id="7933068">&#34;[::]&#34;</span><span class="op" id="7933074">,</span>&nbsp;<span class="ident" id="7933076">net2</span><span class="op" id="7933080">:</span>&nbsp;<span class="string" id="7933082">&#34;tcp4&#34;</span><span class="op" id="7933088">,</span>&nbsp;<span class="ident" id="7933090">laddr2</span><span class="op" id="7933096">:</span>&nbsp;<span class="string" id="7933098">&#34;0.0.0.0&#34;</span><span class="op" id="7933107">,</span>&nbsp;<span class="ident" id="7933109">wildcard</span><span class="op" id="7933117">:</span>&nbsp;<span class="builtintype" id="7933119">true</span><span class="op" id="7933123">}</span><span class="op" id="7933124">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933128">{</span><span class="ident" id="7933129">net1</span><span class="op" id="7933133">:</span>&nbsp;<span class="string" id="7933135">&#34;tcp&#34;</span><span class="op" id="7933140">,</span>&nbsp;<span class="ident" id="7933142">laddr1</span><span class="op" id="7933148">:</span>&nbsp;<span class="string" id="7933150">&#34;127.0.0.1&#34;</span><span class="op" id="7933161">,</span>&nbsp;<span class="ident" id="7933163">net2</span><span class="op" id="7933167">:</span>&nbsp;<span class="string" id="7933169">&#34;tcp&#34;</span><span class="op" id="7933174">,</span>&nbsp;<span class="ident" id="7933176">laddr2</span><span class="op" id="7933182">:</span>&nbsp;<span class="string" id="7933184">&#34;[::1]&#34;</span><span class="op" id="7933191">}</span><span class="op" id="7933192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933195">{</span><span class="ident" id="7933196">net1</span><span class="op" id="7933200">:</span>&nbsp;<span class="string" id="7933202">&#34;tcp&#34;</span><span class="op" id="7933207">,</span>&nbsp;<span class="ident" id="7933209">laddr1</span><span class="op" id="7933215">:</span>&nbsp;<span class="string" id="7933217">&#34;[::1]&#34;</span><span class="op" id="7933224">,</span>&nbsp;<span class="ident" id="7933226">net2</span><span class="op" id="7933230">:</span>&nbsp;<span class="string" id="7933232">&#34;tcp&#34;</span><span class="op" id="7933237">,</span>&nbsp;<span class="ident" id="7933239">laddr2</span><span class="op" id="7933245">:</span>&nbsp;<span class="string" id="7933247">&#34;127.0.0.1&#34;</span><span class="op" id="7933258">}</span><span class="op" id="7933259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933262">{</span><span class="ident" id="7933263">net1</span><span class="op" id="7933267">:</span>&nbsp;<span class="string" id="7933269">&#34;tcp4&#34;</span><span class="op" id="7933275">,</span>&nbsp;<span class="ident" id="7933277">laddr1</span><span class="op" id="7933283">:</span>&nbsp;<span class="string" id="7933285">&#34;127.0.0.1&#34;</span><span class="op" id="7933296">,</span>&nbsp;<span class="ident" id="7933298">net2</span><span class="op" id="7933302">:</span>&nbsp;<span class="string" id="7933304">&#34;tcp6&#34;</span><span class="op" id="7933310">,</span>&nbsp;<span class="ident" id="7933312">laddr2</span><span class="op" id="7933318">:</span>&nbsp;<span class="string" id="7933320">&#34;[::1]&#34;</span><span class="op" id="7933327">}</span><span class="op" id="7933328">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933331">{</span><span class="ident" id="7933332">net1</span><span class="op" id="7933336">:</span>&nbsp;<span class="string" id="7933338">&#34;tcp6&#34;</span><span class="op" id="7933344">,</span>&nbsp;<span class="ident" id="7933346">laddr1</span><span class="op" id="7933352">:</span>&nbsp;<span class="string" id="7933354">&#34;[::1]&#34;</span><span class="op" id="7933361">,</span>&nbsp;<span class="ident" id="7933363">net2</span><span class="op" id="7933367">:</span>&nbsp;<span class="string" id="7933369">&#34;tcp4&#34;</span><span class="op" id="7933375">,</span>&nbsp;<span class="ident" id="7933377">laddr2</span><span class="op" id="7933383">:</span>&nbsp;<span class="string" id="7933385">&#34;127.0.0.1&#34;</span><span class="op" id="7933396">}</span><span class="op" id="7933397">,</span><br>
<span class="lineno"></span><span class="op" id="7933399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7933402">//&nbsp;TestDualStackTCPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="7933466">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;different</span><br>
<span class="lineno">170</span><span class="comment" id="7933529">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="7933565">func</span>&nbsp;<span class="ident" id="7933570">TestDualStackTCPListener</span><span class="op" id="7933594">(</span><span class="ident" id="7933595">t</span>&nbsp;<span class="op" id="7933597">*</span><span class="ident" id="7933598">testing</span><span class="op" id="7933605">.</span><span class="ident" id="7933606">T</span><span class="op" id="7933607">)</span>&nbsp;<span class="op" id="7933609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933612">if</span>&nbsp;<span class="ident" id="7933615">testing</span><span class="op" id="7933622">.</span><span class="ident" id="7933623">Short</span><span class="op" id="7933628">(</span><span class="op" id="7933629">)</span>&nbsp;<span class="op" id="7933631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933635">t</span><span class="op" id="7933636">.</span><span class="ident" id="7933637">Skip</span><span class="op" id="7933641">(</span><span class="string" id="7933642">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="7933683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933686">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933689">switch</span>&nbsp;<span class="ident" id="7933696">runtime</span><span class="op" id="7933703">.</span><span class="ident" id="7933704">GOOS</span>&nbsp;<span class="op" id="7933709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933712">case</span>&nbsp;<span class="string" id="7933717">&#34;plan9&#34;</span><span class="op" id="7933724">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933728">t</span><span class="op" id="7933729">.</span><span class="ident" id="7933730">Skipf</span><span class="op" id="7933735">(</span><span class="string" id="7933736">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7933757">,</span>&nbsp;<span class="ident" id="7933759">runtime</span><span class="op" id="7933766">.</span><span class="ident" id="7933767">GOOS</span><span class="op" id="7933771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933777">if</span>&nbsp;<span class="op" id="7933780">!</span><span class="ident" id="7933781">supportsIPv6</span>&nbsp;<span class="op" id="7933794">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7933798">t</span><span class="op" id="7933799">.</span><span class="ident" id="7933800">Skip</span><span class="op" id="7933804">(</span><span class="string" id="7933805">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7933828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933835">for</span>&nbsp;<span class="ident" id="7933839">_</span><span class="op" id="7933840">,</span>&nbsp;<span class="ident" id="7933842">tt</span>&nbsp;<span class="op" id="7933845">:=</span>&nbsp;<span class="keyword" id="7933848">range</span>&nbsp;<span class="ident" id="7933854">dualStackListenerTests</span>&nbsp;<span class="op" id="7933877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933881">if</span>&nbsp;<span class="ident" id="7933884">tt</span><span class="op" id="7933886">.</span><span class="ident" id="7933887">wildcard</span>&nbsp;<span class="op" id="7933896">&amp;&amp;</span>&nbsp;<span class="op" id="7933899">!</span><span class="op" id="7933900">*</span><span class="ident" id="7933901">testExternal</span>&nbsp;<span class="op" id="7933914">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933919">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7933930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933934">switch</span>&nbsp;<span class="ident" id="7933941">runtime</span><span class="op" id="7933948">.</span><span class="ident" id="7933949">GOOS</span>&nbsp;<span class="op" id="7933954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933958">case</span>&nbsp;<span class="string" id="7933963">&#34;openbsd&#34;</span><span class="op" id="7933972">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7933977">if</span>&nbsp;<span class="ident" id="7933980">tt</span><span class="op" id="7933982">.</span><span class="ident" id="7933983">wildcard</span>&nbsp;<span class="op" id="7933992">&amp;&amp;</span>&nbsp;<span class="ident" id="7933995">differentWildcardAddr</span><span class="op" id="7934016">(</span><span class="ident" id="7934017">tt</span><span class="op" id="7934019">.</span><span class="ident" id="7934020">laddr1</span><span class="op" id="7934026">,</span>&nbsp;<span class="ident" id="7934028">tt</span><span class="op" id="7934030">.</span><span class="ident" id="7934031">laddr2</span><span class="op" id="7934037">)</span>&nbsp;<span class="op" id="7934039">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934045">tt</span><span class="op" id="7934047">.</span><span class="ident" id="7934048">xerr</span>&nbsp;<span class="op" id="7934053">=</span>&nbsp;<span class="ident" id="7934055">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934070">l1</span><span class="op" id="7934072">,</span>&nbsp;<span class="ident" id="7934074">port</span>&nbsp;<span class="op" id="7934079">:=</span>&nbsp;<span class="ident" id="7934082">usableListenPort</span><span class="op" id="7934098">(</span><span class="ident" id="7934099">t</span><span class="op" id="7934100">,</span>&nbsp;<span class="ident" id="7934102">tt</span><span class="op" id="7934104">.</span><span class="ident" id="7934105">net1</span><span class="op" id="7934109">,</span>&nbsp;<span class="ident" id="7934111">tt</span><span class="op" id="7934113">.</span><span class="ident" id="7934114">laddr1</span><span class="op" id="7934120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934124">laddr</span>&nbsp;<span class="op" id="7934130">:=</span>&nbsp;<span class="ident" id="7934133">tt</span><span class="op" id="7934135">.</span><span class="ident" id="7934136">laddr1</span>&nbsp;<span class="op" id="7934143">+</span>&nbsp;<span class="string" id="7934145">&#34;:&#34;</span>&nbsp;<span class="op" id="7934149">+</span>&nbsp;<span class="ident" id="7934151">port</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934158">checkFirstListener</span><span class="op" id="7934176">(</span><span class="ident" id="7934177">t</span><span class="op" id="7934178">,</span>&nbsp;<span class="ident" id="7934180">tt</span><span class="op" id="7934182">.</span><span class="ident" id="7934183">net1</span><span class="op" id="7934187">,</span>&nbsp;<span class="ident" id="7934189">laddr</span><span class="op" id="7934194">,</span>&nbsp;<span class="ident" id="7934196">l1</span><span class="op" id="7934198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934202">laddr</span>&nbsp;<span class="op" id="7934208">=</span>&nbsp;<span class="ident" id="7934210">tt</span><span class="op" id="7934212">.</span><span class="ident" id="7934213">laddr2</span>&nbsp;<span class="op" id="7934220">+</span>&nbsp;<span class="string" id="7934222">&#34;:&#34;</span>&nbsp;<span class="op" id="7934226">+</span>&nbsp;<span class="ident" id="7934228">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934235">l2</span><span class="op" id="7934237">,</span>&nbsp;<span class="ident" id="7934239">err</span>&nbsp;<span class="op" id="7934243">:=</span>&nbsp;<span class="ident" id="7934246">Listen</span><span class="op" id="7934252">(</span><span class="ident" id="7934253">tt</span><span class="op" id="7934255">.</span><span class="ident" id="7934256">net2</span><span class="op" id="7934260">,</span>&nbsp;<span class="ident" id="7934262">laddr</span><span class="op" id="7934267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934271">checkDualStackSecondListener</span><span class="op" id="7934299">(</span><span class="ident" id="7934300">t</span><span class="op" id="7934301">,</span>&nbsp;<span class="ident" id="7934303">tt</span><span class="op" id="7934305">.</span><span class="ident" id="7934306">net2</span><span class="op" id="7934310">,</span>&nbsp;<span class="ident" id="7934312">laddr</span><span class="op" id="7934317">,</span>&nbsp;<span class="ident" id="7934319">tt</span><span class="op" id="7934321">.</span><span class="ident" id="7934322">xerr</span><span class="op" id="7934326">,</span>&nbsp;<span class="ident" id="7934328">err</span><span class="op" id="7934331">,</span>&nbsp;<span class="ident" id="7934333">l2</span><span class="op" id="7934335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934339">l1</span><span class="op" id="7934341">.</span><span class="ident" id="7934342">Close</span><span class="op" id="7934347">(</span><span class="op" id="7934348">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934351">}</span><br>
<span class="lineno"></span><span class="op" id="7934353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7934356">//&nbsp;TestDualStackUDPListener&nbsp;tests&nbsp;both&nbsp;single&nbsp;and&nbsp;double&nbsp;listen</span><br>
<span class="lineno"></span><span class="comment" id="7934420">//&nbsp;to&nbsp;a&nbsp;test&nbsp;listener&nbsp;with&nbsp;various&nbsp;address&nbsp;families,&nbsp;differnet</span><br>
<span class="lineno">205</span><span class="comment" id="7934483">//&nbsp;listening&nbsp;address&nbsp;and&nbsp;same&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="7934519">func</span>&nbsp;<span class="ident" id="7934524">TestDualStackUDPListener</span><span class="op" id="7934548">(</span><span class="ident" id="7934549">t</span>&nbsp;<span class="op" id="7934551">*</span><span class="ident" id="7934552">testing</span><span class="op" id="7934559">.</span><span class="ident" id="7934560">T</span><span class="op" id="7934561">)</span>&nbsp;<span class="op" id="7934563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934566">if</span>&nbsp;<span class="ident" id="7934569">testing</span><span class="op" id="7934576">.</span><span class="ident" id="7934577">Short</span><span class="op" id="7934582">(</span><span class="op" id="7934583">)</span>&nbsp;<span class="op" id="7934585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934589">t</span><span class="op" id="7934590">.</span><span class="ident" id="7934591">Skip</span><span class="op" id="7934595">(</span><span class="string" id="7934596">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode,&nbsp;see&nbsp;issue&nbsp;5001&#34;</span><span class="op" id="7934637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934640">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934643">switch</span>&nbsp;<span class="ident" id="7934650">runtime</span><span class="op" id="7934657">.</span><span class="ident" id="7934658">GOOS</span>&nbsp;<span class="op" id="7934663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934666">case</span>&nbsp;<span class="string" id="7934671">&#34;plan9&#34;</span><span class="op" id="7934678">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934682">t</span><span class="op" id="7934683">.</span><span class="ident" id="7934684">Skipf</span><span class="op" id="7934689">(</span><span class="string" id="7934690">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7934711">,</span>&nbsp;<span class="ident" id="7934713">runtime</span><span class="op" id="7934720">.</span><span class="ident" id="7934721">GOOS</span><span class="op" id="7934725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934731">if</span>&nbsp;<span class="op" id="7934734">!</span><span class="ident" id="7934735">supportsIPv6</span>&nbsp;<span class="op" id="7934748">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934752">t</span><span class="op" id="7934753">.</span><span class="ident" id="7934754">Skip</span><span class="op" id="7934758">(</span><span class="string" id="7934759">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7934782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7934789">toudpnet</span>&nbsp;<span class="op" id="7934798">:=</span>&nbsp;<span class="keyword" id="7934801">func</span><span class="op" id="7934805">(</span><span class="ident" id="7934806">net</span>&nbsp;<span class="builtintype" id="7934810">string</span><span class="op" id="7934816">)</span>&nbsp;<span class="builtintype" id="7934818">string</span>&nbsp;<span class="op" id="7934825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934829">switch</span>&nbsp;<span class="ident" id="7934836">net</span>&nbsp;<span class="op" id="7934840">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934844">case</span>&nbsp;<span class="string" id="7934849">&#34;tcp&#34;</span><span class="op" id="7934854">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934859">return</span>&nbsp;<span class="string" id="7934866">&#34;udp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934874">case</span>&nbsp;<span class="string" id="7934879">&#34;tcp4&#34;</span><span class="op" id="7934885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934890">return</span>&nbsp;<span class="string" id="7934897">&#34;udp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934906">case</span>&nbsp;<span class="string" id="7934911">&#34;tcp6&#34;</span><span class="op" id="7934917">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934922">return</span>&nbsp;<span class="string" id="7934929">&#34;udp6&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934942">return</span>&nbsp;<span class="string" id="7934949">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7934958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7934962">for</span>&nbsp;<span class="ident" id="7934966">_</span><span class="op" id="7934967">,</span>&nbsp;<span class="ident" id="7934969">tt</span>&nbsp;<span class="op" id="7934972">:=</span>&nbsp;<span class="keyword" id="7934975">range</span>&nbsp;<span class="ident" id="7934981">dualStackListenerTests</span>&nbsp;<span class="op" id="7935004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935008">if</span>&nbsp;<span class="ident" id="7935011">tt</span><span class="op" id="7935013">.</span><span class="ident" id="7935014">wildcard</span>&nbsp;<span class="op" id="7935023">&amp;&amp;</span>&nbsp;<span class="op" id="7935026">(</span><span class="ident" id="7935027">testing</span><span class="op" id="7935034">.</span><span class="ident" id="7935035">Short</span><span class="op" id="7935040">(</span><span class="op" id="7935041">)</span>&nbsp;<span class="op" id="7935043">||</span>&nbsp;<span class="op" id="7935046">!</span><span class="op" id="7935047">*</span><span class="ident" id="7935048">testExternal</span><span class="op" id="7935060">)</span>&nbsp;<span class="op" id="7935062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935067">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935082">tt</span><span class="op" id="7935084">.</span><span class="ident" id="7935085">net1</span>&nbsp;<span class="op" id="7935090">=</span>&nbsp;<span class="ident" id="7935092">toudpnet</span><span class="op" id="7935100">(</span><span class="ident" id="7935101">tt</span><span class="op" id="7935103">.</span><span class="ident" id="7935104">net1</span><span class="op" id="7935108">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935112">tt</span><span class="op" id="7935114">.</span><span class="ident" id="7935115">net2</span>&nbsp;<span class="op" id="7935120">=</span>&nbsp;<span class="ident" id="7935122">toudpnet</span><span class="op" id="7935130">(</span><span class="ident" id="7935131">tt</span><span class="op" id="7935133">.</span><span class="ident" id="7935134">net2</span><span class="op" id="7935138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935142">switch</span>&nbsp;<span class="ident" id="7935149">runtime</span><span class="op" id="7935156">.</span><span class="ident" id="7935157">GOOS</span>&nbsp;<span class="op" id="7935162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935166">case</span>&nbsp;<span class="string" id="7935171">&#34;openbsd&#34;</span><span class="op" id="7935180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935185">if</span>&nbsp;<span class="ident" id="7935188">tt</span><span class="op" id="7935190">.</span><span class="ident" id="7935191">wildcard</span>&nbsp;<span class="op" id="7935200">&amp;&amp;</span>&nbsp;<span class="ident" id="7935203">differentWildcardAddr</span><span class="op" id="7935224">(</span><span class="ident" id="7935225">tt</span><span class="op" id="7935227">.</span><span class="ident" id="7935228">laddr1</span><span class="op" id="7935234">,</span>&nbsp;<span class="ident" id="7935236">tt</span><span class="op" id="7935238">.</span><span class="ident" id="7935239">laddr2</span><span class="op" id="7935245">)</span>&nbsp;<span class="op" id="7935247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935253">tt</span><span class="op" id="7935255">.</span><span class="ident" id="7935256">xerr</span>&nbsp;<span class="op" id="7935261">=</span>&nbsp;<span class="ident" id="7935263">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935278">l1</span><span class="op" id="7935280">,</span>&nbsp;<span class="ident" id="7935282">port</span>&nbsp;<span class="op" id="7935287">:=</span>&nbsp;<span class="ident" id="7935290">usableListenPacketPort</span><span class="op" id="7935312">(</span><span class="ident" id="7935313">t</span><span class="op" id="7935314">,</span>&nbsp;<span class="ident" id="7935316">tt</span><span class="op" id="7935318">.</span><span class="ident" id="7935319">net1</span><span class="op" id="7935323">,</span>&nbsp;<span class="ident" id="7935325">tt</span><span class="op" id="7935327">.</span><span class="ident" id="7935328">laddr1</span><span class="op" id="7935334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935338">laddr</span>&nbsp;<span class="op" id="7935344">:=</span>&nbsp;<span class="ident" id="7935347">tt</span><span class="op" id="7935349">.</span><span class="ident" id="7935350">laddr1</span>&nbsp;<span class="op" id="7935357">+</span>&nbsp;<span class="string" id="7935359">&#34;:&#34;</span>&nbsp;<span class="op" id="7935363">+</span>&nbsp;<span class="ident" id="7935365">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935372">checkFirstListener</span><span class="op" id="7935390">(</span><span class="ident" id="7935391">t</span><span class="op" id="7935392">,</span>&nbsp;<span class="ident" id="7935394">tt</span><span class="op" id="7935396">.</span><span class="ident" id="7935397">net1</span><span class="op" id="7935401">,</span>&nbsp;<span class="ident" id="7935403">laddr</span><span class="op" id="7935408">,</span>&nbsp;<span class="ident" id="7935410">l1</span><span class="op" id="7935412">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935416">laddr</span>&nbsp;<span class="op" id="7935422">=</span>&nbsp;<span class="ident" id="7935424">tt</span><span class="op" id="7935426">.</span><span class="ident" id="7935427">laddr2</span>&nbsp;<span class="op" id="7935434">+</span>&nbsp;<span class="string" id="7935436">&#34;:&#34;</span>&nbsp;<span class="op" id="7935440">+</span>&nbsp;<span class="ident" id="7935442">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935449">l2</span><span class="op" id="7935451">,</span>&nbsp;<span class="ident" id="7935453">err</span>&nbsp;<span class="op" id="7935457">:=</span>&nbsp;<span class="ident" id="7935460">ListenPacket</span><span class="op" id="7935472">(</span><span class="ident" id="7935473">tt</span><span class="op" id="7935475">.</span><span class="ident" id="7935476">net2</span><span class="op" id="7935480">,</span>&nbsp;<span class="ident" id="7935482">laddr</span><span class="op" id="7935487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935491">checkDualStackSecondListener</span><span class="op" id="7935519">(</span><span class="ident" id="7935520">t</span><span class="op" id="7935521">,</span>&nbsp;<span class="ident" id="7935523">tt</span><span class="op" id="7935525">.</span><span class="ident" id="7935526">net2</span><span class="op" id="7935530">,</span>&nbsp;<span class="ident" id="7935532">laddr</span><span class="op" id="7935537">,</span>&nbsp;<span class="ident" id="7935539">tt</span><span class="op" id="7935541">.</span><span class="ident" id="7935542">xerr</span><span class="op" id="7935546">,</span>&nbsp;<span class="ident" id="7935548">err</span><span class="op" id="7935551">,</span>&nbsp;<span class="ident" id="7935553">l2</span><span class="op" id="7935555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935559">l1</span><span class="op" id="7935561">.</span><span class="ident" id="7935562">Close</span><span class="op" id="7935567">(</span><span class="op" id="7935568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935571">}</span><br>
<span class="lineno">250</span><span class="op" id="7935573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7935576">func</span>&nbsp;<span class="ident" id="7935581">usableListenPort</span><span class="op" id="7935597">(</span><span class="ident" id="7935598">t</span>&nbsp;<span class="op" id="7935600">*</span><span class="ident" id="7935601">testing</span><span class="op" id="7935608">.</span><span class="ident" id="7935609">T</span><span class="op" id="7935610">,</span>&nbsp;<span class="ident" id="7935612">net</span><span class="op" id="7935615">,</span>&nbsp;<span class="ident" id="7935617">laddr</span>&nbsp;<span class="builtintype" id="7935623">string</span><span class="op" id="7935629">)</span>&nbsp;<span class="op" id="7935631">(</span><span class="ident" id="7935632">l</span>&nbsp;<span class="ident" id="7935634">Listener</span><span class="op" id="7935642">,</span>&nbsp;<span class="ident" id="7935644">port</span>&nbsp;<span class="builtintype" id="7935649">string</span><span class="op" id="7935655">)</span>&nbsp;<span class="op" id="7935657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935660">var</span>&nbsp;<span class="ident" id="7935664">nladdr</span>&nbsp;<span class="builtintype" id="7935671">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935679">var</span>&nbsp;<span class="ident" id="7935683">err</span>&nbsp;<span class="builtintype" id="7935687">error</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935694">switch</span>&nbsp;<span class="ident" id="7935701">net</span>&nbsp;<span class="op" id="7935705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935708">default</span><span class="op" id="7935715">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7935719">panic</span><span class="op" id="7935724">(</span><span class="string" id="7935725">&#34;usableListenPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="7935749">+</span>&nbsp;<span class="ident" id="7935751">net</span><span class="op" id="7935754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935757">case</span>&nbsp;<span class="string" id="7935762">&#34;tcp&#34;</span><span class="op" id="7935767">,</span>&nbsp;<span class="string" id="7935769">&#34;tcp4&#34;</span><span class="op" id="7935775">,</span>&nbsp;<span class="string" id="7935777">&#34;tcp6&#34;</span><span class="op" id="7935783">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935787">l</span><span class="op" id="7935788">,</span>&nbsp;<span class="ident" id="7935790">err</span>&nbsp;<span class="op" id="7935794">=</span>&nbsp;<span class="ident" id="7935796">Listen</span><span class="op" id="7935802">(</span><span class="ident" id="7935803">net</span><span class="op" id="7935806">,</span>&nbsp;<span class="ident" id="7935808">laddr</span><span class="op" id="7935813">+</span><span class="string" id="7935814">&#34;:0&#34;</span><span class="op" id="7935818">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935822">if</span>&nbsp;<span class="ident" id="7935825">err</span>&nbsp;<span class="op" id="7935829">!=</span>&nbsp;<span class="ident" id="7935832">nil</span>&nbsp;<span class="op" id="7935836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935841">t</span><span class="op" id="7935842">.</span><span class="ident" id="7935843">Fatalf</span><span class="op" id="7935849">(</span><span class="string" id="7935850">&#34;Probe&nbsp;Listen(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7935883">,</span>&nbsp;<span class="ident" id="7935885">net</span><span class="op" id="7935888">,</span>&nbsp;<span class="ident" id="7935890">laddr</span><span class="op" id="7935895">,</span>&nbsp;<span class="ident" id="7935897">err</span><span class="op" id="7935900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935908">nladdr</span>&nbsp;<span class="op" id="7935915">=</span>&nbsp;<span class="ident" id="7935917">l</span><span class="op" id="7935918">.</span><span class="op" id="7935919">(</span><span class="op" id="7935920">*</span><span class="ident" id="7935921">TCPListener</span><span class="op" id="7935932">)</span><span class="op" id="7935933">.</span><span class="ident" id="7935934">Addr</span><span class="op" id="7935938">(</span><span class="op" id="7935939">)</span><span class="op" id="7935940">.</span><span class="ident" id="7935941">String</span><span class="op" id="7935947">(</span><span class="op" id="7935948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7935951">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7935954">_</span><span class="op" id="7935955">,</span>&nbsp;<span class="ident" id="7935957">port</span><span class="op" id="7935961">,</span>&nbsp;<span class="ident" id="7935963">err</span>&nbsp;<span class="op" id="7935967">=</span>&nbsp;<span class="ident" id="7935969">SplitHostPort</span><span class="op" id="7935982">(</span><span class="ident" id="7935983">nladdr</span><span class="op" id="7935989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7935992">if</span>&nbsp;<span class="ident" id="7935995">err</span>&nbsp;<span class="op" id="7935999">!=</span>&nbsp;<span class="ident" id="7936002">nil</span>&nbsp;<span class="op" id="7936006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936010">t</span><span class="op" id="7936011">.</span><span class="ident" id="7936012">Fatalf</span><span class="op" id="7936018">(</span><span class="string" id="7936019">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7936045">,</span>&nbsp;<span class="ident" id="7936047">err</span><span class="op" id="7936050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936056">return</span>&nbsp;<span class="ident" id="7936063">l</span><span class="op" id="7936064">,</span>&nbsp;<span class="ident" id="7936066">port</span><br>
<span class="lineno">270</span><span class="op" id="7936071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7936074">func</span>&nbsp;<span class="ident" id="7936079">usableListenPacketPort</span><span class="op" id="7936101">(</span><span class="ident" id="7936102">t</span>&nbsp;<span class="op" id="7936104">*</span><span class="ident" id="7936105">testing</span><span class="op" id="7936112">.</span><span class="ident" id="7936113">T</span><span class="op" id="7936114">,</span>&nbsp;<span class="ident" id="7936116">net</span><span class="op" id="7936119">,</span>&nbsp;<span class="ident" id="7936121">laddr</span>&nbsp;<span class="builtintype" id="7936127">string</span><span class="op" id="7936133">)</span>&nbsp;<span class="op" id="7936135">(</span><span class="ident" id="7936136">l</span>&nbsp;<span class="ident" id="7936138">PacketConn</span><span class="op" id="7936148">,</span>&nbsp;<span class="ident" id="7936150">port</span>&nbsp;<span class="builtintype" id="7936155">string</span><span class="op" id="7936161">)</span>&nbsp;<span class="op" id="7936163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936166">var</span>&nbsp;<span class="ident" id="7936170">nladdr</span>&nbsp;<span class="builtintype" id="7936177">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936185">var</span>&nbsp;<span class="ident" id="7936189">err</span>&nbsp;<span class="builtintype" id="7936193">error</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936200">switch</span>&nbsp;<span class="ident" id="7936207">net</span>&nbsp;<span class="op" id="7936211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936214">default</span><span class="op" id="7936221">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7936225">panic</span><span class="op" id="7936230">(</span><span class="string" id="7936231">&#34;usableListenPacketPort&nbsp;net=&#34;</span>&nbsp;<span class="op" id="7936261">+</span>&nbsp;<span class="ident" id="7936263">net</span><span class="op" id="7936266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936269">case</span>&nbsp;<span class="string" id="7936274">&#34;udp&#34;</span><span class="op" id="7936279">,</span>&nbsp;<span class="string" id="7936281">&#34;udp4&#34;</span><span class="op" id="7936287">,</span>&nbsp;<span class="string" id="7936289">&#34;udp6&#34;</span><span class="op" id="7936295">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936299">l</span><span class="op" id="7936300">,</span>&nbsp;<span class="ident" id="7936302">err</span>&nbsp;<span class="op" id="7936306">=</span>&nbsp;<span class="ident" id="7936308">ListenPacket</span><span class="op" id="7936320">(</span><span class="ident" id="7936321">net</span><span class="op" id="7936324">,</span>&nbsp;<span class="ident" id="7936326">laddr</span><span class="op" id="7936331">+</span><span class="string" id="7936332">&#34;:0&#34;</span><span class="op" id="7936336">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936340">if</span>&nbsp;<span class="ident" id="7936343">err</span>&nbsp;<span class="op" id="7936347">!=</span>&nbsp;<span class="ident" id="7936350">nil</span>&nbsp;<span class="op" id="7936354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936359">t</span><span class="op" id="7936360">.</span><span class="ident" id="7936361">Fatalf</span><span class="op" id="7936367">(</span><span class="string" id="7936368">&#34;Probe&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7936407">,</span>&nbsp;<span class="ident" id="7936409">net</span><span class="op" id="7936412">,</span>&nbsp;<span class="ident" id="7936414">laddr</span><span class="op" id="7936419">,</span>&nbsp;<span class="ident" id="7936421">err</span><span class="op" id="7936424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936432">nladdr</span>&nbsp;<span class="op" id="7936439">=</span>&nbsp;<span class="ident" id="7936441">l</span><span class="op" id="7936442">.</span><span class="op" id="7936443">(</span><span class="op" id="7936444">*</span><span class="ident" id="7936445">UDPConn</span><span class="op" id="7936452">)</span><span class="op" id="7936453">.</span><span class="ident" id="7936454">LocalAddr</span><span class="op" id="7936463">(</span><span class="op" id="7936464">)</span><span class="op" id="7936465">.</span><span class="ident" id="7936466">String</span><span class="op" id="7936472">(</span><span class="op" id="7936473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936476">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936479">_</span><span class="op" id="7936480">,</span>&nbsp;<span class="ident" id="7936482">port</span><span class="op" id="7936486">,</span>&nbsp;<span class="ident" id="7936488">err</span>&nbsp;<span class="op" id="7936492">=</span>&nbsp;<span class="ident" id="7936494">SplitHostPort</span><span class="op" id="7936507">(</span><span class="ident" id="7936508">nladdr</span><span class="op" id="7936514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936517">if</span>&nbsp;<span class="ident" id="7936520">err</span>&nbsp;<span class="op" id="7936524">!=</span>&nbsp;<span class="ident" id="7936527">nil</span>&nbsp;<span class="op" id="7936531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936535">t</span><span class="op" id="7936536">.</span><span class="ident" id="7936537">Fatalf</span><span class="op" id="7936543">(</span><span class="string" id="7936544">&#34;SplitHostPort&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7936570">,</span>&nbsp;<span class="ident" id="7936572">err</span><span class="op" id="7936575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936581">return</span>&nbsp;<span class="ident" id="7936588">l</span><span class="op" id="7936589">,</span>&nbsp;<span class="ident" id="7936591">port</span><br>
<span class="lineno">290</span><span class="op" id="7936596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7936599">func</span>&nbsp;<span class="ident" id="7936604">differentWildcardAddr</span><span class="op" id="7936625">(</span><span class="ident" id="7936626">i</span><span class="op" id="7936627">,</span>&nbsp;<span class="ident" id="7936629">j</span>&nbsp;<span class="builtintype" id="7936631">string</span><span class="op" id="7936637">)</span>&nbsp;<span class="builtintype" id="7936639">bool</span>&nbsp;<span class="op" id="7936644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936647">if</span>&nbsp;<span class="op" id="7936650">(</span><span class="ident" id="7936651">i</span>&nbsp;<span class="op" id="7936653">==</span>&nbsp;<span class="string" id="7936656">&#34;&#34;</span>&nbsp;<span class="op" id="7936659">||</span>&nbsp;<span class="ident" id="7936662">i</span>&nbsp;<span class="op" id="7936664">==</span>&nbsp;<span class="string" id="7936667">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="7936677">||</span>&nbsp;<span class="ident" id="7936680">i</span>&nbsp;<span class="op" id="7936682">==</span>&nbsp;<span class="string" id="7936685">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="7936701">)</span>&nbsp;<span class="op" id="7936703">&amp;&amp;</span>&nbsp;<span class="op" id="7936706">(</span><span class="ident" id="7936707">j</span>&nbsp;<span class="op" id="7936709">==</span>&nbsp;<span class="string" id="7936712">&#34;&#34;</span>&nbsp;<span class="op" id="7936715">||</span>&nbsp;<span class="ident" id="7936718">j</span>&nbsp;<span class="op" id="7936720">==</span>&nbsp;<span class="string" id="7936723">&#34;0.0.0.0&#34;</span>&nbsp;<span class="op" id="7936733">||</span>&nbsp;<span class="ident" id="7936736">j</span>&nbsp;<span class="op" id="7936738">==</span>&nbsp;<span class="string" id="7936741">&#34;::ffff:0.0.0.0&#34;</span><span class="op" id="7936757">)</span>&nbsp;<span class="op" id="7936759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936763">return</span>&nbsp;<span class="builtintype" id="7936770">false</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936780">if</span>&nbsp;<span class="ident" id="7936783">i</span>&nbsp;<span class="op" id="7936785">==</span>&nbsp;<span class="string" id="7936788">&#34;[::]&#34;</span>&nbsp;<span class="op" id="7936795">&amp;&amp;</span>&nbsp;<span class="ident" id="7936798">j</span>&nbsp;<span class="op" id="7936800">==</span>&nbsp;<span class="string" id="7936803">&#34;[::]&#34;</span>&nbsp;<span class="op" id="7936810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936814">return</span>&nbsp;<span class="builtintype" id="7936821">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7936828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936831">return</span>&nbsp;<span class="builtintype" id="7936838">true</span><br>
<span class="lineno">300</span><span class="op" id="7936843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7936846">func</span>&nbsp;<span class="ident" id="7936851">checkFirstListener</span><span class="op" id="7936869">(</span><span class="ident" id="7936870">t</span>&nbsp;<span class="op" id="7936872">*</span><span class="ident" id="7936873">testing</span><span class="op" id="7936880">.</span><span class="ident" id="7936881">T</span><span class="op" id="7936882">,</span>&nbsp;<span class="ident" id="7936884">net</span><span class="op" id="7936887">,</span>&nbsp;<span class="ident" id="7936889">laddr</span>&nbsp;<span class="builtintype" id="7936895">string</span><span class="op" id="7936901">,</span>&nbsp;<span class="ident" id="7936903">l</span>&nbsp;<span class="keyword" id="7936905">interface</span><span class="op" id="7936914">{</span><span class="op" id="7936915">}</span><span class="op" id="7936916">)</span>&nbsp;<span class="op" id="7936918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936921">switch</span>&nbsp;<span class="ident" id="7936928">net</span>&nbsp;<span class="op" id="7936932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7936935">case</span>&nbsp;<span class="string" id="7936940">&#34;tcp&#34;</span><span class="op" id="7936945">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936949">fd</span>&nbsp;<span class="op" id="7936952">:=</span>&nbsp;<span class="ident" id="7936955">l</span><span class="op" id="7936956">.</span><span class="op" id="7936957">(</span><span class="op" id="7936958">*</span><span class="ident" id="7936959">TCPListener</span><span class="op" id="7936970">)</span><span class="op" id="7936971">.</span><span class="ident" id="7936972">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7936977">checkDualStackAddrFamily</span><span class="op" id="7937001">(</span><span class="ident" id="7937002">t</span><span class="op" id="7937003">,</span>&nbsp;<span class="ident" id="7937005">net</span><span class="op" id="7937008">,</span>&nbsp;<span class="ident" id="7937010">laddr</span><span class="op" id="7937015">,</span>&nbsp;<span class="ident" id="7937017">fd</span><span class="op" id="7937019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937022">case</span>&nbsp;<span class="string" id="7937027">&#34;tcp4&#34;</span><span class="op" id="7937033">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937037">fd</span>&nbsp;<span class="op" id="7937040">:=</span>&nbsp;<span class="ident" id="7937043">l</span><span class="op" id="7937044">.</span><span class="op" id="7937045">(</span><span class="op" id="7937046">*</span><span class="ident" id="7937047">TCPListener</span><span class="op" id="7937058">)</span><span class="op" id="7937059">.</span><span class="ident" id="7937060">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937065">if</span>&nbsp;<span class="ident" id="7937068">fd</span><span class="op" id="7937070">.</span><span class="ident" id="7937071">family</span>&nbsp;<span class="op" id="7937078">!=</span>&nbsp;<span class="ident" id="7937081">syscall</span><span class="op" id="7937088">.</span><span class="ident" id="7937089">AF_INET</span>&nbsp;<span class="op" id="7937097">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937102">t</span><span class="op" id="7937103">.</span><span class="ident" id="7937104">Fatalf</span><span class="op" id="7937110">(</span><span class="string" id="7937111">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7937172">,</span>&nbsp;<span class="ident" id="7937174">net</span><span class="op" id="7937177">,</span>&nbsp;<span class="ident" id="7937179">laddr</span><span class="op" id="7937184">,</span>&nbsp;<span class="ident" id="7937186">fd</span><span class="op" id="7937188">.</span><span class="ident" id="7937189">family</span><span class="op" id="7937195">,</span>&nbsp;<span class="ident" id="7937197">syscall</span><span class="op" id="7937204">.</span><span class="ident" id="7937205">AF_INET</span><span class="op" id="7937212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937219">case</span>&nbsp;<span class="string" id="7937224">&#34;tcp6&#34;</span><span class="op" id="7937230">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937234">fd</span>&nbsp;<span class="op" id="7937237">:=</span>&nbsp;<span class="ident" id="7937240">l</span><span class="op" id="7937241">.</span><span class="op" id="7937242">(</span><span class="op" id="7937243">*</span><span class="ident" id="7937244">TCPListener</span><span class="op" id="7937255">)</span><span class="op" id="7937256">.</span><span class="ident" id="7937257">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937262">if</span>&nbsp;<span class="ident" id="7937265">fd</span><span class="op" id="7937267">.</span><span class="ident" id="7937268">family</span>&nbsp;<span class="op" id="7937275">!=</span>&nbsp;<span class="ident" id="7937278">syscall</span><span class="op" id="7937285">.</span><span class="ident" id="7937286">AF_INET6</span>&nbsp;<span class="op" id="7937295">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937300">t</span><span class="op" id="7937301">.</span><span class="ident" id="7937302">Fatalf</span><span class="op" id="7937308">(</span><span class="string" id="7937309">&#34;First&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7937370">,</span>&nbsp;<span class="ident" id="7937372">net</span><span class="op" id="7937375">,</span>&nbsp;<span class="ident" id="7937377">laddr</span><span class="op" id="7937382">,</span>&nbsp;<span class="ident" id="7937384">fd</span><span class="op" id="7937386">.</span><span class="ident" id="7937387">family</span><span class="op" id="7937393">,</span>&nbsp;<span class="ident" id="7937395">syscall</span><span class="op" id="7937402">.</span><span class="ident" id="7937403">AF_INET6</span><span class="op" id="7937411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937418">case</span>&nbsp;<span class="string" id="7937423">&#34;udp&#34;</span><span class="op" id="7937428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937432">fd</span>&nbsp;<span class="op" id="7937435">:=</span>&nbsp;<span class="ident" id="7937438">l</span><span class="op" id="7937439">.</span><span class="op" id="7937440">(</span><span class="op" id="7937441">*</span><span class="ident" id="7937442">UDPConn</span><span class="op" id="7937449">)</span><span class="op" id="7937450">.</span><span class="ident" id="7937451">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937456">checkDualStackAddrFamily</span><span class="op" id="7937480">(</span><span class="ident" id="7937481">t</span><span class="op" id="7937482">,</span>&nbsp;<span class="ident" id="7937484">net</span><span class="op" id="7937487">,</span>&nbsp;<span class="ident" id="7937489">laddr</span><span class="op" id="7937494">,</span>&nbsp;<span class="ident" id="7937496">fd</span><span class="op" id="7937498">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937501">case</span>&nbsp;<span class="string" id="7937506">&#34;udp4&#34;</span><span class="op" id="7937512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937516">fd</span>&nbsp;<span class="op" id="7937519">:=</span>&nbsp;<span class="ident" id="7937522">l</span><span class="op" id="7937523">.</span><span class="op" id="7937524">(</span><span class="op" id="7937525">*</span><span class="ident" id="7937526">UDPConn</span><span class="op" id="7937533">)</span><span class="op" id="7937534">.</span><span class="ident" id="7937535">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937540">if</span>&nbsp;<span class="ident" id="7937543">fd</span><span class="op" id="7937545">.</span><span class="ident" id="7937546">family</span>&nbsp;<span class="op" id="7937553">!=</span>&nbsp;<span class="ident" id="7937556">syscall</span><span class="op" id="7937563">.</span><span class="ident" id="7937564">AF_INET</span>&nbsp;<span class="op" id="7937572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937577">t</span><span class="op" id="7937578">.</span><span class="ident" id="7937579">Fatalf</span><span class="op" id="7937585">(</span><span class="string" id="7937586">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7937653">,</span>&nbsp;<span class="ident" id="7937655">net</span><span class="op" id="7937658">,</span>&nbsp;<span class="ident" id="7937660">laddr</span><span class="op" id="7937665">,</span>&nbsp;<span class="ident" id="7937667">fd</span><span class="op" id="7937669">.</span><span class="ident" id="7937670">family</span><span class="op" id="7937676">,</span>&nbsp;<span class="ident" id="7937678">syscall</span><span class="op" id="7937685">.</span><span class="ident" id="7937686">AF_INET</span><span class="op" id="7937693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937697">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937700">case</span>&nbsp;<span class="string" id="7937705">&#34;udp6&#34;</span><span class="op" id="7937711">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937715">fd</span>&nbsp;<span class="op" id="7937718">:=</span>&nbsp;<span class="ident" id="7937721">l</span><span class="op" id="7937722">.</span><span class="op" id="7937723">(</span><span class="op" id="7937724">*</span><span class="ident" id="7937725">UDPConn</span><span class="op" id="7937732">)</span><span class="op" id="7937733">.</span><span class="ident" id="7937734">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937739">if</span>&nbsp;<span class="ident" id="7937742">fd</span><span class="op" id="7937744">.</span><span class="ident" id="7937745">family</span>&nbsp;<span class="op" id="7937752">!=</span>&nbsp;<span class="ident" id="7937755">syscall</span><span class="op" id="7937762">.</span><span class="ident" id="7937763">AF_INET6</span>&nbsp;<span class="op" id="7937772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937777">t</span><span class="op" id="7937778">.</span><span class="ident" id="7937779">Fatalf</span><span class="op" id="7937785">(</span><span class="string" id="7937786">&#34;First&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7937853">,</span>&nbsp;<span class="ident" id="7937855">net</span><span class="op" id="7937858">,</span>&nbsp;<span class="ident" id="7937860">laddr</span><span class="op" id="7937865">,</span>&nbsp;<span class="ident" id="7937867">fd</span><span class="op" id="7937869">.</span><span class="ident" id="7937870">family</span><span class="op" id="7937876">,</span>&nbsp;<span class="ident" id="7937878">syscall</span><span class="op" id="7937885">.</span><span class="ident" id="7937886">AF_INET6</span><span class="op" id="7937894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937898">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7937901">default</span><span class="op" id="7937908">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7937912">t</span><span class="op" id="7937913">.</span><span class="ident" id="7937914">Fatalf</span><span class="op" id="7937920">(</span><span class="string" id="7937921">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="7937945">,</span>&nbsp;<span class="ident" id="7937947">net</span><span class="op" id="7937950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7937953">}</span><br>
<span class="lineno"></span><span class="op" id="7937955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="7937958">func</span>&nbsp;<span class="ident" id="7937963">checkSecondListener</span><span class="op" id="7937982">(</span><span class="ident" id="7937983">t</span>&nbsp;<span class="op" id="7937985">*</span><span class="ident" id="7937986">testing</span><span class="op" id="7937993">.</span><span class="ident" id="7937994">T</span><span class="op" id="7937995">,</span>&nbsp;<span class="ident" id="7937997">net</span><span class="op" id="7938000">,</span>&nbsp;<span class="ident" id="7938002">laddr</span>&nbsp;<span class="builtintype" id="7938008">string</span><span class="op" id="7938014">,</span>&nbsp;<span class="ident" id="7938016">err</span>&nbsp;<span class="builtintype" id="7938020">error</span><span class="op" id="7938025">,</span>&nbsp;<span class="ident" id="7938027">l</span>&nbsp;<span class="keyword" id="7938029">interface</span><span class="op" id="7938038">{</span><span class="op" id="7938039">}</span><span class="op" id="7938040">)</span>&nbsp;<span class="op" id="7938042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938045">switch</span>&nbsp;<span class="ident" id="7938052">net</span>&nbsp;<span class="op" id="7938056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938059">case</span>&nbsp;<span class="string" id="7938064">&#34;tcp&#34;</span><span class="op" id="7938069">,</span>&nbsp;<span class="string" id="7938071">&#34;tcp4&#34;</span><span class="op" id="7938077">,</span>&nbsp;<span class="string" id="7938079">&#34;tcp6&#34;</span><span class="op" id="7938085">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938089">if</span>&nbsp;<span class="ident" id="7938092">err</span>&nbsp;<span class="op" id="7938096">==</span>&nbsp;<span class="ident" id="7938099">nil</span>&nbsp;<span class="op" id="7938103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938108">l</span><span class="op" id="7938109">.</span><span class="op" id="7938110">(</span><span class="op" id="7938111">*</span><span class="ident" id="7938112">TCPListener</span><span class="op" id="7938123">)</span><span class="op" id="7938124">.</span><span class="ident" id="7938125">Close</span><span class="op" id="7938130">(</span><span class="op" id="7938131">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938136">t</span><span class="op" id="7938137">.</span><span class="ident" id="7938138">Fatalf</span><span class="op" id="7938144">(</span><span class="string" id="7938145">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7938180">,</span>&nbsp;<span class="ident" id="7938182">net</span><span class="op" id="7938185">,</span>&nbsp;<span class="ident" id="7938187">laddr</span><span class="op" id="7938192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938199">case</span>&nbsp;<span class="string" id="7938204">&#34;udp&#34;</span><span class="op" id="7938209">,</span>&nbsp;<span class="string" id="7938211">&#34;udp4&#34;</span><span class="op" id="7938217">,</span>&nbsp;<span class="string" id="7938219">&#34;udp6&#34;</span><span class="op" id="7938225">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938229">if</span>&nbsp;<span class="ident" id="7938232">err</span>&nbsp;<span class="op" id="7938236">==</span>&nbsp;<span class="ident" id="7938239">nil</span>&nbsp;<span class="op" id="7938243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938248">l</span><span class="op" id="7938249">.</span><span class="op" id="7938250">(</span><span class="op" id="7938251">*</span><span class="ident" id="7938252">UDPConn</span><span class="op" id="7938259">)</span><span class="op" id="7938260">.</span><span class="ident" id="7938261">Close</span><span class="op" id="7938266">(</span><span class="op" id="7938267">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938272">t</span><span class="op" id="7938273">.</span><span class="ident" id="7938274">Fatalf</span><span class="op" id="7938280">(</span><span class="string" id="7938281">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7938322">,</span>&nbsp;<span class="ident" id="7938324">net</span><span class="op" id="7938327">,</span>&nbsp;<span class="ident" id="7938329">laddr</span><span class="op" id="7938334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938341">default</span><span class="op" id="7938348">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938352">t</span><span class="op" id="7938353">.</span><span class="ident" id="7938354">Fatalf</span><span class="op" id="7938360">(</span><span class="string" id="7938361">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="7938385">,</span>&nbsp;<span class="ident" id="7938387">net</span><span class="op" id="7938390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938393">}</span><br>
<span class="lineno">350</span><span class="op" id="7938395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7938398">func</span>&nbsp;<span class="ident" id="7938403">checkDualStackSecondListener</span><span class="op" id="7938431">(</span><span class="ident" id="7938432">t</span>&nbsp;<span class="op" id="7938434">*</span><span class="ident" id="7938435">testing</span><span class="op" id="7938442">.</span><span class="ident" id="7938443">T</span><span class="op" id="7938444">,</span>&nbsp;<span class="ident" id="7938446">net</span><span class="op" id="7938449">,</span>&nbsp;<span class="ident" id="7938451">laddr</span>&nbsp;<span class="builtintype" id="7938457">string</span><span class="op" id="7938463">,</span>&nbsp;<span class="ident" id="7938465">xerr</span><span class="op" id="7938469">,</span>&nbsp;<span class="ident" id="7938471">err</span>&nbsp;<span class="builtintype" id="7938475">error</span><span class="op" id="7938480">,</span>&nbsp;<span class="ident" id="7938482">l</span>&nbsp;<span class="keyword" id="7938484">interface</span><span class="op" id="7938493">{</span><span class="op" id="7938494">}</span><span class="op" id="7938495">)</span>&nbsp;<span class="op" id="7938497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938500">switch</span>&nbsp;<span class="ident" id="7938507">net</span>&nbsp;<span class="op" id="7938511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938514">case</span>&nbsp;<span class="string" id="7938519">&#34;tcp&#34;</span><span class="op" id="7938524">,</span>&nbsp;<span class="string" id="7938526">&#34;tcp4&#34;</span><span class="op" id="7938532">,</span>&nbsp;<span class="string" id="7938534">&#34;tcp6&#34;</span><span class="op" id="7938540">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938544">if</span>&nbsp;<span class="ident" id="7938547">xerr</span>&nbsp;<span class="op" id="7938552">==</span>&nbsp;<span class="ident" id="7938555">nil</span>&nbsp;<span class="op" id="7938559">&amp;&amp;</span>&nbsp;<span class="ident" id="7938562">err</span>&nbsp;<span class="op" id="7938566">!=</span>&nbsp;<span class="ident" id="7938569">nil</span>&nbsp;<span class="op" id="7938573">||</span>&nbsp;<span class="ident" id="7938576">xerr</span>&nbsp;<span class="op" id="7938581">!=</span>&nbsp;<span class="ident" id="7938584">nil</span>&nbsp;<span class="op" id="7938588">&amp;&amp;</span>&nbsp;<span class="ident" id="7938591">err</span>&nbsp;<span class="op" id="7938595">==</span>&nbsp;<span class="ident" id="7938598">nil</span>&nbsp;<span class="op" id="7938602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938607">t</span><span class="op" id="7938608">.</span><span class="ident" id="7938609">Fatalf</span><span class="op" id="7938615">(</span><span class="string" id="7938616">&#34;Second&nbsp;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7938663">,</span>&nbsp;<span class="ident" id="7938665">net</span><span class="op" id="7938668">,</span>&nbsp;<span class="ident" id="7938670">laddr</span><span class="op" id="7938675">,</span>&nbsp;<span class="ident" id="7938677">err</span><span class="op" id="7938680">,</span>&nbsp;<span class="ident" id="7938682">xerr</span><span class="op" id="7938686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938694">if</span>&nbsp;<span class="ident" id="7938697">err</span>&nbsp;<span class="op" id="7938701">==</span>&nbsp;<span class="ident" id="7938704">nil</span>&nbsp;<span class="op" id="7938708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938713">l</span><span class="op" id="7938714">.</span><span class="op" id="7938715">(</span><span class="op" id="7938716">*</span><span class="ident" id="7938717">TCPListener</span><span class="op" id="7938728">)</span><span class="op" id="7938729">.</span><span class="ident" id="7938730">Close</span><span class="op" id="7938735">(</span><span class="op" id="7938736">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938743">case</span>&nbsp;<span class="string" id="7938748">&#34;udp&#34;</span><span class="op" id="7938753">,</span>&nbsp;<span class="string" id="7938755">&#34;udp4&#34;</span><span class="op" id="7938761">,</span>&nbsp;<span class="string" id="7938763">&#34;udp6&#34;</span><span class="op" id="7938769">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938773">if</span>&nbsp;<span class="ident" id="7938776">xerr</span>&nbsp;<span class="op" id="7938781">==</span>&nbsp;<span class="ident" id="7938784">nil</span>&nbsp;<span class="op" id="7938788">&amp;&amp;</span>&nbsp;<span class="ident" id="7938791">err</span>&nbsp;<span class="op" id="7938795">!=</span>&nbsp;<span class="ident" id="7938798">nil</span>&nbsp;<span class="op" id="7938802">||</span>&nbsp;<span class="ident" id="7938805">xerr</span>&nbsp;<span class="op" id="7938810">!=</span>&nbsp;<span class="ident" id="7938813">nil</span>&nbsp;<span class="op" id="7938817">&amp;&amp;</span>&nbsp;<span class="ident" id="7938820">err</span>&nbsp;<span class="op" id="7938824">==</span>&nbsp;<span class="ident" id="7938827">nil</span>&nbsp;<span class="op" id="7938831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938836">t</span><span class="op" id="7938837">.</span><span class="ident" id="7938838">Fatalf</span><span class="op" id="7938844">(</span><span class="string" id="7938845">&#34;Second&nbsp;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7938898">,</span>&nbsp;<span class="ident" id="7938900">net</span><span class="op" id="7938903">,</span>&nbsp;<span class="ident" id="7938905">laddr</span><span class="op" id="7938910">,</span>&nbsp;<span class="ident" id="7938912">err</span><span class="op" id="7938915">,</span>&nbsp;<span class="ident" id="7938917">xerr</span><span class="op" id="7938921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938925">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938929">if</span>&nbsp;<span class="ident" id="7938932">err</span>&nbsp;<span class="op" id="7938936">==</span>&nbsp;<span class="ident" id="7938939">nil</span>&nbsp;<span class="op" id="7938943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938948">l</span><span class="op" id="7938949">.</span><span class="op" id="7938950">(</span><span class="op" id="7938951">*</span><span class="ident" id="7938952">UDPConn</span><span class="op" id="7938959">)</span><span class="op" id="7938960">.</span><span class="ident" id="7938961">Close</span><span class="op" id="7938966">(</span><span class="op" id="7938967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7938971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7938974">default</span><span class="op" id="7938981">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7938985">t</span><span class="op" id="7938986">.</span><span class="ident" id="7938987">Fatalf</span><span class="op" id="7938993">(</span><span class="string" id="7938994">&#34;Unexpected&nbsp;network:&nbsp;%q&#34;</span><span class="op" id="7939018">,</span>&nbsp;<span class="ident" id="7939020">net</span><span class="op" id="7939023">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939026">}</span><br>
<span class="lineno"></span><span class="op" id="7939028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7939031">func</span>&nbsp;<span class="ident" id="7939036">checkDualStackAddrFamily</span><span class="op" id="7939060">(</span><span class="ident" id="7939061">t</span>&nbsp;<span class="op" id="7939063">*</span><span class="ident" id="7939064">testing</span><span class="op" id="7939071">.</span><span class="ident" id="7939072">T</span><span class="op" id="7939073">,</span>&nbsp;<span class="ident" id="7939075">net</span><span class="op" id="7939078">,</span>&nbsp;<span class="ident" id="7939080">laddr</span>&nbsp;<span class="builtintype" id="7939086">string</span><span class="op" id="7939092">,</span>&nbsp;<span class="ident" id="7939094">fd</span>&nbsp;<span class="op" id="7939097">*</span><span class="ident" id="7939098">netFD</span><span class="op" id="7939103">)</span>&nbsp;<span class="op" id="7939105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939108">switch</span>&nbsp;<span class="ident" id="7939115">a</span>&nbsp;<span class="op" id="7939117">:=</span>&nbsp;<span class="ident" id="7939120">fd</span><span class="op" id="7939122">.</span><span class="ident" id="7939123">laddr</span><span class="op" id="7939128">.</span><span class="op" id="7939129">(</span><span class="keyword" id="7939130">type</span><span class="op" id="7939134">)</span>&nbsp;<span class="op" id="7939136">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939139">case</span>&nbsp;<span class="op" id="7939144">*</span><span class="ident" id="7939145">TCPAddr</span><span class="op" id="7939152">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939156">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939212">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939265">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939322">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939344">if</span>&nbsp;<span class="ident" id="7939347">supportsIPv4map</span>&nbsp;<span class="op" id="7939363">&amp;&amp;</span>&nbsp;<span class="ident" id="7939366">fd</span><span class="op" id="7939368">.</span><span class="ident" id="7939369">laddr</span><span class="op" id="7939374">.</span><span class="op" id="7939375">(</span><span class="op" id="7939376">*</span><span class="ident" id="7939377">TCPAddr</span><span class="op" id="7939384">)</span><span class="op" id="7939385">.</span><span class="ident" id="7939386">isWildcard</span><span class="op" id="7939396">(</span><span class="op" id="7939397">)</span>&nbsp;<span class="op" id="7939399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939404">if</span>&nbsp;<span class="ident" id="7939407">fd</span><span class="op" id="7939409">.</span><span class="ident" id="7939410">family</span>&nbsp;<span class="op" id="7939417">!=</span>&nbsp;<span class="ident" id="7939420">syscall</span><span class="op" id="7939427">.</span><span class="ident" id="7939428">AF_INET6</span>&nbsp;<span class="op" id="7939437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939443">t</span><span class="op" id="7939444">.</span><span class="ident" id="7939445">Fatalf</span><span class="op" id="7939451">(</span><span class="string" id="7939452">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7939507">,</span>&nbsp;<span class="ident" id="7939509">net</span><span class="op" id="7939512">,</span>&nbsp;<span class="ident" id="7939514">laddr</span><span class="op" id="7939519">,</span>&nbsp;<span class="ident" id="7939521">fd</span><span class="op" id="7939523">.</span><span class="ident" id="7939524">family</span><span class="op" id="7939530">,</span>&nbsp;<span class="ident" id="7939532">syscall</span><span class="op" id="7939539">.</span><span class="ident" id="7939540">AF_INET6</span><span class="op" id="7939548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939557">}</span>&nbsp;<span class="keyword" id="7939559">else</span>&nbsp;<span class="op" id="7939564">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939569">if</span>&nbsp;<span class="ident" id="7939572">fd</span><span class="op" id="7939574">.</span><span class="ident" id="7939575">family</span>&nbsp;<span class="op" id="7939582">!=</span>&nbsp;<span class="ident" id="7939585">a</span><span class="op" id="7939586">.</span><span class="ident" id="7939587">family</span><span class="op" id="7939593">(</span><span class="op" id="7939594">)</span>&nbsp;<span class="op" id="7939596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7939602">t</span><span class="op" id="7939603">.</span><span class="ident" id="7939604">Fatalf</span><span class="op" id="7939610">(</span><span class="string" id="7939611">&#34;Listen(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7939666">,</span>&nbsp;<span class="ident" id="7939668">net</span><span class="op" id="7939671">,</span>&nbsp;<span class="ident" id="7939673">laddr</span><span class="op" id="7939678">,</span>&nbsp;<span class="ident" id="7939680">fd</span><span class="op" id="7939682">.</span><span class="ident" id="7939683">family</span><span class="op" id="7939689">,</span>&nbsp;<span class="ident" id="7939691">a</span><span class="op" id="7939692">.</span><span class="ident" id="7939693">family</span><span class="op" id="7939699">(</span><span class="op" id="7939700">)</span><span class="op" id="7939701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7939710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939713">case</span>&nbsp;<span class="op" id="7939718">*</span><span class="ident" id="7939719">UDPAddr</span><span class="op" id="7939726">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939730">//&nbsp;If&nbsp;a&nbsp;node&nbsp;under&nbsp;test&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939786">//&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;capability,&nbsp;we&nbsp;can&nbsp;assume</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939839">//&nbsp;that&nbsp;the&nbsp;node&nbsp;listens&nbsp;on&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7939896">//&nbsp;AF_INET6&nbsp;socket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939918">if</span>&nbsp;<span class="ident" id="7939921">supportsIPv4map</span>&nbsp;<span class="op" id="7939937">&amp;&amp;</span>&nbsp;<span class="ident" id="7939940">fd</span><span class="op" id="7939942">.</span><span class="ident" id="7939943">laddr</span><span class="op" id="7939948">.</span><span class="op" id="7939949">(</span><span class="op" id="7939950">*</span><span class="ident" id="7939951">UDPAddr</span><span class="op" id="7939958">)</span><span class="op" id="7939959">.</span><span class="ident" id="7939960">isWildcard</span><span class="op" id="7939970">(</span><span class="op" id="7939971">)</span>&nbsp;<span class="op" id="7939973">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7939978">if</span>&nbsp;<span class="ident" id="7939981">fd</span><span class="op" id="7939983">.</span><span class="ident" id="7939984">family</span>&nbsp;<span class="op" id="7939991">!=</span>&nbsp;<span class="ident" id="7939994">syscall</span><span class="op" id="7940001">.</span><span class="ident" id="7940002">AF_INET6</span>&nbsp;<span class="op" id="7940011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940017">t</span><span class="op" id="7940018">.</span><span class="ident" id="7940019">Fatalf</span><span class="op" id="7940025">(</span><span class="string" id="7940026">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7940087">,</span>&nbsp;<span class="ident" id="7940089">net</span><span class="op" id="7940092">,</span>&nbsp;<span class="ident" id="7940094">laddr</span><span class="op" id="7940099">,</span>&nbsp;<span class="ident" id="7940101">fd</span><span class="op" id="7940103">.</span><span class="ident" id="7940104">family</span><span class="op" id="7940110">,</span>&nbsp;<span class="ident" id="7940112">syscall</span><span class="op" id="7940119">.</span><span class="ident" id="7940120">AF_INET6</span><span class="op" id="7940128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940137">}</span>&nbsp;<span class="keyword" id="7940139">else</span>&nbsp;<span class="op" id="7940144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940149">if</span>&nbsp;<span class="ident" id="7940152">fd</span><span class="op" id="7940154">.</span><span class="ident" id="7940155">family</span>&nbsp;<span class="op" id="7940162">!=</span>&nbsp;<span class="ident" id="7940165">a</span><span class="op" id="7940166">.</span><span class="ident" id="7940167">family</span><span class="op" id="7940173">(</span><span class="op" id="7940174">)</span>&nbsp;<span class="op" id="7940176">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940182">t</span><span class="op" id="7940183">.</span><span class="ident" id="7940184">Fatalf</span><span class="op" id="7940190">(</span><span class="string" id="7940191">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;returns&nbsp;address&nbsp;family&nbsp;%v,&nbsp;expected&nbsp;%v&#34;</span><span class="op" id="7940252">,</span>&nbsp;<span class="ident" id="7940254">net</span><span class="op" id="7940257">,</span>&nbsp;<span class="ident" id="7940259">laddr</span><span class="op" id="7940264">,</span>&nbsp;<span class="ident" id="7940266">fd</span><span class="op" id="7940268">.</span><span class="ident" id="7940269">family</span><span class="op" id="7940275">,</span>&nbsp;<span class="ident" id="7940277">a</span><span class="op" id="7940278">.</span><span class="ident" id="7940279">family</span><span class="op" id="7940285">(</span><span class="op" id="7940286">)</span><span class="op" id="7940287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940299">default</span><span class="op" id="7940306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940310">t</span><span class="op" id="7940311">.</span><span class="ident" id="7940312">Fatalf</span><span class="op" id="7940318">(</span><span class="string" id="7940319">&#34;Unexpected&nbsp;protocol&nbsp;address&nbsp;type:&nbsp;%T&#34;</span><span class="op" id="7940357">,</span>&nbsp;<span class="ident" id="7940359">a</span><span class="op" id="7940360">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940363">}</span><br>
<span class="lineno"></span><span class="op" id="7940365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7940368">var</span>&nbsp;<span class="ident" id="7940372">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="7940399">=</span>&nbsp;<span class="op" id="7940401">[</span><span class="op" id="7940402">]</span><span class="keyword" id="7940403">struct</span>&nbsp;<span class="op" id="7940410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940413">net</span>&nbsp;&nbsp;<span class="builtintype" id="7940418">string</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940426">addr</span>&nbsp;<span class="builtintype" id="7940431">string</span><br>
<span class="lineno"></span><span class="op" id="7940438">}</span><span class="op" id="7940439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940442">{</span><span class="string" id="7940443">&#34;tcp6&#34;</span><span class="op" id="7940449">,</span>&nbsp;<span class="string" id="7940451">&#34;127.0.0.1&#34;</span><span class="op" id="7940462">}</span><span class="op" id="7940463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940466">{</span><span class="string" id="7940467">&#34;tcp6&#34;</span><span class="op" id="7940473">,</span>&nbsp;<span class="string" id="7940475">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7940495">}</span><span class="op" id="7940496">,</span><br>
<span class="lineno"></span><span class="op" id="7940498">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="7940501">func</span>&nbsp;<span class="ident" id="7940506">TestProhibitionaryDialArgs</span><span class="op" id="7940532">(</span><span class="ident" id="7940533">t</span>&nbsp;<span class="op" id="7940535">*</span><span class="ident" id="7940536">testing</span><span class="op" id="7940543">.</span><span class="ident" id="7940544">T</span><span class="op" id="7940545">)</span>&nbsp;<span class="op" id="7940547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940550">switch</span>&nbsp;<span class="ident" id="7940557">runtime</span><span class="op" id="7940564">.</span><span class="ident" id="7940565">GOOS</span>&nbsp;<span class="op" id="7940570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940573">case</span>&nbsp;<span class="string" id="7940578">&#34;plan9&#34;</span><span class="op" id="7940585">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940589">t</span><span class="op" id="7940590">.</span><span class="ident" id="7940591">Skipf</span><span class="op" id="7940596">(</span><span class="string" id="7940597">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7940618">,</span>&nbsp;<span class="ident" id="7940620">runtime</span><span class="op" id="7940627">.</span><span class="ident" id="7940628">GOOS</span><span class="op" id="7940632">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7940638">//&nbsp;This&nbsp;test&nbsp;requires&nbsp;both&nbsp;IPv6&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940708">if</span>&nbsp;<span class="op" id="7940711">!</span><span class="ident" id="7940712">supportsIPv4map</span>&nbsp;<span class="op" id="7940728">||</span>&nbsp;<span class="ident" id="7940731">testing</span><span class="op" id="7940738">.</span><span class="ident" id="7940739">Short</span><span class="op" id="7940744">(</span><span class="op" id="7940745">)</span>&nbsp;<span class="op" id="7940747">||</span>&nbsp;<span class="op" id="7940750">!</span><span class="op" id="7940751">*</span><span class="ident" id="7940752">testExternal</span>&nbsp;<span class="op" id="7940765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940769">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7940777">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940781">l</span><span class="op" id="7940782">,</span>&nbsp;<span class="ident" id="7940784">port</span>&nbsp;<span class="op" id="7940789">:=</span>&nbsp;<span class="ident" id="7940792">usableListenPort</span><span class="op" id="7940808">(</span><span class="ident" id="7940809">t</span><span class="op" id="7940810">,</span>&nbsp;<span class="string" id="7940812">&#34;tcp&#34;</span><span class="op" id="7940817">,</span>&nbsp;<span class="string" id="7940819">&#34;[::]&#34;</span><span class="op" id="7940825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940828">defer</span>&nbsp;<span class="ident" id="7940834">l</span><span class="op" id="7940835">.</span><span class="ident" id="7940836">Close</span><span class="op" id="7940841">(</span><span class="op" id="7940842">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940846">for</span>&nbsp;<span class="ident" id="7940850">_</span><span class="op" id="7940851">,</span>&nbsp;<span class="ident" id="7940853">tt</span>&nbsp;<span class="op" id="7940856">:=</span>&nbsp;<span class="keyword" id="7940859">range</span>&nbsp;<span class="ident" id="7940865">prohibitionaryDialArgTests</span>&nbsp;<span class="op" id="7940892">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940896">c</span><span class="op" id="7940897">,</span>&nbsp;<span class="ident" id="7940899">err</span>&nbsp;<span class="op" id="7940903">:=</span>&nbsp;<span class="ident" id="7940906">Dial</span><span class="op" id="7940910">(</span><span class="ident" id="7940911">tt</span><span class="op" id="7940913">.</span><span class="ident" id="7940914">net</span><span class="op" id="7940917">,</span>&nbsp;<span class="ident" id="7940919">tt</span><span class="op" id="7940921">.</span><span class="ident" id="7940922">addr</span><span class="op" id="7940926">+</span><span class="string" id="7940927">&#34;:&#34;</span><span class="op" id="7940930">+</span><span class="ident" id="7940931">port</span><span class="op" id="7940935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7940939">if</span>&nbsp;<span class="ident" id="7940942">err</span>&nbsp;<span class="op" id="7940946">==</span>&nbsp;<span class="ident" id="7940949">nil</span>&nbsp;<span class="op" id="7940953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940958">c</span><span class="op" id="7940959">.</span><span class="ident" id="7940960">Close</span><span class="op" id="7940965">(</span><span class="op" id="7940966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7940971">t</span><span class="op" id="7940972">.</span><span class="ident" id="7940973">Fatalf</span><span class="op" id="7940979">(</span><span class="string" id="7940980">&#34;Dial(%q,&nbsp;%q)&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7941006">,</span>&nbsp;<span class="ident" id="7941008">tt</span><span class="op" id="7941010">.</span><span class="ident" id="7941011">net</span><span class="op" id="7941014">,</span>&nbsp;<span class="ident" id="7941016">tt</span><span class="op" id="7941018">.</span><span class="ident" id="7941019">addr</span><span class="op" id="7941023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941027">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941030">}</span><br>
<span class="lineno"></span><span class="op" id="7941032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7941035">func</span>&nbsp;<span class="ident" id="7941040">TestWildWildcardListener</span><span class="op" id="7941064">(</span><span class="ident" id="7941065">t</span>&nbsp;<span class="op" id="7941067">*</span><span class="ident" id="7941068">testing</span><span class="op" id="7941075">.</span><span class="ident" id="7941076">T</span><span class="op" id="7941077">)</span>&nbsp;<span class="op" id="7941079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941082">switch</span>&nbsp;<span class="ident" id="7941089">runtime</span><span class="op" id="7941096">.</span><span class="ident" id="7941097">GOOS</span>&nbsp;<span class="op" id="7941102">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941105">case</span>&nbsp;<span class="string" id="7941110">&#34;plan9&#34;</span><span class="op" id="7941117">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941121">t</span><span class="op" id="7941122">.</span><span class="ident" id="7941123">Skipf</span><span class="op" id="7941128">(</span><span class="string" id="7941129">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7941150">,</span>&nbsp;<span class="ident" id="7941152">runtime</span><span class="op" id="7941159">.</span><span class="ident" id="7941160">GOOS</span><span class="op" id="7941164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941171">if</span>&nbsp;<span class="ident" id="7941174">testing</span><span class="op" id="7941181">.</span><span class="ident" id="7941182">Short</span><span class="op" id="7941187">(</span><span class="op" id="7941188">)</span>&nbsp;<span class="op" id="7941190">||</span>&nbsp;<span class="op" id="7941193">!</span><span class="op" id="7941194">*</span><span class="ident" id="7941195">testExternal</span>&nbsp;<span class="op" id="7941208">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941212">t</span><span class="op" id="7941213">.</span><span class="ident" id="7941214">Skip</span><span class="op" id="7941218">(</span><span class="string" id="7941219">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7941260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941267">defer</span>&nbsp;<span class="keyword" id="7941273">func</span><span class="op" id="7941277">(</span><span class="op" id="7941278">)</span>&nbsp;<span class="op" id="7941280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941284">if</span>&nbsp;<span class="ident" id="7941287">p</span>&nbsp;<span class="op" id="7941289">:=</span>&nbsp;<span class="builtinfunc" id="7941292">recover</span><span class="op" id="7941299">(</span><span class="op" id="7941300">)</span><span class="op" id="7941301">;</span>&nbsp;<span class="ident" id="7941303">p</span>&nbsp;<span class="op" id="7941305">!=</span>&nbsp;<span class="ident" id="7941308">nil</span>&nbsp;<span class="op" id="7941312">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941317">t</span><span class="op" id="7941318">.</span><span class="ident" id="7941319">Fatalf</span><span class="op" id="7941325">(</span><span class="string" id="7941326">&#34;Listen,&nbsp;ListenPacket&nbsp;or&nbsp;protocol-specific&nbsp;Listen&nbsp;panicked:&nbsp;%v&#34;</span><span class="op" id="7941389">,</span>&nbsp;<span class="ident" id="7941391">p</span><span class="op" id="7941392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941399">}</span><span class="op" id="7941400">(</span><span class="op" id="7941401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941405">if</span>&nbsp;<span class="ident" id="7941408">ln</span><span class="op" id="7941410">,</span>&nbsp;<span class="ident" id="7941412">err</span>&nbsp;<span class="op" id="7941416">:=</span>&nbsp;<span class="ident" id="7941419">Listen</span><span class="op" id="7941425">(</span><span class="string" id="7941426">&#34;tcp&#34;</span><span class="op" id="7941431">,</span>&nbsp;<span class="string" id="7941433">&#34;&#34;</span><span class="op" id="7941435">)</span><span class="op" id="7941436">;</span>&nbsp;<span class="ident" id="7941438">err</span>&nbsp;<span class="op" id="7941442">==</span>&nbsp;<span class="ident" id="7941445">nil</span>&nbsp;<span class="op" id="7941449">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941453">ln</span><span class="op" id="7941455">.</span><span class="ident" id="7941456">Close</span><span class="op" id="7941461">(</span><span class="op" id="7941462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941468">if</span>&nbsp;<span class="ident" id="7941471">ln</span><span class="op" id="7941473">,</span>&nbsp;<span class="ident" id="7941475">err</span>&nbsp;<span class="op" id="7941479">:=</span>&nbsp;<span class="ident" id="7941482">ListenPacket</span><span class="op" id="7941494">(</span><span class="string" id="7941495">&#34;udp&#34;</span><span class="op" id="7941500">,</span>&nbsp;<span class="string" id="7941502">&#34;&#34;</span><span class="op" id="7941504">)</span><span class="op" id="7941505">;</span>&nbsp;<span class="ident" id="7941507">err</span>&nbsp;<span class="op" id="7941511">==</span>&nbsp;<span class="ident" id="7941514">nil</span>&nbsp;<span class="op" id="7941518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941522">ln</span><span class="op" id="7941524">.</span><span class="ident" id="7941525">Close</span><span class="op" id="7941530">(</span><span class="op" id="7941531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941534">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941537">if</span>&nbsp;<span class="ident" id="7941540">ln</span><span class="op" id="7941542">,</span>&nbsp;<span class="ident" id="7941544">err</span>&nbsp;<span class="op" id="7941548">:=</span>&nbsp;<span class="ident" id="7941551">ListenTCP</span><span class="op" id="7941560">(</span><span class="string" id="7941561">&#34;tcp&#34;</span><span class="op" id="7941566">,</span>&nbsp;<span class="ident" id="7941568">nil</span><span class="op" id="7941571">)</span><span class="op" id="7941572">;</span>&nbsp;<span class="ident" id="7941574">err</span>&nbsp;<span class="op" id="7941578">==</span>&nbsp;<span class="ident" id="7941581">nil</span>&nbsp;<span class="op" id="7941585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941589">ln</span><span class="op" id="7941591">.</span><span class="ident" id="7941592">Close</span><span class="op" id="7941597">(</span><span class="op" id="7941598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941604">if</span>&nbsp;<span class="ident" id="7941607">ln</span><span class="op" id="7941609">,</span>&nbsp;<span class="ident" id="7941611">err</span>&nbsp;<span class="op" id="7941615">:=</span>&nbsp;<span class="ident" id="7941618">ListenUDP</span><span class="op" id="7941627">(</span><span class="string" id="7941628">&#34;udp&#34;</span><span class="op" id="7941633">,</span>&nbsp;<span class="ident" id="7941635">nil</span><span class="op" id="7941638">)</span><span class="op" id="7941639">;</span>&nbsp;<span class="ident" id="7941641">err</span>&nbsp;<span class="op" id="7941645">==</span>&nbsp;<span class="ident" id="7941648">nil</span>&nbsp;<span class="op" id="7941652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941656">ln</span><span class="op" id="7941658">.</span><span class="ident" id="7941659">Close</span><span class="op" id="7941664">(</span><span class="op" id="7941665">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7941671">if</span>&nbsp;<span class="ident" id="7941674">ln</span><span class="op" id="7941676">,</span>&nbsp;<span class="ident" id="7941678">err</span>&nbsp;<span class="op" id="7941682">:=</span>&nbsp;<span class="ident" id="7941685">ListenIP</span><span class="op" id="7941693">(</span><span class="string" id="7941694">&#34;ip:icmp&#34;</span><span class="op" id="7941703">,</span>&nbsp;<span class="ident" id="7941705">nil</span><span class="op" id="7941708">)</span><span class="op" id="7941709">;</span>&nbsp;<span class="ident" id="7941711">err</span>&nbsp;<span class="op" id="7941715">==</span>&nbsp;<span class="ident" id="7941718">nil</span>&nbsp;<span class="op" id="7941722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7941726">ln</span><span class="op" id="7941728">.</span><span class="ident" id="7941729">Close</span><span class="op" id="7941734">(</span><span class="op" id="7941735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7941738">}</span><br>
<span class="lineno"></span><span class="op" id="7941740">}</span>
</div>
</body>
</html>
