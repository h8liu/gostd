<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4415066">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4415121">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4415175">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4415226">package</span>&nbsp;<span class="ident" id="4415234">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4415239">import</span>&nbsp;<span class="op" id="4415246">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4415249">&#34;container/list&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4415267">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4415277">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4415292">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4415307">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4415314">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4415320">&#34;math/big&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4415332">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4415343">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4415351">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4415358">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4415361">const</span>&nbsp;<span class="op" id="4415367">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415370">VersionSSL30</span>&nbsp;<span class="op" id="4415383">=</span>&nbsp;<span class="num" id="4415385">0x0300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415393">VersionTLS10</span>&nbsp;<span class="op" id="4415406">=</span>&nbsp;<span class="num" id="4415408">0x0301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415416">VersionTLS11</span>&nbsp;<span class="op" id="4415429">=</span>&nbsp;<span class="num" id="4415431">0x0302</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415439">VersionTLS12</span>&nbsp;<span class="op" id="4415452">=</span>&nbsp;<span class="num" id="4415454">0x0303</span><br>
<span class="lineno">25</span><span class="op" id="4415461">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4415464">const</span>&nbsp;<span class="op" id="4415470">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415473">maxPlaintext</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4415489">=</span>&nbsp;<span class="num" id="4415491">16384</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4415504">//&nbsp;maximum&nbsp;plaintext&nbsp;payload&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415541">maxCiphertext</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4415557">=</span>&nbsp;<span class="num" id="4415559">16384</span>&nbsp;<span class="op" id="4415565">+</span>&nbsp;<span class="num" id="4415567">2048</span>&nbsp;<span class="comment" id="4415572">//&nbsp;maximum&nbsp;ciphertext&nbsp;payload&nbsp;length</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415610">recordHeaderLen</span>&nbsp;<span class="op" id="4415626">=</span>&nbsp;<span class="num" id="4415628">5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4415641">//&nbsp;record&nbsp;header&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415666">maxHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4415682">=</span>&nbsp;<span class="num" id="4415684">65536</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4415697">//&nbsp;maximum&nbsp;handshake&nbsp;we&nbsp;support&nbsp;(protocol&nbsp;max&nbsp;is&nbsp;16&nbsp;MB)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415755">minVersion</span>&nbsp;<span class="op" id="4415766">=</span>&nbsp;<span class="ident" id="4415768">VersionSSL30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415782">maxVersion</span>&nbsp;<span class="op" id="4415793">=</span>&nbsp;<span class="ident" id="4415795">VersionTLS12</span><br>
<span class="lineno">35</span><span class="op" id="4415808">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4415811">//&nbsp;TLS&nbsp;record&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4415832">type</span>&nbsp;<span class="ident" id="4415837">recordType</span>&nbsp;<span class="builtintype" id="4415848">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="4415855">const</span>&nbsp;<span class="op" id="4415861">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415864">recordTypeChangeCipherSpec</span>&nbsp;<span class="ident" id="4415891">recordType</span>&nbsp;<span class="op" id="4415902">=</span>&nbsp;<span class="num" id="4415904">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415908">recordTypeAlert</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4415935">recordType</span>&nbsp;<span class="op" id="4415946">=</span>&nbsp;<span class="num" id="4415948">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415952">recordTypeHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4415979">recordType</span>&nbsp;<span class="op" id="4415990">=</span>&nbsp;<span class="num" id="4415992">22</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415996">recordTypeApplicationData</span>&nbsp;&nbsp;<span class="ident" id="4416023">recordType</span>&nbsp;<span class="op" id="4416034">=</span>&nbsp;<span class="num" id="4416036">23</span><br>
<span class="lineno">45</span><span class="op" id="4416039">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4416042">//&nbsp;TLS&nbsp;handshake&nbsp;message&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4416074">const</span>&nbsp;<span class="op" id="4416080">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416083">typeClientHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4416106">uint8</span>&nbsp;<span class="op" id="4416112">=</span>&nbsp;<span class="num" id="4416114">1</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416117">typeServerHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4416140">uint8</span>&nbsp;<span class="op" id="4416146">=</span>&nbsp;<span class="num" id="4416148">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416151">typeNewSessionTicket</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4416174">uint8</span>&nbsp;<span class="op" id="4416180">=</span>&nbsp;<span class="num" id="4416182">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416185">typeCertificate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4416208">uint8</span>&nbsp;<span class="op" id="4416214">=</span>&nbsp;<span class="num" id="4416216">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416220">typeServerKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="4416243">uint8</span>&nbsp;<span class="op" id="4416249">=</span>&nbsp;<span class="num" id="4416251">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416255">typeCertificateRequest</span>&nbsp;<span class="builtintype" id="4416278">uint8</span>&nbsp;<span class="op" id="4416284">=</span>&nbsp;<span class="num" id="4416286">13</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416290">typeServerHelloDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4416313">uint8</span>&nbsp;<span class="op" id="4416319">=</span>&nbsp;<span class="num" id="4416321">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416325">typeCertificateVerify</span>&nbsp;&nbsp;<span class="builtintype" id="4416348">uint8</span>&nbsp;<span class="op" id="4416354">=</span>&nbsp;<span class="num" id="4416356">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416360">typeClientKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="4416383">uint8</span>&nbsp;<span class="op" id="4416389">=</span>&nbsp;<span class="num" id="4416391">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416395">typeFinished</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4416418">uint8</span>&nbsp;<span class="op" id="4416424">=</span>&nbsp;<span class="num" id="4416426">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416430">typeCertificateStatus</span>&nbsp;&nbsp;<span class="builtintype" id="4416453">uint8</span>&nbsp;<span class="op" id="4416459">=</span>&nbsp;<span class="num" id="4416461">22</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416465">typeNextProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4416488">uint8</span>&nbsp;<span class="op" id="4416494">=</span>&nbsp;<span class="num" id="4416496">67</span>&nbsp;<span class="comment" id="4416499">//&nbsp;Not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span><span class="op" id="4416520">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4416523">//&nbsp;TLS&nbsp;compression&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4416549">const</span>&nbsp;<span class="op" id="4416555">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416558">compressionNone</span>&nbsp;<span class="builtintype" id="4416574">uint8</span>&nbsp;<span class="op" id="4416580">=</span>&nbsp;<span class="num" id="4416582">0</span><br>
<span class="lineno"></span><span class="op" id="4416584">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4416587">//&nbsp;TLS&nbsp;extension&nbsp;numbers</span><br>
<span class="lineno"></span><span class="keyword" id="4416612">const</span>&nbsp;<span class="op" id="4416618">(</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416621">extensionServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4416650">uint16</span>&nbsp;<span class="op" id="4416657">=</span>&nbsp;<span class="num" id="4416659">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416662">extensionStatusRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4416691">uint16</span>&nbsp;<span class="op" id="4416698">=</span>&nbsp;<span class="num" id="4416700">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416703">extensionSupportedCurves</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4416732">uint16</span>&nbsp;<span class="op" id="4416739">=</span>&nbsp;<span class="num" id="4416741">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416745">extensionSupportedPoints</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4416774">uint16</span>&nbsp;<span class="op" id="4416781">=</span>&nbsp;<span class="num" id="4416783">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416787">extensionSignatureAlgorithms</span>&nbsp;<span class="builtintype" id="4416816">uint16</span>&nbsp;<span class="op" id="4416823">=</span>&nbsp;<span class="num" id="4416825">13</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416829">extensionALPN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4416858">uint16</span>&nbsp;<span class="op" id="4416865">=</span>&nbsp;<span class="num" id="4416867">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416871">extensionSessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4416900">uint16</span>&nbsp;<span class="op" id="4416907">=</span>&nbsp;<span class="num" id="4416909">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416913">extensionNextProtoNeg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4416942">uint16</span>&nbsp;<span class="op" id="4416949">=</span>&nbsp;<span class="num" id="4416951">13172</span>&nbsp;<span class="comment" id="4416957">//&nbsp;not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416979">extensionRenegotiationInfo</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4417008">uint16</span>&nbsp;<span class="op" id="4417015">=</span>&nbsp;<span class="num" id="4417017">0xff01</span><br>
<span class="lineno"></span><span class="op" id="4417024">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="4417027">//&nbsp;TLS&nbsp;signaling&nbsp;cipher&nbsp;suite&nbsp;values</span><br>
<span class="lineno"></span><span class="keyword" id="4417064">const</span>&nbsp;<span class="op" id="4417070">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417073">scsvRenegotiation</span>&nbsp;<span class="builtintype" id="4417091">uint16</span>&nbsp;<span class="op" id="4417098">=</span>&nbsp;<span class="num" id="4417100">0x00ff</span><br>
<span class="lineno"></span><span class="op" id="4417107">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4417110">//&nbsp;CurveID&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;TLS&nbsp;identifier&nbsp;for&nbsp;an&nbsp;elliptic&nbsp;curve.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="4417180">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-8</span><br>
<span class="lineno"></span><span class="keyword" id="4417266">type</span>&nbsp;<span class="ident" id="4417271">CurveID</span>&nbsp;<span class="builtintype" id="4417279">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4417287">const</span>&nbsp;<span class="op" id="4417293">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417296">CurveP256</span>&nbsp;<span class="ident" id="4417306">CurveID</span>&nbsp;<span class="op" id="4417314">=</span>&nbsp;<span class="num" id="4417316">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417320">CurveP384</span>&nbsp;<span class="ident" id="4417330">CurveID</span>&nbsp;<span class="op" id="4417338">=</span>&nbsp;<span class="num" id="4417340">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417344">CurveP521</span>&nbsp;<span class="ident" id="4417354">CurveID</span>&nbsp;<span class="op" id="4417362">=</span>&nbsp;<span class="num" id="4417364">25</span><br>
<span class="lineno"></span><span class="op" id="4417367">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="4417370">//&nbsp;TLS&nbsp;Elliptic&nbsp;Curve&nbsp;Point&nbsp;Formats</span><br>
<span class="lineno"></span><span class="comment" id="4417406">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-9</span><br>
<span class="lineno"></span><span class="keyword" id="4417492">const</span>&nbsp;<span class="op" id="4417498">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417501">pointFormatUncompressed</span>&nbsp;<span class="builtintype" id="4417525">uint8</span>&nbsp;<span class="op" id="4417531">=</span>&nbsp;<span class="num" id="4417533">0</span><br>
<span class="lineno">100</span><span class="op" id="4417535">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4417538">//&nbsp;TLS&nbsp;CertificateStatusType&nbsp;(RFC&nbsp;3546)</span><br>
<span class="lineno"></span><span class="keyword" id="4417578">const</span>&nbsp;<span class="op" id="4417584">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417587">statusTypeOCSP</span>&nbsp;<span class="builtintype" id="4417602">uint8</span>&nbsp;<span class="op" id="4417608">=</span>&nbsp;<span class="num" id="4417610">1</span><br>
<span class="lineno">105</span><span class="op" id="4417612">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4417615">//&nbsp;Certificate&nbsp;types&nbsp;(for&nbsp;certificateRequestMsg)</span><br>
<span class="lineno"></span><span class="keyword" id="4417664">const</span>&nbsp;<span class="op" id="4417670">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417673">certTypeRSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4417692">=</span>&nbsp;<span class="num" id="4417694">1</span>&nbsp;<span class="comment" id="4417696">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417736">certTypeDSSSign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4417755">=</span>&nbsp;<span class="num" id="4417757">2</span>&nbsp;<span class="comment" id="4417759">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;DSA&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417798">certTypeRSAFixedDH</span>&nbsp;<span class="op" id="4417817">=</span>&nbsp;<span class="num" id="4417819">3</span>&nbsp;<span class="comment" id="4417821">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417866">certTypeDSSFixedDH</span>&nbsp;<span class="op" id="4417885">=</span>&nbsp;<span class="num" id="4417887">4</span>&nbsp;<span class="comment" id="4417889">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4417935">//&nbsp;See&nbsp;RFC4492&nbsp;sections&nbsp;3&nbsp;and&nbsp;5.5.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417971">certTypeECDSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4417994">=</span>&nbsp;<span class="num" id="4417996">64</span>&nbsp;<span class="comment" id="4417999">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDSA-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418076">certTypeRSAFixedECDH</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4418099">=</span>&nbsp;<span class="num" id="4418101">65</span>&nbsp;<span class="comment" id="4418104">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;RSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418178">certTypeECDSAFixedECDH</span>&nbsp;<span class="op" id="4418201">=</span>&nbsp;<span class="num" id="4418203">66</span>&nbsp;<span class="comment" id="4418206">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4418283">//&nbsp;Rest&nbsp;of&nbsp;these&nbsp;are&nbsp;reserved&nbsp;by&nbsp;the&nbsp;TLS&nbsp;spec</span><br>
<span class="lineno">120</span><span class="op" id="4418329">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4418332">//&nbsp;Hash&nbsp;functions&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="4418392">const</span>&nbsp;<span class="op" id="4418398">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418401">hashSHA1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4418412">uint8</span>&nbsp;<span class="op" id="4418418">=</span>&nbsp;<span class="num" id="4418420">2</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418423">hashSHA256</span>&nbsp;<span class="builtintype" id="4418434">uint8</span>&nbsp;<span class="op" id="4418440">=</span>&nbsp;<span class="num" id="4418442">4</span><br>
<span class="lineno"></span><span class="op" id="4418444">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4418447">//&nbsp;Signature&nbsp;algorithms&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="4418513">const</span>&nbsp;<span class="op" id="4418519">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418522">signatureRSA</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4418537">uint8</span>&nbsp;<span class="op" id="4418543">=</span>&nbsp;<span class="num" id="4418545">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418548">signatureECDSA</span>&nbsp;<span class="builtintype" id="4418563">uint8</span>&nbsp;<span class="op" id="4418569">=</span>&nbsp;<span class="num" id="4418571">3</span><br>
<span class="lineno"></span><span class="op" id="4418573">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4418576">//&nbsp;signatureAndHash&nbsp;mirrors&nbsp;the&nbsp;TLS&nbsp;1.2,&nbsp;SignatureAndHashAlgorithm&nbsp;struct.&nbsp;See</span><br>
<span class="lineno">135</span><span class="comment" id="4418655">//&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4418683">type</span>&nbsp;<span class="ident" id="4418688">signatureAndHash</span>&nbsp;<span class="keyword" id="4418705">struct</span>&nbsp;<span class="op" id="4418712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418715">hash</span><span class="op" id="4418719">,</span>&nbsp;<span class="ident" id="4418721">signature</span>&nbsp;<span class="builtintype" id="4418731">uint8</span><br>
<span class="lineno"></span><span class="op" id="4418737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="4418740">//&nbsp;supportedSKXSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash&nbsp;algorithms</span><br>
<span class="lineno"></span><span class="comment" id="4418818">//&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2&nbsp;ClientHello.</span><br>
<span class="lineno"></span><span class="keyword" id="4418885">var</span>&nbsp;<span class="ident" id="4418889">supportedSKXSignatureAlgorithms</span>&nbsp;<span class="op" id="4418921">=</span>&nbsp;<span class="op" id="4418923">[</span><span class="op" id="4418924">]</span><span class="ident" id="4418925">signatureAndHash</span><span class="op" id="4418941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4418944">{</span><span class="ident" id="4418945">hashSHA256</span><span class="op" id="4418955">,</span>&nbsp;<span class="ident" id="4418957">signatureRSA</span><span class="op" id="4418969">}</span><span class="op" id="4418970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4418973">{</span><span class="ident" id="4418974">hashSHA256</span><span class="op" id="4418984">,</span>&nbsp;<span class="ident" id="4418986">signatureECDSA</span><span class="op" id="4419000">}</span><span class="op" id="4419001">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4419004">{</span><span class="ident" id="4419005">hashSHA1</span><span class="op" id="4419013">,</span>&nbsp;<span class="ident" id="4419015">signatureRSA</span><span class="op" id="4419027">}</span><span class="op" id="4419028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4419031">{</span><span class="ident" id="4419032">hashSHA1</span><span class="op" id="4419040">,</span>&nbsp;<span class="ident" id="4419042">signatureECDSA</span><span class="op" id="4419056">}</span><span class="op" id="4419057">,</span><br>
<span class="lineno"></span><span class="op" id="4419059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4419062">//&nbsp;supportedClientCertSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash</span><br>
<span class="lineno">150</span><span class="comment" id="4419136">//&nbsp;algorithms&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2</span><br>
<span class="lineno"></span><span class="comment" id="4419201">//&nbsp;CertificateRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="4419224">var</span>&nbsp;<span class="ident" id="4419228">supportedClientCertSignatureAlgorithms</span>&nbsp;<span class="op" id="4419267">=</span>&nbsp;<span class="op" id="4419269">[</span><span class="op" id="4419270">]</span><span class="ident" id="4419271">signatureAndHash</span><span class="op" id="4419287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4419290">{</span><span class="ident" id="4419291">hashSHA256</span><span class="op" id="4419301">,</span>&nbsp;<span class="ident" id="4419303">signatureRSA</span><span class="op" id="4419315">}</span><span class="op" id="4419316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4419319">{</span><span class="ident" id="4419320">hashSHA256</span><span class="op" id="4419330">,</span>&nbsp;<span class="ident" id="4419332">signatureECDSA</span><span class="op" id="4419346">}</span><span class="op" id="4419347">,</span><br>
<span class="lineno">155</span><span class="op" id="4419349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4419352">//&nbsp;ConnectionState&nbsp;records&nbsp;basic&nbsp;TLS&nbsp;details&nbsp;about&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4419419">type</span>&nbsp;<span class="ident" id="4419424">ConnectionState</span>&nbsp;<span class="keyword" id="4419440">struct</span>&nbsp;<span class="op" id="4419447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419450">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4419477">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4419499">//&nbsp;TLS&nbsp;version&nbsp;used&nbsp;by&nbsp;the&nbsp;connection&nbsp;(e.g.&nbsp;VersionTLS12)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419558">HandshakeComplete</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4419585">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4419607">//&nbsp;TLS&nbsp;handshake&nbsp;is&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419637">DidResume</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4419664">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4419686">//&nbsp;connection&nbsp;resumes&nbsp;a&nbsp;previous&nbsp;TLS&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419735">CipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4419762">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4419784">//&nbsp;cipher&nbsp;suite&nbsp;in&nbsp;use&nbsp;(TLS_RSA_WITH_RC4_128_SHA,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419840">NegotiatedProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4419867">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4419889">//&nbsp;negotiated&nbsp;next&nbsp;protocol&nbsp;(from&nbsp;Config.NextProtos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419943">NegotiatedProtocolIsMutual</span>&nbsp;<span class="builtintype" id="4419970">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4419992">//&nbsp;negotiated&nbsp;protocol&nbsp;was&nbsp;advertised&nbsp;by&nbsp;server</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420041">ServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4420068">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4420090">//&nbsp;server&nbsp;name&nbsp;requested&nbsp;by&nbsp;client,&nbsp;if&nbsp;any&nbsp;(server&nbsp;side&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420153">PeerCertificates</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4420180">[</span><span class="op" id="4420181">]</span><span class="op" id="4420182">*</span><span class="ident" id="4420183">x509</span><span class="op" id="4420187">.</span><span class="ident" id="4420188">Certificate</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4420202">//&nbsp;certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;remote&nbsp;peer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420249">VerifiedChains</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4420276">[</span><span class="op" id="4420277">]</span><span class="op" id="4420278">[</span><span class="op" id="4420279">]</span><span class="op" id="4420280">*</span><span class="ident" id="4420281">x509</span><span class="op" id="4420285">.</span><span class="ident" id="4420286">Certificate</span>&nbsp;<span class="comment" id="4420298">//&nbsp;verified&nbsp;chains&nbsp;built&nbsp;from&nbsp;PeerCertificates</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420347">//&nbsp;TLSUnique&nbsp;contains&nbsp;the&nbsp;&#34;tls-unique&#34;&nbsp;channel&nbsp;binding&nbsp;value&nbsp;(see&nbsp;RFC</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420418">//&nbsp;5929,&nbsp;section&nbsp;3).&nbsp;For&nbsp;resumed&nbsp;sessions&nbsp;this&nbsp;value&nbsp;will&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420484">//&nbsp;because&nbsp;resumption&nbsp;does&nbsp;not&nbsp;include&nbsp;enough&nbsp;context&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420544">//&nbsp;https://secure-resumption.com/#channelbindings).&nbsp;This&nbsp;will&nbsp;change&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420617">//&nbsp;future&nbsp;versions&nbsp;of&nbsp;Go&nbsp;once&nbsp;the&nbsp;TLS&nbsp;master-secret&nbsp;fix&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420683">//&nbsp;standardized&nbsp;and&nbsp;implemented.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420717">TLSUnique</span>&nbsp;<span class="op" id="4420727">[</span><span class="op" id="4420728">]</span><span class="builtintype" id="4420729">byte</span><br>
<span class="lineno"></span><span class="op" id="4420734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4420737">//&nbsp;ClientAuthType&nbsp;declares&nbsp;the&nbsp;policy&nbsp;the&nbsp;server&nbsp;will&nbsp;follow&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4420802">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.</span><br>
<span class="lineno">180</span><span class="keyword" id="4420832">type</span>&nbsp;<span class="ident" id="4420837">ClientAuthType</span>&nbsp;<span class="builtintype" id="4420852">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4420857">const</span>&nbsp;<span class="op" id="4420863">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420866">NoClientCert</span>&nbsp;<span class="ident" id="4420879">ClientAuthType</span>&nbsp;<span class="op" id="4420894">=</span>&nbsp;<span class="ident" id="4420896">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420902">RequestClientCert</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420921">RequireAnyClientCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420943">VerifyClientCertIfGiven</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420968">RequireAndVerifyClientCert</span><br>
<span class="lineno"></span><span class="op" id="4420995">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4420998">//&nbsp;ClientSessionState&nbsp;contains&nbsp;the&nbsp;state&nbsp;needed&nbsp;by&nbsp;clients&nbsp;to&nbsp;resume&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="4421071">//&nbsp;sessions.</span><br>
<span class="lineno"></span><span class="keyword" id="4421084">type</span>&nbsp;<span class="ident" id="4421089">ClientSessionState</span>&nbsp;<span class="keyword" id="4421108">struct</span>&nbsp;<span class="op" id="4421115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421118">sessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4421137">[</span><span class="op" id="4421138">]</span><span class="builtintype" id="4421139">uint8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4421157">//&nbsp;Encrypted&nbsp;ticket&nbsp;used&nbsp;for&nbsp;session&nbsp;resumption&nbsp;with&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421218">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4421237">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4421257">//&nbsp;SSL/TLS&nbsp;version&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421304">cipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4421323">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4421343">//&nbsp;Ciphersuite&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421386">masterSecret</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4421405">[</span><span class="op" id="4421406">]</span><span class="builtintype" id="4421407">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4421425">//&nbsp;MasterSecret&nbsp;generated&nbsp;by&nbsp;client&nbsp;on&nbsp;a&nbsp;full&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421482">serverCertificates</span>&nbsp;<span class="op" id="4421501">[</span><span class="op" id="4421502">]</span><span class="op" id="4421503">*</span><span class="ident" id="4421504">x509</span><span class="op" id="4421508">.</span><span class="ident" id="4421509">Certificate</span>&nbsp;<span class="comment" id="4421521">//&nbsp;Certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="op" id="4421566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="4421569">//&nbsp;ClientSessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;objects&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4421649">//&nbsp;by&nbsp;a&nbsp;client&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session&nbsp;with&nbsp;a&nbsp;given&nbsp;server.&nbsp;ClientSessionCache</span><br>
<span class="lineno"></span><span class="comment" id="4421728">//&nbsp;implementations&nbsp;should&nbsp;expect&nbsp;to&nbsp;be&nbsp;called&nbsp;concurrently&nbsp;from&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="4421802">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="4421817">type</span>&nbsp;<span class="ident" id="4421822">ClientSessionCache</span>&nbsp;<span class="keyword" id="4421841">interface</span>&nbsp;<span class="op" id="4421851">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4421854">//&nbsp;Get&nbsp;searches&nbsp;for&nbsp;a&nbsp;ClientSessionState&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4421927">//&nbsp;On&nbsp;return,&nbsp;ok&nbsp;is&nbsp;true&nbsp;if&nbsp;one&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421971">Get</span><span class="op" id="4421974">(</span><span class="ident" id="4421975">sessionKey</span>&nbsp;<span class="builtintype" id="4421986">string</span><span class="op" id="4421992">)</span>&nbsp;<span class="op" id="4421994">(</span><span class="ident" id="4421995">session</span>&nbsp;<span class="op" id="4422003">*</span><span class="ident" id="4422004">ClientSessionState</span><span class="op" id="4422022">,</span>&nbsp;<span class="ident" id="4422024">ok</span>&nbsp;<span class="builtintype" id="4422027">bool</span><span class="op" id="4422031">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422035">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;ClientSessionState&nbsp;to&nbsp;the&nbsp;cache&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422104">Put</span><span class="op" id="4422107">(</span><span class="ident" id="4422108">sessionKey</span>&nbsp;<span class="builtintype" id="4422119">string</span><span class="op" id="4422125">,</span>&nbsp;<span class="ident" id="4422127">cs</span>&nbsp;<span class="op" id="4422130">*</span><span class="ident" id="4422131">ClientSessionState</span><span class="op" id="4422149">)</span><br>
<span class="lineno"></span><span class="op" id="4422151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4422154">//&nbsp;ClientHelloInfo&nbsp;contains&nbsp;information&nbsp;from&nbsp;a&nbsp;ClientHello&nbsp;message&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4422233">//&nbsp;guide&nbsp;certificate&nbsp;selection&nbsp;in&nbsp;the&nbsp;GetCertificate&nbsp;callback.</span><br>
<span class="lineno">215</span><span class="keyword" id="4422296">type</span>&nbsp;<span class="ident" id="4422301">ClientHelloInfo</span>&nbsp;<span class="keyword" id="4422317">struct</span>&nbsp;<span class="op" id="4422324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422327">//&nbsp;CipherSuites&nbsp;lists&nbsp;the&nbsp;CipherSuites&nbsp;supported&nbsp;by&nbsp;the&nbsp;client&nbsp;(e.g.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422397">//&nbsp;TLS_RSA_WITH_RC4_128_SHA).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422428">CipherSuites</span>&nbsp;<span class="op" id="4422441">[</span><span class="op" id="4422442">]</span><span class="builtintype" id="4422443">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422452">//&nbsp;ServerName&nbsp;indicates&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;server&nbsp;requested&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422524">//&nbsp;in&nbsp;order&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.&nbsp;ServerName&nbsp;is&nbsp;only&nbsp;set&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422595">//&nbsp;client&nbsp;is&nbsp;using&nbsp;SNI&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422624">//&nbsp;http://tools.ietf.org/html/rfc4366#section-3.1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422677">ServerName</span>&nbsp;<span class="builtintype" id="4422688">string</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422697">//&nbsp;SupportedCurves&nbsp;lists&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422768">//&nbsp;SupportedCurves&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Elliptic&nbsp;Curves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422833">//&nbsp;Extension&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422866">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.1).</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422921">SupportedCurves</span>&nbsp;<span class="op" id="4422937">[</span><span class="op" id="4422938">]</span><span class="ident" id="4422939">CurveID</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422949">//&nbsp;SupportedPoints&nbsp;lists&nbsp;the&nbsp;point&nbsp;formats&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423018">//&nbsp;SupportedPoints&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Point&nbsp;Formats&nbsp;Extension</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423091">//&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423114">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423169">SupportedPoints</span>&nbsp;<span class="op" id="4423185">[</span><span class="op" id="4423186">]</span><span class="builtintype" id="4423187">uint8</span><br>
<span class="lineno"></span><span class="op" id="4423193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4423196">//&nbsp;A&nbsp;Config&nbsp;structure&nbsp;is&nbsp;used&nbsp;to&nbsp;configure&nbsp;a&nbsp;TLS&nbsp;client&nbsp;or&nbsp;server.</span><br>
<span class="lineno">240</span><span class="comment" id="4423263">//&nbsp;After&nbsp;one&nbsp;has&nbsp;been&nbsp;passed&nbsp;to&nbsp;a&nbsp;TLS&nbsp;function&nbsp;it&nbsp;must&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4423325">//&nbsp;modified.&nbsp;A&nbsp;Config&nbsp;may&nbsp;be&nbsp;reused;&nbsp;the&nbsp;tls&nbsp;package&nbsp;will&nbsp;also&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4423392">//&nbsp;modify&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4423406">type</span>&nbsp;<span class="ident" id="4423411">Config</span>&nbsp;<span class="keyword" id="4423418">struct</span>&nbsp;<span class="op" id="4423425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423428">//&nbsp;Rand&nbsp;provides&nbsp;the&nbsp;source&nbsp;of&nbsp;entropy&nbsp;for&nbsp;nonces&nbsp;and&nbsp;RSA&nbsp;blinding.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423497">//&nbsp;If&nbsp;Rand&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;cryptographic&nbsp;random&nbsp;reader&nbsp;in&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423569">//&nbsp;crypto/rand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423586">//&nbsp;The&nbsp;Reader&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423646">Rand</span>&nbsp;<span class="ident" id="4423651">io</span><span class="op" id="4423653">.</span><span class="ident" id="4423654">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423663">//&nbsp;Time&nbsp;returns&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;the&nbsp;number&nbsp;of&nbsp;seconds&nbsp;since&nbsp;the&nbsp;epoch.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423739">//&nbsp;If&nbsp;Time&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;time.Now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423778">Time</span>&nbsp;<span class="keyword" id="4423783">func</span><span class="op" id="4423787">(</span><span class="op" id="4423788">)</span>&nbsp;<span class="ident" id="4423790">time</span><span class="op" id="4423794">.</span><span class="ident" id="4423795">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423802">//&nbsp;Certificates&nbsp;contains&nbsp;one&nbsp;or&nbsp;more&nbsp;certificate&nbsp;chains</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423859">//&nbsp;to&nbsp;present&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423911">//&nbsp;Server&nbsp;configurations&nbsp;must&nbsp;include&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423976">Certificates</span>&nbsp;<span class="op" id="4423989">[</span><span class="op" id="4423990">]</span><span class="ident" id="4423991">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424005">//&nbsp;NameToCertificate&nbsp;maps&nbsp;from&nbsp;a&nbsp;certificate&nbsp;name&nbsp;to&nbsp;an&nbsp;element&nbsp;of</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424073">//&nbsp;Certificates.&nbsp;Note&nbsp;that&nbsp;a&nbsp;certificate&nbsp;name&nbsp;can&nbsp;be&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424139">//&nbsp;&#39;*.example.com&#39;&nbsp;and&nbsp;so&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;a&nbsp;domain&nbsp;name&nbsp;as&nbsp;such.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424208">//&nbsp;See&nbsp;Config.BuildNameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424246">//&nbsp;The&nbsp;nil&nbsp;value&nbsp;causes&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;to&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424316">//&nbsp;for&nbsp;all&nbsp;connections.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424341">NameToCertificate</span>&nbsp;<span class="keyword" id="4424359">map</span><span class="op" id="4424362">[</span><span class="builtintype" id="4424363">string</span><span class="op" id="4424369">]</span><span class="op" id="4424370">*</span><span class="ident" id="4424371">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424385">//&nbsp;GetCertificate&nbsp;returns&nbsp;a&nbsp;Certificate&nbsp;based&nbsp;on&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424445">//&nbsp;ClientHelloInfo.&nbsp;If&nbsp;GetCertificate&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;nil,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424516">//&nbsp;certificate&nbsp;is&nbsp;retrieved&nbsp;from&nbsp;NameToCertificate.&nbsp;If</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424572">//&nbsp;NameToCertificate&nbsp;is&nbsp;nil,&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424644">//&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424654">GetCertificate</span>&nbsp;<span class="keyword" id="4424669">func</span><span class="op" id="4424673">(</span><span class="ident" id="4424674">clientHello</span>&nbsp;<span class="op" id="4424686">*</span><span class="ident" id="4424687">ClientHelloInfo</span><span class="op" id="4424702">)</span>&nbsp;<span class="op" id="4424704">(</span><span class="op" id="4424705">*</span><span class="ident" id="4424706">Certificate</span><span class="op" id="4424717">,</span>&nbsp;<span class="builtintype" id="4424719">error</span><span class="op" id="4424724">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424728">//&nbsp;RootCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424788">//&nbsp;that&nbsp;clients&nbsp;use&nbsp;when&nbsp;verifying&nbsp;server&nbsp;certificates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424845">//&nbsp;If&nbsp;RootCAs&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;host&#39;s&nbsp;root&nbsp;CA&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424901">RootCAs</span>&nbsp;<span class="op" id="4424909">*</span><span class="ident" id="4424910">x509</span><span class="op" id="4424914">.</span><span class="ident" id="4424915">CertPool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424926">//&nbsp;NextProtos&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported,&nbsp;application&nbsp;level&nbsp;protocols.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424994">NextProtos</span>&nbsp;<span class="op" id="4425005">[</span><span class="op" id="4425006">]</span><span class="builtintype" id="4425007">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425016">//&nbsp;ServerName&nbsp;is&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;hostname&nbsp;on&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425078">//&nbsp;certificates&nbsp;unless&nbsp;InsecureSkipVerify&nbsp;is&nbsp;given.&nbsp;It&nbsp;is&nbsp;also&nbsp;included</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425151">//&nbsp;in&nbsp;the&nbsp;client&#39;s&nbsp;handshake&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425209">ServerName</span>&nbsp;<span class="builtintype" id="4425220">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425229">//&nbsp;ClientAuth&nbsp;determines&nbsp;the&nbsp;server&#39;s&nbsp;policy&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425279">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.&nbsp;The&nbsp;default&nbsp;is&nbsp;NoClientCert.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425339">ClientAuth</span>&nbsp;<span class="ident" id="4425350">ClientAuthType</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425367">//&nbsp;ClientCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425429">//&nbsp;that&nbsp;servers&nbsp;use&nbsp;if&nbsp;required&nbsp;to&nbsp;verify&nbsp;a&nbsp;client&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425493">//&nbsp;by&nbsp;the&nbsp;policy&nbsp;in&nbsp;ClientAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425526">ClientCAs</span>&nbsp;<span class="op" id="4425536">*</span><span class="ident" id="4425537">x509</span><span class="op" id="4425541">.</span><span class="ident" id="4425542">CertPool</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425553">//&nbsp;InsecureSkipVerify&nbsp;controls&nbsp;whether&nbsp;a&nbsp;client&nbsp;verifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425615">//&nbsp;server&#39;s&nbsp;certificate&nbsp;chain&nbsp;and&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425661">//&nbsp;If&nbsp;InsecureSkipVerify&nbsp;is&nbsp;true,&nbsp;TLS&nbsp;accepts&nbsp;any&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425724">//&nbsp;presented&nbsp;by&nbsp;the&nbsp;server&nbsp;and&nbsp;any&nbsp;host&nbsp;name&nbsp;in&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425791">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;TLS&nbsp;is&nbsp;susceptible&nbsp;to&nbsp;man-in-the-middle&nbsp;attacks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425858">//&nbsp;This&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425900">InsecureSkipVerify</span>&nbsp;<span class="builtintype" id="4425919">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425926">//&nbsp;CipherSuites&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported&nbsp;cipher&nbsp;suites.&nbsp;If&nbsp;CipherSuites</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425997">//&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;a&nbsp;list&nbsp;of&nbsp;suites&nbsp;supported&nbsp;by&nbsp;the&nbsp;implementation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426068">CipherSuites</span>&nbsp;<span class="op" id="4426081">[</span><span class="op" id="4426082">]</span><span class="builtintype" id="4426083">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426092">//&nbsp;PreferServerCipherSuites&nbsp;controls&nbsp;whether&nbsp;the&nbsp;server&nbsp;selects&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426161">//&nbsp;client&#39;s&nbsp;most&nbsp;preferred&nbsp;ciphersuite,&nbsp;or&nbsp;the&nbsp;server&#39;s&nbsp;most&nbsp;preferred</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426233">//&nbsp;ciphersuite.&nbsp;If&nbsp;true&nbsp;then&nbsp;the&nbsp;server&#39;s&nbsp;preference,&nbsp;as&nbsp;expressed&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426304">//&nbsp;the&nbsp;order&nbsp;of&nbsp;elements&nbsp;in&nbsp;CipherSuites,&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426356">PreferServerCipherSuites</span>&nbsp;<span class="builtintype" id="4426381">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426388">//&nbsp;SessionTicketsDisabled&nbsp;may&nbsp;be&nbsp;set&nbsp;to&nbsp;true&nbsp;to&nbsp;disable&nbsp;session&nbsp;ticket</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426460">//&nbsp;(resumption)&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426486">SessionTicketsDisabled</span>&nbsp;<span class="builtintype" id="4426509">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426516">//&nbsp;SessionTicketKey&nbsp;is&nbsp;used&nbsp;by&nbsp;TLS&nbsp;servers&nbsp;to&nbsp;provide&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426579">//&nbsp;resumption.&nbsp;See&nbsp;RFC&nbsp;5077.&nbsp;If&nbsp;zero,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426641">//&nbsp;random&nbsp;data&nbsp;before&nbsp;the&nbsp;first&nbsp;server&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426692">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426696">//&nbsp;If&nbsp;multiple&nbsp;servers&nbsp;are&nbsp;terminating&nbsp;connections&nbsp;for&nbsp;the&nbsp;same&nbsp;host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426766">//&nbsp;they&nbsp;should&nbsp;all&nbsp;have&nbsp;the&nbsp;same&nbsp;SessionTicketKey.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426825">//&nbsp;SessionTicketKey&nbsp;leaks,&nbsp;previously&nbsp;recorded&nbsp;and&nbsp;future&nbsp;TLS</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426888">//&nbsp;connections&nbsp;using&nbsp;that&nbsp;key&nbsp;are&nbsp;compromised.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426936">SessionTicketKey</span>&nbsp;<span class="op" id="4426953">[</span><span class="num" id="4426954">32</span><span class="op" id="4426956">]</span><span class="builtintype" id="4426957">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426964">//&nbsp;SessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;entries&nbsp;for&nbsp;TLS&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427038">//&nbsp;resumption.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427054">ClientSessionCache</span>&nbsp;<span class="ident" id="4427073">ClientSessionCache</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427094">//&nbsp;MinVersion&nbsp;contains&nbsp;the&nbsp;minimum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427166">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;SSLv3&nbsp;is&nbsp;taken&nbsp;as&nbsp;the&nbsp;minimum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427215">MinVersion</span>&nbsp;<span class="builtintype" id="4427226">uint16</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427235">//&nbsp;MaxVersion&nbsp;contains&nbsp;the&nbsp;maximum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427307">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;the&nbsp;maximum&nbsp;version&nbsp;supported&nbsp;by&nbsp;this&nbsp;package&nbsp;is&nbsp;used,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427380">//&nbsp;which&nbsp;is&nbsp;currently&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427412">MaxVersion</span>&nbsp;<span class="builtintype" id="4427423">uint16</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427432">//&nbsp;CurvePreferences&nbsp;contains&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427503">//&nbsp;an&nbsp;ECDHE&nbsp;handshake,&nbsp;in&nbsp;preference&nbsp;order.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;default&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427575">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427588">CurvePreferences</span>&nbsp;<span class="op" id="4427605">[</span><span class="op" id="4427606">]</span><span class="ident" id="4427607">CurveID</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427617">serverInitOnce</span>&nbsp;<span class="ident" id="4427632">sync</span><span class="op" id="4427636">.</span><span class="ident" id="4427637">Once</span>&nbsp;<span class="comment" id="4427642">//&nbsp;guards&nbsp;calling&nbsp;(*Config).serverInit</span><br>
<span class="lineno"></span><span class="op" id="4427681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4427684">func</span>&nbsp;<span class="op" id="4427689">(</span><span class="ident" id="4427690">c</span>&nbsp;<span class="op" id="4427692">*</span><span class="ident" id="4427693">Config</span><span class="op" id="4427699">)</span>&nbsp;<span class="ident" id="4427701">serverInit</span><span class="op" id="4427711">(</span><span class="op" id="4427712">)</span>&nbsp;<span class="op" id="4427714">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427717">if</span>&nbsp;<span class="ident" id="4427720">c</span><span class="op" id="4427721">.</span><span class="ident" id="4427722">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4427745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427749">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427761">//&nbsp;If&nbsp;the&nbsp;key&nbsp;has&nbsp;already&nbsp;been&nbsp;set&nbsp;then&nbsp;we&nbsp;have&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427825">for</span>&nbsp;<span class="ident" id="4427829">_</span><span class="op" id="4427830">,</span>&nbsp;<span class="ident" id="4427832">b</span>&nbsp;<span class="op" id="4427834">:=</span>&nbsp;<span class="keyword" id="4427837">range</span>&nbsp;<span class="ident" id="4427843">c</span><span class="op" id="4427844">.</span><span class="ident" id="4427845">SessionTicketKey</span>&nbsp;<span class="op" id="4427862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427866">if</span>&nbsp;<span class="ident" id="4427869">b</span>&nbsp;<span class="op" id="4427871">!=</span>&nbsp;<span class="num" id="4427874">0</span>&nbsp;<span class="op" id="4427876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427881">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427893">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427897">if</span>&nbsp;<span class="ident" id="4427900">_</span><span class="op" id="4427901">,</span>&nbsp;<span class="ident" id="4427903">err</span>&nbsp;<span class="op" id="4427907">:=</span>&nbsp;<span class="ident" id="4427910">io</span><span class="op" id="4427912">.</span><span class="ident" id="4427913">ReadFull</span><span class="op" id="4427921">(</span><span class="ident" id="4427922">c</span><span class="op" id="4427923">.</span><span class="ident" id="4427924">rand</span><span class="op" id="4427928">(</span><span class="op" id="4427929">)</span><span class="op" id="4427930">,</span>&nbsp;<span class="ident" id="4427932">c</span><span class="op" id="4427933">.</span><span class="ident" id="4427934">SessionTicketKey</span><span class="op" id="4427950">[</span><span class="op" id="4427951">:</span><span class="op" id="4427952">]</span><span class="op" id="4427953">)</span><span class="op" id="4427954">;</span>&nbsp;<span class="ident" id="4427956">err</span>&nbsp;<span class="op" id="4427960">!=</span>&nbsp;<span class="ident" id="4427963">nil</span>&nbsp;<span class="op" id="4427967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427971">c</span><span class="op" id="4427972">.</span><span class="ident" id="4427973">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4427996">=</span>&nbsp;<span class="builtintype" id="4427998">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428004">}</span><br>
<span class="lineno"></span><span class="op" id="4428006">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="4428009">func</span>&nbsp;<span class="op" id="4428014">(</span><span class="ident" id="4428015">c</span>&nbsp;<span class="op" id="4428017">*</span><span class="ident" id="4428018">Config</span><span class="op" id="4428024">)</span>&nbsp;<span class="ident" id="4428026">rand</span><span class="op" id="4428030">(</span><span class="op" id="4428031">)</span>&nbsp;<span class="ident" id="4428033">io</span><span class="op" id="4428035">.</span><span class="ident" id="4428036">Reader</span>&nbsp;<span class="op" id="4428043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428046">r</span>&nbsp;<span class="op" id="4428048">:=</span>&nbsp;<span class="ident" id="4428051">c</span><span class="op" id="4428052">.</span><span class="ident" id="4428053">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428059">if</span>&nbsp;<span class="ident" id="4428062">r</span>&nbsp;<span class="op" id="4428064">==</span>&nbsp;<span class="ident" id="4428067">nil</span>&nbsp;<span class="op" id="4428071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428075">return</span>&nbsp;<span class="ident" id="4428082">rand</span><span class="op" id="4428086">.</span><span class="ident" id="4428087">Reader</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428098">return</span>&nbsp;<span class="ident" id="4428105">r</span><br>
<span class="lineno"></span><span class="op" id="4428107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4428110">func</span>&nbsp;<span class="op" id="4428115">(</span><span class="ident" id="4428116">c</span>&nbsp;<span class="op" id="4428118">*</span><span class="ident" id="4428119">Config</span><span class="op" id="4428125">)</span>&nbsp;<span class="ident" id="4428127">time</span><span class="op" id="4428131">(</span><span class="op" id="4428132">)</span>&nbsp;<span class="ident" id="4428134">time</span><span class="op" id="4428138">.</span><span class="ident" id="4428139">Time</span>&nbsp;<span class="op" id="4428144">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428147">t</span>&nbsp;<span class="op" id="4428149">:=</span>&nbsp;<span class="ident" id="4428152">c</span><span class="op" id="4428153">.</span><span class="ident" id="4428154">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428160">if</span>&nbsp;<span class="ident" id="4428163">t</span>&nbsp;<span class="op" id="4428165">==</span>&nbsp;<span class="ident" id="4428168">nil</span>&nbsp;<span class="op" id="4428172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428176">t</span>&nbsp;<span class="op" id="4428178">=</span>&nbsp;<span class="ident" id="4428180">time</span><span class="op" id="4428184">.</span><span class="ident" id="4428185">Now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428193">return</span>&nbsp;<span class="ident" id="4428200">t</span><span class="op" id="4428201">(</span><span class="op" id="4428202">)</span><br>
<span class="lineno">380</span><span class="op" id="4428204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4428207">func</span>&nbsp;<span class="op" id="4428212">(</span><span class="ident" id="4428213">c</span>&nbsp;<span class="op" id="4428215">*</span><span class="ident" id="4428216">Config</span><span class="op" id="4428222">)</span>&nbsp;<span class="ident" id="4428224">cipherSuites</span><span class="op" id="4428236">(</span><span class="op" id="4428237">)</span>&nbsp;<span class="op" id="4428239">[</span><span class="op" id="4428240">]</span><span class="builtintype" id="4428241">uint16</span>&nbsp;<span class="op" id="4428248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428251">s</span>&nbsp;<span class="op" id="4428253">:=</span>&nbsp;<span class="ident" id="4428256">c</span><span class="op" id="4428257">.</span><span class="ident" id="4428258">CipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428272">if</span>&nbsp;<span class="ident" id="4428275">s</span>&nbsp;<span class="op" id="4428277">==</span>&nbsp;<span class="ident" id="4428280">nil</span>&nbsp;<span class="op" id="4428284">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428288">s</span>&nbsp;<span class="op" id="4428290">=</span>&nbsp;<span class="ident" id="4428292">defaultCipherSuites</span><span class="op" id="4428311">(</span><span class="op" id="4428312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428318">return</span>&nbsp;<span class="ident" id="4428325">s</span><br>
<span class="lineno"></span><span class="op" id="4428327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="keyword" id="4428330">func</span>&nbsp;<span class="op" id="4428335">(</span><span class="ident" id="4428336">c</span>&nbsp;<span class="op" id="4428338">*</span><span class="ident" id="4428339">Config</span><span class="op" id="4428345">)</span>&nbsp;<span class="ident" id="4428347">minVersion</span><span class="op" id="4428357">(</span><span class="op" id="4428358">)</span>&nbsp;<span class="builtintype" id="4428360">uint16</span>&nbsp;<span class="op" id="4428367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428370">if</span>&nbsp;<span class="ident" id="4428373">c</span>&nbsp;<span class="op" id="4428375">==</span>&nbsp;<span class="ident" id="4428378">nil</span>&nbsp;<span class="op" id="4428382">||</span>&nbsp;<span class="ident" id="4428385">c</span><span class="op" id="4428386">.</span><span class="ident" id="4428387">MinVersion</span>&nbsp;<span class="op" id="4428398">==</span>&nbsp;<span class="num" id="4428401">0</span>&nbsp;<span class="op" id="4428403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428407">return</span>&nbsp;<span class="ident" id="4428414">minVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428429">return</span>&nbsp;<span class="ident" id="4428436">c</span><span class="op" id="4428437">.</span><span class="ident" id="4428438">MinVersion</span><br>
<span class="lineno">395</span><span class="op" id="4428449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4428452">func</span>&nbsp;<span class="op" id="4428457">(</span><span class="ident" id="4428458">c</span>&nbsp;<span class="op" id="4428460">*</span><span class="ident" id="4428461">Config</span><span class="op" id="4428467">)</span>&nbsp;<span class="ident" id="4428469">maxVersion</span><span class="op" id="4428479">(</span><span class="op" id="4428480">)</span>&nbsp;<span class="builtintype" id="4428482">uint16</span>&nbsp;<span class="op" id="4428489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428492">if</span>&nbsp;<span class="ident" id="4428495">c</span>&nbsp;<span class="op" id="4428497">==</span>&nbsp;<span class="ident" id="4428500">nil</span>&nbsp;<span class="op" id="4428504">||</span>&nbsp;<span class="ident" id="4428507">c</span><span class="op" id="4428508">.</span><span class="ident" id="4428509">MaxVersion</span>&nbsp;<span class="op" id="4428520">==</span>&nbsp;<span class="num" id="4428523">0</span>&nbsp;<span class="op" id="4428525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428529">return</span>&nbsp;<span class="ident" id="4428536">maxVersion</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428551">return</span>&nbsp;<span class="ident" id="4428558">c</span><span class="op" id="4428559">.</span><span class="ident" id="4428560">MaxVersion</span><br>
<span class="lineno"></span><span class="op" id="4428571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4428574">var</span>&nbsp;<span class="ident" id="4428578">defaultCurvePreferences</span>&nbsp;<span class="op" id="4428602">=</span>&nbsp;<span class="op" id="4428604">[</span><span class="op" id="4428605">]</span><span class="ident" id="4428606">CurveID</span><span class="op" id="4428613">{</span><span class="ident" id="4428614">CurveP256</span><span class="op" id="4428623">,</span>&nbsp;<span class="ident" id="4428625">CurveP384</span><span class="op" id="4428634">,</span>&nbsp;<span class="ident" id="4428636">CurveP521</span><span class="op" id="4428645">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="4428648">func</span>&nbsp;<span class="op" id="4428653">(</span><span class="ident" id="4428654">c</span>&nbsp;<span class="op" id="4428656">*</span><span class="ident" id="4428657">Config</span><span class="op" id="4428663">)</span>&nbsp;<span class="ident" id="4428665">curvePreferences</span><span class="op" id="4428681">(</span><span class="op" id="4428682">)</span>&nbsp;<span class="op" id="4428684">[</span><span class="op" id="4428685">]</span><span class="ident" id="4428686">CurveID</span>&nbsp;<span class="op" id="4428694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428697">if</span>&nbsp;<span class="ident" id="4428700">c</span>&nbsp;<span class="op" id="4428702">==</span>&nbsp;<span class="ident" id="4428705">nil</span>&nbsp;<span class="op" id="4428709">||</span>&nbsp;<span class="builtinfunc" id="4428712">len</span><span class="op" id="4428715">(</span><span class="ident" id="4428716">c</span><span class="op" id="4428717">.</span><span class="ident" id="4428718">CurvePreferences</span><span class="op" id="4428734">)</span>&nbsp;<span class="op" id="4428736">==</span>&nbsp;<span class="num" id="4428739">0</span>&nbsp;<span class="op" id="4428741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428745">return</span>&nbsp;<span class="ident" id="4428752">defaultCurvePreferences</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428777">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428780">return</span>&nbsp;<span class="ident" id="4428787">c</span><span class="op" id="4428788">.</span><span class="ident" id="4428789">CurvePreferences</span><br>
<span class="lineno"></span><span class="op" id="4428806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4428809">//&nbsp;mutualVersion&nbsp;returns&nbsp;the&nbsp;protocol&nbsp;version&nbsp;to&nbsp;use&nbsp;given&nbsp;the&nbsp;advertised</span><br>
<span class="lineno"></span><span class="comment" id="4428883">//&nbsp;version&nbsp;of&nbsp;the&nbsp;peer.</span><br>
<span class="lineno">415</span><span class="keyword" id="4428907">func</span>&nbsp;<span class="op" id="4428912">(</span><span class="ident" id="4428913">c</span>&nbsp;<span class="op" id="4428915">*</span><span class="ident" id="4428916">Config</span><span class="op" id="4428922">)</span>&nbsp;<span class="ident" id="4428924">mutualVersion</span><span class="op" id="4428937">(</span><span class="ident" id="4428938">vers</span>&nbsp;<span class="builtintype" id="4428943">uint16</span><span class="op" id="4428949">)</span>&nbsp;<span class="op" id="4428951">(</span><span class="builtintype" id="4428952">uint16</span><span class="op" id="4428958">,</span>&nbsp;<span class="builtintype" id="4428960">bool</span><span class="op" id="4428964">)</span>&nbsp;<span class="op" id="4428966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428969">minVersion</span>&nbsp;<span class="op" id="4428980">:=</span>&nbsp;<span class="ident" id="4428983">c</span><span class="op" id="4428984">.</span><span class="ident" id="4428985">minVersion</span><span class="op" id="4428995">(</span><span class="op" id="4428996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428999">maxVersion</span>&nbsp;<span class="op" id="4429010">:=</span>&nbsp;<span class="ident" id="4429013">c</span><span class="op" id="4429014">.</span><span class="ident" id="4429015">maxVersion</span><span class="op" id="4429025">(</span><span class="op" id="4429026">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429030">if</span>&nbsp;<span class="ident" id="4429033">vers</span>&nbsp;<span class="op" id="4429038">&lt;</span>&nbsp;<span class="ident" id="4429040">minVersion</span>&nbsp;<span class="op" id="4429051">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429055">return</span>&nbsp;<span class="num" id="4429062">0</span><span class="op" id="4429063">,</span>&nbsp;<span class="builtintype" id="4429065">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429075">if</span>&nbsp;<span class="ident" id="4429078">vers</span>&nbsp;<span class="op" id="4429083">&gt;</span>&nbsp;<span class="ident" id="4429085">maxVersion</span>&nbsp;<span class="op" id="4429096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429100">vers</span>&nbsp;<span class="op" id="4429105">=</span>&nbsp;<span class="ident" id="4429107">maxVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429119">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429122">return</span>&nbsp;<span class="ident" id="4429129">vers</span><span class="op" id="4429133">,</span>&nbsp;<span class="builtintype" id="4429135">true</span><br>
<span class="lineno"></span><span class="op" id="4429140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4429143">//&nbsp;getCertificate&nbsp;returns&nbsp;the&nbsp;best&nbsp;certificate&nbsp;for&nbsp;the&nbsp;given&nbsp;ClientHelloInfo,</span><br>
<span class="lineno"></span><span class="comment" id="4429221">//&nbsp;defaulting&nbsp;to&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;c.Certificates.</span><br>
<span class="lineno">430</span><span class="keyword" id="4429275">func</span>&nbsp;<span class="op" id="4429280">(</span><span class="ident" id="4429281">c</span>&nbsp;<span class="op" id="4429283">*</span><span class="ident" id="4429284">Config</span><span class="op" id="4429290">)</span>&nbsp;<span class="ident" id="4429292">getCertificate</span><span class="op" id="4429306">(</span><span class="ident" id="4429307">clientHello</span>&nbsp;<span class="op" id="4429319">*</span><span class="ident" id="4429320">ClientHelloInfo</span><span class="op" id="4429335">)</span>&nbsp;<span class="op" id="4429337">(</span><span class="op" id="4429338">*</span><span class="ident" id="4429339">Certificate</span><span class="op" id="4429350">,</span>&nbsp;<span class="builtintype" id="4429352">error</span><span class="op" id="4429357">)</span>&nbsp;<span class="op" id="4429359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429362">if</span>&nbsp;<span class="ident" id="4429365">c</span><span class="op" id="4429366">.</span><span class="ident" id="4429367">GetCertificate</span>&nbsp;<span class="op" id="4429382">!=</span>&nbsp;<span class="ident" id="4429385">nil</span>&nbsp;<span class="op" id="4429389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429393">cert</span><span class="op" id="4429397">,</span>&nbsp;<span class="ident" id="4429399">err</span>&nbsp;<span class="op" id="4429403">:=</span>&nbsp;<span class="ident" id="4429406">c</span><span class="op" id="4429407">.</span><span class="ident" id="4429408">GetCertificate</span><span class="op" id="4429422">(</span><span class="ident" id="4429423">clientHello</span><span class="op" id="4429434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429438">if</span>&nbsp;<span class="ident" id="4429441">cert</span>&nbsp;<span class="op" id="4429446">!=</span>&nbsp;<span class="ident" id="4429449">nil</span>&nbsp;<span class="op" id="4429453">||</span>&nbsp;<span class="ident" id="4429456">err</span>&nbsp;<span class="op" id="4429460">!=</span>&nbsp;<span class="ident" id="4429463">nil</span>&nbsp;<span class="op" id="4429467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429472">return</span>&nbsp;<span class="ident" id="4429479">cert</span><span class="op" id="4429483">,</span>&nbsp;<span class="ident" id="4429485">err</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429498">if</span>&nbsp;<span class="builtinfunc" id="4429501">len</span><span class="op" id="4429504">(</span><span class="ident" id="4429505">c</span><span class="op" id="4429506">.</span><span class="ident" id="4429507">Certificates</span><span class="op" id="4429519">)</span>&nbsp;<span class="op" id="4429521">==</span>&nbsp;<span class="num" id="4429524">1</span>&nbsp;<span class="op" id="4429526">||</span>&nbsp;<span class="ident" id="4429529">c</span><span class="op" id="4429530">.</span><span class="ident" id="4429531">NameToCertificate</span>&nbsp;<span class="op" id="4429549">==</span>&nbsp;<span class="ident" id="4429552">nil</span>&nbsp;<span class="op" id="4429556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4429560">//&nbsp;There&#39;s&nbsp;only&nbsp;one&nbsp;choice,&nbsp;so&nbsp;no&nbsp;point&nbsp;doing&nbsp;any&nbsp;work.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429618">return</span>&nbsp;<span class="op" id="4429625">&amp;</span><span class="ident" id="4429626">c</span><span class="op" id="4429627">.</span><span class="ident" id="4429628">Certificates</span><span class="op" id="4429640">[</span><span class="num" id="4429641">0</span><span class="op" id="4429642">]</span><span class="op" id="4429643">,</span>&nbsp;<span class="ident" id="4429645">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429654">name</span>&nbsp;<span class="op" id="4429659">:=</span>&nbsp;<span class="ident" id="4429662">strings</span><span class="op" id="4429669">.</span><span class="ident" id="4429670">ToLower</span><span class="op" id="4429677">(</span><span class="ident" id="4429678">clientHello</span><span class="op" id="4429689">.</span><span class="ident" id="4429690">ServerName</span><span class="op" id="4429700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429703">for</span>&nbsp;<span class="builtinfunc" id="4429707">len</span><span class="op" id="4429710">(</span><span class="ident" id="4429711">name</span><span class="op" id="4429715">)</span>&nbsp;<span class="op" id="4429717">&gt;</span>&nbsp;<span class="num" id="4429719">0</span>&nbsp;<span class="op" id="4429721">&amp;&amp;</span>&nbsp;<span class="ident" id="4429724">name</span><span class="op" id="4429728">[</span><span class="builtinfunc" id="4429729">len</span><span class="op" id="4429732">(</span><span class="ident" id="4429733">name</span><span class="op" id="4429737">)</span><span class="op" id="4429738">-</span><span class="num" id="4429739">1</span><span class="op" id="4429740">]</span>&nbsp;<span class="op" id="4429742">==</span>&nbsp;<span class="string" id="4429745">&#39;.&#39;</span>&nbsp;<span class="op" id="4429749">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429753">name</span>&nbsp;<span class="op" id="4429758">=</span>&nbsp;<span class="ident" id="4429760">name</span><span class="op" id="4429764">[</span><span class="op" id="4429765">:</span><span class="builtinfunc" id="4429766">len</span><span class="op" id="4429769">(</span><span class="ident" id="4429770">name</span><span class="op" id="4429774">)</span><span class="op" id="4429775">-</span><span class="num" id="4429776">1</span><span class="op" id="4429777">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429784">if</span>&nbsp;<span class="ident" id="4429787">cert</span><span class="op" id="4429791">,</span>&nbsp;<span class="ident" id="4429793">ok</span>&nbsp;<span class="op" id="4429796">:=</span>&nbsp;<span class="ident" id="4429799">c</span><span class="op" id="4429800">.</span><span class="ident" id="4429801">NameToCertificate</span><span class="op" id="4429818">[</span><span class="ident" id="4429819">name</span><span class="op" id="4429823">]</span><span class="op" id="4429824">;</span>&nbsp;<span class="ident" id="4429826">ok</span>&nbsp;<span class="op" id="4429829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429833">return</span>&nbsp;<span class="ident" id="4429840">cert</span><span class="op" id="4429844">,</span>&nbsp;<span class="ident" id="4429846">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4429855">//&nbsp;try&nbsp;replacing&nbsp;labels&nbsp;in&nbsp;the&nbsp;name&nbsp;with&nbsp;wildcards&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4429922">//&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429933">labels</span>&nbsp;<span class="op" id="4429940">:=</span>&nbsp;<span class="ident" id="4429943">strings</span><span class="op" id="4429950">.</span><span class="ident" id="4429951">Split</span><span class="op" id="4429956">(</span><span class="ident" id="4429957">name</span><span class="op" id="4429961">,</span>&nbsp;<span class="string" id="4429963">&#34;.&#34;</span><span class="op" id="4429966">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429969">for</span>&nbsp;<span class="ident" id="4429973">i</span>&nbsp;<span class="op" id="4429975">:=</span>&nbsp;<span class="keyword" id="4429978">range</span>&nbsp;<span class="ident" id="4429984">labels</span>&nbsp;<span class="op" id="4429991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429995">labels</span><span class="op" id="4430001">[</span><span class="ident" id="4430002">i</span><span class="op" id="4430003">]</span>&nbsp;<span class="op" id="4430005">=</span>&nbsp;<span class="string" id="4430007">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430013">candidate</span>&nbsp;<span class="op" id="4430023">:=</span>&nbsp;<span class="ident" id="4430026">strings</span><span class="op" id="4430033">.</span><span class="ident" id="4430034">Join</span><span class="op" id="4430038">(</span><span class="ident" id="4430039">labels</span><span class="op" id="4430045">,</span>&nbsp;<span class="string" id="4430047">&#34;.&#34;</span><span class="op" id="4430050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430054">if</span>&nbsp;<span class="ident" id="4430057">cert</span><span class="op" id="4430061">,</span>&nbsp;<span class="ident" id="4430063">ok</span>&nbsp;<span class="op" id="4430066">:=</span>&nbsp;<span class="ident" id="4430069">c</span><span class="op" id="4430070">.</span><span class="ident" id="4430071">NameToCertificate</span><span class="op" id="4430088">[</span><span class="ident" id="4430089">candidate</span><span class="op" id="4430098">]</span><span class="op" id="4430099">;</span>&nbsp;<span class="ident" id="4430101">ok</span>&nbsp;<span class="op" id="4430104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430109">return</span>&nbsp;<span class="ident" id="4430116">cert</span><span class="op" id="4430120">,</span>&nbsp;<span class="ident" id="4430122">nil</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430135">//&nbsp;If&nbsp;nothing&nbsp;matches,&nbsp;return&nbsp;the&nbsp;first&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430189">return</span>&nbsp;<span class="op" id="4430196">&amp;</span><span class="ident" id="4430197">c</span><span class="op" id="4430198">.</span><span class="ident" id="4430199">Certificates</span><span class="op" id="4430211">[</span><span class="num" id="4430212">0</span><span class="op" id="4430213">]</span><span class="op" id="4430214">,</span>&nbsp;<span class="ident" id="4430216">nil</span><br>
<span class="lineno">465</span><span class="op" id="4430220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4430223">//&nbsp;BuildNameToCertificate&nbsp;parses&nbsp;c.Certificates&nbsp;and&nbsp;builds&nbsp;c.NameToCertificate</span><br>
<span class="lineno"></span><span class="comment" id="4430302">//&nbsp;from&nbsp;the&nbsp;CommonName&nbsp;and&nbsp;SubjectAlternateName&nbsp;fields&nbsp;of&nbsp;each&nbsp;of&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span><span class="comment" id="4430377">//&nbsp;certificates.</span><br>
<span class="lineno">470</span><span class="keyword" id="4430394">func</span>&nbsp;<span class="op" id="4430399">(</span><span class="ident" id="4430400">c</span>&nbsp;<span class="op" id="4430402">*</span><span class="ident" id="4430403">Config</span><span class="op" id="4430409">)</span>&nbsp;<span class="ident" id="4430411">BuildNameToCertificate</span><span class="op" id="4430433">(</span><span class="op" id="4430434">)</span>&nbsp;<span class="op" id="4430436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430439">c</span><span class="op" id="4430440">.</span><span class="ident" id="4430441">NameToCertificate</span>&nbsp;<span class="op" id="4430459">=</span>&nbsp;<span class="builtinfunc" id="4430461">make</span><span class="op" id="4430465">(</span><span class="keyword" id="4430466">map</span><span class="op" id="4430469">[</span><span class="builtintype" id="4430470">string</span><span class="op" id="4430476">]</span><span class="op" id="4430477">*</span><span class="ident" id="4430478">Certificate</span><span class="op" id="4430489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430492">for</span>&nbsp;<span class="ident" id="4430496">i</span>&nbsp;<span class="op" id="4430498">:=</span>&nbsp;<span class="keyword" id="4430501">range</span>&nbsp;<span class="ident" id="4430507">c</span><span class="op" id="4430508">.</span><span class="ident" id="4430509">Certificates</span>&nbsp;<span class="op" id="4430522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430526">cert</span>&nbsp;<span class="op" id="4430531">:=</span>&nbsp;<span class="op" id="4430534">&amp;</span><span class="ident" id="4430535">c</span><span class="op" id="4430536">.</span><span class="ident" id="4430537">Certificates</span><span class="op" id="4430549">[</span><span class="ident" id="4430550">i</span><span class="op" id="4430551">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430555">x509Cert</span><span class="op" id="4430563">,</span>&nbsp;<span class="ident" id="4430565">err</span>&nbsp;<span class="op" id="4430569">:=</span>&nbsp;<span class="ident" id="4430572">x509</span><span class="op" id="4430576">.</span><span class="ident" id="4430577">ParseCertificate</span><span class="op" id="4430593">(</span><span class="ident" id="4430594">cert</span><span class="op" id="4430598">.</span><span class="ident" id="4430599">Certificate</span><span class="op" id="4430610">[</span><span class="num" id="4430611">0</span><span class="op" id="4430612">]</span><span class="op" id="4430613">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430617">if</span>&nbsp;<span class="ident" id="4430620">err</span>&nbsp;<span class="op" id="4430624">!=</span>&nbsp;<span class="ident" id="4430627">nil</span>&nbsp;<span class="op" id="4430631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430636">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430651">if</span>&nbsp;<span class="builtinfunc" id="4430654">len</span><span class="op" id="4430657">(</span><span class="ident" id="4430658">x509Cert</span><span class="op" id="4430666">.</span><span class="ident" id="4430667">Subject</span><span class="op" id="4430674">.</span><span class="ident" id="4430675">CommonName</span><span class="op" id="4430685">)</span>&nbsp;<span class="op" id="4430687">&gt;</span>&nbsp;<span class="num" id="4430689">0</span>&nbsp;<span class="op" id="4430691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430696">c</span><span class="op" id="4430697">.</span><span class="ident" id="4430698">NameToCertificate</span><span class="op" id="4430715">[</span><span class="ident" id="4430716">x509Cert</span><span class="op" id="4430724">.</span><span class="ident" id="4430725">Subject</span><span class="op" id="4430732">.</span><span class="ident" id="4430733">CommonName</span><span class="op" id="4430743">]</span>&nbsp;<span class="op" id="4430745">=</span>&nbsp;<span class="ident" id="4430747">cert</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430758">for</span>&nbsp;<span class="ident" id="4430762">_</span><span class="op" id="4430763">,</span>&nbsp;<span class="ident" id="4430765">san</span>&nbsp;<span class="op" id="4430769">:=</span>&nbsp;<span class="keyword" id="4430772">range</span>&nbsp;<span class="ident" id="4430778">x509Cert</span><span class="op" id="4430786">.</span><span class="ident" id="4430787">DNSNames</span>&nbsp;<span class="op" id="4430796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430801">c</span><span class="op" id="4430802">.</span><span class="ident" id="4430803">NameToCertificate</span><span class="op" id="4430820">[</span><span class="ident" id="4430821">san</span><span class="op" id="4430824">]</span>&nbsp;<span class="op" id="4430826">=</span>&nbsp;<span class="ident" id="4430828">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430838">}</span><br>
<span class="lineno">485</span><span class="op" id="4430840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4430843">//&nbsp;A&nbsp;Certificate&nbsp;is&nbsp;a&nbsp;chain&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;certificates,&nbsp;leaf&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4430912">type</span>&nbsp;<span class="ident" id="4430917">Certificate</span>&nbsp;<span class="keyword" id="4430929">struct</span>&nbsp;<span class="op" id="4430936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430939">Certificate</span>&nbsp;<span class="op" id="4430951">[</span><span class="op" id="4430952">]</span><span class="op" id="4430953">[</span><span class="op" id="4430954">]</span><span class="builtintype" id="4430955">byte</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430961">//&nbsp;PrivateKey&nbsp;contains&nbsp;the&nbsp;private&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;public&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4431033">//&nbsp;in&nbsp;Leaf.&nbsp;For&nbsp;a&nbsp;server,&nbsp;this&nbsp;must&nbsp;be&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4431094">//&nbsp;*ecdsa.PrivateKey.&nbsp;For&nbsp;a&nbsp;client&nbsp;doing&nbsp;client&nbsp;authentication,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4431164">//&nbsp;can&nbsp;be&nbsp;any&nbsp;type&nbsp;that&nbsp;implements&nbsp;crypto.Signer&nbsp;(which&nbsp;includes&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4431234">//&nbsp;and&nbsp;ECDSA&nbsp;private&nbsp;keys).</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431263">PrivateKey</span>&nbsp;<span class="ident" id="4431274">crypto</span><span class="op" id="4431280">.</span><span class="ident" id="4431281">PrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4431293">//&nbsp;OCSPStaple&nbsp;contains&nbsp;an&nbsp;optional&nbsp;OCSP&nbsp;response&nbsp;which&nbsp;will&nbsp;be&nbsp;served</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4431364">//&nbsp;to&nbsp;clients&nbsp;that&nbsp;request&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431396">OCSPStaple</span>&nbsp;<span class="op" id="4431407">[</span><span class="op" id="4431408">]</span><span class="builtintype" id="4431409">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4431415">//&nbsp;Leaf&nbsp;is&nbsp;the&nbsp;parsed&nbsp;form&nbsp;of&nbsp;the&nbsp;leaf&nbsp;certificate,&nbsp;which&nbsp;may&nbsp;be</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4431481">//&nbsp;initialized&nbsp;using&nbsp;x509.ParseCertificate&nbsp;to&nbsp;reduce&nbsp;per-handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4431549">//&nbsp;processing&nbsp;for&nbsp;TLS&nbsp;clients&nbsp;doing&nbsp;client&nbsp;authentication.&nbsp;If&nbsp;nil,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4431621">//&nbsp;leaf&nbsp;certificate&nbsp;will&nbsp;be&nbsp;parsed&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431668">Leaf</span>&nbsp;<span class="op" id="4431673">*</span><span class="ident" id="4431674">x509</span><span class="op" id="4431678">.</span><span class="ident" id="4431679">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4431691">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="comment" id="4431694">//&nbsp;A&nbsp;TLS&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="4431711">type</span>&nbsp;<span class="ident" id="4431716">record</span>&nbsp;<span class="keyword" id="4431723">struct</span>&nbsp;<span class="op" id="4431730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431733">contentType</span>&nbsp;&nbsp;<span class="ident" id="4431746">recordType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431758">major</span><span class="op" id="4431763">,</span>&nbsp;<span class="ident" id="4431765">minor</span>&nbsp;<span class="builtintype" id="4431771">uint8</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431778">payload</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4431791">[</span><span class="op" id="4431792">]</span><span class="builtintype" id="4431793">byte</span><br>
<span class="lineno"></span><span class="op" id="4431798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4431801">type</span>&nbsp;<span class="ident" id="4431806">handshakeMessage</span>&nbsp;<span class="keyword" id="4431823">interface</span>&nbsp;<span class="op" id="4431833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431836">marshal</span><span class="op" id="4431843">(</span><span class="op" id="4431844">)</span>&nbsp;<span class="op" id="4431846">[</span><span class="op" id="4431847">]</span><span class="builtintype" id="4431848">byte</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431854">unmarshal</span><span class="op" id="4431863">(</span><span class="op" id="4431864">[</span><span class="op" id="4431865">]</span><span class="builtintype" id="4431866">byte</span><span class="op" id="4431870">)</span>&nbsp;<span class="builtintype" id="4431872">bool</span><br>
<span class="lineno"></span><span class="op" id="4431877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4431880">//&nbsp;lruSessionCache&nbsp;is&nbsp;a&nbsp;ClientSessionCache&nbsp;implementation&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU</span><br>
<span class="lineno"></span><span class="comment" id="4431955">//&nbsp;caching&nbsp;strategy.</span><br>
<span class="lineno">520</span><span class="keyword" id="4431976">type</span>&nbsp;<span class="ident" id="4431981">lruSessionCache</span>&nbsp;<span class="keyword" id="4431997">struct</span>&nbsp;<span class="op" id="4432004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432007">sync</span><span class="op" id="4432011">.</span><span class="ident" id="4432012">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432020">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4432029">map</span><span class="op" id="4432032">[</span><span class="builtintype" id="4432033">string</span><span class="op" id="4432039">]</span><span class="op" id="4432040">*</span><span class="ident" id="4432041">list</span><span class="op" id="4432045">.</span><span class="ident" id="4432046">Element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432055">q</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4432064">*</span><span class="ident" id="4432065">list</span><span class="op" id="4432069">.</span><span class="ident" id="4432070">List</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432076">capacity</span>&nbsp;<span class="builtintype" id="4432085">int</span><br>
<span class="lineno"></span><span class="op" id="4432089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4432092">type</span>&nbsp;<span class="ident" id="4432097">lruSessionCacheEntry</span>&nbsp;<span class="keyword" id="4432118">struct</span>&nbsp;<span class="op" id="4432125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432128">sessionKey</span>&nbsp;<span class="builtintype" id="4432139">string</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432147">state</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4432158">*</span><span class="ident" id="4432159">ClientSessionState</span><br>
<span class="lineno"></span><span class="op" id="4432178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4432181">//&nbsp;NewLRUClientSessionCache&nbsp;returns&nbsp;a&nbsp;ClientSessionCache&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="4432253">//&nbsp;capacity&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU&nbsp;strategy.&nbsp;If&nbsp;capacity&nbsp;is&nbsp;&lt;&nbsp;1,&nbsp;a&nbsp;default&nbsp;capacity</span><br>
<span class="lineno">535</span><span class="comment" id="4432331">//&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="4432351">func</span>&nbsp;<span class="ident" id="4432356">NewLRUClientSessionCache</span><span class="op" id="4432380">(</span><span class="ident" id="4432381">capacity</span>&nbsp;<span class="builtintype" id="4432390">int</span><span class="op" id="4432393">)</span>&nbsp;<span class="ident" id="4432395">ClientSessionCache</span>&nbsp;<span class="op" id="4432414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432417">const</span>&nbsp;<span class="ident" id="4432423">defaultSessionCacheCapacity</span>&nbsp;<span class="op" id="4432451">=</span>&nbsp;<span class="num" id="4432453">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432458">if</span>&nbsp;<span class="ident" id="4432461">capacity</span>&nbsp;<span class="op" id="4432470">&lt;</span>&nbsp;<span class="num" id="4432472">1</span>&nbsp;<span class="op" id="4432474">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432478">capacity</span>&nbsp;<span class="op" id="4432487">=</span>&nbsp;<span class="ident" id="4432489">defaultSessionCacheCapacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432521">return</span>&nbsp;<span class="op" id="4432528">&amp;</span><span class="ident" id="4432529">lruSessionCache</span><span class="op" id="4432544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432548">m</span><span class="op" id="4432549">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4432558">make</span><span class="op" id="4432562">(</span><span class="keyword" id="4432563">map</span><span class="op" id="4432566">[</span><span class="builtintype" id="4432567">string</span><span class="op" id="4432573">]</span><span class="op" id="4432574">*</span><span class="ident" id="4432575">list</span><span class="op" id="4432579">.</span><span class="ident" id="4432580">Element</span><span class="op" id="4432587">)</span><span class="op" id="4432588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432592">q</span><span class="op" id="4432593">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4432602">list</span><span class="op" id="4432606">.</span><span class="ident" id="4432607">New</span><span class="op" id="4432610">(</span><span class="op" id="4432611">)</span><span class="op" id="4432612">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432616">capacity</span><span class="op" id="4432624">:</span>&nbsp;<span class="ident" id="4432626">capacity</span><span class="op" id="4432634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432637">}</span><br>
<span class="lineno"></span><span class="op" id="4432639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4432642">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;provided&nbsp;(sessionKey,&nbsp;cs)&nbsp;pair&nbsp;to&nbsp;the&nbsp;cache.</span><br>
<span class="lineno">550</span><span class="keyword" id="4432703">func</span>&nbsp;<span class="op" id="4432708">(</span><span class="ident" id="4432709">c</span>&nbsp;<span class="op" id="4432711">*</span><span class="ident" id="4432712">lruSessionCache</span><span class="op" id="4432727">)</span>&nbsp;<span class="ident" id="4432729">Put</span><span class="op" id="4432732">(</span><span class="ident" id="4432733">sessionKey</span>&nbsp;<span class="builtintype" id="4432744">string</span><span class="op" id="4432750">,</span>&nbsp;<span class="ident" id="4432752">cs</span>&nbsp;<span class="op" id="4432755">*</span><span class="ident" id="4432756">ClientSessionState</span><span class="op" id="4432774">)</span>&nbsp;<span class="op" id="4432776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432779">c</span><span class="op" id="4432780">.</span><span class="ident" id="4432781">Lock</span><span class="op" id="4432785">(</span><span class="op" id="4432786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432789">defer</span>&nbsp;<span class="ident" id="4432795">c</span><span class="op" id="4432796">.</span><span class="ident" id="4432797">Unlock</span><span class="op" id="4432803">(</span><span class="op" id="4432804">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432808">if</span>&nbsp;<span class="ident" id="4432811">elem</span><span class="op" id="4432815">,</span>&nbsp;<span class="ident" id="4432817">ok</span>&nbsp;<span class="op" id="4432820">:=</span>&nbsp;<span class="ident" id="4432823">c</span><span class="op" id="4432824">.</span><span class="ident" id="4432825">m</span><span class="op" id="4432826">[</span><span class="ident" id="4432827">sessionKey</span><span class="op" id="4432837">]</span><span class="op" id="4432838">;</span>&nbsp;<span class="ident" id="4432840">ok</span>&nbsp;<span class="op" id="4432843">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432847">entry</span>&nbsp;<span class="op" id="4432853">:=</span>&nbsp;<span class="ident" id="4432856">elem</span><span class="op" id="4432860">.</span><span class="ident" id="4432861">Value</span><span class="op" id="4432866">.</span><span class="op" id="4432867">(</span><span class="op" id="4432868">*</span><span class="ident" id="4432869">lruSessionCacheEntry</span><span class="op" id="4432889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432893">entry</span><span class="op" id="4432898">.</span><span class="ident" id="4432899">state</span>&nbsp;<span class="op" id="4432905">=</span>&nbsp;<span class="ident" id="4432907">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432912">c</span><span class="op" id="4432913">.</span><span class="ident" id="4432914">q</span><span class="op" id="4432915">.</span><span class="ident" id="4432916">MoveToFront</span><span class="op" id="4432927">(</span><span class="ident" id="4432928">elem</span><span class="op" id="4432932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432936">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432944">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432948">if</span>&nbsp;<span class="ident" id="4432951">c</span><span class="op" id="4432952">.</span><span class="ident" id="4432953">q</span><span class="op" id="4432954">.</span><span class="ident" id="4432955">Len</span><span class="op" id="4432958">(</span><span class="op" id="4432959">)</span>&nbsp;<span class="op" id="4432961">&lt;</span>&nbsp;<span class="ident" id="4432963">c</span><span class="op" id="4432964">.</span><span class="ident" id="4432965">capacity</span>&nbsp;<span class="op" id="4432974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432978">entry</span>&nbsp;<span class="op" id="4432984">:=</span>&nbsp;<span class="op" id="4432987">&amp;</span><span class="ident" id="4432988">lruSessionCacheEntry</span><span class="op" id="4433008">{</span><span class="ident" id="4433009">sessionKey</span><span class="op" id="4433019">,</span>&nbsp;<span class="ident" id="4433021">cs</span><span class="op" id="4433023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433027">c</span><span class="op" id="4433028">.</span><span class="ident" id="4433029">m</span><span class="op" id="4433030">[</span><span class="ident" id="4433031">sessionKey</span><span class="op" id="4433041">]</span>&nbsp;<span class="op" id="4433043">=</span>&nbsp;<span class="ident" id="4433045">c</span><span class="op" id="4433046">.</span><span class="ident" id="4433047">q</span><span class="op" id="4433048">.</span><span class="ident" id="4433049">PushFront</span><span class="op" id="4433058">(</span><span class="ident" id="4433059">entry</span><span class="op" id="4433064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433068">return</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433080">elem</span>&nbsp;<span class="op" id="4433085">:=</span>&nbsp;<span class="ident" id="4433088">c</span><span class="op" id="4433089">.</span><span class="ident" id="4433090">q</span><span class="op" id="4433091">.</span><span class="ident" id="4433092">Back</span><span class="op" id="4433096">(</span><span class="op" id="4433097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433100">entry</span>&nbsp;<span class="op" id="4433106">:=</span>&nbsp;<span class="ident" id="4433109">elem</span><span class="op" id="4433113">.</span><span class="ident" id="4433114">Value</span><span class="op" id="4433119">.</span><span class="op" id="4433120">(</span><span class="op" id="4433121">*</span><span class="ident" id="4433122">lruSessionCacheEntry</span><span class="op" id="4433142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4433145">delete</span><span class="op" id="4433151">(</span><span class="ident" id="4433152">c</span><span class="op" id="4433153">.</span><span class="ident" id="4433154">m</span><span class="op" id="4433155">,</span>&nbsp;<span class="ident" id="4433157">entry</span><span class="op" id="4433162">.</span><span class="ident" id="4433163">sessionKey</span><span class="op" id="4433173">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433176">entry</span><span class="op" id="4433181">.</span><span class="ident" id="4433182">sessionKey</span>&nbsp;<span class="op" id="4433193">=</span>&nbsp;<span class="ident" id="4433195">sessionKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433207">entry</span><span class="op" id="4433212">.</span><span class="ident" id="4433213">state</span>&nbsp;<span class="op" id="4433219">=</span>&nbsp;<span class="ident" id="4433221">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433225">c</span><span class="op" id="4433226">.</span><span class="ident" id="4433227">q</span><span class="op" id="4433228">.</span><span class="ident" id="4433229">MoveToFront</span><span class="op" id="4433240">(</span><span class="ident" id="4433241">elem</span><span class="op" id="4433245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433248">c</span><span class="op" id="4433249">.</span><span class="ident" id="4433250">m</span><span class="op" id="4433251">[</span><span class="ident" id="4433252">sessionKey</span><span class="op" id="4433262">]</span>&nbsp;<span class="op" id="4433264">=</span>&nbsp;<span class="ident" id="4433266">elem</span><br>
<span class="lineno"></span><span class="op" id="4433271">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="4433274">//&nbsp;Get&nbsp;returns&nbsp;the&nbsp;ClientSessionState&nbsp;value&nbsp;associated&nbsp;with&nbsp;a&nbsp;given&nbsp;key.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4433350">//&nbsp;returns&nbsp;(nil,&nbsp;false)&nbsp;if&nbsp;no&nbsp;value&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="4433396">func</span>&nbsp;<span class="op" id="4433401">(</span><span class="ident" id="4433402">c</span>&nbsp;<span class="op" id="4433404">*</span><span class="ident" id="4433405">lruSessionCache</span><span class="op" id="4433420">)</span>&nbsp;<span class="ident" id="4433422">Get</span><span class="op" id="4433425">(</span><span class="ident" id="4433426">sessionKey</span>&nbsp;<span class="builtintype" id="4433437">string</span><span class="op" id="4433443">)</span>&nbsp;<span class="op" id="4433445">(</span><span class="op" id="4433446">*</span><span class="ident" id="4433447">ClientSessionState</span><span class="op" id="4433465">,</span>&nbsp;<span class="builtintype" id="4433467">bool</span><span class="op" id="4433471">)</span>&nbsp;<span class="op" id="4433473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433476">c</span><span class="op" id="4433477">.</span><span class="ident" id="4433478">Lock</span><span class="op" id="4433482">(</span><span class="op" id="4433483">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433486">defer</span>&nbsp;<span class="ident" id="4433492">c</span><span class="op" id="4433493">.</span><span class="ident" id="4433494">Unlock</span><span class="op" id="4433500">(</span><span class="op" id="4433501">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433505">if</span>&nbsp;<span class="ident" id="4433508">elem</span><span class="op" id="4433512">,</span>&nbsp;<span class="ident" id="4433514">ok</span>&nbsp;<span class="op" id="4433517">:=</span>&nbsp;<span class="ident" id="4433520">c</span><span class="op" id="4433521">.</span><span class="ident" id="4433522">m</span><span class="op" id="4433523">[</span><span class="ident" id="4433524">sessionKey</span><span class="op" id="4433534">]</span><span class="op" id="4433535">;</span>&nbsp;<span class="ident" id="4433537">ok</span>&nbsp;<span class="op" id="4433540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433544">c</span><span class="op" id="4433545">.</span><span class="ident" id="4433546">q</span><span class="op" id="4433547">.</span><span class="ident" id="4433548">MoveToFront</span><span class="op" id="4433559">(</span><span class="ident" id="4433560">elem</span><span class="op" id="4433564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433568">return</span>&nbsp;<span class="ident" id="4433575">elem</span><span class="op" id="4433579">.</span><span class="ident" id="4433580">Value</span><span class="op" id="4433585">.</span><span class="op" id="4433586">(</span><span class="op" id="4433587">*</span><span class="ident" id="4433588">lruSessionCacheEntry</span><span class="op" id="4433608">)</span><span class="op" id="4433609">.</span><span class="ident" id="4433610">state</span><span class="op" id="4433615">,</span>&nbsp;<span class="builtintype" id="4433617">true</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433626">return</span>&nbsp;<span class="ident" id="4433633">nil</span><span class="op" id="4433636">,</span>&nbsp;<span class="builtintype" id="4433638">false</span><br>
<span class="lineno"></span><span class="op" id="4433644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4433647">//&nbsp;TODO(jsing):&nbsp;Make&nbsp;these&nbsp;available&nbsp;to&nbsp;both&nbsp;crypto/x509&nbsp;and&nbsp;crypto/tls.</span><br>
<span class="lineno">590</span><span class="keyword" id="4433720">type</span>&nbsp;<span class="ident" id="4433725">dsaSignature</span>&nbsp;<span class="keyword" id="4433738">struct</span>&nbsp;<span class="op" id="4433745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433748">R</span><span class="op" id="4433749">,</span>&nbsp;<span class="ident" id="4433751">S</span>&nbsp;<span class="op" id="4433753">*</span><span class="ident" id="4433754">big</span><span class="op" id="4433757">.</span><span class="ident" id="4433758">Int</span><br>
<span class="lineno"></span><span class="op" id="4433762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4433765">type</span>&nbsp;<span class="ident" id="4433770">ecdsaSignature</span>&nbsp;<span class="ident" id="4433785">dsaSignature</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="4433799">var</span>&nbsp;<span class="ident" id="4433803">emptyConfig</span>&nbsp;<span class="ident" id="4433815">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4433823">func</span>&nbsp;<span class="ident" id="4433828">defaultConfig</span><span class="op" id="4433841">(</span><span class="op" id="4433842">)</span>&nbsp;<span class="op" id="4433844">*</span><span class="ident" id="4433845">Config</span>&nbsp;<span class="op" id="4433852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433855">return</span>&nbsp;<span class="op" id="4433862">&amp;</span><span class="ident" id="4433863">emptyConfig</span><br>
<span class="lineno">600</span><span class="op" id="4433875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4433878">var</span>&nbsp;<span class="op" id="4433882">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433885">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4433908">sync</span><span class="op" id="4433912">.</span><span class="ident" id="4433913">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433919">varDefaultCipherSuites</span>&nbsp;<span class="op" id="4433942">[</span><span class="op" id="4433943">]</span><span class="builtintype" id="4433944">uint16</span><br>
<span class="lineno">605</span><span class="op" id="4433951">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4433954">func</span>&nbsp;<span class="ident" id="4433959">defaultCipherSuites</span><span class="op" id="4433978">(</span><span class="op" id="4433979">)</span>&nbsp;<span class="op" id="4433981">[</span><span class="op" id="4433982">]</span><span class="builtintype" id="4433983">uint16</span>&nbsp;<span class="op" id="4433990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433993">once</span><span class="op" id="4433997">.</span><span class="ident" id="4433998">Do</span><span class="op" id="4434000">(</span><span class="ident" id="4434001">initDefaultCipherSuites</span><span class="op" id="4434024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434027">return</span>&nbsp;<span class="ident" id="4434034">varDefaultCipherSuites</span><br>
<span class="lineno">610</span><span class="op" id="4434057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4434060">func</span>&nbsp;<span class="ident" id="4434065">initDefaultCipherSuites</span><span class="op" id="4434088">(</span><span class="op" id="4434089">)</span>&nbsp;<span class="op" id="4434091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434094">varDefaultCipherSuites</span>&nbsp;<span class="op" id="4434117">=</span>&nbsp;<span class="builtinfunc" id="4434119">make</span><span class="op" id="4434123">(</span><span class="op" id="4434124">[</span><span class="op" id="4434125">]</span><span class="builtintype" id="4434126">uint16</span><span class="op" id="4434132">,</span>&nbsp;<span class="builtinfunc" id="4434134">len</span><span class="op" id="4434137">(</span><span class="ident" id="4434138">cipherSuites</span><span class="op" id="4434150">)</span><span class="op" id="4434151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434154">for</span>&nbsp;<span class="ident" id="4434158">i</span><span class="op" id="4434159">,</span>&nbsp;<span class="ident" id="4434161">suite</span>&nbsp;<span class="op" id="4434167">:=</span>&nbsp;<span class="keyword" id="4434170">range</span>&nbsp;<span class="ident" id="4434176">cipherSuites</span>&nbsp;<span class="op" id="4434189">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434193">varDefaultCipherSuites</span><span class="op" id="4434215">[</span><span class="ident" id="4434216">i</span><span class="op" id="4434217">]</span>&nbsp;<span class="op" id="4434219">=</span>&nbsp;<span class="ident" id="4434221">suite</span><span class="op" id="4434226">.</span><span class="ident" id="4434227">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434231">}</span><br>
<span class="lineno"></span><span class="op" id="4434233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4434236">func</span>&nbsp;<span class="ident" id="4434241">unexpectedMessageError</span><span class="op" id="4434263">(</span><span class="ident" id="4434264">wanted</span><span class="op" id="4434270">,</span>&nbsp;<span class="ident" id="4434272">got</span>&nbsp;<span class="keyword" id="4434276">interface</span><span class="op" id="4434285">{</span><span class="op" id="4434286">}</span><span class="op" id="4434287">)</span>&nbsp;<span class="builtintype" id="4434289">error</span>&nbsp;<span class="op" id="4434295">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434298">return</span>&nbsp;<span class="ident" id="4434305">fmt</span><span class="op" id="4434308">.</span><span class="ident" id="4434309">Errorf</span><span class="op" id="4434315">(</span><span class="string" id="4434316">&#34;tls:&nbsp;received&nbsp;unexpected&nbsp;handshake&nbsp;message&nbsp;of&nbsp;type&nbsp;%T&nbsp;when&nbsp;waiting&nbsp;for&nbsp;%T&#34;</span><span class="op" id="4434391">,</span>&nbsp;<span class="ident" id="4434393">got</span><span class="op" id="4434396">,</span>&nbsp;<span class="ident" id="4434398">wanted</span><span class="op" id="4434404">)</span><br>
<span class="lineno"></span><span class="op" id="4434406">}</span>
</div>
</body>
</html>
