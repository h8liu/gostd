<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4129982">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4130037">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4130091">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4130142">package</span>&nbsp;<span class="ident" id="4130150">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4130157">import</span>&nbsp;<span class="op" id="4130164">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4130167">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4130173">&#34;math&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4130180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4130183">const</span>&nbsp;<span class="op" id="4130189">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130192">//&nbsp;The&nbsp;largest&nbsp;offset&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4130221">offsetCodeCount</span>&nbsp;<span class="op" id="4130237">=</span>&nbsp;<span class="num" id="4130239">30</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130244">//&nbsp;The&nbsp;special&nbsp;code&nbsp;used&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4130298">endBlockMarker</span>&nbsp;<span class="op" id="4130313">=</span>&nbsp;<span class="num" id="4130315">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130321">//&nbsp;The&nbsp;first&nbsp;length&nbsp;code.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4130348">lengthCodesStart</span>&nbsp;<span class="op" id="4130365">=</span>&nbsp;<span class="num" id="4130367">257</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130373">//&nbsp;The&nbsp;number&nbsp;of&nbsp;codegen&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4130406">codegenCodeCount</span>&nbsp;<span class="op" id="4130423">=</span>&nbsp;<span class="num" id="4130425">19</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4130429">badCode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4130446">=</span>&nbsp;<span class="num" id="4130448">255</span><br>
<span class="lineno">25</span><span class="op" id="4130452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4130455">//&nbsp;The&nbsp;number&nbsp;of&nbsp;extra&nbsp;bits&nbsp;needed&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4130529">var</span>&nbsp;<span class="ident" id="4130533">lengthExtraBits</span>&nbsp;<span class="op" id="4130549">=</span>&nbsp;<span class="op" id="4130551">[</span><span class="op" id="4130552">]</span><span class="builtintype" id="4130553">int8</span><span class="op" id="4130557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130560">/*&nbsp;257&nbsp;*/</span>&nbsp;<span class="num" id="4130570">0</span><span class="op" id="4130571">,</span>&nbsp;<span class="num" id="4130573">0</span><span class="op" id="4130574">,</span>&nbsp;<span class="num" id="4130576">0</span><span class="op" id="4130577">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130580">/*&nbsp;260&nbsp;*/</span>&nbsp;<span class="num" id="4130590">0</span><span class="op" id="4130591">,</span>&nbsp;<span class="num" id="4130593">0</span><span class="op" id="4130594">,</span>&nbsp;<span class="num" id="4130596">0</span><span class="op" id="4130597">,</span>&nbsp;<span class="num" id="4130599">0</span><span class="op" id="4130600">,</span>&nbsp;<span class="num" id="4130602">0</span><span class="op" id="4130603">,</span>&nbsp;<span class="num" id="4130605">1</span><span class="op" id="4130606">,</span>&nbsp;<span class="num" id="4130608">1</span><span class="op" id="4130609">,</span>&nbsp;<span class="num" id="4130611">1</span><span class="op" id="4130612">,</span>&nbsp;<span class="num" id="4130614">1</span><span class="op" id="4130615">,</span>&nbsp;<span class="num" id="4130617">2</span><span class="op" id="4130618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130621">/*&nbsp;270&nbsp;*/</span>&nbsp;<span class="num" id="4130631">2</span><span class="op" id="4130632">,</span>&nbsp;<span class="num" id="4130634">2</span><span class="op" id="4130635">,</span>&nbsp;<span class="num" id="4130637">2</span><span class="op" id="4130638">,</span>&nbsp;<span class="num" id="4130640">3</span><span class="op" id="4130641">,</span>&nbsp;<span class="num" id="4130643">3</span><span class="op" id="4130644">,</span>&nbsp;<span class="num" id="4130646">3</span><span class="op" id="4130647">,</span>&nbsp;<span class="num" id="4130649">3</span><span class="op" id="4130650">,</span>&nbsp;<span class="num" id="4130652">4</span><span class="op" id="4130653">,</span>&nbsp;<span class="num" id="4130655">4</span><span class="op" id="4130656">,</span>&nbsp;<span class="num" id="4130658">4</span><span class="op" id="4130659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4130662">/*&nbsp;280&nbsp;*/</span>&nbsp;<span class="num" id="4130672">4</span><span class="op" id="4130673">,</span>&nbsp;<span class="num" id="4130675">5</span><span class="op" id="4130676">,</span>&nbsp;<span class="num" id="4130678">5</span><span class="op" id="4130679">,</span>&nbsp;<span class="num" id="4130681">5</span><span class="op" id="4130682">,</span>&nbsp;<span class="num" id="4130684">5</span><span class="op" id="4130685">,</span>&nbsp;<span class="num" id="4130687">0</span><span class="op" id="4130688">,</span><br>
<span class="lineno"></span><span class="op" id="4130690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4130693">//&nbsp;The&nbsp;length&nbsp;indicated&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4130756">var</span>&nbsp;<span class="ident" id="4130760">lengthBase</span>&nbsp;<span class="op" id="4130771">=</span>&nbsp;<span class="op" id="4130773">[</span><span class="op" id="4130774">]</span><span class="builtintype" id="4130775">uint32</span><span class="op" id="4130781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4130784">0</span><span class="op" id="4130785">,</span>&nbsp;<span class="num" id="4130787">1</span><span class="op" id="4130788">,</span>&nbsp;<span class="num" id="4130790">2</span><span class="op" id="4130791">,</span>&nbsp;<span class="num" id="4130793">3</span><span class="op" id="4130794">,</span>&nbsp;<span class="num" id="4130796">4</span><span class="op" id="4130797">,</span>&nbsp;<span class="num" id="4130799">5</span><span class="op" id="4130800">,</span>&nbsp;<span class="num" id="4130802">6</span><span class="op" id="4130803">,</span>&nbsp;<span class="num" id="4130805">7</span><span class="op" id="4130806">,</span>&nbsp;<span class="num" id="4130808">8</span><span class="op" id="4130809">,</span>&nbsp;<span class="num" id="4130811">10</span><span class="op" id="4130813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4130816">12</span><span class="op" id="4130818">,</span>&nbsp;<span class="num" id="4130820">14</span><span class="op" id="4130822">,</span>&nbsp;<span class="num" id="4130824">16</span><span class="op" id="4130826">,</span>&nbsp;<span class="num" id="4130828">20</span><span class="op" id="4130830">,</span>&nbsp;<span class="num" id="4130832">24</span><span class="op" id="4130834">,</span>&nbsp;<span class="num" id="4130836">28</span><span class="op" id="4130838">,</span>&nbsp;<span class="num" id="4130840">32</span><span class="op" id="4130842">,</span>&nbsp;<span class="num" id="4130844">40</span><span class="op" id="4130846">,</span>&nbsp;<span class="num" id="4130848">48</span><span class="op" id="4130850">,</span>&nbsp;<span class="num" id="4130852">56</span><span class="op" id="4130854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4130857">64</span><span class="op" id="4130859">,</span>&nbsp;<span class="num" id="4130861">80</span><span class="op" id="4130863">,</span>&nbsp;<span class="num" id="4130865">96</span><span class="op" id="4130867">,</span>&nbsp;<span class="num" id="4130869">112</span><span class="op" id="4130872">,</span>&nbsp;<span class="num" id="4130874">128</span><span class="op" id="4130877">,</span>&nbsp;<span class="num" id="4130879">160</span><span class="op" id="4130882">,</span>&nbsp;<span class="num" id="4130884">192</span><span class="op" id="4130887">,</span>&nbsp;<span class="num" id="4130889">224</span><span class="op" id="4130892">,</span>&nbsp;<span class="num" id="4130894">255</span><span class="op" id="4130897">,</span><br>
<span class="lineno">40</span><span class="op" id="4130899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4130902">//&nbsp;offset&nbsp;code&nbsp;word&nbsp;extra&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4130934">var</span>&nbsp;<span class="ident" id="4130938">offsetExtraBits</span>&nbsp;<span class="op" id="4130954">=</span>&nbsp;<span class="op" id="4130956">[</span><span class="op" id="4130957">]</span><span class="builtintype" id="4130958">int8</span><span class="op" id="4130962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4130965">0</span><span class="op" id="4130966">,</span>&nbsp;<span class="num" id="4130968">0</span><span class="op" id="4130969">,</span>&nbsp;<span class="num" id="4130971">0</span><span class="op" id="4130972">,</span>&nbsp;<span class="num" id="4130974">0</span><span class="op" id="4130975">,</span>&nbsp;<span class="num" id="4130977">1</span><span class="op" id="4130978">,</span>&nbsp;<span class="num" id="4130980">1</span><span class="op" id="4130981">,</span>&nbsp;<span class="num" id="4130983">2</span><span class="op" id="4130984">,</span>&nbsp;<span class="num" id="4130986">2</span><span class="op" id="4130987">,</span>&nbsp;<span class="num" id="4130989">3</span><span class="op" id="4130990">,</span>&nbsp;<span class="num" id="4130992">3</span><span class="op" id="4130993">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4130996">4</span><span class="op" id="4130997">,</span>&nbsp;<span class="num" id="4130999">4</span><span class="op" id="4131000">,</span>&nbsp;<span class="num" id="4131002">5</span><span class="op" id="4131003">,</span>&nbsp;<span class="num" id="4131005">5</span><span class="op" id="4131006">,</span>&nbsp;<span class="num" id="4131008">6</span><span class="op" id="4131009">,</span>&nbsp;<span class="num" id="4131011">6</span><span class="op" id="4131012">,</span>&nbsp;<span class="num" id="4131014">7</span><span class="op" id="4131015">,</span>&nbsp;<span class="num" id="4131017">7</span><span class="op" id="4131018">,</span>&nbsp;<span class="num" id="4131020">8</span><span class="op" id="4131021">,</span>&nbsp;<span class="num" id="4131023">8</span><span class="op" id="4131024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4131027">9</span><span class="op" id="4131028">,</span>&nbsp;<span class="num" id="4131030">9</span><span class="op" id="4131031">,</span>&nbsp;<span class="num" id="4131033">10</span><span class="op" id="4131035">,</span>&nbsp;<span class="num" id="4131037">10</span><span class="op" id="4131039">,</span>&nbsp;<span class="num" id="4131041">11</span><span class="op" id="4131043">,</span>&nbsp;<span class="num" id="4131045">11</span><span class="op" id="4131047">,</span>&nbsp;<span class="num" id="4131049">12</span><span class="op" id="4131051">,</span>&nbsp;<span class="num" id="4131053">12</span><span class="op" id="4131055">,</span>&nbsp;<span class="num" id="4131057">13</span><span class="op" id="4131059">,</span>&nbsp;<span class="num" id="4131061">13</span><span class="op" id="4131063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4131066">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4131089">14</span><span class="op" id="4131091">,</span>&nbsp;<span class="num" id="4131093">14</span><span class="op" id="4131095">,</span>&nbsp;<span class="num" id="4131097">15</span><span class="op" id="4131099">,</span>&nbsp;<span class="num" id="4131101">15</span><span class="op" id="4131103">,</span>&nbsp;<span class="num" id="4131105">16</span><span class="op" id="4131107">,</span>&nbsp;<span class="num" id="4131109">16</span><span class="op" id="4131111">,</span>&nbsp;<span class="num" id="4131113">17</span><span class="op" id="4131115">,</span>&nbsp;<span class="num" id="4131117">17</span><span class="op" id="4131119">,</span>&nbsp;<span class="num" id="4131121">18</span><span class="op" id="4131123">,</span>&nbsp;<span class="num" id="4131125">18</span><span class="op" id="4131127">,</span>&nbsp;<span class="num" id="4131129">19</span><span class="op" id="4131131">,</span>&nbsp;<span class="num" id="4131133">19</span><span class="op" id="4131135">,</span>&nbsp;<span class="num" id="4131137">20</span><span class="op" id="4131139">,</span>&nbsp;<span class="num" id="4131141">20</span><span class="op" id="4131143">,</span><br>
<span class="lineno"></span><span class="op" id="4131145">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4131148">var</span>&nbsp;<span class="ident" id="4131152">offsetBase</span>&nbsp;<span class="op" id="4131163">=</span>&nbsp;<span class="op" id="4131165">[</span><span class="op" id="4131166">]</span><span class="builtintype" id="4131167">uint32</span><span class="op" id="4131173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4131176">/*&nbsp;normal&nbsp;deflate&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4131198">0x000000</span><span class="op" id="4131206">,</span>&nbsp;<span class="num" id="4131208">0x000001</span><span class="op" id="4131216">,</span>&nbsp;<span class="num" id="4131218">0x000002</span><span class="op" id="4131226">,</span>&nbsp;<span class="num" id="4131228">0x000003</span><span class="op" id="4131236">,</span>&nbsp;<span class="num" id="4131238">0x000004</span><span class="op" id="4131246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4131249">0x000006</span><span class="op" id="4131257">,</span>&nbsp;<span class="num" id="4131259">0x000008</span><span class="op" id="4131267">,</span>&nbsp;<span class="num" id="4131269">0x00000c</span><span class="op" id="4131277">,</span>&nbsp;<span class="num" id="4131279">0x000010</span><span class="op" id="4131287">,</span>&nbsp;<span class="num" id="4131289">0x000018</span><span class="op" id="4131297">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4131300">0x000020</span><span class="op" id="4131308">,</span>&nbsp;<span class="num" id="4131310">0x000030</span><span class="op" id="4131318">,</span>&nbsp;<span class="num" id="4131320">0x000040</span><span class="op" id="4131328">,</span>&nbsp;<span class="num" id="4131330">0x000060</span><span class="op" id="4131338">,</span>&nbsp;<span class="num" id="4131340">0x000080</span><span class="op" id="4131348">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4131351">0x0000c0</span><span class="op" id="4131359">,</span>&nbsp;<span class="num" id="4131361">0x000100</span><span class="op" id="4131369">,</span>&nbsp;<span class="num" id="4131371">0x000180</span><span class="op" id="4131379">,</span>&nbsp;<span class="num" id="4131381">0x000200</span><span class="op" id="4131389">,</span>&nbsp;<span class="num" id="4131391">0x000300</span><span class="op" id="4131399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4131402">0x000400</span><span class="op" id="4131410">,</span>&nbsp;<span class="num" id="4131412">0x000600</span><span class="op" id="4131420">,</span>&nbsp;<span class="num" id="4131422">0x000800</span><span class="op" id="4131430">,</span>&nbsp;<span class="num" id="4131432">0x000c00</span><span class="op" id="4131440">,</span>&nbsp;<span class="num" id="4131442">0x001000</span><span class="op" id="4131450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4131453">0x001800</span><span class="op" id="4131461">,</span>&nbsp;<span class="num" id="4131463">0x002000</span><span class="op" id="4131471">,</span>&nbsp;<span class="num" id="4131473">0x003000</span><span class="op" id="4131481">,</span>&nbsp;<span class="num" id="4131483">0x004000</span><span class="op" id="4131491">,</span>&nbsp;<span class="num" id="4131493">0x006000</span><span class="op" id="4131501">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4131505">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4131528">0x008000</span><span class="op" id="4131536">,</span>&nbsp;<span class="num" id="4131538">0x00c000</span><span class="op" id="4131546">,</span>&nbsp;<span class="num" id="4131548">0x010000</span><span class="op" id="4131556">,</span>&nbsp;<span class="num" id="4131558">0x018000</span><span class="op" id="4131566">,</span>&nbsp;<span class="num" id="4131568">0x020000</span><span class="op" id="4131576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4131579">0x030000</span><span class="op" id="4131587">,</span>&nbsp;<span class="num" id="4131589">0x040000</span><span class="op" id="4131597">,</span>&nbsp;<span class="num" id="4131599">0x060000</span><span class="op" id="4131607">,</span>&nbsp;<span class="num" id="4131609">0x080000</span><span class="op" id="4131617">,</span>&nbsp;<span class="num" id="4131619">0x0c0000</span><span class="op" id="4131627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4131630">0x100000</span><span class="op" id="4131638">,</span>&nbsp;<span class="num" id="4131640">0x180000</span><span class="op" id="4131648">,</span>&nbsp;<span class="num" id="4131650">0x200000</span><span class="op" id="4131658">,</span>&nbsp;<span class="num" id="4131660">0x300000</span><span class="op" id="4131668">,</span><br>
<span class="lineno"></span><span class="op" id="4131670">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="4131673">//&nbsp;The&nbsp;odd&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;codegen&nbsp;code&nbsp;sizes&nbsp;are&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="4131735">var</span>&nbsp;<span class="ident" id="4131739">codegenOrder</span>&nbsp;<span class="op" id="4131752">=</span>&nbsp;<span class="op" id="4131754">[</span><span class="op" id="4131755">]</span><span class="builtintype" id="4131756">uint32</span><span class="op" id="4131762">{</span><span class="num" id="4131763">16</span><span class="op" id="4131765">,</span>&nbsp;<span class="num" id="4131767">17</span><span class="op" id="4131769">,</span>&nbsp;<span class="num" id="4131771">18</span><span class="op" id="4131773">,</span>&nbsp;<span class="num" id="4131775">0</span><span class="op" id="4131776">,</span>&nbsp;<span class="num" id="4131778">8</span><span class="op" id="4131779">,</span>&nbsp;<span class="num" id="4131781">7</span><span class="op" id="4131782">,</span>&nbsp;<span class="num" id="4131784">9</span><span class="op" id="4131785">,</span>&nbsp;<span class="num" id="4131787">6</span><span class="op" id="4131788">,</span>&nbsp;<span class="num" id="4131790">10</span><span class="op" id="4131792">,</span>&nbsp;<span class="num" id="4131794">5</span><span class="op" id="4131795">,</span>&nbsp;<span class="num" id="4131797">11</span><span class="op" id="4131799">,</span>&nbsp;<span class="num" id="4131801">4</span><span class="op" id="4131802">,</span>&nbsp;<span class="num" id="4131804">12</span><span class="op" id="4131806">,</span>&nbsp;<span class="num" id="4131808">3</span><span class="op" id="4131809">,</span>&nbsp;<span class="num" id="4131811">13</span><span class="op" id="4131813">,</span>&nbsp;<span class="num" id="4131815">2</span><span class="op" id="4131816">,</span>&nbsp;<span class="num" id="4131818">14</span><span class="op" id="4131820">,</span>&nbsp;<span class="num" id="4131822">1</span><span class="op" id="4131823">,</span>&nbsp;<span class="num" id="4131825">15</span><span class="op" id="4131827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4131830">type</span>&nbsp;<span class="ident" id="4131835">huffmanBitWriter</span>&nbsp;<span class="keyword" id="4131852">struct</span>&nbsp;<span class="op" id="4131859">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131862">w</span>&nbsp;<span class="ident" id="4131864">io</span><span class="op" id="4131866">.</span><span class="ident" id="4131867">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4131875">//&nbsp;Data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;written&nbsp;is&nbsp;bytes[0:nbytes]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4131925">//&nbsp;and&nbsp;then&nbsp;the&nbsp;low&nbsp;nbits&nbsp;of&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131961">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4131977">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4131985">nbits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4132001">uint32</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132009">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4132025">[</span><span class="num" id="4132026">64</span><span class="op" id="4132028">]</span><span class="builtintype" id="4132029">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132035">nbytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4132051">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132056">literalFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4132072">[</span><span class="op" id="4132073">]</span><span class="builtintype" id="4132074">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132081">offsetFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4132097">[</span><span class="op" id="4132098">]</span><span class="builtintype" id="4132099">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132106">codegen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4132122">[</span><span class="op" id="4132123">]</span><span class="builtintype" id="4132124">uint8</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132131">codegenFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4132147">[</span><span class="op" id="4132148">]</span><span class="builtintype" id="4132149">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132156">literalEncoding</span>&nbsp;<span class="op" id="4132172">*</span><span class="ident" id="4132173">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132189">offsetEncoding</span>&nbsp;&nbsp;<span class="op" id="4132205">*</span><span class="ident" id="4132206">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132222">codegenEncoding</span>&nbsp;<span class="op" id="4132238">*</span><span class="ident" id="4132239">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132255">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4132271">error</span><br>
<span class="lineno">85</span><span class="op" id="4132277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4132280">func</span>&nbsp;<span class="ident" id="4132285">newHuffmanBitWriter</span><span class="op" id="4132304">(</span><span class="ident" id="4132305">w</span>&nbsp;<span class="ident" id="4132307">io</span><span class="op" id="4132309">.</span><span class="ident" id="4132310">Writer</span><span class="op" id="4132316">)</span>&nbsp;<span class="op" id="4132318">*</span><span class="ident" id="4132319">huffmanBitWriter</span>&nbsp;<span class="op" id="4132336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132339">return</span>&nbsp;<span class="op" id="4132346">&amp;</span><span class="ident" id="4132347">huffmanBitWriter</span><span class="op" id="4132363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132367">w</span><span class="op" id="4132368">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4132384">w</span><span class="op" id="4132385">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132389">literalFreq</span><span class="op" id="4132400">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4132406">make</span><span class="op" id="4132410">(</span><span class="op" id="4132411">[</span><span class="op" id="4132412">]</span><span class="builtintype" id="4132413">int32</span><span class="op" id="4132418">,</span>&nbsp;<span class="ident" id="4132420">maxLit</span><span class="op" id="4132426">)</span><span class="op" id="4132427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132431">offsetFreq</span><span class="op" id="4132441">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4132448">make</span><span class="op" id="4132452">(</span><span class="op" id="4132453">[</span><span class="op" id="4132454">]</span><span class="builtintype" id="4132455">int32</span><span class="op" id="4132460">,</span>&nbsp;<span class="ident" id="4132462">offsetCodeCount</span><span class="op" id="4132477">)</span><span class="op" id="4132478">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132482">codegen</span><span class="op" id="4132489">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4132499">make</span><span class="op" id="4132503">(</span><span class="op" id="4132504">[</span><span class="op" id="4132505">]</span><span class="builtintype" id="4132506">uint8</span><span class="op" id="4132511">,</span>&nbsp;<span class="ident" id="4132513">maxLit</span><span class="op" id="4132519">+</span><span class="ident" id="4132520">offsetCodeCount</span><span class="op" id="4132535">+</span><span class="num" id="4132536">1</span><span class="op" id="4132537">)</span><span class="op" id="4132538">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132542">codegenFreq</span><span class="op" id="4132553">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4132559">make</span><span class="op" id="4132563">(</span><span class="op" id="4132564">[</span><span class="op" id="4132565">]</span><span class="builtintype" id="4132566">int32</span><span class="op" id="4132571">,</span>&nbsp;<span class="ident" id="4132573">codegenCodeCount</span><span class="op" id="4132589">)</span><span class="op" id="4132590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132594">literalEncoding</span><span class="op" id="4132609">:</span>&nbsp;<span class="ident" id="4132611">newHuffmanEncoder</span><span class="op" id="4132628">(</span><span class="ident" id="4132629">maxLit</span><span class="op" id="4132635">)</span><span class="op" id="4132636">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132640">offsetEncoding</span><span class="op" id="4132654">:</span>&nbsp;&nbsp;<span class="ident" id="4132657">newHuffmanEncoder</span><span class="op" id="4132674">(</span><span class="ident" id="4132675">offsetCodeCount</span><span class="op" id="4132690">)</span><span class="op" id="4132691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132695">codegenEncoding</span><span class="op" id="4132710">:</span>&nbsp;<span class="ident" id="4132712">newHuffmanEncoder</span><span class="op" id="4132729">(</span><span class="ident" id="4132730">codegenCodeCount</span><span class="op" id="4132746">)</span><span class="op" id="4132747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4132750">}</span><br>
<span class="lineno"></span><span class="op" id="4132752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="4132755">func</span>&nbsp;<span class="op" id="4132760">(</span><span class="ident" id="4132761">w</span>&nbsp;<span class="op" id="4132763">*</span><span class="ident" id="4132764">huffmanBitWriter</span><span class="op" id="4132780">)</span>&nbsp;<span class="ident" id="4132782">reset</span><span class="op" id="4132787">(</span><span class="ident" id="4132788">writer</span>&nbsp;<span class="ident" id="4132795">io</span><span class="op" id="4132797">.</span><span class="ident" id="4132798">Writer</span><span class="op" id="4132804">)</span>&nbsp;<span class="op" id="4132806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132809">w</span><span class="op" id="4132810">.</span><span class="ident" id="4132811">w</span>&nbsp;<span class="op" id="4132813">=</span>&nbsp;<span class="ident" id="4132815">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132823">w</span><span class="op" id="4132824">.</span><span class="ident" id="4132825">bits</span><span class="op" id="4132829">,</span>&nbsp;<span class="ident" id="4132831">w</span><span class="op" id="4132832">.</span><span class="ident" id="4132833">nbits</span><span class="op" id="4132838">,</span>&nbsp;<span class="ident" id="4132840">w</span><span class="op" id="4132841">.</span><span class="ident" id="4132842">nbytes</span><span class="op" id="4132848">,</span>&nbsp;<span class="ident" id="4132850">w</span><span class="op" id="4132851">.</span><span class="ident" id="4132852">err</span>&nbsp;<span class="op" id="4132856">=</span>&nbsp;<span class="num" id="4132858">0</span><span class="op" id="4132859">,</span>&nbsp;<span class="num" id="4132861">0</span><span class="op" id="4132862">,</span>&nbsp;<span class="num" id="4132864">0</span><span class="op" id="4132865">,</span>&nbsp;<span class="ident" id="4132867">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132872">w</span><span class="op" id="4132873">.</span><span class="ident" id="4132874">bytes</span>&nbsp;<span class="op" id="4132880">=</span>&nbsp;<span class="op" id="4132882">[</span><span class="num" id="4132883">64</span><span class="op" id="4132885">]</span><span class="builtintype" id="4132886">byte</span><span class="op" id="4132890">{</span><span class="op" id="4132891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132894">for</span>&nbsp;<span class="ident" id="4132898">i</span>&nbsp;<span class="op" id="4132900">:=</span>&nbsp;<span class="keyword" id="4132903">range</span>&nbsp;<span class="ident" id="4132909">w</span><span class="op" id="4132910">.</span><span class="ident" id="4132911">codegen</span>&nbsp;<span class="op" id="4132919">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4132923">w</span><span class="op" id="4132924">.</span><span class="ident" id="4132925">codegen</span><span class="op" id="4132932">[</span><span class="ident" id="4132933">i</span><span class="op" id="4132934">]</span>&nbsp;<span class="op" id="4132936">=</span>&nbsp;<span class="num" id="4132938">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4132941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4132944">for</span>&nbsp;<span class="ident" id="4132948">_</span><span class="op" id="4132949">,</span>&nbsp;<span class="ident" id="4132951">s</span>&nbsp;<span class="op" id="4132953">:=</span>&nbsp;<span class="keyword" id="4132956">range</span>&nbsp;<span class="op" id="4132962">[</span><span class="op" id="4132963">...</span><span class="op" id="4132966">]</span><span class="op" id="4132967">[</span><span class="op" id="4132968">]</span><span class="builtintype" id="4132969">int32</span><span class="op" id="4132974">{</span><span class="ident" id="4132975">w</span><span class="op" id="4132976">.</span><span class="ident" id="4132977">literalFreq</span><span class="op" id="4132988">,</span>&nbsp;<span class="ident" id="4132990">w</span><span class="op" id="4132991">.</span><span class="ident" id="4132992">offsetFreq</span><span class="op" id="4133002">,</span>&nbsp;<span class="ident" id="4133004">w</span><span class="op" id="4133005">.</span><span class="ident" id="4133006">codegenFreq</span><span class="op" id="4133017">}</span>&nbsp;<span class="op" id="4133019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133023">for</span>&nbsp;<span class="ident" id="4133027">i</span>&nbsp;<span class="op" id="4133029">:=</span>&nbsp;<span class="keyword" id="4133032">range</span>&nbsp;<span class="ident" id="4133038">s</span>&nbsp;<span class="op" id="4133040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133045">s</span><span class="op" id="4133046">[</span><span class="ident" id="4133047">i</span><span class="op" id="4133048">]</span>&nbsp;<span class="op" id="4133050">=</span>&nbsp;<span class="num" id="4133052">0</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133062">for</span>&nbsp;<span class="ident" id="4133066">_</span><span class="op" id="4133067">,</span>&nbsp;<span class="ident" id="4133069">enc</span>&nbsp;<span class="op" id="4133073">:=</span>&nbsp;<span class="keyword" id="4133076">range</span>&nbsp;<span class="op" id="4133082">[</span><span class="op" id="4133083">...</span><span class="op" id="4133086">]</span><span class="op" id="4133087">*</span><span class="ident" id="4133088">huffmanEncoder</span><span class="op" id="4133102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133106">w</span><span class="op" id="4133107">.</span><span class="ident" id="4133108">literalEncoding</span><span class="op" id="4133123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133127">w</span><span class="op" id="4133128">.</span><span class="ident" id="4133129">offsetEncoding</span><span class="op" id="4133143">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133147">w</span><span class="op" id="4133148">.</span><span class="ident" id="4133149">codegenEncoding</span><span class="op" id="4133164">}</span>&nbsp;<span class="op" id="4133166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133170">for</span>&nbsp;<span class="ident" id="4133174">i</span>&nbsp;<span class="op" id="4133176">:=</span>&nbsp;<span class="keyword" id="4133179">range</span>&nbsp;<span class="ident" id="4133185">enc</span><span class="op" id="4133188">.</span><span class="ident" id="4133189">code</span>&nbsp;<span class="op" id="4133194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133199">enc</span><span class="op" id="4133202">.</span><span class="ident" id="4133203">code</span><span class="op" id="4133207">[</span><span class="ident" id="4133208">i</span><span class="op" id="4133209">]</span>&nbsp;<span class="op" id="4133211">=</span>&nbsp;<span class="num" id="4133213">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133221">for</span>&nbsp;<span class="ident" id="4133225">i</span>&nbsp;<span class="op" id="4133227">:=</span>&nbsp;<span class="keyword" id="4133230">range</span>&nbsp;<span class="ident" id="4133236">enc</span><span class="op" id="4133239">.</span><span class="ident" id="4133240">codeBits</span>&nbsp;<span class="op" id="4133249">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133254">enc</span><span class="op" id="4133257">.</span><span class="ident" id="4133258">codeBits</span><span class="op" id="4133266">[</span><span class="ident" id="4133267">i</span><span class="op" id="4133268">]</span>&nbsp;<span class="op" id="4133270">=</span>&nbsp;<span class="num" id="4133272">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133279">}</span><br>
<span class="lineno"></span><span class="op" id="4133281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="4133284">func</span>&nbsp;<span class="op" id="4133289">(</span><span class="ident" id="4133290">w</span>&nbsp;<span class="op" id="4133292">*</span><span class="ident" id="4133293">huffmanBitWriter</span><span class="op" id="4133309">)</span>&nbsp;<span class="ident" id="4133311">flushBits</span><span class="op" id="4133320">(</span><span class="op" id="4133321">)</span>&nbsp;<span class="op" id="4133323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133326">if</span>&nbsp;<span class="ident" id="4133329">w</span><span class="op" id="4133330">.</span><span class="ident" id="4133331">err</span>&nbsp;<span class="op" id="4133335">!=</span>&nbsp;<span class="ident" id="4133338">nil</span>&nbsp;<span class="op" id="4133342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133346">w</span><span class="op" id="4133347">.</span><span class="ident" id="4133348">nbits</span>&nbsp;<span class="op" id="4133354">=</span>&nbsp;<span class="num" id="4133356">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133360">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133368">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133371">bits</span>&nbsp;<span class="op" id="4133376">:=</span>&nbsp;<span class="ident" id="4133379">w</span><span class="op" id="4133380">.</span><span class="ident" id="4133381">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133387">w</span><span class="op" id="4133388">.</span><span class="ident" id="4133389">bits</span>&nbsp;<span class="op" id="4133394">&gt;&gt;=</span>&nbsp;<span class="num" id="4133398">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133402">w</span><span class="op" id="4133403">.</span><span class="ident" id="4133404">nbits</span>&nbsp;<span class="op" id="4133410">-=</span>&nbsp;<span class="num" id="4133413">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133417">n</span>&nbsp;<span class="op" id="4133419">:=</span>&nbsp;<span class="ident" id="4133422">w</span><span class="op" id="4133423">.</span><span class="ident" id="4133424">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133432">w</span><span class="op" id="4133433">.</span><span class="ident" id="4133434">bytes</span><span class="op" id="4133439">[</span><span class="ident" id="4133440">n</span><span class="op" id="4133441">]</span>&nbsp;<span class="op" id="4133443">=</span>&nbsp;<span class="builtintype" id="4133445">byte</span><span class="op" id="4133449">(</span><span class="ident" id="4133450">bits</span><span class="op" id="4133454">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133457">w</span><span class="op" id="4133458">.</span><span class="ident" id="4133459">bytes</span><span class="op" id="4133464">[</span><span class="ident" id="4133465">n</span><span class="op" id="4133466">+</span><span class="num" id="4133467">1</span><span class="op" id="4133468">]</span>&nbsp;<span class="op" id="4133470">=</span>&nbsp;<span class="builtintype" id="4133472">byte</span><span class="op" id="4133476">(</span><span class="ident" id="4133477">bits</span>&nbsp;<span class="op" id="4133482">&gt;&gt;</span>&nbsp;<span class="num" id="4133485">8</span><span class="op" id="4133486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133489">if</span>&nbsp;<span class="ident" id="4133492">n</span>&nbsp;<span class="op" id="4133494">+=</span>&nbsp;<span class="num" id="4133497">2</span><span class="op" id="4133498">;</span>&nbsp;<span class="ident" id="4133500">n</span>&nbsp;<span class="op" id="4133502">&gt;=</span>&nbsp;<span class="builtinfunc" id="4133505">len</span><span class="op" id="4133508">(</span><span class="ident" id="4133509">w</span><span class="op" id="4133510">.</span><span class="ident" id="4133511">bytes</span><span class="op" id="4133516">)</span>&nbsp;<span class="op" id="4133518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133522">_</span><span class="op" id="4133523">,</span>&nbsp;<span class="ident" id="4133525">w</span><span class="op" id="4133526">.</span><span class="ident" id="4133527">err</span>&nbsp;<span class="op" id="4133531">=</span>&nbsp;<span class="ident" id="4133533">w</span><span class="op" id="4133534">.</span><span class="ident" id="4133535">w</span><span class="op" id="4133536">.</span><span class="ident" id="4133537">Write</span><span class="op" id="4133542">(</span><span class="ident" id="4133543">w</span><span class="op" id="4133544">.</span><span class="ident" id="4133545">bytes</span><span class="op" id="4133550">[</span><span class="num" id="4133551">0</span><span class="op" id="4133552">:</span><span class="op" id="4133553">]</span><span class="op" id="4133554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133558">n</span>&nbsp;<span class="op" id="4133560">=</span>&nbsp;<span class="num" id="4133562">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133565">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133568">w</span><span class="op" id="4133569">.</span><span class="ident" id="4133570">nbytes</span>&nbsp;<span class="op" id="4133577">=</span>&nbsp;<span class="ident" id="4133579">n</span><br>
<span class="lineno"></span><span class="op" id="4133581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4133584">func</span>&nbsp;<span class="op" id="4133589">(</span><span class="ident" id="4133590">w</span>&nbsp;<span class="op" id="4133592">*</span><span class="ident" id="4133593">huffmanBitWriter</span><span class="op" id="4133609">)</span>&nbsp;<span class="ident" id="4133611">flush</span><span class="op" id="4133616">(</span><span class="op" id="4133617">)</span>&nbsp;<span class="op" id="4133619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133622">if</span>&nbsp;<span class="ident" id="4133625">w</span><span class="op" id="4133626">.</span><span class="ident" id="4133627">err</span>&nbsp;<span class="op" id="4133631">!=</span>&nbsp;<span class="ident" id="4133634">nil</span>&nbsp;<span class="op" id="4133638">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133642">w</span><span class="op" id="4133643">.</span><span class="ident" id="4133644">nbits</span>&nbsp;<span class="op" id="4133650">=</span>&nbsp;<span class="num" id="4133652">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133656">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133667">n</span>&nbsp;<span class="op" id="4133669">:=</span>&nbsp;<span class="ident" id="4133672">w</span><span class="op" id="4133673">.</span><span class="ident" id="4133674">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133682">if</span>&nbsp;<span class="ident" id="4133685">w</span><span class="op" id="4133686">.</span><span class="ident" id="4133687">nbits</span>&nbsp;<span class="op" id="4133693">&gt;</span>&nbsp;<span class="num" id="4133695">8</span>&nbsp;<span class="op" id="4133697">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133701">w</span><span class="op" id="4133702">.</span><span class="ident" id="4133703">bytes</span><span class="op" id="4133708">[</span><span class="ident" id="4133709">n</span><span class="op" id="4133710">]</span>&nbsp;<span class="op" id="4133712">=</span>&nbsp;<span class="builtintype" id="4133714">byte</span><span class="op" id="4133718">(</span><span class="ident" id="4133719">w</span><span class="op" id="4133720">.</span><span class="ident" id="4133721">bits</span><span class="op" id="4133725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133729">w</span><span class="op" id="4133730">.</span><span class="ident" id="4133731">bits</span>&nbsp;<span class="op" id="4133736">&gt;&gt;=</span>&nbsp;<span class="num" id="4133740">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133744">w</span><span class="op" id="4133745">.</span><span class="ident" id="4133746">nbits</span>&nbsp;<span class="op" id="4133752">-=</span>&nbsp;<span class="num" id="4133755">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133759">n</span><span class="op" id="4133760">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133764">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133767">if</span>&nbsp;<span class="ident" id="4133770">w</span><span class="op" id="4133771">.</span><span class="ident" id="4133772">nbits</span>&nbsp;<span class="op" id="4133778">&gt;</span>&nbsp;<span class="num" id="4133780">0</span>&nbsp;<span class="op" id="4133782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133786">w</span><span class="op" id="4133787">.</span><span class="ident" id="4133788">bytes</span><span class="op" id="4133793">[</span><span class="ident" id="4133794">n</span><span class="op" id="4133795">]</span>&nbsp;<span class="op" id="4133797">=</span>&nbsp;<span class="builtintype" id="4133799">byte</span><span class="op" id="4133803">(</span><span class="ident" id="4133804">w</span><span class="op" id="4133805">.</span><span class="ident" id="4133806">bits</span><span class="op" id="4133810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133814">w</span><span class="op" id="4133815">.</span><span class="ident" id="4133816">nbits</span>&nbsp;<span class="op" id="4133822">=</span>&nbsp;<span class="num" id="4133824">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133828">n</span><span class="op" id="4133829">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4133833">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133836">w</span><span class="op" id="4133837">.</span><span class="ident" id="4133838">bits</span>&nbsp;<span class="op" id="4133843">=</span>&nbsp;<span class="num" id="4133845">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133848">_</span><span class="op" id="4133849">,</span>&nbsp;<span class="ident" id="4133851">w</span><span class="op" id="4133852">.</span><span class="ident" id="4133853">err</span>&nbsp;<span class="op" id="4133857">=</span>&nbsp;<span class="ident" id="4133859">w</span><span class="op" id="4133860">.</span><span class="ident" id="4133861">w</span><span class="op" id="4133862">.</span><span class="ident" id="4133863">Write</span><span class="op" id="4133868">(</span><span class="ident" id="4133869">w</span><span class="op" id="4133870">.</span><span class="ident" id="4133871">bytes</span><span class="op" id="4133876">[</span><span class="num" id="4133877">0</span><span class="op" id="4133878">:</span><span class="ident" id="4133879">n</span><span class="op" id="4133880">]</span><span class="op" id="4133881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133884">w</span><span class="op" id="4133885">.</span><span class="ident" id="4133886">nbytes</span>&nbsp;<span class="op" id="4133893">=</span>&nbsp;<span class="num" id="4133895">0</span><br>
<span class="lineno"></span><span class="op" id="4133897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="4133900">func</span>&nbsp;<span class="op" id="4133905">(</span><span class="ident" id="4133906">w</span>&nbsp;<span class="op" id="4133908">*</span><span class="ident" id="4133909">huffmanBitWriter</span><span class="op" id="4133925">)</span>&nbsp;<span class="ident" id="4133927">writeBits</span><span class="op" id="4133936">(</span><span class="ident" id="4133937">b</span><span class="op" id="4133938">,</span>&nbsp;<span class="ident" id="4133940">nb</span>&nbsp;<span class="builtintype" id="4133943">int32</span><span class="op" id="4133948">)</span>&nbsp;<span class="op" id="4133950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4133953">w</span><span class="op" id="4133954">.</span><span class="ident" id="4133955">bits</span>&nbsp;<span class="op" id="4133960">|=</span>&nbsp;<span class="builtintype" id="4133963">uint32</span><span class="op" id="4133969">(</span><span class="ident" id="4133970">b</span><span class="op" id="4133971">)</span>&nbsp;<span class="op" id="4133973">&lt;&lt;</span>&nbsp;<span class="ident" id="4133976">w</span><span class="op" id="4133977">.</span><span class="ident" id="4133978">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4133985">if</span>&nbsp;<span class="ident" id="4133988">w</span><span class="op" id="4133989">.</span><span class="ident" id="4133990">nbits</span>&nbsp;<span class="op" id="4133996">+=</span>&nbsp;<span class="builtintype" id="4133999">uint32</span><span class="op" id="4134005">(</span><span class="ident" id="4134006">nb</span><span class="op" id="4134008">)</span><span class="op" id="4134009">;</span>&nbsp;<span class="ident" id="4134011">w</span><span class="op" id="4134012">.</span><span class="ident" id="4134013">nbits</span>&nbsp;<span class="op" id="4134019">&gt;=</span>&nbsp;<span class="num" id="4134022">16</span>&nbsp;<span class="op" id="4134025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134029">w</span><span class="op" id="4134030">.</span><span class="ident" id="4134031">flushBits</span><span class="op" id="4134040">(</span><span class="op" id="4134041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134044">}</span><br>
<span class="lineno">170</span><span class="op" id="4134046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4134049">func</span>&nbsp;<span class="op" id="4134054">(</span><span class="ident" id="4134055">w</span>&nbsp;<span class="op" id="4134057">*</span><span class="ident" id="4134058">huffmanBitWriter</span><span class="op" id="4134074">)</span>&nbsp;<span class="ident" id="4134076">writeBytes</span><span class="op" id="4134086">(</span><span class="ident" id="4134087">bytes</span>&nbsp;<span class="op" id="4134093">[</span><span class="op" id="4134094">]</span><span class="builtintype" id="4134095">byte</span><span class="op" id="4134099">)</span>&nbsp;<span class="op" id="4134101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134104">if</span>&nbsp;<span class="ident" id="4134107">w</span><span class="op" id="4134108">.</span><span class="ident" id="4134109">err</span>&nbsp;<span class="op" id="4134113">!=</span>&nbsp;<span class="ident" id="4134116">nil</span>&nbsp;<span class="op" id="4134120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134124">return</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134135">n</span>&nbsp;<span class="op" id="4134137">:=</span>&nbsp;<span class="ident" id="4134140">w</span><span class="op" id="4134141">.</span><span class="ident" id="4134142">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134150">if</span>&nbsp;<span class="ident" id="4134153">w</span><span class="op" id="4134154">.</span><span class="ident" id="4134155">nbits</span>&nbsp;<span class="op" id="4134161">==</span>&nbsp;<span class="num" id="4134164">8</span>&nbsp;<span class="op" id="4134166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134170">w</span><span class="op" id="4134171">.</span><span class="ident" id="4134172">bytes</span><span class="op" id="4134177">[</span><span class="ident" id="4134178">n</span><span class="op" id="4134179">]</span>&nbsp;<span class="op" id="4134181">=</span>&nbsp;<span class="builtintype" id="4134183">byte</span><span class="op" id="4134187">(</span><span class="ident" id="4134188">w</span><span class="op" id="4134189">.</span><span class="ident" id="4134190">bits</span><span class="op" id="4134194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134198">w</span><span class="op" id="4134199">.</span><span class="ident" id="4134200">nbits</span>&nbsp;<span class="op" id="4134206">=</span>&nbsp;<span class="num" id="4134208">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134212">n</span><span class="op" id="4134213">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134220">if</span>&nbsp;<span class="ident" id="4134223">w</span><span class="op" id="4134224">.</span><span class="ident" id="4134225">nbits</span>&nbsp;<span class="op" id="4134231">!=</span>&nbsp;<span class="num" id="4134234">0</span>&nbsp;<span class="op" id="4134236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134240">w</span><span class="op" id="4134241">.</span><span class="ident" id="4134242">err</span>&nbsp;<span class="op" id="4134246">=</span>&nbsp;<span class="ident" id="4134248">InternalError</span><span class="op" id="4134261">(</span><span class="string" id="4134262">&#34;writeBytes&nbsp;with&nbsp;unfinished&nbsp;bits&#34;</span><span class="op" id="4134295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134299">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134310">if</span>&nbsp;<span class="ident" id="4134313">n</span>&nbsp;<span class="op" id="4134315">!=</span>&nbsp;<span class="num" id="4134318">0</span>&nbsp;<span class="op" id="4134320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134324">_</span><span class="op" id="4134325">,</span>&nbsp;<span class="ident" id="4134327">w</span><span class="op" id="4134328">.</span><span class="ident" id="4134329">err</span>&nbsp;<span class="op" id="4134333">=</span>&nbsp;<span class="ident" id="4134335">w</span><span class="op" id="4134336">.</span><span class="ident" id="4134337">w</span><span class="op" id="4134338">.</span><span class="ident" id="4134339">Write</span><span class="op" id="4134344">(</span><span class="ident" id="4134345">w</span><span class="op" id="4134346">.</span><span class="ident" id="4134347">bytes</span><span class="op" id="4134352">[</span><span class="num" id="4134353">0</span><span class="op" id="4134354">:</span><span class="ident" id="4134355">n</span><span class="op" id="4134356">]</span><span class="op" id="4134357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134361">if</span>&nbsp;<span class="ident" id="4134364">w</span><span class="op" id="4134365">.</span><span class="ident" id="4134366">err</span>&nbsp;<span class="op" id="4134370">!=</span>&nbsp;<span class="ident" id="4134373">nil</span>&nbsp;<span class="op" id="4134377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4134382">return</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4134394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134397">w</span><span class="op" id="4134398">.</span><span class="ident" id="4134399">nbytes</span>&nbsp;<span class="op" id="4134406">=</span>&nbsp;<span class="num" id="4134408">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4134411">_</span><span class="op" id="4134412">,</span>&nbsp;<span class="ident" id="4134414">w</span><span class="op" id="4134415">.</span><span class="ident" id="4134416">err</span>&nbsp;<span class="op" id="4134420">=</span>&nbsp;<span class="ident" id="4134422">w</span><span class="op" id="4134423">.</span><span class="ident" id="4134424">w</span><span class="op" id="4134425">.</span><span class="ident" id="4134426">Write</span><span class="op" id="4134431">(</span><span class="ident" id="4134432">bytes</span><span class="op" id="4134437">)</span><br>
<span class="lineno"></span><span class="op" id="4134439">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="4134442">//&nbsp;RFC&nbsp;1951&nbsp;3.2.7&nbsp;specifies&nbsp;a&nbsp;special&nbsp;run-length&nbsp;encoding&nbsp;for&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="4134515">//&nbsp;the&nbsp;literal&nbsp;and&nbsp;offset&nbsp;lengths&nbsp;arrays&nbsp;(which&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="4134594">//&nbsp;array).&nbsp;&nbsp;This&nbsp;method&nbsp;generates&nbsp;that&nbsp;run-length&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="4134654">//</span><br>
<span class="lineno">200</span><span class="comment" id="4134657">//&nbsp;The&nbsp;result&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegen&nbsp;array,&nbsp;and&nbsp;the&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4134726">//&nbsp;of&nbsp;each&nbsp;code&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegenFreq&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="4134781">//&nbsp;Codes&nbsp;0-15&nbsp;are&nbsp;single&nbsp;byte&nbsp;codes.&nbsp;Codes&nbsp;16-18&nbsp;are&nbsp;followed&nbsp;by&nbsp;additional</span><br>
<span class="lineno"></span><span class="comment" id="4134857">//&nbsp;information.&nbsp;&nbsp;Code&nbsp;badCode&nbsp;is&nbsp;an&nbsp;end&nbsp;marker</span><br>
<span class="lineno"></span><span class="comment" id="4134904">//</span><br>
<span class="lineno">205</span><span class="comment" id="4134907">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;in&nbsp;literalEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4134970">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;in&nbsp;offsetEncoding</span><br>
<span class="lineno"></span><span class="keyword" id="4135031">func</span>&nbsp;<span class="op" id="4135036">(</span><span class="ident" id="4135037">w</span>&nbsp;<span class="op" id="4135039">*</span><span class="ident" id="4135040">huffmanBitWriter</span><span class="op" id="4135056">)</span>&nbsp;<span class="ident" id="4135058">generateCodegen</span><span class="op" id="4135073">(</span><span class="ident" id="4135074">numLiterals</span>&nbsp;<span class="builtintype" id="4135086">int</span><span class="op" id="4135089">,</span>&nbsp;<span class="ident" id="4135091">numOffsets</span>&nbsp;<span class="builtintype" id="4135102">int</span><span class="op" id="4135105">)</span>&nbsp;<span class="op" id="4135107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135110">for</span>&nbsp;<span class="ident" id="4135114">i</span>&nbsp;<span class="op" id="4135116">:=</span>&nbsp;<span class="keyword" id="4135119">range</span>&nbsp;<span class="ident" id="4135125">w</span><span class="op" id="4135126">.</span><span class="ident" id="4135127">codegenFreq</span>&nbsp;<span class="op" id="4135139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135143">w</span><span class="op" id="4135144">.</span><span class="ident" id="4135145">codegenFreq</span><span class="op" id="4135156">[</span><span class="ident" id="4135157">i</span><span class="op" id="4135158">]</span>&nbsp;<span class="op" id="4135160">=</span>&nbsp;<span class="num" id="4135162">0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4135165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135168">//&nbsp;Note&nbsp;that&nbsp;we&nbsp;are&nbsp;using&nbsp;codegen&nbsp;both&nbsp;as&nbsp;a&nbsp;temporary&nbsp;variable&nbsp;for&nbsp;holding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135244">//&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;frequencies,&nbsp;and&nbsp;as&nbsp;the&nbsp;place&nbsp;where&nbsp;we&nbsp;put&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135317">//&nbsp;This&nbsp;is&nbsp;fine&nbsp;because&nbsp;the&nbsp;output&nbsp;is&nbsp;always&nbsp;shorter&nbsp;than&nbsp;the&nbsp;input&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135391">//&nbsp;so&nbsp;far.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135403">codegen</span>&nbsp;<span class="op" id="4135411">:=</span>&nbsp;<span class="ident" id="4135414">w</span><span class="op" id="4135415">.</span><span class="ident" id="4135416">codegen</span>&nbsp;<span class="comment" id="4135424">//&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135434">//&nbsp;Copy&nbsp;the&nbsp;concatenated&nbsp;code&nbsp;sizes&nbsp;to&nbsp;codegen.&nbsp;&nbsp;Put&nbsp;a&nbsp;marker&nbsp;at&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4135509">copy</span><span class="op" id="4135513">(</span><span class="ident" id="4135514">codegen</span><span class="op" id="4135521">[</span><span class="num" id="4135522">0</span><span class="op" id="4135523">:</span><span class="ident" id="4135524">numLiterals</span><span class="op" id="4135535">]</span><span class="op" id="4135536">,</span>&nbsp;<span class="ident" id="4135538">w</span><span class="op" id="4135539">.</span><span class="ident" id="4135540">literalEncoding</span><span class="op" id="4135555">.</span><span class="ident" id="4135556">codeBits</span><span class="op" id="4135564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4135567">copy</span><span class="op" id="4135571">(</span><span class="ident" id="4135572">codegen</span><span class="op" id="4135579">[</span><span class="ident" id="4135580">numLiterals</span><span class="op" id="4135591">:</span><span class="ident" id="4135592">numLiterals</span><span class="op" id="4135603">+</span><span class="ident" id="4135604">numOffsets</span><span class="op" id="4135614">]</span><span class="op" id="4135615">,</span>&nbsp;<span class="ident" id="4135617">w</span><span class="op" id="4135618">.</span><span class="ident" id="4135619">offsetEncoding</span><span class="op" id="4135633">.</span><span class="ident" id="4135634">codeBits</span><span class="op" id="4135642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135645">codegen</span><span class="op" id="4135652">[</span><span class="ident" id="4135653">numLiterals</span><span class="op" id="4135664">+</span><span class="ident" id="4135665">numOffsets</span><span class="op" id="4135675">]</span>&nbsp;<span class="op" id="4135677">=</span>&nbsp;<span class="ident" id="4135679">badCode</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135689">size</span>&nbsp;<span class="op" id="4135694">:=</span>&nbsp;<span class="ident" id="4135697">codegen</span><span class="op" id="4135704">[</span><span class="num" id="4135705">0</span><span class="op" id="4135706">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135709">count</span>&nbsp;<span class="op" id="4135715">:=</span>&nbsp;<span class="num" id="4135718">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135721">outIndex</span>&nbsp;<span class="op" id="4135730">:=</span>&nbsp;<span class="num" id="4135733">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135736">for</span>&nbsp;<span class="ident" id="4135740">inIndex</span>&nbsp;<span class="op" id="4135748">:=</span>&nbsp;<span class="num" id="4135751">1</span><span class="op" id="4135752">;</span>&nbsp;<span class="ident" id="4135754">size</span>&nbsp;<span class="op" id="4135759">!=</span>&nbsp;<span class="ident" id="4135762">badCode</span><span class="op" id="4135769">;</span>&nbsp;<span class="ident" id="4135771">inIndex</span><span class="op" id="4135778">++</span>&nbsp;<span class="op" id="4135781">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135785">//&nbsp;INVARIANT:&nbsp;We&nbsp;have&nbsp;seen&nbsp;&#34;count&#34;&nbsp;copies&nbsp;of&nbsp;size&nbsp;that&nbsp;have&nbsp;not&nbsp;yet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135855">//&nbsp;had&nbsp;output&nbsp;generated&nbsp;for&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135891">nextSize</span>&nbsp;<span class="op" id="4135900">:=</span>&nbsp;<span class="ident" id="4135903">codegen</span><span class="op" id="4135910">[</span><span class="ident" id="4135911">inIndex</span><span class="op" id="4135918">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135922">if</span>&nbsp;<span class="ident" id="4135925">nextSize</span>&nbsp;<span class="op" id="4135934">==</span>&nbsp;<span class="ident" id="4135937">size</span>&nbsp;<span class="op" id="4135942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4135947">count</span><span class="op" id="4135952">++</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4135958">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4135969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4135973">//&nbsp;We&nbsp;need&nbsp;to&nbsp;generate&nbsp;codegen&nbsp;indicating&nbsp;&#34;count&#34;&nbsp;of&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136034">if</span>&nbsp;<span class="ident" id="4136037">size</span>&nbsp;<span class="op" id="4136042">!=</span>&nbsp;<span class="num" id="4136045">0</span>&nbsp;<span class="op" id="4136047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136052">codegen</span><span class="op" id="4136059">[</span><span class="ident" id="4136060">outIndex</span><span class="op" id="4136068">]</span>&nbsp;<span class="op" id="4136070">=</span>&nbsp;<span class="ident" id="4136072">size</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136080">outIndex</span><span class="op" id="4136088">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136094">w</span><span class="op" id="4136095">.</span><span class="ident" id="4136096">codegenFreq</span><span class="op" id="4136107">[</span><span class="ident" id="4136108">size</span><span class="op" id="4136112">]</span><span class="op" id="4136113">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136119">count</span><span class="op" id="4136124">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136130">for</span>&nbsp;<span class="ident" id="4136134">count</span>&nbsp;<span class="op" id="4136140">&gt;=</span>&nbsp;<span class="num" id="4136143">3</span>&nbsp;<span class="op" id="4136145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136151">n</span>&nbsp;<span class="op" id="4136153">:=</span>&nbsp;<span class="num" id="4136156">6</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136162">if</span>&nbsp;<span class="ident" id="4136165">n</span>&nbsp;<span class="op" id="4136167">&gt;</span>&nbsp;<span class="ident" id="4136169">count</span>&nbsp;<span class="op" id="4136175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136182">n</span>&nbsp;<span class="op" id="4136184">=</span>&nbsp;<span class="ident" id="4136186">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136202">codegen</span><span class="op" id="4136209">[</span><span class="ident" id="4136210">outIndex</span><span class="op" id="4136218">]</span>&nbsp;<span class="op" id="4136220">=</span>&nbsp;<span class="num" id="4136222">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136229">outIndex</span><span class="op" id="4136237">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136244">codegen</span><span class="op" id="4136251">[</span><span class="ident" id="4136252">outIndex</span><span class="op" id="4136260">]</span>&nbsp;<span class="op" id="4136262">=</span>&nbsp;<span class="builtintype" id="4136264">uint8</span><span class="op" id="4136269">(</span><span class="ident" id="4136270">n</span>&nbsp;<span class="op" id="4136272">-</span>&nbsp;<span class="num" id="4136274">3</span><span class="op" id="4136275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136281">outIndex</span><span class="op" id="4136289">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136296">w</span><span class="op" id="4136297">.</span><span class="ident" id="4136298">codegenFreq</span><span class="op" id="4136309">[</span><span class="num" id="4136310">16</span><span class="op" id="4136312">]</span><span class="op" id="4136313">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136320">count</span>&nbsp;<span class="op" id="4136326">-=</span>&nbsp;<span class="ident" id="4136329">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136334">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136338">}</span>&nbsp;<span class="keyword" id="4136340">else</span>&nbsp;<span class="op" id="4136345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136350">for</span>&nbsp;<span class="ident" id="4136354">count</span>&nbsp;<span class="op" id="4136360">&gt;=</span>&nbsp;<span class="num" id="4136363">11</span>&nbsp;<span class="op" id="4136366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136372">n</span>&nbsp;<span class="op" id="4136374">:=</span>&nbsp;<span class="num" id="4136377">138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136385">if</span>&nbsp;<span class="ident" id="4136388">n</span>&nbsp;<span class="op" id="4136390">&gt;</span>&nbsp;<span class="ident" id="4136392">count</span>&nbsp;<span class="op" id="4136398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136405">n</span>&nbsp;<span class="op" id="4136407">=</span>&nbsp;<span class="ident" id="4136409">count</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136425">codegen</span><span class="op" id="4136432">[</span><span class="ident" id="4136433">outIndex</span><span class="op" id="4136441">]</span>&nbsp;<span class="op" id="4136443">=</span>&nbsp;<span class="num" id="4136445">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136452">outIndex</span><span class="op" id="4136460">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136467">codegen</span><span class="op" id="4136474">[</span><span class="ident" id="4136475">outIndex</span><span class="op" id="4136483">]</span>&nbsp;<span class="op" id="4136485">=</span>&nbsp;<span class="builtintype" id="4136487">uint8</span><span class="op" id="4136492">(</span><span class="ident" id="4136493">n</span>&nbsp;<span class="op" id="4136495">-</span>&nbsp;<span class="num" id="4136497">11</span><span class="op" id="4136499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136505">outIndex</span><span class="op" id="4136513">++</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136520">w</span><span class="op" id="4136521">.</span><span class="ident" id="4136522">codegenFreq</span><span class="op" id="4136533">[</span><span class="num" id="4136534">18</span><span class="op" id="4136536">]</span><span class="op" id="4136537">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136544">count</span>&nbsp;<span class="op" id="4136550">-=</span>&nbsp;<span class="ident" id="4136553">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136563">if</span>&nbsp;<span class="ident" id="4136566">count</span>&nbsp;<span class="op" id="4136572">&gt;=</span>&nbsp;<span class="num" id="4136575">3</span>&nbsp;<span class="op" id="4136577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4136583">//&nbsp;count&nbsp;&gt;=&nbsp;3&nbsp;&amp;&amp;&nbsp;count&nbsp;&lt;=&nbsp;10</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136616">codegen</span><span class="op" id="4136623">[</span><span class="ident" id="4136624">outIndex</span><span class="op" id="4136632">]</span>&nbsp;<span class="op" id="4136634">=</span>&nbsp;<span class="num" id="4136636">17</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136643">outIndex</span><span class="op" id="4136651">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136658">codegen</span><span class="op" id="4136665">[</span><span class="ident" id="4136666">outIndex</span><span class="op" id="4136674">]</span>&nbsp;<span class="op" id="4136676">=</span>&nbsp;<span class="builtintype" id="4136678">uint8</span><span class="op" id="4136683">(</span><span class="ident" id="4136684">count</span>&nbsp;<span class="op" id="4136690">-</span>&nbsp;<span class="num" id="4136692">3</span><span class="op" id="4136693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136699">outIndex</span><span class="op" id="4136707">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136714">w</span><span class="op" id="4136715">.</span><span class="ident" id="4136716">codegenFreq</span><span class="op" id="4136727">[</span><span class="num" id="4136728">17</span><span class="op" id="4136730">]</span><span class="op" id="4136731">++</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136738">count</span>&nbsp;<span class="op" id="4136744">=</span>&nbsp;<span class="num" id="4136746">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136759">count</span><span class="op" id="4136764">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4136769">for</span>&nbsp;<span class="op" id="4136773">;</span>&nbsp;<span class="ident" id="4136775">count</span>&nbsp;<span class="op" id="4136781">&gt;=</span>&nbsp;<span class="num" id="4136784">0</span><span class="op" id="4136785">;</span>&nbsp;<span class="ident" id="4136787">count</span><span class="op" id="4136792">--</span>&nbsp;<span class="op" id="4136795">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136800">codegen</span><span class="op" id="4136807">[</span><span class="ident" id="4136808">outIndex</span><span class="op" id="4136816">]</span>&nbsp;<span class="op" id="4136818">=</span>&nbsp;<span class="ident" id="4136820">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136828">outIndex</span><span class="op" id="4136836">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136842">w</span><span class="op" id="4136843">.</span><span class="ident" id="4136844">codegenFreq</span><span class="op" id="4136855">[</span><span class="ident" id="4136856">size</span><span class="op" id="4136860">]</span><span class="op" id="4136861">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4136870">//&nbsp;Set&nbsp;up&nbsp;invariant&nbsp;for&nbsp;next&nbsp;time&nbsp;through&nbsp;the&nbsp;loop.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136924">size</span>&nbsp;<span class="op" id="4136929">=</span>&nbsp;<span class="ident" id="4136931">nextSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4136942">count</span>&nbsp;<span class="op" id="4136948">=</span>&nbsp;<span class="num" id="4136950">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4136953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4136956">//&nbsp;Marker&nbsp;indicating&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;codegen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137002">codegen</span><span class="op" id="4137009">[</span><span class="ident" id="4137010">outIndex</span><span class="op" id="4137018">]</span>&nbsp;<span class="op" id="4137020">=</span>&nbsp;<span class="ident" id="4137022">badCode</span><br>
<span class="lineno">285</span><span class="op" id="4137030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4137033">func</span>&nbsp;<span class="op" id="4137038">(</span><span class="ident" id="4137039">w</span>&nbsp;<span class="op" id="4137041">*</span><span class="ident" id="4137042">huffmanBitWriter</span><span class="op" id="4137058">)</span>&nbsp;<span class="ident" id="4137060">writeCode</span><span class="op" id="4137069">(</span><span class="ident" id="4137070">code</span>&nbsp;<span class="op" id="4137075">*</span><span class="ident" id="4137076">huffmanEncoder</span><span class="op" id="4137090">,</span>&nbsp;<span class="ident" id="4137092">literal</span>&nbsp;<span class="builtintype" id="4137100">uint32</span><span class="op" id="4137106">)</span>&nbsp;<span class="op" id="4137108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137111">if</span>&nbsp;<span class="ident" id="4137114">w</span><span class="op" id="4137115">.</span><span class="ident" id="4137116">err</span>&nbsp;<span class="op" id="4137120">!=</span>&nbsp;<span class="ident" id="4137123">nil</span>&nbsp;<span class="op" id="4137127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137131">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4137139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137142">w</span><span class="op" id="4137143">.</span><span class="ident" id="4137144">writeBits</span><span class="op" id="4137153">(</span><span class="builtintype" id="4137154">int32</span><span class="op" id="4137159">(</span><span class="ident" id="4137160">code</span><span class="op" id="4137164">.</span><span class="ident" id="4137165">code</span><span class="op" id="4137169">[</span><span class="ident" id="4137170">literal</span><span class="op" id="4137177">]</span><span class="op" id="4137178">)</span><span class="op" id="4137179">,</span>&nbsp;<span class="builtintype" id="4137181">int32</span><span class="op" id="4137186">(</span><span class="ident" id="4137187">code</span><span class="op" id="4137191">.</span><span class="ident" id="4137192">codeBits</span><span class="op" id="4137200">[</span><span class="ident" id="4137201">literal</span><span class="op" id="4137208">]</span><span class="op" id="4137209">)</span><span class="op" id="4137210">)</span><br>
<span class="lineno"></span><span class="op" id="4137212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4137215">//&nbsp;Write&nbsp;the&nbsp;header&nbsp;of&nbsp;a&nbsp;dynamic&nbsp;Huffman&nbsp;block&nbsp;to&nbsp;the&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">295</span><span class="comment" id="4137284">//</span><br>
<span class="lineno"></span><span class="comment" id="4137287">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4137348">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4137408">//&nbsp;&nbsp;numCodegens&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;codegens&nbsp;used&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="keyword" id="4137464">func</span>&nbsp;<span class="op" id="4137469">(</span><span class="ident" id="4137470">w</span>&nbsp;<span class="op" id="4137472">*</span><span class="ident" id="4137473">huffmanBitWriter</span><span class="op" id="4137489">)</span>&nbsp;<span class="ident" id="4137491">writeDynamicHeader</span><span class="op" id="4137509">(</span><span class="ident" id="4137510">numLiterals</span>&nbsp;<span class="builtintype" id="4137522">int</span><span class="op" id="4137525">,</span>&nbsp;<span class="ident" id="4137527">numOffsets</span>&nbsp;<span class="builtintype" id="4137538">int</span><span class="op" id="4137541">,</span>&nbsp;<span class="ident" id="4137543">numCodegens</span>&nbsp;<span class="builtintype" id="4137555">int</span><span class="op" id="4137558">,</span>&nbsp;<span class="ident" id="4137560">isEof</span>&nbsp;<span class="builtintype" id="4137566">bool</span><span class="op" id="4137570">)</span>&nbsp;<span class="op" id="4137572">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137575">if</span>&nbsp;<span class="ident" id="4137578">w</span><span class="op" id="4137579">.</span><span class="ident" id="4137580">err</span>&nbsp;<span class="op" id="4137584">!=</span>&nbsp;<span class="ident" id="4137587">nil</span>&nbsp;<span class="op" id="4137591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137595">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4137603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137606">var</span>&nbsp;<span class="ident" id="4137610">firstBits</span>&nbsp;<span class="builtintype" id="4137620">int32</span>&nbsp;<span class="op" id="4137626">=</span>&nbsp;<span class="num" id="4137628">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137631">if</span>&nbsp;<span class="ident" id="4137634">isEof</span>&nbsp;<span class="op" id="4137640">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137644">firstBits</span>&nbsp;<span class="op" id="4137654">=</span>&nbsp;<span class="num" id="4137656">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4137659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137662">w</span><span class="op" id="4137663">.</span><span class="ident" id="4137664">writeBits</span><span class="op" id="4137673">(</span><span class="ident" id="4137674">firstBits</span><span class="op" id="4137683">,</span>&nbsp;<span class="num" id="4137685">3</span><span class="op" id="4137686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137689">w</span><span class="op" id="4137690">.</span><span class="ident" id="4137691">writeBits</span><span class="op" id="4137700">(</span><span class="builtintype" id="4137701">int32</span><span class="op" id="4137706">(</span><span class="ident" id="4137707">numLiterals</span><span class="op" id="4137718">-</span><span class="num" id="4137719">257</span><span class="op" id="4137722">)</span><span class="op" id="4137723">,</span>&nbsp;<span class="num" id="4137725">5</span><span class="op" id="4137726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137729">w</span><span class="op" id="4137730">.</span><span class="ident" id="4137731">writeBits</span><span class="op" id="4137740">(</span><span class="builtintype" id="4137741">int32</span><span class="op" id="4137746">(</span><span class="ident" id="4137747">numOffsets</span><span class="op" id="4137757">-</span><span class="num" id="4137758">1</span><span class="op" id="4137759">)</span><span class="op" id="4137760">,</span>&nbsp;<span class="num" id="4137762">5</span><span class="op" id="4137763">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137766">w</span><span class="op" id="4137767">.</span><span class="ident" id="4137768">writeBits</span><span class="op" id="4137777">(</span><span class="builtintype" id="4137778">int32</span><span class="op" id="4137783">(</span><span class="ident" id="4137784">numCodegens</span><span class="op" id="4137795">-</span><span class="num" id="4137796">4</span><span class="op" id="4137797">)</span><span class="op" id="4137798">,</span>&nbsp;<span class="num" id="4137800">4</span><span class="op" id="4137801">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137805">for</span>&nbsp;<span class="ident" id="4137809">i</span>&nbsp;<span class="op" id="4137811">:=</span>&nbsp;<span class="num" id="4137814">0</span><span class="op" id="4137815">;</span>&nbsp;<span class="ident" id="4137817">i</span>&nbsp;<span class="op" id="4137819">&lt;</span>&nbsp;<span class="ident" id="4137821">numCodegens</span><span class="op" id="4137832">;</span>&nbsp;<span class="ident" id="4137834">i</span><span class="op" id="4137835">++</span>&nbsp;<span class="op" id="4137838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137842">value</span>&nbsp;<span class="op" id="4137848">:=</span>&nbsp;<span class="ident" id="4137851">w</span><span class="op" id="4137852">.</span><span class="ident" id="4137853">codegenEncoding</span><span class="op" id="4137868">.</span><span class="ident" id="4137869">codeBits</span><span class="op" id="4137877">[</span><span class="ident" id="4137878">codegenOrder</span><span class="op" id="4137890">[</span><span class="ident" id="4137891">i</span><span class="op" id="4137892">]</span><span class="op" id="4137893">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137897">w</span><span class="op" id="4137898">.</span><span class="ident" id="4137899">writeBits</span><span class="op" id="4137908">(</span><span class="builtintype" id="4137909">int32</span><span class="op" id="4137914">(</span><span class="ident" id="4137915">value</span><span class="op" id="4137920">)</span><span class="op" id="4137921">,</span>&nbsp;<span class="num" id="4137923">3</span><span class="op" id="4137924">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4137927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137931">i</span>&nbsp;<span class="op" id="4137933">:=</span>&nbsp;<span class="num" id="4137936">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137939">for</span>&nbsp;<span class="op" id="4137943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137947">var</span>&nbsp;<span class="ident" id="4137951">codeWord</span>&nbsp;<span class="builtintype" id="4137960">int</span>&nbsp;<span class="op" id="4137964">=</span>&nbsp;<span class="builtintype" id="4137966">int</span><span class="op" id="4137969">(</span><span class="ident" id="4137970">w</span><span class="op" id="4137971">.</span><span class="ident" id="4137972">codegen</span><span class="op" id="4137979">[</span><span class="ident" id="4137980">i</span><span class="op" id="4137981">]</span><span class="op" id="4137982">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4137986">i</span><span class="op" id="4137987">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4137992">if</span>&nbsp;<span class="ident" id="4137995">codeWord</span>&nbsp;<span class="op" id="4138004">==</span>&nbsp;<span class="ident" id="4138007">badCode</span>&nbsp;<span class="op" id="4138015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138020">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4138032">//&nbsp;The&nbsp;low&nbsp;byte&nbsp;contains&nbsp;the&nbsp;actual&nbsp;code&nbsp;to&nbsp;generate.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138088">w</span><span class="op" id="4138089">.</span><span class="ident" id="4138090">writeCode</span><span class="op" id="4138099">(</span><span class="ident" id="4138100">w</span><span class="op" id="4138101">.</span><span class="ident" id="4138102">codegenEncoding</span><span class="op" id="4138117">,</span>&nbsp;<span class="builtintype" id="4138119">uint32</span><span class="op" id="4138125">(</span><span class="ident" id="4138126">codeWord</span><span class="op" id="4138134">)</span><span class="op" id="4138135">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138140">switch</span>&nbsp;<span class="ident" id="4138147">codeWord</span>&nbsp;<span class="op" id="4138156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138160">case</span>&nbsp;<span class="num" id="4138165">16</span><span class="op" id="4138167">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138172">w</span><span class="op" id="4138173">.</span><span class="ident" id="4138174">writeBits</span><span class="op" id="4138183">(</span><span class="builtintype" id="4138184">int32</span><span class="op" id="4138189">(</span><span class="ident" id="4138190">w</span><span class="op" id="4138191">.</span><span class="ident" id="4138192">codegen</span><span class="op" id="4138199">[</span><span class="ident" id="4138200">i</span><span class="op" id="4138201">]</span><span class="op" id="4138202">)</span><span class="op" id="4138203">,</span>&nbsp;<span class="num" id="4138205">2</span><span class="op" id="4138206">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138211">i</span><span class="op" id="4138212">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138218">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138226">case</span>&nbsp;<span class="num" id="4138231">17</span><span class="op" id="4138233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138238">w</span><span class="op" id="4138239">.</span><span class="ident" id="4138240">writeBits</span><span class="op" id="4138249">(</span><span class="builtintype" id="4138250">int32</span><span class="op" id="4138255">(</span><span class="ident" id="4138256">w</span><span class="op" id="4138257">.</span><span class="ident" id="4138258">codegen</span><span class="op" id="4138265">[</span><span class="ident" id="4138266">i</span><span class="op" id="4138267">]</span><span class="op" id="4138268">)</span><span class="op" id="4138269">,</span>&nbsp;<span class="num" id="4138271">3</span><span class="op" id="4138272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138277">i</span><span class="op" id="4138278">++</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138284">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138292">case</span>&nbsp;<span class="num" id="4138297">18</span><span class="op" id="4138299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138304">w</span><span class="op" id="4138305">.</span><span class="ident" id="4138306">writeBits</span><span class="op" id="4138315">(</span><span class="builtintype" id="4138316">int32</span><span class="op" id="4138321">(</span><span class="ident" id="4138322">w</span><span class="op" id="4138323">.</span><span class="ident" id="4138324">codegen</span><span class="op" id="4138331">[</span><span class="ident" id="4138332">i</span><span class="op" id="4138333">]</span><span class="op" id="4138334">)</span><span class="op" id="4138335">,</span>&nbsp;<span class="num" id="4138337">7</span><span class="op" id="4138338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138343">i</span><span class="op" id="4138344">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138350">break</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138361">}</span><br>
<span class="lineno"></span><span class="op" id="4138363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4138366">func</span>&nbsp;<span class="op" id="4138371">(</span><span class="ident" id="4138372">w</span>&nbsp;<span class="op" id="4138374">*</span><span class="ident" id="4138375">huffmanBitWriter</span><span class="op" id="4138391">)</span>&nbsp;<span class="ident" id="4138393">writeStoredHeader</span><span class="op" id="4138410">(</span><span class="ident" id="4138411">length</span>&nbsp;<span class="builtintype" id="4138418">int</span><span class="op" id="4138421">,</span>&nbsp;<span class="ident" id="4138423">isEof</span>&nbsp;<span class="builtintype" id="4138429">bool</span><span class="op" id="4138433">)</span>&nbsp;<span class="op" id="4138435">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138438">if</span>&nbsp;<span class="ident" id="4138441">w</span><span class="op" id="4138442">.</span><span class="ident" id="4138443">err</span>&nbsp;<span class="op" id="4138447">!=</span>&nbsp;<span class="ident" id="4138450">nil</span>&nbsp;<span class="op" id="4138454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138458">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138469">var</span>&nbsp;<span class="ident" id="4138473">flag</span>&nbsp;<span class="builtintype" id="4138478">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138485">if</span>&nbsp;<span class="ident" id="4138488">isEof</span>&nbsp;<span class="op" id="4138494">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138498">flag</span>&nbsp;<span class="op" id="4138503">=</span>&nbsp;<span class="num" id="4138505">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138511">w</span><span class="op" id="4138512">.</span><span class="ident" id="4138513">writeBits</span><span class="op" id="4138522">(</span><span class="ident" id="4138523">flag</span><span class="op" id="4138527">,</span>&nbsp;<span class="num" id="4138529">3</span><span class="op" id="4138530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138533">w</span><span class="op" id="4138534">.</span><span class="ident" id="4138535">flush</span><span class="op" id="4138540">(</span><span class="op" id="4138541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138544">w</span><span class="op" id="4138545">.</span><span class="ident" id="4138546">writeBits</span><span class="op" id="4138555">(</span><span class="builtintype" id="4138556">int32</span><span class="op" id="4138561">(</span><span class="ident" id="4138562">length</span><span class="op" id="4138568">)</span><span class="op" id="4138569">,</span>&nbsp;<span class="num" id="4138571">16</span><span class="op" id="4138573">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138576">w</span><span class="op" id="4138577">.</span><span class="ident" id="4138578">writeBits</span><span class="op" id="4138587">(</span><span class="builtintype" id="4138588">int32</span><span class="op" id="4138593">(</span><span class="op" id="4138594">^</span><span class="builtintype" id="4138595">uint16</span><span class="op" id="4138601">(</span><span class="ident" id="4138602">length</span><span class="op" id="4138608">)</span><span class="op" id="4138609">)</span><span class="op" id="4138610">,</span>&nbsp;<span class="num" id="4138612">16</span><span class="op" id="4138614">)</span><br>
<span class="lineno"></span><span class="op" id="4138616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4138619">func</span>&nbsp;<span class="op" id="4138624">(</span><span class="ident" id="4138625">w</span>&nbsp;<span class="op" id="4138627">*</span><span class="ident" id="4138628">huffmanBitWriter</span><span class="op" id="4138644">)</span>&nbsp;<span class="ident" id="4138646">writeFixedHeader</span><span class="op" id="4138662">(</span><span class="ident" id="4138663">isEof</span>&nbsp;<span class="builtintype" id="4138669">bool</span><span class="op" id="4138673">)</span>&nbsp;<span class="op" id="4138675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138678">if</span>&nbsp;<span class="ident" id="4138681">w</span><span class="op" id="4138682">.</span><span class="ident" id="4138683">err</span>&nbsp;<span class="op" id="4138687">!=</span>&nbsp;<span class="ident" id="4138690">nil</span>&nbsp;<span class="op" id="4138694">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138698">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4138709">//&nbsp;Indicate&nbsp;that&nbsp;we&nbsp;are&nbsp;a&nbsp;fixed&nbsp;Huffman&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138756">var</span>&nbsp;<span class="ident" id="4138760">value</span>&nbsp;<span class="builtintype" id="4138766">int32</span>&nbsp;<span class="op" id="4138772">=</span>&nbsp;<span class="num" id="4138774">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138777">if</span>&nbsp;<span class="ident" id="4138780">isEof</span>&nbsp;<span class="op" id="4138786">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138790">value</span>&nbsp;<span class="op" id="4138796">=</span>&nbsp;<span class="num" id="4138798">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138804">w</span><span class="op" id="4138805">.</span><span class="ident" id="4138806">writeBits</span><span class="op" id="4138815">(</span><span class="ident" id="4138816">value</span><span class="op" id="4138821">,</span>&nbsp;<span class="num" id="4138823">3</span><span class="op" id="4138824">)</span><br>
<span class="lineno"></span><span class="op" id="4138826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="4138829">func</span>&nbsp;<span class="op" id="4138834">(</span><span class="ident" id="4138835">w</span>&nbsp;<span class="op" id="4138837">*</span><span class="ident" id="4138838">huffmanBitWriter</span><span class="op" id="4138854">)</span>&nbsp;<span class="ident" id="4138856">writeBlock</span><span class="op" id="4138866">(</span><span class="ident" id="4138867">tokens</span>&nbsp;<span class="op" id="4138874">[</span><span class="op" id="4138875">]</span><span class="ident" id="4138876">token</span><span class="op" id="4138881">,</span>&nbsp;<span class="ident" id="4138883">eof</span>&nbsp;<span class="builtintype" id="4138887">bool</span><span class="op" id="4138891">,</span>&nbsp;<span class="ident" id="4138893">input</span>&nbsp;<span class="op" id="4138899">[</span><span class="op" id="4138900">]</span><span class="builtintype" id="4138901">byte</span><span class="op" id="4138905">)</span>&nbsp;<span class="op" id="4138907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138910">if</span>&nbsp;<span class="ident" id="4138913">w</span><span class="op" id="4138914">.</span><span class="ident" id="4138915">err</span>&nbsp;<span class="op" id="4138919">!=</span>&nbsp;<span class="ident" id="4138922">nil</span>&nbsp;<span class="op" id="4138926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138930">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138941">for</span>&nbsp;<span class="ident" id="4138945">i</span>&nbsp;<span class="op" id="4138947">:=</span>&nbsp;<span class="keyword" id="4138950">range</span>&nbsp;<span class="ident" id="4138956">w</span><span class="op" id="4138957">.</span><span class="ident" id="4138958">literalFreq</span>&nbsp;<span class="op" id="4138970">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4138974">w</span><span class="op" id="4138975">.</span><span class="ident" id="4138976">literalFreq</span><span class="op" id="4138987">[</span><span class="ident" id="4138988">i</span><span class="op" id="4138989">]</span>&nbsp;<span class="op" id="4138991">=</span>&nbsp;<span class="num" id="4138993">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4138996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4138999">for</span>&nbsp;<span class="ident" id="4139003">i</span>&nbsp;<span class="op" id="4139005">:=</span>&nbsp;<span class="keyword" id="4139008">range</span>&nbsp;<span class="ident" id="4139014">w</span><span class="op" id="4139015">.</span><span class="ident" id="4139016">offsetFreq</span>&nbsp;<span class="op" id="4139027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139031">w</span><span class="op" id="4139032">.</span><span class="ident" id="4139033">offsetFreq</span><span class="op" id="4139043">[</span><span class="ident" id="4139044">i</span><span class="op" id="4139045">]</span>&nbsp;<span class="op" id="4139047">=</span>&nbsp;<span class="num" id="4139049">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139052">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139056">n</span>&nbsp;<span class="op" id="4139058">:=</span>&nbsp;<span class="builtinfunc" id="4139061">len</span><span class="op" id="4139064">(</span><span class="ident" id="4139065">tokens</span><span class="op" id="4139071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139074">tokens</span>&nbsp;<span class="op" id="4139081">=</span>&nbsp;<span class="ident" id="4139083">tokens</span><span class="op" id="4139089">[</span><span class="num" id="4139090">0</span>&nbsp;<span class="op" id="4139092">:</span>&nbsp;<span class="ident" id="4139094">n</span><span class="op" id="4139095">+</span><span class="num" id="4139096">1</span><span class="op" id="4139097">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139100">tokens</span><span class="op" id="4139106">[</span><span class="ident" id="4139107">n</span><span class="op" id="4139108">]</span>&nbsp;<span class="op" id="4139110">=</span>&nbsp;<span class="ident" id="4139112">endBlockMarker</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139129">for</span>&nbsp;<span class="ident" id="4139133">_</span><span class="op" id="4139134">,</span>&nbsp;<span class="ident" id="4139136">t</span>&nbsp;<span class="op" id="4139138">:=</span>&nbsp;<span class="keyword" id="4139141">range</span>&nbsp;<span class="ident" id="4139147">tokens</span>&nbsp;<span class="op" id="4139154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139158">switch</span>&nbsp;<span class="ident" id="4139165">t</span><span class="op" id="4139166">.</span><span class="ident" id="4139167">typ</span><span class="op" id="4139170">(</span><span class="op" id="4139171">)</span>&nbsp;<span class="op" id="4139173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139177">case</span>&nbsp;<span class="ident" id="4139182">literalType</span><span class="op" id="4139193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139198">w</span><span class="op" id="4139199">.</span><span class="ident" id="4139200">literalFreq</span><span class="op" id="4139211">[</span><span class="ident" id="4139212">t</span><span class="op" id="4139213">.</span><span class="ident" id="4139214">literal</span><span class="op" id="4139221">(</span><span class="op" id="4139222">)</span><span class="op" id="4139223">]</span><span class="op" id="4139224">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139229">case</span>&nbsp;<span class="ident" id="4139234">matchType</span><span class="op" id="4139243">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139248">length</span>&nbsp;<span class="op" id="4139255">:=</span>&nbsp;<span class="ident" id="4139258">t</span><span class="op" id="4139259">.</span><span class="ident" id="4139260">length</span><span class="op" id="4139266">(</span><span class="op" id="4139267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139272">offset</span>&nbsp;<span class="op" id="4139279">:=</span>&nbsp;<span class="ident" id="4139282">t</span><span class="op" id="4139283">.</span><span class="ident" id="4139284">offset</span><span class="op" id="4139290">(</span><span class="op" id="4139291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139296">w</span><span class="op" id="4139297">.</span><span class="ident" id="4139298">literalFreq</span><span class="op" id="4139309">[</span><span class="ident" id="4139310">lengthCodesStart</span><span class="op" id="4139326">+</span><span class="ident" id="4139327">lengthCode</span><span class="op" id="4139337">(</span><span class="ident" id="4139338">length</span><span class="op" id="4139344">)</span><span class="op" id="4139345">]</span><span class="op" id="4139346">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139352">w</span><span class="op" id="4139353">.</span><span class="ident" id="4139354">offsetFreq</span><span class="op" id="4139364">[</span><span class="ident" id="4139365">offsetCode</span><span class="op" id="4139375">(</span><span class="ident" id="4139376">offset</span><span class="op" id="4139382">)</span><span class="op" id="4139383">]</span><span class="op" id="4139384">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139389">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4139396">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139427">numLiterals</span>&nbsp;<span class="op" id="4139439">:=</span>&nbsp;<span class="builtinfunc" id="4139442">len</span><span class="op" id="4139445">(</span><span class="ident" id="4139446">w</span><span class="op" id="4139447">.</span><span class="ident" id="4139448">literalFreq</span><span class="op" id="4139459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139462">for</span>&nbsp;<span class="ident" id="4139466">w</span><span class="op" id="4139467">.</span><span class="ident" id="4139468">literalFreq</span><span class="op" id="4139479">[</span><span class="ident" id="4139480">numLiterals</span><span class="op" id="4139491">-</span><span class="num" id="4139492">1</span><span class="op" id="4139493">]</span>&nbsp;<span class="op" id="4139495">==</span>&nbsp;<span class="num" id="4139498">0</span>&nbsp;<span class="op" id="4139500">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139504">numLiterals</span><span class="op" id="4139515">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4139522">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139552">numOffsets</span>&nbsp;<span class="op" id="4139563">:=</span>&nbsp;<span class="builtinfunc" id="4139566">len</span><span class="op" id="4139569">(</span><span class="ident" id="4139570">w</span><span class="op" id="4139571">.</span><span class="ident" id="4139572">offsetFreq</span><span class="op" id="4139582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139585">for</span>&nbsp;<span class="ident" id="4139589">numOffsets</span>&nbsp;<span class="op" id="4139600">&gt;</span>&nbsp;<span class="num" id="4139602">0</span>&nbsp;<span class="op" id="4139604">&amp;&amp;</span>&nbsp;<span class="ident" id="4139607">w</span><span class="op" id="4139608">.</span><span class="ident" id="4139609">offsetFreq</span><span class="op" id="4139619">[</span><span class="ident" id="4139620">numOffsets</span><span class="op" id="4139630">-</span><span class="num" id="4139631">1</span><span class="op" id="4139632">]</span>&nbsp;<span class="op" id="4139634">==</span>&nbsp;<span class="num" id="4139637">0</span>&nbsp;<span class="op" id="4139639">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139643">numOffsets</span><span class="op" id="4139653">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4139660">if</span>&nbsp;<span class="ident" id="4139663">numOffsets</span>&nbsp;<span class="op" id="4139674">==</span>&nbsp;<span class="num" id="4139677">0</span>&nbsp;<span class="op" id="4139679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4139683">//&nbsp;We&nbsp;haven&#39;t&nbsp;found&nbsp;a&nbsp;single&nbsp;match.&nbsp;If&nbsp;we&nbsp;want&nbsp;to&nbsp;go&nbsp;with&nbsp;the&nbsp;dynamic&nbsp;encoding,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4139765">//&nbsp;we&nbsp;should&nbsp;count&nbsp;at&nbsp;least&nbsp;one&nbsp;offset&nbsp;to&nbsp;be&nbsp;sure&nbsp;that&nbsp;the&nbsp;offset&nbsp;huffman&nbsp;tree&nbsp;could&nbsp;be&nbsp;encoded.</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139864">w</span><span class="op" id="4139865">.</span><span class="ident" id="4139866">offsetFreq</span><span class="op" id="4139876">[</span><span class="num" id="4139877">0</span><span class="op" id="4139878">]</span>&nbsp;<span class="op" id="4139880">=</span>&nbsp;<span class="num" id="4139882">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139886">numOffsets</span>&nbsp;<span class="op" id="4139897">=</span>&nbsp;<span class="num" id="4139899">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4139902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139906">w</span><span class="op" id="4139907">.</span><span class="ident" id="4139908">literalEncoding</span><span class="op" id="4139923">.</span><span class="ident" id="4139924">generate</span><span class="op" id="4139932">(</span><span class="ident" id="4139933">w</span><span class="op" id="4139934">.</span><span class="ident" id="4139935">literalFreq</span><span class="op" id="4139946">,</span>&nbsp;<span class="num" id="4139948">15</span><span class="op" id="4139950">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139953">w</span><span class="op" id="4139954">.</span><span class="ident" id="4139955">offsetEncoding</span><span class="op" id="4139969">.</span><span class="ident" id="4139970">generate</span><span class="op" id="4139978">(</span><span class="ident" id="4139979">w</span><span class="op" id="4139980">.</span><span class="ident" id="4139981">offsetFreq</span><span class="op" id="4139991">,</span>&nbsp;<span class="num" id="4139993">15</span><span class="op" id="4139995">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4139999">storedBytes</span>&nbsp;<span class="op" id="4140011">:=</span>&nbsp;<span class="num" id="4140014">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140017">if</span>&nbsp;<span class="ident" id="4140020">input</span>&nbsp;<span class="op" id="4140026">!=</span>&nbsp;<span class="ident" id="4140029">nil</span>&nbsp;<span class="op" id="4140033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140037">storedBytes</span>&nbsp;<span class="op" id="4140049">=</span>&nbsp;<span class="builtinfunc" id="4140051">len</span><span class="op" id="4140054">(</span><span class="ident" id="4140055">input</span><span class="op" id="4140060">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4140063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140066">var</span>&nbsp;<span class="ident" id="4140070">extraBits</span>&nbsp;<span class="ident" id="4140080">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140087">var</span>&nbsp;<span class="ident" id="4140091">storedSize</span>&nbsp;<span class="ident" id="4140102">int64</span>&nbsp;<span class="op" id="4140108">=</span>&nbsp;<span class="ident" id="4140110">math</span><span class="op" id="4140114">.</span><span class="ident" id="4140115">MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140125">if</span>&nbsp;<span class="ident" id="4140128">storedBytes</span>&nbsp;<span class="op" id="4140140">&lt;=</span>&nbsp;<span class="ident" id="4140143">maxStoreBlockSize</span>&nbsp;<span class="op" id="4140161">&amp;&amp;</span>&nbsp;<span class="ident" id="4140164">input</span>&nbsp;<span class="op" id="4140170">!=</span>&nbsp;<span class="ident" id="4140173">nil</span>&nbsp;<span class="op" id="4140177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140181">storedSize</span>&nbsp;<span class="op" id="4140192">=</span>&nbsp;<span class="ident" id="4140194">int64</span><span class="op" id="4140199">(</span><span class="op" id="4140200">(</span><span class="ident" id="4140201">storedBytes</span>&nbsp;<span class="op" id="4140213">+</span>&nbsp;<span class="num" id="4140215">5</span><span class="op" id="4140216">)</span>&nbsp;<span class="op" id="4140218">*</span>&nbsp;<span class="num" id="4140220">8</span><span class="op" id="4140221">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140225">//&nbsp;We&nbsp;only&nbsp;bother&nbsp;calculating&nbsp;the&nbsp;costs&nbsp;of&nbsp;the&nbsp;extra&nbsp;bits&nbsp;required&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140297">//&nbsp;the&nbsp;length&nbsp;of&nbsp;offset&nbsp;fields&nbsp;(which&nbsp;will&nbsp;be&nbsp;the&nbsp;same&nbsp;for&nbsp;both&nbsp;fixed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140369">//&nbsp;and&nbsp;dynamic&nbsp;encoding),&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;compare&nbsp;those&nbsp;two&nbsp;encodings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140439">//&nbsp;against&nbsp;stored&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140469">for</span>&nbsp;<span class="ident" id="4140473">lengthCode</span>&nbsp;<span class="op" id="4140484">:=</span>&nbsp;<span class="ident" id="4140487">lengthCodesStart</span>&nbsp;<span class="op" id="4140504">+</span>&nbsp;<span class="num" id="4140506">8</span><span class="op" id="4140507">;</span>&nbsp;<span class="ident" id="4140509">lengthCode</span>&nbsp;<span class="op" id="4140520">&lt;</span>&nbsp;<span class="ident" id="4140522">numLiterals</span><span class="op" id="4140533">;</span>&nbsp;<span class="ident" id="4140535">lengthCode</span><span class="op" id="4140545">++</span>&nbsp;<span class="op" id="4140548">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140553">//&nbsp;First&nbsp;eight&nbsp;length&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140605">extraBits</span>&nbsp;<span class="op" id="4140615">+=</span>&nbsp;<span class="ident" id="4140618">int64</span><span class="op" id="4140623">(</span><span class="ident" id="4140624">w</span><span class="op" id="4140625">.</span><span class="ident" id="4140626">literalFreq</span><span class="op" id="4140637">[</span><span class="ident" id="4140638">lengthCode</span><span class="op" id="4140648">]</span><span class="op" id="4140649">)</span>&nbsp;<span class="op" id="4140651">*</span>&nbsp;<span class="ident" id="4140653">int64</span><span class="op" id="4140658">(</span><span class="ident" id="4140659">lengthExtraBits</span><span class="op" id="4140674">[</span><span class="ident" id="4140675">lengthCode</span><span class="op" id="4140685">-</span><span class="ident" id="4140686">lengthCodesStart</span><span class="op" id="4140702">]</span><span class="op" id="4140703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4140707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140711">for</span>&nbsp;<span class="ident" id="4140715">offsetCode</span>&nbsp;<span class="op" id="4140726">:=</span>&nbsp;<span class="num" id="4140729">4</span><span class="op" id="4140730">;</span>&nbsp;<span class="ident" id="4140732">offsetCode</span>&nbsp;<span class="op" id="4140743">&lt;</span>&nbsp;<span class="ident" id="4140745">numOffsets</span><span class="op" id="4140755">;</span>&nbsp;<span class="ident" id="4140757">offsetCode</span><span class="op" id="4140767">++</span>&nbsp;<span class="op" id="4140770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140775">//&nbsp;First&nbsp;four&nbsp;offset&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140826">extraBits</span>&nbsp;<span class="op" id="4140836">+=</span>&nbsp;<span class="ident" id="4140839">int64</span><span class="op" id="4140844">(</span><span class="ident" id="4140845">w</span><span class="op" id="4140846">.</span><span class="ident" id="4140847">offsetFreq</span><span class="op" id="4140857">[</span><span class="ident" id="4140858">offsetCode</span><span class="op" id="4140868">]</span><span class="op" id="4140869">)</span>&nbsp;<span class="op" id="4140871">*</span>&nbsp;<span class="ident" id="4140873">int64</span><span class="op" id="4140878">(</span><span class="ident" id="4140879">offsetExtraBits</span><span class="op" id="4140894">[</span><span class="ident" id="4140895">offsetCode</span><span class="op" id="4140905">]</span><span class="op" id="4140906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4140910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4140913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140917">//&nbsp;Figure&nbsp;out&nbsp;smallest&nbsp;code.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4140947">//&nbsp;Fixed&nbsp;Huffman&nbsp;baseline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4140975">var</span>&nbsp;<span class="ident" id="4140979">size</span>&nbsp;<span class="op" id="4140984">=</span>&nbsp;<span class="ident" id="4140986">int64</span><span class="op" id="4140991">(</span><span class="num" id="4140992">3</span><span class="op" id="4140993">)</span>&nbsp;<span class="op" id="4140995">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4140999">fixedLiteralEncoding</span><span class="op" id="4141019">.</span><span class="ident" id="4141020">bitLength</span><span class="op" id="4141029">(</span><span class="ident" id="4141030">w</span><span class="op" id="4141031">.</span><span class="ident" id="4141032">literalFreq</span><span class="op" id="4141043">)</span>&nbsp;<span class="op" id="4141045">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141049">fixedOffsetEncoding</span><span class="op" id="4141068">.</span><span class="ident" id="4141069">bitLength</span><span class="op" id="4141078">(</span><span class="ident" id="4141079">w</span><span class="op" id="4141080">.</span><span class="ident" id="4141081">offsetFreq</span><span class="op" id="4141091">)</span>&nbsp;<span class="op" id="4141093">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141097">extraBits</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141108">var</span>&nbsp;<span class="ident" id="4141112">literalEncoding</span>&nbsp;<span class="op" id="4141128">=</span>&nbsp;<span class="ident" id="4141130">fixedLiteralEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141152">var</span>&nbsp;<span class="ident" id="4141156">offsetEncoding</span>&nbsp;<span class="op" id="4141171">=</span>&nbsp;<span class="ident" id="4141173">fixedOffsetEncoding</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141195">//&nbsp;Dynamic&nbsp;Huffman?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141216">var</span>&nbsp;<span class="ident" id="4141220">numCodegens</span>&nbsp;<span class="builtintype" id="4141232">int</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141238">//&nbsp;Generate&nbsp;codegen&nbsp;and&nbsp;codegenFrequencies,&nbsp;which&nbsp;indicates&nbsp;how&nbsp;to&nbsp;encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4141313">//&nbsp;the&nbsp;literalEncoding&nbsp;and&nbsp;the&nbsp;offsetEncoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141361">w</span><span class="op" id="4141362">.</span><span class="ident" id="4141363">generateCodegen</span><span class="op" id="4141378">(</span><span class="ident" id="4141379">numLiterals</span><span class="op" id="4141390">,</span>&nbsp;<span class="ident" id="4141392">numOffsets</span><span class="op" id="4141402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141405">w</span><span class="op" id="4141406">.</span><span class="ident" id="4141407">codegenEncoding</span><span class="op" id="4141422">.</span><span class="ident" id="4141423">generate</span><span class="op" id="4141431">(</span><span class="ident" id="4141432">w</span><span class="op" id="4141433">.</span><span class="ident" id="4141434">codegenFreq</span><span class="op" id="4141445">,</span>&nbsp;<span class="num" id="4141447">7</span><span class="op" id="4141448">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141451">numCodegens</span>&nbsp;<span class="op" id="4141463">=</span>&nbsp;<span class="builtinfunc" id="4141465">len</span><span class="op" id="4141468">(</span><span class="ident" id="4141469">w</span><span class="op" id="4141470">.</span><span class="ident" id="4141471">codegenFreq</span><span class="op" id="4141482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141485">for</span>&nbsp;<span class="ident" id="4141489">numCodegens</span>&nbsp;<span class="op" id="4141501">&gt;</span>&nbsp;<span class="num" id="4141503">4</span>&nbsp;<span class="op" id="4141505">&amp;&amp;</span>&nbsp;<span class="ident" id="4141508">w</span><span class="op" id="4141509">.</span><span class="ident" id="4141510">codegenFreq</span><span class="op" id="4141521">[</span><span class="ident" id="4141522">codegenOrder</span><span class="op" id="4141534">[</span><span class="ident" id="4141535">numCodegens</span><span class="op" id="4141546">-</span><span class="num" id="4141547">1</span><span class="op" id="4141548">]</span><span class="op" id="4141549">]</span>&nbsp;<span class="op" id="4141551">==</span>&nbsp;<span class="num" id="4141554">0</span>&nbsp;<span class="op" id="4141556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141560">numCodegens</span><span class="op" id="4141571">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4141575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141578">dynamicHeader</span>&nbsp;<span class="op" id="4141592">:=</span>&nbsp;<span class="ident" id="4141595">int64</span><span class="op" id="4141600">(</span><span class="num" id="4141601">3</span><span class="op" id="4141602">+</span><span class="num" id="4141603">5</span><span class="op" id="4141604">+</span><span class="num" id="4141605">5</span><span class="op" id="4141606">+</span><span class="num" id="4141607">4</span><span class="op" id="4141608">+</span><span class="op" id="4141609">(</span><span class="num" id="4141610">3</span><span class="op" id="4141611">*</span><span class="ident" id="4141612">numCodegens</span><span class="op" id="4141623">)</span><span class="op" id="4141624">)</span>&nbsp;<span class="op" id="4141626">+</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141630">w</span><span class="op" id="4141631">.</span><span class="ident" id="4141632">codegenEncoding</span><span class="op" id="4141647">.</span><span class="ident" id="4141648">bitLength</span><span class="op" id="4141657">(</span><span class="ident" id="4141658">w</span><span class="op" id="4141659">.</span><span class="ident" id="4141660">codegenFreq</span><span class="op" id="4141671">)</span>&nbsp;<span class="op" id="4141673">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141677">int64</span><span class="op" id="4141682">(</span><span class="ident" id="4141683">extraBits</span><span class="op" id="4141692">)</span>&nbsp;<span class="op" id="4141694">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141698">int64</span><span class="op" id="4141703">(</span><span class="ident" id="4141704">w</span><span class="op" id="4141705">.</span><span class="ident" id="4141706">codegenFreq</span><span class="op" id="4141717">[</span><span class="num" id="4141718">16</span><span class="op" id="4141720">]</span><span class="op" id="4141721">*</span><span class="num" id="4141722">2</span><span class="op" id="4141723">)</span>&nbsp;<span class="op" id="4141725">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141729">int64</span><span class="op" id="4141734">(</span><span class="ident" id="4141735">w</span><span class="op" id="4141736">.</span><span class="ident" id="4141737">codegenFreq</span><span class="op" id="4141748">[</span><span class="num" id="4141749">17</span><span class="op" id="4141751">]</span><span class="op" id="4141752">*</span><span class="num" id="4141753">3</span><span class="op" id="4141754">)</span>&nbsp;<span class="op" id="4141756">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141760">int64</span><span class="op" id="4141765">(</span><span class="ident" id="4141766">w</span><span class="op" id="4141767">.</span><span class="ident" id="4141768">codegenFreq</span><span class="op" id="4141779">[</span><span class="num" id="4141780">18</span><span class="op" id="4141782">]</span><span class="op" id="4141783">*</span><span class="num" id="4141784">7</span><span class="op" id="4141785">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141788">dynamicSize</span>&nbsp;<span class="op" id="4141800">:=</span>&nbsp;<span class="ident" id="4141803">dynamicHeader</span>&nbsp;<span class="op" id="4141817">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141821">w</span><span class="op" id="4141822">.</span><span class="ident" id="4141823">literalEncoding</span><span class="op" id="4141838">.</span><span class="ident" id="4141839">bitLength</span><span class="op" id="4141848">(</span><span class="ident" id="4141849">w</span><span class="op" id="4141850">.</span><span class="ident" id="4141851">literalFreq</span><span class="op" id="4141862">)</span>&nbsp;<span class="op" id="4141864">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141868">w</span><span class="op" id="4141869">.</span><span class="ident" id="4141870">offsetEncoding</span><span class="op" id="4141884">.</span><span class="ident" id="4141885">bitLength</span><span class="op" id="4141894">(</span><span class="ident" id="4141895">w</span><span class="op" id="4141896">.</span><span class="ident" id="4141897">offsetFreq</span><span class="op" id="4141907">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4141911">if</span>&nbsp;<span class="ident" id="4141914">dynamicSize</span>&nbsp;<span class="op" id="4141926">&lt;</span>&nbsp;<span class="ident" id="4141928">size</span>&nbsp;<span class="op" id="4141933">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141937">size</span>&nbsp;<span class="op" id="4141942">=</span>&nbsp;<span class="ident" id="4141944">dynamicSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141958">literalEncoding</span>&nbsp;<span class="op" id="4141974">=</span>&nbsp;<span class="ident" id="4141976">w</span><span class="op" id="4141977">.</span><span class="ident" id="4141978">literalEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4141996">offsetEncoding</span>&nbsp;<span class="op" id="4142011">=</span>&nbsp;<span class="ident" id="4142013">w</span><span class="op" id="4142014">.</span><span class="ident" id="4142015">offsetEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4142031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142035">//&nbsp;Stored&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142053">if</span>&nbsp;<span class="ident" id="4142056">storedSize</span>&nbsp;<span class="op" id="4142067">&lt;</span>&nbsp;<span class="ident" id="4142069">size</span>&nbsp;<span class="op" id="4142074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142078">w</span><span class="op" id="4142079">.</span><span class="ident" id="4142080">writeStoredHeader</span><span class="op" id="4142097">(</span><span class="ident" id="4142098">storedBytes</span><span class="op" id="4142109">,</span>&nbsp;<span class="ident" id="4142111">eof</span><span class="op" id="4142114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142118">w</span><span class="op" id="4142119">.</span><span class="ident" id="4142120">writeBytes</span><span class="op" id="4142130">(</span><span class="ident" id="4142131">input</span><span class="op" id="4142136">[</span><span class="num" id="4142137">0</span><span class="op" id="4142138">:</span><span class="ident" id="4142139">storedBytes</span><span class="op" id="4142150">]</span><span class="op" id="4142151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142155">return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4142163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142167">//&nbsp;Huffman.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142180">if</span>&nbsp;<span class="ident" id="4142183">literalEncoding</span>&nbsp;<span class="op" id="4142199">==</span>&nbsp;<span class="ident" id="4142202">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4142223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142227">w</span><span class="op" id="4142228">.</span><span class="ident" id="4142229">writeFixedHeader</span><span class="op" id="4142245">(</span><span class="ident" id="4142246">eof</span><span class="op" id="4142249">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4142252">}</span>&nbsp;<span class="keyword" id="4142254">else</span>&nbsp;<span class="op" id="4142259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142263">w</span><span class="op" id="4142264">.</span><span class="ident" id="4142265">writeDynamicHeader</span><span class="op" id="4142283">(</span><span class="ident" id="4142284">numLiterals</span><span class="op" id="4142295">,</span>&nbsp;<span class="ident" id="4142297">numOffsets</span><span class="op" id="4142307">,</span>&nbsp;<span class="ident" id="4142309">numCodegens</span><span class="op" id="4142320">,</span>&nbsp;<span class="ident" id="4142322">eof</span><span class="op" id="4142325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4142328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142331">for</span>&nbsp;<span class="ident" id="4142335">_</span><span class="op" id="4142336">,</span>&nbsp;<span class="ident" id="4142338">t</span>&nbsp;<span class="op" id="4142340">:=</span>&nbsp;<span class="keyword" id="4142343">range</span>&nbsp;<span class="ident" id="4142349">tokens</span>&nbsp;<span class="op" id="4142356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142360">switch</span>&nbsp;<span class="ident" id="4142367">t</span><span class="op" id="4142368">.</span><span class="ident" id="4142369">typ</span><span class="op" id="4142372">(</span><span class="op" id="4142373">)</span>&nbsp;<span class="op" id="4142375">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142379">case</span>&nbsp;<span class="ident" id="4142384">literalType</span><span class="op" id="4142395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142400">w</span><span class="op" id="4142401">.</span><span class="ident" id="4142402">writeCode</span><span class="op" id="4142411">(</span><span class="ident" id="4142412">literalEncoding</span><span class="op" id="4142427">,</span>&nbsp;<span class="ident" id="4142429">t</span><span class="op" id="4142430">.</span><span class="ident" id="4142431">literal</span><span class="op" id="4142438">(</span><span class="op" id="4142439">)</span><span class="op" id="4142440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142445">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142453">case</span>&nbsp;<span class="ident" id="4142458">matchType</span><span class="op" id="4142467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142472">//&nbsp;Write&nbsp;the&nbsp;length</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142495">length</span>&nbsp;<span class="op" id="4142502">:=</span>&nbsp;<span class="ident" id="4142505">t</span><span class="op" id="4142506">.</span><span class="ident" id="4142507">length</span><span class="op" id="4142513">(</span><span class="op" id="4142514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142519">lengthCode</span>&nbsp;<span class="op" id="4142530">:=</span>&nbsp;<span class="ident" id="4142533">lengthCode</span><span class="op" id="4142543">(</span><span class="ident" id="4142544">length</span><span class="op" id="4142550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142555">w</span><span class="op" id="4142556">.</span><span class="ident" id="4142557">writeCode</span><span class="op" id="4142566">(</span><span class="ident" id="4142567">literalEncoding</span><span class="op" id="4142582">,</span>&nbsp;<span class="ident" id="4142584">lengthCode</span><span class="op" id="4142594">+</span><span class="ident" id="4142595">lengthCodesStart</span><span class="op" id="4142611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142616">extraLengthBits</span>&nbsp;<span class="op" id="4142632">:=</span>&nbsp;<span class="builtintype" id="4142635">int32</span><span class="op" id="4142640">(</span><span class="ident" id="4142641">lengthExtraBits</span><span class="op" id="4142656">[</span><span class="ident" id="4142657">lengthCode</span><span class="op" id="4142667">]</span><span class="op" id="4142668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142673">if</span>&nbsp;<span class="ident" id="4142676">extraLengthBits</span>&nbsp;<span class="op" id="4142692">&gt;</span>&nbsp;<span class="num" id="4142694">0</span>&nbsp;<span class="op" id="4142696">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142702">extraLength</span>&nbsp;<span class="op" id="4142714">:=</span>&nbsp;<span class="builtintype" id="4142717">int32</span><span class="op" id="4142722">(</span><span class="ident" id="4142723">length</span>&nbsp;<span class="op" id="4142730">-</span>&nbsp;<span class="ident" id="4142732">lengthBase</span><span class="op" id="4142742">[</span><span class="ident" id="4142743">lengthCode</span><span class="op" id="4142753">]</span><span class="op" id="4142754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142760">w</span><span class="op" id="4142761">.</span><span class="ident" id="4142762">writeBits</span><span class="op" id="4142771">(</span><span class="ident" id="4142772">extraLength</span><span class="op" id="4142783">,</span>&nbsp;<span class="ident" id="4142785">extraLengthBits</span><span class="op" id="4142800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4142805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4142810">//&nbsp;Write&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142833">offset</span>&nbsp;<span class="op" id="4142840">:=</span>&nbsp;<span class="ident" id="4142843">t</span><span class="op" id="4142844">.</span><span class="ident" id="4142845">offset</span><span class="op" id="4142851">(</span><span class="op" id="4142852">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142857">offsetCode</span>&nbsp;<span class="op" id="4142868">:=</span>&nbsp;<span class="ident" id="4142871">offsetCode</span><span class="op" id="4142881">(</span><span class="ident" id="4142882">offset</span><span class="op" id="4142888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142893">w</span><span class="op" id="4142894">.</span><span class="ident" id="4142895">writeCode</span><span class="op" id="4142904">(</span><span class="ident" id="4142905">offsetEncoding</span><span class="op" id="4142919">,</span>&nbsp;<span class="ident" id="4142921">offsetCode</span><span class="op" id="4142931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4142936">extraOffsetBits</span>&nbsp;<span class="op" id="4142952">:=</span>&nbsp;<span class="builtintype" id="4142955">int32</span><span class="op" id="4142960">(</span><span class="ident" id="4142961">offsetExtraBits</span><span class="op" id="4142976">[</span><span class="ident" id="4142977">offsetCode</span><span class="op" id="4142987">]</span><span class="op" id="4142988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4142993">if</span>&nbsp;<span class="ident" id="4142996">extraOffsetBits</span>&nbsp;<span class="op" id="4143012">&gt;</span>&nbsp;<span class="num" id="4143014">0</span>&nbsp;<span class="op" id="4143016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143022">extraOffset</span>&nbsp;<span class="op" id="4143034">:=</span>&nbsp;<span class="builtintype" id="4143037">int32</span><span class="op" id="4143042">(</span><span class="ident" id="4143043">offset</span>&nbsp;<span class="op" id="4143050">-</span>&nbsp;<span class="ident" id="4143052">offsetBase</span><span class="op" id="4143062">[</span><span class="ident" id="4143063">offsetCode</span><span class="op" id="4143073">]</span><span class="op" id="4143074">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4143080">w</span><span class="op" id="4143081">.</span><span class="ident" id="4143082">writeBits</span><span class="op" id="4143091">(</span><span class="ident" id="4143092">extraOffset</span><span class="op" id="4143103">,</span>&nbsp;<span class="ident" id="4143105">extraOffsetBits</span><span class="op" id="4143120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4143125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4143130">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4143138">default</span><span class="op" id="4143145">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4143150">panic</span><span class="op" id="4143155">(</span><span class="string" id="4143156">&#34;unknown&nbsp;token&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4143179">+</span>&nbsp;<span class="builtintype" id="4143181">string</span><span class="op" id="4143187">(</span><span class="ident" id="4143188">t</span><span class="op" id="4143189">)</span><span class="op" id="4143190">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4143194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4143197">}</span><br>
<span class="lineno"></span><span class="op" id="4143199">}</span>
</div>
</body>
</html>
