<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>internal/syscall</h2>
<ul>
<li><a href="/gostd/internal/syscall/getrandom_linux.go.html" class="current">getrandom_linux.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3690927">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3690983">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3691037">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3691088">package</span>&nbsp;<span class="ident" id="3691096">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3691105">import</span>&nbsp;<span class="op" id="3691112">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3691115">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3691126">&#34;sync/atomic&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3691141">stdsyscall</span>&nbsp;<span class="string" id="3691152">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3691163">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="3691172">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3691175">var</span>&nbsp;<span class="ident" id="3691179">randomTrap</span>&nbsp;<span class="op" id="3691190">=</span>&nbsp;<span class="keyword" id="3691192">map</span><span class="op" id="3691195">[</span><span class="builtintype" id="3691196">string</span><span class="op" id="3691202">]</span><span class="builtintype" id="3691203">uintptr</span><span class="op" id="3691210">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3691213">&#34;386&#34;</span><span class="op" id="3691218">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3691222">355</span><span class="op" id="3691225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3691228">&#34;amd64&#34;</span><span class="op" id="3691235">:</span>&nbsp;<span class="num" id="3691237">318</span><span class="op" id="3691240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3691243">&#34;arm&#34;</span><span class="op" id="3691248">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3691252">384</span><span class="op" id="3691255">,</span><br>
<span class="lineno"></span><span class="op" id="3691257">}</span><span class="op" id="3691258">[</span><span class="ident" id="3691259">runtime</span><span class="op" id="3691266">.</span><span class="ident" id="3691267">GOARCH</span><span class="op" id="3691273">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3691276">var</span>&nbsp;<span class="ident" id="3691280">randomUnsupported</span>&nbsp;<span class="builtintype" id="3691298">int32</span>&nbsp;<span class="comment" id="3691304">//&nbsp;atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3691315">//&nbsp;GetRandomFlag&nbsp;is&nbsp;a&nbsp;flag&nbsp;supported&nbsp;by&nbsp;the&nbsp;getrandom&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="3691382">type</span>&nbsp;<span class="ident" id="3691387">GetRandomFlag</span>&nbsp;<span class="builtintype" id="3691401">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3691410">const</span>&nbsp;<span class="op" id="3691416">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3691419">//&nbsp;GRND_NONBLOCK&nbsp;means&nbsp;return&nbsp;EAGAIN&nbsp;rather&nbsp;than&nbsp;blocking.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3691479">GRND_NONBLOCK</span>&nbsp;<span class="ident" id="3691493">GetRandomFlag</span>&nbsp;<span class="op" id="3691507">=</span>&nbsp;<span class="num" id="3691509">0x0001</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3691518">//&nbsp;GRND_RANDOM&nbsp;means&nbsp;use&nbsp;the&nbsp;/dev/random&nbsp;pool&nbsp;instead&nbsp;of&nbsp;/dev/urandom.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3691590">GRND_RANDOM</span>&nbsp;<span class="ident" id="3691602">GetRandomFlag</span>&nbsp;<span class="op" id="3691616">=</span>&nbsp;<span class="num" id="3691618">0x0002</span><br>
<span class="lineno"></span><span class="op" id="3691625">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3691628">//&nbsp;GetRandom&nbsp;calls&nbsp;the&nbsp;Linux&nbsp;getrandom&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="3691680">//&nbsp;See&nbsp;https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=c6e9d6f38894798696f23c8084ca7edbf16ee895</span><br>
<span class="lineno">35</span><span class="keyword" id="3691803">func</span>&nbsp;<span class="ident" id="3691808">GetRandom</span><span class="op" id="3691817">(</span><span class="ident" id="3691818">p</span>&nbsp;<span class="op" id="3691820">[</span><span class="op" id="3691821">]</span><span class="builtintype" id="3691822">byte</span><span class="op" id="3691826">,</span>&nbsp;<span class="ident" id="3691828">flags</span>&nbsp;<span class="ident" id="3691834">GetRandomFlag</span><span class="op" id="3691847">)</span>&nbsp;<span class="op" id="3691849">(</span><span class="ident" id="3691850">n</span>&nbsp;<span class="builtintype" id="3691852">int</span><span class="op" id="3691855">,</span>&nbsp;<span class="ident" id="3691857">err</span>&nbsp;<span class="builtintype" id="3691861">error</span><span class="op" id="3691866">)</span>&nbsp;<span class="op" id="3691868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3691871">if</span>&nbsp;<span class="ident" id="3691874">randomTrap</span>&nbsp;<span class="op" id="3691885">==</span>&nbsp;<span class="num" id="3691888">0</span>&nbsp;<span class="op" id="3691890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3691894">return</span>&nbsp;<span class="num" id="3691901">0</span><span class="op" id="3691902">,</span>&nbsp;<span class="ident" id="3691904">stdsyscall</span><span class="op" id="3691914">.</span><span class="ident" id="3691915">ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3691923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3691926">if</span>&nbsp;<span class="builtinfunc" id="3691929">len</span><span class="op" id="3691932">(</span><span class="ident" id="3691933">p</span><span class="op" id="3691934">)</span>&nbsp;<span class="op" id="3691936">==</span>&nbsp;<span class="num" id="3691939">0</span>&nbsp;<span class="op" id="3691941">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3691945">return</span>&nbsp;<span class="num" id="3691952">0</span><span class="op" id="3691953">,</span>&nbsp;<span class="ident" id="3691955">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3691960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3691963">if</span>&nbsp;<span class="ident" id="3691966">atomic</span><span class="op" id="3691972">.</span><span class="ident" id="3691973">LoadInt32</span><span class="op" id="3691982">(</span><span class="op" id="3691983">&amp;</span><span class="ident" id="3691984">randomUnsupported</span><span class="op" id="3692001">)</span>&nbsp;<span class="op" id="3692003">!=</span>&nbsp;<span class="num" id="3692006">0</span>&nbsp;<span class="op" id="3692008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3692012">return</span>&nbsp;<span class="num" id="3692019">0</span><span class="op" id="3692020">,</span>&nbsp;<span class="ident" id="3692022">stdsyscall</span><span class="op" id="3692032">.</span><span class="ident" id="3692033">ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3692041">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3692044">r1</span><span class="op" id="3692046">,</span>&nbsp;<span class="ident" id="3692048">_</span><span class="op" id="3692049">,</span>&nbsp;<span class="ident" id="3692051">errno</span>&nbsp;<span class="op" id="3692057">:=</span>&nbsp;<span class="ident" id="3692060">stdsyscall</span><span class="op" id="3692070">.</span><span class="ident" id="3692071">Syscall</span><span class="op" id="3692078">(</span><span class="ident" id="3692079">randomTrap</span><span class="op" id="3692089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3692093">uintptr</span><span class="op" id="3692100">(</span><span class="ident" id="3692101">unsafe</span><span class="op" id="3692107">.</span><span class="ident" id="3692108">Pointer</span><span class="op" id="3692115">(</span><span class="op" id="3692116">&amp;</span><span class="ident" id="3692117">p</span><span class="op" id="3692118">[</span><span class="num" id="3692119">0</span><span class="op" id="3692120">]</span><span class="op" id="3692121">)</span><span class="op" id="3692122">)</span><span class="op" id="3692123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3692127">uintptr</span><span class="op" id="3692134">(</span><span class="builtinfunc" id="3692135">len</span><span class="op" id="3692138">(</span><span class="ident" id="3692139">p</span><span class="op" id="3692140">)</span><span class="op" id="3692141">)</span><span class="op" id="3692142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3692146">uintptr</span><span class="op" id="3692153">(</span><span class="ident" id="3692154">flags</span><span class="op" id="3692159">)</span><span class="op" id="3692160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3692163">if</span>&nbsp;<span class="ident" id="3692166">errno</span>&nbsp;<span class="op" id="3692172">!=</span>&nbsp;<span class="num" id="3692175">0</span>&nbsp;<span class="op" id="3692177">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3692181">if</span>&nbsp;<span class="ident" id="3692184">errno</span>&nbsp;<span class="op" id="3692190">==</span>&nbsp;<span class="ident" id="3692193">stdsyscall</span><span class="op" id="3692203">.</span><span class="ident" id="3692204">ENOSYS</span>&nbsp;<span class="op" id="3692211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3692216">atomic</span><span class="op" id="3692222">.</span><span class="ident" id="3692223">StoreInt32</span><span class="op" id="3692233">(</span><span class="op" id="3692234">&amp;</span><span class="ident" id="3692235">randomUnsupported</span><span class="op" id="3692252">,</span>&nbsp;<span class="num" id="3692254">1</span><span class="op" id="3692255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3692259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3692263">return</span>&nbsp;<span class="num" id="3692270">0</span><span class="op" id="3692271">,</span>&nbsp;<span class="ident" id="3692273">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3692280">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3692283">return</span>&nbsp;<span class="builtintype" id="3692290">int</span><span class="op" id="3692293">(</span><span class="ident" id="3692294">r1</span><span class="op" id="3692296">)</span><span class="op" id="3692297">,</span>&nbsp;<span class="ident" id="3692299">nil</span><br>
<span class="lineno"></span><span class="op" id="3692303">}</span>
</div>
</body>
</html>
