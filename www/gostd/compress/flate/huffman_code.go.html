<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4278620">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4278675">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4278729">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4278780">package</span>&nbsp;<span class="ident" id="4278788">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4278795">import</span>&nbsp;<span class="op" id="4278802">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4278805">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4278813">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4278820">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4278823">type</span>&nbsp;<span class="ident" id="4278828">huffmanEncoder</span>&nbsp;<span class="keyword" id="4278843">struct</span>&nbsp;<span class="op" id="4278850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278853">codeBits</span>&nbsp;<span class="op" id="4278862">[</span><span class="op" id="4278863">]</span><span class="builtintype" id="4278864">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278871">code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4278880">[</span><span class="op" id="4278881">]</span><span class="builtintype" id="4278882">uint16</span><br>
<span class="lineno">15</span><span class="op" id="4278889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4278892">type</span>&nbsp;<span class="ident" id="4278897">literalNode</span>&nbsp;<span class="keyword" id="4278909">struct</span>&nbsp;<span class="op" id="4278916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278919">literal</span>&nbsp;<span class="builtintype" id="4278927">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278935">freq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4278943">int32</span><br>
<span class="lineno">20</span><span class="op" id="4278949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4278952">//&nbsp;A&nbsp;levelInfo&nbsp;describes&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;constructed&nbsp;tree&nbsp;for&nbsp;a&nbsp;given&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="4279030">type</span>&nbsp;<span class="ident" id="4279035">levelInfo</span>&nbsp;<span class="keyword" id="4279045">struct</span>&nbsp;<span class="op" id="4279052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4279055">//&nbsp;Our&nbsp;level.&nbsp;&nbsp;for&nbsp;better&nbsp;printing</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279091">level</span>&nbsp;<span class="builtintype" id="4279097">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4279105">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;last&nbsp;node&nbsp;at&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279154">lastFreq</span>&nbsp;<span class="builtintype" id="4279163">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4279171">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;character&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279232">nextCharFreq</span>&nbsp;<span class="builtintype" id="4279245">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4279253">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;pair&nbsp;(from&nbsp;level&nbsp;below)&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4279329">//&nbsp;Only&nbsp;valid&nbsp;if&nbsp;the&nbsp;&#34;needed&#34;&nbsp;value&nbsp;of&nbsp;the&nbsp;next&nbsp;lower&nbsp;level&nbsp;is&nbsp;0.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279396">nextPairFreq</span>&nbsp;<span class="builtintype" id="4279409">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4279417">//&nbsp;The&nbsp;number&nbsp;of&nbsp;chains&nbsp;remaining&nbsp;to&nbsp;generate&nbsp;for&nbsp;this&nbsp;level&nbsp;before&nbsp;moving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4279493">//&nbsp;up&nbsp;to&nbsp;the&nbsp;next&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279518">needed</span>&nbsp;<span class="builtintype" id="4279525">int32</span><br>
<span class="lineno">40</span><span class="op" id="4279531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4279534">func</span>&nbsp;<span class="ident" id="4279539">maxNode</span><span class="op" id="4279546">(</span><span class="op" id="4279547">)</span>&nbsp;<span class="ident" id="4279549">literalNode</span>&nbsp;<span class="op" id="4279561">{</span>&nbsp;<span class="keyword" id="4279563">return</span>&nbsp;<span class="ident" id="4279570">literalNode</span><span class="op" id="4279581">{</span><span class="ident" id="4279582">math</span><span class="op" id="4279586">.</span><span class="ident" id="4279587">MaxUint16</span><span class="op" id="4279596">,</span>&nbsp;<span class="ident" id="4279598">math</span><span class="op" id="4279602">.</span><span class="ident" id="4279603">MaxInt32</span><span class="op" id="4279611">}</span>&nbsp;<span class="op" id="4279613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4279616">func</span>&nbsp;<span class="ident" id="4279621">newHuffmanEncoder</span><span class="op" id="4279638">(</span><span class="ident" id="4279639">size</span>&nbsp;<span class="builtintype" id="4279644">int</span><span class="op" id="4279647">)</span>&nbsp;<span class="op" id="4279649">*</span><span class="ident" id="4279650">huffmanEncoder</span>&nbsp;<span class="op" id="4279665">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279668">return</span>&nbsp;<span class="op" id="4279675">&amp;</span><span class="ident" id="4279676">huffmanEncoder</span><span class="op" id="4279690">{</span><span class="builtinfunc" id="4279691">make</span><span class="op" id="4279695">(</span><span class="op" id="4279696">[</span><span class="op" id="4279697">]</span><span class="builtintype" id="4279698">uint8</span><span class="op" id="4279703">,</span>&nbsp;<span class="ident" id="4279705">size</span><span class="op" id="4279709">)</span><span class="op" id="4279710">,</span>&nbsp;<span class="builtinfunc" id="4279712">make</span><span class="op" id="4279716">(</span><span class="op" id="4279717">[</span><span class="op" id="4279718">]</span><span class="builtintype" id="4279719">uint16</span><span class="op" id="4279725">,</span>&nbsp;<span class="ident" id="4279727">size</span><span class="op" id="4279731">)</span><span class="op" id="4279732">}</span><br>
<span class="lineno"></span><span class="op" id="4279734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4279737">//&nbsp;Generates&nbsp;a&nbsp;HuffmanCode&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;fixed&nbsp;literal&nbsp;table</span><br>
<span class="lineno"></span><span class="keyword" id="4279805">func</span>&nbsp;<span class="ident" id="4279810">generateFixedLiteralEncoding</span><span class="op" id="4279838">(</span><span class="op" id="4279839">)</span>&nbsp;<span class="op" id="4279841">*</span><span class="ident" id="4279842">huffmanEncoder</span>&nbsp;<span class="op" id="4279857">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279860">h</span>&nbsp;<span class="op" id="4279862">:=</span>&nbsp;<span class="ident" id="4279865">newHuffmanEncoder</span><span class="op" id="4279882">(</span><span class="ident" id="4279883">maxLit</span><span class="op" id="4279889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279892">codeBits</span>&nbsp;<span class="op" id="4279901">:=</span>&nbsp;<span class="ident" id="4279904">h</span><span class="op" id="4279905">.</span><span class="ident" id="4279906">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279916">code</span>&nbsp;<span class="op" id="4279921">:=</span>&nbsp;<span class="ident" id="4279924">h</span><span class="op" id="4279925">.</span><span class="ident" id="4279926">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279932">var</span>&nbsp;<span class="ident" id="4279936">ch</span>&nbsp;<span class="builtintype" id="4279939">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279947">for</span>&nbsp;<span class="ident" id="4279951">ch</span>&nbsp;<span class="op" id="4279954">=</span>&nbsp;<span class="num" id="4279956">0</span><span class="op" id="4279957">;</span>&nbsp;<span class="ident" id="4279959">ch</span>&nbsp;<span class="op" id="4279962">&lt;</span>&nbsp;<span class="ident" id="4279964">maxLit</span><span class="op" id="4279970">;</span>&nbsp;<span class="ident" id="4279972">ch</span><span class="op" id="4279974">++</span>&nbsp;<span class="op" id="4279977">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279981">var</span>&nbsp;<span class="ident" id="4279985">bits</span>&nbsp;<span class="builtintype" id="4279990">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279999">var</span>&nbsp;<span class="ident" id="4280003">size</span>&nbsp;<span class="builtintype" id="4280008">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280016">switch</span>&nbsp;<span class="op" id="4280023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280027">case</span>&nbsp;<span class="ident" id="4280032">ch</span>&nbsp;<span class="op" id="4280035">&lt;</span>&nbsp;<span class="num" id="4280037">144</span><span class="op" id="4280040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4280045">//&nbsp;size&nbsp;8,&nbsp;000110000&nbsp;&nbsp;..&nbsp;10111111</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280082">bits</span>&nbsp;<span class="op" id="4280087">=</span>&nbsp;<span class="ident" id="4280089">ch</span>&nbsp;<span class="op" id="4280092">+</span>&nbsp;<span class="num" id="4280094">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280100">size</span>&nbsp;<span class="op" id="4280105">=</span>&nbsp;<span class="num" id="4280107">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280112">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280120">case</span>&nbsp;<span class="ident" id="4280125">ch</span>&nbsp;<span class="op" id="4280128">&lt;</span>&nbsp;<span class="num" id="4280130">256</span><span class="op" id="4280133">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4280138">//&nbsp;size&nbsp;9,&nbsp;110010000&nbsp;..&nbsp;111111111</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280175">bits</span>&nbsp;<span class="op" id="4280180">=</span>&nbsp;<span class="ident" id="4280182">ch</span>&nbsp;<span class="op" id="4280185">+</span>&nbsp;<span class="num" id="4280187">400</span>&nbsp;<span class="op" id="4280191">-</span>&nbsp;<span class="num" id="4280193">144</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280200">size</span>&nbsp;<span class="op" id="4280205">=</span>&nbsp;<span class="num" id="4280207">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280212">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280220">case</span>&nbsp;<span class="ident" id="4280225">ch</span>&nbsp;<span class="op" id="4280228">&lt;</span>&nbsp;<span class="num" id="4280230">280</span><span class="op" id="4280233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4280238">//&nbsp;size&nbsp;7,&nbsp;0000000&nbsp;..&nbsp;0010111</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280271">bits</span>&nbsp;<span class="op" id="4280276">=</span>&nbsp;<span class="ident" id="4280278">ch</span>&nbsp;<span class="op" id="4280281">-</span>&nbsp;<span class="num" id="4280283">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280290">size</span>&nbsp;<span class="op" id="4280295">=</span>&nbsp;<span class="num" id="4280297">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280302">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280310">default</span><span class="op" id="4280317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4280322">//&nbsp;size&nbsp;8,&nbsp;11000000&nbsp;..&nbsp;11000111</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280357">bits</span>&nbsp;<span class="op" id="4280362">=</span>&nbsp;<span class="ident" id="4280364">ch</span>&nbsp;<span class="op" id="4280367">+</span>&nbsp;<span class="num" id="4280369">192</span>&nbsp;<span class="op" id="4280373">-</span>&nbsp;<span class="num" id="4280375">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280382">size</span>&nbsp;<span class="op" id="4280387">=</span>&nbsp;<span class="num" id="4280389">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280397">codeBits</span><span class="op" id="4280405">[</span><span class="ident" id="4280406">ch</span><span class="op" id="4280408">]</span>&nbsp;<span class="op" id="4280410">=</span>&nbsp;<span class="ident" id="4280412">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280419">code</span><span class="op" id="4280423">[</span><span class="ident" id="4280424">ch</span><span class="op" id="4280426">]</span>&nbsp;<span class="op" id="4280428">=</span>&nbsp;<span class="ident" id="4280430">reverseBits</span><span class="op" id="4280441">(</span><span class="ident" id="4280442">bits</span><span class="op" id="4280446">,</span>&nbsp;<span class="ident" id="4280448">size</span><span class="op" id="4280452">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280458">return</span>&nbsp;<span class="ident" id="4280465">h</span><br>
<span class="lineno"></span><span class="op" id="4280467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4280470">func</span>&nbsp;<span class="ident" id="4280475">generateFixedOffsetEncoding</span><span class="op" id="4280502">(</span><span class="op" id="4280503">)</span>&nbsp;<span class="op" id="4280505">*</span><span class="ident" id="4280506">huffmanEncoder</span>&nbsp;<span class="op" id="4280521">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280524">h</span>&nbsp;<span class="op" id="4280526">:=</span>&nbsp;<span class="ident" id="4280529">newHuffmanEncoder</span><span class="op" id="4280546">(</span><span class="num" id="4280547">30</span><span class="op" id="4280549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280552">codeBits</span>&nbsp;<span class="op" id="4280561">:=</span>&nbsp;<span class="ident" id="4280564">h</span><span class="op" id="4280565">.</span><span class="ident" id="4280566">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280576">code</span>&nbsp;<span class="op" id="4280581">:=</span>&nbsp;<span class="ident" id="4280584">h</span><span class="op" id="4280585">.</span><span class="ident" id="4280586">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280592">for</span>&nbsp;<span class="ident" id="4280596">ch</span>&nbsp;<span class="op" id="4280599">:=</span>&nbsp;<span class="builtintype" id="4280602">uint16</span><span class="op" id="4280608">(</span><span class="num" id="4280609">0</span><span class="op" id="4280610">)</span><span class="op" id="4280611">;</span>&nbsp;<span class="ident" id="4280613">ch</span>&nbsp;<span class="op" id="4280616">&lt;</span>&nbsp;<span class="num" id="4280618">30</span><span class="op" id="4280620">;</span>&nbsp;<span class="ident" id="4280622">ch</span><span class="op" id="4280624">++</span>&nbsp;<span class="op" id="4280627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280631">codeBits</span><span class="op" id="4280639">[</span><span class="ident" id="4280640">ch</span><span class="op" id="4280642">]</span>&nbsp;<span class="op" id="4280644">=</span>&nbsp;<span class="num" id="4280646">5</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280650">code</span><span class="op" id="4280654">[</span><span class="ident" id="4280655">ch</span><span class="op" id="4280657">]</span>&nbsp;<span class="op" id="4280659">=</span>&nbsp;<span class="ident" id="4280661">reverseBits</span><span class="op" id="4280672">(</span><span class="ident" id="4280673">ch</span><span class="op" id="4280675">,</span>&nbsp;<span class="num" id="4280677">5</span><span class="op" id="4280678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4280681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280684">return</span>&nbsp;<span class="ident" id="4280691">h</span><br>
<span class="lineno"></span><span class="op" id="4280693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4280696">var</span>&nbsp;<span class="ident" id="4280700">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4280721">*</span><span class="ident" id="4280722">huffmanEncoder</span>&nbsp;<span class="op" id="4280737">=</span>&nbsp;<span class="ident" id="4280739">generateFixedLiteralEncoding</span><span class="op" id="4280767">(</span><span class="op" id="4280768">)</span><br>
<span class="lineno"></span><span class="keyword" id="4280770">var</span>&nbsp;<span class="ident" id="4280774">fixedOffsetEncoding</span>&nbsp;<span class="op" id="4280794">*</span><span class="ident" id="4280795">huffmanEncoder</span>&nbsp;<span class="op" id="4280810">=</span>&nbsp;<span class="ident" id="4280812">generateFixedOffsetEncoding</span><span class="op" id="4280839">(</span><span class="op" id="4280840">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4280843">func</span>&nbsp;<span class="op" id="4280848">(</span><span class="ident" id="4280849">h</span>&nbsp;<span class="op" id="4280851">*</span><span class="ident" id="4280852">huffmanEncoder</span><span class="op" id="4280866">)</span>&nbsp;<span class="ident" id="4280868">bitLength</span><span class="op" id="4280877">(</span><span class="ident" id="4280878">freq</span>&nbsp;<span class="op" id="4280883">[</span><span class="op" id="4280884">]</span><span class="builtintype" id="4280885">int32</span><span class="op" id="4280890">)</span>&nbsp;<span class="ident" id="4280892">int64</span>&nbsp;<span class="op" id="4280898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280901">var</span>&nbsp;<span class="ident" id="4280905">total</span>&nbsp;<span class="ident" id="4280911">int64</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280918">for</span>&nbsp;<span class="ident" id="4280922">i</span><span class="op" id="4280923">,</span>&nbsp;<span class="ident" id="4280925">f</span>&nbsp;<span class="op" id="4280927">:=</span>&nbsp;<span class="keyword" id="4280930">range</span>&nbsp;<span class="ident" id="4280936">freq</span>&nbsp;<span class="op" id="4280941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4280945">if</span>&nbsp;<span class="ident" id="4280948">f</span>&nbsp;<span class="op" id="4280950">!=</span>&nbsp;<span class="num" id="4280953">0</span>&nbsp;<span class="op" id="4280955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4280960">total</span>&nbsp;<span class="op" id="4280966">+=</span>&nbsp;<span class="ident" id="4280969">int64</span><span class="op" id="4280974">(</span><span class="ident" id="4280975">f</span><span class="op" id="4280976">)</span>&nbsp;<span class="op" id="4280978">*</span>&nbsp;<span class="ident" id="4280980">int64</span><span class="op" id="4280985">(</span><span class="ident" id="4280986">h</span><span class="op" id="4280987">.</span><span class="ident" id="4280988">codeBits</span><span class="op" id="4280996">[</span><span class="ident" id="4280997">i</span><span class="op" id="4280998">]</span><span class="op" id="4280999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281006">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281009">return</span>&nbsp;<span class="ident" id="4281016">total</span><br>
<span class="lineno"></span><span class="op" id="4281022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4281025">const</span>&nbsp;<span class="ident" id="4281031">maxBitsLimit</span>&nbsp;<span class="op" id="4281044">=</span>&nbsp;<span class="num" id="4281046">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="4281050">//&nbsp;Return&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;assigned&nbsp;to&nbsp;each&nbsp;bit&nbsp;size&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="4281133">//</span><br>
<span class="lineno"></span><span class="comment" id="4281136">//&nbsp;This&nbsp;method&nbsp;is&nbsp;only&nbsp;called&nbsp;when&nbsp;list.length&nbsp;&gt;=&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="4281188">//&nbsp;The&nbsp;cases&nbsp;of&nbsp;0,&nbsp;1,&nbsp;and&nbsp;2&nbsp;literals&nbsp;are&nbsp;handled&nbsp;by&nbsp;special&nbsp;case&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4281259">//</span><br>
<span class="lineno">115</span><span class="comment" id="4281262">//&nbsp;list&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;the&nbsp;literals&nbsp;with&nbsp;non-zero&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4281322">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;their&nbsp;associated&nbsp;frequencies.&nbsp;&nbsp;The&nbsp;array&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing</span><br>
<span class="lineno"></span><span class="comment" id="4281408">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frequency,&nbsp;and&nbsp;has&nbsp;as&nbsp;its&nbsp;last&nbsp;element&nbsp;a&nbsp;special&nbsp;element&nbsp;with&nbsp;frequency</span><br>
<span class="lineno"></span><span class="comment" id="4281495">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxInt32</span><br>
<span class="lineno"></span><span class="comment" id="4281519">//&nbsp;maxBits&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;that&nbsp;should&nbsp;be&nbsp;used&nbsp;to&nbsp;encode&nbsp;any&nbsp;literal.</span><br>
<span class="lineno">120</span><span class="comment" id="4281604">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;be&nbsp;less&nbsp;than&nbsp;16.</span><br>
<span class="lineno"></span><span class="comment" id="4281641">//&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An&nbsp;integer&nbsp;array&nbsp;in&nbsp;which&nbsp;array[i]&nbsp;indicates&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span><span class="comment" id="4281724">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;should&nbsp;be&nbsp;encoded&nbsp;in&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4281773">func</span>&nbsp;<span class="op" id="4281778">(</span><span class="ident" id="4281779">h</span>&nbsp;<span class="op" id="4281781">*</span><span class="ident" id="4281782">huffmanEncoder</span><span class="op" id="4281796">)</span>&nbsp;<span class="ident" id="4281798">bitCounts</span><span class="op" id="4281807">(</span><span class="ident" id="4281808">list</span>&nbsp;<span class="op" id="4281813">[</span><span class="op" id="4281814">]</span><span class="ident" id="4281815">literalNode</span><span class="op" id="4281826">,</span>&nbsp;<span class="ident" id="4281828">maxBits</span>&nbsp;<span class="builtintype" id="4281836">int32</span><span class="op" id="4281841">)</span>&nbsp;<span class="op" id="4281843">[</span><span class="op" id="4281844">]</span><span class="builtintype" id="4281845">int32</span>&nbsp;<span class="op" id="4281851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4281854">if</span>&nbsp;<span class="ident" id="4281857">maxBits</span>&nbsp;<span class="op" id="4281865">&gt;=</span>&nbsp;<span class="ident" id="4281868">maxBitsLimit</span>&nbsp;<span class="op" id="4281881">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4281885">panic</span><span class="op" id="4281890">(</span><span class="string" id="4281891">&#34;flate:&nbsp;maxBits&nbsp;too&nbsp;large&#34;</span><span class="op" id="4281917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4281920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281923">n</span>&nbsp;<span class="op" id="4281925">:=</span>&nbsp;<span class="builtintype" id="4281928">int32</span><span class="op" id="4281933">(</span><span class="builtinfunc" id="4281934">len</span><span class="op" id="4281937">(</span><span class="ident" id="4281938">list</span><span class="op" id="4281942">)</span><span class="op" id="4281943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281946">list</span>&nbsp;<span class="op" id="4281951">=</span>&nbsp;<span class="ident" id="4281953">list</span><span class="op" id="4281957">[</span><span class="num" id="4281958">0</span>&nbsp;<span class="op" id="4281960">:</span>&nbsp;<span class="ident" id="4281962">n</span><span class="op" id="4281963">+</span><span class="num" id="4281964">1</span><span class="op" id="4281965">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4281968">list</span><span class="op" id="4281972">[</span><span class="ident" id="4281973">n</span><span class="op" id="4281974">]</span>&nbsp;<span class="op" id="4281976">=</span>&nbsp;<span class="ident" id="4281978">maxNode</span><span class="op" id="4281985">(</span><span class="op" id="4281986">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4281990">//&nbsp;The&nbsp;tree&nbsp;can&#39;t&nbsp;have&nbsp;greater&nbsp;depth&nbsp;than&nbsp;n&nbsp;-&nbsp;1,&nbsp;no&nbsp;matter&nbsp;what.&nbsp;&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282062">//&nbsp;saves&nbsp;a&nbsp;little&nbsp;bit&nbsp;of&nbsp;work&nbsp;in&nbsp;some&nbsp;small&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282113">if</span>&nbsp;<span class="ident" id="4282116">maxBits</span>&nbsp;<span class="op" id="4282124">&gt;</span>&nbsp;<span class="ident" id="4282126">n</span><span class="op" id="4282127">-</span><span class="num" id="4282128">1</span>&nbsp;<span class="op" id="4282130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282134">maxBits</span>&nbsp;<span class="op" id="4282142">=</span>&nbsp;<span class="ident" id="4282144">n</span>&nbsp;<span class="op" id="4282146">-</span>&nbsp;<span class="num" id="4282148">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4282151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282155">//&nbsp;Create&nbsp;information&nbsp;about&nbsp;each&nbsp;of&nbsp;the&nbsp;levels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282204">//&nbsp;A&nbsp;bogus&nbsp;&#34;Level&nbsp;0&#34;&nbsp;whose&nbsp;sole&nbsp;purpose&nbsp;is&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282256">//&nbsp;level1.prev.needed==0.&nbsp;&nbsp;This&nbsp;makes&nbsp;level1.nextPairFreq</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282315">//&nbsp;be&nbsp;a&nbsp;legitimate&nbsp;value&nbsp;that&nbsp;never&nbsp;gets&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282365">var</span>&nbsp;<span class="ident" id="4282369">levels</span>&nbsp;<span class="op" id="4282376">[</span><span class="ident" id="4282377">maxBitsLimit</span><span class="op" id="4282389">]</span><span class="ident" id="4282390">levelInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282401">//&nbsp;leafCounts[i]&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282461">//&nbsp;of&nbsp;ancestors&nbsp;of&nbsp;the&nbsp;rightmost&nbsp;node&nbsp;at&nbsp;level&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282512">//&nbsp;leafCounts[i][j]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282571">//&nbsp;of&nbsp;the&nbsp;level&nbsp;j&nbsp;ancestor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282600">var</span>&nbsp;<span class="ident" id="4282604">leafCounts</span>&nbsp;<span class="op" id="4282615">[</span><span class="ident" id="4282616">maxBitsLimit</span><span class="op" id="4282628">]</span><span class="op" id="4282629">[</span><span class="ident" id="4282630">maxBitsLimit</span><span class="op" id="4282642">]</span><span class="builtintype" id="4282643">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4282651">for</span>&nbsp;<span class="ident" id="4282655">level</span>&nbsp;<span class="op" id="4282661">:=</span>&nbsp;<span class="builtintype" id="4282664">int32</span><span class="op" id="4282669">(</span><span class="num" id="4282670">1</span><span class="op" id="4282671">)</span><span class="op" id="4282672">;</span>&nbsp;<span class="ident" id="4282674">level</span>&nbsp;<span class="op" id="4282680">&lt;=</span>&nbsp;<span class="ident" id="4282683">maxBits</span><span class="op" id="4282690">;</span>&nbsp;<span class="ident" id="4282692">level</span><span class="op" id="4282697">++</span>&nbsp;<span class="op" id="4282700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282704">//&nbsp;For&nbsp;every&nbsp;level,&nbsp;the&nbsp;first&nbsp;two&nbsp;items&nbsp;are&nbsp;the&nbsp;first&nbsp;two&nbsp;characters.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4282776">//&nbsp;We&nbsp;initialize&nbsp;the&nbsp;levels&nbsp;as&nbsp;if&nbsp;we&nbsp;had&nbsp;already&nbsp;figured&nbsp;this&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282845">levels</span><span class="op" id="4282851">[</span><span class="ident" id="4282852">level</span><span class="op" id="4282857">]</span>&nbsp;<span class="op" id="4282859">=</span>&nbsp;<span class="ident" id="4282861">levelInfo</span><span class="op" id="4282870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282875">level</span><span class="op" id="4282880">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282889">level</span><span class="op" id="4282894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282899">lastFreq</span><span class="op" id="4282907">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282913">list</span><span class="op" id="4282917">[</span><span class="num" id="4282918">1</span><span class="op" id="4282919">]</span><span class="op" id="4282920">.</span><span class="ident" id="4282921">freq</span><span class="op" id="4282925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282930">nextCharFreq</span><span class="op" id="4282942">:</span>&nbsp;<span class="ident" id="4282944">list</span><span class="op" id="4282948">[</span><span class="num" id="4282949">2</span><span class="op" id="4282950">]</span><span class="op" id="4282951">.</span><span class="ident" id="4282952">freq</span><span class="op" id="4282956">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4282961">nextPairFreq</span><span class="op" id="4282973">:</span>&nbsp;<span class="ident" id="4282975">list</span><span class="op" id="4282979">[</span><span class="num" id="4282980">0</span><span class="op" id="4282981">]</span><span class="op" id="4282982">.</span><span class="ident" id="4282983">freq</span>&nbsp;<span class="op" id="4282988">+</span>&nbsp;<span class="ident" id="4282990">list</span><span class="op" id="4282994">[</span><span class="num" id="4282995">1</span><span class="op" id="4282996">]</span><span class="op" id="4282997">.</span><span class="ident" id="4282998">freq</span><span class="op" id="4283002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283010">leafCounts</span><span class="op" id="4283020">[</span><span class="ident" id="4283021">level</span><span class="op" id="4283026">]</span><span class="op" id="4283027">[</span><span class="ident" id="4283028">level</span><span class="op" id="4283033">]</span>&nbsp;<span class="op" id="4283035">=</span>&nbsp;<span class="num" id="4283037">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283041">if</span>&nbsp;<span class="ident" id="4283044">level</span>&nbsp;<span class="op" id="4283050">==</span>&nbsp;<span class="num" id="4283053">1</span>&nbsp;<span class="op" id="4283055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283060">levels</span><span class="op" id="4283066">[</span><span class="ident" id="4283067">level</span><span class="op" id="4283072">]</span><span class="op" id="4283073">.</span><span class="ident" id="4283074">nextPairFreq</span>&nbsp;<span class="op" id="4283087">=</span>&nbsp;<span class="ident" id="4283089">math</span><span class="op" id="4283093">.</span><span class="ident" id="4283094">MaxInt32</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4283112">//&nbsp;We&nbsp;need&nbsp;a&nbsp;total&nbsp;of&nbsp;2*n&nbsp;-&nbsp;2&nbsp;items&nbsp;at&nbsp;top&nbsp;level&nbsp;and&nbsp;have&nbsp;already&nbsp;generated&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283192">levels</span><span class="op" id="4283198">[</span><span class="ident" id="4283199">maxBits</span><span class="op" id="4283206">]</span><span class="op" id="4283207">.</span><span class="ident" id="4283208">needed</span>&nbsp;<span class="op" id="4283215">=</span>&nbsp;<span class="num" id="4283217">2</span><span class="op" id="4283218">*</span><span class="ident" id="4283219">n</span>&nbsp;<span class="op" id="4283221">-</span>&nbsp;<span class="num" id="4283223">4</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283227">level</span>&nbsp;<span class="op" id="4283233">:=</span>&nbsp;<span class="ident" id="4283236">maxBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283245">for</span>&nbsp;<span class="op" id="4283249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283253">l</span>&nbsp;<span class="op" id="4283255">:=</span>&nbsp;<span class="op" id="4283258">&amp;</span><span class="ident" id="4283259">levels</span><span class="op" id="4283265">[</span><span class="ident" id="4283266">level</span><span class="op" id="4283271">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283275">if</span>&nbsp;<span class="ident" id="4283278">l</span><span class="op" id="4283279">.</span><span class="ident" id="4283280">nextPairFreq</span>&nbsp;<span class="op" id="4283293">==</span>&nbsp;<span class="ident" id="4283296">math</span><span class="op" id="4283300">.</span><span class="ident" id="4283301">MaxInt32</span>&nbsp;<span class="op" id="4283310">&amp;&amp;</span>&nbsp;<span class="ident" id="4283313">l</span><span class="op" id="4283314">.</span><span class="ident" id="4283315">nextCharFreq</span>&nbsp;<span class="op" id="4283328">==</span>&nbsp;<span class="ident" id="4283331">math</span><span class="op" id="4283335">.</span><span class="ident" id="4283336">MaxInt32</span>&nbsp;<span class="op" id="4283345">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4283350">//&nbsp;We&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;both&nbsp;leafs&nbsp;and&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4283395">//&nbsp;End&nbsp;all&nbsp;calculations&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4283438">//&nbsp;To&nbsp;make&nbsp;sure&nbsp;we&nbsp;never&nbsp;come&nbsp;back&nbsp;to&nbsp;this&nbsp;level&nbsp;or&nbsp;any&nbsp;lower&nbsp;level,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4283510">//&nbsp;set&nbsp;nextPairFreq&nbsp;impossibly&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283551">l</span><span class="op" id="4283552">.</span><span class="ident" id="4283553">needed</span>&nbsp;<span class="op" id="4283560">=</span>&nbsp;<span class="num" id="4283562">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283567">levels</span><span class="op" id="4283573">[</span><span class="ident" id="4283574">level</span><span class="op" id="4283579">+</span><span class="num" id="4283580">1</span><span class="op" id="4283581">]</span><span class="op" id="4283582">.</span><span class="ident" id="4283583">nextPairFreq</span>&nbsp;<span class="op" id="4283596">=</span>&nbsp;<span class="ident" id="4283598">math</span><span class="op" id="4283602">.</span><span class="ident" id="4283603">MaxInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283615">level</span><span class="op" id="4283620">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283626">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283642">prevFreq</span>&nbsp;<span class="op" id="4283651">:=</span>&nbsp;<span class="ident" id="4283654">l</span><span class="op" id="4283655">.</span><span class="ident" id="4283656">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4283667">if</span>&nbsp;<span class="ident" id="4283670">l</span><span class="op" id="4283671">.</span><span class="ident" id="4283672">nextCharFreq</span>&nbsp;<span class="op" id="4283685">&lt;</span>&nbsp;<span class="ident" id="4283687">l</span><span class="op" id="4283688">.</span><span class="ident" id="4283689">nextPairFreq</span>&nbsp;<span class="op" id="4283702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4283707">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;leaf&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283755">n</span>&nbsp;<span class="op" id="4283757">:=</span>&nbsp;<span class="ident" id="4283760">leafCounts</span><span class="op" id="4283770">[</span><span class="ident" id="4283771">level</span><span class="op" id="4283776">]</span><span class="op" id="4283777">[</span><span class="ident" id="4283778">level</span><span class="op" id="4283783">]</span>&nbsp;<span class="op" id="4283785">+</span>&nbsp;<span class="num" id="4283787">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283792">l</span><span class="op" id="4283793">.</span><span class="ident" id="4283794">lastFreq</span>&nbsp;<span class="op" id="4283803">=</span>&nbsp;<span class="ident" id="4283805">l</span><span class="op" id="4283806">.</span><span class="ident" id="4283807">nextCharFreq</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4283823">//&nbsp;Lower&nbsp;leafCounts&nbsp;are&nbsp;the&nbsp;same&nbsp;of&nbsp;the&nbsp;previous&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283881">leafCounts</span><span class="op" id="4283891">[</span><span class="ident" id="4283892">level</span><span class="op" id="4283897">]</span><span class="op" id="4283898">[</span><span class="ident" id="4283899">level</span><span class="op" id="4283904">]</span>&nbsp;<span class="op" id="4283906">=</span>&nbsp;<span class="ident" id="4283908">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4283913">l</span><span class="op" id="4283914">.</span><span class="ident" id="4283915">nextCharFreq</span>&nbsp;<span class="op" id="4283928">=</span>&nbsp;<span class="ident" id="4283930">list</span><span class="op" id="4283934">[</span><span class="ident" id="4283935">n</span><span class="op" id="4283936">]</span><span class="op" id="4283937">.</span><span class="ident" id="4283938">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4283945">}</span>&nbsp;<span class="keyword" id="4283947">else</span>&nbsp;<span class="op" id="4283952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4283957">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;pair&nbsp;from&nbsp;the&nbsp;previous&nbsp;row.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284022">//&nbsp;nextPairFreq&nbsp;isn&#39;t&nbsp;valid&nbsp;until&nbsp;we&nbsp;generate&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284075">//&nbsp;more&nbsp;values&nbsp;in&nbsp;the&nbsp;level&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284112">l</span><span class="op" id="4284113">.</span><span class="ident" id="4284114">lastFreq</span>&nbsp;<span class="op" id="4284123">=</span>&nbsp;<span class="ident" id="4284125">l</span><span class="op" id="4284126">.</span><span class="ident" id="4284127">nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284143">//&nbsp;Take&nbsp;leaf&nbsp;counts&nbsp;from&nbsp;the&nbsp;lower&nbsp;level,&nbsp;except&nbsp;counts[level]&nbsp;remains&nbsp;the&nbsp;same.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4284227">copy</span><span class="op" id="4284231">(</span><span class="ident" id="4284232">leafCounts</span><span class="op" id="4284242">[</span><span class="ident" id="4284243">level</span><span class="op" id="4284248">]</span><span class="op" id="4284249">[</span><span class="op" id="4284250">:</span><span class="ident" id="4284251">level</span><span class="op" id="4284256">]</span><span class="op" id="4284257">,</span>&nbsp;<span class="ident" id="4284259">leafCounts</span><span class="op" id="4284269">[</span><span class="ident" id="4284270">level</span><span class="op" id="4284275">-</span><span class="num" id="4284276">1</span><span class="op" id="4284277">]</span><span class="op" id="4284278">[</span><span class="op" id="4284279">:</span><span class="ident" id="4284280">level</span><span class="op" id="4284285">]</span><span class="op" id="4284286">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284291">levels</span><span class="op" id="4284297">[</span><span class="ident" id="4284298">l</span><span class="op" id="4284299">.</span><span class="ident" id="4284300">level</span><span class="op" id="4284305">-</span><span class="num" id="4284306">1</span><span class="op" id="4284307">]</span><span class="op" id="4284308">.</span><span class="ident" id="4284309">needed</span>&nbsp;<span class="op" id="4284316">=</span>&nbsp;<span class="num" id="4284318">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284327">if</span>&nbsp;<span class="ident" id="4284330">l</span><span class="op" id="4284331">.</span><span class="ident" id="4284332">needed</span><span class="op" id="4284338">--</span><span class="op" id="4284340">;</span>&nbsp;<span class="ident" id="4284342">l</span><span class="op" id="4284343">.</span><span class="ident" id="4284344">needed</span>&nbsp;<span class="op" id="4284351">==</span>&nbsp;<span class="num" id="4284354">0</span>&nbsp;<span class="op" id="4284356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284361">//&nbsp;We&#39;ve&nbsp;done&nbsp;everything&nbsp;we&nbsp;need&nbsp;to&nbsp;do&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284419">//&nbsp;Continue&nbsp;calculating&nbsp;one&nbsp;level&nbsp;up.&nbsp;&nbsp;Fill&nbsp;in&nbsp;nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284482">//&nbsp;of&nbsp;that&nbsp;level&nbsp;with&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;two&nbsp;nodes&nbsp;we&#39;ve&nbsp;just&nbsp;calculated&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284557">//&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284575">if</span>&nbsp;<span class="ident" id="4284578">l</span><span class="op" id="4284579">.</span><span class="ident" id="4284580">level</span>&nbsp;<span class="op" id="4284586">==</span>&nbsp;<span class="ident" id="4284589">maxBits</span>&nbsp;<span class="op" id="4284597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284603">//&nbsp;All&nbsp;done!</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284620">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284634">levels</span><span class="op" id="4284640">[</span><span class="ident" id="4284641">l</span><span class="op" id="4284642">.</span><span class="ident" id="4284643">level</span><span class="op" id="4284648">+</span><span class="num" id="4284649">1</span><span class="op" id="4284650">]</span><span class="op" id="4284651">.</span><span class="ident" id="4284652">nextPairFreq</span>&nbsp;<span class="op" id="4284665">=</span>&nbsp;<span class="ident" id="4284667">prevFreq</span>&nbsp;<span class="op" id="4284676">+</span>&nbsp;<span class="ident" id="4284678">l</span><span class="op" id="4284679">.</span><span class="ident" id="4284680">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284692">level</span><span class="op" id="4284697">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284702">}</span>&nbsp;<span class="keyword" id="4284704">else</span>&nbsp;<span class="op" id="4284709">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284714">//&nbsp;If&nbsp;we&nbsp;stole&nbsp;from&nbsp;below,&nbsp;move&nbsp;down&nbsp;temporarily&nbsp;to&nbsp;replenish&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284783">for</span>&nbsp;<span class="ident" id="4284787">levels</span><span class="op" id="4284793">[</span><span class="ident" id="4284794">level</span><span class="op" id="4284799">-</span><span class="num" id="4284800">1</span><span class="op" id="4284801">]</span><span class="op" id="4284802">.</span><span class="ident" id="4284803">needed</span>&nbsp;<span class="op" id="4284810">&gt;</span>&nbsp;<span class="num" id="4284812">0</span>&nbsp;<span class="op" id="4284814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284820">level</span><span class="op" id="4284825">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284835">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284842">//&nbsp;Somethings&nbsp;is&nbsp;wrong&nbsp;if&nbsp;at&nbsp;the&nbsp;end,&nbsp;the&nbsp;top&nbsp;level&nbsp;is&nbsp;null&nbsp;or&nbsp;hasn&#39;t&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284918">//&nbsp;all&nbsp;of&nbsp;the&nbsp;leaves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284941">if</span>&nbsp;<span class="ident" id="4284944">leafCounts</span><span class="op" id="4284954">[</span><span class="ident" id="4284955">maxBits</span><span class="op" id="4284962">]</span><span class="op" id="4284963">[</span><span class="ident" id="4284964">maxBits</span><span class="op" id="4284971">]</span>&nbsp;<span class="op" id="4284973">!=</span>&nbsp;<span class="ident" id="4284976">n</span>&nbsp;<span class="op" id="4284978">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4284982">panic</span><span class="op" id="4284987">(</span><span class="string" id="4284988">&#34;leafCounts[maxBits][maxBits]&nbsp;!=&nbsp;n&#34;</span><span class="op" id="4285023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4285026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285030">bitCount</span>&nbsp;<span class="op" id="4285039">:=</span>&nbsp;<span class="builtinfunc" id="4285042">make</span><span class="op" id="4285046">(</span><span class="op" id="4285047">[</span><span class="op" id="4285048">]</span><span class="builtintype" id="4285049">int32</span><span class="op" id="4285054">,</span>&nbsp;<span class="ident" id="4285056">maxBits</span><span class="op" id="4285063">+</span><span class="num" id="4285064">1</span><span class="op" id="4285065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285068">bits</span>&nbsp;<span class="op" id="4285073">:=</span>&nbsp;<span class="num" id="4285076">1</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285079">counts</span>&nbsp;<span class="op" id="4285086">:=</span>&nbsp;<span class="op" id="4285089">&amp;</span><span class="ident" id="4285090">leafCounts</span><span class="op" id="4285100">[</span><span class="ident" id="4285101">maxBits</span><span class="op" id="4285108">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285111">for</span>&nbsp;<span class="ident" id="4285115">level</span>&nbsp;<span class="op" id="4285121">:=</span>&nbsp;<span class="ident" id="4285124">maxBits</span><span class="op" id="4285131">;</span>&nbsp;<span class="ident" id="4285133">level</span>&nbsp;<span class="op" id="4285139">&gt;</span>&nbsp;<span class="num" id="4285141">0</span><span class="op" id="4285142">;</span>&nbsp;<span class="ident" id="4285144">level</span><span class="op" id="4285149">--</span>&nbsp;<span class="op" id="4285152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285156">//&nbsp;chain.leafCount&nbsp;gives&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;requiring&nbsp;at&nbsp;least&nbsp;&#34;bits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285232">//&nbsp;bits&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285253">bitCount</span><span class="op" id="4285261">[</span><span class="ident" id="4285262">bits</span><span class="op" id="4285266">]</span>&nbsp;<span class="op" id="4285268">=</span>&nbsp;<span class="ident" id="4285270">counts</span><span class="op" id="4285276">[</span><span class="ident" id="4285277">level</span><span class="op" id="4285282">]</span>&nbsp;<span class="op" id="4285284">-</span>&nbsp;<span class="ident" id="4285286">counts</span><span class="op" id="4285292">[</span><span class="ident" id="4285293">level</span><span class="op" id="4285298">-</span><span class="num" id="4285299">1</span><span class="op" id="4285300">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285304">bits</span><span class="op" id="4285308">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4285312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285315">return</span>&nbsp;<span class="ident" id="4285322">bitCount</span><br>
<span class="lineno"></span><span class="op" id="4285331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4285334">//&nbsp;Look&nbsp;at&nbsp;the&nbsp;leaves&nbsp;and&nbsp;assign&nbsp;them&nbsp;a&nbsp;bit&nbsp;count&nbsp;and&nbsp;an&nbsp;encoding&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="4285413">//&nbsp;in&nbsp;RFC&nbsp;1951&nbsp;3.2.2</span><br>
<span class="lineno"></span><span class="keyword" id="4285434">func</span>&nbsp;<span class="op" id="4285439">(</span><span class="ident" id="4285440">h</span>&nbsp;<span class="op" id="4285442">*</span><span class="ident" id="4285443">huffmanEncoder</span><span class="op" id="4285457">)</span>&nbsp;<span class="ident" id="4285459">assignEncodingAndSize</span><span class="op" id="4285480">(</span><span class="ident" id="4285481">bitCount</span>&nbsp;<span class="op" id="4285490">[</span><span class="op" id="4285491">]</span><span class="builtintype" id="4285492">int32</span><span class="op" id="4285497">,</span>&nbsp;<span class="ident" id="4285499">list</span>&nbsp;<span class="op" id="4285504">[</span><span class="op" id="4285505">]</span><span class="ident" id="4285506">literalNode</span><span class="op" id="4285517">)</span>&nbsp;<span class="op" id="4285519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285522">code</span>&nbsp;<span class="op" id="4285527">:=</span>&nbsp;<span class="builtintype" id="4285530">uint16</span><span class="op" id="4285536">(</span><span class="num" id="4285537">0</span><span class="op" id="4285538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285541">for</span>&nbsp;<span class="ident" id="4285545">n</span><span class="op" id="4285546">,</span>&nbsp;<span class="ident" id="4285548">bits</span>&nbsp;<span class="op" id="4285553">:=</span>&nbsp;<span class="keyword" id="4285556">range</span>&nbsp;<span class="ident" id="4285562">bitCount</span>&nbsp;<span class="op" id="4285571">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285575">code</span>&nbsp;<span class="op" id="4285580">&lt;&lt;=</span>&nbsp;<span class="num" id="4285584">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285588">if</span>&nbsp;<span class="ident" id="4285591">n</span>&nbsp;<span class="op" id="4285593">==</span>&nbsp;<span class="num" id="4285596">0</span>&nbsp;<span class="op" id="4285598">||</span>&nbsp;<span class="ident" id="4285601">bits</span>&nbsp;<span class="op" id="4285606">==</span>&nbsp;<span class="num" id="4285609">0</span>&nbsp;<span class="op" id="4285611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285616">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4285627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285631">//&nbsp;The&nbsp;literals&nbsp;list[len(list)-bits]&nbsp;..&nbsp;list[len(list)-bits]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285694">//&nbsp;are&nbsp;encoded&nbsp;using&nbsp;&#34;bits&#34;&nbsp;bits,&nbsp;and&nbsp;get&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285749">//&nbsp;code,&nbsp;code&nbsp;+&nbsp;1,&nbsp;....&nbsp;&nbsp;The&nbsp;code&nbsp;values&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285796">//&nbsp;assigned&nbsp;in&nbsp;literal&nbsp;order&nbsp;(not&nbsp;frequency&nbsp;order).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285850">chunk</span>&nbsp;<span class="op" id="4285856">:=</span>&nbsp;<span class="ident" id="4285859">list</span><span class="op" id="4285863">[</span><span class="builtinfunc" id="4285864">len</span><span class="op" id="4285867">(</span><span class="ident" id="4285868">list</span><span class="op" id="4285872">)</span><span class="op" id="4285873">-</span><span class="builtintype" id="4285874">int</span><span class="op" id="4285877">(</span><span class="ident" id="4285878">bits</span><span class="op" id="4285882">)</span><span class="op" id="4285883">:</span><span class="op" id="4285884">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285888">sortByLiteral</span><span class="op" id="4285901">(</span><span class="ident" id="4285902">chunk</span><span class="op" id="4285907">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285911">for</span>&nbsp;<span class="ident" id="4285915">_</span><span class="op" id="4285916">,</span>&nbsp;<span class="ident" id="4285918">node</span>&nbsp;<span class="op" id="4285923">:=</span>&nbsp;<span class="keyword" id="4285926">range</span>&nbsp;<span class="ident" id="4285932">chunk</span>&nbsp;<span class="op" id="4285938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285943">h</span><span class="op" id="4285944">.</span><span class="ident" id="4285945">codeBits</span><span class="op" id="4285953">[</span><span class="ident" id="4285954">node</span><span class="op" id="4285958">.</span><span class="ident" id="4285959">literal</span><span class="op" id="4285966">]</span>&nbsp;<span class="op" id="4285968">=</span>&nbsp;<span class="builtintype" id="4285970">uint8</span><span class="op" id="4285975">(</span><span class="ident" id="4285976">n</span><span class="op" id="4285977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285982">h</span><span class="op" id="4285983">.</span><span class="ident" id="4285984">code</span><span class="op" id="4285988">[</span><span class="ident" id="4285989">node</span><span class="op" id="4285993">.</span><span class="ident" id="4285994">literal</span><span class="op" id="4286001">]</span>&nbsp;<span class="op" id="4286003">=</span>&nbsp;<span class="ident" id="4286005">reverseBits</span><span class="op" id="4286016">(</span><span class="ident" id="4286017">code</span><span class="op" id="4286021">,</span>&nbsp;<span class="builtintype" id="4286023">uint8</span><span class="op" id="4286028">(</span><span class="ident" id="4286029">n</span><span class="op" id="4286030">)</span><span class="op" id="4286031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286036">code</span><span class="op" id="4286040">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4286045">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286049">list</span>&nbsp;<span class="op" id="4286054">=</span>&nbsp;<span class="ident" id="4286056">list</span><span class="op" id="4286060">[</span><span class="num" id="4286061">0</span>&nbsp;<span class="op" id="4286063">:</span>&nbsp;<span class="builtinfunc" id="4286065">len</span><span class="op" id="4286068">(</span><span class="ident" id="4286069">list</span><span class="op" id="4286073">)</span><span class="op" id="4286074">-</span><span class="builtintype" id="4286075">int</span><span class="op" id="4286078">(</span><span class="ident" id="4286079">bits</span><span class="op" id="4286083">)</span><span class="op" id="4286084">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4286087">}</span><br>
<span class="lineno"></span><span class="op" id="4286089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4286092">//&nbsp;Update&nbsp;this&nbsp;Huffman&nbsp;Code&nbsp;object&nbsp;to&nbsp;be&nbsp;the&nbsp;minimum&nbsp;code&nbsp;for&nbsp;the&nbsp;specified&nbsp;frequency&nbsp;count.</span><br>
<span class="lineno">260</span><span class="comment" id="4286185">//</span><br>
<span class="lineno"></span><span class="comment" id="4286188">//&nbsp;freq&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;frequencies,&nbsp;in&nbsp;which&nbsp;frequency[i]&nbsp;gives&nbsp;the&nbsp;frequency&nbsp;of&nbsp;literal&nbsp;i.</span><br>
<span class="lineno"></span><span class="comment" id="4286278">//&nbsp;maxBits&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;any&nbsp;literal.</span><br>
<span class="lineno"></span><span class="keyword" id="4286341">func</span>&nbsp;<span class="op" id="4286346">(</span><span class="ident" id="4286347">h</span>&nbsp;<span class="op" id="4286349">*</span><span class="ident" id="4286350">huffmanEncoder</span><span class="op" id="4286364">)</span>&nbsp;<span class="ident" id="4286366">generate</span><span class="op" id="4286374">(</span><span class="ident" id="4286375">freq</span>&nbsp;<span class="op" id="4286380">[</span><span class="op" id="4286381">]</span><span class="builtintype" id="4286382">int32</span><span class="op" id="4286387">,</span>&nbsp;<span class="ident" id="4286389">maxBits</span>&nbsp;<span class="builtintype" id="4286397">int32</span><span class="op" id="4286402">)</span>&nbsp;<span class="op" id="4286404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286407">list</span>&nbsp;<span class="op" id="4286412">:=</span>&nbsp;<span class="builtinfunc" id="4286415">make</span><span class="op" id="4286419">(</span><span class="op" id="4286420">[</span><span class="op" id="4286421">]</span><span class="ident" id="4286422">literalNode</span><span class="op" id="4286433">,</span>&nbsp;<span class="builtinfunc" id="4286435">len</span><span class="op" id="4286438">(</span><span class="ident" id="4286439">freq</span><span class="op" id="4286443">)</span><span class="op" id="4286444">+</span><span class="num" id="4286445">1</span><span class="op" id="4286446">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4286449">//&nbsp;Number&nbsp;of&nbsp;non-zero&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286481">count</span>&nbsp;<span class="op" id="4286487">:=</span>&nbsp;<span class="num" id="4286490">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4286493">//&nbsp;Set&nbsp;list&nbsp;to&nbsp;be&nbsp;the&nbsp;set&nbsp;of&nbsp;all&nbsp;non-zero&nbsp;literals&nbsp;and&nbsp;their&nbsp;frequencies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286567">for</span>&nbsp;<span class="ident" id="4286571">i</span><span class="op" id="4286572">,</span>&nbsp;<span class="ident" id="4286574">f</span>&nbsp;<span class="op" id="4286576">:=</span>&nbsp;<span class="keyword" id="4286579">range</span>&nbsp;<span class="ident" id="4286585">freq</span>&nbsp;<span class="op" id="4286590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286594">if</span>&nbsp;<span class="ident" id="4286597">f</span>&nbsp;<span class="op" id="4286599">!=</span>&nbsp;<span class="num" id="4286602">0</span>&nbsp;<span class="op" id="4286604">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286609">list</span><span class="op" id="4286613">[</span><span class="ident" id="4286614">count</span><span class="op" id="4286619">]</span>&nbsp;<span class="op" id="4286621">=</span>&nbsp;<span class="ident" id="4286623">literalNode</span><span class="op" id="4286634">{</span><span class="builtintype" id="4286635">uint16</span><span class="op" id="4286641">(</span><span class="ident" id="4286642">i</span><span class="op" id="4286643">)</span><span class="op" id="4286644">,</span>&nbsp;<span class="ident" id="4286646">f</span><span class="op" id="4286647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286652">count</span><span class="op" id="4286657">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4286662">}</span>&nbsp;<span class="keyword" id="4286664">else</span>&nbsp;<span class="op" id="4286669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286674">h</span><span class="op" id="4286675">.</span><span class="ident" id="4286676">codeBits</span><span class="op" id="4286684">[</span><span class="ident" id="4286685">i</span><span class="op" id="4286686">]</span>&nbsp;<span class="op" id="4286688">=</span>&nbsp;<span class="num" id="4286690">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4286694">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4286697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4286700">//&nbsp;If&nbsp;freq[]&nbsp;is&nbsp;shorter&nbsp;than&nbsp;codeBits[],&nbsp;fill&nbsp;rest&nbsp;of&nbsp;codeBits[]&nbsp;with&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286777">h</span><span class="op" id="4286778">.</span><span class="ident" id="4286779">codeBits</span>&nbsp;<span class="op" id="4286788">=</span>&nbsp;<span class="ident" id="4286790">h</span><span class="op" id="4286791">.</span><span class="ident" id="4286792">codeBits</span><span class="op" id="4286800">[</span><span class="num" id="4286801">0</span><span class="op" id="4286802">:</span><span class="builtinfunc" id="4286803">len</span><span class="op" id="4286806">(</span><span class="ident" id="4286807">freq</span><span class="op" id="4286811">)</span><span class="op" id="4286812">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286815">list</span>&nbsp;<span class="op" id="4286820">=</span>&nbsp;<span class="ident" id="4286822">list</span><span class="op" id="4286826">[</span><span class="num" id="4286827">0</span><span class="op" id="4286828">:</span><span class="ident" id="4286829">count</span><span class="op" id="4286834">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286837">if</span>&nbsp;<span class="ident" id="4286840">count</span>&nbsp;<span class="op" id="4286846">&lt;=</span>&nbsp;<span class="num" id="4286849">2</span>&nbsp;<span class="op" id="4286851">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4286855">//&nbsp;Handle&nbsp;the&nbsp;small&nbsp;cases&nbsp;here,&nbsp;because&nbsp;they&nbsp;are&nbsp;awkward&nbsp;for&nbsp;the&nbsp;general&nbsp;case&nbsp;code.&nbsp;&nbsp;With</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4286947">//&nbsp;two&nbsp;or&nbsp;fewer&nbsp;literals,&nbsp;everything&nbsp;has&nbsp;bit&nbsp;length&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4287004">for</span>&nbsp;<span class="ident" id="4287008">i</span><span class="op" id="4287009">,</span>&nbsp;<span class="ident" id="4287011">node</span>&nbsp;<span class="op" id="4287016">:=</span>&nbsp;<span class="keyword" id="4287019">range</span>&nbsp;<span class="ident" id="4287025">list</span>&nbsp;<span class="op" id="4287030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4287035">//&nbsp;&#34;list&#34;&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing&nbsp;literal&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287089">h</span><span class="op" id="4287090">.</span><span class="ident" id="4287091">codeBits</span><span class="op" id="4287099">[</span><span class="ident" id="4287100">node</span><span class="op" id="4287104">.</span><span class="ident" id="4287105">literal</span><span class="op" id="4287112">]</span>&nbsp;<span class="op" id="4287114">=</span>&nbsp;<span class="num" id="4287116">1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287121">h</span><span class="op" id="4287122">.</span><span class="ident" id="4287123">code</span><span class="op" id="4287127">[</span><span class="ident" id="4287128">node</span><span class="op" id="4287132">.</span><span class="ident" id="4287133">literal</span><span class="op" id="4287140">]</span>&nbsp;<span class="op" id="4287142">=</span>&nbsp;<span class="builtintype" id="4287144">uint16</span><span class="op" id="4287150">(</span><span class="ident" id="4287151">i</span><span class="op" id="4287152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4287156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4287160">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4287168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287171">sortByFreq</span><span class="op" id="4287181">(</span><span class="ident" id="4287182">list</span><span class="op" id="4287186">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4287190">//&nbsp;Get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;for&nbsp;each&nbsp;bit&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287240">bitCount</span>&nbsp;<span class="op" id="4287249">:=</span>&nbsp;<span class="ident" id="4287252">h</span><span class="op" id="4287253">.</span><span class="ident" id="4287254">bitCounts</span><span class="op" id="4287263">(</span><span class="ident" id="4287264">list</span><span class="op" id="4287268">,</span>&nbsp;<span class="ident" id="4287270">maxBits</span><span class="op" id="4287277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4287280">//&nbsp;And&nbsp;do&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287306">h</span><span class="op" id="4287307">.</span><span class="ident" id="4287308">assignEncodingAndSize</span><span class="op" id="4287329">(</span><span class="ident" id="4287330">bitCount</span><span class="op" id="4287338">,</span>&nbsp;<span class="ident" id="4287340">list</span><span class="op" id="4287344">)</span><br>
<span class="lineno">295</span><span class="op" id="4287346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4287349">type</span>&nbsp;<span class="ident" id="4287354">literalNodeSorter</span>&nbsp;<span class="keyword" id="4287372">struct</span>&nbsp;<span class="op" id="4287379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287382">a</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4287387">[</span><span class="op" id="4287388">]</span><span class="ident" id="4287389">literalNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287402">less</span>&nbsp;<span class="keyword" id="4287407">func</span><span class="op" id="4287411">(</span><span class="ident" id="4287412">i</span><span class="op" id="4287413">,</span>&nbsp;<span class="ident" id="4287415">j</span>&nbsp;<span class="builtintype" id="4287417">int</span><span class="op" id="4287420">)</span>&nbsp;<span class="builtintype" id="4287422">bool</span><br>
<span class="lineno">300</span><span class="op" id="4287427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4287430">func</span>&nbsp;<span class="op" id="4287435">(</span><span class="ident" id="4287436">s</span>&nbsp;<span class="ident" id="4287438">literalNodeSorter</span><span class="op" id="4287455">)</span>&nbsp;<span class="ident" id="4287457">Len</span><span class="op" id="4287460">(</span><span class="op" id="4287461">)</span>&nbsp;<span class="builtintype" id="4287463">int</span>&nbsp;<span class="op" id="4287467">{</span>&nbsp;<span class="keyword" id="4287469">return</span>&nbsp;<span class="builtinfunc" id="4287476">len</span><span class="op" id="4287479">(</span><span class="ident" id="4287480">s</span><span class="op" id="4287481">.</span><span class="ident" id="4287482">a</span><span class="op" id="4287483">)</span>&nbsp;<span class="op" id="4287485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4287488">func</span>&nbsp;<span class="op" id="4287493">(</span><span class="ident" id="4287494">s</span>&nbsp;<span class="ident" id="4287496">literalNodeSorter</span><span class="op" id="4287513">)</span>&nbsp;<span class="ident" id="4287515">Less</span><span class="op" id="4287519">(</span><span class="ident" id="4287520">i</span><span class="op" id="4287521">,</span>&nbsp;<span class="ident" id="4287523">j</span>&nbsp;<span class="builtintype" id="4287525">int</span><span class="op" id="4287528">)</span>&nbsp;<span class="builtintype" id="4287530">bool</span>&nbsp;<span class="op" id="4287535">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4287538">return</span>&nbsp;<span class="ident" id="4287545">s</span><span class="op" id="4287546">.</span><span class="ident" id="4287547">less</span><span class="op" id="4287551">(</span><span class="ident" id="4287552">i</span><span class="op" id="4287553">,</span>&nbsp;<span class="ident" id="4287555">j</span><span class="op" id="4287556">)</span><br>
<span class="lineno"></span><span class="op" id="4287558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4287561">func</span>&nbsp;<span class="op" id="4287566">(</span><span class="ident" id="4287567">s</span>&nbsp;<span class="ident" id="4287569">literalNodeSorter</span><span class="op" id="4287586">)</span>&nbsp;<span class="ident" id="4287588">Swap</span><span class="op" id="4287592">(</span><span class="ident" id="4287593">i</span><span class="op" id="4287594">,</span>&nbsp;<span class="ident" id="4287596">j</span>&nbsp;<span class="builtintype" id="4287598">int</span><span class="op" id="4287601">)</span>&nbsp;<span class="op" id="4287603">{</span>&nbsp;<span class="ident" id="4287605">s</span><span class="op" id="4287606">.</span><span class="ident" id="4287607">a</span><span class="op" id="4287608">[</span><span class="ident" id="4287609">i</span><span class="op" id="4287610">]</span><span class="op" id="4287611">,</span>&nbsp;<span class="ident" id="4287613">s</span><span class="op" id="4287614">.</span><span class="ident" id="4287615">a</span><span class="op" id="4287616">[</span><span class="ident" id="4287617">j</span><span class="op" id="4287618">]</span>&nbsp;<span class="op" id="4287620">=</span>&nbsp;<span class="ident" id="4287622">s</span><span class="op" id="4287623">.</span><span class="ident" id="4287624">a</span><span class="op" id="4287625">[</span><span class="ident" id="4287626">j</span><span class="op" id="4287627">]</span><span class="op" id="4287628">,</span>&nbsp;<span class="ident" id="4287630">s</span><span class="op" id="4287631">.</span><span class="ident" id="4287632">a</span><span class="op" id="4287633">[</span><span class="ident" id="4287634">i</span><span class="op" id="4287635">]</span>&nbsp;<span class="op" id="4287637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="keyword" id="4287640">func</span>&nbsp;<span class="ident" id="4287645">sortByFreq</span><span class="op" id="4287655">(</span><span class="ident" id="4287656">a</span>&nbsp;<span class="op" id="4287658">[</span><span class="op" id="4287659">]</span><span class="ident" id="4287660">literalNode</span><span class="op" id="4287671">)</span>&nbsp;<span class="op" id="4287673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287676">s</span>&nbsp;<span class="op" id="4287678">:=</span>&nbsp;<span class="op" id="4287681">&amp;</span><span class="ident" id="4287682">literalNodeSorter</span><span class="op" id="4287699">{</span><span class="ident" id="4287700">a</span><span class="op" id="4287701">,</span>&nbsp;<span class="keyword" id="4287703">func</span><span class="op" id="4287707">(</span><span class="ident" id="4287708">i</span><span class="op" id="4287709">,</span>&nbsp;<span class="ident" id="4287711">j</span>&nbsp;<span class="builtintype" id="4287713">int</span><span class="op" id="4287716">)</span>&nbsp;<span class="builtintype" id="4287718">bool</span>&nbsp;<span class="op" id="4287723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4287727">if</span>&nbsp;<span class="ident" id="4287730">a</span><span class="op" id="4287731">[</span><span class="ident" id="4287732">i</span><span class="op" id="4287733">]</span><span class="op" id="4287734">.</span><span class="ident" id="4287735">freq</span>&nbsp;<span class="op" id="4287740">==</span>&nbsp;<span class="ident" id="4287743">a</span><span class="op" id="4287744">[</span><span class="ident" id="4287745">j</span><span class="op" id="4287746">]</span><span class="op" id="4287747">.</span><span class="ident" id="4287748">freq</span>&nbsp;<span class="op" id="4287753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4287758">return</span>&nbsp;<span class="ident" id="4287765">a</span><span class="op" id="4287766">[</span><span class="ident" id="4287767">i</span><span class="op" id="4287768">]</span><span class="op" id="4287769">.</span><span class="ident" id="4287770">literal</span>&nbsp;<span class="op" id="4287778">&lt;</span>&nbsp;<span class="ident" id="4287780">a</span><span class="op" id="4287781">[</span><span class="ident" id="4287782">j</span><span class="op" id="4287783">]</span><span class="op" id="4287784">.</span><span class="ident" id="4287785">literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4287795">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4287799">return</span>&nbsp;<span class="ident" id="4287806">a</span><span class="op" id="4287807">[</span><span class="ident" id="4287808">i</span><span class="op" id="4287809">]</span><span class="op" id="4287810">.</span><span class="ident" id="4287811">freq</span>&nbsp;<span class="op" id="4287816">&lt;</span>&nbsp;<span class="ident" id="4287818">a</span><span class="op" id="4287819">[</span><span class="ident" id="4287820">j</span><span class="op" id="4287821">]</span><span class="op" id="4287822">.</span><span class="ident" id="4287823">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4287829">}</span><span class="op" id="4287830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287833">sort</span><span class="op" id="4287837">.</span><span class="ident" id="4287838">Sort</span><span class="op" id="4287842">(</span><span class="ident" id="4287843">s</span><span class="op" id="4287844">)</span><br>
<span class="lineno"></span><span class="op" id="4287846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="keyword" id="4287849">func</span>&nbsp;<span class="ident" id="4287854">sortByLiteral</span><span class="op" id="4287867">(</span><span class="ident" id="4287868">a</span>&nbsp;<span class="op" id="4287870">[</span><span class="op" id="4287871">]</span><span class="ident" id="4287872">literalNode</span><span class="op" id="4287883">)</span>&nbsp;<span class="op" id="4287885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287888">s</span>&nbsp;<span class="op" id="4287890">:=</span>&nbsp;<span class="op" id="4287893">&amp;</span><span class="ident" id="4287894">literalNodeSorter</span><span class="op" id="4287911">{</span><span class="ident" id="4287912">a</span><span class="op" id="4287913">,</span>&nbsp;<span class="keyword" id="4287915">func</span><span class="op" id="4287919">(</span><span class="ident" id="4287920">i</span><span class="op" id="4287921">,</span>&nbsp;<span class="ident" id="4287923">j</span>&nbsp;<span class="builtintype" id="4287925">int</span><span class="op" id="4287928">)</span>&nbsp;<span class="builtintype" id="4287930">bool</span>&nbsp;<span class="op" id="4287935">{</span>&nbsp;<span class="keyword" id="4287937">return</span>&nbsp;<span class="ident" id="4287944">a</span><span class="op" id="4287945">[</span><span class="ident" id="4287946">i</span><span class="op" id="4287947">]</span><span class="op" id="4287948">.</span><span class="ident" id="4287949">literal</span>&nbsp;<span class="op" id="4287957">&lt;</span>&nbsp;<span class="ident" id="4287959">a</span><span class="op" id="4287960">[</span><span class="ident" id="4287961">j</span><span class="op" id="4287962">]</span><span class="op" id="4287963">.</span><span class="ident" id="4287964">literal</span>&nbsp;<span class="op" id="4287972">}</span><span class="op" id="4287973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287976">sort</span><span class="op" id="4287980">.</span><span class="ident" id="4287981">Sort</span><span class="op" id="4287985">(</span><span class="ident" id="4287986">s</span><span class="op" id="4287987">)</span><br>
<span class="lineno"></span><span class="op" id="4287989">}</span>
</div>
</body>
</html>
