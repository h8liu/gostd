<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html" class="current">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6022047">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6022102">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6022156">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6022207">//&nbsp;Package&nbsp;httptest&nbsp;provides&nbsp;utilities&nbsp;for&nbsp;HTTP&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6022264">package</span>&nbsp;<span class="ident" id="6022272">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6022282">import</span>&nbsp;<span class="op" id="6022289">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6022292">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6022301">&#34;net/http&#34;</span><br>
<span class="lineno"></span><span class="op" id="6022312">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6022315">//&nbsp;ResponseRecorder&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;http.ResponseWriter&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6022384">//&nbsp;records&nbsp;its&nbsp;mutations&nbsp;for&nbsp;later&nbsp;inspection&nbsp;in&nbsp;tests.</span><br>
<span class="lineno">15</span><span class="keyword" id="6022440">type</span>&nbsp;<span class="ident" id="6022445">ResponseRecorder</span>&nbsp;<span class="keyword" id="6022462">struct</span>&nbsp;<span class="op" id="6022469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022472">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6022482">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6022496">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;code&nbsp;from&nbsp;WriteHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022540">HeaderMap</span>&nbsp;<span class="ident" id="6022550">http</span><span class="op" id="6022554">.</span><span class="ident" id="6022555">Header</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6022564">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022594">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6022604">*</span><span class="ident" id="6022605">bytes</span><span class="op" id="6022610">.</span><span class="ident" id="6022611">Buffer</span>&nbsp;<span class="comment" id="6022618">//&nbsp;if&nbsp;non-nil,&nbsp;the&nbsp;bytes.Buffer&nbsp;to&nbsp;append&nbsp;written&nbsp;data&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022677">Flushed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6022687">bool</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022694">wroteHeader</span>&nbsp;<span class="builtintype" id="6022706">bool</span><br>
<span class="lineno"></span><span class="op" id="6022711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6022714">//&nbsp;NewRecorder&nbsp;returns&nbsp;an&nbsp;initialized&nbsp;ResponseRecorder.</span><br>
<span class="lineno">25</span><span class="keyword" id="6022770">func</span>&nbsp;<span class="ident" id="6022775">NewRecorder</span><span class="op" id="6022786">(</span><span class="op" id="6022787">)</span>&nbsp;<span class="op" id="6022789">*</span><span class="ident" id="6022790">ResponseRecorder</span>&nbsp;<span class="op" id="6022807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6022810">return</span>&nbsp;<span class="op" id="6022817">&amp;</span><span class="ident" id="6022818">ResponseRecorder</span><span class="op" id="6022834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022838">HeaderMap</span><span class="op" id="6022847">:</span>&nbsp;<span class="builtinfunc" id="6022849">make</span><span class="op" id="6022853">(</span><span class="ident" id="6022854">http</span><span class="op" id="6022858">.</span><span class="ident" id="6022859">Header</span><span class="op" id="6022865">)</span><span class="op" id="6022866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022870">Body</span><span class="op" id="6022874">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6022881">new</span><span class="op" id="6022884">(</span><span class="ident" id="6022885">bytes</span><span class="op" id="6022890">.</span><span class="ident" id="6022891">Buffer</span><span class="op" id="6022897">)</span><span class="op" id="6022898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6022902">Code</span><span class="op" id="6022906">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6022913">200</span><span class="op" id="6022916">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6022919">}</span><br>
<span class="lineno"></span><span class="op" id="6022921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6022924">//&nbsp;DefaultRemoteAddr&nbsp;is&nbsp;the&nbsp;default&nbsp;remote&nbsp;address&nbsp;to&nbsp;return&nbsp;in&nbsp;RemoteAddr&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6023002">//&nbsp;an&nbsp;explicit&nbsp;DefaultRemoteAddr&nbsp;isn&#39;t&nbsp;set&nbsp;on&nbsp;ResponseRecorder.</span><br>
<span class="lineno">35</span><span class="keyword" id="6023066">const</span>&nbsp;<span class="ident" id="6023072">DefaultRemoteAddr</span>&nbsp;<span class="op" id="6023090">=</span>&nbsp;<span class="string" id="6023092">&#34;1.2.3.4&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6023103">//&nbsp;Header&nbsp;returns&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="6023143">func</span>&nbsp;<span class="op" id="6023148">(</span><span class="ident" id="6023149">rw</span>&nbsp;<span class="op" id="6023152">*</span><span class="ident" id="6023153">ResponseRecorder</span><span class="op" id="6023169">)</span>&nbsp;<span class="ident" id="6023171">Header</span><span class="op" id="6023177">(</span><span class="op" id="6023178">)</span>&nbsp;<span class="ident" id="6023180">http</span><span class="op" id="6023184">.</span><span class="ident" id="6023185">Header</span>&nbsp;<span class="op" id="6023192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023195">m</span>&nbsp;<span class="op" id="6023197">:=</span>&nbsp;<span class="ident" id="6023200">rw</span><span class="op" id="6023202">.</span><span class="ident" id="6023203">HeaderMap</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6023214">if</span>&nbsp;<span class="ident" id="6023217">m</span>&nbsp;<span class="op" id="6023219">==</span>&nbsp;<span class="builtintype" id="6023222">nil</span>&nbsp;<span class="op" id="6023226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023230">m</span>&nbsp;<span class="op" id="6023232">=</span>&nbsp;<span class="builtinfunc" id="6023234">make</span><span class="op" id="6023238">(</span><span class="ident" id="6023239">http</span><span class="op" id="6023243">.</span><span class="ident" id="6023244">Header</span><span class="op" id="6023250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023254">rw</span><span class="op" id="6023256">.</span><span class="ident" id="6023257">HeaderMap</span>&nbsp;<span class="op" id="6023267">=</span>&nbsp;<span class="ident" id="6023269">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6023272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6023275">return</span>&nbsp;<span class="ident" id="6023282">m</span><br>
<span class="lineno">45</span><span class="op" id="6023284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6023287">//&nbsp;Write&nbsp;always&nbsp;succeeds&nbsp;and&nbsp;writes&nbsp;to&nbsp;rw.Body,&nbsp;if&nbsp;not&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="6023347">func</span>&nbsp;<span class="op" id="6023352">(</span><span class="ident" id="6023353">rw</span>&nbsp;<span class="op" id="6023356">*</span><span class="ident" id="6023357">ResponseRecorder</span><span class="op" id="6023373">)</span>&nbsp;<span class="ident" id="6023375">Write</span><span class="op" id="6023380">(</span><span class="ident" id="6023381">buf</span>&nbsp;<span class="op" id="6023385">[</span><span class="op" id="6023386">]</span><span class="builtintype" id="6023387">byte</span><span class="op" id="6023391">)</span>&nbsp;<span class="op" id="6023393">(</span><span class="builtintype" id="6023394">int</span><span class="op" id="6023397">,</span>&nbsp;<span class="builtintype" id="6023399">error</span><span class="op" id="6023404">)</span>&nbsp;<span class="op" id="6023406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6023409">if</span>&nbsp;<span class="op" id="6023412">!</span><span class="ident" id="6023413">rw</span><span class="op" id="6023415">.</span><span class="ident" id="6023416">wroteHeader</span>&nbsp;<span class="op" id="6023428">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023432">rw</span><span class="op" id="6023434">.</span><span class="ident" id="6023435">WriteHeader</span><span class="op" id="6023446">(</span><span class="num" id="6023447">200</span><span class="op" id="6023450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6023453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6023456">if</span>&nbsp;<span class="ident" id="6023459">rw</span><span class="op" id="6023461">.</span><span class="ident" id="6023462">Body</span>&nbsp;<span class="op" id="6023467">!=</span>&nbsp;<span class="builtintype" id="6023470">nil</span>&nbsp;<span class="op" id="6023474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023478">rw</span><span class="op" id="6023480">.</span><span class="ident" id="6023481">Body</span><span class="op" id="6023485">.</span><span class="ident" id="6023486">Write</span><span class="op" id="6023491">(</span><span class="ident" id="6023492">buf</span><span class="op" id="6023495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6023498">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6023501">return</span>&nbsp;<span class="builtinfunc" id="6023508">len</span><span class="op" id="6023511">(</span><span class="ident" id="6023512">buf</span><span class="op" id="6023515">)</span><span class="op" id="6023516">,</span>&nbsp;<span class="builtintype" id="6023518">nil</span><br>
<span class="lineno"></span><span class="op" id="6023522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6023525">//&nbsp;WriteHeader&nbsp;sets&nbsp;rw.Code.</span><br>
<span class="lineno"></span><span class="keyword" id="6023554">func</span>&nbsp;<span class="op" id="6023559">(</span><span class="ident" id="6023560">rw</span>&nbsp;<span class="op" id="6023563">*</span><span class="ident" id="6023564">ResponseRecorder</span><span class="op" id="6023580">)</span>&nbsp;<span class="ident" id="6023582">WriteHeader</span><span class="op" id="6023593">(</span><span class="ident" id="6023594">code</span>&nbsp;<span class="builtintype" id="6023599">int</span><span class="op" id="6023602">)</span>&nbsp;<span class="op" id="6023604">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6023607">if</span>&nbsp;<span class="op" id="6023610">!</span><span class="ident" id="6023611">rw</span><span class="op" id="6023613">.</span><span class="ident" id="6023614">wroteHeader</span>&nbsp;<span class="op" id="6023626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023630">rw</span><span class="op" id="6023632">.</span><span class="ident" id="6023633">Code</span>&nbsp;<span class="op" id="6023638">=</span>&nbsp;<span class="ident" id="6023640">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6023646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023649">rw</span><span class="op" id="6023651">.</span><span class="ident" id="6023652">wroteHeader</span>&nbsp;<span class="op" id="6023664">=</span>&nbsp;<span class="builtintype" id="6023666">true</span><br>
<span class="lineno"></span><span class="op" id="6023671">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="6023674">//&nbsp;Flush&nbsp;sets&nbsp;rw.Flushed&nbsp;to&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="6023708">func</span>&nbsp;<span class="op" id="6023713">(</span><span class="ident" id="6023714">rw</span>&nbsp;<span class="op" id="6023717">*</span><span class="ident" id="6023718">ResponseRecorder</span><span class="op" id="6023734">)</span>&nbsp;<span class="ident" id="6023736">Flush</span><span class="op" id="6023741">(</span><span class="op" id="6023742">)</span>&nbsp;<span class="op" id="6023744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6023747">if</span>&nbsp;<span class="op" id="6023750">!</span><span class="ident" id="6023751">rw</span><span class="op" id="6023753">.</span><span class="ident" id="6023754">wroteHeader</span>&nbsp;<span class="op" id="6023766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023770">rw</span><span class="op" id="6023772">.</span><span class="ident" id="6023773">WriteHeader</span><span class="op" id="6023784">(</span><span class="num" id="6023785">200</span><span class="op" id="6023788">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6023791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6023794">rw</span><span class="op" id="6023796">.</span><span class="ident" id="6023797">Flushed</span>&nbsp;<span class="op" id="6023805">=</span>&nbsp;<span class="builtintype" id="6023807">true</span><br>
<span class="lineno"></span><span class="op" id="6023812">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
