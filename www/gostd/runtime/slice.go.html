<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2045950">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2046005">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2046059">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2046110">package</span>&nbsp;<span class="ident" id="2046118">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2046127">import</span>&nbsp;<span class="op" id="2046134">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2046137">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2046146">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2046149">type</span>&nbsp;<span class="ident" id="2046154">sliceStruct</span>&nbsp;<span class="keyword" id="2046166">struct</span>&nbsp;<span class="op" id="2046173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2046176">array</span>&nbsp;<span class="ident" id="2046182">unsafe</span><span class="op" id="2046188">.</span><span class="ident" id="2046189">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2046198">len</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2046204">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2046209">cap</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2046215">int</span><br>
<span class="lineno">15</span><span class="op" id="2046219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2046222">//&nbsp;TODO:&nbsp;take&nbsp;uintptrs&nbsp;instead&nbsp;of&nbsp;int64s?</span><br>
<span class="lineno"></span><span class="keyword" id="2046264">func</span>&nbsp;<span class="ident" id="2046269">makeslice</span><span class="op" id="2046278">(</span><span class="ident" id="2046279">t</span>&nbsp;<span class="op" id="2046281">*</span><span class="ident" id="2046282">slicetype</span><span class="op" id="2046291">,</span>&nbsp;<span class="ident" id="2046293">len64</span>&nbsp;<span class="ident" id="2046299">int64</span><span class="op" id="2046304">,</span>&nbsp;<span class="ident" id="2046306">cap64</span>&nbsp;<span class="ident" id="2046312">int64</span><span class="op" id="2046317">)</span>&nbsp;<span class="ident" id="2046319">sliceStruct</span>&nbsp;<span class="op" id="2046331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2046334">//&nbsp;NOTE:&nbsp;The&nbsp;len&nbsp;&gt;&nbsp;MaxMem/elemsize&nbsp;check&nbsp;here&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2046408">//&nbsp;but&nbsp;it&nbsp;produces&nbsp;a&nbsp;&#39;len&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error&nbsp;instead&nbsp;of&nbsp;a&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2046493">//&nbsp;when&nbsp;someone&nbsp;does&nbsp;make([]T,&nbsp;bignumber).&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;is&nbsp;true&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2046569">//&nbsp;but&nbsp;since&nbsp;the&nbsp;cap&nbsp;is&nbsp;only&nbsp;being&nbsp;supplied&nbsp;implicitly,&nbsp;saying&nbsp;len&nbsp;is&nbsp;clearer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2046649">//&nbsp;See&nbsp;issue&nbsp;4085.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2046669">len</span>&nbsp;<span class="op" id="2046673">:=</span>&nbsp;<span class="builtintype" id="2046676">int</span><span class="op" id="2046679">(</span><span class="ident" id="2046680">len64</span><span class="op" id="2046685">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2046688">if</span>&nbsp;<span class="ident" id="2046691">len64</span>&nbsp;<span class="op" id="2046697">&lt;</span>&nbsp;<span class="num" id="2046699">0</span>&nbsp;<span class="op" id="2046701">||</span>&nbsp;<span class="ident" id="2046704">int64</span><span class="op" id="2046709">(</span><span class="builtinfunc" id="2046710">len</span><span class="op" id="2046713">)</span>&nbsp;<span class="op" id="2046715">!=</span>&nbsp;<span class="ident" id="2046718">len64</span>&nbsp;<span class="op" id="2046724">||</span>&nbsp;<span class="ident" id="2046727">t</span><span class="op" id="2046728">.</span><span class="ident" id="2046729">elem</span><span class="op" id="2046733">.</span><span class="ident" id="2046734">size</span>&nbsp;<span class="op" id="2046739">&gt;</span>&nbsp;<span class="num" id="2046741">0</span>&nbsp;<span class="op" id="2046743">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2046746">uintptr</span><span class="op" id="2046753">(</span><span class="builtinfunc" id="2046754">len</span><span class="op" id="2046757">)</span>&nbsp;<span class="op" id="2046759">&gt;</span>&nbsp;<span class="ident" id="2046761">maxmem</span><span class="op" id="2046767">/</span><span class="builtintype" id="2046768">uintptr</span><span class="op" id="2046775">(</span><span class="ident" id="2046776">t</span><span class="op" id="2046777">.</span><span class="ident" id="2046778">elem</span><span class="op" id="2046782">.</span><span class="ident" id="2046783">size</span><span class="op" id="2046787">)</span>&nbsp;<span class="op" id="2046789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2046793">panic</span><span class="op" id="2046798">(</span><span class="ident" id="2046799">errorString</span><span class="op" id="2046810">(</span><span class="string" id="2046811">&#34;makeslice:&nbsp;len&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="2046840">)</span><span class="op" id="2046841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2046844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2046847">cap</span>&nbsp;<span class="op" id="2046851">:=</span>&nbsp;<span class="builtintype" id="2046854">int</span><span class="op" id="2046857">(</span><span class="ident" id="2046858">cap64</span><span class="op" id="2046863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2046866">if</span>&nbsp;<span class="builtinfunc" id="2046869">cap</span>&nbsp;<span class="op" id="2046873">&lt;</span>&nbsp;<span class="builtinfunc" id="2046875">len</span>&nbsp;<span class="op" id="2046879">||</span>&nbsp;<span class="ident" id="2046882">int64</span><span class="op" id="2046887">(</span><span class="builtinfunc" id="2046888">cap</span><span class="op" id="2046891">)</span>&nbsp;<span class="op" id="2046893">!=</span>&nbsp;<span class="ident" id="2046896">cap64</span>&nbsp;<span class="op" id="2046902">||</span>&nbsp;<span class="ident" id="2046905">t</span><span class="op" id="2046906">.</span><span class="ident" id="2046907">elem</span><span class="op" id="2046911">.</span><span class="ident" id="2046912">size</span>&nbsp;<span class="op" id="2046917">&gt;</span>&nbsp;<span class="num" id="2046919">0</span>&nbsp;<span class="op" id="2046921">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2046924">uintptr</span><span class="op" id="2046931">(</span><span class="builtinfunc" id="2046932">cap</span><span class="op" id="2046935">)</span>&nbsp;<span class="op" id="2046937">&gt;</span>&nbsp;<span class="ident" id="2046939">maxmem</span><span class="op" id="2046945">/</span><span class="builtintype" id="2046946">uintptr</span><span class="op" id="2046953">(</span><span class="ident" id="2046954">t</span><span class="op" id="2046955">.</span><span class="ident" id="2046956">elem</span><span class="op" id="2046960">.</span><span class="ident" id="2046961">size</span><span class="op" id="2046965">)</span>&nbsp;<span class="op" id="2046967">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2046971">panic</span><span class="op" id="2046976">(</span><span class="ident" id="2046977">errorString</span><span class="op" id="2046988">(</span><span class="string" id="2046989">&#34;makeslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="2047018">)</span><span class="op" id="2047019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047025">p</span>&nbsp;<span class="op" id="2047027">:=</span>&nbsp;<span class="ident" id="2047030">newarray</span><span class="op" id="2047038">(</span><span class="ident" id="2047039">t</span><span class="op" id="2047040">.</span><span class="ident" id="2047041">elem</span><span class="op" id="2047045">,</span>&nbsp;<span class="builtintype" id="2047047">uintptr</span><span class="op" id="2047054">(</span><span class="builtinfunc" id="2047055">cap</span><span class="op" id="2047058">)</span><span class="op" id="2047059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047062">return</span>&nbsp;<span class="ident" id="2047069">sliceStruct</span><span class="op" id="2047080">{</span><span class="ident" id="2047081">p</span><span class="op" id="2047082">,</span>&nbsp;<span class="builtinfunc" id="2047084">len</span><span class="op" id="2047087">,</span>&nbsp;<span class="builtinfunc" id="2047089">cap</span><span class="op" id="2047092">}</span><br>
<span class="lineno"></span><span class="op" id="2047094">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="2047097">//&nbsp;TODO:&nbsp;take&nbsp;uintptr&nbsp;instead&nbsp;of&nbsp;int64?</span><br>
<span class="lineno"></span><span class="keyword" id="2047137">func</span>&nbsp;<span class="ident" id="2047142">growslice</span><span class="op" id="2047151">(</span><span class="ident" id="2047152">t</span>&nbsp;<span class="op" id="2047154">*</span><span class="ident" id="2047155">slicetype</span><span class="op" id="2047164">,</span>&nbsp;<span class="ident" id="2047166">old</span>&nbsp;<span class="ident" id="2047170">sliceStruct</span><span class="op" id="2047181">,</span>&nbsp;<span class="ident" id="2047183">n</span>&nbsp;<span class="ident" id="2047185">int64</span><span class="op" id="2047190">)</span>&nbsp;<span class="ident" id="2047192">sliceStruct</span>&nbsp;<span class="op" id="2047204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047207">if</span>&nbsp;<span class="ident" id="2047210">n</span>&nbsp;<span class="op" id="2047212">&lt;</span>&nbsp;<span class="num" id="2047214">1</span>&nbsp;<span class="op" id="2047216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2047220">panic</span><span class="op" id="2047225">(</span><span class="ident" id="2047226">errorString</span><span class="op" id="2047237">(</span><span class="string" id="2047238">&#34;growslice:&nbsp;invalid&nbsp;n&#34;</span><span class="op" id="2047260">)</span><span class="op" id="2047261">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047268">cap64</span>&nbsp;<span class="op" id="2047274">:=</span>&nbsp;<span class="ident" id="2047277">int64</span><span class="op" id="2047282">(</span><span class="ident" id="2047283">old</span><span class="op" id="2047286">.</span><span class="builtinfunc" id="2047287">cap</span><span class="op" id="2047290">)</span>&nbsp;<span class="op" id="2047292">+</span>&nbsp;<span class="ident" id="2047294">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2047297">cap</span>&nbsp;<span class="op" id="2047301">:=</span>&nbsp;<span class="builtintype" id="2047304">int</span><span class="op" id="2047307">(</span><span class="ident" id="2047308">cap64</span><span class="op" id="2047313">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047317">if</span>&nbsp;<span class="ident" id="2047320">int64</span><span class="op" id="2047325">(</span><span class="builtinfunc" id="2047326">cap</span><span class="op" id="2047329">)</span>&nbsp;<span class="op" id="2047331">!=</span>&nbsp;<span class="ident" id="2047334">cap64</span>&nbsp;<span class="op" id="2047340">||</span>&nbsp;<span class="builtinfunc" id="2047343">cap</span>&nbsp;<span class="op" id="2047347">&lt;</span>&nbsp;<span class="ident" id="2047349">old</span><span class="op" id="2047352">.</span><span class="builtinfunc" id="2047353">cap</span>&nbsp;<span class="op" id="2047357">||</span>&nbsp;<span class="ident" id="2047360">t</span><span class="op" id="2047361">.</span><span class="ident" id="2047362">elem</span><span class="op" id="2047366">.</span><span class="ident" id="2047367">size</span>&nbsp;<span class="op" id="2047372">&gt;</span>&nbsp;<span class="num" id="2047374">0</span>&nbsp;<span class="op" id="2047376">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2047379">uintptr</span><span class="op" id="2047386">(</span><span class="builtinfunc" id="2047387">cap</span><span class="op" id="2047390">)</span>&nbsp;<span class="op" id="2047392">&gt;</span>&nbsp;<span class="ident" id="2047394">maxmem</span><span class="op" id="2047400">/</span><span class="builtintype" id="2047401">uintptr</span><span class="op" id="2047408">(</span><span class="ident" id="2047409">t</span><span class="op" id="2047410">.</span><span class="ident" id="2047411">elem</span><span class="op" id="2047415">.</span><span class="ident" id="2047416">size</span><span class="op" id="2047420">)</span>&nbsp;<span class="op" id="2047422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2047426">panic</span><span class="op" id="2047431">(</span><span class="ident" id="2047432">errorString</span><span class="op" id="2047443">(</span><span class="string" id="2047444">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="2047473">)</span><span class="op" id="2047474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047481">if</span>&nbsp;<span class="ident" id="2047484">raceenabled</span>&nbsp;<span class="op" id="2047496">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047500">callerpc</span>&nbsp;<span class="op" id="2047509">:=</span>&nbsp;<span class="ident" id="2047512">getcallerpc</span><span class="op" id="2047523">(</span><span class="ident" id="2047524">unsafe</span><span class="op" id="2047530">.</span><span class="ident" id="2047531">Pointer</span><span class="op" id="2047538">(</span><span class="op" id="2047539">&amp;</span><span class="ident" id="2047540">t</span><span class="op" id="2047541">)</span><span class="op" id="2047542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047546">racereadrangepc</span><span class="op" id="2047561">(</span><span class="ident" id="2047562">old</span><span class="op" id="2047565">.</span><span class="ident" id="2047566">array</span><span class="op" id="2047571">,</span>&nbsp;<span class="builtintype" id="2047573">uintptr</span><span class="op" id="2047580">(</span><span class="ident" id="2047581">old</span><span class="op" id="2047584">.</span><span class="builtinfunc" id="2047585">len</span><span class="op" id="2047588">*</span><span class="builtintype" id="2047589">int</span><span class="op" id="2047592">(</span><span class="ident" id="2047593">t</span><span class="op" id="2047594">.</span><span class="ident" id="2047595">elem</span><span class="op" id="2047599">.</span><span class="ident" id="2047600">size</span><span class="op" id="2047604">)</span><span class="op" id="2047605">)</span><span class="op" id="2047606">,</span>&nbsp;<span class="ident" id="2047608">callerpc</span><span class="op" id="2047616">,</span>&nbsp;<span class="ident" id="2047618">funcPC</span><span class="op" id="2047624">(</span><span class="ident" id="2047625">growslice</span><span class="op" id="2047634">)</span><span class="op" id="2047635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047642">et</span>&nbsp;<span class="op" id="2047645">:=</span>&nbsp;<span class="ident" id="2047648">t</span><span class="op" id="2047649">.</span><span class="ident" id="2047650">elem</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047656">if</span>&nbsp;<span class="ident" id="2047659">et</span><span class="op" id="2047661">.</span><span class="ident" id="2047662">size</span>&nbsp;<span class="op" id="2047667">==</span>&nbsp;<span class="num" id="2047670">0</span>&nbsp;<span class="op" id="2047672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047676">return</span>&nbsp;<span class="ident" id="2047683">sliceStruct</span><span class="op" id="2047694">{</span><span class="ident" id="2047695">old</span><span class="op" id="2047698">.</span><span class="ident" id="2047699">array</span><span class="op" id="2047704">,</span>&nbsp;<span class="ident" id="2047706">old</span><span class="op" id="2047709">.</span><span class="builtinfunc" id="2047710">len</span><span class="op" id="2047713">,</span>&nbsp;<span class="builtinfunc" id="2047715">cap</span><span class="op" id="2047718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047725">newcap</span>&nbsp;<span class="op" id="2047732">:=</span>&nbsp;<span class="ident" id="2047735">old</span><span class="op" id="2047738">.</span><span class="builtinfunc" id="2047739">cap</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047744">if</span>&nbsp;<span class="ident" id="2047747">newcap</span><span class="op" id="2047753">+</span><span class="ident" id="2047754">newcap</span>&nbsp;<span class="op" id="2047761">&lt;</span>&nbsp;<span class="builtinfunc" id="2047763">cap</span>&nbsp;<span class="op" id="2047767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047771">newcap</span>&nbsp;<span class="op" id="2047778">=</span>&nbsp;<span class="builtinfunc" id="2047780">cap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047785">}</span>&nbsp;<span class="keyword" id="2047787">else</span>&nbsp;<span class="op" id="2047792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047796">for</span>&nbsp;<span class="op" id="2047800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047805">if</span>&nbsp;<span class="ident" id="2047808">old</span><span class="op" id="2047811">.</span><span class="builtinfunc" id="2047812">len</span>&nbsp;<span class="op" id="2047816">&lt;</span>&nbsp;<span class="num" id="2047818">1024</span>&nbsp;<span class="op" id="2047823">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047829">newcap</span>&nbsp;<span class="op" id="2047836">+=</span>&nbsp;<span class="ident" id="2047839">newcap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047849">}</span>&nbsp;<span class="keyword" id="2047851">else</span>&nbsp;<span class="op" id="2047856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2047862">newcap</span>&nbsp;<span class="op" id="2047869">+=</span>&nbsp;<span class="ident" id="2047872">newcap</span>&nbsp;<span class="op" id="2047879">/</span>&nbsp;<span class="num" id="2047881">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047891">if</span>&nbsp;<span class="ident" id="2047894">newcap</span>&nbsp;<span class="op" id="2047901">&gt;=</span>&nbsp;<span class="builtinfunc" id="2047904">cap</span>&nbsp;<span class="op" id="2047908">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047914">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2047930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2047934">if</span>&nbsp;<span class="builtintype" id="2047937">uintptr</span><span class="op" id="2047944">(</span><span class="ident" id="2047945">newcap</span><span class="op" id="2047951">)</span>&nbsp;<span class="op" id="2047953">&gt;=</span>&nbsp;<span class="ident" id="2047956">maxmem</span><span class="op" id="2047962">/</span><span class="builtintype" id="2047963">uintptr</span><span class="op" id="2047970">(</span><span class="ident" id="2047971">et</span><span class="op" id="2047973">.</span><span class="ident" id="2047974">size</span><span class="op" id="2047978">)</span>&nbsp;<span class="op" id="2047980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2047984">panic</span><span class="op" id="2047989">(</span><span class="ident" id="2047990">errorString</span><span class="op" id="2048001">(</span><span class="string" id="2048002">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="2048031">)</span><span class="op" id="2048032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2048035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048038">lenmem</span>&nbsp;<span class="op" id="2048045">:=</span>&nbsp;<span class="builtintype" id="2048048">uintptr</span><span class="op" id="2048055">(</span><span class="ident" id="2048056">old</span><span class="op" id="2048059">.</span><span class="builtinfunc" id="2048060">len</span><span class="op" id="2048063">)</span>&nbsp;<span class="op" id="2048065">*</span>&nbsp;<span class="builtintype" id="2048067">uintptr</span><span class="op" id="2048074">(</span><span class="ident" id="2048075">et</span><span class="op" id="2048077">.</span><span class="ident" id="2048078">size</span><span class="op" id="2048082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048085">capmem</span>&nbsp;<span class="op" id="2048092">:=</span>&nbsp;<span class="ident" id="2048095">goroundupsize</span><span class="op" id="2048108">(</span><span class="builtintype" id="2048109">uintptr</span><span class="op" id="2048116">(</span><span class="ident" id="2048117">newcap</span><span class="op" id="2048123">)</span>&nbsp;<span class="op" id="2048125">*</span>&nbsp;<span class="builtintype" id="2048127">uintptr</span><span class="op" id="2048134">(</span><span class="ident" id="2048135">et</span><span class="op" id="2048137">.</span><span class="ident" id="2048138">size</span><span class="op" id="2048142">)</span><span class="op" id="2048143">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048146">newcap</span>&nbsp;<span class="op" id="2048153">=</span>&nbsp;<span class="builtintype" id="2048155">int</span><span class="op" id="2048158">(</span><span class="ident" id="2048159">capmem</span>&nbsp;<span class="op" id="2048166">/</span>&nbsp;<span class="builtintype" id="2048168">uintptr</span><span class="op" id="2048175">(</span><span class="ident" id="2048176">et</span><span class="op" id="2048178">.</span><span class="ident" id="2048179">size</span><span class="op" id="2048183">)</span><span class="op" id="2048184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048187">var</span>&nbsp;<span class="ident" id="2048191">p</span>&nbsp;<span class="ident" id="2048193">unsafe</span><span class="op" id="2048199">.</span><span class="ident" id="2048200">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048209">if</span>&nbsp;<span class="ident" id="2048212">et</span><span class="op" id="2048214">.</span><span class="ident" id="2048215">kind</span><span class="op" id="2048219">&amp;</span><span class="ident" id="2048220">kindNoPointers</span>&nbsp;<span class="op" id="2048235">!=</span>&nbsp;<span class="num" id="2048238">0</span>&nbsp;<span class="op" id="2048240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048244">p</span>&nbsp;<span class="op" id="2048246">=</span>&nbsp;<span class="ident" id="2048248">rawmem</span><span class="op" id="2048254">(</span><span class="ident" id="2048255">capmem</span><span class="op" id="2048261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048265">memclr</span><span class="op" id="2048271">(</span><span class="ident" id="2048272">add</span><span class="op" id="2048275">(</span><span class="ident" id="2048276">p</span><span class="op" id="2048277">,</span>&nbsp;<span class="ident" id="2048279">lenmem</span><span class="op" id="2048285">)</span><span class="op" id="2048286">,</span>&nbsp;<span class="ident" id="2048288">capmem</span><span class="op" id="2048294">-</span><span class="ident" id="2048295">lenmem</span><span class="op" id="2048301">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2048304">}</span>&nbsp;<span class="keyword" id="2048306">else</span>&nbsp;<span class="op" id="2048311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2048315">//&nbsp;Note:&nbsp;can&#39;t&nbsp;use&nbsp;rawmem&nbsp;(which&nbsp;avoids&nbsp;zeroing&nbsp;of&nbsp;memory),&nbsp;because&nbsp;then&nbsp;GC&nbsp;can&nbsp;scan&nbsp;unitialized&nbsp;memory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048421">p</span>&nbsp;<span class="op" id="2048423">=</span>&nbsp;<span class="ident" id="2048425">newarray</span><span class="op" id="2048433">(</span><span class="ident" id="2048434">et</span><span class="op" id="2048436">,</span>&nbsp;<span class="builtintype" id="2048438">uintptr</span><span class="op" id="2048445">(</span><span class="ident" id="2048446">newcap</span><span class="op" id="2048452">)</span><span class="op" id="2048453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2048456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048459">memmove</span><span class="op" id="2048466">(</span><span class="ident" id="2048467">p</span><span class="op" id="2048468">,</span>&nbsp;<span class="ident" id="2048470">old</span><span class="op" id="2048473">.</span><span class="ident" id="2048474">array</span><span class="op" id="2048479">,</span>&nbsp;<span class="ident" id="2048481">lenmem</span><span class="op" id="2048487">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048491">return</span>&nbsp;<span class="ident" id="2048498">sliceStruct</span><span class="op" id="2048509">{</span><span class="ident" id="2048510">p</span><span class="op" id="2048511">,</span>&nbsp;<span class="ident" id="2048513">old</span><span class="op" id="2048516">.</span><span class="builtinfunc" id="2048517">len</span><span class="op" id="2048520">,</span>&nbsp;<span class="ident" id="2048522">newcap</span><span class="op" id="2048528">}</span><br>
<span class="lineno"></span><span class="op" id="2048530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2048533">func</span>&nbsp;<span class="ident" id="2048538">slicecopy</span><span class="op" id="2048547">(</span><span class="ident" id="2048548">to</span>&nbsp;<span class="ident" id="2048551">sliceStruct</span><span class="op" id="2048562">,</span>&nbsp;<span class="ident" id="2048564">fm</span>&nbsp;<span class="ident" id="2048567">sliceStruct</span><span class="op" id="2048578">,</span>&nbsp;<span class="ident" id="2048580">width</span>&nbsp;<span class="builtintype" id="2048586">uintptr</span><span class="op" id="2048593">)</span>&nbsp;<span class="builtintype" id="2048595">int</span>&nbsp;<span class="op" id="2048599">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048602">if</span>&nbsp;<span class="ident" id="2048605">fm</span><span class="op" id="2048607">.</span><span class="builtinfunc" id="2048608">len</span>&nbsp;<span class="op" id="2048612">==</span>&nbsp;<span class="num" id="2048615">0</span>&nbsp;<span class="op" id="2048617">||</span>&nbsp;<span class="ident" id="2048620">to</span><span class="op" id="2048622">.</span><span class="builtinfunc" id="2048623">len</span>&nbsp;<span class="op" id="2048627">==</span>&nbsp;<span class="num" id="2048630">0</span>&nbsp;<span class="op" id="2048632">||</span>&nbsp;<span class="ident" id="2048635">width</span>&nbsp;<span class="op" id="2048641">==</span>&nbsp;<span class="num" id="2048644">0</span>&nbsp;<span class="op" id="2048646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048650">return</span>&nbsp;<span class="num" id="2048657">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2048660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048664">n</span>&nbsp;<span class="op" id="2048666">:=</span>&nbsp;<span class="ident" id="2048669">fm</span><span class="op" id="2048671">.</span><span class="builtinfunc" id="2048672">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048677">if</span>&nbsp;<span class="ident" id="2048680">to</span><span class="op" id="2048682">.</span><span class="builtinfunc" id="2048683">len</span>&nbsp;<span class="op" id="2048687">&lt;</span>&nbsp;<span class="ident" id="2048689">n</span>&nbsp;<span class="op" id="2048691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048695">n</span>&nbsp;<span class="op" id="2048697">=</span>&nbsp;<span class="ident" id="2048699">to</span><span class="op" id="2048701">.</span><span class="builtinfunc" id="2048702">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2048707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048711">if</span>&nbsp;<span class="ident" id="2048714">raceenabled</span>&nbsp;<span class="op" id="2048726">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048730">callerpc</span>&nbsp;<span class="op" id="2048739">:=</span>&nbsp;<span class="ident" id="2048742">getcallerpc</span><span class="op" id="2048753">(</span><span class="ident" id="2048754">unsafe</span><span class="op" id="2048760">.</span><span class="ident" id="2048761">Pointer</span><span class="op" id="2048768">(</span><span class="op" id="2048769">&amp;</span><span class="ident" id="2048770">to</span><span class="op" id="2048772">)</span><span class="op" id="2048773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048777">pc</span>&nbsp;<span class="op" id="2048780">:=</span>&nbsp;<span class="ident" id="2048783">funcPC</span><span class="op" id="2048789">(</span><span class="ident" id="2048790">slicecopy</span><span class="op" id="2048799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048803">racewriterangepc</span><span class="op" id="2048819">(</span><span class="ident" id="2048820">to</span><span class="op" id="2048822">.</span><span class="ident" id="2048823">array</span><span class="op" id="2048828">,</span>&nbsp;<span class="builtintype" id="2048830">uintptr</span><span class="op" id="2048837">(</span><span class="ident" id="2048838">n</span><span class="op" id="2048839">*</span><span class="builtintype" id="2048840">int</span><span class="op" id="2048843">(</span><span class="ident" id="2048844">width</span><span class="op" id="2048849">)</span><span class="op" id="2048850">)</span><span class="op" id="2048851">,</span>&nbsp;<span class="ident" id="2048853">callerpc</span><span class="op" id="2048861">,</span>&nbsp;<span class="ident" id="2048863">pc</span><span class="op" id="2048865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048869">racereadrangepc</span><span class="op" id="2048884">(</span><span class="ident" id="2048885">fm</span><span class="op" id="2048887">.</span><span class="ident" id="2048888">array</span><span class="op" id="2048893">,</span>&nbsp;<span class="builtintype" id="2048895">uintptr</span><span class="op" id="2048902">(</span><span class="ident" id="2048903">n</span><span class="op" id="2048904">*</span><span class="builtintype" id="2048905">int</span><span class="op" id="2048908">(</span><span class="ident" id="2048909">width</span><span class="op" id="2048914">)</span><span class="op" id="2048915">)</span><span class="op" id="2048916">,</span>&nbsp;<span class="ident" id="2048918">callerpc</span><span class="op" id="2048926">,</span>&nbsp;<span class="ident" id="2048928">pc</span><span class="op" id="2048930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2048933">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2048937">size</span>&nbsp;<span class="op" id="2048942">:=</span>&nbsp;<span class="builtintype" id="2048945">uintptr</span><span class="op" id="2048952">(</span><span class="ident" id="2048953">n</span><span class="op" id="2048954">)</span>&nbsp;<span class="op" id="2048956">*</span>&nbsp;<span class="ident" id="2048958">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2048965">if</span>&nbsp;<span class="ident" id="2048968">size</span>&nbsp;<span class="op" id="2048973">==</span>&nbsp;<span class="num" id="2048976">1</span>&nbsp;<span class="op" id="2048978">{</span>&nbsp;<span class="comment" id="2048980">//&nbsp;common&nbsp;case&nbsp;worth&nbsp;about&nbsp;2x&nbsp;to&nbsp;do&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2049023">//&nbsp;TODO:&nbsp;is&nbsp;this&nbsp;still&nbsp;worth&nbsp;it&nbsp;with&nbsp;new&nbsp;memmove&nbsp;impl?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2049080">*</span><span class="op" id="2049081">(</span><span class="op" id="2049082">*</span><span class="builtintype" id="2049083">byte</span><span class="op" id="2049087">)</span><span class="op" id="2049088">(</span><span class="ident" id="2049089">to</span><span class="op" id="2049091">.</span><span class="ident" id="2049092">array</span><span class="op" id="2049097">)</span>&nbsp;<span class="op" id="2049099">=</span>&nbsp;<span class="op" id="2049101">*</span><span class="op" id="2049102">(</span><span class="op" id="2049103">*</span><span class="builtintype" id="2049104">byte</span><span class="op" id="2049108">)</span><span class="op" id="2049109">(</span><span class="ident" id="2049110">fm</span><span class="op" id="2049112">.</span><span class="ident" id="2049113">array</span><span class="op" id="2049118">)</span>&nbsp;<span class="comment" id="2049120">//&nbsp;known&nbsp;to&nbsp;be&nbsp;a&nbsp;byte&nbsp;pointer</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2049151">}</span>&nbsp;<span class="keyword" id="2049153">else</span>&nbsp;<span class="op" id="2049158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2049162">memmove</span><span class="op" id="2049169">(</span><span class="ident" id="2049170">to</span><span class="op" id="2049172">.</span><span class="ident" id="2049173">array</span><span class="op" id="2049178">,</span>&nbsp;<span class="ident" id="2049180">fm</span><span class="op" id="2049182">.</span><span class="ident" id="2049183">array</span><span class="op" id="2049188">,</span>&nbsp;<span class="ident" id="2049190">size</span><span class="op" id="2049194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2049197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2049200">return</span>&nbsp;<span class="builtintype" id="2049207">int</span><span class="op" id="2049210">(</span><span class="ident" id="2049211">n</span><span class="op" id="2049212">)</span><br>
<span class="lineno"></span><span class="op" id="2049214">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="2049217">func</span>&nbsp;<span class="ident" id="2049222">slicestringcopy</span><span class="op" id="2049237">(</span><span class="ident" id="2049238">to</span>&nbsp;<span class="op" id="2049241">[</span><span class="op" id="2049242">]</span><span class="builtintype" id="2049243">byte</span><span class="op" id="2049247">,</span>&nbsp;<span class="ident" id="2049249">fm</span>&nbsp;<span class="builtintype" id="2049252">string</span><span class="op" id="2049258">)</span>&nbsp;<span class="builtintype" id="2049260">int</span>&nbsp;<span class="op" id="2049264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2049267">if</span>&nbsp;<span class="builtinfunc" id="2049270">len</span><span class="op" id="2049273">(</span><span class="ident" id="2049274">fm</span><span class="op" id="2049276">)</span>&nbsp;<span class="op" id="2049278">==</span>&nbsp;<span class="num" id="2049281">0</span>&nbsp;<span class="op" id="2049283">||</span>&nbsp;<span class="builtinfunc" id="2049286">len</span><span class="op" id="2049289">(</span><span class="ident" id="2049290">to</span><span class="op" id="2049292">)</span>&nbsp;<span class="op" id="2049294">==</span>&nbsp;<span class="num" id="2049297">0</span>&nbsp;<span class="op" id="2049299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2049303">return</span>&nbsp;<span class="num" id="2049310">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2049313">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2049317">n</span>&nbsp;<span class="op" id="2049319">:=</span>&nbsp;<span class="builtinfunc" id="2049322">len</span><span class="op" id="2049325">(</span><span class="ident" id="2049326">fm</span><span class="op" id="2049328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2049331">if</span>&nbsp;<span class="builtinfunc" id="2049334">len</span><span class="op" id="2049337">(</span><span class="ident" id="2049338">to</span><span class="op" id="2049340">)</span>&nbsp;<span class="op" id="2049342">&lt;</span>&nbsp;<span class="ident" id="2049344">n</span>&nbsp;<span class="op" id="2049346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2049350">n</span>&nbsp;<span class="op" id="2049352">=</span>&nbsp;<span class="builtinfunc" id="2049354">len</span><span class="op" id="2049357">(</span><span class="ident" id="2049358">to</span><span class="op" id="2049360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2049363">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2049367">if</span>&nbsp;<span class="ident" id="2049370">raceenabled</span>&nbsp;<span class="op" id="2049382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2049386">callerpc</span>&nbsp;<span class="op" id="2049395">:=</span>&nbsp;<span class="ident" id="2049398">getcallerpc</span><span class="op" id="2049409">(</span><span class="ident" id="2049410">unsafe</span><span class="op" id="2049416">.</span><span class="ident" id="2049417">Pointer</span><span class="op" id="2049424">(</span><span class="op" id="2049425">&amp;</span><span class="ident" id="2049426">to</span><span class="op" id="2049428">)</span><span class="op" id="2049429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2049433">pc</span>&nbsp;<span class="op" id="2049436">:=</span>&nbsp;<span class="ident" id="2049439">funcPC</span><span class="op" id="2049445">(</span><span class="ident" id="2049446">slicestringcopy</span><span class="op" id="2049461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2049465">racewriterangepc</span><span class="op" id="2049481">(</span><span class="ident" id="2049482">unsafe</span><span class="op" id="2049488">.</span><span class="ident" id="2049489">Pointer</span><span class="op" id="2049496">(</span><span class="op" id="2049497">&amp;</span><span class="ident" id="2049498">to</span><span class="op" id="2049500">[</span><span class="num" id="2049501">0</span><span class="op" id="2049502">]</span><span class="op" id="2049503">)</span><span class="op" id="2049504">,</span>&nbsp;<span class="builtintype" id="2049506">uintptr</span><span class="op" id="2049513">(</span><span class="ident" id="2049514">n</span><span class="op" id="2049515">)</span><span class="op" id="2049516">,</span>&nbsp;<span class="ident" id="2049518">callerpc</span><span class="op" id="2049526">,</span>&nbsp;<span class="ident" id="2049528">pc</span><span class="op" id="2049530">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2049533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2049537">memmove</span><span class="op" id="2049544">(</span><span class="ident" id="2049545">unsafe</span><span class="op" id="2049551">.</span><span class="ident" id="2049552">Pointer</span><span class="op" id="2049559">(</span><span class="op" id="2049560">&amp;</span><span class="ident" id="2049561">to</span><span class="op" id="2049563">[</span><span class="num" id="2049564">0</span><span class="op" id="2049565">]</span><span class="op" id="2049566">)</span><span class="op" id="2049567">,</span>&nbsp;<span class="ident" id="2049569">unsafe</span><span class="op" id="2049575">.</span><span class="ident" id="2049576">Pointer</span><span class="op" id="2049583">(</span><span class="op" id="2049584">(</span><span class="op" id="2049585">*</span><span class="ident" id="2049586">stringStruct</span><span class="op" id="2049598">)</span><span class="op" id="2049599">(</span><span class="ident" id="2049600">unsafe</span><span class="op" id="2049606">.</span><span class="ident" id="2049607">Pointer</span><span class="op" id="2049614">(</span><span class="op" id="2049615">&amp;</span><span class="ident" id="2049616">fm</span><span class="op" id="2049618">)</span><span class="op" id="2049619">)</span><span class="op" id="2049620">.</span><span class="ident" id="2049621">str</span><span class="op" id="2049624">)</span><span class="op" id="2049625">,</span>&nbsp;<span class="builtintype" id="2049627">uintptr</span><span class="op" id="2049634">(</span><span class="ident" id="2049635">n</span><span class="op" id="2049636">)</span><span class="op" id="2049637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2049640">return</span>&nbsp;<span class="ident" id="2049647">n</span><br>
<span class="lineno"></span><span class="op" id="2049649">}</span>
</div>
</body>
</html>
