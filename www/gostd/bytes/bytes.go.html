<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bytes</h2>
<ul>
<li><a href="/gostd/bytes/buffer.go.html">buffer.go</a></li>
<li><a href="/gostd/bytes/buffer_test.go.html">buffer_test.go</a></li>
<li><a href="/gostd/bytes/bytes.go.html" class="current">bytes.go</a></li>
<li><a href="/gostd/bytes/bytes_decl.go.html">bytes_decl.go</a></li>
<li><a href="/gostd/bytes/bytes_test.go.html">bytes_test.go</a></li>
<li><a href="/gostd/bytes/compare_test.go.html">compare_test.go</a></li>
<li><a href="/gostd/bytes/equal_test.go.html">equal_test.go</a></li>
<li><a href="/gostd/bytes/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bytes/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bytes/reader.go.html">reader.go</a></li>
<li><a href="/gostd/bytes/reader_test.go.html">reader_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1392748">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1392803">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1392857">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1392908">//&nbsp;Package&nbsp;bytes&nbsp;implements&nbsp;functions&nbsp;for&nbsp;the&nbsp;manipulation&nbsp;of&nbsp;byte&nbsp;slices.</span><br>
<span class="lineno"></span><span class="comment" id="1392983">//&nbsp;It&nbsp;is&nbsp;analogous&nbsp;to&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;strings&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="1393044">package</span>&nbsp;<span class="ident" id="1393052">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1393059">import</span>&nbsp;<span class="op" id="1393066">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1393069">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1393080">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="1393095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1393098">func</span>&nbsp;<span class="ident" id="1393103">equalPortable</span><span class="op" id="1393116">(</span><span class="ident" id="1393117">a</span><span class="op" id="1393118">,</span>&nbsp;<span class="ident" id="1393120">b</span>&nbsp;<span class="op" id="1393122">[</span><span class="op" id="1393123">]</span><span class="builtintype" id="1393124">byte</span><span class="op" id="1393128">)</span>&nbsp;<span class="builtintype" id="1393130">bool</span>&nbsp;<span class="op" id="1393135">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393138">if</span>&nbsp;<span class="builtinfunc" id="1393141">len</span><span class="op" id="1393144">(</span><span class="ident" id="1393145">a</span><span class="op" id="1393146">)</span>&nbsp;<span class="op" id="1393148">!=</span>&nbsp;<span class="builtinfunc" id="1393151">len</span><span class="op" id="1393154">(</span><span class="ident" id="1393155">b</span><span class="op" id="1393156">)</span>&nbsp;<span class="op" id="1393158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393162">return</span>&nbsp;<span class="builtintype" id="1393169">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393179">for</span>&nbsp;<span class="ident" id="1393183">i</span><span class="op" id="1393184">,</span>&nbsp;<span class="ident" id="1393186">c</span>&nbsp;<span class="op" id="1393188">:=</span>&nbsp;<span class="keyword" id="1393191">range</span>&nbsp;<span class="ident" id="1393197">a</span>&nbsp;<span class="op" id="1393199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393203">if</span>&nbsp;<span class="ident" id="1393206">c</span>&nbsp;<span class="op" id="1393208">!=</span>&nbsp;<span class="ident" id="1393211">b</span><span class="op" id="1393212">[</span><span class="ident" id="1393213">i</span><span class="op" id="1393214">]</span>&nbsp;<span class="op" id="1393216">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393221">return</span>&nbsp;<span class="builtintype" id="1393228">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393242">return</span>&nbsp;<span class="builtintype" id="1393249">true</span><br>
<span class="lineno"></span><span class="op" id="1393254">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="1393257">//&nbsp;explode&nbsp;splits&nbsp;s&nbsp;into&nbsp;a&nbsp;slice&nbsp;of&nbsp;UTF-8&nbsp;sequences,&nbsp;one&nbsp;per&nbsp;Unicode&nbsp;character&nbsp;(still&nbsp;slices&nbsp;of&nbsp;bytes),</span><br>
<span class="lineno"></span><span class="comment" id="1393361">//&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;n&nbsp;byte&nbsp;slices.&nbsp;Invalid&nbsp;UTF-8&nbsp;sequences&nbsp;are&nbsp;chopped&nbsp;into&nbsp;individual&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="1393457">func</span>&nbsp;<span class="ident" id="1393462">explode</span><span class="op" id="1393469">(</span><span class="ident" id="1393470">s</span>&nbsp;<span class="op" id="1393472">[</span><span class="op" id="1393473">]</span><span class="builtintype" id="1393474">byte</span><span class="op" id="1393478">,</span>&nbsp;<span class="ident" id="1393480">n</span>&nbsp;<span class="builtintype" id="1393482">int</span><span class="op" id="1393485">)</span>&nbsp;<span class="op" id="1393487">[</span><span class="op" id="1393488">]</span><span class="op" id="1393489">[</span><span class="op" id="1393490">]</span><span class="builtintype" id="1393491">byte</span>&nbsp;<span class="op" id="1393496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393499">if</span>&nbsp;<span class="ident" id="1393502">n</span>&nbsp;<span class="op" id="1393504">&lt;=</span>&nbsp;<span class="num" id="1393507">0</span>&nbsp;<span class="op" id="1393509">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393513">n</span>&nbsp;<span class="op" id="1393515">=</span>&nbsp;<span class="builtinfunc" id="1393517">len</span><span class="op" id="1393520">(</span><span class="ident" id="1393521">s</span><span class="op" id="1393522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393528">a</span>&nbsp;<span class="op" id="1393530">:=</span>&nbsp;<span class="builtinfunc" id="1393533">make</span><span class="op" id="1393537">(</span><span class="op" id="1393538">[</span><span class="op" id="1393539">]</span><span class="op" id="1393540">[</span><span class="op" id="1393541">]</span><span class="builtintype" id="1393542">byte</span><span class="op" id="1393546">,</span>&nbsp;<span class="ident" id="1393548">n</span><span class="op" id="1393549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393552">var</span>&nbsp;<span class="ident" id="1393556">size</span>&nbsp;<span class="builtintype" id="1393561">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393566">na</span>&nbsp;<span class="op" id="1393569">:=</span>&nbsp;<span class="num" id="1393572">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393575">for</span>&nbsp;<span class="builtinfunc" id="1393579">len</span><span class="op" id="1393582">(</span><span class="ident" id="1393583">s</span><span class="op" id="1393584">)</span>&nbsp;<span class="op" id="1393586">&gt;</span>&nbsp;<span class="num" id="1393588">0</span>&nbsp;<span class="op" id="1393590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393594">if</span>&nbsp;<span class="ident" id="1393597">na</span><span class="op" id="1393599">+</span><span class="num" id="1393600">1</span>&nbsp;<span class="op" id="1393602">&gt;=</span>&nbsp;<span class="ident" id="1393605">n</span>&nbsp;<span class="op" id="1393607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393612">a</span><span class="op" id="1393613">[</span><span class="ident" id="1393614">na</span><span class="op" id="1393616">]</span>&nbsp;<span class="op" id="1393618">=</span>&nbsp;<span class="ident" id="1393620">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393625">na</span><span class="op" id="1393627">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393633">break</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393645">_</span><span class="op" id="1393646">,</span>&nbsp;<span class="ident" id="1393648">size</span>&nbsp;<span class="op" id="1393653">=</span>&nbsp;<span class="ident" id="1393655">utf8</span><span class="op" id="1393659">.</span><span class="ident" id="1393660">DecodeRune</span><span class="op" id="1393670">(</span><span class="ident" id="1393671">s</span><span class="op" id="1393672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393676">a</span><span class="op" id="1393677">[</span><span class="ident" id="1393678">na</span><span class="op" id="1393680">]</span>&nbsp;<span class="op" id="1393682">=</span>&nbsp;<span class="ident" id="1393684">s</span><span class="op" id="1393685">[</span><span class="num" id="1393686">0</span><span class="op" id="1393687">:</span><span class="ident" id="1393688">size</span><span class="op" id="1393692">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393696">s</span>&nbsp;<span class="op" id="1393698">=</span>&nbsp;<span class="ident" id="1393700">s</span><span class="op" id="1393701">[</span><span class="ident" id="1393702">size</span><span class="op" id="1393706">:</span><span class="op" id="1393707">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393711">na</span><span class="op" id="1393713">++</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393720">return</span>&nbsp;<span class="ident" id="1393727">a</span><span class="op" id="1393728">[</span><span class="num" id="1393729">0</span><span class="op" id="1393730">:</span><span class="ident" id="1393731">na</span><span class="op" id="1393733">]</span><br>
<span class="lineno"></span><span class="op" id="1393735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1393738">//&nbsp;Count&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;sep&nbsp;in&nbsp;s.</span><br>
<span class="lineno">50</span><span class="keyword" id="1393807">func</span>&nbsp;<span class="ident" id="1393812">Count</span><span class="op" id="1393817">(</span><span class="ident" id="1393818">s</span><span class="op" id="1393819">,</span>&nbsp;<span class="ident" id="1393821">sep</span>&nbsp;<span class="op" id="1393825">[</span><span class="op" id="1393826">]</span><span class="builtintype" id="1393827">byte</span><span class="op" id="1393831">)</span>&nbsp;<span class="builtintype" id="1393833">int</span>&nbsp;<span class="op" id="1393837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393840">n</span>&nbsp;<span class="op" id="1393842">:=</span>&nbsp;<span class="builtinfunc" id="1393845">len</span><span class="op" id="1393848">(</span><span class="ident" id="1393849">sep</span><span class="op" id="1393852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393855">if</span>&nbsp;<span class="ident" id="1393858">n</span>&nbsp;<span class="op" id="1393860">==</span>&nbsp;<span class="num" id="1393863">0</span>&nbsp;<span class="op" id="1393865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393869">return</span>&nbsp;<span class="ident" id="1393876">utf8</span><span class="op" id="1393880">.</span><span class="ident" id="1393881">RuneCount</span><span class="op" id="1393890">(</span><span class="ident" id="1393891">s</span><span class="op" id="1393892">)</span>&nbsp;<span class="op" id="1393894">+</span>&nbsp;<span class="num" id="1393896">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393899">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393902">if</span>&nbsp;<span class="ident" id="1393905">n</span>&nbsp;<span class="op" id="1393907">&gt;</span>&nbsp;<span class="builtinfunc" id="1393909">len</span><span class="op" id="1393912">(</span><span class="ident" id="1393913">s</span><span class="op" id="1393914">)</span>&nbsp;<span class="op" id="1393916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393920">return</span>&nbsp;<span class="num" id="1393927">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1393930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393933">count</span>&nbsp;<span class="op" id="1393939">:=</span>&nbsp;<span class="num" id="1393942">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393945">c</span>&nbsp;<span class="op" id="1393947">:=</span>&nbsp;<span class="ident" id="1393950">sep</span><span class="op" id="1393953">[</span><span class="num" id="1393954">0</span><span class="op" id="1393955">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393958">i</span>&nbsp;<span class="op" id="1393960">:=</span>&nbsp;<span class="num" id="1393963">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1393966">t</span>&nbsp;<span class="op" id="1393968">:=</span>&nbsp;<span class="ident" id="1393971">s</span><span class="op" id="1393972">[</span><span class="op" id="1393973">:</span><span class="builtinfunc" id="1393974">len</span><span class="op" id="1393977">(</span><span class="ident" id="1393978">s</span><span class="op" id="1393979">)</span><span class="op" id="1393980">-</span><span class="ident" id="1393981">n</span><span class="op" id="1393982">+</span><span class="num" id="1393983">1</span><span class="op" id="1393984">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1393987">for</span>&nbsp;<span class="ident" id="1393991">i</span>&nbsp;<span class="op" id="1393993">&lt;</span>&nbsp;<span class="builtinfunc" id="1393995">len</span><span class="op" id="1393998">(</span><span class="ident" id="1393999">t</span><span class="op" id="1394000">)</span>&nbsp;<span class="op" id="1394002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394006">if</span>&nbsp;<span class="ident" id="1394009">t</span><span class="op" id="1394010">[</span><span class="ident" id="1394011">i</span><span class="op" id="1394012">]</span>&nbsp;<span class="op" id="1394014">!=</span>&nbsp;<span class="ident" id="1394017">c</span>&nbsp;<span class="op" id="1394019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394024">o</span>&nbsp;<span class="op" id="1394026">:=</span>&nbsp;<span class="ident" id="1394029">IndexByte</span><span class="op" id="1394038">(</span><span class="ident" id="1394039">t</span><span class="op" id="1394040">[</span><span class="ident" id="1394041">i</span><span class="op" id="1394042">:</span><span class="op" id="1394043">]</span><span class="op" id="1394044">,</span>&nbsp;<span class="ident" id="1394046">c</span><span class="op" id="1394047">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394052">if</span>&nbsp;<span class="ident" id="1394055">o</span>&nbsp;<span class="op" id="1394057">&lt;</span>&nbsp;<span class="num" id="1394059">0</span>&nbsp;<span class="op" id="1394061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394067">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394081">i</span>&nbsp;<span class="op" id="1394083">+=</span>&nbsp;<span class="ident" id="1394086">o</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394090">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394094">if</span>&nbsp;<span class="ident" id="1394097">n</span>&nbsp;<span class="op" id="1394099">==</span>&nbsp;<span class="num" id="1394102">1</span>&nbsp;<span class="op" id="1394104">||</span>&nbsp;<span class="ident" id="1394107">Equal</span><span class="op" id="1394112">(</span><span class="ident" id="1394113">s</span><span class="op" id="1394114">[</span><span class="ident" id="1394115">i</span><span class="op" id="1394116">:</span><span class="ident" id="1394117">i</span><span class="op" id="1394118">+</span><span class="ident" id="1394119">n</span><span class="op" id="1394120">]</span><span class="op" id="1394121">,</span>&nbsp;<span class="ident" id="1394123">sep</span><span class="op" id="1394126">)</span>&nbsp;<span class="op" id="1394128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394133">count</span><span class="op" id="1394138">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394144">i</span>&nbsp;<span class="op" id="1394146">+=</span>&nbsp;<span class="ident" id="1394149">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394154">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394165">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394169">i</span><span class="op" id="1394170">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394177">return</span>&nbsp;<span class="ident" id="1394184">count</span><br>
<span class="lineno"></span><span class="op" id="1394190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="1394193">//&nbsp;Contains&nbsp;reports&nbsp;whether&nbsp;subslice&nbsp;is&nbsp;within&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="1394243">func</span>&nbsp;<span class="ident" id="1394248">Contains</span><span class="op" id="1394256">(</span><span class="ident" id="1394257">b</span><span class="op" id="1394258">,</span>&nbsp;<span class="ident" id="1394260">subslice</span>&nbsp;<span class="op" id="1394269">[</span><span class="op" id="1394270">]</span><span class="builtintype" id="1394271">byte</span><span class="op" id="1394275">)</span>&nbsp;<span class="builtintype" id="1394277">bool</span>&nbsp;<span class="op" id="1394282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394285">return</span>&nbsp;<span class="ident" id="1394292">Index</span><span class="op" id="1394297">(</span><span class="ident" id="1394298">b</span><span class="op" id="1394299">,</span>&nbsp;<span class="ident" id="1394301">subslice</span><span class="op" id="1394309">)</span>&nbsp;<span class="op" id="1394311">!=</span>&nbsp;<span class="op" id="1394314">-</span><span class="num" id="1394315">1</span><br>
<span class="lineno"></span><span class="op" id="1394317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1394320">//&nbsp;Index&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="1394416">func</span>&nbsp;<span class="ident" id="1394421">Index</span><span class="op" id="1394426">(</span><span class="ident" id="1394427">s</span><span class="op" id="1394428">,</span>&nbsp;<span class="ident" id="1394430">sep</span>&nbsp;<span class="op" id="1394434">[</span><span class="op" id="1394435">]</span><span class="builtintype" id="1394436">byte</span><span class="op" id="1394440">)</span>&nbsp;<span class="builtintype" id="1394442">int</span>&nbsp;<span class="op" id="1394446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394449">n</span>&nbsp;<span class="op" id="1394451">:=</span>&nbsp;<span class="builtinfunc" id="1394454">len</span><span class="op" id="1394457">(</span><span class="ident" id="1394458">sep</span><span class="op" id="1394461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394464">if</span>&nbsp;<span class="ident" id="1394467">n</span>&nbsp;<span class="op" id="1394469">==</span>&nbsp;<span class="num" id="1394472">0</span>&nbsp;<span class="op" id="1394474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394478">return</span>&nbsp;<span class="num" id="1394485">0</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394491">if</span>&nbsp;<span class="ident" id="1394494">n</span>&nbsp;<span class="op" id="1394496">&gt;</span>&nbsp;<span class="builtinfunc" id="1394498">len</span><span class="op" id="1394501">(</span><span class="ident" id="1394502">s</span><span class="op" id="1394503">)</span>&nbsp;<span class="op" id="1394505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394509">return</span>&nbsp;<span class="op" id="1394516">-</span><span class="num" id="1394517">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394523">c</span>&nbsp;<span class="op" id="1394525">:=</span>&nbsp;<span class="ident" id="1394528">sep</span><span class="op" id="1394531">[</span><span class="num" id="1394532">0</span><span class="op" id="1394533">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394536">if</span>&nbsp;<span class="ident" id="1394539">n</span>&nbsp;<span class="op" id="1394541">==</span>&nbsp;<span class="num" id="1394544">1</span>&nbsp;<span class="op" id="1394546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394550">return</span>&nbsp;<span class="ident" id="1394557">IndexByte</span><span class="op" id="1394566">(</span><span class="ident" id="1394567">s</span><span class="op" id="1394568">,</span>&nbsp;<span class="ident" id="1394570">c</span><span class="op" id="1394571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394577">i</span>&nbsp;<span class="op" id="1394579">:=</span>&nbsp;<span class="num" id="1394582">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394585">t</span>&nbsp;<span class="op" id="1394587">:=</span>&nbsp;<span class="ident" id="1394590">s</span><span class="op" id="1394591">[</span><span class="op" id="1394592">:</span><span class="builtinfunc" id="1394593">len</span><span class="op" id="1394596">(</span><span class="ident" id="1394597">s</span><span class="op" id="1394598">)</span><span class="op" id="1394599">-</span><span class="ident" id="1394600">n</span><span class="op" id="1394601">+</span><span class="num" id="1394602">1</span><span class="op" id="1394603">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394606">for</span>&nbsp;<span class="ident" id="1394610">i</span>&nbsp;<span class="op" id="1394612">&lt;</span>&nbsp;<span class="builtinfunc" id="1394614">len</span><span class="op" id="1394617">(</span><span class="ident" id="1394618">t</span><span class="op" id="1394619">)</span>&nbsp;<span class="op" id="1394621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394625">if</span>&nbsp;<span class="ident" id="1394628">t</span><span class="op" id="1394629">[</span><span class="ident" id="1394630">i</span><span class="op" id="1394631">]</span>&nbsp;<span class="op" id="1394633">!=</span>&nbsp;<span class="ident" id="1394636">c</span>&nbsp;<span class="op" id="1394638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394643">o</span>&nbsp;<span class="op" id="1394645">:=</span>&nbsp;<span class="ident" id="1394648">IndexByte</span><span class="op" id="1394657">(</span><span class="ident" id="1394658">t</span><span class="op" id="1394659">[</span><span class="ident" id="1394660">i</span><span class="op" id="1394661">:</span><span class="op" id="1394662">]</span><span class="op" id="1394663">,</span>&nbsp;<span class="ident" id="1394665">c</span><span class="op" id="1394666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394671">if</span>&nbsp;<span class="ident" id="1394674">o</span>&nbsp;<span class="op" id="1394676">&lt;</span>&nbsp;<span class="num" id="1394678">0</span>&nbsp;<span class="op" id="1394680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394686">break</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394700">i</span>&nbsp;<span class="op" id="1394702">+=</span>&nbsp;<span class="ident" id="1394705">o</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394713">if</span>&nbsp;<span class="ident" id="1394716">Equal</span><span class="op" id="1394721">(</span><span class="ident" id="1394722">s</span><span class="op" id="1394723">[</span><span class="ident" id="1394724">i</span><span class="op" id="1394725">:</span><span class="ident" id="1394726">i</span><span class="op" id="1394727">+</span><span class="ident" id="1394728">n</span><span class="op" id="1394729">]</span><span class="op" id="1394730">,</span>&nbsp;<span class="ident" id="1394732">sep</span><span class="op" id="1394735">)</span>&nbsp;<span class="op" id="1394737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394742">return</span>&nbsp;<span class="ident" id="1394749">i</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1394757">i</span><span class="op" id="1394758">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394765">return</span>&nbsp;<span class="op" id="1394772">-</span><span class="num" id="1394773">1</span><br>
<span class="lineno"></span><span class="op" id="1394775">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="1394778">func</span>&nbsp;<span class="ident" id="1394783">indexBytePortable</span><span class="op" id="1394800">(</span><span class="ident" id="1394801">s</span>&nbsp;<span class="op" id="1394803">[</span><span class="op" id="1394804">]</span><span class="builtintype" id="1394805">byte</span><span class="op" id="1394809">,</span>&nbsp;<span class="ident" id="1394811">c</span>&nbsp;<span class="builtintype" id="1394813">byte</span><span class="op" id="1394817">)</span>&nbsp;<span class="builtintype" id="1394819">int</span>&nbsp;<span class="op" id="1394823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394826">for</span>&nbsp;<span class="ident" id="1394830">i</span><span class="op" id="1394831">,</span>&nbsp;<span class="ident" id="1394833">b</span>&nbsp;<span class="op" id="1394835">:=</span>&nbsp;<span class="keyword" id="1394838">range</span>&nbsp;<span class="ident" id="1394844">s</span>&nbsp;<span class="op" id="1394846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394850">if</span>&nbsp;<span class="ident" id="1394853">b</span>&nbsp;<span class="op" id="1394855">==</span>&nbsp;<span class="ident" id="1394858">c</span>&nbsp;<span class="op" id="1394860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394865">return</span>&nbsp;<span class="ident" id="1394872">i</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1394879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1394882">return</span>&nbsp;<span class="op" id="1394889">-</span><span class="num" id="1394890">1</span><br>
<span class="lineno"></span><span class="op" id="1394892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="1394895">//&nbsp;LastIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="1394994">func</span>&nbsp;<span class="ident" id="1394999">LastIndex</span><span class="op" id="1395008">(</span><span class="ident" id="1395009">s</span><span class="op" id="1395010">,</span>&nbsp;<span class="ident" id="1395012">sep</span>&nbsp;<span class="op" id="1395016">[</span><span class="op" id="1395017">]</span><span class="builtintype" id="1395018">byte</span><span class="op" id="1395022">)</span>&nbsp;<span class="builtintype" id="1395024">int</span>&nbsp;<span class="op" id="1395028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1395031">n</span>&nbsp;<span class="op" id="1395033">:=</span>&nbsp;<span class="builtinfunc" id="1395036">len</span><span class="op" id="1395039">(</span><span class="ident" id="1395040">sep</span><span class="op" id="1395043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395046">if</span>&nbsp;<span class="ident" id="1395049">n</span>&nbsp;<span class="op" id="1395051">==</span>&nbsp;<span class="num" id="1395054">0</span>&nbsp;<span class="op" id="1395056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395060">return</span>&nbsp;<span class="builtinfunc" id="1395067">len</span><span class="op" id="1395070">(</span><span class="ident" id="1395071">s</span><span class="op" id="1395072">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1395075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1395078">c</span>&nbsp;<span class="op" id="1395080">:=</span>&nbsp;<span class="ident" id="1395083">sep</span><span class="op" id="1395086">[</span><span class="num" id="1395087">0</span><span class="op" id="1395088">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395091">for</span>&nbsp;<span class="ident" id="1395095">i</span>&nbsp;<span class="op" id="1395097">:=</span>&nbsp;<span class="builtinfunc" id="1395100">len</span><span class="op" id="1395103">(</span><span class="ident" id="1395104">s</span><span class="op" id="1395105">)</span>&nbsp;<span class="op" id="1395107">-</span>&nbsp;<span class="ident" id="1395109">n</span><span class="op" id="1395110">;</span>&nbsp;<span class="ident" id="1395112">i</span>&nbsp;<span class="op" id="1395114">&gt;=</span>&nbsp;<span class="num" id="1395117">0</span><span class="op" id="1395118">;</span>&nbsp;<span class="ident" id="1395120">i</span><span class="op" id="1395121">--</span>&nbsp;<span class="op" id="1395124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395128">if</span>&nbsp;<span class="ident" id="1395131">s</span><span class="op" id="1395132">[</span><span class="ident" id="1395133">i</span><span class="op" id="1395134">]</span>&nbsp;<span class="op" id="1395136">==</span>&nbsp;<span class="ident" id="1395139">c</span>&nbsp;<span class="op" id="1395141">&amp;&amp;</span>&nbsp;<span class="op" id="1395144">(</span><span class="ident" id="1395145">n</span>&nbsp;<span class="op" id="1395147">==</span>&nbsp;<span class="num" id="1395150">1</span>&nbsp;<span class="op" id="1395152">||</span>&nbsp;<span class="ident" id="1395155">Equal</span><span class="op" id="1395160">(</span><span class="ident" id="1395161">s</span><span class="op" id="1395162">[</span><span class="ident" id="1395163">i</span><span class="op" id="1395164">:</span><span class="ident" id="1395165">i</span><span class="op" id="1395166">+</span><span class="ident" id="1395167">n</span><span class="op" id="1395168">]</span><span class="op" id="1395169">,</span>&nbsp;<span class="ident" id="1395171">sep</span><span class="op" id="1395174">)</span><span class="op" id="1395175">)</span>&nbsp;<span class="op" id="1395177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395182">return</span>&nbsp;<span class="ident" id="1395189">i</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1395193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1395196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395199">return</span>&nbsp;<span class="op" id="1395206">-</span><span class="num" id="1395207">1</span><br>
<span class="lineno"></span><span class="op" id="1395209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1395212">//&nbsp;IndexRune&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="1395290">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;given&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1395367">//&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;rune&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="1395413">func</span>&nbsp;<span class="ident" id="1395418">IndexRune</span><span class="op" id="1395427">(</span><span class="ident" id="1395428">s</span>&nbsp;<span class="op" id="1395430">[</span><span class="op" id="1395431">]</span><span class="builtintype" id="1395432">byte</span><span class="op" id="1395436">,</span>&nbsp;<span class="ident" id="1395438">r</span>&nbsp;<span class="builtintype" id="1395440">rune</span><span class="op" id="1395444">)</span>&nbsp;<span class="builtintype" id="1395446">int</span>&nbsp;<span class="op" id="1395450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395453">for</span>&nbsp;<span class="ident" id="1395457">i</span>&nbsp;<span class="op" id="1395459">:=</span>&nbsp;<span class="num" id="1395462">0</span><span class="op" id="1395463">;</span>&nbsp;<span class="ident" id="1395465">i</span>&nbsp;<span class="op" id="1395467">&lt;</span>&nbsp;<span class="builtinfunc" id="1395469">len</span><span class="op" id="1395472">(</span><span class="ident" id="1395473">s</span><span class="op" id="1395474">)</span><span class="op" id="1395475">;</span>&nbsp;<span class="op" id="1395477">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1395481">r1</span><span class="op" id="1395483">,</span>&nbsp;<span class="ident" id="1395485">size</span>&nbsp;<span class="op" id="1395490">:=</span>&nbsp;<span class="ident" id="1395493">utf8</span><span class="op" id="1395497">.</span><span class="ident" id="1395498">DecodeRune</span><span class="op" id="1395508">(</span><span class="ident" id="1395509">s</span><span class="op" id="1395510">[</span><span class="ident" id="1395511">i</span><span class="op" id="1395512">:</span><span class="op" id="1395513">]</span><span class="op" id="1395514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395518">if</span>&nbsp;<span class="ident" id="1395521">r</span>&nbsp;<span class="op" id="1395523">==</span>&nbsp;<span class="ident" id="1395526">r1</span>&nbsp;<span class="op" id="1395529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395534">return</span>&nbsp;<span class="ident" id="1395541">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1395545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1395549">i</span>&nbsp;<span class="op" id="1395551">+=</span>&nbsp;<span class="ident" id="1395554">size</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1395560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395563">return</span>&nbsp;<span class="op" id="1395570">-</span><span class="num" id="1395571">1</span><br>
<span class="lineno"></span><span class="op" id="1395573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1395576">//&nbsp;IndexAny&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno">155</span><span class="comment" id="1395653">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;s&nbsp;of&nbsp;any&nbsp;of&nbsp;the&nbsp;Unicode</span><br>
<span class="lineno"></span><span class="comment" id="1395733">//&nbsp;code&nbsp;points&nbsp;in&nbsp;chars.&nbsp;&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;chars&nbsp;is&nbsp;empty&nbsp;or&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="1395814">//&nbsp;point&nbsp;in&nbsp;common.</span><br>
<span class="lineno"></span><span class="keyword" id="1395834">func</span>&nbsp;<span class="ident" id="1395839">IndexAny</span><span class="op" id="1395847">(</span><span class="ident" id="1395848">s</span>&nbsp;<span class="op" id="1395850">[</span><span class="op" id="1395851">]</span><span class="builtintype" id="1395852">byte</span><span class="op" id="1395856">,</span>&nbsp;<span class="ident" id="1395858">chars</span>&nbsp;<span class="builtintype" id="1395864">string</span><span class="op" id="1395870">)</span>&nbsp;<span class="builtintype" id="1395872">int</span>&nbsp;<span class="op" id="1395876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395879">if</span>&nbsp;<span class="builtinfunc" id="1395882">len</span><span class="op" id="1395885">(</span><span class="ident" id="1395886">chars</span><span class="op" id="1395891">)</span>&nbsp;<span class="op" id="1395893">&gt;</span>&nbsp;<span class="num" id="1395895">0</span>&nbsp;<span class="op" id="1395897">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395901">var</span>&nbsp;<span class="ident" id="1395905">r</span>&nbsp;<span class="builtintype" id="1395907">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395914">var</span>&nbsp;<span class="ident" id="1395918">width</span>&nbsp;<span class="builtintype" id="1395924">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395930">for</span>&nbsp;<span class="ident" id="1395934">i</span>&nbsp;<span class="op" id="1395936">:=</span>&nbsp;<span class="num" id="1395939">0</span><span class="op" id="1395940">;</span>&nbsp;<span class="ident" id="1395942">i</span>&nbsp;<span class="op" id="1395944">&lt;</span>&nbsp;<span class="builtinfunc" id="1395946">len</span><span class="op" id="1395949">(</span><span class="ident" id="1395950">s</span><span class="op" id="1395951">)</span><span class="op" id="1395952">;</span>&nbsp;<span class="ident" id="1395954">i</span>&nbsp;<span class="op" id="1395956">+=</span>&nbsp;<span class="ident" id="1395959">width</span>&nbsp;<span class="op" id="1395965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1395970">r</span>&nbsp;<span class="op" id="1395972">=</span>&nbsp;<span class="builtintype" id="1395974">rune</span><span class="op" id="1395978">(</span><span class="ident" id="1395979">s</span><span class="op" id="1395980">[</span><span class="ident" id="1395981">i</span><span class="op" id="1395982">]</span><span class="op" id="1395983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1395988">if</span>&nbsp;<span class="ident" id="1395991">r</span>&nbsp;<span class="op" id="1395993">&lt;</span>&nbsp;<span class="ident" id="1395995">utf8</span><span class="op" id="1395999">.</span><span class="ident" id="1396000">RuneSelf</span>&nbsp;<span class="op" id="1396009">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396015">width</span>&nbsp;<span class="op" id="1396021">=</span>&nbsp;<span class="num" id="1396023">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396028">}</span>&nbsp;<span class="keyword" id="1396030">else</span>&nbsp;<span class="op" id="1396035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396041">r</span><span class="op" id="1396042">,</span>&nbsp;<span class="ident" id="1396044">width</span>&nbsp;<span class="op" id="1396050">=</span>&nbsp;<span class="ident" id="1396052">utf8</span><span class="op" id="1396056">.</span><span class="ident" id="1396057">DecodeRune</span><span class="op" id="1396067">(</span><span class="ident" id="1396068">s</span><span class="op" id="1396069">[</span><span class="ident" id="1396070">i</span><span class="op" id="1396071">:</span><span class="op" id="1396072">]</span><span class="op" id="1396073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396083">for</span>&nbsp;<span class="ident" id="1396087">_</span><span class="op" id="1396088">,</span>&nbsp;<span class="ident" id="1396090">ch</span>&nbsp;<span class="op" id="1396093">:=</span>&nbsp;<span class="keyword" id="1396096">range</span>&nbsp;<span class="ident" id="1396102">chars</span>&nbsp;<span class="op" id="1396108">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396114">if</span>&nbsp;<span class="ident" id="1396117">r</span>&nbsp;<span class="op" id="1396119">==</span>&nbsp;<span class="ident" id="1396122">ch</span>&nbsp;<span class="op" id="1396125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396132">return</span>&nbsp;<span class="ident" id="1396139">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396154">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396160">return</span>&nbsp;<span class="op" id="1396167">-</span><span class="num" id="1396168">1</span><br>
<span class="lineno"></span><span class="op" id="1396170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1396173">//&nbsp;LastIndexAny&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code</span><br>
<span class="lineno">180</span><span class="comment" id="1396246">//&nbsp;points.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;occurrence&nbsp;in&nbsp;s&nbsp;of&nbsp;any&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1396322">//&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;in&nbsp;chars.&nbsp;&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;chars&nbsp;is&nbsp;empty&nbsp;or&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1396398">//&nbsp;there&nbsp;is&nbsp;no&nbsp;code&nbsp;point&nbsp;in&nbsp;common.</span><br>
<span class="lineno"></span><span class="keyword" id="1396435">func</span>&nbsp;<span class="ident" id="1396440">LastIndexAny</span><span class="op" id="1396452">(</span><span class="ident" id="1396453">s</span>&nbsp;<span class="op" id="1396455">[</span><span class="op" id="1396456">]</span><span class="builtintype" id="1396457">byte</span><span class="op" id="1396461">,</span>&nbsp;<span class="ident" id="1396463">chars</span>&nbsp;<span class="builtintype" id="1396469">string</span><span class="op" id="1396475">)</span>&nbsp;<span class="builtintype" id="1396477">int</span>&nbsp;<span class="op" id="1396481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396484">if</span>&nbsp;<span class="builtinfunc" id="1396487">len</span><span class="op" id="1396490">(</span><span class="ident" id="1396491">chars</span><span class="op" id="1396496">)</span>&nbsp;<span class="op" id="1396498">&gt;</span>&nbsp;<span class="num" id="1396500">0</span>&nbsp;<span class="op" id="1396502">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396506">for</span>&nbsp;<span class="ident" id="1396510">i</span>&nbsp;<span class="op" id="1396512">:=</span>&nbsp;<span class="builtinfunc" id="1396515">len</span><span class="op" id="1396518">(</span><span class="ident" id="1396519">s</span><span class="op" id="1396520">)</span><span class="op" id="1396521">;</span>&nbsp;<span class="ident" id="1396523">i</span>&nbsp;<span class="op" id="1396525">&gt;</span>&nbsp;<span class="num" id="1396527">0</span><span class="op" id="1396528">;</span>&nbsp;<span class="op" id="1396530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396535">r</span><span class="op" id="1396536">,</span>&nbsp;<span class="ident" id="1396538">size</span>&nbsp;<span class="op" id="1396543">:=</span>&nbsp;<span class="ident" id="1396546">utf8</span><span class="op" id="1396550">.</span><span class="ident" id="1396551">DecodeLastRune</span><span class="op" id="1396565">(</span><span class="ident" id="1396566">s</span><span class="op" id="1396567">[</span><span class="num" id="1396568">0</span><span class="op" id="1396569">:</span><span class="ident" id="1396570">i</span><span class="op" id="1396571">]</span><span class="op" id="1396572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396577">i</span>&nbsp;<span class="op" id="1396579">-=</span>&nbsp;<span class="ident" id="1396582">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396590">for</span>&nbsp;<span class="ident" id="1396594">_</span><span class="op" id="1396595">,</span>&nbsp;<span class="ident" id="1396597">ch</span>&nbsp;<span class="op" id="1396600">:=</span>&nbsp;<span class="keyword" id="1396603">range</span>&nbsp;<span class="ident" id="1396609">chars</span>&nbsp;<span class="op" id="1396615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396621">if</span>&nbsp;<span class="ident" id="1396624">r</span>&nbsp;<span class="op" id="1396626">==</span>&nbsp;<span class="ident" id="1396629">ch</span>&nbsp;<span class="op" id="1396632">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396639">return</span>&nbsp;<span class="ident" id="1396646">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396664">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396667">return</span>&nbsp;<span class="op" id="1396674">-</span><span class="num" id="1396675">1</span><br>
<span class="lineno"></span><span class="op" id="1396677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1396680">//&nbsp;Generic&nbsp;split:&nbsp;splits&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep,</span><br>
<span class="lineno"></span><span class="comment" id="1396733">//&nbsp;including&nbsp;sepSave&nbsp;bytes&nbsp;of&nbsp;sep&nbsp;in&nbsp;the&nbsp;subslices.</span><br>
<span class="lineno">200</span><span class="keyword" id="1396785">func</span>&nbsp;<span class="ident" id="1396790">genSplit</span><span class="op" id="1396798">(</span><span class="ident" id="1396799">s</span><span class="op" id="1396800">,</span>&nbsp;<span class="ident" id="1396802">sep</span>&nbsp;<span class="op" id="1396806">[</span><span class="op" id="1396807">]</span><span class="builtintype" id="1396808">byte</span><span class="op" id="1396812">,</span>&nbsp;<span class="ident" id="1396814">sepSave</span><span class="op" id="1396821">,</span>&nbsp;<span class="ident" id="1396823">n</span>&nbsp;<span class="builtintype" id="1396825">int</span><span class="op" id="1396828">)</span>&nbsp;<span class="op" id="1396830">[</span><span class="op" id="1396831">]</span><span class="op" id="1396832">[</span><span class="op" id="1396833">]</span><span class="builtintype" id="1396834">byte</span>&nbsp;<span class="op" id="1396839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396842">if</span>&nbsp;<span class="ident" id="1396845">n</span>&nbsp;<span class="op" id="1396847">==</span>&nbsp;<span class="num" id="1396850">0</span>&nbsp;<span class="op" id="1396852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396856">return</span>&nbsp;<span class="ident" id="1396863">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396871">if</span>&nbsp;<span class="builtinfunc" id="1396874">len</span><span class="op" id="1396877">(</span><span class="ident" id="1396878">sep</span><span class="op" id="1396881">)</span>&nbsp;<span class="op" id="1396883">==</span>&nbsp;<span class="num" id="1396886">0</span>&nbsp;<span class="op" id="1396888">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396892">return</span>&nbsp;<span class="ident" id="1396899">explode</span><span class="op" id="1396906">(</span><span class="ident" id="1396907">s</span><span class="op" id="1396908">,</span>&nbsp;<span class="ident" id="1396910">n</span><span class="op" id="1396911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1396917">if</span>&nbsp;<span class="ident" id="1396920">n</span>&nbsp;<span class="op" id="1396922">&lt;</span>&nbsp;<span class="num" id="1396924">0</span>&nbsp;<span class="op" id="1396926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396930">n</span>&nbsp;<span class="op" id="1396932">=</span>&nbsp;<span class="ident" id="1396934">Count</span><span class="op" id="1396939">(</span><span class="ident" id="1396940">s</span><span class="op" id="1396941">,</span>&nbsp;<span class="ident" id="1396943">sep</span><span class="op" id="1396946">)</span>&nbsp;<span class="op" id="1396948">+</span>&nbsp;<span class="num" id="1396950">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1396953">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396956">c</span>&nbsp;<span class="op" id="1396958">:=</span>&nbsp;<span class="ident" id="1396961">sep</span><span class="op" id="1396964">[</span><span class="num" id="1396965">0</span><span class="op" id="1396966">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396969">start</span>&nbsp;<span class="op" id="1396975">:=</span>&nbsp;<span class="num" id="1396978">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1396981">a</span>&nbsp;<span class="op" id="1396983">:=</span>&nbsp;<span class="builtinfunc" id="1396986">make</span><span class="op" id="1396990">(</span><span class="op" id="1396991">[</span><span class="op" id="1396992">]</span><span class="op" id="1396993">[</span><span class="op" id="1396994">]</span><span class="builtintype" id="1396995">byte</span><span class="op" id="1396999">,</span>&nbsp;<span class="ident" id="1397001">n</span><span class="op" id="1397002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397005">na</span>&nbsp;<span class="op" id="1397008">:=</span>&nbsp;<span class="num" id="1397011">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397014">for</span>&nbsp;<span class="ident" id="1397018">i</span>&nbsp;<span class="op" id="1397020">:=</span>&nbsp;<span class="num" id="1397023">0</span><span class="op" id="1397024">;</span>&nbsp;<span class="ident" id="1397026">i</span><span class="op" id="1397027">+</span><span class="builtinfunc" id="1397028">len</span><span class="op" id="1397031">(</span><span class="ident" id="1397032">sep</span><span class="op" id="1397035">)</span>&nbsp;<span class="op" id="1397037">&lt;=</span>&nbsp;<span class="builtinfunc" id="1397040">len</span><span class="op" id="1397043">(</span><span class="ident" id="1397044">s</span><span class="op" id="1397045">)</span>&nbsp;<span class="op" id="1397047">&amp;&amp;</span>&nbsp;<span class="ident" id="1397050">na</span><span class="op" id="1397052">+</span><span class="num" id="1397053">1</span>&nbsp;<span class="op" id="1397055">&lt;</span>&nbsp;<span class="ident" id="1397057">n</span><span class="op" id="1397058">;</span>&nbsp;<span class="ident" id="1397060">i</span><span class="op" id="1397061">++</span>&nbsp;<span class="op" id="1397064">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397068">if</span>&nbsp;<span class="ident" id="1397071">s</span><span class="op" id="1397072">[</span><span class="ident" id="1397073">i</span><span class="op" id="1397074">]</span>&nbsp;<span class="op" id="1397076">==</span>&nbsp;<span class="ident" id="1397079">c</span>&nbsp;<span class="op" id="1397081">&amp;&amp;</span>&nbsp;<span class="op" id="1397084">(</span><span class="builtinfunc" id="1397085">len</span><span class="op" id="1397088">(</span><span class="ident" id="1397089">sep</span><span class="op" id="1397092">)</span>&nbsp;<span class="op" id="1397094">==</span>&nbsp;<span class="num" id="1397097">1</span>&nbsp;<span class="op" id="1397099">||</span>&nbsp;<span class="ident" id="1397102">Equal</span><span class="op" id="1397107">(</span><span class="ident" id="1397108">s</span><span class="op" id="1397109">[</span><span class="ident" id="1397110">i</span><span class="op" id="1397111">:</span><span class="ident" id="1397112">i</span><span class="op" id="1397113">+</span><span class="builtinfunc" id="1397114">len</span><span class="op" id="1397117">(</span><span class="ident" id="1397118">sep</span><span class="op" id="1397121">)</span><span class="op" id="1397122">]</span><span class="op" id="1397123">,</span>&nbsp;<span class="ident" id="1397125">sep</span><span class="op" id="1397128">)</span><span class="op" id="1397129">)</span>&nbsp;<span class="op" id="1397131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397136">a</span><span class="op" id="1397137">[</span><span class="ident" id="1397138">na</span><span class="op" id="1397140">]</span>&nbsp;<span class="op" id="1397142">=</span>&nbsp;<span class="ident" id="1397144">s</span><span class="op" id="1397145">[</span><span class="ident" id="1397146">start</span>&nbsp;<span class="op" id="1397152">:</span>&nbsp;<span class="ident" id="1397154">i</span><span class="op" id="1397155">+</span><span class="ident" id="1397156">sepSave</span><span class="op" id="1397163">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397168">na</span><span class="op" id="1397170">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397176">start</span>&nbsp;<span class="op" id="1397182">=</span>&nbsp;<span class="ident" id="1397184">i</span>&nbsp;<span class="op" id="1397186">+</span>&nbsp;<span class="builtinfunc" id="1397188">len</span><span class="op" id="1397191">(</span><span class="ident" id="1397192">sep</span><span class="op" id="1397195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397200">i</span>&nbsp;<span class="op" id="1397202">+=</span>&nbsp;<span class="builtinfunc" id="1397205">len</span><span class="op" id="1397208">(</span><span class="ident" id="1397209">sep</span><span class="op" id="1397212">)</span>&nbsp;<span class="op" id="1397214">-</span>&nbsp;<span class="num" id="1397216">1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1397220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1397223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1397226">a</span><span class="op" id="1397227">[</span><span class="ident" id="1397228">na</span><span class="op" id="1397230">]</span>&nbsp;<span class="op" id="1397232">=</span>&nbsp;<span class="ident" id="1397234">s</span><span class="op" id="1397235">[</span><span class="ident" id="1397236">start</span><span class="op" id="1397241">:</span><span class="op" id="1397242">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1397245">return</span>&nbsp;<span class="ident" id="1397252">a</span><span class="op" id="1397253">[</span><span class="num" id="1397254">0</span>&nbsp;<span class="op" id="1397256">:</span>&nbsp;<span class="ident" id="1397258">na</span><span class="op" id="1397260">+</span><span class="num" id="1397261">1</span><span class="op" id="1397262">]</span><br>
<span class="lineno"></span><span class="op" id="1397264">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="1397267">//&nbsp;SplitN&nbsp;slices&nbsp;s&nbsp;into&nbsp;subslices&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1397341">//&nbsp;the&nbsp;subslices&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="1397384">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="1397445">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;subslices&nbsp;to&nbsp;return:</span><br>
<span class="lineno">230</span><span class="comment" id="1397504">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;subslices;&nbsp;the&nbsp;last&nbsp;subslice&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="1397586">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;subslices)</span><br>
<span class="lineno"></span><span class="comment" id="1397634">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;subslices</span><br>
<span class="lineno"></span><span class="keyword" id="1397660">func</span>&nbsp;<span class="ident" id="1397665">SplitN</span><span class="op" id="1397671">(</span><span class="ident" id="1397672">s</span><span class="op" id="1397673">,</span>&nbsp;<span class="ident" id="1397675">sep</span>&nbsp;<span class="op" id="1397679">[</span><span class="op" id="1397680">]</span><span class="builtintype" id="1397681">byte</span><span class="op" id="1397685">,</span>&nbsp;<span class="ident" id="1397687">n</span>&nbsp;<span class="builtintype" id="1397689">int</span><span class="op" id="1397692">)</span>&nbsp;<span class="op" id="1397694">[</span><span class="op" id="1397695">]</span><span class="op" id="1397696">[</span><span class="op" id="1397697">]</span><span class="builtintype" id="1397698">byte</span>&nbsp;<span class="op" id="1397703">{</span>&nbsp;<span class="keyword" id="1397705">return</span>&nbsp;<span class="ident" id="1397712">genSplit</span><span class="op" id="1397720">(</span><span class="ident" id="1397721">s</span><span class="op" id="1397722">,</span>&nbsp;<span class="ident" id="1397724">sep</span><span class="op" id="1397727">,</span>&nbsp;<span class="num" id="1397729">0</span><span class="op" id="1397730">,</span>&nbsp;<span class="ident" id="1397732">n</span><span class="op" id="1397733">)</span>&nbsp;<span class="op" id="1397735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="1397738">//&nbsp;SplitAfterN&nbsp;slices&nbsp;s&nbsp;into&nbsp;subslices&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1397808">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;subslices.</span><br>
<span class="lineno"></span><span class="comment" id="1397847">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfterN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="1397913">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;subslices&nbsp;to&nbsp;return:</span><br>
<span class="lineno"></span><span class="comment" id="1397972">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;subslices;&nbsp;the&nbsp;last&nbsp;subslice&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno">240</span><span class="comment" id="1398054">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;subslices)</span><br>
<span class="lineno"></span><span class="comment" id="1398102">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;subslices</span><br>
<span class="lineno"></span><span class="keyword" id="1398128">func</span>&nbsp;<span class="ident" id="1398133">SplitAfterN</span><span class="op" id="1398144">(</span><span class="ident" id="1398145">s</span><span class="op" id="1398146">,</span>&nbsp;<span class="ident" id="1398148">sep</span>&nbsp;<span class="op" id="1398152">[</span><span class="op" id="1398153">]</span><span class="builtintype" id="1398154">byte</span><span class="op" id="1398158">,</span>&nbsp;<span class="ident" id="1398160">n</span>&nbsp;<span class="builtintype" id="1398162">int</span><span class="op" id="1398165">)</span>&nbsp;<span class="op" id="1398167">[</span><span class="op" id="1398168">]</span><span class="op" id="1398169">[</span><span class="op" id="1398170">]</span><span class="builtintype" id="1398171">byte</span>&nbsp;<span class="op" id="1398176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398179">return</span>&nbsp;<span class="ident" id="1398186">genSplit</span><span class="op" id="1398194">(</span><span class="ident" id="1398195">s</span><span class="op" id="1398196">,</span>&nbsp;<span class="ident" id="1398198">sep</span><span class="op" id="1398201">,</span>&nbsp;<span class="builtinfunc" id="1398203">len</span><span class="op" id="1398206">(</span><span class="ident" id="1398207">sep</span><span class="op" id="1398210">)</span><span class="op" id="1398211">,</span>&nbsp;<span class="ident" id="1398213">n</span><span class="op" id="1398214">)</span><br>
<span class="lineno"></span><span class="op" id="1398216">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="1398219">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;subslices&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1398296">//&nbsp;the&nbsp;subslices&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="1398339">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;Split&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="1398399">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno">250</span><span class="keyword" id="1398449">func</span>&nbsp;<span class="ident" id="1398454">Split</span><span class="op" id="1398459">(</span><span class="ident" id="1398460">s</span><span class="op" id="1398461">,</span>&nbsp;<span class="ident" id="1398463">sep</span>&nbsp;<span class="op" id="1398467">[</span><span class="op" id="1398468">]</span><span class="builtintype" id="1398469">byte</span><span class="op" id="1398473">)</span>&nbsp;<span class="op" id="1398475">[</span><span class="op" id="1398476">]</span><span class="op" id="1398477">[</span><span class="op" id="1398478">]</span><span class="builtintype" id="1398479">byte</span>&nbsp;<span class="op" id="1398484">{</span>&nbsp;<span class="keyword" id="1398486">return</span>&nbsp;<span class="ident" id="1398493">genSplit</span><span class="op" id="1398501">(</span><span class="ident" id="1398502">s</span><span class="op" id="1398503">,</span>&nbsp;<span class="ident" id="1398505">sep</span><span class="op" id="1398508">,</span>&nbsp;<span class="num" id="1398510">0</span><span class="op" id="1398511">,</span>&nbsp;<span class="op" id="1398513">-</span><span class="num" id="1398514">1</span><span class="op" id="1398515">)</span>&nbsp;<span class="op" id="1398517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1398520">//&nbsp;SplitAfter&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;subslices&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1398593">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;subslices.</span><br>
<span class="lineno"></span><span class="comment" id="1398632">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfter&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno">255</span><span class="comment" id="1398697">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitAfterN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="1398752">func</span>&nbsp;<span class="ident" id="1398757">SplitAfter</span><span class="op" id="1398767">(</span><span class="ident" id="1398768">s</span><span class="op" id="1398769">,</span>&nbsp;<span class="ident" id="1398771">sep</span>&nbsp;<span class="op" id="1398775">[</span><span class="op" id="1398776">]</span><span class="builtintype" id="1398777">byte</span><span class="op" id="1398781">)</span>&nbsp;<span class="op" id="1398783">[</span><span class="op" id="1398784">]</span><span class="op" id="1398785">[</span><span class="op" id="1398786">]</span><span class="builtintype" id="1398787">byte</span>&nbsp;<span class="op" id="1398792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1398795">return</span>&nbsp;<span class="ident" id="1398802">genSplit</span><span class="op" id="1398810">(</span><span class="ident" id="1398811">s</span><span class="op" id="1398812">,</span>&nbsp;<span class="ident" id="1398814">sep</span><span class="op" id="1398817">,</span>&nbsp;<span class="builtinfunc" id="1398819">len</span><span class="op" id="1398822">(</span><span class="ident" id="1398823">sep</span><span class="op" id="1398826">)</span><span class="op" id="1398827">,</span>&nbsp;<span class="op" id="1398829">-</span><span class="num" id="1398830">1</span><span class="op" id="1398831">)</span><br>
<span class="lineno"></span><span class="op" id="1398833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="1398836">//&nbsp;Fields&nbsp;splits&nbsp;the&nbsp;slice&nbsp;s&nbsp;around&nbsp;each&nbsp;instance&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;consecutive&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="1398925">//&nbsp;characters,&nbsp;returning&nbsp;a&nbsp;slice&nbsp;of&nbsp;subslices&nbsp;of&nbsp;s&nbsp;or&nbsp;an&nbsp;empty&nbsp;list&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="1399025">func</span>&nbsp;<span class="ident" id="1399030">Fields</span><span class="op" id="1399036">(</span><span class="ident" id="1399037">s</span>&nbsp;<span class="op" id="1399039">[</span><span class="op" id="1399040">]</span><span class="builtintype" id="1399041">byte</span><span class="op" id="1399045">)</span>&nbsp;<span class="op" id="1399047">[</span><span class="op" id="1399048">]</span><span class="op" id="1399049">[</span><span class="op" id="1399050">]</span><span class="builtintype" id="1399051">byte</span>&nbsp;<span class="op" id="1399056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399059">return</span>&nbsp;<span class="ident" id="1399066">FieldsFunc</span><span class="op" id="1399076">(</span><span class="ident" id="1399077">s</span><span class="op" id="1399078">,</span>&nbsp;<span class="ident" id="1399080">unicode</span><span class="op" id="1399087">.</span><span class="ident" id="1399088">IsSpace</span><span class="op" id="1399095">)</span><br>
<span class="lineno"></span><span class="op" id="1399097">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="comment" id="1399100">//&nbsp;FieldsFunc&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="1399179">//&nbsp;It&nbsp;splits&nbsp;the&nbsp;slice&nbsp;s&nbsp;at&nbsp;each&nbsp;run&nbsp;of&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1399253">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;subslices&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;all&nbsp;code&nbsp;points&nbsp;in&nbsp;s&nbsp;satisfy&nbsp;f(c),&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="1399333">//&nbsp;len(s)&nbsp;==&nbsp;0,&nbsp;an&nbsp;empty&nbsp;slice&nbsp;is&nbsp;returned.</span><br>
<span class="lineno">270</span><span class="comment" id="1399377">//&nbsp;FieldsFunc&nbsp;makes&nbsp;no&nbsp;guarantees&nbsp;about&nbsp;the&nbsp;order&nbsp;in&nbsp;which&nbsp;it&nbsp;calls&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="comment" id="1399451">//&nbsp;If&nbsp;f&nbsp;does&nbsp;not&nbsp;return&nbsp;consistent&nbsp;results&nbsp;for&nbsp;a&nbsp;given&nbsp;c,&nbsp;FieldsFunc&nbsp;may&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="1399531">func</span>&nbsp;<span class="ident" id="1399536">FieldsFunc</span><span class="op" id="1399546">(</span><span class="ident" id="1399547">s</span>&nbsp;<span class="op" id="1399549">[</span><span class="op" id="1399550">]</span><span class="builtintype" id="1399551">byte</span><span class="op" id="1399555">,</span>&nbsp;<span class="ident" id="1399557">f</span>&nbsp;<span class="keyword" id="1399559">func</span><span class="op" id="1399563">(</span><span class="builtintype" id="1399564">rune</span><span class="op" id="1399568">)</span>&nbsp;<span class="builtintype" id="1399570">bool</span><span class="op" id="1399574">)</span>&nbsp;<span class="op" id="1399576">[</span><span class="op" id="1399577">]</span><span class="op" id="1399578">[</span><span class="op" id="1399579">]</span><span class="builtintype" id="1399580">byte</span>&nbsp;<span class="op" id="1399585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399588">n</span>&nbsp;<span class="op" id="1399590">:=</span>&nbsp;<span class="num" id="1399593">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399596">inField</span>&nbsp;<span class="op" id="1399604">:=</span>&nbsp;<span class="builtintype" id="1399607">false</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399614">for</span>&nbsp;<span class="ident" id="1399618">i</span>&nbsp;<span class="op" id="1399620">:=</span>&nbsp;<span class="num" id="1399623">0</span><span class="op" id="1399624">;</span>&nbsp;<span class="ident" id="1399626">i</span>&nbsp;<span class="op" id="1399628">&lt;</span>&nbsp;<span class="builtinfunc" id="1399630">len</span><span class="op" id="1399633">(</span><span class="ident" id="1399634">s</span><span class="op" id="1399635">)</span><span class="op" id="1399636">;</span>&nbsp;<span class="op" id="1399638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399642">r</span><span class="op" id="1399643">,</span>&nbsp;<span class="ident" id="1399645">size</span>&nbsp;<span class="op" id="1399650">:=</span>&nbsp;<span class="ident" id="1399653">utf8</span><span class="op" id="1399657">.</span><span class="ident" id="1399658">DecodeRune</span><span class="op" id="1399668">(</span><span class="ident" id="1399669">s</span><span class="op" id="1399670">[</span><span class="ident" id="1399671">i</span><span class="op" id="1399672">:</span><span class="op" id="1399673">]</span><span class="op" id="1399674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399678">wasInField</span>&nbsp;<span class="op" id="1399689">:=</span>&nbsp;<span class="ident" id="1399692">inField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399702">inField</span>&nbsp;<span class="op" id="1399710">=</span>&nbsp;<span class="op" id="1399712">!</span><span class="ident" id="1399713">f</span><span class="op" id="1399714">(</span><span class="ident" id="1399715">r</span><span class="op" id="1399716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399720">if</span>&nbsp;<span class="ident" id="1399723">inField</span>&nbsp;<span class="op" id="1399731">&amp;&amp;</span>&nbsp;<span class="op" id="1399734">!</span><span class="ident" id="1399735">wasInField</span>&nbsp;<span class="op" id="1399746">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399751">n</span><span class="op" id="1399752">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1399757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399761">i</span>&nbsp;<span class="op" id="1399763">+=</span>&nbsp;<span class="ident" id="1399766">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1399772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399776">a</span>&nbsp;<span class="op" id="1399778">:=</span>&nbsp;<span class="builtinfunc" id="1399781">make</span><span class="op" id="1399785">(</span><span class="op" id="1399786">[</span><span class="op" id="1399787">]</span><span class="op" id="1399788">[</span><span class="op" id="1399789">]</span><span class="builtintype" id="1399790">byte</span><span class="op" id="1399794">,</span>&nbsp;<span class="ident" id="1399796">n</span><span class="op" id="1399797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399800">na</span>&nbsp;<span class="op" id="1399803">:=</span>&nbsp;<span class="num" id="1399806">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399809">fieldStart</span>&nbsp;<span class="op" id="1399820">:=</span>&nbsp;<span class="op" id="1399823">-</span><span class="num" id="1399824">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399827">for</span>&nbsp;<span class="ident" id="1399831">i</span>&nbsp;<span class="op" id="1399833">:=</span>&nbsp;<span class="num" id="1399836">0</span><span class="op" id="1399837">;</span>&nbsp;<span class="ident" id="1399839">i</span>&nbsp;<span class="op" id="1399841">&lt;=</span>&nbsp;<span class="builtinfunc" id="1399844">len</span><span class="op" id="1399847">(</span><span class="ident" id="1399848">s</span><span class="op" id="1399849">)</span>&nbsp;<span class="op" id="1399851">&amp;&amp;</span>&nbsp;<span class="ident" id="1399854">na</span>&nbsp;<span class="op" id="1399857">&lt;</span>&nbsp;<span class="ident" id="1399859">n</span><span class="op" id="1399860">;</span>&nbsp;<span class="op" id="1399862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399866">r</span><span class="op" id="1399867">,</span>&nbsp;<span class="ident" id="1399869">size</span>&nbsp;<span class="op" id="1399874">:=</span>&nbsp;<span class="ident" id="1399877">utf8</span><span class="op" id="1399881">.</span><span class="ident" id="1399882">DecodeRune</span><span class="op" id="1399892">(</span><span class="ident" id="1399893">s</span><span class="op" id="1399894">[</span><span class="ident" id="1399895">i</span><span class="op" id="1399896">:</span><span class="op" id="1399897">]</span><span class="op" id="1399898">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399902">if</span>&nbsp;<span class="ident" id="1399905">fieldStart</span>&nbsp;<span class="op" id="1399916">&lt;</span>&nbsp;<span class="num" id="1399918">0</span>&nbsp;<span class="op" id="1399920">&amp;&amp;</span>&nbsp;<span class="ident" id="1399923">size</span>&nbsp;<span class="op" id="1399928">&gt;</span>&nbsp;<span class="num" id="1399930">0</span>&nbsp;<span class="op" id="1399932">&amp;&amp;</span>&nbsp;<span class="op" id="1399935">!</span><span class="ident" id="1399936">f</span><span class="op" id="1399937">(</span><span class="ident" id="1399938">r</span><span class="op" id="1399939">)</span>&nbsp;<span class="op" id="1399941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399946">fieldStart</span>&nbsp;<span class="op" id="1399957">=</span>&nbsp;<span class="ident" id="1399959">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1399964">i</span>&nbsp;<span class="op" id="1399966">+=</span>&nbsp;<span class="ident" id="1399969">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399977">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1399988">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1399992">if</span>&nbsp;<span class="ident" id="1399995">fieldStart</span>&nbsp;<span class="op" id="1400006">&gt;=</span>&nbsp;<span class="num" id="1400009">0</span>&nbsp;<span class="op" id="1400011">&amp;&amp;</span>&nbsp;<span class="op" id="1400014">(</span><span class="ident" id="1400015">size</span>&nbsp;<span class="op" id="1400020">==</span>&nbsp;<span class="num" id="1400023">0</span>&nbsp;<span class="op" id="1400025">||</span>&nbsp;<span class="ident" id="1400028">f</span><span class="op" id="1400029">(</span><span class="ident" id="1400030">r</span><span class="op" id="1400031">)</span><span class="op" id="1400032">)</span>&nbsp;<span class="op" id="1400034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1400039">a</span><span class="op" id="1400040">[</span><span class="ident" id="1400041">na</span><span class="op" id="1400043">]</span>&nbsp;<span class="op" id="1400045">=</span>&nbsp;<span class="ident" id="1400047">s</span><span class="op" id="1400048">[</span><span class="ident" id="1400049">fieldStart</span><span class="op" id="1400059">:</span><span class="ident" id="1400060">i</span><span class="op" id="1400061">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1400066">na</span><span class="op" id="1400068">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1400074">fieldStart</span>&nbsp;<span class="op" id="1400085">=</span>&nbsp;<span class="op" id="1400087">-</span><span class="num" id="1400088">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1400092">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400096">if</span>&nbsp;<span class="ident" id="1400099">size</span>&nbsp;<span class="op" id="1400104">==</span>&nbsp;<span class="num" id="1400107">0</span>&nbsp;<span class="op" id="1400109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400114">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1400122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1400126">i</span>&nbsp;<span class="op" id="1400128">+=</span>&nbsp;<span class="ident" id="1400131">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1400137">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400140">return</span>&nbsp;<span class="ident" id="1400147">a</span><span class="op" id="1400148">[</span><span class="num" id="1400149">0</span><span class="op" id="1400150">:</span><span class="ident" id="1400151">na</span><span class="op" id="1400153">]</span><br>
<span class="lineno"></span><span class="op" id="1400155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1400158">//&nbsp;Join&nbsp;concatenates&nbsp;the&nbsp;elements&nbsp;of&nbsp;s&nbsp;to&nbsp;create&nbsp;a&nbsp;new&nbsp;byte&nbsp;slice.&nbsp;The&nbsp;separator</span><br>
<span class="lineno"></span><span class="comment" id="1400239">//&nbsp;sep&nbsp;is&nbsp;placed&nbsp;between&nbsp;elements&nbsp;in&nbsp;the&nbsp;resulting&nbsp;slice.</span><br>
<span class="lineno">310</span><span class="keyword" id="1400297">func</span>&nbsp;<span class="ident" id="1400302">Join</span><span class="op" id="1400306">(</span><span class="ident" id="1400307">s</span>&nbsp;<span class="op" id="1400309">[</span><span class="op" id="1400310">]</span><span class="op" id="1400311">[</span><span class="op" id="1400312">]</span><span class="builtintype" id="1400313">byte</span><span class="op" id="1400317">,</span>&nbsp;<span class="ident" id="1400319">sep</span>&nbsp;<span class="op" id="1400323">[</span><span class="op" id="1400324">]</span><span class="builtintype" id="1400325">byte</span><span class="op" id="1400329">)</span>&nbsp;<span class="op" id="1400331">[</span><span class="op" id="1400332">]</span><span class="builtintype" id="1400333">byte</span>&nbsp;<span class="op" id="1400338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400341">if</span>&nbsp;<span class="builtinfunc" id="1400344">len</span><span class="op" id="1400347">(</span><span class="ident" id="1400348">s</span><span class="op" id="1400349">)</span>&nbsp;<span class="op" id="1400351">==</span>&nbsp;<span class="num" id="1400354">0</span>&nbsp;<span class="op" id="1400356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400360">return</span>&nbsp;<span class="op" id="1400367">[</span><span class="op" id="1400368">]</span><span class="builtintype" id="1400369">byte</span><span class="op" id="1400373">{</span><span class="op" id="1400374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1400377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400380">if</span>&nbsp;<span class="builtinfunc" id="1400383">len</span><span class="op" id="1400386">(</span><span class="ident" id="1400387">s</span><span class="op" id="1400388">)</span>&nbsp;<span class="op" id="1400390">==</span>&nbsp;<span class="num" id="1400393">1</span>&nbsp;<span class="op" id="1400395">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1400399">//&nbsp;Just&nbsp;return&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400424">return</span>&nbsp;<span class="builtinfunc" id="1400431">append</span><span class="op" id="1400437">(</span><span class="op" id="1400438">[</span><span class="op" id="1400439">]</span><span class="builtintype" id="1400440">byte</span><span class="op" id="1400444">(</span><span class="ident" id="1400445">nil</span><span class="op" id="1400448">)</span><span class="op" id="1400449">,</span>&nbsp;<span class="ident" id="1400451">s</span><span class="op" id="1400452">[</span><span class="num" id="1400453">0</span><span class="op" id="1400454">]</span><span class="op" id="1400455">...</span><span class="op" id="1400458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1400461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1400464">n</span>&nbsp;<span class="op" id="1400466">:=</span>&nbsp;<span class="builtinfunc" id="1400469">len</span><span class="op" id="1400472">(</span><span class="ident" id="1400473">sep</span><span class="op" id="1400476">)</span>&nbsp;<span class="op" id="1400478">*</span>&nbsp;<span class="op" id="1400480">(</span><span class="builtinfunc" id="1400481">len</span><span class="op" id="1400484">(</span><span class="ident" id="1400485">s</span><span class="op" id="1400486">)</span>&nbsp;<span class="op" id="1400488">-</span>&nbsp;<span class="num" id="1400490">1</span><span class="op" id="1400491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400494">for</span>&nbsp;<span class="ident" id="1400498">_</span><span class="op" id="1400499">,</span>&nbsp;<span class="ident" id="1400501">v</span>&nbsp;<span class="op" id="1400503">:=</span>&nbsp;<span class="keyword" id="1400506">range</span>&nbsp;<span class="ident" id="1400512">s</span>&nbsp;<span class="op" id="1400514">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1400518">n</span>&nbsp;<span class="op" id="1400520">+=</span>&nbsp;<span class="builtinfunc" id="1400523">len</span><span class="op" id="1400526">(</span><span class="ident" id="1400527">v</span><span class="op" id="1400528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1400531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1400535">b</span>&nbsp;<span class="op" id="1400537">:=</span>&nbsp;<span class="builtinfunc" id="1400540">make</span><span class="op" id="1400544">(</span><span class="op" id="1400545">[</span><span class="op" id="1400546">]</span><span class="builtintype" id="1400547">byte</span><span class="op" id="1400551">,</span>&nbsp;<span class="ident" id="1400553">n</span><span class="op" id="1400554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1400557">bp</span>&nbsp;<span class="op" id="1400560">:=</span>&nbsp;<span class="builtinfunc" id="1400563">copy</span><span class="op" id="1400567">(</span><span class="ident" id="1400568">b</span><span class="op" id="1400569">,</span>&nbsp;<span class="ident" id="1400571">s</span><span class="op" id="1400572">[</span><span class="num" id="1400573">0</span><span class="op" id="1400574">]</span><span class="op" id="1400575">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400578">for</span>&nbsp;<span class="ident" id="1400582">_</span><span class="op" id="1400583">,</span>&nbsp;<span class="ident" id="1400585">v</span>&nbsp;<span class="op" id="1400587">:=</span>&nbsp;<span class="keyword" id="1400590">range</span>&nbsp;<span class="ident" id="1400596">s</span><span class="op" id="1400597">[</span><span class="num" id="1400598">1</span><span class="op" id="1400599">:</span><span class="op" id="1400600">]</span>&nbsp;<span class="op" id="1400602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1400606">bp</span>&nbsp;<span class="op" id="1400609">+=</span>&nbsp;<span class="builtinfunc" id="1400612">copy</span><span class="op" id="1400616">(</span><span class="ident" id="1400617">b</span><span class="op" id="1400618">[</span><span class="ident" id="1400619">bp</span><span class="op" id="1400621">:</span><span class="op" id="1400622">]</span><span class="op" id="1400623">,</span>&nbsp;<span class="ident" id="1400625">sep</span><span class="op" id="1400628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1400632">bp</span>&nbsp;<span class="op" id="1400635">+=</span>&nbsp;<span class="builtinfunc" id="1400638">copy</span><span class="op" id="1400642">(</span><span class="ident" id="1400643">b</span><span class="op" id="1400644">[</span><span class="ident" id="1400645">bp</span><span class="op" id="1400647">:</span><span class="op" id="1400648">]</span><span class="op" id="1400649">,</span>&nbsp;<span class="ident" id="1400651">v</span><span class="op" id="1400652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1400655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400658">return</span>&nbsp;<span class="ident" id="1400665">b</span><br>
<span class="lineno">330</span><span class="op" id="1400667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1400670">//&nbsp;HasPrefix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;begins&nbsp;with&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="1400734">func</span>&nbsp;<span class="ident" id="1400739">HasPrefix</span><span class="op" id="1400748">(</span><span class="ident" id="1400749">s</span><span class="op" id="1400750">,</span>&nbsp;<span class="ident" id="1400752">prefix</span>&nbsp;<span class="op" id="1400759">[</span><span class="op" id="1400760">]</span><span class="builtintype" id="1400761">byte</span><span class="op" id="1400765">)</span>&nbsp;<span class="builtintype" id="1400767">bool</span>&nbsp;<span class="op" id="1400772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400775">return</span>&nbsp;<span class="builtinfunc" id="1400782">len</span><span class="op" id="1400785">(</span><span class="ident" id="1400786">s</span><span class="op" id="1400787">)</span>&nbsp;<span class="op" id="1400789">&gt;=</span>&nbsp;<span class="builtinfunc" id="1400792">len</span><span class="op" id="1400795">(</span><span class="ident" id="1400796">prefix</span><span class="op" id="1400802">)</span>&nbsp;<span class="op" id="1400804">&amp;&amp;</span>&nbsp;<span class="ident" id="1400807">Equal</span><span class="op" id="1400812">(</span><span class="ident" id="1400813">s</span><span class="op" id="1400814">[</span><span class="num" id="1400815">0</span><span class="op" id="1400816">:</span><span class="builtinfunc" id="1400817">len</span><span class="op" id="1400820">(</span><span class="ident" id="1400821">prefix</span><span class="op" id="1400827">)</span><span class="op" id="1400828">]</span><span class="op" id="1400829">,</span>&nbsp;<span class="ident" id="1400831">prefix</span><span class="op" id="1400837">)</span><br>
<span class="lineno">335</span><span class="op" id="1400839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1400842">//&nbsp;HasSuffix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;ends&nbsp;with&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="1400904">func</span>&nbsp;<span class="ident" id="1400909">HasSuffix</span><span class="op" id="1400918">(</span><span class="ident" id="1400919">s</span><span class="op" id="1400920">,</span>&nbsp;<span class="ident" id="1400922">suffix</span>&nbsp;<span class="op" id="1400929">[</span><span class="op" id="1400930">]</span><span class="builtintype" id="1400931">byte</span><span class="op" id="1400935">)</span>&nbsp;<span class="builtintype" id="1400937">bool</span>&nbsp;<span class="op" id="1400942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1400945">return</span>&nbsp;<span class="builtinfunc" id="1400952">len</span><span class="op" id="1400955">(</span><span class="ident" id="1400956">s</span><span class="op" id="1400957">)</span>&nbsp;<span class="op" id="1400959">&gt;=</span>&nbsp;<span class="builtinfunc" id="1400962">len</span><span class="op" id="1400965">(</span><span class="ident" id="1400966">suffix</span><span class="op" id="1400972">)</span>&nbsp;<span class="op" id="1400974">&amp;&amp;</span>&nbsp;<span class="ident" id="1400977">Equal</span><span class="op" id="1400982">(</span><span class="ident" id="1400983">s</span><span class="op" id="1400984">[</span><span class="builtinfunc" id="1400985">len</span><span class="op" id="1400988">(</span><span class="ident" id="1400989">s</span><span class="op" id="1400990">)</span><span class="op" id="1400991">-</span><span class="builtinfunc" id="1400992">len</span><span class="op" id="1400995">(</span><span class="ident" id="1400996">suffix</span><span class="op" id="1401002">)</span><span class="op" id="1401003">:</span><span class="op" id="1401004">]</span><span class="op" id="1401005">,</span>&nbsp;<span class="ident" id="1401007">suffix</span><span class="op" id="1401013">)</span><br>
<span class="lineno">340</span><span class="op" id="1401015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1401018">//&nbsp;Map&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;its&nbsp;characters&nbsp;modified</span><br>
<span class="lineno"></span><span class="comment" id="1401093">//&nbsp;according&nbsp;to&nbsp;the&nbsp;mapping&nbsp;function.&nbsp;If&nbsp;mapping&nbsp;returns&nbsp;a&nbsp;negative&nbsp;value,&nbsp;the&nbsp;character&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1401185">//&nbsp;dropped&nbsp;from&nbsp;the&nbsp;string&nbsp;with&nbsp;no&nbsp;replacement.&nbsp;&nbsp;The&nbsp;characters&nbsp;in&nbsp;s&nbsp;and&nbsp;the</span><br>
<span class="lineno">345</span><span class="comment" id="1401262">//&nbsp;output&nbsp;are&nbsp;interpreted&nbsp;as&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="1401326">func</span>&nbsp;<span class="ident" id="1401331">Map</span><span class="op" id="1401334">(</span><span class="ident" id="1401335">mapping</span>&nbsp;<span class="keyword" id="1401343">func</span><span class="op" id="1401347">(</span><span class="ident" id="1401348">r</span>&nbsp;<span class="builtintype" id="1401350">rune</span><span class="op" id="1401354">)</span>&nbsp;<span class="builtintype" id="1401356">rune</span><span class="op" id="1401360">,</span>&nbsp;<span class="ident" id="1401362">s</span>&nbsp;<span class="op" id="1401364">[</span><span class="op" id="1401365">]</span><span class="builtintype" id="1401366">byte</span><span class="op" id="1401370">)</span>&nbsp;<span class="op" id="1401372">[</span><span class="op" id="1401373">]</span><span class="builtintype" id="1401374">byte</span>&nbsp;<span class="op" id="1401379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1401382">//&nbsp;In&nbsp;the&nbsp;worst&nbsp;case,&nbsp;the&nbsp;slice&nbsp;can&nbsp;grow&nbsp;when&nbsp;mapped,&nbsp;making</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1401444">//&nbsp;things&nbsp;unpleasant.&nbsp;&nbsp;But&nbsp;it&#39;s&nbsp;so&nbsp;rare&nbsp;we&nbsp;barge&nbsp;in&nbsp;assuming&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1401511">//&nbsp;fine.&nbsp;&nbsp;It&nbsp;could&nbsp;also&nbsp;shrink&nbsp;but&nbsp;that&nbsp;falls&nbsp;out&nbsp;naturally.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401573">maxbytes</span>&nbsp;<span class="op" id="1401582">:=</span>&nbsp;<span class="builtinfunc" id="1401585">len</span><span class="op" id="1401588">(</span><span class="ident" id="1401589">s</span><span class="op" id="1401590">)</span>&nbsp;<span class="comment" id="1401592">//&nbsp;length&nbsp;of&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401608">nbytes</span>&nbsp;<span class="op" id="1401615">:=</span>&nbsp;<span class="num" id="1401618">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1401627">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;encoded&nbsp;in&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401660">b</span>&nbsp;<span class="op" id="1401662">:=</span>&nbsp;<span class="builtinfunc" id="1401665">make</span><span class="op" id="1401669">(</span><span class="op" id="1401670">[</span><span class="op" id="1401671">]</span><span class="builtintype" id="1401672">byte</span><span class="op" id="1401676">,</span>&nbsp;<span class="ident" id="1401678">maxbytes</span><span class="op" id="1401686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1401689">for</span>&nbsp;<span class="ident" id="1401693">i</span>&nbsp;<span class="op" id="1401695">:=</span>&nbsp;<span class="num" id="1401698">0</span><span class="op" id="1401699">;</span>&nbsp;<span class="ident" id="1401701">i</span>&nbsp;<span class="op" id="1401703">&lt;</span>&nbsp;<span class="builtinfunc" id="1401705">len</span><span class="op" id="1401708">(</span><span class="ident" id="1401709">s</span><span class="op" id="1401710">)</span><span class="op" id="1401711">;</span>&nbsp;<span class="op" id="1401713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401717">wid</span>&nbsp;<span class="op" id="1401721">:=</span>&nbsp;<span class="num" id="1401724">1</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401728">r</span>&nbsp;<span class="op" id="1401730">:=</span>&nbsp;<span class="builtintype" id="1401733">rune</span><span class="op" id="1401737">(</span><span class="ident" id="1401738">s</span><span class="op" id="1401739">[</span><span class="ident" id="1401740">i</span><span class="op" id="1401741">]</span><span class="op" id="1401742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1401746">if</span>&nbsp;<span class="ident" id="1401749">r</span>&nbsp;<span class="op" id="1401751">&gt;=</span>&nbsp;<span class="ident" id="1401754">utf8</span><span class="op" id="1401758">.</span><span class="ident" id="1401759">RuneSelf</span>&nbsp;<span class="op" id="1401768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401773">r</span><span class="op" id="1401774">,</span>&nbsp;<span class="ident" id="1401776">wid</span>&nbsp;<span class="op" id="1401780">=</span>&nbsp;<span class="ident" id="1401782">utf8</span><span class="op" id="1401786">.</span><span class="ident" id="1401787">DecodeRune</span><span class="op" id="1401797">(</span><span class="ident" id="1401798">s</span><span class="op" id="1401799">[</span><span class="ident" id="1401800">i</span><span class="op" id="1401801">:</span><span class="op" id="1401802">]</span><span class="op" id="1401803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1401807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401811">r</span>&nbsp;<span class="op" id="1401813">=</span>&nbsp;<span class="ident" id="1401815">mapping</span><span class="op" id="1401822">(</span><span class="ident" id="1401823">r</span><span class="op" id="1401824">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1401828">if</span>&nbsp;<span class="ident" id="1401831">r</span>&nbsp;<span class="op" id="1401833">&gt;=</span>&nbsp;<span class="num" id="1401836">0</span>&nbsp;<span class="op" id="1401838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401843">rl</span>&nbsp;<span class="op" id="1401846">:=</span>&nbsp;<span class="ident" id="1401849">utf8</span><span class="op" id="1401853">.</span><span class="ident" id="1401854">RuneLen</span><span class="op" id="1401861">(</span><span class="ident" id="1401862">r</span><span class="op" id="1401863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1401868">if</span>&nbsp;<span class="ident" id="1401871">rl</span>&nbsp;<span class="op" id="1401874">&lt;</span>&nbsp;<span class="num" id="1401876">0</span>&nbsp;<span class="op" id="1401878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401884">rl</span>&nbsp;<span class="op" id="1401887">=</span>&nbsp;<span class="builtinfunc" id="1401889">len</span><span class="op" id="1401892">(</span><span class="builtintype" id="1401893">string</span><span class="op" id="1401899">(</span><span class="ident" id="1401900">utf8</span><span class="op" id="1401904">.</span><span class="ident" id="1401905">RuneError</span><span class="op" id="1401914">)</span><span class="op" id="1401915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1401920">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1401925">if</span>&nbsp;<span class="ident" id="1401928">nbytes</span><span class="op" id="1401934">+</span><span class="ident" id="1401935">rl</span>&nbsp;<span class="op" id="1401938">&gt;</span>&nbsp;<span class="ident" id="1401940">maxbytes</span>&nbsp;<span class="op" id="1401949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1401955">//&nbsp;Grow&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1401979">maxbytes</span>&nbsp;<span class="op" id="1401988">=</span>&nbsp;<span class="ident" id="1401990">maxbytes</span><span class="op" id="1401998">*</span><span class="num" id="1401999">2</span>&nbsp;<span class="op" id="1402001">+</span>&nbsp;<span class="ident" id="1402003">utf8</span><span class="op" id="1402007">.</span><span class="ident" id="1402008">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1402019">nb</span>&nbsp;<span class="op" id="1402022">:=</span>&nbsp;<span class="builtinfunc" id="1402025">make</span><span class="op" id="1402029">(</span><span class="op" id="1402030">[</span><span class="op" id="1402031">]</span><span class="builtintype" id="1402032">byte</span><span class="op" id="1402036">,</span>&nbsp;<span class="ident" id="1402038">maxbytes</span><span class="op" id="1402046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1402052">copy</span><span class="op" id="1402056">(</span><span class="ident" id="1402057">nb</span><span class="op" id="1402059">,</span>&nbsp;<span class="ident" id="1402061">b</span><span class="op" id="1402062">[</span><span class="num" id="1402063">0</span><span class="op" id="1402064">:</span><span class="ident" id="1402065">nbytes</span><span class="op" id="1402071">]</span><span class="op" id="1402072">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1402078">b</span>&nbsp;<span class="op" id="1402080">=</span>&nbsp;<span class="ident" id="1402082">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1402088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1402093">nbytes</span>&nbsp;<span class="op" id="1402100">+=</span>&nbsp;<span class="ident" id="1402103">utf8</span><span class="op" id="1402107">.</span><span class="ident" id="1402108">EncodeRune</span><span class="op" id="1402118">(</span><span class="ident" id="1402119">b</span><span class="op" id="1402120">[</span><span class="ident" id="1402121">nbytes</span><span class="op" id="1402127">:</span><span class="ident" id="1402128">maxbytes</span><span class="op" id="1402136">]</span><span class="op" id="1402137">,</span>&nbsp;<span class="ident" id="1402139">r</span><span class="op" id="1402140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1402144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1402148">i</span>&nbsp;<span class="op" id="1402150">+=</span>&nbsp;<span class="ident" id="1402153">wid</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1402158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1402161">return</span>&nbsp;<span class="ident" id="1402168">b</span><span class="op" id="1402169">[</span><span class="num" id="1402170">0</span><span class="op" id="1402171">:</span><span class="ident" id="1402172">nbytes</span><span class="op" id="1402178">]</span><br>
<span class="lineno"></span><span class="op" id="1402180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1402183">//&nbsp;Repeat&nbsp;returns&nbsp;a&nbsp;new&nbsp;byte&nbsp;slice&nbsp;consisting&nbsp;of&nbsp;count&nbsp;copies&nbsp;of&nbsp;b.</span><br>
<span class="lineno">380</span><span class="keyword" id="1402251">func</span>&nbsp;<span class="ident" id="1402256">Repeat</span><span class="op" id="1402262">(</span><span class="ident" id="1402263">b</span>&nbsp;<span class="op" id="1402265">[</span><span class="op" id="1402266">]</span><span class="builtintype" id="1402267">byte</span><span class="op" id="1402271">,</span>&nbsp;<span class="ident" id="1402273">count</span>&nbsp;<span class="builtintype" id="1402279">int</span><span class="op" id="1402282">)</span>&nbsp;<span class="op" id="1402284">[</span><span class="op" id="1402285">]</span><span class="builtintype" id="1402286">byte</span>&nbsp;<span class="op" id="1402291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1402294">nb</span>&nbsp;<span class="op" id="1402297">:=</span>&nbsp;<span class="builtinfunc" id="1402300">make</span><span class="op" id="1402304">(</span><span class="op" id="1402305">[</span><span class="op" id="1402306">]</span><span class="builtintype" id="1402307">byte</span><span class="op" id="1402311">,</span>&nbsp;<span class="builtinfunc" id="1402313">len</span><span class="op" id="1402316">(</span><span class="ident" id="1402317">b</span><span class="op" id="1402318">)</span><span class="op" id="1402319">*</span><span class="ident" id="1402320">count</span><span class="op" id="1402325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1402328">bp</span>&nbsp;<span class="op" id="1402331">:=</span>&nbsp;<span class="builtinfunc" id="1402334">copy</span><span class="op" id="1402338">(</span><span class="ident" id="1402339">nb</span><span class="op" id="1402341">,</span>&nbsp;<span class="ident" id="1402343">b</span><span class="op" id="1402344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1402347">for</span>&nbsp;<span class="ident" id="1402351">bp</span>&nbsp;<span class="op" id="1402354">&lt;</span>&nbsp;<span class="builtinfunc" id="1402356">len</span><span class="op" id="1402359">(</span><span class="ident" id="1402360">nb</span><span class="op" id="1402362">)</span>&nbsp;<span class="op" id="1402364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1402368">copy</span><span class="op" id="1402372">(</span><span class="ident" id="1402373">nb</span><span class="op" id="1402375">[</span><span class="ident" id="1402376">bp</span><span class="op" id="1402378">:</span><span class="op" id="1402379">]</span><span class="op" id="1402380">,</span>&nbsp;<span class="ident" id="1402382">nb</span><span class="op" id="1402384">[</span><span class="op" id="1402385">:</span><span class="ident" id="1402386">bp</span><span class="op" id="1402388">]</span><span class="op" id="1402389">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1402393">bp</span>&nbsp;<span class="op" id="1402396">*=</span>&nbsp;<span class="num" id="1402399">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1402402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1402405">return</span>&nbsp;<span class="ident" id="1402412">nb</span><br>
<span class="lineno"></span><span class="op" id="1402415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="comment" id="1402418">//&nbsp;ToUpper&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="1402517">func</span>&nbsp;<span class="ident" id="1402522">ToUpper</span><span class="op" id="1402529">(</span><span class="ident" id="1402530">s</span>&nbsp;<span class="op" id="1402532">[</span><span class="op" id="1402533">]</span><span class="builtintype" id="1402534">byte</span><span class="op" id="1402538">)</span>&nbsp;<span class="op" id="1402540">[</span><span class="op" id="1402541">]</span><span class="builtintype" id="1402542">byte</span>&nbsp;<span class="op" id="1402547">{</span>&nbsp;<span class="keyword" id="1402549">return</span>&nbsp;<span class="ident" id="1402556">Map</span><span class="op" id="1402559">(</span><span class="ident" id="1402560">unicode</span><span class="op" id="1402567">.</span><span class="ident" id="1402568">ToUpper</span><span class="op" id="1402575">,</span>&nbsp;<span class="ident" id="1402577">s</span><span class="op" id="1402578">)</span>&nbsp;<span class="op" id="1402580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1402583">//&nbsp;ToLower&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="1402682">func</span>&nbsp;<span class="ident" id="1402687">ToLower</span><span class="op" id="1402694">(</span><span class="ident" id="1402695">s</span>&nbsp;<span class="op" id="1402697">[</span><span class="op" id="1402698">]</span><span class="builtintype" id="1402699">byte</span><span class="op" id="1402703">)</span>&nbsp;<span class="op" id="1402705">[</span><span class="op" id="1402706">]</span><span class="builtintype" id="1402707">byte</span>&nbsp;<span class="op" id="1402712">{</span>&nbsp;<span class="keyword" id="1402714">return</span>&nbsp;<span class="ident" id="1402721">Map</span><span class="op" id="1402724">(</span><span class="ident" id="1402725">unicode</span><span class="op" id="1402732">.</span><span class="ident" id="1402733">ToLower</span><span class="op" id="1402740">,</span>&nbsp;<span class="ident" id="1402742">s</span><span class="op" id="1402743">)</span>&nbsp;<span class="op" id="1402745">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="1402748">//&nbsp;ToTitle&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="1402847">func</span>&nbsp;<span class="ident" id="1402852">ToTitle</span><span class="op" id="1402859">(</span><span class="ident" id="1402860">s</span>&nbsp;<span class="op" id="1402862">[</span><span class="op" id="1402863">]</span><span class="builtintype" id="1402864">byte</span><span class="op" id="1402868">)</span>&nbsp;<span class="op" id="1402870">[</span><span class="op" id="1402871">]</span><span class="builtintype" id="1402872">byte</span>&nbsp;<span class="op" id="1402877">{</span>&nbsp;<span class="keyword" id="1402879">return</span>&nbsp;<span class="ident" id="1402886">Map</span><span class="op" id="1402889">(</span><span class="ident" id="1402890">unicode</span><span class="op" id="1402897">.</span><span class="ident" id="1402898">ToTitle</span><span class="op" id="1402905">,</span>&nbsp;<span class="ident" id="1402907">s</span><span class="op" id="1402908">)</span>&nbsp;<span class="op" id="1402910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1402913">//&nbsp;ToUpperSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno">400</span><span class="comment" id="1403007">//&nbsp;upper&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="1403067">func</span>&nbsp;<span class="ident" id="1403072">ToUpperSpecial</span><span class="op" id="1403086">(</span><span class="ident" id="1403087">_case</span>&nbsp;<span class="ident" id="1403093">unicode</span><span class="op" id="1403100">.</span><span class="ident" id="1403101">SpecialCase</span><span class="op" id="1403112">,</span>&nbsp;<span class="ident" id="1403114">s</span>&nbsp;<span class="op" id="1403116">[</span><span class="op" id="1403117">]</span><span class="builtintype" id="1403118">byte</span><span class="op" id="1403122">)</span>&nbsp;<span class="op" id="1403124">[</span><span class="op" id="1403125">]</span><span class="builtintype" id="1403126">byte</span>&nbsp;<span class="op" id="1403131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1403134">return</span>&nbsp;<span class="ident" id="1403141">Map</span><span class="op" id="1403144">(</span><span class="keyword" id="1403145">func</span><span class="op" id="1403149">(</span><span class="ident" id="1403150">r</span>&nbsp;<span class="builtintype" id="1403152">rune</span><span class="op" id="1403156">)</span>&nbsp;<span class="builtintype" id="1403158">rune</span>&nbsp;<span class="op" id="1403163">{</span>&nbsp;<span class="keyword" id="1403165">return</span>&nbsp;<span class="ident" id="1403172">_case</span><span class="op" id="1403177">.</span><span class="ident" id="1403178">ToUpper</span><span class="op" id="1403185">(</span><span class="ident" id="1403186">r</span><span class="op" id="1403187">)</span>&nbsp;<span class="op" id="1403189">}</span><span class="op" id="1403190">,</span>&nbsp;<span class="ident" id="1403192">s</span><span class="op" id="1403193">)</span><br>
<span class="lineno"></span><span class="op" id="1403195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="1403198">//&nbsp;ToLowerSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="1403292">//&nbsp;lower&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="1403352">func</span>&nbsp;<span class="ident" id="1403357">ToLowerSpecial</span><span class="op" id="1403371">(</span><span class="ident" id="1403372">_case</span>&nbsp;<span class="ident" id="1403378">unicode</span><span class="op" id="1403385">.</span><span class="ident" id="1403386">SpecialCase</span><span class="op" id="1403397">,</span>&nbsp;<span class="ident" id="1403399">s</span>&nbsp;<span class="op" id="1403401">[</span><span class="op" id="1403402">]</span><span class="builtintype" id="1403403">byte</span><span class="op" id="1403407">)</span>&nbsp;<span class="op" id="1403409">[</span><span class="op" id="1403410">]</span><span class="builtintype" id="1403411">byte</span>&nbsp;<span class="op" id="1403416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1403419">return</span>&nbsp;<span class="ident" id="1403426">Map</span><span class="op" id="1403429">(</span><span class="keyword" id="1403430">func</span><span class="op" id="1403434">(</span><span class="ident" id="1403435">r</span>&nbsp;<span class="builtintype" id="1403437">rune</span><span class="op" id="1403441">)</span>&nbsp;<span class="builtintype" id="1403443">rune</span>&nbsp;<span class="op" id="1403448">{</span>&nbsp;<span class="keyword" id="1403450">return</span>&nbsp;<span class="ident" id="1403457">_case</span><span class="op" id="1403462">.</span><span class="ident" id="1403463">ToLower</span><span class="op" id="1403470">(</span><span class="ident" id="1403471">r</span><span class="op" id="1403472">)</span>&nbsp;<span class="op" id="1403474">}</span><span class="op" id="1403475">,</span>&nbsp;<span class="ident" id="1403477">s</span><span class="op" id="1403478">)</span><br>
<span class="lineno"></span><span class="op" id="1403480">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span><span class="comment" id="1403483">//&nbsp;ToTitleSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="1403577">//&nbsp;title&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="1403637">func</span>&nbsp;<span class="ident" id="1403642">ToTitleSpecial</span><span class="op" id="1403656">(</span><span class="ident" id="1403657">_case</span>&nbsp;<span class="ident" id="1403663">unicode</span><span class="op" id="1403670">.</span><span class="ident" id="1403671">SpecialCase</span><span class="op" id="1403682">,</span>&nbsp;<span class="ident" id="1403684">s</span>&nbsp;<span class="op" id="1403686">[</span><span class="op" id="1403687">]</span><span class="builtintype" id="1403688">byte</span><span class="op" id="1403692">)</span>&nbsp;<span class="op" id="1403694">[</span><span class="op" id="1403695">]</span><span class="builtintype" id="1403696">byte</span>&nbsp;<span class="op" id="1403701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1403704">return</span>&nbsp;<span class="ident" id="1403711">Map</span><span class="op" id="1403714">(</span><span class="keyword" id="1403715">func</span><span class="op" id="1403719">(</span><span class="ident" id="1403720">r</span>&nbsp;<span class="builtintype" id="1403722">rune</span><span class="op" id="1403726">)</span>&nbsp;<span class="builtintype" id="1403728">rune</span>&nbsp;<span class="op" id="1403733">{</span>&nbsp;<span class="keyword" id="1403735">return</span>&nbsp;<span class="ident" id="1403742">_case</span><span class="op" id="1403747">.</span><span class="ident" id="1403748">ToTitle</span><span class="op" id="1403755">(</span><span class="ident" id="1403756">r</span><span class="op" id="1403757">)</span>&nbsp;<span class="op" id="1403759">}</span><span class="op" id="1403760">,</span>&nbsp;<span class="ident" id="1403762">s</span><span class="op" id="1403763">)</span><br>
<span class="lineno">415</span><span class="op" id="1403765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1403768">//&nbsp;isSeparator&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;could&nbsp;mark&nbsp;a&nbsp;word&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="comment" id="1403836">//&nbsp;TODO:&nbsp;update&nbsp;when&nbsp;package&nbsp;unicode&nbsp;captures&nbsp;more&nbsp;of&nbsp;the&nbsp;properties.</span><br>
<span class="lineno"></span><span class="keyword" id="1403906">func</span>&nbsp;<span class="ident" id="1403911">isSeparator</span><span class="op" id="1403922">(</span><span class="ident" id="1403923">r</span>&nbsp;<span class="builtintype" id="1403925">rune</span><span class="op" id="1403929">)</span>&nbsp;<span class="builtintype" id="1403931">bool</span>&nbsp;<span class="op" id="1403936">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1403939">//&nbsp;ASCII&nbsp;alphanumerics&nbsp;and&nbsp;underscore&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1403997">if</span>&nbsp;<span class="ident" id="1404000">r</span>&nbsp;<span class="op" id="1404002">&lt;=</span>&nbsp;<span class="num" id="1404005">0x7F</span>&nbsp;<span class="op" id="1404010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404014">switch</span>&nbsp;<span class="op" id="1404021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404025">case</span>&nbsp;<span class="string" id="1404030">&#39;0&#39;</span>&nbsp;<span class="op" id="1404034">&lt;=</span>&nbsp;<span class="ident" id="1404037">r</span>&nbsp;<span class="op" id="1404039">&amp;&amp;</span>&nbsp;<span class="ident" id="1404042">r</span>&nbsp;<span class="op" id="1404044">&lt;=</span>&nbsp;<span class="string" id="1404047">&#39;9&#39;</span><span class="op" id="1404050">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404055">return</span>&nbsp;<span class="builtintype" id="1404062">false</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404070">case</span>&nbsp;<span class="string" id="1404075">&#39;a&#39;</span>&nbsp;<span class="op" id="1404079">&lt;=</span>&nbsp;<span class="ident" id="1404082">r</span>&nbsp;<span class="op" id="1404084">&amp;&amp;</span>&nbsp;<span class="ident" id="1404087">r</span>&nbsp;<span class="op" id="1404089">&lt;=</span>&nbsp;<span class="string" id="1404092">&#39;z&#39;</span><span class="op" id="1404095">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404100">return</span>&nbsp;<span class="builtintype" id="1404107">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404115">case</span>&nbsp;<span class="string" id="1404120">&#39;A&#39;</span>&nbsp;<span class="op" id="1404124">&lt;=</span>&nbsp;<span class="ident" id="1404127">r</span>&nbsp;<span class="op" id="1404129">&amp;&amp;</span>&nbsp;<span class="ident" id="1404132">r</span>&nbsp;<span class="op" id="1404134">&lt;=</span>&nbsp;<span class="string" id="1404137">&#39;Z&#39;</span><span class="op" id="1404140">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404145">return</span>&nbsp;<span class="builtintype" id="1404152">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404160">case</span>&nbsp;<span class="ident" id="1404165">r</span>&nbsp;<span class="op" id="1404167">==</span>&nbsp;<span class="string" id="1404170">&#39;_&#39;</span><span class="op" id="1404173">:</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404178">return</span>&nbsp;<span class="builtintype" id="1404185">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1404193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404197">return</span>&nbsp;<span class="builtintype" id="1404204">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1404210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1404213">//&nbsp;Letters&nbsp;and&nbsp;digits&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404255">if</span>&nbsp;<span class="ident" id="1404258">unicode</span><span class="op" id="1404265">.</span><span class="ident" id="1404266">IsLetter</span><span class="op" id="1404274">(</span><span class="ident" id="1404275">r</span><span class="op" id="1404276">)</span>&nbsp;<span class="op" id="1404278">||</span>&nbsp;<span class="ident" id="1404281">unicode</span><span class="op" id="1404288">.</span><span class="ident" id="1404289">IsDigit</span><span class="op" id="1404296">(</span><span class="ident" id="1404297">r</span><span class="op" id="1404298">)</span>&nbsp;<span class="op" id="1404300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404304">return</span>&nbsp;<span class="builtintype" id="1404311">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1404318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1404321">//&nbsp;Otherwise,&nbsp;all&nbsp;we&nbsp;can&nbsp;do&nbsp;for&nbsp;now&nbsp;is&nbsp;treat&nbsp;spaces&nbsp;as&nbsp;separators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404389">return</span>&nbsp;<span class="ident" id="1404396">unicode</span><span class="op" id="1404403">.</span><span class="ident" id="1404404">IsSpace</span><span class="op" id="1404411">(</span><span class="ident" id="1404412">r</span><span class="op" id="1404413">)</span><br>
<span class="lineno">440</span><span class="op" id="1404415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1404418">//&nbsp;Title&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;that&nbsp;begin&nbsp;words</span><br>
<span class="lineno"></span><span class="comment" id="1404489">//&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="comment" id="1404520">//</span><br>
<span class="lineno">445</span><span class="comment" id="1404523">//&nbsp;BUG:&nbsp;The&nbsp;rule&nbsp;Title&nbsp;uses&nbsp;for&nbsp;word&nbsp;boundaries&nbsp;does&nbsp;not&nbsp;handle&nbsp;Unicode&nbsp;punctuation&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="1404617">func</span>&nbsp;<span class="ident" id="1404622">Title</span><span class="op" id="1404627">(</span><span class="ident" id="1404628">s</span>&nbsp;<span class="op" id="1404630">[</span><span class="op" id="1404631">]</span><span class="builtintype" id="1404632">byte</span><span class="op" id="1404636">)</span>&nbsp;<span class="op" id="1404638">[</span><span class="op" id="1404639">]</span><span class="builtintype" id="1404640">byte</span>&nbsp;<span class="op" id="1404645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1404648">//&nbsp;Use&nbsp;a&nbsp;closure&nbsp;here&nbsp;to&nbsp;remember&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1404690">//&nbsp;Hackish&nbsp;but&nbsp;effective.&nbsp;Depends&nbsp;on&nbsp;Map&nbsp;scanning&nbsp;in&nbsp;order&nbsp;and&nbsp;calling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1404762">//&nbsp;the&nbsp;closure&nbsp;once&nbsp;per&nbsp;rune.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1404793">prev</span>&nbsp;<span class="op" id="1404798">:=</span>&nbsp;<span class="string" id="1404801">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404806">return</span>&nbsp;<span class="ident" id="1404813">Map</span><span class="op" id="1404816">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404820">func</span><span class="op" id="1404824">(</span><span class="ident" id="1404825">r</span>&nbsp;<span class="builtintype" id="1404827">rune</span><span class="op" id="1404831">)</span>&nbsp;<span class="builtintype" id="1404833">rune</span>&nbsp;<span class="op" id="1404838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404843">if</span>&nbsp;<span class="ident" id="1404846">isSeparator</span><span class="op" id="1404857">(</span><span class="ident" id="1404858">prev</span><span class="op" id="1404862">)</span>&nbsp;<span class="op" id="1404864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1404870">prev</span>&nbsp;<span class="op" id="1404875">=</span>&nbsp;<span class="ident" id="1404877">r</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404883">return</span>&nbsp;<span class="ident" id="1404890">unicode</span><span class="op" id="1404897">.</span><span class="ident" id="1404898">ToTitle</span><span class="op" id="1404905">(</span><span class="ident" id="1404906">r</span><span class="op" id="1404907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1404912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1404917">prev</span>&nbsp;<span class="op" id="1404922">=</span>&nbsp;<span class="ident" id="1404924">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1404929">return</span>&nbsp;<span class="ident" id="1404936">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1404940">}</span><span class="op" id="1404941">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1404945">s</span><span class="op" id="1404946">)</span><br>
<span class="lineno"></span><span class="op" id="1404948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1404951">//&nbsp;TrimLeftFunc&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="1405032">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;that&nbsp;satisfy&nbsp;f(c).</span><br>
<span class="lineno">465</span><span class="keyword" id="1405076">func</span>&nbsp;<span class="ident" id="1405081">TrimLeftFunc</span><span class="op" id="1405093">(</span><span class="ident" id="1405094">s</span>&nbsp;<span class="op" id="1405096">[</span><span class="op" id="1405097">]</span><span class="builtintype" id="1405098">byte</span><span class="op" id="1405102">,</span>&nbsp;<span class="ident" id="1405104">f</span>&nbsp;<span class="keyword" id="1405106">func</span><span class="op" id="1405110">(</span><span class="ident" id="1405111">r</span>&nbsp;<span class="builtintype" id="1405113">rune</span><span class="op" id="1405117">)</span>&nbsp;<span class="builtintype" id="1405119">bool</span><span class="op" id="1405123">)</span>&nbsp;<span class="op" id="1405125">[</span><span class="op" id="1405126">]</span><span class="builtintype" id="1405127">byte</span>&nbsp;<span class="op" id="1405132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405135">i</span>&nbsp;<span class="op" id="1405137">:=</span>&nbsp;<span class="ident" id="1405140">indexFunc</span><span class="op" id="1405149">(</span><span class="ident" id="1405150">s</span><span class="op" id="1405151">,</span>&nbsp;<span class="ident" id="1405153">f</span><span class="op" id="1405154">,</span>&nbsp;<span class="builtintype" id="1405156">false</span><span class="op" id="1405161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405164">if</span>&nbsp;<span class="ident" id="1405167">i</span>&nbsp;<span class="op" id="1405169">==</span>&nbsp;<span class="op" id="1405172">-</span><span class="num" id="1405173">1</span>&nbsp;<span class="op" id="1405175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405179">return</span>&nbsp;<span class="ident" id="1405186">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1405191">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405194">return</span>&nbsp;<span class="ident" id="1405201">s</span><span class="op" id="1405202">[</span><span class="ident" id="1405203">i</span><span class="op" id="1405204">:</span><span class="op" id="1405205">]</span><br>
<span class="lineno"></span><span class="op" id="1405207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1405210">//&nbsp;TrimRightFunc&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;trailing&nbsp;UTF-8</span><br>
<span class="lineno"></span><span class="comment" id="1405285">//&nbsp;encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;that&nbsp;satisfy&nbsp;f(c).</span><br>
<span class="lineno">475</span><span class="keyword" id="1405337">func</span>&nbsp;<span class="ident" id="1405342">TrimRightFunc</span><span class="op" id="1405355">(</span><span class="ident" id="1405356">s</span>&nbsp;<span class="op" id="1405358">[</span><span class="op" id="1405359">]</span><span class="builtintype" id="1405360">byte</span><span class="op" id="1405364">,</span>&nbsp;<span class="ident" id="1405366">f</span>&nbsp;<span class="keyword" id="1405368">func</span><span class="op" id="1405372">(</span><span class="ident" id="1405373">r</span>&nbsp;<span class="builtintype" id="1405375">rune</span><span class="op" id="1405379">)</span>&nbsp;<span class="builtintype" id="1405381">bool</span><span class="op" id="1405385">)</span>&nbsp;<span class="op" id="1405387">[</span><span class="op" id="1405388">]</span><span class="builtintype" id="1405389">byte</span>&nbsp;<span class="op" id="1405394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405397">i</span>&nbsp;<span class="op" id="1405399">:=</span>&nbsp;<span class="ident" id="1405402">lastIndexFunc</span><span class="op" id="1405415">(</span><span class="ident" id="1405416">s</span><span class="op" id="1405417">,</span>&nbsp;<span class="ident" id="1405419">f</span><span class="op" id="1405420">,</span>&nbsp;<span class="builtintype" id="1405422">false</span><span class="op" id="1405427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405430">if</span>&nbsp;<span class="ident" id="1405433">i</span>&nbsp;<span class="op" id="1405435">&gt;=</span>&nbsp;<span class="num" id="1405438">0</span>&nbsp;<span class="op" id="1405440">&amp;&amp;</span>&nbsp;<span class="ident" id="1405443">s</span><span class="op" id="1405444">[</span><span class="ident" id="1405445">i</span><span class="op" id="1405446">]</span>&nbsp;<span class="op" id="1405448">&gt;=</span>&nbsp;<span class="ident" id="1405451">utf8</span><span class="op" id="1405455">.</span><span class="ident" id="1405456">RuneSelf</span>&nbsp;<span class="op" id="1405465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405469">_</span><span class="op" id="1405470">,</span>&nbsp;<span class="ident" id="1405472">wid</span>&nbsp;<span class="op" id="1405476">:=</span>&nbsp;<span class="ident" id="1405479">utf8</span><span class="op" id="1405483">.</span><span class="ident" id="1405484">DecodeRune</span><span class="op" id="1405494">(</span><span class="ident" id="1405495">s</span><span class="op" id="1405496">[</span><span class="ident" id="1405497">i</span><span class="op" id="1405498">:</span><span class="op" id="1405499">]</span><span class="op" id="1405500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405504">i</span>&nbsp;<span class="op" id="1405506">+=</span>&nbsp;<span class="ident" id="1405509">wid</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1405514">}</span>&nbsp;<span class="keyword" id="1405516">else</span>&nbsp;<span class="op" id="1405521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1405525">i</span><span class="op" id="1405526">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1405530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405533">return</span>&nbsp;<span class="ident" id="1405540">s</span><span class="op" id="1405541">[</span><span class="num" id="1405542">0</span><span class="op" id="1405543">:</span><span class="ident" id="1405544">i</span><span class="op" id="1405545">]</span><br>
<span class="lineno"></span><span class="op" id="1405547">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="comment" id="1405550">//&nbsp;TrimFunc&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;and&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="1405626">//&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;that&nbsp;satisfy&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="keyword" id="1405684">func</span>&nbsp;<span class="ident" id="1405689">TrimFunc</span><span class="op" id="1405697">(</span><span class="ident" id="1405698">s</span>&nbsp;<span class="op" id="1405700">[</span><span class="op" id="1405701">]</span><span class="builtintype" id="1405702">byte</span><span class="op" id="1405706">,</span>&nbsp;<span class="ident" id="1405708">f</span>&nbsp;<span class="keyword" id="1405710">func</span><span class="op" id="1405714">(</span><span class="ident" id="1405715">r</span>&nbsp;<span class="builtintype" id="1405717">rune</span><span class="op" id="1405721">)</span>&nbsp;<span class="builtintype" id="1405723">bool</span><span class="op" id="1405727">)</span>&nbsp;<span class="op" id="1405729">[</span><span class="op" id="1405730">]</span><span class="builtintype" id="1405731">byte</span>&nbsp;<span class="op" id="1405736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405739">return</span>&nbsp;<span class="ident" id="1405746">TrimRightFunc</span><span class="op" id="1405759">(</span><span class="ident" id="1405760">TrimLeftFunc</span><span class="op" id="1405772">(</span><span class="ident" id="1405773">s</span><span class="op" id="1405774">,</span>&nbsp;<span class="ident" id="1405776">f</span><span class="op" id="1405777">)</span><span class="op" id="1405778">,</span>&nbsp;<span class="ident" id="1405780">f</span><span class="op" id="1405781">)</span><br>
<span class="lineno">490</span><span class="op" id="1405783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1405786">//&nbsp;TrimPrefix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;leading&nbsp;prefix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="1405854">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;start&nbsp;with&nbsp;prefix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="1405914">func</span>&nbsp;<span class="ident" id="1405919">TrimPrefix</span><span class="op" id="1405929">(</span><span class="ident" id="1405930">s</span><span class="op" id="1405931">,</span>&nbsp;<span class="ident" id="1405933">prefix</span>&nbsp;<span class="op" id="1405940">[</span><span class="op" id="1405941">]</span><span class="builtintype" id="1405942">byte</span><span class="op" id="1405946">)</span>&nbsp;<span class="op" id="1405948">[</span><span class="op" id="1405949">]</span><span class="builtintype" id="1405950">byte</span>&nbsp;<span class="op" id="1405955">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405958">if</span>&nbsp;<span class="ident" id="1405961">HasPrefix</span><span class="op" id="1405970">(</span><span class="ident" id="1405971">s</span><span class="op" id="1405972">,</span>&nbsp;<span class="ident" id="1405974">prefix</span><span class="op" id="1405980">)</span>&nbsp;<span class="op" id="1405982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1405986">return</span>&nbsp;<span class="ident" id="1405993">s</span><span class="op" id="1405994">[</span><span class="builtinfunc" id="1405995">len</span><span class="op" id="1405998">(</span><span class="ident" id="1405999">prefix</span><span class="op" id="1406005">)</span><span class="op" id="1406006">:</span><span class="op" id="1406007">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1406010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1406013">return</span>&nbsp;<span class="ident" id="1406020">s</span><br>
<span class="lineno"></span><span class="op" id="1406022">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="1406025">//&nbsp;TrimSuffix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;trailing&nbsp;suffix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="1406094">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;end&nbsp;with&nbsp;suffix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="1406152">func</span>&nbsp;<span class="ident" id="1406157">TrimSuffix</span><span class="op" id="1406167">(</span><span class="ident" id="1406168">s</span><span class="op" id="1406169">,</span>&nbsp;<span class="ident" id="1406171">suffix</span>&nbsp;<span class="op" id="1406178">[</span><span class="op" id="1406179">]</span><span class="builtintype" id="1406180">byte</span><span class="op" id="1406184">)</span>&nbsp;<span class="op" id="1406186">[</span><span class="op" id="1406187">]</span><span class="builtintype" id="1406188">byte</span>&nbsp;<span class="op" id="1406193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1406196">if</span>&nbsp;<span class="ident" id="1406199">HasSuffix</span><span class="op" id="1406208">(</span><span class="ident" id="1406209">s</span><span class="op" id="1406210">,</span>&nbsp;<span class="ident" id="1406212">suffix</span><span class="op" id="1406218">)</span>&nbsp;<span class="op" id="1406220">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1406224">return</span>&nbsp;<span class="ident" id="1406231">s</span><span class="op" id="1406232">[</span><span class="op" id="1406233">:</span><span class="builtinfunc" id="1406234">len</span><span class="op" id="1406237">(</span><span class="ident" id="1406238">s</span><span class="op" id="1406239">)</span><span class="op" id="1406240">-</span><span class="builtinfunc" id="1406241">len</span><span class="op" id="1406244">(</span><span class="ident" id="1406245">suffix</span><span class="op" id="1406251">)</span><span class="op" id="1406252">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1406255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1406258">return</span>&nbsp;<span class="ident" id="1406265">s</span><br>
<span class="lineno"></span><span class="op" id="1406267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span><span class="comment" id="1406270">//&nbsp;IndexFunc&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="1406348">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;first&nbsp;Unicode</span><br>
<span class="lineno"></span><span class="comment" id="1406403">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="1406452">func</span>&nbsp;<span class="ident" id="1406457">IndexFunc</span><span class="op" id="1406466">(</span><span class="ident" id="1406467">s</span>&nbsp;<span class="op" id="1406469">[</span><span class="op" id="1406470">]</span><span class="builtintype" id="1406471">byte</span><span class="op" id="1406475">,</span>&nbsp;<span class="ident" id="1406477">f</span>&nbsp;<span class="keyword" id="1406479">func</span><span class="op" id="1406483">(</span><span class="ident" id="1406484">r</span>&nbsp;<span class="builtintype" id="1406486">rune</span><span class="op" id="1406490">)</span>&nbsp;<span class="builtintype" id="1406492">bool</span><span class="op" id="1406496">)</span>&nbsp;<span class="builtintype" id="1406498">int</span>&nbsp;<span class="op" id="1406502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1406505">return</span>&nbsp;<span class="ident" id="1406512">indexFunc</span><span class="op" id="1406521">(</span><span class="ident" id="1406522">s</span><span class="op" id="1406523">,</span>&nbsp;<span class="ident" id="1406525">f</span><span class="op" id="1406526">,</span>&nbsp;<span class="builtintype" id="1406528">true</span><span class="op" id="1406532">)</span><br>
<span class="lineno">515</span><span class="op" id="1406534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1406537">//&nbsp;LastIndexFunc&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="1406619">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;last&nbsp;Unicode</span><br>
<span class="lineno"></span><span class="comment" id="1406673">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno">520</span><span class="keyword" id="1406722">func</span>&nbsp;<span class="ident" id="1406727">LastIndexFunc</span><span class="op" id="1406740">(</span><span class="ident" id="1406741">s</span>&nbsp;<span class="op" id="1406743">[</span><span class="op" id="1406744">]</span><span class="builtintype" id="1406745">byte</span><span class="op" id="1406749">,</span>&nbsp;<span class="ident" id="1406751">f</span>&nbsp;<span class="keyword" id="1406753">func</span><span class="op" id="1406757">(</span><span class="ident" id="1406758">r</span>&nbsp;<span class="builtintype" id="1406760">rune</span><span class="op" id="1406764">)</span>&nbsp;<span class="builtintype" id="1406766">bool</span><span class="op" id="1406770">)</span>&nbsp;<span class="builtintype" id="1406772">int</span>&nbsp;<span class="op" id="1406776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1406779">return</span>&nbsp;<span class="ident" id="1406786">lastIndexFunc</span><span class="op" id="1406799">(</span><span class="ident" id="1406800">s</span><span class="op" id="1406801">,</span>&nbsp;<span class="ident" id="1406803">f</span><span class="op" id="1406804">,</span>&nbsp;<span class="builtintype" id="1406806">true</span><span class="op" id="1406810">)</span><br>
<span class="lineno"></span><span class="op" id="1406812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1406815">//&nbsp;indexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;IndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno">525</span><span class="comment" id="1406868">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1406924">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="1406937">func</span>&nbsp;<span class="ident" id="1406942">indexFunc</span><span class="op" id="1406951">(</span><span class="ident" id="1406952">s</span>&nbsp;<span class="op" id="1406954">[</span><span class="op" id="1406955">]</span><span class="builtintype" id="1406956">byte</span><span class="op" id="1406960">,</span>&nbsp;<span class="ident" id="1406962">f</span>&nbsp;<span class="keyword" id="1406964">func</span><span class="op" id="1406968">(</span><span class="ident" id="1406969">r</span>&nbsp;<span class="builtintype" id="1406971">rune</span><span class="op" id="1406975">)</span>&nbsp;<span class="builtintype" id="1406977">bool</span><span class="op" id="1406981">,</span>&nbsp;<span class="ident" id="1406983">truth</span>&nbsp;<span class="builtintype" id="1406989">bool</span><span class="op" id="1406993">)</span>&nbsp;<span class="builtintype" id="1406995">int</span>&nbsp;<span class="op" id="1406999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407002">start</span>&nbsp;<span class="op" id="1407008">:=</span>&nbsp;<span class="num" id="1407011">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407014">for</span>&nbsp;<span class="ident" id="1407018">start</span>&nbsp;<span class="op" id="1407024">&lt;</span>&nbsp;<span class="builtinfunc" id="1407026">len</span><span class="op" id="1407029">(</span><span class="ident" id="1407030">s</span><span class="op" id="1407031">)</span>&nbsp;<span class="op" id="1407033">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407037">wid</span>&nbsp;<span class="op" id="1407041">:=</span>&nbsp;<span class="num" id="1407044">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407048">r</span>&nbsp;<span class="op" id="1407050">:=</span>&nbsp;<span class="builtintype" id="1407053">rune</span><span class="op" id="1407057">(</span><span class="ident" id="1407058">s</span><span class="op" id="1407059">[</span><span class="ident" id="1407060">start</span><span class="op" id="1407065">]</span><span class="op" id="1407066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407070">if</span>&nbsp;<span class="ident" id="1407073">r</span>&nbsp;<span class="op" id="1407075">&gt;=</span>&nbsp;<span class="ident" id="1407078">utf8</span><span class="op" id="1407082">.</span><span class="ident" id="1407083">RuneSelf</span>&nbsp;<span class="op" id="1407092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407097">r</span><span class="op" id="1407098">,</span>&nbsp;<span class="ident" id="1407100">wid</span>&nbsp;<span class="op" id="1407104">=</span>&nbsp;<span class="ident" id="1407106">utf8</span><span class="op" id="1407110">.</span><span class="ident" id="1407111">DecodeRune</span><span class="op" id="1407121">(</span><span class="ident" id="1407122">s</span><span class="op" id="1407123">[</span><span class="ident" id="1407124">start</span><span class="op" id="1407129">:</span><span class="op" id="1407130">]</span><span class="op" id="1407131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407135">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407139">if</span>&nbsp;<span class="ident" id="1407142">f</span><span class="op" id="1407143">(</span><span class="ident" id="1407144">r</span><span class="op" id="1407145">)</span>&nbsp;<span class="op" id="1407147">==</span>&nbsp;<span class="ident" id="1407150">truth</span>&nbsp;<span class="op" id="1407156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407161">return</span>&nbsp;<span class="ident" id="1407168">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407180">start</span>&nbsp;<span class="op" id="1407186">+=</span>&nbsp;<span class="ident" id="1407189">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407194">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407197">return</span>&nbsp;<span class="op" id="1407204">-</span><span class="num" id="1407205">1</span><br>
<span class="lineno"></span><span class="op" id="1407207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1407210">//&nbsp;lastIndexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;LastIndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1407271">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno">545</span><span class="comment" id="1407327">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="1407340">func</span>&nbsp;<span class="ident" id="1407345">lastIndexFunc</span><span class="op" id="1407358">(</span><span class="ident" id="1407359">s</span>&nbsp;<span class="op" id="1407361">[</span><span class="op" id="1407362">]</span><span class="builtintype" id="1407363">byte</span><span class="op" id="1407367">,</span>&nbsp;<span class="ident" id="1407369">f</span>&nbsp;<span class="keyword" id="1407371">func</span><span class="op" id="1407375">(</span><span class="ident" id="1407376">r</span>&nbsp;<span class="builtintype" id="1407378">rune</span><span class="op" id="1407382">)</span>&nbsp;<span class="builtintype" id="1407384">bool</span><span class="op" id="1407388">,</span>&nbsp;<span class="ident" id="1407390">truth</span>&nbsp;<span class="builtintype" id="1407396">bool</span><span class="op" id="1407400">)</span>&nbsp;<span class="builtintype" id="1407402">int</span>&nbsp;<span class="op" id="1407406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407409">for</span>&nbsp;<span class="ident" id="1407413">i</span>&nbsp;<span class="op" id="1407415">:=</span>&nbsp;<span class="builtinfunc" id="1407418">len</span><span class="op" id="1407421">(</span><span class="ident" id="1407422">s</span><span class="op" id="1407423">)</span><span class="op" id="1407424">;</span>&nbsp;<span class="ident" id="1407426">i</span>&nbsp;<span class="op" id="1407428">&gt;</span>&nbsp;<span class="num" id="1407430">0</span><span class="op" id="1407431">;</span>&nbsp;<span class="op" id="1407433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407437">r</span><span class="op" id="1407438">,</span>&nbsp;<span class="ident" id="1407440">size</span>&nbsp;<span class="op" id="1407445">:=</span>&nbsp;<span class="builtintype" id="1407448">rune</span><span class="op" id="1407452">(</span><span class="ident" id="1407453">s</span><span class="op" id="1407454">[</span><span class="ident" id="1407455">i</span><span class="op" id="1407456">-</span><span class="num" id="1407457">1</span><span class="op" id="1407458">]</span><span class="op" id="1407459">)</span><span class="op" id="1407460">,</span>&nbsp;<span class="num" id="1407462">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407466">if</span>&nbsp;<span class="ident" id="1407469">r</span>&nbsp;<span class="op" id="1407471">&gt;=</span>&nbsp;<span class="ident" id="1407474">utf8</span><span class="op" id="1407478">.</span><span class="ident" id="1407479">RuneSelf</span>&nbsp;<span class="op" id="1407488">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407493">r</span><span class="op" id="1407494">,</span>&nbsp;<span class="ident" id="1407496">size</span>&nbsp;<span class="op" id="1407501">=</span>&nbsp;<span class="ident" id="1407503">utf8</span><span class="op" id="1407507">.</span><span class="ident" id="1407508">DecodeLastRune</span><span class="op" id="1407522">(</span><span class="ident" id="1407523">s</span><span class="op" id="1407524">[</span><span class="num" id="1407525">0</span><span class="op" id="1407526">:</span><span class="ident" id="1407527">i</span><span class="op" id="1407528">]</span><span class="op" id="1407529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1407537">i</span>&nbsp;<span class="op" id="1407539">-=</span>&nbsp;<span class="ident" id="1407542">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407549">if</span>&nbsp;<span class="ident" id="1407552">f</span><span class="op" id="1407553">(</span><span class="ident" id="1407554">r</span><span class="op" id="1407555">)</span>&nbsp;<span class="op" id="1407557">==</span>&nbsp;<span class="ident" id="1407560">truth</span>&nbsp;<span class="op" id="1407566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407571">return</span>&nbsp;<span class="ident" id="1407578">i</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407588">return</span>&nbsp;<span class="op" id="1407595">-</span><span class="num" id="1407596">1</span><br>
<span class="lineno"></span><span class="op" id="1407598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span><span class="keyword" id="1407601">func</span>&nbsp;<span class="ident" id="1407606">makeCutsetFunc</span><span class="op" id="1407620">(</span><span class="ident" id="1407621">cutset</span>&nbsp;<span class="builtintype" id="1407628">string</span><span class="op" id="1407634">)</span>&nbsp;<span class="keyword" id="1407636">func</span><span class="op" id="1407640">(</span><span class="ident" id="1407641">r</span>&nbsp;<span class="builtintype" id="1407643">rune</span><span class="op" id="1407647">)</span>&nbsp;<span class="builtintype" id="1407649">bool</span>&nbsp;<span class="op" id="1407654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407657">return</span>&nbsp;<span class="keyword" id="1407664">func</span><span class="op" id="1407668">(</span><span class="ident" id="1407669">r</span>&nbsp;<span class="builtintype" id="1407671">rune</span><span class="op" id="1407675">)</span>&nbsp;<span class="builtintype" id="1407677">bool</span>&nbsp;<span class="op" id="1407682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407686">for</span>&nbsp;<span class="ident" id="1407690">_</span><span class="op" id="1407691">,</span>&nbsp;<span class="ident" id="1407693">c</span>&nbsp;<span class="op" id="1407695">:=</span>&nbsp;<span class="keyword" id="1407698">range</span>&nbsp;<span class="ident" id="1407704">cutset</span>&nbsp;<span class="op" id="1407711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407716">if</span>&nbsp;<span class="ident" id="1407719">c</span>&nbsp;<span class="op" id="1407721">==</span>&nbsp;<span class="ident" id="1407724">r</span>&nbsp;<span class="op" id="1407726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407732">return</span>&nbsp;<span class="builtintype" id="1407739">true</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407755">return</span>&nbsp;<span class="builtintype" id="1407762">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1407769">}</span><br>
<span class="lineno"></span><span class="op" id="1407771">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="comment" id="1407774">//&nbsp;Trim&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1407837">//&nbsp;trailing&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset.</span><br>
<span class="lineno"></span><span class="keyword" id="1407904">func</span>&nbsp;<span class="ident" id="1407909">Trim</span><span class="op" id="1407913">(</span><span class="ident" id="1407914">s</span>&nbsp;<span class="op" id="1407916">[</span><span class="op" id="1407917">]</span><span class="builtintype" id="1407918">byte</span><span class="op" id="1407922">,</span>&nbsp;<span class="ident" id="1407924">cutset</span>&nbsp;<span class="builtintype" id="1407931">string</span><span class="op" id="1407937">)</span>&nbsp;<span class="op" id="1407939">[</span><span class="op" id="1407940">]</span><span class="builtintype" id="1407941">byte</span>&nbsp;<span class="op" id="1407946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1407949">return</span>&nbsp;<span class="ident" id="1407956">TrimFunc</span><span class="op" id="1407964">(</span><span class="ident" id="1407965">s</span><span class="op" id="1407966">,</span>&nbsp;<span class="ident" id="1407968">makeCutsetFunc</span><span class="op" id="1407982">(</span><span class="ident" id="1407983">cutset</span><span class="op" id="1407989">)</span><span class="op" id="1407990">)</span><br>
<span class="lineno">575</span><span class="op" id="1407992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1407995">//&nbsp;TrimLeft&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="1408058">//&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset.</span><br>
<span class="lineno"></span><span class="keyword" id="1408116">func</span>&nbsp;<span class="ident" id="1408121">TrimLeft</span><span class="op" id="1408129">(</span><span class="ident" id="1408130">s</span>&nbsp;<span class="op" id="1408132">[</span><span class="op" id="1408133">]</span><span class="builtintype" id="1408134">byte</span><span class="op" id="1408138">,</span>&nbsp;<span class="ident" id="1408140">cutset</span>&nbsp;<span class="builtintype" id="1408147">string</span><span class="op" id="1408153">)</span>&nbsp;<span class="op" id="1408155">[</span><span class="op" id="1408156">]</span><span class="builtintype" id="1408157">byte</span>&nbsp;<span class="op" id="1408162">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408165">return</span>&nbsp;<span class="ident" id="1408172">TrimLeftFunc</span><span class="op" id="1408184">(</span><span class="ident" id="1408185">s</span><span class="op" id="1408186">,</span>&nbsp;<span class="ident" id="1408188">makeCutsetFunc</span><span class="op" id="1408202">(</span><span class="ident" id="1408203">cutset</span><span class="op" id="1408209">)</span><span class="op" id="1408210">)</span><br>
<span class="lineno"></span><span class="op" id="1408212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1408215">//&nbsp;TrimRight&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="1408280">//&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;that&nbsp;are&nbsp;contained&nbsp;in&nbsp;cutset.</span><br>
<span class="lineno">585</span><span class="keyword" id="1408347">func</span>&nbsp;<span class="ident" id="1408352">TrimRight</span><span class="op" id="1408361">(</span><span class="ident" id="1408362">s</span>&nbsp;<span class="op" id="1408364">[</span><span class="op" id="1408365">]</span><span class="builtintype" id="1408366">byte</span><span class="op" id="1408370">,</span>&nbsp;<span class="ident" id="1408372">cutset</span>&nbsp;<span class="builtintype" id="1408379">string</span><span class="op" id="1408385">)</span>&nbsp;<span class="op" id="1408387">[</span><span class="op" id="1408388">]</span><span class="builtintype" id="1408389">byte</span>&nbsp;<span class="op" id="1408394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408397">return</span>&nbsp;<span class="ident" id="1408404">TrimRightFunc</span><span class="op" id="1408417">(</span><span class="ident" id="1408418">s</span><span class="op" id="1408419">,</span>&nbsp;<span class="ident" id="1408421">makeCutsetFunc</span><span class="op" id="1408435">(</span><span class="ident" id="1408436">cutset</span><span class="op" id="1408442">)</span><span class="op" id="1408443">)</span><br>
<span class="lineno"></span><span class="op" id="1408445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1408448">//&nbsp;TrimSpace&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno">590</span><span class="comment" id="1408516">//&nbsp;trailing&nbsp;white&nbsp;space,&nbsp;as&nbsp;defined&nbsp;by&nbsp;Unicode.</span><br>
<span class="lineno"></span><span class="keyword" id="1408564">func</span>&nbsp;<span class="ident" id="1408569">TrimSpace</span><span class="op" id="1408578">(</span><span class="ident" id="1408579">s</span>&nbsp;<span class="op" id="1408581">[</span><span class="op" id="1408582">]</span><span class="builtintype" id="1408583">byte</span><span class="op" id="1408587">)</span>&nbsp;<span class="op" id="1408589">[</span><span class="op" id="1408590">]</span><span class="builtintype" id="1408591">byte</span>&nbsp;<span class="op" id="1408596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408599">return</span>&nbsp;<span class="ident" id="1408606">TrimFunc</span><span class="op" id="1408614">(</span><span class="ident" id="1408615">s</span><span class="op" id="1408616">,</span>&nbsp;<span class="ident" id="1408618">unicode</span><span class="op" id="1408625">.</span><span class="ident" id="1408626">IsSpace</span><span class="op" id="1408633">)</span><br>
<span class="lineno"></span><span class="op" id="1408635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="1408638">//&nbsp;Runes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;runes&nbsp;(Unicode&nbsp;code&nbsp;points)&nbsp;equivalent&nbsp;to&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="1408711">func</span>&nbsp;<span class="ident" id="1408716">Runes</span><span class="op" id="1408721">(</span><span class="ident" id="1408722">s</span>&nbsp;<span class="op" id="1408724">[</span><span class="op" id="1408725">]</span><span class="builtintype" id="1408726">byte</span><span class="op" id="1408730">)</span>&nbsp;<span class="op" id="1408732">[</span><span class="op" id="1408733">]</span><span class="builtintype" id="1408734">rune</span>&nbsp;<span class="op" id="1408739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408742">t</span>&nbsp;<span class="op" id="1408744">:=</span>&nbsp;<span class="builtinfunc" id="1408747">make</span><span class="op" id="1408751">(</span><span class="op" id="1408752">[</span><span class="op" id="1408753">]</span><span class="builtintype" id="1408754">rune</span><span class="op" id="1408758">,</span>&nbsp;<span class="ident" id="1408760">utf8</span><span class="op" id="1408764">.</span><span class="ident" id="1408765">RuneCount</span><span class="op" id="1408774">(</span><span class="ident" id="1408775">s</span><span class="op" id="1408776">)</span><span class="op" id="1408777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408780">i</span>&nbsp;<span class="op" id="1408782">:=</span>&nbsp;<span class="num" id="1408785">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408788">for</span>&nbsp;<span class="builtinfunc" id="1408792">len</span><span class="op" id="1408795">(</span><span class="ident" id="1408796">s</span><span class="op" id="1408797">)</span>&nbsp;<span class="op" id="1408799">&gt;</span>&nbsp;<span class="num" id="1408801">0</span>&nbsp;<span class="op" id="1408803">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408807">r</span><span class="op" id="1408808">,</span>&nbsp;<span class="ident" id="1408810">l</span>&nbsp;<span class="op" id="1408812">:=</span>&nbsp;<span class="ident" id="1408815">utf8</span><span class="op" id="1408819">.</span><span class="ident" id="1408820">DecodeRune</span><span class="op" id="1408830">(</span><span class="ident" id="1408831">s</span><span class="op" id="1408832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408836">t</span><span class="op" id="1408837">[</span><span class="ident" id="1408838">i</span><span class="op" id="1408839">]</span>&nbsp;<span class="op" id="1408841">=</span>&nbsp;<span class="ident" id="1408843">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408847">i</span><span class="op" id="1408848">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1408853">s</span>&nbsp;<span class="op" id="1408855">=</span>&nbsp;<span class="ident" id="1408857">s</span><span class="op" id="1408858">[</span><span class="ident" id="1408859">l</span><span class="op" id="1408860">:</span><span class="op" id="1408861">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1408864">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1408867">return</span>&nbsp;<span class="ident" id="1408874">t</span><br>
<span class="lineno"></span><span class="op" id="1408876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1408879">//&nbsp;Replace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;slice&nbsp;s&nbsp;with&nbsp;the&nbsp;first&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="1408937">//&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;old&nbsp;replaced&nbsp;by&nbsp;new.</span><br>
<span class="lineno">610</span><span class="comment" id="1408990">//&nbsp;If&nbsp;old&nbsp;is&nbsp;empty,&nbsp;it&nbsp;matches&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="1409051">//&nbsp;and&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence,&nbsp;yielding&nbsp;up&nbsp;to&nbsp;k+1&nbsp;replacements</span><br>
<span class="lineno"></span><span class="comment" id="1409117">//&nbsp;for&nbsp;a&nbsp;k-rune&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="1409140">//&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;there&nbsp;is&nbsp;no&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span><span class="keyword" id="1409202">func</span>&nbsp;<span class="ident" id="1409207">Replace</span><span class="op" id="1409214">(</span><span class="ident" id="1409215">s</span><span class="op" id="1409216">,</span>&nbsp;<span class="ident" id="1409218">old</span><span class="op" id="1409221">,</span>&nbsp;<span class="builtinfunc" id="1409223">new</span>&nbsp;<span class="op" id="1409227">[</span><span class="op" id="1409228">]</span><span class="builtintype" id="1409229">byte</span><span class="op" id="1409233">,</span>&nbsp;<span class="ident" id="1409235">n</span>&nbsp;<span class="builtintype" id="1409237">int</span><span class="op" id="1409240">)</span>&nbsp;<span class="op" id="1409242">[</span><span class="op" id="1409243">]</span><span class="builtintype" id="1409244">byte</span>&nbsp;<span class="op" id="1409249">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409252">m</span>&nbsp;<span class="op" id="1409254">:=</span>&nbsp;<span class="num" id="1409257">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409260">if</span>&nbsp;<span class="ident" id="1409263">n</span>&nbsp;<span class="op" id="1409265">!=</span>&nbsp;<span class="num" id="1409268">0</span>&nbsp;<span class="op" id="1409270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1409274">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409311">m</span>&nbsp;<span class="op" id="1409313">=</span>&nbsp;<span class="ident" id="1409315">Count</span><span class="op" id="1409320">(</span><span class="ident" id="1409321">s</span><span class="op" id="1409322">,</span>&nbsp;<span class="ident" id="1409324">old</span><span class="op" id="1409327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409330">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409333">if</span>&nbsp;<span class="ident" id="1409336">m</span>&nbsp;<span class="op" id="1409338">==</span>&nbsp;<span class="num" id="1409341">0</span>&nbsp;<span class="op" id="1409343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1409347">//&nbsp;Just&nbsp;return&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409372">return</span>&nbsp;<span class="builtinfunc" id="1409379">append</span><span class="op" id="1409385">(</span><span class="op" id="1409386">[</span><span class="op" id="1409387">]</span><span class="builtintype" id="1409388">byte</span><span class="op" id="1409392">(</span><span class="ident" id="1409393">nil</span><span class="op" id="1409396">)</span><span class="op" id="1409397">,</span>&nbsp;<span class="ident" id="1409399">s</span><span class="op" id="1409400">...</span><span class="op" id="1409403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409409">if</span>&nbsp;<span class="ident" id="1409412">n</span>&nbsp;<span class="op" id="1409414">&lt;</span>&nbsp;<span class="num" id="1409416">0</span>&nbsp;<span class="op" id="1409418">||</span>&nbsp;<span class="ident" id="1409421">m</span>&nbsp;<span class="op" id="1409423">&lt;</span>&nbsp;<span class="ident" id="1409425">n</span>&nbsp;<span class="op" id="1409427">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409431">n</span>&nbsp;<span class="op" id="1409433">=</span>&nbsp;<span class="ident" id="1409435">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1409442">//&nbsp;Apply&nbsp;replacements&nbsp;to&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409476">t</span>&nbsp;<span class="op" id="1409478">:=</span>&nbsp;<span class="builtinfunc" id="1409481">make</span><span class="op" id="1409485">(</span><span class="op" id="1409486">[</span><span class="op" id="1409487">]</span><span class="builtintype" id="1409488">byte</span><span class="op" id="1409492">,</span>&nbsp;<span class="builtinfunc" id="1409494">len</span><span class="op" id="1409497">(</span><span class="ident" id="1409498">s</span><span class="op" id="1409499">)</span><span class="op" id="1409500">+</span><span class="ident" id="1409501">n</span><span class="op" id="1409502">*</span><span class="op" id="1409503">(</span><span class="builtinfunc" id="1409504">len</span><span class="op" id="1409507">(</span><span class="builtinfunc" id="1409508">new</span><span class="op" id="1409511">)</span><span class="op" id="1409512">-</span><span class="builtinfunc" id="1409513">len</span><span class="op" id="1409516">(</span><span class="ident" id="1409517">old</span><span class="op" id="1409520">)</span><span class="op" id="1409521">)</span><span class="op" id="1409522">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409525">w</span>&nbsp;<span class="op" id="1409527">:=</span>&nbsp;<span class="num" id="1409530">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409533">start</span>&nbsp;<span class="op" id="1409539">:=</span>&nbsp;<span class="num" id="1409542">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409545">for</span>&nbsp;<span class="ident" id="1409549">i</span>&nbsp;<span class="op" id="1409551">:=</span>&nbsp;<span class="num" id="1409554">0</span><span class="op" id="1409555">;</span>&nbsp;<span class="ident" id="1409557">i</span>&nbsp;<span class="op" id="1409559">&lt;</span>&nbsp;<span class="ident" id="1409561">n</span><span class="op" id="1409562">;</span>&nbsp;<span class="ident" id="1409564">i</span><span class="op" id="1409565">++</span>&nbsp;<span class="op" id="1409568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409572">j</span>&nbsp;<span class="op" id="1409574">:=</span>&nbsp;<span class="ident" id="1409577">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409585">if</span>&nbsp;<span class="builtinfunc" id="1409588">len</span><span class="op" id="1409591">(</span><span class="ident" id="1409592">old</span><span class="op" id="1409595">)</span>&nbsp;<span class="op" id="1409597">==</span>&nbsp;<span class="num" id="1409600">0</span>&nbsp;<span class="op" id="1409602">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409607">if</span>&nbsp;<span class="ident" id="1409610">i</span>&nbsp;<span class="op" id="1409612">&gt;</span>&nbsp;<span class="num" id="1409614">0</span>&nbsp;<span class="op" id="1409616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409622">_</span><span class="op" id="1409623">,</span>&nbsp;<span class="ident" id="1409625">wid</span>&nbsp;<span class="op" id="1409629">:=</span>&nbsp;<span class="ident" id="1409632">utf8</span><span class="op" id="1409636">.</span><span class="ident" id="1409637">DecodeRune</span><span class="op" id="1409647">(</span><span class="ident" id="1409648">s</span><span class="op" id="1409649">[</span><span class="ident" id="1409650">start</span><span class="op" id="1409655">:</span><span class="op" id="1409656">]</span><span class="op" id="1409657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409663">j</span>&nbsp;<span class="op" id="1409665">+=</span>&nbsp;<span class="ident" id="1409668">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409679">}</span>&nbsp;<span class="keyword" id="1409681">else</span>&nbsp;<span class="op" id="1409686">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409691">j</span>&nbsp;<span class="op" id="1409693">+=</span>&nbsp;<span class="ident" id="1409696">Index</span><span class="op" id="1409701">(</span><span class="ident" id="1409702">s</span><span class="op" id="1409703">[</span><span class="ident" id="1409704">start</span><span class="op" id="1409709">:</span><span class="op" id="1409710">]</span><span class="op" id="1409711">,</span>&nbsp;<span class="ident" id="1409713">old</span><span class="op" id="1409716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409724">w</span>&nbsp;<span class="op" id="1409726">+=</span>&nbsp;<span class="builtinfunc" id="1409729">copy</span><span class="op" id="1409733">(</span><span class="ident" id="1409734">t</span><span class="op" id="1409735">[</span><span class="ident" id="1409736">w</span><span class="op" id="1409737">:</span><span class="op" id="1409738">]</span><span class="op" id="1409739">,</span>&nbsp;<span class="ident" id="1409741">s</span><span class="op" id="1409742">[</span><span class="ident" id="1409743">start</span><span class="op" id="1409748">:</span><span class="ident" id="1409749">j</span><span class="op" id="1409750">]</span><span class="op" id="1409751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409755">w</span>&nbsp;<span class="op" id="1409757">+=</span>&nbsp;<span class="builtinfunc" id="1409760">copy</span><span class="op" id="1409764">(</span><span class="ident" id="1409765">t</span><span class="op" id="1409766">[</span><span class="ident" id="1409767">w</span><span class="op" id="1409768">:</span><span class="op" id="1409769">]</span><span class="op" id="1409770">,</span>&nbsp;<span class="builtinfunc" id="1409772">new</span><span class="op" id="1409775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409779">start</span>&nbsp;<span class="op" id="1409785">=</span>&nbsp;<span class="ident" id="1409787">j</span>&nbsp;<span class="op" id="1409789">+</span>&nbsp;<span class="builtinfunc" id="1409791">len</span><span class="op" id="1409794">(</span><span class="ident" id="1409795">old</span><span class="op" id="1409798">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1409801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1409804">w</span>&nbsp;<span class="op" id="1409806">+=</span>&nbsp;<span class="builtinfunc" id="1409809">copy</span><span class="op" id="1409813">(</span><span class="ident" id="1409814">t</span><span class="op" id="1409815">[</span><span class="ident" id="1409816">w</span><span class="op" id="1409817">:</span><span class="op" id="1409818">]</span><span class="op" id="1409819">,</span>&nbsp;<span class="ident" id="1409821">s</span><span class="op" id="1409822">[</span><span class="ident" id="1409823">start</span><span class="op" id="1409828">:</span><span class="op" id="1409829">]</span><span class="op" id="1409830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409833">return</span>&nbsp;<span class="ident" id="1409840">t</span><span class="op" id="1409841">[</span><span class="num" id="1409842">0</span><span class="op" id="1409843">:</span><span class="ident" id="1409844">w</span><span class="op" id="1409845">]</span><br>
<span class="lineno"></span><span class="op" id="1409847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="comment" id="1409850">//&nbsp;EqualFold&nbsp;reports&nbsp;whether&nbsp;s&nbsp;and&nbsp;t,&nbsp;interpreted&nbsp;as&nbsp;UTF-8&nbsp;strings,</span><br>
<span class="lineno"></span><span class="comment" id="1409918">//&nbsp;are&nbsp;equal&nbsp;under&nbsp;Unicode&nbsp;case-folding.</span><br>
<span class="lineno"></span><span class="keyword" id="1409959">func</span>&nbsp;<span class="ident" id="1409964">EqualFold</span><span class="op" id="1409973">(</span><span class="ident" id="1409974">s</span><span class="op" id="1409975">,</span>&nbsp;<span class="ident" id="1409977">t</span>&nbsp;<span class="op" id="1409979">[</span><span class="op" id="1409980">]</span><span class="builtintype" id="1409981">byte</span><span class="op" id="1409985">)</span>&nbsp;<span class="builtintype" id="1409987">bool</span>&nbsp;<span class="op" id="1409992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1409995">for</span>&nbsp;<span class="builtinfunc" id="1409999">len</span><span class="op" id="1410002">(</span><span class="ident" id="1410003">s</span><span class="op" id="1410004">)</span>&nbsp;<span class="op" id="1410006">!=</span>&nbsp;<span class="num" id="1410009">0</span>&nbsp;<span class="op" id="1410011">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1410014">len</span><span class="op" id="1410017">(</span><span class="ident" id="1410018">t</span><span class="op" id="1410019">)</span>&nbsp;<span class="op" id="1410021">!=</span>&nbsp;<span class="num" id="1410024">0</span>&nbsp;<span class="op" id="1410026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410030">//&nbsp;Extract&nbsp;first&nbsp;rune&nbsp;from&nbsp;each.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410065">var</span>&nbsp;<span class="ident" id="1410069">sr</span><span class="op" id="1410071">,</span>&nbsp;<span class="ident" id="1410073">tr</span>&nbsp;<span class="builtintype" id="1410076">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410083">if</span>&nbsp;<span class="ident" id="1410086">s</span><span class="op" id="1410087">[</span><span class="num" id="1410088">0</span><span class="op" id="1410089">]</span>&nbsp;<span class="op" id="1410091">&lt;</span>&nbsp;<span class="ident" id="1410093">utf8</span><span class="op" id="1410097">.</span><span class="ident" id="1410098">RuneSelf</span>&nbsp;<span class="op" id="1410107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410112">sr</span><span class="op" id="1410114">,</span>&nbsp;<span class="ident" id="1410116">s</span>&nbsp;<span class="op" id="1410118">=</span>&nbsp;<span class="builtintype" id="1410120">rune</span><span class="op" id="1410124">(</span><span class="ident" id="1410125">s</span><span class="op" id="1410126">[</span><span class="num" id="1410127">0</span><span class="op" id="1410128">]</span><span class="op" id="1410129">)</span><span class="op" id="1410130">,</span>&nbsp;<span class="ident" id="1410132">s</span><span class="op" id="1410133">[</span><span class="num" id="1410134">1</span><span class="op" id="1410135">:</span><span class="op" id="1410136">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410140">}</span>&nbsp;<span class="keyword" id="1410142">else</span>&nbsp;<span class="op" id="1410147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410152">r</span><span class="op" id="1410153">,</span>&nbsp;<span class="ident" id="1410155">size</span>&nbsp;<span class="op" id="1410160">:=</span>&nbsp;<span class="ident" id="1410163">utf8</span><span class="op" id="1410167">.</span><span class="ident" id="1410168">DecodeRune</span><span class="op" id="1410178">(</span><span class="ident" id="1410179">s</span><span class="op" id="1410180">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410185">sr</span><span class="op" id="1410187">,</span>&nbsp;<span class="ident" id="1410189">s</span>&nbsp;<span class="op" id="1410191">=</span>&nbsp;<span class="ident" id="1410193">r</span><span class="op" id="1410194">,</span>&nbsp;<span class="ident" id="1410196">s</span><span class="op" id="1410197">[</span><span class="ident" id="1410198">size</span><span class="op" id="1410202">:</span><span class="op" id="1410203">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410211">if</span>&nbsp;<span class="ident" id="1410214">t</span><span class="op" id="1410215">[</span><span class="num" id="1410216">0</span><span class="op" id="1410217">]</span>&nbsp;<span class="op" id="1410219">&lt;</span>&nbsp;<span class="ident" id="1410221">utf8</span><span class="op" id="1410225">.</span><span class="ident" id="1410226">RuneSelf</span>&nbsp;<span class="op" id="1410235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410240">tr</span><span class="op" id="1410242">,</span>&nbsp;<span class="ident" id="1410244">t</span>&nbsp;<span class="op" id="1410246">=</span>&nbsp;<span class="builtintype" id="1410248">rune</span><span class="op" id="1410252">(</span><span class="ident" id="1410253">t</span><span class="op" id="1410254">[</span><span class="num" id="1410255">0</span><span class="op" id="1410256">]</span><span class="op" id="1410257">)</span><span class="op" id="1410258">,</span>&nbsp;<span class="ident" id="1410260">t</span><span class="op" id="1410261">[</span><span class="num" id="1410262">1</span><span class="op" id="1410263">:</span><span class="op" id="1410264">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410268">}</span>&nbsp;<span class="keyword" id="1410270">else</span>&nbsp;<span class="op" id="1410275">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410280">r</span><span class="op" id="1410281">,</span>&nbsp;<span class="ident" id="1410283">size</span>&nbsp;<span class="op" id="1410288">:=</span>&nbsp;<span class="ident" id="1410291">utf8</span><span class="op" id="1410295">.</span><span class="ident" id="1410296">DecodeRune</span><span class="op" id="1410306">(</span><span class="ident" id="1410307">t</span><span class="op" id="1410308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410313">tr</span><span class="op" id="1410315">,</span>&nbsp;<span class="ident" id="1410317">t</span>&nbsp;<span class="op" id="1410319">=</span>&nbsp;<span class="ident" id="1410321">r</span><span class="op" id="1410322">,</span>&nbsp;<span class="ident" id="1410324">t</span><span class="op" id="1410325">[</span><span class="ident" id="1410326">size</span><span class="op" id="1410330">:</span><span class="op" id="1410331">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410340">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;keep&nbsp;going;&nbsp;if&nbsp;not,&nbsp;return&nbsp;false.</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410395">//&nbsp;Easy&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410411">if</span>&nbsp;<span class="ident" id="1410414">tr</span>&nbsp;<span class="op" id="1410417">==</span>&nbsp;<span class="ident" id="1410420">sr</span>&nbsp;<span class="op" id="1410423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410428">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410439">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410444">//&nbsp;Make&nbsp;sr&nbsp;&lt;&nbsp;tr&nbsp;to&nbsp;simplify&nbsp;what&nbsp;follows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410488">if</span>&nbsp;<span class="ident" id="1410491">tr</span>&nbsp;<span class="op" id="1410494">&lt;</span>&nbsp;<span class="ident" id="1410496">sr</span>&nbsp;<span class="op" id="1410499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410504">tr</span><span class="op" id="1410506">,</span>&nbsp;<span class="ident" id="1410508">sr</span>&nbsp;<span class="op" id="1410511">=</span>&nbsp;<span class="ident" id="1410513">sr</span><span class="op" id="1410515">,</span>&nbsp;<span class="ident" id="1410517">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410522">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410526">//&nbsp;Fast&nbsp;check&nbsp;for&nbsp;ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410553">if</span>&nbsp;<span class="ident" id="1410556">tr</span>&nbsp;<span class="op" id="1410559">&lt;</span>&nbsp;<span class="ident" id="1410561">utf8</span><span class="op" id="1410565">.</span><span class="ident" id="1410566">RuneSelf</span>&nbsp;<span class="op" id="1410575">&amp;&amp;</span>&nbsp;<span class="string" id="1410578">&#39;A&#39;</span>&nbsp;<span class="op" id="1410582">&lt;=</span>&nbsp;<span class="ident" id="1410585">sr</span>&nbsp;<span class="op" id="1410588">&amp;&amp;</span>&nbsp;<span class="ident" id="1410591">sr</span>&nbsp;<span class="op" id="1410594">&lt;=</span>&nbsp;<span class="string" id="1410597">&#39;Z&#39;</span>&nbsp;<span class="op" id="1410601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410606">//&nbsp;ASCII,&nbsp;and&nbsp;sr&nbsp;is&nbsp;upper&nbsp;case.&nbsp;&nbsp;tr&nbsp;must&nbsp;be&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410665">if</span>&nbsp;<span class="ident" id="1410668">tr</span>&nbsp;<span class="op" id="1410671">==</span>&nbsp;<span class="ident" id="1410674">sr</span><span class="op" id="1410676">+</span><span class="string" id="1410677">&#39;a&#39;</span><span class="op" id="1410680">-</span><span class="string" id="1410681">&#39;A&#39;</span>&nbsp;<span class="op" id="1410685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410691">continue</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410708">return</span>&nbsp;<span class="builtintype" id="1410715">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410728">//&nbsp;General&nbsp;case.&nbsp;&nbsp;SimpleFold(x)&nbsp;returns&nbsp;the&nbsp;next&nbsp;equivalent&nbsp;rune&nbsp;&gt;&nbsp;x</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410799">//&nbsp;or&nbsp;wraps&nbsp;around&nbsp;to&nbsp;smaller&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410839">r</span>&nbsp;<span class="op" id="1410841">:=</span>&nbsp;<span class="ident" id="1410844">unicode</span><span class="op" id="1410851">.</span><span class="ident" id="1410852">SimpleFold</span><span class="op" id="1410862">(</span><span class="ident" id="1410863">sr</span><span class="op" id="1410865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410869">for</span>&nbsp;<span class="ident" id="1410873">r</span>&nbsp;<span class="op" id="1410875">!=</span>&nbsp;<span class="ident" id="1410878">sr</span>&nbsp;<span class="op" id="1410881">&amp;&amp;</span>&nbsp;<span class="ident" id="1410884">r</span>&nbsp;<span class="op" id="1410886">&lt;</span>&nbsp;<span class="ident" id="1410888">tr</span>&nbsp;<span class="op" id="1410891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1410896">r</span>&nbsp;<span class="op" id="1410898">=</span>&nbsp;<span class="ident" id="1410900">unicode</span><span class="op" id="1410907">.</span><span class="ident" id="1410908">SimpleFold</span><span class="op" id="1410918">(</span><span class="ident" id="1410919">r</span><span class="op" id="1410920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410924">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410928">if</span>&nbsp;<span class="ident" id="1410931">r</span>&nbsp;<span class="op" id="1410933">==</span>&nbsp;<span class="ident" id="1410936">tr</span>&nbsp;<span class="op" id="1410939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410944">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1410959">return</span>&nbsp;<span class="builtintype" id="1410966">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1410973">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1410977">//&nbsp;One&nbsp;string&nbsp;is&nbsp;empty.&nbsp;&nbsp;Are&nbsp;both?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1411013">return</span>&nbsp;<span class="builtinfunc" id="1411020">len</span><span class="op" id="1411023">(</span><span class="ident" id="1411024">s</span><span class="op" id="1411025">)</span>&nbsp;<span class="op" id="1411027">==</span>&nbsp;<span class="builtinfunc" id="1411030">len</span><span class="op" id="1411033">(</span><span class="ident" id="1411034">t</span><span class="op" id="1411035">)</span><br>
<span class="lineno"></span><span class="op" id="1411037">}</span>
</div>
</body>
</html>
