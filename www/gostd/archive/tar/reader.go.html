<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1337323">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1337378">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1337432">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1337483">package</span>&nbsp;<span class="ident" id="1337491">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1337496">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="1337515">//&nbsp;&nbsp;&nbsp;-&nbsp;pax&nbsp;extensions</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="1337538">import</span>&nbsp;<span class="op" id="1337545">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337548">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337557">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337567">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337573">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337586">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337592">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337603">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337614">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="1337621">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1337624">var</span>&nbsp;<span class="op" id="1337628">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337631">ErrHeader</span>&nbsp;<span class="op" id="1337641">=</span>&nbsp;<span class="ident" id="1337643">errors</span><span class="op" id="1337649">.</span><span class="ident" id="1337650">New</span><span class="op" id="1337653">(</span><span class="string" id="1337654">&#34;archive/tar:&nbsp;invalid&nbsp;tar&nbsp;header&#34;</span><span class="op" id="1337687">)</span><br>
<span class="lineno"></span><span class="op" id="1337689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="1337692">const</span>&nbsp;<span class="ident" id="1337698">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="1337719">=</span>&nbsp;<span class="num" id="1337721">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1337724">//&nbsp;A&nbsp;Reader&nbsp;provides&nbsp;sequential&nbsp;access&nbsp;to&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="1337797">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="1337847">//&nbsp;The&nbsp;Next&nbsp;method&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;file&nbsp;in&nbsp;the&nbsp;archive&nbsp;(including&nbsp;the&nbsp;first),</span><br>
<span class="lineno">30</span><span class="comment" id="1337930">//&nbsp;and&nbsp;then&nbsp;it&nbsp;can&nbsp;be&nbsp;treated&nbsp;as&nbsp;an&nbsp;io.Reader&nbsp;to&nbsp;access&nbsp;the&nbsp;file&#39;s&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1338003">type</span>&nbsp;<span class="ident" id="1338008">Reader</span>&nbsp;<span class="keyword" id="1338015">struct</span>&nbsp;<span class="op" id="1338022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338025">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338033">io</span><span class="op" id="1338035">.</span><span class="ident" id="1338036">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338044">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1338052">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338059">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338067">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1338083">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;(ignored)&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338140">curr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1338148">numBytesReader</span>&nbsp;&nbsp;<span class="comment" id="1338164">//&nbsp;reader&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338198">hdrBuff</span>&nbsp;<span class="op" id="1338206">[</span><span class="ident" id="1338207">blockSize</span><span class="op" id="1338216">]</span><span class="builtintype" id="1338217">byte</span>&nbsp;<span class="comment" id="1338222">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;readHeader</span><br>
<span class="lineno"></span><span class="op" id="1338253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1338256">//&nbsp;A&nbsp;numBytesReader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;with&nbsp;a&nbsp;numBytes&nbsp;method,&nbsp;returning&nbsp;the&nbsp;number</span><br>
<span class="lineno">40</span><span class="comment" id="1338337">//&nbsp;of&nbsp;bytes&nbsp;remaining&nbsp;in&nbsp;the&nbsp;underlying&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1338391">type</span>&nbsp;<span class="ident" id="1338396">numBytesReader</span>&nbsp;<span class="keyword" id="1338411">interface</span>&nbsp;<span class="op" id="1338421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338424">io</span><span class="op" id="1338426">.</span><span class="ident" id="1338427">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338435">numBytes</span><span class="op" id="1338443">(</span><span class="op" id="1338444">)</span>&nbsp;<span class="ident" id="1338446">int64</span><br>
<span class="lineno"></span><span class="op" id="1338452">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1338455">//&nbsp;A&nbsp;regFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="1338536">type</span>&nbsp;<span class="ident" id="1338541">regFileReader</span>&nbsp;<span class="keyword" id="1338555">struct</span>&nbsp;<span class="op" id="1338562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338565">r</span>&nbsp;&nbsp;<span class="ident" id="1338568">io</span><span class="op" id="1338570">.</span><span class="ident" id="1338571">Reader</span>&nbsp;<span class="comment" id="1338578">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338600">nb</span>&nbsp;<span class="ident" id="1338603">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1338613">//&nbsp;number&nbsp;of&nbsp;unread&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">50</span><span class="op" id="1338662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1338665">//&nbsp;A&nbsp;sparseFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;sparse&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="1338756">type</span>&nbsp;<span class="ident" id="1338761">sparseFileReader</span>&nbsp;<span class="keyword" id="1338778">struct</span>&nbsp;<span class="op" id="1338785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338788">rfr</span>&nbsp;<span class="op" id="1338792">*</span><span class="ident" id="1338793">regFileReader</span>&nbsp;<span class="comment" id="1338807">//&nbsp;reads&nbsp;the&nbsp;sparse-encoded&nbsp;file&nbsp;data</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338846">sp</span>&nbsp;&nbsp;<span class="op" id="1338850">[</span><span class="op" id="1338851">]</span><span class="ident" id="1338852">sparseEntry</span>&nbsp;&nbsp;<span class="comment" id="1338865">//&nbsp;the&nbsp;sparse&nbsp;map&nbsp;for&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338897">pos</span>&nbsp;<span class="ident" id="1338901">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1338916">//&nbsp;keeps&nbsp;track&nbsp;of&nbsp;file&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338949">tot</span>&nbsp;<span class="ident" id="1338953">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1338968">//&nbsp;total&nbsp;size&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="1338994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="1338997">//&nbsp;Keywords&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;files&nbsp;in&nbsp;a&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span><span class="keyword" id="1339055">const</span>&nbsp;<span class="op" id="1339061">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339064">paxGNUSparseNumBlocks</span>&nbsp;<span class="op" id="1339086">=</span>&nbsp;<span class="string" id="1339088">&#34;GNU.sparse.numblocks&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339112">paxGNUSparseOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339134">=</span>&nbsp;<span class="string" id="1339136">&#34;GNU.sparse.offset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339157">paxGNUSparseNumBytes</span>&nbsp;&nbsp;<span class="op" id="1339179">=</span>&nbsp;<span class="string" id="1339181">&#34;GNU.sparse.numbytes&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339204">paxGNUSparseMap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339226">=</span>&nbsp;<span class="string" id="1339228">&#34;GNU.sparse.map&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339246">paxGNUSparseName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339268">=</span>&nbsp;<span class="string" id="1339270">&#34;GNU.sparse.name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339289">paxGNUSparseMajor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339311">=</span>&nbsp;<span class="string" id="1339313">&#34;GNU.sparse.major&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339333">paxGNUSparseMinor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339355">=</span>&nbsp;<span class="string" id="1339357">&#34;GNU.sparse.minor&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339377">paxGNUSparseSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339399">=</span>&nbsp;<span class="string" id="1339401">&#34;GNU.sparse.size&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339420">paxGNUSparseRealSize</span>&nbsp;&nbsp;<span class="op" id="1339442">=</span>&nbsp;<span class="string" id="1339444">&#34;GNU.sparse.realsize&#34;</span><br>
<span class="lineno"></span><span class="op" id="1339466">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1339469">//&nbsp;Keywords&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;headers</span><br>
<span class="lineno"></span><span class="keyword" id="1339508">const</span>&nbsp;<span class="op" id="1339514">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339517">oldGNUSparseMainHeaderOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339560">=</span>&nbsp;<span class="num" id="1339562">386</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339567">oldGNUSparseMainHeaderIsExtendedOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339610">=</span>&nbsp;<span class="num" id="1339612">482</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339617">oldGNUSparseMainHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339660">=</span>&nbsp;<span class="num" id="1339662">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339665">oldGNUSparseExtendedHeaderIsExtendedOffset</span>&nbsp;<span class="op" id="1339708">=</span>&nbsp;<span class="num" id="1339710">504</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339715">oldGNUSparseExtendedHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339758">=</span>&nbsp;<span class="num" id="1339760">21</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339764">oldGNUSparseOffsetSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339807">=</span>&nbsp;<span class="num" id="1339809">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339813">oldGNUSparseNumBytesSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1339856">=</span>&nbsp;<span class="num" id="1339858">12</span><br>
<span class="lineno"></span><span class="op" id="1339861">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1339864">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno">85</span><span class="keyword" id="1339914">func</span>&nbsp;<span class="ident" id="1339919">NewReader</span><span class="op" id="1339928">(</span><span class="ident" id="1339929">r</span>&nbsp;<span class="ident" id="1339931">io</span><span class="op" id="1339933">.</span><span class="ident" id="1339934">Reader</span><span class="op" id="1339940">)</span>&nbsp;<span class="op" id="1339942">*</span><span class="ident" id="1339943">Reader</span>&nbsp;<span class="op" id="1339950">{</span>&nbsp;<span class="keyword" id="1339952">return</span>&nbsp;<span class="op" id="1339959">&amp;</span><span class="ident" id="1339960">Reader</span><span class="op" id="1339966">{</span><span class="ident" id="1339967">r</span><span class="op" id="1339968">:</span>&nbsp;<span class="ident" id="1339970">r</span><span class="op" id="1339971">}</span>&nbsp;<span class="op" id="1339973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1339976">//&nbsp;Next&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="1340031">func</span>&nbsp;<span class="op" id="1340036">(</span><span class="ident" id="1340037">tr</span>&nbsp;<span class="op" id="1340040">*</span><span class="ident" id="1340041">Reader</span><span class="op" id="1340047">)</span>&nbsp;<span class="ident" id="1340049">Next</span><span class="op" id="1340053">(</span><span class="op" id="1340054">)</span>&nbsp;<span class="op" id="1340056">(</span><span class="op" id="1340057">*</span><span class="ident" id="1340058">Header</span><span class="op" id="1340064">,</span>&nbsp;<span class="builtintype" id="1340066">error</span><span class="op" id="1340071">)</span>&nbsp;<span class="op" id="1340073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340076">var</span>&nbsp;<span class="ident" id="1340080">hdr</span>&nbsp;<span class="op" id="1340084">*</span><span class="ident" id="1340085">Header</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340093">if</span>&nbsp;<span class="ident" id="1340096">tr</span><span class="op" id="1340098">.</span><span class="ident" id="1340099">err</span>&nbsp;<span class="op" id="1340103">==</span>&nbsp;<span class="ident" id="1340106">nil</span>&nbsp;<span class="op" id="1340110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340114">tr</span><span class="op" id="1340116">.</span><span class="ident" id="1340117">skipUnread</span><span class="op" id="1340127">(</span><span class="op" id="1340128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1340131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340134">if</span>&nbsp;<span class="ident" id="1340137">tr</span><span class="op" id="1340139">.</span><span class="ident" id="1340140">err</span>&nbsp;<span class="op" id="1340144">!=</span>&nbsp;<span class="ident" id="1340147">nil</span>&nbsp;<span class="op" id="1340151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340155">return</span>&nbsp;<span class="ident" id="1340162">hdr</span><span class="op" id="1340165">,</span>&nbsp;<span class="ident" id="1340167">tr</span><span class="op" id="1340169">.</span><span class="ident" id="1340170">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1340175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340178">hdr</span>&nbsp;<span class="op" id="1340182">=</span>&nbsp;<span class="ident" id="1340184">tr</span><span class="op" id="1340186">.</span><span class="ident" id="1340187">readHeader</span><span class="op" id="1340197">(</span><span class="op" id="1340198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340201">if</span>&nbsp;<span class="ident" id="1340204">hdr</span>&nbsp;<span class="op" id="1340208">==</span>&nbsp;<span class="ident" id="1340211">nil</span>&nbsp;<span class="op" id="1340215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340219">return</span>&nbsp;<span class="ident" id="1340226">hdr</span><span class="op" id="1340229">,</span>&nbsp;<span class="ident" id="1340231">tr</span><span class="op" id="1340233">.</span><span class="ident" id="1340234">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1340239">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1340242">//&nbsp;Check&nbsp;for&nbsp;PAX/GNU&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340272">switch</span>&nbsp;<span class="ident" id="1340279">hdr</span><span class="op" id="1340282">.</span><span class="ident" id="1340283">Typeflag</span>&nbsp;<span class="op" id="1340292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340295">case</span>&nbsp;<span class="ident" id="1340300">TypeXHeader</span><span class="op" id="1340311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1340315">//&nbsp;&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340341">headers</span><span class="op" id="1340348">,</span>&nbsp;<span class="ident" id="1340350">err</span>&nbsp;<span class="op" id="1340354">:=</span>&nbsp;<span class="ident" id="1340357">parsePAX</span><span class="op" id="1340365">(</span><span class="ident" id="1340366">tr</span><span class="op" id="1340368">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340372">if</span>&nbsp;<span class="ident" id="1340375">err</span>&nbsp;<span class="op" id="1340379">!=</span>&nbsp;<span class="ident" id="1340382">nil</span>&nbsp;<span class="op" id="1340386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340391">return</span>&nbsp;<span class="ident" id="1340398">nil</span><span class="op" id="1340401">,</span>&nbsp;<span class="ident" id="1340403">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1340409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1340413">//&nbsp;We&nbsp;actually&nbsp;read&nbsp;the&nbsp;whole&nbsp;file,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1340451">//&nbsp;but&nbsp;this&nbsp;skips&nbsp;alignment&nbsp;padding</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340489">tr</span><span class="op" id="1340491">.</span><span class="ident" id="1340492">skipUnread</span><span class="op" id="1340502">(</span><span class="op" id="1340503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340507">hdr</span>&nbsp;<span class="op" id="1340511">=</span>&nbsp;<span class="ident" id="1340513">tr</span><span class="op" id="1340515">.</span><span class="ident" id="1340516">readHeader</span><span class="op" id="1340526">(</span><span class="op" id="1340527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340531">mergePAX</span><span class="op" id="1340539">(</span><span class="ident" id="1340540">hdr</span><span class="op" id="1340543">,</span>&nbsp;<span class="ident" id="1340545">headers</span><span class="op" id="1340552">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1340557">//&nbsp;Check&nbsp;for&nbsp;a&nbsp;PAX&nbsp;format&nbsp;sparse&nbsp;file</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340597">sp</span><span class="op" id="1340599">,</span>&nbsp;<span class="ident" id="1340601">err</span>&nbsp;<span class="op" id="1340605">:=</span>&nbsp;<span class="ident" id="1340608">tr</span><span class="op" id="1340610">.</span><span class="ident" id="1340611">checkForGNUSparsePAXHeaders</span><span class="op" id="1340638">(</span><span class="ident" id="1340639">hdr</span><span class="op" id="1340642">,</span>&nbsp;<span class="ident" id="1340644">headers</span><span class="op" id="1340651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340655">if</span>&nbsp;<span class="ident" id="1340658">err</span>&nbsp;<span class="op" id="1340662">!=</span>&nbsp;<span class="ident" id="1340665">nil</span>&nbsp;<span class="op" id="1340669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340674">tr</span><span class="op" id="1340676">.</span><span class="ident" id="1340677">err</span>&nbsp;<span class="op" id="1340681">=</span>&nbsp;<span class="ident" id="1340683">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340690">return</span>&nbsp;<span class="ident" id="1340697">nil</span><span class="op" id="1340700">,</span>&nbsp;<span class="ident" id="1340702">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1340708">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340712">if</span>&nbsp;<span class="ident" id="1340715">sp</span>&nbsp;<span class="op" id="1340718">!=</span>&nbsp;<span class="ident" id="1340721">nil</span>&nbsp;<span class="op" id="1340725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1340730">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1340782">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader&nbsp;to&nbsp;a&nbsp;sparse&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340841">tr</span><span class="op" id="1340843">.</span><span class="ident" id="1340844">curr</span>&nbsp;<span class="op" id="1340849">=</span>&nbsp;<span class="op" id="1340851">&amp;</span><span class="ident" id="1340852">sparseFileReader</span><span class="op" id="1340868">{</span><span class="ident" id="1340869">rfr</span><span class="op" id="1340872">:</span>&nbsp;<span class="ident" id="1340874">tr</span><span class="op" id="1340876">.</span><span class="ident" id="1340877">curr</span><span class="op" id="1340881">.</span><span class="op" id="1340882">(</span><span class="op" id="1340883">*</span><span class="ident" id="1340884">regFileReader</span><span class="op" id="1340897">)</span><span class="op" id="1340898">,</span>&nbsp;<span class="ident" id="1340900">sp</span><span class="op" id="1340902">:</span>&nbsp;<span class="ident" id="1340904">sp</span><span class="op" id="1340906">,</span>&nbsp;<span class="ident" id="1340908">tot</span><span class="op" id="1340911">:</span>&nbsp;<span class="ident" id="1340913">hdr</span><span class="op" id="1340916">.</span><span class="ident" id="1340917">Size</span><span class="op" id="1340921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1340925">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340929">return</span>&nbsp;<span class="ident" id="1340936">hdr</span><span class="op" id="1340939">,</span>&nbsp;<span class="ident" id="1340941">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340946">case</span>&nbsp;<span class="ident" id="1340951">TypeGNULongName</span><span class="op" id="1340966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1340970">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;name&nbsp;header.&nbsp;Its&nbsp;contents&nbsp;are&nbsp;the&nbsp;real&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341044">realname</span><span class="op" id="1341052">,</span>&nbsp;<span class="ident" id="1341054">err</span>&nbsp;<span class="op" id="1341058">:=</span>&nbsp;<span class="ident" id="1341061">ioutil</span><span class="op" id="1341067">.</span><span class="ident" id="1341068">ReadAll</span><span class="op" id="1341075">(</span><span class="ident" id="1341076">tr</span><span class="op" id="1341078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341082">if</span>&nbsp;<span class="ident" id="1341085">err</span>&nbsp;<span class="op" id="1341089">!=</span>&nbsp;<span class="ident" id="1341092">nil</span>&nbsp;<span class="op" id="1341096">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341101">return</span>&nbsp;<span class="ident" id="1341108">nil</span><span class="op" id="1341111">,</span>&nbsp;<span class="ident" id="1341113">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1341119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341123">hdr</span><span class="op" id="1341126">,</span>&nbsp;<span class="ident" id="1341128">err</span>&nbsp;<span class="op" id="1341132">:=</span>&nbsp;<span class="ident" id="1341135">tr</span><span class="op" id="1341137">.</span><span class="ident" id="1341138">Next</span><span class="op" id="1341142">(</span><span class="op" id="1341143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341147">hdr</span><span class="op" id="1341150">.</span><span class="ident" id="1341151">Name</span>&nbsp;<span class="op" id="1341156">=</span>&nbsp;<span class="ident" id="1341158">cString</span><span class="op" id="1341165">(</span><span class="ident" id="1341166">realname</span><span class="op" id="1341174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341178">return</span>&nbsp;<span class="ident" id="1341185">hdr</span><span class="op" id="1341188">,</span>&nbsp;<span class="ident" id="1341190">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341195">case</span>&nbsp;<span class="ident" id="1341200">TypeGNULongLink</span><span class="op" id="1341215">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1341219">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;link&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341256">realname</span><span class="op" id="1341264">,</span>&nbsp;<span class="ident" id="1341266">err</span>&nbsp;<span class="op" id="1341270">:=</span>&nbsp;<span class="ident" id="1341273">ioutil</span><span class="op" id="1341279">.</span><span class="ident" id="1341280">ReadAll</span><span class="op" id="1341287">(</span><span class="ident" id="1341288">tr</span><span class="op" id="1341290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341294">if</span>&nbsp;<span class="ident" id="1341297">err</span>&nbsp;<span class="op" id="1341301">!=</span>&nbsp;<span class="ident" id="1341304">nil</span>&nbsp;<span class="op" id="1341308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341313">return</span>&nbsp;<span class="ident" id="1341320">nil</span><span class="op" id="1341323">,</span>&nbsp;<span class="ident" id="1341325">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1341331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341335">hdr</span><span class="op" id="1341338">,</span>&nbsp;<span class="ident" id="1341340">err</span>&nbsp;<span class="op" id="1341344">:=</span>&nbsp;<span class="ident" id="1341347">tr</span><span class="op" id="1341349">.</span><span class="ident" id="1341350">Next</span><span class="op" id="1341354">(</span><span class="op" id="1341355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341359">hdr</span><span class="op" id="1341362">.</span><span class="ident" id="1341363">Linkname</span>&nbsp;<span class="op" id="1341372">=</span>&nbsp;<span class="ident" id="1341374">cString</span><span class="op" id="1341381">(</span><span class="ident" id="1341382">realname</span><span class="op" id="1341390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341394">return</span>&nbsp;<span class="ident" id="1341401">hdr</span><span class="op" id="1341404">,</span>&nbsp;<span class="ident" id="1341406">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1341411">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341414">return</span>&nbsp;<span class="ident" id="1341421">hdr</span><span class="op" id="1341424">,</span>&nbsp;<span class="ident" id="1341426">tr</span><span class="op" id="1341428">.</span><span class="ident" id="1341429">err</span><br>
<span class="lineno"></span><span class="op" id="1341433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1341436">//&nbsp;checkForGNUSparsePAXHeaders&nbsp;checks&nbsp;the&nbsp;PAX&nbsp;headers&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;headers.&nbsp;If&nbsp;they&nbsp;are&nbsp;found,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="1341538">//&nbsp;this&nbsp;function&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;and&nbsp;returns&nbsp;it.&nbsp;Unknown&nbsp;sparse&nbsp;formats&nbsp;are&nbsp;ignored,&nbsp;causing&nbsp;the&nbsp;file&nbsp;to</span><br>
<span class="lineno">150</span><span class="comment" id="1341648">//&nbsp;be&nbsp;treated&nbsp;as&nbsp;a&nbsp;regular&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="1341681">func</span>&nbsp;<span class="op" id="1341686">(</span><span class="ident" id="1341687">tr</span>&nbsp;<span class="op" id="1341690">*</span><span class="ident" id="1341691">Reader</span><span class="op" id="1341697">)</span>&nbsp;<span class="ident" id="1341699">checkForGNUSparsePAXHeaders</span><span class="op" id="1341726">(</span><span class="ident" id="1341727">hdr</span>&nbsp;<span class="op" id="1341731">*</span><span class="ident" id="1341732">Header</span><span class="op" id="1341738">,</span>&nbsp;<span class="ident" id="1341740">headers</span>&nbsp;<span class="keyword" id="1341748">map</span><span class="op" id="1341751">[</span><span class="builtintype" id="1341752">string</span><span class="op" id="1341758">]</span><span class="builtintype" id="1341759">string</span><span class="op" id="1341765">)</span>&nbsp;<span class="op" id="1341767">(</span><span class="op" id="1341768">[</span><span class="op" id="1341769">]</span><span class="ident" id="1341770">sparseEntry</span><span class="op" id="1341781">,</span>&nbsp;<span class="builtintype" id="1341783">error</span><span class="op" id="1341788">)</span>&nbsp;<span class="op" id="1341790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341793">var</span>&nbsp;<span class="ident" id="1341797">sparseFormat</span>&nbsp;<span class="builtintype" id="1341810">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1341819">//&nbsp;Check&nbsp;for&nbsp;sparse&nbsp;format&nbsp;indicators</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341858">major</span><span class="op" id="1341863">,</span>&nbsp;<span class="ident" id="1341865">majorOk</span>&nbsp;<span class="op" id="1341873">:=</span>&nbsp;<span class="ident" id="1341876">headers</span><span class="op" id="1341883">[</span><span class="ident" id="1341884">paxGNUSparseMajor</span><span class="op" id="1341901">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341904">minor</span><span class="op" id="1341909">,</span>&nbsp;<span class="ident" id="1341911">minorOk</span>&nbsp;<span class="op" id="1341919">:=</span>&nbsp;<span class="ident" id="1341922">headers</span><span class="op" id="1341929">[</span><span class="ident" id="1341930">paxGNUSparseMinor</span><span class="op" id="1341947">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341950">sparseName</span><span class="op" id="1341960">,</span>&nbsp;<span class="ident" id="1341962">sparseNameOk</span>&nbsp;<span class="op" id="1341975">:=</span>&nbsp;<span class="ident" id="1341978">headers</span><span class="op" id="1341985">[</span><span class="ident" id="1341986">paxGNUSparseName</span><span class="op" id="1342002">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342005">_</span><span class="op" id="1342006">,</span>&nbsp;<span class="ident" id="1342008">sparseMapOk</span>&nbsp;<span class="op" id="1342020">:=</span>&nbsp;<span class="ident" id="1342023">headers</span><span class="op" id="1342030">[</span><span class="ident" id="1342031">paxGNUSparseMap</span><span class="op" id="1342046">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342049">sparseSize</span><span class="op" id="1342059">,</span>&nbsp;<span class="ident" id="1342061">sparseSizeOk</span>&nbsp;<span class="op" id="1342074">:=</span>&nbsp;<span class="ident" id="1342077">headers</span><span class="op" id="1342084">[</span><span class="ident" id="1342085">paxGNUSparseSize</span><span class="op" id="1342101">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342104">sparseRealSize</span><span class="op" id="1342118">,</span>&nbsp;<span class="ident" id="1342120">sparseRealSizeOk</span>&nbsp;<span class="op" id="1342137">:=</span>&nbsp;<span class="ident" id="1342140">headers</span><span class="op" id="1342147">[</span><span class="ident" id="1342148">paxGNUSparseRealSize</span><span class="op" id="1342168">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1342172">//&nbsp;Identify&nbsp;which,&nbsp;if&nbsp;any,&nbsp;sparse&nbsp;format&nbsp;applies&nbsp;from&nbsp;which&nbsp;PAX&nbsp;headers&nbsp;are&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342253">if</span>&nbsp;<span class="ident" id="1342256">majorOk</span>&nbsp;<span class="op" id="1342264">&amp;&amp;</span>&nbsp;<span class="ident" id="1342267">minorOk</span>&nbsp;<span class="op" id="1342275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342279">sparseFormat</span>&nbsp;<span class="op" id="1342292">=</span>&nbsp;<span class="ident" id="1342294">major</span>&nbsp;<span class="op" id="1342300">+</span>&nbsp;<span class="string" id="1342302">&#34;.&#34;</span>&nbsp;<span class="op" id="1342306">+</span>&nbsp;<span class="ident" id="1342308">minor</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1342315">}</span>&nbsp;<span class="keyword" id="1342317">else</span>&nbsp;<span class="keyword" id="1342322">if</span>&nbsp;<span class="ident" id="1342325">sparseNameOk</span>&nbsp;<span class="op" id="1342338">&amp;&amp;</span>&nbsp;<span class="ident" id="1342341">sparseMapOk</span>&nbsp;<span class="op" id="1342353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342357">sparseFormat</span>&nbsp;<span class="op" id="1342370">=</span>&nbsp;<span class="string" id="1342372">&#34;0.1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1342379">}</span>&nbsp;<span class="keyword" id="1342381">else</span>&nbsp;<span class="keyword" id="1342386">if</span>&nbsp;<span class="ident" id="1342389">sparseSizeOk</span>&nbsp;<span class="op" id="1342402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342406">sparseFormat</span>&nbsp;<span class="op" id="1342419">=</span>&nbsp;<span class="string" id="1342421">&#34;0.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1342428">}</span>&nbsp;<span class="keyword" id="1342430">else</span>&nbsp;<span class="op" id="1342435">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1342439">//&nbsp;Not&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342478">return</span>&nbsp;<span class="ident" id="1342485">nil</span><span class="op" id="1342488">,</span>&nbsp;<span class="ident" id="1342490">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1342495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1342499">//&nbsp;Check&nbsp;for&nbsp;unknown&nbsp;sparse&nbsp;format</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342535">if</span>&nbsp;<span class="ident" id="1342538">sparseFormat</span>&nbsp;<span class="op" id="1342551">!=</span>&nbsp;<span class="string" id="1342554">&#34;0.0&#34;</span>&nbsp;<span class="op" id="1342560">&amp;&amp;</span>&nbsp;<span class="ident" id="1342563">sparseFormat</span>&nbsp;<span class="op" id="1342576">!=</span>&nbsp;<span class="string" id="1342579">&#34;0.1&#34;</span>&nbsp;<span class="op" id="1342585">&amp;&amp;</span>&nbsp;<span class="ident" id="1342588">sparseFormat</span>&nbsp;<span class="op" id="1342601">!=</span>&nbsp;<span class="string" id="1342604">&#34;1.0&#34;</span>&nbsp;<span class="op" id="1342610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342614">return</span>&nbsp;<span class="ident" id="1342621">nil</span><span class="op" id="1342624">,</span>&nbsp;<span class="ident" id="1342626">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1342631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1342635">//&nbsp;Update&nbsp;hdr&nbsp;from&nbsp;GNU&nbsp;sparse&nbsp;PAX&nbsp;headers</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342678">if</span>&nbsp;<span class="ident" id="1342681">sparseNameOk</span>&nbsp;<span class="op" id="1342694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342698">hdr</span><span class="op" id="1342701">.</span><span class="ident" id="1342702">Name</span>&nbsp;<span class="op" id="1342707">=</span>&nbsp;<span class="ident" id="1342709">sparseName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1342721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342724">if</span>&nbsp;<span class="ident" id="1342727">sparseSizeOk</span>&nbsp;<span class="op" id="1342740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342744">realSize</span><span class="op" id="1342752">,</span>&nbsp;<span class="ident" id="1342754">err</span>&nbsp;<span class="op" id="1342758">:=</span>&nbsp;<span class="ident" id="1342761">strconv</span><span class="op" id="1342768">.</span><span class="ident" id="1342769">ParseInt</span><span class="op" id="1342777">(</span><span class="ident" id="1342778">sparseSize</span><span class="op" id="1342788">,</span>&nbsp;<span class="num" id="1342790">10</span><span class="op" id="1342792">,</span>&nbsp;<span class="num" id="1342794">0</span><span class="op" id="1342795">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342799">if</span>&nbsp;<span class="ident" id="1342802">err</span>&nbsp;<span class="op" id="1342806">!=</span>&nbsp;<span class="ident" id="1342809">nil</span>&nbsp;<span class="op" id="1342813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342818">return</span>&nbsp;<span class="ident" id="1342825">nil</span><span class="op" id="1342828">,</span>&nbsp;<span class="ident" id="1342830">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1342842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342846">hdr</span><span class="op" id="1342849">.</span><span class="ident" id="1342850">Size</span>&nbsp;<span class="op" id="1342855">=</span>&nbsp;<span class="ident" id="1342857">realSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1342867">}</span>&nbsp;<span class="keyword" id="1342869">else</span>&nbsp;<span class="keyword" id="1342874">if</span>&nbsp;<span class="ident" id="1342877">sparseRealSizeOk</span>&nbsp;<span class="op" id="1342894">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342898">realSize</span><span class="op" id="1342906">,</span>&nbsp;<span class="ident" id="1342908">err</span>&nbsp;<span class="op" id="1342912">:=</span>&nbsp;<span class="ident" id="1342915">strconv</span><span class="op" id="1342922">.</span><span class="ident" id="1342923">ParseInt</span><span class="op" id="1342931">(</span><span class="ident" id="1342932">sparseRealSize</span><span class="op" id="1342946">,</span>&nbsp;<span class="num" id="1342948">10</span><span class="op" id="1342950">,</span>&nbsp;<span class="num" id="1342952">0</span><span class="op" id="1342953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342957">if</span>&nbsp;<span class="ident" id="1342960">err</span>&nbsp;<span class="op" id="1342964">!=</span>&nbsp;<span class="ident" id="1342967">nil</span>&nbsp;<span class="op" id="1342971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342976">return</span>&nbsp;<span class="ident" id="1342983">nil</span><span class="op" id="1342986">,</span>&nbsp;<span class="ident" id="1342988">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1343000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343004">hdr</span><span class="op" id="1343007">.</span><span class="ident" id="1343008">Size</span>&nbsp;<span class="op" id="1343013">=</span>&nbsp;<span class="ident" id="1343015">realSize</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1343025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1343029">//&nbsp;Set&nbsp;up&nbsp;the&nbsp;sparse&nbsp;map,&nbsp;according&nbsp;to&nbsp;the&nbsp;particular&nbsp;sparse&nbsp;format&nbsp;in&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343105">var</span>&nbsp;<span class="ident" id="1343109">sp</span>&nbsp;<span class="op" id="1343112">[</span><span class="op" id="1343113">]</span><span class="ident" id="1343114">sparseEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343127">var</span>&nbsp;<span class="ident" id="1343131">err</span>&nbsp;<span class="builtintype" id="1343135">error</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343142">switch</span>&nbsp;<span class="ident" id="1343149">sparseFormat</span>&nbsp;<span class="op" id="1343162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343165">case</span>&nbsp;<span class="string" id="1343170">&#34;0.0&#34;</span><span class="op" id="1343175">,</span>&nbsp;<span class="string" id="1343177">&#34;0.1&#34;</span><span class="op" id="1343182">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343186">sp</span><span class="op" id="1343188">,</span>&nbsp;<span class="ident" id="1343190">err</span>&nbsp;<span class="op" id="1343194">=</span>&nbsp;<span class="ident" id="1343196">readGNUSparseMap0x1</span><span class="op" id="1343215">(</span><span class="ident" id="1343216">headers</span><span class="op" id="1343223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343226">case</span>&nbsp;<span class="string" id="1343231">&#34;1.0&#34;</span><span class="op" id="1343236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343240">sp</span><span class="op" id="1343242">,</span>&nbsp;<span class="ident" id="1343244">err</span>&nbsp;<span class="op" id="1343248">=</span>&nbsp;<span class="ident" id="1343250">readGNUSparseMap1x0</span><span class="op" id="1343269">(</span><span class="ident" id="1343270">tr</span><span class="op" id="1343272">.</span><span class="ident" id="1343273">curr</span><span class="op" id="1343277">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1343280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343283">return</span>&nbsp;<span class="ident" id="1343290">sp</span><span class="op" id="1343292">,</span>&nbsp;<span class="ident" id="1343294">err</span><br>
<span class="lineno"></span><span class="op" id="1343298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1343301">//&nbsp;mergePAX&nbsp;merges&nbsp;well&nbsp;known&nbsp;headers&nbsp;according&nbsp;to&nbsp;PAX&nbsp;standard.</span><br>
<span class="lineno">210</span><span class="comment" id="1343366">//&nbsp;In&nbsp;general&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;as&nbsp;those&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="1343422">//&nbsp;in&nbsp;the&nbsp;header&nbsp;struct&nbsp;overwrite&nbsp;those&nbsp;found&nbsp;in&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="1343482">//&nbsp;struct&nbsp;with&nbsp;higher&nbsp;precision&nbsp;or&nbsp;longer&nbsp;values.&nbsp;Esp.&nbsp;useful</span><br>
<span class="lineno"></span><span class="comment" id="1343544">//&nbsp;for&nbsp;name&nbsp;and&nbsp;linkname&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="1343577">func</span>&nbsp;<span class="ident" id="1343582">mergePAX</span><span class="op" id="1343590">(</span><span class="ident" id="1343591">hdr</span>&nbsp;<span class="op" id="1343595">*</span><span class="ident" id="1343596">Header</span><span class="op" id="1343602">,</span>&nbsp;<span class="ident" id="1343604">headers</span>&nbsp;<span class="keyword" id="1343612">map</span><span class="op" id="1343615">[</span><span class="builtintype" id="1343616">string</span><span class="op" id="1343622">]</span><span class="builtintype" id="1343623">string</span><span class="op" id="1343629">)</span>&nbsp;<span class="builtintype" id="1343631">error</span>&nbsp;<span class="op" id="1343637">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343640">for</span>&nbsp;<span class="ident" id="1343644">k</span><span class="op" id="1343645">,</span>&nbsp;<span class="ident" id="1343647">v</span>&nbsp;<span class="op" id="1343649">:=</span>&nbsp;<span class="keyword" id="1343652">range</span>&nbsp;<span class="ident" id="1343658">headers</span>&nbsp;<span class="op" id="1343666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343670">switch</span>&nbsp;<span class="ident" id="1343677">k</span>&nbsp;<span class="op" id="1343679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343683">case</span>&nbsp;<span class="ident" id="1343688">paxPath</span><span class="op" id="1343695">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343700">hdr</span><span class="op" id="1343703">.</span><span class="ident" id="1343704">Name</span>&nbsp;<span class="op" id="1343709">=</span>&nbsp;<span class="ident" id="1343711">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343715">case</span>&nbsp;<span class="ident" id="1343720">paxLinkpath</span><span class="op" id="1343731">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343736">hdr</span><span class="op" id="1343739">.</span><span class="ident" id="1343740">Linkname</span>&nbsp;<span class="op" id="1343749">=</span>&nbsp;<span class="ident" id="1343751">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343755">case</span>&nbsp;<span class="ident" id="1343760">paxGname</span><span class="op" id="1343768">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343773">hdr</span><span class="op" id="1343776">.</span><span class="ident" id="1343777">Gname</span>&nbsp;<span class="op" id="1343783">=</span>&nbsp;<span class="ident" id="1343785">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343789">case</span>&nbsp;<span class="ident" id="1343794">paxUname</span><span class="op" id="1343802">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343807">hdr</span><span class="op" id="1343810">.</span><span class="ident" id="1343811">Uname</span>&nbsp;<span class="op" id="1343817">=</span>&nbsp;<span class="ident" id="1343819">v</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343823">case</span>&nbsp;<span class="ident" id="1343828">paxUid</span><span class="op" id="1343834">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343839">uid</span><span class="op" id="1343842">,</span>&nbsp;<span class="ident" id="1343844">err</span>&nbsp;<span class="op" id="1343848">:=</span>&nbsp;<span class="ident" id="1343851">strconv</span><span class="op" id="1343858">.</span><span class="ident" id="1343859">ParseInt</span><span class="op" id="1343867">(</span><span class="ident" id="1343868">v</span><span class="op" id="1343869">,</span>&nbsp;<span class="num" id="1343871">10</span><span class="op" id="1343873">,</span>&nbsp;<span class="num" id="1343875">0</span><span class="op" id="1343876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343881">if</span>&nbsp;<span class="ident" id="1343884">err</span>&nbsp;<span class="op" id="1343888">!=</span>&nbsp;<span class="ident" id="1343891">nil</span>&nbsp;<span class="op" id="1343895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343901">return</span>&nbsp;<span class="ident" id="1343908">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1343915">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343920">hdr</span><span class="op" id="1343923">.</span><span class="ident" id="1343924">Uid</span>&nbsp;<span class="op" id="1343928">=</span>&nbsp;<span class="builtintype" id="1343930">int</span><span class="op" id="1343933">(</span><span class="ident" id="1343934">uid</span><span class="op" id="1343937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343941">case</span>&nbsp;<span class="ident" id="1343946">paxGid</span><span class="op" id="1343952">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343957">gid</span><span class="op" id="1343960">,</span>&nbsp;<span class="ident" id="1343962">err</span>&nbsp;<span class="op" id="1343966">:=</span>&nbsp;<span class="ident" id="1343969">strconv</span><span class="op" id="1343976">.</span><span class="ident" id="1343977">ParseInt</span><span class="op" id="1343985">(</span><span class="ident" id="1343986">v</span><span class="op" id="1343987">,</span>&nbsp;<span class="num" id="1343989">10</span><span class="op" id="1343991">,</span>&nbsp;<span class="num" id="1343993">0</span><span class="op" id="1343994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343999">if</span>&nbsp;<span class="ident" id="1344002">err</span>&nbsp;<span class="op" id="1344006">!=</span>&nbsp;<span class="ident" id="1344009">nil</span>&nbsp;<span class="op" id="1344013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344019">return</span>&nbsp;<span class="ident" id="1344026">err</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344038">hdr</span><span class="op" id="1344041">.</span><span class="ident" id="1344042">Gid</span>&nbsp;<span class="op" id="1344046">=</span>&nbsp;<span class="builtintype" id="1344048">int</span><span class="op" id="1344051">(</span><span class="ident" id="1344052">gid</span><span class="op" id="1344055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344059">case</span>&nbsp;<span class="ident" id="1344064">paxAtime</span><span class="op" id="1344072">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344077">t</span><span class="op" id="1344078">,</span>&nbsp;<span class="ident" id="1344080">err</span>&nbsp;<span class="op" id="1344084">:=</span>&nbsp;<span class="ident" id="1344087">parsePAXTime</span><span class="op" id="1344099">(</span><span class="ident" id="1344100">v</span><span class="op" id="1344101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344106">if</span>&nbsp;<span class="ident" id="1344109">err</span>&nbsp;<span class="op" id="1344113">!=</span>&nbsp;<span class="ident" id="1344116">nil</span>&nbsp;<span class="op" id="1344120">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344126">return</span>&nbsp;<span class="ident" id="1344133">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344145">hdr</span><span class="op" id="1344148">.</span><span class="ident" id="1344149">AccessTime</span>&nbsp;<span class="op" id="1344160">=</span>&nbsp;<span class="ident" id="1344162">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344166">case</span>&nbsp;<span class="ident" id="1344171">paxMtime</span><span class="op" id="1344179">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344184">t</span><span class="op" id="1344185">,</span>&nbsp;<span class="ident" id="1344187">err</span>&nbsp;<span class="op" id="1344191">:=</span>&nbsp;<span class="ident" id="1344194">parsePAXTime</span><span class="op" id="1344206">(</span><span class="ident" id="1344207">v</span><span class="op" id="1344208">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344213">if</span>&nbsp;<span class="ident" id="1344216">err</span>&nbsp;<span class="op" id="1344220">!=</span>&nbsp;<span class="ident" id="1344223">nil</span>&nbsp;<span class="op" id="1344227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344233">return</span>&nbsp;<span class="ident" id="1344240">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344252">hdr</span><span class="op" id="1344255">.</span><span class="ident" id="1344256">ModTime</span>&nbsp;<span class="op" id="1344264">=</span>&nbsp;<span class="ident" id="1344266">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344270">case</span>&nbsp;<span class="ident" id="1344275">paxCtime</span><span class="op" id="1344283">:</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344288">t</span><span class="op" id="1344289">,</span>&nbsp;<span class="ident" id="1344291">err</span>&nbsp;<span class="op" id="1344295">:=</span>&nbsp;<span class="ident" id="1344298">parsePAXTime</span><span class="op" id="1344310">(</span><span class="ident" id="1344311">v</span><span class="op" id="1344312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344317">if</span>&nbsp;<span class="ident" id="1344320">err</span>&nbsp;<span class="op" id="1344324">!=</span>&nbsp;<span class="ident" id="1344327">nil</span>&nbsp;<span class="op" id="1344331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344337">return</span>&nbsp;<span class="ident" id="1344344">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344356">hdr</span><span class="op" id="1344359">.</span><span class="ident" id="1344360">ChangeTime</span>&nbsp;<span class="op" id="1344371">=</span>&nbsp;<span class="ident" id="1344373">t</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344377">case</span>&nbsp;<span class="ident" id="1344382">paxSize</span><span class="op" id="1344389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344394">size</span><span class="op" id="1344398">,</span>&nbsp;<span class="ident" id="1344400">err</span>&nbsp;<span class="op" id="1344404">:=</span>&nbsp;<span class="ident" id="1344407">strconv</span><span class="op" id="1344414">.</span><span class="ident" id="1344415">ParseInt</span><span class="op" id="1344423">(</span><span class="ident" id="1344424">v</span><span class="op" id="1344425">,</span>&nbsp;<span class="num" id="1344427">10</span><span class="op" id="1344429">,</span>&nbsp;<span class="num" id="1344431">0</span><span class="op" id="1344432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344437">if</span>&nbsp;<span class="ident" id="1344440">err</span>&nbsp;<span class="op" id="1344444">!=</span>&nbsp;<span class="ident" id="1344447">nil</span>&nbsp;<span class="op" id="1344451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344457">return</span>&nbsp;<span class="ident" id="1344464">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344471">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344476">hdr</span><span class="op" id="1344479">.</span><span class="ident" id="1344480">Size</span>&nbsp;<span class="op" id="1344485">=</span>&nbsp;<span class="ident" id="1344487">int64</span><span class="op" id="1344492">(</span><span class="ident" id="1344493">size</span><span class="op" id="1344497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344501">default</span><span class="op" id="1344508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344513">if</span>&nbsp;<span class="ident" id="1344516">strings</span><span class="op" id="1344523">.</span><span class="ident" id="1344524">HasPrefix</span><span class="op" id="1344533">(</span><span class="ident" id="1344534">k</span><span class="op" id="1344535">,</span>&nbsp;<span class="ident" id="1344537">paxXattr</span><span class="op" id="1344545">)</span>&nbsp;<span class="op" id="1344547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344553">if</span>&nbsp;<span class="ident" id="1344556">hdr</span><span class="op" id="1344559">.</span><span class="ident" id="1344560">Xattrs</span>&nbsp;<span class="op" id="1344567">==</span>&nbsp;<span class="ident" id="1344570">nil</span>&nbsp;<span class="op" id="1344574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344581">hdr</span><span class="op" id="1344584">.</span><span class="ident" id="1344585">Xattrs</span>&nbsp;<span class="op" id="1344592">=</span>&nbsp;<span class="builtinfunc" id="1344594">make</span><span class="op" id="1344598">(</span><span class="keyword" id="1344599">map</span><span class="op" id="1344602">[</span><span class="builtintype" id="1344603">string</span><span class="op" id="1344609">]</span><span class="builtintype" id="1344610">string</span><span class="op" id="1344616">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344628">hdr</span><span class="op" id="1344631">.</span><span class="ident" id="1344632">Xattrs</span><span class="op" id="1344638">[</span><span class="ident" id="1344639">k</span><span class="op" id="1344640">[</span><span class="builtinfunc" id="1344641">len</span><span class="op" id="1344644">(</span><span class="ident" id="1344645">paxXattr</span><span class="op" id="1344653">)</span><span class="op" id="1344654">:</span><span class="op" id="1344655">]</span><span class="op" id="1344656">]</span>&nbsp;<span class="op" id="1344658">=</span>&nbsp;<span class="ident" id="1344660">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344672">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344675">return</span>&nbsp;<span class="ident" id="1344682">nil</span><br>
<span class="lineno"></span><span class="op" id="1344686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1344689">//&nbsp;parsePAXTime&nbsp;takes&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;%d.%d&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1344754">//&nbsp;the&nbsp;PAX&nbsp;specification.</span><br>
<span class="lineno">275</span><span class="keyword" id="1344780">func</span>&nbsp;<span class="ident" id="1344785">parsePAXTime</span><span class="op" id="1344797">(</span><span class="ident" id="1344798">t</span>&nbsp;<span class="builtintype" id="1344800">string</span><span class="op" id="1344806">)</span>&nbsp;<span class="op" id="1344808">(</span><span class="ident" id="1344809">time</span><span class="op" id="1344813">.</span><span class="ident" id="1344814">Time</span><span class="op" id="1344818">,</span>&nbsp;<span class="builtintype" id="1344820">error</span><span class="op" id="1344825">)</span>&nbsp;<span class="op" id="1344827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344830">buf</span>&nbsp;<span class="op" id="1344834">:=</span>&nbsp;<span class="op" id="1344837">[</span><span class="op" id="1344838">]</span><span class="builtintype" id="1344839">byte</span><span class="op" id="1344843">(</span><span class="ident" id="1344844">t</span><span class="op" id="1344845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344848">pos</span>&nbsp;<span class="op" id="1344852">:=</span>&nbsp;<span class="ident" id="1344855">bytes</span><span class="op" id="1344860">.</span><span class="ident" id="1344861">IndexByte</span><span class="op" id="1344870">(</span><span class="ident" id="1344871">buf</span><span class="op" id="1344874">,</span>&nbsp;<span class="string" id="1344876">&#39;.&#39;</span><span class="op" id="1344879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344882">var</span>&nbsp;<span class="ident" id="1344886">seconds</span><span class="op" id="1344893">,</span>&nbsp;<span class="ident" id="1344895">nanoseconds</span>&nbsp;<span class="ident" id="1344907">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344914">var</span>&nbsp;<span class="ident" id="1344918">err</span>&nbsp;<span class="builtintype" id="1344922">error</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344929">if</span>&nbsp;<span class="ident" id="1344932">pos</span>&nbsp;<span class="op" id="1344936">==</span>&nbsp;<span class="op" id="1344939">-</span><span class="num" id="1344940">1</span>&nbsp;<span class="op" id="1344942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344946">seconds</span><span class="op" id="1344953">,</span>&nbsp;<span class="ident" id="1344955">err</span>&nbsp;<span class="op" id="1344959">=</span>&nbsp;<span class="ident" id="1344961">strconv</span><span class="op" id="1344968">.</span><span class="ident" id="1344969">ParseInt</span><span class="op" id="1344977">(</span><span class="ident" id="1344978">t</span><span class="op" id="1344979">,</span>&nbsp;<span class="num" id="1344981">10</span><span class="op" id="1344983">,</span>&nbsp;<span class="num" id="1344985">0</span><span class="op" id="1344986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344990">if</span>&nbsp;<span class="ident" id="1344993">err</span>&nbsp;<span class="op" id="1344997">!=</span>&nbsp;<span class="ident" id="1345000">nil</span>&nbsp;<span class="op" id="1345004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345009">return</span>&nbsp;<span class="ident" id="1345016">time</span><span class="op" id="1345020">.</span><span class="ident" id="1345021">Time</span><span class="op" id="1345025">{</span><span class="op" id="1345026">}</span><span class="op" id="1345027">,</span>&nbsp;<span class="ident" id="1345029">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345035">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345038">}</span>&nbsp;<span class="keyword" id="1345040">else</span>&nbsp;<span class="op" id="1345045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345049">seconds</span><span class="op" id="1345056">,</span>&nbsp;<span class="ident" id="1345058">err</span>&nbsp;<span class="op" id="1345062">=</span>&nbsp;<span class="ident" id="1345064">strconv</span><span class="op" id="1345071">.</span><span class="ident" id="1345072">ParseInt</span><span class="op" id="1345080">(</span><span class="builtintype" id="1345081">string</span><span class="op" id="1345087">(</span><span class="ident" id="1345088">buf</span><span class="op" id="1345091">[</span><span class="op" id="1345092">:</span><span class="ident" id="1345093">pos</span><span class="op" id="1345096">]</span><span class="op" id="1345097">)</span><span class="op" id="1345098">,</span>&nbsp;<span class="num" id="1345100">10</span><span class="op" id="1345102">,</span>&nbsp;<span class="num" id="1345104">0</span><span class="op" id="1345105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345109">if</span>&nbsp;<span class="ident" id="1345112">err</span>&nbsp;<span class="op" id="1345116">!=</span>&nbsp;<span class="ident" id="1345119">nil</span>&nbsp;<span class="op" id="1345123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345128">return</span>&nbsp;<span class="ident" id="1345135">time</span><span class="op" id="1345139">.</span><span class="ident" id="1345140">Time</span><span class="op" id="1345144">{</span><span class="op" id="1345145">}</span><span class="op" id="1345146">,</span>&nbsp;<span class="ident" id="1345148">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345154">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345158">nano_buf</span>&nbsp;<span class="op" id="1345167">:=</span>&nbsp;<span class="builtintype" id="1345170">string</span><span class="op" id="1345176">(</span><span class="ident" id="1345177">buf</span><span class="op" id="1345180">[</span><span class="ident" id="1345181">pos</span><span class="op" id="1345184">+</span><span class="num" id="1345185">1</span><span class="op" id="1345186">:</span><span class="op" id="1345187">]</span><span class="op" id="1345188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1345192">//&nbsp;Pad&nbsp;as&nbsp;needed&nbsp;before&nbsp;converting&nbsp;to&nbsp;a&nbsp;decimal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1345243">//&nbsp;For&nbsp;example&nbsp;.030&nbsp;-&gt;&nbsp;.030000000&nbsp;-&gt;&nbsp;30000000&nbsp;nanoseconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345303">if</span>&nbsp;<span class="builtinfunc" id="1345306">len</span><span class="op" id="1345309">(</span><span class="ident" id="1345310">nano_buf</span><span class="op" id="1345318">)</span>&nbsp;<span class="op" id="1345320">&lt;</span>&nbsp;<span class="ident" id="1345322">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="1345343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1345348">//&nbsp;Right&nbsp;pad</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345364">nano_buf</span>&nbsp;<span class="op" id="1345373">+=</span>&nbsp;<span class="ident" id="1345376">strings</span><span class="op" id="1345383">.</span><span class="ident" id="1345384">Repeat</span><span class="op" id="1345390">(</span><span class="string" id="1345391">&#34;0&#34;</span><span class="op" id="1345394">,</span>&nbsp;<span class="ident" id="1345396">maxNanoSecondIntSize</span><span class="op" id="1345416">-</span><span class="builtinfunc" id="1345417">len</span><span class="op" id="1345420">(</span><span class="ident" id="1345421">nano_buf</span><span class="op" id="1345429">)</span><span class="op" id="1345430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345434">}</span>&nbsp;<span class="keyword" id="1345436">else</span>&nbsp;<span class="keyword" id="1345441">if</span>&nbsp;<span class="builtinfunc" id="1345444">len</span><span class="op" id="1345447">(</span><span class="ident" id="1345448">nano_buf</span><span class="op" id="1345456">)</span>&nbsp;<span class="op" id="1345458">&gt;</span>&nbsp;<span class="ident" id="1345460">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="1345481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1345486">//&nbsp;Right&nbsp;truncate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345507">nano_buf</span>&nbsp;<span class="op" id="1345516">=</span>&nbsp;<span class="ident" id="1345518">nano_buf</span><span class="op" id="1345526">[</span><span class="op" id="1345527">:</span><span class="ident" id="1345528">maxNanoSecondIntSize</span><span class="op" id="1345548">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345552">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345556">nanoseconds</span><span class="op" id="1345567">,</span>&nbsp;<span class="ident" id="1345569">err</span>&nbsp;<span class="op" id="1345573">=</span>&nbsp;<span class="ident" id="1345575">strconv</span><span class="op" id="1345582">.</span><span class="ident" id="1345583">ParseInt</span><span class="op" id="1345591">(</span><span class="builtintype" id="1345592">string</span><span class="op" id="1345598">(</span><span class="ident" id="1345599">nano_buf</span><span class="op" id="1345607">)</span><span class="op" id="1345608">,</span>&nbsp;<span class="num" id="1345610">10</span><span class="op" id="1345612">,</span>&nbsp;<span class="num" id="1345614">0</span><span class="op" id="1345615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345619">if</span>&nbsp;<span class="ident" id="1345622">err</span>&nbsp;<span class="op" id="1345626">!=</span>&nbsp;<span class="ident" id="1345629">nil</span>&nbsp;<span class="op" id="1345633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345638">return</span>&nbsp;<span class="ident" id="1345645">time</span><span class="op" id="1345649">.</span><span class="ident" id="1345650">Time</span><span class="op" id="1345654">{</span><span class="op" id="1345655">}</span><span class="op" id="1345656">,</span>&nbsp;<span class="ident" id="1345658">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345667">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345670">ts</span>&nbsp;<span class="op" id="1345673">:=</span>&nbsp;<span class="ident" id="1345676">time</span><span class="op" id="1345680">.</span><span class="ident" id="1345681">Unix</span><span class="op" id="1345685">(</span><span class="ident" id="1345686">seconds</span><span class="op" id="1345693">,</span>&nbsp;<span class="ident" id="1345695">nanoseconds</span><span class="op" id="1345706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345709">return</span>&nbsp;<span class="ident" id="1345716">ts</span><span class="op" id="1345718">,</span>&nbsp;<span class="ident" id="1345720">nil</span><br>
<span class="lineno"></span><span class="op" id="1345724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1345727">//&nbsp;parsePAX&nbsp;parses&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno">310</span><span class="comment" id="1345759">//&nbsp;If&nbsp;an&nbsp;extended&nbsp;header&nbsp;(type&nbsp;&#39;x&#39;)&nbsp;is&nbsp;invalid,&nbsp;ErrHeader&nbsp;is&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="1345829">func</span>&nbsp;<span class="ident" id="1345834">parsePAX</span><span class="op" id="1345842">(</span><span class="ident" id="1345843">r</span>&nbsp;<span class="ident" id="1345845">io</span><span class="op" id="1345847">.</span><span class="ident" id="1345848">Reader</span><span class="op" id="1345854">)</span>&nbsp;<span class="op" id="1345856">(</span><span class="keyword" id="1345857">map</span><span class="op" id="1345860">[</span><span class="builtintype" id="1345861">string</span><span class="op" id="1345867">]</span><span class="builtintype" id="1345868">string</span><span class="op" id="1345874">,</span>&nbsp;<span class="builtintype" id="1345876">error</span><span class="op" id="1345881">)</span>&nbsp;<span class="op" id="1345883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345886">buf</span><span class="op" id="1345889">,</span>&nbsp;<span class="ident" id="1345891">err</span>&nbsp;<span class="op" id="1345895">:=</span>&nbsp;<span class="ident" id="1345898">ioutil</span><span class="op" id="1345904">.</span><span class="ident" id="1345905">ReadAll</span><span class="op" id="1345912">(</span><span class="ident" id="1345913">r</span><span class="op" id="1345914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345917">if</span>&nbsp;<span class="ident" id="1345920">err</span>&nbsp;<span class="op" id="1345924">!=</span>&nbsp;<span class="ident" id="1345927">nil</span>&nbsp;<span class="op" id="1345931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345935">return</span>&nbsp;<span class="ident" id="1345942">nil</span><span class="op" id="1345945">,</span>&nbsp;<span class="ident" id="1345947">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1345956">//&nbsp;For&nbsp;GNU&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1345999">//&nbsp;This&nbsp;function&nbsp;transforms&nbsp;the&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;headers&nbsp;into&nbsp;sparse&nbsp;format&nbsp;0.1&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346090">var</span>&nbsp;<span class="ident" id="1346094">sparseMap</span>&nbsp;<span class="ident" id="1346104">bytes</span><span class="op" id="1346109">.</span><span class="ident" id="1346110">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346119">headers</span>&nbsp;<span class="op" id="1346127">:=</span>&nbsp;<span class="builtinfunc" id="1346130">make</span><span class="op" id="1346134">(</span><span class="keyword" id="1346135">map</span><span class="op" id="1346138">[</span><span class="builtintype" id="1346139">string</span><span class="op" id="1346145">]</span><span class="builtintype" id="1346146">string</span><span class="op" id="1346152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346155">//&nbsp;Each&nbsp;record&nbsp;is&nbsp;constructed&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346189">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;%d&nbsp;%s=%s\n&#34;,&nbsp;length,&nbsp;keyword,&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346234">for</span>&nbsp;<span class="builtinfunc" id="1346238">len</span><span class="op" id="1346241">(</span><span class="ident" id="1346242">buf</span><span class="op" id="1346245">)</span>&nbsp;<span class="op" id="1346247">&gt;</span>&nbsp;<span class="num" id="1346249">0</span>&nbsp;<span class="op" id="1346251">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346255">//&nbsp;or&nbsp;the&nbsp;header&nbsp;was&nbsp;empty&nbsp;to&nbsp;start&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346299">var</span>&nbsp;<span class="ident" id="1346303">sp</span>&nbsp;<span class="builtintype" id="1346306">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346312">//&nbsp;The&nbsp;size&nbsp;field&nbsp;ends&nbsp;at&nbsp;the&nbsp;first&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346357">sp</span>&nbsp;<span class="op" id="1346360">=</span>&nbsp;<span class="ident" id="1346362">bytes</span><span class="op" id="1346367">.</span><span class="ident" id="1346368">IndexByte</span><span class="op" id="1346377">(</span><span class="ident" id="1346378">buf</span><span class="op" id="1346381">,</span>&nbsp;<span class="string" id="1346383">&#39;&nbsp;&#39;</span><span class="op" id="1346386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346390">if</span>&nbsp;<span class="ident" id="1346393">sp</span>&nbsp;<span class="op" id="1346396">==</span>&nbsp;<span class="op" id="1346399">-</span><span class="num" id="1346400">1</span>&nbsp;<span class="op" id="1346402">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346407">return</span>&nbsp;<span class="ident" id="1346414">nil</span><span class="op" id="1346417">,</span>&nbsp;<span class="ident" id="1346419">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346435">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;token&nbsp;as&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346484">n</span><span class="op" id="1346485">,</span>&nbsp;<span class="ident" id="1346487">err</span>&nbsp;<span class="op" id="1346491">:=</span>&nbsp;<span class="ident" id="1346494">strconv</span><span class="op" id="1346501">.</span><span class="ident" id="1346502">ParseInt</span><span class="op" id="1346510">(</span><span class="builtintype" id="1346511">string</span><span class="op" id="1346517">(</span><span class="ident" id="1346518">buf</span><span class="op" id="1346521">[</span><span class="op" id="1346522">:</span><span class="ident" id="1346523">sp</span><span class="op" id="1346525">]</span><span class="op" id="1346526">)</span><span class="op" id="1346527">,</span>&nbsp;<span class="num" id="1346529">10</span><span class="op" id="1346531">,</span>&nbsp;<span class="num" id="1346533">0</span><span class="op" id="1346534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346538">if</span>&nbsp;<span class="ident" id="1346541">err</span>&nbsp;<span class="op" id="1346545">!=</span>&nbsp;<span class="ident" id="1346548">nil</span>&nbsp;<span class="op" id="1346552">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346557">return</span>&nbsp;<span class="ident" id="1346564">nil</span><span class="op" id="1346567">,</span>&nbsp;<span class="ident" id="1346569">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346585">//&nbsp;Extract&nbsp;everything&nbsp;between&nbsp;the&nbsp;decimal&nbsp;and&nbsp;the&nbsp;n&nbsp;-1&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346649">//&nbsp;beginning&nbsp;to&nbsp;eat&nbsp;the&nbsp;&#39;&nbsp;&#39;,&nbsp;-1&nbsp;on&nbsp;the&nbsp;end&nbsp;to&nbsp;skip&nbsp;the&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346715">var</span>&nbsp;<span class="ident" id="1346719">record</span>&nbsp;<span class="op" id="1346726">[</span><span class="op" id="1346727">]</span><span class="builtintype" id="1346728">byte</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346735">record</span><span class="op" id="1346741">,</span>&nbsp;<span class="ident" id="1346743">buf</span>&nbsp;<span class="op" id="1346747">=</span>&nbsp;<span class="ident" id="1346749">buf</span><span class="op" id="1346752">[</span><span class="ident" id="1346753">sp</span><span class="op" id="1346755">+</span><span class="num" id="1346756">1</span><span class="op" id="1346757">:</span><span class="ident" id="1346758">n</span><span class="op" id="1346759">-</span><span class="num" id="1346760">1</span><span class="op" id="1346761">]</span><span class="op" id="1346762">,</span>&nbsp;<span class="ident" id="1346764">buf</span><span class="op" id="1346767">[</span><span class="ident" id="1346768">n</span><span class="op" id="1346769">:</span><span class="op" id="1346770">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346774">//&nbsp;The&nbsp;first&nbsp;equals&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346838">//&nbsp;Everything&nbsp;else&nbsp;is&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346869">eq</span>&nbsp;<span class="op" id="1346872">:=</span>&nbsp;<span class="ident" id="1346875">bytes</span><span class="op" id="1346880">.</span><span class="ident" id="1346881">IndexByte</span><span class="op" id="1346890">(</span><span class="ident" id="1346891">record</span><span class="op" id="1346897">,</span>&nbsp;<span class="string" id="1346899">&#39;=&#39;</span><span class="op" id="1346902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346906">if</span>&nbsp;<span class="ident" id="1346909">eq</span>&nbsp;<span class="op" id="1346912">==</span>&nbsp;<span class="op" id="1346915">-</span><span class="num" id="1346916">1</span>&nbsp;<span class="op" id="1346918">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346923">return</span>&nbsp;<span class="ident" id="1346930">nil</span><span class="op" id="1346933">,</span>&nbsp;<span class="ident" id="1346935">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346951">key</span><span class="op" id="1346954">,</span>&nbsp;<span class="ident" id="1346956">value</span>&nbsp;<span class="op" id="1346962">:=</span>&nbsp;<span class="ident" id="1346965">record</span><span class="op" id="1346971">[</span><span class="op" id="1346972">:</span><span class="ident" id="1346973">eq</span><span class="op" id="1346975">]</span><span class="op" id="1346976">,</span>&nbsp;<span class="ident" id="1346978">record</span><span class="op" id="1346984">[</span><span class="ident" id="1346985">eq</span><span class="op" id="1346987">+</span><span class="num" id="1346988">1</span><span class="op" id="1346989">:</span><span class="op" id="1346990">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346995">keyStr</span>&nbsp;<span class="op" id="1347002">:=</span>&nbsp;<span class="builtintype" id="1347005">string</span><span class="op" id="1347011">(</span><span class="ident" id="1347012">key</span><span class="op" id="1347015">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347019">if</span>&nbsp;<span class="ident" id="1347022">keyStr</span>&nbsp;<span class="op" id="1347029">==</span>&nbsp;<span class="ident" id="1347032">paxGNUSparseOffset</span>&nbsp;<span class="op" id="1347051">||</span>&nbsp;<span class="ident" id="1347054">keyStr</span>&nbsp;<span class="op" id="1347061">==</span>&nbsp;<span class="ident" id="1347064">paxGNUSparseNumBytes</span>&nbsp;<span class="op" id="1347085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1347090">//&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;special&nbsp;key.&nbsp;Write&nbsp;to&nbsp;sparseMap&nbsp;instead&nbsp;of&nbsp;using&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347184">sparseMap</span><span class="op" id="1347193">.</span><span class="ident" id="1347194">Write</span><span class="op" id="1347199">(</span><span class="ident" id="1347200">value</span><span class="op" id="1347205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347210">sparseMap</span><span class="op" id="1347219">.</span><span class="ident" id="1347220">Write</span><span class="op" id="1347225">(</span><span class="op" id="1347226">[</span><span class="op" id="1347227">]</span><span class="builtintype" id="1347228">byte</span><span class="op" id="1347232">{</span><span class="string" id="1347233">&#39;,&#39;</span><span class="op" id="1347236">}</span><span class="op" id="1347237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347241">}</span>&nbsp;<span class="keyword" id="1347243">else</span>&nbsp;<span class="op" id="1347248">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1347253">//&nbsp;Normal&nbsp;key.&nbsp;Set&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347305">headers</span><span class="op" id="1347312">[</span><span class="ident" id="1347313">keyStr</span><span class="op" id="1347319">]</span>&nbsp;<span class="op" id="1347321">=</span>&nbsp;<span class="builtintype" id="1347323">string</span><span class="op" id="1347329">(</span><span class="ident" id="1347330">value</span><span class="op" id="1347335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347345">if</span>&nbsp;<span class="ident" id="1347348">sparseMap</span><span class="op" id="1347357">.</span><span class="ident" id="1347358">Len</span><span class="op" id="1347361">(</span><span class="op" id="1347362">)</span>&nbsp;<span class="op" id="1347364">!=</span>&nbsp;<span class="num" id="1347367">0</span>&nbsp;<span class="op" id="1347369">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1347373">//&nbsp;Add&nbsp;sparse&nbsp;info&nbsp;to&nbsp;headers,&nbsp;chopping&nbsp;off&nbsp;the&nbsp;extra&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347435">sparseMap</span><span class="op" id="1347444">.</span><span class="ident" id="1347445">Truncate</span><span class="op" id="1347453">(</span><span class="ident" id="1347454">sparseMap</span><span class="op" id="1347463">.</span><span class="ident" id="1347464">Len</span><span class="op" id="1347467">(</span><span class="op" id="1347468">)</span>&nbsp;<span class="op" id="1347470">-</span>&nbsp;<span class="num" id="1347472">1</span><span class="op" id="1347473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347477">headers</span><span class="op" id="1347484">[</span><span class="ident" id="1347485">paxGNUSparseMap</span><span class="op" id="1347500">]</span>&nbsp;<span class="op" id="1347502">=</span>&nbsp;<span class="ident" id="1347504">sparseMap</span><span class="op" id="1347513">.</span><span class="ident" id="1347514">String</span><span class="op" id="1347520">(</span><span class="op" id="1347521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347527">return</span>&nbsp;<span class="ident" id="1347534">headers</span><span class="op" id="1347541">,</span>&nbsp;<span class="ident" id="1347543">nil</span><br>
<span class="lineno">365</span><span class="op" id="1347547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1347550">//&nbsp;cString&nbsp;parses&nbsp;bytes&nbsp;as&nbsp;a&nbsp;NUL-terminated&nbsp;C-style&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="1347610">//&nbsp;If&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;is&nbsp;not&nbsp;found&nbsp;then&nbsp;the&nbsp;whole&nbsp;slice&nbsp;is&nbsp;returned&nbsp;as&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1347686">func</span>&nbsp;<span class="ident" id="1347691">cString</span><span class="op" id="1347698">(</span><span class="ident" id="1347699">b</span>&nbsp;<span class="op" id="1347701">[</span><span class="op" id="1347702">]</span><span class="builtintype" id="1347703">byte</span><span class="op" id="1347707">)</span>&nbsp;<span class="builtintype" id="1347709">string</span>&nbsp;<span class="op" id="1347716">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347719">n</span>&nbsp;<span class="op" id="1347721">:=</span>&nbsp;<span class="num" id="1347724">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347727">for</span>&nbsp;<span class="ident" id="1347731">n</span>&nbsp;<span class="op" id="1347733">&lt;</span>&nbsp;<span class="builtinfunc" id="1347735">len</span><span class="op" id="1347738">(</span><span class="ident" id="1347739">b</span><span class="op" id="1347740">)</span>&nbsp;<span class="op" id="1347742">&amp;&amp;</span>&nbsp;<span class="ident" id="1347745">b</span><span class="op" id="1347746">[</span><span class="ident" id="1347747">n</span><span class="op" id="1347748">]</span>&nbsp;<span class="op" id="1347750">!=</span>&nbsp;<span class="num" id="1347753">0</span>&nbsp;<span class="op" id="1347755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347759">n</span><span class="op" id="1347760">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347767">return</span>&nbsp;<span class="builtintype" id="1347774">string</span><span class="op" id="1347780">(</span><span class="ident" id="1347781">b</span><span class="op" id="1347782">[</span><span class="num" id="1347783">0</span><span class="op" id="1347784">:</span><span class="ident" id="1347785">n</span><span class="op" id="1347786">]</span><span class="op" id="1347787">)</span><br>
<span class="lineno">375</span><span class="op" id="1347789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1347792">func</span>&nbsp;<span class="op" id="1347797">(</span><span class="ident" id="1347798">tr</span>&nbsp;<span class="op" id="1347801">*</span><span class="ident" id="1347802">Reader</span><span class="op" id="1347808">)</span>&nbsp;<span class="ident" id="1347810">octal</span><span class="op" id="1347815">(</span><span class="ident" id="1347816">b</span>&nbsp;<span class="op" id="1347818">[</span><span class="op" id="1347819">]</span><span class="builtintype" id="1347820">byte</span><span class="op" id="1347824">)</span>&nbsp;<span class="ident" id="1347826">int64</span>&nbsp;<span class="op" id="1347832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1347835">//&nbsp;Check&nbsp;for&nbsp;binary&nbsp;format&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347870">if</span>&nbsp;<span class="builtinfunc" id="1347873">len</span><span class="op" id="1347876">(</span><span class="ident" id="1347877">b</span><span class="op" id="1347878">)</span>&nbsp;<span class="op" id="1347880">&gt;</span>&nbsp;<span class="num" id="1347882">0</span>&nbsp;<span class="op" id="1347884">&amp;&amp;</span>&nbsp;<span class="ident" id="1347887">b</span><span class="op" id="1347888">[</span><span class="num" id="1347889">0</span><span class="op" id="1347890">]</span><span class="op" id="1347891">&amp;</span><span class="num" id="1347892">0x80</span>&nbsp;<span class="op" id="1347897">!=</span>&nbsp;<span class="num" id="1347900">0</span>&nbsp;<span class="op" id="1347902">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347906">var</span>&nbsp;<span class="ident" id="1347910">x</span>&nbsp;<span class="ident" id="1347912">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347920">for</span>&nbsp;<span class="ident" id="1347924">i</span><span class="op" id="1347925">,</span>&nbsp;<span class="ident" id="1347927">c</span>&nbsp;<span class="op" id="1347929">:=</span>&nbsp;<span class="keyword" id="1347932">range</span>&nbsp;<span class="ident" id="1347938">b</span>&nbsp;<span class="op" id="1347940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347945">if</span>&nbsp;<span class="ident" id="1347948">i</span>&nbsp;<span class="op" id="1347950">==</span>&nbsp;<span class="num" id="1347953">0</span>&nbsp;<span class="op" id="1347955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347961">c</span>&nbsp;<span class="op" id="1347963">&amp;=</span>&nbsp;<span class="num" id="1347966">0x7f</span>&nbsp;<span class="comment" id="1347971">//&nbsp;ignore&nbsp;signal&nbsp;bit&nbsp;in&nbsp;first&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348009">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348014">x</span>&nbsp;<span class="op" id="1348016">=</span>&nbsp;<span class="ident" id="1348018">x</span><span class="op" id="1348019">&lt;&lt;</span><span class="num" id="1348021">8</span>&nbsp;<span class="op" id="1348023">|</span>&nbsp;<span class="ident" id="1348025">int64</span><span class="op" id="1348030">(</span><span class="ident" id="1348031">c</span><span class="op" id="1348032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348040">return</span>&nbsp;<span class="ident" id="1348047">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1348054">//&nbsp;Because&nbsp;unused&nbsp;fields&nbsp;are&nbsp;filled&nbsp;with&nbsp;NULs,&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1348110">//&nbsp;to&nbsp;skip&nbsp;leading&nbsp;NULs.&nbsp;Fields&nbsp;may&nbsp;also&nbsp;be&nbsp;padded&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1348167">//&nbsp;spaces&nbsp;or&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1348187">//&nbsp;So&nbsp;we&nbsp;remove&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;NULs&nbsp;and&nbsp;spaces&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1348244">//&nbsp;be&nbsp;sure.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348257">b</span>&nbsp;<span class="op" id="1348259">=</span>&nbsp;<span class="ident" id="1348261">bytes</span><span class="op" id="1348266">.</span><span class="ident" id="1348267">Trim</span><span class="op" id="1348271">(</span><span class="ident" id="1348272">b</span><span class="op" id="1348273">,</span>&nbsp;<span class="string" id="1348275">&#34;&nbsp;\x00&#34;</span><span class="op" id="1348282">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348286">if</span>&nbsp;<span class="builtinfunc" id="1348289">len</span><span class="op" id="1348292">(</span><span class="ident" id="1348293">b</span><span class="op" id="1348294">)</span>&nbsp;<span class="op" id="1348296">==</span>&nbsp;<span class="num" id="1348299">0</span>&nbsp;<span class="op" id="1348301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348305">return</span>&nbsp;<span class="num" id="1348312">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348315">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348318">x</span><span class="op" id="1348319">,</span>&nbsp;<span class="ident" id="1348321">err</span>&nbsp;<span class="op" id="1348325">:=</span>&nbsp;<span class="ident" id="1348328">strconv</span><span class="op" id="1348335">.</span><span class="ident" id="1348336">ParseUint</span><span class="op" id="1348345">(</span><span class="ident" id="1348346">cString</span><span class="op" id="1348353">(</span><span class="ident" id="1348354">b</span><span class="op" id="1348355">)</span><span class="op" id="1348356">,</span>&nbsp;<span class="num" id="1348358">8</span><span class="op" id="1348359">,</span>&nbsp;<span class="num" id="1348361">64</span><span class="op" id="1348363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348366">if</span>&nbsp;<span class="ident" id="1348369">err</span>&nbsp;<span class="op" id="1348373">!=</span>&nbsp;<span class="ident" id="1348376">nil</span>&nbsp;<span class="op" id="1348380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348384">tr</span><span class="op" id="1348386">.</span><span class="ident" id="1348387">err</span>&nbsp;<span class="op" id="1348391">=</span>&nbsp;<span class="ident" id="1348393">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348401">return</span>&nbsp;<span class="ident" id="1348408">int64</span><span class="op" id="1348413">(</span><span class="ident" id="1348414">x</span><span class="op" id="1348415">)</span><br>
<span class="lineno">405</span><span class="op" id="1348417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1348420">//&nbsp;skipUnread&nbsp;skips&nbsp;any&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;the&nbsp;existing&nbsp;file&nbsp;entry,&nbsp;as&nbsp;well&nbsp;as&nbsp;any&nbsp;alignment&nbsp;padding.</span><br>
<span class="lineno"></span><span class="keyword" id="1348519">func</span>&nbsp;<span class="op" id="1348524">(</span><span class="ident" id="1348525">tr</span>&nbsp;<span class="op" id="1348528">*</span><span class="ident" id="1348529">Reader</span><span class="op" id="1348535">)</span>&nbsp;<span class="ident" id="1348537">skipUnread</span><span class="op" id="1348547">(</span><span class="op" id="1348548">)</span>&nbsp;<span class="op" id="1348550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348553">nr</span>&nbsp;<span class="op" id="1348556">:=</span>&nbsp;<span class="ident" id="1348559">tr</span><span class="op" id="1348561">.</span><span class="ident" id="1348562">numBytes</span><span class="op" id="1348570">(</span><span class="op" id="1348571">)</span>&nbsp;<span class="op" id="1348573">+</span>&nbsp;<span class="ident" id="1348575">tr</span><span class="op" id="1348577">.</span><span class="ident" id="1348578">pad</span>&nbsp;<span class="comment" id="1348582">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;skip</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348610">tr</span><span class="op" id="1348612">.</span><span class="ident" id="1348613">curr</span><span class="op" id="1348617">,</span>&nbsp;<span class="ident" id="1348619">tr</span><span class="op" id="1348621">.</span><span class="ident" id="1348622">pad</span>&nbsp;<span class="op" id="1348626">=</span>&nbsp;<span class="ident" id="1348628">nil</span><span class="op" id="1348631">,</span>&nbsp;<span class="num" id="1348633">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348636">if</span>&nbsp;<span class="ident" id="1348639">sr</span><span class="op" id="1348641">,</span>&nbsp;<span class="ident" id="1348643">ok</span>&nbsp;<span class="op" id="1348646">:=</span>&nbsp;<span class="ident" id="1348649">tr</span><span class="op" id="1348651">.</span><span class="ident" id="1348652">r</span><span class="op" id="1348653">.</span><span class="op" id="1348654">(</span><span class="ident" id="1348655">io</span><span class="op" id="1348657">.</span><span class="ident" id="1348658">Seeker</span><span class="op" id="1348664">)</span><span class="op" id="1348665">;</span>&nbsp;<span class="ident" id="1348667">ok</span>&nbsp;<span class="op" id="1348670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348674">if</span>&nbsp;<span class="ident" id="1348677">_</span><span class="op" id="1348678">,</span>&nbsp;<span class="ident" id="1348680">err</span>&nbsp;<span class="op" id="1348684">:=</span>&nbsp;<span class="ident" id="1348687">sr</span><span class="op" id="1348689">.</span><span class="ident" id="1348690">Seek</span><span class="op" id="1348694">(</span><span class="ident" id="1348695">nr</span><span class="op" id="1348697">,</span>&nbsp;<span class="ident" id="1348699">os</span><span class="op" id="1348701">.</span><span class="ident" id="1348702">SEEK_CUR</span><span class="op" id="1348710">)</span><span class="op" id="1348711">;</span>&nbsp;<span class="ident" id="1348713">err</span>&nbsp;<span class="op" id="1348717">==</span>&nbsp;<span class="ident" id="1348720">nil</span>&nbsp;<span class="op" id="1348724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348729">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348738">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348744">_</span><span class="op" id="1348745">,</span>&nbsp;<span class="ident" id="1348747">tr</span><span class="op" id="1348749">.</span><span class="ident" id="1348750">err</span>&nbsp;<span class="op" id="1348754">=</span>&nbsp;<span class="ident" id="1348756">io</span><span class="op" id="1348758">.</span><span class="ident" id="1348759">CopyN</span><span class="op" id="1348764">(</span><span class="ident" id="1348765">ioutil</span><span class="op" id="1348771">.</span><span class="ident" id="1348772">Discard</span><span class="op" id="1348779">,</span>&nbsp;<span class="ident" id="1348781">tr</span><span class="op" id="1348783">.</span><span class="ident" id="1348784">r</span><span class="op" id="1348785">,</span>&nbsp;<span class="ident" id="1348787">nr</span><span class="op" id="1348789">)</span><br>
<span class="lineno"></span><span class="op" id="1348791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1348794">func</span>&nbsp;<span class="op" id="1348799">(</span><span class="ident" id="1348800">tr</span>&nbsp;<span class="op" id="1348803">*</span><span class="ident" id="1348804">Reader</span><span class="op" id="1348810">)</span>&nbsp;<span class="ident" id="1348812">verifyChecksum</span><span class="op" id="1348826">(</span><span class="ident" id="1348827">header</span>&nbsp;<span class="op" id="1348834">[</span><span class="op" id="1348835">]</span><span class="builtintype" id="1348836">byte</span><span class="op" id="1348840">)</span>&nbsp;<span class="builtintype" id="1348842">bool</span>&nbsp;<span class="op" id="1348847">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348850">if</span>&nbsp;<span class="ident" id="1348853">tr</span><span class="op" id="1348855">.</span><span class="ident" id="1348856">err</span>&nbsp;<span class="op" id="1348860">!=</span>&nbsp;<span class="ident" id="1348863">nil</span>&nbsp;<span class="op" id="1348867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348871">return</span>&nbsp;<span class="builtintype" id="1348878">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348889">given</span>&nbsp;<span class="op" id="1348895">:=</span>&nbsp;<span class="ident" id="1348898">tr</span><span class="op" id="1348900">.</span><span class="ident" id="1348901">octal</span><span class="op" id="1348906">(</span><span class="ident" id="1348907">header</span><span class="op" id="1348913">[</span><span class="num" id="1348914">148</span><span class="op" id="1348917">:</span><span class="num" id="1348918">156</span><span class="op" id="1348921">]</span><span class="op" id="1348922">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348925">unsigned</span><span class="op" id="1348933">,</span>&nbsp;<span class="ident" id="1348935">signed</span>&nbsp;<span class="op" id="1348942">:=</span>&nbsp;<span class="ident" id="1348945">checksum</span><span class="op" id="1348953">(</span><span class="ident" id="1348954">header</span><span class="op" id="1348960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348963">return</span>&nbsp;<span class="ident" id="1348970">given</span>&nbsp;<span class="op" id="1348976">==</span>&nbsp;<span class="ident" id="1348979">unsigned</span>&nbsp;<span class="op" id="1348988">||</span>&nbsp;<span class="ident" id="1348991">given</span>&nbsp;<span class="op" id="1348997">==</span>&nbsp;<span class="ident" id="1349000">signed</span><br>
<span class="lineno"></span><span class="op" id="1349007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1349010">func</span>&nbsp;<span class="op" id="1349015">(</span><span class="ident" id="1349016">tr</span>&nbsp;<span class="op" id="1349019">*</span><span class="ident" id="1349020">Reader</span><span class="op" id="1349026">)</span>&nbsp;<span class="ident" id="1349028">readHeader</span><span class="op" id="1349038">(</span><span class="op" id="1349039">)</span>&nbsp;<span class="op" id="1349041">*</span><span class="ident" id="1349042">Header</span>&nbsp;<span class="op" id="1349049">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349052">header</span>&nbsp;<span class="op" id="1349059">:=</span>&nbsp;<span class="ident" id="1349062">tr</span><span class="op" id="1349064">.</span><span class="ident" id="1349065">hdrBuff</span><span class="op" id="1349072">[</span><span class="op" id="1349073">:</span><span class="op" id="1349074">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1349077">copy</span><span class="op" id="1349081">(</span><span class="ident" id="1349082">header</span><span class="op" id="1349088">,</span>&nbsp;<span class="ident" id="1349090">zeroBlock</span><span class="op" id="1349099">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349103">if</span>&nbsp;<span class="ident" id="1349106">_</span><span class="op" id="1349107">,</span>&nbsp;<span class="ident" id="1349109">tr</span><span class="op" id="1349111">.</span><span class="ident" id="1349112">err</span>&nbsp;<span class="op" id="1349116">=</span>&nbsp;<span class="ident" id="1349118">io</span><span class="op" id="1349120">.</span><span class="ident" id="1349121">ReadFull</span><span class="op" id="1349129">(</span><span class="ident" id="1349130">tr</span><span class="op" id="1349132">.</span><span class="ident" id="1349133">r</span><span class="op" id="1349134">,</span>&nbsp;<span class="ident" id="1349136">header</span><span class="op" id="1349142">)</span><span class="op" id="1349143">;</span>&nbsp;<span class="ident" id="1349145">tr</span><span class="op" id="1349147">.</span><span class="ident" id="1349148">err</span>&nbsp;<span class="op" id="1349152">!=</span>&nbsp;<span class="ident" id="1349155">nil</span>&nbsp;<span class="op" id="1349159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349163">return</span>&nbsp;<span class="ident" id="1349170">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1349179">//&nbsp;Two&nbsp;blocks&nbsp;of&nbsp;zero&nbsp;bytes&nbsp;marks&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349238">if</span>&nbsp;<span class="ident" id="1349241">bytes</span><span class="op" id="1349246">.</span><span class="ident" id="1349247">Equal</span><span class="op" id="1349252">(</span><span class="ident" id="1349253">header</span><span class="op" id="1349259">,</span>&nbsp;<span class="ident" id="1349261">zeroBlock</span><span class="op" id="1349270">[</span><span class="num" id="1349271">0</span><span class="op" id="1349272">:</span><span class="ident" id="1349273">blockSize</span><span class="op" id="1349282">]</span><span class="op" id="1349283">)</span>&nbsp;<span class="op" id="1349285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349289">if</span>&nbsp;<span class="ident" id="1349292">_</span><span class="op" id="1349293">,</span>&nbsp;<span class="ident" id="1349295">tr</span><span class="op" id="1349297">.</span><span class="ident" id="1349298">err</span>&nbsp;<span class="op" id="1349302">=</span>&nbsp;<span class="ident" id="1349304">io</span><span class="op" id="1349306">.</span><span class="ident" id="1349307">ReadFull</span><span class="op" id="1349315">(</span><span class="ident" id="1349316">tr</span><span class="op" id="1349318">.</span><span class="ident" id="1349319">r</span><span class="op" id="1349320">,</span>&nbsp;<span class="ident" id="1349322">header</span><span class="op" id="1349328">)</span><span class="op" id="1349329">;</span>&nbsp;<span class="ident" id="1349331">tr</span><span class="op" id="1349333">.</span><span class="ident" id="1349334">err</span>&nbsp;<span class="op" id="1349338">!=</span>&nbsp;<span class="ident" id="1349341">nil</span>&nbsp;<span class="op" id="1349345">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349350">return</span>&nbsp;<span class="ident" id="1349357">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349367">if</span>&nbsp;<span class="ident" id="1349370">bytes</span><span class="op" id="1349375">.</span><span class="ident" id="1349376">Equal</span><span class="op" id="1349381">(</span><span class="ident" id="1349382">header</span><span class="op" id="1349388">,</span>&nbsp;<span class="ident" id="1349390">zeroBlock</span><span class="op" id="1349399">[</span><span class="num" id="1349400">0</span><span class="op" id="1349401">:</span><span class="ident" id="1349402">blockSize</span><span class="op" id="1349411">]</span><span class="op" id="1349412">)</span>&nbsp;<span class="op" id="1349414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349419">tr</span><span class="op" id="1349421">.</span><span class="ident" id="1349422">err</span>&nbsp;<span class="op" id="1349426">=</span>&nbsp;<span class="ident" id="1349428">io</span><span class="op" id="1349430">.</span><span class="ident" id="1349431">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349437">}</span>&nbsp;<span class="keyword" id="1349439">else</span>&nbsp;<span class="op" id="1349444">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349449">tr</span><span class="op" id="1349451">.</span><span class="ident" id="1349452">err</span>&nbsp;<span class="op" id="1349456">=</span>&nbsp;<span class="ident" id="1349458">ErrHeader</span>&nbsp;<span class="comment" id="1349468">//&nbsp;zero&nbsp;block&nbsp;and&nbsp;then&nbsp;non-zero&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349512">return</span>&nbsp;<span class="ident" id="1349519">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349528">if</span>&nbsp;<span class="op" id="1349531">!</span><span class="ident" id="1349532">tr</span><span class="op" id="1349534">.</span><span class="ident" id="1349535">verifyChecksum</span><span class="op" id="1349549">(</span><span class="ident" id="1349550">header</span><span class="op" id="1349556">)</span>&nbsp;<span class="op" id="1349558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349562">tr</span><span class="op" id="1349564">.</span><span class="ident" id="1349565">err</span>&nbsp;<span class="op" id="1349569">=</span>&nbsp;<span class="ident" id="1349571">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349583">return</span>&nbsp;<span class="ident" id="1349590">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1349599">//&nbsp;Unpack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349610">hdr</span>&nbsp;<span class="op" id="1349614">:=</span>&nbsp;<span class="builtinfunc" id="1349617">new</span><span class="op" id="1349620">(</span><span class="ident" id="1349621">Header</span><span class="op" id="1349627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349630">s</span>&nbsp;<span class="op" id="1349632">:=</span>&nbsp;<span class="ident" id="1349635">slicer</span><span class="op" id="1349641">(</span><span class="ident" id="1349642">header</span><span class="op" id="1349648">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349652">hdr</span><span class="op" id="1349655">.</span><span class="ident" id="1349656">Name</span>&nbsp;<span class="op" id="1349661">=</span>&nbsp;<span class="ident" id="1349663">cString</span><span class="op" id="1349670">(</span><span class="ident" id="1349671">s</span><span class="op" id="1349672">.</span><span class="ident" id="1349673">next</span><span class="op" id="1349677">(</span><span class="num" id="1349678">100</span><span class="op" id="1349681">)</span><span class="op" id="1349682">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349685">hdr</span><span class="op" id="1349688">.</span><span class="ident" id="1349689">Mode</span>&nbsp;<span class="op" id="1349694">=</span>&nbsp;<span class="ident" id="1349696">tr</span><span class="op" id="1349698">.</span><span class="ident" id="1349699">octal</span><span class="op" id="1349704">(</span><span class="ident" id="1349705">s</span><span class="op" id="1349706">.</span><span class="ident" id="1349707">next</span><span class="op" id="1349711">(</span><span class="num" id="1349712">8</span><span class="op" id="1349713">)</span><span class="op" id="1349714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349717">hdr</span><span class="op" id="1349720">.</span><span class="ident" id="1349721">Uid</span>&nbsp;<span class="op" id="1349725">=</span>&nbsp;<span class="builtintype" id="1349727">int</span><span class="op" id="1349730">(</span><span class="ident" id="1349731">tr</span><span class="op" id="1349733">.</span><span class="ident" id="1349734">octal</span><span class="op" id="1349739">(</span><span class="ident" id="1349740">s</span><span class="op" id="1349741">.</span><span class="ident" id="1349742">next</span><span class="op" id="1349746">(</span><span class="num" id="1349747">8</span><span class="op" id="1349748">)</span><span class="op" id="1349749">)</span><span class="op" id="1349750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349753">hdr</span><span class="op" id="1349756">.</span><span class="ident" id="1349757">Gid</span>&nbsp;<span class="op" id="1349761">=</span>&nbsp;<span class="builtintype" id="1349763">int</span><span class="op" id="1349766">(</span><span class="ident" id="1349767">tr</span><span class="op" id="1349769">.</span><span class="ident" id="1349770">octal</span><span class="op" id="1349775">(</span><span class="ident" id="1349776">s</span><span class="op" id="1349777">.</span><span class="ident" id="1349778">next</span><span class="op" id="1349782">(</span><span class="num" id="1349783">8</span><span class="op" id="1349784">)</span><span class="op" id="1349785">)</span><span class="op" id="1349786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349789">hdr</span><span class="op" id="1349792">.</span><span class="ident" id="1349793">Size</span>&nbsp;<span class="op" id="1349798">=</span>&nbsp;<span class="ident" id="1349800">tr</span><span class="op" id="1349802">.</span><span class="ident" id="1349803">octal</span><span class="op" id="1349808">(</span><span class="ident" id="1349809">s</span><span class="op" id="1349810">.</span><span class="ident" id="1349811">next</span><span class="op" id="1349815">(</span><span class="num" id="1349816">12</span><span class="op" id="1349818">)</span><span class="op" id="1349819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349822">hdr</span><span class="op" id="1349825">.</span><span class="ident" id="1349826">ModTime</span>&nbsp;<span class="op" id="1349834">=</span>&nbsp;<span class="ident" id="1349836">time</span><span class="op" id="1349840">.</span><span class="ident" id="1349841">Unix</span><span class="op" id="1349845">(</span><span class="ident" id="1349846">tr</span><span class="op" id="1349848">.</span><span class="ident" id="1349849">octal</span><span class="op" id="1349854">(</span><span class="ident" id="1349855">s</span><span class="op" id="1349856">.</span><span class="ident" id="1349857">next</span><span class="op" id="1349861">(</span><span class="num" id="1349862">12</span><span class="op" id="1349864">)</span><span class="op" id="1349865">)</span><span class="op" id="1349866">,</span>&nbsp;<span class="num" id="1349868">0</span><span class="op" id="1349869">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349872">s</span><span class="op" id="1349873">.</span><span class="ident" id="1349874">next</span><span class="op" id="1349878">(</span><span class="num" id="1349879">8</span><span class="op" id="1349880">)</span>&nbsp;<span class="comment" id="1349882">//&nbsp;chksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349893">hdr</span><span class="op" id="1349896">.</span><span class="ident" id="1349897">Typeflag</span>&nbsp;<span class="op" id="1349906">=</span>&nbsp;<span class="ident" id="1349908">s</span><span class="op" id="1349909">.</span><span class="ident" id="1349910">next</span><span class="op" id="1349914">(</span><span class="num" id="1349915">1</span><span class="op" id="1349916">)</span><span class="op" id="1349917">[</span><span class="num" id="1349918">0</span><span class="op" id="1349919">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349922">hdr</span><span class="op" id="1349925">.</span><span class="ident" id="1349926">Linkname</span>&nbsp;<span class="op" id="1349935">=</span>&nbsp;<span class="ident" id="1349937">cString</span><span class="op" id="1349944">(</span><span class="ident" id="1349945">s</span><span class="op" id="1349946">.</span><span class="ident" id="1349947">next</span><span class="op" id="1349951">(</span><span class="num" id="1349952">100</span><span class="op" id="1349955">)</span><span class="op" id="1349956">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1349960">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;header&nbsp;depends&nbsp;on&nbsp;the&nbsp;value&nbsp;of&nbsp;magic.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1350023">//&nbsp;The&nbsp;original&nbsp;(v7)&nbsp;version&nbsp;of&nbsp;tar&nbsp;had&nbsp;no&nbsp;explicit&nbsp;magic&nbsp;field,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1350089">//&nbsp;so&nbsp;its&nbsp;magic&nbsp;bytes,&nbsp;like&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;block,&nbsp;are&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350151">magic</span>&nbsp;<span class="op" id="1350157">:=</span>&nbsp;<span class="builtintype" id="1350160">string</span><span class="op" id="1350166">(</span><span class="ident" id="1350167">s</span><span class="op" id="1350168">.</span><span class="ident" id="1350169">next</span><span class="op" id="1350173">(</span><span class="num" id="1350174">8</span><span class="op" id="1350175">)</span><span class="op" id="1350176">)</span>&nbsp;<span class="comment" id="1350178">//&nbsp;contains&nbsp;version&nbsp;field&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350214">var</span>&nbsp;<span class="ident" id="1350218">format</span>&nbsp;<span class="builtintype" id="1350225">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350233">switch</span>&nbsp;<span class="op" id="1350240">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350243">case</span>&nbsp;<span class="ident" id="1350248">magic</span><span class="op" id="1350253">[</span><span class="op" id="1350254">:</span><span class="num" id="1350255">6</span><span class="op" id="1350256">]</span>&nbsp;<span class="op" id="1350258">==</span>&nbsp;<span class="string" id="1350261">&#34;ustar\x00&#34;</span><span class="op" id="1350272">:</span>&nbsp;<span class="comment" id="1350274">//&nbsp;POSIX&nbsp;tar&nbsp;(1003.1-1988)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350303">if</span>&nbsp;<span class="builtintype" id="1350306">string</span><span class="op" id="1350312">(</span><span class="ident" id="1350313">header</span><span class="op" id="1350319">[</span><span class="num" id="1350320">508</span><span class="op" id="1350323">:</span><span class="num" id="1350324">512</span><span class="op" id="1350327">]</span><span class="op" id="1350328">)</span>&nbsp;<span class="op" id="1350330">==</span>&nbsp;<span class="string" id="1350333">&#34;tar\x00&#34;</span>&nbsp;<span class="op" id="1350343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350348">format</span>&nbsp;<span class="op" id="1350355">=</span>&nbsp;<span class="string" id="1350357">&#34;star&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350366">}</span>&nbsp;<span class="keyword" id="1350368">else</span>&nbsp;<span class="op" id="1350373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350378">format</span>&nbsp;<span class="op" id="1350385">=</span>&nbsp;<span class="string" id="1350387">&#34;posix&#34;</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350400">case</span>&nbsp;<span class="ident" id="1350405">magic</span>&nbsp;<span class="op" id="1350411">==</span>&nbsp;<span class="string" id="1350414">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="1350427">:</span>&nbsp;<span class="comment" id="1350429">//&nbsp;old&nbsp;GNU&nbsp;tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350446">format</span>&nbsp;<span class="op" id="1350453">=</span>&nbsp;<span class="string" id="1350455">&#34;gnu&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350466">switch</span>&nbsp;<span class="ident" id="1350473">format</span>&nbsp;<span class="op" id="1350480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350483">case</span>&nbsp;<span class="string" id="1350488">&#34;posix&#34;</span><span class="op" id="1350495">,</span>&nbsp;<span class="string" id="1350497">&#34;gnu&#34;</span><span class="op" id="1350502">,</span>&nbsp;<span class="string" id="1350504">&#34;star&#34;</span><span class="op" id="1350510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350514">hdr</span><span class="op" id="1350517">.</span><span class="ident" id="1350518">Uname</span>&nbsp;<span class="op" id="1350524">=</span>&nbsp;<span class="ident" id="1350526">cString</span><span class="op" id="1350533">(</span><span class="ident" id="1350534">s</span><span class="op" id="1350535">.</span><span class="ident" id="1350536">next</span><span class="op" id="1350540">(</span><span class="num" id="1350541">32</span><span class="op" id="1350543">)</span><span class="op" id="1350544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350548">hdr</span><span class="op" id="1350551">.</span><span class="ident" id="1350552">Gname</span>&nbsp;<span class="op" id="1350558">=</span>&nbsp;<span class="ident" id="1350560">cString</span><span class="op" id="1350567">(</span><span class="ident" id="1350568">s</span><span class="op" id="1350569">.</span><span class="ident" id="1350570">next</span><span class="op" id="1350574">(</span><span class="num" id="1350575">32</span><span class="op" id="1350577">)</span><span class="op" id="1350578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350582">devmajor</span>&nbsp;<span class="op" id="1350591">:=</span>&nbsp;<span class="ident" id="1350594">s</span><span class="op" id="1350595">.</span><span class="ident" id="1350596">next</span><span class="op" id="1350600">(</span><span class="num" id="1350601">8</span><span class="op" id="1350602">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350606">devminor</span>&nbsp;<span class="op" id="1350615">:=</span>&nbsp;<span class="ident" id="1350618">s</span><span class="op" id="1350619">.</span><span class="ident" id="1350620">next</span><span class="op" id="1350624">(</span><span class="num" id="1350625">8</span><span class="op" id="1350626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350630">if</span>&nbsp;<span class="ident" id="1350633">hdr</span><span class="op" id="1350636">.</span><span class="ident" id="1350637">Typeflag</span>&nbsp;<span class="op" id="1350646">==</span>&nbsp;<span class="ident" id="1350649">TypeChar</span>&nbsp;<span class="op" id="1350658">||</span>&nbsp;<span class="ident" id="1350661">hdr</span><span class="op" id="1350664">.</span><span class="ident" id="1350665">Typeflag</span>&nbsp;<span class="op" id="1350674">==</span>&nbsp;<span class="ident" id="1350677">TypeBlock</span>&nbsp;<span class="op" id="1350687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350692">hdr</span><span class="op" id="1350695">.</span><span class="ident" id="1350696">Devmajor</span>&nbsp;<span class="op" id="1350705">=</span>&nbsp;<span class="ident" id="1350707">tr</span><span class="op" id="1350709">.</span><span class="ident" id="1350710">octal</span><span class="op" id="1350715">(</span><span class="ident" id="1350716">devmajor</span><span class="op" id="1350724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350729">hdr</span><span class="op" id="1350732">.</span><span class="ident" id="1350733">Devminor</span>&nbsp;<span class="op" id="1350742">=</span>&nbsp;<span class="ident" id="1350744">tr</span><span class="op" id="1350746">.</span><span class="ident" id="1350747">octal</span><span class="op" id="1350752">(</span><span class="ident" id="1350753">devminor</span><span class="op" id="1350761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350765">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350769">var</span>&nbsp;<span class="ident" id="1350773">prefix</span>&nbsp;<span class="builtintype" id="1350780">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350789">switch</span>&nbsp;<span class="ident" id="1350796">format</span>&nbsp;<span class="op" id="1350803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350807">case</span>&nbsp;<span class="string" id="1350812">&#34;posix&#34;</span><span class="op" id="1350819">,</span>&nbsp;<span class="string" id="1350821">&#34;gnu&#34;</span><span class="op" id="1350826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350831">prefix</span>&nbsp;<span class="op" id="1350838">=</span>&nbsp;<span class="ident" id="1350840">cString</span><span class="op" id="1350847">(</span><span class="ident" id="1350848">s</span><span class="op" id="1350849">.</span><span class="ident" id="1350850">next</span><span class="op" id="1350854">(</span><span class="num" id="1350855">155</span><span class="op" id="1350858">)</span><span class="op" id="1350859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350863">case</span>&nbsp;<span class="string" id="1350868">&#34;star&#34;</span><span class="op" id="1350874">:</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350879">prefix</span>&nbsp;<span class="op" id="1350886">=</span>&nbsp;<span class="ident" id="1350888">cString</span><span class="op" id="1350895">(</span><span class="ident" id="1350896">s</span><span class="op" id="1350897">.</span><span class="ident" id="1350898">next</span><span class="op" id="1350902">(</span><span class="num" id="1350903">131</span><span class="op" id="1350906">)</span><span class="op" id="1350907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350912">hdr</span><span class="op" id="1350915">.</span><span class="ident" id="1350916">AccessTime</span>&nbsp;<span class="op" id="1350927">=</span>&nbsp;<span class="ident" id="1350929">time</span><span class="op" id="1350933">.</span><span class="ident" id="1350934">Unix</span><span class="op" id="1350938">(</span><span class="ident" id="1350939">tr</span><span class="op" id="1350941">.</span><span class="ident" id="1350942">octal</span><span class="op" id="1350947">(</span><span class="ident" id="1350948">s</span><span class="op" id="1350949">.</span><span class="ident" id="1350950">next</span><span class="op" id="1350954">(</span><span class="num" id="1350955">12</span><span class="op" id="1350957">)</span><span class="op" id="1350958">)</span><span class="op" id="1350959">,</span>&nbsp;<span class="num" id="1350961">0</span><span class="op" id="1350962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350967">hdr</span><span class="op" id="1350970">.</span><span class="ident" id="1350971">ChangeTime</span>&nbsp;<span class="op" id="1350982">=</span>&nbsp;<span class="ident" id="1350984">time</span><span class="op" id="1350988">.</span><span class="ident" id="1350989">Unix</span><span class="op" id="1350993">(</span><span class="ident" id="1350994">tr</span><span class="op" id="1350996">.</span><span class="ident" id="1350997">octal</span><span class="op" id="1351002">(</span><span class="ident" id="1351003">s</span><span class="op" id="1351004">.</span><span class="ident" id="1351005">next</span><span class="op" id="1351009">(</span><span class="num" id="1351010">12</span><span class="op" id="1351012">)</span><span class="op" id="1351013">)</span><span class="op" id="1351014">,</span>&nbsp;<span class="num" id="1351016">0</span><span class="op" id="1351017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351025">if</span>&nbsp;<span class="builtinfunc" id="1351028">len</span><span class="op" id="1351031">(</span><span class="ident" id="1351032">prefix</span><span class="op" id="1351038">)</span>&nbsp;<span class="op" id="1351040">&gt;</span>&nbsp;<span class="num" id="1351042">0</span>&nbsp;<span class="op" id="1351044">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351049">hdr</span><span class="op" id="1351052">.</span><span class="ident" id="1351053">Name</span>&nbsp;<span class="op" id="1351058">=</span>&nbsp;<span class="ident" id="1351060">prefix</span>&nbsp;<span class="op" id="1351067">+</span>&nbsp;<span class="string" id="1351069">&#34;/&#34;</span>&nbsp;<span class="op" id="1351073">+</span>&nbsp;<span class="ident" id="1351075">hdr</span><span class="op" id="1351078">.</span><span class="ident" id="1351079">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351093">if</span>&nbsp;<span class="ident" id="1351096">tr</span><span class="op" id="1351098">.</span><span class="ident" id="1351099">err</span>&nbsp;<span class="op" id="1351103">!=</span>&nbsp;<span class="ident" id="1351106">nil</span>&nbsp;<span class="op" id="1351110">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351114">tr</span><span class="op" id="1351116">.</span><span class="ident" id="1351117">err</span>&nbsp;<span class="op" id="1351121">=</span>&nbsp;<span class="ident" id="1351123">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351135">return</span>&nbsp;<span class="ident" id="1351142">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1351151">//&nbsp;Maximum&nbsp;value&nbsp;of&nbsp;hdr.Size&nbsp;is&nbsp;64&nbsp;GB&nbsp;(12&nbsp;octal&nbsp;digits),</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1351209">//&nbsp;so&nbsp;there&#39;s&nbsp;no&nbsp;risk&nbsp;of&nbsp;int64&nbsp;overflowing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351254">nb</span>&nbsp;<span class="op" id="1351257">:=</span>&nbsp;<span class="ident" id="1351260">int64</span><span class="op" id="1351265">(</span><span class="ident" id="1351266">hdr</span><span class="op" id="1351269">.</span><span class="ident" id="1351270">Size</span><span class="op" id="1351274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351277">tr</span><span class="op" id="1351279">.</span><span class="ident" id="1351280">pad</span>&nbsp;<span class="op" id="1351284">=</span>&nbsp;<span class="op" id="1351286">-</span><span class="ident" id="1351287">nb</span>&nbsp;<span class="op" id="1351290">&amp;</span>&nbsp;<span class="op" id="1351292">(</span><span class="ident" id="1351293">blockSize</span>&nbsp;<span class="op" id="1351303">-</span>&nbsp;<span class="num" id="1351305">1</span><span class="op" id="1351306">)</span>&nbsp;<span class="comment" id="1351308">//&nbsp;blockSize&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;two</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1351341">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351374">tr</span><span class="op" id="1351376">.</span><span class="ident" id="1351377">curr</span>&nbsp;<span class="op" id="1351382">=</span>&nbsp;<span class="op" id="1351384">&amp;</span><span class="ident" id="1351385">regFileReader</span><span class="op" id="1351398">{</span><span class="ident" id="1351399">r</span><span class="op" id="1351400">:</span>&nbsp;<span class="ident" id="1351402">tr</span><span class="op" id="1351404">.</span><span class="ident" id="1351405">r</span><span class="op" id="1351406">,</span>&nbsp;<span class="ident" id="1351408">nb</span><span class="op" id="1351410">:</span>&nbsp;<span class="ident" id="1351412">nb</span><span class="op" id="1351414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1351418">//&nbsp;Check&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351461">if</span>&nbsp;<span class="ident" id="1351464">hdr</span><span class="op" id="1351467">.</span><span class="ident" id="1351468">Typeflag</span>&nbsp;<span class="op" id="1351477">==</span>&nbsp;<span class="ident" id="1351480">TypeGNUSparse</span>&nbsp;<span class="op" id="1351494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1351498">//&nbsp;Get&nbsp;the&nbsp;real&nbsp;size&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351534">hdr</span><span class="op" id="1351537">.</span><span class="ident" id="1351538">Size</span>&nbsp;<span class="op" id="1351543">=</span>&nbsp;<span class="ident" id="1351545">tr</span><span class="op" id="1351547">.</span><span class="ident" id="1351548">octal</span><span class="op" id="1351553">(</span><span class="ident" id="1351554">header</span><span class="op" id="1351560">[</span><span class="num" id="1351561">483</span><span class="op" id="1351564">:</span><span class="num" id="1351565">495</span><span class="op" id="1351568">]</span><span class="op" id="1351569">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1351574">//&nbsp;Read&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351600">sp</span>&nbsp;<span class="op" id="1351603">:=</span>&nbsp;<span class="ident" id="1351606">tr</span><span class="op" id="1351608">.</span><span class="ident" id="1351609">readOldGNUSparseMap</span><span class="op" id="1351628">(</span><span class="ident" id="1351629">header</span><span class="op" id="1351635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351639">if</span>&nbsp;<span class="ident" id="1351642">tr</span><span class="op" id="1351644">.</span><span class="ident" id="1351645">err</span>&nbsp;<span class="op" id="1351649">!=</span>&nbsp;<span class="ident" id="1351652">nil</span>&nbsp;<span class="op" id="1351656">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351661">return</span>&nbsp;<span class="ident" id="1351668">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1351678">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;GNU&nbsp;sparse&nbsp;file.&nbsp;Update&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351750">tr</span><span class="op" id="1351752">.</span><span class="ident" id="1351753">curr</span>&nbsp;<span class="op" id="1351758">=</span>&nbsp;<span class="op" id="1351760">&amp;</span><span class="ident" id="1351761">sparseFileReader</span><span class="op" id="1351777">{</span><span class="ident" id="1351778">rfr</span><span class="op" id="1351781">:</span>&nbsp;<span class="ident" id="1351783">tr</span><span class="op" id="1351785">.</span><span class="ident" id="1351786">curr</span><span class="op" id="1351790">.</span><span class="op" id="1351791">(</span><span class="op" id="1351792">*</span><span class="ident" id="1351793">regFileReader</span><span class="op" id="1351806">)</span><span class="op" id="1351807">,</span>&nbsp;<span class="ident" id="1351809">sp</span><span class="op" id="1351811">:</span>&nbsp;<span class="ident" id="1351813">sp</span><span class="op" id="1351815">,</span>&nbsp;<span class="ident" id="1351817">tot</span><span class="op" id="1351820">:</span>&nbsp;<span class="ident" id="1351822">hdr</span><span class="op" id="1351825">.</span><span class="ident" id="1351826">Size</span><span class="op" id="1351830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351833">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351837">return</span>&nbsp;<span class="ident" id="1351844">hdr</span><br>
<span class="lineno"></span><span class="op" id="1351848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1351851">//&nbsp;A&nbsp;sparseEntry&nbsp;holds&nbsp;a&nbsp;single&nbsp;entry&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&#39;s&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">540</span><span class="comment" id="1351920">//&nbsp;A&nbsp;sparse&nbsp;entry&nbsp;indicates&nbsp;the&nbsp;offset&nbsp;and&nbsp;size&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1351990">//&nbsp;block&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="1352008">type</span>&nbsp;<span class="ident" id="1352013">sparseEntry</span>&nbsp;<span class="keyword" id="1352025">struct</span>&nbsp;<span class="op" id="1352032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352035">offset</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1352044">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352051">numBytes</span>&nbsp;<span class="ident" id="1352060">int64</span><br>
<span class="lineno">545</span><span class="op" id="1352066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1352069">//&nbsp;readOldGNUSparseMap&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;the&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="1352153">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;tar&nbsp;header&nbsp;if&nbsp;it&#39;s&nbsp;small&nbsp;enough.&nbsp;If&nbsp;it&#39;s&nbsp;larger&nbsp;than&nbsp;four&nbsp;entries,</span><br>
<span class="lineno"></span><span class="comment" id="1352255">//&nbsp;then&nbsp;one&nbsp;or&nbsp;more&nbsp;extension&nbsp;headers&nbsp;are&nbsp;used&nbsp;to&nbsp;store&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">550</span><span class="keyword" id="1352339">func</span>&nbsp;<span class="op" id="1352344">(</span><span class="ident" id="1352345">tr</span>&nbsp;<span class="op" id="1352348">*</span><span class="ident" id="1352349">Reader</span><span class="op" id="1352355">)</span>&nbsp;<span class="ident" id="1352357">readOldGNUSparseMap</span><span class="op" id="1352376">(</span><span class="ident" id="1352377">header</span>&nbsp;<span class="op" id="1352384">[</span><span class="op" id="1352385">]</span><span class="builtintype" id="1352386">byte</span><span class="op" id="1352390">)</span>&nbsp;<span class="op" id="1352392">[</span><span class="op" id="1352393">]</span><span class="ident" id="1352394">sparseEntry</span>&nbsp;<span class="op" id="1352406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352409">isExtended</span>&nbsp;<span class="op" id="1352420">:=</span>&nbsp;<span class="ident" id="1352423">header</span><span class="op" id="1352429">[</span><span class="ident" id="1352430">oldGNUSparseMainHeaderIsExtendedOffset</span><span class="op" id="1352468">]</span>&nbsp;<span class="op" id="1352470">!=</span>&nbsp;<span class="num" id="1352473">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352476">spCap</span>&nbsp;<span class="op" id="1352482">:=</span>&nbsp;<span class="ident" id="1352485">oldGNUSparseMainHeaderNumEntries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352519">if</span>&nbsp;<span class="ident" id="1352522">isExtended</span>&nbsp;<span class="op" id="1352533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352537">spCap</span>&nbsp;<span class="op" id="1352543">+=</span>&nbsp;<span class="ident" id="1352546">oldGNUSparseExtendedHeaderNumEntries</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352587">sp</span>&nbsp;<span class="op" id="1352590">:=</span>&nbsp;<span class="builtinfunc" id="1352593">make</span><span class="op" id="1352597">(</span><span class="op" id="1352598">[</span><span class="op" id="1352599">]</span><span class="ident" id="1352600">sparseEntry</span><span class="op" id="1352611">,</span>&nbsp;<span class="num" id="1352613">0</span><span class="op" id="1352614">,</span>&nbsp;<span class="ident" id="1352616">spCap</span><span class="op" id="1352621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352624">s</span>&nbsp;<span class="op" id="1352626">:=</span>&nbsp;<span class="ident" id="1352629">slicer</span><span class="op" id="1352635">(</span><span class="ident" id="1352636">header</span><span class="op" id="1352642">[</span><span class="ident" id="1352643">oldGNUSparseMainHeaderOffset</span><span class="op" id="1352671">:</span><span class="op" id="1352672">]</span><span class="op" id="1352673">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1352677">//&nbsp;Read&nbsp;the&nbsp;four&nbsp;entries&nbsp;from&nbsp;the&nbsp;main&nbsp;tar&nbsp;header</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352728">for</span>&nbsp;<span class="ident" id="1352732">i</span>&nbsp;<span class="op" id="1352734">:=</span>&nbsp;<span class="num" id="1352737">0</span><span class="op" id="1352738">;</span>&nbsp;<span class="ident" id="1352740">i</span>&nbsp;<span class="op" id="1352742">&lt;</span>&nbsp;<span class="ident" id="1352744">oldGNUSparseMainHeaderNumEntries</span><span class="op" id="1352776">;</span>&nbsp;<span class="ident" id="1352778">i</span><span class="op" id="1352779">++</span>&nbsp;<span class="op" id="1352782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352786">offset</span>&nbsp;<span class="op" id="1352793">:=</span>&nbsp;<span class="ident" id="1352796">tr</span><span class="op" id="1352798">.</span><span class="ident" id="1352799">octal</span><span class="op" id="1352804">(</span><span class="ident" id="1352805">s</span><span class="op" id="1352806">.</span><span class="ident" id="1352807">next</span><span class="op" id="1352811">(</span><span class="ident" id="1352812">oldGNUSparseOffsetSize</span><span class="op" id="1352834">)</span><span class="op" id="1352835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352839">numBytes</span>&nbsp;<span class="op" id="1352848">:=</span>&nbsp;<span class="ident" id="1352851">tr</span><span class="op" id="1352853">.</span><span class="ident" id="1352854">octal</span><span class="op" id="1352859">(</span><span class="ident" id="1352860">s</span><span class="op" id="1352861">.</span><span class="ident" id="1352862">next</span><span class="op" id="1352866">(</span><span class="ident" id="1352867">oldGNUSparseNumBytesSize</span><span class="op" id="1352891">)</span><span class="op" id="1352892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352896">if</span>&nbsp;<span class="ident" id="1352899">tr</span><span class="op" id="1352901">.</span><span class="ident" id="1352902">err</span>&nbsp;<span class="op" id="1352906">!=</span>&nbsp;<span class="ident" id="1352909">nil</span>&nbsp;<span class="op" id="1352913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352918">tr</span><span class="op" id="1352920">.</span><span class="ident" id="1352921">err</span>&nbsp;<span class="op" id="1352925">=</span>&nbsp;<span class="ident" id="1352927">ErrHeader</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352940">return</span>&nbsp;<span class="ident" id="1352947">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352957">if</span>&nbsp;<span class="ident" id="1352960">offset</span>&nbsp;<span class="op" id="1352967">==</span>&nbsp;<span class="num" id="1352970">0</span>&nbsp;<span class="op" id="1352972">&amp;&amp;</span>&nbsp;<span class="ident" id="1352975">numBytes</span>&nbsp;<span class="op" id="1352984">==</span>&nbsp;<span class="num" id="1352987">0</span>&nbsp;<span class="op" id="1352989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352994">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353002">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353006">sp</span>&nbsp;<span class="op" id="1353009">=</span>&nbsp;<span class="builtinfunc" id="1353011">append</span><span class="op" id="1353017">(</span><span class="ident" id="1353018">sp</span><span class="op" id="1353020">,</span>&nbsp;<span class="ident" id="1353022">sparseEntry</span><span class="op" id="1353033">{</span><span class="ident" id="1353034">offset</span><span class="op" id="1353040">:</span>&nbsp;<span class="ident" id="1353042">offset</span><span class="op" id="1353048">,</span>&nbsp;<span class="ident" id="1353050">numBytes</span><span class="op" id="1353058">:</span>&nbsp;<span class="ident" id="1353060">numBytes</span><span class="op" id="1353068">}</span><span class="op" id="1353069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353076">for</span>&nbsp;<span class="ident" id="1353080">isExtended</span>&nbsp;<span class="op" id="1353091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1353095">//&nbsp;There&nbsp;are&nbsp;more&nbsp;entries.&nbsp;Read&nbsp;an&nbsp;extension&nbsp;header&nbsp;and&nbsp;parse&nbsp;its&nbsp;entries.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353172">sparseHeader</span>&nbsp;<span class="op" id="1353185">:=</span>&nbsp;<span class="builtinfunc" id="1353188">make</span><span class="op" id="1353192">(</span><span class="op" id="1353193">[</span><span class="op" id="1353194">]</span><span class="builtintype" id="1353195">byte</span><span class="op" id="1353199">,</span>&nbsp;<span class="ident" id="1353201">blockSize</span><span class="op" id="1353210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353214">if</span>&nbsp;<span class="ident" id="1353217">_</span><span class="op" id="1353218">,</span>&nbsp;<span class="ident" id="1353220">tr</span><span class="op" id="1353222">.</span><span class="ident" id="1353223">err</span>&nbsp;<span class="op" id="1353227">=</span>&nbsp;<span class="ident" id="1353229">io</span><span class="op" id="1353231">.</span><span class="ident" id="1353232">ReadFull</span><span class="op" id="1353240">(</span><span class="ident" id="1353241">tr</span><span class="op" id="1353243">.</span><span class="ident" id="1353244">r</span><span class="op" id="1353245">,</span>&nbsp;<span class="ident" id="1353247">sparseHeader</span><span class="op" id="1353259">)</span><span class="op" id="1353260">;</span>&nbsp;<span class="ident" id="1353262">tr</span><span class="op" id="1353264">.</span><span class="ident" id="1353265">err</span>&nbsp;<span class="op" id="1353269">!=</span>&nbsp;<span class="ident" id="1353272">nil</span>&nbsp;<span class="op" id="1353276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353281">return</span>&nbsp;<span class="ident" id="1353288">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353298">isExtended</span>&nbsp;<span class="op" id="1353309">=</span>&nbsp;<span class="ident" id="1353311">sparseHeader</span><span class="op" id="1353323">[</span><span class="ident" id="1353324">oldGNUSparseExtendedHeaderIsExtendedOffset</span><span class="op" id="1353366">]</span>&nbsp;<span class="op" id="1353368">!=</span>&nbsp;<span class="num" id="1353371">0</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353375">s</span>&nbsp;<span class="op" id="1353377">=</span>&nbsp;<span class="ident" id="1353379">slicer</span><span class="op" id="1353385">(</span><span class="ident" id="1353386">sparseHeader</span><span class="op" id="1353398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353402">for</span>&nbsp;<span class="ident" id="1353406">i</span>&nbsp;<span class="op" id="1353408">:=</span>&nbsp;<span class="num" id="1353411">0</span><span class="op" id="1353412">;</span>&nbsp;<span class="ident" id="1353414">i</span>&nbsp;<span class="op" id="1353416">&lt;</span>&nbsp;<span class="ident" id="1353418">oldGNUSparseExtendedHeaderNumEntries</span><span class="op" id="1353454">;</span>&nbsp;<span class="ident" id="1353456">i</span><span class="op" id="1353457">++</span>&nbsp;<span class="op" id="1353460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353465">offset</span>&nbsp;<span class="op" id="1353472">:=</span>&nbsp;<span class="ident" id="1353475">tr</span><span class="op" id="1353477">.</span><span class="ident" id="1353478">octal</span><span class="op" id="1353483">(</span><span class="ident" id="1353484">s</span><span class="op" id="1353485">.</span><span class="ident" id="1353486">next</span><span class="op" id="1353490">(</span><span class="ident" id="1353491">oldGNUSparseOffsetSize</span><span class="op" id="1353513">)</span><span class="op" id="1353514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353519">numBytes</span>&nbsp;<span class="op" id="1353528">:=</span>&nbsp;<span class="ident" id="1353531">tr</span><span class="op" id="1353533">.</span><span class="ident" id="1353534">octal</span><span class="op" id="1353539">(</span><span class="ident" id="1353540">s</span><span class="op" id="1353541">.</span><span class="ident" id="1353542">next</span><span class="op" id="1353546">(</span><span class="ident" id="1353547">oldGNUSparseNumBytesSize</span><span class="op" id="1353571">)</span><span class="op" id="1353572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353577">if</span>&nbsp;<span class="ident" id="1353580">tr</span><span class="op" id="1353582">.</span><span class="ident" id="1353583">err</span>&nbsp;<span class="op" id="1353587">!=</span>&nbsp;<span class="ident" id="1353590">nil</span>&nbsp;<span class="op" id="1353594">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353600">tr</span><span class="op" id="1353602">.</span><span class="ident" id="1353603">err</span>&nbsp;<span class="op" id="1353607">=</span>&nbsp;<span class="ident" id="1353609">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353623">return</span>&nbsp;<span class="ident" id="1353630">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353642">if</span>&nbsp;<span class="ident" id="1353645">offset</span>&nbsp;<span class="op" id="1353652">==</span>&nbsp;<span class="num" id="1353655">0</span>&nbsp;<span class="op" id="1353657">&amp;&amp;</span>&nbsp;<span class="ident" id="1353660">numBytes</span>&nbsp;<span class="op" id="1353669">==</span>&nbsp;<span class="num" id="1353672">0</span>&nbsp;<span class="op" id="1353674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353680">break</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353694">sp</span>&nbsp;<span class="op" id="1353697">=</span>&nbsp;<span class="builtinfunc" id="1353699">append</span><span class="op" id="1353705">(</span><span class="ident" id="1353706">sp</span><span class="op" id="1353708">,</span>&nbsp;<span class="ident" id="1353710">sparseEntry</span><span class="op" id="1353721">{</span><span class="ident" id="1353722">offset</span><span class="op" id="1353728">:</span>&nbsp;<span class="ident" id="1353730">offset</span><span class="op" id="1353736">,</span>&nbsp;<span class="ident" id="1353738">numBytes</span><span class="op" id="1353746">:</span>&nbsp;<span class="ident" id="1353748">numBytes</span><span class="op" id="1353756">}</span><span class="op" id="1353757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353767">return</span>&nbsp;<span class="ident" id="1353774">sp</span><br>
<span class="lineno">595</span><span class="op" id="1353777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1353780">//&nbsp;readGNUSparseMap1x0&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;1.0.</span><br>
<span class="lineno"></span><span class="comment" id="1353874">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;just&nbsp;before&nbsp;the&nbsp;file&nbsp;data&nbsp;and&nbsp;padded&nbsp;out&nbsp;to&nbsp;the&nbsp;nearest&nbsp;block&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="1353974">func</span>&nbsp;<span class="ident" id="1353979">readGNUSparseMap1x0</span><span class="op" id="1353998">(</span><span class="ident" id="1353999">r</span>&nbsp;<span class="ident" id="1354001">io</span><span class="op" id="1354003">.</span><span class="ident" id="1354004">Reader</span><span class="op" id="1354010">)</span>&nbsp;<span class="op" id="1354012">(</span><span class="op" id="1354013">[</span><span class="op" id="1354014">]</span><span class="ident" id="1354015">sparseEntry</span><span class="op" id="1354026">,</span>&nbsp;<span class="builtintype" id="1354028">error</span><span class="op" id="1354033">)</span>&nbsp;<span class="op" id="1354035">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354038">buf</span>&nbsp;<span class="op" id="1354042">:=</span>&nbsp;<span class="builtinfunc" id="1354045">make</span><span class="op" id="1354049">(</span><span class="op" id="1354050">[</span><span class="op" id="1354051">]</span><span class="builtintype" id="1354052">byte</span><span class="op" id="1354056">,</span>&nbsp;<span class="num" id="1354058">2</span><span class="op" id="1354059">*</span><span class="ident" id="1354060">blockSize</span><span class="op" id="1354069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354072">sparseHeader</span>&nbsp;<span class="op" id="1354085">:=</span>&nbsp;<span class="ident" id="1354088">buf</span><span class="op" id="1354091">[</span><span class="op" id="1354092">:</span><span class="ident" id="1354093">blockSize</span><span class="op" id="1354102">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1354106">//&nbsp;readDecimal&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;to&nbsp;read&nbsp;a&nbsp;decimal&nbsp;integer&nbsp;from&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1354189">//&nbsp;while&nbsp;making&nbsp;sure&nbsp;to&nbsp;read&nbsp;from&nbsp;the&nbsp;file&nbsp;in&nbsp;blocks&nbsp;of&nbsp;size&nbsp;blockSize</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354261">readDecimal</span>&nbsp;<span class="op" id="1354273">:=</span>&nbsp;<span class="keyword" id="1354276">func</span><span class="op" id="1354280">(</span><span class="op" id="1354281">)</span>&nbsp;<span class="op" id="1354283">(</span><span class="ident" id="1354284">int64</span><span class="op" id="1354289">,</span>&nbsp;<span class="builtintype" id="1354291">error</span><span class="op" id="1354296">)</span>&nbsp;<span class="op" id="1354298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1354302">//&nbsp;Look&nbsp;for&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354324">nl</span>&nbsp;<span class="op" id="1354327">:=</span>&nbsp;<span class="ident" id="1354330">bytes</span><span class="op" id="1354335">.</span><span class="ident" id="1354336">IndexByte</span><span class="op" id="1354345">(</span><span class="ident" id="1354346">sparseHeader</span><span class="op" id="1354358">,</span>&nbsp;<span class="string" id="1354360">&#39;\n&#39;</span><span class="op" id="1354364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354368">if</span>&nbsp;<span class="ident" id="1354371">nl</span>&nbsp;<span class="op" id="1354374">==</span>&nbsp;<span class="op" id="1354377">-</span><span class="num" id="1354378">1</span>&nbsp;<span class="op" id="1354380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354385">if</span>&nbsp;<span class="builtinfunc" id="1354388">len</span><span class="op" id="1354391">(</span><span class="ident" id="1354392">sparseHeader</span><span class="op" id="1354404">)</span>&nbsp;<span class="op" id="1354406">&gt;=</span>&nbsp;<span class="ident" id="1354409">blockSize</span>&nbsp;<span class="op" id="1354419">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1354425">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354449">return</span>&nbsp;<span class="num" id="1354456">0</span><span class="op" id="1354457">,</span>&nbsp;<span class="ident" id="1354459">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354477">oldLen</span>&nbsp;<span class="op" id="1354484">:=</span>&nbsp;<span class="builtinfunc" id="1354487">len</span><span class="op" id="1354490">(</span><span class="ident" id="1354491">sparseHeader</span><span class="op" id="1354503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354508">newLen</span>&nbsp;<span class="op" id="1354515">:=</span>&nbsp;<span class="ident" id="1354518">oldLen</span>&nbsp;<span class="op" id="1354525">+</span>&nbsp;<span class="ident" id="1354527">blockSize</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354540">if</span>&nbsp;<span class="builtinfunc" id="1354543">cap</span><span class="op" id="1354546">(</span><span class="ident" id="1354547">sparseHeader</span><span class="op" id="1354559">)</span>&nbsp;<span class="op" id="1354561">&lt;</span>&nbsp;<span class="ident" id="1354563">newLen</span>&nbsp;<span class="op" id="1354570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1354576">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;the&nbsp;next&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1354648">copy</span><span class="op" id="1354652">(</span><span class="ident" id="1354653">buf</span><span class="op" id="1354656">,</span>&nbsp;<span class="ident" id="1354658">sparseHeader</span><span class="op" id="1354670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354676">sparseHeader</span>&nbsp;<span class="op" id="1354689">=</span>&nbsp;<span class="ident" id="1354691">buf</span><span class="op" id="1354694">[</span><span class="op" id="1354695">:</span><span class="ident" id="1354696">newLen</span><span class="op" id="1354702">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354707">}</span>&nbsp;<span class="keyword" id="1354709">else</span>&nbsp;<span class="op" id="1354714">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1354720">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;and&nbsp;we&nbsp;can&nbsp;just&nbsp;reslice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354772">sparseHeader</span>&nbsp;<span class="op" id="1354785">=</span>&nbsp;<span class="ident" id="1354787">sparseHeader</span><span class="op" id="1354799">[</span><span class="op" id="1354800">:</span><span class="ident" id="1354801">newLen</span><span class="op" id="1354807">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1354818">//&nbsp;Now&nbsp;that&nbsp;sparseHeader&nbsp;is&nbsp;large&nbsp;enough,&nbsp;read&nbsp;next&nbsp;block</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354879">if</span>&nbsp;<span class="ident" id="1354882">_</span><span class="op" id="1354883">,</span>&nbsp;<span class="ident" id="1354885">err</span>&nbsp;<span class="op" id="1354889">:=</span>&nbsp;<span class="ident" id="1354892">io</span><span class="op" id="1354894">.</span><span class="ident" id="1354895">ReadFull</span><span class="op" id="1354903">(</span><span class="ident" id="1354904">r</span><span class="op" id="1354905">,</span>&nbsp;<span class="ident" id="1354907">sparseHeader</span><span class="op" id="1354919">[</span><span class="ident" id="1354920">oldLen</span><span class="op" id="1354926">:</span><span class="ident" id="1354927">newLen</span><span class="op" id="1354933">]</span><span class="op" id="1354934">)</span><span class="op" id="1354935">;</span>&nbsp;<span class="ident" id="1354937">err</span>&nbsp;<span class="op" id="1354941">!=</span>&nbsp;<span class="ident" id="1354944">nil</span>&nbsp;<span class="op" id="1354948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354954">return</span>&nbsp;<span class="num" id="1354961">0</span><span class="op" id="1354962">,</span>&nbsp;<span class="ident" id="1354964">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1354977">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;newline&nbsp;in&nbsp;the&nbsp;new&nbsp;data</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355018">nl</span>&nbsp;<span class="op" id="1355021">=</span>&nbsp;<span class="ident" id="1355023">bytes</span><span class="op" id="1355028">.</span><span class="ident" id="1355029">IndexByte</span><span class="op" id="1355038">(</span><span class="ident" id="1355039">sparseHeader</span><span class="op" id="1355051">[</span><span class="ident" id="1355052">oldLen</span><span class="op" id="1355058">:</span><span class="ident" id="1355059">newLen</span><span class="op" id="1355065">]</span><span class="op" id="1355066">,</span>&nbsp;<span class="string" id="1355068">&#39;\n&#39;</span><span class="op" id="1355072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355077">if</span>&nbsp;<span class="ident" id="1355080">nl</span>&nbsp;<span class="op" id="1355083">==</span>&nbsp;<span class="op" id="1355086">-</span><span class="num" id="1355087">1</span>&nbsp;<span class="op" id="1355089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1355095">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355119">return</span>&nbsp;<span class="num" id="1355126">0</span><span class="op" id="1355127">,</span>&nbsp;<span class="ident" id="1355129">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355142">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355147">nl</span>&nbsp;<span class="op" id="1355150">+=</span>&nbsp;<span class="ident" id="1355153">oldLen</span>&nbsp;<span class="comment" id="1355160">//&nbsp;We&nbsp;want&nbsp;the&nbsp;position&nbsp;from&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1355209">//&nbsp;Now&nbsp;that&nbsp;we&#39;ve&nbsp;found&nbsp;a&nbsp;newline,&nbsp;read&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355260">n</span><span class="op" id="1355261">,</span>&nbsp;<span class="ident" id="1355263">err</span>&nbsp;<span class="op" id="1355267">:=</span>&nbsp;<span class="ident" id="1355270">strconv</span><span class="op" id="1355277">.</span><span class="ident" id="1355278">ParseInt</span><span class="op" id="1355286">(</span><span class="builtintype" id="1355287">string</span><span class="op" id="1355293">(</span><span class="ident" id="1355294">sparseHeader</span><span class="op" id="1355306">[</span><span class="op" id="1355307">:</span><span class="ident" id="1355308">nl</span><span class="op" id="1355310">]</span><span class="op" id="1355311">)</span><span class="op" id="1355312">,</span>&nbsp;<span class="num" id="1355314">10</span><span class="op" id="1355316">,</span>&nbsp;<span class="num" id="1355318">0</span><span class="op" id="1355319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355323">if</span>&nbsp;<span class="ident" id="1355326">err</span>&nbsp;<span class="op" id="1355330">!=</span>&nbsp;<span class="ident" id="1355333">nil</span>&nbsp;<span class="op" id="1355337">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355342">return</span>&nbsp;<span class="num" id="1355349">0</span><span class="op" id="1355350">,</span>&nbsp;<span class="ident" id="1355352">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1355369">//&nbsp;Update&nbsp;sparseHeader&nbsp;to&nbsp;consume&nbsp;this&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355417">sparseHeader</span>&nbsp;<span class="op" id="1355430">=</span>&nbsp;<span class="ident" id="1355432">sparseHeader</span><span class="op" id="1355444">[</span><span class="ident" id="1355445">nl</span><span class="op" id="1355447">+</span><span class="num" id="1355448">1</span><span class="op" id="1355449">:</span><span class="op" id="1355450">]</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355454">return</span>&nbsp;<span class="ident" id="1355461">n</span><span class="op" id="1355462">,</span>&nbsp;<span class="ident" id="1355464">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1355473">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355498">if</span>&nbsp;<span class="ident" id="1355501">_</span><span class="op" id="1355502">,</span>&nbsp;<span class="ident" id="1355504">err</span>&nbsp;<span class="op" id="1355508">:=</span>&nbsp;<span class="ident" id="1355511">io</span><span class="op" id="1355513">.</span><span class="ident" id="1355514">ReadFull</span><span class="op" id="1355522">(</span><span class="ident" id="1355523">r</span><span class="op" id="1355524">,</span>&nbsp;<span class="ident" id="1355526">sparseHeader</span><span class="op" id="1355538">)</span><span class="op" id="1355539">;</span>&nbsp;<span class="ident" id="1355541">err</span>&nbsp;<span class="op" id="1355545">!=</span>&nbsp;<span class="ident" id="1355548">nil</span>&nbsp;<span class="op" id="1355552">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355556">return</span>&nbsp;<span class="ident" id="1355563">nil</span><span class="op" id="1355566">,</span>&nbsp;<span class="ident" id="1355568">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1355577">//&nbsp;The&nbsp;first&nbsp;line&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355627">numEntries</span><span class="op" id="1355637">,</span>&nbsp;<span class="ident" id="1355639">err</span>&nbsp;<span class="op" id="1355643">:=</span>&nbsp;<span class="ident" id="1355646">readDecimal</span><span class="op" id="1355657">(</span><span class="op" id="1355658">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355661">if</span>&nbsp;<span class="ident" id="1355664">err</span>&nbsp;<span class="op" id="1355668">!=</span>&nbsp;<span class="ident" id="1355671">nil</span>&nbsp;<span class="op" id="1355675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355679">return</span>&nbsp;<span class="ident" id="1355686">nil</span><span class="op" id="1355689">,</span>&nbsp;<span class="ident" id="1355691">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1355700">//&nbsp;Read&nbsp;all&nbsp;the&nbsp;entries</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355725">sp</span>&nbsp;<span class="op" id="1355728">:=</span>&nbsp;<span class="builtinfunc" id="1355731">make</span><span class="op" id="1355735">(</span><span class="op" id="1355736">[</span><span class="op" id="1355737">]</span><span class="ident" id="1355738">sparseEntry</span><span class="op" id="1355749">,</span>&nbsp;<span class="num" id="1355751">0</span><span class="op" id="1355752">,</span>&nbsp;<span class="ident" id="1355754">numEntries</span><span class="op" id="1355764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355767">for</span>&nbsp;<span class="ident" id="1355771">i</span>&nbsp;<span class="op" id="1355773">:=</span>&nbsp;<span class="ident" id="1355776">int64</span><span class="op" id="1355781">(</span><span class="num" id="1355782">0</span><span class="op" id="1355783">)</span><span class="op" id="1355784">;</span>&nbsp;<span class="ident" id="1355786">i</span>&nbsp;<span class="op" id="1355788">&lt;</span>&nbsp;<span class="ident" id="1355790">numEntries</span><span class="op" id="1355800">;</span>&nbsp;<span class="ident" id="1355802">i</span><span class="op" id="1355803">++</span>&nbsp;<span class="op" id="1355806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1355810">//&nbsp;Read&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355831">offset</span><span class="op" id="1355837">,</span>&nbsp;<span class="ident" id="1355839">err</span>&nbsp;<span class="op" id="1355843">:=</span>&nbsp;<span class="ident" id="1355846">readDecimal</span><span class="op" id="1355857">(</span><span class="op" id="1355858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355862">if</span>&nbsp;<span class="ident" id="1355865">err</span>&nbsp;<span class="op" id="1355869">!=</span>&nbsp;<span class="ident" id="1355872">nil</span>&nbsp;<span class="op" id="1355876">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355881">return</span>&nbsp;<span class="ident" id="1355888">nil</span><span class="op" id="1355891">,</span>&nbsp;<span class="ident" id="1355893">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1355903">//&nbsp;Read&nbsp;numBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355922">numBytes</span><span class="op" id="1355930">,</span>&nbsp;<span class="ident" id="1355932">err</span>&nbsp;<span class="op" id="1355936">:=</span>&nbsp;<span class="ident" id="1355939">readDecimal</span><span class="op" id="1355950">(</span><span class="op" id="1355951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355955">if</span>&nbsp;<span class="ident" id="1355958">err</span>&nbsp;<span class="op" id="1355962">!=</span>&nbsp;<span class="ident" id="1355965">nil</span>&nbsp;<span class="op" id="1355969">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355974">return</span>&nbsp;<span class="ident" id="1355981">nil</span><span class="op" id="1355984">,</span>&nbsp;<span class="ident" id="1355986">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355997">sp</span>&nbsp;<span class="op" id="1356000">=</span>&nbsp;<span class="builtinfunc" id="1356002">append</span><span class="op" id="1356008">(</span><span class="ident" id="1356009">sp</span><span class="op" id="1356011">,</span>&nbsp;<span class="ident" id="1356013">sparseEntry</span><span class="op" id="1356024">{</span><span class="ident" id="1356025">offset</span><span class="op" id="1356031">:</span>&nbsp;<span class="ident" id="1356033">offset</span><span class="op" id="1356039">,</span>&nbsp;<span class="ident" id="1356041">numBytes</span><span class="op" id="1356049">:</span>&nbsp;<span class="ident" id="1356051">numBytes</span><span class="op" id="1356059">}</span><span class="op" id="1356060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1356063">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356067">return</span>&nbsp;<span class="ident" id="1356074">sp</span><span class="op" id="1356076">,</span>&nbsp;<span class="ident" id="1356078">nil</span><br>
<span class="lineno"></span><span class="op" id="1356082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1356085">//&nbsp;readGNUSparseMap0x1&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;0.1.</span><br>
<span class="lineno">680</span><span class="comment" id="1356179">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="1356227">func</span>&nbsp;<span class="ident" id="1356232">readGNUSparseMap0x1</span><span class="op" id="1356251">(</span><span class="ident" id="1356252">headers</span>&nbsp;<span class="keyword" id="1356260">map</span><span class="op" id="1356263">[</span><span class="builtintype" id="1356264">string</span><span class="op" id="1356270">]</span><span class="builtintype" id="1356271">string</span><span class="op" id="1356277">)</span>&nbsp;<span class="op" id="1356279">(</span><span class="op" id="1356280">[</span><span class="op" id="1356281">]</span><span class="ident" id="1356282">sparseEntry</span><span class="op" id="1356293">,</span>&nbsp;<span class="builtintype" id="1356295">error</span><span class="op" id="1356300">)</span>&nbsp;<span class="op" id="1356302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1356305">//&nbsp;Get&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1356331">numEntriesStr</span><span class="op" id="1356344">,</span>&nbsp;<span class="ident" id="1356346">ok</span>&nbsp;<span class="op" id="1356349">:=</span>&nbsp;<span class="ident" id="1356352">headers</span><span class="op" id="1356359">[</span><span class="ident" id="1356360">paxGNUSparseNumBlocks</span><span class="op" id="1356381">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356384">if</span>&nbsp;<span class="op" id="1356387">!</span><span class="ident" id="1356388">ok</span>&nbsp;<span class="op" id="1356391">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356395">return</span>&nbsp;<span class="ident" id="1356402">nil</span><span class="op" id="1356405">,</span>&nbsp;<span class="ident" id="1356407">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1356418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1356421">numEntries</span><span class="op" id="1356431">,</span>&nbsp;<span class="ident" id="1356433">err</span>&nbsp;<span class="op" id="1356437">:=</span>&nbsp;<span class="ident" id="1356440">strconv</span><span class="op" id="1356447">.</span><span class="ident" id="1356448">ParseInt</span><span class="op" id="1356456">(</span><span class="ident" id="1356457">numEntriesStr</span><span class="op" id="1356470">,</span>&nbsp;<span class="num" id="1356472">10</span><span class="op" id="1356474">,</span>&nbsp;<span class="num" id="1356476">0</span><span class="op" id="1356477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356480">if</span>&nbsp;<span class="ident" id="1356483">err</span>&nbsp;<span class="op" id="1356487">!=</span>&nbsp;<span class="ident" id="1356490">nil</span>&nbsp;<span class="op" id="1356494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356498">return</span>&nbsp;<span class="ident" id="1356505">nil</span><span class="op" id="1356508">,</span>&nbsp;<span class="ident" id="1356510">ErrHeader</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1356521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1356525">sparseMap</span>&nbsp;<span class="op" id="1356535">:=</span>&nbsp;<span class="ident" id="1356538">strings</span><span class="op" id="1356545">.</span><span class="ident" id="1356546">Split</span><span class="op" id="1356551">(</span><span class="ident" id="1356552">headers</span><span class="op" id="1356559">[</span><span class="ident" id="1356560">paxGNUSparseMap</span><span class="op" id="1356575">]</span><span class="op" id="1356576">,</span>&nbsp;<span class="string" id="1356578">&#34;,&#34;</span><span class="op" id="1356581">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1356585">//&nbsp;There&nbsp;should&nbsp;be&nbsp;two&nbsp;numbers&nbsp;in&nbsp;sparseMap&nbsp;for&nbsp;each&nbsp;entry</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356645">if</span>&nbsp;<span class="ident" id="1356648">int64</span><span class="op" id="1356653">(</span><span class="builtinfunc" id="1356654">len</span><span class="op" id="1356657">(</span><span class="ident" id="1356658">sparseMap</span><span class="op" id="1356667">)</span><span class="op" id="1356668">)</span>&nbsp;<span class="op" id="1356670">!=</span>&nbsp;<span class="num" id="1356673">2</span><span class="op" id="1356674">*</span><span class="ident" id="1356675">numEntries</span>&nbsp;<span class="op" id="1356686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356690">return</span>&nbsp;<span class="ident" id="1356697">nil</span><span class="op" id="1356700">,</span>&nbsp;<span class="ident" id="1356702">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1356713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1356717">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;entries&nbsp;in&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1356764">sp</span>&nbsp;<span class="op" id="1356767">:=</span>&nbsp;<span class="builtinfunc" id="1356770">make</span><span class="op" id="1356774">(</span><span class="op" id="1356775">[</span><span class="op" id="1356776">]</span><span class="ident" id="1356777">sparseEntry</span><span class="op" id="1356788">,</span>&nbsp;<span class="num" id="1356790">0</span><span class="op" id="1356791">,</span>&nbsp;<span class="ident" id="1356793">numEntries</span><span class="op" id="1356803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356806">for</span>&nbsp;<span class="ident" id="1356810">i</span>&nbsp;<span class="op" id="1356812">:=</span>&nbsp;<span class="ident" id="1356815">int64</span><span class="op" id="1356820">(</span><span class="num" id="1356821">0</span><span class="op" id="1356822">)</span><span class="op" id="1356823">;</span>&nbsp;<span class="ident" id="1356825">i</span>&nbsp;<span class="op" id="1356827">&lt;</span>&nbsp;<span class="ident" id="1356829">numEntries</span><span class="op" id="1356839">;</span>&nbsp;<span class="ident" id="1356841">i</span><span class="op" id="1356842">++</span>&nbsp;<span class="op" id="1356845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1356849">offset</span><span class="op" id="1356855">,</span>&nbsp;<span class="ident" id="1356857">err</span>&nbsp;<span class="op" id="1356861">:=</span>&nbsp;<span class="ident" id="1356864">strconv</span><span class="op" id="1356871">.</span><span class="ident" id="1356872">ParseInt</span><span class="op" id="1356880">(</span><span class="ident" id="1356881">sparseMap</span><span class="op" id="1356890">[</span><span class="num" id="1356891">2</span><span class="op" id="1356892">*</span><span class="ident" id="1356893">i</span><span class="op" id="1356894">]</span><span class="op" id="1356895">,</span>&nbsp;<span class="num" id="1356897">10</span><span class="op" id="1356899">,</span>&nbsp;<span class="num" id="1356901">0</span><span class="op" id="1356902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356906">if</span>&nbsp;<span class="ident" id="1356909">err</span>&nbsp;<span class="op" id="1356913">!=</span>&nbsp;<span class="ident" id="1356916">nil</span>&nbsp;<span class="op" id="1356920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356925">return</span>&nbsp;<span class="ident" id="1356932">nil</span><span class="op" id="1356935">,</span>&nbsp;<span class="ident" id="1356937">ErrHeader</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1356949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1356953">numBytes</span><span class="op" id="1356961">,</span>&nbsp;<span class="ident" id="1356963">err</span>&nbsp;<span class="op" id="1356967">:=</span>&nbsp;<span class="ident" id="1356970">strconv</span><span class="op" id="1356977">.</span><span class="ident" id="1356978">ParseInt</span><span class="op" id="1356986">(</span><span class="ident" id="1356987">sparseMap</span><span class="op" id="1356996">[</span><span class="num" id="1356997">2</span><span class="op" id="1356998">*</span><span class="ident" id="1356999">i</span><span class="op" id="1357000">+</span><span class="num" id="1357001">1</span><span class="op" id="1357002">]</span><span class="op" id="1357003">,</span>&nbsp;<span class="num" id="1357005">10</span><span class="op" id="1357007">,</span>&nbsp;<span class="num" id="1357009">0</span><span class="op" id="1357010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357014">if</span>&nbsp;<span class="ident" id="1357017">err</span>&nbsp;<span class="op" id="1357021">!=</span>&nbsp;<span class="ident" id="1357024">nil</span>&nbsp;<span class="op" id="1357028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357033">return</span>&nbsp;<span class="ident" id="1357040">nil</span><span class="op" id="1357043">,</span>&nbsp;<span class="ident" id="1357045">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357057">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357061">sp</span>&nbsp;<span class="op" id="1357064">=</span>&nbsp;<span class="builtinfunc" id="1357066">append</span><span class="op" id="1357072">(</span><span class="ident" id="1357073">sp</span><span class="op" id="1357075">,</span>&nbsp;<span class="ident" id="1357077">sparseEntry</span><span class="op" id="1357088">{</span><span class="ident" id="1357089">offset</span><span class="op" id="1357095">:</span>&nbsp;<span class="ident" id="1357097">offset</span><span class="op" id="1357103">,</span>&nbsp;<span class="ident" id="1357105">numBytes</span><span class="op" id="1357113">:</span>&nbsp;<span class="ident" id="1357115">numBytes</span><span class="op" id="1357123">}</span><span class="op" id="1357124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357131">return</span>&nbsp;<span class="ident" id="1357138">sp</span><span class="op" id="1357140">,</span>&nbsp;<span class="ident" id="1357142">nil</span><br>
<span class="lineno"></span><span class="op" id="1357146">}</span><br>
<span class="lineno">715</span><br>
<span class="lineno"></span><span class="comment" id="1357149">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;current&nbsp;file&#39;s&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="1357230">//&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;or&nbsp;0&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;current&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="1357287">func</span>&nbsp;<span class="op" id="1357292">(</span><span class="ident" id="1357293">tr</span>&nbsp;<span class="op" id="1357296">*</span><span class="ident" id="1357297">Reader</span><span class="op" id="1357303">)</span>&nbsp;<span class="ident" id="1357305">numBytes</span><span class="op" id="1357313">(</span><span class="op" id="1357314">)</span>&nbsp;<span class="ident" id="1357316">int64</span>&nbsp;<span class="op" id="1357322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357325">if</span>&nbsp;<span class="ident" id="1357328">tr</span><span class="op" id="1357330">.</span><span class="ident" id="1357331">curr</span>&nbsp;<span class="op" id="1357336">==</span>&nbsp;<span class="ident" id="1357339">nil</span>&nbsp;<span class="op" id="1357343">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1357347">//&nbsp;No&nbsp;current&nbsp;file,&nbsp;so&nbsp;no&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357381">return</span>&nbsp;<span class="num" id="1357388">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357394">return</span>&nbsp;<span class="ident" id="1357401">tr</span><span class="op" id="1357403">.</span><span class="ident" id="1357404">curr</span><span class="op" id="1357408">.</span><span class="ident" id="1357409">numBytes</span><span class="op" id="1357417">(</span><span class="op" id="1357418">)</span><br>
<span class="lineno"></span><span class="op" id="1357420">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="1357423">//&nbsp;Read&nbsp;reads&nbsp;from&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="1357480">//&nbsp;It&nbsp;returns&nbsp;0,&nbsp;io.EOF&nbsp;when&nbsp;it&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;that&nbsp;entry,</span><br>
<span class="lineno"></span><span class="comment" id="1357543">//&nbsp;until&nbsp;Next&nbsp;is&nbsp;called&nbsp;to&nbsp;advance&nbsp;to&nbsp;the&nbsp;next&nbsp;entry.</span><br>
<span class="lineno"></span><span class="keyword" id="1357597">func</span>&nbsp;<span class="op" id="1357602">(</span><span class="ident" id="1357603">tr</span>&nbsp;<span class="op" id="1357606">*</span><span class="ident" id="1357607">Reader</span><span class="op" id="1357613">)</span>&nbsp;<span class="ident" id="1357615">Read</span><span class="op" id="1357619">(</span><span class="ident" id="1357620">b</span>&nbsp;<span class="op" id="1357622">[</span><span class="op" id="1357623">]</span><span class="builtintype" id="1357624">byte</span><span class="op" id="1357628">)</span>&nbsp;<span class="op" id="1357630">(</span><span class="ident" id="1357631">n</span>&nbsp;<span class="builtintype" id="1357633">int</span><span class="op" id="1357636">,</span>&nbsp;<span class="ident" id="1357638">err</span>&nbsp;<span class="builtintype" id="1357642">error</span><span class="op" id="1357647">)</span>&nbsp;<span class="op" id="1357649">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357652">if</span>&nbsp;<span class="ident" id="1357655">tr</span><span class="op" id="1357657">.</span><span class="ident" id="1357658">curr</span>&nbsp;<span class="op" id="1357663">==</span>&nbsp;<span class="ident" id="1357666">nil</span>&nbsp;<span class="op" id="1357670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357674">return</span>&nbsp;<span class="num" id="1357681">0</span><span class="op" id="1357682">,</span>&nbsp;<span class="ident" id="1357684">io</span><span class="op" id="1357686">.</span><span class="ident" id="1357687">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357695">n</span><span class="op" id="1357696">,</span>&nbsp;<span class="ident" id="1357698">err</span>&nbsp;<span class="op" id="1357702">=</span>&nbsp;<span class="ident" id="1357704">tr</span><span class="op" id="1357706">.</span><span class="ident" id="1357707">curr</span><span class="op" id="1357711">.</span><span class="ident" id="1357712">Read</span><span class="op" id="1357716">(</span><span class="ident" id="1357717">b</span><span class="op" id="1357718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357721">if</span>&nbsp;<span class="ident" id="1357724">err</span>&nbsp;<span class="op" id="1357728">!=</span>&nbsp;<span class="ident" id="1357731">nil</span>&nbsp;<span class="op" id="1357735">&amp;&amp;</span>&nbsp;<span class="ident" id="1357738">err</span>&nbsp;<span class="op" id="1357742">!=</span>&nbsp;<span class="ident" id="1357745">io</span><span class="op" id="1357747">.</span><span class="ident" id="1357748">EOF</span>&nbsp;<span class="op" id="1357752">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357756">tr</span><span class="op" id="1357758">.</span><span class="ident" id="1357759">err</span>&nbsp;<span class="op" id="1357763">=</span>&nbsp;<span class="ident" id="1357765">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357773">return</span><br>
<span class="lineno"></span><span class="op" id="1357780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="1357783">func</span>&nbsp;<span class="op" id="1357788">(</span><span class="ident" id="1357789">rfr</span>&nbsp;<span class="op" id="1357793">*</span><span class="ident" id="1357794">regFileReader</span><span class="op" id="1357807">)</span>&nbsp;<span class="ident" id="1357809">Read</span><span class="op" id="1357813">(</span><span class="ident" id="1357814">b</span>&nbsp;<span class="op" id="1357816">[</span><span class="op" id="1357817">]</span><span class="builtintype" id="1357818">byte</span><span class="op" id="1357822">)</span>&nbsp;<span class="op" id="1357824">(</span><span class="ident" id="1357825">n</span>&nbsp;<span class="builtintype" id="1357827">int</span><span class="op" id="1357830">,</span>&nbsp;<span class="ident" id="1357832">err</span>&nbsp;<span class="builtintype" id="1357836">error</span><span class="op" id="1357841">)</span>&nbsp;<span class="op" id="1357843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357846">if</span>&nbsp;<span class="ident" id="1357849">rfr</span><span class="op" id="1357852">.</span><span class="ident" id="1357853">nb</span>&nbsp;<span class="op" id="1357856">==</span>&nbsp;<span class="num" id="1357859">0</span>&nbsp;<span class="op" id="1357861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1357865">//&nbsp;file&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357884">return</span>&nbsp;<span class="num" id="1357891">0</span><span class="op" id="1357892">,</span>&nbsp;<span class="ident" id="1357894">io</span><span class="op" id="1357896">.</span><span class="ident" id="1357897">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357902">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357905">if</span>&nbsp;<span class="ident" id="1357908">int64</span><span class="op" id="1357913">(</span><span class="builtinfunc" id="1357914">len</span><span class="op" id="1357917">(</span><span class="ident" id="1357918">b</span><span class="op" id="1357919">)</span><span class="op" id="1357920">)</span>&nbsp;<span class="op" id="1357922">&gt;</span>&nbsp;<span class="ident" id="1357924">rfr</span><span class="op" id="1357927">.</span><span class="ident" id="1357928">nb</span>&nbsp;<span class="op" id="1357931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357935">b</span>&nbsp;<span class="op" id="1357937">=</span>&nbsp;<span class="ident" id="1357939">b</span><span class="op" id="1357940">[</span><span class="num" id="1357941">0</span><span class="op" id="1357942">:</span><span class="ident" id="1357943">rfr</span><span class="op" id="1357946">.</span><span class="ident" id="1357947">nb</span><span class="op" id="1357949">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357955">n</span><span class="op" id="1357956">,</span>&nbsp;<span class="ident" id="1357958">err</span>&nbsp;<span class="op" id="1357962">=</span>&nbsp;<span class="ident" id="1357964">rfr</span><span class="op" id="1357967">.</span><span class="ident" id="1357968">r</span><span class="op" id="1357969">.</span><span class="ident" id="1357970">Read</span><span class="op" id="1357974">(</span><span class="ident" id="1357975">b</span><span class="op" id="1357976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357979">rfr</span><span class="op" id="1357982">.</span><span class="ident" id="1357983">nb</span>&nbsp;<span class="op" id="1357986">-=</span>&nbsp;<span class="ident" id="1357989">int64</span><span class="op" id="1357994">(</span><span class="ident" id="1357995">n</span><span class="op" id="1357996">)</span><br>
<span class="lineno">750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358000">if</span>&nbsp;<span class="ident" id="1358003">err</span>&nbsp;<span class="op" id="1358007">==</span>&nbsp;<span class="ident" id="1358010">io</span><span class="op" id="1358012">.</span><span class="ident" id="1358013">EOF</span>&nbsp;<span class="op" id="1358017">&amp;&amp;</span>&nbsp;<span class="ident" id="1358020">rfr</span><span class="op" id="1358023">.</span><span class="ident" id="1358024">nb</span>&nbsp;<span class="op" id="1358027">&gt;</span>&nbsp;<span class="num" id="1358029">0</span>&nbsp;<span class="op" id="1358031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1358035">err</span>&nbsp;<span class="op" id="1358039">=</span>&nbsp;<span class="ident" id="1358041">io</span><span class="op" id="1358043">.</span><span class="ident" id="1358044">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1358062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358065">return</span><br>
<span class="lineno">755</span><span class="op" id="1358072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1358075">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;file&#39;s&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="1358167">func</span>&nbsp;<span class="op" id="1358172">(</span><span class="ident" id="1358173">rfr</span>&nbsp;<span class="op" id="1358177">*</span><span class="ident" id="1358178">regFileReader</span><span class="op" id="1358191">)</span>&nbsp;<span class="ident" id="1358193">numBytes</span><span class="op" id="1358201">(</span><span class="op" id="1358202">)</span>&nbsp;<span class="ident" id="1358204">int64</span>&nbsp;<span class="op" id="1358210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358213">return</span>&nbsp;<span class="ident" id="1358220">rfr</span><span class="op" id="1358223">.</span><span class="ident" id="1358224">nb</span><br>
<span class="lineno">760</span><span class="op" id="1358227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1358230">//&nbsp;readHole&nbsp;reads&nbsp;a&nbsp;sparse&nbsp;file&nbsp;hole&nbsp;ending&nbsp;at&nbsp;offset&nbsp;toOffset</span><br>
<span class="lineno"></span><span class="keyword" id="1358293">func</span>&nbsp;<span class="op" id="1358298">(</span><span class="ident" id="1358299">sfr</span>&nbsp;<span class="op" id="1358303">*</span><span class="ident" id="1358304">sparseFileReader</span><span class="op" id="1358320">)</span>&nbsp;<span class="ident" id="1358322">readHole</span><span class="op" id="1358330">(</span><span class="ident" id="1358331">b</span>&nbsp;<span class="op" id="1358333">[</span><span class="op" id="1358334">]</span><span class="builtintype" id="1358335">byte</span><span class="op" id="1358339">,</span>&nbsp;<span class="ident" id="1358341">toOffset</span>&nbsp;<span class="ident" id="1358350">int64</span><span class="op" id="1358355">)</span>&nbsp;<span class="builtintype" id="1358357">int</span>&nbsp;<span class="op" id="1358361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1358364">n64</span>&nbsp;<span class="op" id="1358368">:=</span>&nbsp;<span class="ident" id="1358371">toOffset</span>&nbsp;<span class="op" id="1358380">-</span>&nbsp;<span class="ident" id="1358382">sfr</span><span class="op" id="1358385">.</span><span class="ident" id="1358386">pos</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358391">if</span>&nbsp;<span class="ident" id="1358394">n64</span>&nbsp;<span class="op" id="1358398">&gt;</span>&nbsp;<span class="ident" id="1358400">int64</span><span class="op" id="1358405">(</span><span class="builtinfunc" id="1358406">len</span><span class="op" id="1358409">(</span><span class="ident" id="1358410">b</span><span class="op" id="1358411">)</span><span class="op" id="1358412">)</span>&nbsp;<span class="op" id="1358414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1358418">n64</span>&nbsp;<span class="op" id="1358422">=</span>&nbsp;<span class="ident" id="1358424">int64</span><span class="op" id="1358429">(</span><span class="builtinfunc" id="1358430">len</span><span class="op" id="1358433">(</span><span class="ident" id="1358434">b</span><span class="op" id="1358435">)</span><span class="op" id="1358436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1358439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1358442">n</span>&nbsp;<span class="op" id="1358444">:=</span>&nbsp;<span class="builtintype" id="1358447">int</span><span class="op" id="1358450">(</span><span class="ident" id="1358451">n64</span><span class="op" id="1358454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358457">for</span>&nbsp;<span class="ident" id="1358461">i</span>&nbsp;<span class="op" id="1358463">:=</span>&nbsp;<span class="num" id="1358466">0</span><span class="op" id="1358467">;</span>&nbsp;<span class="ident" id="1358469">i</span>&nbsp;<span class="op" id="1358471">&lt;</span>&nbsp;<span class="ident" id="1358473">n</span><span class="op" id="1358474">;</span>&nbsp;<span class="ident" id="1358476">i</span><span class="op" id="1358477">++</span>&nbsp;<span class="op" id="1358480">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1358484">b</span><span class="op" id="1358485">[</span><span class="ident" id="1358486">i</span><span class="op" id="1358487">]</span>&nbsp;<span class="op" id="1358489">=</span>&nbsp;<span class="num" id="1358491">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1358494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1358497">sfr</span><span class="op" id="1358500">.</span><span class="ident" id="1358501">pos</span>&nbsp;<span class="op" id="1358505">+=</span>&nbsp;<span class="ident" id="1358508">n64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358513">return</span>&nbsp;<span class="ident" id="1358520">n</span><br>
<span class="lineno"></span><span class="op" id="1358522">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="1358525">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;file&nbsp;data&nbsp;in&nbsp;expanded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="1358578">func</span>&nbsp;<span class="op" id="1358583">(</span><span class="ident" id="1358584">sfr</span>&nbsp;<span class="op" id="1358588">*</span><span class="ident" id="1358589">sparseFileReader</span><span class="op" id="1358605">)</span>&nbsp;<span class="ident" id="1358607">Read</span><span class="op" id="1358611">(</span><span class="ident" id="1358612">b</span>&nbsp;<span class="op" id="1358614">[</span><span class="op" id="1358615">]</span><span class="builtintype" id="1358616">byte</span><span class="op" id="1358620">)</span>&nbsp;<span class="op" id="1358622">(</span><span class="ident" id="1358623">n</span>&nbsp;<span class="builtintype" id="1358625">int</span><span class="op" id="1358628">,</span>&nbsp;<span class="ident" id="1358630">err</span>&nbsp;<span class="builtintype" id="1358634">error</span><span class="op" id="1358639">)</span>&nbsp;<span class="op" id="1358641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358644">if</span>&nbsp;<span class="builtinfunc" id="1358647">len</span><span class="op" id="1358650">(</span><span class="ident" id="1358651">sfr</span><span class="op" id="1358654">.</span><span class="ident" id="1358655">sp</span><span class="op" id="1358657">)</span>&nbsp;<span class="op" id="1358659">==</span>&nbsp;<span class="num" id="1358662">0</span>&nbsp;<span class="op" id="1358664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1358668">//&nbsp;No&nbsp;more&nbsp;data&nbsp;fragments&nbsp;to&nbsp;read&nbsp;from.</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358710">if</span>&nbsp;<span class="ident" id="1358713">sfr</span><span class="op" id="1358716">.</span><span class="ident" id="1358717">pos</span>&nbsp;<span class="op" id="1358721">&lt;</span>&nbsp;<span class="ident" id="1358723">sfr</span><span class="op" id="1358726">.</span><span class="ident" id="1358727">tot</span>&nbsp;<span class="op" id="1358731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1358736">//&nbsp;We&#39;re&nbsp;in&nbsp;the&nbsp;last&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1358765">n</span>&nbsp;<span class="op" id="1358767">=</span>&nbsp;<span class="ident" id="1358769">sfr</span><span class="op" id="1358772">.</span><span class="ident" id="1358773">readHole</span><span class="op" id="1358781">(</span><span class="ident" id="1358782">b</span><span class="op" id="1358783">,</span>&nbsp;<span class="ident" id="1358785">sfr</span><span class="op" id="1358788">.</span><span class="ident" id="1358789">tot</span><span class="op" id="1358792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358797">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1358806">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1358810">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358855">return</span>&nbsp;<span class="num" id="1358862">0</span><span class="op" id="1358863">,</span>&nbsp;<span class="ident" id="1358865">io</span><span class="op" id="1358867">.</span><span class="ident" id="1358868">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1358873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358876">if</span>&nbsp;<span class="ident" id="1358879">sfr</span><span class="op" id="1358882">.</span><span class="ident" id="1358883">pos</span>&nbsp;<span class="op" id="1358887">&lt;</span>&nbsp;<span class="ident" id="1358889">sfr</span><span class="op" id="1358892">.</span><span class="ident" id="1358893">sp</span><span class="op" id="1358895">[</span><span class="num" id="1358896">0</span><span class="op" id="1358897">]</span><span class="op" id="1358898">.</span><span class="ident" id="1358899">offset</span>&nbsp;<span class="op" id="1358906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1358910">//&nbsp;We&#39;re&nbsp;in&nbsp;a&nbsp;hole</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1358931">n</span>&nbsp;<span class="op" id="1358933">=</span>&nbsp;<span class="ident" id="1358935">sfr</span><span class="op" id="1358938">.</span><span class="ident" id="1358939">readHole</span><span class="op" id="1358947">(</span><span class="ident" id="1358948">b</span><span class="op" id="1358949">,</span>&nbsp;<span class="ident" id="1358951">sfr</span><span class="op" id="1358954">.</span><span class="ident" id="1358955">sp</span><span class="op" id="1358957">[</span><span class="num" id="1358958">0</span><span class="op" id="1358959">]</span><span class="op" id="1358960">.</span><span class="ident" id="1358961">offset</span><span class="op" id="1358967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358971">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1358979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1358983">//&nbsp;We&#39;re&nbsp;not&nbsp;in&nbsp;a&nbsp;hole,&nbsp;so&nbsp;we&#39;ll&nbsp;read&nbsp;from&nbsp;the&nbsp;next&nbsp;data&nbsp;fragment</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359050">posInFragment</span>&nbsp;<span class="op" id="1359064">:=</span>&nbsp;<span class="ident" id="1359067">sfr</span><span class="op" id="1359070">.</span><span class="ident" id="1359071">pos</span>&nbsp;<span class="op" id="1359075">-</span>&nbsp;<span class="ident" id="1359077">sfr</span><span class="op" id="1359080">.</span><span class="ident" id="1359081">sp</span><span class="op" id="1359083">[</span><span class="num" id="1359084">0</span><span class="op" id="1359085">]</span><span class="op" id="1359086">.</span><span class="ident" id="1359087">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359095">bytesLeft</span>&nbsp;<span class="op" id="1359105">:=</span>&nbsp;<span class="ident" id="1359108">sfr</span><span class="op" id="1359111">.</span><span class="ident" id="1359112">sp</span><span class="op" id="1359114">[</span><span class="num" id="1359115">0</span><span class="op" id="1359116">]</span><span class="op" id="1359117">.</span><span class="ident" id="1359118">numBytes</span>&nbsp;<span class="op" id="1359127">-</span>&nbsp;<span class="ident" id="1359129">posInFragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1359144">if</span>&nbsp;<span class="ident" id="1359147">int64</span><span class="op" id="1359152">(</span><span class="builtinfunc" id="1359153">len</span><span class="op" id="1359156">(</span><span class="ident" id="1359157">b</span><span class="op" id="1359158">)</span><span class="op" id="1359159">)</span>&nbsp;<span class="op" id="1359161">&gt;</span>&nbsp;<span class="ident" id="1359163">bytesLeft</span>&nbsp;<span class="op" id="1359173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359177">b</span>&nbsp;<span class="op" id="1359179">=</span>&nbsp;<span class="ident" id="1359181">b</span><span class="op" id="1359182">[</span><span class="num" id="1359183">0</span><span class="op" id="1359184">:</span><span class="ident" id="1359185">bytesLeft</span><span class="op" id="1359194">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1359197">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359201">n</span><span class="op" id="1359202">,</span>&nbsp;<span class="ident" id="1359204">err</span>&nbsp;<span class="op" id="1359208">=</span>&nbsp;<span class="ident" id="1359210">sfr</span><span class="op" id="1359213">.</span><span class="ident" id="1359214">rfr</span><span class="op" id="1359217">.</span><span class="ident" id="1359218">Read</span><span class="op" id="1359222">(</span><span class="ident" id="1359223">b</span><span class="op" id="1359224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359227">sfr</span><span class="op" id="1359230">.</span><span class="ident" id="1359231">pos</span>&nbsp;<span class="op" id="1359235">+=</span>&nbsp;<span class="ident" id="1359238">int64</span><span class="op" id="1359243">(</span><span class="ident" id="1359244">n</span><span class="op" id="1359245">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1359249">if</span>&nbsp;<span class="ident" id="1359252">int64</span><span class="op" id="1359257">(</span><span class="ident" id="1359258">n</span><span class="op" id="1359259">)</span>&nbsp;<span class="op" id="1359261">==</span>&nbsp;<span class="ident" id="1359264">bytesLeft</span>&nbsp;<span class="op" id="1359274">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1359278">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359313">sfr</span><span class="op" id="1359316">.</span><span class="ident" id="1359317">sp</span>&nbsp;<span class="op" id="1359320">=</span>&nbsp;<span class="ident" id="1359322">sfr</span><span class="op" id="1359325">.</span><span class="ident" id="1359326">sp</span><span class="op" id="1359328">[</span><span class="num" id="1359329">1</span><span class="op" id="1359330">:</span><span class="op" id="1359331">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1359334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1359338">if</span>&nbsp;<span class="ident" id="1359341">err</span>&nbsp;<span class="op" id="1359345">==</span>&nbsp;<span class="ident" id="1359348">io</span><span class="op" id="1359350">.</span><span class="ident" id="1359351">EOF</span>&nbsp;<span class="op" id="1359355">&amp;&amp;</span>&nbsp;<span class="ident" id="1359358">sfr</span><span class="op" id="1359361">.</span><span class="ident" id="1359362">pos</span>&nbsp;<span class="op" id="1359366">&lt;</span>&nbsp;<span class="ident" id="1359368">sfr</span><span class="op" id="1359371">.</span><span class="ident" id="1359372">tot</span>&nbsp;<span class="op" id="1359376">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1359380">//&nbsp;We&nbsp;reached&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;last&nbsp;fragment&#39;s&nbsp;data,&nbsp;but&nbsp;there&#39;s&nbsp;a&nbsp;final&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359458">err</span>&nbsp;<span class="op" id="1359462">=</span>&nbsp;<span class="ident" id="1359464">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1359469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1359472">return</span><br>
<span class="lineno"></span><span class="op" id="1359479">}</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="1359482">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;sparse&nbsp;file&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1359556">//&nbsp;sparse-encoded&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="1359599">func</span>&nbsp;<span class="op" id="1359604">(</span><span class="ident" id="1359605">sfr</span>&nbsp;<span class="op" id="1359609">*</span><span class="ident" id="1359610">sparseFileReader</span><span class="op" id="1359626">)</span>&nbsp;<span class="ident" id="1359628">numBytes</span><span class="op" id="1359636">(</span><span class="op" id="1359637">)</span>&nbsp;<span class="ident" id="1359639">int64</span>&nbsp;<span class="op" id="1359645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1359648">return</span>&nbsp;<span class="ident" id="1359655">sfr</span><span class="op" id="1359658">.</span><span class="ident" id="1359659">rfr</span><span class="op" id="1359662">.</span><span class="ident" id="1359663">nb</span><br>
<span class="lineno">820</span><span class="op" id="1359666">}</span>
</div>
</body>
</html>
