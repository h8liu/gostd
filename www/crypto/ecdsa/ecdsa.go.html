<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4253953">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4254008">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4254062">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4254113">//&nbsp;Package&nbsp;ecdsa&nbsp;implements&nbsp;the&nbsp;Elliptic&nbsp;Curve&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4254192">//&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4254218">package</span>&nbsp;<span class="ident" id="4254226">ecdsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4254233">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="4254248">//&nbsp;&nbsp;&nbsp;[NSA]:&nbsp;Suite&nbsp;B&nbsp;implementer&#39;s&nbsp;guide&nbsp;to&nbsp;FIPS&nbsp;186-3,</span><br>
<span class="lineno"></span><span class="comment" id="4254303">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.nsa.gov/ia/_files/ecdsa.pdf</span><br>
<span class="lineno"></span><span class="comment" id="4254349">//&nbsp;&nbsp;&nbsp;[SECG]:&nbsp;SECG,&nbsp;SEC1</span><br>
<span class="lineno"></span><span class="comment" id="4254373">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.secg.org/download/aid-780/sec1-v2.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4254430">import</span>&nbsp;<span class="op" id="4254437">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4254440">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4254450">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4254469">&#34;encoding/asn1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4254486">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4254492">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4254503">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4254506">//&nbsp;PublicKey&nbsp;represents&nbsp;an&nbsp;ECDSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4254551">type</span>&nbsp;<span class="ident" id="4254556">PublicKey</span>&nbsp;<span class="keyword" id="4254566">struct</span>&nbsp;<span class="op" id="4254573">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254576">elliptic</span><span class="op" id="4254584">.</span><span class="ident" id="4254585">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254592">X</span><span class="op" id="4254593">,</span>&nbsp;<span class="ident" id="4254595">Y</span>&nbsp;<span class="op" id="4254597">*</span><span class="ident" id="4254598">big</span><span class="op" id="4254601">.</span><span class="ident" id="4254602">Int</span><br>
<span class="lineno"></span><span class="op" id="4254606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4254609">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;ECDSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno">30</span><span class="keyword" id="4254655">type</span>&nbsp;<span class="ident" id="4254660">PrivateKey</span>&nbsp;<span class="keyword" id="4254671">struct</span>&nbsp;<span class="op" id="4254678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254681">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254692">D</span>&nbsp;<span class="op" id="4254694">*</span><span class="ident" id="4254695">big</span><span class="op" id="4254698">.</span><span class="ident" id="4254699">Int</span><br>
<span class="lineno"></span><span class="op" id="4254703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="4254706">type</span>&nbsp;<span class="ident" id="4254711">ecdsaSignature</span>&nbsp;<span class="keyword" id="4254726">struct</span>&nbsp;<span class="op" id="4254733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4254736">R</span><span class="op" id="4254737">,</span>&nbsp;<span class="ident" id="4254739">S</span>&nbsp;<span class="op" id="4254741">*</span><span class="ident" id="4254742">big</span><span class="op" id="4254745">.</span><span class="ident" id="4254746">Int</span><br>
<span class="lineno"></span><span class="op" id="4254750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4254753">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno">40</span><span class="keyword" id="4254809">func</span>&nbsp;<span class="op" id="4254814">(</span><span class="ident" id="4254815">priv</span>&nbsp;<span class="op" id="4254820">*</span><span class="ident" id="4254821">PrivateKey</span><span class="op" id="4254831">)</span>&nbsp;<span class="ident" id="4254833">Public</span><span class="op" id="4254839">(</span><span class="op" id="4254840">)</span>&nbsp;<span class="ident" id="4254842">crypto</span><span class="op" id="4254848">.</span><span class="ident" id="4254849">PublicKey</span>&nbsp;<span class="op" id="4254859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4254862">return</span>&nbsp;<span class="op" id="4254869">&amp;</span><span class="ident" id="4254870">priv</span><span class="op" id="4254874">.</span><span class="ident" id="4254875">PublicKey</span><br>
<span class="lineno"></span><span class="op" id="4254885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4254888">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;This&nbsp;method&nbsp;is</span><br>
<span class="lineno">45</span><span class="comment" id="4254962">//&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4255040">//&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign&nbsp;function&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4255117">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="4255130">func</span>&nbsp;<span class="op" id="4255135">(</span><span class="ident" id="4255136">priv</span>&nbsp;<span class="op" id="4255141">*</span><span class="ident" id="4255142">PrivateKey</span><span class="op" id="4255152">)</span>&nbsp;<span class="ident" id="4255154">Sign</span><span class="op" id="4255158">(</span><span class="ident" id="4255159">rand</span>&nbsp;<span class="ident" id="4255164">io</span><span class="op" id="4255166">.</span><span class="ident" id="4255167">Reader</span><span class="op" id="4255173">,</span>&nbsp;<span class="ident" id="4255175">msg</span>&nbsp;<span class="op" id="4255179">[</span><span class="op" id="4255180">]</span><span class="builtintype" id="4255181">byte</span><span class="op" id="4255185">,</span>&nbsp;<span class="ident" id="4255187">opts</span>&nbsp;<span class="ident" id="4255192">crypto</span><span class="op" id="4255198">.</span><span class="ident" id="4255199">SignerOpts</span><span class="op" id="4255209">)</span>&nbsp;<span class="op" id="4255211">(</span><span class="op" id="4255212">[</span><span class="op" id="4255213">]</span><span class="builtintype" id="4255214">byte</span><span class="op" id="4255218">,</span>&nbsp;<span class="builtintype" id="4255220">error</span><span class="op" id="4255225">)</span>&nbsp;<span class="op" id="4255227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255230">r</span><span class="op" id="4255231">,</span>&nbsp;<span class="ident" id="4255233">s</span><span class="op" id="4255234">,</span>&nbsp;<span class="ident" id="4255236">err</span>&nbsp;<span class="op" id="4255240">:=</span>&nbsp;<span class="ident" id="4255243">Sign</span><span class="op" id="4255247">(</span><span class="ident" id="4255248">rand</span><span class="op" id="4255252">,</span>&nbsp;<span class="ident" id="4255254">priv</span><span class="op" id="4255258">,</span>&nbsp;<span class="ident" id="4255260">msg</span><span class="op" id="4255263">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255266">if</span>&nbsp;<span class="ident" id="4255269">err</span>&nbsp;<span class="op" id="4255273">!=</span>&nbsp;<span class="ident" id="4255276">nil</span>&nbsp;<span class="op" id="4255280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255284">return</span>&nbsp;<span class="ident" id="4255291">nil</span><span class="op" id="4255294">,</span>&nbsp;<span class="ident" id="4255296">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4255301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255305">return</span>&nbsp;<span class="ident" id="4255312">asn1</span><span class="op" id="4255316">.</span><span class="ident" id="4255317">Marshal</span><span class="op" id="4255324">(</span><span class="ident" id="4255325">ecdsaSignature</span><span class="op" id="4255339">{</span><span class="ident" id="4255340">r</span><span class="op" id="4255341">,</span>&nbsp;<span class="ident" id="4255343">s</span><span class="op" id="4255344">}</span><span class="op" id="4255345">)</span><br>
<span class="lineno">55</span><span class="op" id="4255347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4255350">var</span>&nbsp;<span class="ident" id="4255354">one</span>&nbsp;<span class="op" id="4255358">=</span>&nbsp;<span class="builtinfunc" id="4255360">new</span><span class="op" id="4255363">(</span><span class="ident" id="4255364">big</span><span class="op" id="4255367">.</span><span class="ident" id="4255368">Int</span><span class="op" id="4255371">)</span><span class="op" id="4255372">.</span><span class="ident" id="4255373">SetInt64</span><span class="op" id="4255381">(</span><span class="num" id="4255382">1</span><span class="op" id="4255383">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4255386">//&nbsp;randFieldElement&nbsp;returns&nbsp;a&nbsp;random&nbsp;element&nbsp;of&nbsp;the&nbsp;field&nbsp;underlying&nbsp;the&nbsp;given</span><br>
<span class="lineno">60</span><span class="comment" id="4255465">//&nbsp;curve&nbsp;using&nbsp;the&nbsp;procedure&nbsp;given&nbsp;in&nbsp;[NSA]&nbsp;A.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4255516">func</span>&nbsp;<span class="ident" id="4255521">randFieldElement</span><span class="op" id="4255537">(</span><span class="ident" id="4255538">c</span>&nbsp;<span class="ident" id="4255540">elliptic</span><span class="op" id="4255548">.</span><span class="ident" id="4255549">Curve</span><span class="op" id="4255554">,</span>&nbsp;<span class="ident" id="4255556">rand</span>&nbsp;<span class="ident" id="4255561">io</span><span class="op" id="4255563">.</span><span class="ident" id="4255564">Reader</span><span class="op" id="4255570">)</span>&nbsp;<span class="op" id="4255572">(</span><span class="ident" id="4255573">k</span>&nbsp;<span class="op" id="4255575">*</span><span class="ident" id="4255576">big</span><span class="op" id="4255579">.</span><span class="ident" id="4255580">Int</span><span class="op" id="4255583">,</span>&nbsp;<span class="ident" id="4255585">err</span>&nbsp;<span class="builtintype" id="4255589">error</span><span class="op" id="4255594">)</span>&nbsp;<span class="op" id="4255596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255599">params</span>&nbsp;<span class="op" id="4255606">:=</span>&nbsp;<span class="ident" id="4255609">c</span><span class="op" id="4255610">.</span><span class="ident" id="4255611">Params</span><span class="op" id="4255617">(</span><span class="op" id="4255618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255621">b</span>&nbsp;<span class="op" id="4255623">:=</span>&nbsp;<span class="builtinfunc" id="4255626">make</span><span class="op" id="4255630">(</span><span class="op" id="4255631">[</span><span class="op" id="4255632">]</span><span class="builtintype" id="4255633">byte</span><span class="op" id="4255637">,</span>&nbsp;<span class="ident" id="4255639">params</span><span class="op" id="4255645">.</span><span class="ident" id="4255646">BitSize</span><span class="op" id="4255653">/</span><span class="num" id="4255654">8</span><span class="op" id="4255655">+</span><span class="num" id="4255656">8</span><span class="op" id="4255657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255660">_</span><span class="op" id="4255661">,</span>&nbsp;<span class="ident" id="4255663">err</span>&nbsp;<span class="op" id="4255667">=</span>&nbsp;<span class="ident" id="4255669">io</span><span class="op" id="4255671">.</span><span class="ident" id="4255672">ReadFull</span><span class="op" id="4255680">(</span><span class="ident" id="4255681">rand</span><span class="op" id="4255685">,</span>&nbsp;<span class="ident" id="4255687">b</span><span class="op" id="4255688">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255691">if</span>&nbsp;<span class="ident" id="4255694">err</span>&nbsp;<span class="op" id="4255698">!=</span>&nbsp;<span class="ident" id="4255701">nil</span>&nbsp;<span class="op" id="4255705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255709">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4255717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255721">k</span>&nbsp;<span class="op" id="4255723">=</span>&nbsp;<span class="builtinfunc" id="4255725">new</span><span class="op" id="4255728">(</span><span class="ident" id="4255729">big</span><span class="op" id="4255732">.</span><span class="ident" id="4255733">Int</span><span class="op" id="4255736">)</span><span class="op" id="4255737">.</span><span class="ident" id="4255738">SetBytes</span><span class="op" id="4255746">(</span><span class="ident" id="4255747">b</span><span class="op" id="4255748">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255751">n</span>&nbsp;<span class="op" id="4255753">:=</span>&nbsp;<span class="builtinfunc" id="4255756">new</span><span class="op" id="4255759">(</span><span class="ident" id="4255760">big</span><span class="op" id="4255763">.</span><span class="ident" id="4255764">Int</span><span class="op" id="4255767">)</span><span class="op" id="4255768">.</span><span class="ident" id="4255769">Sub</span><span class="op" id="4255772">(</span><span class="ident" id="4255773">params</span><span class="op" id="4255779">.</span><span class="ident" id="4255780">N</span><span class="op" id="4255781">,</span>&nbsp;<span class="ident" id="4255783">one</span><span class="op" id="4255786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255789">k</span><span class="op" id="4255790">.</span><span class="ident" id="4255791">Mod</span><span class="op" id="4255794">(</span><span class="ident" id="4255795">k</span><span class="op" id="4255796">,</span>&nbsp;<span class="ident" id="4255798">n</span><span class="op" id="4255799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255802">k</span><span class="op" id="4255803">.</span><span class="ident" id="4255804">Add</span><span class="op" id="4255807">(</span><span class="ident" id="4255808">k</span><span class="op" id="4255809">,</span>&nbsp;<span class="ident" id="4255811">one</span><span class="op" id="4255814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4255817">return</span><br>
<span class="lineno"></span><span class="op" id="4255824">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4255827">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&nbsp;and&nbsp;private&nbsp;key&nbsp;pair.</span><br>
<span class="lineno"></span><span class="keyword" id="4255883">func</span>&nbsp;<span class="ident" id="4255888">GenerateKey</span><span class="op" id="4255899">(</span><span class="ident" id="4255900">c</span>&nbsp;<span class="ident" id="4255902">elliptic</span><span class="op" id="4255910">.</span><span class="ident" id="4255911">Curve</span><span class="op" id="4255916">,</span>&nbsp;<span class="ident" id="4255918">rand</span>&nbsp;<span class="ident" id="4255923">io</span><span class="op" id="4255925">.</span><span class="ident" id="4255926">Reader</span><span class="op" id="4255932">)</span>&nbsp;<span class="op" id="4255934">(</span><span class="ident" id="4255935">priv</span>&nbsp;<span class="op" id="4255940">*</span><span class="ident" id="4255941">PrivateKey</span><span class="op" id="4255951">,</span>&nbsp;<span class="ident" id="4255953">err</span>&nbsp;<span class="builtintype" id="4255957">error</span><span class="op" id="4255962">)</span>&nbsp;<span class="op" id="4255964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4255967">k</span><span class="op" id="4255968">,</span>&nbsp;<span class="ident" id="4255970">err</span>&nbsp;<span class="op" id="4255974">:=</span>&nbsp;<span class="ident" id="4255977">randFieldElement</span><span class="op" id="4255993">(</span><span class="ident" id="4255994">c</span><span class="op" id="4255995">,</span>&nbsp;<span class="ident" id="4255997">rand</span><span class="op" id="4256001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256004">if</span>&nbsp;<span class="ident" id="4256007">err</span>&nbsp;<span class="op" id="4256011">!=</span>&nbsp;<span class="ident" id="4256014">nil</span>&nbsp;<span class="op" id="4256018">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256022">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256034">priv</span>&nbsp;<span class="op" id="4256039">=</span>&nbsp;<span class="builtinfunc" id="4256041">new</span><span class="op" id="4256044">(</span><span class="ident" id="4256045">PrivateKey</span><span class="op" id="4256055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256058">priv</span><span class="op" id="4256062">.</span><span class="ident" id="4256063">PublicKey</span><span class="op" id="4256072">.</span><span class="ident" id="4256073">Curve</span>&nbsp;<span class="op" id="4256079">=</span>&nbsp;<span class="ident" id="4256081">c</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256084">priv</span><span class="op" id="4256088">.</span><span class="ident" id="4256089">D</span>&nbsp;<span class="op" id="4256091">=</span>&nbsp;<span class="ident" id="4256093">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256096">priv</span><span class="op" id="4256100">.</span><span class="ident" id="4256101">PublicKey</span><span class="op" id="4256110">.</span><span class="ident" id="4256111">X</span><span class="op" id="4256112">,</span>&nbsp;<span class="ident" id="4256114">priv</span><span class="op" id="4256118">.</span><span class="ident" id="4256119">PublicKey</span><span class="op" id="4256128">.</span><span class="ident" id="4256129">Y</span>&nbsp;<span class="op" id="4256131">=</span>&nbsp;<span class="ident" id="4256133">c</span><span class="op" id="4256134">.</span><span class="ident" id="4256135">ScalarBaseMult</span><span class="op" id="4256149">(</span><span class="ident" id="4256150">k</span><span class="op" id="4256151">.</span><span class="ident" id="4256152">Bytes</span><span class="op" id="4256157">(</span><span class="op" id="4256158">)</span><span class="op" id="4256159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256162">return</span><br>
<span class="lineno"></span><span class="op" id="4256169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="4256172">//&nbsp;hashToInt&nbsp;converts&nbsp;a&nbsp;hash&nbsp;value&nbsp;to&nbsp;an&nbsp;integer.&nbsp;There&nbsp;is&nbsp;some&nbsp;disagreement</span><br>
<span class="lineno"></span><span class="comment" id="4256249">//&nbsp;about&nbsp;how&nbsp;this&nbsp;is&nbsp;done.&nbsp;[NSA]&nbsp;suggests&nbsp;that&nbsp;this&nbsp;is&nbsp;done&nbsp;in&nbsp;the&nbsp;obvious</span><br>
<span class="lineno"></span><span class="comment" id="4256324">//&nbsp;manner,&nbsp;but&nbsp;[SECG]&nbsp;truncates&nbsp;the&nbsp;hash&nbsp;to&nbsp;the&nbsp;bit-length&nbsp;of&nbsp;the&nbsp;curve&nbsp;order</span><br>
<span class="lineno"></span><span class="comment" id="4256402">//&nbsp;first.&nbsp;We&nbsp;follow&nbsp;[SECG]&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;OpenSSL&nbsp;does.&nbsp;Additionally,</span><br>
<span class="lineno"></span><span class="comment" id="4256477">//&nbsp;OpenSSL&nbsp;right&nbsp;shifts&nbsp;excess&nbsp;bits&nbsp;from&nbsp;the&nbsp;number&nbsp;if&nbsp;the&nbsp;hash&nbsp;is&nbsp;too&nbsp;large</span><br>
<span class="lineno">95</span><span class="comment" id="4256554">//&nbsp;and&nbsp;we&nbsp;mirror&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span><span class="keyword" id="4256581">func</span>&nbsp;<span class="ident" id="4256586">hashToInt</span><span class="op" id="4256595">(</span><span class="ident" id="4256596">hash</span>&nbsp;<span class="op" id="4256601">[</span><span class="op" id="4256602">]</span><span class="builtintype" id="4256603">byte</span><span class="op" id="4256607">,</span>&nbsp;<span class="ident" id="4256609">c</span>&nbsp;<span class="ident" id="4256611">elliptic</span><span class="op" id="4256619">.</span><span class="ident" id="4256620">Curve</span><span class="op" id="4256625">)</span>&nbsp;<span class="op" id="4256627">*</span><span class="ident" id="4256628">big</span><span class="op" id="4256631">.</span><span class="ident" id="4256632">Int</span>&nbsp;<span class="op" id="4256636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256639">orderBits</span>&nbsp;<span class="op" id="4256649">:=</span>&nbsp;<span class="ident" id="4256652">c</span><span class="op" id="4256653">.</span><span class="ident" id="4256654">Params</span><span class="op" id="4256660">(</span><span class="op" id="4256661">)</span><span class="op" id="4256662">.</span><span class="ident" id="4256663">N</span><span class="op" id="4256664">.</span><span class="ident" id="4256665">BitLen</span><span class="op" id="4256671">(</span><span class="op" id="4256672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256675">orderBytes</span>&nbsp;<span class="op" id="4256686">:=</span>&nbsp;<span class="op" id="4256689">(</span><span class="ident" id="4256690">orderBits</span>&nbsp;<span class="op" id="4256700">+</span>&nbsp;<span class="num" id="4256702">7</span><span class="op" id="4256703">)</span>&nbsp;<span class="op" id="4256705">/</span>&nbsp;<span class="num" id="4256707">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256710">if</span>&nbsp;<span class="builtinfunc" id="4256713">len</span><span class="op" id="4256716">(</span><span class="ident" id="4256717">hash</span><span class="op" id="4256721">)</span>&nbsp;<span class="op" id="4256723">&gt;</span>&nbsp;<span class="ident" id="4256725">orderBytes</span>&nbsp;<span class="op" id="4256736">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256740">hash</span>&nbsp;<span class="op" id="4256745">=</span>&nbsp;<span class="ident" id="4256747">hash</span><span class="op" id="4256751">[</span><span class="op" id="4256752">:</span><span class="ident" id="4256753">orderBytes</span><span class="op" id="4256763">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256770">ret</span>&nbsp;<span class="op" id="4256774">:=</span>&nbsp;<span class="builtinfunc" id="4256777">new</span><span class="op" id="4256780">(</span><span class="ident" id="4256781">big</span><span class="op" id="4256784">.</span><span class="ident" id="4256785">Int</span><span class="op" id="4256788">)</span><span class="op" id="4256789">.</span><span class="ident" id="4256790">SetBytes</span><span class="op" id="4256798">(</span><span class="ident" id="4256799">hash</span><span class="op" id="4256803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256806">excess</span>&nbsp;<span class="op" id="4256813">:=</span>&nbsp;<span class="builtinfunc" id="4256816">len</span><span class="op" id="4256819">(</span><span class="ident" id="4256820">hash</span><span class="op" id="4256824">)</span><span class="op" id="4256825">*</span><span class="num" id="4256826">8</span>&nbsp;<span class="op" id="4256828">-</span>&nbsp;<span class="ident" id="4256830">orderBits</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256841">if</span>&nbsp;<span class="ident" id="4256844">excess</span>&nbsp;<span class="op" id="4256851">&gt;</span>&nbsp;<span class="num" id="4256853">0</span>&nbsp;<span class="op" id="4256855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4256859">ret</span><span class="op" id="4256862">.</span><span class="ident" id="4256863">Rsh</span><span class="op" id="4256866">(</span><span class="ident" id="4256867">ret</span><span class="op" id="4256870">,</span>&nbsp;<span class="builtintype" id="4256872">uint</span><span class="op" id="4256876">(</span><span class="ident" id="4256877">excess</span><span class="op" id="4256883">)</span><span class="op" id="4256884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4256887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4256890">return</span>&nbsp;<span class="ident" id="4256897">ret</span><br>
<span class="lineno"></span><span class="op" id="4256901">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4256904">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4256981">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4257059">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4257130">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">115</span><span class="keyword" id="4257168">func</span>&nbsp;<span class="ident" id="4257173">fermatInverse</span><span class="op" id="4257186">(</span><span class="ident" id="4257187">k</span><span class="op" id="4257188">,</span>&nbsp;<span class="ident" id="4257190">N</span>&nbsp;<span class="op" id="4257192">*</span><span class="ident" id="4257193">big</span><span class="op" id="4257196">.</span><span class="ident" id="4257197">Int</span><span class="op" id="4257200">)</span>&nbsp;<span class="op" id="4257202">*</span><span class="ident" id="4257203">big</span><span class="op" id="4257206">.</span><span class="ident" id="4257207">Int</span>&nbsp;<span class="op" id="4257211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257214">two</span>&nbsp;<span class="op" id="4257218">:=</span>&nbsp;<span class="ident" id="4257221">big</span><span class="op" id="4257224">.</span><span class="ident" id="4257225">NewInt</span><span class="op" id="4257231">(</span><span class="num" id="4257232">2</span><span class="op" id="4257233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257236">nMinus2</span>&nbsp;<span class="op" id="4257244">:=</span>&nbsp;<span class="builtinfunc" id="4257247">new</span><span class="op" id="4257250">(</span><span class="ident" id="4257251">big</span><span class="op" id="4257254">.</span><span class="ident" id="4257255">Int</span><span class="op" id="4257258">)</span><span class="op" id="4257259">.</span><span class="ident" id="4257260">Sub</span><span class="op" id="4257263">(</span><span class="ident" id="4257264">N</span><span class="op" id="4257265">,</span>&nbsp;<span class="ident" id="4257267">two</span><span class="op" id="4257270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257273">return</span>&nbsp;<span class="builtinfunc" id="4257280">new</span><span class="op" id="4257283">(</span><span class="ident" id="4257284">big</span><span class="op" id="4257287">.</span><span class="ident" id="4257288">Int</span><span class="op" id="4257291">)</span><span class="op" id="4257292">.</span><span class="ident" id="4257293">Exp</span><span class="op" id="4257296">(</span><span class="ident" id="4257297">k</span><span class="op" id="4257298">,</span>&nbsp;<span class="ident" id="4257300">nMinus2</span><span class="op" id="4257307">,</span>&nbsp;<span class="ident" id="4257309">N</span><span class="op" id="4257310">)</span><br>
<span class="lineno"></span><span class="op" id="4257312">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="4257315">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4257395">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4257473">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4257552">//&nbsp;rand.</span><br>
<span class="lineno">125</span><span class="keyword" id="4257561">func</span>&nbsp;<span class="ident" id="4257566">Sign</span><span class="op" id="4257570">(</span><span class="ident" id="4257571">rand</span>&nbsp;<span class="ident" id="4257576">io</span><span class="op" id="4257578">.</span><span class="ident" id="4257579">Reader</span><span class="op" id="4257585">,</span>&nbsp;<span class="ident" id="4257587">priv</span>&nbsp;<span class="op" id="4257592">*</span><span class="ident" id="4257593">PrivateKey</span><span class="op" id="4257603">,</span>&nbsp;<span class="ident" id="4257605">hash</span>&nbsp;<span class="op" id="4257610">[</span><span class="op" id="4257611">]</span><span class="builtintype" id="4257612">byte</span><span class="op" id="4257616">)</span>&nbsp;<span class="op" id="4257618">(</span><span class="ident" id="4257619">r</span><span class="op" id="4257620">,</span>&nbsp;<span class="ident" id="4257622">s</span>&nbsp;<span class="op" id="4257624">*</span><span class="ident" id="4257625">big</span><span class="op" id="4257628">.</span><span class="ident" id="4257629">Int</span><span class="op" id="4257632">,</span>&nbsp;<span class="ident" id="4257634">err</span>&nbsp;<span class="builtintype" id="4257638">error</span><span class="op" id="4257643">)</span>&nbsp;<span class="op" id="4257645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4257648">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257668">c</span>&nbsp;<span class="op" id="4257670">:=</span>&nbsp;<span class="ident" id="4257673">priv</span><span class="op" id="4257677">.</span><span class="ident" id="4257678">PublicKey</span><span class="op" id="4257687">.</span><span class="ident" id="4257688">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257695">N</span>&nbsp;<span class="op" id="4257697">:=</span>&nbsp;<span class="ident" id="4257700">c</span><span class="op" id="4257701">.</span><span class="ident" id="4257702">Params</span><span class="op" id="4257708">(</span><span class="op" id="4257709">)</span><span class="op" id="4257710">.</span><span class="ident" id="4257711">N</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257715">var</span>&nbsp;<span class="ident" id="4257719">k</span><span class="op" id="4257720">,</span>&nbsp;<span class="ident" id="4257722">kInv</span>&nbsp;<span class="op" id="4257727">*</span><span class="ident" id="4257728">big</span><span class="op" id="4257731">.</span><span class="ident" id="4257732">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257737">for</span>&nbsp;<span class="op" id="4257741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257745">for</span>&nbsp;<span class="op" id="4257749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257754">k</span><span class="op" id="4257755">,</span>&nbsp;<span class="ident" id="4257757">err</span>&nbsp;<span class="op" id="4257761">=</span>&nbsp;<span class="ident" id="4257763">randFieldElement</span><span class="op" id="4257779">(</span><span class="ident" id="4257780">c</span><span class="op" id="4257781">,</span>&nbsp;<span class="ident" id="4257783">rand</span><span class="op" id="4257787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257792">if</span>&nbsp;<span class="ident" id="4257795">err</span>&nbsp;<span class="op" id="4257799">!=</span>&nbsp;<span class="ident" id="4257802">nil</span>&nbsp;<span class="op" id="4257806">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257812">r</span>&nbsp;<span class="op" id="4257814">=</span>&nbsp;<span class="ident" id="4257816">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257824">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4257834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257840">kInv</span>&nbsp;<span class="op" id="4257845">=</span>&nbsp;<span class="ident" id="4257847">fermatInverse</span><span class="op" id="4257860">(</span><span class="ident" id="4257861">k</span><span class="op" id="4257862">,</span>&nbsp;<span class="ident" id="4257864">N</span><span class="op" id="4257865">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257870">r</span><span class="op" id="4257871">,</span>&nbsp;<span class="ident" id="4257873">_</span>&nbsp;<span class="op" id="4257875">=</span>&nbsp;<span class="ident" id="4257877">priv</span><span class="op" id="4257881">.</span><span class="ident" id="4257882">Curve</span><span class="op" id="4257887">.</span><span class="ident" id="4257888">ScalarBaseMult</span><span class="op" id="4257902">(</span><span class="ident" id="4257903">k</span><span class="op" id="4257904">.</span><span class="ident" id="4257905">Bytes</span><span class="op" id="4257910">(</span><span class="op" id="4257911">)</span><span class="op" id="4257912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257917">r</span><span class="op" id="4257918">.</span><span class="ident" id="4257919">Mod</span><span class="op" id="4257922">(</span><span class="ident" id="4257923">r</span><span class="op" id="4257924">,</span>&nbsp;<span class="ident" id="4257926">N</span><span class="op" id="4257927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257932">if</span>&nbsp;<span class="ident" id="4257935">r</span><span class="op" id="4257936">.</span><span class="ident" id="4257937">Sign</span><span class="op" id="4257941">(</span><span class="op" id="4257942">)</span>&nbsp;<span class="op" id="4257944">!=</span>&nbsp;<span class="num" id="4257947">0</span>&nbsp;<span class="op" id="4257949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4257955">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4257964">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4257968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257973">e</span>&nbsp;<span class="op" id="4257975">:=</span>&nbsp;<span class="ident" id="4257978">hashToInt</span><span class="op" id="4257987">(</span><span class="ident" id="4257988">hash</span><span class="op" id="4257992">,</span>&nbsp;<span class="ident" id="4257994">c</span><span class="op" id="4257995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4257999">s</span>&nbsp;<span class="op" id="4258001">=</span>&nbsp;<span class="builtinfunc" id="4258003">new</span><span class="op" id="4258006">(</span><span class="ident" id="4258007">big</span><span class="op" id="4258010">.</span><span class="ident" id="4258011">Int</span><span class="op" id="4258014">)</span><span class="op" id="4258015">.</span><span class="ident" id="4258016">Mul</span><span class="op" id="4258019">(</span><span class="ident" id="4258020">priv</span><span class="op" id="4258024">.</span><span class="ident" id="4258025">D</span><span class="op" id="4258026">,</span>&nbsp;<span class="ident" id="4258028">r</span><span class="op" id="4258029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258033">s</span><span class="op" id="4258034">.</span><span class="ident" id="4258035">Add</span><span class="op" id="4258038">(</span><span class="ident" id="4258039">s</span><span class="op" id="4258040">,</span>&nbsp;<span class="ident" id="4258042">e</span><span class="op" id="4258043">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258047">s</span><span class="op" id="4258048">.</span><span class="ident" id="4258049">Mul</span><span class="op" id="4258052">(</span><span class="ident" id="4258053">s</span><span class="op" id="4258054">,</span>&nbsp;<span class="ident" id="4258056">kInv</span><span class="op" id="4258060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258064">s</span><span class="op" id="4258065">.</span><span class="ident" id="4258066">Mod</span><span class="op" id="4258069">(</span><span class="ident" id="4258070">s</span><span class="op" id="4258071">,</span>&nbsp;<span class="ident" id="4258073">N</span><span class="op" id="4258074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258078">if</span>&nbsp;<span class="ident" id="4258081">s</span><span class="op" id="4258082">.</span><span class="ident" id="4258083">Sign</span><span class="op" id="4258087">(</span><span class="op" id="4258088">)</span>&nbsp;<span class="op" id="4258090">!=</span>&nbsp;<span class="num" id="4258093">0</span>&nbsp;<span class="op" id="4258095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258100">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4258108">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4258111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258115">return</span><br>
<span class="lineno"></span><span class="op" id="4258122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4258125">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;Its</span><br>
<span class="lineno"></span><span class="comment" id="4258205">//&nbsp;return&nbsp;value&nbsp;records&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4258261">func</span>&nbsp;<span class="ident" id="4258266">Verify</span><span class="op" id="4258272">(</span><span class="ident" id="4258273">pub</span>&nbsp;<span class="op" id="4258277">*</span><span class="ident" id="4258278">PublicKey</span><span class="op" id="4258287">,</span>&nbsp;<span class="ident" id="4258289">hash</span>&nbsp;<span class="op" id="4258294">[</span><span class="op" id="4258295">]</span><span class="builtintype" id="4258296">byte</span><span class="op" id="4258300">,</span>&nbsp;<span class="ident" id="4258302">r</span><span class="op" id="4258303">,</span>&nbsp;<span class="ident" id="4258305">s</span>&nbsp;<span class="op" id="4258307">*</span><span class="ident" id="4258308">big</span><span class="op" id="4258311">.</span><span class="ident" id="4258312">Int</span><span class="op" id="4258315">)</span>&nbsp;<span class="builtintype" id="4258317">bool</span>&nbsp;<span class="op" id="4258322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4258325">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258345">c</span>&nbsp;<span class="op" id="4258347">:=</span>&nbsp;<span class="ident" id="4258350">pub</span><span class="op" id="4258353">.</span><span class="ident" id="4258354">Curve</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258361">N</span>&nbsp;<span class="op" id="4258363">:=</span>&nbsp;<span class="ident" id="4258366">c</span><span class="op" id="4258367">.</span><span class="ident" id="4258368">Params</span><span class="op" id="4258374">(</span><span class="op" id="4258375">)</span><span class="op" id="4258376">.</span><span class="ident" id="4258377">N</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258381">if</span>&nbsp;<span class="ident" id="4258384">r</span><span class="op" id="4258385">.</span><span class="ident" id="4258386">Sign</span><span class="op" id="4258390">(</span><span class="op" id="4258391">)</span>&nbsp;<span class="op" id="4258393">==</span>&nbsp;<span class="num" id="4258396">0</span>&nbsp;<span class="op" id="4258398">||</span>&nbsp;<span class="ident" id="4258401">s</span><span class="op" id="4258402">.</span><span class="ident" id="4258403">Sign</span><span class="op" id="4258407">(</span><span class="op" id="4258408">)</span>&nbsp;<span class="op" id="4258410">==</span>&nbsp;<span class="num" id="4258413">0</span>&nbsp;<span class="op" id="4258415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258419">return</span>&nbsp;<span class="ident" id="4258426">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4258433">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258436">if</span>&nbsp;<span class="ident" id="4258439">r</span><span class="op" id="4258440">.</span><span class="ident" id="4258441">Cmp</span><span class="op" id="4258444">(</span><span class="ident" id="4258445">N</span><span class="op" id="4258446">)</span>&nbsp;<span class="op" id="4258448">&gt;=</span>&nbsp;<span class="num" id="4258451">0</span>&nbsp;<span class="op" id="4258453">||</span>&nbsp;<span class="ident" id="4258456">s</span><span class="op" id="4258457">.</span><span class="ident" id="4258458">Cmp</span><span class="op" id="4258461">(</span><span class="ident" id="4258462">N</span><span class="op" id="4258463">)</span>&nbsp;<span class="op" id="4258465">&gt;=</span>&nbsp;<span class="num" id="4258468">0</span>&nbsp;<span class="op" id="4258470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258474">return</span>&nbsp;<span class="ident" id="4258481">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4258488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258491">e</span>&nbsp;<span class="op" id="4258493">:=</span>&nbsp;<span class="ident" id="4258496">hashToInt</span><span class="op" id="4258505">(</span><span class="ident" id="4258506">hash</span><span class="op" id="4258510">,</span>&nbsp;<span class="ident" id="4258512">c</span><span class="op" id="4258513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258516">w</span>&nbsp;<span class="op" id="4258518">:=</span>&nbsp;<span class="builtinfunc" id="4258521">new</span><span class="op" id="4258524">(</span><span class="ident" id="4258525">big</span><span class="op" id="4258528">.</span><span class="ident" id="4258529">Int</span><span class="op" id="4258532">)</span><span class="op" id="4258533">.</span><span class="ident" id="4258534">ModInverse</span><span class="op" id="4258544">(</span><span class="ident" id="4258545">s</span><span class="op" id="4258546">,</span>&nbsp;<span class="ident" id="4258548">N</span><span class="op" id="4258549">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258553">u1</span>&nbsp;<span class="op" id="4258556">:=</span>&nbsp;<span class="ident" id="4258559">e</span><span class="op" id="4258560">.</span><span class="ident" id="4258561">Mul</span><span class="op" id="4258564">(</span><span class="ident" id="4258565">e</span><span class="op" id="4258566">,</span>&nbsp;<span class="ident" id="4258568">w</span><span class="op" id="4258569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258572">u1</span><span class="op" id="4258574">.</span><span class="ident" id="4258575">Mod</span><span class="op" id="4258578">(</span><span class="ident" id="4258579">u1</span><span class="op" id="4258581">,</span>&nbsp;<span class="ident" id="4258583">N</span><span class="op" id="4258584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258587">u2</span>&nbsp;<span class="op" id="4258590">:=</span>&nbsp;<span class="ident" id="4258593">w</span><span class="op" id="4258594">.</span><span class="ident" id="4258595">Mul</span><span class="op" id="4258598">(</span><span class="ident" id="4258599">r</span><span class="op" id="4258600">,</span>&nbsp;<span class="ident" id="4258602">w</span><span class="op" id="4258603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258606">u2</span><span class="op" id="4258608">.</span><span class="ident" id="4258609">Mod</span><span class="op" id="4258612">(</span><span class="ident" id="4258613">u2</span><span class="op" id="4258615">,</span>&nbsp;<span class="ident" id="4258617">N</span><span class="op" id="4258618">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258622">x1</span><span class="op" id="4258624">,</span>&nbsp;<span class="ident" id="4258626">y1</span>&nbsp;<span class="op" id="4258629">:=</span>&nbsp;<span class="ident" id="4258632">c</span><span class="op" id="4258633">.</span><span class="ident" id="4258634">ScalarBaseMult</span><span class="op" id="4258648">(</span><span class="ident" id="4258649">u1</span><span class="op" id="4258651">.</span><span class="ident" id="4258652">Bytes</span><span class="op" id="4258657">(</span><span class="op" id="4258658">)</span><span class="op" id="4258659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258662">x2</span><span class="op" id="4258664">,</span>&nbsp;<span class="ident" id="4258666">y2</span>&nbsp;<span class="op" id="4258669">:=</span>&nbsp;<span class="ident" id="4258672">c</span><span class="op" id="4258673">.</span><span class="ident" id="4258674">ScalarMult</span><span class="op" id="4258684">(</span><span class="ident" id="4258685">pub</span><span class="op" id="4258688">.</span><span class="ident" id="4258689">X</span><span class="op" id="4258690">,</span>&nbsp;<span class="ident" id="4258692">pub</span><span class="op" id="4258695">.</span><span class="ident" id="4258696">Y</span><span class="op" id="4258697">,</span>&nbsp;<span class="ident" id="4258699">u2</span><span class="op" id="4258701">.</span><span class="ident" id="4258702">Bytes</span><span class="op" id="4258707">(</span><span class="op" id="4258708">)</span><span class="op" id="4258709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258712">x</span><span class="op" id="4258713">,</span>&nbsp;<span class="ident" id="4258715">y</span>&nbsp;<span class="op" id="4258717">:=</span>&nbsp;<span class="ident" id="4258720">c</span><span class="op" id="4258721">.</span><span class="ident" id="4258722">Add</span><span class="op" id="4258725">(</span><span class="ident" id="4258726">x1</span><span class="op" id="4258728">,</span>&nbsp;<span class="ident" id="4258730">y1</span><span class="op" id="4258732">,</span>&nbsp;<span class="ident" id="4258734">x2</span><span class="op" id="4258736">,</span>&nbsp;<span class="ident" id="4258738">y2</span><span class="op" id="4258740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258743">if</span>&nbsp;<span class="ident" id="4258746">x</span><span class="op" id="4258747">.</span><span class="ident" id="4258748">Sign</span><span class="op" id="4258752">(</span><span class="op" id="4258753">)</span>&nbsp;<span class="op" id="4258755">==</span>&nbsp;<span class="num" id="4258758">0</span>&nbsp;<span class="op" id="4258760">&amp;&amp;</span>&nbsp;<span class="ident" id="4258763">y</span><span class="op" id="4258764">.</span><span class="ident" id="4258765">Sign</span><span class="op" id="4258769">(</span><span class="op" id="4258770">)</span>&nbsp;<span class="op" id="4258772">==</span>&nbsp;<span class="num" id="4258775">0</span>&nbsp;<span class="op" id="4258777">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258781">return</span>&nbsp;<span class="ident" id="4258788">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4258795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258798">x</span><span class="op" id="4258799">.</span><span class="ident" id="4258800">Mod</span><span class="op" id="4258803">(</span><span class="ident" id="4258804">x</span><span class="op" id="4258805">,</span>&nbsp;<span class="ident" id="4258807">N</span><span class="op" id="4258808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258811">return</span>&nbsp;<span class="ident" id="4258818">x</span><span class="op" id="4258819">.</span><span class="ident" id="4258820">Cmp</span><span class="op" id="4258823">(</span><span class="ident" id="4258824">r</span><span class="op" id="4258825">)</span>&nbsp;<span class="op" id="4258827">==</span>&nbsp;<span class="num" id="4258830">0</span><br>
<span class="lineno"></span><span class="op" id="4258832">}</span>
</div>
</body>
</html>
