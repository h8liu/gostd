<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2215045">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2215101">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2215155">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2215206">//&nbsp;Netlink&nbsp;sockets&nbsp;and&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2215239">package</span>&nbsp;<span class="ident" id="2215247">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2215256">import</span>&nbsp;<span class="string" id="2215263">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2215273">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;message&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2215339">func</span>&nbsp;<span class="ident" id="2215344">nlmAlignOf</span><span class="op" id="2215354">(</span><span class="ident" id="2215355">msglen</span>&nbsp;<span class="builtintype" id="2215362">int</span><span class="op" id="2215365">)</span>&nbsp;<span class="builtintype" id="2215367">int</span>&nbsp;<span class="op" id="2215371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215374">return</span>&nbsp;<span class="op" id="2215381">(</span><span class="ident" id="2215382">msglen</span>&nbsp;<span class="op" id="2215389">+</span>&nbsp;<span class="ident" id="2215391">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2215405">-</span>&nbsp;<span class="num" id="2215407">1</span><span class="op" id="2215408">)</span>&nbsp;<span class="op" id="2215410">&amp;</span>&nbsp;<span class="op" id="2215412">^</span><span class="op" id="2215413">(</span><span class="ident" id="2215414">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2215428">-</span>&nbsp;<span class="num" id="2215430">1</span><span class="op" id="2215431">)</span><br>
<span class="lineno"></span><span class="op" id="2215433">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2215436">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute&nbsp;up&nbsp;to&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2215500">//&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2215513">func</span>&nbsp;<span class="ident" id="2215518">rtaAlignOf</span><span class="op" id="2215528">(</span><span class="ident" id="2215529">attrlen</span>&nbsp;<span class="builtintype" id="2215537">int</span><span class="op" id="2215540">)</span>&nbsp;<span class="builtintype" id="2215542">int</span>&nbsp;<span class="op" id="2215546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215549">return</span>&nbsp;<span class="op" id="2215556">(</span><span class="ident" id="2215557">attrlen</span>&nbsp;<span class="op" id="2215565">+</span>&nbsp;<span class="ident" id="2215567">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2215579">-</span>&nbsp;<span class="num" id="2215581">1</span><span class="op" id="2215582">)</span>&nbsp;<span class="op" id="2215584">&amp;</span>&nbsp;<span class="op" id="2215586">^</span><span class="op" id="2215587">(</span><span class="ident" id="2215588">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2215600">-</span>&nbsp;<span class="num" id="2215602">1</span><span class="op" id="2215603">)</span><br>
<span class="lineno">20</span><span class="op" id="2215605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2215608">//&nbsp;NetlinkRouteRequest&nbsp;represents&nbsp;a&nbsp;request&nbsp;message&nbsp;to&nbsp;receive&nbsp;routing</span><br>
<span class="lineno"></span><span class="comment" id="2215679">//&nbsp;and&nbsp;link&nbsp;states&nbsp;from&nbsp;the&nbsp;kernel.</span><br>
<span class="lineno"></span><span class="keyword" id="2215715">type</span>&nbsp;<span class="ident" id="2215720">NetlinkRouteRequest</span>&nbsp;<span class="keyword" id="2215740">struct</span>&nbsp;<span class="op" id="2215747">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215750">Header</span>&nbsp;<span class="ident" id="2215757">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215767">Data</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2215774">RtGenmsg</span><br>
<span class="lineno"></span><span class="op" id="2215783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2215786">func</span>&nbsp;<span class="op" id="2215791">(</span><span class="ident" id="2215792">rr</span>&nbsp;<span class="op" id="2215795">*</span><span class="ident" id="2215796">NetlinkRouteRequest</span><span class="op" id="2215815">)</span>&nbsp;<span class="ident" id="2215817">toWireFormat</span><span class="op" id="2215829">(</span><span class="op" id="2215830">)</span>&nbsp;<span class="op" id="2215832">[</span><span class="op" id="2215833">]</span><span class="builtintype" id="2215834">byte</span>&nbsp;<span class="op" id="2215839">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215842">b</span>&nbsp;<span class="op" id="2215844">:=</span>&nbsp;<span class="builtinfunc" id="2215847">make</span><span class="op" id="2215851">(</span><span class="op" id="2215852">[</span><span class="op" id="2215853">]</span><span class="builtintype" id="2215854">byte</span><span class="op" id="2215858">,</span>&nbsp;<span class="ident" id="2215860">rr</span><span class="op" id="2215862">.</span><span class="ident" id="2215863">Header</span><span class="op" id="2215869">.</span><span class="ident" id="2215870">Len</span><span class="op" id="2215873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2215876">*</span><span class="op" id="2215877">(</span><span class="op" id="2215878">*</span><span class="builtintype" id="2215879">uint32</span><span class="op" id="2215885">)</span><span class="op" id="2215886">(</span><span class="ident" id="2215887">unsafe</span><span class="op" id="2215893">.</span><span class="ident" id="2215894">Pointer</span><span class="op" id="2215901">(</span><span class="op" id="2215902">&amp;</span><span class="ident" id="2215903">b</span><span class="op" id="2215904">[</span><span class="num" id="2215905">0</span><span class="op" id="2215906">:</span><span class="num" id="2215907">4</span><span class="op" id="2215908">]</span><span class="op" id="2215909">[</span><span class="num" id="2215910">0</span><span class="op" id="2215911">]</span><span class="op" id="2215912">)</span><span class="op" id="2215913">)</span>&nbsp;<span class="op" id="2215915">=</span>&nbsp;<span class="ident" id="2215917">rr</span><span class="op" id="2215919">.</span><span class="ident" id="2215920">Header</span><span class="op" id="2215926">.</span><span class="ident" id="2215927">Len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2215932">*</span><span class="op" id="2215933">(</span><span class="op" id="2215934">*</span><span class="builtintype" id="2215935">uint16</span><span class="op" id="2215941">)</span><span class="op" id="2215942">(</span><span class="ident" id="2215943">unsafe</span><span class="op" id="2215949">.</span><span class="ident" id="2215950">Pointer</span><span class="op" id="2215957">(</span><span class="op" id="2215958">&amp;</span><span class="ident" id="2215959">b</span><span class="op" id="2215960">[</span><span class="num" id="2215961">4</span><span class="op" id="2215962">:</span><span class="num" id="2215963">6</span><span class="op" id="2215964">]</span><span class="op" id="2215965">[</span><span class="num" id="2215966">0</span><span class="op" id="2215967">]</span><span class="op" id="2215968">)</span><span class="op" id="2215969">)</span>&nbsp;<span class="op" id="2215971">=</span>&nbsp;<span class="ident" id="2215973">rr</span><span class="op" id="2215975">.</span><span class="ident" id="2215976">Header</span><span class="op" id="2215982">.</span><span class="ident" id="2215983">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2215989">*</span><span class="op" id="2215990">(</span><span class="op" id="2215991">*</span><span class="builtintype" id="2215992">uint16</span><span class="op" id="2215998">)</span><span class="op" id="2215999">(</span><span class="ident" id="2216000">unsafe</span><span class="op" id="2216006">.</span><span class="ident" id="2216007">Pointer</span><span class="op" id="2216014">(</span><span class="op" id="2216015">&amp;</span><span class="ident" id="2216016">b</span><span class="op" id="2216017">[</span><span class="num" id="2216018">6</span><span class="op" id="2216019">:</span><span class="num" id="2216020">8</span><span class="op" id="2216021">]</span><span class="op" id="2216022">[</span><span class="num" id="2216023">0</span><span class="op" id="2216024">]</span><span class="op" id="2216025">)</span><span class="op" id="2216026">)</span>&nbsp;<span class="op" id="2216028">=</span>&nbsp;<span class="ident" id="2216030">rr</span><span class="op" id="2216032">.</span><span class="ident" id="2216033">Header</span><span class="op" id="2216039">.</span><span class="ident" id="2216040">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216047">*</span><span class="op" id="2216048">(</span><span class="op" id="2216049">*</span><span class="builtintype" id="2216050">uint32</span><span class="op" id="2216056">)</span><span class="op" id="2216057">(</span><span class="ident" id="2216058">unsafe</span><span class="op" id="2216064">.</span><span class="ident" id="2216065">Pointer</span><span class="op" id="2216072">(</span><span class="op" id="2216073">&amp;</span><span class="ident" id="2216074">b</span><span class="op" id="2216075">[</span><span class="num" id="2216076">8</span><span class="op" id="2216077">:</span><span class="num" id="2216078">12</span><span class="op" id="2216080">]</span><span class="op" id="2216081">[</span><span class="num" id="2216082">0</span><span class="op" id="2216083">]</span><span class="op" id="2216084">)</span><span class="op" id="2216085">)</span>&nbsp;<span class="op" id="2216087">=</span>&nbsp;<span class="ident" id="2216089">rr</span><span class="op" id="2216091">.</span><span class="ident" id="2216092">Header</span><span class="op" id="2216098">.</span><span class="ident" id="2216099">Seq</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216104">*</span><span class="op" id="2216105">(</span><span class="op" id="2216106">*</span><span class="builtintype" id="2216107">uint32</span><span class="op" id="2216113">)</span><span class="op" id="2216114">(</span><span class="ident" id="2216115">unsafe</span><span class="op" id="2216121">.</span><span class="ident" id="2216122">Pointer</span><span class="op" id="2216129">(</span><span class="op" id="2216130">&amp;</span><span class="ident" id="2216131">b</span><span class="op" id="2216132">[</span><span class="num" id="2216133">12</span><span class="op" id="2216135">:</span><span class="num" id="2216136">16</span><span class="op" id="2216138">]</span><span class="op" id="2216139">[</span><span class="num" id="2216140">0</span><span class="op" id="2216141">]</span><span class="op" id="2216142">)</span><span class="op" id="2216143">)</span>&nbsp;<span class="op" id="2216145">=</span>&nbsp;<span class="ident" id="2216147">rr</span><span class="op" id="2216149">.</span><span class="ident" id="2216150">Header</span><span class="op" id="2216156">.</span><span class="ident" id="2216157">Pid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216162">b</span><span class="op" id="2216163">[</span><span class="num" id="2216164">16</span><span class="op" id="2216166">]</span>&nbsp;<span class="op" id="2216168">=</span>&nbsp;<span class="builtintype" id="2216170">byte</span><span class="op" id="2216174">(</span><span class="ident" id="2216175">rr</span><span class="op" id="2216177">.</span><span class="ident" id="2216178">Data</span><span class="op" id="2216182">.</span><span class="ident" id="2216183">Family</span><span class="op" id="2216189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216192">return</span>&nbsp;<span class="ident" id="2216199">b</span><br>
<span class="lineno"></span><span class="op" id="2216201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2216204">func</span>&nbsp;<span class="ident" id="2216209">newNetlinkRouteRequest</span><span class="op" id="2216231">(</span><span class="ident" id="2216232">proto</span><span class="op" id="2216237">,</span>&nbsp;<span class="ident" id="2216239">seq</span><span class="op" id="2216242">,</span>&nbsp;<span class="ident" id="2216244">family</span>&nbsp;<span class="builtintype" id="2216251">int</span><span class="op" id="2216254">)</span>&nbsp;<span class="op" id="2216256">[</span><span class="op" id="2216257">]</span><span class="builtintype" id="2216258">byte</span>&nbsp;<span class="op" id="2216263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216266">rr</span>&nbsp;<span class="op" id="2216269">:=</span>&nbsp;<span class="op" id="2216272">&amp;</span><span class="ident" id="2216273">NetlinkRouteRequest</span><span class="op" id="2216292">{</span><span class="op" id="2216293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216296">rr</span><span class="op" id="2216298">.</span><span class="ident" id="2216299">Header</span><span class="op" id="2216305">.</span><span class="ident" id="2216306">Len</span>&nbsp;<span class="op" id="2216310">=</span>&nbsp;<span class="builtintype" id="2216312">uint32</span><span class="op" id="2216318">(</span><span class="ident" id="2216319">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2216332">+</span>&nbsp;<span class="ident" id="2216334">SizeofRtGenmsg</span><span class="op" id="2216348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216351">rr</span><span class="op" id="2216353">.</span><span class="ident" id="2216354">Header</span><span class="op" id="2216360">.</span><span class="ident" id="2216361">Type</span>&nbsp;<span class="op" id="2216366">=</span>&nbsp;<span class="builtintype" id="2216368">uint16</span><span class="op" id="2216374">(</span><span class="ident" id="2216375">proto</span><span class="op" id="2216380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216383">rr</span><span class="op" id="2216385">.</span><span class="ident" id="2216386">Header</span><span class="op" id="2216392">.</span><span class="ident" id="2216393">Flags</span>&nbsp;<span class="op" id="2216399">=</span>&nbsp;<span class="ident" id="2216401">NLM_F_DUMP</span>&nbsp;<span class="op" id="2216412">|</span>&nbsp;<span class="ident" id="2216414">NLM_F_REQUEST</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216429">rr</span><span class="op" id="2216431">.</span><span class="ident" id="2216432">Header</span><span class="op" id="2216438">.</span><span class="ident" id="2216439">Seq</span>&nbsp;<span class="op" id="2216443">=</span>&nbsp;<span class="builtintype" id="2216445">uint32</span><span class="op" id="2216451">(</span><span class="ident" id="2216452">seq</span><span class="op" id="2216455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216458">rr</span><span class="op" id="2216460">.</span><span class="ident" id="2216461">Data</span><span class="op" id="2216465">.</span><span class="ident" id="2216466">Family</span>&nbsp;<span class="op" id="2216473">=</span>&nbsp;<span class="builtintype" id="2216475">uint8</span><span class="op" id="2216480">(</span><span class="ident" id="2216481">family</span><span class="op" id="2216487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216490">return</span>&nbsp;<span class="ident" id="2216497">rr</span><span class="op" id="2216499">.</span><span class="ident" id="2216500">toWireFormat</span><span class="op" id="2216512">(</span><span class="op" id="2216513">)</span><br>
<span class="lineno"></span><span class="op" id="2216515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="2216518">//&nbsp;NetlinkRIB&nbsp;returns&nbsp;routing&nbsp;information&nbsp;base,&nbsp;as&nbsp;known&nbsp;as&nbsp;RIB,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="2216589">//&nbsp;consists&nbsp;of&nbsp;network&nbsp;facility&nbsp;information,&nbsp;states&nbsp;and&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="2216657">func</span>&nbsp;<span class="ident" id="2216662">NetlinkRIB</span><span class="op" id="2216672">(</span><span class="ident" id="2216673">proto</span><span class="op" id="2216678">,</span>&nbsp;<span class="ident" id="2216680">family</span>&nbsp;<span class="builtintype" id="2216687">int</span><span class="op" id="2216690">)</span>&nbsp;<span class="op" id="2216692">(</span><span class="op" id="2216693">[</span><span class="op" id="2216694">]</span><span class="builtintype" id="2216695">byte</span><span class="op" id="2216699">,</span>&nbsp;<span class="builtintype" id="2216701">error</span><span class="op" id="2216706">)</span>&nbsp;<span class="op" id="2216708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216711">s</span><span class="op" id="2216712">,</span>&nbsp;<span class="ident" id="2216714">err</span>&nbsp;<span class="op" id="2216718">:=</span>&nbsp;<span class="ident" id="2216721">Socket</span><span class="op" id="2216727">(</span><span class="ident" id="2216728">AF_NETLINK</span><span class="op" id="2216738">,</span>&nbsp;<span class="ident" id="2216740">SOCK_RAW</span><span class="op" id="2216748">,</span>&nbsp;<span class="ident" id="2216750">NETLINK_ROUTE</span><span class="op" id="2216763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216766">if</span>&nbsp;<span class="ident" id="2216769">err</span>&nbsp;<span class="op" id="2216773">!=</span>&nbsp;<span class="ident" id="2216776">nil</span>&nbsp;<span class="op" id="2216780">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216784">return</span>&nbsp;<span class="ident" id="2216791">nil</span><span class="op" id="2216794">,</span>&nbsp;<span class="ident" id="2216796">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216804">defer</span>&nbsp;<span class="ident" id="2216810">Close</span><span class="op" id="2216815">(</span><span class="ident" id="2216816">s</span><span class="op" id="2216817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216820">lsa</span>&nbsp;<span class="op" id="2216824">:=</span>&nbsp;<span class="op" id="2216827">&amp;</span><span class="ident" id="2216828">SockaddrNetlink</span><span class="op" id="2216843">{</span><span class="ident" id="2216844">Family</span><span class="op" id="2216850">:</span>&nbsp;<span class="ident" id="2216852">AF_NETLINK</span><span class="op" id="2216862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216865">if</span>&nbsp;<span class="ident" id="2216868">err</span>&nbsp;<span class="op" id="2216872">:=</span>&nbsp;<span class="ident" id="2216875">Bind</span><span class="op" id="2216879">(</span><span class="ident" id="2216880">s</span><span class="op" id="2216881">,</span>&nbsp;<span class="ident" id="2216883">lsa</span><span class="op" id="2216886">)</span><span class="op" id="2216887">;</span>&nbsp;<span class="ident" id="2216889">err</span>&nbsp;<span class="op" id="2216893">!=</span>&nbsp;<span class="ident" id="2216896">nil</span>&nbsp;<span class="op" id="2216900">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216904">return</span>&nbsp;<span class="ident" id="2216911">nil</span><span class="op" id="2216914">,</span>&nbsp;<span class="ident" id="2216916">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216924">wb</span>&nbsp;<span class="op" id="2216927">:=</span>&nbsp;<span class="ident" id="2216930">newNetlinkRouteRequest</span><span class="op" id="2216952">(</span><span class="ident" id="2216953">proto</span><span class="op" id="2216958">,</span>&nbsp;<span class="num" id="2216960">1</span><span class="op" id="2216961">,</span>&nbsp;<span class="ident" id="2216963">family</span><span class="op" id="2216969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216972">if</span>&nbsp;<span class="ident" id="2216975">err</span>&nbsp;<span class="op" id="2216979">:=</span>&nbsp;<span class="ident" id="2216982">Sendto</span><span class="op" id="2216988">(</span><span class="ident" id="2216989">s</span><span class="op" id="2216990">,</span>&nbsp;<span class="ident" id="2216992">wb</span><span class="op" id="2216994">,</span>&nbsp;<span class="num" id="2216996">0</span><span class="op" id="2216997">,</span>&nbsp;<span class="ident" id="2216999">lsa</span><span class="op" id="2217002">)</span><span class="op" id="2217003">;</span>&nbsp;<span class="ident" id="2217005">err</span>&nbsp;<span class="op" id="2217009">!=</span>&nbsp;<span class="ident" id="2217012">nil</span>&nbsp;<span class="op" id="2217016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217020">return</span>&nbsp;<span class="ident" id="2217027">nil</span><span class="op" id="2217030">,</span>&nbsp;<span class="ident" id="2217032">err</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2217037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217040">var</span>&nbsp;<span class="ident" id="2217044">tab</span>&nbsp;<span class="op" id="2217048">[</span><span class="op" id="2217049">]</span><span class="builtintype" id="2217050">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2217056">rbNew</span>&nbsp;<span class="op" id="2217062">:=</span>&nbsp;<span class="builtinfunc" id="2217065">make</span><span class="op" id="2217069">(</span><span class="op" id="2217070">[</span><span class="op" id="2217071">]</span><span class="builtintype" id="2217072">byte</span><span class="op" id="2217076">,</span>&nbsp;<span class="ident" id="2217078">Getpagesize</span><span class="op" id="2217089">(</span><span class="op" id="2217090">)</span><span class="op" id="2217091">)</span><br>
<span class="lineno"></span><span class="ident" id="2217093">done</span><span class="op" id="2217097">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217100">for</span>&nbsp;<span class="op" id="2217104">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2217108">rb</span>&nbsp;<span class="op" id="2217111">:=</span>&nbsp;<span class="ident" id="2217114">rbNew</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2217122">nr</span><span class="op" id="2217124">,</span>&nbsp;<span class="ident" id="2217126">_</span><span class="op" id="2217127">,</span>&nbsp;<span class="ident" id="2217129">err</span>&nbsp;<span class="op" id="2217133">:=</span>&nbsp;<span class="ident" id="2217136">Recvfrom</span><span class="op" id="2217144">(</span><span class="ident" id="2217145">s</span><span class="op" id="2217146">,</span>&nbsp;<span class="ident" id="2217148">rb</span><span class="op" id="2217150">,</span>&nbsp;<span class="num" id="2217152">0</span><span class="op" id="2217153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217157">if</span>&nbsp;<span class="ident" id="2217160">err</span>&nbsp;<span class="op" id="2217164">!=</span>&nbsp;<span class="ident" id="2217167">nil</span>&nbsp;<span class="op" id="2217171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217176">return</span>&nbsp;<span class="ident" id="2217183">nil</span><span class="op" id="2217186">,</span>&nbsp;<span class="ident" id="2217188">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2217194">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217198">if</span>&nbsp;<span class="ident" id="2217201">nr</span>&nbsp;<span class="op" id="2217204">&lt;</span>&nbsp;<span class="ident" id="2217206">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2217219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217224">return</span>&nbsp;<span class="ident" id="2217231">nil</span><span class="op" id="2217234">,</span>&nbsp;<span class="ident" id="2217236">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2217245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2217249">rb</span>&nbsp;<span class="op" id="2217252">=</span>&nbsp;<span class="ident" id="2217254">rb</span><span class="op" id="2217256">[</span><span class="op" id="2217257">:</span><span class="ident" id="2217258">nr</span><span class="op" id="2217260">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2217264">tab</span>&nbsp;<span class="op" id="2217268">=</span>&nbsp;<span class="builtinfunc" id="2217270">append</span><span class="op" id="2217276">(</span><span class="ident" id="2217277">tab</span><span class="op" id="2217280">,</span>&nbsp;<span class="ident" id="2217282">rb</span><span class="op" id="2217284">...</span><span class="op" id="2217287">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2217291">msgs</span><span class="op" id="2217295">,</span>&nbsp;<span class="ident" id="2217297">err</span>&nbsp;<span class="op" id="2217301">:=</span>&nbsp;<span class="ident" id="2217304">ParseNetlinkMessage</span><span class="op" id="2217323">(</span><span class="ident" id="2217324">rb</span><span class="op" id="2217326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217330">if</span>&nbsp;<span class="ident" id="2217333">err</span>&nbsp;<span class="op" id="2217337">!=</span>&nbsp;<span class="ident" id="2217340">nil</span>&nbsp;<span class="op" id="2217344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217349">return</span>&nbsp;<span class="ident" id="2217356">nil</span><span class="op" id="2217359">,</span>&nbsp;<span class="ident" id="2217361">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2217367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217371">for</span>&nbsp;<span class="ident" id="2217375">_</span><span class="op" id="2217376">,</span>&nbsp;<span class="ident" id="2217378">m</span>&nbsp;<span class="op" id="2217380">:=</span>&nbsp;<span class="keyword" id="2217383">range</span>&nbsp;<span class="ident" id="2217389">msgs</span>&nbsp;<span class="op" id="2217394">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2217399">lsa</span><span class="op" id="2217402">,</span>&nbsp;<span class="ident" id="2217404">err</span>&nbsp;<span class="op" id="2217408">:=</span>&nbsp;<span class="ident" id="2217411">Getsockname</span><span class="op" id="2217422">(</span><span class="ident" id="2217423">s</span><span class="op" id="2217424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217429">if</span>&nbsp;<span class="ident" id="2217432">err</span>&nbsp;<span class="op" id="2217436">!=</span>&nbsp;<span class="ident" id="2217439">nil</span>&nbsp;<span class="op" id="2217443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217449">return</span>&nbsp;<span class="ident" id="2217456">nil</span><span class="op" id="2217459">,</span>&nbsp;<span class="ident" id="2217461">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2217468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217473">switch</span>&nbsp;<span class="ident" id="2217480">v</span>&nbsp;<span class="op" id="2217482">:=</span>&nbsp;<span class="ident" id="2217485">lsa</span><span class="op" id="2217488">.</span><span class="op" id="2217489">(</span><span class="keyword" id="2217490">type</span><span class="op" id="2217494">)</span>&nbsp;<span class="op" id="2217496">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217501">case</span>&nbsp;<span class="op" id="2217506">*</span><span class="ident" id="2217507">SockaddrNetlink</span><span class="op" id="2217522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217528">if</span>&nbsp;<span class="ident" id="2217531">m</span><span class="op" id="2217532">.</span><span class="ident" id="2217533">Header</span><span class="op" id="2217539">.</span><span class="ident" id="2217540">Seq</span>&nbsp;<span class="op" id="2217544">!=</span>&nbsp;<span class="num" id="2217547">1</span>&nbsp;<span class="op" id="2217549">||</span>&nbsp;<span class="ident" id="2217552">m</span><span class="op" id="2217553">.</span><span class="ident" id="2217554">Header</span><span class="op" id="2217560">.</span><span class="ident" id="2217561">Pid</span>&nbsp;<span class="op" id="2217565">!=</span>&nbsp;<span class="ident" id="2217568">v</span><span class="op" id="2217569">.</span><span class="ident" id="2217570">Pid</span>&nbsp;<span class="op" id="2217574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217581">return</span>&nbsp;<span class="ident" id="2217588">nil</span><span class="op" id="2217591">,</span>&nbsp;<span class="ident" id="2217593">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2217604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217609">default</span><span class="op" id="2217616">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217622">return</span>&nbsp;<span class="ident" id="2217629">nil</span><span class="op" id="2217632">,</span>&nbsp;<span class="ident" id="2217634">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2217644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217649">if</span>&nbsp;<span class="ident" id="2217652">m</span><span class="op" id="2217653">.</span><span class="ident" id="2217654">Header</span><span class="op" id="2217660">.</span><span class="ident" id="2217661">Type</span>&nbsp;<span class="op" id="2217666">==</span>&nbsp;<span class="ident" id="2217669">NLMSG_DONE</span>&nbsp;<span class="op" id="2217680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217686">break</span>&nbsp;<span class="ident" id="2217692">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2217700">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217705">if</span>&nbsp;<span class="ident" id="2217708">m</span><span class="op" id="2217709">.</span><span class="ident" id="2217710">Header</span><span class="op" id="2217716">.</span><span class="ident" id="2217717">Type</span>&nbsp;<span class="op" id="2217722">==</span>&nbsp;<span class="ident" id="2217725">NLMSG_ERROR</span>&nbsp;<span class="op" id="2217737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217743">return</span>&nbsp;<span class="ident" id="2217750">nil</span><span class="op" id="2217753">,</span>&nbsp;<span class="ident" id="2217755">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2217765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2217769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2217772">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2217775">return</span>&nbsp;<span class="ident" id="2217782">tab</span><span class="op" id="2217785">,</span>&nbsp;<span class="ident" id="2217787">nil</span><br>
<span class="lineno"></span><span class="op" id="2217791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2217794">//&nbsp;NetlinkMessage&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2217842">type</span>&nbsp;<span class="ident" id="2217847">NetlinkMessage</span>&nbsp;<span class="keyword" id="2217862">struct</span>&nbsp;<span class="op" id="2217869">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2217872">Header</span>&nbsp;<span class="ident" id="2217879">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2217889">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2217896">[</span><span class="op" id="2217897">]</span><span class="builtintype" id="2217898">byte</span><br>
<span class="lineno"></span><span class="op" id="2217903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2217906">//&nbsp;ParseNetlinkMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink&nbsp;messages&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="2217974">//&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the&nbsp;NetlinkMessage&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2218037">func</span>&nbsp;<span class="ident" id="2218042">ParseNetlinkMessage</span><span class="op" id="2218061">(</span><span class="ident" id="2218062">b</span>&nbsp;<span class="op" id="2218064">[</span><span class="op" id="2218065">]</span><span class="builtintype" id="2218066">byte</span><span class="op" id="2218070">)</span>&nbsp;<span class="op" id="2218072">(</span><span class="op" id="2218073">[</span><span class="op" id="2218074">]</span><span class="ident" id="2218075">NetlinkMessage</span><span class="op" id="2218089">,</span>&nbsp;<span class="builtintype" id="2218091">error</span><span class="op" id="2218096">)</span>&nbsp;<span class="op" id="2218098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218101">var</span>&nbsp;<span class="ident" id="2218105">msgs</span>&nbsp;<span class="op" id="2218110">[</span><span class="op" id="2218111">]</span><span class="ident" id="2218112">NetlinkMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218128">for</span>&nbsp;<span class="builtinfunc" id="2218132">len</span><span class="op" id="2218135">(</span><span class="ident" id="2218136">b</span><span class="op" id="2218137">)</span>&nbsp;<span class="op" id="2218139">&gt;=</span>&nbsp;<span class="ident" id="2218142">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2218155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2218159">h</span><span class="op" id="2218160">,</span>&nbsp;<span class="ident" id="2218162">dbuf</span><span class="op" id="2218166">,</span>&nbsp;<span class="ident" id="2218168">dlen</span><span class="op" id="2218172">,</span>&nbsp;<span class="ident" id="2218174">err</span>&nbsp;<span class="op" id="2218178">:=</span>&nbsp;<span class="ident" id="2218181">netlinkMessageHeaderAndData</span><span class="op" id="2218208">(</span><span class="ident" id="2218209">b</span><span class="op" id="2218210">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218214">if</span>&nbsp;<span class="ident" id="2218217">err</span>&nbsp;<span class="op" id="2218221">!=</span>&nbsp;<span class="ident" id="2218224">nil</span>&nbsp;<span class="op" id="2218228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218233">return</span>&nbsp;<span class="ident" id="2218240">nil</span><span class="op" id="2218243">,</span>&nbsp;<span class="ident" id="2218245">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2218251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2218255">m</span>&nbsp;<span class="op" id="2218257">:=</span>&nbsp;<span class="ident" id="2218260">NetlinkMessage</span><span class="op" id="2218274">{</span><span class="ident" id="2218275">Header</span><span class="op" id="2218281">:</span>&nbsp;<span class="op" id="2218283">*</span><span class="ident" id="2218284">h</span><span class="op" id="2218285">,</span>&nbsp;<span class="ident" id="2218287">Data</span><span class="op" id="2218291">:</span>&nbsp;<span class="ident" id="2218293">dbuf</span><span class="op" id="2218297">[</span><span class="op" id="2218298">:</span><span class="builtintype" id="2218299">int</span><span class="op" id="2218302">(</span><span class="ident" id="2218303">h</span><span class="op" id="2218304">.</span><span class="ident" id="2218305">Len</span><span class="op" id="2218308">)</span><span class="op" id="2218309">-</span><span class="ident" id="2218310">NLMSG_HDRLEN</span><span class="op" id="2218322">]</span><span class="op" id="2218323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2218327">msgs</span>&nbsp;<span class="op" id="2218332">=</span>&nbsp;<span class="builtinfunc" id="2218334">append</span><span class="op" id="2218340">(</span><span class="ident" id="2218341">msgs</span><span class="op" id="2218345">,</span>&nbsp;<span class="ident" id="2218347">m</span><span class="op" id="2218348">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2218352">b</span>&nbsp;<span class="op" id="2218354">=</span>&nbsp;<span class="ident" id="2218356">b</span><span class="op" id="2218357">[</span><span class="ident" id="2218358">dlen</span><span class="op" id="2218362">:</span><span class="op" id="2218363">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2218366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218369">return</span>&nbsp;<span class="ident" id="2218376">msgs</span><span class="op" id="2218380">,</span>&nbsp;<span class="ident" id="2218382">nil</span><br>
<span class="lineno"></span><span class="op" id="2218386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2218389">func</span>&nbsp;<span class="ident" id="2218394">netlinkMessageHeaderAndData</span><span class="op" id="2218421">(</span><span class="ident" id="2218422">b</span>&nbsp;<span class="op" id="2218424">[</span><span class="op" id="2218425">]</span><span class="builtintype" id="2218426">byte</span><span class="op" id="2218430">)</span>&nbsp;<span class="op" id="2218432">(</span><span class="op" id="2218433">*</span><span class="ident" id="2218434">NlMsghdr</span><span class="op" id="2218442">,</span>&nbsp;<span class="op" id="2218444">[</span><span class="op" id="2218445">]</span><span class="builtintype" id="2218446">byte</span><span class="op" id="2218450">,</span>&nbsp;<span class="builtintype" id="2218452">int</span><span class="op" id="2218455">,</span>&nbsp;<span class="builtintype" id="2218457">error</span><span class="op" id="2218462">)</span>&nbsp;<span class="op" id="2218464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2218467">h</span>&nbsp;<span class="op" id="2218469">:=</span>&nbsp;<span class="op" id="2218472">(</span><span class="op" id="2218473">*</span><span class="ident" id="2218474">NlMsghdr</span><span class="op" id="2218482">)</span><span class="op" id="2218483">(</span><span class="ident" id="2218484">unsafe</span><span class="op" id="2218490">.</span><span class="ident" id="2218491">Pointer</span><span class="op" id="2218498">(</span><span class="op" id="2218499">&amp;</span><span class="ident" id="2218500">b</span><span class="op" id="2218501">[</span><span class="num" id="2218502">0</span><span class="op" id="2218503">]</span><span class="op" id="2218504">)</span><span class="op" id="2218505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218508">if</span>&nbsp;<span class="builtintype" id="2218511">int</span><span class="op" id="2218514">(</span><span class="ident" id="2218515">h</span><span class="op" id="2218516">.</span><span class="ident" id="2218517">Len</span><span class="op" id="2218520">)</span>&nbsp;<span class="op" id="2218522">&lt;</span>&nbsp;<span class="ident" id="2218524">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2218537">||</span>&nbsp;<span class="builtintype" id="2218540">int</span><span class="op" id="2218543">(</span><span class="ident" id="2218544">h</span><span class="op" id="2218545">.</span><span class="ident" id="2218546">Len</span><span class="op" id="2218549">)</span>&nbsp;<span class="op" id="2218551">&gt;</span>&nbsp;<span class="builtinfunc" id="2218553">len</span><span class="op" id="2218556">(</span><span class="ident" id="2218557">b</span><span class="op" id="2218558">)</span>&nbsp;<span class="op" id="2218560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218564">return</span>&nbsp;<span class="ident" id="2218571">nil</span><span class="op" id="2218574">,</span>&nbsp;<span class="ident" id="2218576">nil</span><span class="op" id="2218579">,</span>&nbsp;<span class="num" id="2218581">0</span><span class="op" id="2218582">,</span>&nbsp;<span class="ident" id="2218584">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2218592">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2218595">return</span>&nbsp;<span class="ident" id="2218602">h</span><span class="op" id="2218603">,</span>&nbsp;<span class="ident" id="2218605">b</span><span class="op" id="2218606">[</span><span class="ident" id="2218607">NLMSG_HDRLEN</span><span class="op" id="2218619">:</span><span class="op" id="2218620">]</span><span class="op" id="2218621">,</span>&nbsp;<span class="ident" id="2218623">nlmAlignOf</span><span class="op" id="2218633">(</span><span class="builtintype" id="2218634">int</span><span class="op" id="2218637">(</span><span class="ident" id="2218638">h</span><span class="op" id="2218639">.</span><span class="ident" id="2218640">Len</span><span class="op" id="2218643">)</span><span class="op" id="2218644">)</span><span class="op" id="2218645">,</span>&nbsp;<span class="ident" id="2218647">nil</span><br>
<span class="lineno"></span><span class="op" id="2218651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2218654">//&nbsp;NetlinkRouteAttr&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="2218712">type</span>&nbsp;<span class="ident" id="2218717">NetlinkRouteAttr</span>&nbsp;<span class="keyword" id="2218734">struct</span>&nbsp;<span class="op" id="2218741">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2218744">Attr</span>&nbsp;&nbsp;<span class="ident" id="2218750">RtAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2218758">Value</span>&nbsp;<span class="op" id="2218764">[</span><span class="op" id="2218765">]</span><span class="builtintype" id="2218766">byte</span><br>
<span class="lineno"></span><span class="op" id="2218771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2218774">//&nbsp;ParseNetlinkRouteAttr&nbsp;parses&nbsp;m&#39;s&nbsp;payload&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink</span><br>
<span class="lineno">145</span><span class="comment" id="2218841">//&nbsp;route&nbsp;attributes&nbsp;and&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2218898">//&nbsp;NetlinkRouteAttr&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2218930">func</span>&nbsp;<span class="ident" id="2218935">ParseNetlinkRouteAttr</span><span class="op" id="2218956">(</span><span class="ident" id="2218957">m</span>&nbsp;<span class="op" id="2218959">*</span><span class="ident" id="2218960">NetlinkMessage</span><span class="op" id="2218974">)</span>&nbsp;<span class="op" id="2218976">(</span><span class="op" id="2218977">[</span><span class="op" id="2218978">]</span><span class="ident" id="2218979">NetlinkRouteAttr</span><span class="op" id="2218995">,</span>&nbsp;<span class="builtintype" id="2218997">error</span><span class="op" id="2219002">)</span>&nbsp;<span class="op" id="2219004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219007">var</span>&nbsp;<span class="ident" id="2219011">b</span>&nbsp;<span class="op" id="2219013">[</span><span class="op" id="2219014">]</span><span class="builtintype" id="2219015">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219021">switch</span>&nbsp;<span class="ident" id="2219028">m</span><span class="op" id="2219029">.</span><span class="ident" id="2219030">Header</span><span class="op" id="2219036">.</span><span class="ident" id="2219037">Type</span>&nbsp;<span class="op" id="2219042">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219045">case</span>&nbsp;<span class="ident" id="2219050">RTM_NEWLINK</span><span class="op" id="2219061">,</span>&nbsp;<span class="ident" id="2219063">RTM_DELLINK</span><span class="op" id="2219074">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219078">b</span>&nbsp;<span class="op" id="2219080">=</span>&nbsp;<span class="ident" id="2219082">m</span><span class="op" id="2219083">.</span><span class="ident" id="2219084">Data</span><span class="op" id="2219088">[</span><span class="ident" id="2219089">SizeofIfInfomsg</span><span class="op" id="2219104">:</span><span class="op" id="2219105">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219108">case</span>&nbsp;<span class="ident" id="2219113">RTM_NEWADDR</span><span class="op" id="2219124">,</span>&nbsp;<span class="ident" id="2219126">RTM_DELADDR</span><span class="op" id="2219137">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219141">b</span>&nbsp;<span class="op" id="2219143">=</span>&nbsp;<span class="ident" id="2219145">m</span><span class="op" id="2219146">.</span><span class="ident" id="2219147">Data</span><span class="op" id="2219151">[</span><span class="ident" id="2219152">SizeofIfAddrmsg</span><span class="op" id="2219167">:</span><span class="op" id="2219168">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219171">case</span>&nbsp;<span class="ident" id="2219176">RTM_NEWROUTE</span><span class="op" id="2219188">,</span>&nbsp;<span class="ident" id="2219190">RTM_DELROUTE</span><span class="op" id="2219202">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219206">b</span>&nbsp;<span class="op" id="2219208">=</span>&nbsp;<span class="ident" id="2219210">m</span><span class="op" id="2219211">.</span><span class="ident" id="2219212">Data</span><span class="op" id="2219216">[</span><span class="ident" id="2219217">SizeofRtMsg</span><span class="op" id="2219228">:</span><span class="op" id="2219229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219232">default</span><span class="op" id="2219239">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219243">return</span>&nbsp;<span class="ident" id="2219250">nil</span><span class="op" id="2219253">,</span>&nbsp;<span class="ident" id="2219255">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2219263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219266">var</span>&nbsp;<span class="ident" id="2219270">attrs</span>&nbsp;<span class="op" id="2219276">[</span><span class="op" id="2219277">]</span><span class="ident" id="2219278">NetlinkRouteAttr</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219296">for</span>&nbsp;<span class="builtinfunc" id="2219300">len</span><span class="op" id="2219303">(</span><span class="ident" id="2219304">b</span><span class="op" id="2219305">)</span>&nbsp;<span class="op" id="2219307">&gt;=</span>&nbsp;<span class="ident" id="2219310">SizeofRtAttr</span>&nbsp;<span class="op" id="2219323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219327">a</span><span class="op" id="2219328">,</span>&nbsp;<span class="ident" id="2219330">vbuf</span><span class="op" id="2219334">,</span>&nbsp;<span class="ident" id="2219336">alen</span><span class="op" id="2219340">,</span>&nbsp;<span class="ident" id="2219342">err</span>&nbsp;<span class="op" id="2219346">:=</span>&nbsp;<span class="ident" id="2219349">netlinkRouteAttrAndValue</span><span class="op" id="2219373">(</span><span class="ident" id="2219374">b</span><span class="op" id="2219375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219379">if</span>&nbsp;<span class="ident" id="2219382">err</span>&nbsp;<span class="op" id="2219386">!=</span>&nbsp;<span class="ident" id="2219389">nil</span>&nbsp;<span class="op" id="2219393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219398">return</span>&nbsp;<span class="ident" id="2219405">nil</span><span class="op" id="2219408">,</span>&nbsp;<span class="ident" id="2219410">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2219416">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219420">ra</span>&nbsp;<span class="op" id="2219423">:=</span>&nbsp;<span class="ident" id="2219426">NetlinkRouteAttr</span><span class="op" id="2219442">{</span><span class="ident" id="2219443">Attr</span><span class="op" id="2219447">:</span>&nbsp;<span class="op" id="2219449">*</span><span class="ident" id="2219450">a</span><span class="op" id="2219451">,</span>&nbsp;<span class="ident" id="2219453">Value</span><span class="op" id="2219458">:</span>&nbsp;<span class="ident" id="2219460">vbuf</span><span class="op" id="2219464">[</span><span class="op" id="2219465">:</span><span class="builtintype" id="2219466">int</span><span class="op" id="2219469">(</span><span class="ident" id="2219470">a</span><span class="op" id="2219471">.</span><span class="ident" id="2219472">Len</span><span class="op" id="2219475">)</span><span class="op" id="2219476">-</span><span class="ident" id="2219477">SizeofRtAttr</span><span class="op" id="2219489">]</span><span class="op" id="2219490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219494">attrs</span>&nbsp;<span class="op" id="2219500">=</span>&nbsp;<span class="builtinfunc" id="2219502">append</span><span class="op" id="2219508">(</span><span class="ident" id="2219509">attrs</span><span class="op" id="2219514">,</span>&nbsp;<span class="ident" id="2219516">ra</span><span class="op" id="2219518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219522">b</span>&nbsp;<span class="op" id="2219524">=</span>&nbsp;<span class="ident" id="2219526">b</span><span class="op" id="2219527">[</span><span class="ident" id="2219528">alen</span><span class="op" id="2219532">:</span><span class="op" id="2219533">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2219536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219539">return</span>&nbsp;<span class="ident" id="2219546">attrs</span><span class="op" id="2219551">,</span>&nbsp;<span class="ident" id="2219553">nil</span><br>
<span class="lineno">170</span><span class="op" id="2219557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2219560">func</span>&nbsp;<span class="ident" id="2219565">netlinkRouteAttrAndValue</span><span class="op" id="2219589">(</span><span class="ident" id="2219590">b</span>&nbsp;<span class="op" id="2219592">[</span><span class="op" id="2219593">]</span><span class="builtintype" id="2219594">byte</span><span class="op" id="2219598">)</span>&nbsp;<span class="op" id="2219600">(</span><span class="op" id="2219601">*</span><span class="ident" id="2219602">RtAttr</span><span class="op" id="2219608">,</span>&nbsp;<span class="op" id="2219610">[</span><span class="op" id="2219611">]</span><span class="builtintype" id="2219612">byte</span><span class="op" id="2219616">,</span>&nbsp;<span class="builtintype" id="2219618">int</span><span class="op" id="2219621">,</span>&nbsp;<span class="builtintype" id="2219623">error</span><span class="op" id="2219628">)</span>&nbsp;<span class="op" id="2219630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2219633">a</span>&nbsp;<span class="op" id="2219635">:=</span>&nbsp;<span class="op" id="2219638">(</span><span class="op" id="2219639">*</span><span class="ident" id="2219640">RtAttr</span><span class="op" id="2219646">)</span><span class="op" id="2219647">(</span><span class="ident" id="2219648">unsafe</span><span class="op" id="2219654">.</span><span class="ident" id="2219655">Pointer</span><span class="op" id="2219662">(</span><span class="op" id="2219663">&amp;</span><span class="ident" id="2219664">b</span><span class="op" id="2219665">[</span><span class="num" id="2219666">0</span><span class="op" id="2219667">]</span><span class="op" id="2219668">)</span><span class="op" id="2219669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219672">if</span>&nbsp;<span class="builtintype" id="2219675">int</span><span class="op" id="2219678">(</span><span class="ident" id="2219679">a</span><span class="op" id="2219680">.</span><span class="ident" id="2219681">Len</span><span class="op" id="2219684">)</span>&nbsp;<span class="op" id="2219686">&lt;</span>&nbsp;<span class="ident" id="2219688">SizeofRtAttr</span>&nbsp;<span class="op" id="2219701">||</span>&nbsp;<span class="builtintype" id="2219704">int</span><span class="op" id="2219707">(</span><span class="ident" id="2219708">a</span><span class="op" id="2219709">.</span><span class="ident" id="2219710">Len</span><span class="op" id="2219713">)</span>&nbsp;<span class="op" id="2219715">&gt;</span>&nbsp;<span class="builtinfunc" id="2219717">len</span><span class="op" id="2219720">(</span><span class="ident" id="2219721">b</span><span class="op" id="2219722">)</span>&nbsp;<span class="op" id="2219724">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219728">return</span>&nbsp;<span class="ident" id="2219735">nil</span><span class="op" id="2219738">,</span>&nbsp;<span class="ident" id="2219740">nil</span><span class="op" id="2219743">,</span>&nbsp;<span class="num" id="2219745">0</span><span class="op" id="2219746">,</span>&nbsp;<span class="ident" id="2219748">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2219756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2219759">return</span>&nbsp;<span class="ident" id="2219766">a</span><span class="op" id="2219767">,</span>&nbsp;<span class="ident" id="2219769">b</span><span class="op" id="2219770">[</span><span class="ident" id="2219771">SizeofRtAttr</span><span class="op" id="2219783">:</span><span class="op" id="2219784">]</span><span class="op" id="2219785">,</span>&nbsp;<span class="ident" id="2219787">rtaAlignOf</span><span class="op" id="2219797">(</span><span class="builtintype" id="2219798">int</span><span class="op" id="2219801">(</span><span class="ident" id="2219802">a</span><span class="op" id="2219803">.</span><span class="ident" id="2219804">Len</span><span class="op" id="2219807">)</span><span class="op" id="2219808">)</span><span class="op" id="2219809">,</span>&nbsp;<span class="ident" id="2219811">nil</span><br>
<span class="lineno"></span><span class="op" id="2219815">}</span>
</div>
</body>
</html>
